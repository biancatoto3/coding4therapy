/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/css-loader/dist/cjs.js!./src/index.css":
/*!*************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/index.css ***!
  \*************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/sourceMaps.js */ \"./node_modules/css-loader/dist/runtime/sourceMaps.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"body {\\n    margin: 0;\\n    max-width: 100vw;\\n}\\n\\npre, code {\\n    overflow: auto;\\n}\\n\\n#pageContainer {\\n    display: flex;\\n    width: 100%;\\n    max-width: 100vw;\\n    height: 100vh;\\n}\\n\\n#blocklyDiv {\\n    flex-basis: 100%;\\n    height: 100%;\\n    min-width: 600px;\\n}\\n\\n#outputPane {\\n    display: flex;\\n    flex-direction: column;\\n    width: 400px;\\n    flex: 0 0 400px;\\n    overflow: auto;\\n    margin: 1rem;\\n}\\n\\n#generatedCode {\\n    height: 50%;\\n    background-color: rgb(247, 240, 228);\\n}\\n\\n#output {\\n    height: 50%;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/index.css\"],\"names\":[],\"mappings\":\"AAAA;IACI,SAAS;IACT,gBAAgB;AACpB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,aAAa;IACb,WAAW;IACX,gBAAgB;IAChB,aAAa;AACjB;;AAEA;IACI,gBAAgB;IAChB,YAAY;IACZ,gBAAgB;AACpB;;AAEA;IACI,aAAa;IACb,sBAAsB;IACtB,YAAY;IACZ,eAAe;IACf,cAAc;IACd,YAAY;AAChB;;AAEA;IACI,WAAW;IACX,oCAAoC;AACxC;;AAEA;IACI,WAAW;AACf\",\"sourcesContent\":[\"body {\\n    margin: 0;\\n    max-width: 100vw;\\n}\\n\\npre, code {\\n    overflow: auto;\\n}\\n\\n#pageContainer {\\n    display: flex;\\n    width: 100%;\\n    max-width: 100vw;\\n    height: 100vh;\\n}\\n\\n#blocklyDiv {\\n    flex-basis: 100%;\\n    height: 100%;\\n    min-width: 600px;\\n}\\n\\n#outputPane {\\n    display: flex;\\n    flex-direction: column;\\n    width: 400px;\\n    flex: 0 0 400px;\\n    overflow: auto;\\n    margin: 1rem;\\n}\\n\\n#generatedCode {\\n    height: 50%;\\n    background-color: rgb(247, 240, 228);\\n}\\n\\n#output {\\n    height: 50%;\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL3NyYy9pbmRleC5jc3MuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vc3JjL2luZGV4LmNzcz9mYWE0Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIEltcG9ydHNcbmltcG9ydCBfX19DU1NfTE9BREVSX0FQSV9TT1VSQ0VNQVBfSU1QT1JUX19fIGZyb20gXCIuLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvc291cmNlTWFwcy5qc1wiO1xuaW1wb3J0IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyBmcm9tIFwiLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL2FwaS5qc1wiO1xudmFyIF9fX0NTU19MT0FERVJfRVhQT1JUX19fID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKF9fX0NTU19MT0FERVJfQVBJX1NPVVJDRU1BUF9JTVBPUlRfX18pO1xuLy8gTW9kdWxlXG5fX19DU1NfTE9BREVSX0VYUE9SVF9fXy5wdXNoKFttb2R1bGUuaWQsIFwiYm9keSB7XFxuICAgIG1hcmdpbjogMDtcXG4gICAgbWF4LXdpZHRoOiAxMDB2dztcXG59XFxuXFxucHJlLCBjb2RlIHtcXG4gICAgb3ZlcmZsb3c6IGF1dG87XFxufVxcblxcbiNwYWdlQ29udGFpbmVyIHtcXG4gICAgZGlzcGxheTogZmxleDtcXG4gICAgd2lkdGg6IDEwMCU7XFxuICAgIG1heC13aWR0aDogMTAwdnc7XFxuICAgIGhlaWdodDogMTAwdmg7XFxufVxcblxcbiNibG9ja2x5RGl2IHtcXG4gICAgZmxleC1iYXNpczogMTAwJTtcXG4gICAgaGVpZ2h0OiAxMDAlO1xcbiAgICBtaW4td2lkdGg6IDYwMHB4O1xcbn1cXG5cXG4jb3V0cHV0UGFuZSB7XFxuICAgIGRpc3BsYXk6IGZsZXg7XFxuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxuICAgIHdpZHRoOiA0MDBweDtcXG4gICAgZmxleDogMCAwIDQwMHB4O1xcbiAgICBvdmVyZmxvdzogYXV0bztcXG4gICAgbWFyZ2luOiAxcmVtO1xcbn1cXG5cXG4jZ2VuZXJhdGVkQ29kZSB7XFxuICAgIGhlaWdodDogNTAlO1xcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjQ3LCAyNDAsIDIyOCk7XFxufVxcblxcbiNvdXRwdXQge1xcbiAgICBoZWlnaHQ6IDUwJTtcXG59XCIsIFwiXCIse1widmVyc2lvblwiOjMsXCJzb3VyY2VzXCI6W1wid2VicGFjazovLy4vc3JjL2luZGV4LmNzc1wiXSxcIm5hbWVzXCI6W10sXCJtYXBwaW5nc1wiOlwiQUFBQTtJQUNJLFNBQVM7SUFDVCxnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSxjQUFjO0FBQ2xCOztBQUVBO0lBQ0ksYUFBYTtJQUNiLFdBQVc7SUFDWCxnQkFBZ0I7SUFDaEIsYUFBYTtBQUNqQjs7QUFFQTtJQUNJLGdCQUFnQjtJQUNoQixZQUFZO0lBQ1osZ0JBQWdCO0FBQ3BCOztBQUVBO0lBQ0ksYUFBYTtJQUNiLHNCQUFzQjtJQUN0QixZQUFZO0lBQ1osZUFBZTtJQUNmLGNBQWM7SUFDZCxZQUFZO0FBQ2hCOztBQUVBO0lBQ0ksV0FBVztJQUNYLG9DQUFvQztBQUN4Qzs7QUFFQTtJQUNJLFdBQVc7QUFDZlwiLFwic291cmNlc0NvbnRlbnRcIjpbXCJib2R5IHtcXG4gICAgbWFyZ2luOiAwO1xcbiAgICBtYXgtd2lkdGg6IDEwMHZ3O1xcbn1cXG5cXG5wcmUsIGNvZGUge1xcbiAgICBvdmVyZmxvdzogYXV0bztcXG59XFxuXFxuI3BhZ2VDb250YWluZXIge1xcbiAgICBkaXNwbGF5OiBmbGV4O1xcbiAgICB3aWR0aDogMTAwJTtcXG4gICAgbWF4LXdpZHRoOiAxMDB2dztcXG4gICAgaGVpZ2h0OiAxMDB2aDtcXG59XFxuXFxuI2Jsb2NrbHlEaXYge1xcbiAgICBmbGV4LWJhc2lzOiAxMDAlO1xcbiAgICBoZWlnaHQ6IDEwMCU7XFxuICAgIG1pbi13aWR0aDogNjAwcHg7XFxufVxcblxcbiNvdXRwdXRQYW5lIHtcXG4gICAgZGlzcGxheTogZmxleDtcXG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcXG4gICAgd2lkdGg6IDQwMHB4O1xcbiAgICBmbGV4OiAwIDAgNDAwcHg7XFxuICAgIG92ZXJmbG93OiBhdXRvO1xcbiAgICBtYXJnaW46IDFyZW07XFxufVxcblxcbiNnZW5lcmF0ZWRDb2RlIHtcXG4gICAgaGVpZ2h0OiA1MCU7XFxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyNDcsIDI0MCwgMjI4KTtcXG59XFxuXFxuI291dHB1dCB7XFxuICAgIGhlaWdodDogNTAlO1xcbn1cIl0sXCJzb3VyY2VSb290XCI6XCJcIn1dKTtcbi8vIEV4cG9ydHNcbmV4cG9ydCBkZWZhdWx0IF9fX0NTU19MT0FERVJfRVhQT1JUX19fO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/css-loader/dist/cjs.js!./src/index.css\n");

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/***/ ((module) => {

"use strict";
eval("\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzLmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL2FwaS5qcz8yNGZiIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKlxuICBNSVQgTGljZW5zZSBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICBBdXRob3IgVG9iaWFzIEtvcHBlcnMgQHNva3JhXG4qL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoY3NzV2l0aE1hcHBpbmdUb1N0cmluZykge1xuICB2YXIgbGlzdCA9IFtdO1xuXG4gIC8vIHJldHVybiB0aGUgbGlzdCBvZiBtb2R1bGVzIGFzIGNzcyBzdHJpbmdcbiAgbGlzdC50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIGNvbnRlbnQgPSBcIlwiO1xuICAgICAgdmFyIG5lZWRMYXllciA9IHR5cGVvZiBpdGVtWzVdICE9PSBcInVuZGVmaW5lZFwiO1xuICAgICAgaWYgKGl0ZW1bNF0pIHtcbiAgICAgICAgY29udGVudCArPSBcIkBzdXBwb3J0cyAoXCIuY29uY2F0KGl0ZW1bNF0sIFwiKSB7XCIpO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW1bMl0pIHtcbiAgICAgICAgY29udGVudCArPSBcIkBtZWRpYSBcIi5jb25jYXQoaXRlbVsyXSwgXCIge1wiKTtcbiAgICAgIH1cbiAgICAgIGlmIChuZWVkTGF5ZXIpIHtcbiAgICAgICAgY29udGVudCArPSBcIkBsYXllclwiLmNvbmNhdChpdGVtWzVdLmxlbmd0aCA+IDAgPyBcIiBcIi5jb25jYXQoaXRlbVs1XSkgOiBcIlwiLCBcIiB7XCIpO1xuICAgICAgfVxuICAgICAgY29udGVudCArPSBjc3NXaXRoTWFwcGluZ1RvU3RyaW5nKGl0ZW0pO1xuICAgICAgaWYgKG5lZWRMYXllcikge1xuICAgICAgICBjb250ZW50ICs9IFwifVwiO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW1bMl0pIHtcbiAgICAgICAgY29udGVudCArPSBcIn1cIjtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVtWzRdKSB7XG4gICAgICAgIGNvbnRlbnQgKz0gXCJ9XCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udGVudDtcbiAgICB9KS5qb2luKFwiXCIpO1xuICB9O1xuXG4gIC8vIGltcG9ydCBhIGxpc3Qgb2YgbW9kdWxlcyBpbnRvIHRoZSBsaXN0XG4gIGxpc3QuaSA9IGZ1bmN0aW9uIGkobW9kdWxlcywgbWVkaWEsIGRlZHVwZSwgc3VwcG9ydHMsIGxheWVyKSB7XG4gICAgaWYgKHR5cGVvZiBtb2R1bGVzID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBtb2R1bGVzID0gW1tudWxsLCBtb2R1bGVzLCB1bmRlZmluZWRdXTtcbiAgICB9XG4gICAgdmFyIGFscmVhZHlJbXBvcnRlZE1vZHVsZXMgPSB7fTtcbiAgICBpZiAoZGVkdXBlKSB7XG4gICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgdmFyIGlkID0gdGhpc1trXVswXTtcbiAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICBhbHJlYWR5SW1wb3J0ZWRNb2R1bGVzW2lkXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZm9yICh2YXIgX2sgPSAwOyBfayA8IG1vZHVsZXMubGVuZ3RoOyBfaysrKSB7XG4gICAgICB2YXIgaXRlbSA9IFtdLmNvbmNhdChtb2R1bGVzW19rXSk7XG4gICAgICBpZiAoZGVkdXBlICYmIGFscmVhZHlJbXBvcnRlZE1vZHVsZXNbaXRlbVswXV0pIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGxheWVyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgaXRlbVs1XSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgIGl0ZW1bNV0gPSBsYXllcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtWzFdID0gXCJAbGF5ZXJcIi5jb25jYXQoaXRlbVs1XS5sZW5ndGggPiAwID8gXCIgXCIuY29uY2F0KGl0ZW1bNV0pIDogXCJcIiwgXCIge1wiKS5jb25jYXQoaXRlbVsxXSwgXCJ9XCIpO1xuICAgICAgICAgIGl0ZW1bNV0gPSBsYXllcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG1lZGlhKSB7XG4gICAgICAgIGlmICghaXRlbVsyXSkge1xuICAgICAgICAgIGl0ZW1bMl0gPSBtZWRpYTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtWzFdID0gXCJAbWVkaWEgXCIuY29uY2F0KGl0ZW1bMl0sIFwiIHtcIikuY29uY2F0KGl0ZW1bMV0sIFwifVwiKTtcbiAgICAgICAgICBpdGVtWzJdID0gbWVkaWE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzdXBwb3J0cykge1xuICAgICAgICBpZiAoIWl0ZW1bNF0pIHtcbiAgICAgICAgICBpdGVtWzRdID0gXCJcIi5jb25jYXQoc3VwcG9ydHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGl0ZW1bMV0gPSBcIkBzdXBwb3J0cyAoXCIuY29uY2F0KGl0ZW1bNF0sIFwiKSB7XCIpLmNvbmNhdChpdGVtWzFdLCBcIn1cIik7XG4gICAgICAgICAgaXRlbVs0XSA9IHN1cHBvcnRzO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsaXN0LnB1c2goaXRlbSk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gbGlzdDtcbn07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/css-loader/dist/runtime/api.js\n");

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/sourceMaps.js":
/*!************************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/sourceMaps.js ***!
  \************************************************************/
/***/ ((module) => {

"use strict";
eval("\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvc291cmNlTWFwcy5qcy5qcyIsIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9zb3VyY2VNYXBzLmpzP2FmMTIiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgdmFyIGNvbnRlbnQgPSBpdGVtWzFdO1xuICB2YXIgY3NzTWFwcGluZyA9IGl0ZW1bM107XG4gIGlmICghY3NzTWFwcGluZykge1xuICAgIHJldHVybiBjb250ZW50O1xuICB9XG4gIGlmICh0eXBlb2YgYnRvYSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgdmFyIGJhc2U2NCA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGNzc01hcHBpbmcpKSkpO1xuICAgIHZhciBkYXRhID0gXCJzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04O2Jhc2U2NCxcIi5jb25jYXQoYmFzZTY0KTtcbiAgICB2YXIgc291cmNlTWFwcGluZyA9IFwiLyojIFwiLmNvbmNhdChkYXRhLCBcIiAqL1wiKTtcbiAgICByZXR1cm4gW2NvbnRlbnRdLmNvbmNhdChbc291cmNlTWFwcGluZ10pLmpvaW4oXCJcXG5cIik7XG4gIH1cbiAgcmV0dXJuIFtjb250ZW50XS5qb2luKFwiXFxuXCIpO1xufTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/css-loader/dist/runtime/sourceMaps.js\n");

/***/ }),

/***/ "./node_modules/blockly/blockly.js":
/*!*****************************************!*\
  !*** ./node_modules/blockly/blockly.js ***!
  \*****************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* eslint-disable */\n;(function(root, factory) {\n  if (true) { // AMD\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! ./blockly_compressed */ \"./node_modules/blockly/blockly_compressed.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly module; just a wrapper for blockly_compressed.js.\n */\n\nreturn Blockly;\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYmxvY2tseS9ibG9ja2x5LmpzLmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2Jsb2NrbHkuanM/MTQxYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSAqL1xuOyhmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsgLy8gQU1EXG4gICAgZGVmaW5lKFsnLi9ibG9ja2x5X2NvbXByZXNzZWQnXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7IC8vIE5vZGUuanNcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnLi9ibG9ja2x5X2NvbXByZXNzZWQnKSk7XG4gIH0gZWxzZSB7IC8vIEJyb3dzZXJcbiAgICByb290LkJsb2NrbHkgPSBmYWN0b3J5KHJvb3QuQmxvY2tseSk7XG4gIH1cbn0odGhpcywgZnVuY3Rpb24oQmxvY2tseSkge1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQmxvY2tseSBtb2R1bGU7IGp1c3QgYSB3cmFwcGVyIGZvciBibG9ja2x5X2NvbXByZXNzZWQuanMuXG4gKi9cblxucmV0dXJuIEJsb2NrbHk7XG59KSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/blockly/blockly.js\n");

/***/ }),

/***/ "./node_modules/blockly/blockly_compressed.js":
/*!****************************************************!*\
  !*** ./node_modules/blockly/blockly_compressed.js ***!
  \****************************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// Do not edit this file; automatically generated.\n\n/* eslint-disable */\n;(function(root, factory) {\n  if (true) { // AMD\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else { var factoryExports; }\n}(this, function() {\nvar $={};\nvar warn$$module$build$src$core$utils$deprecation=function(a,b,c,d){a=a+\" was deprecated in \"+b+\" and will be deleted in \"+c+\".\";d&&(a+=\"\\nUse \"+d+\" instead.\");console.warn(a)},longStart$$module$build$src$core$touch=function(a,b){longStop$$module$build$src$core$touch();longPid_$$module$build$src$core$touch=setTimeout(function(){b&&b.handleRightClick(a)},LONGPRESS$$module$build$src$core$touch)},longStop$$module$build$src$core$touch=function(){longPid_$$module$build$src$core$touch&&(clearTimeout(longPid_$$module$build$src$core$touch),\nlongPid_$$module$build$src$core$touch=0)},clearTouchIdentifier$$module$build$src$core$touch=function(){touchIdentifier_$$module$build$src$core$touch=null},shouldHandleEvent$$module$build$src$core$touch=function(a){return!a.type.startsWith(\"pointer\")||a instanceof PointerEvent&&checkTouchIdentifier$$module$build$src$core$touch(a)},getTouchIdentifierFromEvent$$module$build$src$core$touch=function(a){return`${a.pointerId}`},checkTouchIdentifier$$module$build$src$core$touch=function(a){const b=getTouchIdentifierFromEvent$$module$build$src$core$touch(a);\nreturn touchIdentifier_$$module$build$src$core$touch?touchIdentifier_$$module$build$src$core$touch===b:\"pointerdown\"===a.type?(touchIdentifier_$$module$build$src$core$touch=b,!0):!1},setClientFromTouch$$module$build$src$core$touch=function(a){warn$$module$build$src$core$utils$deprecation(\"setClientFromTouch()\",\"version 9\",\"version 10\");if(a.type.startsWith(\"touch\")&&a.changedTouches){const b=a.changedTouches[0];a.clientX=b.clientX;a.clientY=b.clientY}},isMouseOrTouchEvent$$module$build$src$core$touch=\nfunction(a){warn$$module$build$src$core$utils$deprecation(\"isMouseOrTouchEvent()\",\"version 9\",\"version 10\");return a.type.startsWith(\"touch\")||a.type.startsWith(\"mouse\")||a.type.startsWith(\"pointer\")},isTouchEvent$$module$build$src$core$touch=function(a){warn$$module$build$src$core$utils$deprecation(\"isTouchEvent()\",\"version 9\",\"version 10\");return a.type.startsWith(\"touch\")||a.type.startsWith(\"pointer\")},splitEventByTouches$$module$build$src$core$touch=function(a){warn$$module$build$src$core$utils$deprecation(\"splitEventByTouches()\",\n\"version 9\",\"version 10\");const b=[];if(a.changedTouches)for(let c=0;c<a.changedTouches.length;c++)b[c]={type:a.type,changedTouches:[a.changedTouches[c]],target:a.target,stopPropagation(){a.stopPropagation()},preventDefault(){a.preventDefault()}};else b.push(a);return b},conditionalBind$$module$build$src$core$browser_events=function(a,b,c,d,e,f){function g(h){if(e||shouldHandleEvent$$module$build$src$core$touch(h))c?d.call(c,h):d(h)}void 0!==f&&warn$$module$build$src$core$utils$deprecation(\"The opt_noPreventDefault argument of conditionalBind\",\n\"version 9\",\"version 10\");f=[];if(b in TOUCH_MAP$$module$build$src$core$touch)for(let h=0;h<TOUCH_MAP$$module$build$src$core$touch[b].length;h++){const k=TOUCH_MAP$$module$build$src$core$touch[b][h];a.addEventListener(k,g,!1);f.push([a,k,g])}else a.addEventListener(b,g,!1),f.push([a,b,g]);return f},bind$$module$build$src$core$browser_events=function(a,b,c,d){function e(g){c?d.call(c,g):d(g)}const f=[];if(b in TOUCH_MAP$$module$build$src$core$touch)for(let g=0;g<TOUCH_MAP$$module$build$src$core$touch[b].length;g++){const h=\nTOUCH_MAP$$module$build$src$core$touch[b][g];a.addEventListener(h,e,!1);f.push([a,h,e])}else a.addEventListener(b,e,!1),f.push([a,b,e]);return f},unbind$$module$build$src$core$browser_events=function(a){const b=a[a.length-1][2];for(;a.length;){const c=a.pop();c[0].removeEventListener(c[1],c[2],!1)}return b},isTargetInput$$module$build$src$core$browser_events=function(a){if(a.target instanceof HTMLElement){if(a.target.isContentEditable||\"true\"===a.target.getAttribute(\"data-is-text-input\"))return!0;\nif(a.target instanceof HTMLInputElement)return a=a.target,\"text\"===a.type||\"number\"===a.type||\"email\"===a.type||\"password\"===a.type||\"search\"===a.type||\"tel\"===a.type||\"url\"===a.type;if(a.target instanceof HTMLTextAreaElement)return!0}return!1},isRightButton$$module$build$src$core$browser_events=function(a){return a.ctrlKey&&MAC$$module$build$src$core$utils$useragent?!0:2===a.button},mouseToSvg$$module$build$src$core$browser_events=function(a,b,c){const d=b.createSVGPoint();d.x=a.clientX;d.y=a.clientY;\nc||(c=b.getScreenCTM().inverse());return d.matrixTransform(c)},getScrollDeltaPixels$$module$build$src$core$browser_events=function(a){switch(a.deltaMode){default:return{x:a.deltaX,y:a.deltaY};case 1:return{x:a.deltaX*LINE_MODE_MULTIPLIER$$module$build$src$core$browser_events,y:a.deltaY*LINE_MODE_MULTIPLIER$$module$build$src$core$browser_events};case 2:return{x:a.deltaX*PAGE_MODE_MULTIPLIER$$module$build$src$core$browser_events,y:a.deltaY*PAGE_MODE_MULTIPLIER$$module$build$src$core$browser_events}}},\ngetWorkspaceById$$module$build$src$core$common=function(a){return WorkspaceDB_$$module$build$src$core$common[a]||null},getAllWorkspaces$$module$build$src$core$common=function(){const a=[];for(const b in WorkspaceDB_$$module$build$src$core$common)a.push(WorkspaceDB_$$module$build$src$core$common[b]);return a},registerWorkspace$$module$build$src$core$common=function(a){WorkspaceDB_$$module$build$src$core$common[a.id]=a},unregisterWorkpace$$module$build$src$core$common=function(a){delete WorkspaceDB_$$module$build$src$core$common[a.id]},\ngetMainWorkspace$$module$build$src$core$common=function(){return mainWorkspace$$module$build$src$core$common},setMainWorkspace$$module$build$src$core$common=function(a){mainWorkspace$$module$build$src$core$common=a},getSelected$$module$build$src$core$common=function(){return selected$$module$build$src$core$common},setSelected$$module$build$src$core$common=function(a){selected$$module$build$src$core$common=a},getParentContainer$$module$build$src$core$common=function(){return parentContainer$$module$build$src$core$common},\nsetParentContainer$$module$build$src$core$common=function(a){parentContainer$$module$build$src$core$common=a},svgResize$$module$build$src$core$common=function(a){for(;a.options.parentWorkspace;)a=a.options.parentWorkspace;const b=a.getParentSvg(),c=a.getCachedParentSvgSize();var d=b.parentElement;if(d instanceof HTMLElement){var e=d.offsetWidth;d=d.offsetHeight;c.width!==e&&(b.setAttribute(\"width\",e+\"px\"),a.setCachedParentSvgSize(e,null));c.height!==d&&(b.setAttribute(\"height\",d+\"px\"),a.setCachedParentSvgSize(null,\nd));a.resize()}},getBlockTypeCounts$$module$build$src$core$common=function(a,b){const c=Object.create(null),d=a.getDescendants(!0);b&&(a=a.getNextBlock())&&(a=d.indexOf(a),d.splice(a,d.length-a));for(let e=0,f;f=d[e];e++)c[f.type]?c[f.type]++:c[f.type]=1;return c},jsonInitFactory$$module$build$src$core$common=function(a){return function(){this.jsonInit(a)}},defineBlocksWithJsonArray$$module$build$src$core$common=function(a){TEST_ONLY$$module$build$src$core$common.defineBlocksWithJsonArrayInternal(a)},\ndefineBlocksWithJsonArrayInternal$$module$build$src$core$common=function(a){defineBlocks$$module$build$src$core$common(createBlockDefinitionsFromJsonArray$$module$build$src$core$common(a))},createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(a){const b={};for(let c=0;c<a.length;c++){const d=a[c];if(!d){console.warn(`Block definition #${c} in JSON array is ${d}. Skipping`);continue}const e=d.type;e?b[e]={init:jsonInitFactory$$module$build$src$core$common(d)}:console.warn(`Block definition #${c} in JSON array is missing a type attribute. `+\n\"Skipping.\")}return b},defineBlocks$$module$build$src$core$common=function(a){for(const b of Object.keys(a)){const c=a[b];b in Blocks$$module$build$src$core$blocks&&console.warn(`Block definiton \"${b}\" overwrites previous definition.`);Blocks$$module$build$src$core$blocks[b]=c}},createSvgElement$$module$build$src$core$utils$dom=function(a,b,c){a=document.createElementNS(SVG_NS$$module$build$src$core$utils$dom,String(a));for(const d in b)a.setAttribute(d,`${b[d]}`);c&&c.appendChild(a);return a},addClass$$module$build$src$core$utils$dom=\nfunction(a,b){b=b.split(\" \");if(b.every(c=>a.classList.contains(c)))return!1;a.classList.add(...b);return!0},removeClasses$$module$build$src$core$utils$dom=function(a,b){a.classList.remove(...b.split(\" \"))},removeClass$$module$build$src$core$utils$dom=function(a,b){b=b.split(\" \");if(b.every(c=>!a.classList.contains(c)))return!1;a.classList.remove(...b);return!0},hasClass$$module$build$src$core$utils$dom=function(a,b){return a.classList.contains(b)},removeNode$$module$build$src$core$utils$dom=function(a){return a&&\na.parentNode?a.parentNode.removeChild(a):null},insertAfter$$module$build$src$core$utils$dom=function(a,b){const c=b.nextSibling;b=b.parentNode;if(!b)throw Error(\"Reference node has no parent.\");c?b.insertBefore(a,c):b.appendChild(a)},containsNode$$module$build$src$core$utils$dom=function(a,b){return!!(a.compareDocumentPosition(b)&NodeType$$module$build$src$core$utils$dom.DOCUMENT_POSITION_CONTAINED_BY)},setCssTransform$$module$build$src$core$utils$dom=function(a,b){a.style.transform=b;a.style[\"-webkit-transform\"]=\nb},startTextWidthCache$$module$build$src$core$utils$dom=function(){cacheReference$$module$build$src$core$utils$dom++;cacheWidths$$module$build$src$core$utils$dom||(cacheWidths$$module$build$src$core$utils$dom=Object.create(null))},stopTextWidthCache$$module$build$src$core$utils$dom=function(){cacheReference$$module$build$src$core$utils$dom--;cacheReference$$module$build$src$core$utils$dom||(cacheWidths$$module$build$src$core$utils$dom=null)},getTextWidth$$module$build$src$core$utils$dom=function(a){const b=\na.textContent+\"\\n\"+a.className.baseVal;let c;if(cacheWidths$$module$build$src$core$utils$dom&&(c=cacheWidths$$module$build$src$core$utils$dom[b]))return c;try{c=a.getComputedTextLength()}catch(d){return 8*a.textContent.length}cacheWidths$$module$build$src$core$utils$dom&&(cacheWidths$$module$build$src$core$utils$dom[b]=c);return c},getFastTextWidth$$module$build$src$core$utils$dom=function(a,b,c,d){return getFastTextWidthWithSizeString$$module$build$src$core$utils$dom(a,b+\"pt\",c,d)},getFastTextWidthWithSizeString$$module$build$src$core$utils$dom=\nfunction(a,b,c,d){const e=a.textContent;a=e+\"\\n\"+a.className.baseVal;var f;if(cacheWidths$$module$build$src$core$utils$dom&&(f=cacheWidths$$module$build$src$core$utils$dom[a]))return f;canvasContext$$module$build$src$core$utils$dom||(f=document.createElement(\"canvas\"),f.className=\"blocklyComputeCanvas\",document.body.appendChild(f),canvasContext$$module$build$src$core$utils$dom=f.getContext(\"2d\"));canvasContext$$module$build$src$core$utils$dom.font=c+\" \"+b+\" \"+d;f=e?canvasContext$$module$build$src$core$utils$dom.measureText(e).width:\n0;cacheWidths$$module$build$src$core$utils$dom&&(cacheWidths$$module$build$src$core$utils$dom[a]=f);return f},measureFontMetrics$$module$build$src$core$utils$dom=function(a,b,c,d){const e=document.createElement(\"span\");e.style.font=c+\" \"+b+\" \"+d;e.textContent=a;a=document.createElement(\"div\");a.style.width=\"1px\";a.style.height=\"0\";b=document.createElement(\"div\");b.setAttribute(\"style\",\"position: fixed; top: 0; left: 0; display: flex;\");b.appendChild(e);b.appendChild(a);document.body.appendChild(b);\nc={height:0,baseline:0};try{b.style.alignItems=\"baseline\",c.baseline=a.offsetTop-e.offsetTop,b.style.alignItems=\"flex-end\",c.height=a.offsetTop-e.offsetTop}finally{document.body.removeChild(b)}return c},toRadians$$module$build$src$core$utils$math=function(a){return a*Math.PI/180},toDegrees$$module$build$src$core$utils$math=function(a){return 180*a/Math.PI},clamp$$module$build$src$core$utils$math=function(a,b,c){if(c<a){const d=c;c=a;a=d}return Math.max(a,Math.min(b,c))},getSize$$module$build$src$core$utils$style=\nfunction(a){return TEST_ONLY$$module$build$src$core$utils$style.getSizeInternal(a)},getSizeInternal$$module$build$src$core$utils$style=function(a){if(\"none\"!==getComputedStyle$$module$build$src$core$utils$style(a,\"display\"))return getSizeWithDisplay$$module$build$src$core$utils$style(a);const b=a.style,c=b.display,d=b.visibility,e=b.position;b.visibility=\"hidden\";b.position=\"absolute\";b.display=\"inline\";const f=a.offsetWidth;a=a.offsetHeight;b.display=c;b.position=e;b.visibility=d;return new Size$$module$build$src$core$utils$size(f,\na)},getSizeWithDisplay$$module$build$src$core$utils$style=function(a){return new Size$$module$build$src$core$utils$size(a.offsetWidth,a.offsetHeight)},getComputedStyle$$module$build$src$core$utils$style=function(a,b){a=window.getComputedStyle(a);return a[b]||a.getPropertyValue(b)},getCascadedStyle$$module$build$src$core$utils$style=function(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.style.getCascadedStyle\",\"version 9\",\"version 10\");return a.currentStyle?a.currentStyle[b]:\"\"},\ngetPageOffset$$module$build$src$core$utils$style=function(a){const b=new Coordinate$$module$build$src$core$utils$coordinate(0,0);a=a.getBoundingClientRect();var c=document.documentElement;c=new Coordinate$$module$build$src$core$utils$coordinate(window.pageXOffset||c.scrollLeft,window.pageYOffset||c.scrollTop);b.x=a.left+c.x;b.y=a.top+c.y;return b},getViewportPageOffset$$module$build$src$core$utils$style=function(){const a=document.body,b=document.documentElement;return new Coordinate$$module$build$src$core$utils$coordinate(a.scrollLeft||\nb.scrollLeft,a.scrollTop||b.scrollTop)},getBorderBox$$module$build$src$core$utils$style=function(a){const b=parseFloat(getComputedStyle$$module$build$src$core$utils$style(a,\"borderLeftWidth\")),c=parseFloat(getComputedStyle$$module$build$src$core$utils$style(a,\"borderRightWidth\")),d=parseFloat(getComputedStyle$$module$build$src$core$utils$style(a,\"borderTopWidth\"));a=parseFloat(getComputedStyle$$module$build$src$core$utils$style(a,\"borderBottomWidth\"));return new Rect$$module$build$src$core$utils$rect(d,\na,b,c)},scrollIntoContainerView$$module$build$src$core$utils$style=function(a,b,c){a=getContainerOffsetToScrollInto$$module$build$src$core$utils$style(a,b,c);b.scrollLeft=a.x;b.scrollTop=a.y},getContainerOffsetToScrollInto$$module$build$src$core$utils$style=function(a,b,c){var d=getPageOffset$$module$build$src$core$utils$style(a),e=getPageOffset$$module$build$src$core$utils$style(b),f=getBorderBox$$module$build$src$core$utils$style(b);const g=d.x-e.x-f.left;d=d.y-e.y-f.top;e=getSizeWithDisplay$$module$build$src$core$utils$style(a);\na=b.clientWidth-e.width;e=b.clientHeight-e.height;f=b.scrollLeft;b=b.scrollTop;c?(f+=g-a/2,b+=d-e/2):(f+=Math.min(g,Math.max(g-a,0)),b+=Math.min(d,Math.max(d-e,0)));return new Coordinate$$module$build$src$core$utils$coordinate(f,b)},createDom$$module$build$src$core$dropdowndiv=function(){div$$module$build$src$core$dropdowndiv||(div$$module$build$src$core$dropdowndiv=document.createElement(\"div\"),div$$module$build$src$core$dropdowndiv.className=\"blocklyDropDownDiv\",(getParentContainer$$module$build$src$core$common()||\ndocument.body).appendChild(div$$module$build$src$core$dropdowndiv),content$$module$build$src$core$dropdowndiv=document.createElement(\"div\"),content$$module$build$src$core$dropdowndiv.className=\"blocklyDropDownContent\",div$$module$build$src$core$dropdowndiv.appendChild(content$$module$build$src$core$dropdowndiv),arrow$$module$build$src$core$dropdowndiv=document.createElement(\"div\"),arrow$$module$build$src$core$dropdowndiv.className=\"blocklyDropDownArrow\",div$$module$build$src$core$dropdowndiv.appendChild(arrow$$module$build$src$core$dropdowndiv),\ndiv$$module$build$src$core$dropdowndiv.style.opacity=\"0\",div$$module$build$src$core$dropdowndiv.style.transition=\"transform \"+ANIMATION_TIME$$module$build$src$core$dropdowndiv+\"s, opacity \"+ANIMATION_TIME$$module$build$src$core$dropdowndiv+\"s\",div$$module$build$src$core$dropdowndiv.addEventListener(\"focusin\",function(){addClass$$module$build$src$core$utils$dom(div$$module$build$src$core$dropdowndiv,\"blocklyFocused\")}),div$$module$build$src$core$dropdowndiv.addEventListener(\"focusout\",function(){removeClass$$module$build$src$core$utils$dom(div$$module$build$src$core$dropdowndiv,\n\"blocklyFocused\")}))},setBoundsElement$$module$build$src$core$dropdowndiv=function(a){boundsElement$$module$build$src$core$dropdowndiv=a},getOwner$$module$build$src$core$dropdowndiv=function(){return owner$$module$build$src$core$dropdowndiv},getContentDiv$$module$build$src$core$dropdowndiv=function(){return content$$module$build$src$core$dropdowndiv},clearContent$$module$build$src$core$dropdowndiv=function(){content$$module$build$src$core$dropdowndiv.textContent=\"\";content$$module$build$src$core$dropdowndiv.style.width=\n\"\"},setColour$$module$build$src$core$dropdowndiv=function(a,b){div$$module$build$src$core$dropdowndiv.style.backgroundColor=a;div$$module$build$src$core$dropdowndiv.style.borderColor=b},showPositionedByBlock$$module$build$src$core$dropdowndiv=function(a,b,c,d){return showPositionedByRect$$module$build$src$core$dropdowndiv(getScaledBboxOfBlock$$module$build$src$core$dropdowndiv(b),a,c,d)},showPositionedByField$$module$build$src$core$dropdowndiv=function(a,b,c){positionToField$$module$build$src$core$dropdowndiv=\n!0;return showPositionedByRect$$module$build$src$core$dropdowndiv(getScaledBboxOfField$$module$build$src$core$dropdowndiv(a),a,b,c)},getScaledBboxOfBlock$$module$build$src$core$dropdowndiv=function(a){var b=a.getSvgRoot();const c=a.workspace.scale,d=a.height*c;a=a.width*c;b=getPageOffset$$module$build$src$core$utils$style(b);return new Rect$$module$build$src$core$utils$rect(b.y,b.y+d,b.x,b.x+a)},getScaledBboxOfField$$module$build$src$core$dropdowndiv=function(a){a=a.getScaledBBox();return new Rect$$module$build$src$core$utils$rect(a.top,\na.bottom,a.left,a.right)},showPositionedByRect$$module$build$src$core$dropdowndiv=function(a,b,c,d){const e=a.left+(a.right-a.left)/2,f=a.bottom;a=a.top;d&&(a+=d);d=b.getSourceBlock();let g=d.workspace;for(;g.options.parentWorkspace;)g=g.options.parentWorkspace;setBoundsElement$$module$build$src$core$dropdowndiv(g.getParentSvg().parentNode);return show$$module$build$src$core$dropdowndiv(b,d.RTL,e,f,e,a,c)},show$$module$build$src$core$dropdowndiv=function(a,b,c,d,e,f,g){owner$$module$build$src$core$dropdowndiv=\na;onHide$$module$build$src$core$dropdowndiv=g||null;div$$module$build$src$core$dropdowndiv.style.direction=b?\"rtl\":\"ltr\";a=getMainWorkspace$$module$build$src$core$common();renderedClassName$$module$build$src$core$dropdowndiv=a.getRenderer().getClassName();themeClassName$$module$build$src$core$dropdowndiv=a.getTheme().getClassName();renderedClassName$$module$build$src$core$dropdowndiv&&addClass$$module$build$src$core$utils$dom(div$$module$build$src$core$dropdowndiv,renderedClassName$$module$build$src$core$dropdowndiv);\nthemeClassName$$module$build$src$core$dropdowndiv&&addClass$$module$build$src$core$utils$dom(div$$module$build$src$core$dropdowndiv,themeClassName$$module$build$src$core$dropdowndiv);return positionInternal$$module$build$src$core$dropdowndiv(c,d,e,f)},getPositionBelowMetrics$$module$build$src$core$dropdowndiv=function(a,b,c,d){a=getPositionX$$module$build$src$core$dropdowndiv(a,c.left,c.right,d.width);return{initialX:a.divX,initialY:b,finalX:a.divX,finalY:b+PADDING_Y$$module$build$src$core$dropdowndiv,\narrowX:a.arrowX,arrowY:-(ARROW_SIZE$$module$build$src$core$dropdowndiv/2+BORDER_SIZE$$module$build$src$core$dropdowndiv),arrowAtTop:!0,arrowVisible:!0}},getPositionAboveMetrics$$module$build$src$core$dropdowndiv=function(a,b,c,d){a=getPositionX$$module$build$src$core$dropdowndiv(a,c.left,c.right,d.width);return{initialX:a.divX,initialY:b-d.height,finalX:a.divX,finalY:b-d.height-PADDING_Y$$module$build$src$core$dropdowndiv,arrowX:a.arrowX,arrowY:d.height-2*BORDER_SIZE$$module$build$src$core$dropdowndiv-\nARROW_SIZE$$module$build$src$core$dropdowndiv/2,arrowAtTop:!1,arrowVisible:!0}},getPositionTopOfPageMetrics$$module$build$src$core$dropdowndiv=function(a,b,c){a=getPositionX$$module$build$src$core$dropdowndiv(a,b.left,b.right,c.width);return{initialX:a.divX,initialY:0,finalX:a.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},getPositionX$$module$build$src$core$dropdowndiv=function(a,b,c,d){b=clamp$$module$build$src$core$utils$math(b,a-d/2,c-d);a=a-ARROW_SIZE$$module$build$src$core$dropdowndiv/\n2-b;c=ARROW_HORIZONTAL_PADDING$$module$build$src$core$dropdowndiv;a=clamp$$module$build$src$core$utils$math(c,a,d-c-ARROW_SIZE$$module$build$src$core$dropdowndiv);return{arrowX:a,divX:b}},isVisible$$module$build$src$core$dropdowndiv=function(){return!!owner$$module$build$src$core$dropdowndiv},hideIfOwner$$module$build$src$core$dropdowndiv=function(a,b){return owner$$module$build$src$core$dropdowndiv===a?(b?hideWithoutAnimation$$module$build$src$core$dropdowndiv():hide$$module$build$src$core$dropdowndiv(),\n!0):!1},hide$$module$build$src$core$dropdowndiv=function(){div$$module$build$src$core$dropdowndiv.style.transform=\"translate(0, 0)\";div$$module$build$src$core$dropdowndiv.style.opacity=\"0\";animateOutTimer$$module$build$src$core$dropdowndiv=setTimeout(function(){hideWithoutAnimation$$module$build$src$core$dropdowndiv()},1E3*ANIMATION_TIME$$module$build$src$core$dropdowndiv);onHide$$module$build$src$core$dropdowndiv&&(onHide$$module$build$src$core$dropdowndiv(),onHide$$module$build$src$core$dropdowndiv=\nnull)},hideWithoutAnimation$$module$build$src$core$dropdowndiv=function(){isVisible$$module$build$src$core$dropdowndiv()&&(animateOutTimer$$module$build$src$core$dropdowndiv&&clearTimeout(animateOutTimer$$module$build$src$core$dropdowndiv),div$$module$build$src$core$dropdowndiv.style.transform=\"\",div$$module$build$src$core$dropdowndiv.style.left=\"\",div$$module$build$src$core$dropdowndiv.style.top=\"\",div$$module$build$src$core$dropdowndiv.style.opacity=\"0\",div$$module$build$src$core$dropdowndiv.style.display=\n\"none\",div$$module$build$src$core$dropdowndiv.style.backgroundColor=\"\",div$$module$build$src$core$dropdowndiv.style.borderColor=\"\",onHide$$module$build$src$core$dropdowndiv&&(onHide$$module$build$src$core$dropdowndiv(),onHide$$module$build$src$core$dropdowndiv=null),clearContent$$module$build$src$core$dropdowndiv(),owner$$module$build$src$core$dropdowndiv=null,renderedClassName$$module$build$src$core$dropdowndiv&&(removeClass$$module$build$src$core$utils$dom(div$$module$build$src$core$dropdowndiv,\nrenderedClassName$$module$build$src$core$dropdowndiv),renderedClassName$$module$build$src$core$dropdowndiv=\"\"),themeClassName$$module$build$src$core$dropdowndiv&&(removeClass$$module$build$src$core$utils$dom(div$$module$build$src$core$dropdowndiv,themeClassName$$module$build$src$core$dropdowndiv),themeClassName$$module$build$src$core$dropdowndiv=\"\"),getMainWorkspace$$module$build$src$core$common().markFocused())},positionInternal$$module$build$src$core$dropdowndiv=function(a,b,c,d){a=internal$$module$build$src$core$dropdowndiv.getPositionMetrics(a,\nb,c,d);a.arrowVisible?(arrow$$module$build$src$core$dropdowndiv.style.display=\"\",arrow$$module$build$src$core$dropdowndiv.style.transform=\"translate(\"+a.arrowX+\"px,\"+a.arrowY+\"px) rotate(45deg)\",arrow$$module$build$src$core$dropdowndiv.setAttribute(\"class\",a.arrowAtTop?\"blocklyDropDownArrow blocklyArrowTop\":\"blocklyDropDownArrow blocklyArrowBottom\")):arrow$$module$build$src$core$dropdowndiv.style.display=\"none\";b=Math.floor(a.initialX);c=Math.floor(a.initialY);d=Math.floor(a.finalX);const e=Math.floor(a.finalY);\ndiv$$module$build$src$core$dropdowndiv.style.left=b+\"px\";div$$module$build$src$core$dropdowndiv.style.top=c+\"px\";div$$module$build$src$core$dropdowndiv.style.display=\"block\";div$$module$build$src$core$dropdowndiv.style.opacity=\"1\";div$$module$build$src$core$dropdowndiv.style.transform=\"translate(\"+(d-b)+\"px,\"+(e-c)+\"px)\";return!!a.arrowAtTop},repositionForWindowResize$$module$build$src$core$dropdowndiv=function(){if(owner$$module$build$src$core$dropdowndiv){var a=owner$$module$build$src$core$dropdowndiv.getSourceBlock();\na=positionToField$$module$build$src$core$dropdowndiv?getScaledBboxOfField$$module$build$src$core$dropdowndiv(owner$$module$build$src$core$dropdowndiv):getScaledBboxOfBlock$$module$build$src$core$dropdowndiv(a);const b=a.left+(a.right-a.left)/2;positionInternal$$module$build$src$core$dropdowndiv(b,a.bottom,b,a.top)}else hide$$module$build$src$core$dropdowndiv()},register$$module$build$src$core$registry=function(a,b,c,d){if(!(a instanceof Type$$module$build$src$core$registry)&&\"string\"!==typeof a||\n\"\"===String(a).trim())throw Error('Invalid type \"'+a+'\". The type must be a non-empty string or a Blockly.registry.Type.');a=String(a).toLowerCase();if(\"string\"!==typeof b||\"\"===b.trim())throw Error('Invalid name \"'+b+'\". The name must be a non-empty string.');const e=b.toLowerCase();if(!c)throw Error(\"Can not register a null value\");let f=typeMap$$module$build$src$core$registry[a],g=nameMap$$module$build$src$core$registry[a];f||(f=typeMap$$module$build$src$core$registry[a]=Object.create(null),g=\nnameMap$$module$build$src$core$registry[a]=Object.create(null));validate$$module$build$src$core$registry(a,c);if(!d&&f[e])throw Error('Name \"'+e+'\" with type \"'+a+'\" already registered.');f[e]=c;g[e]=b},validate$$module$build$src$core$registry=function(a,b){switch(a){case String(Type$$module$build$src$core$registry.FIELD):if(\"function\"!==typeof b.fromJson)throw Error('Type \"'+a+'\" must have a fromJson function');}},unregister$$module$build$src$core$registry=function(a,b){a=String(a).toLowerCase();\nb=b.toLowerCase();const c=typeMap$$module$build$src$core$registry[a];c&&c[b]?(delete typeMap$$module$build$src$core$registry[a][b],delete nameMap$$module$build$src$core$registry[a][b]):console.warn(\"Unable to unregister [\"+b+\"][\"+a+\"] from the registry.\")},getItem$$module$build$src$core$registry=function(a,b,c){a=String(a).toLowerCase();b=b.toLowerCase();const d=typeMap$$module$build$src$core$registry[a];if(!d||!d[b]){b=\"Unable to find [\"+b+\"][\"+a+\"] in the registry.\";if(c)throw Error(b+\" You must require or register a \"+\na+\" plugin.\");console.warn(b);return null}return d[b]},hasItem$$module$build$src$core$registry=function(a,b){a=String(a).toLowerCase();b=b.toLowerCase();return(a=typeMap$$module$build$src$core$registry[a])?!!a[b]:!1},getClass$$module$build$src$core$registry=function(a,b,c){return getItem$$module$build$src$core$registry(a,b,c)},getObject$$module$build$src$core$registry=function(a,b,c){return getItem$$module$build$src$core$registry(a,b,c)},getAllItems$$module$build$src$core$registry=function(a,b,c){a=\nString(a).toLowerCase();var d=typeMap$$module$build$src$core$registry[a];if(!d){d=`Unable to find [${a}] in the registry.`;if(c)throw Error(`${d} You must require or register a ${a} plugin.`);console.warn(d);return null}if(!b)return d;a=nameMap$$module$build$src$core$registry[a];c=Object.create(null);b=Object.keys(d);for(let e=0;e<b.length;e++){const f=b[e];c[a[f]]=d[f]}return c},getClassFromOptions$$module$build$src$core$registry=function(a,b,c){b=b.plugins[a.toString()]||DEFAULT$$module$build$src$core$registry;\nreturn\"function\"===typeof b?b:getClass$$module$build$src$core$registry(a,b,c)},getNextUniqueId$$module$build$src$core$utils$idgenerator=function(){return\"blockly-\"+(nextId$$module$build$src$core$utils$idgenerator++).toString(36)},genUid$$module$build$src$core$utils$idgenerator=function(){return internal$$module$build$src$core$utils$idgenerator.genUid()},setRecordUndo$$module$build$src$core$events$utils=function(a){recordUndo$$module$build$src$core$events$utils=a},getRecordUndo$$module$build$src$core$events$utils=\nfunction(){return recordUndo$$module$build$src$core$events$utils},fire$$module$build$src$core$events$utils=function(a){TEST_ONLY$$module$build$src$core$events$utils.fireInternal(a)},fireInternal$$module$build$src$core$events$utils=function(a){isEnabled$$module$build$src$core$events$utils()&&(FIRE_QUEUE$$module$build$src$core$events$utils.length||setTimeout(fireNow$$module$build$src$core$events$utils,0),FIRE_QUEUE$$module$build$src$core$events$utils.push(a))},fireNow$$module$build$src$core$events$utils=\nfunction(){const a=filter$$module$build$src$core$events$utils(FIRE_QUEUE$$module$build$src$core$events$utils,!0);FIRE_QUEUE$$module$build$src$core$events$utils.length=0;for(let b=0,c;c=a[b];b++){if(!c.workspaceId)continue;const d=getWorkspaceById$$module$build$src$core$common(c.workspaceId);d&&d.fireChangeListener(c)}},filter$$module$build$src$core$events$utils=function(a,b){a=a.slice();b||a.reverse();const c=[],d=Object.create(null);for(let g=0,h;h=a[g];g++)if(!h.isNull()){var e=[h.isUiEvent?UI$$module$build$src$core$events$utils:\nh.type,h.blockId,h.workspaceId].join(\" \"),f=d[e];const k=f?f.event:null;if(!f)d[e]={event:h,index:g},c.push(h);else if(h.type===MOVE$$module$build$src$core$events$utils&&f.index===g-1)e=h,k.newParentId=e.newParentId,k.newInputName=e.newInputName,k.newCoordinate=e.newCoordinate,f.index=g;else if(h.type===CHANGE$$module$build$src$core$events$utils&&h.element===k.element&&h.name===k.name)k.newValue=h.newValue;else if(h.type===VIEWPORT_CHANGE$$module$build$src$core$events$utils)f=h,k.viewTop=f.viewTop,\nk.viewLeft=f.viewLeft,k.scale=f.scale,k.oldScale=f.oldScale;else if(h.type!==CLICK$$module$build$src$core$events$utils||k.type!==BUBBLE_OPEN$$module$build$src$core$events$utils)d[e]={event:h,index:g},c.push(h)}a=c.filter(function(g){return!g.isNull()});b||a.reverse();for(let g=1,h;h=a[g];g++)h.type===CHANGE$$module$build$src$core$events$utils&&\"mutation\"===h.element&&a.unshift(a.splice(g,1)[0]);return a},clearPendingUndo$$module$build$src$core$events$utils=function(){for(let a=0,b;b=FIRE_QUEUE$$module$build$src$core$events$utils[a];a++)b.recordUndo=\n!1},disable$$module$build$src$core$events$utils=function(){disabled$$module$build$src$core$events$utils++},enable$$module$build$src$core$events$utils=function(){disabled$$module$build$src$core$events$utils--},isEnabled$$module$build$src$core$events$utils=function(){return 0===disabled$$module$build$src$core$events$utils},getGroup$$module$build$src$core$events$utils=function(){return group$$module$build$src$core$events$utils},setGroup$$module$build$src$core$events$utils=function(a){TEST_ONLY$$module$build$src$core$events$utils.setGroupInternal(a)},\nsetGroupInternal$$module$build$src$core$events$utils=function(a){group$$module$build$src$core$events$utils=\"boolean\"===typeof a?a?genUid$$module$build$src$core$utils$idgenerator():\"\":a},getDescendantIds$$module$build$src$core$events$utils=function(a){const b=[];a=a.getDescendants(!1);for(let c=0,d;d=a[c];c++)b[c]=d.id;return b},fromJson$$module$build$src$core$events$utils=function(a,b){var c=get$$module$build$src$core$events$utils(a.type);if(!c)throw Error(\"Unknown event type.\");if(eventClassHasStaticFromJson$$module$build$src$core$events$utils(c))return c.fromJson(a,\nb);c=new c;c.fromJson(a);c.workspaceId=b.id;return c},eventClassHasStaticFromJson$$module$build$src$core$events$utils=function(a){return Object.getOwnPropertyDescriptors(a).fromJson&&\"function\"===typeof a.fromJson},get$$module$build$src$core$events$utils=function(a){const b=getClass$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,a);if(!b)throw Error(`Event type ${a} not found in registry.`);return b},disableOrphans$$module$build$src$core$events$utils=function(a){if((a.type===\nMOVE$$module$build$src$core$events$utils||a.type===CREATE$$module$build$src$core$events$utils)&&a.workspaceId){var b=getWorkspaceById$$module$build$src$core$common(a.workspaceId);if(!a.blockId)throw Error(\"Encountered a blockEvent without a proper blockId\");if(a=b.getBlockById(a.blockId)){const c=recordUndo$$module$build$src$core$events$utils;try{recordUndo$$module$build$src$core$events$utils=!1;const d=a.getParent();if(d&&d.isEnabled()){const e=a.getDescendants(!1);for(let f=0,g;g=e[f];f++)g.setEnabled(!0)}else if((a.outputConnection||\na.previousConnection)&&!b.isDragging()){do a.setEnabled(!1),a=a.getNextBlock();while(a)}}finally{recordUndo$$module$build$src$core$events$utils=c}}}},getDocument$$module$build$src$core$utils$xml=function(){return xmlDocument$$module$build$src$core$utils$xml},setDocument$$module$build$src$core$utils$xml=function(a){xmlDocument$$module$build$src$core$utils$xml=a},createElement$$module$build$src$core$utils$xml=function(a){return xmlDocument$$module$build$src$core$utils$xml.createElementNS(NAME_SPACE$$module$build$src$core$utils$xml,\na)},createTextNode$$module$build$src$core$utils$xml=function(a){return xmlDocument$$module$build$src$core$utils$xml.createTextNode(a)},textToDomDocument$$module$build$src$core$utils$xml=function(a){return(new DOMParser).parseFromString(a,\"text/xml\")},domToText$$module$build$src$core$utils$xml=function(a){return(new XMLSerializer).serializeToString(a)},alert$$module$build$src$core$dialog=function(a,b){alertImplementation$$module$build$src$core$dialog(a,b)},setAlert$$module$build$src$core$dialog=function(a){alertImplementation$$module$build$src$core$dialog=\na},confirm$$module$build$src$core$dialog=function(a,b){TEST_ONLY$$module$build$src$core$dialog.confirmInternal(a,b)},confirmInternal$$module$build$src$core$dialog=function(a,b){confirmImplementation$$module$build$src$core$dialog(a,b)},setConfirm$$module$build$src$core$dialog=function(a){confirmImplementation$$module$build$src$core$dialog=a},prompt$$module$build$src$core$dialog=function(a,b,c){promptImplementation$$module$build$src$core$dialog(a,b,c)},setPrompt$$module$build$src$core$dialog=function(a){promptImplementation$$module$build$src$core$dialog=\na},allUsedVarModels$$module$build$src$core$variables=function(a){a=a.getAllBlocks(!1);const b=new Set;for(let c=0;c<a.length;c++){const d=a[c].getVarModels();if(d)for(let e=0;e<d.length;e++){const f=d[e];f.getId()&&b.add(f)}}return Array.from(b.values())},allDeveloperVariables$$module$build$src$core$variables=function(a){a=a.getAllBlocks(!1);const b=new Set;for(let d=0,e;e=a[d];d++){var c=e.getDeveloperVariables;if(c){c=c();for(let f=0;f<c.length;f++)b.add(c[f])}}return Array.from(b.values())},flyoutCategory$$module$build$src$core$variables=\nfunction(a){let b=[];const c=document.createElement(\"button\");c.setAttribute(\"text\",\"%{BKY_NEW_VARIABLE}\");c.setAttribute(\"callbackKey\",\"CREATE_VARIABLE\");a.registerButtonCallback(\"CREATE_VARIABLE\",function(d){createVariableButtonHandler$$module$build$src$core$variables(d.getTargetWorkspace())});b.push(c);a=flyoutCategoryBlocks$$module$build$src$core$variables(a);return b=b.concat(a)},flyoutCategoryBlocks$$module$build$src$core$variables=function(a){a=a.getVariablesOfType(\"\");const b=[];if(0<a.length){var c=\na[a.length-1];if(Blocks$$module$build$src$core$blocks.variables_set){var d=createElement$$module$build$src$core$utils$xml(\"block\");d.setAttribute(\"type\",\"variables_set\");d.setAttribute(\"gap\",Blocks$$module$build$src$core$blocks.math_change?\"8\":\"24\");d.appendChild(generateVariableFieldDom$$module$build$src$core$variables(c));b.push(d)}Blocks$$module$build$src$core$blocks.math_change&&(d=createElement$$module$build$src$core$utils$xml(\"block\"),d.setAttribute(\"type\",\"math_change\"),d.setAttribute(\"gap\",\nBlocks$$module$build$src$core$blocks.variables_get?\"20\":\"8\"),d.appendChild(generateVariableFieldDom$$module$build$src$core$variables(c)),c=textToDom$$module$build$src$core$xml('<value name=\"DELTA\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value>'),d.appendChild(c),b.push(d));if(Blocks$$module$build$src$core$blocks.variables_get){a.sort(VariableModel$$module$build$src$core$variable_model.compareByName);for(let e=0,f;f=a[e];e++)c=createElement$$module$build$src$core$utils$xml(\"block\"),\nc.setAttribute(\"type\",\"variables_get\"),c.setAttribute(\"gap\",\"8\"),c.appendChild(generateVariableFieldDom$$module$build$src$core$variables(f)),b.push(c)}}return b},generateUniqueName$$module$build$src$core$variables=function(a){return TEST_ONLY$$module$build$src$core$variables.generateUniqueNameInternal(a)},generateUniqueNameInternal$$module$build$src$core$variables=function(a){return generateUniqueNameFromOptions$$module$build$src$core$variables(VAR_LETTER_OPTIONS$$module$build$src$core$variables.charAt(0),\na.getAllVariableNames())},generateUniqueNameFromOptions$$module$build$src$core$variables=function(a,b){if(!b.length)return a;const c=VAR_LETTER_OPTIONS$$module$build$src$core$variables;let d=\"\",e=c.indexOf(a);for(;;){let f=!1;for(let g=0;g<b.length;g++)if(b[g].toLowerCase()===a){f=!0;break}if(!f)break;e++;e===c.length&&(e=0,d=`${Number(d)+1}`);a=c.charAt(e)+d}return a},createVariableButtonHandler$$module$build$src$core$variables=function(a,b,c){function d(f){promptName$$module$build$src$core$variables(Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,\nf,function(g){if(g){const h=nameUsedWithAnyType$$module$build$src$core$variables(g,a);if(h){let k;h.type===e?k=Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace(\"%1\",h.name):(k=Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,k=k.replace(\"%1\",h.name).replace(\"%2\",h.type));alert$$module$build$src$core$dialog(k,function(){d(g)})}else a.createVariable(g,e),b&&b(g)}else b&&b(null)})}const e=c||\"\";d(\"\")},renameVariable$$module$build$src$core$variables=function(a,b,c){function d(e){const f=\nMsg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace(\"%1\",b.name);promptName$$module$build$src$core$variables(f,e,function(g){if(g){var h=nameUsedWithOtherType$$module$build$src$core$variables(g,b.type,a);h?(h=Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace(\"%1\",h.name).replace(\"%2\",h.type),alert$$module$build$src$core$dialog(h,function(){d(g)})):(a.renameVariableById(b.getId(),g),c&&c(g))}else c&&c(null)})}d(\"\")},promptName$$module$build$src$core$variables=\nfunction(a,b,c){prompt$$module$build$src$core$dialog(a,b,function(d){d&&(d=d.replace(/[\\s\\xa0]+/g,\" \").trim(),d===Msg$$module$build$src$core$msg.RENAME_VARIABLE||d===Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(d=null);c(d)})},nameUsedWithOtherType$$module$build$src$core$variables=function(a,b,c){c=c.getVariableMap().getAllVariables();a=a.toLowerCase();for(let d=0,e;e=c[d];d++)if(e.name.toLowerCase()===a&&e.type!==b)return e;return null},nameUsedWithAnyType$$module$build$src$core$variables=function(a,\nb){b=b.getVariableMap().getAllVariables();a=a.toLowerCase();for(let c=0,d;d=b[c];c++)if(d.name.toLowerCase()===a)return d;return null},generateVariableFieldDom$$module$build$src$core$variables=function(a){const b=createElement$$module$build$src$core$utils$xml(\"field\");b.setAttribute(\"name\",\"VAR\");b.setAttribute(\"id\",a.getId());b.setAttribute(\"variabletype\",a.type);a=createTextNode$$module$build$src$core$utils$xml(a.name);b.appendChild(a);return b},getOrCreateVariablePackage$$module$build$src$core$variables=\nfunction(a,b,c,d){let e=getVariable$$module$build$src$core$variables(a,b,c,d);e||(e=createVariable$$module$build$src$core$variables(a,b,c,d));return e},getVariable$$module$build$src$core$variables=function(a,b,c,d){const e=a.getPotentialVariableMap();let f=null;if(b&&(f=a.getVariableById(b),!f&&e&&(f=e.getVariableById(b)),f))return f;if(c){if(void 0===d)throw Error(\"Tried to look up a variable by name without a type\");f=a.getVariable(c,d);!f&&e&&(f=e.getVariable(c,d))}return f},createVariable$$module$build$src$core$variables=\nfunction(a,b,c,d){const e=a.getPotentialVariableMap();c||(c=generateUniqueName$$module$build$src$core$variables(a.isFlyout?a.targetWorkspace:a));return e?e.createVariable(c,d,b):a.createVariable(c,d,b)},getAddedVariables$$module$build$src$core$variables=function(a,b){a=a.getAllVariables();const c=[];if(b.length!==a.length)for(let d=0;d<a.length;d++){const e=a[d];-1===b.indexOf(e)&&c.push(e)}return c},register$$module$build$src$core$css=function(a){if(injected$$module$build$src$core$css)throw Error(\"CSS already injected\");\ncontent$$module$build$src$core$css+=\"\\n\"+a},inject$$module$build$src$core$css=function(a,b){injected$$module$build$src$core$css||(injected$$module$build$src$core$css=!0,a&&(a=b.replace(/[\\\\/]$/,\"\"),b=content$$module$build$src$core$css.replace(/<<<PATH>>>/g,a),content$$module$build$src$core$css=\"\",a=document.createElement(\"style\"),a.id=\"blockly-common-style\",b=document.createTextNode(b),a.appendChild(b),document.head.insertBefore(a,document.head.firstChild)))},getRelativeXY$$module$build$src$core$utils$svg_math=\nfunction(a){const b=new Coordinate$$module$build$src$core$utils$coordinate(0,0);var c=a.x&&a.getAttribute(\"x\");const d=a.y&&a.getAttribute(\"y\");c&&(b.x=parseInt(c));d&&(b.y=parseInt(d));if(c=(c=a.getAttribute(\"transform\"))&&c.match(XY_REGEX$$module$build$src$core$utils$svg_math))b.x+=Number(c[1]),c[3]&&(b.y+=Number(c[3]));(a=a.getAttribute(\"style\"))&&-1<a.indexOf(\"translate\")&&(a=a.match(XY_STYLE_REGEX$$module$build$src$core$utils$svg_math))&&(b.x+=Number(a[1]),a[3]&&(b.y+=Number(a[3])));return b},\ngetInjectionDivXY$$module$build$src$core$utils$svg_math=function(a){let b=0,c=0;for(;a;){const d=getRelativeXY$$module$build$src$core$utils$svg_math(a);b+=d.x;c+=d.y;if(-1!==(\" \"+(a.getAttribute(\"class\")||\"\")+\" \").indexOf(\" injectionDiv \"))break;a=a.parentNode}return new Coordinate$$module$build$src$core$utils$coordinate(b,c)},is3dSupported$$module$build$src$core$utils$svg_math=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.svgMath.is3dSupported\",\"version 9\",\"version 10\");\nreturn!0},getViewportBBox$$module$build$src$core$utils$svg_math=function(){const a=getViewportPageOffset$$module$build$src$core$utils$style();return new Rect$$module$build$src$core$utils$rect(a.y,document.documentElement.clientHeight+a.y,a.x,document.documentElement.clientWidth+a.x)},getDocumentScroll$$module$build$src$core$utils$svg_math=function(){const a=document.documentElement,b=window;return new Coordinate$$module$build$src$core$utils$coordinate(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)},\nscreenToWsCoordinates$$module$build$src$core$utils$svg_math=function(a,b){var c=b.x;b=b.y;const d=a.getInjectionDiv().getBoundingClientRect();c=new Coordinate$$module$build$src$core$utils$coordinate(c-d.left,b-d.top);b=a.getOriginOffsetInPixels();return Coordinate$$module$build$src$core$utils$coordinate.difference(c,b).scale(1/a.scale)},workspaceToDom$$module$build$src$core$xml=function(a,b){const c=createElement$$module$build$src$core$utils$xml(\"xml\");var d=variablesToDom$$module$build$src$core$xml(allUsedVarModels$$module$build$src$core$variables(a));\nd.hasChildNodes()&&c.appendChild(d);d=a.getTopComments(!0);for(let e=0;e<d.length;e++)c.appendChild(d[e].toXmlWithXY(b));a=a.getTopBlocks(!0);for(d=0;d<a.length;d++)c.appendChild(blockToDomWithXY$$module$build$src$core$xml(a[d],b));return c},variablesToDom$$module$build$src$core$xml=function(a){const b=createElement$$module$build$src$core$utils$xml(\"variables\");for(let c=0;c<a.length;c++){const d=a[c],e=createElement$$module$build$src$core$utils$xml(\"variable\");e.appendChild(createTextNode$$module$build$src$core$utils$xml(d.name));\nd.type&&e.setAttribute(\"type\",d.type);e.id=d.getId();b.appendChild(e)}return b},blockToDomWithXY$$module$build$src$core$xml=function(a,b){if(a.isInsertionMarker()&&(a=a.getChildren(!1)[0],!a))return new DocumentFragment;let c=0;a.workspace.RTL&&(c=a.workspace.getWidth());b=blockToDom$$module$build$src$core$xml(a,b);const d=a.getRelativeToSurfaceXY();b.setAttribute(\"x\",Math.round(a.workspace.RTL?c-d.x:d.x));b.setAttribute(\"y\",Math.round(d.y));return b},fieldToDom$$module$build$src$core$xml=function(a){if(a.isSerializable()){const b=\ncreateElement$$module$build$src$core$utils$xml(\"field\");b.setAttribute(\"name\",a.name||\"\");return a.toXml(b)}return null},allFieldsToDom$$module$build$src$core$xml=function(a,b){for(let c=0;c<a.inputList.length;c++){const d=a.inputList[c];for(let e=0;e<d.fieldRow.length;e++){const f=fieldToDom$$module$build$src$core$xml(d.fieldRow[e]);f&&b.appendChild(f)}}},blockToDom$$module$build$src$core$xml=function(a,b){if(a.isInsertionMarker())return(b=a.getChildren(!1)[0])?blockToDom$$module$build$src$core$xml(b):\nnew DocumentFragment;const c=createElement$$module$build$src$core$utils$xml(a.isShadow()?\"shadow\":\"block\");c.setAttribute(\"type\",a.type);b||c.setAttribute(\"id\",a.id);if(a.mutationToDom){var d=a.mutationToDom();d&&(d.hasChildNodes()||d.hasAttributes())&&c.appendChild(d)}allFieldsToDom$$module$build$src$core$xml(a,c);if(d=a.getCommentText()){var e=a.commentModel.size,f=a.commentModel.pinned,g=createElement$$module$build$src$core$utils$xml(\"comment\");g.appendChild(createTextNode$$module$build$src$core$utils$xml(d));\ng.setAttribute(\"pinned\",f);g.setAttribute(\"h\",e.height);g.setAttribute(\"w\",e.width);c.appendChild(g)}a.data&&(d=createElement$$module$build$src$core$utils$xml(\"data\"),d.appendChild(createTextNode$$module$build$src$core$utils$xml(a.data)),c.appendChild(d));for(d=0;d<a.inputList.length;d++){e=a.inputList[d];var h=void 0;f=!0;if(e.type!==inputTypes$$module$build$src$core$input_types.DUMMY){g=e.connection.targetBlock();e.type===inputTypes$$module$build$src$core$input_types.VALUE?h=createElement$$module$build$src$core$utils$xml(\"value\"):\ne.type===inputTypes$$module$build$src$core$input_types.STATEMENT&&(h=createElement$$module$build$src$core$utils$xml(\"statement\"));const l=e.connection.getShadowDom();!l||g&&g.isShadow()||h.appendChild(cloneShadow$$module$build$src$core$xml(l,b));g&&(g=blockToDom$$module$build$src$core$xml(g,b),g.nodeType===NodeType$$module$build$src$core$utils$dom.ELEMENT_NODE&&(h.appendChild(g),f=!1));h.setAttribute(\"name\",e.name);f||c.appendChild(h)}}void 0!==a.inputsInline&&a.inputsInline!==a.inputsInlineDefault&&\nc.setAttribute(\"inline\",a.inputsInline.toString());a.isCollapsed()&&c.setAttribute(\"collapsed\",\"true\");a.isEnabled()||c.setAttribute(\"disabled\",\"true\");a.isDeletable()||a.isShadow()||c.setAttribute(\"deletable\",\"false\");a.isMovable()||a.isShadow()||c.setAttribute(\"movable\",\"false\");a.isEditable()||c.setAttribute(\"editable\",\"false\");h=a.getNextBlock();let k;h&&(d=blockToDom$$module$build$src$core$xml(h,b),d.nodeType===NodeType$$module$build$src$core$utils$dom.ELEMENT_NODE&&(k=createElement$$module$build$src$core$utils$xml(\"next\"),\nk.appendChild(d),c.appendChild(k)));a=a.nextConnection&&a.nextConnection.getShadowDom();!a||h&&h.isShadow()||k.appendChild(cloneShadow$$module$build$src$core$xml(a,b));return c},cloneShadow$$module$build$src$core$xml=function(a,b){let c=a=a.cloneNode(!0),d;for(;c;)if(b&&\"shadow\"===c.nodeName&&c.removeAttribute(\"id\"),c.firstChild)c=c.firstChild;else{for(;c&&!c.nextSibling;){d=c;c=c.parentNode;let e;d.nodeType===NodeType$$module$build$src$core$utils$dom.TEXT_NODE&&\"\"===d.data.trim()&&(null==(e=c)?void 0:\ne.firstChild)!==d&&removeNode$$module$build$src$core$utils$dom(d)}c&&(d=c,c=c.nextSibling,d.nodeType===NodeType$$module$build$src$core$utils$dom.TEXT_NODE&&\"\"===d.data.trim()&&removeNode$$module$build$src$core$utils$dom(d))}return a},domToText$$module$build$src$core$xml=function(a){return domToText$$module$build$src$core$utils$xml(a).replace(/<(\\w+)([^<]*)\\/>/g,\"<$1$2></$1>\")},domToPrettyText$$module$build$src$core$xml=function(a){a=domToText$$module$build$src$core$xml(a).split(\"<\");let b=\"\";for(let c=\n1;c<a.length;c++){const d=a[c];\"/\"===d[0]&&(b=b.substring(2));a[c]=b+\"<\"+d;\"/\"!==d[0]&&\"/>\"!==d.slice(-2)&&(b+=\"  \")}a=a.join(\"\\n\");a=a.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g,\"$1</$2>\");return a.replace(/^\\n/,\"\")},textToDom$$module$build$src$core$xml=function(a){const b=textToDomDocument$$module$build$src$core$utils$xml(a);if(!b||!b.documentElement||b.getElementsByTagName(\"parsererror\").length)throw Error(\"textToDom was unable to parse: \"+a);return b.documentElement},clearWorkspaceAndLoadFromXml$$module$build$src$core$xml=\nfunction(a,b){b.setResizesEnabled(!1);b.clear();a=domToWorkspace$$module$build$src$core$xml(a,b);b.setResizesEnabled(!0);return a},domToWorkspace$$module$build$src$core$xml=function(a,b){let c=0;b.RTL&&(c=b.getWidth());const d=[];startTextWidthCache$$module$build$src$core$utils$dom();const e=getGroup$$module$build$src$core$events$utils();e||setGroup$$module$build$src$core$events$utils(!0);b.setResizesEnabled&&b.setResizesEnabled(!1);let f=!0;try{for(let g=0,h;h=a.childNodes[g];g++){const k=h.nodeName.toLowerCase(),\nl=h;if(\"block\"===k||\"shadow\"===k&&!getRecordUndo$$module$build$src$core$events$utils()){const m=domToBlock$$module$build$src$core$xml(l,b);d.push(m.id);const n=l.hasAttribute(\"x\")?parseInt(l.getAttribute(\"x\")):10,p=l.hasAttribute(\"y\")?parseInt(l.getAttribute(\"y\")):10;isNaN(n)||isNaN(p)||m.moveBy(b.RTL?c-n:n,p);f=!1}else{if(\"shadow\"===k)throw TypeError(\"Shadow block cannot be a top-level block.\");if(\"comment\"===k)b.rendered?WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.fromXmlRendered(l,\nb,c):WorkspaceComment$$module$build$src$core$workspace_comment.fromXml(l,b);else if(\"variables\"===k){if(f)domToVariables$$module$build$src$core$xml(l,b);else throw Error(\"'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.\");f=!1}}}}finally{e||setGroup$$module$build$src$core$events$utils(!1),stopTextWidthCache$$module$build$src$core$utils$dom()}b.setResizesEnabled&&b.setResizesEnabled(!0);fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(FINISHED_LOADING$$module$build$src$core$events$utils))(b));\nreturn d},appendDomToWorkspace$$module$build$src$core$xml=function(a,b){if(!b.getBlocksBoundingBox)return domToWorkspace$$module$build$src$core$xml(a,b);var c=b.getBlocksBoundingBox();a=domToWorkspace$$module$build$src$core$xml(a,b);if(c&&c.top!==c.bottom){var d=c.bottom;c=b.RTL?c.right:c.left;var e=Infinity;let f=-Infinity,g=Infinity;for(let h=0;h<a.length;h++){const k=b.getBlockById(a[h]).getRelativeToSurfaceXY();k.y<g&&(g=k.y);k.x<e&&(e=k.x);k.x>f&&(f=k.x)}d=d-g+10;c=b.RTL?c-f:c-e;for(e=0;e<a.length;e++)b.getBlockById(a[e]).moveBy(c,\nd)}return a},domToBlock$$module$build$src$core$xml=function(a,b){disable$$module$build$src$core$events$utils();var c=b.getAllVariables();let d;try{if(d=domToBlockHeadless$$module$build$src$core$xml(a,b),b.rendered){const e=d,f=d.getDescendants(!1);e.setConnectionTracking(!1);for(let g=f.length-1;0<=g;g--)f[g].initSvg();for(let g=f.length-1;0<=g;g--)f[g].render(!1);setTimeout(function(){e.disposed||e.setConnectionTracking(!0)},1);e.updateDisabled();b.resizeContents()}else{const e=d.getDescendants(!1);\nfor(let f=e.length-1;0<=f;f--)e[f].initModel()}}finally{enable$$module$build$src$core$events$utils()}if(isEnabled$$module$build$src$core$events$utils()){a=getAddedVariables$$module$build$src$core$variables(b,c);for(b=0;b<a.length;b++)c=a[b],fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(VAR_CREATE$$module$build$src$core$events$utils))(c));fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CREATE$$module$build$src$core$events$utils))(d))}return d},\ndomToVariables$$module$build$src$core$xml=function(a,b){for(let c=0;c<a.children.length;c++){const d=a.children[c],e=d.getAttribute(\"type\"),f=d.getAttribute(\"id\");b.createVariable(d.textContent,e,f)}},mapSupportedXmlTags$$module$build$src$core$xml=function(a){const b={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let c=0;c<a.children.length;c++){const d=a.children[c];if(d.nodeType!==NodeType$$module$build$src$core$utils$dom.TEXT_NODE)switch(d.nodeName.toLowerCase()){case \"mutation\":b.mutation.push(d);\nbreak;case \"comment\":b.comment.push(d);break;case \"data\":b.data.push(d);break;case \"title\":case \"field\":b.field.push(d);break;case \"value\":case \"statement\":b.input.push(d);break;case \"next\":b.next.push(d);break;default:console.warn(\"Ignoring unknown tag: \"+d.nodeName)}}return b},applyMutationTagNodes$$module$build$src$core$xml=function(a,b){let c=!1;for(let d=0;d<a.length;d++){const e=a[d];b.domToMutation&&(b.domToMutation(e),b.initSvg&&(c=!0))}return c},applyCommentTagNodes$$module$build$src$core$xml=\nfunction(a,b){for(let d=0;d<a.length;d++){var c=a[d];const e=c.textContent,f=\"true\"===c.getAttribute(\"pinned\"),g=parseInt(c.getAttribute(\"w\"));c=parseInt(c.getAttribute(\"h\"));b.setCommentText(e);b.commentModel.pinned=f;isNaN(g)||isNaN(c)||(b.commentModel.size=new Size$$module$build$src$core$utils$size(g,c));if(f&&b.getCommentIcon&&!b.isInFlyout){const h=b;setTimeout(function(){h.getCommentIcon().setVisible(!0)},1)}}},applyDataTagNodes$$module$build$src$core$xml=function(a,b){for(let c=0;c<a.length;c++)b.data=\na[c].textContent},applyFieldTagNodes$$module$build$src$core$xml=function(a,b){for(let c=0;c<a.length;c++){const d=a[c],e=d.getAttribute(\"name\");domToField$$module$build$src$core$xml(b,e,d)}},findChildBlocks$$module$build$src$core$xml=function(a){const b={childBlockElement:null,childShadowElement:null};for(let c=0;c<a.childNodes.length;c++){const d=a.childNodes[c];d.nodeType===NodeType$$module$build$src$core$utils$dom.ELEMENT_NODE&&(\"block\"===d.nodeName.toLowerCase()?b.childBlockElement=d:\"shadow\"===\nd.nodeName.toLowerCase()&&(b.childShadowElement=d))}return b},applyInputTagNodes$$module$build$src$core$xml=function(a,b,c,d){for(let f=0;f<a.length;f++){var e=a[f];const g=e.getAttribute(\"name\"),h=c.getInput(g);if(!h){console.warn(\"Ignoring non-existent input \"+g+\" in block \"+d);break}e=findChildBlocks$$module$build$src$core$xml(e);if(e.childBlockElement){if(!h.connection)throw TypeError(\"Input connection does not exist.\");domToBlockHeadless$$module$build$src$core$xml(e.childBlockElement,b,h.connection,\n!1)}if(e.childShadowElement){let k;null==(k=h.connection)||k.setShadowDom(e.childShadowElement)}}},applyNextTagNodes$$module$build$src$core$xml=function(a,b,c){for(let d=0;d<a.length;d++){const e=findChildBlocks$$module$build$src$core$xml(a[d]);if(e.childBlockElement){if(!c.nextConnection)throw TypeError(\"Next statement does not exist.\");if(c.nextConnection.isConnected())throw TypeError(\"Next statement is already connected.\");domToBlockHeadless$$module$build$src$core$xml(e.childBlockElement,b,c.nextConnection,\n!0)}e.childShadowElement&&c.nextConnection&&c.nextConnection.setShadowDom(e.childShadowElement)}},domToBlockHeadless$$module$build$src$core$xml=function(a,b,c,d){const e=a.getAttribute(\"type\");if(!e)throw TypeError(\"Block type unspecified: \"+a.outerHTML);var f=a.getAttribute(\"id\");f=b.newBlock(e,f);const g=mapSupportedXmlTags$$module$build$src$core$xml(a),h=applyMutationTagNodes$$module$build$src$core$xml(g.mutation,f);applyCommentTagNodes$$module$build$src$core$xml(g.comment,f);applyDataTagNodes$$module$build$src$core$xml(g.data,\nf);if(c)if(d)if(f.previousConnection)c.connect(f.previousConnection);else throw TypeError(\"Next block does not have previous statement.\");else if(f.outputConnection)c.connect(f.outputConnection);else if(f.previousConnection)c.connect(f.previousConnection);else throw TypeError(\"Child block does not have output or previous statement.\");applyFieldTagNodes$$module$build$src$core$xml(g.field,f);applyInputTagNodes$$module$build$src$core$xml(g.input,b,f,e);applyNextTagNodes$$module$build$src$core$xml(g.next,\nb,f);h&&f.initSvg();(b=a.getAttribute(\"inline\"))&&f.setInputsInline(\"true\"===b);(b=a.getAttribute(\"disabled\"))&&f.setEnabled(\"true\"!==b&&\"disabled\"!==b);(b=a.getAttribute(\"deletable\"))&&f.setDeletable(\"true\"===b);(b=a.getAttribute(\"movable\"))&&f.setMovable(\"true\"===b);(b=a.getAttribute(\"editable\"))&&f.setEditable(\"true\"===b);(b=a.getAttribute(\"collapsed\"))&&f.setCollapsed(\"true\"===b);if(\"shadow\"===a.nodeName.toLowerCase()){a=f.getChildren(!1);for(b=0;b<a.length;b++)if(!a[b].isShadow())throw TypeError(\"Shadow block not allowed non-shadow child.\");\nif(f.getVarModels().length)throw TypeError(\"Shadow blocks cannot have variable references.\");f.setShadow(!0)}return f},domToField$$module$build$src$core$xml=function(a,b,c){const d=a.getField(b);d?d.fromXml(c):console.warn(\"Ignoring non-existent field \"+b+\" in block \"+a.type)},deleteNext$$module$build$src$core$xml=function(a){for(let b=0;b<a.childNodes.length;b++){const c=a.childNodes[b];if(\"next\"===c.nodeName.toLowerCase()){a.removeChild(c);break}}},startsWith$$module$build$src$core$utils$string=\nfunction(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.string.startsWith()\",\"April 2022\",\"April 2023\",\"Use built-in string.startsWith\");return a.startsWith(b)},shortestStringLength$$module$build$src$core$utils$string=function(a){return a.length?a.reduce(function(b,c){return b.length<c.length?b:c}).length:0},commonWordPrefix$$module$build$src$core$utils$string=function(a,b){if(!a.length)return 0;if(1===a.length)return a[0].length;let c=0;b=b||shortestStringLength$$module$build$src$core$utils$string(a);\nlet d;for(d=0;d<b;d++){var e=a[0][d];for(var f=1;f<a.length;f++)if(e!==a[f][d])return c;\" \"===e&&(c=d+1)}for(e=1;e<a.length;e++)if((f=a[e][d])&&\" \"!==f)return c;return b},commonWordSuffix$$module$build$src$core$utils$string=function(a,b){if(!a.length)return 0;if(1===a.length)return a[0].length;let c=0;b=b||shortestStringLength$$module$build$src$core$utils$string(a);let d;for(d=0;d<b;d++){var e=a[0].substr(-d-1,1);for(var f=1;f<a.length;f++)if(e!==a[f].substr(-d-1,1))return c;\" \"===e&&(c=d+1)}for(e=\n1;e<a.length;e++)if((f=a[e].charAt(a[e].length-d-1))&&\" \"!==f)return c;return b},wrap$$module$build$src$core$utils$string=function(a,b){a=a.split(\"\\n\");for(let c=0;c<a.length;c++)a[c]=wrapLine$$module$build$src$core$utils$string(a[c],b);return a.join(\"\\n\")},wrapLine$$module$build$src$core$utils$string=function(a,b){if(a.length<=b)return a;const c=a.trim().split(/\\s+/);for(var d=0;d<c.length;d++)c[d].length>b&&(b=c[d].length);var e=-Infinity;let f,g=1;do{d=e;f=a;a=[];e=c.length/g;let h=1;for(let k=\n0;k<c.length-1;k++)h<(k+1.5)/e?(h++,a[k]=!0):a[k]=!1;a=wrapMutate$$module$build$src$core$utils$string(c,a,b);e=wrapScore$$module$build$src$core$utils$string(c,a,b);a=wrapToText$$module$build$src$core$utils$string(c,a);g++}while(e>d);return f},wrapScore$$module$build$src$core$utils$string=function(a,b,c){const d=[0],e=[];for(var f=0;f<a.length;f++)d[d.length-1]+=a[f].length,!0===b[f]?(d.push(0),e.push(a[f].charAt(a[f].length-1))):!1===b[f]&&d[d.length-1]++;a=Math.max(...d);b=0;for(f=0;f<d.length;f++)b-=\n2*Math.pow(Math.abs(c-d[f]),1.5),b-=Math.pow(a-d[f],1.5),-1!==\".?!\".indexOf(e[f])?b+=c/3:-1!==\",;)]}\".indexOf(e[f])&&(b+=c/4);1<d.length&&d[d.length-1]<=d[d.length-2]&&(b+=.5);return b},wrapMutate$$module$build$src$core$utils$string=function(a,b,c){let d=wrapScore$$module$build$src$core$utils$string(a,b,c),e;for(let f=0;f<b.length-1;f++){if(b[f]===b[f+1])continue;const g=[].concat(b);g[f]=!g[f];g[f+1]=!g[f+1];const h=wrapScore$$module$build$src$core$utils$string(a,g,c);h>d&&(d=h,e=g)}return e?wrapMutate$$module$build$src$core$utils$string(a,\ne,c):b},wrapToText$$module$build$src$core$utils$string=function(a,b){const c=[];for(let d=0;d<a.length;d++)c.push(a[d]),void 0!==b[d]&&c.push(b[d]?\"\\n\":\" \");return c.join(\"\")},isNumber$$module$build$src$core$utils$string=function(a){return/^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(a)},setCustomTooltip$$module$build$src$core$tooltip=function(a){customTooltip$$module$build$src$core$tooltip=a},getCustomTooltip$$module$build$src$core$tooltip=function(){return customTooltip$$module$build$src$core$tooltip},isVisible$$module$build$src$core$tooltip=\nfunction(){return visible$$module$build$src$core$tooltip},getDiv$$module$build$src$core$tooltip=function(){return containerDiv$$module$build$src$core$tooltip},getTooltipOfObject$$module$build$src$core$tooltip=function(a){if(a=getTargetObject$$module$build$src$core$tooltip(a)){for(a=a.tooltip;\"function\"===typeof a;)a=a();if(\"string\"!==typeof a)throw Error(\"Tooltip function must return a string.\");return a}return\"\"},getTargetObject$$module$build$src$core$tooltip=function(a){for(;a&&a.tooltip;){if(\"string\"===\ntypeof a.tooltip||\"function\"===typeof a.tooltip)return a;a=a.tooltip}return null},createDom$$module$build$src$core$tooltip=function(){containerDiv$$module$build$src$core$tooltip||(containerDiv$$module$build$src$core$tooltip=document.createElement(\"div\"),containerDiv$$module$build$src$core$tooltip.className=\"blocklyTooltipDiv\",(getParentContainer$$module$build$src$core$common()||document.body).appendChild(containerDiv$$module$build$src$core$tooltip))},bindMouseEvents$$module$build$src$core$tooltip=\nfunction(a){a.mouseOverWrapper_=bind$$module$build$src$core$browser_events(a,\"pointerover\",null,onMouseOver$$module$build$src$core$tooltip);a.mouseOutWrapper_=bind$$module$build$src$core$browser_events(a,\"pointerout\",null,onMouseOut$$module$build$src$core$tooltip);a.addEventListener(\"pointermove\",onMouseMove$$module$build$src$core$tooltip,!1)},unbindMouseEvents$$module$build$src$core$tooltip=function(a){a&&(unbind$$module$build$src$core$browser_events(a.mouseOverWrapper_),unbind$$module$build$src$core$browser_events(a.mouseOutWrapper_),\na.removeEventListener(\"pointermove\",onMouseMove$$module$build$src$core$tooltip))},onMouseOver$$module$build$src$core$tooltip=function(a){blocked$$module$build$src$core$tooltip||(a=getTargetObject$$module$build$src$core$tooltip(a.currentTarget),element$$module$build$src$core$tooltip!==a&&(hide$$module$build$src$core$tooltip(),poisonedElement$$module$build$src$core$tooltip=null,element$$module$build$src$core$tooltip=a),clearTimeout(mouseOutPid$$module$build$src$core$tooltip))},onMouseOut$$module$build$src$core$tooltip=\nfunction(a){blocked$$module$build$src$core$tooltip||(mouseOutPid$$module$build$src$core$tooltip=setTimeout(function(){poisonedElement$$module$build$src$core$tooltip=element$$module$build$src$core$tooltip=null;hide$$module$build$src$core$tooltip()},1),clearTimeout(showPid$$module$build$src$core$tooltip))},onMouseMove$$module$build$src$core$tooltip=function(a){if(element$$module$build$src$core$tooltip&&element$$module$build$src$core$tooltip.tooltip&&!blocked$$module$build$src$core$tooltip)if(visible$$module$build$src$core$tooltip){const b=\nlastX$$module$build$src$core$tooltip-a.pageX;a=lastY$$module$build$src$core$tooltip-a.pageY;Math.sqrt(b*b+a*a)>RADIUS_OK$$module$build$src$core$tooltip&&hide$$module$build$src$core$tooltip()}else poisonedElement$$module$build$src$core$tooltip!==element$$module$build$src$core$tooltip&&(clearTimeout(showPid$$module$build$src$core$tooltip),lastX$$module$build$src$core$tooltip=a.pageX,lastY$$module$build$src$core$tooltip=a.pageY,showPid$$module$build$src$core$tooltip=setTimeout(show$$module$build$src$core$tooltip,\nHOVER_MS$$module$build$src$core$tooltip))},dispose$$module$build$src$core$tooltip=function(){poisonedElement$$module$build$src$core$tooltip=element$$module$build$src$core$tooltip=null;hide$$module$build$src$core$tooltip()},hide$$module$build$src$core$tooltip=function(){visible$$module$build$src$core$tooltip&&(visible$$module$build$src$core$tooltip=!1,containerDiv$$module$build$src$core$tooltip&&(containerDiv$$module$build$src$core$tooltip.style.display=\"none\"));showPid$$module$build$src$core$tooltip&&\nclearTimeout(showPid$$module$build$src$core$tooltip)},block$$module$build$src$core$tooltip=function(){hide$$module$build$src$core$tooltip();blocked$$module$build$src$core$tooltip=!0},unblock$$module$build$src$core$tooltip=function(){blocked$$module$build$src$core$tooltip=!1},renderContent$$module$build$src$core$tooltip=function(){containerDiv$$module$build$src$core$tooltip&&element$$module$build$src$core$tooltip&&(\"function\"===typeof customTooltip$$module$build$src$core$tooltip?customTooltip$$module$build$src$core$tooltip(containerDiv$$module$build$src$core$tooltip,\nelement$$module$build$src$core$tooltip):renderDefaultContent$$module$build$src$core$tooltip())},renderDefaultContent$$module$build$src$core$tooltip=function(){var a=getTooltipOfObject$$module$build$src$core$tooltip(element$$module$build$src$core$tooltip);a=wrap$$module$build$src$core$utils$string(a,LIMIT$$module$build$src$core$tooltip);a=a.split(\"\\n\");for(let b=0;b<a.length;b++){const c=document.createElement(\"div\");c.appendChild(document.createTextNode(a[b]));containerDiv$$module$build$src$core$tooltip.appendChild(c)}},\ngetPosition$$module$build$src$core$tooltip=function(a){const b=document.documentElement.clientWidth,c=document.documentElement.clientHeight;let d=lastX$$module$build$src$core$tooltip;d=a?d-(OFFSET_X$$module$build$src$core$tooltip+containerDiv$$module$build$src$core$tooltip.offsetWidth):d+OFFSET_X$$module$build$src$core$tooltip;let e=lastY$$module$build$src$core$tooltip+OFFSET_Y$$module$build$src$core$tooltip;e+containerDiv$$module$build$src$core$tooltip.offsetHeight>c+window.scrollY&&(e-=containerDiv$$module$build$src$core$tooltip.offsetHeight+\n2*OFFSET_Y$$module$build$src$core$tooltip);a?d=Math.max(MARGINS$$module$build$src$core$tooltip-window.scrollX,d):d+containerDiv$$module$build$src$core$tooltip.offsetWidth>b+window.scrollX-2*MARGINS$$module$build$src$core$tooltip&&(d=b-containerDiv$$module$build$src$core$tooltip.offsetWidth-2*MARGINS$$module$build$src$core$tooltip);return{x:d,y:e}},show$$module$build$src$core$tooltip=function(){if(!blocked$$module$build$src$core$tooltip&&(poisonedElement$$module$build$src$core$tooltip=element$$module$build$src$core$tooltip,\ncontainerDiv$$module$build$src$core$tooltip)){containerDiv$$module$build$src$core$tooltip.textContent=\"\";renderContent$$module$build$src$core$tooltip();var a=element$$module$build$src$core$tooltip.RTL;containerDiv$$module$build$src$core$tooltip.style.direction=a?\"rtl\":\"ltr\";containerDiv$$module$build$src$core$tooltip.style.display=\"block\";visible$$module$build$src$core$tooltip=!0;var {x:b,y:c}=getPosition$$module$build$src$core$tooltip(a);containerDiv$$module$build$src$core$tooltip.style.left=b+\"px\";\ncontainerDiv$$module$build$src$core$tooltip.style.top=c+\"px\"}},getHsvSaturation$$module$build$src$core$utils$colour=function(){return hsvSaturation$$module$build$src$core$utils$colour},setHsvSaturation$$module$build$src$core$utils$colour=function(a){hsvSaturation$$module$build$src$core$utils$colour=a},getHsvValue$$module$build$src$core$utils$colour=function(){return hsvValue$$module$build$src$core$utils$colour},setHsvValue$$module$build$src$core$utils$colour=function(a){hsvValue$$module$build$src$core$utils$colour=\na},parse$$module$build$src$core$utils$colour=function(a){a=String(a).toLowerCase().trim();var b=names$$module$build$src$core$utils$colour[a];if(b)return b;b=\"0x\"===a.substring(0,2)?\"#\"+a.substring(2):a;b=\"#\"===b[0]?b:\"#\"+b;if(/^#[0-9a-f]{6}$/.test(b))return b;if(/^#[0-9a-f]{3}$/.test(b))return[\"#\",b[1],b[1],b[2],b[2],b[3],b[3]].join(\"\");var c=a.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);return c&&(a=Number(c[1]),b=Number(c[2]),c=Number(c[3]),0<=a&&256>a&&0<=b&&256>b&&0<=c&&256>\nc)?rgbToHex$$module$build$src$core$utils$colour(a,b,c):null},rgbToHex$$module$build$src$core$utils$colour=function(a,b,c){b=a<<16|b<<8|c;return 16>a?\"#\"+(16777216|b).toString(16).substr(1):\"#\"+b.toString(16)},hexToRgb$$module$build$src$core$utils$colour=function(a){a=parse$$module$build$src$core$utils$colour(a);if(!a)return[0,0,0];a=parseInt(a.substr(1),16);return[a>>16,a>>8&255,a&255]},hsvToHex$$module$build$src$core$utils$colour=function(a,b,c){let d=0,e=0,f=0;if(0===b)f=e=d=c;else{const g=Math.floor(a/\n60),h=a/60-g;a=c*(1-b);const k=c*(1-b*h);b=c*(1-b*(1-h));switch(g){case 1:d=k;e=c;f=a;break;case 2:d=a;e=c;f=b;break;case 3:d=a;e=k;f=c;break;case 4:d=b;e=a;f=c;break;case 5:d=c;e=a;f=k;break;case 6:case 0:d=c,e=b,f=a}}return rgbToHex$$module$build$src$core$utils$colour(Math.floor(d),Math.floor(e),Math.floor(f))},blend$$module$build$src$core$utils$colour=function(a,b,c){a=parse$$module$build$src$core$utils$colour(a);if(!a)return null;b=parse$$module$build$src$core$utils$colour(b);if(!b)return null;\na=hexToRgb$$module$build$src$core$utils$colour(a);b=hexToRgb$$module$build$src$core$utils$colour(b);return rgbToHex$$module$build$src$core$utils$colour(Math.round(b[0]+c*(a[0]-b[0])),Math.round(b[1]+c*(a[1]-b[1])),Math.round(b[2]+c*(a[2]-b[2])))},hueToHex$$module$build$src$core$utils$colour=function(a){return hsvToHex$$module$build$src$core$utils$colour(a,hsvSaturation$$module$build$src$core$utils$colour,255*hsvValue$$module$build$src$core$utils$colour)},tokenizeInterpolationInternal$$module$build$src$core$utils$parsing=\nfunction(a,b){const c=[];var d=a.split(\"\");d.push(\"\");var e=0;a=[];let f=null;for(let k=0;k<d.length;k++){var g=d[k];if(0===e)\"%\"===g?((e=a.join(\"\"))&&c.push(e),a.length=0,e=1):a.push(g);else if(1===e)\"%\"===g?(a.push(g),e=0):b&&\"0\"<=g&&\"9\">=g?(e=2,f=g,(g=a.join(\"\"))&&c.push(g),a.length=0):\"{\"===g?e=3:(a.push(\"%\",g),e=0);else if(2===e)if(\"0\"<=g&&\"9\">=g)f+=g;else{var h=void 0;c.push(parseInt(null!=(h=f)?h:\"\",10));k--;e=0}else 3===e&&(\"\"===g?(a.splice(0,0,\"%{\"),k--,e=0):\"}\"!==g?a.push(g):(e=a.join(\"\"),\n/[A-Z]\\w*/i.test(e)?(g=e.toUpperCase(),(g=g.startsWith(\"BKY_\")?g.substring(4):null)&&g in Msg$$module$build$src$core$msg?(e=Msg$$module$build$src$core$msg[g],\"string\"===typeof e?Array.prototype.push.apply(c,tokenizeInterpolationInternal$$module$build$src$core$utils$parsing(e,b)):b?c.push(String(e)):c.push(e)):c.push(\"%{\"+e+\"}\")):c.push(\"%{\"+e+\"}\"),e=a.length=0))}(b=a.join(\"\"))&&c.push(b);h=[];a.length=0;for(d=0;d<c.length;d++)\"string\"===typeof c[d]?a.push(c[d]):((b=a.join(\"\"))&&h.push(b),a.length=\n0,h.push(c[d]));(b=a.join(\"\"))&&h.push(b);a.length=0;return h},tokenizeInterpolation$$module$build$src$core$utils$parsing=function(a){return tokenizeInterpolationInternal$$module$build$src$core$utils$parsing(a,!0)},replaceMessageReferences$$module$build$src$core$utils$parsing=function(a){if(\"string\"!==typeof a)return a;a=tokenizeInterpolationInternal$$module$build$src$core$utils$parsing(a,!1);return a.length?String(a[0]):\"\"},checkMessageReferences$$module$build$src$core$utils$parsing=function(a){let b=\n!0;const c=Msg$$module$build$src$core$msg,d=a.match(/%{BKY_[A-Z]\\w*}/ig);if(d)for(let e=0;e<d.length;e++){const f=d[e].toUpperCase();void 0===c[f.slice(6,-1)]&&(console.warn(\"No message string for \"+d[e]+\" in \"+a),b=!1)}return b},parseBlockColour$$module$build$src$core$utils$parsing=function(a){const b=\"string\"===typeof a?replaceMessageReferences$$module$build$src$core$utils$parsing(a):a;var c=Number(b);if(!isNaN(c)&&0<=c&&360>=c)return{hue:c,hex:hsvToHex$$module$build$src$core$utils$colour(c,getHsvSaturation$$module$build$src$core$utils$colour(),\n255*getHsvValue$$module$build$src$core$utils$colour())};if(c=parse$$module$build$src$core$utils$colour(b))return{hue:null,hex:c};c='Invalid colour: \"'+b+'\"';a!==b&&(c+=' (from \"'+a+'\")');throw Error(c);},getDiv$$module$build$src$core$widgetdiv=function(){return containerDiv$$module$build$src$core$widgetdiv},testOnly_setDiv$$module$build$src$core$widgetdiv=function(a){containerDiv$$module$build$src$core$widgetdiv=a},createDom$$module$build$src$core$widgetdiv=function(){containerDiv$$module$build$src$core$widgetdiv||\n(containerDiv$$module$build$src$core$widgetdiv=document.createElement(\"div\"),containerDiv$$module$build$src$core$widgetdiv.className=\"blocklyWidgetDiv\",(getParentContainer$$module$build$src$core$common()||document.body).appendChild(containerDiv$$module$build$src$core$widgetdiv))},show$$module$build$src$core$widgetdiv=function(a,b,c){hide$$module$build$src$core$widgetdiv();owner$$module$build$src$core$widgetdiv=a;dispose$$module$build$src$core$widgetdiv=c;if(a=containerDiv$$module$build$src$core$widgetdiv)a.style.direction=\nb?\"rtl\":\"ltr\",a.style.display=\"block\",b=getMainWorkspace$$module$build$src$core$common(),rendererClassName$$module$build$src$core$widgetdiv=b.getRenderer().getClassName(),themeClassName$$module$build$src$core$widgetdiv=b.getTheme().getClassName(),rendererClassName$$module$build$src$core$widgetdiv&&addClass$$module$build$src$core$utils$dom(a,rendererClassName$$module$build$src$core$widgetdiv),themeClassName$$module$build$src$core$widgetdiv&&addClass$$module$build$src$core$utils$dom(a,themeClassName$$module$build$src$core$widgetdiv)},\nhide$$module$build$src$core$widgetdiv=function(){if(isVisible$$module$build$src$core$widgetdiv()){owner$$module$build$src$core$widgetdiv=null;var a=containerDiv$$module$build$src$core$widgetdiv;a&&(a.style.display=\"none\",a.style.left=\"\",a.style.top=\"\",dispose$$module$build$src$core$widgetdiv&&dispose$$module$build$src$core$widgetdiv(),dispose$$module$build$src$core$widgetdiv=null,a.textContent=\"\",rendererClassName$$module$build$src$core$widgetdiv&&(removeClass$$module$build$src$core$utils$dom(a,rendererClassName$$module$build$src$core$widgetdiv),\nrendererClassName$$module$build$src$core$widgetdiv=\"\"),themeClassName$$module$build$src$core$widgetdiv&&(removeClass$$module$build$src$core$utils$dom(a,themeClassName$$module$build$src$core$widgetdiv),themeClassName$$module$build$src$core$widgetdiv=\"\"),getMainWorkspace$$module$build$src$core$common().markFocused())}},isVisible$$module$build$src$core$widgetdiv=function(){return!!owner$$module$build$src$core$widgetdiv},hideIfOwner$$module$build$src$core$widgetdiv=function(a){owner$$module$build$src$core$widgetdiv===\na&&hide$$module$build$src$core$widgetdiv()},positionInternal$$module$build$src$core$widgetdiv=function(a,b,c){containerDiv$$module$build$src$core$widgetdiv.style.left=a+\"px\";containerDiv$$module$build$src$core$widgetdiv.style.top=b+\"px\";containerDiv$$module$build$src$core$widgetdiv.style.height=c+\"px\"},positionWithAnchor$$module$build$src$core$widgetdiv=function(a,b,c,d){const e=calculateY$$module$build$src$core$widgetdiv(a,b,c);a=calculateX$$module$build$src$core$widgetdiv(a,b,c,d);0>e?positionInternal$$module$build$src$core$widgetdiv(a,\n0,c.height+e):positionInternal$$module$build$src$core$widgetdiv(a,e,c.height)},calculateX$$module$build$src$core$widgetdiv=function(a,b,c,d){return d?Math.min(Math.max(b.right-c.width,a.left),a.right-c.width):Math.max(Math.min(b.left,a.right-c.width),a.left)},calculateY$$module$build$src$core$widgetdiv=function(a,b,c){return b.bottom+c.height>=a.bottom?b.top-c.height:b.bottom},register$$module$build$src$core$field_registry=function(a,b){register$$module$build$src$core$registry(Type$$module$build$src$core$registry.FIELD,\na,b)},unregister$$module$build$src$core$field_registry=function(a){unregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.FIELD,a)},fromJson$$module$build$src$core$field_registry=function(a){return TEST_ONLY$$module$build$src$core$field_registry.fromJsonInternal(a)},fromJsonInternal$$module$build$src$core$field_registry=function(a){const b=getObject$$module$build$src$core$registry(Type$$module$build$src$core$registry.FIELD,a.type);if(b){if(\"function\"!==typeof b.fromJson)throw new TypeError(\"returned Field was not a IRegistrableField\");\nreturn b.fromJson(a)}console.warn(\"Blockly could not create a field of type \"+a.type+\". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached.\");return null},setRole$$module$build$src$core$utils$aria=function(a,b){a.setAttribute(ROLE_ATTRIBUTE$$module$build$src$core$utils$aria,b)},setState$$module$build$src$core$utils$aria=function(a,b,c){Array.isArray(c)&&(c=c.join(\" \"));\na.setAttribute(ARIA_PREFIX$$module$build$src$core$utils$aria+b,`${c}`)},isMenuGenerator$$module$build$src$core$field_dropdown=function(a){return a!==Field$$module$build$src$core$field.SKIP_SETUP},trimOptions$$module$build$src$core$field_dropdown=function(a){let b=!1;const c=a.map(([g,h])=>{if(\"string\"===typeof g)return[replaceMessageReferences$$module$build$src$core$utils$parsing(g),h];b=!0;return[null!==g.alt?Object.assign({},g,{alt:replaceMessageReferences$$module$build$src$core$utils$parsing(g.alt)}):\nObject.assign({},g),h]});if(b||2>a.length)return{options:c};var d=c.map(([g])=>g),e=shortestStringLength$$module$build$src$core$utils$string(d);a=commonWordPrefix$$module$build$src$core$utils$string(d,e);const f=commonWordSuffix$$module$build$src$core$utils$string(d,e);if(!a&&!f||e<=a+f)return{options:c};e=a?d[0].substring(0,a-1):void 0;d=f?d[0].substr(1-f):void 0;return{options:applyTrim$$module$build$src$core$field_dropdown(c,a,f),prefix:e,suffix:d}},applyTrim$$module$build$src$core$field_dropdown=\nfunction(a,b,c){return a.map(([d,e])=>[d.substring(b,d.length-c),e])},validateOptions$$module$build$src$core$field_dropdown=function(a){if(!Array.isArray(a))throw TypeError(\"FieldDropdown options must be an array.\");if(!a.length)throw TypeError(\"FieldDropdown options must not be an empty array.\");let b=!1;for(let c=0;c<a.length;c++){const d=a[c];Array.isArray(d)?\"string\"!==typeof d[1]?(b=!0,console.error(\"Invalid option[\"+c+\"]: Each FieldDropdown option id must be a string. Found \"+d[1]+\" in: \",d)):\nd[0]&&\"string\"!==typeof d[0]&&\"string\"!==typeof d[0].src&&(b=!0,console.error(\"Invalid option[\"+c+\"]: Each FieldDropdown option must have a string label or image description. Found\"+d[0]+\" in: \",d)):(b=!0,console.error(\"Invalid option[\"+c+\"]: Each FieldDropdown option must be an array. Found: \",d))}if(b)throw TypeError(\"Found invalid FieldDropdown options.\");},inherits$$module$build$src$core$utils$object=function(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.object.inherits\",\"version 9\",\n\"version 10\");a.superClass_=b.prototype;Object.setPrototypeOf(a,b);a.prototype=Object.create(b.prototype);a.prototype.constructor=a},mixin$$module$build$src$core$utils$object=function(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.object.mixin\",\"May 2022\",\"May 2023\",\"Object.assign\");for(const c in b)a[c]=b[c]},deepMerge$$module$build$src$core$utils$object=function(a,b){for(const c in b)a[c]=null!==b[c]&&\"object\"===typeof b[c]?deepMerge$$module$build$src$core$utils$object(a[c]||\nObject.create(null),b[c]):b[c];return a},values$$module$build$src$core$utils$object=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.object.values\",\"version 9\",\"version 10\",\"Object.values\");return Object.values(a)},convertToolboxDefToJson$$module$build$src$core$utils$toolbox=function(a){if(!a)return null;if(a instanceof Element||\"string\"===typeof a)a=parseToolboxTree$$module$build$src$core$utils$toolbox(a),a=convertToToolboxJson$$module$build$src$core$utils$toolbox(a);validateToolbox$$module$build$src$core$utils$toolbox(a);\nreturn a},validateToolbox$$module$build$src$core$utils$toolbox=function(a){const b=a.kind;a=a.contents;if(b&&b!==FLYOUT_TOOLBOX_KIND$$module$build$src$core$utils$toolbox&&b!==CATEGORY_TOOLBOX_KIND$$module$build$src$core$utils$toolbox)throw Error(\"Invalid toolbox kind \"+b+\". Please supply either \"+FLYOUT_TOOLBOX_KIND$$module$build$src$core$utils$toolbox+\" or \"+CATEGORY_TOOLBOX_KIND$$module$build$src$core$utils$toolbox);if(!a)throw Error(\"Toolbox must have a contents attribute.\");},convertFlyoutDefToJsonArray$$module$build$src$core$utils$toolbox=\nfunction(a){return a?a.contents?a.contents:Array.isArray(a)&&0<a.length&&!a[0].nodeType?a:xmlToJsonArray$$module$build$src$core$utils$toolbox(a):[]},hasCategories$$module$build$src$core$utils$toolbox=function(a){return TEST_ONLY$$module$build$src$core$utils$toolbox.hasCategoriesInternal(a)},hasCategoriesInternal$$module$build$src$core$utils$toolbox=function(a){if(!a)return!1;const b=a.kind;return b?b===CATEGORY_TOOLBOX_KIND$$module$build$src$core$utils$toolbox:!!a.contents.filter(function(c){return\"CATEGORY\"===\nc.kind.toUpperCase()}).length},isCategoryCollapsible$$module$build$src$core$utils$toolbox=function(a){return a&&a.contents?!!a.contents.filter(function(b){return\"CATEGORY\"===b.kind.toUpperCase()}).length:!1},convertToToolboxJson$$module$build$src$core$utils$toolbox=function(a){const b={contents:xmlToJsonArray$$module$build$src$core$utils$toolbox(a)};a instanceof Node&&addAttributes$$module$build$src$core$utils$toolbox(a,b);return b},xmlToJsonArray$$module$build$src$core$utils$toolbox=function(a){const b=\n[];let c=a.childNodes;c||(c=a);for(let d=0,e;e=c[d];d++){if(!e.tagName)continue;a={};const f=e.tagName.toUpperCase();a.kind=f;\"BLOCK\"===f?a.blockxml=e:e.childNodes&&0<e.childNodes.length&&(a.contents=xmlToJsonArray$$module$build$src$core$utils$toolbox(e));addAttributes$$module$build$src$core$utils$toolbox(e,a);b.push(a)}return b},addAttributes$$module$build$src$core$utils$toolbox=function(a,b){for(let c=0;c<a.attributes.length;c++){const d=a.attributes[c];-1<d.nodeName.indexOf(\"css-\")?(b.cssconfig=\nb.cssconfig||{},b.cssconfig[d.nodeName.replace(\"css-\",\"\")]=d.value):b[d.nodeName]=d.value}},parseToolboxTree$$module$build$src$core$utils$toolbox=function(a){let b=null;if(a)if(\"string\"===typeof a){if(b=textToDom$$module$build$src$core$xml(a),\"xml\"!==b.nodeName.toLowerCase())throw TypeError(\"Toolbox should be an <xml> document.\");}else a instanceof Element&&(b=a);return b},register$$module$build$src$core$extensions=function(a,b){if(\"string\"!==typeof a||\"\"===a.trim())throw Error('Error: Invalid extension name \"'+\na+'\"');if(allExtensions$$module$build$src$core$extensions[a])throw Error('Error: Extension \"'+a+'\" is already registered.');if(\"function\"!==typeof b)throw Error('Error: Extension \"'+a+'\" must be a function');allExtensions$$module$build$src$core$extensions[a]=b},registerMixin$$module$build$src$core$extensions=function(a,b){if(!b||\"object\"!==typeof b)throw Error('Error: Mixin \"'+a+'\" must be a object');register$$module$build$src$core$extensions(a,function(){this.mixin(b)})},registerMutator$$module$build$src$core$extensions=\nfunction(a,b,c,d){const e='Error when registering mutator \"'+a+'\": ';checkHasMutatorProperties$$module$build$src$core$extensions(e,b);const f=checkMutatorDialog$$module$build$src$core$extensions(b,e);if(c&&\"function\"!==typeof c)throw Error(e+'Extension \"'+a+'\" is not a function');register$$module$build$src$core$extensions(a,function(){f&&this.setMutator(new $.Mutator$$module$build$src$core$mutator(d||[],this));this.mixin(b);c&&c.apply(this)})},unregister$$module$build$src$core$extensions=function(a){isRegistered$$module$build$src$core$extensions(a)?\ndelete allExtensions$$module$build$src$core$extensions[a]:console.warn('No extension mapping for name \"'+a+'\" found to unregister')},isRegistered$$module$build$src$core$extensions=function(a){return!!allExtensions$$module$build$src$core$extensions[a]},apply$$module$build$src$core$extensions=function(a,b,c){const d=allExtensions$$module$build$src$core$extensions[a];if(\"function\"!==typeof d)throw Error('Error: Extension \"'+a+'\" not found.');let e;c?checkNoMutatorProperties$$module$build$src$core$extensions(a,\nb):e=getMutatorProperties$$module$build$src$core$extensions(b);d.apply(b);if(c)checkHasMutatorProperties$$module$build$src$core$extensions('Error after applying mutator \"'+a+'\": ',b);else if(!mutatorPropertiesMatch$$module$build$src$core$extensions(e,b))throw Error('Error when applying extension \"'+a+'\": mutation properties changed when applying a non-mutator extension.');},checkNoMutatorProperties$$module$build$src$core$extensions=function(a,b){if(getMutatorProperties$$module$build$src$core$extensions(b).length)throw Error('Error: tried to apply mutation \"'+\na+'\" to a block that already has mutator functions.  Block id: '+b.id);},checkXmlHooks$$module$build$src$core$extensions=function(a,b){return checkHasFunctionPair$$module$build$src$core$extensions(a.mutationToDom,a.domToMutation,b+\" mutationToDom/domToMutation\")},checkJsonHooks$$module$build$src$core$extensions=function(a,b){return checkHasFunctionPair$$module$build$src$core$extensions(a.saveExtraState,a.loadExtraState,b+\" saveExtraState/loadExtraState\")},checkMutatorDialog$$module$build$src$core$extensions=\nfunction(a,b){return checkHasFunctionPair$$module$build$src$core$extensions(a.compose,a.decompose,b+\" compose/decompose\")},checkHasFunctionPair$$module$build$src$core$extensions=function(a,b,c){if(a&&b){if(\"function\"!==typeof a||\"function\"!==typeof b)throw Error(c+\" must be a function\");return!0}if(!a&&!b)return!1;throw Error(c+\"Must have both or neither functions\");},checkHasMutatorProperties$$module$build$src$core$extensions=function(a,b){const c=checkXmlHooks$$module$build$src$core$extensions(b,\na),d=checkJsonHooks$$module$build$src$core$extensions(b,a);if(!c&&!d)throw Error(a+\"Mutations must contain either XML hooks, or JSON hooks, or both\");checkMutatorDialog$$module$build$src$core$extensions(b,a)},getMutatorProperties$$module$build$src$core$extensions=function(a){const b=[];void 0!==a.domToMutation&&b.push(a.domToMutation);void 0!==a.mutationToDom&&b.push(a.mutationToDom);void 0!==a.saveExtraState&&b.push(a.saveExtraState);void 0!==a.loadExtraState&&b.push(a.loadExtraState);void 0!==a.compose&&\nb.push(a.compose);void 0!==a.decompose&&b.push(a.decompose);return b},mutatorPropertiesMatch$$module$build$src$core$extensions=function(a,b){b=getMutatorProperties$$module$build$src$core$extensions(b);if(b.length!==a.length)return!1;for(let c=0;c<b.length;c++)if(a[c]!==b[c])return!1;return!0},runAfterPageLoad$$module$build$src$core$extensions=function(a){if(\"object\"!==typeof document)throw Error(\"runAfterPageLoad() requires browser document.\");if(\"complete\"===document.readyState)a();else{const b=\nsetInterval(function(){\"complete\"===document.readyState&&(clearInterval(b),a())},10)}},buildTooltipForDropdown$$module$build$src$core$extensions=function(a,b){const c=[];\"object\"===typeof document&&runAfterPageLoad$$module$build$src$core$extensions(function(){for(const d in b)checkMessageReferences$$module$build$src$core$utils$parsing(b[d])});return function(){this.type&&-1===c.indexOf(this.type)&&(checkDropdownOptionsInTable$$module$build$src$core$extensions(this,a,b),c.push(this.type));this.setTooltip(function(){var d=\nString(this.getFieldValue(a));let e=b[d];null===e?-1===c.indexOf(this.type)&&(d=\"No tooltip mapping for value \"+d+\" of field \"+a,null!==this.type&&(d+=\" of block type \"+this.type),console.warn(d+\".\")):e=replaceMessageReferences$$module$build$src$core$utils$parsing(e);return e}.bind(this))}},checkDropdownOptionsInTable$$module$build$src$core$extensions=function(a,b,c){var d=a.getField(b);if(d instanceof FieldDropdown$$module$build$src$core$field_dropdown&&!d.isOptionListDynamic()){d=d.getOptions();\nfor(let e=0;e<d.length;e++){const f=d[e][1];null===c[f]&&console.warn(\"No tooltip mapping for value \"+f+\" of field \"+b+\" of block type \"+a.type)}}},buildTooltipWithFieldText$$module$build$src$core$extensions=function(a,b){\"object\"===typeof document&&runAfterPageLoad$$module$build$src$core$extensions(function(){checkMessageReferences$$module$build$src$core$utils$parsing(a)});return function(){this.setTooltip(function(){const c=this.getField(b);return replaceMessageReferences$$module$build$src$core$utils$parsing(a).replace(\"%1\",\nc?c.getText():\"\")}.bind(this))}},extensionParentTooltip$$module$build$src$core$extensions=function(){const a=this.tooltip;this.setTooltip(function(){const b=this.getParent();return b&&b.getInputsInline()&&b.tooltip||a}.bind(this))},removeElem$$module$build$src$core$utils$array=function(a,b){b=a.indexOf(b);if(-1===b)return!1;a.splice(b,1);return!0},point$$module$build$src$core$utils$svg_paths=function(a,b){return\" \"+a+\",\"+b+\" \"},curve$$module$build$src$core$utils$svg_paths=function(a,b){return\" \"+\na+b.join(\"\")},moveTo$$module$build$src$core$utils$svg_paths=function(a,b){return\" M \"+a+\",\"+b+\" \"},moveBy$$module$build$src$core$utils$svg_paths=function(a,b){return\" m \"+a+\",\"+b+\" \"},lineTo$$module$build$src$core$utils$svg_paths=function(a,b){return\" l \"+a+\",\"+b+\" \"},line$$module$build$src$core$utils$svg_paths=function(a){return\" l\"+a.join(\"\")},lineOnAxis$$module$build$src$core$utils$svg_paths=function(a,b){return\" \"+a+\" \"+b+\" \"},arc$$module$build$src$core$utils$svg_paths=function(a,b,c,d){return a+\n\" \"+c+\" \"+c+\" \"+b+d},getRelativeXY$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.getRelativeXY\",\"December 2021\",\"December 2022\",\"Blockly.utils.svgMath.getRelativeXY\");return getRelativeXY$$module$build$src$core$utils$svg_math(a)},getInjectionDivXY$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.getInjectionDivXY_\",\"December 2021\",\"December 2022\",\"Blockly.utils.svgMath.getInjectionDivXY\");\nreturn getInjectionDivXY$$module$build$src$core$utils$svg_math(a)},tokenizeInterpolation$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.tokenizeInterpolation\",\"December 2021\",\"December 2022\",\"Blockly.utils.parsing.tokenizeInterpolation\");return tokenizeInterpolation$$module$build$src$core$utils$parsing(a)},replaceMessageReferences$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.replaceMessageReferences\",\n\"December 2021\",\"December 2022\",\"Blockly.utils.parsing.replaceMessageReferences\");return replaceMessageReferences$$module$build$src$core$utils$parsing(a)},checkMessageReferences$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.checkMessageReferences\",\"December 2021\",\"December 2022\",\"Blockly.utils.parsing.checkMessageReferences\");return checkMessageReferences$$module$build$src$core$utils$parsing(a)},is3dSupported$$module$build$src$core$utils=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.is3dSupported\",\n\"December 2021\",\"December 2022\",\"Blockly.utils.svgMath.is3dSupported\");return is3dSupported$$module$build$src$core$utils$svg_math()},getViewportBBox$$module$build$src$core$utils=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.getViewportBBox\",\"December 2021\",\"December 2022\",\"Blockly.utils.svgMath.getViewportBBox\");return getViewportBBox$$module$build$src$core$utils$svg_math()},arrayRemove$$module$build$src$core$utils=function(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.arrayRemove\",\n\"December 2021\",\"December 2022\",\"Blockly.array.removeElem\");return removeElem$$module$build$src$core$utils$array(a,b)},getDocumentScroll$$module$build$src$core$utils=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.getDocumentScroll\",\"December 2021\",\"December 2022\",\"Blockly.utils.svgMath.getDocumentScroll\");return getDocumentScroll$$module$build$src$core$utils$svg_math()},getBlockTypeCounts$$module$build$src$core$utils=function(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.getBlockTypeCounts\",\n\"December 2021\",\"December 2022\",\"Blockly.common.getBlockTypeCounts\");return getBlockTypeCounts$$module$build$src$core$common(a,b)},screenToWsCoordinates$$module$build$src$core$utils=function(a,b){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.screenToWsCoordinates\",\"December 2021\",\"December 2022\",\"Blockly.utils.svgMath.screenToWsCoordinates\");return screenToWsCoordinates$$module$build$src$core$utils$svg_math(a,b)},parseBlockColour$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.parseBlockColour\",\n\"December 2021\",\"December 2022\",\"Blockly.utils.parsing.parseBlockColour\");return parseBlockColour$$module$build$src$core$utils$parsing(a)},runAfterPageLoad$$module$build$src$core$utils=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.utils.runAfterPageLoad\",\"December 2021\",\"December 2022\");runAfterPageLoad$$module$build$src$core$extensions(a)},register$$module$build$src$core$serialization$registry=function(a,b){register$$module$build$src$core$registry(Type$$module$build$src$core$registry.SERIALIZER,\na,b)},unregister$$module$build$src$core$serialization$registry=function(a){unregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.SERIALIZER,a)},save$$module$build$src$core$serialization$blocks=function(a,{addCoordinates:b=!1,addInputBlocks:c=!0,addNextBlocks:d=!0,doFullSerialization:e=!0}={}){if(a.isInsertionMarker())return null;const f={type:a.type,id:a.id};b&&saveCoords$$module$build$src$core$serialization$blocks(a,f);saveAttributes$$module$build$src$core$serialization$blocks(a,\nf);saveExtraState$$module$build$src$core$serialization$blocks(a,f);saveIcons$$module$build$src$core$serialization$blocks(a,f);saveFields$$module$build$src$core$serialization$blocks(a,f,e);c&&saveInputBlocks$$module$build$src$core$serialization$blocks(a,f,e);d&&saveNextBlocks$$module$build$src$core$serialization$blocks(a,f,e);return f},saveAttributes$$module$build$src$core$serialization$blocks=function(a,b){a.isCollapsed()&&(b.collapsed=!0);a.isEnabled()||(b.enabled=!1);void 0!==a.inputsInline&&a.inputsInline!==\na.inputsInlineDefault&&(b.inline=a.inputsInline);a.data&&(b.data=a.data)},saveCoords$$module$build$src$core$serialization$blocks=function(a,b){const c=a.workspace;a=a.getRelativeToSurfaceXY();b.x=Math.round(c.RTL?c.getWidth()-a.x:a.x);b.y=Math.round(a.y)},saveExtraState$$module$build$src$core$serialization$blocks=function(a,b){a.saveExtraState?(a=a.saveExtraState(),null!==a&&(b.extraState=a)):a.mutationToDom&&(a=a.mutationToDom(),null!==a&&(b.extraState=domToText$$module$build$src$core$xml(a).replace(' xmlns=\"https://developers.google.com/blockly/xml\"',\n\"\")))},saveIcons$$module$build$src$core$serialization$blocks=function(a,b){a.getCommentText()&&(b.icons={comment:{text:a.getCommentText(),pinned:a.commentModel.pinned,height:Math.round(a.commentModel.size.height),width:Math.round(a.commentModel.size.width)}})},saveFields$$module$build$src$core$serialization$blocks=function(a,b,c){const d=Object.create(null);for(let e=0;e<a.inputList.length;e++){const f=a.inputList[e];for(let g=0;g<f.fieldRow.length;g++){const h=f.fieldRow[g];h.isSerializable()&&(d[h.name]=\nh.saveState(c))}}Object.keys(d).length&&(b.fields=d)},saveInputBlocks$$module$build$src$core$serialization$blocks=function(a,b,c){const d=Object.create(null);for(let e=0;e<a.inputList.length;e++){const f=a.inputList[e];if(f.type===inputTypes$$module$build$src$core$input_types.DUMMY)continue;const g=saveConnection$$module$build$src$core$serialization$blocks(f.connection,c);g&&(d[f.name]=g)}Object.keys(d).length&&(b.inputs=d)},saveNextBlocks$$module$build$src$core$serialization$blocks=function(a,b,\nc){a.nextConnection&&(a=saveConnection$$module$build$src$core$serialization$blocks(a.nextConnection,c))&&(b.next=a)},saveConnection$$module$build$src$core$serialization$blocks=function(a,b){const c=a.getShadowState(!0);a=a.targetBlock();if(!c&&!a)return null;const d=Object.create(null);c&&(d.shadow=c);a&&!a.isShadow()&&(d.block=save$$module$build$src$core$serialization$blocks(a,{doFullSerialization:b}));return d},append$$module$build$src$core$serialization$blocks=function(a,b,{recordUndo:c=!1}={}){return appendInternal$$module$build$src$core$serialization$blocks(a,\nb,{recordUndo:c})},appendInternal$$module$build$src$core$serialization$blocks=function(a,b,{parentConnection:c,isShadow:d=!1,recordUndo:e=!1}={}){const f=getRecordUndo$$module$build$src$core$events$utils();setRecordUndo$$module$build$src$core$events$utils(e);(e=getGroup$$module$build$src$core$events$utils())||setGroup$$module$build$src$core$events$utils(!0);disable$$module$build$src$core$events$utils();const g=appendPrivate$$module$build$src$core$serialization$blocks(a,b,{parentConnection:c,isShadow:d});\nenable$$module$build$src$core$events$utils();fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CREATE$$module$build$src$core$events$utils))(g));setGroup$$module$build$src$core$events$utils(e);setRecordUndo$$module$build$src$core$events$utils(f);b.rendered&&setTimeout(()=>{g.disposed||g.setConnectionTracking(!0)},1);return g},appendPrivate$$module$build$src$core$serialization$blocks=function(a,b,{parentConnection:c,isShadow:d=!1}={}){if(!a.type)throw new MissingBlockType$$module$build$src$core$serialization$exceptions(a);\nconst e=b.newBlock(a.type,a.id);e.setShadow(d);loadCoords$$module$build$src$core$serialization$blocks(e,a);loadAttributes$$module$build$src$core$serialization$blocks(e,a);loadExtraState$$module$build$src$core$serialization$blocks(e,a);tryToConnectParent$$module$build$src$core$serialization$blocks(c,e,a);loadIcons$$module$build$src$core$serialization$blocks(e,a);loadFields$$module$build$src$core$serialization$blocks(e,a);loadInputBlocks$$module$build$src$core$serialization$blocks(e,a);loadNextBlocks$$module$build$src$core$serialization$blocks(e,\na);initBlock$$module$build$src$core$serialization$blocks(e,b.rendered);return e},loadCoords$$module$build$src$core$serialization$blocks=function(a,b){let c=void 0===b.x?0:b.x;b=void 0===b.y?0:b.y;const d=a.workspace;c=d.RTL?d.getWidth()-c:c;a.moveBy(c,b)},loadAttributes$$module$build$src$core$serialization$blocks=function(a,b){b.collapsed&&a.setCollapsed(!0);!1===b.enabled&&a.setEnabled(!1);void 0!==b.inline&&a.setInputsInline(b.inline);void 0!==b.data&&(a.data=b.data)},loadExtraState$$module$build$src$core$serialization$blocks=\nfunction(a,b){b.extraState&&(a.loadExtraState?a.loadExtraState(b.extraState):a.domToMutation&&a.domToMutation(textToDom$$module$build$src$core$xml(b.extraState)))},tryToConnectParent$$module$build$src$core$serialization$blocks=function(a,b,c){if(a){if(a.getSourceBlock().isShadow()&&!b.isShadow())throw new RealChildOfShadow$$module$build$src$core$serialization$exceptions(c);if(a.type===inputTypes$$module$build$src$core$input_types.VALUE){var d=b.outputConnection;if(!d)throw new MissingConnection$$module$build$src$core$serialization$exceptions(\"output\",\nb,c);}else if(d=b.previousConnection,!d)throw new MissingConnection$$module$build$src$core$serialization$exceptions(\"previous\",b,c);if(!a.connect(d)){const e=b.workspace.connectionChecker;throw new BadConnectionCheck$$module$build$src$core$serialization$exceptions(e.getErrorMessage(e.canConnectWithReason(d,a,!1),d,a),a.type===inputTypes$$module$build$src$core$input_types.VALUE?\"output connection\":\"previous connection\",b,c);}}},loadIcons$$module$build$src$core$serialization$blocks=function(a,b){b.icons&&\n(b=b.icons.comment)&&(a.setCommentText(b.text),\"pinned\"in b&&(a.commentModel.pinned=b.pinned),\"width\"in b&&\"height\"in b&&(a.commentModel.size=new Size$$module$build$src$core$utils$size(b.width,b.height)),b.pinned&&a.rendered&&!a.isInFlyout&&setTimeout(()=>a.getCommentIcon().setVisible(!0),1))},loadFields$$module$build$src$core$serialization$blocks=function(a,b){if(b.fields){var c=Object.keys(b.fields);for(let d=0;d<c.length;d++){const e=c[d],f=b.fields[e],g=a.getField(e);g?g.loadState(f):console.warn(`Ignoring non-existant field ${e} in block ${a.type}`)}}},\nloadInputBlocks$$module$build$src$core$serialization$blocks=function(a,b){if(b.inputs){var c=Object.keys(b.inputs);for(let d=0;d<c.length;d++){const e=c[d],f=a.getInput(e);if(!f||!f.connection)throw new MissingConnection$$module$build$src$core$serialization$exceptions(e,a,b);loadConnection$$module$build$src$core$serialization$blocks(f.connection,b.inputs[e])}}},loadNextBlocks$$module$build$src$core$serialization$blocks=function(a,b){if(b.next){if(!a.nextConnection)throw new MissingConnection$$module$build$src$core$serialization$exceptions(\"next\",\na,b);loadConnection$$module$build$src$core$serialization$blocks(a.nextConnection,b.next)}},loadConnection$$module$build$src$core$serialization$blocks=function(a,b){b.shadow&&a.setShadowState(b.shadow);b.block&&appendPrivate$$module$build$src$core$serialization$blocks(b.block,a.getSourceBlock().workspace,{parentConnection:a})},initBlock$$module$build$src$core$serialization$blocks=function(a,b){if(b)for(a.setConnectionTracking(!1),a.initSvg(),a.render(!1),a=a.getIcons(),b=0;b<a.length;b++)a[b].computeIconLocation();\nelse a.initModel()},connectReciprocally$$module$build$src$core$connection=function(a,b){if(!a||!b)throw Error(\"Cannot connect null connections.\");a.targetConnection=b;b.targetConnection=a},getSingleConnection$$module$build$src$core$connection=function(a,b){let c=null;b=b.outputConnection;const d=b.getConnectionChecker();for(let e=0,f;f=a.inputList[e];e++){const g=f.connection;if(g&&d.canConnect(b,g,!1)){if(c)return null;c=g}}return c},getConnectionForOrphanedOutput$$module$build$src$core$connection=\nfunction(a,b){let c;for(;c=getSingleConnection$$module$build$src$core$connection(a,b);)if(a=c.targetBlock(),!a||a.isShadow())return c;return null},getParentConnection$$module$build$src$core$keyboard_nav$ast_node=function(a){let b=a.outputConnection;if(!b||a.previousConnection&&a.previousConnection.isConnected())b=a.previousConnection;return b},disposeUiEffect$$module$build$src$core$block_animations=function(a){const b=a.workspace;var c=a.getSvgRoot();b.getAudioManager().play(\"delete\");const d=b.getSvgXY(c);\nc=c.cloneNode(!0);c.setAttribute(\"transform\",\"translate(\"+d.x+\",\"+d.y+\")\");b.getParentSvg().appendChild(c);disposeUiStep$$module$build$src$core$block_animations(c,{x:d.x,y:d.y,width:a.width,height:a.height},b.RTL,new Date,b.scale)},disposeUiStep$$module$build$src$core$block_animations=function(a,b,c,d,e){const f=((new Date).getTime()-d.getTime())/150;1<f?removeNode$$module$build$src$core$utils$dom(a):(a.setAttribute(\"transform\",\"translate(\"+(b.x+(c?-1:1)*b.width*e/2*f)+\",\"+(b.y+b.height*e*f)+\") scale(\"+\n(1-f)*e+\")\"),setTimeout(disposeUiStep$$module$build$src$core$block_animations,10,a,b,c,d,e))},connectionUiEffect$$module$build$src$core$block_animations=function(a){const b=a.workspace,c=b.scale;b.getAudioManager().play(\"click\");if(!(1>c)){var d=b.getSvgXY(a.getSvgRoot());a.outputConnection?(d.x+=(a.RTL?3:-3)*c,d.y+=13*c):a.previousConnection&&(d.x+=(a.RTL?-23:23)*c,d.y+=3*c);a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,{cx:d.x,cy:d.y,r:0,fill:\"none\",\nstroke:\"#888\",\"stroke-width\":10},b.getParentSvg());connectionUiStep$$module$build$src$core$block_animations(a,new Date,c)}},connectionUiStep$$module$build$src$core$block_animations=function(a,b,c){const d=((new Date).getTime()-b.getTime())/150;1<d?removeNode$$module$build$src$core$utils$dom(a):(a.setAttribute(\"r\",(25*d*c).toString()),a.style.opacity=(1-d).toString(),disconnectPid$$module$build$src$core$block_animations=setTimeout(connectionUiStep$$module$build$src$core$block_animations,10,a,b,c))},\ndisconnectUiEffect$$module$build$src$core$block_animations=function(a){disconnectUiStop$$module$build$src$core$block_animations();a.workspace.getAudioManager().play(\"disconnect\");if(!(1>a.workspace.scale)){var b=a.getHeightWidth().height;b=Math.atan(10/b)/Math.PI*180;a.RTL||(b*=-1);disconnectGroup$$module$build$src$core$block_animations=a.getSvgRoot();disconnectUiStep$$module$build$src$core$block_animations(disconnectGroup$$module$build$src$core$block_animations,b,new Date)}},disconnectUiStep$$module$build$src$core$block_animations=\nfunction(a,b,c){const d=((new Date).getTime()-c.getTime())/200;let e=\"\";1>=d&&(e=`skewX(${Math.round(Math.sin(d*Math.PI*3)*(1-d)*b)})`,disconnectPid$$module$build$src$core$block_animations=setTimeout(disconnectUiStep$$module$build$src$core$block_animations,10,a,b,c));a.skew_=e;a.setAttribute(\"transform\",a.translate_+a.skew_)},disconnectUiStop$$module$build$src$core$block_animations=function(){if(disconnectGroup$$module$build$src$core$block_animations){disconnectPid$$module$build$src$core$block_animations&&\nclearTimeout(disconnectPid$$module$build$src$core$block_animations);const a=disconnectGroup$$module$build$src$core$block_animations;a.skew_=\"\";a.setAttribute(\"transform\",a.translate_);disconnectGroup$$module$build$src$core$block_animations=null}},copy$$module$build$src$core$clipboard=function(a){TEST_ONLY$$module$build$src$core$clipboard.copyInternal(a)},copyInternal$$module$build$src$core$clipboard=function(a){copyData$$module$build$src$core$clipboard=a.toCopyData()},paste$$module$build$src$core$clipboard=\nfunction(){if(!copyData$$module$build$src$core$clipboard)return null;let a=copyData$$module$build$src$core$clipboard.source;a.isFlyout&&(a=a.targetWorkspace);return copyData$$module$build$src$core$clipboard.typeCounts&&a.isCapacityAvailable(copyData$$module$build$src$core$clipboard.typeCounts)?a.paste(copyData$$module$build$src$core$clipboard.saveInfo):null},duplicate$$module$build$src$core$clipboard=function(a){return TEST_ONLY$$module$build$src$core$clipboard.duplicateInternal(a)},duplicateInternal$$module$build$src$core$clipboard=\nfunction(a){const b=copyData$$module$build$src$core$clipboard;copy$$module$build$src$core$clipboard(a);let c,d,e;a=null!=(e=null==(c=a.toCopyData())?void 0:null==(d=c.source)?void 0:d.paste(copyData$$module$build$src$core$clipboard.saveInfo))?e:null;copyData$$module$build$src$core$clipboard=b;return a},getCurrentBlock$$module$build$src$core$contextmenu=function(){return currentBlock$$module$build$src$core$contextmenu},setCurrentBlock$$module$build$src$core$contextmenu=function(a){currentBlock$$module$build$src$core$contextmenu=\na},show$$module$build$src$core$contextmenu=function(a,b,c){show$$module$build$src$core$widgetdiv(dummyOwner$$module$build$src$core$contextmenu,c,dispose$$module$build$src$core$contextmenu);if(b.length){var d=populate_$$module$build$src$core$contextmenu(b,c);menu_$$module$build$src$core$contextmenu=d;position_$$module$build$src$core$contextmenu(d,a,c);setTimeout(function(){d.focus()},1);currentBlock$$module$build$src$core$contextmenu=null}else hide$$module$build$src$core$contextmenu()},populate_$$module$build$src$core$contextmenu=\nfunction(a,b){const c=new Menu$$module$build$src$core$menu;c.setRole(Role$$module$build$src$core$utils$aria.MENU);for(let d=0;d<a.length;d++){const e=a[d],f=new MenuItem$$module$build$src$core$menuitem(e.text);f.setRightToLeft(b);f.setRole(Role$$module$build$src$core$utils$aria.MENUITEM);c.addChild(f);f.setEnabled(e.enabled);if(e.enabled)f.onAction(function(){hide$$module$build$src$core$contextmenu();e.callback(e.scope)},{})}return c},position_$$module$build$src$core$contextmenu=function(a,b,c){const d=\ngetViewportBBox$$module$build$src$core$utils$svg_math();b=new Rect$$module$build$src$core$utils$rect(b.clientY+d.top,b.clientY+d.top,b.clientX+d.left,b.clientX+d.left);createWidget_$$module$build$src$core$contextmenu(a);const e=a.getSize();c&&(b.left+=e.width,b.right+=e.width,d.left+=e.width,d.right+=e.width);positionWithAnchor$$module$build$src$core$widgetdiv(d,b,e,c);a.focus()},createWidget_$$module$build$src$core$contextmenu=function(a){var b=getDiv$$module$build$src$core$widgetdiv();if(!b)throw Error(\"Attempting to create a context menu when widget div is null\");\nb=a.render(b);addClass$$module$build$src$core$utils$dom(b,\"blocklyContextMenu\");conditionalBind$$module$build$src$core$browser_events(b,\"contextmenu\",null,haltPropagation$$module$build$src$core$contextmenu);a.focus()},haltPropagation$$module$build$src$core$contextmenu=function(a){a.preventDefault();a.stopPropagation()},hide$$module$build$src$core$contextmenu=function(){hideIfOwner$$module$build$src$core$widgetdiv(dummyOwner$$module$build$src$core$contextmenu);currentBlock$$module$build$src$core$contextmenu=\nnull},dispose$$module$build$src$core$contextmenu=function(){menu_$$module$build$src$core$contextmenu&&(menu_$$module$build$src$core$contextmenu.dispose(),menu_$$module$build$src$core$contextmenu=null)},callbackFactory$$module$build$src$core$contextmenu=function(a,b){return()=>{disable$$module$build$src$core$events$utils();let c;try{c=domToBlock$$module$build$src$core$xml(b,a.workspace);const d=a.getRelativeToSurfaceXY();d.x=a.RTL?d.x-$.config$$module$build$src$core$config.snapRadius:d.x+$.config$$module$build$src$core$config.snapRadius;\nd.y+=2*$.config$$module$build$src$core$config.snapRadius;c.moveBy(d.x,d.y)}finally{enable$$module$build$src$core$events$utils()}isEnabled$$module$build$src$core$events$utils()&&!c.isShadow()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CREATE$$module$build$src$core$events$utils))(c));c.select()}},commentDeleteOption$$module$build$src$core$contextmenu=function(a){return{text:Msg$$module$build$src$core$msg.REMOVE_COMMENT,enabled:!0,callback:function(){setGroup$$module$build$src$core$events$utils(!0);\na.dispose();setGroup$$module$build$src$core$events$utils(!1)}}},commentDuplicateOption$$module$build$src$core$contextmenu=function(a){return{text:Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,enabled:!0,callback:function(){duplicate$$module$build$src$core$clipboard(a)}}},workspaceCommentOption$$module$build$src$core$contextmenu=function(a,b){const c={enabled:!0};c.text=Msg$$module$build$src$core$msg.ADD_COMMENT;c.callback=function(){const d=new WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg(a,\nMsg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT,WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.DEFAULT_SIZE,WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.DEFAULT_SIZE);var e=a.getInjectionDiv().getBoundingClientRect();e=new Coordinate$$module$build$src$core$utils$coordinate(b.clientX-e.left,b.clientY-e.top);const f=a.getOriginOffsetInPixels();e=Coordinate$$module$build$src$core$utils$coordinate.difference(e,f);e.scale(1/a.scale);d.moveBy(e.x,e.y);\na.rendered&&(d.initSvg(),d.render(),d.select())};return c},getStartPositionRect$$module$build$src$core$positionable_helpers=function(a,b,c,d,e,f){const g=f.scrollbar&&f.scrollbar.canScrollVertically();a.horizontal===horizontalPosition$$module$build$src$core$positionable_helpers.LEFT?(c=e.absoluteMetrics.left+c,g&&f.RTL&&(c+=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness)):(c=e.absoluteMetrics.left+e.viewMetrics.width-b.width-c,g&&!f.RTL&&(c-=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness));\na.vertical===verticalPosition$$module$build$src$core$positionable_helpers.TOP?a=e.absoluteMetrics.top+d:(a=e.absoluteMetrics.top+e.viewMetrics.height-b.height-d,f.scrollbar&&f.scrollbar.canScrollHorizontally()&&(a-=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness));return new Rect$$module$build$src$core$utils$rect(a,a+b.height,c,c+b.width)},getCornerOppositeToolbox$$module$build$src$core$positionable_helpers=function(a,b){return{horizontal:b.toolboxMetrics.position===Position$$module$build$src$core$utils$toolbox.LEFT||\na.horizontalLayout&&!a.RTL?horizontalPosition$$module$build$src$core$positionable_helpers.RIGHT:horizontalPosition$$module$build$src$core$positionable_helpers.LEFT,vertical:b.toolboxMetrics.position===Position$$module$build$src$core$utils$toolbox.BOTTOM?verticalPosition$$module$build$src$core$positionable_helpers.TOP:verticalPosition$$module$build$src$core$positionable_helpers.BOTTOM}},bumpPositionRect$$module$build$src$core$positionable_helpers=function(a,b,c,d){const e=a.left,f=a.right-a.left,g=\na.bottom-a.top;for(let h=0;h<d.length;h++){const k=d[h];a.intersects(k)&&(a=c===bumpDirection$$module$build$src$core$positionable_helpers.UP?k.top-g-b:k.bottom+b,a=new Rect$$module$build$src$core$utils$rect(a,a+g,e,e+f),h=-1)}return a},registerEscape$$module$build$src$core$shortcut_items=function(){ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.ESCAPE,preconditionFn(a){return!a.options.readOnly},callback(a){a.hideChaff();\nreturn!0},keyCodes:[KeyCodes$$module$build$src$core$utils$keycodes.ESC]})},registerDelete$$module$build$src$core$shortcut_items=function(){ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.DELETE,preconditionFn(a){const b=getSelected$$module$build$src$core$common();return!a.options.readOnly&&null!=b&&b.isDeletable()},callback(a,b){b.preventDefault();if(Gesture$$module$build$src$core$gesture.inProgress())return!1;getSelected$$module$build$src$core$common().checkAndDelete();\nreturn!0},keyCodes:[KeyCodes$$module$build$src$core$utils$keycodes.DELETE,KeyCodes$$module$build$src$core$utils$keycodes.BACKSPACE]})},registerCopy$$module$build$src$core$shortcut_items=function(){const a=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.C,[KeyCodes$$module$build$src$core$utils$keycodes.CTRL]),b=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.C,\n[KeyCodes$$module$build$src$core$utils$keycodes.ALT]),c=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.C,[KeyCodes$$module$build$src$core$utils$keycodes.META]);ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.COPY,preconditionFn(d){const e=getSelected$$module$build$src$core$common();return!d.options.readOnly&&!Gesture$$module$build$src$core$gesture.inProgress()&&\nnull!=e&&e.isDeletable()&&e.isMovable()},callback(d,e){e.preventDefault();d.hideChaff();copy$$module$build$src$core$clipboard(getSelected$$module$build$src$core$common());return!0},keyCodes:[a,b,c]})},registerCut$$module$build$src$core$shortcut_items=function(){const a=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.X,[KeyCodes$$module$build$src$core$utils$keycodes.CTRL]),b=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.X,\n[KeyCodes$$module$build$src$core$utils$keycodes.ALT]),c=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.X,[KeyCodes$$module$build$src$core$utils$keycodes.META]);ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.CUT,preconditionFn(d){const e=getSelected$$module$build$src$core$common();return!d.options.readOnly&&!Gesture$$module$build$src$core$gesture.inProgress()&&\nnull!=e&&e instanceof BlockSvg$$module$build$src$core$block_svg&&e.isDeletable()&&e.isMovable()&&!e.workspace.isFlyout},callback(){const d=getSelected$$module$build$src$core$common();if(!d)return!1;copy$$module$build$src$core$clipboard(d);d.checkAndDelete();return!0},keyCodes:[a,b,c]})},registerPaste$$module$build$src$core$shortcut_items=function(){const a=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.V,[KeyCodes$$module$build$src$core$utils$keycodes.CTRL]),\nb=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.V,[KeyCodes$$module$build$src$core$utils$keycodes.ALT]),c=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.V,[KeyCodes$$module$build$src$core$utils$keycodes.META]);ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.PASTE,\npreconditionFn(d){return!d.options.readOnly&&!Gesture$$module$build$src$core$gesture.inProgress()},callback(){return!!paste$$module$build$src$core$clipboard()},keyCodes:[a,b,c]})},registerUndo$$module$build$src$core$shortcut_items=function(){const a=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Z,[KeyCodes$$module$build$src$core$utils$keycodes.CTRL]),b=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Z,\n[KeyCodes$$module$build$src$core$utils$keycodes.ALT]),c=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Z,[KeyCodes$$module$build$src$core$utils$keycodes.META]);ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.UNDO,preconditionFn(d){return!d.options.readOnly&&!Gesture$$module$build$src$core$gesture.inProgress()},callback(d){d.hideChaff();\nd.undo(!1);return!0},keyCodes:[a,b,c]})},registerRedo$$module$build$src$core$shortcut_items=function(){const a=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Z,[KeyCodes$$module$build$src$core$utils$keycodes.SHIFT,KeyCodes$$module$build$src$core$utils$keycodes.CTRL]),b=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Z,[KeyCodes$$module$build$src$core$utils$keycodes.SHIFT,\nKeyCodes$$module$build$src$core$utils$keycodes.ALT]),c=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Z,[KeyCodes$$module$build$src$core$utils$keycodes.SHIFT,KeyCodes$$module$build$src$core$utils$keycodes.META]),d=ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.createSerializedKey(KeyCodes$$module$build$src$core$utils$keycodes.Y,[KeyCodes$$module$build$src$core$utils$keycodes.CTRL]);ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.register({name:names$$module$build$src$core$shortcut_items.REDO,\npreconditionFn(e){return!Gesture$$module$build$src$core$gesture.inProgress()&&!e.options.readOnly},callback(e){e.hideChaff();e.undo(!0);return!0},keyCodes:[a,b,c,d]})},registerDefaultShortcuts$$module$build$src$core$shortcut_items=function(){registerEscape$$module$build$src$core$shortcut_items();registerDelete$$module$build$src$core$shortcut_items();registerCopy$$module$build$src$core$shortcut_items();registerCut$$module$build$src$core$shortcut_items();registerPaste$$module$build$src$core$shortcut_items();\nregisterUndo$$module$build$src$core$shortcut_items();registerRedo$$module$build$src$core$shortcut_items()},isObservable$$module$build$src$core$interfaces$i_observable=function(a){return void 0!==a.startPublishing&&void 0!==a.stopPublishing},isProcedureBlock$$module$build$src$core$interfaces$i_procedure_block=function(a){return void 0!==a.doProcedureUpdate},triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures=function(a){for(const b of a.getAllBlocks(!1))isProcedureBlock$$module$build$src$core$interfaces$i_procedure_block(b)&&\nb.doProcedureUpdate()},allProcedures$$module$build$src$core$procedures=function(a){const b=a.getBlocksByType(\"procedures_defnoreturn\",!1).map(function(c){return c.getProcedureDef()});a=a.getBlocksByType(\"procedures_defreturn\",!1).map(function(c){return c.getProcedureDef()});b.sort(procTupleComparator$$module$build$src$core$procedures);a.sort(procTupleComparator$$module$build$src$core$procedures);return[b,a]},procTupleComparator$$module$build$src$core$procedures=function(a,b){return a[0].localeCompare(b[0],\nvoid 0,{sensitivity:\"base\"})},findLegalName$$module$build$src$core$procedures=function(a,b){if(b.isInFlyout)return a;for(a=a||Msg$$module$build$src$core$msg.UNNAMED_KEY||\"unnamed\";!isLegalName$$module$build$src$core$procedures(a,b.workspace,b);){const c=a.match(/^(.*?)(\\d+)$/);a=c?c[1]+(parseInt(c[2])+1):a+\"2\"}return a},isLegalName$$module$build$src$core$procedures=function(a,b,c){return!isNameUsed$$module$build$src$core$procedures(a,b,c)},isNameUsed$$module$build$src$core$procedures=function(a,b,\nc){b=b.getAllBlocks(!1);for(let e=0;e<b.length;e++)if(b[e]!==c){var d=b[e];if(d.getProcedureDef&&(d=d.getProcedureDef(),Names$$module$build$src$core$names.equals(d[0],a)))return!0}return!1},rename$$module$build$src$core$procedures=function(a){var b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;a=a.trim();const c=findLegalName$$module$build$src$core$procedures(a,b),d=this.getValue();if(d!==a&&d!==c)for(a=b.workspace.getAllBlocks(!1),b=0;b<a.length;b++){const e=\na[b];e.renameProcedure&&e.renameProcedure(d,c)}return c},flyoutCategory$$module$build$src$core$procedures=function(a){function b(f,g){for(let k=0;k<f.length;k++){var h=f[k][0];const l=f[k][1],m=createElement$$module$build$src$core$utils$xml(\"block\");m.setAttribute(\"type\",g);m.setAttribute(\"gap\",\"16\");const n=createElement$$module$build$src$core$utils$xml(\"mutation\");n.setAttribute(\"name\",h);m.appendChild(n);for(h=0;h<l.length;h++){const p=createElement$$module$build$src$core$utils$xml(\"arg\");p.setAttribute(\"name\",\nl[h]);n.appendChild(p)}c.push(m)}}const c=[];if(Blocks$$module$build$src$core$blocks.procedures_defnoreturn){var d=createElement$$module$build$src$core$utils$xml(\"block\");d.setAttribute(\"type\",\"procedures_defnoreturn\");d.setAttribute(\"gap\",\"16\");var e=createElement$$module$build$src$core$utils$xml(\"field\");e.setAttribute(\"name\",\"NAME\");e.appendChild(createTextNode$$module$build$src$core$utils$xml(Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE));d.appendChild(e);c.push(d)}Blocks$$module$build$src$core$blocks.procedures_defreturn&&\n(d=createElement$$module$build$src$core$utils$xml(\"block\"),d.setAttribute(\"type\",\"procedures_defreturn\"),d.setAttribute(\"gap\",\"16\"),e=createElement$$module$build$src$core$utils$xml(\"field\"),e.setAttribute(\"name\",\"NAME\"),e.appendChild(createTextNode$$module$build$src$core$utils$xml(Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),d.appendChild(e),c.push(d));Blocks$$module$build$src$core$blocks.procedures_ifreturn&&(d=createElement$$module$build$src$core$utils$xml(\"block\"),d.setAttribute(\"type\",\n\"procedures_ifreturn\"),d.setAttribute(\"gap\",\"16\"),c.push(d));c.length&&c[c.length-1].setAttribute(\"gap\",\"24\");a=allProcedures$$module$build$src$core$procedures(a);b(a[0],\"procedures_callnoreturn\");b(a[1],\"procedures_callreturn\");return c},updateMutatorFlyout$$module$build$src$core$procedures=function(a){var b=[],c=a.getBlocksByType(\"procedures_mutatorarg\",!1);for(let f=0,g;g=c[f];f++)b.push(g.getFieldValue(\"NAME\"));c=createElement$$module$build$src$core$utils$xml(\"xml\");const d=createElement$$module$build$src$core$utils$xml(\"block\");\nd.setAttribute(\"type\",\"procedures_mutatorarg\");const e=createElement$$module$build$src$core$utils$xml(\"field\");e.setAttribute(\"name\",\"NAME\");b=generateUniqueNameFromOptions$$module$build$src$core$variables(DEFAULT_ARG$$module$build$src$core$procedures,b);b=createTextNode$$module$build$src$core$utils$xml(b);e.appendChild(b);d.appendChild(e);c.appendChild(d);a.updateToolbox(c)},mutatorOpenListener$$module$build$src$core$procedures=function(a){if(a.type===BUBBLE_OPEN$$module$build$src$core$events$utils&&\n\"mutator\"===a.bubbleType&&a.isOpen&&a.blockId){a=getWorkspaceById$$module$build$src$core$common(a.workspaceId).getBlockById(a.blockId);var b=a.type;if(\"procedures_defnoreturn\"===b||\"procedures_defreturn\"===b)a=a.mutator.getWorkspace(),updateMutatorFlyout$$module$build$src$core$procedures(a),a.addChangeListener(mutatorChangeListener$$module$build$src$core$procedures)}},mutatorChangeListener$$module$build$src$core$procedures=function(a){if(a.type===CREATE$$module$build$src$core$events$utils||a.type===\nDELETE$$module$build$src$core$events$utils||a.type===CHANGE$$module$build$src$core$events$utils)a=getWorkspaceById$$module$build$src$core$common(a.workspaceId),updateMutatorFlyout$$module$build$src$core$procedures(a)},getCallers$$module$build$src$core$procedures=function(a,b){const c=[];b=b.getAllBlocks(!1);for(let e=0;e<b.length;e++){var d=b[e];d.getProcedureCall&&(d=d.getProcedureCall())&&Names$$module$build$src$core$names.equals(d,a)&&c.push(b[e])}return c},mutateCallers$$module$build$src$core$procedures=\nfunction(a){const b=getRecordUndo$$module$build$src$core$events$utils();var c=a.getProcedureDef()[0];const d=a.mutationToDom(!0);a=getCallers$$module$build$src$core$procedures(c,a.workspace);for(let f=0,g;g=a[f];f++){c=(c=g.mutationToDom())&&domToText$$module$build$src$core$xml(c);g.domToMutation&&g.domToMutation(d);var e=g.mutationToDom();e=e&&domToText$$module$build$src$core$xml(e);c!==e&&(setRecordUndo$$module$build$src$core$events$utils(!1),fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(g,\n\"mutation\",null,c,e)),setRecordUndo$$module$build$src$core$events$utils(b))}},getDefinition$$module$build$src$core$procedures=function(a,b){b=b.getAllBlocks(!1);for(let d=0;d<b.length;d++){var c=b[d];if(c.getProcedureDef&&(c=c.getProcedureDef())&&Names$$module$build$src$core$names.equals(c[0],a))return b[d]}return null},isDynamicShape$$module$build$src$core$renderers$common$constants=function(a){return a.isDynamic},isDebuggerEnabled$$module$build$src$core$renderers$common$debug=function(){return useDebugger$$module$build$src$core$renderers$common$debug},\nstartDebugger$$module$build$src$core$renderers$common$debug=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.blockRendering.debug.startDebugger()\",\"version 8\",\"version 10\",\"the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)\");useDebugger$$module$build$src$core$renderers$common$debug=!0},stopDebugger$$module$build$src$core$renderers$common$debug=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.blockRendering.debug.stopDebugger()\",\n\"version 8\",\"version 10\",\"the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)\");useDebugger$$module$build$src$core$renderers$common$debug=!1},register$$module$build$src$core$renderers$common$block_rendering=function(a,b){register$$module$build$src$core$registry(Type$$module$build$src$core$registry.RENDERER,a,b)},unregister$$module$build$src$core$renderers$common$block_rendering=function(a){unregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.RENDERER,\na)},stopDebugger$$module$build$src$core$renderers$common$block_rendering=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.blockRendering.stopDebugger()\",\"September 2021\",\"September 2022\",\"the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)\");stopDebugger$$module$build$src$core$renderers$common$debug()},init$$module$build$src$core$renderers$common$block_rendering=function(a,b,c){a=new (getClass$$module$build$src$core$registry(Type$$module$build$src$core$registry.RENDERER,\na))(a);a.init(b,c);return a},stringButtonClickHandler$$module$build$src$core$variables_dynamic=function(a){createVariableButtonHandler$$module$build$src$core$variables(a.getTargetWorkspace(),void 0,\"String\")},numberButtonClickHandler$$module$build$src$core$variables_dynamic=function(a){createVariableButtonHandler$$module$build$src$core$variables(a.getTargetWorkspace(),void 0,\"Number\")},colourButtonClickHandler$$module$build$src$core$variables_dynamic=function(a){createVariableButtonHandler$$module$build$src$core$variables(a.getTargetWorkspace(),\nvoid 0,\"Colour\")},flyoutCategory$$module$build$src$core$variables_dynamic=function(a){let b=[],c=document.createElement(\"button\");c.setAttribute(\"text\",Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE);c.setAttribute(\"callbackKey\",\"CREATE_VARIABLE_STRING\");b.push(c);c=document.createElement(\"button\");c.setAttribute(\"text\",Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE);c.setAttribute(\"callbackKey\",\"CREATE_VARIABLE_NUMBER\");b.push(c);c=document.createElement(\"button\");c.setAttribute(\"text\",Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE);\nc.setAttribute(\"callbackKey\",\"CREATE_VARIABLE_COLOUR\");b.push(c);a.registerButtonCallback(\"CREATE_VARIABLE_STRING\",stringButtonClickHandler$$module$build$src$core$variables_dynamic);a.registerButtonCallback(\"CREATE_VARIABLE_NUMBER\",numberButtonClickHandler$$module$build$src$core$variables_dynamic);a.registerButtonCallback(\"CREATE_VARIABLE_COLOUR\",colourButtonClickHandler$$module$build$src$core$variables_dynamic);a=flyoutCategoryBlocks$$module$build$src$core$variables_dynamic(a);return b=b.concat(a)},\nflyoutCategoryBlocks$$module$build$src$core$variables_dynamic=function(a){a=a.getAllVariables();const b=[];if(0<a.length){if(Blocks$$module$build$src$core$blocks.variables_set_dynamic){var c=a[a.length-1];const d=createElement$$module$build$src$core$utils$xml(\"block\");d.setAttribute(\"type\",\"variables_set_dynamic\");d.setAttribute(\"gap\",\"24\");d.appendChild(generateVariableFieldDom$$module$build$src$core$variables(c));b.push(d)}if(Blocks$$module$build$src$core$blocks.variables_get_dynamic){a.sort(VariableModel$$module$build$src$core$variable_model.compareByName);\nfor(let d=0,e;e=a[d];d++)c=createElement$$module$build$src$core$utils$xml(\"block\"),c.setAttribute(\"type\",\"variables_get_dynamic\"),c.setAttribute(\"gap\",\"8\"),c.appendChild(generateVariableFieldDom$$module$build$src$core$variables(e)),b.push(c)}}return b},resizeSvgContents$$module$build$src$core$workspace_svg=function(a){a.resizeContents()},save$$module$build$src$core$serialization$workspaces=function(a){const b=Object.create(null),c=getAllItems$$module$build$src$core$registry(Type$$module$build$src$core$registry.SERIALIZER,\n!0);for(const d in c){let e;const f=null==(e=c[d])?void 0:e.save(a);f&&(b[d]=f)}return b},load$$module$build$src$core$serialization$workspaces=function(a,b,{recordUndo:c=!1}={}){var d=getAllItems$$module$build$src$core$registry(Type$$module$build$src$core$registry.SERIALIZER,!0);if(d){d=Object.entries(d).sort((f,g)=>g[1].priority-f[1].priority);var e=getRecordUndo$$module$build$src$core$events$utils();setRecordUndo$$module$build$src$core$events$utils(c);(c=getGroup$$module$build$src$core$events$utils())||\nsetGroup$$module$build$src$core$events$utils(!0);startTextWidthCache$$module$build$src$core$utils$dom();b instanceof WorkspaceSvg$$module$build$src$core$workspace_svg&&b.setResizesEnabled(!1);for(const [,f]of d.reverse()){let g;null==(g=f)||g.clear(b)}for(let [f,g]of d.reverse())if(a[f]){let h;null==(h=g)||h.load(a[f],b)}b instanceof WorkspaceSvg$$module$build$src$core$workspace_svg&&b.setResizesEnabled(!0);stopTextWidthCache$$module$build$src$core$utils$dom();fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(FINISHED_LOADING$$module$build$src$core$events$utils))(b));\nsetGroup$$module$build$src$core$events$utils(c);setRecordUndo$$module$build$src$core$events$utils(e)}},saveProcedure$$module$build$src$core$serialization$procedures=function(a){const b={id:a.getId(),name:a.getName(),returnTypes:a.getReturnTypes()};if(!a.getParameters().length)return b;b.parameters=a.getParameters().map(c=>saveParameter$$module$build$src$core$serialization$procedures(c));return b},saveParameter$$module$build$src$core$serialization$procedures=function(a){const b={id:a.getId(),name:a.getName()};\nif(!a.getTypes().length)return b;b.types=a.getTypes();return b},loadProcedure$$module$build$src$core$serialization$procedures=function(a,b,c,d){a=(new a(d,c.name,c.id)).setReturnTypes(c.returnTypes);if(!c.parameters)return a;for(const [e,f]of c.parameters.entries())a.insertParameter(loadParameter$$module$build$src$core$serialization$procedures(b,f,d),e);return a},loadParameter$$module$build$src$core$serialization$procedures=function(a,b,c){a=new a(c,b.name,b.id);b.types&&a.setTypes(b.types);return a},\nbumpObjectIntoBounds$$module$build$src$core$bump_objects=function(a,b,c){const d=c.getBoundingRectangle(),e=d.right-d.left,f=clamp$$module$build$src$core$utils$math(b.top,d.top,b.top+b.height-(d.bottom-d.top))-d.top;let g=b.left;b=b.left+b.width-e;a.RTL?g=Math.min(b,g):b=Math.max(g,b);return(a=clamp$$module$build$src$core$utils$math(g,d.left,b)-d.left)||f?(c.moveBy(a,f),!0):!1},bumpIntoBoundsHandler$$module$build$src$core$bump_objects=function(a){return b=>{var c=a.getMetricsManager();if(c.hasFixedEdges()&&\n!a.isDragging()){var d;if(-1!==BUMP_EVENTS$$module$build$src$core$events$utils.indexOf(null!=(d=b.type)?d:\"\")){d=c.getScrollMetrics(!0);const e=extractObjectFromEvent$$module$build$src$core$bump_objects(a,b);e&&(c=getGroup$$module$build$src$core$events$utils(),setGroup$$module$build$src$core$events$utils(b.group),bumpObjectIntoBounds$$module$build$src$core$bump_objects(a,d,e)&&!b.group&&console.warn(\"Moved object in bounds but there was no event group. This may break undo.\"),null!==c&&setGroup$$module$build$src$core$events$utils(c))}else b.type===\nVIEWPORT_CHANGE$$module$build$src$core$events$utils&&b.scale&&b.oldScale&&b.scale>b.oldScale&&bumpTopObjectsIntoBounds$$module$build$src$core$bump_objects(a)}}},extractObjectFromEvent$$module$build$src$core$bump_objects=function(a,b){let c=null;switch(b.type){case CREATE$$module$build$src$core$events$utils:case MOVE$$module$build$src$core$events$utils:(c=a.getBlockById(b.blockId))&&(c=c.getRootBlock());break;case COMMENT_CREATE$$module$build$src$core$events$utils:case COMMENT_MOVE$$module$build$src$core$events$utils:c=\na.getCommentById(b.commentId)}return c},bumpTopObjectsIntoBounds$$module$build$src$core$bump_objects=function(a){var b=a.getMetricsManager();if(b.hasFixedEdges()&&!a.isDragging()){b=b.getScrollMetrics(!0);var c=a.getTopBoundedElements();for(let d=0,e;e=c[d];d++)bumpObjectIntoBounds$$module$build$src$core$bump_objects(a,b,e)}},inject$$module$build$src$core$inject=function(a,b){\"string\"===typeof a&&(a=document.getElementById(a)||document.querySelector(a));if(!a||!containsNode$$module$build$src$core$utils$dom(document,\na))throw Error(\"Error: container is not in current document.\");b=new Options$$module$build$src$core$options(b||{});const c=document.createElement(\"div\");c.className=\"injectionDiv\";c.tabIndex=0;setState$$module$build$src$core$utils$aria(c,State$$module$build$src$core$utils$aria.LABEL,Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL);a.appendChild(c);a=createDom$$module$build$src$core$inject(c,b);const d=new BlockDragSurfaceSvg$$module$build$src$core$block_drag_surface(c),e=new WorkspaceDragSurfaceSvg$$module$build$src$core$workspace_drag_surface_svg(c),\nf=createMainWorkspace$$module$build$src$core$inject(a,b,d,e);init$$module$build$src$core$inject(f);setMainWorkspace$$module$build$src$core$common(f);svgResize$$module$build$src$core$common(f);c.addEventListener(\"focusin\",function(){setMainWorkspace$$module$build$src$core$common(f)});return f},createDom$$module$build$src$core$inject=function(a,b){a.setAttribute(\"dir\",\"LTR\");inject$$module$build$src$core$css(b.hasCss,b.pathToMedia);a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.SVG,\n{xmlns:SVG_NS$$module$build$src$core$utils$dom,\"xmlns:html\":HTML_NS$$module$build$src$core$utils$dom,\"xmlns:xlink\":XLINK_NS$$module$build$src$core$utils$dom,version:\"1.1\",\"class\":\"blocklySvg\",tabindex:\"0\"},a);const c=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.DEFS,{},a),d=String(Math.random()).substring(2);b.gridPattern=Grid$$module$build$src$core$grid.createDom(d,b.gridOptions,c);return a},createMainWorkspace$$module$build$src$core$inject=function(a,b,\nc,d){b.parentWorkspace=null;b=new WorkspaceSvg$$module$build$src$core$workspace_svg(b,c,d);c=b.options;b.scale=c.zoomOptions.startScale;a.appendChild(b.createDom(\"blocklyMainBackground\"));d=b.getInjectionDiv();var e=b.getRenderer().getClassName();e&&addClass$$module$build$src$core$utils$dom(d,e);(e=b.getTheme().getClassName())&&addClass$$module$build$src$core$utils$dom(d,e);!c.hasCategories&&c.languageTree&&(d=b.addFlyout(Svg$$module$build$src$core$utils$svg.SVG),insertAfter$$module$build$src$core$utils$dom(d,\na));c.hasTrashcan&&b.addTrashcan();c.zoomOptions&&c.zoomOptions.controls&&b.addZoomControls();b.getThemeManager().subscribe(a,\"workspaceBackgroundColour\",\"background-color\");b.translate(0,0);b.addChangeListener(bumpIntoBoundsHandler$$module$build$src$core$bump_objects(b));svgResize$$module$build$src$core$common(b);createDom$$module$build$src$core$widgetdiv();createDom$$module$build$src$core$dropdowndiv();createDom$$module$build$src$core$tooltip();return b},init$$module$build$src$core$inject=function(a){const b=\na.options;var c=a.getParentSvg();conditionalBind$$module$build$src$core$browser_events(c.parentNode,\"contextmenu\",null,function(d){isTargetInput$$module$build$src$core$browser_events(d)||d.preventDefault()});c=conditionalBind$$module$build$src$core$browser_events(window,\"resize\",null,function(){a.hideChaff(!0);svgResize$$module$build$src$core$common(a);bumpTopObjectsIntoBounds$$module$build$src$core$bump_objects(a)});a.setResizeHandlerWrapper(c);bindDocumentEvents$$module$build$src$core$inject();\nif(b.languageTree){c=a.getToolbox();const d=a.getFlyout(!0);c?c.init():d&&(d.init(a),d.show(b.languageTree),\"function\"===typeof d.scrollToStart&&d.scrollToStart())}b.hasTrashcan&&a.trashcan.init();b.zoomOptions&&b.zoomOptions.controls&&a.zoomControls_.init();b.moveOptions&&b.moveOptions.scrollbars?(a.scrollbar=new ScrollbarPair$$module$build$src$core$scrollbar_pair(a,!0===b.moveOptions.scrollbars||!!b.moveOptions.scrollbars.horizontal,!0===b.moveOptions.scrollbars||!!b.moveOptions.scrollbars.vertical,\n\"blocklyMainWorkspaceScrollbar\"),a.scrollbar.resize()):a.setMetrics({x:.5,y:.5});b.hasSounds&&loadSounds$$module$build$src$core$inject(b.pathToMedia,a)},onKeyDown$$module$build$src$core$inject=function(a){const b=getMainWorkspace$$module$build$src$core$common();if(b&&!(isTargetInput$$module$build$src$core$browser_events(a)||b.rendered&&!b.isVisible()))ShortcutRegistry$$module$build$src$core$shortcut_registry.registry.onKeyDown(b,a)},bindDocumentEvents$$module$build$src$core$inject=function(){documentEventsBound$$module$build$src$core$inject||\n(conditionalBind$$module$build$src$core$browser_events(document,\"scroll\",null,function(){const a=getAllWorkspaces$$module$build$src$core$common();for(let b=0,c;c=a[b];b++)c instanceof WorkspaceSvg$$module$build$src$core$workspace_svg&&c.updateInverseScreenCTM()}),conditionalBind$$module$build$src$core$browser_events(document,\"keydown\",null,onKeyDown$$module$build$src$core$inject),bind$$module$build$src$core$browser_events(document,\"touchend\",null,longStop$$module$build$src$core$touch),bind$$module$build$src$core$browser_events(document,\n\"touchcancel\",null,longStop$$module$build$src$core$touch),IPAD$$module$build$src$core$utils$useragent&&conditionalBind$$module$build$src$core$browser_events(window,\"orientationchange\",document,function(){svgResize$$module$build$src$core$common(getMainWorkspace$$module$build$src$core$common())}));documentEventsBound$$module$build$src$core$inject=!0},loadSounds$$module$build$src$core$inject=function(a,b){function c(){for(;e.length;)unbind$$module$build$src$core$browser_events(e.pop());d.preload()}const d=\nb.getAudioManager();d.load([a+\"click.mp3\",a+\"click.wav\",a+\"click.ogg\"],\"click\");d.load([a+\"disconnect.wav\",a+\"disconnect.mp3\",a+\"disconnect.ogg\"],\"disconnect\");d.load([a+\"delete.mp3\",a+\"delete.ogg\",a+\"delete.wav\"],\"delete\");const e=[];e.push(conditionalBind$$module$build$src$core$browser_events(document,\"pointermove\",null,c,!0));e.push(conditionalBind$$module$build$src$core$browser_events(document,\"touchstart\",null,c,!0))},findMatchingParameter$$module$build$src$core$events$events_procedure_parameter_rename=\nfunction(a,b,c){a=a.getProcedureMap().get(b);if(!a)throw Error(\"Cannot rename the parameter of a procedure that does not exist in the procedure map\");return a.getParameters().find(d=>d.getId()===c)},registerUndo$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.UNDO},preconditionFn(a){return 0<a.workspace.getUndoStack().length?\"enabled\":\"disabled\"},callback(a){a.workspace.undo(!1)},\nscopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,id:\"undoWorkspace\",weight:1})},registerRedo$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.REDO},preconditionFn(a){return 0<a.workspace.getRedoStack().length?\"enabled\":\"disabled\"},callback(a){a.workspace.undo(!0)},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,\nid:\"redoWorkspace\",weight:2})},registerCleanup$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.CLEAN_UP},preconditionFn(a){return a.workspace.isMovable()?1<a.workspace.getTopBlocks(!1).length?\"enabled\":\"disabled\":\"hidden\"},callback(a){a.workspace.cleanUp()},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,id:\"cleanWorkspace\",\nweight:3})},toggleOption_$$module$build$src$core$contextmenu_items=function(a,b){function c(f){e--;f.setCollapsed(a);0===e&&setGroup$$module$build$src$core$events$utils(!1)}let d=0,e=0;setGroup$$module$build$src$core$events$utils(!0);for(let f=0;f<b.length;f++){let g=b[f];for(;g;)e++,setTimeout(c.bind(null,g),d),g=g.getNextBlock(),d+=10}},registerCollapse$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.COLLAPSE_ALL},\npreconditionFn(a){if(a.workspace.options.collapse){a=a.workspace.getTopBlocks(!1);for(let b=0;b<a.length;b++){let c=a[b];for(;c;){if(!c.isCollapsed())return\"enabled\";c=c.getNextBlock()}}return\"disabled\"}return\"hidden\"},callback(a){toggleOption_$$module$build$src$core$contextmenu_items(!0,a.workspace.getTopBlocks(!0))},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,id:\"collapseWorkspace\",weight:4})},registerExpand$$module$build$src$core$contextmenu_items=\nfunction(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.EXPAND_ALL},preconditionFn(a){if(a.workspace.options.collapse){a=a.workspace.getTopBlocks(!1);for(let b=0;b<a.length;b++){let c=a[b];for(;c;){if(c.isCollapsed())return\"enabled\";c=c.getNextBlock()}}return\"disabled\"}return\"hidden\"},callback(a){toggleOption_$$module$build$src$core$contextmenu_items(!1,a.workspace.getTopBlocks(!0))},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,\nid:\"expandWorkspace\",weight:5})},addDeletableBlocks_$$module$build$src$core$contextmenu_items=function(a,b){if(a.isDeletable())Array.prototype.push.apply(b,a.getDescendants(!1));else{a=a.getChildren(!1);for(let c=0;c<a.length;c++)addDeletableBlocks_$$module$build$src$core$contextmenu_items(a[c],b)}},getDeletableBlocks_$$module$build$src$core$contextmenu_items=function(a){const b=[];a=a.getTopBlocks(!0);for(let c=0;c<a.length;c++)addDeletableBlocks_$$module$build$src$core$contextmenu_items(a[c],b);\nreturn b},deleteNext_$$module$build$src$core$contextmenu_items=function(a,b){setGroup$$module$build$src$core$events$utils(b);const c=a.shift();c&&(c.isDeadOrDying()?deleteNext_$$module$build$src$core$contextmenu_items(a,b):(c.dispose(!1,!0),setTimeout(deleteNext_$$module$build$src$core$contextmenu_items,10,a,b)));setGroup$$module$build$src$core$events$utils(!1)},registerDeleteAll$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(a){if(!a.workspace)return\"\";\na=getDeletableBlocks_$$module$build$src$core$contextmenu_items(a.workspace).length;return 1===a?Msg$$module$build$src$core$msg.DELETE_BLOCK:Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace(\"%1\",String(a))},preconditionFn(a){return a.workspace?0<getDeletableBlocks_$$module$build$src$core$contextmenu_items(a.workspace).length?\"enabled\":\"disabled\":\"disabled\"},callback(a){if(a.workspace){a.workspace.cancelCurrentGesture();var b=getDeletableBlocks_$$module$build$src$core$contextmenu_items(a.workspace),\nc=genUid$$module$build$src$core$utils$idgenerator();2>b.length?deleteNext_$$module$build$src$core$contextmenu_items(b,c):confirm$$module$build$src$core$dialog(Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace(\"%1\",String(b.length)),function(d){d&&deleteNext_$$module$build$src$core$contextmenu_items(b,c)})}},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,id:\"workspaceDelete\",weight:6})},registerWorkspaceOptions_$$module$build$src$core$contextmenu_items=\nfunction(){registerUndo$$module$build$src$core$contextmenu_items();registerRedo$$module$build$src$core$contextmenu_items();registerCleanup$$module$build$src$core$contextmenu_items();registerCollapse$$module$build$src$core$contextmenu_items();registerExpand$$module$build$src$core$contextmenu_items();registerDeleteAll$$module$build$src$core$contextmenu_items()},registerDuplicate$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.DUPLICATE_BLOCK},\npreconditionFn(a){a=a.block;return!a.isInFlyout&&a.isDeletable()&&a.isMovable()?a.isDuplicatable()?\"enabled\":\"disabled\":\"hidden\"},callback(a){a.block&&duplicate$$module$build$src$core$clipboard(a.block)},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,id:\"blockDuplicate\",weight:1})},registerComment$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(a){return a.block.getCommentIcon()?\nMsg$$module$build$src$core$msg.REMOVE_COMMENT:Msg$$module$build$src$core$msg.ADD_COMMENT},preconditionFn(a){a=a.block;return!a.isInFlyout&&a.workspace.options.comments&&!a.isCollapsed()&&a.isEditable()?\"enabled\":\"hidden\"},callback(a){a=a.block;a.getCommentIcon()?a.setCommentText(null):a.setCommentText(\"\")},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,id:\"blockComment\",weight:2})},registerInline$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(a){return a.block.getInputsInline()?\nMsg$$module$build$src$core$msg.EXTERNAL_INPUTS:Msg$$module$build$src$core$msg.INLINE_INPUTS},preconditionFn(a){a=a.block;if(!a.isInFlyout&&a.isMovable()&&!a.isCollapsed())for(let b=1;b<a.inputList.length;b++)if(a.inputList[b-1].type!==inputTypes$$module$build$src$core$input_types.STATEMENT&&a.inputList[b].type!==inputTypes$$module$build$src$core$input_types.STATEMENT)return\"enabled\";return\"hidden\"},callback(a){a.block.setInputsInline(!a.block.getInputsInline())},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,\nid:\"blockInline\",weight:3})},registerCollapseExpandBlock$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(a){return a.block.isCollapsed()?Msg$$module$build$src$core$msg.EXPAND_BLOCK:Msg$$module$build$src$core$msg.COLLAPSE_BLOCK},preconditionFn(a){a=a.block;return!a.isInFlyout&&a.isMovable()&&a.workspace.options.collapse?\"enabled\":\"hidden\"},callback(a){a.block.setCollapsed(!a.block.isCollapsed())},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,\nid:\"blockCollapseExpand\",weight:4})},registerDisable$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(a){return a.block.isEnabled()?Msg$$module$build$src$core$msg.DISABLE_BLOCK:Msg$$module$build$src$core$msg.ENABLE_BLOCK},preconditionFn(a){a=a.block;return!a.isInFlyout&&a.workspace.options.disable&&a.isEditable()?a.getInheritedDisabled()?\"disabled\":\"enabled\":\"hidden\"},callback(a){a=a.block;const b=getGroup$$module$build$src$core$events$utils();\nb||setGroup$$module$build$src$core$events$utils(!0);a.setEnabled(!a.isEnabled());b||setGroup$$module$build$src$core$events$utils(!1)},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,id:\"blockDisable\",weight:5})},registerDelete$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(a){var b=a.block;a=b.getDescendants(!1).length;(b=b.getNextBlock())&&(a-=b.getDescendants(!1).length);\nreturn 1===a?Msg$$module$build$src$core$msg.DELETE_BLOCK:Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace(\"%1\",String(a))},preconditionFn(a){return!a.block.isInFlyout&&a.block.isDeletable()?\"enabled\":\"hidden\"},callback(a){a.block&&a.block.checkAndDelete()},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,id:\"blockDelete\",weight:6})},registerHelp$$module$build$src$core$contextmenu_items=function(){ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.register({displayText(){return Msg$$module$build$src$core$msg.HELP},\npreconditionFn(a){a=a.block;return(\"function\"===typeof a.helpUrl?a.helpUrl():a.helpUrl)?\"enabled\":\"hidden\"},callback(a){a.block.showHelp()},scopeType:ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,id:\"blockHelp\",weight:7})},registerBlockOptions_$$module$build$src$core$contextmenu_items=function(){registerDuplicate$$module$build$src$core$contextmenu_items();registerComment$$module$build$src$core$contextmenu_items();registerInline$$module$build$src$core$contextmenu_items();\nregisterCollapseExpandBlock$$module$build$src$core$contextmenu_items();registerDisable$$module$build$src$core$contextmenu_items();registerDelete$$module$build$src$core$contextmenu_items();registerHelp$$module$build$src$core$contextmenu_items()},registerDefaultOptions$$module$build$src$core$contextmenu_items=function(){registerWorkspaceOptions_$$module$build$src$core$contextmenu_items();registerBlockOptions_$$module$build$src$core$contextmenu_items()},initIconData$$module$build$src$core$block_dragger=\nfunction(a){const b=[];a=a.getDescendants(!1);for(let c=0,d;d=a[c];c++){const e=d.getIcons();for(let f=0;f<e.length;f++){const g={location:e[f].getIconLocation(),icon:e[f]};b.push(g)}}return b},hideChaff$$module$build$src$core$blockly=function(a){getMainWorkspace$$module$build$src$core$common().hideChaff(a)},resizeSvgContentsLocal$$module$build$src$core$blockly=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.resizeSvgContents\",\"December 2021\",\"December 2022\",\"Blockly.WorkspaceSvg.resizeSvgContents\");\nresizeSvgContents$$module$build$src$core$workspace_svg(a)},copy$$module$build$src$core$blockly=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.copy\",\"December 2021\",\"December 2022\",\"Blockly.clipboard.copy\");copy$$module$build$src$core$clipboard(a)},paste$$module$build$src$core$blockly=function(){warn$$module$build$src$core$utils$deprecation(\"Blockly.paste\",\"December 2021\",\"December 2022\",\"Blockly.clipboard.paste\");return!!paste$$module$build$src$core$clipboard()},duplicate$$module$build$src$core$blockly=\nfunction(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.duplicate\",\"December 2021\",\"December 2022\",\"Blockly.clipboard.duplicate\");duplicate$$module$build$src$core$clipboard(a)},isNumber$$module$build$src$core$blockly=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.isNumber\",\"December 2021\",\"December 2022\",\"Blockly.utils.string.isNumber\");return isNumber$$module$build$src$core$utils$string(a)},hueToHex$$module$build$src$core$blockly=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.hueToHex\",\n\"December 2021\",\"December 2022\",\"Blockly.utils.colour.hueToHex\");return hueToHex$$module$build$src$core$utils$colour(a)},bindEvent_$$module$build$src$core$blockly=function(a,b,c,d){warn$$module$build$src$core$utils$deprecation(\"Blockly.bindEvent_\",\"December 2021\",\"December 2022\",\"Blockly.browserEvents.bind\");return bind$$module$build$src$core$browser_events(a,b,c,d)},unbindEvent_$$module$build$src$core$blockly=function(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.unbindEvent_\",\"December 2021\",\n\"December 2022\",\"Blockly.browserEvents.unbind\");return unbind$$module$build$src$core$browser_events(a)},bindEventWithChecks_$$module$build$src$core$blockly=function(a,b,c,d,e,f){warn$$module$build$src$core$utils$deprecation(\"Blockly.bindEventWithChecks_\",\"December 2021\",\"December 2022\",\"Blockly.browserEvents.conditionalBind\");return conditionalBind$$module$build$src$core$browser_events(a,b,c,d,e)},$jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;\n$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||\"function\"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};\n$jscomp.getGlobal=function(a){a=[\"object\"==typeof globalThis&&globalThis,a,\"object\"==typeof window&&window,\"object\"==typeof self&&self,\"object\"==typeof __webpack_require__.g&&__webpack_require__.g];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error(\"Cannot find global object\");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE=\"function\"===typeof Symbol&&\"symbol\"===typeof Symbol(\"x\");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};\n$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX=\"$jscp$\";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};\n$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(\".\");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};\n$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(\".\");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&\"es6\"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?\n$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+\"$\"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill(\"globalThis\",function(a){return a||$jscomp.global},\"es_2020\",\"es3\");$jscomp.polyfill(\"Object.getOwnPropertyDescriptors\",function(a){return a?a:function(b){for(var c={},d=Reflect.ownKeys(b),e=0;e<d.length;e++)c[d[e]]=Object.getOwnPropertyDescriptor(b,d[e]);return c}},\"es8\",\"es5\");\n$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.initSymbol=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};\n$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+=\"\");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill(\"Array.prototype.values\",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},\"es8\",\"es3\");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};\n$jscomp.polyfill(\"Object.values\",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push(b[d]);return c}},\"es8\",\"es3\");$jscomp.polyfill(\"Array.prototype.flat\",function(a){return a?a:function(b){b=void 0===b?1:b;for(var c=[],d=0;d<this.length;d++){var e=this[d];Array.isArray(e)&&0<b?(e=Array.prototype.flat.call(e,b-1),c.push.apply(c,e)):c.push(e)}return c}},\"es9\",\"es5\");\n$jscomp.polyfill(\"Object.entries\",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},\"es8\",\"es3\");var global$$module$build$src$closure$goog$goog=globalThis,declareModuleId$$module$build$src$closure$goog$goog=function(a){window.goog&&window.goog.declareModuleId&&window.goog.declareModuleId.call(this,a)},module$build$src$closure$goog$goog={};module$build$src$closure$goog$goog.declareModuleId=declareModuleId$$module$build$src$closure$goog$goog;\nmodule$build$src$closure$goog$goog.global=global$$module$build$src$closure$goog$goog;/*\n\n Copyright The Closure Library Authors.\n SPDX-License-Identifier: Apache-2.0\n*/\nvar COMPILED=!0,goog=goog||{};goog.global=globalThis||root;goog.define=function(a,b){return b};goog.DEBUG=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;goog.provide=function(a){};goog.module=function(a){};goog.module.get=function(a){};goog.module.declareLegacyNamespace=function(){};goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||\"\",Error(\"Importing test-only code into non-debug environment\"+(a?\": \"+a:\".\"));};goog.require=function(a){};goog.requireType=function(a){};var module$build$src$core$utils$deprecation={};module$build$src$core$utils$deprecation.warn=warn$$module$build$src$core$utils$deprecation;var LONGPRESS$$module$build$src$core$touch=750,TOUCH_ENABLED$$module$build$src$core$touch=\"ontouchstart\"in globalThis||!!(globalThis.document&&document.documentElement&&\"ontouchstart\"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),touchIdentifier_$$module$build$src$core$touch=null,TOUCH_MAP$$module$build$src$core$touch={mousedown:[\"pointerdown\"],mouseenter:[\"pointerenter\"],mouseleave:[\"pointerleave\"],mousemove:[\"pointermove\"],\nmouseout:[\"pointerout\"],mouseover:[\"pointerover\"],mouseup:[\"pointerup\",\"pointercancel\"],touchend:[\"pointerup\"],touchcancel:[\"pointercancel\"]},longPid_$$module$build$src$core$touch=0,module$build$src$core$touch={};module$build$src$core$touch.TOUCH_ENABLED=TOUCH_ENABLED$$module$build$src$core$touch;module$build$src$core$touch.TOUCH_MAP=TOUCH_MAP$$module$build$src$core$touch;module$build$src$core$touch.checkTouchIdentifier=checkTouchIdentifier$$module$build$src$core$touch;\nmodule$build$src$core$touch.clearTouchIdentifier=clearTouchIdentifier$$module$build$src$core$touch;module$build$src$core$touch.getTouchIdentifierFromEvent=getTouchIdentifierFromEvent$$module$build$src$core$touch;module$build$src$core$touch.isMouseOrTouchEvent=isMouseOrTouchEvent$$module$build$src$core$touch;module$build$src$core$touch.isTouchEvent=isTouchEvent$$module$build$src$core$touch;module$build$src$core$touch.longStart=longStart$$module$build$src$core$touch;\nmodule$build$src$core$touch.longStop=longStop$$module$build$src$core$touch;module$build$src$core$touch.setClientFromTouch=setClientFromTouch$$module$build$src$core$touch;module$build$src$core$touch.shouldHandleEvent=shouldHandleEvent$$module$build$src$core$touch;module$build$src$core$touch.splitEventByTouches=splitEventByTouches$$module$build$src$core$touch;var rawUserAgent$$module$build$src$core$utils$useragent,isJavaFx$$module$build$src$core$utils$useragent,isWebKit$$module$build$src$core$utils$useragent,isGecko$$module$build$src$core$utils$useragent,isAndroid$$module$build$src$core$utils$useragent,isIPad$$module$build$src$core$utils$useragent,isIPhone$$module$build$src$core$utils$useragent,isMac$$module$build$src$core$utils$useragent,isTablet$$module$build$src$core$utils$useragent,isMobile$$module$build$src$core$utils$useragent;\n(function(a){function b(d){return-1!==c.indexOf(d.toUpperCase())}rawUserAgent$$module$build$src$core$utils$useragent=a;const c=rawUserAgent$$module$build$src$core$utils$useragent.toUpperCase();isJavaFx$$module$build$src$core$utils$useragent=b(\"JavaFX\");isWebKit$$module$build$src$core$utils$useragent=b(\"WebKit\");isGecko$$module$build$src$core$utils$useragent=b(\"Gecko\")&&!isWebKit$$module$build$src$core$utils$useragent;isAndroid$$module$build$src$core$utils$useragent=b(\"Android\");a=globalThis.navigator&&\nglobalThis.navigator.maxTouchPoints;isIPad$$module$build$src$core$utils$useragent=b(\"iPad\")||b(\"Macintosh\")&&0<a;isIPhone$$module$build$src$core$utils$useragent=b(\"iPhone\")&&!isIPad$$module$build$src$core$utils$useragent;isMac$$module$build$src$core$utils$useragent=b(\"Macintosh\");isTablet$$module$build$src$core$utils$useragent=isIPad$$module$build$src$core$utils$useragent||isAndroid$$module$build$src$core$utils$useragent&&!b(\"Mobile\")||b(\"Silk\");isMobile$$module$build$src$core$utils$useragent=!isTablet$$module$build$src$core$utils$useragent&&\n(isIPhone$$module$build$src$core$utils$useragent||isAndroid$$module$build$src$core$utils$useragent)})(globalThis.navigator&&globalThis.navigator.userAgent||\"\");\nvar raw$$module$build$src$core$utils$useragent=rawUserAgent$$module$build$src$core$utils$useragent,JavaFx$$module$build$src$core$utils$useragent=isJavaFx$$module$build$src$core$utils$useragent,GECKO$$module$build$src$core$utils$useragent=isGecko$$module$build$src$core$utils$useragent,ANDROID$$module$build$src$core$utils$useragent=isAndroid$$module$build$src$core$utils$useragent,IPAD$$module$build$src$core$utils$useragent=isIPad$$module$build$src$core$utils$useragent,IPHONE$$module$build$src$core$utils$useragent=\nisIPhone$$module$build$src$core$utils$useragent,MAC$$module$build$src$core$utils$useragent=isMac$$module$build$src$core$utils$useragent,MOBILE$$module$build$src$core$utils$useragent=isMobile$$module$build$src$core$utils$useragent,module$build$src$core$utils$useragent={};module$build$src$core$utils$useragent.ANDROID=ANDROID$$module$build$src$core$utils$useragent;module$build$src$core$utils$useragent.GECKO=GECKO$$module$build$src$core$utils$useragent;module$build$src$core$utils$useragent.IPAD=IPAD$$module$build$src$core$utils$useragent;\nmodule$build$src$core$utils$useragent.IPHONE=IPHONE$$module$build$src$core$utils$useragent;module$build$src$core$utils$useragent.JavaFx=JavaFx$$module$build$src$core$utils$useragent;module$build$src$core$utils$useragent.MAC=MAC$$module$build$src$core$utils$useragent;module$build$src$core$utils$useragent.MOBILE=MOBILE$$module$build$src$core$utils$useragent;module$build$src$core$utils$useragent.raw=raw$$module$build$src$core$utils$useragent;var LINE_MODE_MULTIPLIER$$module$build$src$core$browser_events=40,PAGE_MODE_MULTIPLIER$$module$build$src$core$browser_events=125,module$build$src$core$browser_events={};module$build$src$core$browser_events.bind=bind$$module$build$src$core$browser_events;module$build$src$core$browser_events.conditionalBind=conditionalBind$$module$build$src$core$browser_events;module$build$src$core$browser_events.getScrollDeltaPixels=getScrollDeltaPixels$$module$build$src$core$browser_events;\nmodule$build$src$core$browser_events.isRightButton=isRightButton$$module$build$src$core$browser_events;module$build$src$core$browser_events.isTargetInput=isTargetInput$$module$build$src$core$browser_events;module$build$src$core$browser_events.mouseToSvg=mouseToSvg$$module$build$src$core$browser_events;module$build$src$core$browser_events.unbind=unbind$$module$build$src$core$browser_events;var Blocks$$module$build$src$core$blocks=Object.create(null),module$build$src$core$blocks={};module$build$src$core$blocks.Blocks=Blocks$$module$build$src$core$blocks;var WorkspaceDB_$$module$build$src$core$common,mainWorkspace$$module$build$src$core$common,selected$$module$build$src$core$common,parentContainer$$module$build$src$core$common,draggingConnections$$module$build$src$core$common,TEST_ONLY$$module$build$src$core$common;WorkspaceDB_$$module$build$src$core$common=Object.create(null);selected$$module$build$src$core$common=null;draggingConnections$$module$build$src$core$common=[];TEST_ONLY$$module$build$src$core$common={defineBlocksWithJsonArrayInternal:defineBlocksWithJsonArrayInternal$$module$build$src$core$common};\n$.module$build$src$core$common={};$.module$build$src$core$common.TEST_ONLY=TEST_ONLY$$module$build$src$core$common;$.module$build$src$core$common.createBlockDefinitionsFromJsonArray=createBlockDefinitionsFromJsonArray$$module$build$src$core$common;$.module$build$src$core$common.defineBlocks=defineBlocks$$module$build$src$core$common;$.module$build$src$core$common.defineBlocksWithJsonArray=defineBlocksWithJsonArray$$module$build$src$core$common;$.module$build$src$core$common.draggingConnections=draggingConnections$$module$build$src$core$common;\n$.module$build$src$core$common.getAllWorkspaces=getAllWorkspaces$$module$build$src$core$common;$.module$build$src$core$common.getBlockTypeCounts=getBlockTypeCounts$$module$build$src$core$common;$.module$build$src$core$common.getMainWorkspace=getMainWorkspace$$module$build$src$core$common;$.module$build$src$core$common.getParentContainer=getParentContainer$$module$build$src$core$common;$.module$build$src$core$common.getSelected=getSelected$$module$build$src$core$common;\n$.module$build$src$core$common.getWorkspaceById=getWorkspaceById$$module$build$src$core$common;$.module$build$src$core$common.registerWorkspace=registerWorkspace$$module$build$src$core$common;$.module$build$src$core$common.setMainWorkspace=setMainWorkspace$$module$build$src$core$common;$.module$build$src$core$common.setParentContainer=setParentContainer$$module$build$src$core$common;$.module$build$src$core$common.setSelected=setSelected$$module$build$src$core$common;\n$.module$build$src$core$common.svgResize=svgResize$$module$build$src$core$common;$.module$build$src$core$common.unregisterWorkpace=unregisterWorkpace$$module$build$src$core$common;var SVG_NS$$module$build$src$core$utils$dom=\"http://www.w3.org/2000/svg\",HTML_NS$$module$build$src$core$utils$dom=\"http://www.w3.org/1999/xhtml\",XLINK_NS$$module$build$src$core$utils$dom=\"http://www.w3.org/1999/xlink\",NodeType$$module$build$src$core$utils$dom;\n(function(a){a[a.ELEMENT_NODE=1]=\"ELEMENT_NODE\";a[a.TEXT_NODE=3]=\"TEXT_NODE\";a[a.COMMENT_NODE=8]=\"COMMENT_NODE\";a[a.DOCUMENT_POSITION_CONTAINED_BY=16]=\"DOCUMENT_POSITION_CONTAINED_BY\"})(NodeType$$module$build$src$core$utils$dom||(NodeType$$module$build$src$core$utils$dom={}));var cacheWidths$$module$build$src$core$utils$dom=null,cacheReference$$module$build$src$core$utils$dom=0,canvasContext$$module$build$src$core$utils$dom=null,module$build$src$core$utils$dom={};\nmodule$build$src$core$utils$dom.HTML_NS=HTML_NS$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.NodeType=NodeType$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.SVG_NS=SVG_NS$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.XLINK_NS=XLINK_NS$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.addClass=addClass$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.containsNode=containsNode$$module$build$src$core$utils$dom;\nmodule$build$src$core$utils$dom.createSvgElement=createSvgElement$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.getFastTextWidth=getFastTextWidth$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.getFastTextWidthWithSizeString=getFastTextWidthWithSizeString$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.getTextWidth=getTextWidth$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.hasClass=hasClass$$module$build$src$core$utils$dom;\nmodule$build$src$core$utils$dom.insertAfter=insertAfter$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.measureFontMetrics=measureFontMetrics$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.removeClass=removeClass$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.removeClasses=removeClasses$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.removeNode=removeNode$$module$build$src$core$utils$dom;\nmodule$build$src$core$utils$dom.setCssTransform=setCssTransform$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.startTextWidthCache=startTextWidthCache$$module$build$src$core$utils$dom;module$build$src$core$utils$dom.stopTextWidthCache=stopTextWidthCache$$module$build$src$core$utils$dom;var module$build$src$core$utils$math={};module$build$src$core$utils$math.clamp=clamp$$module$build$src$core$utils$math;module$build$src$core$utils$math.toDegrees=toDegrees$$module$build$src$core$utils$math;module$build$src$core$utils$math.toRadians=toRadians$$module$build$src$core$utils$math;var Rect$$module$build$src$core$utils$rect=class{constructor(a,b,c,d){this.top=a;this.bottom=b;this.left=c;this.right=d}contains(a,b){return a>=this.left&&a<=this.right&&b>=this.top&&b<=this.bottom}intersects(a){return!(this.left>a.right||this.right<a.left||this.top>a.bottom||this.bottom<a.top)}},module$build$src$core$utils$rect={};module$build$src$core$utils$rect.Rect=Rect$$module$build$src$core$utils$rect;var Coordinate$$module$build$src$core$utils$coordinate=class{constructor(a,b){this.x=a;this.y=b}clone(){return new Coordinate$$module$build$src$core$utils$coordinate(this.x,this.y)}scale(a){this.x*=a;this.y*=a;return this}translate(a,b){this.x+=a;this.y+=b;return this}static equals(a,b){return a===b?!0:a&&b?a.x===b.x&&a.y===b.y:!1}static distance(a,b){const c=a.x-b.x;a=a.y-b.y;return Math.sqrt(c*c+a*a)}static magnitude(a){return Math.sqrt(a.x*a.x+a.y*a.y)}static difference(a,b){return new Coordinate$$module$build$src$core$utils$coordinate(a.x-\nb.x,a.y-b.y)}static sum(a,b){return new Coordinate$$module$build$src$core$utils$coordinate(a.x+b.x,a.y+b.y)}},module$build$src$core$utils$coordinate={};module$build$src$core$utils$coordinate.Coordinate=Coordinate$$module$build$src$core$utils$coordinate;var Size$$module$build$src$core$utils$size=class{constructor(a,b){this.width=a;this.height=b}static equals(a,b){return a===b?!0:a&&b?a.width===b.width&&a.height===b.height:!1}},module$build$src$core$utils$size={};module$build$src$core$utils$size.Size=Size$$module$build$src$core$utils$size;var TEST_ONLY$$module$build$src$core$utils$style={getSizeInternal:getSizeInternal$$module$build$src$core$utils$style},module$build$src$core$utils$style={};module$build$src$core$utils$style.TEST_ONLY=TEST_ONLY$$module$build$src$core$utils$style;module$build$src$core$utils$style.getBorderBox=getBorderBox$$module$build$src$core$utils$style;module$build$src$core$utils$style.getCascadedStyle=getCascadedStyle$$module$build$src$core$utils$style;module$build$src$core$utils$style.getComputedStyle=getComputedStyle$$module$build$src$core$utils$style;\nmodule$build$src$core$utils$style.getContainerOffsetToScrollInto=getContainerOffsetToScrollInto$$module$build$src$core$utils$style;module$build$src$core$utils$style.getPageOffset=getPageOffset$$module$build$src$core$utils$style;module$build$src$core$utils$style.getSize=getSize$$module$build$src$core$utils$style;module$build$src$core$utils$style.getViewportPageOffset=getViewportPageOffset$$module$build$src$core$utils$style;module$build$src$core$utils$style.scrollIntoContainerView=scrollIntoContainerView$$module$build$src$core$utils$style;var ARROW_SIZE$$module$build$src$core$dropdowndiv=16,BORDER_SIZE$$module$build$src$core$dropdowndiv=1,ARROW_HORIZONTAL_PADDING$$module$build$src$core$dropdowndiv=12,PADDING_Y$$module$build$src$core$dropdowndiv=16,ANIMATION_TIME$$module$build$src$core$dropdowndiv=.25,animateOutTimer$$module$build$src$core$dropdowndiv=null,onHide$$module$build$src$core$dropdowndiv=null,renderedClassName$$module$build$src$core$dropdowndiv=\"\",themeClassName$$module$build$src$core$dropdowndiv=\"\",div$$module$build$src$core$dropdowndiv,\ncontent$$module$build$src$core$dropdowndiv,arrow$$module$build$src$core$dropdowndiv,boundsElement$$module$build$src$core$dropdowndiv=null,owner$$module$build$src$core$dropdowndiv=null,positionToField$$module$build$src$core$dropdowndiv=null,internal$$module$build$src$core$dropdowndiv={getBoundsInfo:function(){const a=getPageOffset$$module$build$src$core$utils$style(boundsElement$$module$build$src$core$dropdowndiv),b=getSize$$module$build$src$core$utils$style(boundsElement$$module$build$src$core$dropdowndiv);\nreturn{left:a.x,right:a.x+b.width,top:a.y,bottom:a.y+b.height,width:b.width,height:b.height}},getPositionMetrics:function(a,b,c,d){const e=internal$$module$build$src$core$dropdowndiv.getBoundsInfo(),f=getSize$$module$build$src$core$utils$style(div$$module$build$src$core$dropdowndiv);return b+f.height<e.bottom?getPositionBelowMetrics$$module$build$src$core$dropdowndiv(a,b,e,f):d-f.height>e.top?getPositionAboveMetrics$$module$build$src$core$dropdowndiv(c,d,e,f):b+f.height<document.documentElement.clientHeight?\ngetPositionBelowMetrics$$module$build$src$core$dropdowndiv(a,b,e,f):d-f.height>document.documentElement.clientTop?getPositionAboveMetrics$$module$build$src$core$dropdowndiv(c,d,e,f):getPositionTopOfPageMetrics$$module$build$src$core$dropdowndiv(a,e,f)}},TEST_ONLY$$module$build$src$core$dropdowndiv=internal$$module$build$src$core$dropdowndiv,module$build$src$core$dropdowndiv={};module$build$src$core$dropdowndiv.ANIMATION_TIME=ANIMATION_TIME$$module$build$src$core$dropdowndiv;\nmodule$build$src$core$dropdowndiv.ARROW_HORIZONTAL_PADDING=ARROW_HORIZONTAL_PADDING$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.ARROW_SIZE=ARROW_SIZE$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.BORDER_SIZE=BORDER_SIZE$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.PADDING_Y=PADDING_Y$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.TEST_ONLY=internal$$module$build$src$core$dropdowndiv;\nmodule$build$src$core$dropdowndiv.clearContent=clearContent$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.createDom=createDom$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.getContentDiv=getContentDiv$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.getOwner=getOwner$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.getPositionX=getPositionX$$module$build$src$core$dropdowndiv;\nmodule$build$src$core$dropdowndiv.hide=hide$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.hideIfOwner=hideIfOwner$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.hideWithoutAnimation=hideWithoutAnimation$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.isVisible=isVisible$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.repositionForWindowResize=repositionForWindowResize$$module$build$src$core$dropdowndiv;\nmodule$build$src$core$dropdowndiv.setBoundsElement=setBoundsElement$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.setColour=setColour$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.show=show$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.showPositionedByBlock=showPositionedByBlock$$module$build$src$core$dropdowndiv;module$build$src$core$dropdowndiv.showPositionedByField=showPositionedByField$$module$build$src$core$dropdowndiv;var typeMap$$module$build$src$core$registry=Object.create(null),TEST_ONLY$$module$build$src$core$registry={typeMap:typeMap$$module$build$src$core$registry},nameMap$$module$build$src$core$registry=Object.create(null),DEFAULT$$module$build$src$core$registry=\"default\",Type$$module$build$src$core$registry=class{constructor(a){this.name=a}toString(){return this.name}};Type$$module$build$src$core$registry.CONNECTION_CHECKER=new Type$$module$build$src$core$registry(\"connectionChecker\");\nType$$module$build$src$core$registry.CURSOR=new Type$$module$build$src$core$registry(\"cursor\");Type$$module$build$src$core$registry.EVENT=new Type$$module$build$src$core$registry(\"event\");Type$$module$build$src$core$registry.FIELD=new Type$$module$build$src$core$registry(\"field\");Type$$module$build$src$core$registry.RENDERER=new Type$$module$build$src$core$registry(\"renderer\");Type$$module$build$src$core$registry.TOOLBOX=new Type$$module$build$src$core$registry(\"toolbox\");\nType$$module$build$src$core$registry.THEME=new Type$$module$build$src$core$registry(\"theme\");Type$$module$build$src$core$registry.TOOLBOX_ITEM=new Type$$module$build$src$core$registry(\"toolboxItem\");Type$$module$build$src$core$registry.FLYOUTS_VERTICAL_TOOLBOX=new Type$$module$build$src$core$registry(\"flyoutsVerticalToolbox\");Type$$module$build$src$core$registry.FLYOUTS_HORIZONTAL_TOOLBOX=new Type$$module$build$src$core$registry(\"flyoutsHorizontalToolbox\");\nType$$module$build$src$core$registry.METRICS_MANAGER=new Type$$module$build$src$core$registry(\"metricsManager\");Type$$module$build$src$core$registry.BLOCK_DRAGGER=new Type$$module$build$src$core$registry(\"blockDragger\");Type$$module$build$src$core$registry.SERIALIZER=new Type$$module$build$src$core$registry(\"serializer\");var module$build$src$core$registry={};module$build$src$core$registry.DEFAULT=DEFAULT$$module$build$src$core$registry;module$build$src$core$registry.TEST_ONLY=TEST_ONLY$$module$build$src$core$registry;\nmodule$build$src$core$registry.Type=Type$$module$build$src$core$registry;module$build$src$core$registry.getAllItems=getAllItems$$module$build$src$core$registry;module$build$src$core$registry.getClass=getClass$$module$build$src$core$registry;module$build$src$core$registry.getClassFromOptions=getClassFromOptions$$module$build$src$core$registry;module$build$src$core$registry.getObject=getObject$$module$build$src$core$registry;module$build$src$core$registry.hasItem=hasItem$$module$build$src$core$registry;\nmodule$build$src$core$registry.register=register$$module$build$src$core$registry;module$build$src$core$registry.unregister=unregister$$module$build$src$core$registry;var soup$$module$build$src$core$utils$idgenerator=\"!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",internal$$module$build$src$core$utils$idgenerator={genUid:()=>{const a=soup$$module$build$src$core$utils$idgenerator.length,b=[];for(let c=0;20>c;c++)b[c]=soup$$module$build$src$core$utils$idgenerator.charAt(Math.random()*a);return b.join(\"\")}},TEST_ONLY$$module$build$src$core$utils$idgenerator=internal$$module$build$src$core$utils$idgenerator,nextId$$module$build$src$core$utils$idgenerator=\n0,module$build$src$core$utils$idgenerator={};module$build$src$core$utils$idgenerator.TEST_ONLY=internal$$module$build$src$core$utils$idgenerator;module$build$src$core$utils$idgenerator.genUid=genUid$$module$build$src$core$utils$idgenerator;module$build$src$core$utils$idgenerator.getNextUniqueId=getNextUniqueId$$module$build$src$core$utils$idgenerator;var group$$module$build$src$core$events$utils=\"\",recordUndo$$module$build$src$core$events$utils=!0,disabled$$module$build$src$core$events$utils=0,CREATE$$module$build$src$core$events$utils=\"create\",BLOCK_CREATE$$module$build$src$core$events$utils=CREATE$$module$build$src$core$events$utils,DELETE$$module$build$src$core$events$utils=\"delete\",BLOCK_DELETE$$module$build$src$core$events$utils=DELETE$$module$build$src$core$events$utils,CHANGE$$module$build$src$core$events$utils=\"change\",BLOCK_CHANGE$$module$build$src$core$events$utils=\nCHANGE$$module$build$src$core$events$utils,MOVE$$module$build$src$core$events$utils=\"move\",BLOCK_MOVE$$module$build$src$core$events$utils=MOVE$$module$build$src$core$events$utils,VAR_CREATE$$module$build$src$core$events$utils=\"var_create\",VAR_DELETE$$module$build$src$core$events$utils=\"var_delete\",VAR_RENAME$$module$build$src$core$events$utils=\"var_rename\",UI$$module$build$src$core$events$utils=\"ui\",BLOCK_DRAG$$module$build$src$core$events$utils=\"drag\",SELECTED$$module$build$src$core$events$utils=\n\"selected\",CLICK$$module$build$src$core$events$utils=\"click\",MARKER_MOVE$$module$build$src$core$events$utils=\"marker_move\",BUBBLE_OPEN$$module$build$src$core$events$utils=\"bubble_open\",TRASHCAN_OPEN$$module$build$src$core$events$utils=\"trashcan_open\",TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils=\"toolbox_item_select\",THEME_CHANGE$$module$build$src$core$events$utils=\"theme_change\",VIEWPORT_CHANGE$$module$build$src$core$events$utils=\"viewport_change\",COMMENT_CREATE$$module$build$src$core$events$utils=\n\"comment_create\",COMMENT_DELETE$$module$build$src$core$events$utils=\"comment_delete\",COMMENT_CHANGE$$module$build$src$core$events$utils=\"comment_change\",COMMENT_MOVE$$module$build$src$core$events$utils=\"comment_move\",FINISHED_LOADING$$module$build$src$core$events$utils=\"finished_loading\",PROCEDURE_CREATE$$module$build$src$core$events$utils=\"procedure_create\",PROCEDURE_DELETE$$module$build$src$core$events$utils=\"procedure_delete\",PROCEDURE_RENAME$$module$build$src$core$events$utils=\"procedure_rename\",\nPROCEDURE_ENABLE$$module$build$src$core$events$utils=\"procedure_enable\",PROCEDURE_CHANGE_RETURN$$module$build$src$core$events$utils=\"procedure_change_return\",PROCEDURE_PARAMETER_CREATE$$module$build$src$core$events$utils=\"procedure_parameter_create\",PROCEDURE_PARAMETER_DELETE$$module$build$src$core$events$utils=\"procedure_parameter_delete\",PROCEDURE_PARAMETER_RENAME$$module$build$src$core$events$utils=\"procedure_parameter_rename\",BUMP_EVENTS$$module$build$src$core$events$utils=[CREATE$$module$build$src$core$events$utils,\nMOVE$$module$build$src$core$events$utils,COMMENT_CREATE$$module$build$src$core$events$utils,COMMENT_MOVE$$module$build$src$core$events$utils],FIRE_QUEUE$$module$build$src$core$events$utils=[],TEST_ONLY$$module$build$src$core$events$utils={FIRE_QUEUE:FIRE_QUEUE$$module$build$src$core$events$utils,fireNow:fireNow$$module$build$src$core$events$utils,fireInternal:fireInternal$$module$build$src$core$events$utils,setGroupInternal:setGroupInternal$$module$build$src$core$events$utils},module$build$src$core$events$utils=\n{};module$build$src$core$events$utils.BLOCK_CHANGE=CHANGE$$module$build$src$core$events$utils;module$build$src$core$events$utils.BLOCK_CREATE=CREATE$$module$build$src$core$events$utils;module$build$src$core$events$utils.BLOCK_DELETE=DELETE$$module$build$src$core$events$utils;module$build$src$core$events$utils.BLOCK_DRAG=BLOCK_DRAG$$module$build$src$core$events$utils;module$build$src$core$events$utils.BLOCK_MOVE=MOVE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.BUBBLE_OPEN=BUBBLE_OPEN$$module$build$src$core$events$utils;module$build$src$core$events$utils.BUMP_EVENTS=BUMP_EVENTS$$module$build$src$core$events$utils;module$build$src$core$events$utils.CHANGE=CHANGE$$module$build$src$core$events$utils;module$build$src$core$events$utils.CLICK=CLICK$$module$build$src$core$events$utils;module$build$src$core$events$utils.COMMENT_CHANGE=COMMENT_CHANGE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.COMMENT_CREATE=COMMENT_CREATE$$module$build$src$core$events$utils;module$build$src$core$events$utils.COMMENT_DELETE=COMMENT_DELETE$$module$build$src$core$events$utils;module$build$src$core$events$utils.COMMENT_MOVE=COMMENT_MOVE$$module$build$src$core$events$utils;module$build$src$core$events$utils.CREATE=CREATE$$module$build$src$core$events$utils;module$build$src$core$events$utils.DELETE=DELETE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.FINISHED_LOADING=FINISHED_LOADING$$module$build$src$core$events$utils;module$build$src$core$events$utils.MARKER_MOVE=MARKER_MOVE$$module$build$src$core$events$utils;module$build$src$core$events$utils.MOVE=MOVE$$module$build$src$core$events$utils;module$build$src$core$events$utils.PROCEDURE_CHANGE_RETURN=PROCEDURE_CHANGE_RETURN$$module$build$src$core$events$utils;module$build$src$core$events$utils.PROCEDURE_CREATE=PROCEDURE_CREATE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.PROCEDURE_DELETE=PROCEDURE_DELETE$$module$build$src$core$events$utils;module$build$src$core$events$utils.PROCEDURE_ENABLE=PROCEDURE_ENABLE$$module$build$src$core$events$utils;module$build$src$core$events$utils.PROCEDURE_PARAMETER_CREATE=PROCEDURE_PARAMETER_CREATE$$module$build$src$core$events$utils;module$build$src$core$events$utils.PROCEDURE_PARAMETER_DELETE=PROCEDURE_PARAMETER_DELETE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.PROCEDURE_PARAMETER_RENAME=PROCEDURE_PARAMETER_RENAME$$module$build$src$core$events$utils;module$build$src$core$events$utils.PROCEDURE_RENAME=PROCEDURE_RENAME$$module$build$src$core$events$utils;module$build$src$core$events$utils.SELECTED=SELECTED$$module$build$src$core$events$utils;module$build$src$core$events$utils.TEST_ONLY=TEST_ONLY$$module$build$src$core$events$utils;module$build$src$core$events$utils.THEME_CHANGE=THEME_CHANGE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.TOOLBOX_ITEM_SELECT=TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils;module$build$src$core$events$utils.TRASHCAN_OPEN=TRASHCAN_OPEN$$module$build$src$core$events$utils;module$build$src$core$events$utils.UI=UI$$module$build$src$core$events$utils;module$build$src$core$events$utils.VAR_CREATE=VAR_CREATE$$module$build$src$core$events$utils;module$build$src$core$events$utils.VAR_DELETE=VAR_DELETE$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.VAR_RENAME=VAR_RENAME$$module$build$src$core$events$utils;module$build$src$core$events$utils.VIEWPORT_CHANGE=VIEWPORT_CHANGE$$module$build$src$core$events$utils;module$build$src$core$events$utils.clearPendingUndo=clearPendingUndo$$module$build$src$core$events$utils;module$build$src$core$events$utils.disable=disable$$module$build$src$core$events$utils;module$build$src$core$events$utils.disableOrphans=disableOrphans$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.enable=enable$$module$build$src$core$events$utils;module$build$src$core$events$utils.filter=filter$$module$build$src$core$events$utils;module$build$src$core$events$utils.fire=fire$$module$build$src$core$events$utils;module$build$src$core$events$utils.fromJson=fromJson$$module$build$src$core$events$utils;module$build$src$core$events$utils.get=get$$module$build$src$core$events$utils;module$build$src$core$events$utils.getDescendantIds=getDescendantIds$$module$build$src$core$events$utils;\nmodule$build$src$core$events$utils.getGroup=getGroup$$module$build$src$core$events$utils;module$build$src$core$events$utils.getRecordUndo=getRecordUndo$$module$build$src$core$events$utils;module$build$src$core$events$utils.isEnabled=isEnabled$$module$build$src$core$events$utils;module$build$src$core$events$utils.setGroup=setGroup$$module$build$src$core$events$utils;module$build$src$core$events$utils.setRecordUndo=setRecordUndo$$module$build$src$core$events$utils;var inputTypes$$module$build$src$core$input_types;(function(a){a[a.VALUE=1]=\"VALUE\";a[a.STATEMENT=3]=\"STATEMENT\";a[a.DUMMY=5]=\"DUMMY\"})(inputTypes$$module$build$src$core$input_types||(inputTypes$$module$build$src$core$input_types={}));$.module$build$src$core$input_types={};$.module$build$src$core$input_types.inputTypes=inputTypes$$module$build$src$core$input_types;var NAME_SPACE$$module$build$src$core$utils$xml,xmlDocument$$module$build$src$core$utils$xml;NAME_SPACE$$module$build$src$core$utils$xml=\"https://developers.google.com/blockly/xml\";xmlDocument$$module$build$src$core$utils$xml=globalThis.document;$.module$build$src$core$utils$xml={};$.module$build$src$core$utils$xml.NAME_SPACE=NAME_SPACE$$module$build$src$core$utils$xml;$.module$build$src$core$utils$xml.createElement=createElement$$module$build$src$core$utils$xml;\n$.module$build$src$core$utils$xml.createTextNode=createTextNode$$module$build$src$core$utils$xml;$.module$build$src$core$utils$xml.domToText=domToText$$module$build$src$core$utils$xml;$.module$build$src$core$utils$xml.getDocument=getDocument$$module$build$src$core$utils$xml;$.module$build$src$core$utils$xml.setDocument=setDocument$$module$build$src$core$utils$xml;$.module$build$src$core$utils$xml.textToDomDocument=textToDomDocument$$module$build$src$core$utils$xml;var alertImplementation$$module$build$src$core$dialog=function(a,b){window.alert(a);b&&b()},confirmImplementation$$module$build$src$core$dialog=function(a,b){b(window.confirm(a))},promptImplementation$$module$build$src$core$dialog=function(a,b,c){c(window.prompt(a,b))},TEST_ONLY$$module$build$src$core$dialog={confirmInternal:confirmInternal$$module$build$src$core$dialog},module$build$src$core$dialog={};module$build$src$core$dialog.TEST_ONLY=TEST_ONLY$$module$build$src$core$dialog;\nmodule$build$src$core$dialog.alert=alert$$module$build$src$core$dialog;module$build$src$core$dialog.confirm=confirm$$module$build$src$core$dialog;module$build$src$core$dialog.prompt=prompt$$module$build$src$core$dialog;module$build$src$core$dialog.setAlert=setAlert$$module$build$src$core$dialog;module$build$src$core$dialog.setConfirm=setConfirm$$module$build$src$core$dialog;module$build$src$core$dialog.setPrompt=setPrompt$$module$build$src$core$dialog;var Msg$$module$build$src$core$msg,setLocale$$module$build$src$core$msg;Msg$$module$build$src$core$msg=Object.create(null);setLocale$$module$build$src$core$msg=function(a){Object.keys(a).forEach(function(b){Msg$$module$build$src$core$msg[b]=a[b]})};$.module$build$src$core$msg={};$.module$build$src$core$msg.Msg=Msg$$module$build$src$core$msg;$.module$build$src$core$msg.setLocale=setLocale$$module$build$src$core$msg;var Abstract$$module$build$src$core$events$events_abstract=class{constructor(){this.workspaceId=void 0;this.isUiEvent=!1;this.type=\"\";this.group=getGroup$$module$build$src$core$events$utils();this.recordUndo=getRecordUndo$$module$build$src$core$events$utils()}toJson(){return{type:this.type,group:this.group}}fromJson(a){this.isBlank=!1;this.group=a.group||\"\"}static fromJson(a,b,c){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.Abstract.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");\nc.isBlank=!1;c.group=a.group||\"\";c.workspaceId=b.id;return c}isNull(){return!1}run(a){}getEventWorkspace_(){let a;this.workspaceId&&(a=getWorkspaceById$$module$build$src$core$common(this.workspaceId));if(!a)throw Error(\"Workspace is null. Event must have been generated from real Blockly events.\");return a}},module$build$src$core$events$events_abstract={};module$build$src$core$events$events_abstract.Abstract=Abstract$$module$build$src$core$events$events_abstract;var VarBase$$module$build$src$core$events$events_var_base=class extends Abstract$$module$build$src$core$events$events_abstract{constructor(a){super();this.isBlank=\"undefined\"===typeof a;a&&(this.varId=a.getId(),this.workspaceId=a.workspace.id)}toJson(){const a=super.toJson();if(!this.varId)throw Error(\"The var ID is undefined. Either pass a variable to the constructor, or call fromJson\");a.varId=this.varId;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.VarBase.prototype.fromJson\",\n\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.varId=a.varId}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new VarBase$$module$build$src$core$events$events_var_base);b.varId=a.varId;return b}},module$build$src$core$events$events_var_base={};module$build$src$core$events$events_var_base.VarBase=VarBase$$module$build$src$core$events$events_var_base;var VarCreate$$module$build$src$core$events$events_var_create=class extends VarBase$$module$build$src$core$events$events_var_base{constructor(a){super(a);this.type=VAR_CREATE$$module$build$src$core$events$utils;a&&(this.varType=a.type,this.varName=a.name)}toJson(){const a=super.toJson();if(!this.varType)throw Error(\"The var type is undefined. Either pass a variable to the constructor, or call fromJson\");if(!this.varName)throw Error(\"The var name is undefined. Either pass a variable to the constructor, or call fromJson\");\na.varType=this.varType;a.varName=this.varName;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.VarCreate.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.varType=a.varType;this.varName=a.varName}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new VarCreate$$module$build$src$core$events$events_var_create);b.varType=a.varType;b.varName=a.varName;return b}run(a){const b=this.getEventWorkspace_();if(!this.varId)throw Error(\"The var ID is undefined. Either pass a variable to the constructor, or call fromJson\");\nif(!this.varName)throw Error(\"The var name is undefined. Either pass a variable to the constructor, or call fromJson\");a?b.createVariable(this.varName,this.varType,this.varId):b.deleteVariableById(this.varId)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,VAR_CREATE$$module$build$src$core$events$utils,VarCreate$$module$build$src$core$events$events_var_create);var module$build$src$core$events$events_var_create={};\nmodule$build$src$core$events$events_var_create.VarCreate=VarCreate$$module$build$src$core$events$events_var_create;var VariableModel$$module$build$src$core$variable_model=class{constructor(a,b,c,d){this.workspace=a;this.name=b;this.type=c||\"\";this.id_=d||genUid$$module$build$src$core$utils$idgenerator()}getId(){return this.id_}static compareByName(a,b){return a.name.localeCompare(b.name,void 0,{sensitivity:\"base\"})}},module$build$src$core$variable_model={};module$build$src$core$variable_model.VariableModel=VariableModel$$module$build$src$core$variable_model;var CATEGORY_NAME$$module$build$src$core$variables,VAR_LETTER_OPTIONS$$module$build$src$core$variables,TEST_ONLY$$module$build$src$core$variables;CATEGORY_NAME$$module$build$src$core$variables=\"VARIABLE\";VAR_LETTER_OPTIONS$$module$build$src$core$variables=\"ijkmnopqrstuvwxyzabcdefgh\";TEST_ONLY$$module$build$src$core$variables={generateUniqueNameInternal:generateUniqueNameInternal$$module$build$src$core$variables};$.module$build$src$core$variables={};\n$.module$build$src$core$variables.CATEGORY_NAME=CATEGORY_NAME$$module$build$src$core$variables;$.module$build$src$core$variables.TEST_ONLY=TEST_ONLY$$module$build$src$core$variables;$.module$build$src$core$variables.VAR_LETTER_OPTIONS=VAR_LETTER_OPTIONS$$module$build$src$core$variables;$.module$build$src$core$variables.allDeveloperVariables=allDeveloperVariables$$module$build$src$core$variables;$.module$build$src$core$variables.allUsedVarModels=allUsedVarModels$$module$build$src$core$variables;\n$.module$build$src$core$variables.createVariableButtonHandler=createVariableButtonHandler$$module$build$src$core$variables;$.module$build$src$core$variables.flyoutCategory=flyoutCategory$$module$build$src$core$variables;$.module$build$src$core$variables.flyoutCategoryBlocks=flyoutCategoryBlocks$$module$build$src$core$variables;$.module$build$src$core$variables.generateUniqueName=generateUniqueName$$module$build$src$core$variables;$.module$build$src$core$variables.generateUniqueNameFromOptions=generateUniqueNameFromOptions$$module$build$src$core$variables;\n$.module$build$src$core$variables.generateVariableFieldDom=generateVariableFieldDom$$module$build$src$core$variables;$.module$build$src$core$variables.getAddedVariables=getAddedVariables$$module$build$src$core$variables;$.module$build$src$core$variables.getOrCreateVariablePackage=getOrCreateVariablePackage$$module$build$src$core$variables;$.module$build$src$core$variables.getVariable=getVariable$$module$build$src$core$variables;$.module$build$src$core$variables.nameUsedWithAnyType=nameUsedWithAnyType$$module$build$src$core$variables;\n$.module$build$src$core$variables.promptName=promptName$$module$build$src$core$variables;$.module$build$src$core$variables.renameVariable=renameVariable$$module$build$src$core$variables;var WorkspaceComment$$module$build$src$core$workspace_comment=class{constructor(a,b,c,d,e){this.workspace=a;this.editable_=this.movable_=this.deletable_=!0;this.disposed_=!1;this.isComment=!0;this.id=e&&!a.getCommentById(e)?e:genUid$$module$build$src$core$utils$idgenerator();a.addTopComment(this);this.xy_=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.height_=c;this.width_=d;this.RTL=a.RTL;this.content_=b;WorkspaceComment$$module$build$src$core$workspace_comment.fireCreateEvent(this)}dispose(){this.disposed_||\n(isEnabled$$module$build$src$core$events$utils()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(COMMENT_DELETE$$module$build$src$core$events$utils))(this)),this.workspace.removeTopComment(this),this.disposed_=!0)}getHeight(){return this.height_}setHeight(a){this.height_=a}getWidth(){return this.width_}setWidth(a){this.width_=a}getXY(){return new Coordinate$$module$build$src$core$utils$coordinate(this.xy_.x,this.xy_.y)}moveBy(a,b){const c=new (get$$module$build$src$core$events$utils(COMMENT_MOVE$$module$build$src$core$events$utils))(this);\nthis.xy_.translate(a,b);c.recordNew();fire$$module$build$src$core$events$utils(c)}isDeletable(){return this.deletable_&&!(this.workspace&&this.workspace.options.readOnly)}setDeletable(a){this.deletable_=a}isMovable(){return this.movable_&&!(this.workspace&&this.workspace.options.readOnly)}setMovable(a){this.movable_=a}isEditable(){return this.editable_&&!(this.workspace&&this.workspace.options.readOnly)}setEditable(a){this.editable_=a}getContent(){return this.content_}setContent(a){this.content_!==\na&&(fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(COMMENT_CHANGE$$module$build$src$core$events$utils))(this,this.content_,a)),this.content_=a)}toXmlWithXY(a){a=this.toXml(a);a.setAttribute(\"x\",`${Math.round(this.xy_.x)}`);a.setAttribute(\"y\",`${Math.round(this.xy_.y)}`);a.setAttribute(\"h\",`${this.height_}`);a.setAttribute(\"w\",`${this.width_}`);return a}toXml(a){const b=createElement$$module$build$src$core$utils$xml(\"comment\");a||(b.id=this.id);b.textContent=\nthis.getContent();return b}static fireCreateEvent(a){if(isEnabled$$module$build$src$core$events$utils()){const b=getGroup$$module$build$src$core$events$utils();b||setGroup$$module$build$src$core$events$utils(!0);try{fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(COMMENT_CREATE$$module$build$src$core$events$utils))(a))}finally{b||setGroup$$module$build$src$core$events$utils(!1)}}}static fromXml(a,b){var c=WorkspaceComment$$module$build$src$core$workspace_comment.parseAttributes(a);\nb=new WorkspaceComment$$module$build$src$core$workspace_comment(b,c.content,c.h,c.w,c.id);c=a.getAttribute(\"x\");a=a.getAttribute(\"y\");c=c?parseInt(c,10):NaN;a=a?parseInt(a,10):NaN;isNaN(c)||isNaN(a)||b.moveBy(c,a);WorkspaceComment$$module$build$src$core$workspace_comment.fireCreateEvent(b);return b}static parseAttributes(a){const b=a.getAttribute(\"h\"),c=a.getAttribute(\"w\"),d=a.getAttribute(\"x\"),e=a.getAttribute(\"y\"),f=a.getAttribute(\"id\");if(!f)throw Error(\"No ID present in XML comment definition.\");\nlet g;return{id:f,h:b?parseInt(b):100,w:c?parseInt(c):100,x:d?parseInt(d):NaN,y:e?parseInt(e):NaN,content:null!=(g=a.textContent)?g:\"\"}}},module$build$src$core$workspace_comment={};module$build$src$core$workspace_comment.WorkspaceComment=WorkspaceComment$$module$build$src$core$workspace_comment;var UiBase$$module$build$src$core$events$events_ui_base=class extends Abstract$$module$build$src$core$events$events_abstract{constructor(a){super();this.isBlank=!0;this.recordUndo=!1;this.isUiEvent=!0;this.isBlank=\"undefined\"===typeof a;this.workspaceId=a?a:\"\"}},module$build$src$core$events$events_ui_base={};module$build$src$core$events$events_ui_base.UiBase=UiBase$$module$build$src$core$events$events_ui_base;var Selected$$module$build$src$core$events$events_selected=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c){super(c);this.type=SELECTED$$module$build$src$core$events$utils;this.oldElementId=null!=a?a:void 0;this.newElementId=null!=b?b:void 0}toJson(){const a=super.toJson();a.oldElementId=this.oldElementId;a.newElementId=this.newElementId;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.Selected.prototype.fromJson\",\"version 9\",\"version 10\",\n\"Blockly.Events.fromJson\");super.fromJson(a);this.oldElementId=a.oldElementId;this.newElementId=a.newElementId}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new Selected$$module$build$src$core$events$events_selected);b.oldElementId=a.oldElementId;b.newElementId=a.newElementId;return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,SELECTED$$module$build$src$core$events$utils,Selected$$module$build$src$core$events$events_selected);\nvar module$build$src$core$events$events_selected={};module$build$src$core$events$events_selected.Selected=Selected$$module$build$src$core$events$events_selected;var injected$$module$build$src$core$css=!1,content$$module$build$src$core$css='\\n.blocklySvg {\\n  background-color: #fff;\\n  outline: none;\\n  overflow: hidden;  /* IE overflows by default. */\\n  position: absolute;\\n  display: block;\\n}\\n\\n.blocklyWidgetDiv {\\n  display: none;\\n  position: absolute;\\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\\n}\\n\\n.injectionDiv {\\n  height: 100%;\\n  position: relative;\\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\\n  touch-action: none;\\n}\\n\\n.blocklyNonSelectable {\\n  user-select: none;\\n  -ms-user-select: none;\\n  -webkit-user-select: none;\\n}\\n\\n.blocklyWsDragSurface {\\n  display: none;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n}\\n\\n/* Added as a separate rule with multiple classes to make it more specific\\n   than a bootstrap rule that selects svg:root. See issue #1275 for context.\\n*/\\n.blocklyWsDragSurface.blocklyOverflowVisible {\\n  overflow: visible;\\n}\\n\\n.blocklyBlockDragSurface {\\n  display: none;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  overflow: visible !important;\\n  z-index: 50;  /* Display below toolbox, but above everything else. */\\n}\\n\\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\\n  transition: transform .5s;\\n}\\n\\n.blocklyTooltipDiv {\\n  background-color: #ffffc7;\\n  border: 1px solid #ddc;\\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\\n  color: #000;\\n  display: none;\\n  font: 9pt sans-serif;\\n  opacity: .9;\\n  padding: 2px;\\n  position: absolute;\\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\\n}\\n\\n.blocklyDropDownDiv {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 1000;\\n  display: none;\\n  border: 1px solid;\\n  border-color: #dadce0;\\n  background-color: #fff;\\n  border-radius: 2px;\\n  padding: 4px;\\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\\n}\\n\\n.blocklyDropDownDiv.blocklyFocused {\\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\\n}\\n\\n.blocklyDropDownContent {\\n  max-height: 300px;  /* @todo: spec for maximum height. */\\n  overflow: auto;\\n  overflow-x: hidden;\\n  position: relative;\\n}\\n\\n.blocklyDropDownArrow {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  width: 16px;\\n  height: 16px;\\n  z-index: -1;\\n  background-color: inherit;\\n  border-color: inherit;\\n}\\n\\n.blocklyDropDownButton {\\n  display: inline-block;\\n  float: left;\\n  padding: 0;\\n  margin: 4px;\\n  border-radius: 4px;\\n  outline: none;\\n  border: 1px solid;\\n  transition: box-shadow .1s;\\n  cursor: pointer;\\n}\\n\\n.blocklyArrowTop {\\n  border-top: 1px solid;\\n  border-left: 1px solid;\\n  border-top-left-radius: 4px;\\n  border-color: inherit;\\n}\\n\\n.blocklyArrowBottom {\\n  border-bottom: 1px solid;\\n  border-right: 1px solid;\\n  border-bottom-right-radius: 4px;\\n  border-color: inherit;\\n}\\n\\n.blocklyResizeSE {\\n  cursor: se-resize;\\n  fill: #aaa;\\n}\\n\\n.blocklyResizeSW {\\n  cursor: sw-resize;\\n  fill: #aaa;\\n}\\n\\n.blocklyResizeLine {\\n  stroke: #515A5A;\\n  stroke-width: 1;\\n}\\n\\n.blocklyHighlightedConnectionPath {\\n  fill: none;\\n  stroke: #fc3;\\n  stroke-width: 4px;\\n}\\n\\n.blocklyPathLight {\\n  fill: none;\\n  stroke-linecap: round;\\n  stroke-width: 1;\\n}\\n\\n.blocklySelected>.blocklyPathLight {\\n  display: none;\\n}\\n\\n.blocklyDraggable {\\n  /* backup for browsers (e.g. IE11) that don\\'t support grab */\\n  cursor: url(\"<<<PATH>>>/handopen.cur\"), auto;\\n  cursor: grab;\\n  cursor: -webkit-grab;\\n}\\n\\n  /* backup for browsers (e.g. IE11) that don\\'t support grabbing */\\n.blocklyDragging {\\n  /* backup for browsers (e.g. IE11) that don\\'t support grabbing */\\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\\n  cursor: grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\\n  /* Changes cursor on mouse down. Not effective in Firefox because of\\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\\n.blocklyDraggable:active {\\n  /* backup for browsers (e.g. IE11) that don\\'t support grabbing */\\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\\n  cursor: grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\\n/* Change the cursor on the whole drag surface in case the mouse gets\\n   ahead of block during a drag. This way the cursor is still a closed hand.\\n  */\\n.blocklyBlockDragSurface .blocklyDraggable {\\n  /* backup for browsers (e.g. IE11) that don\\'t support grabbing */\\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\\n  cursor: grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\\n.blocklyDragging.blocklyDraggingDelete {\\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\\n}\\n\\n.blocklyDragging>.blocklyPath,\\n.blocklyDragging>.blocklyPathLight {\\n  fill-opacity: .8;\\n  stroke-opacity: .8;\\n}\\n\\n.blocklyDragging>.blocklyPathDark {\\n  display: none;\\n}\\n\\n.blocklyDisabled>.blocklyPath {\\n  fill-opacity: .5;\\n  stroke-opacity: .5;\\n}\\n\\n.blocklyDisabled>.blocklyPathLight,\\n.blocklyDisabled>.blocklyPathDark {\\n  display: none;\\n}\\n\\n.blocklyInsertionMarker>.blocklyPath,\\n.blocklyInsertionMarker>.blocklyPathLight,\\n.blocklyInsertionMarker>.blocklyPathDark {\\n  fill-opacity: .2;\\n  stroke: none;\\n}\\n\\n.blocklyMultilineText {\\n  font-family: monospace;\\n}\\n\\n.blocklyNonEditableText>text {\\n  pointer-events: none;\\n}\\n\\n.blocklyFlyout {\\n  position: absolute;\\n  z-index: 20;\\n}\\n\\n.blocklyText text {\\n  cursor: default;\\n}\\n\\n/*\\n  Don\\'t allow users to select text.  It gets annoying when trying to\\n  drag a block and selected text moves instead.\\n*/\\n.blocklySvg text,\\n.blocklyBlockDragSurface text {\\n  user-select: none;\\n  -ms-user-select: none;\\n  -webkit-user-select: none;\\n  cursor: inherit;\\n}\\n\\n.blocklyHidden {\\n  display: none;\\n}\\n\\n.blocklyFieldDropdown:not(.blocklyHidden) {\\n  display: block;\\n}\\n\\n.blocklyIconGroup {\\n  cursor: default;\\n}\\n\\n.blocklyIconGroup:not(:hover),\\n.blocklyIconGroupReadonly {\\n  opacity: .6;\\n}\\n\\n.blocklyIconShape {\\n  fill: #00f;\\n  stroke: #fff;\\n  stroke-width: 1px;\\n}\\n\\n.blocklyIconSymbol {\\n  fill: #fff;\\n}\\n\\n.blocklyMinimalBody {\\n  margin: 0;\\n  padding: 0;\\n}\\n\\n.blocklyHtmlInput {\\n  border: none;\\n  border-radius: 4px;\\n  height: 100%;\\n  margin: 0;\\n  outline: none;\\n  padding: 0;\\n  width: 100%;\\n  text-align: center;\\n  display: block;\\n  box-sizing: border-box;\\n}\\n\\n/* Edge and IE introduce a close icon when the input value is longer than a\\n   certain length. This affects our sizing calculations of the text input.\\n   Hiding the close icon to avoid that. */\\n.blocklyHtmlInput::-ms-clear {\\n  display: none;\\n}\\n\\n.blocklyMainBackground {\\n  stroke-width: 1;\\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\\n}\\n\\n.blocklyMutatorBackground {\\n  fill: #fff;\\n  stroke: #ddd;\\n  stroke-width: 1;\\n}\\n\\n.blocklyFlyoutBackground {\\n  fill: #ddd;\\n  fill-opacity: .8;\\n}\\n\\n.blocklyMainWorkspaceScrollbar {\\n  z-index: 20;\\n}\\n\\n.blocklyFlyoutScrollbar {\\n  z-index: 30;\\n}\\n\\n.blocklyScrollbarHorizontal,\\n.blocklyScrollbarVertical {\\n  position: absolute;\\n  outline: none;\\n}\\n\\n.blocklyScrollbarBackground {\\n  opacity: 0;\\n}\\n\\n.blocklyScrollbarHandle {\\n  fill: #ccc;\\n}\\n\\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\\n.blocklyScrollbarHandle:hover {\\n  fill: #bbb;\\n}\\n\\n/* Darken flyout scrollbars due to being on a grey background. */\\n/* By contrast, workspace scrollbars are on a white background. */\\n.blocklyFlyout .blocklyScrollbarHandle {\\n  fill: #bbb;\\n}\\n\\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\\n.blocklyFlyout .blocklyScrollbarHandle:hover {\\n  fill: #aaa;\\n}\\n\\n.blocklyInvalidInput {\\n  background: #faa;\\n}\\n\\n.blocklyVerticalMarker {\\n  stroke-width: 3px;\\n  fill: rgba(255,255,255,.5);\\n  pointer-events: none;\\n}\\n\\n.blocklyComputeCanvas {\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n}\\n\\n.blocklyNoPointerEvents {\\n  pointer-events: none;\\n}\\n\\n.blocklyContextMenu {\\n  border-radius: 4px;\\n  max-height: 100%;\\n}\\n\\n.blocklyDropdownMenu {\\n  border-radius: 2px;\\n  padding: 0 !important;\\n}\\n\\n.blocklyDropdownMenu .blocklyMenuItem {\\n  /* 28px on the left for icon or checkbox. */\\n  padding-left: 28px;\\n}\\n\\n/* BiDi override for the resting state. */\\n.blocklyDropdownMenu .blocklyMenuItemRtl {\\n  /* Flip left/right padding for BiDi. */\\n  padding-left: 5px;\\n  padding-right: 28px;\\n}\\n\\n.blocklyWidgetDiv .blocklyMenu {\\n  background: #fff;\\n  border: 1px solid transparent;\\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\\n  font: normal 13px Arial, sans-serif;\\n  margin: 0;\\n  outline: none;\\n  padding: 4px 0;\\n  position: absolute;\\n  overflow-y: auto;\\n  overflow-x: hidden;\\n  max-height: 100%;\\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\\n}\\n\\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\\n}\\n\\n.blocklyDropDownDiv .blocklyMenu {\\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\\n  outline: none;\\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\\n}\\n\\n/* State: resting. */\\n.blocklyMenuItem {\\n  border: none;\\n  color: #000;\\n  cursor: pointer;\\n  list-style: none;\\n  margin: 0;\\n  /* 7em on the right for shortcut. */\\n  min-width: 7em;\\n  padding: 6px 15px;\\n  white-space: nowrap;\\n}\\n\\n/* State: disabled. */\\n.blocklyMenuItemDisabled {\\n  color: #ccc;\\n  cursor: inherit;\\n}\\n\\n/* State: hover. */\\n.blocklyMenuItemHighlight {\\n  background-color: rgba(0,0,0,.1);\\n}\\n\\n/* State: selected/checked. */\\n.blocklyMenuItemCheckbox {\\n  height: 16px;\\n  position: absolute;\\n  width: 16px;\\n}\\n\\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\\n  float: left;\\n  margin-left: -24px;\\n  position: static;  /* Scroll with the menu. */\\n}\\n\\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\\n  float: right;\\n  margin-right: -24px;\\n}\\n',\nmodule$build$src$core$css={};module$build$src$core$css.inject=inject$$module$build$src$core$css;module$build$src$core$css.register=register$$module$build$src$core$css;var Svg$$module$build$src$core$utils$svg=class{constructor(a){this.tagName=a}toString(){return this.tagName}};Svg$$module$build$src$core$utils$svg.ANIMATE=new Svg$$module$build$src$core$utils$svg(\"animate\");Svg$$module$build$src$core$utils$svg.CIRCLE=new Svg$$module$build$src$core$utils$svg(\"circle\");Svg$$module$build$src$core$utils$svg.CLIPPATH=new Svg$$module$build$src$core$utils$svg(\"clipPath\");Svg$$module$build$src$core$utils$svg.DEFS=new Svg$$module$build$src$core$utils$svg(\"defs\");\nSvg$$module$build$src$core$utils$svg.FECOMPOSITE=new Svg$$module$build$src$core$utils$svg(\"feComposite\");Svg$$module$build$src$core$utils$svg.FECOMPONENTTRANSFER=new Svg$$module$build$src$core$utils$svg(\"feComponentTransfer\");Svg$$module$build$src$core$utils$svg.FEFLOOD=new Svg$$module$build$src$core$utils$svg(\"feFlood\");Svg$$module$build$src$core$utils$svg.FEFUNCA=new Svg$$module$build$src$core$utils$svg(\"feFuncA\");Svg$$module$build$src$core$utils$svg.FEGAUSSIANBLUR=new Svg$$module$build$src$core$utils$svg(\"feGaussianBlur\");\nSvg$$module$build$src$core$utils$svg.FEPOINTLIGHT=new Svg$$module$build$src$core$utils$svg(\"fePointLight\");Svg$$module$build$src$core$utils$svg.FESPECULARLIGHTING=new Svg$$module$build$src$core$utils$svg(\"feSpecularLighting\");Svg$$module$build$src$core$utils$svg.FILTER=new Svg$$module$build$src$core$utils$svg(\"filter\");Svg$$module$build$src$core$utils$svg.FOREIGNOBJECT=new Svg$$module$build$src$core$utils$svg(\"foreignObject\");Svg$$module$build$src$core$utils$svg.G=new Svg$$module$build$src$core$utils$svg(\"g\");\nSvg$$module$build$src$core$utils$svg.IMAGE=new Svg$$module$build$src$core$utils$svg(\"image\");Svg$$module$build$src$core$utils$svg.LINE=new Svg$$module$build$src$core$utils$svg(\"line\");Svg$$module$build$src$core$utils$svg.PATH=new Svg$$module$build$src$core$utils$svg(\"path\");Svg$$module$build$src$core$utils$svg.PATTERN=new Svg$$module$build$src$core$utils$svg(\"pattern\");Svg$$module$build$src$core$utils$svg.POLYGON=new Svg$$module$build$src$core$utils$svg(\"polygon\");\nSvg$$module$build$src$core$utils$svg.RECT=new Svg$$module$build$src$core$utils$svg(\"rect\");Svg$$module$build$src$core$utils$svg.SVG=new Svg$$module$build$src$core$utils$svg(\"svg\");Svg$$module$build$src$core$utils$svg.TEXT=new Svg$$module$build$src$core$utils$svg(\"text\");Svg$$module$build$src$core$utils$svg.TSPAN=new Svg$$module$build$src$core$utils$svg(\"tspan\");var module$build$src$core$utils$svg={};module$build$src$core$utils$svg.Svg=Svg$$module$build$src$core$utils$svg;var XY_REGEX$$module$build$src$core$utils$svg_math=/translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/,XY_STYLE_REGEX$$module$build$src$core$utils$svg_math=/transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/,TEST_ONLY$$module$build$src$core$utils$svg_math={XY_REGEX:XY_REGEX$$module$build$src$core$utils$svg_math,XY_STYLE_REGEX:XY_STYLE_REGEX$$module$build$src$core$utils$svg_math},module$build$src$core$utils$svg_math={};module$build$src$core$utils$svg_math.TEST_ONLY=TEST_ONLY$$module$build$src$core$utils$svg_math;\nmodule$build$src$core$utils$svg_math.getDocumentScroll=getDocumentScroll$$module$build$src$core$utils$svg_math;module$build$src$core$utils$svg_math.getInjectionDivXY=getInjectionDivXY$$module$build$src$core$utils$svg_math;module$build$src$core$utils$svg_math.getRelativeXY=getRelativeXY$$module$build$src$core$utils$svg_math;module$build$src$core$utils$svg_math.getViewportBBox=getViewportBBox$$module$build$src$core$utils$svg_math;module$build$src$core$utils$svg_math.is3dSupported=is3dSupported$$module$build$src$core$utils$svg_math;\nmodule$build$src$core$utils$svg_math.screenToWsCoordinates=screenToWsCoordinates$$module$build$src$core$utils$svg_math;var RESIZE_SIZE$$module$build$src$core$workspace_comment_svg=8,BORDER_RADIUS$$module$build$src$core$workspace_comment_svg=3,TEXTAREA_OFFSET$$module$build$src$core$workspace_comment_svg=2,WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg=class extends WorkspaceComment$$module$build$src$core$workspace_comment{constructor(a,b,c,d,e){super(a,b,c,d,e);this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null;this.eventsInit_=!1;this.deleteIconBorder_=this.deleteGroup_=this.resizeGroup_=this.foreignObject_=\nthis.svgHandleTarget_=this.svgRectTarget_=this.textarea_=null;this.rendered_=this.autoLayout_=this.focused_=!1;this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyComment\"});this.svgGroup_.translate_=\"\";this.workspace=a;this.svgRect_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyCommentRect\",x:0,y:0,rx:BORDER_RADIUS$$module$build$src$core$workspace_comment_svg,ry:BORDER_RADIUS$$module$build$src$core$workspace_comment_svg});\nthis.svgGroup_.appendChild(this.svgRect_);this.useDragSurface_=!!a.getBlockDragSurface();this.render()}dispose(){this.disposed_||(getSelected$$module$build$src$core$common()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),isEnabled$$module$build$src$core$events$utils()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(COMMENT_DELETE$$module$build$src$core$events$utils))(this)),removeNode$$module$build$src$core$utils$dom(this.svgGroup_),this.disposeInternal_(),\ndisable$$module$build$src$core$events$utils(),super.dispose(),enable$$module$build$src$core$events$utils())}initSvg(a){if(!this.workspace.rendered)throw TypeError(\"Workspace is headless.\");this.workspace.options.readOnly||this.eventsInit_||(conditionalBind$$module$build$src$core$browser_events(this.svgRectTarget_,\"pointerdown\",this,this.pathMouseDown_),conditionalBind$$module$build$src$core$browser_events(this.svgHandleTarget_,\"pointerdown\",this,this.pathMouseDown_));this.eventsInit_=!0;this.updateMovable();\nthis.getSvgRoot().parentNode||this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot());!a&&this.textarea_&&this.textarea_.select()}pathMouseDown_(a){const b=this.workspace.getGesture(a);b&&b.handleBubbleStart(a,this)}showContextMenu(a){throw Error(\"The implementation of showContextMenu should be monkey-patched in by blockly.ts\");}select(){if(getSelected$$module$build$src$core$common()!==this){var a=null;if(getSelected$$module$build$src$core$common()){a=getSelected$$module$build$src$core$common().id;\ndisable$$module$build$src$core$events$utils();try{getSelected$$module$build$src$core$common().unselect()}finally{enable$$module$build$src$core$events$utils()}}a=new (get$$module$build$src$core$events$utils(SELECTED$$module$build$src$core$events$utils))(a,this.id,this.workspace.id);fire$$module$build$src$core$events$utils(a);setSelected$$module$build$src$core$common(this);this.addSelect()}}unselect(){if(getSelected$$module$build$src$core$common()===this){var a=new (get$$module$build$src$core$events$utils(SELECTED$$module$build$src$core$events$utils))(this.id,\nnull,this.workspace.id);fire$$module$build$src$core$events$utils(a);setSelected$$module$build$src$core$common(null);this.removeSelect();this.blurFocus()}}addSelect(){addClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklySelected\");this.setFocus()}removeSelect(){addClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklySelected\");this.blurFocus()}addFocus(){addClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyFocused\")}removeFocus(){removeClass$$module$build$src$core$utils$dom(this.svgGroup_,\n\"blocklyFocused\")}getRelativeToSurfaceXY(){let a=0,b=0;const c=this.useDragSurface_?this.workspace.getBlockDragSurface().getGroup():null;let d=this.getSvgRoot();if(d){do{var e=getRelativeXY$$module$build$src$core$utils$svg_math(d);a+=e.x;b+=e.y;this.useDragSurface_&&this.workspace.getBlockDragSurface().getCurrentBlock()===d&&(e=this.workspace.getBlockDragSurface().getSurfaceTranslation(),a+=e.x,b+=e.y);d=d.parentNode}while(d&&d!==this.workspace.getBubbleCanvas()&&d!==c)}return this.xy_=new Coordinate$$module$build$src$core$utils$coordinate(a,\nb)}moveBy(a,b){const c=new (get$$module$build$src$core$events$utils(COMMENT_MOVE$$module$build$src$core$events$utils))(this),d=this.getRelativeToSurfaceXY();this.translate(d.x+a,d.y+b);this.xy_=new Coordinate$$module$build$src$core$utils$coordinate(d.x+a,d.y+b);c.recordNew();fire$$module$build$src$core$events$utils(c);this.workspace.resizeContents()}translate(a,b){this.xy_=new Coordinate$$module$build$src$core$utils$coordinate(a,b);this.getSvgRoot().setAttribute(\"transform\",\"translate(\"+a+\",\"+b+\")\")}moveToDragSurface(){if(this.useDragSurface_){var a=\nthis.getRelativeToSurfaceXY();this.clearTransformAttributes_();this.workspace.getBlockDragSurface().translateSurface(a.x,a.y);this.workspace.getBlockDragSurface().setBlocksAndShow(this.getSvgRoot())}}moveDuringDrag(a,b){a?a.translateSurface(b.x,b.y):(this.svgGroup_.translate_=\"translate(\"+b.x+\",\"+b.y+\")\",this.svgGroup_.setAttribute(\"transform\",this.svgGroup_.translate_+this.svgGroup_.skew_))}moveTo(a,b){this.translate(a,b)}clearTransformAttributes_(){this.getSvgRoot().removeAttribute(\"transform\")}getBoundingRectangle(){var a=\nthis.getRelativeToSurfaceXY();const b=this.getHeightWidth(),c=a.y,d=a.y+b.height;let e;this.RTL?(e=a.x-b.width,a=a.x):(e=a.x,a=a.x+b.width);return new Rect$$module$build$src$core$utils$rect(c,d,e,a)}updateMovable(){this.isMovable()?addClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDraggable\"):removeClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDraggable\")}setMovable(a){super.setMovable(a);this.updateMovable()}setEditable(a){super.setEditable(a);this.textarea_&&(this.textarea_.readOnly=\n!a)}setDragging(a){a?(a=this.getSvgRoot(),a.translate_=\"\",a.skew_=\"\",addClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDragging\")):removeClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDragging\")}getSvgRoot(){return this.svgGroup_}getContent(){return this.textarea_?this.textarea_.value:this.content_}setContent(a){super.setContent(a);this.textarea_&&(this.textarea_.value=a)}setDeleteStyle(a){a?addClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDraggingDelete\"):\nremoveClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDraggingDelete\")}setAutoLayout(a){}toXmlWithXY(a){let b=0;this.workspace.RTL&&(b=this.workspace.getWidth());a=this.toXml(a);const c=this.getRelativeToSurfaceXY();a.setAttribute(\"x\",Math.round(this.workspace.RTL?b-c.x:c.x));a.setAttribute(\"y\",Math.round(c.y));a.setAttribute(\"h\",this.getHeight());a.setAttribute(\"w\",this.getWidth());return a}toCopyData(){return{saveInfo:this.toXmlWithXY(),source:this.workspace,typeCounts:null}}getHeightWidth(){return{width:this.getWidth(),\nheight:this.getHeight()}}render(){if(!this.rendered_){var a=this.getHeightWidth();this.createEditor_();this.svgGroup_.appendChild(this.foreignObject_);this.svgHandleTarget_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyCommentHandleTarget\",x:0,y:0});this.svgGroup_.appendChild(this.svgHandleTarget_);this.svgRectTarget_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyCommentTarget\",\nx:0,y:0,rx:BORDER_RADIUS$$module$build$src$core$workspace_comment_svg,ry:BORDER_RADIUS$$module$build$src$core$workspace_comment_svg});this.svgGroup_.appendChild(this.svgRectTarget_);this.addResizeDom_();this.isDeletable()&&this.addDeleteDom_();this.setSize_(a.width,a.height);this.textarea_.value=this.content_;this.rendered_=!0;this.resizeGroup_&&conditionalBind$$module$build$src$core$browser_events(this.resizeGroup_,\"pointerdown\",this,this.resizeMouseDown_);this.isDeletable()&&(conditionalBind$$module$build$src$core$browser_events(this.deleteGroup_,\n\"pointerdown\",this,this.deleteMouseDown_),conditionalBind$$module$build$src$core$browser_events(this.deleteGroup_,\"pointerout\",this,this.deleteMouseOut_),conditionalBind$$module$build$src$core$browser_events(this.deleteGroup_,\"pointerup\",this,this.deleteMouseUp_))}}createEditor_(){this.foreignObject_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FOREIGNOBJECT,{x:0,y:WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.TOP_OFFSET,\"class\":\"blocklyCommentForeignObject\"});\nconst a=document.createElementNS(HTML_NS$$module$build$src$core$utils$dom,\"body\");a.setAttribute(\"xmlns\",HTML_NS$$module$build$src$core$utils$dom);a.className=\"blocklyMinimalBody\";const b=document.createElementNS(HTML_NS$$module$build$src$core$utils$dom,\"textarea\");b.className=\"blocklyCommentTextarea\";b.setAttribute(\"dir\",this.RTL?\"RTL\":\"LTR\");b.readOnly=!this.isEditable();a.appendChild(b);this.textarea_=b;this.foreignObject_.appendChild(a);conditionalBind$$module$build$src$core$browser_events(b,\n\"wheel\",this,function(c){c.stopPropagation()});conditionalBind$$module$build$src$core$browser_events(b,\"change\",this,function(c){this.setContent(b.value)});return this.foreignObject_}addResizeDom_(){this.resizeGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":this.RTL?\"blocklyResizeSW\":\"blocklyResizeSE\"},this.svgGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.POLYGON,{points:\"0,x x,x x,0\".replace(/x/g,\nRESIZE_SIZE$$module$build$src$core$workspace_comment_svg.toString())},this.resizeGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{\"class\":\"blocklyResizeLine\",x1:RESIZE_SIZE$$module$build$src$core$workspace_comment_svg/3,y1:RESIZE_SIZE$$module$build$src$core$workspace_comment_svg-1,x2:RESIZE_SIZE$$module$build$src$core$workspace_comment_svg-1,y2:RESIZE_SIZE$$module$build$src$core$workspace_comment_svg/3},this.resizeGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,\n{\"class\":\"blocklyResizeLine\",x1:2*RESIZE_SIZE$$module$build$src$core$workspace_comment_svg/3,y1:RESIZE_SIZE$$module$build$src$core$workspace_comment_svg-1,x2:RESIZE_SIZE$$module$build$src$core$workspace_comment_svg-1,y2:2*RESIZE_SIZE$$module$build$src$core$workspace_comment_svg/3},this.resizeGroup_)}addDeleteDom_(){this.deleteGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyCommentDeleteIcon\"},this.svgGroup_);this.deleteIconBorder_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,\n{\"class\":\"blocklyDeleteIconShape\",r:\"7\",cx:\"7.5\",cy:\"7.5\"},this.deleteGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{x1:\"5\",y1:\"10\",x2:\"10\",y2:\"5\",stroke:\"#fff\",\"stroke-width\":\"2\"},this.deleteGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{x1:\"5\",y1:\"5\",x2:\"10\",y2:\"10\",stroke:\"#fff\",\"stroke-width\":\"2\"},this.deleteGroup_)}resizeMouseDown_(a){this.unbindDragEvents_();isRightButton$$module$build$src$core$browser_events(a)||\n(this.workspace.startDrag(a,new Coordinate$$module$build$src$core$utils$coordinate(this.workspace.RTL?-this.width_:this.width_,this.height_)),this.onMouseUpWrapper_=conditionalBind$$module$build$src$core$browser_events(document,\"pointerup\",this,this.resizeMouseUp_),this.onMouseMoveWrapper_=conditionalBind$$module$build$src$core$browser_events(document,\"pointermove\",this,this.resizeMouseMove_),this.workspace.hideChaff());a.stopPropagation()}deleteMouseDown_(a){this.deleteIconBorder_&&addClass$$module$build$src$core$utils$dom(this.deleteIconBorder_,\n\"blocklyDeleteIconHighlighted\");a.stopPropagation()}deleteMouseOut_(a){this.deleteIconBorder_&&removeClass$$module$build$src$core$utils$dom(this.deleteIconBorder_,\"blocklyDeleteIconHighlighted\")}deleteMouseUp_(a){this.dispose();a.stopPropagation()}unbindDragEvents_(){this.onMouseUpWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null);this.onMouseMoveWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=\nnull)}resizeMouseUp_(a){clearTouchIdentifier$$module$build$src$core$touch();this.unbindDragEvents_()}resizeMouseMove_(a){this.autoLayout_=!1;a=this.workspace.moveDrag(a);this.setSize_(this.RTL?-a.x:a.x,a.y)}resizeComment_(){const a=this.getHeightWidth(),b=WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.TOP_OFFSET,c=2*TEXTAREA_OFFSET$$module$build$src$core$workspace_comment_svg;this.foreignObject_.setAttribute(\"width\",a.width);this.foreignObject_.setAttribute(\"height\",(a.height-b).toString());\nthis.RTL&&this.foreignObject_.setAttribute(\"x\",(-a.width).toString());this.textarea_.style.width=a.width-c+\"px\";this.textarea_.style.height=a.height-c-b+\"px\"}setSize_(a,b){a=Math.max(a,45);b=Math.max(b,20+WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.TOP_OFFSET);this.width_=a;this.height_=b;this.svgRect_.setAttribute(\"width\",a);this.svgRect_.setAttribute(\"height\",b);this.svgRectTarget_.setAttribute(\"width\",a);this.svgRectTarget_.setAttribute(\"height\",b);this.svgHandleTarget_.setAttribute(\"width\",\na);this.svgHandleTarget_.setAttribute(\"height\",WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.TOP_OFFSET);this.RTL&&(this.svgRect_.setAttribute(\"transform\",\"scale(-1 1)\"),this.svgRectTarget_.setAttribute(\"transform\",\"scale(-1 1)\"));this.resizeGroup_&&(this.RTL?(this.resizeGroup_.setAttribute(\"transform\",\"translate(\"+(-a+RESIZE_SIZE$$module$build$src$core$workspace_comment_svg)+\",\"+(b-RESIZE_SIZE$$module$build$src$core$workspace_comment_svg)+\") scale(-1 1)\"),this.deleteGroup_.setAttribute(\"transform\",\n\"translate(\"+(-a+RESIZE_SIZE$$module$build$src$core$workspace_comment_svg)+\",\"+-RESIZE_SIZE$$module$build$src$core$workspace_comment_svg+\") scale(-1 1)\")):(this.resizeGroup_.setAttribute(\"transform\",\"translate(\"+(a-RESIZE_SIZE$$module$build$src$core$workspace_comment_svg)+\",\"+(b-RESIZE_SIZE$$module$build$src$core$workspace_comment_svg)+\")\"),this.deleteGroup_.setAttribute(\"transform\",\"translate(\"+(a-RESIZE_SIZE$$module$build$src$core$workspace_comment_svg)+\",\"+-RESIZE_SIZE$$module$build$src$core$workspace_comment_svg+\n\")\")));this.resizeComment_()}disposeInternal_(){this.svgHandleTarget_=this.svgRectTarget_=this.foreignObject_=this.textarea_=null;this.disposed_=!0}setFocus(){this.focused_=!0;setTimeout(()=>{this.disposed_||(this.textarea_.focus(),this.addFocus(),this.svgRectTarget_&&addClass$$module$build$src$core$utils$dom(this.svgRectTarget_,\"blocklyCommentTargetFocused\"),this.svgHandleTarget_&&addClass$$module$build$src$core$utils$dom(this.svgHandleTarget_,\"blocklyCommentHandleTargetFocused\"))},0)}blurFocus(){this.focused_=\n!1;setTimeout(()=>{this.disposed_||(this.textarea_.blur(),this.removeFocus(),this.svgRectTarget_&&removeClass$$module$build$src$core$utils$dom(this.svgRectTarget_,\"blocklyCommentTargetFocused\"),this.svgHandleTarget_&&removeClass$$module$build$src$core$utils$dom(this.svgHandleTarget_,\"blocklyCommentHandleTargetFocused\"))},0)}static fromXmlRendered(a,b,c){disable$$module$build$src$core$events$utils();let d;try{const e=WorkspaceComment$$module$build$src$core$workspace_comment.parseAttributes(a);d=new WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg(b,\ne.content,e.h,e.w,e.id);b.rendered&&(d.initSvg(!0),d.render());if(!isNaN(e.x)&&!isNaN(e.y))if(b.RTL){const f=c||b.getWidth();d.moveBy(f-e.x,e.y)}else d.moveBy(e.x,e.y)}finally{enable$$module$build$src$core$events$utils()}WorkspaceComment$$module$build$src$core$workspace_comment.fireCreateEvent(d);return d}};WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.DEFAULT_SIZE=100;WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.TOP_OFFSET=10;register$$module$build$src$core$css(\"\\n.blocklyCommentForeignObject {\\n  position: relative;\\n  z-index: 0;\\n}\\n\\n.blocklyCommentRect {\\n  fill: #E7DE8E;\\n  stroke: #bcA903;\\n  stroke-width: 1px;\\n}\\n\\n.blocklyCommentTarget {\\n  fill: transparent;\\n  stroke: #bcA903;\\n}\\n\\n.blocklyCommentTargetFocused {\\n  fill: none;\\n}\\n\\n.blocklyCommentHandleTarget {\\n  fill: none;\\n}\\n\\n.blocklyCommentHandleTargetFocused {\\n  fill: transparent;\\n}\\n\\n.blocklyFocused>.blocklyCommentRect {\\n  fill: #B9B272;\\n  stroke: #B9B272;\\n}\\n\\n.blocklySelected>.blocklyCommentTarget {\\n  stroke: #fc3;\\n  stroke-width: 3px;\\n}\\n\\n.blocklyCommentDeleteIcon {\\n  cursor: pointer;\\n  fill: #000;\\n  display: none;\\n}\\n\\n.blocklySelected > .blocklyCommentDeleteIcon {\\n  display: block;\\n}\\n\\n.blocklyDeleteIconShape {\\n  fill: #000;\\n  stroke: #000;\\n  stroke-width: 1px;\\n}\\n\\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\\n  stroke: #fc3;\\n}\\n\");\nvar module$build$src$core$workspace_comment_svg={};module$build$src$core$workspace_comment_svg.WorkspaceCommentSvg=WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg;$.module$build$src$core$xml={};$.module$build$src$core$xml.appendDomToWorkspace=appendDomToWorkspace$$module$build$src$core$xml;$.module$build$src$core$xml.blockToDom=blockToDom$$module$build$src$core$xml;$.module$build$src$core$xml.blockToDomWithXY=blockToDomWithXY$$module$build$src$core$xml;$.module$build$src$core$xml.clearWorkspaceAndLoadFromXml=clearWorkspaceAndLoadFromXml$$module$build$src$core$xml;$.module$build$src$core$xml.deleteNext=deleteNext$$module$build$src$core$xml;\n$.module$build$src$core$xml.domToBlock=domToBlock$$module$build$src$core$xml;$.module$build$src$core$xml.domToPrettyText=domToPrettyText$$module$build$src$core$xml;$.module$build$src$core$xml.domToText=domToText$$module$build$src$core$xml;$.module$build$src$core$xml.domToVariables=domToVariables$$module$build$src$core$xml;$.module$build$src$core$xml.domToWorkspace=domToWorkspace$$module$build$src$core$xml;$.module$build$src$core$xml.textToDom=textToDom$$module$build$src$core$xml;\n$.module$build$src$core$xml.variablesToDom=variablesToDom$$module$build$src$core$xml;$.module$build$src$core$xml.workspaceToDom=workspaceToDom$$module$build$src$core$xml;var BlockBase$$module$build$src$core$events$events_block_base=class extends Abstract$$module$build$src$core$events$events_abstract{constructor(a){super();this.isBlank=!a;a&&(this.blockId=a.id,this.workspaceId=a.workspace.id)}toJson(){const a=super.toJson();if(!this.blockId)throw Error(\"The block ID is undefined. Either pass a block to the constructor, or call fromJson\");a.blockId=this.blockId;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BlockBase.prototype.fromJson\",\n\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.blockId=a.blockId}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BlockBase$$module$build$src$core$events$events_block_base);b.blockId=a.blockId;return b}},module$build$src$core$events$events_block_base={};module$build$src$core$events$events_block_base.BlockBase=BlockBase$$module$build$src$core$events$events_block_base;var BlockChange$$module$build$src$core$events$events_block_change=class extends BlockBase$$module$build$src$core$events$events_block_base{constructor(a,b,c,d,e){super(a);this.type=CHANGE$$module$build$src$core$events$utils;a&&(this.element=b,this.name=c||void 0,this.oldValue=d,this.newValue=e)}toJson(){const a=super.toJson();if(!this.element)throw Error(\"The changed element is undefined. Either pass an element to the constructor, or call fromJson\");a.element=this.element;a.name=this.name;a.oldValue=\nthis.oldValue;a.newValue=this.newValue;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BlockChange.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.element=a.element;this.name=a.name;this.oldValue=a.oldValue;this.newValue=a.newValue}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BlockChange$$module$build$src$core$events$events_block_change);b.element=a.element;b.name=a.name;b.oldValue=a.oldValue;b.newValue=\na.newValue;return b}isNull(){return this.oldValue===this.newValue}run(a){var b=this.getEventWorkspace_();if(!this.blockId)throw Error(\"The block ID is undefined. Either pass a block to the constructor, or call fromJson\");b=b.getBlockById(this.blockId);if(!b)throw Error(\"The associated block is undefined. Either pass a block to the constructor, or call fromJson\");b.mutator&&b.mutator.setVisible(!1);a=a?this.newValue:this.oldValue;switch(this.element){case \"field\":(b=b.getField(this.name))?b.setValue(a):\nconsole.warn(\"Can't set non-existent field: \"+this.name);break;case \"comment\":b.setCommentText(a||null);break;case \"collapsed\":b.setCollapsed(!!a);break;case \"disabled\":b.setEnabled(!a);break;case \"inline\":b.setInputsInline(!!a);break;case \"mutation\":const c=BlockChange$$module$build$src$core$events$events_block_change.getExtraBlockState_(b);b.loadExtraState?b.loadExtraState(JSON.parse(a||\"{}\")):b.domToMutation&&b.domToMutation(textToDom$$module$build$src$core$xml(a||\"<mutation/>\"));fire$$module$build$src$core$events$utils(new BlockChange$$module$build$src$core$events$events_block_change(b,\n\"mutation\",null,c,a));break;default:console.warn(\"Unknown change type: \"+this.element)}}static getExtraBlockState_(a){return a.saveExtraState?(a=a.saveExtraState())?JSON.stringify(a):\"\":a.mutationToDom?(a=a.mutationToDom())?domToText$$module$build$src$core$xml(a):\"\":\"\"}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,CHANGE$$module$build$src$core$events$utils,BlockChange$$module$build$src$core$events$events_block_change);\nvar module$build$src$core$events$events_block_change={};module$build$src$core$events$events_block_change.BlockChange=BlockChange$$module$build$src$core$events$events_block_change;var MarkerManager$$module$build$src$core$marker_manager=class{constructor(a){this.workspace=a;this.cursorSvg_=this.cursor_=null;this.markers=new Map;this.markerSvg_=null}registerMarker(a,b){this.markers.has(a)&&this.unregisterMarker(a);b.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,b));this.setMarkerSvg(b.getDrawer().createDom());this.markers.set(a,b)}unregisterMarker(a){const b=this.markers.get(a);if(b)b.dispose(),this.markers.delete(a);else throw Error(\"Marker with ID \"+\na+\" does not exist. Can only unregister markers that exist.\");}getCursor(){return this.cursor_}getMarker(a){return this.markers.get(a)||null}setCursor(a){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose();if(this.cursor_=a)a=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor_),this.cursor_.setDrawer(a),this.setCursorSvg(this.cursor_.getDrawer().createDom())}setCursorSvg(a){a?(this.workspace.getBlockCanvas().appendChild(a),this.cursorSvg_=a):this.cursorSvg_=\nnull}setMarkerSvg(a){a?this.workspace.getBlockCanvas()&&(this.cursorSvg_?this.workspace.getBlockCanvas().insertBefore(a,this.cursorSvg_):this.workspace.getBlockCanvas().appendChild(a)):this.markerSvg_=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace.getCursor().draw()}dispose(){const a=Object.keys(this.markers);for(let b=0,c;c=a[b];b++)this.unregisterMarker(c);this.markers.clear();this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)}};\nMarkerManager$$module$build$src$core$marker_manager.LOCAL_MARKER=\"local_marker_1\";var module$build$src$core$marker_manager={};module$build$src$core$marker_manager.MarkerManager=MarkerManager$$module$build$src$core$marker_manager;$.module$build$src$core$utils$string={};$.module$build$src$core$utils$string.commonWordPrefix=commonWordPrefix$$module$build$src$core$utils$string;$.module$build$src$core$utils$string.commonWordSuffix=commonWordSuffix$$module$build$src$core$utils$string;$.module$build$src$core$utils$string.isNumber=isNumber$$module$build$src$core$utils$string;$.module$build$src$core$utils$string.shortestStringLength=shortestStringLength$$module$build$src$core$utils$string;\n$.module$build$src$core$utils$string.startsWith=startsWith$$module$build$src$core$utils$string;$.module$build$src$core$utils$string.wrap=wrap$$module$build$src$core$utils$string;var customTooltip$$module$build$src$core$tooltip=void 0,visible$$module$build$src$core$tooltip=!1,blocked$$module$build$src$core$tooltip=!1,LIMIT$$module$build$src$core$tooltip=50,mouseOutPid$$module$build$src$core$tooltip=0,showPid$$module$build$src$core$tooltip=0,lastX$$module$build$src$core$tooltip=0,lastY$$module$build$src$core$tooltip=0,element$$module$build$src$core$tooltip=null,poisonedElement$$module$build$src$core$tooltip=null,OFFSET_X$$module$build$src$core$tooltip=0,OFFSET_Y$$module$build$src$core$tooltip=\n10,RADIUS_OK$$module$build$src$core$tooltip=10,HOVER_MS$$module$build$src$core$tooltip=750,MARGINS$$module$build$src$core$tooltip=5,containerDiv$$module$build$src$core$tooltip=null,module$build$src$core$tooltip={};module$build$src$core$tooltip.HOVER_MS=HOVER_MS$$module$build$src$core$tooltip;module$build$src$core$tooltip.LIMIT=LIMIT$$module$build$src$core$tooltip;module$build$src$core$tooltip.MARGINS=MARGINS$$module$build$src$core$tooltip;module$build$src$core$tooltip.OFFSET_X=OFFSET_X$$module$build$src$core$tooltip;\nmodule$build$src$core$tooltip.OFFSET_Y=OFFSET_Y$$module$build$src$core$tooltip;module$build$src$core$tooltip.RADIUS_OK=RADIUS_OK$$module$build$src$core$tooltip;module$build$src$core$tooltip.bindMouseEvents=bindMouseEvents$$module$build$src$core$tooltip;module$build$src$core$tooltip.block=block$$module$build$src$core$tooltip;module$build$src$core$tooltip.createDom=createDom$$module$build$src$core$tooltip;module$build$src$core$tooltip.dispose=dispose$$module$build$src$core$tooltip;\nmodule$build$src$core$tooltip.getCustomTooltip=getCustomTooltip$$module$build$src$core$tooltip;module$build$src$core$tooltip.getDiv=getDiv$$module$build$src$core$tooltip;module$build$src$core$tooltip.getTooltipOfObject=getTooltipOfObject$$module$build$src$core$tooltip;module$build$src$core$tooltip.hide=hide$$module$build$src$core$tooltip;module$build$src$core$tooltip.isVisible=isVisible$$module$build$src$core$tooltip;module$build$src$core$tooltip.setCustomTooltip=setCustomTooltip$$module$build$src$core$tooltip;\nmodule$build$src$core$tooltip.unbindMouseEvents=unbindMouseEvents$$module$build$src$core$tooltip;module$build$src$core$tooltip.unblock=unblock$$module$build$src$core$tooltip;var hsvSaturation$$module$build$src$core$utils$colour=.45,hsvValue$$module$build$src$core$utils$colour=.65,names$$module$build$src$core$utils$colour={aqua:\"#00ffff\",black:\"#000000\",blue:\"#0000ff\",fuchsia:\"#ff00ff\",gray:\"#808080\",green:\"#008000\",lime:\"#00ff00\",maroon:\"#800000\",navy:\"#000080\",olive:\"#808000\",purple:\"#800080\",red:\"#ff0000\",silver:\"#c0c0c0\",teal:\"#008080\",white:\"#ffffff\",yellow:\"#ffff00\"},module$build$src$core$utils$colour={};module$build$src$core$utils$colour.blend=blend$$module$build$src$core$utils$colour;\nmodule$build$src$core$utils$colour.getHsvSaturation=getHsvSaturation$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.getHsvValue=getHsvValue$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.hexToRgb=hexToRgb$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.hsvToHex=hsvToHex$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.hueToHex=hueToHex$$module$build$src$core$utils$colour;\nmodule$build$src$core$utils$colour.names=names$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.parse=parse$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.rgbToHex=rgbToHex$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.setHsvSaturation=setHsvSaturation$$module$build$src$core$utils$colour;module$build$src$core$utils$colour.setHsvValue=setHsvValue$$module$build$src$core$utils$colour;var module$build$src$core$utils$parsing={};module$build$src$core$utils$parsing.checkMessageReferences=checkMessageReferences$$module$build$src$core$utils$parsing;module$build$src$core$utils$parsing.parseBlockColour=parseBlockColour$$module$build$src$core$utils$parsing;module$build$src$core$utils$parsing.replaceMessageReferences=replaceMessageReferences$$module$build$src$core$utils$parsing;module$build$src$core$utils$parsing.tokenizeInterpolation=tokenizeInterpolation$$module$build$src$core$utils$parsing;var Sentinel$$module$build$src$core$utils$sentinel=class{},module$build$src$core$utils$sentinel={};module$build$src$core$utils$sentinel.Sentinel=Sentinel$$module$build$src$core$utils$sentinel;var owner$$module$build$src$core$widgetdiv=null,dispose$$module$build$src$core$widgetdiv=null,rendererClassName$$module$build$src$core$widgetdiv=\"\",themeClassName$$module$build$src$core$widgetdiv=\"\",containerDiv$$module$build$src$core$widgetdiv,module$build$src$core$widgetdiv={};module$build$src$core$widgetdiv.createDom=createDom$$module$build$src$core$widgetdiv;module$build$src$core$widgetdiv.getDiv=getDiv$$module$build$src$core$widgetdiv;module$build$src$core$widgetdiv.hide=hide$$module$build$src$core$widgetdiv;\nmodule$build$src$core$widgetdiv.hideIfOwner=hideIfOwner$$module$build$src$core$widgetdiv;module$build$src$core$widgetdiv.isVisible=isVisible$$module$build$src$core$widgetdiv;module$build$src$core$widgetdiv.positionWithAnchor=positionWithAnchor$$module$build$src$core$widgetdiv;module$build$src$core$widgetdiv.show=show$$module$build$src$core$widgetdiv;module$build$src$core$widgetdiv.testOnly_setDiv=testOnly_setDiv$$module$build$src$core$widgetdiv;var Field$$module$build$src$core$field=class{constructor(a,b,c){this.DEFAULT_VALUE=null;this.name=void 0;this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=this.tooltip_=this.validator_=null;this.disposed=!1;this.maxDisplayLength=50;this.sourceBlock_=null;this.enabled_=this.visible_=this.isDirty_=!0;this.suffixField=this.prefixField=this.clickTarget_=null;this.EDITABLE=!0;this.SERIALIZABLE=!1;this.CURSOR=\"\";\nthis.value_=\"DEFAULT_VALUE\"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE;this.size_=new Size$$module$build$src$core$utils$size(0,0);a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(a),b&&this.setValidator(b))}configure_(a){a.tooltip&&this.setTooltip(replaceMessageReferences$$module$build$src$core$utils$parsing(a.tooltip))}setSourceBlock(a){if(this.sourceBlock_)throw Error(\"Field already bound to a block\");this.sourceBlock_=a}getConstants(){!this.constants_&&\nthis.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants());return this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{}),this.isVisible()||(this.fieldGroup_.style.display=\"none\"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),\nthis.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel())}initView(){this.createBorderRect_();this.createTextElement_()}initModel(){}createBorderRect_(){this.borderRect_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,\"class\":\"blocklyFieldRect\"},this.fieldGroup_)}createTextElement_(){this.textElement_=\ncreateSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TEXT,{\"class\":\"blocklyText\"},this.fieldGroup_);this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute(\"dominant-baseline\",\"central\");this.textContent_=document.createTextNode(\"\");this.textElement_.appendChild(this.textContent_)}bindEvents_(){const a=this.getClickTarget_();if(!a)throw Error(\"A click target has not been set.\");bindMouseEvents$$module$build$src$core$tooltip(a);this.mouseDownWrapper_=\nconditionalBind$$module$build$src$core$browser_events(a,\"pointerdown\",this,this.onMouseDown_)}fromXml(a){this.setValue(a.textContent)}toXml(a){a.textContent=this.getValue();return a}saveState(a){a=this.saveLegacyState(Field$$module$build$src$core$field);return null!==a?a:this.getValue()}loadState(a){this.loadLegacyState(Field$$module$build$src$core$field,a)||this.setValue(a)}saveLegacyState(a){return a.prototype.saveState===this.saveState&&a.prototype.toXml!==this.toXml?(a=createElement$$module$build$src$core$utils$xml(\"field\"),\na.setAttribute(\"name\",this.name||\"\"),domToText$$module$build$src$core$xml(this.toXml(a)).replace(' xmlns=\"https://developers.google.com/blockly/xml\"',\"\")):null}loadLegacyState(a,b){return a.prototype.loadState===this.loadState&&a.prototype.fromXml!==this.fromXml?(this.fromXml(textToDom$$module$build$src$core$xml(b)),!0):!1}dispose(){hideIfOwner$$module$build$src$core$dropdowndiv(this);hideIfOwner$$module$build$src$core$widgetdiv(this);unbindMouseEvents$$module$build$src$core$tooltip(this.getClickTarget_());\nthis.mouseDownWrapper_&&unbind$$module$build$src$core$browser_events(this.mouseDownWrapper_);removeNode$$module$build$src$core$utils$dom(this.fieldGroup_);this.disposed=!0}updateEditable(){const a=this.fieldGroup_,b=this.getSourceBlock();this.EDITABLE&&a&&b&&(this.enabled_&&b.isEditable()?(addClass$$module$build$src$core$utils$dom(a,\"blocklyEditableText\"),removeClass$$module$build$src$core$utils$dom(a,\"blocklyNonEditableText\"),a.style.cursor=this.CURSOR):(addClass$$module$build$src$core$utils$dom(a,\n\"blocklyNonEditableText\"),removeClass$$module$build$src$core$utils$dom(a,\"blocklyEditableText\"),a.style.cursor=\"\"))}setEnabled(a){this.enabled_=a;this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==Field$$module$build$src$core$field.prototype.showEditor_}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let a=!1;\nthis.name&&(this.SERIALIZABLE?a=!0:this.EDITABLE&&(console.warn(\"Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization.\"),a=!0));return a}isVisible(){return this.visible_}setVisible(a){if(this.visible_!==a){this.visible_=a;var b=this.fieldGroup_;b&&(b.style.display=a?\"block\":\"none\")}}setValidator(a){this.validator_=a}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);\nreturn this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_());this.updateSize_()}showEditor(a){this.isClickable()&&this.showEditor_(a)}showEditor_(a){}updateSize_(a){const b=this.getConstants();a=void 0!==\na?a:this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let c=2*a,d=b.FIELD_TEXT_HEIGHT,e=0;this.textElement_&&(e=getFastTextWidth$$module$build$src$core$utils$dom(this.textElement_,b.FIELD_TEXT_FONTSIZE,b.FIELD_TEXT_FONTWEIGHT,b.FIELD_TEXT_FONTFAMILY),c+=e);this.borderRect_&&(d=Math.max(d,b.FIELD_BORDER_RECT_HEIGHT));this.size_.height=d;this.size_.width=c;this.positionTextElement_(a,e);this.positionBorderRect_()}positionTextElement_(a,b){if(this.textElement_){var c=this.getConstants(),\nd=this.size_.height/2,e;this.textElement_.setAttribute(\"x\",`${(null==(e=this.getSourceBlock())?0:e.RTL)?this.size_.width-b-a:a}`);this.textElement_.setAttribute(\"y\",`${c.FIELD_TEXT_BASELINE_CENTER?d:d-c.FIELD_TEXT_HEIGHT/2+c.FIELD_TEXT_BASELINE}`)}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute(\"width\",`${this.size_.width}`),this.borderRect_.setAttribute(\"height\",`${this.size_.height}`),this.borderRect_.setAttribute(\"rx\",`${this.getConstants().FIELD_BORDER_RECT_RADIUS}`),this.borderRect_.setAttribute(\"ry\",\n`${this.getConstants().FIELD_BORDER_RECT_RADIUS}`))}getSize(){if(!this.isVisible())return new Size$$module$build$src$core$utils$size(0,0);this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&0===this.size_.width&&(this.render_(),0!==this.size_.width&&console.warn(\"Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.\"));return this.size_}getScaledBBox(){let a;var b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;\nif(this.borderRect_){var c=this.borderRect_.getBoundingClientRect();a=getPageOffset$$module$build$src$core$utils$style(this.borderRect_);b=c.width;c=c.height}else{c=this.sourceBlock_.getHeightWidth();const d=b.workspace.scale;a=this.getAbsoluteXY_();b=(c.width+1)*d;c=(c.height+1)*d;GECKO$$module$build$src$core$utils$useragent?(a.x+=1.5*d,a.y+=1.5*d):(a.x-=.5*d,a.y-=.5*d)}return new Rect$$module$build$src$core$utils$rect(a.y,a.y+c,a.x,a.x+b)}getDisplayText_(){let a=this.getText();if(!a)return Field$$module$build$src$core$field.NBSP;\na.length>this.maxDisplayLength&&(a=a.substring(0,this.maxDisplayLength-2)+\"\\u2026\");a=a.replace(/\\s/g,Field$$module$build$src$core$field.NBSP);this.sourceBlock_&&this.sourceBlock_.RTL&&(a+=\"\\u200f\");return a}getText(){const a=this.getText_();return null!==a?String(a):String(this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0;this.constants_=null}forceRerender(){this.isDirty_=!0;this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours(),\nthis.updateMarkers_())}setValue(a){if(null!==a){var b=this.doClassValidation_(a);a=this.processValidation_(a,b);if(!(a instanceof Error)){if(b=this.getValidator())if(b=b.call(this,a),a=this.processValidation_(a,b),a instanceof Error)return;b=this.sourceBlock_;if(!b||!b.disposed){var c=this.getValue();c===a?this.doValueUpdate_(a):(this.doValueUpdate_(a),b&&isEnabled$$module$build$src$core$events$utils()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(b,\n\"field\",this.name||null,c,a)),this.isDirty_&&this.forceRerender())}}}}processValidation_(a,b){if(null===b)return this.doValueInvalid_(a),this.isDirty_&&this.forceRerender(),Error();void 0!==b&&(a=b);return a}getValue(){return this.value_}doClassValidation_(a){return null===a||void 0===a?null:a}doValueUpdate_(a){this.value_=a;this.isDirty_=!0}doValueInvalid_(a){}onMouseDown_(a){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(a=this.sourceBlock_.workspace.getGesture(a))&&a.setStartField(this)}setTooltip(a){a||\n\"\"===a||(a=this.sourceBlock_);const b=this.getClickTarget_();b?b.tooltip=a:this.tooltip_=a}getTooltip(){const a=this.getClickTarget_();return a?getTooltipOfObject$$module$build$src$core$tooltip(a):getTooltipOfObject$$module$build$src$core$tooltip({tooltip:this.tooltip_})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return getPageOffset$$module$build$src$core$utils$style(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let a=\nnull;const b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;const c=b.inputList;for(let d=0;d<b.inputList.length;d++){const e=c[d],f=e.fieldRow;for(let g=0;g<f.length;g++)if(f[g]===this){a=e;break}}return a}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(a){return!1}setCursorSvg(a){if(a){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(a);this.cursorSvg_=a}else this.cursorSvg_=null}setMarkerSvg(a){if(a){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);\nthis.fieldGroup_.appendChild(a);this.markerSvg_=a}else this.markerSvg_=null}updateMarkers_(){var a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;a=a.workspace;a.keyboardAccessibilityMode&&this.cursorSvg_&&a.getCursor().draw();a.keyboardAccessibilityMode&&this.markerSvg_&&a.getMarker(MarkerManager$$module$build$src$core$marker_manager.LOCAL_MARKER).draw()}};Field$$module$build$src$core$field.NBSP=\"\\u00a0\";Field$$module$build$src$core$field.SKIP_SETUP=new Sentinel$$module$build$src$core$utils$sentinel;\nvar UnattachedFieldError$$module$build$src$core$field=class extends Error{constructor(){super(\"The field has not yet been attached to its input. Call appendField to attach it.\")}},module$build$src$core$field={};module$build$src$core$field.Field=Field$$module$build$src$core$field;module$build$src$core$field.UnattachedFieldError=UnattachedFieldError$$module$build$src$core$field;var TEST_ONLY$$module$build$src$core$field_registry={fromJsonInternal:fromJsonInternal$$module$build$src$core$field_registry},module$build$src$core$field_registry={};module$build$src$core$field_registry.TEST_ONLY=TEST_ONLY$$module$build$src$core$field_registry;module$build$src$core$field_registry.fromJson=fromJson$$module$build$src$core$field_registry;module$build$src$core$field_registry.register=register$$module$build$src$core$field_registry;module$build$src$core$field_registry.unregister=unregister$$module$build$src$core$field_registry;var ARIA_PREFIX$$module$build$src$core$utils$aria=\"aria-\",ROLE_ATTRIBUTE$$module$build$src$core$utils$aria=\"role\",Role$$module$build$src$core$utils$aria;(function(a){a.GRID=\"grid\";a.GRIDCELL=\"gridcell\";a.GROUP=\"group\";a.LISTBOX=\"listbox\";a.MENU=\"menu\";a.MENUITEM=\"menuitem\";a.MENUITEMCHECKBOX=\"menuitemcheckbox\";a.OPTION=\"option\";a.PRESENTATION=\"presentation\";a.ROW=\"row\";a.TREE=\"tree\";a.TREEITEM=\"treeitem\"})(Role$$module$build$src$core$utils$aria||(Role$$module$build$src$core$utils$aria={}));var State$$module$build$src$core$utils$aria;\n(function(a){a.ACTIVEDESCENDANT=\"activedescendant\";a.COLCOUNT=\"colcount\";a.DISABLED=\"disabled\";a.EXPANDED=\"expanded\";a.INVALID=\"invalid\";a.LABEL=\"label\";a.LABELLEDBY=\"labelledby\";a.LEVEL=\"level\";a.ORIENTATION=\"orientation\";a.POSINSET=\"posinset\";a.ROWCOUNT=\"rowcount\";a.SELECTED=\"selected\";a.SETSIZE=\"setsize\";a.VALUEMAX=\"valuemax\";a.VALUEMIN=\"valuemin\"})(State$$module$build$src$core$utils$aria||(State$$module$build$src$core$utils$aria={}));var module$build$src$core$utils$aria={};\nmodule$build$src$core$utils$aria.Role=Role$$module$build$src$core$utils$aria;module$build$src$core$utils$aria.State=State$$module$build$src$core$utils$aria;module$build$src$core$utils$aria.setRole=setRole$$module$build$src$core$utils$aria;module$build$src$core$utils$aria.setState=setState$$module$build$src$core$utils$aria;var KeyCodes$$module$build$src$core$utils$keycodes;\n(function(a){a[a.WIN_KEY_FF_LINUX=0]=\"WIN_KEY_FF_LINUX\";a[a.MAC_ENTER=3]=\"MAC_ENTER\";a[a.BACKSPACE=8]=\"BACKSPACE\";a[a.TAB=9]=\"TAB\";a[a.NUM_CENTER=12]=\"NUM_CENTER\";a[a.ENTER=13]=\"ENTER\";a[a.SHIFT=16]=\"SHIFT\";a[a.CTRL=17]=\"CTRL\";a[a.ALT=18]=\"ALT\";a[a.PAUSE=19]=\"PAUSE\";a[a.CAPS_LOCK=20]=\"CAPS_LOCK\";a[a.ESC=27]=\"ESC\";a[a.SPACE=32]=\"SPACE\";a[a.PAGE_UP=33]=\"PAGE_UP\";a[a.PAGE_DOWN=34]=\"PAGE_DOWN\";a[a.END=35]=\"END\";a[a.HOME=36]=\"HOME\";a[a.LEFT=37]=\"LEFT\";a[a.UP=38]=\"UP\";a[a.RIGHT=39]=\"RIGHT\";a[a.DOWN=40]=\n\"DOWN\";a[a.PLUS_SIGN=43]=\"PLUS_SIGN\";a[a.PRINT_SCREEN=44]=\"PRINT_SCREEN\";a[a.INSERT=45]=\"INSERT\";a[a.DELETE=46]=\"DELETE\";a[a.ZERO=48]=\"ZERO\";a[a.ONE=49]=\"ONE\";a[a.TWO=50]=\"TWO\";a[a.THREE=51]=\"THREE\";a[a.FOUR=52]=\"FOUR\";a[a.FIVE=53]=\"FIVE\";a[a.SIX=54]=\"SIX\";a[a.SEVEN=55]=\"SEVEN\";a[a.EIGHT=56]=\"EIGHT\";a[a.NINE=57]=\"NINE\";a[a.FF_SEMICOLON=59]=\"FF_SEMICOLON\";a[a.FF_EQUALS=61]=\"FF_EQUALS\";a[a.FF_DASH=173]=\"FF_DASH\";a[a.FF_HASH=163]=\"FF_HASH\";a[a.QUESTION_MARK=63]=\"QUESTION_MARK\";a[a.AT_SIGN=64]=\"AT_SIGN\";\na[a.A=65]=\"A\";a[a.B=66]=\"B\";a[a.C=67]=\"C\";a[a.D=68]=\"D\";a[a.E=69]=\"E\";a[a.F=70]=\"F\";a[a.G=71]=\"G\";a[a.H=72]=\"H\";a[a.I=73]=\"I\";a[a.J=74]=\"J\";a[a.K=75]=\"K\";a[a.L=76]=\"L\";a[a.M=77]=\"M\";a[a.N=78]=\"N\";a[a.O=79]=\"O\";a[a.P=80]=\"P\";a[a.Q=81]=\"Q\";a[a.R=82]=\"R\";a[a.S=83]=\"S\";a[a.T=84]=\"T\";a[a.U=85]=\"U\";a[a.V=86]=\"V\";a[a.W=87]=\"W\";a[a.X=88]=\"X\";a[a.Y=89]=\"Y\";a[a.Z=90]=\"Z\";a[a.META=91]=\"META\";a[a.WIN_KEY_RIGHT=92]=\"WIN_KEY_RIGHT\";a[a.CONTEXT_MENU=93]=\"CONTEXT_MENU\";a[a.NUM_ZERO=96]=\"NUM_ZERO\";a[a.NUM_ONE=97]=\n\"NUM_ONE\";a[a.NUM_TWO=98]=\"NUM_TWO\";a[a.NUM_THREE=99]=\"NUM_THREE\";a[a.NUM_FOUR=100]=\"NUM_FOUR\";a[a.NUM_FIVE=101]=\"NUM_FIVE\";a[a.NUM_SIX=102]=\"NUM_SIX\";a[a.NUM_SEVEN=103]=\"NUM_SEVEN\";a[a.NUM_EIGHT=104]=\"NUM_EIGHT\";a[a.NUM_NINE=105]=\"NUM_NINE\";a[a.NUM_MULTIPLY=106]=\"NUM_MULTIPLY\";a[a.NUM_PLUS=107]=\"NUM_PLUS\";a[a.NUM_MINUS=109]=\"NUM_MINUS\";a[a.NUM_PERIOD=110]=\"NUM_PERIOD\";a[a.NUM_DIVISION=111]=\"NUM_DIVISION\";a[a.F1=112]=\"F1\";a[a.F2=113]=\"F2\";a[a.F3=114]=\"F3\";a[a.F4=115]=\"F4\";a[a.F5=116]=\"F5\";a[a.F6=\n117]=\"F6\";a[a.F7=118]=\"F7\";a[a.F8=119]=\"F8\";a[a.F9=120]=\"F9\";a[a.F10=121]=\"F10\";a[a.F11=122]=\"F11\";a[a.F12=123]=\"F12\";a[a.NUMLOCK=144]=\"NUMLOCK\";a[a.SCROLL_LOCK=145]=\"SCROLL_LOCK\";a[a.FIRST_MEDIA_KEY=166]=\"FIRST_MEDIA_KEY\";a[a.LAST_MEDIA_KEY=183]=\"LAST_MEDIA_KEY\";a[a.SEMICOLON=186]=\"SEMICOLON\";a[a.DASH=189]=\"DASH\";a[a.EQUALS=187]=\"EQUALS\";a[a.COMMA=188]=\"COMMA\";a[a.PERIOD=190]=\"PERIOD\";a[a.SLASH=191]=\"SLASH\";a[a.APOSTROPHE=192]=\"APOSTROPHE\";a[a.TILDE=192]=\"TILDE\";a[a.SINGLE_QUOTE=222]=\"SINGLE_QUOTE\";\na[a.OPEN_SQUARE_BRACKET=219]=\"OPEN_SQUARE_BRACKET\";a[a.BACKSLASH=220]=\"BACKSLASH\";a[a.CLOSE_SQUARE_BRACKET=221]=\"CLOSE_SQUARE_BRACKET\";a[a.WIN_KEY=224]=\"WIN_KEY\";a[a.MAC_FF_META=224]=\"MAC_FF_META\";a[a.MAC_WK_CMD_LEFT=91]=\"MAC_WK_CMD_LEFT\";a[a.MAC_WK_CMD_RIGHT=93]=\"MAC_WK_CMD_RIGHT\";a[a.WIN_IME=229]=\"WIN_IME\";a[a.VK_NONAME=252]=\"VK_NONAME\";a[a.PHANTOM=255]=\"PHANTOM\"})(KeyCodes$$module$build$src$core$utils$keycodes||(KeyCodes$$module$build$src$core$utils$keycodes={}));\nvar module$build$src$core$utils$keycodes={};module$build$src$core$utils$keycodes.KeyCodes=KeyCodes$$module$build$src$core$utils$keycodes;var Menu$$module$build$src$core$menu=class{constructor(){this.menuItems=[];this.roleName=this.element=this.onKeyDownHandler=this.mouseLeaveHandler=this.mouseEnterHandler=this.clickHandler=this.mouseOverHandler=this.highlightedItem=this.openingCoords=null}addChild(a){this.menuItems.push(a)}render(a){const b=document.createElement(\"div\");b.className=\"blocklyMenu goog-menu blocklyNonSelectable\";b.tabIndex=0;this.roleName&&setRole$$module$build$src$core$utils$aria(b,this.roleName);this.element=b;for(let c=\n0,d;d=this.menuItems[c];c++)b.appendChild(d.createDom());this.mouseOverHandler=conditionalBind$$module$build$src$core$browser_events(b,\"pointerover\",this,this.handleMouseOver,!0);this.clickHandler=conditionalBind$$module$build$src$core$browser_events(b,\"pointerdown\",this,this.handleClick,!0);this.mouseEnterHandler=conditionalBind$$module$build$src$core$browser_events(b,\"pointerenter\",this,this.handleMouseEnter,!0);this.mouseLeaveHandler=conditionalBind$$module$build$src$core$browser_events(b,\"pointerleave\",\nthis,this.handleMouseLeave,!0);this.onKeyDownHandler=conditionalBind$$module$build$src$core$browser_events(b,\"keydown\",this,this.handleKeyEvent);a.appendChild(b);return b}getElement(){return this.element}focus(){const a=this.getElement();a&&(a.focus({preventScroll:!0}),addClass$$module$build$src$core$utils$dom(a,\"blocklyFocused\"))}blur(){const a=this.getElement();a&&(a.blur(),removeClass$$module$build$src$core$utils$dom(a,\"blocklyFocused\"))}setRole(a){this.roleName=a}dispose(){this.mouseOverHandler&&\n(unbind$$module$build$src$core$browser_events(this.mouseOverHandler),this.mouseOverHandler=null);this.clickHandler&&(unbind$$module$build$src$core$browser_events(this.clickHandler),this.clickHandler=null);this.mouseEnterHandler&&(unbind$$module$build$src$core$browser_events(this.mouseEnterHandler),this.mouseEnterHandler=null);this.mouseLeaveHandler&&(unbind$$module$build$src$core$browser_events(this.mouseLeaveHandler),this.mouseLeaveHandler=null);this.onKeyDownHandler&&(unbind$$module$build$src$core$browser_events(this.onKeyDownHandler),\nthis.onKeyDownHandler=null);for(let a=0,b;b=this.menuItems[a];a++)b.dispose();this.element=null}getMenuItem(a){const b=this.getElement();for(;a&&a!==b;){if(a.classList.contains(\"blocklyMenuItem\"))for(let c=0,d;d=this.menuItems[c];c++)if(d.getElement()===a)return d;a=a.parentElement}return null}setHighlighted(a){var b=this.highlightedItem;b&&(b.setHighlighted(!1),this.highlightedItem=null);a&&(a.setHighlighted(!0),this.highlightedItem=a,b=this.getElement(),scrollIntoContainerView$$module$build$src$core$utils$style(a.getElement(),\nb),setState$$module$build$src$core$utils$aria(b,State$$module$build$src$core$utils$aria.ACTIVEDESCENDANT,a.getId()))}highlightNext(){const a=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(a,1)}highlightPrevious(){const a=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>a?this.menuItems.length:a,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(a,\nb){a+=b;let c;for(;c=this.menuItems[a];){if(c.isEnabled()){this.setHighlighted(c);break}a+=b}}handleMouseOver(a){(a=this.getMenuItem(a.target))&&(a.isEnabled()?this.highlightedItem!==a&&this.setHighlighted(a):this.setHighlighted(null))}handleClick(a){const b=this.openingCoords;this.openingCoords=null;if(b&&\"number\"===typeof a.clientX){const c=new Coordinate$$module$build$src$core$utils$coordinate(a.clientX,a.clientY);if(1>Coordinate$$module$build$src$core$utils$coordinate.distance(b,c))return}(a=\nthis.getMenuItem(a.target))&&a.performAction()}handleMouseEnter(a){this.focus()}handleMouseLeave(a){this.getElement()&&(this.blur(),this.setHighlighted(null))}handleKeyEvent(a){if(this.menuItems.length&&!(a.shiftKey||a.ctrlKey||a.metaKey||a.altKey)){var b=this.highlightedItem;switch(a.keyCode){case KeyCodes$$module$build$src$core$utils$keycodes.ENTER:case KeyCodes$$module$build$src$core$utils$keycodes.SPACE:b&&b.performAction();break;case KeyCodes$$module$build$src$core$utils$keycodes.UP:this.highlightPrevious();\nbreak;case KeyCodes$$module$build$src$core$utils$keycodes.DOWN:this.highlightNext();break;case KeyCodes$$module$build$src$core$utils$keycodes.PAGE_UP:case KeyCodes$$module$build$src$core$utils$keycodes.HOME:this.highlightFirst();break;case KeyCodes$$module$build$src$core$utils$keycodes.PAGE_DOWN:case KeyCodes$$module$build$src$core$utils$keycodes.END:this.highlightLast();break;default:return}a.preventDefault();a.stopPropagation()}}getSize(){const a=this.getElement(),b=getSize$$module$build$src$core$utils$style(a);\nb.height=a.scrollHeight;return b}},module$build$src$core$menu={};module$build$src$core$menu.Menu=Menu$$module$build$src$core$menu;var MenuItem$$module$build$src$core$menuitem=class{constructor(a,b){this.content=a;this.opt_value=b;this.enabled=!0;this.element=null;this.rightToLeft=!1;this.roleName=null;this.highlight=this.checked=this.checkable=!1;this.actionHandler=null}createDom(){const a=document.createElement(\"div\");a.id=getNextUniqueId$$module$build$src$core$utils$idgenerator();this.element=a;a.className=\"blocklyMenuItem goog-menuitem \"+(this.enabled?\"\":\"blocklyMenuItemDisabled goog-menuitem-disabled \")+(this.checked?\"blocklyMenuItemSelected goog-option-selected \":\n\"\")+(this.highlight?\"blocklyMenuItemHighlight goog-menuitem-highlight \":\"\")+(this.rightToLeft?\"blocklyMenuItemRtl goog-menuitem-rtl \":\"\");const b=document.createElement(\"div\");b.className=\"blocklyMenuItemContent goog-menuitem-content\";if(this.checkable){var c=document.createElement(\"div\");c.className=\"blocklyMenuItemCheckbox goog-menuitem-checkbox\";b.appendChild(c)}c=this.content;\"string\"===typeof this.content&&(c=document.createTextNode(this.content));b.appendChild(c);a.appendChild(b);this.roleName&&\nsetRole$$module$build$src$core$utils$aria(a,this.roleName);setState$$module$build$src$core$utils$aria(a,State$$module$build$src$core$utils$aria.SELECTED,this.checkable&&this.checked||!1);setState$$module$build$src$core$utils$aria(a,State$$module$build$src$core$utils$aria.DISABLED,!this.enabled);return a}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let a;return null!=(a=this.opt_value)?a:null}setRightToLeft(a){this.rightToLeft=a}setRole(a){this.roleName=\na}setCheckable(a){this.checkable=a}setChecked(a){this.checked=a}setHighlighted(a){this.highlight=a;const b=this.getElement();b&&this.isEnabled()&&(a?(addClass$$module$build$src$core$utils$dom(b,\"blocklyMenuItemHighlight\"),addClass$$module$build$src$core$utils$dom(b,\"goog-menuitem-highlight\")):(removeClass$$module$build$src$core$utils$dom(b,\"blocklyMenuItemHighlight\"),removeClass$$module$build$src$core$utils$dom(b,\"goog-menuitem-highlight\")))}isEnabled(){return this.enabled}setEnabled(a){this.enabled=\na}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(a,b){this.actionHandler=a.bind(b)}},module$build$src$core$menuitem={};module$build$src$core$menuitem.MenuItem=MenuItem$$module$build$src$core$menuitem;var FieldDropdown$$module$build$src$core$field_dropdown=class extends Field$$module$build$src$core$field{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.svgArrow_=this.arrow_=this.imageElement_=this.menu_=this.selectedMenuItem_=null;this.SERIALIZABLE=!0;this.CURSOR=\"default\";this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions_=null;isMenuGenerator$$module$build$src$core$field_dropdown(a)&&(Array.isArray(a)?(validateOptions$$module$build$src$core$field_dropdown(a),\na=trimOptions$$module$build$src$core$field_dropdown(a),this.menuGenerator_=a.options,this.prefixField=a.prefix||null,this.suffixField=a.suffix||null):this.menuGenerator_=a,this.selectedOption_=this.getOptions(!1)[0],c&&this.configure_(c),this.setValue(this.selectedOption_[1]),b&&this.setValidator(b))}fromXml(a){this.isOptionListDynamic()&&this.getOptions(!1);this.setValue(a.textContent)}loadState(a){this.loadLegacyState(FieldDropdown$$module$build$src$core$field_dropdown,a)||(this.isOptionListDynamic()&&\nthis.getOptions(!1),this.setValue(a))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot();this.createTextElement_();this.imageElement_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{},this.fieldGroup_);this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_();this.borderRect_&&addClass$$module$build$src$core$utils$dom(this.borderRect_,\"blocklyDropdownRect\")}shouldAddBorderRect_(){let a;\nreturn!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!(null==(a=this.getSourceBlock())?0:a.isShadow())}createTextArrow_(){this.arrow_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TSPAN,{},this.textElement_);let a;this.arrow_.appendChild(document.createTextNode((null==(a=this.getSourceBlock())?0:a.RTL)?FieldDropdown$$module$build$src$core$field_dropdown.ARROW_CHAR+\" \":\" \"+FieldDropdown$$module$build$src$core$field_dropdown.ARROW_CHAR));\nlet b;(null==(b=this.getSourceBlock())?0:b.RTL)?this.getTextElement().insertBefore(this.arrow_,this.textContent_):this.getTextElement().appendChild(this.arrow_)}createSVGArrow_(){this.svgArrow_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+\"px\",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+\"px\"},this.fieldGroup_);this.svgArrow_.setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\n\"xlink:href\",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(a){var b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;this.dropdownCreate_();this.menu_.openingCoords=a&&\"number\"===typeof a.clientX?new Coordinate$$module$build$src$core$utils$coordinate(a.clientX,a.clientY):null;clearContent$$module$build$src$core$dropdowndiv();a=this.menu_.render(getContentDiv$$module$build$src$core$dropdowndiv());addClass$$module$build$src$core$utils$dom(a,\n\"blocklyDropdownMenu\");this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(a=b.isShadow()?b.getParent().getColour():b.getColour(),b=b.isShadow()?b.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,setColour$$module$build$src$core$dropdowndiv(a,b));showPositionedByField$$module$build$src$core$dropdowndiv(this,this.dropdownDispose_.bind(this));this.menu_.focus();this.selectedMenuItem_&&this.menu_.setHighlighted(this.selectedMenuItem_);this.applyColour()}dropdownCreate_(){const a=\nthis.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;const b=new Menu$$module$build$src$core$menu;b.setRole(Role$$module$build$src$core$utils$aria.LISTBOX);this.menu_=b;const c=this.getOptions(!1);this.selectedMenuItem_=null;for(let e=0;e<c.length;e++){const [f,g]=c[e];if(\"object\"===typeof f){var d=new Image(f.width,f.height);d.src=f.src;d.alt=f.alt||\"\"}else d=f;d=new MenuItem$$module$build$src$core$menuitem(d,g);d.setRole(Role$$module$build$src$core$utils$aria.OPTION);\nd.setRightToLeft(a.RTL);d.setCheckable(!0);b.addChild(d);d.setChecked(g===this.value_);g===this.value_&&(this.selectedMenuItem_=d);d.onAction(this.handleMenuActionEvent_,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose();this.selectedMenuItem_=this.menu_=null;this.applyColour()}handleMenuActionEvent_(a){hideIfOwner$$module$build$src$core$dropdowndiv(this,!0);this.onItemSelected_(this.menu_,a)}onItemSelected_(a,b){this.setValue(b.getValue())}isOptionListDynamic(){return\"function\"===typeof this.menuGenerator_}getOptions(a){if(!this.menuGenerator_)throw TypeError(\"A menu generator was never defined.\");\nif(Array.isArray(this.menuGenerator_))return this.menuGenerator_;if(a&&this.generatedOptions_)return this.generatedOptions_;this.generatedOptions_=this.menuGenerator_();validateOptions$$module$build$src$core$field_dropdown(this.generatedOptions_);return this.generatedOptions_}doClassValidation_(a){return this.getOptions(!0).some(b=>b[1]===a)?a:(this.sourceBlock_&&console.warn(\"Cannot set the dropdown's value to an unavailable option. Block type: \"+this.sourceBlock_.type+\", Field name: \"+this.name+\n\", Value: \"+a),null)}doValueUpdate_(a){super.doValueUpdate_(a);a=this.getOptions(!0);for(let b=0,c;c=a[b];b++)c[1]===this.value_&&(this.selectedOption_=c)}applyColour(){const a=this.sourceBlock_.style;this.borderRect_&&(this.borderRect_.setAttribute(\"stroke\",a.colourTertiary),this.menu_?this.borderRect_.setAttribute(\"fill\",a.colourTertiary):this.borderRect_.setAttribute(\"fill\",\"transparent\"));this.sourceBlock_&&this.arrow_&&(this.sourceBlock_.isShadow()?this.arrow_.style.fill=a.colourSecondary:this.arrow_.style.fill=\na.colourPrimary)}render_(){this.getTextContent().nodeValue=\"\";this.imageElement_.style.display=\"none\";const a=this.selectedOption_&&this.selectedOption_[0];a&&\"object\"===typeof a?this.renderSelectedImage_(a):this.renderSelectedText_();this.positionBorderRect_()}renderSelectedImage_(a){const b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;this.imageElement_.style.display=\"\";this.imageElement_.setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",\na.src);this.imageElement_.setAttribute(\"height\",`${a.height}`);this.imageElement_.setAttribute(\"width\",`${a.width}`);const c=Number(a.height);a=Number(a.width);var d=!!this.borderRect_;const e=Math.max(d?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,c+IMAGE_Y_PADDING$$module$build$src$core$field_dropdown);d=d?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let f;f=this.svgArrow_?this.positionSVGArrow_(a+d,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):getFastTextWidth$$module$build$src$core$utils$dom(this.arrow_,\nthis.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);this.size_.width=a+f+2*d;this.size_.height=e;let g=0;b.RTL?this.imageElement_.setAttribute(\"x\",(d+f).toString()):(g=a+f,this.getTextElement().setAttribute(\"text-anchor\",\"end\"),this.imageElement_.setAttribute(\"x\",d.toString()));this.imageElement_.setAttribute(\"y\",(e/2-c/2).toString());this.positionTextElement_(g+d,a+f)}renderSelectedText_(){this.getTextContent().nodeValue=this.getDisplayText_();\nvar a=this.getTextElement();addClass$$module$build$src$core$utils$dom(a,\"blocklyDropdownText\");a.setAttribute(\"text-anchor\",\"start\");var b=!!this.borderRect_;a=Math.max(b?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const c=getFastTextWidth$$module$build$src$core$utils$dom(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);b=b?this.getConstants().FIELD_BORDER_RECT_X_PADDING:\n0;let d=0;this.svgArrow_&&(d=this.positionSVGArrow_(c+b,a/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2));this.size_.width=c+d+2*b;this.size_.height=a;this.positionTextElement_(b,c)}positionSVGArrow_(a,b){if(!this.svgArrow_)return 0;const c=this.getSourceBlock();if(!c)throw new UnattachedFieldError$$module$build$src$core$field;const d=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,e=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,f=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;\nthis.svgArrow_.setAttribute(\"transform\",\"translate(\"+(c.RTL?d:a+e)+\",\"+b+\")\");return f+e}getText_(){if(!this.selectedOption_)return null;const a=this.selectedOption_[0];return\"object\"===typeof a?a.alt:a}static fromJson(a){if(!a.options)throw Error(\"options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.\");return new this(a.options,void 0,a)}};\nFieldDropdown$$module$build$src$core$field_dropdown.CHECKMARK_OVERHANG=25;FieldDropdown$$module$build$src$core$field_dropdown.MAX_MENU_HEIGHT_VH=.45;FieldDropdown$$module$build$src$core$field_dropdown.ARROW_CHAR=\"\\u25be\";var IMAGE_Y_OFFSET$$module$build$src$core$field_dropdown=5,IMAGE_Y_PADDING$$module$build$src$core$field_dropdown=2*IMAGE_Y_OFFSET$$module$build$src$core$field_dropdown;register$$module$build$src$core$field_registry(\"field_dropdown\",FieldDropdown$$module$build$src$core$field_dropdown);\n$.module$build$src$core$field_dropdown={};$.module$build$src$core$field_dropdown.FieldDropdown=FieldDropdown$$module$build$src$core$field_dropdown;var BubbleOpen$$module$build$src$core$events$events_bubble_open=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c){super(a?a.workspace.id:void 0);this.type=BUBBLE_OPEN$$module$build$src$core$events$utils;a&&(this.blockId=a.id,this.isOpen=b,this.bubbleType=c)}toJson(){const a=super.toJson();if(void 0===this.isOpen)throw Error(\"Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson\");if(!this.bubbleType)throw Error(\"The type of bubble is undefined. Either pass the value to the constructor, or call fromJson\");\na.isOpen=this.isOpen;a.bubbleType=this.bubbleType;a.blockId=this.blockId||\"\";return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BubbleOpen.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.isOpen=a.isOpen;this.bubbleType=a.bubbleType;this.blockId=a.blockId}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BubbleOpen$$module$build$src$core$events$events_bubble_open);b.isOpen=a.isOpen;b.bubbleType=a.bubbleType;b.blockId=\na.blockId;return b}},BubbleType$$module$build$src$core$events$events_bubble_open;(function(a){a.MUTATOR=\"mutator\";a.COMMENT=\"comment\";a.WARNING=\"warning\"})(BubbleType$$module$build$src$core$events$events_bubble_open||(BubbleType$$module$build$src$core$events$events_bubble_open={}));register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,BUBBLE_OPEN$$module$build$src$core$events$utils,BubbleOpen$$module$build$src$core$events$events_bubble_open);\nvar module$build$src$core$events$events_bubble_open={};module$build$src$core$events$events_bubble_open.BubbleOpen=BubbleOpen$$module$build$src$core$events$events_bubble_open;module$build$src$core$events$events_bubble_open.BubbleType=BubbleType$$module$build$src$core$events$events_bubble_open;var Scrollbar$$module$build$src$core$scrollbar=class{constructor(a,b,c,d,e){this.workspace=a;this.horizontal=b;this.oldHostMetrics=null;this.ratio=1;this.origin=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0;this.containerVisible=this.isHandleVisible=!0;this.position=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null;this.pair=\nc||!1;this.margin=void 0!==e?e:Scrollbar$$module$build$src$core$scrollbar.DEFAULT_SCROLLBAR_MARGIN;a=\"blocklyScrollbar\"+(this.horizontal?\"Horizontal\":\"Vertical\");d&&(a+=\" \"+d);this.outerSvg=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.SVG,{\"class\":a});d=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{},this.outerSvg);this.svgBackground=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,\n{\"class\":\"blocklyScrollbarBackground\"},d);a=Math.floor((Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness-5)/2);this.svgHandle=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyScrollbarHandle\",rx:a,ry:a},d);this.workspace.getThemeManager().subscribe(this.svgHandle,\"scrollbarColour\",\"fill\");this.workspace.getThemeManager().subscribe(this.svgHandle,\"scrollbarOpacity\",\"fill-opacity\");insertAfter$$module$build$src$core$utils$dom(this.outerSvg,\nthis.workspace.getParentSvg());this.setInitialThickness();b?(this.lengthAttribute_=\"width\",this.positionAttribute_=\"x\"):(this.lengthAttribute_=\"height\",this.positionAttribute_=\"y\");this.onMouseDownBarWrapper_=conditionalBind$$module$build$src$core$browser_events(this.svgBackground,\"pointerdown\",this,this.onMouseDownBar);this.onMouseDownHandleWrapper_=conditionalBind$$module$build$src$core$browser_events(this.svgHandle,\"pointerdown\",this,this.onMouseDownHandle)}setInitialThickness(){const a=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness;\nthis.horizontal?(this.svgBackground.setAttribute(\"height\",String(a)),this.outerSvg.setAttribute(\"height\",String(a)),this.svgHandle.setAttribute(\"height\",String(a-5)),this.svgHandle.setAttribute(\"y\",\"2.5\")):(this.svgBackground.setAttribute(\"width\",String(a)),this.outerSvg.setAttribute(\"width\",String(a)),this.svgHandle.setAttribute(\"width\",String(a-5)),this.svgHandle.setAttribute(\"x\",\"2.5\"))}dispose(){this.cleanUp();unbind$$module$build$src$core$browser_events(this.onMouseDownBarWrapper_);unbind$$module$build$src$core$browser_events(this.onMouseDownHandleWrapper_);\nremoveNode$$module$build$src$core$utils$dom(this.outerSvg);this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(a){return a=0>=a||isNaN(a)?0:Math.min(a,this.scrollbarLength)}setHandleLength(a){this.handleLength=a;this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(a){return a=0>=a||isNaN(a)?0:Math.min(a,this.scrollbarLength-this.handleLength)}setHandlePosition(a){this.handlePosition=a;this.svgHandle.setAttribute(this.positionAttribute_,\nString(this.handlePosition))}setScrollbarLength(a){this.scrollbarLength=a;this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength));this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(a,b){this.position.x=a;this.position.y=b;setCssTransform$$module$build$src$core$utils$dom(this.outerSvg,\"translate(\"+(this.position.x+this.origin.x)+\"px,\"+(this.position.y+this.origin.y)+\"px)\")}resize(a){if(!a&&(a=this.workspace.getMetrics(),!a))return;\nthis.oldHostMetrics&&Scrollbar$$module$build$src$core$scrollbar.metricsAreEquivalent(a,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(a):this.resizeVertical(a),this.oldHostMetrics=a,this.updateMetrics())}requiresViewResize(a){return this.oldHostMetrics?this.oldHostMetrics.viewWidth!==a.viewWidth||this.oldHostMetrics.viewHeight!==a.viewHeight||this.oldHostMetrics.absoluteLeft!==a.absoluteLeft||this.oldHostMetrics.absoluteTop!==a.absoluteTop:!0}resizeHorizontal(a){this.requiresViewResize(a)?\nthis.resizeViewHorizontal(a):this.resizeContentHorizontal(a)}resizeViewHorizontal(a){var b=a.viewWidth-2*this.margin;this.pair&&(b-=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness);this.setScrollbarLength(Math.max(0,b));b=a.absoluteLeft+this.margin;this.pair&&this.workspace.RTL&&(b+=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness);this.setPosition(b,a.absoluteTop+a.viewHeight-Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness-this.margin);this.resizeContentHorizontal(a)}resizeContentHorizontal(a){if(a.viewWidth>=\na.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var b=this.scrollbarLength*a.viewWidth/a.scrollWidth;b=this.constrainHandleLength(b);this.setHandleLength(b);b=a.scrollWidth-a.viewWidth;var c=this.scrollbarLength-this.handleLength;a=(a.viewLeft-a.scrollLeft)/b*c;a=this.constrainHandlePosition(a);this.setHandlePosition(a);this.ratio=c/b}}resizeVertical(a){this.requiresViewResize(a)?this.resizeViewVertical(a):\nthis.resizeContentVertical(a)}resizeViewVertical(a){let b=a.viewHeight-2*this.margin;this.pair&&(b-=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness);this.setScrollbarLength(Math.max(0,b));this.setPosition(this.workspace.RTL?a.absoluteLeft+this.margin:a.absoluteLeft+a.viewWidth-Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness-this.margin,a.absoluteTop+this.margin);this.resizeContentVertical(a)}resizeContentVertical(a){if(a.viewHeight>=a.scrollHeight)this.setHandleLength(this.scrollbarLength),\nthis.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var b=this.scrollbarLength*a.viewHeight/a.scrollHeight;b=this.constrainHandleLength(b);this.setHandleLength(b);b=a.scrollHeight-a.viewHeight;var c=this.scrollbarLength-this.handleLength;a=(a.viewTop-a.scrollTop)/b*c;a=this.constrainHandlePosition(a);this.setHandlePosition(a);this.ratio=c/b}}isVisible(){return this.isHandleVisible}setContainerVisible(a){const b=a!==this.containerVisible;this.containerVisible=\na;b&&this.updateDisplay_()}setVisible(a){const b=a!==this.isVisible();if(this.pair)throw Error(\"Unable to toggle visibility of paired scrollbars.\");this.isHandleVisible=a;b&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute(\"display\",\"block\"):this.outerSvg.setAttribute(\"display\",\"none\")}onMouseDownBar(a){this.workspace.markFocused();clearTouchIdentifier$$module$build$src$core$touch();this.cleanUp();if(isRightButton$$module$build$src$core$browser_events(a))a.stopPropagation();\nelse{var b=mouseToSvg$$module$build$src$core$browser_events(a,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());b=this.horizontal?b.x:b.y;var c=getInjectionDivXY$$module$build$src$core$utils$svg_math(this.svgHandle);c=this.horizontal?c.x:c.y;var d=this.handlePosition,e=.95*this.handleLength;b<=c?d-=e:b>=c+this.handleLength&&(d+=e);this.setHandlePosition(this.constrainHandlePosition(d));this.updateMetrics();a.stopPropagation();a.preventDefault()}}onMouseDownHandle(a){this.workspace.markFocused();\nthis.cleanUp();isRightButton$$module$build$src$core$browser_events(a)?a.stopPropagation():(this.startDragHandle=this.handlePosition,this.workspace.setupDragSurface(),this.startDragMouse=this.horizontal?a.clientX:a.clientY,this.onMouseUpWrapper_=conditionalBind$$module$build$src$core$browser_events(document,\"pointerup\",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=conditionalBind$$module$build$src$core$browser_events(document,\"pointermove\",this,this.onMouseMoveHandle),a.stopPropagation(),a.preventDefault())}onMouseMoveHandle(a){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+\n((this.horizontal?a.clientX:a.clientY)-this.startDragMouse)));this.updateMetrics()}onMouseUpHandle(){this.workspace.resetDragSurface();clearTouchIdentifier$$module$build$src$core$touch();this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0);this.onMouseUpWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null);this.onMouseMoveWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let a=\nthis.handlePosition/(this.scrollbarLength-this.handleLength);isNaN(a)&&(a=0);return a}updateMetrics(){const a=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:a}):this.workspace.setMetrics({y:a})}set(a,b){this.setHandlePosition(this.constrainHandlePosition(a*this.ratio));(b||void 0===b)&&this.updateMetrics()}setOrigin(a,b){this.origin=new Coordinate$$module$build$src$core$utils$coordinate(a,b)}static metricsAreEquivalent(a,b){return a.viewWidth===b.viewWidth&&a.viewHeight===b.viewHeight&&\na.viewLeft===b.viewLeft&&a.viewTop===b.viewTop&&a.absoluteTop===b.absoluteTop&&a.absoluteLeft===b.absoluteLeft&&a.scrollWidth===b.scrollWidth&&a.scrollHeight===b.scrollHeight&&a.scrollLeft===b.scrollLeft&&a.scrollTop===b.scrollTop}};Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness=TOUCH_ENABLED$$module$build$src$core$touch?25:15;Scrollbar$$module$build$src$core$scrollbar.DEFAULT_SCROLLBAR_MARGIN=.5;var module$build$src$core$scrollbar={};module$build$src$core$scrollbar.Scrollbar=Scrollbar$$module$build$src$core$scrollbar;var Bubble$$module$build$src$core$bubble=class{constructor(a,b,c,d,e,f){this.resizeGroup=this.bubbleBack=this.bubbleArrow=this.bubbleGroup=null;this.height=this.width=this.relativeTop=this.relativeLeft=0;this.autoLayout=!0;this.onMouseDownResizeWrapper=this.onMouseDownBubbleWrapper=this.moveCallback=this.resizeCallback=null;this.rendered=this.disposed=!1;this.workspace_=a;this.content_=b;this.shape_=c;c=Bubble$$module$build$src$core$bubble.ARROW_ANGLE;this.workspace_.RTL&&(c=-c);this.arrowRadians=\ntoRadians$$module$build$src$core$utils$math(c);a.getBubbleCanvas().appendChild(this.createDom(b,!(!e||!f)));this.setAnchorLocation(d);e&&f||(a=this.content_.getBBox(),e=a.width+2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH,f=a.height+2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH);this.setBubbleSize(e,f);this.positionBubble();this.renderArrow();this.rendered=!0}createDom(a,b){this.bubbleGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{});var c=\n{filter:\"url(#\"+this.workspace_.getRenderer().getConstants().embossFilterId+\")\"};JavaFx$$module$build$src$core$utils$useragent&&(c={});c=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,c,this.bubbleGroup);this.bubbleArrow=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{},c);this.bubbleBack=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyDraggable\",x:0,\ny:0,rx:Bubble$$module$build$src$core$bubble.BORDER_WIDTH,ry:Bubble$$module$build$src$core$bubble.BORDER_WIDTH},c);b?(this.resizeGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":this.workspace_.RTL?\"blocklyResizeSW\":\"blocklyResizeSE\"},this.bubbleGroup),b=2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH,createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.POLYGON,{points:\"0,x x,x x,0\".replace(/x/g,b.toString())},\nthis.resizeGroup),createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{\"class\":\"blocklyResizeLine\",x1:b/3,y1:b-1,x2:b-1,y2:b/3},this.resizeGroup),createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{\"class\":\"blocklyResizeLine\",x1:2*b/3,y1:b-1,x2:b-1,y2:2*b/3},this.resizeGroup)):this.resizeGroup=null;this.workspace_.options.readOnly||(this.onMouseDownBubbleWrapper=conditionalBind$$module$build$src$core$browser_events(this.bubbleBack,\n\"pointerdown\",this,this.bubbleMouseDown),this.resizeGroup&&(this.onMouseDownResizeWrapper=conditionalBind$$module$build$src$core$browser_events(this.resizeGroup,\"pointerdown\",this,this.resizeMouseDown)));this.bubbleGroup.appendChild(a);return this.bubbleGroup}getSvgRoot(){return this.bubbleGroup}setSvgId(a){let b;null==(b=this.bubbleGroup)||b.setAttribute(\"data-block-id\",a)}bubbleMouseDown(a){const b=this.workspace_.getGesture(a);b&&b.handleBubbleStart(a,this)}showContextMenu(a){}isDeletable(){return!1}setDeleteStyle(a){}resizeMouseDown(a){this.promote();\nBubble$$module$build$src$core$bubble.unbindDragEvents();isRightButton$$module$build$src$core$browser_events(a)||(this.workspace_.startDrag(a,new Coordinate$$module$build$src$core$utils$coordinate(this.workspace_.RTL?-this.width:this.width,this.height)),Bubble$$module$build$src$core$bubble.onMouseUpWrapper=conditionalBind$$module$build$src$core$browser_events(document,\"pointerup\",this,Bubble$$module$build$src$core$bubble.bubbleMouseUp),Bubble$$module$build$src$core$bubble.onMouseMoveWrapper=conditionalBind$$module$build$src$core$browser_events(document,\n\"pointermove\",this,this.resizeMouseMove),this.workspace_.hideChaff());a.stopPropagation()}resizeMouseMove(a){this.autoLayout=!1;a=this.workspace_.moveDrag(a);this.setBubbleSize(this.workspace_.RTL?-a.x:a.x,a.y);this.workspace_.RTL&&this.positionBubble()}registerResizeEvent(a){this.resizeCallback=a}registerMoveEvent(a){this.moveCallback=a}promote(){let a;const b=null==(a=this.bubbleGroup)?void 0:a.parentNode;return(null==b?void 0:b.lastChild)!==this.bubbleGroup&&this.bubbleGroup?(null==b||b.appendChild(this.bubbleGroup),\n!0):!1}setAnchorLocation(a){this.anchorXY=a;this.rendered&&this.positionBubble()}layoutBubble(){var a=this.workspace_.getMetricsManager().getViewMetrics(!0),b=this.getOptimalRelativeLeft(a),c=this.getOptimalRelativeTop(a),d=this.shape_.getBBox();const e={x:b,y:-this.height-this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT},f={x:-this.width-30,y:c};c={x:d.width,y:c};var g={x:b,y:d.height};b=d.width<d.height?c:g;d=d.width<d.height?g:c;c=this.getOverlap(e,a);g=this.getOverlap(f,a);const h=\nthis.getOverlap(b,a);a=this.getOverlap(d,a);a=Math.max(c,g,h,a);c===a?(this.relativeLeft=e.x,this.relativeTop=e.y):g===a?(this.relativeLeft=f.x,this.relativeTop=f.y):h===a?(this.relativeLeft=b.x,this.relativeTop=b.y):(this.relativeLeft=d.x,this.relativeTop=d.y)}getOverlap(a,b){var c=this.workspace_.RTL?this.anchorXY.x-a.x-this.width:a.x+this.anchorXY.x;a=a.y+this.anchorXY.y;return Math.max(0,Math.min(1,(Math.min(c+this.width,b.left+b.width)-Math.max(c,b.left))*(Math.min(a+this.height,b.top+b.height)-\nMath.max(a,b.top))/(this.width*this.height)))}getOptimalRelativeLeft(a){let b=-this.width/4;if(this.width>a.width)return b;if(this.workspace_.RTL){var c=this.anchorXY.x-b,d=a.left+a.width;a=a.left+Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness/this.workspace_.scale;c-this.width<a?b=-(a-this.anchorXY.x+this.width):c>d&&(b=-(d-this.anchorXY.x))}else{c=b+this.anchorXY.x;d=c+this.width;const e=a.left;a=a.left+a.width-Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness/this.workspace_.scale;\nc<e?b=e-this.anchorXY.x:d>a&&(b=a-this.anchorXY.x-this.width)}return b}getOptimalRelativeTop(a){let b=-this.height/4;if(this.height>a.height)return b;const c=this.anchorXY.y+b,d=c+this.height,e=a.top;a=a.top+a.height-Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness/this.workspace_.scale;const f=this.anchorXY.y;c<e?b=e-f:d>a&&(b=a-f-this.height);return b}positionBubble(){let a=this.anchorXY.x;a=this.workspace_.RTL?a-(this.relativeLeft+this.width):a+this.relativeLeft;this.moveTo(a,this.relativeTop+\nthis.anchorXY.y)}moveTo(a,b){let c;null==(c=this.bubbleGroup)||c.setAttribute(\"transform\",\"translate(\"+a+\",\"+b+\")\")}setDragging(a){!a&&this.moveCallback&&this.moveCallback()}getBubbleSize(){return new Size$$module$build$src$core$utils$size(this.width,this.height)}setBubbleSize(a,b){const c=2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH;a=Math.max(a,c+45);b=Math.max(b,c+20);this.width=a;this.height=b;let d;null==(d=this.bubbleBack)||d.setAttribute(\"width\",a.toString());let e;null==(e=this.bubbleBack)||\ne.setAttribute(\"height\",b.toString());this.resizeGroup&&(this.workspace_.RTL?this.resizeGroup.setAttribute(\"transform\",\"translate(\"+2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH+\",\"+(b-c)+\") scale(-1 1)\"):this.resizeGroup.setAttribute(\"transform\",\"translate(\"+(a-c)+\",\"+(b-c)+\")\"));this.autoLayout&&this.layoutBubble();this.positionBubble();this.renderArrow();this.resizeCallback&&this.resizeCallback()}renderArrow(){const a=[];var b=this.width/2,c=this.height/2,d=-this.relativeLeft,e=-this.relativeTop;\nif(b===d&&c===e)a.push(\"M \"+b+\",\"+c);else{e-=c;d-=b;this.workspace_.RTL&&(d*=-1);var f=Math.sqrt(e*e+d*d),g=Math.acos(d/f);0>e&&(g=2*Math.PI-g);var h=g+Math.PI/2;h>2*Math.PI&&(h-=2*Math.PI);var k=Math.sin(h);const n=Math.cos(h);var l=this.getBubbleSize();h=(l.width+l.height)/Bubble$$module$build$src$core$bubble.ARROW_THICKNESS;h=Math.min(h,l.width,l.height)/4;l=1-Bubble$$module$build$src$core$bubble.ANCHOR_RADIUS/f;d=b+l*d;e=c+l*e;l=b+h*n;const p=c+h*k;b-=h*n;c-=h*k;k=g+this.arrowRadians;k>2*Math.PI&&\n(k-=2*Math.PI);g=Math.sin(k)*f/Bubble$$module$build$src$core$bubble.ARROW_BEND;f=Math.cos(k)*f/Bubble$$module$build$src$core$bubble.ARROW_BEND;a.push(\"M\"+l+\",\"+p);a.push(\"C\"+(l+f)+\",\"+(p+g)+\" \"+d+\",\"+e+\" \"+d+\",\"+e);a.push(\"C\"+d+\",\"+e+\" \"+(b+f)+\",\"+(c+g)+\" \"+b+\",\"+c)}a.push(\"z\");let m;null==(m=this.bubbleArrow)||m.setAttribute(\"d\",a.join(\" \"))}setColour(a){let b;null==(b=this.bubbleBack)||b.setAttribute(\"fill\",a);let c;null==(c=this.bubbleArrow)||c.setAttribute(\"fill\",a)}dispose(){this.onMouseDownBubbleWrapper&&\nunbind$$module$build$src$core$browser_events(this.onMouseDownBubbleWrapper);this.onMouseDownResizeWrapper&&unbind$$module$build$src$core$browser_events(this.onMouseDownResizeWrapper);Bubble$$module$build$src$core$bubble.unbindDragEvents();removeNode$$module$build$src$core$utils$dom(this.bubbleGroup);this.disposed=!0}moveDuringDrag(a,b){a?a.translateSurface(b.x,b.y):this.moveTo(b.x,b.y);this.relativeLeft=this.workspace_.RTL?this.anchorXY.x-b.x-this.width:b.x-this.anchorXY.x;this.relativeTop=b.y-this.anchorXY.y;\nthis.renderArrow()}getRelativeToSurfaceXY(){return new Coordinate$$module$build$src$core$utils$coordinate(this.workspace_.RTL?-this.relativeLeft+this.anchorXY.x-this.width:this.anchorXY.x+this.relativeLeft,this.anchorXY.y+this.relativeTop)}setAutoLayout(a){this.autoLayout=a}static unbindDragEvents(){Bubble$$module$build$src$core$bubble.onMouseUpWrapper&&(unbind$$module$build$src$core$browser_events(Bubble$$module$build$src$core$bubble.onMouseUpWrapper),Bubble$$module$build$src$core$bubble.onMouseUpWrapper=\nnull);Bubble$$module$build$src$core$bubble.onMouseMoveWrapper&&(unbind$$module$build$src$core$browser_events(Bubble$$module$build$src$core$bubble.onMouseMoveWrapper),Bubble$$module$build$src$core$bubble.onMouseMoveWrapper=null)}static bubbleMouseUp(a){clearTouchIdentifier$$module$build$src$core$touch();Bubble$$module$build$src$core$bubble.unbindDragEvents()}static textToDom(a){const b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TEXT,{\"class\":\"blocklyText blocklyBubbleText blocklyNoPointerEvents\",\ny:Bubble$$module$build$src$core$bubble.BORDER_WIDTH});a=a.split(\"\\n\");for(let c=0;c<a.length;c++){const d=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TSPAN,{dy:\"1em\",x:Bubble$$module$build$src$core$bubble.BORDER_WIDTH},b),e=document.createTextNode(a[c]);d.appendChild(e)}return b}static createNonEditableBubble(a,b,c){c=new Bubble$$module$build$src$core$bubble(b.workspace,a,b.pathObject.svgPath,c,null,null);c.setSvgId(b.id);if(b.RTL){b=a.getBBox().width;for(let d=\n0,e;e=a.childNodes[d];d++)e.setAttribute(\"text-anchor\",\"end\"),e.setAttribute(\"x\",(b+Bubble$$module$build$src$core$bubble.BORDER_WIDTH).toString())}return c}};Bubble$$module$build$src$core$bubble.BORDER_WIDTH=6;Bubble$$module$build$src$core$bubble.ARROW_THICKNESS=5;Bubble$$module$build$src$core$bubble.ARROW_ANGLE=20;Bubble$$module$build$src$core$bubble.ARROW_BEND=4;Bubble$$module$build$src$core$bubble.ANCHOR_RADIUS=8;Bubble$$module$build$src$core$bubble.onMouseUpWrapper=null;\nBubble$$module$build$src$core$bubble.onMouseMoveWrapper=null;var module$build$src$core$bubble={};module$build$src$core$bubble.Bubble=Bubble$$module$build$src$core$bubble;var DEFAULT_SNAP_RADIUS$$module$build$src$core$config,module$build$src$core$config;DEFAULT_SNAP_RADIUS$$module$build$src$core$config=28;$.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:DEFAULT_SNAP_RADIUS$$module$build$src$core$config,connectingSnapRadius:DEFAULT_SNAP_RADIUS$$module$build$src$core$config,currentConnectionPreference:8,bumpDelay:250};module$build$src$core$config={};module$build$src$core$config.config=$.config$$module$build$src$core$config;var Icon$$module$build$src$core$icon=class{constructor(a){this.iconGroup_=null;this.collapseHidden=!0;this.SIZE=17;this.iconXY_=this.bubble_=null;a||warn$$module$build$src$core$utils$deprecation(\"Calling the Icon constructor with a null block\",\"version 9\",\"version 10\",\"a non-null block\");this.block_=a}createIcon(){this.iconGroup_||(this.iconGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyIconGroup\"}),this.getBlock().isInFlyout&&addClass$$module$build$src$core$utils$dom(this.iconGroup_,\n\"blocklyIconGroupReadonly\"),this.drawIcon_(this.iconGroup_),this.getBlock().getSvgRoot().appendChild(this.iconGroup_),conditionalBind$$module$build$src$core$browser_events(this.iconGroup_,\"pointerup\",this,this.iconClick_),this.updateEditable())}dispose(){removeNode$$module$build$src$core$utils$dom(this.iconGroup_);this.setVisible(!1)}updateEditable(){}isVisible(){return!!this.bubble_}iconClick_(a){this.getBlock().workspace.isDragging()||this.getBlock().isInFlyout||isRightButton$$module$build$src$core$browser_events(a)||\nthis.setVisible(!this.isVisible())}applyColour(){this.bubble_&&this.isVisible()&&this.bubble_.setColour(this.getBlock().style.colourPrimary)}setIconLocation(a){this.iconXY_=a;this.bubble_&&this.isVisible()&&this.bubble_.setAnchorLocation(a)}computeIconLocation(){var a=this.getBlock().getRelativeToSurfaceXY();const b=getRelativeXY$$module$build$src$core$utils$svg_math(this.iconGroup_);a=new Coordinate$$module$build$src$core$utils$coordinate(a.x+b.x+this.SIZE/2,a.y+b.y+this.SIZE/2);Coordinate$$module$build$src$core$utils$coordinate.equals(this.getIconLocation(),\na)||this.setIconLocation(a)}getIconLocation(){return this.iconXY_}getCorrectedSize(){return new Size$$module$build$src$core$utils$size(this.SIZE,this.SIZE-2)}drawIcon_(a){}setVisible(a){}getBlock(){if(!this.block_)throw Error(\"Block is not set for this icon.\");return this.block_}},module$build$src$core$icon={};module$build$src$core$icon.Icon=Icon$$module$build$src$core$icon;var module$build$src$core$utils$object={};module$build$src$core$utils$object.deepMerge=deepMerge$$module$build$src$core$utils$object;module$build$src$core$utils$object.inherits=inherits$$module$build$src$core$utils$object;module$build$src$core$utils$object.mixin=mixin$$module$build$src$core$utils$object;module$build$src$core$utils$object.values=values$$module$build$src$core$utils$object;var Theme$$module$build$src$core$theme=class{constructor(a,b,c,d){this.name=a;this.startHats=!1;this.blockStyles=b||Object.create(null);this.categoryStyles=c||Object.create(null);this.componentStyles=d||Object.create(null);this.fontStyle=Object.create(null);register$$module$build$src$core$registry(Type$$module$build$src$core$registry.THEME,a,this)}getClassName(){return this.name+\"-theme\"}setBlockStyle(a,b){this.blockStyles[a]=b}setCategoryStyle(a,b){this.categoryStyles[a]=b}getComponentStyle(a){return(a=\nthis.componentStyles[a])&&\"string\"===typeof a&&this.getComponentStyle(a)?this.getComponentStyle(a):a?String(a):null}setComponentStyle(a,b){this.componentStyles[a]=b}setFontStyle(a){this.fontStyle=a}setStartHats(a){this.startHats=a}static defineTheme(a,b){a=a.toLowerCase();const c=new Theme$$module$build$src$core$theme(a);let d=b.base;if(d){if(\"string\"===typeof d){let e;d=null!=(e=getObject$$module$build$src$core$registry(Type$$module$build$src$core$registry.THEME,d))?e:void 0}d instanceof Theme$$module$build$src$core$theme&&\n(deepMerge$$module$build$src$core$utils$object(c,d),c.name=a)}deepMerge$$module$build$src$core$utils$object(c.blockStyles,b.blockStyles);deepMerge$$module$build$src$core$utils$object(c.categoryStyles,b.categoryStyles);deepMerge$$module$build$src$core$utils$object(c.componentStyles,b.componentStyles);deepMerge$$module$build$src$core$utils$object(c.fontStyle,b.fontStyle);null!==b.startHats&&(c.startHats=b.startHats);return c}},module$build$src$core$theme={};module$build$src$core$theme.Theme=Theme$$module$build$src$core$theme;var defaultBlockStyles$$module$build$src$core$theme$classic={colour_blocks:{colourPrimary:\"20\"},list_blocks:{colourPrimary:\"260\"},logic_blocks:{colourPrimary:\"210\"},loop_blocks:{colourPrimary:\"120\"},math_blocks:{colourPrimary:\"230\"},procedure_blocks:{colourPrimary:\"290\"},text_blocks:{colourPrimary:\"160\"},variable_blocks:{colourPrimary:\"330\"},variable_dynamic_blocks:{colourPrimary:\"310\"},hat_blocks:{colourPrimary:\"330\",hat:\"cap\"}},categoryStyles$$module$build$src$core$theme$classic={colour_category:{colour:\"20\"},\nlist_category:{colour:\"260\"},logic_category:{colour:\"210\"},loop_category:{colour:\"120\"},math_category:{colour:\"230\"},procedure_category:{colour:\"290\"},text_category:{colour:\"160\"},variable_category:{colour:\"330\"},variable_dynamic_category:{colour:\"310\"}},Classic$$module$build$src$core$theme$classic=new Theme$$module$build$src$core$theme(\"classic\",defaultBlockStyles$$module$build$src$core$theme$classic,categoryStyles$$module$build$src$core$theme$classic),module$build$src$core$theme$classic={};\nmodule$build$src$core$theme$classic.Classic=Classic$$module$build$src$core$theme$classic;var CATEGORY_TOOLBOX_KIND$$module$build$src$core$utils$toolbox=\"categoryToolbox\",FLYOUT_TOOLBOX_KIND$$module$build$src$core$utils$toolbox=\"flyoutToolbox\",Position$$module$build$src$core$utils$toolbox;(function(a){a[a.TOP=0]=\"TOP\";a[a.BOTTOM=1]=\"BOTTOM\";a[a.LEFT=2]=\"LEFT\";a[a.RIGHT=3]=\"RIGHT\"})(Position$$module$build$src$core$utils$toolbox||(Position$$module$build$src$core$utils$toolbox={}));\nvar TEST_ONLY$$module$build$src$core$utils$toolbox={hasCategoriesInternal:hasCategoriesInternal$$module$build$src$core$utils$toolbox},module$build$src$core$utils$toolbox={};module$build$src$core$utils$toolbox.Position=Position$$module$build$src$core$utils$toolbox;module$build$src$core$utils$toolbox.TEST_ONLY=TEST_ONLY$$module$build$src$core$utils$toolbox;module$build$src$core$utils$toolbox.convertFlyoutDefToJsonArray=convertFlyoutDefToJsonArray$$module$build$src$core$utils$toolbox;\nmodule$build$src$core$utils$toolbox.convertToolboxDefToJson=convertToolboxDefToJson$$module$build$src$core$utils$toolbox;module$build$src$core$utils$toolbox.hasCategories=hasCategories$$module$build$src$core$utils$toolbox;module$build$src$core$utils$toolbox.isCategoryCollapsible=isCategoryCollapsible$$module$build$src$core$utils$toolbox;module$build$src$core$utils$toolbox.parseToolboxTree=parseToolboxTree$$module$build$src$core$utils$toolbox;var Options$$module$build$src$core$options=class{constructor(a){this.gridPattern=null;this.getMetrics=this.setMetrics=void 0;let b=null,c=!1;var d=!1,e=!1,f=!1,g=!1,h=!1;const k=!!a.readOnly;if(!k){var l;b=convertToolboxDefToJson$$module$build$src$core$utils$toolbox(null!=(l=a.toolbox)?l:null);c=hasCategories$$module$build$src$core$utils$toolbox(b);d=a.trashcan;d=void 0===d?c:d;e=a.collapse;e=void 0===e?c:e;f=a.comments;f=void 0===f?c:f;g=a.disable;g=void 0===g?c:g;h=a.sounds;h=void 0===h?!0:h}l=\na.maxTrashcanContents;d?void 0===l&&(l=32):l=0;const m=!!a.rtl;let n=a.horizontalLayout;void 0===n&&(n=!1);var p=\"end\"!==a.toolboxPosition;p=n?p?Position$$module$build$src$core$utils$toolbox.TOP:Position$$module$build$src$core$utils$toolbox.BOTTOM:p===m?Position$$module$build$src$core$utils$toolbox.RIGHT:Position$$module$build$src$core$utils$toolbox.LEFT;let q=a.css;void 0===q&&(q=!0);let r=\"https://blockly-demo.appspot.com/static/media/\";a.media?r=a.media.endsWith(\"/\")?a.media:a.media+\"/\":\"path\"in\na&&(warn$$module$build$src$core$utils$deprecation(\"path\",\"Nov 2014\",\"Jul 2023\",\"media\"),r=a.path+\"media/\");const u=a.oneBasedIndex,y=a.renderer||\"geras\",z=a.plugins||{};let t=a.modalInputs;void 0===t&&(t=!0);this.RTL=m;this.oneBasedIndex=void 0===u?!0:u;this.collapse=e;this.comments=f;this.disable=g;this.readOnly=k;this.maxBlocks=a.maxBlocks||Infinity;let v;this.maxInstances=null!=(v=a.maxInstances)?v:null;this.modalInputs=t;this.pathToMedia=r;this.hasCategories=c;this.moveOptions=Options$$module$build$src$core$options.parseMoveOptions_(a,\nc);this.hasScrollbars=!!this.moveOptions.scrollbars;this.hasTrashcan=d;this.maxTrashcanContents=l;this.hasSounds=h;this.hasCss=q;this.horizontalLayout=n;this.languageTree=b;this.gridOptions=Options$$module$build$src$core$options.parseGridOptions_(a);this.zoomOptions=Options$$module$build$src$core$options.parseZoomOptions_(a);this.toolboxPosition=p;this.theme=Options$$module$build$src$core$options.parseThemeOptions_(a);this.renderer=y;let w;this.rendererOverrides=null!=(w=a.rendererOverrides)?w:null;\nlet x;this.parentWorkspace=null!=(x=a.parentWorkspace)?x:null;this.plugins=z}static parseMoveOptions_(a,b){const c=a.move||{},d={};void 0===c.scrollbars&&void 0===a.scrollbars?d.scrollbars=b:\"object\"===typeof c.scrollbars?(d.scrollbars={horizontal:!!c.scrollbars.horizontal,vertical:!!c.scrollbars.vertical},d.scrollbars.horizontal&&d.scrollbars.vertical?d.scrollbars=!0:d.scrollbars.horizontal||d.scrollbars.vertical||(d.scrollbars=!1)):d.scrollbars=!!c.scrollbars||!!a.scrollbars;d.wheel=d.scrollbars&&\nvoid 0!==c.wheel?!!c.wheel:\"object\"===typeof d.scrollbars;d.drag=d.scrollbars?void 0===c.drag?!0:!!c.drag:!1;return d}static parseZoomOptions_(a){a=a.zoom||{};const b={};b.controls=void 0===a.controls?!1:!!a.controls;b.wheel=void 0===a.wheel?!1:!!a.wheel;b.startScale=void 0===a.startScale?1:Number(a.startScale);b.maxScale=void 0===a.maxScale?3:Number(a.maxScale);b.minScale=void 0===a.minScale?.3:Number(a.minScale);b.scaleSpeed=void 0===a.scaleSpeed?1.2:Number(a.scaleSpeed);b.pinch=void 0===a.pinch?\nb.wheel||b.controls:!!a.pinch;return b}static parseGridOptions_(a){a=a.grid||{};const b={};b.spacing=Number(a.spacing)||0;b.colour=a.colour||\"#888\";b.length=void 0===a.length?1:Number(a.length);b.snap=0<b.spacing&&!!a.snap;return b}static parseThemeOptions_(a){a=a.theme||Classic$$module$build$src$core$theme$classic;return\"string\"===typeof a?getObject$$module$build$src$core$registry(Type$$module$build$src$core$registry.THEME,a):a instanceof Theme$$module$build$src$core$theme?a:Theme$$module$build$src$core$theme.defineTheme(a.name||\n\"builtin\"+getNextUniqueId$$module$build$src$core$utils$idgenerator(),a)}},module$build$src$core$options={};module$build$src$core$options.Options=Options$$module$build$src$core$options;var module$build$src$core$mutator;\n$.Mutator$$module$build$src$core$mutator=class extends Icon$$module$build$src$core$icon{constructor(a,b){b||warn$$module$build$src$core$utils$deprecation(\"Calling the Mutator constructor without passing the block it is attached to\",\"version 9\",\"version 10\",\"the constructor by passing the list of subblocks and the block instance to attach the mutator to\");super(null!=b?b:null);this.workspace_=null;this.workspaceHeight=this.workspaceWidth=0;this.updateWorkspacePid=this.sourceListener=this.rootBlock=\nthis.svgDialog=null;this.quarkNames=a}setBlock(a){this.block_=a}getWorkspace(){return this.workspace_}drawIcon_(a){createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyIconShape\",rx:\"4\",ry:\"4\",height:\"16\",width:\"16\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyIconSymbol\",d:\"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z\"},\na);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,{\"class\":\"blocklyIconShape\",r:\"2.7\",cx:\"8\",cy:\"8\"},a)}iconClick_(a){this.getBlock().isEditable()&&super.iconClick_(a)}createEditor(){this.svgDialog=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.SVG,{x:Bubble$$module$build$src$core$bubble.BORDER_WIDTH,y:Bubble$$module$build$src$core$bubble.BORDER_WIDTH});if(this.quarkNames.length){var a=createElement$$module$build$src$core$utils$xml(\"xml\");\nfor(let d=0,e;e=this.quarkNames[d];d++){var b=createElement$$module$build$src$core$utils$xml(\"block\");b.setAttribute(\"type\",e);a.appendChild(b)}}else a=null;var c=this.getBlock();b=new Options$$module$build$src$core$options({disable:!1,parentWorkspace:c.workspace,media:c.workspace.options.pathToMedia,rtl:c.RTL,horizontalLayout:!1,renderer:c.workspace.options.renderer,rendererOverrides:c.workspace.options.rendererOverrides});b.toolboxPosition=c.RTL?Position$$module$build$src$core$utils$toolbox.RIGHT:\nPosition$$module$build$src$core$utils$toolbox.LEFT;if(c=!!a)b.languageTree=convertToolboxDefToJson$$module$build$src$core$utils$toolbox(a);this.workspace_=this.newWorkspaceSvg(b);this.workspace_.internalIsMutator=!0;this.workspace_.addChangeListener(disableOrphans$$module$build$src$core$events$utils);a=c?this.workspace_.addFlyout(Svg$$module$build$src$core$utils$svg.G):null;b=this.workspace_.createDom(\"blocklyMutatorBackground\");a&&b.insertBefore(a,this.workspace_.svgBlockCanvas_);this.svgDialog.appendChild(b);\nreturn this.svgDialog}newWorkspaceSvg(a){throw Error(\"The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts\");}updateEditable(){super.updateEditable();this.getBlock().isInFlyout||(this.getBlock().isEditable()?this.iconGroup_&&removeClass$$module$build$src$core$utils$dom(this.iconGroup_,\"blocklyIconGroupReadonly\"):(this.setVisible(!1),this.iconGroup_&&addClass$$module$build$src$core$utils$dom(this.iconGroup_,\"blocklyIconGroupReadonly\")))}resizeBubble(){if(this.workspace_){var a=\n2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH,b=this.workspace_.getCanvas(),c=b.getBBox(),d=c.width+c.x,e=c.height+3*a,f=this.workspace_.getFlyout();if(f){const g=f.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,g.height+20);d+=f.getWidth()}(f=this.getBlock().RTL)&&(d=-c.x);d+=3*a;if(Math.abs(this.workspaceWidth-d)>a||Math.abs(this.workspaceHeight-e)>a)this.workspaceWidth=d,this.workspaceHeight=e,this.bubble_.setBubbleSize(d+a,e+a),this.svgDialog.setAttribute(\"width\",`${d}`),\nthis.svgDialog.setAttribute(\"height\",`${e}`),this.workspace_.setCachedParentSvgSize(d,e);f&&b.setAttribute(\"transform\",`translate(${this.workspaceWidth}, 0)`);this.workspace_.resize()}}onBubbleMove(){this.workspace_&&this.workspace_.recordDragTargets()}setVisible(a){if(a!==this.isVisible()){var b=this.getBlock();fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(BUBBLE_OPEN$$module$build$src$core$events$utils))(b,a,\"mutator\"));if(a){this.bubble_=new Bubble$$module$build$src$core$bubble(b.workspace,\nthis.createEditor(),b.pathObject.svgPath,this.iconXY_,null,null);a=this.workspace_;this.bubble_.setSvgId(b.id);this.bubble_.registerMoveEvent(this.onBubbleMove.bind(this));var c=a.options.languageTree,d=a.getFlyout();c&&(d.init(a),d.show(c));this.rootBlock=b.decompose(a);c=this.rootBlock.getDescendants(!1);for(let e=0,f;f=c[e];e++)f.render();this.rootBlock.setMovable(!1);this.rootBlock.setDeletable(!1);d?(c=2*d.CORNER_RADIUS,d=this.rootBlock.RTL?d.getWidth()+c:c):d=c=16;b.RTL&&(d=-d);this.rootBlock.moveBy(d,\nc);if(b.saveConnections){const e=this.rootBlock;b.saveConnections(e);this.sourceListener=()=>{const f=this.getBlock();f.saveConnections&&f.saveConnections(e)};b.workspace.addChangeListener(this.sourceListener)}this.resizeBubble();a.addChangeListener(this.workspaceChanged.bind(this));this.updateWorkspace();this.applyColour()}else this.svgDialog=null,this.workspace_.dispose(),this.rootBlock=this.workspace_=null,null==(d=this.bubble_)||d.dispose(),this.bubble_=null,this.workspaceHeight=this.workspaceWidth=\n0,this.sourceListener&&(b.workspace.removeChangeListener(this.sourceListener),this.sourceListener=null)}}workspaceChanged(a){this.shouldIgnoreMutatorEvent_(a)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout(()=>{this.updateWorkspacePid=null;this.updateWorkspace()},0))}shouldIgnoreMutatorEvent_(a){return a.isUiEvent||a.type===CREATE$$module$build$src$core$events$utils||a.type===CHANGE$$module$build$src$core$events$utils&&\"disabled\"===a.element}updateWorkspace(){if(!this.workspace_.isDragging()){var a=\nthis.workspace_.getTopBlocks(!1);for(let d=0,e;e=a[d];d++){var b=e.getRelativeToSurfaceXY();20>b.y&&e.moveBy(0,20-b.y);if(e.RTL){var c=-20;const f=this.workspace_.getFlyout();f&&(c-=f.getWidth());b.x>c&&e.moveBy(c-b.x,0)}else 20>b.x&&e.moveBy(20-b.x,0)}}if(this.rootBlock&&this.rootBlock.workspace===this.workspace_){(a=getGroup$$module$build$src$core$events$utils())||setGroup$$module$build$src$core$events$utils(!0);const d=this.getBlock();b=BlockChange$$module$build$src$core$events$events_block_change.getExtraBlockState_(d);\nc=d.rendered;d.rendered=!1;d.compose(this.rootBlock);d.rendered=c;d.initSvg();d.rendered&&d.render();c=BlockChange$$module$build$src$core$events$events_block_change.getExtraBlockState_(d);if(b!==c){fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(d,\"mutation\",null,b,c));const e=getGroup$$module$build$src$core$events$utils();setTimeout(function(){const f=getGroup$$module$build$src$core$events$utils();setGroup$$module$build$src$core$events$utils(e);\nd.bumpNeighbours();setGroup$$module$build$src$core$events$utils(f)},$.config$$module$build$src$core$config.bumpDelay)}this.workspace_.isDragging()||setTimeout(()=>this.resizeBubble(),0);setGroup$$module$build$src$core$events$utils(a)}}dispose(){this.getBlock().mutator=null;super.dispose()}updateBlockStyle(){var a=this.workspace_;if(a&&a.getAllBlocks(!1)){const b=a.getAllBlocks(!1);for(let c=0,d;d=b[c];c++)d.setStyle(d.getStyleName());if(a=a.getFlyout()){a=a.getWorkspace().getAllBlocks(!1);for(let c=\n0,d;d=a[c];c++)d.setStyle(d.getStyleName())}}}static reconnect(a,b,c){if(!a||!a.getSourceBlock().workspace)return!1;c=b.getInput(c).connection;const d=a.targetBlock();return d&&d!==b||!c||c.targetConnection===a?!1:(c.isConnected()&&c.disconnect(),c.connect(a),!0)}static findParentWs(a){let b=null;if(a&&a.options){const c=a.options.parentWorkspace;a.isFlyout?c&&c.options&&(b=c.options.parentWorkspace):c&&(b=c)}return b}};module$build$src$core$mutator={};module$build$src$core$mutator.Mutator=$.Mutator$$module$build$src$core$mutator;var allExtensions$$module$build$src$core$extensions=Object.create(null),TEST_ONLY$$module$build$src$core$extensions={allExtensions:allExtensions$$module$build$src$core$extensions};register$$module$build$src$core$extensions(\"parent_tooltip_when_inline\",extensionParentTooltip$$module$build$src$core$extensions);$.module$build$src$core$extensions={};$.module$build$src$core$extensions.TEST_ONLY=TEST_ONLY$$module$build$src$core$extensions;$.module$build$src$core$extensions.apply=apply$$module$build$src$core$extensions;\n$.module$build$src$core$extensions.buildTooltipForDropdown=buildTooltipForDropdown$$module$build$src$core$extensions;$.module$build$src$core$extensions.buildTooltipWithFieldText=buildTooltipWithFieldText$$module$build$src$core$extensions;$.module$build$src$core$extensions.isRegistered=isRegistered$$module$build$src$core$extensions;$.module$build$src$core$extensions.register=register$$module$build$src$core$extensions;$.module$build$src$core$extensions.registerMixin=registerMixin$$module$build$src$core$extensions;\n$.module$build$src$core$extensions.registerMutator=registerMutator$$module$build$src$core$extensions;$.module$build$src$core$extensions.runAfterPageLoad=runAfterPageLoad$$module$build$src$core$extensions;$.module$build$src$core$extensions.unregister=unregister$$module$build$src$core$extensions;var module$build$src$core$utils$array={};module$build$src$core$utils$array.removeElem=removeElem$$module$build$src$core$utils$array;var module$build$src$core$utils$svg_paths={};module$build$src$core$utils$svg_paths.arc=arc$$module$build$src$core$utils$svg_paths;module$build$src$core$utils$svg_paths.curve=curve$$module$build$src$core$utils$svg_paths;module$build$src$core$utils$svg_paths.line=line$$module$build$src$core$utils$svg_paths;module$build$src$core$utils$svg_paths.lineOnAxis=lineOnAxis$$module$build$src$core$utils$svg_paths;module$build$src$core$utils$svg_paths.lineTo=lineTo$$module$build$src$core$utils$svg_paths;\nmodule$build$src$core$utils$svg_paths.moveBy=moveBy$$module$build$src$core$utils$svg_paths;module$build$src$core$utils$svg_paths.moveTo=moveTo$$module$build$src$core$utils$svg_paths;module$build$src$core$utils$svg_paths.point=point$$module$build$src$core$utils$svg_paths;var getInjectionDivXY_$$module$build$src$core$utils=getInjectionDivXY$$module$build$src$core$utils,module$build$src$core$utils={};module$build$src$core$utils.Coordinate=Coordinate$$module$build$src$core$utils$coordinate;module$build$src$core$utils.KeyCodes=KeyCodes$$module$build$src$core$utils$keycodes;module$build$src$core$utils.Rect=Rect$$module$build$src$core$utils$rect;module$build$src$core$utils.Size=Size$$module$build$src$core$utils$size;module$build$src$core$utils.Svg=Svg$$module$build$src$core$utils$svg;\nmodule$build$src$core$utils.aria=module$build$src$core$utils$aria;module$build$src$core$utils.array=module$build$src$core$utils$array;module$build$src$core$utils.arrayRemove=arrayRemove$$module$build$src$core$utils;module$build$src$core$utils.browserEvents=module$build$src$core$browser_events;module$build$src$core$utils.checkMessageReferences=checkMessageReferences$$module$build$src$core$utils;module$build$src$core$utils.colour=module$build$src$core$utils$colour;\nmodule$build$src$core$utils.deprecation=module$build$src$core$utils$deprecation;module$build$src$core$utils.dom=module$build$src$core$utils$dom;module$build$src$core$utils.extensions=$.module$build$src$core$extensions;module$build$src$core$utils.getBlockTypeCounts=getBlockTypeCounts$$module$build$src$core$utils;module$build$src$core$utils.getDocumentScroll=getDocumentScroll$$module$build$src$core$utils;module$build$src$core$utils.getInjectionDivXY_=getInjectionDivXY$$module$build$src$core$utils;\nmodule$build$src$core$utils.getRelativeXY=getRelativeXY$$module$build$src$core$utils;module$build$src$core$utils.getViewportBBox=getViewportBBox$$module$build$src$core$utils;module$build$src$core$utils.idGenerator=module$build$src$core$utils$idgenerator;module$build$src$core$utils.is3dSupported=is3dSupported$$module$build$src$core$utils;module$build$src$core$utils.math=module$build$src$core$utils$math;module$build$src$core$utils.object=module$build$src$core$utils$object;\nmodule$build$src$core$utils.parseBlockColour=parseBlockColour$$module$build$src$core$utils;module$build$src$core$utils.parsing=module$build$src$core$utils$parsing;module$build$src$core$utils.replaceMessageReferences=replaceMessageReferences$$module$build$src$core$utils;module$build$src$core$utils.runAfterPageLoad=runAfterPageLoad$$module$build$src$core$utils;module$build$src$core$utils.screenToWsCoordinates=screenToWsCoordinates$$module$build$src$core$utils;module$build$src$core$utils.string=$.module$build$src$core$utils$string;\nmodule$build$src$core$utils.style=module$build$src$core$utils$style;module$build$src$core$utils.svgMath=module$build$src$core$utils$svg_math;module$build$src$core$utils.svgPaths=module$build$src$core$utils$svg_paths;module$build$src$core$utils.tokenizeInterpolation=tokenizeInterpolation$$module$build$src$core$utils;module$build$src$core$utils.toolbox=module$build$src$core$utils$toolbox;module$build$src$core$utils.userAgent=module$build$src$core$utils$useragent;module$build$src$core$utils.xml=$.module$build$src$core$utils$xml;var TrashcanOpen$$module$build$src$core$events$events_trashcan_open=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b){super(b);this.type=TRASHCAN_OPEN$$module$build$src$core$events$utils;this.isOpen=a}toJson(){const a=super.toJson();if(void 0===this.isOpen)throw Error(\"Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson\");a.isOpen=this.isOpen;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.TrashcanOpen.prototype.fromJson\",\n\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.isOpen=a.isOpen}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new TrashcanOpen$$module$build$src$core$events$events_trashcan_open);b.isOpen=a.isOpen;return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,TRASHCAN_OPEN$$module$build$src$core$events$utils,TrashcanOpen$$module$build$src$core$events$events_trashcan_open);var module$build$src$core$events$events_trashcan_open={};\nmodule$build$src$core$events$events_trashcan_open.TrashcanOpen=TrashcanOpen$$module$build$src$core$events$events_trashcan_open;var Capability$$module$build$src$core$component_manager=class{constructor(a){this.name_=a}toString(){return this.name_}};Capability$$module$build$src$core$component_manager.POSITIONABLE=new Capability$$module$build$src$core$component_manager(\"positionable\");Capability$$module$build$src$core$component_manager.DRAG_TARGET=new Capability$$module$build$src$core$component_manager(\"drag_target\");Capability$$module$build$src$core$component_manager.DELETE_AREA=new Capability$$module$build$src$core$component_manager(\"delete_area\");\nCapability$$module$build$src$core$component_manager.AUTOHIDEABLE=new Capability$$module$build$src$core$component_manager(\"autohideable\");\nvar ComponentManager$$module$build$src$core$component_manager=class{constructor(){this.componentData=new Map;this.capabilityToComponentIds=new Map}addComponent(a,b){const c=a.component.id;if(!b&&this.componentData.has(c)){var d;throw Error('Plugin \"'+c+'\" with capabilities \"'+(null==(d=this.componentData.get(c))?void 0:d.capabilities)+'\" already added.');}this.componentData.set(c,a);b=[];for(d=0;d<a.capabilities.length;d++){const e=String(a.capabilities[d]).toLowerCase();b.push(e);if(this.capabilityToComponentIds.has(e)){let f;\nnull==(f=this.capabilityToComponentIds.get(e))||f.push(c)}else this.capabilityToComponentIds.set(e,[c])}this.componentData.get(c).capabilities=b}removeComponent(a){const b=this.componentData.get(a);if(b){for(let c=0;c<b.capabilities.length;c++){const d=String(b.capabilities[c]).toLowerCase();removeElem$$module$build$src$core$utils$array(this.capabilityToComponentIds.get(d),a)}this.componentData.delete(a)}}addCapability(a,b){if(!this.getComponent(a))throw Error('Cannot add capability, \"'+b+'\". Plugin \"'+\na+'\" has not been added to the ComponentManager');if(this.hasCapability(a,b))console.warn('Plugin \"'+a+'already has capability \"'+b+'\"');else{b=String(b).toLowerCase();var c;null==(c=this.componentData.get(a))||c.capabilities.push(b);var d;null==(d=this.capabilityToComponentIds.get(b))||d.push(a)}}removeCapability(a,b){if(!this.getComponent(a))throw Error('Cannot remove capability, \"'+b+'\". Plugin \"'+a+'\" has not been added to the ComponentManager');this.hasCapability(a,b)?(b=String(b).toLowerCase(),\nremoveElem$$module$build$src$core$utils$array(this.componentData.get(a).capabilities,b),removeElem$$module$build$src$core$utils$array(this.capabilityToComponentIds.get(b),a)):console.warn('Plugin \"'+a+\"doesn't have capability \\\"\"+b+'\" to remove')}hasCapability(a,b){b=String(b).toLowerCase();return this.componentData.has(a)&&-1!==this.componentData.get(a).capabilities.indexOf(b)}getComponent(a){let b;return null==(b=this.componentData.get(a))?void 0:b.component}getComponents(a,b){a=String(a).toLowerCase();\na=this.capabilityToComponentIds.get(a);if(!a)return[];const c=[];if(b){const d=[];a.forEach(e=>{d.push(this.componentData.get(e))});d.sort(function(e,f){return e.weight-f.weight});d.forEach(function(e){c.push(e.component)})}else a.forEach(d=>{c.push(this.componentData.get(d).component)});return c}};ComponentManager$$module$build$src$core$component_manager.Capability=Capability$$module$build$src$core$component_manager;var module$build$src$core$component_manager={};\nmodule$build$src$core$component_manager.ComponentManager=ComponentManager$$module$build$src$core$component_manager;var DeserializationError$$module$build$src$core$serialization$exceptions=class extends Error{},MissingBlockType$$module$build$src$core$serialization$exceptions=class extends DeserializationError$$module$build$src$core$serialization$exceptions{constructor(a){super(\"Expected to find a 'type' property, defining the block type\");this.state=a}},MissingConnection$$module$build$src$core$serialization$exceptions=class extends DeserializationError$$module$build$src$core$serialization$exceptions{constructor(a,\nb,c){super(`The block ${b.toDevString()} is missing a(n) ${a}\nconnection`);this.block=b;this.state=c}},BadConnectionCheck$$module$build$src$core$serialization$exceptions=class extends DeserializationError$$module$build$src$core$serialization$exceptions{constructor(a,b,c,d){super(`The block ${c.toDevString()} could not connect its\n${b} to its parent, because: ${a}`);this.childBlock=c;this.childState=d}},RealChildOfShadow$$module$build$src$core$serialization$exceptions=class extends DeserializationError$$module$build$src$core$serialization$exceptions{constructor(a){super(\"Encountered a real block which is defined as a child of a shadow\\nblock. It is an invariant of Blockly that shadow blocks only have shadow\\nchildren\");this.state=a}},module$build$src$core$serialization$exceptions={};\nmodule$build$src$core$serialization$exceptions.BadConnectionCheck=BadConnectionCheck$$module$build$src$core$serialization$exceptions;module$build$src$core$serialization$exceptions.DeserializationError=DeserializationError$$module$build$src$core$serialization$exceptions;module$build$src$core$serialization$exceptions.MissingBlockType=MissingBlockType$$module$build$src$core$serialization$exceptions;module$build$src$core$serialization$exceptions.MissingConnection=MissingConnection$$module$build$src$core$serialization$exceptions;\nmodule$build$src$core$serialization$exceptions.RealChildOfShadow=RealChildOfShadow$$module$build$src$core$serialization$exceptions;var VARIABLES$$module$build$src$core$serialization$priorities=100,PROCEDURES$$module$build$src$core$serialization$priorities=75,BLOCKS$$module$build$src$core$serialization$priorities=50,module$build$src$core$serialization$priorities={};module$build$src$core$serialization$priorities.BLOCKS=BLOCKS$$module$build$src$core$serialization$priorities;module$build$src$core$serialization$priorities.PROCEDURES=PROCEDURES$$module$build$src$core$serialization$priorities;\nmodule$build$src$core$serialization$priorities.VARIABLES=VARIABLES$$module$build$src$core$serialization$priorities;var module$build$src$core$serialization$registry={};module$build$src$core$serialization$registry.register=register$$module$build$src$core$serialization$registry;module$build$src$core$serialization$registry.unregister=unregister$$module$build$src$core$serialization$registry;var saveBlock$$module$build$src$core$serialization$blocks=save$$module$build$src$core$serialization$blocks,BlockSerializer$$module$build$src$core$serialization$blocks=class{constructor(){this.priority=BLOCKS$$module$build$src$core$serialization$priorities}save(a){const b=[];for(const c of a.getTopBlocks(!1))(a=save$$module$build$src$core$serialization$blocks(c,{addCoordinates:!0,doFullSerialization:!1}))&&b.push(a);return b.length?{languageVersion:0,blocks:b}:null}load(a,b){a=a.blocks;for(const c of a)append$$module$build$src$core$serialization$blocks(c,\nb,{recordUndo:getRecordUndo$$module$build$src$core$events$utils()})}clear(a){for(const b of a.getTopBlocks(!1))b.dispose(!1)}};register$$module$build$src$core$serialization$registry(\"blocks\",new BlockSerializer$$module$build$src$core$serialization$blocks);var module$build$src$core$serialization$blocks={};module$build$src$core$serialization$blocks.BlockSerializer=BlockSerializer$$module$build$src$core$serialization$blocks;module$build$src$core$serialization$blocks.append=append$$module$build$src$core$serialization$blocks;\nmodule$build$src$core$serialization$blocks.appendInternal=appendInternal$$module$build$src$core$serialization$blocks;module$build$src$core$serialization$blocks.save=save$$module$build$src$core$serialization$blocks;var BlockCreate$$module$build$src$core$events$events_block_create=class extends BlockBase$$module$build$src$core$events$events_block_base{constructor(a){super(a);this.type=CREATE$$module$build$src$core$events$utils;a&&(a.isShadow()&&(this.recordUndo=!1),this.xml=blockToDomWithXY$$module$build$src$core$xml(a),this.ids=getDescendantIds$$module$build$src$core$events$utils(a),this.json=save$$module$build$src$core$serialization$blocks(a,{addCoordinates:!0}))}toJson(){const a=super.toJson();if(!this.xml)throw Error(\"The block XML is undefined. Either pass a block to the constructor, or call fromJson\");\nif(!this.ids)throw Error(\"The block IDs are undefined. Either pass a block to the constructor, or call fromJson\");if(!this.json)throw Error(\"The block JSON is undefined. Either pass a block to the constructor, or call fromJson\");a.xml=domToText$$module$build$src$core$xml(this.xml);a.ids=this.ids;a.json=this.json;this.recordUndo||(a.recordUndo=this.recordUndo);return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BlockCreate.prototype.fromJson\",\"version 9\",\"version 10\",\n\"Blockly.Events.fromJson\");super.fromJson(a);this.xml=textToDom$$module$build$src$core$xml(a.xml);this.ids=a.ids;this.json=a.json;void 0!==a.recordUndo&&(this.recordUndo=a.recordUndo)}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BlockCreate$$module$build$src$core$events$events_block_create);b.xml=textToDom$$module$build$src$core$xml(a.xml);b.ids=a.ids;b.json=a.json;void 0!==a.recordUndo&&(b.recordUndo=a.recordUndo);return b}run(a){const b=this.getEventWorkspace_();if(!this.json)throw Error(\"The block JSON is undefined. Either pass a block to the constructor, or call fromJson\");\nif(!this.ids)throw Error(\"The block IDs are undefined. Either pass a block to the constructor, or call fromJson\");if(a)append$$module$build$src$core$serialization$blocks(this.json,b);else for(a=0;a<this.ids.length;a++){const c=this.ids[a],d=b.getBlockById(c);d?d.dispose(!1):c===this.blockId&&console.warn(\"Can't uncreate non-existent block: \"+c)}}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,CREATE$$module$build$src$core$events$utils,BlockCreate$$module$build$src$core$events$events_block_create);\nvar module$build$src$core$events$events_block_create={};module$build$src$core$events$events_block_create.BlockCreate=BlockCreate$$module$build$src$core$events$events_block_create;var BlockDelete$$module$build$src$core$events$events_block_delete=class extends BlockBase$$module$build$src$core$events$events_block_base{constructor(a){super(a);this.type=DELETE$$module$build$src$core$events$utils;if(a){if(a.getParent())throw Error(\"Connected blocks cannot be deleted.\");a.isShadow()&&(this.recordUndo=!1);this.oldXml=blockToDomWithXY$$module$build$src$core$xml(a);this.ids=getDescendantIds$$module$build$src$core$events$utils(a);this.wasShadow=a.isShadow();this.oldJson=save$$module$build$src$core$serialization$blocks(a,\n{addCoordinates:!0})}}toJson(){const a=super.toJson();if(!this.oldXml)throw Error(\"The old block XML is undefined. Either pass a block to the constructor, or call fromJson\");if(!this.ids)throw Error(\"The block IDs are undefined. Either pass a block to the constructor, or call fromJson\");if(void 0===this.wasShadow)throw Error(\"Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson\");if(!this.oldJson)throw Error(\"The old block JSON is undefined. Either pass a block to the constructor, or call fromJson\");\na.oldXml=domToText$$module$build$src$core$xml(this.oldXml);a.ids=this.ids;a.wasShadow=this.wasShadow;a.oldJson=this.oldJson;this.recordUndo||(a.recordUndo=this.recordUndo);return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BlockDelete.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.oldXml=textToDom$$module$build$src$core$xml(a.oldXml);this.ids=a.ids;this.wasShadow=a.wasShadow||\"shadow\"===this.oldXml.tagName.toLowerCase();\nthis.oldJson=a.oldJson;void 0!==a.recordUndo&&(this.recordUndo=a.recordUndo)}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BlockDelete$$module$build$src$core$events$events_block_delete);b.oldXml=textToDom$$module$build$src$core$xml(a.oldXml);b.ids=a.ids;b.wasShadow=a.wasShadow||\"shadow\"===b.oldXml.tagName.toLowerCase();b.oldJson=a.oldJson;void 0!==a.recordUndo&&(b.recordUndo=a.recordUndo);return b}run(a){const b=this.getEventWorkspace_();if(!this.ids)throw Error(\"The block IDs are undefined. Either pass a block to the constructor, or call fromJson\");\nif(!this.oldJson)throw Error(\"The old block JSON is undefined. Either pass a block to the constructor, or call fromJson\");if(a)for(a=0;a<this.ids.length;a++){const c=this.ids[a],d=b.getBlockById(c);d?d.dispose(!1):c===this.blockId&&console.warn(\"Can't delete non-existent block: \"+c)}else append$$module$build$src$core$serialization$blocks(this.oldJson,b)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,DELETE$$module$build$src$core$events$utils,BlockDelete$$module$build$src$core$events$events_block_delete);\nvar module$build$src$core$events$events_block_delete={};module$build$src$core$events$events_block_delete.BlockDelete=BlockDelete$$module$build$src$core$events$events_block_delete;var ConnectionType$$module$build$src$core$connection_type;(function(a){a[a.INPUT_VALUE=1]=\"INPUT_VALUE\";a[a.OUTPUT_VALUE=2]=\"OUTPUT_VALUE\";a[a.NEXT_STATEMENT=3]=\"NEXT_STATEMENT\";a[a.PREVIOUS_STATEMENT=4]=\"PREVIOUS_STATEMENT\"})(ConnectionType$$module$build$src$core$connection_type||(ConnectionType$$module$build$src$core$connection_type={}));$.module$build$src$core$connection_type={};$.module$build$src$core$connection_type.ConnectionType=ConnectionType$$module$build$src$core$connection_type;var Connection$$module$build$src$core$connection=class{constructor(a,b){this.type=b;this.targetConnection=null;this.disposed=!1;this.shadowDom_=this.check_=null;this.y=this.x=0;this.shadowState_=null;this.sourceBlock_=a}connect_(a){const b=ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE,c=this.getSourceBlock();var d=a.getSourceBlock();a.isConnected()&&a.disconnect();let e;if(this.isConnected()){const g=this.stashShadowState_(),h=this.targetBlock();h.isShadow()?h.dispose(!1):(this.disconnect(),\ne=h);this.applyShadowState_(g)}let f;isEnabled$$module$build$src$core$events$utils()&&(f=new (get$$module$build$src$core$events$utils(MOVE$$module$build$src$core$events$utils))(d));connectReciprocally$$module$build$src$core$connection(this,a);d.setParent(c);f&&(f.recordNew(),fire$$module$build$src$core$events$utils(f));if(e)if(a=this.type===b?e.outputConnection:e.previousConnection,d=Connection$$module$build$src$core$connection.getConnectionForOrphanedConnection(d,a))a.connect(d);else a.onFailedConnect(this)}dispose(){if(this.isConnected()){this.setShadowStateInternal_();\nconst a=this.targetBlock();a&&a.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE||this.type===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(a){}connect(a){if(this.targetConnection===a)return!0;if(this.getConnectionChecker().canConnect(this,\na,!1)){const b=getGroup$$module$build$src$core$events$utils();b||setGroup$$module$build$src$core$events$utils(!0);this.isSuperior()?this.connect_(a):a.connect_(this);b||setGroup$$module$build$src$core$events$utils(!1)}return this.isConnected()}disconnect(){var a=this.targetConnection;if(!a)throw Error(\"Source connection not connected.\");if(a.targetConnection!==this)throw Error(\"Target connection not connected to source connection.\");let b,c;this.isSuperior()?(b=this.sourceBlock_,c=a.getSourceBlock(),\na=this):(b=a.getSourceBlock(),c=this.sourceBlock_);const d=getGroup$$module$build$src$core$events$utils();d||setGroup$$module$build$src$core$events$utils(!0);this.disconnectInternal_(b,c);c.isShadow()||a.respawnShadow_();d||setGroup$$module$build$src$core$events$utils(!1)}disconnectInternal_(a,b){let c;isEnabled$$module$build$src$core$events$utils()&&(c=new (get$$module$build$src$core$events$utils(MOVE$$module$build$src$core$events$utils))(b));if(a=this.targetConnection)a.targetConnection=null;this.targetConnection=\nnull;b.setParent(null);c&&(c.recordNew(),fire$$module$build$src$core$events$utils(c))}respawnShadow_(){this.createShadowBlock_(!0)}targetBlock(){if(this.isConnected()){let a,b;return null!=(b=null==(a=this.targetConnection)?void 0:a.getSourceBlock())?b:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(a){a?(Array.isArray(a)||\n(a=[a]),this.check_=a,this.onCheckChanged_()):this.check_=null;return this}getCheck(){return this.check_}setShadowDom(a){this.setShadowStateInternal_({shadowDom:a})}getShadowDom(a){return a&&this.targetBlock().isShadow()?blockToDom$$module$build$src$core$xml(this.targetBlock()):this.shadowDom_}setShadowState(a){this.setShadowStateInternal_({shadowState:a})}getShadowState(a){return a&&this.targetBlock()&&this.targetBlock().isShadow()?save$$module$build$src$core$serialization$blocks(this.targetBlock()):\nthis.shadowState_}neighbours(a){return[]}getParentInput(){let a=null;const b=this.sourceBlock_.inputList;for(let c=0;c<b.length;c++)if(b[c].connection===this){a=b[c];break}return a}toString(){const a=this.sourceBlock_;if(!a)return\"Orphan Connection\";if(a.outputConnection===this)var b=\"Output Connection of \";else if(a.previousConnection===this)b=\"Previous Connection of \";else if(a.nextConnection===this)b=\"Next Connection of \";else{b=null;for(let c=0,d;d=a.inputList[c];c++)if(d.connection===this){b=\nd;break}if(b)b='Input \"'+b.name+'\" connection on ';else return console.warn(\"Connection not actually connected to sourceBlock_\"),\"Orphan Connection\"}return b+a.toDevString()}stashShadowState_(){const a=this.getShadowDom(!0),b=this.getShadowState(!0);this.shadowState_=this.shadowDom_=null;return{shadowDom:a,shadowState:b}}applyShadowState_({shadowDom:a,shadowState:b}){this.shadowDom_=a;this.shadowState_=b}setShadowStateInternal_({shadowDom:a=null,shadowState:b=null}={}){this.shadowDom_=a;this.shadowState_=\nb;(a=this.targetBlock())?a.isShadow()?(a.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow_(this.targetBlock())):(a=this.createShadowBlock_(!1),this.serializeShadow_(a),a&&a.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow_(this.targetBlock()))}createShadowBlock_(a){var b=this.getSourceBlock();const c=this.getShadowState(),d=this.getShadowDom();if(b.isDeadOrDying()||!c&&!d)return null;\nif(c)return b=appendInternal$$module$build$src$core$serialization$blocks(c,b.workspace,{parentConnection:a?this:void 0,isShadow:!0,recordUndo:!1});if(d){b=domToBlock$$module$build$src$core$xml(d,b.workspace);if(a)if(this.type===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE){if(!b.outputConnection)throw Error(\"Shadow block is missing an output connection\");if(!this.connect(b.outputConnection))throw Error(\"Could not connect shadow block to connection\");}else if(this.type===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT){if(!b.previousConnection)throw Error(\"Shadow block is missing previous connection\");\nif(!this.connect(b.previousConnection))throw Error(\"Could not connect shadow block to connection\");}else throw Error(\"Cannot connect a shadow block to a previous/output connection\");return b}return null}serializeShadow_(a){a&&(this.shadowDom_=blockToDom$$module$build$src$core$xml(a),this.shadowState_=save$$module$build$src$core$serialization$blocks(a))}static getConnectionForOrphanedConnection(a,b){if(b.type===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE)return getConnectionForOrphanedOutput$$module$build$src$core$connection(a,\nb.getSourceBlock());a=a.lastConnectionInStack(!0);const c=b.getConnectionChecker();return a&&c.canConnect(b,a,!1)?a:null}};Connection$$module$build$src$core$connection.CAN_CONNECT=0;Connection$$module$build$src$core$connection.REASON_SELF_CONNECTION=1;Connection$$module$build$src$core$connection.REASON_WRONG_TYPE=2;Connection$$module$build$src$core$connection.REASON_TARGET_NULL=3;Connection$$module$build$src$core$connection.REASON_CHECKS_FAILED=4;\nConnection$$module$build$src$core$connection.REASON_DIFFERENT_WORKSPACES=5;Connection$$module$build$src$core$connection.REASON_SHADOW_PARENT=6;Connection$$module$build$src$core$connection.REASON_DRAG_CHECKS_FAILED=7;Connection$$module$build$src$core$connection.REASON_PREVIOUS_AND_OUTPUT=8;var module$build$src$core$connection={};module$build$src$core$connection.Connection=Connection$$module$build$src$core$connection;var COLLAPSED_INPUT_NAME$$module$build$src$core$constants=\"_TEMP_COLLAPSED_INPUT\",COLLAPSED_FIELD_NAME$$module$build$src$core$constants=\"_TEMP_COLLAPSED_FIELD\",module$build$src$core$constants={};module$build$src$core$constants.COLLAPSED_FIELD_NAME=COLLAPSED_FIELD_NAME$$module$build$src$core$constants;module$build$src$core$constants.COLLAPSED_INPUT_NAME=COLLAPSED_INPUT_NAME$$module$build$src$core$constants;$.FieldLabel$$module$build$src$core$field_label=class extends Field$$module$build$src$core$field{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.class_=null;this.EDITABLE=!1;a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c?this.configure_(c):this.class_=b||null,this.setValue(a))}configure_(a){super.configure_(a);a.class&&(this.class_=a.class)}initView(){this.createTextElement_();this.class_&&addClass$$module$build$src$core$utils$dom(this.getTextElement(),this.class_)}doClassValidation_(a){return null===\na||void 0===a?null:String(a)}setClass(a){this.textElement_&&(this.class_&&removeClass$$module$build$src$core$utils$dom(this.textElement_,this.class_),a&&addClass$$module$build$src$core$utils$dom(this.textElement_,a));this.class_=a}static fromJson(a){return new this(replaceMessageReferences$$module$build$src$core$utils$parsing(a.text),void 0,a)}};register$$module$build$src$core$field_registry(\"field_label\",$.FieldLabel$$module$build$src$core$field_label);\n$.FieldLabel$$module$build$src$core$field_label.prototype.DEFAULT_VALUE=\"\";var module$build$src$core$field_label={};module$build$src$core$field_label.FieldLabel=$.FieldLabel$$module$build$src$core$field_label;var Input$$module$build$src$core$input=class{constructor(a,b,c,d){this.type=a;this.name=b;this.connection=d;this.fieldRow=[];this.align=$.Align$$module$build$src$core$input.LEFT;this.visible=!0;if(a!==inputTypes$$module$build$src$core$input_types.DUMMY&&!b)throw Error(\"Value inputs and statement inputs must have non-empty name.\");this.sourceBlock=c}getSourceBlock(){return this.sourceBlock}appendField(a,b){this.insertFieldAt(this.fieldRow.length,a,b);return this}insertFieldAt(a,b,c){if(0>a||a>this.fieldRow.length)throw Error(\"index \"+\na+\" out of bounds.\");if(!(b||\"\"===b&&c))return a;\"string\"===typeof b&&(b=fromJson$$module$build$src$core$field_registry({type:\"field_label\",text:b}));b.setSourceBlock(this.sourceBlock);this.sourceBlock.rendered&&(b.init(),b.applyColour());b.name=c;b.setVisible(this.isVisible());b.prefixField&&(a=this.insertFieldAt(a,b.prefixField));this.fieldRow.splice(a,0,b);a++;b.suffixField&&(a=this.insertFieldAt(a,b.suffixField));this.sourceBlock.rendered&&(this.sourceBlock.render(),this.sourceBlock.bumpNeighbours());\nreturn a}removeField(a,b){for(let c=0,d;d=this.fieldRow[c];c++)if(d.name===a)return d.dispose(),this.fieldRow.splice(c,1),this.sourceBlock.rendered&&(this.sourceBlock.render(),this.sourceBlock.bumpNeighbours()),!0;if(b)return!1;throw Error('Field \"'+a+'\" not found.');}isVisible(){return this.visible}setVisible(a){let b=[];if(this.visible===a)return b;this.visible=a;for(let d=0,e;e=this.fieldRow[d];d++)e.setVisible(a);if(this.connection){var c=this.connection;a?b=c.startTrackingAll():c.stopTrackingAll();\nif(c=c.targetBlock())c.getSvgRoot().style.display=a?\"block\":\"none\"}return b}markDirty(){for(let a=0,b;b=this.fieldRow[a];a++)b.markDirty()}setCheck(a){if(!this.connection)throw Error(\"This input does not have a connection.\");this.connection.setCheck(a);return this}setAlign(a){this.align=a;this.sourceBlock.rendered&&this.sourceBlock.render();return this}setShadowDom(a){if(!this.connection)throw Error(\"This input does not have a connection.\");this.connection.setShadowDom(a);return this}getShadowDom(){if(!this.connection)throw Error(\"This input does not have a connection.\");\nreturn this.connection.getShadowDom()}init(){if(this.sourceBlock.workspace.rendered)for(let a=0;a<this.fieldRow.length;a++)this.fieldRow[a].init()}dispose(){for(let a=0,b;b=this.fieldRow[a];a++)b.dispose();this.connection&&this.connection.dispose()}},module$build$src$core$input;(function(a){a=a.Align||(a.Align={});a[a.LEFT=-1]=\"LEFT\";a[a.CENTRE=0]=\"CENTRE\";a[a.RIGHT=1]=\"RIGHT\"})(Input$$module$build$src$core$input||(Input$$module$build$src$core$input={}));$.Align$$module$build$src$core$input=Input$$module$build$src$core$input.Align;\nmodule$build$src$core$input={};module$build$src$core$input.Align=$.Align$$module$build$src$core$input;module$build$src$core$input.Input=Input$$module$build$src$core$input;var ASTNode$$module$build$src$core$keyboard_nav$ast_node=class{constructor(a,b,c){this.wsCoordinate_=null;if(!b)throw Error(\"Cannot create a node without a location.\");this.type_=a;this.isConnection_=ASTNode$$module$build$src$core$keyboard_nav$ast_node.isConnectionType_(a);this.location_=b;this.processParams_(c||null)}processParams_(a){a&&a.wsCoordinate&&(this.wsCoordinate_=a.wsCoordinate)}getLocation(){return this.location_}getType(){return this.type_}getWsCoordinate(){return this.wsCoordinate_}isConnection(){return this.isConnection_}findNextForInput_(){var a=\nthis.location_.getParentInput();const b=a.getSourceBlock();a=b.inputList.indexOf(a);for(a+=1;a<b.inputList.length;a++){const c=b.inputList[a],d=c.fieldRow;for(let e=0;e<d.length;e++){const f=d[e];if(f.isClickable()||ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createFieldNode(f)}if(c.connection)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(c)}return null}findNextForField_(){var a=\nthis.location_,b=a.getParentInput();const c=a.getSourceBlock();if(!c)throw Error(\"The current AST location is not associated with a block\");var d=c.inputList.indexOf(b);for(a=b.fieldRow.indexOf(a)+1;d<c.inputList.length;d++){b=c.inputList[d];const e=b.fieldRow;for(;a<e.length;){if(e[a].isClickable()||ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createFieldNode(e[a]);a++}a=0;if(b.connection)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(b)}return null}findPrevForInput_(){const a=\nthis.location_.getParentInput(),b=a.getSourceBlock();for(var c=b.inputList.indexOf(a);0<=c;c--){var d=b.inputList[c];if(d.connection&&d!==a)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(d);d=d.fieldRow;for(let e=d.length-1;0<=e;e--){const f=d[e];if(f.isClickable()||ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createFieldNode(f)}}return null}findPrevForField_(){var a=this.location_;\nconst b=a.getParentInput(),c=a.getSourceBlock();if(!c)throw Error(\"The current AST location is not associated with a block\");var d=c.inputList.indexOf(b);for(a=b.fieldRow.indexOf(a)-1;0<=d;d--){var e=c.inputList[d];if(e.connection&&e!==b)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(e);for(e=e.fieldRow;-1<a;){if(e[a].isClickable()||ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createFieldNode(e[a]);\na--}0<=d-1&&(a=c.inputList[d-1].fieldRow.length-1)}return null}navigateBetweenStacks_(a){var b=this.getLocation();if(b.getSourceBlock){var c=b.getSourceBlock();c&&(b=c)}if(!b||b.isDeadOrDying())return null;c=b.getRootBlock();b=c.workspace.getTopBlocks(!0);for(let d=0;d<b.length;d++)if(c.id===b[d].id)return a=d+(a?1:-1),-1===a||a===b.length?null:ASTNode$$module$build$src$core$keyboard_nav$ast_node.createStackNode(b[a]);throw Error(\"Couldn't find \"+(a?\"next\":\"previous\")+\" stack?!\");}findTopASTNodeForBlock_(a){const b=\ngetParentConnection$$module$build$src$core$keyboard_nav$ast_node(a);return b?ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(b):ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(a)}getOutAstNodeForBlock_(a){if(!a)return null;a=a.getTopStackBlock();const b=getParentConnection$$module$build$src$core$keyboard_nav$ast_node(a);return b&&b.targetConnection&&b.targetConnection.getParentInput()?ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(b.targetConnection.getParentInput()):\nASTNode$$module$build$src$core$keyboard_nav$ast_node.createStackNode(a)}findFirstFieldOrInput_(a){a=a.inputList;for(let b=0;b<a.length;b++){const c=a[b],d=c.fieldRow;for(let e=0;e<d.length;e++){const f=d[e];if(f.isClickable()||ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createFieldNode(f)}if(c.connection)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(c)}return null}getSourceBlock(){return this.getType()===\nASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK?this.getLocation():this.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK?this.getLocation():this.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.WORKSPACE?null:this.getLocation().getSourceBlock()}next(){switch(this.type_){case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK:return this.navigateBetweenStacks_(!0);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(this.location_.getSourceBlock());\ncase ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD:return this.findNextForField_();case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT:return this.findNextForInput_();case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(this.location_.nextConnection);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(this.location_.getSourceBlock());\ncase ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(this.location_.targetConnection)}return null}in(){switch(this.type_){case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.WORKSPACE:const a=this.location_.getTopBlocks(!0);if(0<a.length)return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createStackNode(a[0]);break;case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK:return this.findTopASTNodeForBlock_(this.location_);\ncase ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK:return this.findFirstFieldOrInput_(this.location_);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(this.location_.targetConnection)}return null}prev(){switch(this.type_){case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK:return this.navigateBetweenStacks_(!1);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD:return this.findPrevForField_();\ncase ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT:return this.findPrevForInput_();case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK:var a=getParentConnection$$module$build$src$core$keyboard_nav$ast_node(this.location_);return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(a);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS:if((a=this.location_.targetConnection)&&!a.getParentInput())return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(a);\nbreak;case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(this.location_.getSourceBlock())}return null}out(){switch(this.type_){case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK:var a=this.location_,b=a.getRelativeToSurfaceXY();b=new Coordinate$$module$build$src$core$utils$coordinate(b.x,b.y+ASTNode$$module$build$src$core$keyboard_nav$ast_node.DEFAULT_OFFSET_Y);return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createWorkspaceNode(a.workspace,\nb);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT:return a=this.location_,(b=a.targetConnection)?ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(b):ASTNode$$module$build$src$core$keyboard_nav$ast_node.createStackNode(a.getSourceBlock());case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD:a=this.location_.getSourceBlock();if(!a)throw Error(\"The current AST location is not associated with a block\");return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(a);\ncase ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT:return ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(this.location_.getSourceBlock());case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK:return this.getOutAstNodeForBlock_(this.location_);case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS:return this.getOutAstNodeForBlock_(this.location_.getSourceBlock());case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT:return this.getOutAstNodeForBlock_(this.location_.getSourceBlock())}return null}static isConnectionType_(a){switch(a){case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS:case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT:case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT:case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT:return!0}return!1}static createFieldNode(a){return a?\nnew ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD,a):null}static createConnectionNode(a){if(!a)return null;const b=a.type;return b===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE||b===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT&&a.getParentInput()?ASTNode$$module$build$src$core$keyboard_nav$ast_node.createInputNode(a.getParentInput()):b===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT?\nnew ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT,a):b===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE?new ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT,a):b===ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT?new ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS,\na):null}static createInputNode(a){return a&&a.connection?new ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT,a.connection):null}static createBlockNode(a){return a?new ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK,a):null}static createStackNode(a){return a?new ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK,\na):null}static createWorkspaceNode(a,b){return b&&a?new ASTNode$$module$build$src$core$keyboard_nav$ast_node(ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.WORKSPACE,a,{wsCoordinate:b}):null}static createTopNode(a){const b=getParentConnection$$module$build$src$core$keyboard_nav$ast_node(a);return b?ASTNode$$module$build$src$core$keyboard_nav$ast_node.createConnectionNode(b):ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(a)}};\nASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS=!1;ASTNode$$module$build$src$core$keyboard_nav$ast_node.DEFAULT_OFFSET_Y=-20;(function(a){a=a.types||(a.types={});a.FIELD=\"field\";a.BLOCK=\"block\";a.INPUT=\"input\";a.OUTPUT=\"output\";a.NEXT=\"next\";a.PREVIOUS=\"previous\";a.STACK=\"stack\";a.WORKSPACE=\"workspace\"})(ASTNode$$module$build$src$core$keyboard_nav$ast_node||(ASTNode$$module$build$src$core$keyboard_nav$ast_node={}));var module$build$src$core$keyboard_nav$ast_node={};\nmodule$build$src$core$keyboard_nav$ast_node.ASTNode=ASTNode$$module$build$src$core$keyboard_nav$ast_node;var Block$$module$build$src$core$block=class{constructor(a,b,c){this.data=null;this.disposed=!1;this.hue_=null;this.colour_=\"#000000\";this.styleName_=\"\";this.loadExtraState=this.saveExtraState=this.domToMutation=this.mutationToDom=this.destroy=this.init=void 0;this.suppressPrefixSuffix=!1;this.decompose=this.compose=this.getDeveloperVariables=void 0;this.previousConnection=this.nextConnection=this.outputConnection=null;this.inputList=[];this.inputsInline=void 0;this.disabled=!1;this.tooltip=\"\";this.contextMenu=\n!0;this.parentBlock_=null;this.childBlocks_=[];this.editable_=this.movable_=this.deletable_=!0;this.collapsed_=this.isShadow_=!1;this.outputShape_=null;this.disposing=!1;this.comment=null;this.isInsertionMarker_=!1;this.hat=void 0;this.onchangeWrapper_=this.helpUrl=this.rendered=null;this.statementInputCount=0;this.workspace=a;this.id=c&&!a.getBlockById(c)?c:genUid$$module$build$src$core$utils$idgenerator();a.setBlockById(this.id,this);this.commentModel={text:null,pinned:!1,size:new Size$$module$build$src$core$utils$size(160,\n80)};this.xy_=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.isInFlyout=a.isFlyout;this.isInMutator=a.isMutator;this.RTL=a.RTL;if(b){this.type=b;c=Blocks$$module$build$src$core$blocks[b];if(!c||\"object\"!==typeof c)throw TypeError(\"Invalid block definition for type: \"+b);Object.assign(this,c)}a.addTopBlock(this);a.addTypedBlock(this);new.target===Block$$module$build$src$core$block&&this.doInit_()}doInit_(){const a=getGroup$$module$build$src$core$events$utils();a||setGroup$$module$build$src$core$events$utils(!0);\nconst b=getRecordUndo$$module$build$src$core$events$utils();try{\"function\"===typeof this.init&&(setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),setRecordUndo$$module$build$src$core$events$utils(b)),isEnabled$$module$build$src$core$events$utils()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CREATE$$module$build$src$core$events$utils))(this))}finally{a||setGroup$$module$build$src$core$events$utils(!1),setRecordUndo$$module$build$src$core$events$utils(b)}this.inputsInlineDefault=\nthis.inputsInline;\"function\"===typeof this.onchange&&this.setOnChange(this.onchange)}dispose(a){if(!this.isDeadOrDying()){this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_);this.unplug(a);isEnabled$$module$build$src$core$events$utils()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(DELETE$$module$build$src$core$events$utils))(this));disable$$module$build$src$core$events$utils();try{this.workspace.removeTopBlock(this);this.workspace.removeTypedBlock(this);\nthis.workspace.removeBlockById(this.id);this.disposing=!0;for(let c=this.childBlocks_.length-1;0<=c;c--)this.childBlocks_[c].dispose(!1);for(let c=0,d;d=this.inputList[c];c++)d.dispose();this.inputList.length=0;const b=this.getConnections_(!0);for(let c=0,d;d=b[c];c++)d.dispose()}finally{enable$$module$build$src$core$events$utils(),\"function\"===typeof this.destroy&&this.destroy(),this.disposed=!0}}}isDeadOrDying(){return this.disposing||this.disposed}initModel(){for(let a=0,b;b=this.inputList[a];a++)for(let c=\n0,d;d=b.fieldRow[c];c++)d.initModel&&d.initModel()}unplug(a){this.outputConnection&&this.unplugFromRow_(a);this.previousConnection&&this.unplugFromStack_(a)}unplugFromRow_(a){let b=null;this.outputConnection.isConnected()&&(b=this.outputConnection.targetConnection,this.outputConnection.disconnect());b&&a&&(a=this.getOnlyValueConnection_())&&a.isConnected()&&!a.targetBlock().isShadow()&&(a=a.targetConnection,null==a||a.disconnect(),this.workspace.connectionChecker.canConnect(a,b,!1)?b.connect(a):null==\na||a.onFailedConnect(b))}getOnlyValueConnection_(){let a=null;for(let b=0;b<this.inputList.length;b++){const c=this.inputList[b].connection;if(c&&c.type===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE&&c.targetConnection){if(a)return null;a=c}}return a}unplugFromStack_(a){let b=null;this.previousConnection.isConnected()&&(b=this.previousConnection.targetConnection,this.previousConnection.disconnect());const c=this.getNextBlock();a&&c&&!c.isShadow()&&(a=this.nextConnection.targetConnection,\nnull==a||a.disconnect(),b&&this.workspace.connectionChecker.canConnect(b,a,!1)&&b.connect(a))}getConnections_(a){a=[];this.outputConnection&&a.push(this.outputConnection);this.previousConnection&&a.push(this.previousConnection);this.nextConnection&&a.push(this.nextConnection);for(let b=0,c;c=this.inputList[b];b++)c.connection&&a.push(c.connection);return a}lastConnectionInStack(a){let b=this.nextConnection;for(;b;){const c=b.targetBlock();if(!c||a&&c.isShadow())return b;b=c.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(a){for(let b=\n0,c;c=this.inputList[b];b++)if(c.connection&&c.connection.targetBlock()===a)return c;return null}getSurroundParent(){let a=this,b;do if(b=a,a=a.getParent(),!a)return null;while(a.getNextBlock()===b);return a}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getFirstStatementConnection(){for(let a=0,b;b=this.inputList[a];a++)if(b.connection&&b.connection.type===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT)return b.connection;\nreturn null}getRootBlock(){let a,b=this;do a=b,b=a.parentBlock_;while(b);return a}getTopStackBlock(){let a=this,b;do b=a.getPreviousBlock();while(b&&b.getNextBlock()===a&&(a=b));return a}getChildren(a){if(!a)return this.childBlocks_;a=[];for(let c=0,d;d=this.inputList[c];c++)if(d.connection){var b=d.connection.targetBlock();b&&a.push(b)}(b=this.getNextBlock())&&a.push(b);return a}setParent(a){if(a!==this.parentBlock_){var b=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&\nthis.outputConnection.targetBlock(),c=!!b;if(c&&a&&b!==a)throw Error(\"Block connected to superior one that is not new parent.\");if(!c&&a)throw Error(\"Block not connected to new parent.\");if(c&&!a)throw Error(\"Cannot set parent to null while block is still connected to superior block.\");this.parentBlock_?removeElem$$module$build$src$core$utils$array(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this);(this.parentBlock_=a)?a.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(a){const b=\n[this],c=this.getChildren(a);for(let d,e=0;d=c[e];e++)b.push(...d.getDescendants(a));return b}isDeletable(){return this.deletable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}setDeletable(a){this.deletable_=a}isMovable(){return this.movable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}setMovable(a){this.movable_=a}isDuplicatable(){return this.workspace.hasBlockLimits()?this.workspace.isCapacityAvailable(getBlockTypeCounts$$module$build$src$core$common(this,\n!0)):!0}isShadow(){return this.isShadow_}setShadow(a){this.isShadow_=a}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(a){this.isInsertionMarker_=a}isEditable(){return this.editable_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}setEditable(a){this.editable_=a;for(let b=0,c;c=this.inputList[b];b++)for(let d=0,e;e=c.fieldRow[d];d++)e.updateEditable()}isDisposed(){return this.disposed}getMatchingConnection(a,b){const c=this.getConnections_(!0);a=a.getConnections_(!0);\nif(c.length!==a.length)throw Error(\"Connection lists did not match in length.\");for(let d=0;d<a.length;d++)if(a[d]===b)return c[d];return null}setHelpUrl(a){this.helpUrl=a}setTooltip(a){this.tooltip=a}getTooltip(){return getTooltipOfObject$$module$build$src$core$tooltip(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue_}setColour(a){a=parseBlockColour$$module$build$src$core$utils$parsing(a);this.hue_=a.hue;this.colour_=a.hex}setStyle(a){this.styleName_=\na}setOnChange(a){if(a&&\"function\"!==typeof a)throw Error(\"onchange must be a function.\");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_);this.onchange=a;this.onchangeWrapper_=a.bind(this);this.workspace.addChangeListener(this.onchangeWrapper_)}getField(a){if(\"string\"!==typeof a)throw TypeError(\"Block.prototype.getField expects a string with the field name but received \"+(void 0===a?\"nothing\":a+\" of type \"+typeof a)+\" instead\");for(let b=0,c;c=this.inputList[b];b++)for(let d=\n0,e;e=c.fieldRow[d];d++)if(e.name===a)return e;return null}getVars(){const a=[];for(let b=0,c;c=this.inputList[b];b++)for(let d=0,e;e=c.fieldRow[d];d++)e.referencesVariables()&&a.push(e.getValue());return a}getVarModels(){const a=[];for(let b=0,c;c=this.inputList[b];b++)for(let d=0,e;e=c.fieldRow[d];d++)if(e.referencesVariables()){const f=this.workspace.getVariableById(e.getValue());f&&a.push(f)}return a}updateVarName(a){for(let b=0,c;c=this.inputList[b];b++)for(let d=0,e;e=c.fieldRow[d];d++)e.referencesVariables()&&\na.getId()===e.getValue()&&e.refreshVariableName()}renameVarById(a,b){for(let c=0,d;d=this.inputList[c];c++)for(let e=0,f;f=d.fieldRow[e];e++)f.referencesVariables()&&a===f.getValue()&&f.setValue(b)}getFieldValue(a){return(a=this.getField(a))?a.getValue():null}setFieldValue(a,b){const c=this.getField(b);if(!c)throw Error('Field \"'+b+'\" not found.');c.setValue(a)}setPreviousStatement(a,b){if(a)void 0===b&&(b=null),this.previousConnection||(this.previousConnection=this.makeConnection_(ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT)),\nthis.previousConnection.setCheck(b);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error(\"Must disconnect previous statement before removing connection.\");this.previousConnection.dispose();this.previousConnection=null}}setNextStatement(a,b){if(a)void 0===b&&(b=null),this.nextConnection||(this.nextConnection=this.makeConnection_(ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT)),this.nextConnection.setCheck(b);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error(\"Must disconnect next statement before removing connection.\");\nthis.nextConnection.dispose();this.nextConnection=null}}setOutput(a,b){if(a)void 0===b&&(b=null),this.outputConnection||(this.outputConnection=this.makeConnection_(ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE)),this.outputConnection.setCheck(b);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error(\"Must disconnect output value before removing connection.\");this.outputConnection.dispose();this.outputConnection=null}}setInputsInline(a){this.inputsInline!==\na&&(fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(this,\"inline\",null,this.inputsInline,a)),this.inputsInline=a)}getInputsInline(){if(void 0!==this.inputsInline)return this.inputsInline;for(var a=1;a<this.inputList.length;a++)if(this.inputList[a-1].type===inputTypes$$module$build$src$core$input_types.DUMMY&&this.inputList[a].type===inputTypes$$module$build$src$core$input_types.DUMMY)return!1;for(a=1;a<this.inputList.length;a++)if(this.inputList[a-\n1].type===inputTypes$$module$build$src$core$input_types.VALUE&&this.inputList[a].type===inputTypes$$module$build$src$core$input_types.DUMMY)return!0;return!1}setOutputShape(a){this.outputShape_=a}getOutputShape(){return this.outputShape_}isEnabled(){return!this.disabled}setEnabled(a){if(this.isEnabled()!==a){const b=this.disabled;this.disabled=!a;fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(this,\"disabled\",null,\nb,!a))}}getInheritedDisabled(){let a=this.getSurroundParent();for(;a;){if(a.disabled)return!0;a=a.getSurroundParent()}return!1}isCollapsed(){return this.collapsed_}setCollapsed(a){this.collapsed_!==a&&(fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(this,\"collapsed\",null,this.collapsed_,a)),this.collapsed_=a)}toString(a,b){function c(l){let m=l.getCheck();!m&&l.targetConnection&&(m=l.targetConnection.getCheck());return!!m&&\n(-1!==m.indexOf(\"Boolean\")||-1!==m.indexOf(\"Number\"))}function d(){let l,m;g&&g.getType()===(null==(l=h)?void 0:l.getType())&&g.getLocation()===(null==(m=h)?void 0:m.getLocation())&&(g=null)}var e=[];b=b||\"?\";const f=ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS;ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS=!0;let g=ASTNode$$module$build$src$core$keyboard_nav$ast_node.createBlockNode(this);const h=g;for(;g;){switch(g.getType()){case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT:var k=\ng.getLocation();g.in()?c(k)&&e.push(\"(\"):e.push(b);break;case ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD:k=g.getLocation(),k.name!==COLLAPSED_FIELD_NAME$$module$build$src$core$constants&&e.push(k.getText())}k=g;g=k.in()||k.next();if(!g){g=k.out();for(d();g&&!g.next();)g=g.out(),d(),g&&g.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT&&c(g.getLocation())&&e.push(\")\");g&&(g=g.next())}}ASTNode$$module$build$src$core$keyboard_nav$ast_node.NAVIGATE_ALL_FIELDS=\nf;for(b=2;b<e.length;b++)\"(\"===e[b-2]&&\")\"===e[b]&&(e[b-2]=e[b-1],e.splice(b-1,2));e=e.reduce(function(l,m){return l+(\"(\"===l.substr(-1)||\")\"===m?\"\":\" \")+m},\"\");e=e.trim()||\"???\";a&&e.length>a&&(e=e.substring(0,a-3)+\"...\");return e}appendValueInput(a){return this.appendInput_(inputTypes$$module$build$src$core$input_types.VALUE,a)}appendStatementInput(a){return this.appendInput_(inputTypes$$module$build$src$core$input_types.STATEMENT,a)}appendDummyInput(a){return this.appendInput_(inputTypes$$module$build$src$core$input_types.DUMMY,\na||\"\")}jsonInit(a){var b=a.type?'Block \"'+a.type+'\": ':\"\";if(a.output&&a.previousStatement)throw Error(b+\"Must not have both an output and a previousStatement.\");a.style&&a.style.hat&&(this.hat=a.style.hat,a.style=null);if(a.style&&a.colour)throw Error(b+\"Must not have both a colour and a style.\");a.style?this.jsonInitStyle_(a,b):this.jsonInitColour_(a,b);for(var c=0;void 0!==a[\"message\"+c];)this.interpolate_(a[\"message\"+c],a[\"args\"+c]||[],a[\"lastDummyAlign\"+c],b),c++;void 0!==a.inputsInline&&this.setInputsInline(a.inputsInline);\nvoid 0!==a.output&&this.setOutput(!0,a.output);void 0!==a.outputShape&&this.setOutputShape(a.outputShape);void 0!==a.previousStatement&&this.setPreviousStatement(!0,a.previousStatement);void 0!==a.nextStatement&&this.setNextStatement(!0,a.nextStatement);void 0!==a.tooltip&&(c=replaceMessageReferences$$module$build$src$core$utils$parsing(a.tooltip),this.setTooltip(c));void 0!==a.enableContextMenu&&(this.contextMenu=!!a.enableContextMenu);void 0!==a.suppressPrefixSuffix&&(this.suppressPrefixSuffix=\n!!a.suppressPrefixSuffix);void 0!==a.helpUrl&&(c=replaceMessageReferences$$module$build$src$core$utils$parsing(a.helpUrl),this.setHelpUrl(c));\"string\"===typeof a.extensions&&(console.warn(b+\"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '\"+a.type+\"' block.\"),a.extensions=[a.extensions]);void 0!==a.mutator&&apply$$module$build$src$core$extensions(a.mutator,this,!0);a=a.extensions;if(Array.isArray(a))for(b=0;b<a.length;b++)apply$$module$build$src$core$extensions(a[b],\nthis,!1)}jsonInitColour_(a,b){if(\"colour\"in a)if(void 0===a.colour)console.warn(b+\"Undefined colour value.\");else{a=a.colour;try{this.setColour(a)}catch(c){console.warn(b+\"Illegal colour value: \",a)}}}jsonInitStyle_(a,b){a=a.style;try{this.setStyle(a)}catch(c){console.warn(b+\"Style does not exist: \",a)}}mixin(a,b){if(void 0!==b&&\"boolean\"!==typeof b)throw Error(\"opt_disableCheck must be a boolean if provided\");if(!b){b=[];for(const c in a)void 0!==this[c]&&b.push(c);if(b.length)throw Error(\"Mixin will overwrite block members: \"+\nJSON.stringify(b));}Object.assign(this,a)}interpolate_(a,b,c,d){a=tokenizeInterpolation$$module$build$src$core$utils$parsing(a);this.validateTokens_(a,b.length);b=this.interpolateArguments_(a,b,c);c=[];for(let e=0,f;f=b[e];e++)if(this.isInputKeyword_(f.type)){if(a=this.inputFromJson_(f,d)){for(let g=0,h;h=c[g];g++)a.appendField(h[0],h[1]);c.length=0}}else(a=this.fieldFromJson_(f))&&c.push([a,f.name])}validateTokens_(a,b){const c=[];let d=0;for(let e=0;e<a.length;e++){const f=a[e];if(\"number\"===typeof f){if(1>\nf||f>b)throw Error('Block \"'+this.type+'\": Message index %'+f+\" out of range.\");if(c[f])throw Error('Block \"'+this.type+'\": Message index %'+f+\" duplicated.\");c[f]=!0;d++}}if(d!==b)throw Error('Block \"'+this.type+'\": Message does not reference all '+b+\" arg(s).\");}interpolateArguments_(a,b,c){const d=[];for(let e=0;e<a.length;e++){let f=a[e];\"number\"===typeof f&&(f=b[f-1]);if(\"string\"===typeof f&&(f=this.stringToFieldJson_(f),!f))continue;d.push(f)}(a=d.length)&&!this.isInputKeyword_(d[a-1].type)&&\n(a={type:\"input_dummy\"},c&&(a.align=c),d.push(a));return d}fieldFromJson_(a){const b=fromJson$$module$build$src$core$field_registry(a);return!b&&a.alt?\"string\"===typeof a.alt?(a=this.stringToFieldJson_(a.alt))?this.fieldFromJson_(a):null:this.fieldFromJson_(a.alt):b}inputFromJson_(a,b){var c={LEFT:$.Align$$module$build$src$core$input.LEFT,RIGHT:$.Align$$module$build$src$core$input.RIGHT,CENTRE:$.Align$$module$build$src$core$input.CENTRE,CENTER:$.Align$$module$build$src$core$input.CENTRE};let d=null;\nswitch(a.type){case \"input_value\":d=this.appendValueInput(a.name);break;case \"input_statement\":d=this.appendStatementInput(a.name);break;case \"input_dummy\":d=this.appendDummyInput(a.name)}if(!d)return null;a.check&&d.setCheck(a.check);a.align&&(c=c[a.align.toUpperCase()],void 0===c?console.warn(b+\"Illegal align value: \",a.align):d.setAlign(c));return d}isInputKeyword_(a){return\"input_value\"===a||\"input_statement\"===a||\"input_dummy\"===a}stringToFieldJson_(a){return(a=a.trim())?{type:\"field_label\",\ntext:a}:null}appendInput_(a,b){let c=null;if(a===inputTypes$$module$build$src$core$input_types.VALUE||a===inputTypes$$module$build$src$core$input_types.STATEMENT)c=this.makeConnection_(a);a===inputTypes$$module$build$src$core$input_types.STATEMENT&&this.statementInputCount++;a=new Input$$module$build$src$core$input(a,b,this,c);this.inputList.push(a);return a}moveInputBefore(a,b){if(a!==b){var c=-1,d=b?-1:this.inputList.length;for(let e=0,f;f=this.inputList[e];e++)if(f.name===a){if(c=e,-1!==d)break}else if(b&&\nf.name===b&&(d=e,-1!==c))break;if(-1===c)throw Error('Named input \"'+a+'\" not found.');if(-1===d)throw Error('Reference input \"'+b+'\" not found.');this.moveNumberedInputBefore(c,d)}}moveNumberedInputBefore(a,b){if(a===b)throw Error(\"Can't move input to itself.\");if(a>=this.inputList.length)throw RangeError(\"Input index \"+a+\" out of bounds.\");if(b>this.inputList.length)throw RangeError(\"Reference input \"+b+\" out of bounds.\");const c=this.inputList[a];this.inputList.splice(a,1);a<b&&b--;this.inputList.splice(b,\n0,c)}removeInput(a,b){for(let c=0,d;d=this.inputList[c];c++)if(d.name===a)return d.type===inputTypes$$module$build$src$core$input_types.STATEMENT&&this.statementInputCount--,d.dispose(),this.inputList.splice(c,1),!0;if(b)return!1;throw Error(\"Input not found: \"+a);}getInput(a){for(let b=0,c;c=this.inputList[b];b++)if(c.name===a)return c;return null}getInputTargetBlock(a){return(a=this.getInput(a))&&a.connection&&a.connection.targetBlock()}getCommentText(){return this.commentModel.text}setCommentText(a){this.commentModel.text!==\na&&(fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(this,\"comment\",null,this.commentModel.text,a)),this.comment=this.commentModel.text=a)}setWarningText(a,b){}setMutator(a){}getRelativeToSurfaceXY(){return this.xy_}moveBy(a,b){if(this.parentBlock_)throw Error(\"Block has parent.\");const c=new (get$$module$build$src$core$events$utils(MOVE$$module$build$src$core$events$utils))(this);this.xy_.translate(a,b);c.recordNew();\nfire$$module$build$src$core$events$utils(c)}makeConnection_(a){return new Connection$$module$build$src$core$connection(this,a)}allInputsFilled(a){void 0===a&&(a=!0);if(!a&&this.isShadow())return!1;for(let c=0,d;d=this.inputList[c];c++)if(d.connection){var b=d.connection.targetBlock();if(!b||!b.allInputsFilled(a))return!1}return(b=this.getNextBlock())?b.allInputsFilled(a):!0}toDevString(){let a=this.type?'\"'+this.type+'\" block':\"Block\";this.id&&(a+=' (id=\"'+this.id+'\")');return a}};\nBlock$$module$build$src$core$block.COLLAPSED_INPUT_NAME=COLLAPSED_INPUT_NAME$$module$build$src$core$constants;Block$$module$build$src$core$block.COLLAPSED_FIELD_NAME=COLLAPSED_FIELD_NAME$$module$build$src$core$constants;var module$build$src$core$block={};module$build$src$core$block.Block=Block$$module$build$src$core$block;var disconnectPid$$module$build$src$core$block_animations=null,disconnectGroup$$module$build$src$core$block_animations=null,module$build$src$core$block_animations={};module$build$src$core$block_animations.connectionUiEffect=connectionUiEffect$$module$build$src$core$block_animations;module$build$src$core$block_animations.disconnectUiEffect=disconnectUiEffect$$module$build$src$core$block_animations;module$build$src$core$block_animations.disconnectUiStop=disconnectUiStop$$module$build$src$core$block_animations;\nmodule$build$src$core$block_animations.disposeUiEffect=disposeUiEffect$$module$build$src$core$block_animations;var Comment$$module$build$src$core$comment=class extends Icon$$module$build$src$core$icon{constructor(a){super(a);this.cachedText=\"\";this.paragraphElement_=this.textarea_=this.foreignObject=this.onInputWrapper=this.onChangeWrapper=this.onWheelWrapper=this.onMouseUpWrapper=null;this.model=a.commentModel;let b;this.model.text=null!=(b=this.model.text)?b:\"\";this.createIcon()}drawIcon_(a){createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,{\"class\":\"blocklyIconShape\",\nr:\"8\",cx:\"8\",cy:\"8\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyIconSymbol\",d:\"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyIconSymbol\",x:\"6.8\",y:\"10.78\",height:\"2\",width:\"2\"},a)}createEditor(){this.foreignObject=\ncreateSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FOREIGNOBJECT,{x:Bubble$$module$build$src$core$bubble.BORDER_WIDTH,y:Bubble$$module$build$src$core$bubble.BORDER_WIDTH});const a=document.createElementNS(HTML_NS$$module$build$src$core$utils$dom,\"body\");a.setAttribute(\"xmlns\",HTML_NS$$module$build$src$core$utils$dom);a.className=\"blocklyMinimalBody\";const b=this.textarea_=document.createElementNS(HTML_NS$$module$build$src$core$utils$dom,\"textarea\");b.className=\n\"blocklyCommentTextarea\";b.setAttribute(\"dir\",this.getBlock().RTL?\"RTL\":\"LTR\");let c;b.value=null!=(c=this.model.text)?c:\"\";this.resizeTextarea();a.appendChild(b);this.foreignObject.appendChild(a);this.onMouseUpWrapper=conditionalBind$$module$build$src$core$browser_events(b,\"focus\",this,this.startEdit,!0);this.onWheelWrapper=conditionalBind$$module$build$src$core$browser_events(b,\"wheel\",this,function(d){d.stopPropagation()});this.onChangeWrapper=conditionalBind$$module$build$src$core$browser_events(b,\n\"change\",this,function(d){this.cachedText!==this.model.text&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(this.getBlock(),\"comment\",null,this.cachedText,this.model.text))});this.onInputWrapper=conditionalBind$$module$build$src$core$browser_events(b,\"input\",this,function(d){this.model.text=b.value});setTimeout(b.focus.bind(b),0);return this.foreignObject}updateEditable(){super.updateEditable();this.isVisible()&&(this.disposeBubble(),\nthis.createBubble())}onBubbleResize(){this.isVisible()&&this.bubble_&&(this.model.size=this.bubble_.getBubbleSize(),this.resizeTextarea())}resizeTextarea(){if(this.textarea_&&this.foreignObject){var a=this.model.size,b=2*Bubble$$module$build$src$core$bubble.BORDER_WIDTH,c=a.width-b;a=a.height-b;this.foreignObject.setAttribute(\"width\",`${c}`);this.foreignObject.setAttribute(\"height\",`${a}`);this.textarea_.style.width=c-4+\"px\";this.textarea_.style.height=a-4+\"px\"}}setVisible(a){a!==this.isVisible()&&\n(fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(BUBBLE_OPEN$$module$build$src$core$events$utils))(this.getBlock(),a,\"comment\")),(this.model.pinned=a)?this.createBubble():this.disposeBubble())}createBubble(){this.getBlock().isEditable()?this.createEditableBubble():this.createNonEditableBubble()}createEditableBubble(){const a=this.getBlock();this.bubble_=new Bubble$$module$build$src$core$bubble(a.workspace,this.createEditor(),a.pathObject.svgPath,this.iconXY_,\nthis.model.size.width,this.model.size.height);this.bubble_.setSvgId(a.id);this.bubble_.registerResizeEvent(this.onBubbleResize.bind(this));this.applyColour()}createNonEditableBubble(){let a;this.paragraphElement_=Bubble$$module$build$src$core$bubble.textToDom(null!=(a=this.model.text)?a:\"\");this.bubble_=Bubble$$module$build$src$core$bubble.createNonEditableBubble(this.paragraphElement_,this.getBlock(),this.iconXY_);this.applyColour()}disposeBubble(){this.onMouseUpWrapper&&(unbind$$module$build$src$core$browser_events(this.onMouseUpWrapper),\nthis.onMouseUpWrapper=null);this.onWheelWrapper&&(unbind$$module$build$src$core$browser_events(this.onWheelWrapper),this.onWheelWrapper=null);this.onChangeWrapper&&(unbind$$module$build$src$core$browser_events(this.onChangeWrapper),this.onChangeWrapper=null);this.onInputWrapper&&(unbind$$module$build$src$core$browser_events(this.onInputWrapper),this.onInputWrapper=null);this.bubble_&&(this.bubble_.dispose(),this.bubble_=null);this.paragraphElement_=this.foreignObject=this.textarea_=null}startEdit(a){let b;\n(null==(b=this.bubble_)?0:b.promote())&&this.textarea_.focus();this.cachedText=this.model.text}getBubbleSize(){return this.model.size}setBubbleSize(a,b){this.bubble_?this.bubble_.setBubbleSize(a,b):(this.model.size.width=a,this.model.size.height=b)}updateText(){if(this.textarea_){let a;this.textarea_.value=null!=(a=this.model.text)?a:\"\"}else this.paragraphElement_&&(this.paragraphElement_.firstChild.textContent=this.model.text)}dispose(){this.getBlock().comment=null;super.dispose()}};register$$module$build$src$core$css(\"\\n.blocklyCommentTextarea {\\n  background-color: #fef49c;\\n  border: 0;\\n  display: block;\\n  margin: 0;\\n  outline: 0;\\n  padding: 3px;\\n  resize: none;\\n  text-overflow: hidden;\\n}\\n\");\nvar module$build$src$core$comment={};module$build$src$core$comment.Comment=Comment$$module$build$src$core$comment;var copyData$$module$build$src$core$clipboard=null,TEST_ONLY$$module$build$src$core$clipboard={duplicateInternal:duplicateInternal$$module$build$src$core$clipboard,copyInternal:copyInternal$$module$build$src$core$clipboard},module$build$src$core$clipboard={};module$build$src$core$clipboard.TEST_ONLY=TEST_ONLY$$module$build$src$core$clipboard;module$build$src$core$clipboard.copy=copy$$module$build$src$core$clipboard;module$build$src$core$clipboard.duplicate=duplicate$$module$build$src$core$clipboard;\nmodule$build$src$core$clipboard.paste=paste$$module$build$src$core$clipboard;var currentBlock$$module$build$src$core$contextmenu,dummyOwner$$module$build$src$core$contextmenu,menu_$$module$build$src$core$contextmenu;currentBlock$$module$build$src$core$contextmenu=null;dummyOwner$$module$build$src$core$contextmenu={};menu_$$module$build$src$core$contextmenu=null;$.module$build$src$core$contextmenu={};$.module$build$src$core$contextmenu.callbackFactory=callbackFactory$$module$build$src$core$contextmenu;$.module$build$src$core$contextmenu.commentDeleteOption=commentDeleteOption$$module$build$src$core$contextmenu;\n$.module$build$src$core$contextmenu.commentDuplicateOption=commentDuplicateOption$$module$build$src$core$contextmenu;$.module$build$src$core$contextmenu.dispose=dispose$$module$build$src$core$contextmenu;$.module$build$src$core$contextmenu.getCurrentBlock=getCurrentBlock$$module$build$src$core$contextmenu;$.module$build$src$core$contextmenu.hide=hide$$module$build$src$core$contextmenu;$.module$build$src$core$contextmenu.setCurrentBlock=setCurrentBlock$$module$build$src$core$contextmenu;\n$.module$build$src$core$contextmenu.show=show$$module$build$src$core$contextmenu;$.module$build$src$core$contextmenu.workspaceCommentOption=workspaceCommentOption$$module$build$src$core$contextmenu;var ContextMenuRegistry$$module$build$src$core$contextmenu_registry=class{constructor(){this.registry_=new Map;this.reset()}reset(){this.registry_.clear()}register(a){if(this.registry_.has(a.id))throw Error('Menu item with ID \"'+a.id+'\" is already registered.');this.registry_.set(a.id,a)}unregister(a){if(!this.registry_.has(a))throw Error('Menu item with ID \"'+a+'\" not found.');this.registry_.delete(a)}getItem(a){let b;return null!=(b=this.registry_.get(a))?b:null}getContextMenuOptions(a,b){const c=\n[];for(const e of this.registry_.values())if(a===e.scopeType){var d=e.preconditionFn(b);\"hidden\"!==d&&(d={text:\"function\"===typeof e.displayText?e.displayText(b):e.displayText,enabled:\"enabled\"===d,callback:e.callback,scope:b,weight:e.weight},c.push(d))}c.sort(function(e,f){return e.weight-f.weight});return c}};\n(function(a){var b=a.ScopeType||(a.ScopeType={});b.BLOCK=\"block\";b.WORKSPACE=\"workspace\";a.registry=new a})(ContextMenuRegistry$$module$build$src$core$contextmenu_registry||(ContextMenuRegistry$$module$build$src$core$contextmenu_registry={}));var ScopeType$$module$build$src$core$contextmenu_registry=ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType,module$build$src$core$contextmenu_registry={};module$build$src$core$contextmenu_registry.ContextMenuRegistry=ContextMenuRegistry$$module$build$src$core$contextmenu_registry;\nmodule$build$src$core$contextmenu_registry.ScopeType=ScopeType$$module$build$src$core$contextmenu_registry;var COLLAPSE_CHARS$$module$build$src$core$internal_constants=30,DRAG_STACK$$module$build$src$core$internal_constants=!0,OPPOSITE_TYPE$$module$build$src$core$internal_constants=[];OPPOSITE_TYPE$$module$build$src$core$internal_constants[ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE]=ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE;OPPOSITE_TYPE$$module$build$src$core$internal_constants[ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE]=ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE;\nOPPOSITE_TYPE$$module$build$src$core$internal_constants[ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT]=ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT;OPPOSITE_TYPE$$module$build$src$core$internal_constants[ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT]=ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT;\nvar RENAME_VARIABLE_ID$$module$build$src$core$internal_constants=\"RENAME_VARIABLE_ID\",DELETE_VARIABLE_ID$$module$build$src$core$internal_constants=\"DELETE_VARIABLE_ID\",module$build$src$core$internal_constants={};module$build$src$core$internal_constants.COLLAPSE_CHARS=COLLAPSE_CHARS$$module$build$src$core$internal_constants;module$build$src$core$internal_constants.DELETE_VARIABLE_ID=DELETE_VARIABLE_ID$$module$build$src$core$internal_constants;module$build$src$core$internal_constants.DRAG_STACK=DRAG_STACK$$module$build$src$core$internal_constants;\nmodule$build$src$core$internal_constants.OPPOSITE_TYPE=OPPOSITE_TYPE$$module$build$src$core$internal_constants;module$build$src$core$internal_constants.RENAME_VARIABLE_ID=RENAME_VARIABLE_ID$$module$build$src$core$internal_constants;var Marker$$module$build$src$core$keyboard_nav$marker=class{constructor(){this.drawer_=this.curNode_=this.colour=null;this.type=\"marker\"}setDrawer(a){this.drawer_=a}getDrawer(){return this.drawer_}getCurNode(){return this.curNode_}setCurNode(a){const b=this.curNode_;this.curNode_=a;this.drawer_&&this.drawer_.draw(b,this.curNode_)}draw(){this.drawer_&&this.drawer_.draw(this.curNode_,this.curNode_)}hide(){this.drawer_&&this.drawer_.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},module$build$src$core$keyboard_nav$marker=\n{};module$build$src$core$keyboard_nav$marker.Marker=Marker$$module$build$src$core$keyboard_nav$marker;var Cursor$$module$build$src$core$keyboard_nav$cursor=class extends Marker$$module$build$src$core$keyboard_nav$marker{constructor(){super();this.type=\"cursor\"}next(){var a=this.getCurNode();if(!a)return null;for(a=a.next();a&&a.next()&&(a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT||a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK);)a=a.next();a&&this.setCurNode(a);return a}in(){var a=this.getCurNode();if(!a)return null;if(a.getType()===\nASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS||a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT)a=a.next();let b,c;(a=null!=(c=null==(b=a)?void 0:b.in())?c:null)&&this.setCurNode(a);return a}prev(){var a=this.getCurNode();if(!a)return null;for(a=a.prev();a&&a.prev()&&(a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT||a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK);)a=a.prev();a&&this.setCurNode(a);\nreturn a}out(){var a=this.getCurNode();if(!a)return null;(a=a.out())&&a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK&&(a=a.prev()||a);a&&this.setCurNode(a);return a}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.CURSOR,DEFAULT$$module$build$src$core$registry,Cursor$$module$build$src$core$keyboard_nav$cursor);var module$build$src$core$keyboard_nav$cursor={};module$build$src$core$keyboard_nav$cursor.Cursor=Cursor$$module$build$src$core$keyboard_nav$cursor;var BasicCursor$$module$build$src$core$keyboard_nav$basic_cursor=class extends Cursor$$module$build$src$core$keyboard_nav$cursor{constructor(){super()}next(){var a=this.getCurNode();if(!a)return null;(a=this.getNextNode_(a,this.validNode_))&&this.setCurNode(a);return a}in(){return this.next()}prev(){var a=this.getCurNode();if(!a)return null;(a=this.getPreviousNode_(a,this.validNode_))&&this.setCurNode(a);return a}out(){return this.prev()}getNextNode_(a,b){if(!a)return null;const c=a.in()||a.next();\nif(b(c))return c;if(c)return this.getNextNode_(c,b);a=this.findSiblingOrParent_(a.out());return b(a)?a:a?this.getNextNode_(a,b):null}getPreviousNode_(a,b){if(!a)return null;let c=a.prev();c=c?this.getRightMostChild_(c):a.out();return b(c)?c:c?this.getPreviousNode_(c,b):null}validNode_(a){let b=!1;a=a&&a.getType();if(a===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT||a===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.INPUT||a===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD||\na===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.NEXT||a===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS||a===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.WORKSPACE)b=!0;return b}findSiblingOrParent_(a){if(!a)return null;const b=a.next();return b?b:this.findSiblingOrParent_(a.out())}getRightMostChild_(a){if(!a.in())return a;for(a=a.in();a&&a.next();)a=a.next();return this.getRightMostChild_(a)}};\nBasicCursor$$module$build$src$core$keyboard_nav$basic_cursor.registrationName=\"basicCursor\";register$$module$build$src$core$registry(Type$$module$build$src$core$registry.CURSOR,BasicCursor$$module$build$src$core$keyboard_nav$basic_cursor.registrationName,BasicCursor$$module$build$src$core$keyboard_nav$basic_cursor);var module$build$src$core$keyboard_nav$basic_cursor={};module$build$src$core$keyboard_nav$basic_cursor.BasicCursor=BasicCursor$$module$build$src$core$keyboard_nav$basic_cursor;var TabNavigateCursor$$module$build$src$core$keyboard_nav$tab_navigate_cursor=class extends BasicCursor$$module$build$src$core$keyboard_nav$basic_cursor{validNode_(a){let b=!1;const c=a&&a.getType();a&&(a=a.getLocation(),c===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD&&a&&a.isTabNavigable()&&a.isClickable()&&(b=!0));return b}},module$build$src$core$keyboard_nav$tab_navigate_cursor={};module$build$src$core$keyboard_nav$tab_navigate_cursor.TabNavigateCursor=TabNavigateCursor$$module$build$src$core$keyboard_nav$tab_navigate_cursor;var BUMP_RANDOMNESS$$module$build$src$core$rendered_connection=10,RenderedConnection$$module$build$src$core$rendered_connection=class extends Connection$$module$build$src$core$connection{constructor(a,b){super(a,b);this.targetConnection=this.highlightPath=null;this.db_=a.workspace.connectionDBList[b];this.dbOpposite_=a.workspace.connectionDBList[OPPOSITE_TYPE$$module$build$src$core$internal_constants[b]];this.offsetInBlock_=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.trackedState_=\nRenderedConnection$$module$build$src$core$rendered_connection.TrackedState.WILL_TRACK}dispose(){super.dispose();this.trackedState_===RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(a){const b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)}bumpAwayFrom(a){if(!this.sourceBlock_.workspace.isDragging()){var b=this.sourceBlock_.getRootBlock();\nif(!b.isInFlyout){var c=!1;if(!b.isMovable()){b=a.getSourceBlock().getRootBlock();if(!b.isMovable())return;a=this;c=!0}var d=getSelected$$module$build$src$core$common()==b;d||b.addSelect();var e=a.x+$.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*BUMP_RANDOMNESS$$module$build$src$core$rendered_connection)-this.x,f=a.y+$.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*BUMP_RANDOMNESS$$module$build$src$core$rendered_connection)-this.y;c&&(f=-f);b.RTL&&\n(e=a.x-$.config$$module$build$src$core$config.snapRadius-Math.floor(Math.random()*BUMP_RANDOMNESS$$module$build$src$core$rendered_connection)-this.x);b.moveBy(e,f);d||b.removeSelect()}}}moveTo(a,b){this.trackedState_===RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.WILL_TRACK?(this.db_.addConnection(this,b),this.trackedState_=RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.TRACKED):this.trackedState_===RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.TRACKED&&\n(this.db_.removeConnection(this,this.y),this.db_.addConnection(this,b));this.x=a;this.y=b}moveBy(a,b){this.moveTo(this.x+a,this.y+b)}moveToOffset(a){this.moveTo(a.x+this.offsetInBlock_.x,a.y+this.offsetInBlock_.y)}setOffsetInBlock(a,b){this.offsetInBlock_.x=a;this.offsetInBlock_.y=b}getOffsetInBlock(){return this.offsetInBlock_}tighten(){const a=this.targetConnection.x-this.x,b=this.targetConnection.y-this.y;if(0!==a||0!==b){const d=this.targetBlock();var c=d.getSvgRoot();if(!c)throw Error(\"block is not rendered.\");\nc=getRelativeXY$$module$build$src$core$utils$svg_math(c);d.getSvgRoot().setAttribute(\"transform\",\"translate(\"+(c.x-a)+\",\"+(c.y-b)+\")\");d.moveConnections(-a,-b)}}closest(a,b){return this.dbOpposite_.searchForClosest(this,a,b)}highlight(){if(!this.highlightPath){var a=this.sourceBlock_.workspace.getRenderer().getConstants();var b=a.shapeFor(this);this.type===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE||this.type===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE?\n(a=a.TAB_OFFSET_FROM_TOP,b=moveBy$$module$build$src$core$utils$svg_paths(0,-a)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a)+b.pathDown+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a)):(a=a.NOTCH_OFFSET_LEFT-a.CORNER_RADIUS,b=moveBy$$module$build$src$core$utils$svg_paths(-a,0)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",a)+b.pathLeft+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",a));a=this.sourceBlock_.getRelativeToSurfaceXY();this.highlightPath=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,\n{\"class\":\"blocklyHighlightedConnectionPath\",d:b,transform:\"translate(\"+(this.x-a.x)+\",\"+(this.y-a.y)+\")\"+(this.sourceBlock_.RTL?\" scale(-1 1)\":\"\")},this.sourceBlock_.getSvgRoot())}}unhighlight(){this.highlightPath&&(removeNode$$module$build$src$core$utils$dom(this.highlightPath),this.highlightPath=null)}setTracking(a){a&&this.trackedState_===RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.TRACKED||!a&&this.trackedState_===RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.UNTRACKED||\nthis.sourceBlock_.isInFlyout||(a?(this.db_.addConnection(this,this.y),this.trackedState_=RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.TRACKED):(this.trackedState_===RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y),this.trackedState_=RenderedConnection$$module$build$src$core$rendered_connection.TrackedState.UNTRACKED))}stopTrackingAll(){this.setTracking(!1);if(this.targetConnection){const c=this.targetBlock().getDescendants(!1);\nfor(let d=0;d<c.length;d++){var a=c[d],b=a.getConnections_(!0);for(let e=0;e<b.length;e++)b[e].setTracking(!1);a=a.getIcons();for(b=0;b<a.length;b++)a[b].setVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let a=[];if(this.type!==ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE&&this.type!==ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT)return a;const b=this.targetBlock();if(b){let c;b.isCollapsed()?(c=[],b.outputConnection&&c.push(b.outputConnection),b.nextConnection&&\nc.push(b.nextConnection),b.previousConnection&&c.push(b.previousConnection)):c=b.getConnections_(!0);for(let d=0;d<c.length;d++)a.push(...c[d].startTrackingAll());a.length||(a=[b])}return a}onFailedConnect(a){const b=this.getSourceBlock();if(getRecordUndo$$module$build$src$core$events$utils()){const c=getGroup$$module$build$src$core$events$utils();setTimeout(function(){b.isDisposed()||b.getParent()||(setGroup$$module$build$src$core$events$utils(c),this.bumpAwayFrom(a),setGroup$$module$build$src$core$events$utils(!1))}.bind(this),\n$.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal_(a,b){super.disconnectInternal_(a,b);a.rendered&&a.render();b.rendered&&(b.updateDisabled(),b.render(),b.getSvgRoot().style.display=\"block\")}respawnShadow_(){super.respawnShadow_();var a=this.targetBlock();a&&(a.initSvg(),a.render(!1),a=this.getSourceBlock(),a.rendered&&a.render())}neighbours(a){return this.dbOpposite_.getNeighbours(this,a)}connect_(a){super.connect_(a);var b=this.getSourceBlock();a=a.getSourceBlock();const c=b.rendered,\nd=a.rendered;c&&b.updateDisabled();d&&a.updateDisabled();c&&d&&(this.type===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT||this.type===ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT?a.render():b.render());if(b=b.getInputWithBlock(a))b=b.isVisible(),a.getSvgRoot().style.display=b?\"block\":\"none\"}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||((this.isSuperior()?this.targetBlock():\nthis.sourceBlock_).unplug(),this.sourceBlock_.bumpNeighbours())}};(function(a){a=a.TrackedState||(a.TrackedState={});a[a.WILL_TRACK=-1]=\"WILL_TRACK\";a[a.UNTRACKED=0]=\"UNTRACKED\";a[a.TRACKED=1]=\"TRACKED\"})(RenderedConnection$$module$build$src$core$rendered_connection||(RenderedConnection$$module$build$src$core$rendered_connection={}));\nvar TrackedState$$module$build$src$core$rendered_connection=RenderedConnection$$module$build$src$core$rendered_connection.TrackedState,module$build$src$core$rendered_connection={};module$build$src$core$rendered_connection.RenderedConnection=RenderedConnection$$module$build$src$core$rendered_connection;module$build$src$core$rendered_connection.TrackedState=TrackedState$$module$build$src$core$rendered_connection;var Warning$$module$build$src$core$warning=class extends Icon$$module$build$src$core$icon{constructor(a){super(a);this.paragraphElement=null;this.collapseHidden=!1;this.createIcon();this.text=Object.create(null)}drawIcon_(a){createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyIconShape\",d:\"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,\n{\"class\":\"blocklyIconSymbol\",d:\"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyIconSymbol\",x:\"7\",y:\"11\",height:\"2\",width:\"2\"},a)}setVisible(a){a!==this.isVisible()&&(fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(BUBBLE_OPEN$$module$build$src$core$events$utils))(this.getBlock(),a,\"warning\")),a?this.createBubble():this.disposeBubble())}createBubble(){this.paragraphElement=\nBubble$$module$build$src$core$bubble.textToDom(this.getText());this.bubble_=Bubble$$module$build$src$core$bubble.createNonEditableBubble(this.paragraphElement,this.getBlock(),this.iconXY_);this.applyColour()}disposeBubble(){this.bubble_&&(this.bubble_.dispose(),this.bubble_=null);this.paragraphElement=null}setText(a,b){this.text[b]!==a&&(a?this.text[b]=a:delete this.text[b],this.isVisible()&&(this.setVisible(!1),this.setVisible(!0)))}getText(){const a=[];for(const b in this.text)a.push(this.text[b]);\nreturn a.join(\"\\n\")}dispose(){this.getBlock().warning=null;super.dispose()}},module$build$src$core$warning={};module$build$src$core$warning.Warning=Warning$$module$build$src$core$warning;var BlockSvg$$module$build$src$core$block_svg=class extends Block$$module$build$src$core$block{constructor(a,b,c){super(a,b,c);this.renderingDebugger=null;this.width=this.height=0;this.warningTextDb=new Map;this.warning=this.commentIcon_=this.mutator=null;this.eventsInit_=this.renderIsInProgress_=this.rendered=!1;this.workspace=a;this.decompose=this.decompose;this.compose=this.compose;this.saveConnections=this.saveConnections;this.customContextMenu=this.customContextMenu;this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,\n{});this.svgGroup_.translate_=\"\";this.style=a.getRenderer().getConstants().getBlockStyle(null);this.pathObject=a.getRenderer().makePathObject(this.svgGroup_,this.style);this.useDragSurface_=!!a.getBlockDragSurface();a=this.pathObject.svgPath;a.tooltip=this;bindMouseEvents$$module$build$src$core$tooltip(a);this.svgGroup_.setAttribute(\"data-id\",this.id);this.doInit_()}initSvg(){if(!this.workspace.rendered)throw TypeError(\"Workspace is headless.\");for(let b=0,c;c=this.inputList[b];b++)c.init();var a=\nthis.getIcons();for(let b=0;b<a.length;b++)a[b].createIcon();this.applyColour();this.pathObject.updateMovable(this.isMovable());a=this.getSvgRoot();this.workspace.options.readOnly||this.eventsInit_||!a||conditionalBind$$module$build$src$core$browser_events(a,\"pointerdown\",this,this.onMouseDown_);this.eventsInit_=!0;a.parentNode||this.workspace.getCanvas().appendChild(a)}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()&&\nthis.getParent())this.getParent().select();else if(getSelected$$module$build$src$core$common()!==this){var a=null;if(getSelected$$module$build$src$core$common()){a=getSelected$$module$build$src$core$common().id;disable$$module$build$src$core$events$utils();try{getSelected$$module$build$src$core$common().unselect()}finally{enable$$module$build$src$core$events$utils()}}a=new (get$$module$build$src$core$events$utils(SELECTED$$module$build$src$core$events$utils))(a,this.id,this.workspace.id);fire$$module$build$src$core$events$utils(a);\nsetSelected$$module$build$src$core$common(this);this.addSelect()}}unselect(){if(getSelected$$module$build$src$core$common()===this){var a=new (get$$module$build$src$core$events$utils(SELECTED$$module$build$src$core$events$utils))(this.id,null,this.workspace.id);a.workspaceId=this.workspace.id;fire$$module$build$src$core$events$utils(a);setSelected$$module$build$src$core$common(null);this.removeSelect()}}getIcons(){const a=[];this.mutator&&a.push(this.mutator);this.commentIcon_&&a.push(this.commentIcon_);\nthis.warning&&a.push(this.warning);return a}setParent(a){const b=this.parentBlock_;if(a!==b){startTextWidthCache$$module$build$src$core$utils$dom();super.setParent(a);stopTextWidthCache$$module$build$src$core$utils$dom();var c=this.getSvgRoot();if(!this.workspace.isClearing&&c){var d=this.getRelativeToSurfaceXY();a?(a.getSvgRoot().appendChild(c),a=this.getRelativeToSurfaceXY(),this.moveConnections(a.x-d.x,a.y-d.y)):b&&(this.workspace.getCanvas().appendChild(c),this.translate(d.x,d.y));this.applyColour()}}}getRelativeToSurfaceXY(){let a=\n0,b=0;const c=this.useDragSurface_?this.workspace.getBlockDragSurface().getGroup():null;let d=this.getSvgRoot();if(d){do{var e=getRelativeXY$$module$build$src$core$utils$svg_math(d);a+=e.x;b+=e.y;this.useDragSurface_&&this.workspace.getBlockDragSurface().getCurrentBlock()===d&&(e=this.workspace.getBlockDragSurface().getSurfaceTranslation(),a+=e.x,b+=e.y);d=d.parentNode}while(d&&d!==this.workspace.getCanvas()&&d!==c)}return new Coordinate$$module$build$src$core$utils$coordinate(a,b)}moveBy(a,b){if(this.parentBlock_)throw Error(\"Block has parent.\");\nconst c=isEnabled$$module$build$src$core$events$utils();let d=null;c&&(d=new (get$$module$build$src$core$events$utils(MOVE$$module$build$src$core$events$utils))(this));const e=this.getRelativeToSurfaceXY();this.translate(e.x+a,e.y+b);this.moveConnections(a,b);c&&d&&(d.recordNew(),fire$$module$build$src$core$events$utils(d));this.workspace.resizeContents()}translate(a,b){this.getSvgRoot().setAttribute(\"transform\",\"translate(\"+a+\",\"+b+\")\")}moveToDragSurface(){if(this.useDragSurface_){var a=this.getRelativeToSurfaceXY();\nthis.clearTransformAttributes_();this.workspace.getBlockDragSurface().translateSurface(a.x,a.y);(a=this.getSvgRoot())&&this.workspace.getBlockDragSurface().setBlocksAndShow(a)}}moveTo(a){const b=this.getRelativeToSurfaceXY();this.moveBy(a.x-b.x,a.y-b.y)}moveOffDragSurface(a){this.useDragSurface_&&(this.translate(a.x,a.y),this.workspace.getBlockDragSurface().clearAndHide(this.workspace.getCanvas()))}moveDuringDrag(a){this.useDragSurface_?this.workspace.getBlockDragSurface().translateSurface(a.x,a.y):\n(this.svgGroup_.translate_=\"translate(\"+a.x+\",\"+a.y+\")\",this.svgGroup_.setAttribute(\"transform\",this.svgGroup_.translate_+this.svgGroup_.skew_))}clearTransformAttributes_(){this.getSvgRoot().removeAttribute(\"transform\")}snapToGrid(){if(!(this.isDeadOrDying()||this.workspace.isDragging()||this.getParent()||this.isInFlyout)){var a=this.workspace.getGrid();if(a&&a.shouldSnap()){var b=a.getSpacing(),c=b/2,d=this.getRelativeToSurfaceXY();a=Math.round(Math.round((d.x-c)/b)*b+c-d.x);b=Math.round(Math.round((d.y-\nc)/b)*b+c-d.y);(a||b)&&this.moveBy(a,b)}}}getBoundingRectangle(){const a=this.getRelativeToSurfaceXY(),b=this.getHeightWidth();let c,d;this.RTL?(c=a.x-b.width,d=a.x):(c=a.x,d=a.x+b.width);return new Rect$$module$build$src$core$utils$rect(a.y,a.y+b.height,c,d)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let a=0,b;b=this.inputList[a];a++)b.markDirty()}setCollapsed(a){this.collapsed_!==a&&(super.setCollapsed(a),a?this.rendered&&this.render():this.updateCollapsed_())}updateCollapsed_(){var a=\nthis.isCollapsed();const b=COLLAPSED_INPUT_NAME$$module$build$src$core$constants,c=COLLAPSED_FIELD_NAME$$module$build$src$core$constants;for(let e=0,f;f=this.inputList[e];e++)f.name!==b&&f.setVisible(!a);if(a){a=this.getIcons();for(let e=0,f;f=a[e];e++)f.setVisible(!1);a=this.toString(COLLAPSE_CHARS$$module$build$src$core$internal_constants);var d=this.getField(c);d?d.setValue(a):(this.getInput(b)||this.appendDummyInput(b)).appendField(new $.FieldLabel$$module$build$src$core$field_label(a),c)}else this.updateDisabled(),\nthis.removeInput(b)}tab(a,b){const c=new TabNavigateCursor$$module$build$src$core$keyboard_nav$tab_navigate_cursor;c.setCurNode(ASTNode$$module$build$src$core$keyboard_nav$ast_node.createFieldNode(a));a=c.getCurNode();b?c.next():c.prev();(b=c.getCurNode())&&b!==a&&(b.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(b))}onMouseDown_(a){const b=this.workspace.getGesture(a);b&&b.handleBlockStart(a,this)}showHelp(){const a=\"function\"===typeof this.helpUrl?\nthis.helpUrl():this.helpUrl;a&&window.open(a)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const a=ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.getContextMenuOptions(ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.BLOCK,{block:this});this.customContextMenu&&this.customContextMenu(a);return a}showContextMenu(a){const b=this.generateContextMenu();b&&b.length&&(show$$module$build$src$core$contextmenu(a,b,\nthis.RTL),setCurrentBlock$$module$build$src$core$contextmenu(this))}moveConnections(a,b){if(this.rendered){var c=this.getConnections_(!1);for(var d=0;d<c.length;d++)c[d].moveBy(a,b);c=this.getIcons();for(d=0;d<c.length;d++)c[d].computeIconLocation();for(c=0;c<this.childBlocks_.length;c++)this.childBlocks_[c].moveConnections(a,b)}}setDragging(a){if(a){var b=this.getSvgRoot();b.translate_=\"\";b.skew_=\"\";draggingConnections$$module$build$src$core$common.push(...this.getConnections_(!0));addClass$$module$build$src$core$utils$dom(this.svgGroup_,\n\"blocklyDragging\")}else draggingConnections$$module$build$src$core$common.length=0,removeClass$$module$build$src$core$utils$dom(this.svgGroup_,\"blocklyDragging\");for(b=0;b<this.childBlocks_.length;b++)this.childBlocks_[b].setDragging(a)}setMovable(a){super.setMovable(a);this.pathObject.updateMovable(a)}setEditable(a){super.setEditable(a);a=this.getIcons();for(let b=0;b<a.length;b++)a[b].updateEditable()}setShadow(a){super.setShadow(a);this.applyColour()}setInsertionMarker(a){this.isInsertionMarker_!==\na&&(this.isInsertionMarker_=a)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup_}dispose(a,b){if(!this.isDeadOrDying()){dispose$$module$build$src$core$tooltip();unbindMouseEvents$$module$build$src$core$tooltip(this.pathObject.svgPath);startTextWidthCache$$module$build$src$core$utils$dom();var c=this.workspace;getSelected$$module$build$src$core$common()===this&&(this.unselect(),this.workspace.cancelCurrentGesture());\ngetCurrentBlock$$module$build$src$core$contextmenu()===this&&hide$$module$build$src$core$contextmenu();b&&this.rendered&&(this.unplug(a),disposeUiEffect$$module$build$src$core$block_animations(this));this.rendered=!1;for(var d of this.warningTextDb.values())clearTimeout(d);this.warningTextDb.clear();b=this.getIcons();for(d=0;d<b.length;d++)b[d].dispose();getSelected$$module$build$src$core$common()===this&&setSelected$$module$build$src$core$common(null);super.dispose(!!a);removeNode$$module$build$src$core$utils$dom(this.svgGroup_);\nc.resizeContents();this.svgGroup_=null;stopTextWidthCache$$module$build$src$core$utils$dom()}}checkAndDelete(){this.workspace.isFlyout||(setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{saveInfo:save$$module$build$src$core$serialization$blocks(this,{addCoordinates:!0,addNextBlocks:!1}),source:this.workspace,typeCounts:getBlockTypeCounts$$module$build$src$core$common(this,\n!0)}}applyColour(){this.pathObject.applyColour(this);const a=this.getIcons();for(let b=0;b<a.length;b++)a[b].applyColour();for(let b=0,c;c=this.inputList[b];b++)for(let d=0,e;e=c.fieldRow[d];d++)e.applyColour()}updateDisabled(){const a=this.getChildren(!1);this.applyColour();if(!this.isCollapsed())for(let b=0,c;c=a[b];b++)c.rendered&&c.updateDisabled()}getCommentIcon(){return this.commentIcon_}setCommentText(a){this.commentModel.text!==a&&(super.setCommentText(a),a=null!==a,!!this.commentIcon_===\na?this.commentIcon_.updateText():(a?this.comment=this.commentIcon_=new Comment$$module$build$src$core$comment(this):(this.commentIcon_.dispose(),this.comment=this.commentIcon_=null),this.rendered&&(this.render(),this.bumpNeighbours())))}setWarningText(a,b){const c=b||\"\";if(c)this.warningTextDb.has(c)&&(clearTimeout(this.warningTextDb.get(c)),this.warningTextDb.delete(c));else{for(var d of this.warningTextDb.values())clearTimeout(d);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(c,\nsetTimeout(()=>{this.isDeadOrDying()||(this.warningTextDb.delete(c),this.setWarningText(a,c))},100));else{this.isInFlyout&&(a=null);b=!1;if(\"string\"===typeof a){d=this.getSurroundParent();let e=null;for(;d;)d.isCollapsed()&&(e=d),d=d.getSurroundParent();e&&e.setWarningText(Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,BlockSvg$$module$build$src$core$block_svg.COLLAPSED_WARNING_ID);this.warning||(this.warning=new Warning$$module$build$src$core$warning(this),b=!0);this.warning.setText(a,\nc)}else this.warning&&!c?(this.warning.dispose(),b=!0):this.warning&&(b=this.warning.getText(),this.warning.setText(\"\",c),(d=this.warning.getText())||this.warning.dispose(),b=b!==d);b&&this.rendered&&(this.render(),this.bumpNeighbours())}}setMutator(a){this.mutator&&this.mutator!==a&&this.mutator.dispose();a&&(a.setBlock(this),this.mutator=a,a.createIcon());this.rendered&&(this.render(),this.bumpNeighbours())}setEnabled(a){this.isEnabled()!==a&&(super.setEnabled(a),this.rendered&&!this.getInheritedDisabled()&&\nthis.updateDisabled())}setHighlighted(a){this.rendered&&this.pathObject.updateHighlighted(a)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(a){this.pathObject.updateDraggingDelete(a)}getColour(){return this.style.colourPrimary}setColour(a){super.setColour(a);a=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_);this.pathObject.setStyle(a.style);this.style=a.style;this.styleName_=a.name;this.applyColour()}setStyle(a){const b=\nthis.workspace.getRenderer().getConstants().getBlockStyle(a);this.styleName_=a;if(b)this.hat=b.hat,this.pathObject.setStyle(b),this.colour_=b.colourPrimary,this.style=b,this.applyColour();else throw Error(\"Invalid style name: \"+a);}bringToFront(){let a=this;do{const b=a.getSvgRoot(),c=b.parentNode,d=c.childNodes;d[d.length-1]!==b&&c.appendChild(b);a=a.getParent()}while(a)}setPreviousStatement(a,b){super.setPreviousStatement(a,b);this.rendered&&(this.render(),this.bumpNeighbours())}setNextStatement(a,\nb){super.setNextStatement(a,b);this.rendered&&(this.render(),this.bumpNeighbours())}setOutput(a,b){super.setOutput(a,b);this.rendered&&(this.render(),this.bumpNeighbours())}setInputsInline(a){super.setInputsInline(a);this.rendered&&(this.render(),this.bumpNeighbours())}removeInput(a,b){a=super.removeInput(a,b);this.rendered&&(this.render(),this.bumpNeighbours());return a}moveNumberedInputBefore(a,b){super.moveNumberedInputBefore(a,b);this.rendered&&(this.render(),this.bumpNeighbours())}appendInput_(a,\nb){a=super.appendInput_(a,b);this.rendered&&(this.render(),this.bumpNeighbours());return a}setConnectionTracking(a){this.previousConnection&&this.previousConnection.setTracking(a);this.outputConnection&&this.outputConnection.setTracking(a);if(this.nextConnection){this.nextConnection.setTracking(a);var b=this.nextConnection.targetBlock();b&&b.setConnectionTracking(a)}if(!this.collapsed_)for(b=0;b<this.inputList.length;b++){var c=this.inputList[b].connection;c&&(c.setTracking(a),(c=c.targetBlock())&&\nc.setConnectionTracking(a))}}getConnections_(a){const b=[];if(a||this.rendered)if(this.outputConnection&&b.push(this.outputConnection),this.previousConnection&&b.push(this.previousConnection),this.nextConnection&&b.push(this.nextConnection),a||!this.collapsed_)for(let c=0,d;d=this.inputList[c];c++)d.connection&&b.push(d.connection);return b}lastConnectionInStack(a){return super.lastConnectionInStack(a)}getMatchingConnection(a,b){return super.getMatchingConnection(a,b)}makeConnection_(a){return new RenderedConnection$$module$build$src$core$rendered_connection(this,\na)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){this.getRootBlock().bumpNeighboursInternal()}bumpNeighboursInternal(){const a=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||a.isInFlyout))for(const b of this.getConnections_(!1)){if(b.isSuperior()){let c;null==(c=b.targetBlock())||c.bumpNeighboursInternal()}for(const c of b.neighbours($.config$$module$build$src$core$config.snapRadius))c.getSourceBlock().getRootBlock()!==\na&&(b.isConnected()&&c.isConnected()||(b.isSuperior()?c.bumpAwayFrom(b):b.bumpAwayFrom(c)))}}scheduleSnapAndBump(){const a=getGroup$$module$build$src$core$events$utils();setTimeout(()=>{setGroup$$module$build$src$core$events$utils(a);this.snapToGrid();setGroup$$module$build$src$core$events$utils(!1)},$.config$$module$build$src$core$config.bumpDelay/2);setTimeout(()=>{setGroup$$module$build$src$core$events$utils(a);this.bumpNeighbours();setGroup$$module$build$src$core$events$utils(!1)},$.config$$module$build$src$core$config.bumpDelay)}positionNearConnection(a,\nb){a.type!==ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT&&a.type!==ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE||this.moveBy(b.x-a.x,b.y-a.y)}getFirstStatementConnection(){return super.getFirstStatementConnection()}getChildren(a){return super.getChildren(a)}render(a){if(!this.renderIsInProgress_){this.renderIsInProgress_=!0;try{this.rendered=!0;startTextWidthCache$$module$build$src$core$utils$dom();this.isCollapsed()&&this.updateCollapsed_();this.workspace.getRenderer().render(this);\nthis.updateConnectionLocations_();if(!1!==a){const b=this.getParent();b?b.render(!0):this.workspace.resizeContents()}stopTextWidthCache$$module$build$src$core$utils$dom();this.updateMarkers_()}finally{this.renderIsInProgress_=!1}}}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw();this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(MarkerManager$$module$build$src$core$marker_manager.LOCAL_MARKER).draw()}updateConnectionLocations_(){const a=\nthis.getRelativeToSurfaceXY();this.previousConnection&&this.previousConnection.moveToOffset(a);this.outputConnection&&this.outputConnection.moveToOffset(a);for(let b=0;b<this.inputList.length;b++){const c=this.inputList[b].connection;c&&(c.moveToOffset(a),c.isConnected()&&c.tighten())}this.nextConnection&&(this.nextConnection.moveToOffset(a),this.nextConnection.isConnected()&&this.nextConnection.tighten())}setCursorSvg(a){this.pathObject.setCursorSvg(a)}setMarkerSvg(a){this.pathObject.setMarkerSvg(a)}getHeightWidth(){let a=\nthis.height,b=this.width;var c=this.getNextBlock();if(c){c=c.getHeightWidth();const d=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;a+=c.height-d;b=Math.max(b,c.width)}return{height:a,width:b}}fadeForReplacement(a){this.pathObject.updateReplacementFade(a)}highlightShapeForInput(a,b){this.pathObject.updateShapeForInputHighlight(a,b)}};BlockSvg$$module$build$src$core$block_svg.INLINE=-1;BlockSvg$$module$build$src$core$block_svg.COLLAPSED_WARNING_ID=\"TEMP_COLLAPSED_WARNING_\";\nvar module$build$src$core$block_svg={};module$build$src$core$block_svg.BlockSvg=BlockSvg$$module$build$src$core$block_svg;var DragTarget$$module$build$src$core$drag_target=class{constructor(){}onDragEnter(a){}onDragOver(a){}onDragExit(a){}onDrop(a){}getClientRect(){return null}shouldPreventMove(a){return!1}},module$build$src$core$drag_target={};module$build$src$core$drag_target.DragTarget=DragTarget$$module$build$src$core$drag_target;var DeleteArea$$module$build$src$core$delete_area=class extends DragTarget$$module$build$src$core$drag_target{constructor(){super();this.wouldDelete_=!1}wouldDelete(a,b){a instanceof BlockSvg$$module$build$src$core$block_svg?(a=!a.getParent()&&a.isDeletable(),this.updateWouldDelete_(a&&!b)):this.updateWouldDelete_(a.isDeletable());return this.wouldDelete_}updateWouldDelete_(a){this.wouldDelete_=a}},module$build$src$core$delete_area={};module$build$src$core$delete_area.DeleteArea=DeleteArea$$module$build$src$core$delete_area;var verticalPosition$$module$build$src$core$positionable_helpers;(function(a){a[a.TOP=0]=\"TOP\";a[a.BOTTOM=1]=\"BOTTOM\"})(verticalPosition$$module$build$src$core$positionable_helpers||(verticalPosition$$module$build$src$core$positionable_helpers={}));var horizontalPosition$$module$build$src$core$positionable_helpers;(function(a){a[a.LEFT=0]=\"LEFT\";a[a.RIGHT=1]=\"RIGHT\"})(horizontalPosition$$module$build$src$core$positionable_helpers||(horizontalPosition$$module$build$src$core$positionable_helpers={}));\nvar bumpDirection$$module$build$src$core$positionable_helpers;(function(a){a[a.UP=0]=\"UP\";a[a.DOWN=1]=\"DOWN\"})(bumpDirection$$module$build$src$core$positionable_helpers||(bumpDirection$$module$build$src$core$positionable_helpers={}));var module$build$src$core$positionable_helpers={};module$build$src$core$positionable_helpers.bumpDirection=bumpDirection$$module$build$src$core$positionable_helpers;module$build$src$core$positionable_helpers.bumpPositionRect=bumpPositionRect$$module$build$src$core$positionable_helpers;\nmodule$build$src$core$positionable_helpers.getCornerOppositeToolbox=getCornerOppositeToolbox$$module$build$src$core$positionable_helpers;module$build$src$core$positionable_helpers.getStartPositionRect=getStartPositionRect$$module$build$src$core$positionable_helpers;module$build$src$core$positionable_helpers.horizontalPosition=horizontalPosition$$module$build$src$core$positionable_helpers;module$build$src$core$positionable_helpers.verticalPosition=verticalPosition$$module$build$src$core$positionable_helpers;var SPRITE$$module$build$src$core$sprites={width:96,height:124,url:\"sprites.png\"},module$build$src$core$sprites={};module$build$src$core$sprites.SPRITE=SPRITE$$module$build$src$core$sprites;var Trashcan$$module$build$src$core$trashcan=class extends DeleteArea$$module$build$src$core$delete_area{constructor(a){super();this.workspace=a;this.id=\"trashcan\";this.contents_=[];this.flyout=null;this.isLidOpen=!1;this.minOpenness_=0;this.lidTask_=this.svgLid_=this.svgGroup_=null;this.top_=this.left_=this.lidOpen_=0;this.initialized_=!1;0>=this.workspace.options.maxTrashcanContents||(a=new Options$$module$build$src$core$options({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,\noneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(a.toolboxPosition=this.workspace.toolboxPosition===Position$$module$build$src$core$utils$toolbox.TOP?Position$$module$build$src$core$utils$toolbox.BOTTOM:Position$$module$build$src$core$utils$toolbox.TOP,this.flyout=new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_HORIZONTAL_TOOLBOX,\nthis.workspace.options,!0))(a)):(a.toolboxPosition=this.workspace.toolboxPosition===Position$$module$build$src$core$utils$toolbox.RIGHT?Position$$module$build$src$core$utils$toolbox.LEFT:Position$$module$build$src$core$utils$toolbox.RIGHT,this.flyout=new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(a)),this.workspace.addChangeListener(this.onDelete_.bind(this)))}createDom(){this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,\n{\"class\":\"blocklyTrash\"});let a;const b=String(Math.random()).substring(2);a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CLIPPATH,{id:\"blocklyTrashBodyClipPath\"+b},this.svgGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:WIDTH$$module$build$src$core$trashcan,height:BODY_HEIGHT$$module$build$src$core$trashcan,y:LID_HEIGHT$$module$build$src$core$trashcan},a);const c=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,\n{width:SPRITE$$module$build$src$core$sprites.width,x:-SPRITE_LEFT$$module$build$src$core$trashcan,height:SPRITE$$module$build$src$core$sprites.height,y:-SPRITE_TOP$$module$build$src$core$trashcan,\"clip-path\":\"url(#blocklyTrashBodyClipPath\"+b+\")\"},this.svgGroup_);c.setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",this.workspace.options.pathToMedia+SPRITE$$module$build$src$core$sprites.url);a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CLIPPATH,\n{id:\"blocklyTrashLidClipPath\"+b},this.svgGroup_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:WIDTH$$module$build$src$core$trashcan,height:LID_HEIGHT$$module$build$src$core$trashcan},a);this.svgLid_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{width:SPRITE$$module$build$src$core$sprites.width,x:-SPRITE_LEFT$$module$build$src$core$trashcan,height:SPRITE$$module$build$src$core$sprites.height,y:-SPRITE_TOP$$module$build$src$core$trashcan,\n\"clip-path\":\"url(#blocklyTrashLidClipPath\"+b+\")\"},this.svgGroup_);this.svgLid_.setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",this.workspace.options.pathToMedia+SPRITE$$module$build$src$core$sprites.url);bind$$module$build$src$core$browser_events(this.svgGroup_,\"pointerdown\",this,this.blockMouseDownWhenOpenable_);bind$$module$build$src$core$browser_events(this.svgGroup_,\"pointerup\",this,this.click);bind$$module$build$src$core$browser_events(c,\"pointerover\",this,this.mouseOver_);\nbind$$module$build$src$core$browser_events(c,\"pointerout\",this,this.mouseOut_);this.animateLid_();return this.svgGroup_}init(){0<this.workspace.options.maxTrashcanContents&&(insertAfter$$module$build$src$core$utils$dom(this.flyout.createDom(Svg$$module$build$src$core$utils$svg.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace));this.workspace.getComponentManager().addComponent({component:this,weight:1,capabilities:[ComponentManager$$module$build$src$core$component_manager.Capability.AUTOHIDEABLE,\nComponentManager$$module$build$src$core$component_manager.Capability.DELETE_AREA,ComponentManager$$module$build$src$core$component_manager.Capability.DRAG_TARGET,ComponentManager$$module$build$src$core$component_manager.Capability.POSITIONABLE]});this.initialized_=!0;this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent(\"trashcan\");this.svgGroup_&&(removeNode$$module$build$src$core$utils$dom(this.svgGroup_),this.svgGroup_=null);this.svgLid_=null;this.lidTask_&&clearTimeout(this.lidTask_)}hasContents_(){return!!this.contents_.length}contentsIsOpen(){return!!this.flyout&&\nthis.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var a=this.contents_.map(function(c){return JSON.parse(c)}),b=this.workspace.getParentSvg().style;b.cursor=\"wait\";setTimeout(()=>{let c;null==(c=this.flyout)||c.show(a);b.cursor=\"\"},10);this.fireUiEvent_(!0)}}closeFlyout(){if(this.contentsIsOpen()){var a;null==(a=this.flyout)||a.hide();this.fireUiEvent_(!1);this.workspace.recordDragTargets()}}autoHide(a){!a&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents_()&&(this.contents_.length=\n0,this.setMinOpenness_(0),this.closeFlyout())}position(a,b){if(this.initialized_){var c=getCornerOppositeToolbox$$module$build$src$core$positionable_helpers(this.workspace,a);a=getStartPositionRect$$module$build$src$core$positionable_helpers(c,new Size$$module$build$src$core$utils$size(WIDTH$$module$build$src$core$trashcan,BODY_HEIGHT$$module$build$src$core$trashcan+LID_HEIGHT$$module$build$src$core$trashcan),MARGIN_HORIZONTAL$$module$build$src$core$trashcan,MARGIN_VERTICAL$$module$build$src$core$trashcan,\na,this.workspace);b=bumpPositionRect$$module$build$src$core$positionable_helpers(a,MARGIN_VERTICAL$$module$build$src$core$trashcan,c.vertical===verticalPosition$$module$build$src$core$positionable_helpers.TOP?bumpDirection$$module$build$src$core$positionable_helpers.DOWN:bumpDirection$$module$build$src$core$positionable_helpers.UP,b);this.top_=b.top;this.left_=b.left;var d;null==(d=this.svgGroup_)||d.setAttribute(\"transform\",\"translate(\"+this.left_+\",\"+this.top_+\")\")}}getBoundingRectangle(){return new Rect$$module$build$src$core$utils$rect(this.top_,\nthis.top_+BODY_HEIGHT$$module$build$src$core$trashcan+LID_HEIGHT$$module$build$src$core$trashcan,this.left_,this.left_+WIDTH$$module$build$src$core$trashcan)}getClientRect(){if(!this.svgGroup_)return null;var a=this.svgGroup_.getBoundingClientRect();const b=a.top+SPRITE_TOP$$module$build$src$core$trashcan-MARGIN_HOTSPOT$$module$build$src$core$trashcan;a=a.left+SPRITE_LEFT$$module$build$src$core$trashcan-MARGIN_HOTSPOT$$module$build$src$core$trashcan;return new Rect$$module$build$src$core$utils$rect(b,\nb+LID_HEIGHT$$module$build$src$core$trashcan+BODY_HEIGHT$$module$build$src$core$trashcan+2*MARGIN_HOTSPOT$$module$build$src$core$trashcan,a,a+WIDTH$$module$build$src$core$trashcan+2*MARGIN_HOTSPOT$$module$build$src$core$trashcan)}onDragOver(a){this.setLidOpen(this.wouldDelete_)}onDragExit(a){this.setLidOpen(!1)}onDrop(a){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(a){this.isLidOpen!==a&&(this.lidTask_&&clearTimeout(this.lidTask_),this.isLidOpen=a,this.animateLid_())}animateLid_(){const a=\nANIMATION_FRAMES$$module$build$src$core$trashcan;var b=1/(a+1);this.lidOpen_+=this.isLidOpen?b:-b;this.lidOpen_=Math.min(Math.max(this.lidOpen_,this.minOpenness_),1);this.setLidAngle_(this.lidOpen_*MAX_LID_ANGLE$$module$build$src$core$trashcan);b=OPACITY_MIN$$module$build$src$core$trashcan+this.lidOpen_*(OPACITY_MAX$$module$build$src$core$trashcan-OPACITY_MIN$$module$build$src$core$trashcan);this.svgGroup_&&(this.svgGroup_.style.opacity=b.toString());this.lidOpen_>this.minOpenness_&&1>this.lidOpen_&&\n(this.lidTask_=setTimeout(this.animateLid_.bind(this),ANIMATION_LENGTH$$module$build$src$core$trashcan/a))}setLidAngle_(a){const b=this.workspace.toolboxPosition===Position$$module$build$src$core$utils$toolbox.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let c;null==(c=this.svgLid_)||c.setAttribute(\"transform\",\"rotate(\"+(b?-a:a)+\",\"+(b?4:WIDTH$$module$build$src$core$trashcan-4)+\",\"+(LID_HEIGHT$$module$build$src$core$trashcan-2)+\")\")}setMinOpenness_(a){this.minOpenness_=a;this.isLidOpen||\nthis.setLidAngle_(a*MAX_LID_ANGLE$$module$build$src$core$trashcan)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents_()&&this.openFlyout()}fireUiEvent_(a){a=new (get$$module$build$src$core$events$utils(TRASHCAN_OPEN$$module$build$src$core$events$utils))(a,this.workspace.id);fire$$module$build$src$core$events$utils(a)}blockMouseDownWhenOpenable_(a){!this.contentsIsOpen()&&this.hasContents_()&&a.stopPropagation()}mouseOver_(){this.hasContents_()&&this.setLidOpen(!0)}mouseOut_(){this.setLidOpen(!1)}onDelete_(a){if(!(0>=\nthis.workspace.options.maxTrashcanContents||a.type!==DELETE$$module$build$src$core$events$utils||a.type!==DELETE$$module$build$src$core$events$utils||a.wasShadow)){if(!a.oldJson)throw Error(\"Encountered a delete event without proper oldJson\");a=JSON.stringify(this.cleanBlockJson_(a.oldJson));if(-1===this.contents_.indexOf(a)){for(this.contents_.unshift(a);this.contents_.length>this.workspace.options.maxTrashcanContents;)this.contents_.pop();this.setMinOpenness_(HAS_BLOCKS_LID_ANGLE$$module$build$src$core$trashcan)}}}cleanBlockJson_(a){function b(c){if(c){delete c.id;\ndelete c.x;delete c.y;delete c.enabled;if(c.icons&&c.icons.comment){var d=c.icons.comment;delete d.height;delete d.width;delete d.pinned}d=c.inputs;for(var e in d){var f=d[e];const g=f.block;f=f.shadow;g&&b(g);f&&b(f)}c.next&&(e=c.next,c=e.block,e=e.shadow,c&&b(c),e&&b(e))}}a=JSON.parse(JSON.stringify(a));b(a);return Object.assign({},{kind:\"BLOCK\"},a)}},WIDTH$$module$build$src$core$trashcan=47,BODY_HEIGHT$$module$build$src$core$trashcan=44,LID_HEIGHT$$module$build$src$core$trashcan=16,MARGIN_VERTICAL$$module$build$src$core$trashcan=\n20,MARGIN_HORIZONTAL$$module$build$src$core$trashcan=20,MARGIN_HOTSPOT$$module$build$src$core$trashcan=10,SPRITE_LEFT$$module$build$src$core$trashcan=0,SPRITE_TOP$$module$build$src$core$trashcan=32,HAS_BLOCKS_LID_ANGLE$$module$build$src$core$trashcan=.1,ANIMATION_LENGTH$$module$build$src$core$trashcan=80,ANIMATION_FRAMES$$module$build$src$core$trashcan=4,OPACITY_MIN$$module$build$src$core$trashcan=.4,OPACITY_MAX$$module$build$src$core$trashcan=.8,MAX_LID_ANGLE$$module$build$src$core$trashcan=45,module$build$src$core$trashcan=\n{};module$build$src$core$trashcan.Trashcan=Trashcan$$module$build$src$core$trashcan;var ToolboxItemSelect$$module$build$src$core$events$events_toolbox_item_select=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c){super(c);this.type=TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils;this.oldItem=null!=a?a:void 0;this.newItem=null!=b?b:void 0}toJson(){const a=super.toJson();a.oldItem=this.oldItem;a.newItem=this.newItem;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.ToolboxItemSelect.prototype.fromJson\",\"version 9\",\n\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.oldItem=a.oldItem;this.newItem=a.newItem}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new ToolboxItemSelect$$module$build$src$core$events$events_toolbox_item_select);b.oldItem=a.oldItem;b.newItem=a.newItem;return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils,ToolboxItemSelect$$module$build$src$core$events$events_toolbox_item_select);\nvar module$build$src$core$events$events_toolbox_item_select={};module$build$src$core$events$events_toolbox_item_select.ToolboxItemSelect=ToolboxItemSelect$$module$build$src$core$events$events_toolbox_item_select;var ToolboxItem$$module$build$src$core$toolbox$toolbox_item=class{constructor(a,b,c){this.id_=a.toolboxitemid||getNextUniqueId$$module$build$src$core$utils$idgenerator();this.level_=(this.parent_=c||null)?this.parent_.getLevel()+1:0;this.toolboxItemDef_=a;this.parentToolbox_=b;this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(a){}},\nmodule$build$src$core$toolbox$toolbox_item={};module$build$src$core$toolbox$toolbox_item.ToolboxItem=ToolboxItem$$module$build$src$core$toolbox$toolbox_item;var ToolboxCategory$$module$build$src$core$toolbox$category=class extends ToolboxItem$$module$build$src$core$toolbox$toolbox_item{constructor(a,b,c){super(a,b,c);this.colour_=this.name_=\"\";this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null;this.isDisabled_=this.isHidden_=!1;this.flyoutItems_=[];this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_);this.parseContents_(this.toolboxItemDef_);this.createDom_();\"true\"===this.toolboxItemDef_.hidden&&\nthis.hide()}makeDefaultCssConfig_(){return{container:\"blocklyToolboxCategory\",row:\"blocklyTreeRow\",rowcontentcontainer:\"blocklyTreeRowContentContainer\",icon:\"blocklyTreeIcon\",label:\"blocklyTreeLabel\",contents:\"blocklyToolboxContents\",selected:\"blocklyTreeSelected\",openicon:\"blocklyTreeIconOpen\",closedicon:\"blocklyTreeIconClosed\"}}parseContents_(a){if(\"custom\"in a)this.flyoutItems_=a.custom;else if(a=a.contents)for(let b=0;b<a.length;b++){const c=a[b];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(c)}}parseCategoryDef_(a){this.name_=\n\"name\"in a?replaceMessageReferences$$module$build$src$core$utils$parsing(a.name):\"\";this.colour_=this.getColour_(a);Object.assign(this.cssConfig_,a.cssconfig||a.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_();setRole$$module$build$src$core$utils$aria(this.htmlDiv_,Role$$module$build$src$core$utils$aria.TREEITEM);setState$$module$build$src$core$utils$aria(this.htmlDiv_,State$$module$build$src$core$utils$aria.SELECTED,!1);setState$$module$build$src$core$utils$aria(this.htmlDiv_,State$$module$build$src$core$utils$aria.LEVEL,\nthis.level_);this.rowDiv_=this.createRowContainer_();this.rowDiv_.style.pointerEvents=\"auto\";this.htmlDiv_.appendChild(this.rowDiv_);this.rowContents_=this.createRowContentsContainer_();this.rowContents_.style.pointerEvents=\"none\";this.rowDiv_.appendChild(this.rowContents_);this.iconDom_=this.createIconDom_();setRole$$module$build$src$core$utils$aria(this.iconDom_,Role$$module$build$src$core$utils$aria.PRESENTATION);this.rowContents_.appendChild(this.iconDom_);this.labelDom_=this.createLabelDom_(this.name_);\nthis.rowContents_.appendChild(this.labelDom_);const a=this.labelDom_.getAttribute(\"id\");a&&setState$$module$build$src$core$utils$aria(this.htmlDiv_,State$$module$build$src$core$utils$aria.LABELLEDBY,a);this.addColourBorder_(this.colour_);return this.htmlDiv_}createContainer_(){const a=document.createElement(\"div\"),b=this.cssConfig_.container;b&&addClass$$module$build$src$core$utils$dom(a,b);return a}createRowContainer_(){const a=document.createElement(\"div\");var b=this.cssConfig_.row;b&&addClass$$module$build$src$core$utils$dom(a,\nb);b=`${ToolboxCategory$$module$build$src$core$toolbox$category.nestedPadding*this.getLevel()}px`;this.workspace_.RTL?a.style.paddingRight=b:a.style.paddingLeft=b;return a}createRowContentsContainer_(){const a=document.createElement(\"div\"),b=this.cssConfig_.rowcontentcontainer;b&&addClass$$module$build$src$core$utils$dom(a,b);return a}createIconDom_(){const a=document.createElement(\"span\");if(!this.parentToolbox_.isHorizontal()){const b=this.cssConfig_.icon;b&&addClass$$module$build$src$core$utils$dom(a,\nb)}a.style.display=\"inline-block\";return a}createLabelDom_(a){const b=document.createElement(\"span\");b.setAttribute(\"id\",this.getId()+\".label\");b.textContent=a;(a=this.cssConfig_.label)&&addClass$$module$build$src$core$utils$dom(b,a);return b}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_);this.addColourBorder_(this.colour_)}addColourBorder_(a){a&&(a=ToolboxCategory$$module$build$src$core$toolbox$category.borderWidth+\"px solid \"+(a||\"#ddd\"),this.workspace_.RTL?this.rowDiv_.style.borderRight=\na:this.rowDiv_.style.borderLeft=a)}getColour_(a){const b=a.categorystyle||a.categoryStyle;if((a=a.colour)&&b)console.warn('Toolbox category \"'+this.name_+'\" must not have both a style and a colour');else{if(b)return this.getColourfromStyle_(b);if(a)return this.parseColour_(a)}return\"\"}getColourfromStyle_(a){var b=this.workspace_.getTheme();if(a&&b){if((b=b.categoryStyles[a])&&b.colour)return this.parseColour_(b.colour);console.warn('Style \"'+a+'\" must exist and contain a colour value')}return\"\"}getClickTarget(){return this.rowDiv_}parseColour_(a){a=\nreplaceMessageReferences$$module$build$src$core$utils$parsing(a);if(null==a||\"\"===a)return\"\";var b=Number(a);if(isNaN(b)){if(b=parse$$module$build$src$core$utils$colour(a))return b;console.warn('Toolbox category \"'+this.name_+'\" has unrecognized colour attribute: '+a);return\"\"}return hueToHex$$module$build$src$core$utils$colour(b)}openIcon_(a){if(a){var b=this.cssConfig_.closedicon;b&&removeClasses$$module$build$src$core$utils$dom(a,b);(b=this.cssConfig_.openicon)&&addClass$$module$build$src$core$utils$dom(a,\nb)}}closeIcon_(a){if(a){var b=this.cssConfig_.openicon;b&&removeClasses$$module$build$src$core$utils$dom(a,b);(b=this.cssConfig_.closedicon)&&addClass$$module$build$src$core$utils$dom(a,b)}}setVisible_(a){this.htmlDiv_.style.display=a?\"block\":\"none\";this.isHidden_=!a;this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let a=\nthis;for(;a.getParent();)if(a=a.getParent(),!a.isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(a){}setSelected(a){if(this.rowDiv_){var b=this.cssConfig_.selected;if(a){const c=this.parseColour_(ToolboxCategory$$module$build$src$core$toolbox$category.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||c;b&&addClass$$module$build$src$core$utils$dom(this.rowDiv_,b)}else this.rowDiv_.style.backgroundColor=\"\",b&&removeClass$$module$build$src$core$utils$dom(this.rowDiv_,\nb);setState$$module$build$src$core$utils$aria(this.htmlDiv_,State$$module$build$src$core$utils$aria.SELECTED,a)}}setDisabled(a){this.isDisabled_=a;this.getDiv().setAttribute(\"disabled\",`${a}`);a?this.getDiv().setAttribute(\"disabled\",\"true\"):this.getDiv().removeAttribute(\"disabled\")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(a){this.flyoutItems_=[];this.toolboxItemDef_=\"string\"===typeof a?{kind:this.toolboxItemDef_.kind,\ncustom:a,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:\"name\"in this.toolboxItemDef_?this.toolboxItemDef_.name:\"\",contents:convertFlyoutDefToJsonArray$$module$build$src$core$utils$toolbox(a),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,\nhidden:this.toolboxItemDef_.hidden};this.parseContents_(this.toolboxItemDef_)}dispose(){removeNode$$module$build$src$core$utils$dom(this.htmlDiv_)}};ToolboxCategory$$module$build$src$core$toolbox$category.registrationName=\"category\";ToolboxCategory$$module$build$src$core$toolbox$category.nestedPadding=19;ToolboxCategory$$module$build$src$core$toolbox$category.borderWidth=8;ToolboxCategory$$module$build$src$core$toolbox$category.defaultBackgroundColour=\"#57e\";register$$module$build$src$core$css('\\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\\n  background-color: rgba(255, 255, 255, .2);\\n}\\n\\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\\n  margin: 1px 5px 1px 0;\\n}\\n\\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\\n  margin: 1px 0 1px 5px;\\n}\\n\\n.blocklyTreeRow {\\n  height: 22px;\\n  line-height: 22px;\\n  margin-bottom: 3px;\\n  padding-right: 8px;\\n  white-space: nowrap;\\n}\\n\\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\\n  margin-left: 8px;\\n  padding-right: 0;\\n}\\n\\n.blocklyTreeIcon {\\n  background-image: url(<<<PATH>>>/sprites.png);\\n  height: 16px;\\n  vertical-align: middle;\\n  visibility: hidden;\\n  width: 16px;\\n}\\n\\n.blocklyTreeIconClosed {\\n  background-position: -32px -1px;\\n}\\n\\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\\n  background-position: 0 -1px;\\n}\\n\\n.blocklyTreeSelected>.blocklyTreeIconClosed {\\n  background-position: -32px -17px;\\n}\\n\\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\\n  background-position: 0 -17px;\\n}\\n\\n.blocklyTreeIconOpen {\\n  background-position: -16px -1px;\\n}\\n\\n.blocklyTreeSelected>.blocklyTreeIconOpen {\\n  background-position: -16px -17px;\\n}\\n\\n.blocklyTreeLabel {\\n  cursor: default;\\n  font: 16px sans-serif;\\n  padding: 0 3px;\\n  vertical-align: middle;\\n}\\n\\n.blocklyToolboxDelete .blocklyTreeLabel {\\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\\n}\\n\\n.blocklyTreeSelected .blocklyTreeLabel {\\n  color: #fff;\\n}\\n');\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX_ITEM,ToolboxCategory$$module$build$src$core$toolbox$category.registrationName,ToolboxCategory$$module$build$src$core$toolbox$category);var module$build$src$core$toolbox$category={};module$build$src$core$toolbox$category.ToolboxCategory=ToolboxCategory$$module$build$src$core$toolbox$category;var ToolboxSeparator$$module$build$src$core$toolbox$separator=class extends ToolboxItem$$module$build$src$core$toolbox$toolbox_item{constructor(a,b){super(a,b);this.cssConfig_={container:\"blocklyTreeSeparator\"};this.htmlDiv_=null;Object.assign(this.cssConfig_,a.cssconfig||a.cssConfig)}init(){this.createDom_()}createDom_(){const a=document.createElement(\"div\"),b=this.cssConfig_.container;b&&addClass$$module$build$src$core$utils$dom(a,b);return this.htmlDiv_=a}getDiv(){return this.htmlDiv_}dispose(){removeNode$$module$build$src$core$utils$dom(this.htmlDiv_)}};\nToolboxSeparator$$module$build$src$core$toolbox$separator.registrationName=\"sep\";register$$module$build$src$core$css('\\n.blocklyTreeSeparator {\\n  border-bottom: solid #e5e5e5 1px;\\n  height: 0;\\n  margin: 5px 0;\\n}\\n\\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\\n  border-right: solid #e5e5e5 1px;\\n  border-bottom: none;\\n  height: auto;\\n  margin: 0 5px 0 5px;\\n  padding: 5px 0;\\n  width: 0;\\n}\\n');\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX_ITEM,ToolboxSeparator$$module$build$src$core$toolbox$separator.registrationName,ToolboxSeparator$$module$build$src$core$toolbox$separator);var module$build$src$core$toolbox$separator={};module$build$src$core$toolbox$separator.ToolboxSeparator=ToolboxSeparator$$module$build$src$core$toolbox$separator;var CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category=class extends ToolboxCategory$$module$build$src$core$toolbox$category{constructor(a,b,c){super(a,b,c);this.subcategoriesDiv_=null;this.expanded_=!1;this.toolboxItems_=[]}makeDefaultCssConfig_(){const a=super.makeDefaultCssConfig_();a.contents=\"blocklyToolboxContents\";return a}parseContents_(a){const b=a.contents;let c=!0;if(a.custom)this.flyoutItems_=a.custom;else if(b)for(a=0;a<b.length;a++){const d=b[a];!hasItem$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX_ITEM,\nd.kind)||d.kind.toLowerCase()===ToolboxSeparator$$module$build$src$core$toolbox$separator.registrationName&&c?(this.flyoutItems_.push(d),c=!0):(this.createToolboxItem_(d),c=!1)}}createToolboxItem_(a){let b=a.kind;\"CATEGORY\"===b.toUpperCase()&&isCategoryCollapsible$$module$build$src$core$utils$toolbox(a)&&(b=CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category.registrationName);a=new (getClass$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX_ITEM,\nb))(a,this.parentToolbox_,this);this.toolboxItems_.push(a)}init(){super.init();this.setExpanded(\"true\"===this.toolboxItemDef_.expanded||this.toolboxItemDef_.expanded)}createDom_(){super.createDom_();const a=this.getChildToolboxItems();this.subcategoriesDiv_=this.createSubCategoriesDom_(a);setRole$$module$build$src$core$utils$aria(this.subcategoriesDiv_,Role$$module$build$src$core$utils$aria.GROUP);this.htmlDiv_.appendChild(this.subcategoriesDiv_);return this.htmlDiv_}createIconDom_(){const a=document.createElement(\"span\");\nif(!this.parentToolbox_.isHorizontal()){const b=this.cssConfig_.icon;b&&addClass$$module$build$src$core$utils$dom(a,b);a.style.visibility=\"visible\"}a.style.display=\"inline-block\";return a}createSubCategoriesDom_(a){const b=document.createElement(\"div\");var c=this.cssConfig_.contents;c&&addClass$$module$build$src$core$utils$dom(b,c);for(c=0;c<a.length;c++){const d=a[c];d.init();const e=d.getDiv();b.appendChild(e);if(d.getClickTarget){let f;null==(f=d.getClickTarget())||f.setAttribute(\"id\",d.getId())}}return b}setExpanded(a){this.expanded_!==\na&&((this.expanded_=a)?(this.subcategoriesDiv_.style.display=\"block\",this.openIcon_(this.iconDom_)):(this.subcategoriesDiv_.style.display=\"none\",this.closeIcon_(this.iconDom_)),setState$$module$build$src$core$utils$aria(this.htmlDiv_,State$$module$build$src$core$utils$aria.EXPANDED,a),this.parentToolbox_.handleToolboxItemResize())}setVisible_(a){this.htmlDiv_.style.display=a?\"block\":\"none\";const b=this.getChildToolboxItems();for(let c=0;c<b.length;c++)b[c].setVisible_(a);this.isHidden_=!a;this.parentToolbox_.getSelectedItem()===\nthis&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(a){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category.registrationName=\"collapsibleCategory\";\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX_ITEM,CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category.registrationName,CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category);var module$build$src$core$toolbox$collapsible_category={};module$build$src$core$toolbox$collapsible_category.CollapsibleToolboxCategory=CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category;var Toolbox$$module$build$src$core$toolbox$toolbox=class extends DeleteArea$$module$build$src$core$delete_area{constructor(a){super();this.id=\"toolbox\";this.contentsDiv_=this.HtmlDiv=null;this.isVisible_=!1;this.contents_=[];this.height_=this.width_=0;this.previouslySelectedItem_=this.selectedItem_=this.flyout_=null;this.boundEvents_=[];this.workspace_=a;this.toolboxDef_=a.options.languageTree||{contents:[]};this.horizontalLayout_=a.options.horizontalLayout;this.RTL=a.options.RTL;this.contentMap_=\nObject.create(null);this.toolboxPosition=a.options.toolboxPosition}onShortcut(a){return!1}init(){var a=this.workspace_;const b=a.getParentSvg();this.flyout_=this.createFlyout_();this.HtmlDiv=this.createDom_(this.workspace_);insertAfter$$module$build$src$core$utils$dom(this.flyout_.createDom(\"svg\"),b);this.setVisible(!0);this.flyout_.init(a);this.render(this.toolboxDef_);a=a.getThemeManager();a.subscribe(this.HtmlDiv,\"toolboxBackgroundColour\",\"background-color\");a.subscribe(this.HtmlDiv,\"toolboxForegroundColour\",\n\"color\");this.workspace_.getComponentManager().addComponent({component:this,weight:1,capabilities:[ComponentManager$$module$build$src$core$component_manager.Capability.AUTOHIDEABLE,ComponentManager$$module$build$src$core$component_manager.Capability.DELETE_AREA,ComponentManager$$module$build$src$core$component_manager.Capability.DRAG_TARGET]})}createDom_(a){a=a.getParentSvg();const b=this.createContainer_();this.contentsDiv_=this.createContentsContainer_();this.contentsDiv_.tabIndex=0;setRole$$module$build$src$core$utils$aria(this.contentsDiv_,\nRole$$module$build$src$core$utils$aria.TREE);b.appendChild(this.contentsDiv_);a.parentNode.insertBefore(b,a);this.attachEvents_(b,this.contentsDiv_);return b}createContainer_(){const a=document.createElement(\"div\");a.setAttribute(\"layout\",this.isHorizontal()?\"h\":\"v\");addClass$$module$build$src$core$utils$dom(a,\"blocklyToolboxDiv\");addClass$$module$build$src$core$utils$dom(a,\"blocklyNonSelectable\");a.setAttribute(\"dir\",this.RTL?\"RTL\":\"LTR\");return a}createContentsContainer_(){const a=document.createElement(\"div\");\naddClass$$module$build$src$core$utils$dom(a,\"blocklyToolboxContents\");this.isHorizontal()&&(a.style.flexDirection=\"row\");return a}attachEvents_(a,b){a=conditionalBind$$module$build$src$core$browser_events(a,\"pointerdown\",this,this.onClick_,!1);this.boundEvents_.push(a);b=conditionalBind$$module$build$src$core$browser_events(b,\"keydown\",this,this.onKeyDown_,!1);this.boundEvents_.push(b)}onClick_(a){if(isRightButton$$module$build$src$core$browser_events(a)||a.target===this.HtmlDiv)getMainWorkspace$$module$build$src$core$common().hideChaff(!1);\nelse{var b=a.target.getAttribute(\"id\");b&&(b=this.getToolboxItemById(b),b.isSelectable()&&(this.setSelectedItem(b),b.onClick(a)));getMainWorkspace$$module$build$src$core$common().hideChaff(!0)}clearTouchIdentifier$$module$build$src$core$touch()}onKeyDown_(a){let b=!1;switch(a.keyCode){case KeyCodes$$module$build$src$core$utils$keycodes.DOWN:b=this.selectNext_();break;case KeyCodes$$module$build$src$core$utils$keycodes.UP:b=this.selectPrevious_();break;case KeyCodes$$module$build$src$core$utils$keycodes.LEFT:b=\nthis.selectParent_();break;case KeyCodes$$module$build$src$core$utils$keycodes.RIGHT:b=this.selectChild_();break;case KeyCodes$$module$build$src$core$utils$keycodes.ENTER:case KeyCodes$$module$build$src$core$utils$keycodes.SPACE:this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),b=!0);break;default:b=!1}if(!b&&this.selectedItem_){const c=this.selectedItem_;c.onKeyDown&&(b=c.onKeyDown(a))}b&&a.preventDefault()}createFlyout_(){const a=this.workspace_,b=new Options$$module$build$src$core$options({parentWorkspace:a,\nrtl:a.RTL,oneBasedIndex:a.options.oneBasedIndex,horizontalLayout:a.horizontalLayout,renderer:a.options.renderer,rendererOverrides:a.options.rendererOverrides,move:{scrollbars:!0}});b.toolboxPosition=a.options.toolboxPosition;return new (a.horizontalLayout?getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_HORIZONTAL_TOOLBOX,a.options,!0):getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_VERTICAL_TOOLBOX,a.options,\n!0))(b)}render(a){this.toolboxDef_=a;for(let b=0;b<this.contents_.length;b++){const c=this.contents_[b];c&&c.dispose()}this.contents_=[];this.contentMap_=Object.create(null);this.renderContents_(a.contents);this.position();this.handleToolboxItemResize()}renderContents_(a){const b=document.createDocumentFragment();for(let c=0;c<a.length;c++)this.createToolboxItem_(a[c],b);this.contentsDiv_.appendChild(b)}createToolboxItem_(a,b){var c=a.kind;\"CATEGORY\"===c.toUpperCase()&&isCategoryCollapsible$$module$build$src$core$utils$toolbox(a)&&\n(c=CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category.registrationName);if(c=getClass$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX_ITEM,c.toLowerCase()))a=new c(a,this),a.init(),this.addToolboxItem_(a),(c=a.getDiv())&&b.appendChild(c),a.getClickTarget()&&a.getClickTarget().setAttribute(\"id\",a.getId())}addToolboxItem_(a){this.contents_.push(a);this.contentMap_[a.getId()]=a;if(a.isCollapsible()){a=a.getChildToolboxItems();for(let b=0;b<a.length;b++)this.addToolboxItem_(a[b])}}getToolboxItems(){return this.contents_}addStyle(a){a&&\nthis.HtmlDiv&&addClass$$module$build$src$core$utils$dom(this.HtmlDiv,a)}removeStyle(a){a&&this.HtmlDiv&&removeClass$$module$build$src$core$utils$dom(this.HtmlDiv,a)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var a=this.HtmlDiv.getBoundingClientRect();const b=a.top,c=b+a.height,d=a.left;a=d+a.width;return this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.TOP?new Rect$$module$build$src$core$utils$rect(-1E7,c,-1E7,1E7):this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.BOTTOM?\nnew Rect$$module$build$src$core$utils$rect(b,1E7,-1E7,1E7):this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.LEFT?new Rect$$module$build$src$core$utils$rect(-1E7,1E7,-1E7,a):new Rect$$module$build$src$core$utils$rect(-1E7,1E7,d,1E7)}wouldDelete(a,b){a instanceof BlockSvg$$module$build$src$core$block_svg?this.updateWouldDelete_(!a.getParent()&&a.isDeletable()):this.updateWouldDelete_(a.isDeletable());return this.wouldDelete_}onDragEnter(a){this.updateCursorDeleteStyle_(!0)}onDragExit(a){this.updateCursorDeleteStyle_(!1)}onDrop(a){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(a){a!==\nthis.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=a,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(a){const b=this.wouldDelete_?\"blocklyToolboxDelete\":\"blocklyToolboxGrab\";a?this.addStyle(b):this.removeStyle(b)}getToolboxItemById(a){return this.contentMap_[a]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout_}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout_}position(){const a=\nthis.workspace_.getMetrics(),b=this.HtmlDiv;b&&(this.horizontalLayout_?(b.style.left=\"0\",b.style.height=\"auto\",b.style.width=\"100%\",this.height_=b.offsetHeight,this.width_=a.viewWidth,this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.TOP?b.style.top=\"0\":b.style.bottom=\"0\"):(this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.RIGHT?b.style.right=\"0\":b.style.left=\"0\",b.style.height=\"100%\",this.width_=b.offsetWidth,this.height_=a.viewHeight),this.flyout_.position())}handleToolboxItemResize(){const a=\nthis.workspace_,b=this.HtmlDiv.getBoundingClientRect();a.translate(this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.LEFT?a.scrollX+b.width:a.scrollX,this.toolboxPosition===Position$$module$build$src$core$utils$toolbox.TOP?a.scrollY+b.height:a.scrollY);svgResize$$module$build$src$core$common(a)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let a=0;a<this.contents_.length;a++){const b=this.contents_[a];b.refreshTheme&&b.refreshTheme()}}refreshSelection(){this.selectedItem_&&\nthis.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())}setVisible(a){this.isVisible_!==a&&(this.HtmlDiv.style.display=a?\"block\":\"none\",this.isVisible_=a,this.workspace_.recordDragTargets())}autoHide(a){!a&&this.flyout_&&this.flyout_.autoClose&&this.clearSelection()}setSelectedItem(a){const b=this.selectedItem_;!a&&!b||a&&!a.isSelectable()||(this.shouldDeselectItem_(b,a)&&null!==b&&this.deselectItem_(b),this.shouldSelectItem_(b,\na)&&null!==a&&this.selectItem_(b,a),this.updateFlyout_(b,a),this.fireSelectEvent_(b,a))}shouldDeselectItem_(a,b){return null!==a&&(!a.isCollapsible()||a!==b)}shouldSelectItem_(a,b){return null!==b&&b!==a}deselectItem_(a){this.selectedItem_=null;this.previouslySelectedItem_=a;a.setSelected(!1);setState$$module$build$src$core$utils$aria(this.contentsDiv_,State$$module$build$src$core$utils$aria.ACTIVEDESCENDANT,\"\")}selectItem_(a,b){this.selectedItem_=b;this.previouslySelectedItem_=a;b.setSelected(!0);\nsetState$$module$build$src$core$utils$aria(this.contentsDiv_,State$$module$build$src$core$utils$aria.ACTIVEDESCENDANT,b.getId())}selectItemByPosition(a){-1<a&&a<this.contents_.length&&(a=this.contents_[a],a.isSelectable()&&this.setSelectedItem(a))}updateFlyout_(a,b){b&&(a!==b||b.isCollapsible())&&b.getContents().length?(this.flyout_.show(b.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()}fireSelectEvent_(a,b){const c=a&&a.getName();let d=b&&b.getName();a===b&&(d=null);a=new (get$$module$build$src$core$events$utils(TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils))(c,\nd,this.workspace_.id);fire$$module$build$src$core$events$utils(a)}selectParent_(){return this.selectedItem_?this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),!0):this.selectedItem_.getParent()&&this.selectedItem_.getParent().isSelectable()?(this.setSelectedItem(this.selectedItem_.getParent()),!0):!1:!1}selectChild_(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const a=this.selectedItem_;a.isExpanded()?this.selectNext_():\na.toggleExpanded();return!0}selectNext_(){if(!this.selectedItem_)return!1;let a=this.contents_.indexOf(this.selectedItem_)+1;if(-1<a&&a<this.contents_.length){let b=this.contents_[a];for(;b&&!b.isSelectable();)b=this.contents_[++a];if(b&&b.isSelectable())return this.setSelectedItem(b),!0}return!1}selectPrevious_(){if(!this.selectedItem_)return!1;let a=this.contents_.indexOf(this.selectedItem_)-1;if(-1<a&&a<this.contents_.length){let b=this.contents_[a];for(;b&&!b.isSelectable();)b=this.contents_[--a];\nif(b&&b.isSelectable())return this.setSelectedItem(b),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent(\"toolbox\");this.flyout_.dispose();for(var a=0;a<this.contents_.length;a++)this.contents_[a].dispose();for(a=0;a<this.boundEvents_.length;a++)unbind$$module$build$src$core$browser_events(this.boundEvents_[a]);this.boundEvents_=[];this.contents_=[];this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);removeNode$$module$build$src$core$utils$dom(this.HtmlDiv)}};register$$module$build$src$core$css('\\n.blocklyToolboxDelete {\\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\\n}\\n\\n.blocklyToolboxGrab {\\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\\n  cursor: grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\\n/* Category tree in Toolbox. */\\n.blocklyToolboxDiv {\\n  background-color: #ddd;\\n  overflow-x: visible;\\n  overflow-y: auto;\\n  padding: 4px 0 4px 0;\\n  position: absolute;\\n  z-index: 70;  /* so blocks go under toolbox when dragging */\\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\\n}\\n\\n.blocklyToolboxContents {\\n  display: flex;\\n  flex-wrap: wrap;\\n  flex-direction: column;\\n}\\n\\n.blocklyToolboxContents:focus {\\n  outline: none;\\n}\\n');\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX,DEFAULT$$module$build$src$core$registry,Toolbox$$module$build$src$core$toolbox$toolbox);var module$build$src$core$toolbox$toolbox={};module$build$src$core$toolbox$toolbox.Toolbox=Toolbox$$module$build$src$core$toolbox$toolbox;var defaultBlockStyles$$module$build$src$core$theme$zelos={colour_blocks:{colourPrimary:\"#CF63CF\",colourSecondary:\"#C94FC9\",colourTertiary:\"#BD42BD\"},list_blocks:{colourPrimary:\"#9966FF\",colourSecondary:\"#855CD6\",colourTertiary:\"#774DCB\"},logic_blocks:{colourPrimary:\"#4C97FF\",colourSecondary:\"#4280D7\",colourTertiary:\"#3373CC\"},loop_blocks:{colourPrimary:\"#0fBD8C\",colourSecondary:\"#0DA57A\",colourTertiary:\"#0B8E69\"},math_blocks:{colourPrimary:\"#59C059\",colourSecondary:\"#46B946\",colourTertiary:\"#389438\"},\nprocedure_blocks:{colourPrimary:\"#FF6680\",colourSecondary:\"#FF4D6A\",colourTertiary:\"#FF3355\"},text_blocks:{colourPrimary:\"#FFBF00\",colourSecondary:\"#E6AC00\",colourTertiary:\"#CC9900\"},variable_blocks:{colourPrimary:\"#FF8C1A\",colourSecondary:\"#FF8000\",colourTertiary:\"#DB6E00\"},variable_dynamic_blocks:{colourPrimary:\"#FF8C1A\",colourSecondary:\"#FF8000\",colourTertiary:\"#DB6E00\"},hat_blocks:{colourPrimary:\"#4C97FF\",colourSecondary:\"#4280D7\",colourTertiary:\"#3373CC\",hat:\"cap\"}},categoryStyles$$module$build$src$core$theme$zelos=\n{colour_category:{colour:\"#CF63CF\"},list_category:{colour:\"#9966FF\"},logic_category:{colour:\"#4C97FF\"},loop_category:{colour:\"#0fBD8C\"},math_category:{colour:\"#59C059\"},procedure_category:{colour:\"#FF6680\"},text_category:{colour:\"#FFBF00\"},variable_category:{colour:\"#FF8C1A\"},variable_dynamic_category:{colour:\"#FF8C1A\"}},Zelos$$module$build$src$core$theme$zelos=new Theme$$module$build$src$core$theme(\"zelos\",defaultBlockStyles$$module$build$src$core$theme$zelos,categoryStyles$$module$build$src$core$theme$zelos),\nmodule$build$src$core$theme$zelos={};module$build$src$core$theme$zelos.Zelos=Zelos$$module$build$src$core$theme$zelos;var module$build$src$core$theme$themes={};module$build$src$core$theme$themes.Classic=Classic$$module$build$src$core$theme$classic;module$build$src$core$theme$themes.Zelos=Zelos$$module$build$src$core$theme$zelos;var Click$$module$build$src$core$events$events_click=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c){b=a?a.workspace.id:b;null===b&&(b=void 0);super(b);this.type=CLICK$$module$build$src$core$events$utils;this.blockId=a?a.id:void 0;this.targetType=c}toJson(){const a=super.toJson();if(!this.targetType)throw Error(\"The click target type is undefined. Either pass a block to the constructor, or call fromJson\");a.targetType=this.targetType;a.blockId=this.blockId;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.Click.prototype.fromJson\",\n\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.targetType=a.targetType;this.blockId=a.blockId}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new Click$$module$build$src$core$events$events_click);b.targetType=a.targetType;b.blockId=a.blockId;return b}},ClickTarget$$module$build$src$core$events$events_click;\n(function(a){a.BLOCK=\"block\";a.WORKSPACE=\"workspace\";a.ZOOM_CONTROLS=\"zoom_controls\"})(ClickTarget$$module$build$src$core$events$events_click||(ClickTarget$$module$build$src$core$events$events_click={}));register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,CLICK$$module$build$src$core$events$utils,Click$$module$build$src$core$events$events_click);var module$build$src$core$events$events_click={};module$build$src$core$events$events_click.Click=Click$$module$build$src$core$events$events_click;\nmodule$build$src$core$events$events_click.ClickTarget=ClickTarget$$module$build$src$core$events$events_click;var BubbleDragger$$module$build$src$core$bubble_dragger=class{constructor(a,b){this.bubble=a;this.workspace=b;this.dragTarget_=null;this.wouldDeleteBubble_=!1;this.startXY_=this.bubble.getRelativeToSurfaceXY();this.dragSurface_=b.getBlockDragSurface()}startBubbleDrag(){getGroup$$module$build$src$core$events$utils()||setGroup$$module$build$src$core$events$utils(!0);this.workspace.setResizesEnabled(!1);this.bubble.setAutoLayout(!1);this.dragSurface_&&(this.bubble.moveTo(0,0),this.dragSurface_.translateSurface(this.startXY_.x,\nthis.startXY_.y),this.dragSurface_.setBlocksAndShow(this.bubble.getSvgRoot()));this.bubble.setDragging&&this.bubble.setDragging(!0)}dragBubble(a,b){b=this.pixelsToWorkspaceUnits_(b);b=Coordinate$$module$build$src$core$utils$coordinate.sum(this.startXY_,b);this.bubble.moveDuringDrag(this.dragSurface_,b);b=this.dragTarget_;this.dragTarget_=this.workspace.getDragTarget(a);a=this.wouldDeleteBubble_;this.wouldDeleteBubble_=this.shouldDelete_(this.dragTarget_);a!==this.wouldDeleteBubble_&&this.updateCursorDuringBubbleDrag_();\nthis.dragTarget_!==b&&(b&&b.onDragExit(this.bubble),this.dragTarget_&&this.dragTarget_.onDragEnter(this.bubble));this.dragTarget_&&this.dragTarget_.onDragOver(this.bubble)}shouldDelete_(a){return a&&this.workspace.getComponentManager().hasCapability(a.id,ComponentManager$$module$build$src$core$component_manager.Capability.DELETE_AREA)?a.wouldDelete(this.bubble,!1):!1}updateCursorDuringBubbleDrag_(){this.bubble.setDeleteStyle(this.wouldDeleteBubble_)}endBubbleDrag(a,b){this.dragBubble(a,b);this.dragTarget_&&\nthis.dragTarget_.shouldPreventMove(this.bubble)?a=this.startXY_:(a=this.pixelsToWorkspaceUnits_(b),a=Coordinate$$module$build$src$core$utils$coordinate.sum(this.startXY_,a));this.bubble.moveTo(a.x,a.y);if(this.dragTarget_)this.dragTarget_.onDrop(this.bubble);this.wouldDeleteBubble_?(this.fireMoveEvent_(),this.bubble.dispose()):(this.dragSurface_&&this.dragSurface_.clearAndHide(this.workspace.getBubbleCanvas()),this.bubble.setDragging&&this.bubble.setDragging(!1),this.fireMoveEvent_());this.workspace.setResizesEnabled(!0);\nsetGroup$$module$build$src$core$events$utils(!1)}fireMoveEvent_(){if(this.bubble instanceof WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg){const a=new (get$$module$build$src$core$events$utils(COMMENT_MOVE$$module$build$src$core$events$utils))(this.bubble);a.setOldCoordinate(this.startXY_);a.recordNew();fire$$module$build$src$core$events$utils(a)}}pixelsToWorkspaceUnits_(a){a=new Coordinate$$module$build$src$core$utils$coordinate(a.x/this.workspace.scale,a.y/this.workspace.scale);\nthis.workspace.isMutator&&a.scale(1/this.workspace.options.parentWorkspace.scale);return a}},module$build$src$core$bubble_dragger={};module$build$src$core$bubble_dragger.BubbleDragger=BubbleDragger$$module$build$src$core$bubble_dragger;var WorkspaceDragger$$module$build$src$core$workspace_dragger=class{constructor(a){this.workspace=a;this.horizontalScrollEnabled_=this.workspace.isMovableHorizontally();this.verticalScrollEnabled_=this.workspace.isMovableVertically();this.startScrollXY_=new Coordinate$$module$build$src$core$utils$coordinate(a.scrollX,a.scrollY)}dispose(){this.workspace=null}startDrag(){getSelected$$module$build$src$core$common()&&getSelected$$module$build$src$core$common().unselect();this.workspace.setupDragSurface()}endDrag(a){this.drag(a);\nthis.workspace.resetDragSurface()}drag(a){a=Coordinate$$module$build$src$core$utils$coordinate.sum(this.startScrollXY_,a);if(this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace.scroll(a.x,a.y);else if(this.horizontalScrollEnabled_)this.workspace.scroll(a.x,this.workspace.scrollY);else if(this.verticalScrollEnabled_)this.workspace.scroll(this.workspace.scrollX,a.y);else throw new TypeError(\"Invalid state.\");}},module$build$src$core$workspace_dragger={};\nmodule$build$src$core$workspace_dragger.WorkspaceDragger=WorkspaceDragger$$module$build$src$core$workspace_dragger;var ZOOM_IN_MULTIPLIER$$module$build$src$core$gesture=5,ZOOM_OUT_MULTIPLIER$$module$build$src$core$gesture=6,Gesture$$module$build$src$core$gesture=class{constructor(a,b){this.creatorWorkspace=b;this.mouseDownXY_=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.startWorkspace_=this.targetBlock_=this.startBlock_=this.startField_=this.startBubble_=null;this.hasExceededDragRadius_=!1;this.flyout_=this.workspaceDragger_=this.blockDragger_=this.bubbleDragger_=this.onUpWrapper_=this.onMoveWrapper_=\nnull;this.isMultiTouch_=this.isEnding_=this.hasStarted_=this.calledUpdateIsDragging_=!1;this.cachedPoints=new Map;this.startDistance_=this.previousScale_=0;this.currentDropdownOwner=this.isPinchZoomEnabled_=this.onStartWrapper_=null;this.mostRecentEvent_=a;this.currentDragDeltaXY_=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.healStack_=!DRAG_STACK$$module$build$src$core$internal_constants}dispose(){clearTouchIdentifier$$module$build$src$core$touch();unblock$$module$build$src$core$tooltip();\nthis.creatorWorkspace.clearGesture();this.onMoveWrapper_&&unbind$$module$build$src$core$browser_events(this.onMoveWrapper_);this.onUpWrapper_&&unbind$$module$build$src$core$browser_events(this.onUpWrapper_);this.blockDragger_&&this.blockDragger_.dispose();this.workspaceDragger_&&this.workspaceDragger_.dispose();this.onStartWrapper_&&unbind$$module$build$src$core$browser_events(this.onStartWrapper_)}updateFromEvent_(a){const b=new Coordinate$$module$build$src$core$utils$coordinate(a.clientX,a.clientY);\nthis.updateDragDelta_(b)&&(this.updateIsDragging_(),longStop$$module$build$src$core$touch());this.mostRecentEvent_=a}updateDragDelta_(a){this.currentDragDeltaXY_=Coordinate$$module$build$src$core$utils$coordinate.difference(a,this.mouseDownXY_);return this.hasExceededDragRadius_?!1:this.hasExceededDragRadius_=Coordinate$$module$build$src$core$utils$coordinate.magnitude(this.currentDragDeltaXY_)>(this.flyout_?$.config$$module$build$src$core$config.flyoutDragRadius:$.config$$module$build$src$core$config.dragRadius)}updateIsDraggingFromFlyout_(){let a;\nif(!this.targetBlock_||null==(a=this.flyout_)||!a.isBlockCreatable(this.targetBlock_))return!1;if(!this.flyout_.targetWorkspace)throw Error(\"Cannot update dragging from the flyout because the ' +\\n          'flyout's target workspace is undefined\");return!this.flyout_.isScrollable()||this.flyout_.isDragTowardWorkspace(this.currentDragDeltaXY_)?(this.startWorkspace_=this.flyout_.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),getGroup$$module$build$src$core$events$utils()||\nsetGroup$$module$build$src$core$events$utils(!0),this.startBlock_=null,this.targetBlock_=this.flyout_.createBlock(this.targetBlock_),this.targetBlock_.select(),!0):!1}updateIsDraggingBubble_(){if(!this.startBubble_)return!1;this.startDraggingBubble_();return!0}updateIsDraggingBlock_(){if(!this.targetBlock_)return!1;if(this.flyout_){if(this.updateIsDraggingFromFlyout_())return this.startDraggingBlock_(),!0}else if(this.targetBlock_.isMovable())return this.startDraggingBlock_(),!0;return!1}updateIsDraggingWorkspace_(){if(!this.startWorkspace_)throw Error(\"Cannot update dragging the workspace because the start workspace is undefined\");\nif(this.flyout_?this.flyout_.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())this.workspaceDragger_=new WorkspaceDragger$$module$build$src$core$workspace_dragger(this.startWorkspace_),this.workspaceDragger_.startDrag()}updateIsDragging_(){if(this.calledUpdateIsDragging_)throw Error(\"updateIsDragging_ should only be called once per gesture.\");this.calledUpdateIsDragging_=!0;this.updateIsDraggingBubble_()||this.updateIsDraggingBlock_()||this.updateIsDraggingWorkspace_()}startDraggingBlock_(){this.blockDragger_=\nnew (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(this.targetBlock_,this.startWorkspace_);this.blockDragger_.startDrag(this.currentDragDeltaXY_,this.healStack_);this.blockDragger_.drag(this.mostRecentEvent_,this.currentDragDeltaXY_)}startDraggingBubble_(){if(!this.startBubble_)throw Error(\"Cannot update dragging the bubble because the start bubble is undefined\");if(!this.startWorkspace_)throw Error(\"Cannot update dragging the bubble because the start workspace is undefined\");\nthis.bubbleDragger_=new BubbleDragger$$module$build$src$core$bubble_dragger(this.startBubble_,this.startWorkspace_);this.bubbleDragger_.startBubbleDrag();this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_)}doStart(a){if(!this.startWorkspace_)throw Error(\"Cannot start the touch gesture becauase the start workspace is undefined\");this.isPinchZoomEnabled_=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch;isTargetInput$$module$build$src$core$browser_events(a)?\nthis.cancel():(this.hasStarted_=!0,disconnectUiStop$$module$build$src$core$block_animations(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=getOwner$$module$build$src$core$dropdowndiv(),this.startWorkspace_.hideChaff(!!this.flyout_),this.startWorkspace_.markFocused(),this.mostRecentEvent_=a,block$$module$build$src$core$tooltip(),this.targetBlock_&&this.targetBlock_.select(),isRightButton$$module$build$src$core$browser_events(a)?\nthis.handleRightClick(a):(\"pointerdown\"===a.type.toLowerCase()&&\"mouse\"!==a.pointerType&&longStart$$module$build$src$core$touch(a,this),this.mouseDownXY_=new Coordinate$$module$build$src$core$utils$coordinate(a.clientX,a.clientY),this.healStack_=a.altKey||a.ctrlKey||a.metaKey,this.bindMouseEvents(a),this.isEnding_||this.handleTouchStart(a)))}bindMouseEvents(a){this.onStartWrapper_=conditionalBind$$module$build$src$core$browser_events(document,\"pointerdown\",null,this.handleStart.bind(this),!0);this.onMoveWrapper_=\nconditionalBind$$module$build$src$core$browser_events(document,\"pointermove\",null,this.handleMove.bind(this),!0);this.onUpWrapper_=conditionalBind$$module$build$src$core$browser_events(document,\"pointerup\",null,this.handleUp.bind(this),!0);a.preventDefault();a.stopPropagation()}handleStart(a){this.isDragging()||(this.handleTouchStart(a),this.isMultiTouch()&&longStop$$module$build$src$core$touch())}handleMove(a){this.isDragging()&&shouldHandleEvent$$module$build$src$core$touch(a)||!this.isMultiTouch()?\n(this.updateFromEvent_(a),this.workspaceDragger_?this.workspaceDragger_.drag(this.currentDragDeltaXY_):this.blockDragger_?this.blockDragger_.drag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.bubbleDragger_&&this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_),a.preventDefault(),a.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(a),longStop$$module$build$src$core$touch())}handleUp(a){this.isDragging()||this.handleTouchEnd(a);if(!this.isMultiTouch()||this.isDragging()){if(!shouldHandleEvent$$module$build$src$core$touch(a))return;\nthis.updateFromEvent_(a);longStop$$module$build$src$core$touch();if(this.isEnding_){console.log(\"Trying to end a gesture recursively.\");return}this.isEnding_=!0;this.bubbleDragger_?this.bubbleDragger_.endBubbleDrag(a,this.currentDragDeltaXY_):this.blockDragger_?this.blockDragger_.endDrag(a,this.currentDragDeltaXY_):this.workspaceDragger_?this.workspaceDragger_.endDrag(this.currentDragDeltaXY_):this.isBubbleClick_()?this.doBubbleClick_():this.isFieldClick_()?this.doFieldClick_():this.isBlockClick_()?\nthis.doBlockClick_():this.isWorkspaceClick_()&&this.doWorkspaceClick_(a)}a.preventDefault();a.stopPropagation();this.dispose()}handleTouchStart(a){var b=getTouchIdentifierFromEvent$$module$build$src$core$touch(a);this.cachedPoints.set(b,this.getTouchPoint(a));var c=Array.from(this.cachedPoints.keys());2===c.length&&(b=this.cachedPoints.get(c[0]),c=this.cachedPoints.get(c[1]),this.startDistance_=Coordinate$$module$build$src$core$utils$coordinate.distance(b,c),this.isMultiTouch_=!0,a.preventDefault())}handleTouchMove(a){const b=\ngetTouchIdentifierFromEvent$$module$build$src$core$touch(a);this.cachedPoints.set(b,this.getTouchPoint(a));this.isPinchZoomEnabled_&&2===this.cachedPoints.size?this.handlePinch_(a):this.handleMove(a)}handlePinch_(a){var b=Array.from(this.cachedPoints.keys()),c=this.cachedPoints.get(b[0]);b=this.cachedPoints.get(b[1]);c=Coordinate$$module$build$src$core$utils$coordinate.distance(c,b)/this.startDistance_;if(0<this.previousScale_&&Infinity>this.previousScale_){b=c-this.previousScale_;b=0<b?b*ZOOM_IN_MULTIPLIER$$module$build$src$core$gesture:\nb*ZOOM_OUT_MULTIPLIER$$module$build$src$core$gesture;if(!this.startWorkspace_)throw Error(\"Cannot handle a pinch because the start workspace is undefined\");const d=this.startWorkspace_,e=mouseToSvg$$module$build$src$core$browser_events(a,d.getParentSvg(),d.getInverseScreenCTM());d.zoom(e.x,e.y,b)}this.previousScale_=c;a.preventDefault()}handleTouchEnd(a){a=getTouchIdentifierFromEvent$$module$build$src$core$touch(a);this.cachedPoints.has(a)&&this.cachedPoints.delete(a);2>this.cachedPoints.size&&(this.cachedPoints.clear(),\nthis.previousScale_=0)}getTouchPoint(a){return this.startWorkspace_?new Coordinate$$module$build$src$core$utils$coordinate(a.pageX,a.pageY):null}isMultiTouch(){return this.isMultiTouch_}cancel(){this.isEnding_||(longStop$$module$build$src$core$touch(),this.bubbleDragger_?this.bubbleDragger_.endBubbleDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.blockDragger_?this.blockDragger_.endDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.workspaceDragger_&&this.workspaceDragger_.endDrag(this.currentDragDeltaXY_),\nthis.dispose())}handleRightClick(a){this.targetBlock_?(this.bringBlockToFront_(),this.targetBlock_.workspace.hideChaff(!!this.flyout_),this.targetBlock_.showContextMenu(a)):this.startBubble_?this.startBubble_.showContextMenu(a):this.startWorkspace_&&!this.flyout_&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(a));a.preventDefault();a.stopPropagation();this.dispose()}handleWsStart(a,b){if(this.hasStarted_)throw Error(\"Tried to call gesture.handleWsStart, but the gesture had already been started.\");\nthis.setStartWorkspace_(b);this.mostRecentEvent_=a;this.doStart(a)}fireWorkspaceClick_(a){fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CLICK$$module$build$src$core$events$utils))(null,a.id,\"workspace\"))}handleFlyoutStart(a,b){if(this.hasStarted_)throw Error(\"Tried to call gesture.handleFlyoutStart, but the gesture had already been started.\");this.setStartFlyout_(b);this.handleWsStart(a,b.getWorkspace())}handleBlockStart(a,b){if(this.hasStarted_)throw Error(\"Tried to call gesture.handleBlockStart, but the gesture had already been started.\");\nthis.setStartBlock(b);this.mostRecentEvent_=a}handleBubbleStart(a,b){if(this.hasStarted_)throw Error(\"Tried to call gesture.handleBubbleStart, but the gesture had already been started.\");this.setStartBubble(b);this.mostRecentEvent_=a}doBubbleClick_(){this.startBubble_ instanceof WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg&&(this.startBubble_.setFocus(),this.startBubble_.select())}doFieldClick_(){if(!this.startField_)throw Error(\"Cannot do a field click because the start field is undefined\");\nthis.currentDropdownOwner!==this.startField_&&this.startField_.showEditor(this.mostRecentEvent_);this.bringBlockToFront_()}doBlockClick_(){if(this.flyout_&&this.flyout_.autoClose){if(!this.targetBlock_)throw Error(\"Cannot do a block click because the target block is undefined\");this.targetBlock_.isEnabled()&&(getGroup$$module$build$src$core$events$utils()||setGroup$$module$build$src$core$events$utils(!0),this.flyout_.createBlock(this.targetBlock_).scheduleSnapAndBump())}else{if(!this.startWorkspace_)throw Error(\"Cannot do a block click because the start workspace is undefined\");\nconst a=new (get$$module$build$src$core$events$utils(CLICK$$module$build$src$core$events$utils))(this.startBlock_,this.startWorkspace_.id,\"block\");fire$$module$build$src$core$events$utils(a)}this.bringBlockToFront_();setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick_(a){a=this.creatorWorkspace;getSelected$$module$build$src$core$common()&&getSelected$$module$build$src$core$common().unselect();this.fireWorkspaceClick_(this.startWorkspace_||a)}bringBlockToFront_(){this.targetBlock_&&\n!this.flyout_&&this.targetBlock_.bringToFront()}setStartField(a){if(this.hasStarted_)throw Error(\"Tried to call gesture.setStartField, but the gesture had already been started.\");this.startField_||(this.startField_=a)}setStartBubble(a){this.startBubble_||(this.startBubble_=a)}setStartBlock(a){this.startBlock_||this.startBubble_||(this.startBlock_=a,a.isInFlyout&&a!==a.getRootBlock()?this.setTargetBlock_(a.getRootBlock()):this.setTargetBlock_(a))}setTargetBlock_(a){a.isShadow()?this.setTargetBlock_(a.getParent()):\nthis.targetBlock_=a}setStartWorkspace_(a){this.startWorkspace_||(this.startWorkspace_=a)}setStartFlyout_(a){this.flyout_||(this.flyout_=a)}isBubbleClick_(){return!!this.startBubble_&&!this.hasExceededDragRadius_}isBlockClick_(){return!!this.startBlock_&&!this.hasExceededDragRadius_&&!this.isFieldClick_()}isFieldClick_(){return(this.startField_?this.startField_.isClickable():!1)&&!this.hasExceededDragRadius_&&(!this.flyout_||!this.flyout_.autoClose)}isWorkspaceClick_(){return!this.startBlock_&&!this.startBubble_&&\n!this.startField_&&!this.hasExceededDragRadius_}isDragging(){return!!this.workspaceDragger_||!!this.blockDragger_||!!this.bubbleDragger_}hasStarted(){return this.hasStarted_}getInsertionMarkers(){return this.blockDragger_?this.blockDragger_.getInsertionMarkers():[]}getCurrentDragger(){let a,b;return null!=(b=null!=(a=this.blockDragger_)?a:this.workspaceDragger_)?b:this.bubbleDragger_}static inProgress(){const a=getAllWorkspaces$$module$build$src$core$common();for(let b=0,c;c=a[b];b++)if(c.currentGesture_)return!0;\nreturn!1}},module$build$src$core$gesture={};module$build$src$core$gesture.Gesture=Gesture$$module$build$src$core$gesture;var ShortcutRegistry$$module$build$src$core$shortcut_registry=class{constructor(){this.shortcuts=new Map;this.keyMap=new Map;this.reset()}reset(){this.shortcuts.clear();this.keyMap.clear()}register(a,b){if(this.shortcuts.get(a.name)&&!b)throw Error(`Shortcut named \"${a.name}\" already exists.`);this.shortcuts.set(a.name,a);if((b=a.keyCodes)&&0<b.length)for(let c=0;c<b.length;c++)this.addKeyMapping(b[c],a.name,!!a.allowCollision)}unregister(a){if(!this.shortcuts.get(a))return console.warn(`Keyboard shortcut named \"${a}\" not found.`),\n!1;this.removeAllKeyMappings(a);this.shortcuts.delete(a);return!0}addKeyMapping(a,b,c){a=String(a);const d=this.keyMap.get(a);if(d&&!c)throw Error(`Shortcut named \"${b}\" collides with shortcuts \"${d}\"`);d&&c?d.unshift(b):this.keyMap.set(a,[b])}removeKeyMapping(a,b,c){const d=this.keyMap.get(a);if(!d)return c||console.warn(`No keyboard shortcut named \"${b}\" registered with key code \"${a}\"`),!1;const e=d.indexOf(b);if(-1<e)return d.splice(e,1),0===d.length&&this.keyMap.delete(a),!0;c||console.warn(`No keyboard shortcut named \"${b}\" registered with key code \"${a}\"`);\nreturn!1}removeAllKeyMappings(a){for(const b of this.keyMap.keys())this.removeKeyMapping(b,a,!0)}setKeyMap(a){this.keyMap.clear();for(const b in a)this.keyMap.set(b,a[b])}getKeyMap(){const a=Object.create(null);for(const [b,c]of this.keyMap)a[b]=c;return a}getRegistry(){const a=Object.create(null);for(const [b,c]of this.shortcuts)a[b]=c;return deepMerge$$module$build$src$core$utils$object(Object.create(null),a)}onKeyDown(a,b){var c=this.serializeKeyEvent_(b);c=this.getShortcutNamesByKeyCode(c);if(!c)return!1;\nfor(let d=0,e;e=c[d];d++){const f=this.shortcuts.get(e);let g,h;if(null==(g=f)||!g.preconditionFn||(null==(h=f)?0:h.preconditionFn(a))){let k,l;if((null==(k=f)?0:k.callback)&&(null==(l=f)?0:l.callback(a,b,f)))return!0}}return!1}getShortcutNamesByKeyCode(a){return this.keyMap.get(a)||[]}getKeyCodesByShortcutName(a){const b=[];for(const [c,d]of this.keyMap)-1<d.indexOf(a)&&b.push(c);return b}serializeKeyEvent_(a){let b=\"\";for(const c in ShortcutRegistry$$module$build$src$core$shortcut_registry.modifierKeys)a.getModifierState(c)&&\n(\"\"!==b&&(b+=\"+\"),b+=c);\"\"!==b&&a.keyCode?b=b+\"+\"+a.keyCode:a.keyCode&&(b=a.keyCode.toString());return b}checkModifiers_(a){for(let b=0,c;c=a[b];b++)if(!(c in ShortcutRegistry$$module$build$src$core$shortcut_registry.modifierKeys))throw Error(c+\" is not a valid modifier key.\");}createSerializedKey(a,b){let c=\"\";if(b){this.checkModifiers_(b);for(const d in ShortcutRegistry$$module$build$src$core$shortcut_registry.modifierKeys)-1<b.indexOf(ShortcutRegistry$$module$build$src$core$shortcut_registry.modifierKeys[d])&&\n(\"\"!==c&&(c+=\"+\"),c+=d)}\"\"!==c&&a?c=c+\"+\"+a:a&&(c=a.toString());return c}};ShortcutRegistry$$module$build$src$core$shortcut_registry.registry=new ShortcutRegistry$$module$build$src$core$shortcut_registry;(function(a){a=a.modifierKeys||(a.modifierKeys={});a[a.Shift=16]=\"Shift\";a[a.Control=17]=\"Control\";a[a.Alt=18]=\"Alt\";a[a.Meta=91]=\"Meta\"})(ShortcutRegistry$$module$build$src$core$shortcut_registry||(ShortcutRegistry$$module$build$src$core$shortcut_registry={}));\nvar module$build$src$core$shortcut_registry={};module$build$src$core$shortcut_registry.ShortcutRegistry=ShortcutRegistry$$module$build$src$core$shortcut_registry;var names$$module$build$src$core$shortcut_items;(function(a){a.ESCAPE=\"escape\";a.DELETE=\"delete\";a.COPY=\"copy\";a.CUT=\"cut\";a.PASTE=\"paste\";a.UNDO=\"undo\";a.REDO=\"redo\"})(names$$module$build$src$core$shortcut_items||(names$$module$build$src$core$shortcut_items={}));registerDefaultShortcuts$$module$build$src$core$shortcut_items();var module$build$src$core$shortcut_items={};module$build$src$core$shortcut_items.names=names$$module$build$src$core$shortcut_items;\nmodule$build$src$core$shortcut_items.registerCopy=registerCopy$$module$build$src$core$shortcut_items;module$build$src$core$shortcut_items.registerCut=registerCut$$module$build$src$core$shortcut_items;module$build$src$core$shortcut_items.registerDefaultShortcuts=registerDefaultShortcuts$$module$build$src$core$shortcut_items;module$build$src$core$shortcut_items.registerDelete=registerDelete$$module$build$src$core$shortcut_items;module$build$src$core$shortcut_items.registerEscape=registerEscape$$module$build$src$core$shortcut_items;\nmodule$build$src$core$shortcut_items.registerPaste=registerPaste$$module$build$src$core$shortcut_items;module$build$src$core$shortcut_items.registerRedo=registerRedo$$module$build$src$core$shortcut_items;module$build$src$core$shortcut_items.registerUndo=registerUndo$$module$build$src$core$shortcut_items;var ThemeChange$$module$build$src$core$events$events_theme_change=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b){super(b);this.type=THEME_CHANGE$$module$build$src$core$events$utils;this.themeName=a}toJson(){const a=super.toJson();if(!this.themeName)throw Error(\"The theme name is undefined. Either pass a theme name to the constructor, or call fromJson\");a.themeName=this.themeName;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.ThemeChange.prototype.fromJson\",\n\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.themeName=a.themeName}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new ThemeChange$$module$build$src$core$events$events_theme_change);b.themeName=a.themeName;return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,THEME_CHANGE$$module$build$src$core$events$utils,ThemeChange$$module$build$src$core$events$events_theme_change);\nvar module$build$src$core$events$events_theme_change={};module$build$src$core$events$events_theme_change.ThemeChange=ThemeChange$$module$build$src$core$events$events_theme_change;var ViewportChange$$module$build$src$core$events$events_viewport=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c,d,e){super(d);this.type=VIEWPORT_CHANGE$$module$build$src$core$events$utils;this.viewTop=a;this.viewLeft=b;this.scale=c;this.oldScale=e}toJson(){const a=super.toJson();if(void 0===this.viewTop)throw Error(\"The view top is undefined. Either pass a value to the constructor, or call fromJson\");if(void 0===this.viewLeft)throw Error(\"The view left is undefined. Either pass a value to the constructor, or call fromJson\");\nif(void 0===this.scale)throw Error(\"The scale is undefined. Either pass a value to the constructor, or call fromJson\");if(void 0===this.oldScale)throw Error(\"The old scale is undefined. Either pass a value to the constructor, or call fromJson\");a.viewTop=this.viewTop;a.viewLeft=this.viewLeft;a.scale=this.scale;a.oldScale=this.oldScale;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.Viewport.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");\nsuper.fromJson(a);this.viewTop=a.viewTop;this.viewLeft=a.viewLeft;this.scale=a.scale;this.oldScale=a.oldScale}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new ViewportChange$$module$build$src$core$events$events_viewport);b.viewTop=a.viewTop;b.viewLeft=a.viewLeft;b.scale=a.scale;b.oldScale=a.oldScale;return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,VIEWPORT_CHANGE$$module$build$src$core$events$utils,ViewportChange$$module$build$src$core$events$events_viewport);\nvar module$build$src$core$events$events_viewport={};module$build$src$core$events$events_viewport.ViewportChange=ViewportChange$$module$build$src$core$events$events_viewport;var ConnectionDB$$module$build$src$core$connection_db=class{constructor(a){this.connectionChecker=a;this.connections_=[]}addConnection(a,b){b=this.calculateIndexForYPos_(b);this.connections_.splice(b,0,a)}findIndexOfConnection_(a,b){if(!this.connections_.length)return-1;const c=this.calculateIndexForYPos_(b);if(c>=this.connections_.length)return-1;b=a.y;let d=c;for(;0<=d&&this.connections_[d].y===b;){if(this.connections_[d]===a)return d;d--}for(d=c;d<this.connections_.length&&this.connections_[d].y===\nb;){if(this.connections_[d]===a)return d;d++}return-1}calculateIndexForYPos_(a){if(!this.connections_.length)return 0;let b=0,c=this.connections_.length;for(;b<c;){const d=Math.floor((b+c)/2);if(this.connections_[d].y<a)b=d+1;else if(this.connections_[d].y>a)c=d;else{b=d;break}}return b}removeConnection(a,b){a=this.findIndexOfConnection_(a,b);if(-1===a)throw Error(\"Unable to find connection in connectionDB.\");this.connections_.splice(a,1)}getNeighbours(a,b){function c(l){const m=e-d[l].x,n=f-d[l].y;\nMath.sqrt(m*m+n*n)<=b&&k.push(d[l]);return n<b}const d=this.connections_,e=a.x,f=a.y;a=0;let g=d.length-2,h=g;for(;a<h;)d[h].y<f?a=h:g=h,h=Math.floor((a+g)/2);const k=[];g=a=h;if(d.length){for(;0<=a&&c(a);)a--;do g++;while(g<d.length&&c(g))}return k}isInYRange_(a,b,c){return Math.abs(this.connections_[a].y-b)<=c}searchForClosest(a,b,c){if(!this.connections_.length)return{connection:null,radius:b};const d=a.y,e=a.x;a.x=e+c.x;a.y=d+c.y;var f=this.calculateIndexForYPos_(a.y);c=null;let g=b,h,k=f-1;for(;0<=\nk&&this.isInYRange_(k,a.y,b);)h=this.connections_[k],this.connectionChecker.canConnect(a,h,!0,g)&&(c=h,g=h.distanceFrom(a)),k--;for(;f<this.connections_.length&&this.isInYRange_(f,a.y,b);)h=this.connections_[f],this.connectionChecker.canConnect(a,h,!0,g)&&(c=h,g=h.distanceFrom(a)),f++;a.x=e;a.y=d;return{connection:c,radius:g}}static init(a){const b=[];b[ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE]=new ConnectionDB$$module$build$src$core$connection_db(a);b[ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE]=\nnew ConnectionDB$$module$build$src$core$connection_db(a);b[ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT]=new ConnectionDB$$module$build$src$core$connection_db(a);b[ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT]=new ConnectionDB$$module$build$src$core$connection_db(a);return b}},module$build$src$core$connection_db={};module$build$src$core$connection_db.ConnectionDB=ConnectionDB$$module$build$src$core$connection_db;var Grid$$module$build$src$core$grid=class{constructor(a,b){this.pattern=a;let c;this.spacing=null!=(c=b.spacing)?c:0;let d;this.length=null!=(d=b.length)?d:1;this.line2=(this.line1=a.firstChild)&&this.line1.nextSibling;let e;this.snapToGrid=null!=(e=b.snap)?e:!1}shouldSnap(){return this.snapToGrid}getSpacing(){return this.spacing}getPatternId(){return this.pattern.id}update(a){var b=this.spacing*a||100;this.pattern.setAttribute(\"width\",b.toString());this.pattern.setAttribute(\"height\",b.toString());\nb=Math.floor(this.spacing/2)+.5;let c=b-this.length/2,d=b+this.length/2;b*=a;c*=a;d*=a;this.setLineAttributes(this.line1,a,c,d,b,b);this.setLineAttributes(this.line2,a,b,b,c,d)}setLineAttributes(a,b,c,d,e,f){a&&(a.setAttribute(\"stroke-width\",b.toString()),a.setAttribute(\"x1\",c.toString()),a.setAttribute(\"y1\",e.toString()),a.setAttribute(\"x2\",d.toString()),a.setAttribute(\"y2\",f.toString()))}moveTo(a,b){this.pattern.setAttribute(\"x\",a.toString());this.pattern.setAttribute(\"y\",b.toString())}static createDom(a,\nb,c){a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATTERN,{id:\"blocklyGridPattern\"+a,patternUnits:\"userSpaceOnUse\"},c);let d,e;if(0<(null!=(d=b.length)?d:1)&&0<(null!=(e=b.spacing)?e:0)){createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{stroke:b.colour},a);let f;null!=(f=b.length)&&f&&createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{stroke:b.colour},a)}else createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,\n{},a);return a}},module$build$src$core$grid={};module$build$src$core$grid.Grid=Grid$$module$build$src$core$grid;var Names$$module$build$src$core$names=class{constructor(a,b){this.db=new Map;this.dbReverse=new Set;this.variableMap_=null;this.variablePrefix_=b||\"\";this.reservedWords=new Set(a?a.split(\",\"):[])}reset(){this.db.clear();this.dbReverse.clear();this.variableMap_=null}setVariableMap(a){this.variableMap_=a}getNameForUserVariable_(a){return this.variableMap_?(a=this.variableMap_.getVariableById(a))?a.name:null:(console.warn(\"Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\\nBlockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());\"),\nnull)}populateVariables(a){a=allUsedVarModels$$module$build$src$core$variables(a);for(let b=0;b<a.length;b++)this.getName(a[b].getId(),$.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(a){throw Error(\"The implementation of populateProcedures should be monkey-patched in by blockly.ts\");}getName(a,b){let c=a;b===$.NameType$$module$build$src$core$names.VARIABLE&&(a=this.getNameForUserVariable_(a))&&(c=a);a=c.toLowerCase();const d=b===$.NameType$$module$build$src$core$names.VARIABLE||\nb===$.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix_:\"\";this.db.has(b)||this.db.set(b,new Map);const e=this.db.get(b);if(e.has(a))return d+e.get(a);b=this.getDistinctName(c,b);e.set(a,b.substr(d.length));return b}getUserNames(a){let b;return(a=null==(b=this.db.get(a))?void 0:b.keys())?Array.from(a):[]}getDistinctName(a,b){a=this.safeName_(a);let c=\"\";for(;this.dbReverse.has(a+c)||this.reservedWords.has(a+c);)c=c?c+1:2;a+=c;this.dbReverse.add(a);return(b===$.NameType$$module$build$src$core$names.VARIABLE||\nb===$.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix_:\"\")+a}safeName_(a){a?(a=encodeURI(a.replace(/ /g,\"_\")).replace(/[^\\w]/g,\"_\"),-1!==\"0123456789\".indexOf(a[0])&&(a=\"my_\"+a)):a=Msg$$module$build$src$core$msg.UNNAMED_KEY||\"unnamed\";return a}static equals(a,b){return a.toLowerCase()===b.toLowerCase()}};\n(function(a){a=a.NameType||(a.NameType={});a.DEVELOPER_VARIABLE=\"DEVELOPER_VARIABLE\";a.VARIABLE=\"VARIABLE\";a.PROCEDURE=\"PROCEDURE\"})(Names$$module$build$src$core$names||(Names$$module$build$src$core$names={}));$.NameType$$module$build$src$core$names=Names$$module$build$src$core$names.NameType;Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=$.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE;$.module$build$src$core$names={};$.module$build$src$core$names.NameType=$.NameType$$module$build$src$core$names;\n$.module$build$src$core$names.Names=Names$$module$build$src$core$names;var module$build$src$core$interfaces$i_observable={};module$build$src$core$interfaces$i_observable.isObservable=isObservable$$module$build$src$core$interfaces$i_observable;var module$build$src$core$interfaces$i_procedure_block={};module$build$src$core$interfaces$i_procedure_block.isProcedureBlock=isProcedureBlock$$module$build$src$core$interfaces$i_procedure_block;var module$build$src$core$procedures$update_procedures={};module$build$src$core$procedures$update_procedures.triggerProceduresUpdate=triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures;var ObservableProcedureMap$$module$build$src$core$procedures$observable_procedure_map=class extends Map{constructor(a){super();this.workspace=a}set(a,b){if(this.get(a)===b)return this;super.set(a,b);fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_CREATE$$module$build$src$core$events$utils))(this.workspace,b));isObservable$$module$build$src$core$interfaces$i_observable(b)&&b.startPublishing();return this}delete(a){const b=this.get(a);a=super.delete(a);\nif(!a)return a;triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_DELETE$$module$build$src$core$events$utils))(this.workspace,b));isObservable$$module$build$src$core$interfaces$i_observable(b)&&b.stopPublishing();return a}clear(){if(this.size){for(const a of this.keys()){const b=this.get(a);super.delete(a);fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_DELETE$$module$build$src$core$events$utils))(this.workspace,\nb))}triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace)}}add(a){return this.set(a.getId(),a)}getProcedures(){return[...this.values()]}},module$build$src$core$procedures$observable_procedure_map={};module$build$src$core$procedures$observable_procedure_map.ObservableProcedureMap=ObservableProcedureMap$$module$build$src$core$procedures$observable_procedure_map;var ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model=class{constructor(a,b,c){this.workspace=a;this.parameters=[];this.returnTypes=null;this.enabled=!0;this.shouldFireEvents=!1;this.id=null!=c?c:genUid$$module$build$src$core$utils$idgenerator();this.name=b}setName(a){if(a===this.name)return this;const b=this.name;this.name=a;triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);this.shouldFireEvents&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_RENAME$$module$build$src$core$events$utils))(this.workspace,\nthis,b));return this}insertParameter(a,b){if(this.parameters[b]&&this.parameters[b].getId()===a.getId())return this;this.parameters.splice(b,0,a);a.setProcedureModel(this);isObservable$$module$build$src$core$interfaces$i_observable(a)&&(this.shouldFireEvents?a.startPublishing():a.stopPublishing());triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);this.shouldFireEvents&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_PARAMETER_CREATE$$module$build$src$core$events$utils))(this.workspace,\nthis,a,b));return this}deleteParameter(a){if(!this.parameters[a])return this;const b=this.parameters[a];this.parameters.splice(a,1);triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);isObservable$$module$build$src$core$interfaces$i_observable(b)&&b.stopPublishing();this.shouldFireEvents&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_PARAMETER_DELETE$$module$build$src$core$events$utils))(this.workspace,this,\nb,a));return this}setReturnTypes(a){if(a&&a.length)throw Error(\"The built-in ProcedureModel does not support typing. You need to implement your own custom ProcedureModel.\");if(!!a===!!this.returnTypes)return this;const b=this.returnTypes;this.returnTypes=a;triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);this.shouldFireEvents&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_CHANGE_RETURN$$module$build$src$core$events$utils))(this.workspace,\nthis,b));return this}setEnabled(a){if(a===this.enabled)return this;this.enabled=a;triggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);this.shouldFireEvents&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_ENABLE$$module$build$src$core$events$utils))(this.workspace,this));return this}getId(){return this.id}getName(){return this.name}getParameter(a){return this.parameters[a]}getParameters(){return[...this.parameters]}getReturnTypes(){return this.returnTypes}getEnabled(){return this.enabled}startPublishing(){this.shouldFireEvents=\n!0;for(const a of this.parameters)isObservable$$module$build$src$core$interfaces$i_observable(a)&&a.startPublishing()}stopPublishing(){this.shouldFireEvents=!1;for(const a of this.parameters)isObservable$$module$build$src$core$interfaces$i_observable(a)&&a.stopPublishing()}},module$build$src$core$procedures$observable_procedure_model={};module$build$src$core$procedures$observable_procedure_model.ObservableProcedureModel=ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model;var ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model=class{constructor(a,b,c){this.workspace=a;this.shouldFireEvents=!1;this.procedureModel=null;this.id=null!=c?c:genUid$$module$build$src$core$utils$idgenerator();let d;this.variable=null!=(d=this.workspace.getVariable(b))?d:a.createVariable(b)}setName(a){if(a===this.variable.name)return this;const b=this.variable.name;let c;this.variable=null!=(c=this.workspace.getVariable(a))?c:this.workspace.createVariable(a);\ntriggerProceduresUpdate$$module$build$src$core$procedures$update_procedures(this.workspace);this.shouldFireEvents&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(PROCEDURE_PARAMETER_RENAME$$module$build$src$core$events$utils))(this.workspace,this.procedureModel,this,b));return this}setTypes(a){throw Error(\"The built-in ParameterModel does not support typing. You need to implement your own custom ParameterModel.\");}getName(){return this.variable.name}getTypes(){return[]}getId(){return this.id}getVariableModel(){return this.variable}startPublishing(){this.shouldFireEvents=\n!0}stopPublishing(){this.shouldFireEvents=!1}setProcedureModel(a){this.procedureModel=a;return this}},module$build$src$core$procedures$observable_parameter_model={};module$build$src$core$procedures$observable_parameter_model.ObservableParameterModel=ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model;var CATEGORY_NAME$$module$build$src$core$procedures,DEFAULT_ARG$$module$build$src$core$procedures;CATEGORY_NAME$$module$build$src$core$procedures=\"PROCEDURE\";DEFAULT_ARG$$module$build$src$core$procedures=\"x\";$.module$build$src$core$procedures={};$.module$build$src$core$procedures.CATEGORY_NAME=CATEGORY_NAME$$module$build$src$core$procedures;$.module$build$src$core$procedures.DEFAULT_ARG=DEFAULT_ARG$$module$build$src$core$procedures;$.module$build$src$core$procedures.ObservableParameterModel=ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model;\n$.module$build$src$core$procedures.ObservableProcedureMap=ObservableProcedureMap$$module$build$src$core$procedures$observable_procedure_map;$.module$build$src$core$procedures.ObservableProcedureModel=ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model;$.module$build$src$core$procedures.allProcedures=allProcedures$$module$build$src$core$procedures;$.module$build$src$core$procedures.findLegalName=findLegalName$$module$build$src$core$procedures;\n$.module$build$src$core$procedures.flyoutCategory=flyoutCategory$$module$build$src$core$procedures;$.module$build$src$core$procedures.getCallers=getCallers$$module$build$src$core$procedures;$.module$build$src$core$procedures.getDefinition=getDefinition$$module$build$src$core$procedures;$.module$build$src$core$procedures.isNameUsed=isNameUsed$$module$build$src$core$procedures;$.module$build$src$core$procedures.mutateCallers=mutateCallers$$module$build$src$core$procedures;\n$.module$build$src$core$procedures.mutatorOpenListener=mutatorOpenListener$$module$build$src$core$procedures;$.module$build$src$core$procedures.rename=rename$$module$build$src$core$procedures;var TypesContainer$$module$build$src$core$renderers$measurables$types=class{constructor(){this.NONE=0;this.FIELD=1;this.HAT=2;this.ICON=4;this.SPACER=8;this.BETWEEN_ROW_SPACER=16;this.IN_ROW_SPACER=32;this.EXTERNAL_VALUE_INPUT=64;this.INPUT=128;this.INLINE_INPUT=256;this.STATEMENT_INPUT=512;this.CONNECTION=1024;this.PREVIOUS_CONNECTION=2048;this.NEXT_CONNECTION=4096;this.OUTPUT_CONNECTION=8192;this.CORNER=16384;this.LEFT_SQUARE_CORNER=32768;this.LEFT_ROUND_CORNER=65536;this.RIGHT_SQUARE_CORNER=131072;\nthis.RIGHT_ROUND_CORNER=262144;this.JAGGED_EDGE=524288;this.ROW=1048576;this.TOP_ROW=2097152;this.BOTTOM_ROW=4194304;this.INPUT_ROW=8388608;this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER;this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER;this.nextTypeValue_=16777216}getType(a){Object.prototype.hasOwnProperty.call(this,a)||(this[a]=this.nextTypeValue_,this.nextTypeValue_<<=1);return this[a]}isField(a){return a.type&this.FIELD}isHat(a){return a.type&this.HAT}isIcon(a){return a.type&\nthis.ICON}isSpacer(a){return a.type&this.SPACER}isInRowSpacer(a){return a.type&this.IN_ROW_SPACER}isInput(a){return a.type&this.INPUT}isExternalInput(a){return a.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(a){return a.type&this.INLINE_INPUT}isStatementInput(a){return a.type&this.STATEMENT_INPUT}isPreviousConnection(a){return a.type&this.PREVIOUS_CONNECTION}isNextConnection(a){return a.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(a){return a.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(a){return a.type&\nthis.LEFT_ROUND_CORNER}isRightRoundedCorner(a){return a.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(a){return a.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(a){return a.type&this.RIGHT_SQUARE_CORNER}isCorner(a){return a.type&this.CORNER}isJaggedEdge(a){return a.type&this.JAGGED_EDGE}isRow(a){return a.type&this.ROW}isBetweenRowSpacer(a){return a.type&this.BETWEEN_ROW_SPACER}isTopRow(a){return a.type&this.TOP_ROW}isBottomRow(a){return a.type&this.BOTTOM_ROW}isTopOrBottomRow(a){return a.type&\n(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(a){return a.type&this.INPUT_ROW}},Types$$module$build$src$core$renderers$measurables$types=new TypesContainer$$module$build$src$core$renderers$measurables$types,module$build$src$core$renderers$measurables$types={};module$build$src$core$renderers$measurables$types.Types=Types$$module$build$src$core$renderers$measurables$types;var Measurable$$module$build$src$core$renderers$measurables$base=class{constructor(a){this.centerline=this.xPos=this.height=this.width=0;this.constants_=a;this.type=Types$$module$build$src$core$renderers$measurables$types.NONE;this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},module$build$src$core$renderers$measurables$base={};module$build$src$core$renderers$measurables$base.Measurable=Measurable$$module$build$src$core$renderers$measurables$base;var Row$$module$build$src$core$renderers$measurables$row=class{constructor(a){this.elements=[];this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0;this.hasStatement=this.hasExternalInput=!1;this.statementEdge=0;this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1;this.align=null;this.constants_=a;this.type=Types$$module$build$src$core$renderers$measurables$types.ROW;this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let a=\nthis.elements.length-1;0<=a;a--){const b=this.elements[a];if(Types$$module$build$src$core$renderers$measurables$types.isInput(b))return b}return null}measure(){throw Error(\"Unexpected attempt to measure a base Row.\");}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let a=0;a<this.elements.length;a++){const b=this.elements[a];if(Types$$module$build$src$core$renderers$measurables$types.isSpacer(b))return b}return null}getLastSpacer(){for(let a=this.elements.length-\n1;0<=a;a--){const b=this.elements[a];if(Types$$module$build$src$core$renderers$measurables$types.isSpacer(b))return b}return null}},module$build$src$core$renderers$measurables$row={};module$build$src$core$renderers$measurables$row.Row=Row$$module$build$src$core$renderers$measurables$row;var BottomRow$$module$build$src$core$renderers$measurables$bottom_row=class extends Row$$module$build$src$core$renderers$measurables$row{constructor(a){super(a);this.hasNextConnection=!1;this.connection=null;this.baseline=this.descenderHeight=0;this.type|=Types$$module$build$src$core$renderers$measurables$types.BOTTOM_ROW}hasLeftSquareCorner(a){return!!a.outputConnection||!!a.getNextBlock()}hasRightSquareCorner(a){return!0}measure(){let a=0,b=0,c=0;for(let d=0;d<this.elements.length;d++){const e=\nthis.elements[d];b+=e.width;Types$$module$build$src$core$renderers$measurables$types.isSpacer(e)||(Types$$module$build$src$core$renderers$measurables$types.isNextConnection(e)?c=Math.max(c,e.height):a=Math.max(a,e.height))}this.width=Math.max(this.minWidth,b);this.height=Math.max(this.minHeight,a)+c;this.descenderHeight=c;this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},module$build$src$core$renderers$measurables$bottom_row={};\nmodule$build$src$core$renderers$measurables$bottom_row.BottomRow=BottomRow$$module$build$src$core$renderers$measurables$bottom_row;var Connection$$module$build$src$core$renderers$measurables$connection=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a,b){super(a);this.connectionModel=b;this.shape=this.constants_.shapeFor(b);this.isDynamicShape=\"isDynamic\"in this.shape&&this.shape.isDynamic;this.type|=Types$$module$build$src$core$renderers$measurables$types.CONNECTION}},module$build$src$core$renderers$measurables$connection={};\nmodule$build$src$core$renderers$measurables$connection.Connection=Connection$$module$build$src$core$renderers$measurables$connection;var InputConnection$$module$build$src$core$renderers$measurables$input_connection=class extends Connection$$module$build$src$core$renderers$measurables$connection{constructor(a,b){super(a,b.connection);this.input=b;this.connectionOffsetY=this.connectionOffsetX=0;this.type|=Types$$module$build$src$core$renderers$measurables$types.INPUT;this.align=b.align;(this.connectedBlock=b.connection&&b.connection.targetBlock()?b.connection.targetBlock():null)?(a=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=\na.width,this.connectedBlockHeight=a.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},module$build$src$core$renderers$measurables$input_connection={};module$build$src$core$renderers$measurables$input_connection.InputConnection=InputConnection$$module$build$src$core$renderers$measurables$input_connection;var ExternalValueInput$$module$build$src$core$renderers$measurables$external_value_input=class extends InputConnection$$module$build$src$core$renderers$measurables$input_connection{constructor(a,b){super(a,b);this.height=0;this.type|=Types$$module$build$src$core$renderers$measurables$types.EXTERNAL_VALUE_INPUT;this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height;this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\nthis.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP;this.connectionHeight=this.shape.height;this.connectionWidth=this.shape.width}},module$build$src$core$renderers$measurables$external_value_input={};module$build$src$core$renderers$measurables$external_value_input.ExternalValueInput=ExternalValueInput$$module$build$src$core$renderers$measurables$external_value_input;var Field$$module$build$src$core$renderers$measurables$field=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a,b,c){super(a);this.field=b;this.parentInput=c;this.isEditable=b.EDITABLE;this.flipRtl=b.getFlipRtl();this.type|=Types$$module$build$src$core$renderers$measurables$types.FIELD;a=this.field.getSize();this.height=a.height;this.width=a.width}},module$build$src$core$renderers$measurables$field={};module$build$src$core$renderers$measurables$field.Field=Field$$module$build$src$core$renderers$measurables$field;var Hat$$module$build$src$core$renderers$measurables$hat=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a){super(a);this.type|=Types$$module$build$src$core$renderers$measurables$types.HAT;this.height=this.constants_.START_HAT.height;this.width=this.constants_.START_HAT.width;this.ascenderHeight=this.height}},module$build$src$core$renderers$measurables$hat={};module$build$src$core$renderers$measurables$hat.Hat=Hat$$module$build$src$core$renderers$measurables$hat;var Icon$$module$build$src$core$renderers$measurables$icon=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a,b){super(a);this.icon=b;this.flipRtl=!1;this.isVisible=b.isVisible();this.type|=Types$$module$build$src$core$renderers$measurables$types.ICON;a=b.getCorrectedSize();this.height=a.height;this.width=a.width}},module$build$src$core$renderers$measurables$icon={};module$build$src$core$renderers$measurables$icon.Icon=Icon$$module$build$src$core$renderers$measurables$icon;var InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a,b){super(a);this.type=this.type|Types$$module$build$src$core$renderers$measurables$types.SPACER|Types$$module$build$src$core$renderers$measurables$types.IN_ROW_SPACER;this.width=b;this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},module$build$src$core$renderers$measurables$in_row_spacer={};\nmodule$build$src$core$renderers$measurables$in_row_spacer.InRowSpacer=InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer;var InlineInput$$module$build$src$core$renderers$measurables$inline_input=class extends InputConnection$$module$build$src$core$renderers$measurables$input_connection{constructor(a,b){super(a,b);this.type|=Types$$module$build$src$core$renderers$measurables$types.INLINE_INPUT;this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING);this.connectionHeight=\nthis.isDynamicShape?this.shape.height(this.height):this.shape.height;this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width;this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1));this.connectionOffsetY=\"connectionOffsetY\"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP;this.connectionOffsetX=\"connectionOffsetX\"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},module$build$src$core$renderers$measurables$inline_input=\n{};module$build$src$core$renderers$measurables$inline_input.InlineInput=InlineInput$$module$build$src$core$renderers$measurables$inline_input;var StatementInput$$module$build$src$core$renderers$measurables$statement_input=class extends InputConnection$$module$build$src$core$renderers$measurables$input_connection{constructor(a,b){super(a,b);this.type|=Types$$module$build$src$core$renderers$measurables$types.STATEMENT_INPUT;this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},\nmodule$build$src$core$renderers$measurables$statement_input={};module$build$src$core$renderers$measurables$statement_input.StatementInput=StatementInput$$module$build$src$core$renderers$measurables$statement_input;var InputRow$$module$build$src$core$renderers$measurables$input_row=class extends Row$$module$build$src$core$renderers$measurables$row{constructor(a){super(a);this.connectedBlockWidths=0;this.type|=Types$$module$build$src$core$renderers$measurables$types.INPUT_ROW}measure(){this.width=this.minWidth;this.height=this.minHeight;let a=0;for(let b=0;b<this.elements.length;b++){const c=this.elements[b];this.width+=c.width;Types$$module$build$src$core$renderers$measurables$types.isInput(c)&&c instanceof\nInputConnection$$module$build$src$core$renderers$measurables$input_connection&&(Types$$module$build$src$core$renderers$measurables$types.isStatementInput(c)&&c instanceof StatementInput$$module$build$src$core$renderers$measurables$statement_input?a+=c.connectedBlockWidth:Types$$module$build$src$core$renderers$measurables$types.isExternalInput(c)&&c instanceof ExternalValueInput$$module$build$src$core$renderers$measurables$external_value_input&&0!==c.connectedBlockWidth&&(a+=c.connectedBlockWidth-\nc.connectionWidth));Types$$module$build$src$core$renderers$measurables$types.isSpacer(c)||(this.height=Math.max(this.height,c.height))}this.connectedBlockWidths=a;this.widthWithConnectedBlocks=this.width+a}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},module$build$src$core$renderers$measurables$input_row={};module$build$src$core$renderers$measurables$input_row.InputRow=InputRow$$module$build$src$core$renderers$measurables$input_row;var JaggedEdge$$module$build$src$core$renderers$measurables$jagged_edge=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a){super(a);this.type|=Types$$module$build$src$core$renderers$measurables$types.JAGGED_EDGE;this.height=this.constants_.JAGGED_TEETH.height;this.width=this.constants_.JAGGED_TEETH.width}},module$build$src$core$renderers$measurables$jagged_edge={};module$build$src$core$renderers$measurables$jagged_edge.JaggedEdge=JaggedEdge$$module$build$src$core$renderers$measurables$jagged_edge;var NextConnection$$module$build$src$core$renderers$measurables$next_connection=class extends Connection$$module$build$src$core$renderers$measurables$connection{constructor(a,b){super(a,b);this.type|=Types$$module$build$src$core$renderers$measurables$types.NEXT_CONNECTION;this.height=this.shape.height;this.width=this.shape.width}},module$build$src$core$renderers$measurables$next_connection={};module$build$src$core$renderers$measurables$next_connection.NextConnection=NextConnection$$module$build$src$core$renderers$measurables$next_connection;var OutputConnection$$module$build$src$core$renderers$measurables$output_connection=class extends Connection$$module$build$src$core$renderers$measurables$connection{constructor(a,b){super(a,b);this.connectionOffsetX=0;this.type|=Types$$module$build$src$core$renderers$measurables$types.OUTPUT_CONNECTION;this.height=this.isDynamicShape?0:this.shape.height;this.startX=this.width=this.isDynamicShape?0:this.shape.width;this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},module$build$src$core$renderers$measurables$output_connection=\n{};module$build$src$core$renderers$measurables$output_connection.OutputConnection=OutputConnection$$module$build$src$core$renderers$measurables$output_connection;var PreviousConnection$$module$build$src$core$renderers$measurables$previous_connection=class extends Connection$$module$build$src$core$renderers$measurables$connection{constructor(a,b){super(a,b);this.type|=Types$$module$build$src$core$renderers$measurables$types.PREVIOUS_CONNECTION;this.height=this.shape.height;this.width=this.shape.width}},module$build$src$core$renderers$measurables$previous_connection={};module$build$src$core$renderers$measurables$previous_connection.PreviousConnection=PreviousConnection$$module$build$src$core$renderers$measurables$previous_connection;var RoundCorner$$module$build$src$core$renderers$measurables$round_corner=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a,b){super(a);this.type=(b&&\"left\"!==b?Types$$module$build$src$core$renderers$measurables$types.RIGHT_ROUND_CORNER:Types$$module$build$src$core$renderers$measurables$types.LEFT_ROUND_CORNER)|Types$$module$build$src$core$renderers$measurables$types.CORNER;this.width=this.constants_.CORNER_RADIUS;this.height=this.constants_.CORNER_RADIUS/2}},\nmodule$build$src$core$renderers$measurables$round_corner={};module$build$src$core$renderers$measurables$round_corner.RoundCorner=RoundCorner$$module$build$src$core$renderers$measurables$round_corner;var SpacerRow$$module$build$src$core$renderers$measurables$spacer_row=class extends Row$$module$build$src$core$renderers$measurables$row{constructor(a,b,c){super(a);this.height=b;this.width=c;this.precedesStatement=this.followsStatement=!1;this.widthWithConnectedBlocks=0;this.type=this.type|Types$$module$build$src$core$renderers$measurables$types.SPACER|Types$$module$build$src$core$renderers$measurables$types.BETWEEN_ROW_SPACER;this.elements=[new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,\nc)]}measure(){}},module$build$src$core$renderers$measurables$spacer_row={};module$build$src$core$renderers$measurables$spacer_row.SpacerRow=SpacerRow$$module$build$src$core$renderers$measurables$spacer_row;var SquareCorner$$module$build$src$core$renderers$measurables$square_corner=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a,b){super(a);this.type=(b&&\"left\"!==b?Types$$module$build$src$core$renderers$measurables$types.RIGHT_SQUARE_CORNER:Types$$module$build$src$core$renderers$measurables$types.LEFT_SQUARE_CORNER)|Types$$module$build$src$core$renderers$measurables$types.CORNER;this.width=this.height=this.constants_.NO_PADDING}},module$build$src$core$renderers$measurables$square_corner=\n{};module$build$src$core$renderers$measurables$square_corner.SquareCorner=SquareCorner$$module$build$src$core$renderers$measurables$square_corner;var TopRow$$module$build$src$core$renderers$measurables$top_row=class extends Row$$module$build$src$core$renderers$measurables$row{constructor(a){super(a);this.ascenderHeight=this.capline=0;this.hasPreviousConnection=!1;this.connection=null;this.type|=Types$$module$build$src$core$renderers$measurables$types.TOP_ROW}hasLeftSquareCorner(a){const b=(a.hat?\"cap\"===a.hat:this.constants_.ADD_START_HATS)&&!a.outputConnection&&!a.previousConnection,c=a.getPreviousBlock();return!!a.outputConnection||b||(c?\nc.getNextBlock()===a:!1)}hasRightSquareCorner(a){return!0}measure(){let a=0,b=0,c=0;for(let d=0;d<this.elements.length;d++){const e=this.elements[d];b+=e.width;Types$$module$build$src$core$renderers$measurables$types.isSpacer(e)||(Types$$module$build$src$core$renderers$measurables$types.isHat(e)&&e instanceof Hat$$module$build$src$core$renderers$measurables$hat?c=Math.max(c,e.ascenderHeight):a=Math.max(a,e.height))}this.width=Math.max(this.minWidth,b);this.height=Math.max(this.minHeight,a)+c;this.capline=\nthis.ascenderHeight=c;this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},module$build$src$core$renderers$measurables$top_row={};module$build$src$core$renderers$measurables$top_row.TopRow=TopRow$$module$build$src$core$renderers$measurables$top_row;var ConstantProvider$$module$build$src$core$renderers$common$constants=class{constructor(){this.NO_PADDING=0;this.SMALL_PADDING=3;this.MEDIUM_PADDING=5;this.MEDIUM_LARGE_PADDING=8;this.LARGE_PADDING=10;this.TAB_HEIGHT=15;this.TAB_OFFSET_FROM_TOP=5;this.TAB_VERTICAL_OVERLAP=2.5;this.TAB_WIDTH=8;this.NOTCH_WIDTH=15;this.NOTCH_HEIGHT=4;this.MIN_BLOCK_WIDTH=12;this.EMPTY_BLOCK_SPACER_HEIGHT=16;this.CORNER_RADIUS=8;this.NOTCH_OFFSET_LEFT=15;this.STATEMENT_BOTTOM_SPACER=0;this.STATEMENT_INPUT_PADDING_LEFT=\n20;this.BETWEEN_STATEMENT_PADDING_Y=4;this.ADD_START_HATS=!1;this.START_HAT_HEIGHT=15;this.START_HAT_WIDTH=100;this.SPACER_DEFAULT_HEIGHT=15;this.MIN_BLOCK_HEIGHT=24;this.EMPTY_INLINE_INPUT_PADDING=14.5;this.EXTERNAL_VALUE_INPUT_PADDING=2;this.JAGGED_TEETH_HEIGHT=12;this.JAGGED_TEETH_WIDTH=6;this.FIELD_TEXT_FONTSIZE=11;this.FIELD_TEXT_FONTWEIGHT=\"normal\";this.FIELD_TEXT_FONTFAMILY=\"sans-serif\";this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1;this.FIELD_BORDER_RECT_RADIUS=4;this.FIELD_BORDER_RECT_HEIGHT=\n16;this.FIELD_BORDER_RECT_X_PADDING=5;this.FIELD_BORDER_RECT_Y_PADDING=3;this.FIELD_BORDER_RECT_COLOUR=\"#fff\";this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1;this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12;this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1;this.FIELD_COLOUR_DEFAULT_WIDTH=26;this.defs_=null;this.embossFilterId=\"\";this.embossFilter_=null;this.disabledPatternId=\"\";this.disabledPattern_=null;this.debugFilterId=\"\";this.cssNode_=\nthis.debugFilter_=null;this.CURSOR_COLOUR=\"#cc0a0a\";this.MARKER_COLOUR=\"#4286f4\";this.CURSOR_WS_WIDTH=100;this.WS_CURSOR_HEIGHT=5;this.CURSOR_STACK_PADDING=10;this.CURSOR_BLOCK_PADDING=2;this.CURSOR_STROKE_WIDTH=4;this.FULL_BLOCK_FIELDS=!1;this.INSERTION_MARKER_COLOUR=\"#000000\";this.INSERTION_MARKER_OPACITY=.2;this.SHAPES={PUZZLE:1,NOTCH:2};this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING;this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT;this.STATEMENT_INPUT_NOTCH_OFFSET=\nthis.NOTCH_OFFSET_LEFT;this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING;this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING;this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING;this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING;this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11;this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT;this.START_POINT=moveBy$$module$build$src$core$utils$svg_paths(0,0);this.FIELD_TEXT_BASELINE_CENTER=!0;this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT;\nthis.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING;this.FIELD_DROPDOWN_SVG_ARROW_DATAURI=\"data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=\";\nthis.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT;this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3;this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth();this.NOTCH=this.makeNotch();this.START_HAT=this.makeStartHat();this.PUZZLE_TAB=this.makePuzzleTab();this.INSIDE_CORNERS=this.makeInsideCorners();this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(a){this.blockStyles=Object.create(null);const b=a.blockStyles;for(const c in b)this.blockStyles[c]=\nthis.validatedBlockStyle_(b[c]);this.setDynamicProperties_(a)}setDynamicProperties_(a){this.setFontConstants_(a);this.setComponentConstants_(a);this.ADD_START_HATS=void 0!==a.startHats?a.startHats:this.ADD_START_HATS}setFontConstants_(a){a.fontStyle&&a.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=a.fontStyle.family);a.fontStyle&&a.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=a.fontStyle.weight);a.fontStyle&&a.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=a.fontStyle.size);a=measureFontMetrics$$module$build$src$core$utils$dom(\"Hg\",\nthis.FIELD_TEXT_FONTSIZE+\"pt\",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY);this.FIELD_TEXT_HEIGHT=a.height;this.FIELD_TEXT_BASELINE=a.baseline}setComponentConstants_(a){this.CURSOR_COLOUR=a.getComponentStyle(\"cursorColour\")||this.CURSOR_COLOUR;this.MARKER_COLOUR=a.getComponentStyle(\"markerColour\")||this.MARKER_COLOUR;this.INSERTION_MARKER_COLOUR=a.getComponentStyle(\"insertionMarkerColour\")||this.INSERTION_MARKER_COLOUR;this.INSERTION_MARKER_OPACITY=Number(a.getComponentStyle(\"insertionMarkerOpacity\"))||\nthis.INSERTION_MARKER_OPACITY}getBlockStyleForColour(a){const b=\"auto_\"+a;this.blockStyles[b]||(this.blockStyles[b]=this.createBlockStyle_(a));return{style:this.blockStyles[b],name:b}}getBlockStyle(a){return this.blockStyles[a||\"\"]||(a&&0===a.indexOf(\"auto_\")?this.getBlockStyleForColour(a.substring(5)).style:this.createBlockStyle_(\"#000000\"))}createBlockStyle_(a){return this.validatedBlockStyle_({colourPrimary:a})}validatedBlockStyle_(a){const b={};a&&Object.assign(b,a);a=parseBlockColour$$module$build$src$core$utils$parsing(b.colourPrimary||\n\"#000\");b.colourPrimary=a.hex;b.colourSecondary=b.colourSecondary?parseBlockColour$$module$build$src$core$utils$parsing(b.colourSecondary).hex:this.generateSecondaryColour_(b.colourPrimary);b.colourTertiary=b.colourTertiary?parseBlockColour$$module$build$src$core$utils$parsing(b.colourTertiary).hex:this.generateTertiaryColour_(b.colourPrimary);b.hat=b.hat||\"\";return b}generateSecondaryColour_(a){return blend$$module$build$src$core$utils$colour(\"#fff\",a,.6)||a}generateTertiaryColour_(a){return blend$$module$build$src$core$utils$colour(\"#fff\",\na,.3)||a}dispose(){this.embossFilter_&&removeNode$$module$build$src$core$utils$dom(this.embossFilter_);this.disabledPattern_&&removeNode$$module$build$src$core$utils$dom(this.disabledPattern_);this.debugFilter_&&removeNode$$module$build$src$core$utils$dom(this.debugFilter_);this.cssNode_=null}makeJaggedTeeth(){const a=this.JAGGED_TEETH_HEIGHT,b=this.JAGGED_TEETH_WIDTH,c=line$$module$build$src$core$utils$svg_paths([point$$module$build$src$core$utils$svg_paths(b,a/4),point$$module$build$src$core$utils$svg_paths(2*\n-b,a/2),point$$module$build$src$core$utils$svg_paths(b,a/4)]);return{height:a,width:b,path:c}}makeStartHat(){const a=this.START_HAT_HEIGHT,b=this.START_HAT_WIDTH,c=curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(30,-a),point$$module$build$src$core$utils$svg_paths(70,-a),point$$module$build$src$core$utils$svg_paths(b,0)]);return{height:a,width:b,path:c}}makePuzzleTab(){function a(f){f=f?-1:1;const g=-f;var h=c/2;const k=h+2.5,l=h+.5,m=point$$module$build$src$core$utils$svg_paths(-b,\nf*h);h=point$$module$build$src$core$utils$svg_paths(b,f*h);return curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(0,f*k),point$$module$build$src$core$utils$svg_paths(-b,g*l),m])+curve$$module$build$src$core$utils$svg_paths(\"s\",[point$$module$build$src$core$utils$svg_paths(b,2.5*g),h])}const b=this.TAB_WIDTH,c=this.TAB_HEIGHT,d=a(!0),e=a(!1);return{type:this.SHAPES.PUZZLE,width:b,height:c,pathDown:e,pathUp:d}}makeNotch(){function a(g){return line$$module$build$src$core$utils$svg_paths([point$$module$build$src$core$utils$svg_paths(g*\nd,c),point$$module$build$src$core$utils$svg_paths(3*g,0),point$$module$build$src$core$utils$svg_paths(g*d,-c)])}const b=this.NOTCH_WIDTH,c=this.NOTCH_HEIGHT,d=(b-3)/2,e=a(1),f=a(-1);return{type:this.SHAPES.NOTCH,width:b,height:c,pathLeft:e,pathRight:f}}makeInsideCorners(){const a=this.CORNER_RADIUS,b=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a,point$$module$build$src$core$utils$svg_paths(-a,a)),c=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a,point$$module$build$src$core$utils$svg_paths(a,\na));return{width:a,height:a,pathTop:b,pathBottom:c}}makeOutsideCorners(){const a=this.CORNER_RADIUS,b=moveBy$$module$build$src$core$utils$svg_paths(0,a)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a,point$$module$build$src$core$utils$svg_paths(a,-a)),c=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a,point$$module$build$src$core$utils$svg_paths(a,a)),d=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a,point$$module$build$src$core$utils$svg_paths(-a,-a)),e=arc$$module$build$src$core$utils$svg_paths(\"a\",\n\"0 0,1\",a,point$$module$build$src$core$utils$svg_paths(-a,a));return{topLeft:b,topRight:c,bottomRight:e,bottomLeft:d,rightHeight:a}}shapeFor(a){switch(a.type){case ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE:case ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE:return this.PUZZLE_TAB;case ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT:case ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT:return this.NOTCH;default:throw Error(\"Unknown connection type\");\n}}createDom(a,b,c){this.injectCSS_(b,c);this.defs_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.DEFS,{},a);a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FILTER,{id:\"blocklyEmbossFilter\"+this.randomIdentifier},this.defs_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEGAUSSIANBLUR,{\"in\":\"SourceAlpha\",stdDeviation:1,result:\"blur\"},a);b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FESPECULARLIGHTING,\n{\"in\":\"blur\",surfaceScale:1,specularConstant:.5,specularExponent:10,\"lighting-color\":\"white\",result:\"specOut\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEPOINTLIGHT,{x:-5E3,y:-1E4,z:2E4},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPOSITE,{\"in\":\"specOut\",in2:\"SourceAlpha\",operator:\"in\",result:\"specOut\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPOSITE,\n{\"in\":\"SourceGraphic\",in2:\"specOut\",operator:\"arithmetic\",k1:0,k2:1,k3:1,k4:0},a);this.embossFilterId=a.id;this.embossFilter_=a;a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATTERN,{id:\"blocklyDisabledPattern\"+this.randomIdentifier,patternUnits:\"userSpaceOnUse\",width:10,height:10},this.defs_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:10,height:10,fill:\"#aaa\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,\n{d:\"M 0 0 L 10 10 M 10 0 L 0 10\",stroke:\"#cc0\"},a);this.disabledPatternId=a.id;this.disabledPattern_=a;this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter_){const a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FILTER,{id:\"blocklyDebugFilter\"+this.randomIdentifier,height:\"160%\",width:\"180%\",y:\"-30%\",x:\"-40%\"},this.defs_),b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPONENTTRANSFER,{result:\"outBlur\"},\na);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEFUNCA,{type:\"table\",tableValues:\"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\"},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEFLOOD,{\"flood-color\":\"#ff0000\",\"flood-opacity\":.5,result:\"outColor\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPOSITE,{\"in\":\"outColor\",in2:\"outBlur\",operator:\"in\",result:\"outGlow\"},a);this.debugFilterId=\na.id;this.debugFilter_=a}}injectCSS_(a,b){b=this.getCSS_(b);a=\"blockly-renderer-style-\"+a;this.cssNode_=document.getElementById(a);const c=b.join(\"\\n\");this.cssNode_?this.cssNode_.firstChild.textContent=c:(b=document.createElement(\"style\"),b.id=a,a=document.createTextNode(c),b.appendChild(a),document.head.insertBefore(b,document.head.firstChild),this.cssNode_=b)}getCSS_(a){return[`${a} .blocklyText, `,`${a} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} `+`${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\n\"}\",`${a} .blocklyText {`,\"fill: #fff;\",\"}\",`${a} .blocklyNonEditableText>rect,`,`${a} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\"fill-opacity: .6;\",\"stroke: none;\",\"}\",`${a} .blocklyNonEditableText>text,`,`${a} .blocklyEditableText>text {`,\"fill: #000;\",\"}\",`${a} .blocklyFlyoutLabelText {`,\"fill: #000;\",\"}\",`${a} .blocklyText.blocklyBubbleText {`,\"fill: #000;\",\"}\",`${a} .blocklyEditableText:not(.editing):hover>rect {`,\"stroke: #fff;\",\"stroke-width: 2;\",\"}\",`${a} .blocklyHtmlInput {`,\n`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\"}\",`${a} .blocklySelected>.blocklyPath {`,\"stroke: #fc3;\",\"stroke-width: 3px;\",\"}\",`${a} .blocklyHighlightedConnectionPath {`,\"stroke: #fc3;\",\"}\",`${a} .blocklyReplaceable .blocklyPath {`,\"fill-opacity: .5;\",\"}\",`${a} .blocklyReplaceable .blocklyPathLight,`,`${a} .blocklyReplaceable .blocklyPathDark {`,\"display: none;\",\"}\",`${a} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n\"stroke: none;\",\"}\"]}},module$build$src$core$renderers$common$constants={};module$build$src$core$renderers$common$constants.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$common$constants;module$build$src$core$renderers$common$constants.isDynamicShape=isDynamicShape$$module$build$src$core$renderers$common$constants;var useDebugger$$module$build$src$core$renderers$common$debug=!1,module$build$src$core$renderers$common$debug={};module$build$src$core$renderers$common$debug.isDebuggerEnabled=isDebuggerEnabled$$module$build$src$core$renderers$common$debug;module$build$src$core$renderers$common$debug.startDebugger=startDebugger$$module$build$src$core$renderers$common$debug;module$build$src$core$renderers$common$debug.stopDebugger=stopDebugger$$module$build$src$core$renderers$common$debug;var Debug$$module$build$src$core$renderers$common$debugger=class{constructor(a){this.constants=a;this.debugElements_=[];this.svgRoot_=null;this.randomColour_=\"\"}clearElems(){for(let a=0;a<this.debugElements_.length;a++)removeNode$$module$build$src$core$utils$dom(this.debugElements_[a]);this.debugElements_=[]}drawSpacerRow(a,b,c){if(Debug$$module$build$src$core$renderers$common$debugger.config.rowSpacers){var d=Math.abs(a.height),e=0>a.height;e&&(b-=d);this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,\n{\"class\":\"rowSpacerRect blockRenderDebug\",x:c?-(a.xPos+a.width):a.xPos,y:b,width:a.width,height:d,stroke:e?\"black\":\"blue\",fill:\"blue\",\"fill-opacity\":\"0.5\",\"stroke-width\":\"1px\"},this.svgRoot_))}}drawSpacerElem(a,b,c){if(Debug$$module$build$src$core$renderers$common$debugger.config.elemSpacers){b=Math.abs(a.width);var d=0>a.width,e=d?a.xPos-b:a.xPos;c&&(e=-(e+b));this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"elemSpacerRect blockRenderDebug\",\nx:e,y:a.centerline-a.height/2,width:b,height:a.height,stroke:\"pink\",fill:d?\"black\":\"pink\",\"fill-opacity\":\"0.5\",\"stroke-width\":\"1px\"},this.svgRoot_))}}drawRenderedElem(a,b){if(Debug$$module$build$src$core$renderers$common$debugger.config.elems){let c=a.xPos;b&&(c=-(c+a.width));b=a.centerline-a.height/2;this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"rowRenderingRect blockRenderDebug\",x:c,y:b,width:a.width,height:a.height,\nstroke:\"black\",fill:\"none\",\"stroke-width\":\"1px\"},this.svgRoot_));Types$$module$build$src$core$renderers$measurables$types.isField(a)&&a instanceof Field$$module$build$src$core$renderers$measurables$field&&a.field instanceof $.FieldLabel$$module$build$src$core$field_label&&this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"rowRenderingRect blockRenderDebug\",x:c,y:b+this.constants.FIELD_TEXT_BASELINE,width:a.width,height:\"0.1px\",\nstroke:\"red\",fill:\"none\",\"stroke-width\":\"0.5px\"},this.svgRoot_))}Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&a instanceof InputConnection$$module$build$src$core$renderers$measurables$input_connection&&Debug$$module$build$src$core$renderers$common$debugger.config.connections&&this.drawConnection(a.connectionModel)}drawConnection(a){if(Debug$$module$build$src$core$renderers$common$debugger.config.connections){var b=\"\",c=0,d=\"\";a.type===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE?\n(c=4,b=\"magenta\",d=\"none\"):a.type===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE?(c=2,d=b=\"magenta\"):a.type===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT?(c=4,b=\"goldenrod\",d=\"none\"):a.type===ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT&&(c=2,d=b=\"goldenrod\");this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,{\"class\":\"blockRenderDebug\",cx:a.getOffsetInBlock().x,\ncy:a.getOffsetInBlock().y,r:c,fill:d,stroke:b},this.svgRoot_))}}drawRenderedRow(a,b,c){Debug$$module$build$src$core$renderers$common$debugger.config.rows&&(this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"elemRenderingRect blockRenderDebug\",x:c?-(a.xPos+a.width):a.xPos,y:a.yPos,width:a.width,height:a.height,stroke:\"red\",fill:\"none\",\"stroke-width\":\"1px\"},this.svgRoot_)),Types$$module$build$src$core$renderers$measurables$types.isTopOrBottomRow(a)||\nDebug$$module$build$src$core$renderers$common$debugger.config.connectedBlockBounds&&this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"connectedBlockWidth blockRenderDebug\",x:c?-(a.xPos+a.widthWithConnectedBlocks):a.xPos,y:a.yPos,width:a.widthWithConnectedBlocks,height:a.height,stroke:this.randomColour_,fill:\"none\",\"stroke-width\":\"1px\",\"stroke-dasharray\":\"3,3\"},this.svgRoot_)))}drawRowWithElements(a,b,c){for(let d=0;d<a.elements.length;d++){const e=\na.elements[d];e?Types$$module$build$src$core$renderers$measurables$types.isSpacer(e)?this.drawSpacerElem(e,a.height,c):this.drawRenderedElem(e,c):console.warn(\"A row has an undefined or null element.\",a,e)}this.drawRenderedRow(a,b,c)}drawBoundingBox(a){if(Debug$$module$build$src$core$renderers$common$debugger.config.blockBounds){var b=a.RTL?-a.width:0;this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blockBoundingBox blockRenderDebug\",\nx:b,y:0,width:a.width,height:a.height,stroke:\"black\",fill:\"none\",\"stroke-width\":\"1px\",\"stroke-dasharray\":\"5,5\"},this.svgRoot_));Debug$$module$build$src$core$renderers$common$debugger.config.connectedBlockBounds&&(b=a.RTL?-a.widthWithChildren:0,this.debugElements_.push(createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blockRenderDebug\",x:b,y:0,width:a.widthWithChildren,height:a.height,stroke:\"#DF57BC\",fill:\"none\",\"stroke-width\":\"1px\",\"stroke-dasharray\":\"3,3\"},\nthis.svgRoot_)))}}drawDebug(a,b){this.clearElems();this.svgRoot_=a.getSvgRoot();this.randomColour_=\"#\"+Math.floor(16777215*Math.random()).toString(16);let c=0;for(let d=0;d<b.rows.length;d++){const e=b.rows[d];Types$$module$build$src$core$renderers$measurables$types.isBetweenRowSpacer(e)?this.drawSpacerRow(e,c,b.RTL):this.drawRowWithElements(e,c,b.RTL);c+=e.height}a.previousConnection&&this.drawConnection(a.previousConnection);a.nextConnection&&this.drawConnection(a.nextConnection);a.outputConnection&&\nthis.drawConnection(a.outputConnection);b.rightSide&&this.drawRenderedElem(b.rightSide,b.RTL);this.drawBoundingBox(b);this.drawRender(a.pathObject.svgPath)}drawRender(a){Debug$$module$build$src$core$renderers$common$debugger.config.render&&(a.setAttribute(\"filter\",\"url(#\"+this.constants.debugFilterId+\")\"),setTimeout(function(){a.setAttribute(\"filter\",\"\")},100))}};\nDebug$$module$build$src$core$renderers$common$debugger.config={rowSpacers:!0,elemSpacers:!0,rows:!0,elems:!0,connections:!0,blockBounds:!0,connectedBlockBounds:!0,render:!0};var module$build$src$core$renderers$common$debugger={};module$build$src$core$renderers$common$debugger.Debug=Debug$$module$build$src$core$renderers$common$debugger;var Drawer$$module$build$src$core$renderers$common$drawer=class{constructor(a,b){this.inlinePath_=this.outlinePath_=\"\";this.block_=a;this.info_=b;this.topLeft_=a.getRelativeToSurfaceXY();this.constants_=b.getRenderer().getConstants()}draw(){this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();this.block_.pathObject.setPath(this.outlinePath_+\"\\n\"+this.inlinePath_);this.info_.RTL&&this.block_.pathObject.flipRTL();if(isDebuggerEnabled$$module$build$src$core$renderers$common$debug()){let a;\nnull==(a=this.block_.renderingDebugger)||a.drawDebug(this.block_,this.info_)}this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height;this.block_.width=this.info_.widthWithChildren}hideHiddenIcons_(){for(let a=0,b;b=this.info_.hiddenIcons[a];a++){let c;null==(c=b.icon.iconGroup_)||c.setAttribute(\"display\",\"none\")}}drawOutline_(){this.drawTop_();for(let a=1;a<this.info_.rows.length-1;a++){const b=this.info_.rows[a];b.hasJaggedEdge?this.drawJaggedEdge_(b):b.hasStatement?this.drawStatementInput_(b):\nb.hasExternalInput?this.drawValueInput_(b):this.drawRightSideRow_(b)}this.drawBottom_();this.drawLeft_()}drawTop_(){const a=this.info_.topRow,b=a.elements;this.positionPreviousConnection_();this.outlinePath_+=moveBy$$module$build$src$core$utils$svg_paths(a.xPos,this.info_.startY);for(let c=0,d;d=b[c];c++)Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(d)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:Types$$module$build$src$core$renderers$measurables$types.isRightRoundedCorner(d)?\nthis.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(d)&&d instanceof Connection$$module$build$src$core$renderers$measurables$connection?this.outlinePath_+=d.shape.pathLeft:Types$$module$build$src$core$renderers$measurables$types.isHat(d)?this.outlinePath_+=this.constants_.START_HAT.path:Types$$module$build$src$core$renderers$measurables$types.isSpacer(d)&&(this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",\nd.width));this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a.height)}drawJaggedEdge_(a){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(a){const b=a.getLastInput();this.positionExternalValueConnection_(a);const c=isDynamicShape$$module$build$src$core$renderers$common$constants(b.shape)?b.shape.pathDown(b.height):b.shape.pathDown;this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",\nb.xPos+b.width)+c+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a.height-b.connectionHeight)}drawStatementInput_(a){var b=a.getLastInput();if(b){var c=b.xPos+b.notchOffset+b.shape.width;b=b.shape.pathRight+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",-(b.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var d=a.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",c)+b+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",\nd)+this.constants_.INSIDE_CORNERS.pathBottom+lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a.xPos+a.width);this.positionStatementInputConnection_(a)}}drawRightSideRow_(a){this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.yPos+a.height)}drawBottom_(){const a=this.info_.bottomRow,b=a.elements;this.positionNextConnection_();let c=0,d=\"\";for(let e=b.length-1,f;f=b[e];e--)Types$$module$build$src$core$renderers$measurables$types.isNextConnection(f)&&f instanceof Connection$$module$build$src$core$renderers$measurables$connection?\nd+=f.shape.pathRight:Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(f)?d+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a.xPos):Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(f)?d+=this.constants_.OUTSIDE_CORNERS.bottomLeft:Types$$module$build$src$core$renderers$measurables$types.isRightRoundedCorner(f)?(d+=this.constants_.OUTSIDE_CORNERS.bottomRight,c=this.constants_.OUTSIDE_CORNERS.rightHeight):Types$$module$build$src$core$renderers$measurables$types.isSpacer(f)&&\n(d+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",-1*f.width));this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.baseline-c);this.outlinePath_+=d}drawLeft_(){var a=this.info_.outputConnection;this.positionOutputConnection_();if(a){const b=a.connectionOffsetY+a.height;a=isDynamicShape$$module$build$src$core$renderers$common$constants(a.shape)?a.shape.pathUp(a.height):a.shape.pathUp;this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",b)+a}this.outlinePath_+=\n\"z\"}drawInternals_(){for(let a=0,b;b=this.info_.rows[a];a++)for(let c=0,d;d=b.elements[c];c++)Types$$module$build$src$core$renderers$measurables$types.isInlineInput(d)?this.drawInlineInput_(d):(Types$$module$build$src$core$renderers$measurables$types.isIcon(d)||Types$$module$build$src$core$renderers$measurables$types.isField(d))&&this.layoutField_(d)}layoutField_(a){const b=Types$$module$build$src$core$renderers$measurables$types.isField(a)?a.field.getSvgRoot():a.icon.iconGroup_,c=a.centerline-a.height/\n2;let d=a.xPos,e=\"\";this.info_.RTL&&(d=-(d+a.width),a.flipRtl&&(d+=a.width,e=\"scale(-1 1)\"));Types$$module$build$src$core$renderers$measurables$types.isIcon(a)?(b.setAttribute(\"display\",\"block\"),b.setAttribute(\"transform\",\"translate(\"+d+\",\"+c+\")\"),a.icon.computeIconLocation()):b.setAttribute(\"transform\",\"translate(\"+d+\",\"+c+\")\"+e);this.info_.isInsertionMarker&&b.setAttribute(\"display\",\"none\")}drawInlineInput_(a){const b=a.width,c=a.height,d=a.connectionOffsetY,e=a.connectionHeight+d;this.inlinePath_+=\nmoveTo$$module$build$src$core$utils$svg_paths(a.xPos+a.connectionWidth,a.centerline-c/2)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",d)+a.shape.pathDown+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",c-e)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",b-a.connectionWidth)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",-c)+\"z\";this.positionInlineInputConnection_(a)}positionInlineInputConnection_(a){const b=a.centerline-a.height/2;if(a.connectionModel){let c=a.xPos+a.connectionWidth+\na.connectionOffsetX;this.info_.RTL&&(c*=-1);a.connectionModel.setOffsetInBlock(c,b+a.connectionOffsetY)}}positionStatementInputConnection_(a){const b=a.getLastInput();if(null==b?0:b.connectionModel){let c=a.xPos+a.statementEdge+b.notchOffset;this.info_.RTL&&(c*=-1);b.connectionModel.setOffsetInBlock(c,a.yPos)}}positionExternalValueConnection_(a){const b=a.getLastInput();if(b&&b.connectionModel){let c=a.xPos+a.width;this.info_.RTL&&(c*=-1);b.connectionModel.setOffsetInBlock(c,a.yPos)}}positionPreviousConnection_(){const a=\nthis.info_.topRow;if(a.connection){const b=a.xPos+a.notchOffset;a.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-b:b,0)}}positionNextConnection_(){const a=this.info_.bottomRow;if(a.connection){const b=a.connection,c=b.xPos;b.connectionModel.setOffsetInBlock(this.info_.RTL?-c:c,a.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const a=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-a:a,\nthis.info_.outputConnection.connectionOffsetY)}}},module$build$src$core$renderers$common$drawer={};module$build$src$core$renderers$common$drawer.Drawer=Drawer$$module$build$src$core$renderers$common$drawer;var RenderInfo$$module$build$src$core$renderers$common$info=class{constructor(a,b){this.statementEdge=this.width=this.widthWithChildren=this.height=0;this.rows=[];this.inputRows=[];this.hiddenIcons=[];this.startY=this.startX=0;this.renderer_=a;this.block_=b;this.constants_=this.renderer_.getConstants();this.outputConnection=b.outputConnection?new OutputConnection$$module$build$src$core$renderers$measurables$output_connection(this.constants_,b.outputConnection):null;this.isInline=b.getInputsInline()&&\n!b.isCollapsed();this.isCollapsed=b.isCollapsed();this.isInsertionMarker=b.isInsertionMarker();this.RTL=b.RTL;this.topRow=new TopRow$$module$build$src$core$renderers$measurables$top_row(this.constants_);this.bottomRow=new BottomRow$$module$build$src$core$renderers$measurables$bottom_row(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_();this.addElemSpacing_();this.addRowSpacing_();this.computeBounds_();this.alignRowElements_();this.finalize_()}createRows_(){this.populateTopRow_();\nthis.rows.push(this.topRow);let a=new InputRow$$module$build$src$core$renderers$measurables$input_row(this.constants_);this.inputRows.push(a);var b=this.block_.getIcons();for(let c=0,d;d=b[c];c++){const e=new Icon$$module$build$src$core$renderers$measurables$icon(this.constants_,d);this.isCollapsed&&d.collapseHidden?this.hiddenIcons.push(e):a.elements.push(e)}b=void 0;for(let c=0,d;d=this.block_.inputList[c];c++)if(d.isVisible()){this.shouldStartNewRow_(d,b)&&(this.rows.push(a),a=new InputRow$$module$build$src$core$renderers$measurables$input_row(this.constants_),\nthis.inputRows.push(a));for(let e=0,f;f=d.fieldRow[e];e++)a.elements.push(new Field$$module$build$src$core$renderers$measurables$field(this.constants_,f,d));this.addInput_(d,a);b=d}this.isCollapsed&&(a.hasJaggedEdge=!0,a.elements.push(new JaggedEdge$$module$build$src$core$renderers$measurables$jagged_edge(this.constants_)));(a.elements.length||a.hasDummyInput)&&this.rows.push(a);this.populateBottomRow_();this.rows.push(this.bottomRow)}populateTopRow_(){var a=!!this.block_.previousConnection;const b=\n(this.block_.hat?\"cap\"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!a;let c=this.topRow.hasLeftSquareCorner(this.block_)?SquareCorner$$module$build$src$core$renderers$measurables$square_corner:RoundCorner$$module$build$src$core$renderers$measurables$round_corner;this.topRow.elements.push(new c(this.constants_));b?(a=new Hat$$module$build$src$core$renderers$measurables$hat(this.constants_),this.topRow.elements.push(a),this.topRow.capline=a.ascenderHeight):a&&(this.topRow.hasPreviousConnection=\n!0,this.topRow.connection=new PreviousConnection$$module$build$src$core$renderers$measurables$previous_connection(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection));this.block_.inputList.length&&this.block_.inputList[0].type===inputTypes$$module$build$src$core$input_types.STATEMENT&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT;c=this.topRow.hasRightSquareCorner(this.block_)?\nSquareCorner$$module$build$src$core$renderers$measurables$square_corner:RoundCorner$$module$build$src$core$renderers$measurables$round_corner;this.topRow.elements.push(new c(this.constants_,\"right\"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type===inputTypes$$module$build$src$core$input_types.STATEMENT?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:\nthis.constants_.BOTTOM_ROW_MIN_HEIGHT;this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new SquareCorner$$module$build$src$core$renderers$measurables$square_corner(this.constants_)):this.bottomRow.elements.push(new RoundCorner$$module$build$src$core$renderers$measurables$round_corner(this.constants_));this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new NextConnection$$module$build$src$core$renderers$measurables$next_connection(this.constants_,this.block_.nextConnection),\nthis.bottomRow.elements.push(this.bottomRow.connection));this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new SquareCorner$$module$build$src$core$renderers$measurables$square_corner(this.constants_,\"right\")):this.bottomRow.elements.push(new RoundCorner$$module$build$src$core$renderers$measurables$round_corner(this.constants_,\"right\"))}addInput_(a,b){this.isInline&&a.type===inputTypes$$module$build$src$core$input_types.VALUE?(b.elements.push(new InlineInput$$module$build$src$core$renderers$measurables$inline_input(this.constants_,\na)),b.hasInlineInput=!0):a.type===inputTypes$$module$build$src$core$input_types.STATEMENT?(b.elements.push(new StatementInput$$module$build$src$core$renderers$measurables$statement_input(this.constants_,a)),b.hasStatement=!0):a.type===inputTypes$$module$build$src$core$input_types.VALUE?(b.elements.push(new ExternalValueInput$$module$build$src$core$renderers$measurables$external_value_input(this.constants_,a)),b.hasExternalInput=!0):a.type===inputTypes$$module$build$src$core$input_types.DUMMY&&(b.minHeight=\nMath.max(b.minHeight,a.getSourceBlock()&&a.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),b.hasDummyInput=!0);null===b.align&&(b.align=a.align)}shouldStartNewRow_(a,b){return b?a.type===inputTypes$$module$build$src$core$input_types.STATEMENT||b.type===inputTypes$$module$build$src$core$input_types.STATEMENT?!0:a.type===inputTypes$$module$build$src$core$input_types.VALUE||a.type===inputTypes$$module$build$src$core$input_types.DUMMY?\n!this.isInline:!1:!1}addElemSpacing_(){for(let a=0,b;b=this.rows[a];a++){const c=b.elements;b.elements=[];b.startsWithElemSpacer()&&b.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,this.getInRowSpacing_(null,c[0])));if(c.length){for(let d=0;d<c.length-1;d++){b.elements.push(c[d]);const e=this.getInRowSpacing_(c[d],c[d+1]);b.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,e))}b.elements.push(c[c.length-\n1]);b.endsWithElemSpacer()&&b.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,this.getInRowSpacing_(c[c.length-1],null)))}}}getInRowSpacing_(a,b){if(!a&&b&&Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(a&&Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&!b){if(Types$$module$build$src$core$renderers$measurables$types.isExternalInput(a))return this.constants_.NO_PADDING;\nif(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(a))return this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isStatementInput(a))return this.constants_.NO_PADDING}return a&&Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(a)&&b&&(Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(b)||Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b))?b.notchOffset:a&&Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a)&&\nb&&(Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(b)||Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b))?b.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let a=0,b=0,c=0;for(let e=0,f;f=this.rows[e];e++){f.measure();b=Math.max(b,f.width);if(f.hasStatement){var d=f.getLastInput();let g,h;d=f.width-(null!=(h=null==(g=d)?void 0:g.width)?h:0);a=Math.max(a,d)}c=Math.max(c,f.widthWithConnectedBlocks)}this.statementEdge=\na;this.width=b;for(let e=0,f;f=this.rows[e];e++)f.hasStatement&&(f.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(b,c);this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let b=0,c;c=this.rows[b];b++)if(c.hasStatement)this.alignStatementRow_(c);else{var a=c.width;a=this.getDesiredRowWidth_(c)-a;0<a&&this.addAlignmentPadding_(c,a);Types$$module$build$src$core$renderers$measurables$types.isTopOrBottomRow(c)&&\n(c.widthWithConnectedBlocks=c.width)}}getDesiredRowWidth_(a){return this.width-this.startX}addAlignmentPadding_(a,b){const c=a.getFirstSpacer(),d=a.getLastSpacer();if(a.hasExternalInput||a.hasStatement)a.widthWithConnectedBlocks+=b;if(a.align===$.Align$$module$build$src$core$input.LEFT&&d)d.width+=b;else if(a.align===$.Align$$module$build$src$core$input.CENTRE&&c&&d)c.width+=b/2,d.width+=b/2;else if(a.align===$.Align$$module$build$src$core$input.RIGHT&&c)c.width+=b;else if(d)d.width+=b;else return;\na.width+=b}alignStatementRow_(a){const b=a.getLastInput();if(b){var c=a.width-b.width,d=this.statementEdge;c=d-c;0<c&&this.addAlignmentPadding_(a,c);c=a.width;d=this.getDesiredRowWidth_(a);b.width+=d-c;b.height=Math.max(b.height,a.height);a.width+=d-c;a.widthWithConnectedBlocks=Math.max(a.width,this.statementEdge+a.connectedBlockWidths)}}addRowSpacing_(){const a=this.rows;this.rows=[];for(let b=0;b<a.length;b++)this.rows.push(a[b]),b!==a.length-1&&this.rows.push(this.makeSpacerRow_(a[b],a[b+1]))}makeSpacerRow_(a,\nb){var c=this.getSpacerRowHeight_(a,b);const d=this.getSpacerRowWidth_(a,b);c=new SpacerRow$$module$build$src$core$renderers$measurables$spacer_row(this.constants_,c,d);a.hasStatement&&(c.followsStatement=!0);b.hasStatement&&(c.precedesStatement=!0);return c}getSpacerRowWidth_(a,b){return this.width-this.startX}getSpacerRowHeight_(a,b){return this.constants_.MEDIUM_PADDING}getElemCenterline_(a,b){return Types$$module$build$src$core$renderers$measurables$types.isSpacer(b)?a.yPos+b.height/2:Types$$module$build$src$core$renderers$measurables$types.isBottomRow(a)?\n(a=a.yPos+a.height-a.descenderHeight,Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b)?a+b.height/2:a-b.height/2):Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)?Types$$module$build$src$core$renderers$measurables$types.isHat(b)?a.capline-b.height/2:a.capline+b.height/2:a.yPos+a.height/2}recordElemPositions_(a){let b=a.xPos;for(let c=0,d;d=a.elements[c];c++)Types$$module$build$src$core$renderers$measurables$types.isSpacer(d)&&(d.height=a.height),d.xPos=\nb,d.centerline=this.getElemCenterline_(a,d),b+=d.width}finalize_(){let a=0,b=0;for(let c=0,d;d=this.rows[c];c++)d.yPos=b,d.xPos=this.startX,b+=d.height,a=Math.max(a,d.widthWithConnectedBlocks),this.recordElemPositions_(d);if(this.outputConnection&&this.block_.nextConnection){const c=this.block_.nextConnection.targetBlock();c&&(a=Math.max(a,c.getHeightWidth().width))}this.widthWithChildren=a+this.startX;this.height=b;this.startY=this.topRow.capline;this.bottomRow.baseline=b-this.bottomRow.descenderHeight}},\nmodule$build$src$core$renderers$common$info={};module$build$src$core$renderers$common$info.RenderInfo=RenderInfo$$module$build$src$core$renderers$common$info;var MarkerMove$$module$build$src$core$events$events_marker_move=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c,d){let e=a?a.workspace.id:void 0;d&&d.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.WORKSPACE&&(e=d.getLocation().id);super(e);this.type=MARKER_MOVE$$module$build$src$core$events$utils;this.blockId=null==a?void 0:a.id;this.oldNode=c||void 0;this.newNode=d;this.isCursor=b}toJson(){const a=super.toJson();if(void 0===this.isCursor)throw Error(\"Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson\");\nif(!this.newNode)throw Error(\"The new node is undefined. Either pass a node to the constructor, or call fromJson\");a.isCursor=this.isCursor;a.blockId=this.blockId;a.oldNode=this.oldNode;a.newNode=this.newNode;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.MarkerMove.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.isCursor=a.isCursor;this.blockId=a.blockId;this.oldNode=a.oldNode;this.newNode=a.newNode}static fromJson(a,\nb,c){b=super.fromJson(a,b,null!=c?c:new MarkerMove$$module$build$src$core$events$events_marker_move);b.isCursor=a.isCursor;b.blockId=a.blockId;b.oldNode=a.oldNode;b.newNode=a.newNode;return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,MARKER_MOVE$$module$build$src$core$events$utils,MarkerMove$$module$build$src$core$events$events_marker_move);var module$build$src$core$events$events_marker_move={};\nmodule$build$src$core$events$events_marker_move.MarkerMove=MarkerMove$$module$build$src$core$events$events_marker_move;var CURSOR_CLASS$$module$build$src$core$renderers$common$marker_svg=\"blocklyCursor\",MARKER_CLASS$$module$build$src$core$renderers$common$marker_svg=\"blocklyMarker\",HEIGHT_MULTIPLIER$$module$build$src$core$renderers$common$marker_svg=.75,MarkerSvg$$module$build$src$core$renderers$common$marker_svg=class{constructor(a,b,c){this.workspace=a;this.marker=c;this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent_=null;\nthis.constants_=b;a=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=c.colour||a}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return\"cursor\"===this.marker.type}createDom(){const a=this.isCursor()?CURSOR_CLASS$$module$build$src$core$renderers$common$marker_svg:MARKER_CLASS$$module$build$src$core$renderers$common$marker_svg;this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":a});\nthis.createDomInternal_();return this.svgGroup_}setParent_(a){this.isCursor()?(this.parent_&&this.parent_.setCursorSvg(null),a.setCursorSvg(this.getSvgRoot())):(this.parent_&&this.parent_.setMarkerSvg(null),a.setMarkerSvg(this.getSvgRoot()));this.parent_=a}draw(a,b){if(b){this.constants_=this.workspace.getRenderer().getConstants();var c=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||c;this.applyColour_(b);this.showAtLocation_(b);this.fireMarkerEvent_(a,\nb);a=this.currentMarkerSvg.childNodes[0];void 0!==a&&a.beginElement&&a.beginElement()}else this.hide()}showAtLocation_(a){const b=a.getLocation().type;a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.BLOCK?this.showWithBlock_(a):a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.OUTPUT?this.showWithOutput_(a):b===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE?this.showWithInput_(a):b===ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT?\nthis.showWithNext_(a):a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.PREVIOUS?this.showWithPrevious_(a):a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.FIELD?this.showWithField_(a):a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.WORKSPACE?this.showWithCoordinates_(a):a.getType()===ASTNode$$module$build$src$core$keyboard_nav$ast_node.types.STACK&&this.showWithStack_(a)}showWithBlockPrevOutput_(a){a=a.getSourceBlock();const b=\na.width;var c=a.height,d=c*HEIGHT_MULTIPLIER$$module$build$src$core$renderers$common$marker_svg;const e=this.constants_.CURSOR_BLOCK_PADDING;a.previousConnection?(c=this.constants_.shapeFor(a.previousConnection),this.positionPrevious_(b,e,d,c)):a.outputConnection?(d=this.constants_.shapeFor(a.outputConnection),this.positionOutput_(b,c,d)):this.positionBlock_(b,e,d);this.setParent_(a);this.showCurrent_()}showWithBlock_(a){this.showWithBlockPrevOutput_(a)}showWithPrevious_(a){this.showWithBlockPrevOutput_(a)}showWithOutput_(a){this.showWithBlockPrevOutput_(a)}showWithCoordinates_(a){var b=\na.getWsCoordinate();a=b.x;b=b.y;this.workspace.RTL&&(a-=this.constants_.CURSOR_WS_WIDTH);this.positionLine_(a,b,this.constants_.CURSOR_WS_WIDTH);this.setParent_(this.workspace);this.showCurrent_()}showWithField_(a){a=a.getLocation();const b=a.getSize().width,c=a.getSize().height;this.positionRect_(0,0,b,c);this.setParent_(a);this.showCurrent_()}showWithInput_(a){a=a.getLocation();const b=a.getSourceBlock();this.positionInput_(a);this.setParent_(b);this.showCurrent_()}showWithNext_(a){var b=a.getLocation();\na=b.getSourceBlock();let c=0;b=b.getOffsetInBlock().y;const d=a.getHeightWidth().width;this.workspace.RTL&&(c=-d);this.positionLine_(c,b,d);this.setParent_(a);this.showCurrent_()}showWithStack_(a){a=a.getLocation();var b=a.getHeightWidth();const c=b.width+this.constants_.CURSOR_STACK_PADDING;b=b.height+this.constants_.CURSOR_STACK_PADDING;const d=-this.constants_.CURSOR_STACK_PADDING/2,e=-this.constants_.CURSOR_STACK_PADDING/2;let f=d;this.workspace.RTL&&(f=-(c+d));this.positionRect_(f,e,c,b);this.setParent_(a);\nthis.showCurrent_()}showCurrent_(){this.hide();this.currentMarkerSvg&&(this.currentMarkerSvg.style.display=\"\")}positionBlock_(a,b,c){a=moveBy$$module$build$src$core$utils$svg_paths(-b,c)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",-b)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a+2*b)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",c);if(!this.markerBlock_)throw Error(\"createDom should be called before positioning the marker\");this.markerBlock_.setAttribute(\"d\",a);this.workspace.RTL&&\nthis.flipRtl_(this.markerBlock_);this.currentMarkerSvg=this.markerBlock_}positionInput_(a){const b=a.getOffsetInBlock().x,c=a.getOffsetInBlock().y;a=moveTo$$module$build$src$core$utils$svg_paths(0,0)+this.constants_.shapeFor(a).pathDown;this.markerInput_.setAttribute(\"d\",a);this.markerInput_.setAttribute(\"transform\",\"translate(\"+b+\",\"+c+\")\"+(this.workspace.RTL?\" scale(-1 1)\":\"\"));this.currentMarkerSvg=this.markerInput_}positionLine_(a,b,c){if(!this.markerSvgLine_)throw Error(\"createDom should be called before positioning the line\");\nthis.markerSvgLine_.setAttribute(\"x\",`${a}`);this.markerSvgLine_.setAttribute(\"y\",`${b}`);this.markerSvgLine_.setAttribute(\"width\",`${c}`);this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(a,b,c){if(!this.markerBlock_)throw Error(\"createDom should be called before positioning the output\");a=moveBy$$module$build$src$core$utils$svg_paths(a,0)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",-(a-c.width))+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",this.constants_.TAB_OFFSET_FROM_TOP)+\nc.pathDown+lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",b)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a);this.markerBlock_.setAttribute(\"d\",a);this.workspace.RTL&&this.flipRtl_(this.markerBlock_);this.currentMarkerSvg=this.markerBlock_}positionPrevious_(a,b,c,d){if(!this.markerBlock_)throw Error(\"createDom should be called before positioning the previous connection marker\");a=moveBy$$module$build$src$core$utils$svg_paths(-b,c)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",\n-b)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",this.constants_.NOTCH_OFFSET_LEFT)+d.pathLeft+lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a+2*b)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",c);this.markerBlock_.setAttribute(\"d\",a);this.workspace.RTL&&this.flipRtl_(this.markerBlock_);this.currentMarkerSvg=this.markerBlock_}positionRect_(a,b,c,d){if(!this.markerSvgRect_)throw Error(\"createDom should be called before positioning the rect\");this.markerSvgRect_.setAttribute(\"x\",\n`${a}`);this.markerSvgRect_.setAttribute(\"y\",`${b}`);this.markerSvgRect_.setAttribute(\"width\",`${c}`);this.markerSvgRect_.setAttribute(\"height\",`${d}`);this.currentMarkerSvg=this.markerSvgRect_}flipRtl_(a){a.setAttribute(\"transform\",\"scale(-1 1)\")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error(\"createDom should be called before hiding the marker\");this.markerSvgLine_.style.display=\"none\";this.markerSvgRect_.style.display=\"none\";this.markerInput_.style.display=\n\"none\";this.markerBlock_.style.display=\"none\"}fireMarkerEvent_(a,b){const c=b.getSourceBlock();a=new (get$$module$build$src$core$events$utils(MARKER_MOVE$$module$build$src$core$events$utils))(c,this.isCursor(),a,b);fire$$module$build$src$core$events$utils(a)}getBlinkProperties_(){return{attributeType:\"XML\",attributeName:\"fill\",dur:\"1s\",values:this.colour_+\";transparent;transparent;\",repeatCount:\"indefinite\"}}createDomInternal_(){this.markerSvg_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,\n{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_);this.markerSvgLine_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT,style:\"display: none\"},this.markerSvg_);this.markerSvgRect_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyVerticalMarker\",rx:10,ry:10,style:\"display: none\"},\nthis.markerSvg_);this.markerInput_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{transform:\"\",style:\"display: none\"},this.markerSvg_);this.markerBlock_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{transform:\"\",style:\"display: none\",fill:\"none\",\"stroke-width\":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_);if(this.isCursor()){const a=this.getBlinkProperties_();createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.ANIMATE,\na,this.markerSvgLine_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.ANIMATE,a,this.markerInput_);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.ANIMATE,Object.assign({},a,{attributeName:\"stroke\"}),this.markerBlock_)}return this.markerSvg_}applyColour_(a){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error(\"createDom should be called before applying color to the markerj\");\nthis.markerSvgLine_.setAttribute(\"fill\",this.colour_);this.markerSvgRect_.setAttribute(\"stroke\",this.colour_);this.markerInput_.setAttribute(\"fill\",this.colour_);this.markerBlock_.setAttribute(\"stroke\",this.colour_);this.isCursor()&&(a=this.colour_+\";transparent;transparent;\",this.markerSvgLine_.firstElementChild.setAttribute(\"values\",a),this.markerInput_.firstElementChild.setAttribute(\"values\",a),this.markerBlock_.firstElementChild.setAttribute(\"values\",a))}dispose(){this.svgGroup_&&removeNode$$module$build$src$core$utils$dom(this.svgGroup_)}},\nmodule$build$src$core$renderers$common$marker_svg={};module$build$src$core$renderers$common$marker_svg.MarkerSvg=MarkerSvg$$module$build$src$core$renderers$common$marker_svg;var PathObject$$module$build$src$core$renderers$common$path_object=class{constructor(a,b,c){this.markerSvg=this.cursorSvg=null;this.constants=c;this.style=b;this.svgRoot=a;this.svgPath=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyPath\"},this.svgRoot)}setPath(a){this.svgPath.setAttribute(\"d\",a)}flipRTL(){this.svgPath.setAttribute(\"transform\",\"scale(-1 1)\")}setCursorSvg(a){a?(this.svgRoot.appendChild(a),this.cursorSvg=a):this.cursorSvg=\nnull}setMarkerSvg(a){a?(this.cursorSvg?this.svgRoot.insertBefore(a,this.cursorSvg):this.svgRoot.appendChild(a),this.markerSvg=a):this.markerSvg=null}applyColour(a){this.svgPath.setAttribute(\"stroke\",this.style.colourTertiary);this.svgPath.setAttribute(\"fill\",this.style.colourPrimary);this.updateShadow_(a.isShadow());this.updateDisabled_(!a.isEnabled()||a.getInheritedDisabled())}setStyle(a){this.style=a}setClass_(a,b){a&&(b?addClass$$module$build$src$core$utils$dom(this.svgRoot,a):removeClass$$module$build$src$core$utils$dom(this.svgRoot,\na))}updateHighlighted(a){a?this.svgPath.setAttribute(\"filter\",\"url(#\"+this.constants.embossFilterId+\")\"):this.svgPath.setAttribute(\"filter\",\"none\")}updateShadow_(a){a&&(this.svgPath.setAttribute(\"stroke\",\"none\"),this.svgPath.setAttribute(\"fill\",this.style.colourSecondary))}updateDisabled_(a){this.setClass_(\"blocklyDisabled\",a);a&&this.svgPath.setAttribute(\"fill\",\"url(#\"+this.constants.disabledPatternId+\")\")}updateSelected(a){this.setClass_(\"blocklySelected\",a)}updateDraggingDelete(a){this.setClass_(\"blocklyDraggingDelete\",\na)}updateInsertionMarker(a){this.setClass_(\"blocklyInsertionMarker\",a)}updateMovable(a){this.setClass_(\"blocklyDraggable\",a)}updateReplacementFade(a){this.setClass_(\"blocklyReplaceable\",a)}updateShapeForInputHighlight(a,b){}},module$build$src$core$renderers$common$path_object={};module$build$src$core$renderers$common$path_object.PathObject=PathObject$$module$build$src$core$renderers$common$path_object;var DUPLICATE_BLOCK_ERROR$$module$build$src$core$insertion_marker_manager=\"The insertion marker manager tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.\",InsertionMarkerManager$$module$build$src$core$insertion_marker_manager=class{constructor(a){this.activeCandidate=this.lastMarker=this.lastOnStack=null;this.wouldDeleteBlock=!1;this.fadedBlock=this.highlightedBlock=this.markerConnection=null;setSelected$$module$build$src$core$common(a);\nthis.topBlock=a;this.workspace=a.workspace;this.firstMarker=this.createMarkerBlock(this.topBlock);this.availableConnections=this.initAvailableConnections()}dispose(){this.availableConnections.length=0;disable$$module$build$src$core$events$utils();try{this.firstMarker&&this.firstMarker.dispose(),this.lastMarker&&this.lastMarker.dispose()}finally{enable$$module$build$src$core$events$utils()}}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){disable$$module$build$src$core$events$utils();\nthis.hidePreview();enable$$module$build$src$core$events$utils();var {local:a,closest:b}=this.activeCandidate;a.connect(b);if(this.topBlock.rendered){const c=a.isSuperior()?b:a;connectionUiEffect$$module$build$src$core$block_animations(c.getSourceBlock());this.topBlock.getRootBlock().bringToFront()}}}update(a,b){const c=this.getCandidate(a);if((this.wouldDeleteBlock=this.shouldDelete(!!c,b))||this.shouldUpdatePreviews(c,a))disable$$module$build$src$core$events$utils(),this.maybeHidePreview(c),this.maybeShowPreview(c),\nenable$$module$build$src$core$events$utils()}createMarkerBlock(a){var b=a.type;disable$$module$build$src$core$events$utils();let c;try{c=this.workspace.newBlock(b);c.setInsertionMarker(!0);if(a.saveExtraState){var d=a.saveExtraState();d&&c.loadExtraState&&c.loadExtraState(d)}else if(a.mutationToDom){const e=a.mutationToDom();e&&c.domToMutation&&c.domToMutation(e)}for(b=0;b<a.inputList.length;b++){const e=a.inputList[b];if(e.name===COLLAPSED_INPUT_NAME$$module$build$src$core$constants)continue;const f=\nc.inputList[b];if(!f)throw Error(DUPLICATE_BLOCK_ERROR$$module$build$src$core$insertion_marker_manager.replace(\"%1\",\"an input\"));for(d=0;d<e.fieldRow.length;d++){const g=e.fieldRow[d],h=f.fieldRow[d];if(!h)throw Error(DUPLICATE_BLOCK_ERROR$$module$build$src$core$insertion_marker_manager.replace(\"%1\",\"a field\"));h.setValue(g.getValue())}}c.setCollapsed(a.isCollapsed());c.setInputsInline(a.getInputsInline());c.initSvg();c.getSvgRoot().setAttribute(\"visibility\",\"hidden\")}finally{enable$$module$build$src$core$events$utils()}return c}initAvailableConnections(){const a=\nthis.topBlock.getConnections_(!1),b=this.topBlock.lastConnectionInStack(!0);if(b&&b!==this.topBlock.nextConnection){a.push(b);this.lastOnStack=b;if(this.lastMarker){disable$$module$build$src$core$events$utils();try{this.lastMarker.dispose()}finally{enable$$module$build$src$core$events$utils()}}this.lastMarker=this.createMarkerBlock(b.getSourceBlock())}return a}shouldUpdatePreviews(a,b){if(!a)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const {local:c,closest:d}=this.activeCandidate;\nif(d===a.closest&&c===a.local)return!1;const e=c.x+b.x-d.x;b=c.y+b.y-d.y;return a.radius<Math.sqrt(e*e+b*b)-$.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(a){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let b=this.getStartRadius(),c=null;for(let d=0;d<this.availableConnections.length;d++){const e=this.availableConnections[d],f=e.closest(b,a);f.connection&&(c={closest:f.connection,local:e,radius:f.radius},b=f.radius)}return c}getStartRadius(){return this.activeCandidate?\n$.config$$module$build$src$core$config.connectingSnapRadius:$.config$$module$build$src$core$config.snapRadius}shouldDelete(a,b){return b&&this.workspace.getComponentManager().hasCapability(b.id,ComponentManager$$module$build$src$core$component_manager.Capability.DELETE_AREA)?b.wouldDelete(this.topBlock,a):!1}maybeShowPreview(a){if(!this.wouldDeleteBlock&&a){var b=a.closest,c;b===(null==(c=this.activeCandidate)?void 0:c.closest)||b.getSourceBlock().isInsertionMarker()?console.log(\"Trying to connect to an insertion marker\"):\n(this.activeCandidate=a,this.showPreview(this.activeCandidate))}}showPreview(a){const b=this.workspace.getRenderer();switch(b.getConnectionPreviewMethod(a.closest,a.local,this.topBlock)){case InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(a);break;case InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(a);break;case InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(a)}b.shouldHighlightConnection(a.closest)&&\na.closest.highlight()}maybeHidePreview(a){if(!a)this.hidePreview();else if(this.activeCandidate){const b=this.activeCandidate.local!==a.local;(this.activeCandidate.closest!==a.closest||b||this.wouldDeleteBlock)&&this.hidePreview()}this.activeCandidate=this.markerConnection=null}hidePreview(){let a;const b=null==(a=this.activeCandidate)?void 0:a.closest;b&&b.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(b)&&b.unhighlight();this.hideReplacementFade();this.hideInsertionInputOutline();\nthis.hideInsertionMarker()}showInsertionMarker(a){const {local:b,closest:c}=a;let d=(a=this.lastOnStack&&b===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!d)throw Error(\"Cannot show the insertion marker because there is no insertion marker block\");let e;try{e=d.getMatchingConnection(b.getSourceBlock(),b)}catch(f){this.firstMarker=this.createMarkerBlock(this.topBlock);d=a?this.lastMarker:this.firstMarker;if(!d)throw Error(\"Cannot show the insertion marker because there is no insertion marker block\");\ne=d.getMatchingConnection(b.getSourceBlock(),b)}if(!e)throw Error(\"Cannot show the insertion marker because there is no associated connection\");if(e===this.markerConnection)throw Error(\"Made it to showInsertionMarker_ even though the marker isn't changing\");d.render();d.rendered=!0;d.getSvgRoot().setAttribute(\"visibility\",\"visible\");e&&c&&d.positionNearConnection(e,c);c&&e.connect(c);this.markerConnection=e}hideInsertionMarker(){if(this.markerConnection){var a=this.markerConnection,b=a.getSourceBlock(),\nc=b.previousConnection,d=b.outputConnection,e=a===b.nextConnection;d=a.type===ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE&&!(d&&d.targetConnection);e&&(!c||!c.targetConnection)||d?a.targetBlock().unplug(!1):a.type!==ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT||e?b.unplug(!0):((e=a.targetConnection)&&e.getSourceBlock().unplug(!1),c=c?c.targetConnection:null,b.unplug(!0),c&&e&&c.connect(e));if(a.targetConnection)throw Error(\"markerConnection still connected at the end of disconnectInsertionMarker\");\nthis.markerConnection=null;(a=b.getSvgRoot())&&a.setAttribute(\"visibility\",\"hidden\")}}showInsertionInputOutline(a){a=a.closest;this.highlightedBlock=a.getSourceBlock();this.highlightedBlock.highlightShapeForInput(a,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error(\"Cannot hide the insertion marker outline because there is no active candidate\");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1);this.highlightedBlock=null}}showReplacementFade(a){this.fadedBlock=\na.closest.targetBlock();if(!this.fadedBlock)throw Error(\"Cannot show the replacement fade because the closest connection does not have a target block\");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const a=[];this.firstMarker&&a.push(this.firstMarker);this.lastMarker&&a.push(this.lastMarker);return a}};\n(function(a){a=a.PREVIEW_TYPE||(a.PREVIEW_TYPE={});a[a.INSERTION_MARKER=0]=\"INSERTION_MARKER\";a[a.INPUT_OUTLINE=1]=\"INPUT_OUTLINE\";a[a.REPLACEMENT_FADE=2]=\"REPLACEMENT_FADE\"})(InsertionMarkerManager$$module$build$src$core$insertion_marker_manager||(InsertionMarkerManager$$module$build$src$core$insertion_marker_manager={}));\nvar PreviewType$$module$build$src$core$insertion_marker_manager=InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE,module$build$src$core$insertion_marker_manager={};module$build$src$core$insertion_marker_manager.InsertionMarkerManager=InsertionMarkerManager$$module$build$src$core$insertion_marker_manager;module$build$src$core$insertion_marker_manager.PreviewType=PreviewType$$module$build$src$core$insertion_marker_manager;var Renderer$$module$build$src$core$renderers$common$renderer=class{constructor(a){this.overrides=null;this.name=a}getClassName(){return this.name+\"-renderer\"}init(a,b){this.constants_=this.makeConstants_();b&&(this.overrides=b,Object.assign(this.constants_,b));this.constants_.setTheme(a);this.constants_.init()}createDom(a,b){this.constants_.createDom(a,this.name+\"-\"+b.name,\".\"+this.getClassName()+\".\"+b.getClassName())}refreshDom(a,b){const c=this.getConstants();c.dispose();this.constants_=this.makeConstants_();\nthis.overrides&&Object.assign(this.constants_,this.overrides);this.constants_.randomIdentifier=c.randomIdentifier;this.constants_.setTheme(b);this.constants_.init();this.createDom(a,b)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new ConstantProvider$$module$build$src$core$renderers$common$constants}makeRenderInfo_(a){return new RenderInfo$$module$build$src$core$renderers$common$info(this,a)}makeDrawer_(a,b){return new Drawer$$module$build$src$core$renderers$common$drawer(a,\nb)}makeDebugger_(){return new Debug$$module$build$src$core$renderers$common$debugger(this.getConstants())}makeMarkerDrawer(a,b){return new MarkerSvg$$module$build$src$core$renderers$common$marker_svg(a,this.getConstants(),b)}makePathObject(a,b){return new PathObject$$module$build$src$core$renderers$common$path_object(a,b,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(a){return!0}orphanCanConnectAtEnd(a,b,c){return!!Connection$$module$build$src$core$connection.getConnectionForOrphanedConnection(a,\nc===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE?b.outputConnection:b.previousConnection)}getConnectionPreviewMethod(a,b,c){return b.type===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE||b.type===ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT?!a.isConnected()||this.orphanCanConnectAtEnd(c,a.targetBlock(),b.type)?InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.INSERTION_MARKER:InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.REPLACEMENT_FADE:\nInsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.INSERTION_MARKER}render(a){isDebuggerEnabled$$module$build$src$core$renderers$common$debug()&&!a.renderingDebugger&&(a.renderingDebugger=this.makeDebugger_());const b=this.makeRenderInfo_(a);b.measure();this.makeDrawer_(a,b).draw()}},module$build$src$core$renderers$common$renderer={};module$build$src$core$renderers$common$renderer.Renderer=Renderer$$module$build$src$core$renderers$common$renderer;var module$build$src$core$renderers$common$block_rendering={};module$build$src$core$renderers$common$block_rendering.BottomRow=BottomRow$$module$build$src$core$renderers$measurables$bottom_row;module$build$src$core$renderers$common$block_rendering.Connection=Connection$$module$build$src$core$renderers$measurables$connection;module$build$src$core$renderers$common$block_rendering.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$common$constants;\nmodule$build$src$core$renderers$common$block_rendering.Debug=Debug$$module$build$src$core$renderers$common$debugger;module$build$src$core$renderers$common$block_rendering.Drawer=Drawer$$module$build$src$core$renderers$common$drawer;module$build$src$core$renderers$common$block_rendering.ExternalValueInput=ExternalValueInput$$module$build$src$core$renderers$measurables$external_value_input;module$build$src$core$renderers$common$block_rendering.Field=Field$$module$build$src$core$renderers$measurables$field;\nmodule$build$src$core$renderers$common$block_rendering.Hat=Hat$$module$build$src$core$renderers$measurables$hat;module$build$src$core$renderers$common$block_rendering.Icon=Icon$$module$build$src$core$renderers$measurables$icon;module$build$src$core$renderers$common$block_rendering.InRowSpacer=InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer;module$build$src$core$renderers$common$block_rendering.InlineInput=InlineInput$$module$build$src$core$renderers$measurables$inline_input;\nmodule$build$src$core$renderers$common$block_rendering.InputConnection=InputConnection$$module$build$src$core$renderers$measurables$input_connection;module$build$src$core$renderers$common$block_rendering.InputRow=InputRow$$module$build$src$core$renderers$measurables$input_row;module$build$src$core$renderers$common$block_rendering.JaggedEdge=JaggedEdge$$module$build$src$core$renderers$measurables$jagged_edge;module$build$src$core$renderers$common$block_rendering.MarkerSvg=MarkerSvg$$module$build$src$core$renderers$common$marker_svg;\nmodule$build$src$core$renderers$common$block_rendering.Measurable=Measurable$$module$build$src$core$renderers$measurables$base;module$build$src$core$renderers$common$block_rendering.NextConnection=NextConnection$$module$build$src$core$renderers$measurables$next_connection;module$build$src$core$renderers$common$block_rendering.OutputConnection=OutputConnection$$module$build$src$core$renderers$measurables$output_connection;module$build$src$core$renderers$common$block_rendering.PathObject=PathObject$$module$build$src$core$renderers$common$path_object;\nmodule$build$src$core$renderers$common$block_rendering.PreviousConnection=PreviousConnection$$module$build$src$core$renderers$measurables$previous_connection;module$build$src$core$renderers$common$block_rendering.RenderInfo=RenderInfo$$module$build$src$core$renderers$common$info;module$build$src$core$renderers$common$block_rendering.Renderer=Renderer$$module$build$src$core$renderers$common$renderer;module$build$src$core$renderers$common$block_rendering.RoundCorner=RoundCorner$$module$build$src$core$renderers$measurables$round_corner;\nmodule$build$src$core$renderers$common$block_rendering.Row=Row$$module$build$src$core$renderers$measurables$row;module$build$src$core$renderers$common$block_rendering.SpacerRow=SpacerRow$$module$build$src$core$renderers$measurables$spacer_row;module$build$src$core$renderers$common$block_rendering.SquareCorner=SquareCorner$$module$build$src$core$renderers$measurables$square_corner;module$build$src$core$renderers$common$block_rendering.StatementInput=StatementInput$$module$build$src$core$renderers$measurables$statement_input;\nmodule$build$src$core$renderers$common$block_rendering.TopRow=TopRow$$module$build$src$core$renderers$measurables$top_row;module$build$src$core$renderers$common$block_rendering.Types=Types$$module$build$src$core$renderers$measurables$types;module$build$src$core$renderers$common$block_rendering.init=init$$module$build$src$core$renderers$common$block_rendering;module$build$src$core$renderers$common$block_rendering.register=register$$module$build$src$core$renderers$common$block_rendering;\nmodule$build$src$core$renderers$common$block_rendering.stopDebugger=stopDebugger$$module$build$src$core$renderers$common$block_rendering;module$build$src$core$renderers$common$block_rendering.unregister=unregister$$module$build$src$core$renderers$common$block_rendering;var ThemeManager$$module$build$src$core$theme_manager=class{constructor(a,b){this.workspace=a;this.theme=b;this.subscribedWorkspaces_=[];this.componentDB=new Map}getTheme(){return this.theme}setTheme(a){var b=this.theme;this.theme=a;if(a=this.workspace.getInjectionDiv())b&&(b=b.getClassName())&&removeClass$$module$build$src$core$utils$dom(a,b),(b=this.theme.getClassName())&&addClass$$module$build$src$core$utils$dom(a,b);for(let c=0,d;d=this.subscribedWorkspaces_[c];c++)d.refreshTheme();for(const [c,\nd]of this.componentDB)for(const e of d){a=e.element;b=e.propertyName;const f=this.theme&&this.theme.getComponentStyle(c);a.style[b]=f||\"\"}for(const c of this.subscribedWorkspaces_)c.hideChaff()}subscribeWorkspace(a){this.subscribedWorkspaces_.push(a)}unsubscribeWorkspace(a){if(!removeElem$$module$build$src$core$utils$array(this.subscribedWorkspaces_,a))throw Error(\"Cannot unsubscribe a workspace that hasn't been subscribed.\");}subscribe(a,b,c){this.componentDB.has(b)||this.componentDB.set(b,[]);this.componentDB.get(b).push({element:a,\npropertyName:c});b=this.theme&&this.theme.getComponentStyle(b);a.style[c]=b||\"\"}unsubscribe(a){if(a)for(const [b,c]of this.componentDB){for(let d=c.length-1;0<=d;d--)c[d].element===a&&c.splice(d,1);c.length||this.componentDB.delete(b)}}dispose(){this.subscribedWorkspaces_=this.theme=this.owner_=null;this.componentDB.clear()}},module$build$src$core$theme_manager={};module$build$src$core$theme_manager.ThemeManager=ThemeManager$$module$build$src$core$theme_manager;var CATEGORY_NAME$$module$build$src$core$variables_dynamic=\"VARIABLE_DYNAMIC\",onCreateVariableButtonClick_String$$module$build$src$core$variables_dynamic=stringButtonClickHandler$$module$build$src$core$variables_dynamic,onCreateVariableButtonClick_Number$$module$build$src$core$variables_dynamic=numberButtonClickHandler$$module$build$src$core$variables_dynamic,onCreateVariableButtonClick_Colour$$module$build$src$core$variables_dynamic=colourButtonClickHandler$$module$build$src$core$variables_dynamic,\nmodule$build$src$core$variables_dynamic={};module$build$src$core$variables_dynamic.CATEGORY_NAME=CATEGORY_NAME$$module$build$src$core$variables_dynamic;module$build$src$core$variables_dynamic.flyoutCategory=flyoutCategory$$module$build$src$core$variables_dynamic;module$build$src$core$variables_dynamic.flyoutCategoryBlocks=flyoutCategoryBlocks$$module$build$src$core$variables_dynamic;module$build$src$core$variables_dynamic.onCreateVariableButtonClick_Colour=colourButtonClickHandler$$module$build$src$core$variables_dynamic;\nmodule$build$src$core$variables_dynamic.onCreateVariableButtonClick_Number=numberButtonClickHandler$$module$build$src$core$variables_dynamic;module$build$src$core$variables_dynamic.onCreateVariableButtonClick_String=stringButtonClickHandler$$module$build$src$core$variables_dynamic;var ConnectionChecker$$module$build$src$core$connection_checker=class{canConnect(a,b,c,d){return this.canConnectWithReason(a,b,c,d)===Connection$$module$build$src$core$connection.CAN_CONNECT}canConnectWithReason(a,b,c,d){const e=this.doSafetyChecks(a,b);return e!==Connection$$module$build$src$core$connection.CAN_CONNECT?e:this.doTypeChecks(a,b)?c&&!this.doDragChecks(a,b,d||0)?Connection$$module$build$src$core$connection.REASON_DRAG_CHECKS_FAILED:Connection$$module$build$src$core$connection.CAN_CONNECT:\nConnection$$module$build$src$core$connection.REASON_CHECKS_FAILED}getErrorMessage(a,b,c){switch(a){case Connection$$module$build$src$core$connection.REASON_SELF_CONNECTION:return\"Attempted to connect a block to itself.\";case Connection$$module$build$src$core$connection.REASON_DIFFERENT_WORKSPACES:return\"Blocks not on same workspace.\";case Connection$$module$build$src$core$connection.REASON_WRONG_TYPE:return\"Attempt to connect incompatible types.\";case Connection$$module$build$src$core$connection.REASON_TARGET_NULL:return\"Target connection is null.\";\ncase Connection$$module$build$src$core$connection.REASON_CHECKS_FAILED:return\"Connection checks failed. \"+(b+\" expected \"+b.getCheck()+\", found \"+c.getCheck());case Connection$$module$build$src$core$connection.REASON_SHADOW_PARENT:return\"Connecting non-shadow to shadow block.\";case Connection$$module$build$src$core$connection.REASON_DRAG_CHECKS_FAILED:return\"Drag checks failed.\";case Connection$$module$build$src$core$connection.REASON_PREVIOUS_AND_OUTPUT:return\"Block would have an output and a previous connection.\";\ndefault:return\"Unknown connection failure: this should never happen!\"}}doSafetyChecks(a,b){if(!a||!b)return Connection$$module$build$src$core$connection.REASON_TARGET_NULL;let c,d,e;a.isSuperior()?(c=a.getSourceBlock(),d=b.getSourceBlock(),e=b):(d=a.getSourceBlock(),c=b.getSourceBlock(),e=a,a=b);return c===d?Connection$$module$build$src$core$connection.REASON_SELF_CONNECTION:e.type!==OPPOSITE_TYPE$$module$build$src$core$internal_constants[a.type]?Connection$$module$build$src$core$connection.REASON_WRONG_TYPE:\nc.workspace!==d.workspace?Connection$$module$build$src$core$connection.REASON_DIFFERENT_WORKSPACES:c.isShadow()&&!d.isShadow()?Connection$$module$build$src$core$connection.REASON_SHADOW_PARENT:e.type===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE&&d.previousConnection&&d.previousConnection.isConnected()||e.type===ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT&&d.outputConnection&&d.outputConnection.isConnected()?Connection$$module$build$src$core$connection.REASON_PREVIOUS_AND_OUTPUT:\nConnection$$module$build$src$core$connection.CAN_CONNECT}doTypeChecks(a,b){a=a.getCheck();b=b.getCheck();if(!a||!b)return!0;for(let c=0;c<a.length;c++)if(-1!==b.indexOf(a[c]))return!0;return!1}doDragChecks(a,b,c){if(a.distanceFrom(b)>c||b.getSourceBlock().isInsertionMarker())return!1;switch(b.type){case ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(a,b);case ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE:if(b.isConnected()&&\n!b.targetBlock().isInsertionMarker()||a.isConnected())return!1;break;case ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE:if(b.isConnected()&&!b.targetBlock().isMovable()&&!b.targetBlock().isShadow())return!1;break;case ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT:if(b.isConnected()&&!a.getSourceBlock().nextConnection&&!b.targetBlock().isShadow()&&b.targetBlock().nextConnection)return!1;break;default:return!1}return-1!==draggingConnections$$module$build$src$core$common.indexOf(b)?\n!1:!0}canConnectToPrevious_(a,b){if(a.targetConnection||-1!==draggingConnections$$module$build$src$core$common.indexOf(b))return!1;if(!b.targetConnection)return!0;a=b.targetBlock();return a.isInsertionMarker()?!a.getPreviousBlock():!1}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.CONNECTION_CHECKER,DEFAULT$$module$build$src$core$registry,ConnectionChecker$$module$build$src$core$connection_checker);var module$build$src$core$connection_checker={};\nmodule$build$src$core$connection_checker.ConnectionChecker=ConnectionChecker$$module$build$src$core$connection_checker;var VarDelete$$module$build$src$core$events$events_var_delete=class extends VarBase$$module$build$src$core$events$events_var_base{constructor(a){super(a);this.type=VAR_DELETE$$module$build$src$core$events$utils;a&&(this.varType=a.type,this.varName=a.name)}toJson(){const a=super.toJson();if(!this.varType)throw Error(\"The var type is undefined. Either pass a variable to the constructor, or call fromJson\");if(!this.varName)throw Error(\"The var name is undefined. Either pass a variable to the constructor, or call fromJson\");\na.varType=this.varType;a.varName=this.varName;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.VarDelete.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.varType=a.varType;this.varName=a.varName}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new VarDelete$$module$build$src$core$events$events_var_delete);b.varType=a.varType;b.varName=a.varName;return b}run(a){const b=this.getEventWorkspace_();if(!this.varId)throw Error(\"The var ID is undefined. Either pass a variable to the constructor, or call fromJson\");\nif(!this.varName)throw Error(\"The var name is undefined. Either pass a variable to the constructor, or call fromJson\");a?b.deleteVariableById(this.varId):b.createVariable(this.varName,this.varType,this.varId)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,VAR_DELETE$$module$build$src$core$events$utils,VarDelete$$module$build$src$core$events$events_var_delete);var module$build$src$core$events$events_var_delete={};\nmodule$build$src$core$events$events_var_delete.VarDelete=VarDelete$$module$build$src$core$events$events_var_delete;var VarRename$$module$build$src$core$events$events_var_rename=class extends VarBase$$module$build$src$core$events$events_var_base{constructor(a,b){super(a);this.type=VAR_RENAME$$module$build$src$core$events$utils;a&&(this.oldName=a.name,this.newName=\"undefined\"===typeof b?\"\":b)}toJson(){const a=super.toJson();if(!this.oldName)throw Error(\"The old var name is undefined. Either pass a variable to the constructor, or call fromJson\");if(!this.newName)throw Error(\"The new var name is undefined. Either pass a value to the constructor, or call fromJson\");\na.oldName=this.oldName;a.newName=this.newName;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.VarRename.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.oldName=a.oldName;this.newName=a.newName}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new VarRename$$module$build$src$core$events$events_var_rename);b.oldName=a.oldName;b.newName=a.newName;return b}run(a){const b=this.getEventWorkspace_();if(!this.varId)throw Error(\"The var ID is undefined. Either pass a variable to the constructor, or call fromJson\");\nif(!this.oldName)throw Error(\"The old var name is undefined. Either pass a variable to the constructor, or call fromJson\");if(!this.newName)throw Error(\"The new var name is undefined. Either pass a value to the constructor, or call fromJson\");a?b.renameVariableById(this.varId,this.newName):b.renameVariableById(this.varId,this.oldName)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,VAR_RENAME$$module$build$src$core$events$utils,VarRename$$module$build$src$core$events$events_var_rename);\nvar module$build$src$core$events$events_var_rename={};module$build$src$core$events$events_var_rename.VarRename=VarRename$$module$build$src$core$events$events_var_rename;var VariableMap$$module$build$src$core$variable_map=class{constructor(a){this.workspace=a;this.variableMap=new Map}clear(){this.variableMap.clear()}renameVariable(a,b){if(a.name!==b){var c=this.getVariable(b,a.type),d=this.workspace.getAllBlocks(!1);setGroup$$module$build$src$core$events$utils(!0);try{c&&c.getId()!==a.getId()?this.renameVariableWithConflict_(a,b,c,d):this.renameVariableAndUses_(a,b,d)}finally{setGroup$$module$build$src$core$events$utils(!1)}}}renameVariableById(a,b){const c=this.getVariableById(a);\nif(!c)throw Error(\"Tried to rename a variable that didn't exist. ID: \"+a);this.renameVariable(c,b)}renameVariableAndUses_(a,b,c){fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(VAR_RENAME$$module$build$src$core$events$utils))(a,b));a.name=b;for(b=0;b<c.length;b++)c[b].updateVarName(a)}renameVariableWithConflict_(a,b,c,d){const e=a.type;b!==c.name&&this.renameVariableAndUses_(c,b,d);for(b=0;b<d.length;b++)d[b].renameVarById(a.getId(),c.getId());fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(VAR_DELETE$$module$build$src$core$events$utils))(a));\nremoveElem$$module$build$src$core$utils$array(this.variableMap.get(e),a)}createVariable(a,b,c){var d=this.getVariable(a,b);if(d){if(c&&d.getId()!==c)throw Error('Variable \"'+a+'\" is already in use and its id is \"'+d.getId()+'\" which conflicts with the passed in id, \"'+c+'\".');return d}if(c&&this.getVariableById(c))throw Error('Variable id, \"'+c+'\", is already in use.');d=c||genUid$$module$build$src$core$utils$idgenerator();b=b||\"\";d=new VariableModel$$module$build$src$core$variable_model(this.workspace,\na,b,d);a=this.variableMap.get(b)||[];a.push(d);this.variableMap.delete(b);this.variableMap.set(b,a);fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(VAR_CREATE$$module$build$src$core$events$utils))(d));return d}deleteVariable(a){const b=a.getId(),c=this.variableMap.get(a.type);if(c)for(let d=0;d<c.length;d++)if(c[d].getId()===b){c.splice(d,1);fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(VAR_DELETE$$module$build$src$core$events$utils))(a));\nbreak}}deleteVariableById(a){const b=this.getVariableById(a);if(b){var c=b.name;const d=this.getVariableUsesById(a);for(let e=0,f;f=d[e];e++)if(\"procedures_defnoreturn\"===f.type||\"procedures_defreturn\"===f.type){a=String(f.getFieldValue(\"NAME\"));c=Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace(\"%1\",c).replace(\"%2\",a);alert$$module$build$src$core$dialog(c);return}1<d.length?(c=Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace(\"%1\",String(d.length)).replace(\"%2\",\nc),confirm$$module$build$src$core$dialog(c,e=>{e&&b&&this.deleteVariableInternal(b,d)})):this.deleteVariableInternal(b,d)}else console.warn(\"Can't delete non-existent variable: \"+a)}deleteVariableInternal(a,b){const c=getGroup$$module$build$src$core$events$utils();c||setGroup$$module$build$src$core$events$utils(!0);try{for(let d=0;d<b.length;d++)b[d].dispose(!0);this.deleteVariable(a)}finally{c||setGroup$$module$build$src$core$events$utils(!1)}}getVariable(a,b){if(b=this.variableMap.get(b||\"\"))for(let c=\n0,d;d=b[c];c++)if(Names$$module$build$src$core$names.equals(d.name,a))return d;return null}getVariableById(a){for(const [,b]of this.variableMap)for(const c of b)if(c.getId()===a)return c;return null}getVariablesOfType(a){return(a=this.variableMap.get(a||\"\"))?a.slice():[]}getVariableTypes(a){const b=new Set(this.variableMap.keys());if(a&&a.getPotentialVariableMap())for(const c of a.getPotentialVariableMap().variableMap.keys())b.add(c);b.has(\"\")||b.add(\"\");return Array.from(b.values())}getAllVariables(){let a=\n[];for(const b of this.variableMap.values())a=a.concat(b);return a}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map(a=>a.name)}getVariableUsesById(a){const b=[],c=this.workspace.getAllBlocks(!1);for(let d=0;d<c.length;d++){const e=c[d].getVarModels();if(e)for(let f=0;f<e.length;f++)e[f].getId()===a&&b.push(c[d])}return b}},module$build$src$core$variable_map={};module$build$src$core$variable_map.VariableMap=VariableMap$$module$build$src$core$variable_map;var Workspace$$module$build$src$core$workspace=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(a){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1;this.MAX_UNDO=1024;this.connectionDBList=[];this.topBlocks=[];this.topComments=[];this.commentDB=new Map;this.listeners=[];this.undoStack_=[];this.redoStack_=[];this.blockDB=new Map;this.typedBlocksDB=new Map;this.procedureMap=new ObservableProcedureMap$$module$build$src$core$procedures$observable_procedure_map(this);\nthis.potentialVariableMap=null;this.id=genUid$$module$build$src$core$utils$idgenerator();registerWorkspace$$module$build$src$core$common(this);this.options=a||new Options$$module$build$src$core$options({});this.RTL=!!this.options.RTL;this.horizontalLayout=!!this.options.horizontalLayout;this.toolboxPosition=this.options.toolboxPosition;this.connectionChecker=new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.CONNECTION_CHECKER,this.options,!0))(this);this.variableMap=\nnew VariableMap$$module$build$src$core$variable_map(this)}dispose(){this.listeners.length=0;this.clear();unregisterWorkpace$$module$build$src$core$common(this)}sortObjects_(a,b){a=a.getRelativeToSurfaceXY();b=b.getRelativeToSurfaceXY();return a.y+Workspace$$module$build$src$core$workspace.prototype.sortObjects_.offset*a.x-(b.y+Workspace$$module$build$src$core$workspace.prototype.sortObjects_.offset*b.x)}addTopBlock(a){this.topBlocks.push(a)}removeTopBlock(a){if(!removeElem$$module$build$src$core$utils$array(this.topBlocks,\na))throw Error(\"Block not present in workspace's list of top-most blocks.\");}getTopBlocks(a){const b=[].concat(this.topBlocks);a&&1<b.length&&(this.sortObjects_.offset=Math.sin(toRadians$$module$build$src$core$utils$math(Workspace$$module$build$src$core$workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),b.sort(this.sortObjects_));return b}addTypedBlock(a){this.typedBlocksDB.has(a.type)||this.typedBlocksDB.set(a.type,[]);this.typedBlocksDB.get(a.type).push(a)}removeTypedBlock(a){removeElem$$module$build$src$core$utils$array(this.typedBlocksDB.get(a.type),\na);this.typedBlocksDB.get(a.type).length||this.typedBlocksDB.delete(a.type)}getBlocksByType(a,b){if(!this.typedBlocksDB.has(a))return[];a=this.typedBlocksDB.get(a).slice(0);b&&a&&1<a.length&&(this.sortObjects_.offset=Math.sin(toRadians$$module$build$src$core$utils$math(Workspace$$module$build$src$core$workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),a.sort(this.sortObjects_));return a.filter(function(c){return!c.isInsertionMarker()})}addTopComment(a){this.topComments.push(a);this.commentDB.has(a.id)&&\nconsole.warn('Overriding an existing comment on this workspace, with id \"'+a.id+'\"');this.commentDB.set(a.id,a)}removeTopComment(a){if(!removeElem$$module$build$src$core$utils$array(this.topComments,a))throw Error(\"Comment not present in workspace's list of top-most comments.\");this.commentDB.delete(a.id)}getTopComments(a){const b=[].concat(this.topComments);a&&1<b.length&&(this.sortObjects_.offset=Math.sin(toRadians$$module$build$src$core$utils$math(Workspace$$module$build$src$core$workspace.SCAN_ANGLE)),\nthis.RTL&&(this.sortObjects_.offset*=-1),b.sort(this.sortObjects_));return b}getAllBlocks(a){if(a){var b=this.getTopBlocks(!0);a=[];for(let c=0;c<b.length;c++)a.push(...b[c].getDescendants(!0))}else for(a=this.getTopBlocks(!1),b=0;b<a.length;b++)a.push(...a[b].getChildren(!1));return a.filter(function(c){return!c.isInsertionMarker()})}clear(){this.isClearing=!0;try{const a=getGroup$$module$build$src$core$events$utils();for(a||setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);\nfor(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();a||setGroup$$module$build$src$core$events$utils(!1);this.variableMap.clear();this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(a,b){this.variableMap.renameVariableById(a,b)}createVariable(a,b,c){return this.variableMap.createVariable(a,b,c)}getVariableUsesById(a){return this.variableMap.getVariableUsesById(a)}deleteVariableById(a){this.variableMap.deleteVariableById(a)}getVariable(a,\nb){return this.variableMap.getVariable(a,b)}getVariableById(a){return this.variableMap.getVariableById(a)}getVariablesOfType(a){return this.variableMap.getVariablesOfType(a)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(a,b){throw Error(\"The implementation of newBlock should be monkey-patched in by blockly.ts\");}remainingCapacity(){return isNaN(this.options.maxBlocks)?\nInfinity:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(a){return this.options.maxInstances?(void 0!==this.options.maxInstances[a]?this.options.maxInstances[a]:Infinity)-this.getBlocksByType(a,!1).length:Infinity}isCapacityAvailable(a){if(!this.hasBlockLimits())return!0;let b=0;for(const c in a){if(a[c]>this.remainingCapacityOfType(c))return!1;b+=a[c]}return b>this.remainingCapacity()?!1:!0}hasBlockLimits(){return Infinity!==this.options.maxBlocks||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(a){var b=\na?this.redoStack_:this.undoStack_,c=a?this.undoStack_:this.redoStack_;const d=b.pop();if(d){for(var e=[d];b.length&&d.group&&d.group===b[b.length-1].group;)e.push(b.pop());for(b=0;b<e.length;b++)c.push(e[b]);e=filter$$module$build$src$core$events$utils(e,a);setRecordUndo$$module$build$src$core$events$utils(!1);try{for(c=0;c<e.length;c++)e[c].run(a)}finally{setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0;this.redoStack_.length=0;clearPendingUndo$$module$build$src$core$events$utils()}addChangeListener(a){this.listeners.push(a);\nreturn a}removeChangeListener(a){removeElem$$module$build$src$core$utils$array(this.listeners,a)}fireChangeListener(a){if(a.recordUndo)for(this.undoStack_.push(a),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let b=0;b<this.listeners.length;b++)(0,this.listeners[b])(a)}getBlockById(a){return this.blockDB.get(a)||null}setBlockById(a,b){this.blockDB.set(a,b)}removeBlockById(a){this.blockDB.delete(a)}getCommentById(a){let b;return null!=\n(b=this.commentDB.get(a))?b:null}allInputsFilled(a){const b=this.getTopBlocks(!1);for(let c=0;c<b.length;c++)if(!b[c].allInputsFilled(a))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new VariableMap$$module$build$src$core$variable_map(this)}getVariableMap(){return this.variableMap}setVariableMap(a){this.variableMap=a}getProcedureMap(){return this.procedureMap}static getById(a){return getWorkspaceById$$module$build$src$core$common(a)}static getAll(){return getAllWorkspaces$$module$build$src$core$common()}};\nWorkspace$$module$build$src$core$workspace.SCAN_ANGLE=3;var module$build$src$core$workspace={};module$build$src$core$workspace.Workspace=Workspace$$module$build$src$core$workspace;var SOUND_LIMIT$$module$build$src$core$workspace_audio=100,WorkspaceAudio$$module$build$src$core$workspace_audio=class{constructor(a){this.parentWorkspace=a;this.sounds=new Map;this.lastSound_=null}dispose(){this.sounds.clear()}load(a,b){if(a.length){try{var c=new globalThis.Audio}catch(e){return}for(let e=0;e<a.length;e++){const f=a[e],g=f.match(/\\.(\\w+)$/);if(g&&c.canPlayType(\"audio/\"+g[1])){var d=new globalThis.Audio(f);break}}d&&this.sounds.set(b,d)}}preload(){for(const a of this.sounds.values()){a.volume=\n.01;const b=a.play();void 0!==b?b.then(a.pause).catch(function(){}):a.pause();if(IPAD$$module$build$src$core$utils$useragent||IPHONE$$module$build$src$core$utils$useragent)break}}play(a,b){var c=this.sounds.get(a);c?(a=new Date,null!==this.lastSound_&&a.getTime()-this.lastSound_.getTime()<SOUND_LIMIT$$module$build$src$core$workspace_audio||(this.lastSound_=a,c=IPAD$$module$build$src$core$utils$useragent||ANDROID$$module$build$src$core$utils$useragent?c:c.cloneNode(),c.volume=void 0===b?1:b,c.play())):\nthis.parentWorkspace&&this.parentWorkspace.getAudioManager().play(a,b)}},module$build$src$core$workspace_audio={};module$build$src$core$workspace_audio.WorkspaceAudio=WorkspaceAudio$$module$build$src$core$workspace_audio;var ZoomControls$$module$build$src$core$zoom_controls=class{constructor(a){this.workspace=a;this.id=\"zoomControls\";this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=this.onZoomOutWrapper=this.onZoomInWrapper=this.onZoomResetWrapper=null;this.HEIGHT=this.WIDTH=32;this.SMALL_SPACING=2;this.LARGE_SPACING=11;this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20;this.svgGroup=null;this.top=this.left=0;this.initialized=!1}createDom(){this.svgGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,\n{});const a=String(Math.random()).substring(2);this.createZoomOutSvg(a);this.createZoomInSvg(a);this.workspace.isMovable()&&this.createZoomResetSvg(a);return this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:2,capabilities:[ComponentManager$$module$build$src$core$component_manager.Capability.POSITIONABLE]});this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent(\"zoomControls\");this.svgGroup&&removeNode$$module$build$src$core$utils$dom(this.svgGroup);\nthis.onZoomResetWrapper&&unbind$$module$build$src$core$browser_events(this.onZoomResetWrapper);this.onZoomInWrapper&&unbind$$module$build$src$core$browser_events(this.onZoomInWrapper);this.onZoomOutWrapper&&unbind$$module$build$src$core$browser_events(this.onZoomOutWrapper)}getBoundingRectangle(){let a=this.SMALL_SPACING+2*this.HEIGHT;this.zoomResetGroup&&(a+=this.LARGE_SPACING+this.HEIGHT);return new Rect$$module$build$src$core$utils$rect(this.top,this.top+a,this.left,this.left+this.WIDTH)}position(a,\nb){if(this.initialized){var c=getCornerOppositeToolbox$$module$build$src$core$positionable_helpers(this.workspace,a),d=this.SMALL_SPACING+2*this.HEIGHT;this.zoomResetGroup&&(d+=this.LARGE_SPACING+this.HEIGHT);a=getStartPositionRect$$module$build$src$core$positionable_helpers(c,new Size$$module$build$src$core$utils$size(this.WIDTH,d),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,a,this.workspace);c=c.vertical;b=bumpPositionRect$$module$build$src$core$positionable_helpers(a,this.MARGIN_VERTICAL,c===verticalPosition$$module$build$src$core$positionable_helpers.TOP?\nbumpDirection$$module$build$src$core$positionable_helpers.DOWN:bumpDirection$$module$build$src$core$positionable_helpers.UP,b);if(c===verticalPosition$$module$build$src$core$positionable_helpers.TOP){var e=this.SMALL_SPACING+this.HEIGHT,f;null==(f=this.zoomInGroup)||f.setAttribute(\"transform\",\"translate(0, \"+e+\")\");this.zoomResetGroup&&this.zoomResetGroup.setAttribute(\"transform\",\"translate(0, \"+(e+this.LARGE_SPACING+this.HEIGHT)+\")\")}else{f=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0;let h;\nnull==(h=this.zoomInGroup)||h.setAttribute(\"transform\",\"translate(0, \"+f+\")\");f=f+this.SMALL_SPACING+this.HEIGHT;null==(e=this.zoomOutGroup)||e.setAttribute(\"transform\",\"translate(0, \"+f+\")\")}this.top=b.top;this.left=b.left;var g;null==(g=this.svgGroup)||g.setAttribute(\"transform\",\"translate(\"+this.left+\",\"+this.top+\")\")}}createZoomOutSvg(a){this.zoomOutGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyZoom\"},this.svgGroup);const b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CLIPPATH,\n{id:\"blocklyZoomoutClipPath\"+a},this.zoomOutGroup);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:32,height:32},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{width:SPRITE$$module$build$src$core$sprites.width,height:SPRITE$$module$build$src$core$sprites.height,x:-64,y:-92,\"clip-path\":\"url(#blocklyZoomoutClipPath\"+a+\")\"},this.zoomOutGroup).setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",\nthis.workspace.options.pathToMedia+SPRITE$$module$build$src$core$sprites.url);this.onZoomOutWrapper=conditionalBind$$module$build$src$core$browser_events(this.zoomOutGroup,\"pointerdown\",null,this.zoom.bind(this,-1))}createZoomInSvg(a){this.zoomInGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyZoom\"},this.svgGroup);const b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CLIPPATH,{id:\"blocklyZoominClipPath\"+\na},this.zoomInGroup);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:32,height:32},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{width:SPRITE$$module$build$src$core$sprites.width,height:SPRITE$$module$build$src$core$sprites.height,x:-32,y:-92,\"clip-path\":\"url(#blocklyZoominClipPath\"+a+\")\"},this.zoomInGroup).setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",this.workspace.options.pathToMedia+\nSPRITE$$module$build$src$core$sprites.url);this.onZoomInWrapper=conditionalBind$$module$build$src$core$browser_events(this.zoomInGroup,\"pointerdown\",null,this.zoom.bind(this,1))}zoom(a,b){this.workspace.markFocused();this.workspace.zoomCenter(a);this.fireZoomEvent();clearTouchIdentifier$$module$build$src$core$touch();b.stopPropagation();b.preventDefault()}createZoomResetSvg(a){this.zoomResetGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyZoom\"},\nthis.svgGroup);const b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CLIPPATH,{id:\"blocklyZoomresetClipPath\"+a},this.zoomResetGroup);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{width:32,height:32},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{width:SPRITE$$module$build$src$core$sprites.width,height:SPRITE$$module$build$src$core$sprites.height,y:-92,\"clip-path\":\"url(#blocklyZoomresetClipPath\"+\na+\")\"},this.zoomResetGroup).setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",this.workspace.options.pathToMedia+SPRITE$$module$build$src$core$sprites.url);this.onZoomResetWrapper=conditionalBind$$module$build$src$core$browser_events(this.zoomResetGroup,\"pointerdown\",null,this.resetZoom.bind(this))}resetZoom(a){this.workspace.markFocused();const b=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);\nthis.workspace.beginCanvasTransition();this.workspace.zoomCenter(b);this.workspace.scrollCenter();setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500);this.fireZoomEvent();clearTouchIdentifier$$module$build$src$core$touch();a.stopPropagation();a.preventDefault()}fireZoomEvent(){const a=new (get$$module$build$src$core$events$utils(CLICK$$module$build$src$core$events$utils))(null,this.workspace.id,\"zoom_controls\");fire$$module$build$src$core$events$utils(a)}};register$$module$build$src$core$css(\"\\n.blocklyZoom>image, .blocklyZoom>svg>image {\\n  opacity: .4;\\n}\\n\\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\\n  opacity: .6;\\n}\\n\\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\\n  opacity: .8;\\n}\\n\");\nvar module$build$src$core$zoom_controls={};module$build$src$core$zoom_controls.ZoomControls=ZoomControls$$module$build$src$core$zoom_controls;var ZOOM_TO_FIT_MARGIN$$module$build$src$core$workspace_svg=20,WorkspaceSvg$$module$build$src$core$workspace_svg=class extends Workspace$$module$build$src$core$workspace{constructor(a,b,c){super(a);this.resizeHandlerWrapper=null;this.resizesEnabled=this.isVisible_=this.rendered=!0;this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0;this.dragDeltaXY=null;this.oldScale=this.scale=1;this.oldLeft=this.oldTop=0;this.workspaceDragSurface=this.blockDragSurface=this.currentGesture_=this.toolbox_=\nthis.flyout=this.scrollbar=this.trashcan=null;this.isDragSurfaceActive=!1;this.inverseScreenCTM=this.targetWorkspace=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=null;this.inverseScreenCTMDirty=!0;this.highlightedBlocks=[];this.toolboxCategoryCallbacks=new Map;this.flyoutButtonCallbacks=new Map;this.cachedParentSvg=null;this.keyboardAccessibilityMode=!1;this.topBoundedElements=[];this.dragTargetAreas=[];this.zoomControls_=null;this.metricsManager=new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.METRICS_MANAGER,\na,!0))(this);this.getMetrics=a.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager);this.setMetrics=a.setMetrics||WorkspaceSvg$$module$build$src$core$workspace_svg.setTopLevelWorkspaceMetrics_;this.componentManager=new ComponentManager$$module$build$src$core$component_manager;this.connectionDBList=ConnectionDB$$module$build$src$core$connection_db.init(this.connectionChecker);b&&(this.blockDragSurface=b);c&&(this.workspaceDragSurface=c);this.useWorkspaceDragSurface=!!this.workspaceDragSurface;\nthis.audioManager=new WorkspaceAudio$$module$build$src$core$workspace_audio(a.parentWorkspace);this.grid=this.options.gridPattern?new Grid$$module$build$src$core$grid(this.options.gridPattern,a.gridOptions):null;this.markerManager=new MarkerManager$$module$build$src$core$marker_manager(this);$.module$build$src$core$variables&&flyoutCategory$$module$build$src$core$variables&&this.registerToolboxCategoryCallback(CATEGORY_NAME$$module$build$src$core$variables,flyoutCategory$$module$build$src$core$variables);\nmodule$build$src$core$variables_dynamic&&flyoutCategory$$module$build$src$core$variables_dynamic&&this.registerToolboxCategoryCallback(CATEGORY_NAME$$module$build$src$core$variables_dynamic,flyoutCategory$$module$build$src$core$variables_dynamic);$.module$build$src$core$procedures&&flyoutCategory$$module$build$src$core$procedures&&(this.registerToolboxCategoryCallback(CATEGORY_NAME$$module$build$src$core$procedures,flyoutCategory$$module$build$src$core$procedures),this.addChangeListener(mutatorOpenListener$$module$build$src$core$procedures));\nthis.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new ThemeManager$$module$build$src$core$theme_manager(this,this.options.theme||Classic$$module$build$src$core$theme$classic);this.themeManager_.subscribeWorkspace(this);let d;this.renderer=init$$module$build$src$core$renderers$common$block_rendering(this.options.renderer||\"geras\",this.getTheme(),null!=(d=this.options.rendererOverrides)?d:void 0);this.cachedParentSvgSize=new Size$$module$build$src$core$utils$size(0,\n0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(a){this.metricsManager=a;this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(a){this.markerManager.setCursorSvg(a)}setMarkerSvg(a){this.markerManager.setMarkerSvg(a)}getMarker(a){return this.markerManager?this.markerManager.getMarker(a):null}getCursor(){return this.markerManager?this.markerManager.getCursor():\nnull}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(a){a||(a=Classic$$module$build$src$core$theme$classic);this.themeManager_.setTheme(a)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme());this.updateBlockStyles_(this.getAllBlocks(!1).filter(function(b){return!!b.getStyleName()}));this.refreshToolboxSelection();this.toolbox_&&this.toolbox_.refreshTheme();this.isVisible()&&\nthis.setVisible(!0);const a=new (get$$module$build$src$core$events$utils(THEME_CHANGE$$module$build$src$core$events$utils))(this.getTheme().name,this.id);fire$$module$build$src$core$events$utils(a)}updateBlockStyles_(a){for(let b=0,c;c=a[b];b++){const d=c.getStyleName();if(d){const e=c;e.setStyle(d);e.mutator&&e.mutator.updateBlockStyle()}}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const a=this.getParentSvg().getScreenCTM();a&&(this.inverseScreenCTM=a.inverse(),this.inverseScreenCTMDirty=\n!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.isVisible_}getSvgXY(a){let b=0,c=0,d=1;if(containsNode$$module$build$src$core$utils$dom(this.getCanvas(),a)||containsNode$$module$build$src$core$utils$dom(this.getBubbleCanvas(),a))d=this.scale;do{const e=getRelativeXY$$module$build$src$core$utils$svg_math(a);if(a===this.getCanvas()||a===this.getBubbleCanvas())d=1;b+=e.x*d;c+=e.y*d;a=a.parentNode}while(a&&a!==this.getParentSvg());return new Coordinate$$module$build$src$core$utils$coordinate(b,\nc)}getCachedParentSvgSize(){const a=this.cachedParentSvgSize;return new Size$$module$build$src$core$utils$size(a.width,a.height)}getOriginOffsetInPixels(){return getInjectionDivXY$$module$build$src$core$utils$svg_math(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let a=this.svgGroup_;for(;a;){if(-1!==(\" \"+(a.getAttribute(\"class\")||\"\")+\" \").indexOf(\" injectionDiv \")){this.injectionDiv=a;break}a=a.parentNode}}return this.injectionDiv}getBlockCanvas(){return this.svgBlockCanvas_}setResizeHandlerWrapper(a){this.resizeHandlerWrapper=\na}createDom(a){this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyWorkspace\"});a&&(this.svgBackground_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{height:\"100%\",width:\"100%\",\"class\":a},this.svgGroup_),\"blocklyMainBackground\"===a&&this.grid?this.svgBackground_.style.fill=\"url(#\"+this.grid.getPatternId()+\")\":this.themeManager_.subscribe(this.svgBackground_,\"workspaceBackgroundColour\",\n\"fill\"));this.svgBlockCanvas_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyBlockCanvas\"},this.svgGroup_);this.svgBubbleCanvas_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyBubbleCanvas\"},this.svgGroup_);this.isFlyout||(conditionalBind$$module$build$src$core$browser_events(this.svgGroup_,\"pointerdown\",this,this.onMouseDown_,!1),document.body.addEventListener(\"wheel\",function(){}),\nconditionalBind$$module$build$src$core$browser_events(this.svgGroup_,\"wheel\",this,this.onMouseWheel_));this.options.hasCategories&&(this.toolbox_=new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.TOOLBOX,this.options,!0))(this));this.grid&&this.grid.update(this.scale);this.recordDragTargets();(a=getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.CURSOR,this.options))&&this.markerManager.setCursor(new a);this.renderer.createDom(this.svgGroup_,\nthis.getTheme());return this.svgGroup_}dispose(){this.rendered=!1;this.currentGesture_&&this.currentGesture_.cancel();this.svgGroup_&&removeNode$$module$build$src$core$utils$dom(this.svgGroup_);this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null);this.flyout&&(this.flyout.dispose(),this.flyout=null);this.trashcan&&(this.trashcan.dispose(),this.trashcan=null);this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null);this.zoomControls_&&this.zoomControls_.dispose();this.audioManager&&this.audioManager.dispose();\nthis.grid&&(this.grid=null);this.renderer.dispose();this.markerManager&&this.markerManager.dispose();super.dispose();this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose());this.connectionDBList.length=0;this.toolboxCategoryCallbacks.clear();this.flyoutButtonCallbacks.clear();if(!this.options.parentWorkspace){const a=this.getParentSvg();a&&a.parentNode&&removeNode$$module$build$src$core$utils$dom(a.parentNode)}this.resizeHandlerWrapper&&\n(unbind$$module$build$src$core$browser_events(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null)}addTrashcan(){this.trashcan=WorkspaceSvg$$module$build$src$core$workspace_svg.newTrashcan(this);const a=this.trashcan.createDom();this.svgGroup_.insertBefore(a,this.svgBlockCanvas_)}static newTrashcan(a){throw Error(\"The implementation of newTrashcan should be monkey-patched in by blockly.ts\");}addZoomControls(){this.zoomControls_=new ZoomControls$$module$build$src$core$zoom_controls(this);const a=\nthis.zoomControls_.createDom();this.svgGroup_.appendChild(a)}addFlyout(a){const b=new Options$$module$build$src$core$options({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});b.toolboxPosition=this.options.toolboxPosition;this.flyout=this.horizontalLayout?new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_HORIZONTAL_TOOLBOX,\nthis.options,!0))(b):new (getClassFromOptions$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(b);this.flyout.autoClose=!1;this.flyout.getWorkspace().setVisible(!0);return this.flyout.createDom(a)}getFlyout(a){return this.flyout||a?this.flyout:this.toolbox_?this.toolbox_.getFlyout():null}getToolbox(){return this.toolbox_}updateScreenCalculations_(){this.updateInverseScreenCTM();this.recordDragTargets()}resizeContents(){this.resizesEnabled&&\nthis.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox_&&this.toolbox_.position();this.flyout&&this.flyout.position();const a=this.componentManager.getComponents(ComponentManager$$module$build$src$core$component_manager.Capability.POSITIONABLE,!0),b=this.getMetricsManager().getUiMetrics(),c=[];for(let d=0,e;e=a[d];d++){e.position(b,c);const f=e.getBoundingRectangle();f&&c.push(f)}this.scrollbar&&this.scrollbar.resize();this.updateScreenCalculations_()}updateScreenCalculationsIfScrolled(){const a=\ngetDocumentScroll$$module$build$src$core$utils$svg_math();Coordinate$$module$build$src$core$utils$coordinate.equals(this.lastRecordedPageScroll,a)||(this.lastRecordedPageScroll=a,this.updateScreenCalculations_())}getCanvas(){return this.svgBlockCanvas_}setCachedParentSvgSize(a,b){const c=this.getParentSvg();null!=a&&(this.cachedParentSvgSize.width=a,c.setAttribute(\"data-cached-width\",a.toString()));null!=b&&(this.cachedParentSvgSize.height=b,c.setAttribute(\"data-cached-height\",b.toString()))}getBubbleCanvas(){return this.svgBubbleCanvas_}getParentSvg(){if(!this.cachedParentSvg){let a=\nthis.svgGroup_;for(;a;){if(\"svg\"===a.tagName){this.cachedParentSvg=a;break}a=a.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(isEnabled$$module$build$src$core$events$utils()){var a=this.scale,b=-this.scrollY,c=-this.scrollX;if(!(a===this.oldScale&&1>Math.abs(b-this.oldTop)&&1>Math.abs(c-this.oldLeft))){var d=new (get$$module$build$src$core$events$utils(VIEWPORT_CHANGE$$module$build$src$core$events$utils))(b,c,a,this.id,this.oldScale);this.oldScale=a;this.oldTop=b;this.oldLeft=\nc;fire$$module$build$src$core$events$utils(d)}}}translate(a,b){if(this.useWorkspaceDragSurface&&this.isDragSurfaceActive){var c;null==(c=this.workspaceDragSurface)||c.translateSurface(a,b)}else c=\"translate(\"+a+\",\"+b+\") scale(\"+this.scale+\")\",this.svgBlockCanvas_.setAttribute(\"transform\",c),this.svgBubbleCanvas_.setAttribute(\"transform\",c);this.blockDragSurface&&this.blockDragSurface.translateAndScaleGroup(a,b,this.scale);this.grid&&this.grid.moveTo(a,b);this.maybeFireViewportChangeEvent()}resetDragSurface(){if(this.useWorkspaceDragSurface){this.isDragSurfaceActive=\n!1;var a=this.workspaceDragSurface.getSurfaceTranslation();this.workspaceDragSurface.clearAndHide(this.svgGroup_);a=\"translate(\"+a.x+\",\"+a.y+\") scale(\"+this.scale+\")\";this.svgBlockCanvas_.setAttribute(\"transform\",a);this.svgBubbleCanvas_.setAttribute(\"transform\",a)}}setupDragSurface(){if(this.useWorkspaceDragSurface&&!this.isDragSurfaceActive){this.isDragSurfaceActive=!0;var a=this.svgBlockCanvas_.previousSibling,b,c=parseInt(null!=(b=this.getParentSvg().getAttribute(\"width\"))?b:\"0\"),d;b=parseInt(null!=\n(d=this.getParentSvg().getAttribute(\"height\"))?d:\"0\");d=getRelativeXY$$module$build$src$core$utils$svg_math(this.getCanvas());this.workspaceDragSurface.setContentsAndShow(this.getCanvas(),this.getBubbleCanvas(),a,c,b,this.scale);this.workspaceDragSurface.translateSurface(d.x,d.y)}}getBlockDragSurface(){return this.blockDragSurface}getWidth(){const a=this.getMetrics();return a?a.viewWidth/this.scale:0}setVisible(a){this.isVisible_=a;if(this.svgGroup_)if(this.scrollbar&&this.scrollbar.setContainerVisible(a),\nthis.getFlyout()&&this.getFlyout().setContainerVisible(a),this.getParentSvg().style.display=a?\"block\":\"none\",this.toolbox_&&this.toolbox_.setVisible(a),a){a=this.getAllBlocks(!1);for(let b=a.length-1;0<=b;b--)a[b].markDirty();this.render();this.toolbox_&&this.toolbox_.position()}else this.hideChaff(!0)}render(){var a=this.getAllBlocks(!1);for(var b=a.length-1;0<=b;b--)a[b].render(!1);if(this.currentGesture_)for(a=this.currentGesture_.getInsertionMarkers(),b=0;b<a.length;b++)a[b].render(!1);this.markerManager.updateMarkers()}highlightBlock(a,\nb){if(void 0===b){for(let c=0,d;d=this.highlightedBlocks[c];c++)d.setHighlighted(!1);this.highlightedBlocks.length=0}if(a=a?this.getBlockById(a):null)(b=void 0===b||b)?-1===this.highlightedBlocks.indexOf(a)&&this.highlightedBlocks.push(a):removeElem$$module$build$src$core$utils$array(this.highlightedBlocks,a),a.setHighlighted(b)}paste(a){if(!this.rendered||!a.type&&!a.tagName)return null;this.currentGesture_&&this.currentGesture_.cancel();const b=getGroup$$module$build$src$core$events$utils();b||\nsetGroup$$module$build$src$core$events$utils(!0);a=a.type?this.pasteBlock_(null,a):\"comment\"===a.tagName.toLowerCase()?this.pasteWorkspaceComment_(a):this.pasteBlock_(a,null);setGroup$$module$build$src$core$events$utils(b);return a}pasteBlock_(a,b){disable$$module$build$src$core$events$utils();let c;try{let d=0,e=0;if(a){c=domToBlock$$module$build$src$core$xml(a,this);let f;d=parseInt(null!=(f=a.getAttribute(\"x\"))?f:\"0\");this.RTL&&(d=-d);let g;e=parseInt(null!=(g=a.getAttribute(\"y\"))?g:\"0\")}else b&&\n(c=append$$module$build$src$core$serialization$blocks(b,this),d=b.x||10,this.RTL&&(d=this.getWidth()-d),e=b.y||10);if(!isNaN(d)&&!isNaN(e)){let f;do{f=!1;const g=this.getAllBlocks(!1);for(let h=0,k;k=g[h];h++){const l=k.getRelativeToSurfaceXY();if(1>=Math.abs(d-l.x)&&1>=Math.abs(e-l.y)){f=!0;break}}if(!f){const h=c.getConnections_(!1);for(let k=0,l;l=h[k];k++)if(l.closest($.config$$module$build$src$core$config.snapRadius,new Coordinate$$module$build$src$core$utils$coordinate(d,e)).connection){f=!0;\nbreak}}f&&(d=this.RTL?d-$.config$$module$build$src$core$config.snapRadius:d+$.config$$module$build$src$core$config.snapRadius,e+=2*$.config$$module$build$src$core$config.snapRadius)}while(f);c.moveTo(new Coordinate$$module$build$src$core$utils$coordinate(d,e))}}finally{enable$$module$build$src$core$events$utils()}isEnabled$$module$build$src$core$events$utils()&&!c.isShadow()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CREATE$$module$build$src$core$events$utils))(c));\nc.select();return c}pasteWorkspaceComment_(a){disable$$module$build$src$core$events$utils();let b;try{b=WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.fromXmlRendered(a,this);let c,d=parseInt(null!=(c=a.getAttribute(\"x\"))?c:\"0\"),e,f=parseInt(null!=(e=a.getAttribute(\"y\"))?e:\"0\");isNaN(d)||isNaN(f)||(this.RTL&&(d=-d),b.moveBy(d+50,f+50))}finally{enable$$module$build$src$core$events$utils()}isEnabled$$module$build$src$core$events$utils()&&WorkspaceComment$$module$build$src$core$workspace_comment.fireCreateEvent(b);\nb.select();return b}refreshToolboxSelection(){const a=this.isFlyout?this.targetWorkspace:this;a&&!a.currentGesture_&&a.toolbox_&&a.toolbox_.getFlyout()&&a.toolbox_.refreshSelection()}renameVariableById(a,b){super.renameVariableById(a,b);this.refreshToolboxSelection()}deleteVariableById(a){super.deleteVariableById(a);this.refreshToolboxSelection()}createVariable(a,b,c){a=super.createVariable(a,b,c);this.refreshToolboxSelection();return a}recordDragTargets(){const a=this.componentManager.getComponents(ComponentManager$$module$build$src$core$component_manager.Capability.DRAG_TARGET,\n!0);this.dragTargetAreas=[];for(let b=0,c;c=a[b];b++){const d=c.getClientRect();d&&this.dragTargetAreas.push({component:c,clientRect:d})}}newBlock(a,b){throw Error(\"The implementation of newBlock should be monkey-patched in by blockly.ts\");}getDragTarget(a){for(let b=0,c;c=this.dragTargetAreas[b];b++)if(c.clientRect.contains(a.clientX,a.clientY))return c.component;return null}onMouseDown_(a){const b=this.getGesture(a);b&&b.handleWsStart(a,this)}startDrag(a,b){a=mouseToSvg$$module$build$src$core$browser_events(a,\nthis.getParentSvg(),this.getInverseScreenCTM());a.x/=this.scale;a.y/=this.scale;this.dragDeltaXY=Coordinate$$module$build$src$core$utils$coordinate.difference(b,a)}moveDrag(a){a=mouseToSvg$$module$build$src$core$browser_events(a,this.getParentSvg(),this.getInverseScreenCTM());a.x/=this.scale;a.y/=this.scale;return Coordinate$$module$build$src$core$utils$coordinate.sum(this.dragDeltaXY,a)}isDragging(){return null!==this.currentGesture_&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&\nthis.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const a=!!this.scrollbar;return this.isMovable()&&(!a||a&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const a=!!this.scrollbar;\nreturn this.isMovable()&&(!a||a&&this.scrollbar.canScrollVertically())}onMouseWheel_(a){if(Gesture$$module$build$src$core$gesture.inProgress())a.preventDefault(),a.stopPropagation();else{var b=this.options.zoomOptions&&this.options.zoomOptions.wheel,c=this.options.moveOptions&&this.options.moveOptions.wheel;if(b||c){var d=getScrollDeltaPixels$$module$build$src$core$browser_events(a);if(MAC$$module$build$src$core$utils$useragent)var e=a.metaKey;b&&(a.ctrlKey||e||!c)?(d=-d.y/50,b=mouseToSvg$$module$build$src$core$browser_events(a,\nthis.getParentSvg(),this.getInverseScreenCTM()),this.zoom(b.x,b.y,d)):(b=this.scrollX-d.x,c=this.scrollY-d.y,a.shiftKey&&!d.x&&(b=this.scrollX-d.y,c=this.scrollY),this.scroll(b,c));a.preventDefault()}}}getBlocksBoundingBox(){const a=this.getTopBoundedElements();if(!a.length)return new Rect$$module$build$src$core$utils$rect(0,0,0,0);const b=a[0].getBoundingRectangle();for(let d=1;d<a.length;d++){var c=a[d];c.isInsertionMarker&&c.isInsertionMarker()||(c=c.getBoundingRectangle(),c.top<b.top&&(b.top=\nc.top),c.bottom>b.bottom&&(b.bottom=c.bottom),c.left<b.left&&(b.left=c.left),c.right>b.right&&(b.right=c.right))}return b}cleanUp(){this.setResizesEnabled(!1);setGroup$$module$build$src$core$events$utils(!0);const a=this.getTopBlocks(!0);let b=0;for(let c=0,d;d=a[c];c++){if(!d.isMovable())continue;const e=d.getRelativeToSurfaceXY();d.moveBy(-e.x,b-e.y);d.snapToGrid();b=d.getRelativeToSurfaceXY().y+d.getHeightWidth().height+this.renderer.getConstants().MIN_BLOCK_HEIGHT}setGroup$$module$build$src$core$events$utils(!1);\nthis.setResizesEnabled(!0)}showContextMenu(a){if(!this.options.readOnly&&!this.isFlyout){var b=ContextMenuRegistry$$module$build$src$core$contextmenu_registry.registry.getContextMenuOptions(ContextMenuRegistry$$module$build$src$core$contextmenu_registry.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(b,a);show$$module$build$src$core$contextmenu(a,b,this.RTL)}}updateToolbox(a){if(a=convertToolboxDefToJson$$module$build$src$core$utils$toolbox(a)){if(!this.options.languageTree)throw Error(\"Existing toolbox is null.  Can't create new toolbox.\");\nif(hasCategories$$module$build$src$core$utils$toolbox(a)){if(!this.toolbox_)throw Error(\"Existing toolbox has no categories.  Can't change mode.\");this.options.languageTree=a;this.toolbox_.render(a)}else{if(!this.flyout)throw Error(\"Existing toolbox has categories.  Can't change mode.\");this.options.languageTree=a;this.flyout.show(a)}}else if(this.options.languageTree)throw Error(\"Can't nullify an existing toolbox.\");}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():\n(setMainWorkspace$$module$build$src$core$common(this),this.setBrowserFocus())}setBrowserFocus(){document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur();try{this.getParentSvg().focus({preventScroll:!0})}catch(a){try{this.getParentSvg().parentElement.setActive()}catch(b){this.getParentSvg().parentElement.focus({preventScroll:!0})}}}zoom(a,b,c){c=Math.pow(this.options.zoomOptions.scaleSpeed,c);const d=this.scale*c;if(this.scale!==d){d>this.options.zoomOptions.maxScale?\nc=this.options.zoomOptions.maxScale/this.scale:d<this.options.zoomOptions.minScale&&(c=this.options.zoomOptions.minScale/this.scale);var e=this.getCanvas().getCTM(),f=this.getParentSvg().createSVGPoint();f.x=a;f.y=b;f=f.matrixTransform(e.inverse());a=f.x;b=f.y;e=e.translate(a*(1-c),b*(1-c)).scale(c);this.scrollX=e.e;this.scrollY=e.f;this.setScale(d)}}zoomCenter(a){var b=this.getMetrics();let c;this.flyout?(c=b.svgWidth?b.svgWidth/2:0,b=b.svgHeight?b.svgHeight/2:0):(c=b.viewWidth/2+b.absoluteLeft,\nb=b.viewHeight/2+b.absoluteTop);this.zoom(c,b,a)}zoomToFit(){if(this.isMovable()){var a=this.getMetrics(),b=a.viewWidth;a=a.viewHeight;var c=this.getBlocksBoundingBox(),d=2*ZOOM_TO_FIT_MARGIN$$module$build$src$core$workspace_svg,e=c.right-c.left+d;c=c.bottom-c.top+d;if(e){this.flyout&&(this.horizontalLayout?(a+=this.flyout.getHeight(),c+=this.flyout.getHeight()/this.scale):(b+=this.flyout.getWidth(),e+=this.flyout.getWidth()/this.scale));b/=e;a/=c;disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(b,\na)),this.scrollCenter()}finally{enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn(\"Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.\")}beginCanvasTransition(){addClass$$module$build$src$core$utils$dom(this.svgBlockCanvas_,\"blocklyCanvasTransitioning\");addClass$$module$build$src$core$utils$dom(this.svgBubbleCanvas_,\"blocklyCanvasTransitioning\")}endCanvasTransition(){removeClass$$module$build$src$core$utils$dom(this.svgBlockCanvas_,\n\"blocklyCanvasTransitioning\");removeClass$$module$build$src$core$utils$dom(this.svgBubbleCanvas_,\"blocklyCanvasTransitioning\")}scrollCenter(){if(this.isMovable()){var a=this.getMetrics(),b=(a.scrollWidth-a.viewWidth)/2,c=(a.scrollHeight-a.viewHeight)/2;b=-b-a.scrollLeft;c=-c-a.scrollTop;this.scroll(b,c)}else console.warn(\"Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.\")}centerOnBlock(a){if(this.isMovable()){if(a=a?this.getBlockById(a):null){var b=a.getRelativeToSurfaceXY(),\nc=a.getHeightWidth(),d=this.scale;a=(b.x+(this.RTL?-1:1)*c.width/2)*d;b=(b.y+c.height/2)*d;c=this.getMetrics();this.scroll(-(a-c.viewWidth/2),-(b-c.viewHeight/2))}}else console.warn(\"Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.\")}setScale(a){this.options.zoomOptions.maxScale&&a>this.options.zoomOptions.maxScale?a=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&a<this.options.zoomOptions.minScale&&(a=this.options.zoomOptions.minScale);\nthis.scale=a;this.hideChaff(!1);(a=this.getFlyout(!1))&&a.isVisible()&&(a.reflow(),this.recordDragTargets());this.grid&&this.grid.update(this.scale);a=this.getMetrics();this.scrollX-=a.absoluteLeft;this.scrollY-=a.absoluteTop;a.viewLeft+=a.absoluteLeft;a.viewTop+=a.absoluteTop;this.scroll(this.scrollX,this.scrollY);this.scrollbar&&(this.flyout?this.scrollbar.resizeView(a):this.scrollbar.resizeContent(a))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(a,\nb){this.hideChaff(!0);const c=this.getMetrics();a=Math.min(a,-c.scrollLeft);b=Math.min(b,-c.scrollTop);const d=c.scrollTop+Math.max(0,c.scrollHeight-c.viewHeight);a=Math.max(a,-(c.scrollLeft+Math.max(0,c.scrollWidth-c.viewWidth)));b=Math.max(b,-d);this.scrollX=a;this.scrollY=b;this.scrollbar&&this.scrollbar.set(-(a+c.scrollLeft),-(b+c.scrollTop),!1);a+=c.absoluteLeft;b+=c.absoluteTop;this.translate(a,b)}getBlockById(a){return super.getBlockById(a)}getAllBlocks(a){return super.getAllBlocks(a)}getTopBlocks(a){return super.getTopBlocks(a)}addTopBlock(a){this.addTopBoundedElement(a);\nsuper.addTopBlock(a)}removeTopBlock(a){this.removeTopBoundedElement(a);super.removeTopBlock(a)}addTopComment(a){this.addTopBoundedElement(a);super.addTopComment(a)}removeTopComment(a){this.removeTopBoundedElement(a);super.removeTopComment(a)}addTopBoundedElement(a){this.topBoundedElements.push(a)}removeTopBoundedElement(a){removeElem$$module$build$src$core$utils$array(this.topBoundedElements,a)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(a){const b=!this.resizesEnabled&&\na;this.resizesEnabled=a;b&&this.resizeContents()}clear(){this.setResizesEnabled(!1);super.clear();this.topBoundedElements=[];this.setResizesEnabled(!0)}registerButtonCallback(a,b){if(\"function\"!==typeof b)throw TypeError(\"Button callbacks must be functions.\");this.flyoutButtonCallbacks.set(a,b)}getButtonCallback(a){let b;return null!=(b=this.flyoutButtonCallbacks.get(a))?b:null}removeButtonCallback(a){this.flyoutButtonCallbacks.delete(a)}registerToolboxCategoryCallback(a,b){if(\"function\"!==typeof b)throw TypeError(\"Toolbox category callbacks must be functions.\");\nthis.toolboxCategoryCallbacks.set(a,b)}getToolboxCategoryCallback(a){return this.toolboxCategoryCallbacks.get(a)||null}removeToolboxCategoryCallback(a){this.toolboxCategoryCallbacks.delete(a)}getGesture(a){const b=\"pointerdown\"===a.type,c=this.currentGesture_;return c?b&&c.hasStarted()?(console.warn(\"Tried to start the same gesture twice.\"),c.cancel(),null):c:b?this.currentGesture_=new Gesture$$module$build$src$core$gesture(a,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&\nthis.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(a){hide$$module$build$src$core$tooltip();hide$$module$build$src$core$widgetdiv();hideWithoutAnimation$$module$build$src$core$dropdowndiv();const b=!!a;this.getComponentManager().getComponents(ComponentManager$$module$build$src$core$component_manager.Capability.AUTOHIDEABLE,!0).forEach(c=>c.autoHide(b))}static setTopLevelWorkspaceMetrics_(a){const b=this.getMetrics();\"number\"===typeof a.x&&\n(this.scrollX=-(b.scrollLeft+(b.scrollWidth-b.viewWidth)*a.x));\"number\"===typeof a.y&&(this.scrollY=-(b.scrollTop+(b.scrollHeight-b.viewHeight)*a.y));this.translate(this.scrollX+b.absoluteLeft,this.scrollY+b.absoluteTop)}},module$build$src$core$workspace_svg={};module$build$src$core$workspace_svg.WorkspaceSvg=WorkspaceSvg$$module$build$src$core$workspace_svg;module$build$src$core$workspace_svg.resizeSvgContents=resizeSvgContents$$module$build$src$core$workspace_svg;var module$build$src$core$serialization$workspaces={};module$build$src$core$serialization$workspaces.load=load$$module$build$src$core$serialization$workspaces;module$build$src$core$serialization$workspaces.save=save$$module$build$src$core$serialization$workspaces;var VariableSerializer$$module$build$src$core$serialization$variables=class{constructor(){this.priority=VARIABLES$$module$build$src$core$serialization$priorities}save(a){const b=[];for(const c of a.getAllVariables())a={name:c.name,id:c.getId()},c.type&&(a.type=c.type),b.push(a);return b.length?b:null}load(a,b){for(const c of a)b.createVariable(c.name,c.type,c.id)}clear(a){a.getVariableMap().clear()}};register$$module$build$src$core$serialization$registry(\"variables\",new VariableSerializer$$module$build$src$core$serialization$variables);\nvar module$build$src$core$serialization$variables={};module$build$src$core$serialization$variables.VariableSerializer=VariableSerializer$$module$build$src$core$serialization$variables;var ProcedureSerializer$$module$build$src$core$serialization$procedures=class{constructor(a,b){this.procedureModelClass=a;this.parameterModelClass=b;this.priority=PROCEDURES$$module$build$src$core$serialization$priorities}save(a){return a.getProcedureMap().getProcedures().map(b=>saveProcedure$$module$build$src$core$serialization$procedures(b))}load(a,b){const c=b.getProcedureMap();for(const d of a)c.add(loadProcedure$$module$build$src$core$serialization$procedures(this.procedureModelClass,this.parameterModelClass,\nd,b))}clear(a){a.getProcedureMap().clear()}},observableProcedureSerializer$$module$build$src$core$serialization$procedures=new ProcedureSerializer$$module$build$src$core$serialization$procedures(ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model,ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model),module$build$src$core$serialization$procedures={};module$build$src$core$serialization$procedures.ProcedureSerializer=ProcedureSerializer$$module$build$src$core$serialization$procedures;\nmodule$build$src$core$serialization$procedures.loadParameter=loadParameter$$module$build$src$core$serialization$procedures;module$build$src$core$serialization$procedures.loadProcedure=loadProcedure$$module$build$src$core$serialization$procedures;module$build$src$core$serialization$procedures.observableProcedureSerializer=observableProcedureSerializer$$module$build$src$core$serialization$procedures;module$build$src$core$serialization$procedures.saveParameter=saveParameter$$module$build$src$core$serialization$procedures;\nmodule$build$src$core$serialization$procedures.saveProcedure=saveProcedure$$module$build$src$core$serialization$procedures;var module$build$src$core$serialization={blocks:module$build$src$core$serialization$blocks,exceptions:module$build$src$core$serialization$exceptions,priorities:module$build$src$core$serialization$priorities,procedures:module$build$src$core$serialization$procedures,registry:module$build$src$core$serialization$registry,variables:module$build$src$core$serialization$variables,workspaces:module$build$src$core$serialization$workspaces};var ConstantProvider$$module$build$src$core$renderers$zelos$constants=class extends ConstantProvider$$module$build$src$core$renderers$common$constants{constructor(){super();this.GRID_UNIT=4;this.CURSOR_COLOUR=\"#ffa200\";this.CURSOR_RADIUS=5;this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0;this.START_HAT_HEIGHT=22;this.START_HAT_WIDTH=96;this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5};this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},\n2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}};this.FULL_BLOCK_FIELDS=!0;this.FIELD_TEXT_FONTWEIGHT=\"bold\";this.FIELD_TEXT_FONTFAMILY='\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0;this.SELECTED_GLOW_COLOUR=\"#fff200\";\nthis.SELECTED_GLOW_SIZE=.5;this.REPLACEMENT_GLOW_COLOUR=\"#fff200\";this.REPLACEMENT_GLOW_SIZE=2;this.selectedGlowFilterId=\"\";this.selectedGlowFilter_=null;this.replacementGlowFilterId=\"\";this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter_=null;this.SMALL_PADDING=this.GRID_UNIT;this.MEDIUM_PADDING=2*this.GRID_UNIT;this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT;this.LARGE_PADDING=4*this.GRID_UNIT;this.CORNER_RADIUS=1*this.GRID_UNIT;this.NOTCH_WIDTH=9*this.GRID_UNIT;this.NOTCH_HEIGHT=2*this.GRID_UNIT;\nthis.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT;this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT;this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT;this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT;this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS;this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING;this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS;this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT;this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT;this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*\nthis.GRID_UNIT;this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT;this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT;this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT;this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT;this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT;this.CURSOR_WS_WIDTH=20*this.GRID_UNIT;this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT;this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS;this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT;this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT;this.FIELD_BORDER_RECT_HEIGHT=\n8*this.GRID_UNIT;this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT;this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING;this.FIELD_COLOUR_DEFAULT_WIDTH=2*this.GRID_UNIT;this.FIELD_COLOUR_DEFAULT_HEIGHT=4*this.GRID_UNIT;this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT;this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(a){super.setFontConstants_(a);this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init();\nthis.HEXAGONAL=this.makeHexagonal();this.ROUNDED=this.makeRounded();this.SQUARED=this.makeSquared();this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(a){super.setDynamicProperties_(a);this.SELECTED_GLOW_COLOUR=a.getComponentStyle(\"selectedGlowColour\")||this.SELECTED_GLOW_COLOUR;const b=Number(a.getComponentStyle(\"selectedGlowSize\"));this.SELECTED_GLOW_SIZE=b&&!isNaN(b)?b:this.SELECTED_GLOW_SIZE;this.REPLACEMENT_GLOW_COLOUR=a.getComponentStyle(\"replacementGlowColour\")||\nthis.REPLACEMENT_GLOW_COLOUR;this.REPLACEMENT_GLOW_SIZE=(a=Number(a.getComponentStyle(\"replacementGlowSize\")))&&!isNaN(a)?a:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose();this.selectedGlowFilter_&&removeNode$$module$build$src$core$utils$dom(this.selectedGlowFilter_);this.replacementGlowFilter_&&removeNode$$module$build$src$core$utils$dom(this.replacementGlowFilter_)}makeStartHat(){const a=this.START_HAT_HEIGHT,b=this.START_HAT_WIDTH,c=curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(25,\n-a),point$$module$build$src$core$utils$svg_paths(71,-a),point$$module$build$src$core$utils$svg_paths(b,0)]);return{height:a,width:b,path:c}}makeHexagonal(){function a(c,d,e){var f=c/2;f=f>b?b:f;e=e?-1:1;c=(d?-1:1)*c/2;return lineTo$$module$build$src$core$utils$svg_paths(-e*f,c)+lineTo$$module$build$src$core$utils$svg_paths(e*f,c)}const b=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width(c){c/=2;return c>b?b:c},height(c){return c},connectionOffsetY(c){return c/\n2},connectionOffsetX(c){return-c},pathDown(c){return a(c,!1,!1)},pathUp(c){return a(c,!0,!1)},pathRightDown(c){return a(c,!1,!0)},pathRightUp(c){return a(c,!1,!0)}}}makeRounded(){function a(d,e,f){const g=d>c?d-c:0;d=(d>c?c:d)/2;return arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",d,point$$module$build$src$core$utils$svg_paths((e?-1:1)*d,(e?-1:1)*d))+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",(f?1:-1)*g)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",d,point$$module$build$src$core$utils$svg_paths((e?\n1:-1)*d,(e?-1:1)*d))}const b=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,c=2*b;return{type:this.SHAPES.ROUND,isDynamic:!0,width(d){d/=2;return d>b?b:d},height(d){return d},connectionOffsetY(d){return d/2},connectionOffsetX(d){return-d},pathDown(d){return a(d,!1,!1)},pathUp(d){return a(d,!0,!1)},pathRightDown(d){return a(d,!1,!0)},pathRightUp(d){return a(d,!1,!0)}}}makeSquared(){function a(c,d,e){c-=2*b;return arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",b,point$$module$build$src$core$utils$svg_paths((d?\n-1:1)*b,(d?-1:1)*b))+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",(e?1:-1)*c)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",b,point$$module$build$src$core$utils$svg_paths((d?1:-1)*b,(d?-1:1)*b))}const b=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width(c){return b},height(c){return c},connectionOffsetY(c){return c/2},connectionOffsetX(c){return-c},pathDown(c){return a(c,!1,!1)},pathUp(c){return a(c,!0,!1)},pathRightDown(c){return a(c,!1,!0)},pathRightUp(c){return a(c,\n!1,!0)}}}shapeFor(a){let b=a.getCheck();!b&&a.targetConnection&&(b=a.targetConnection.getCheck());switch(a.type){case ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE:case ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE:a=a.getSourceBlock().getOutputShape();if(null!==a)switch(a){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}if(b&&-1!==b.indexOf(\"Boolean\"))return this.HEXAGONAL;\nif(b&&-1!==b.indexOf(\"Number\"))return this.ROUNDED;b&&b.indexOf(\"String\");return this.ROUNDED;case ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT:case ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT:return this.NOTCH;default:throw Error(\"Unknown type\");}}makeNotch(){function a(l){return curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(l*e/2,0),point$$module$build$src$core$utils$svg_paths(l*e*3/4,g/2),point$$module$build$src$core$utils$svg_paths(l*\ne,g)])+line$$module$build$src$core$utils$svg_paths([point$$module$build$src$core$utils$svg_paths(l*e,f)])+curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(l*e/4,g/2),point$$module$build$src$core$utils$svg_paths(l*e/2,g),point$$module$build$src$core$utils$svg_paths(l*e,g)])+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",l*d)+curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(l*e/2,0),point$$module$build$src$core$utils$svg_paths(l*\ne*3/4,-(g/2)),point$$module$build$src$core$utils$svg_paths(l*e,-g)])+line$$module$build$src$core$utils$svg_paths([point$$module$build$src$core$utils$svg_paths(l*e,-f)])+curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(l*e/4,-(g/2)),point$$module$build$src$core$utils$svg_paths(l*e/2,-g),point$$module$build$src$core$utils$svg_paths(l*e,-g)])}const b=this.NOTCH_WIDTH,c=this.NOTCH_HEIGHT,d=b/3,e=d/3,f=c/2,g=f/2,h=a(1),k=a(-1);return{type:this.SHAPES.NOTCH,\nwidth:b,height:c,pathLeft:h,pathRight:k}}makeInsideCorners(){const a=this.CORNER_RADIUS,b=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a,point$$module$build$src$core$utils$svg_paths(-a,a)),c=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a,point$$module$build$src$core$utils$svg_paths(-a,a)),d=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a,point$$module$build$src$core$utils$svg_paths(a,a)),e=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a,point$$module$build$src$core$utils$svg_paths(a,\na));return{width:a,height:a,pathTop:b,pathBottom:d,rightWidth:a,rightHeight:a,pathTopRight:c,pathBottomRight:e}}generateSecondaryColour_(a){return blend$$module$build$src$core$utils$colour(\"#000\",a,.15)||a}generateTertiaryColour_(a){return blend$$module$build$src$core$utils$colour(\"#000\",a,.25)||a}createDom(a,b,c){super.createDom(a,b,c);a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.DEFS,{},a);b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FILTER,\n{id:\"blocklySelectedGlowFilter\"+this.randomIdentifier,height:\"160%\",width:\"180%\",y:\"-30%\",x:\"-40%\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEGAUSSIANBLUR,{\"in\":\"SourceGraphic\",stdDeviation:this.SELECTED_GLOW_SIZE},b);c=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPONENTTRANSFER,{result:\"outBlur\"},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEFUNCA,{type:\"table\",\ntableValues:\"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\"},c);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEFLOOD,{\"flood-color\":this.SELECTED_GLOW_COLOUR,\"flood-opacity\":1,result:\"outColor\"},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPOSITE,{\"in\":\"outColor\",in2:\"outBlur\",operator:\"in\",result:\"outGlow\"},b);this.selectedGlowFilterId=b.id;this.selectedGlowFilter_=b;a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FILTER,\n{id:\"blocklyReplacementGlowFilter\"+this.randomIdentifier,height:\"160%\",width:\"180%\",y:\"-30%\",x:\"-40%\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEGAUSSIANBLUR,{\"in\":\"SourceGraphic\",stdDeviation:this.REPLACEMENT_GLOW_SIZE},a);b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPONENTTRANSFER,{result:\"outBlur\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEFUNCA,{type:\"table\",\ntableValues:\"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1\"},b);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FEFLOOD,{\"flood-color\":this.REPLACEMENT_GLOW_COLOUR,\"flood-opacity\":1,result:\"outColor\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPOSITE,{\"in\":\"outColor\",in2:\"outBlur\",operator:\"in\",result:\"outGlow\"},a);createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.FECOMPOSITE,{\"in\":\"SourceGraphic\",\nin2:\"outGlow\",operator:\"over\"},a);this.replacementGlowFilterId=a.id;this.replacementGlowFilter_=a}getCSS_(a){return[`${a} .blocklyText,`,`${a} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}`+`pt ${this.FIELD_TEXT_FONTFAMILY};`,\"}\",`${a} .blocklyText {`,\"fill: #fff;\",\"}\",`${a} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${a} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\"}\",`${a} .blocklyNonEditableText>text,`,\n`${a} .blocklyEditableText>text,`,`${a} .blocklyNonEditableText>g>text,`,`${a} .blocklyEditableText>g>text {`,\"fill: #575E75;\",\"}\",`${a} .blocklyFlyoutLabelText {`,\"fill: #575E75;\",\"}\",`${a} .blocklyText.blocklyBubbleText {`,\"fill: #575E75;\",\"}\",`${a} .blocklyDraggable:not(.blocklyDisabled)`,\" .blocklyEditableText:not(.editing):hover>rect,\",`${a} .blocklyDraggable:not(.blocklyDisabled)`,\" .blocklyEditableText:not(.editing):hover>.blocklyPath {\",\"stroke: #fff;\",\"stroke-width: 2;\",\"}\",`${a} .blocklyHtmlInput {`,\n`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\"color: #575E75;\",\"}\",`${a} .blocklyDropdownText {`,\"fill: #fff !important;\",\"}\",`${a}.blocklyWidgetDiv .goog-menuitem,`,`${a}.blocklyDropDownDiv .goog-menuitem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\"}\",`${a}.blocklyDropDownDiv .goog-menuitem-content {`,\"color: #fff;\",\"}\",`${a} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,\"}\",`${a} .blocklyDisabled > .blocklyOutlinePath {`,\n`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\"}\",`${a} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\"stroke: none;\",\"}\"]}},module$build$src$core$renderers$zelos$constants={};module$build$src$core$renderers$zelos$constants.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$zelos$constants;var Drawer$$module$build$src$core$renderers$zelos$drawer=class extends Drawer$$module$build$src$core$renderers$common$drawer{constructor(a,b){super(a,b)}draw(){const a=this.block_.pathObject;a.beginDrawing();this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();a.setPath(this.outlinePath_+\"\\n\"+this.inlinePath_);this.info_.RTL&&a.flipRTL();if(isDebuggerEnabled$$module$build$src$core$renderers$common$debug()){let b,c;null==(b=this.block_)||null==(c=b.renderingDebugger)||c.drawDebug(this.block_,\nthis.info_)}this.recordSizeOnBlock_();this.info_.outputConnection&&(a.outputShapeType=this.info_.outputConnection.shape.type);a.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?\nthis.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(a){if(!(0>=a.height))if(Types$$module$build$src$core$renderers$measurables$types.isSpacer(a)&&(a.precedesStatement||a.followsStatement)){var b=this.constants_.INSIDE_CORNERS.rightHeight;b=a.height-(a.precedesStatement?b:0);this.outlinePath_+=(a.followsStatement?this.constants_.INSIDE_CORNERS.pathBottomRight:\"\")+(0<b?lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.yPos+b):\"\")+(a.precedesStatement?this.constants_.INSIDE_CORNERS.pathTopRight:\n\"\")}else this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.yPos+a.height)}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error(\"Cannot draw the output connection of a block that doesn't have one\");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error(\"Cannot draw the output connection of a block that doesn't have one\");this.positionOutputConnection_();\nthis.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height);this.outlinePath_+=\"z\"}drawFlatTop_(){const a=this.info_.topRow;this.positionPreviousConnection_();this.outlinePath_+=moveBy$$module$build$src$core$utils$svg_paths(a.xPos,this.info_.startY);this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",a.width)}drawFlatBottom_(){const a=this.info_.bottomRow;this.positionNextConnection_();this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",\na.baseline);this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",-a.width)}drawInlineInput_(a){this.positionInlineInputConnection_(a);const b=a.input.name;if(!a.connectedBlock&&!this.info_.isInsertionMarker){var c=a.width-2*a.connectionWidth;a=moveTo$$module$build$src$core$utils$svg_paths(a.xPos+a.connectionWidth,a.centerline-a.height/2)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",c)+a.shape.pathRightDown(a.height)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",\n-c)+a.shape.pathUp(a.height)+\"z\";this.block_.pathObject.setOutlinePath(b,a)}}drawStatementInput_(a){var b=a.getLastInput();const c=b.xPos+b.notchOffset+b.shape.width,d=b.shape.pathRight+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",-(b.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop,e=a.height-2*this.constants_.INSIDE_CORNERS.height;b=this.constants_.INSIDE_CORNERS.pathBottom+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",b.notchOffset-this.constants_.INSIDE_CORNERS.width)+\n(b.connectedBottomNextConnection?\"\":b.shape.pathLeft);this.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",c)+d+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",e)+b+lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a.xPos+a.width);this.positionStatementInputConnection_(a)}},module$build$src$core$renderers$zelos$drawer={};module$build$src$core$renderers$zelos$drawer.Drawer=Drawer$$module$build$src$core$renderers$zelos$drawer;$.FieldImage$$module$build$src$core$field_image=class extends Field$$module$build$src$core$field{constructor(a,b,c,d,e,f,g){super(Field$$module$build$src$core$field.SKIP_SETUP);this.imageElement_=this.clickHandler_=null;this.flipRtl_=this.isDirty_=this.EDITABLE=!1;this.altText_=\"\";c=Number(replaceMessageReferences$$module$build$src$core$utils$parsing(c));b=Number(replaceMessageReferences$$module$build$src$core$utils$parsing(b));if(isNaN(c)||isNaN(b))throw Error(\"Height and width values of an image field must cast to numbers.\");\nif(0>=c||0>=b)throw Error(\"Height and width values of an image field must be greater than 0.\");this.size_=new Size$$module$build$src$core$utils$size(b,c+$.FieldImage$$module$build$src$core$field_image.Y_PADDING);this.imageHeight_=c;\"function\"===typeof e&&(this.clickHandler_=e);a!==Field$$module$build$src$core$field.SKIP_SETUP&&(g?this.configure_(g):(this.flipRtl_=!!f,this.altText_=replaceMessageReferences$$module$build$src$core$utils$parsing(d)||\"\"),this.setValue(replaceMessageReferences$$module$build$src$core$utils$parsing(a)))}configure_(a){super.configure_(a);\na.flipRtl&&(this.flipRtl_=a.flipRtl);a.alt&&(this.altText_=replaceMessageReferences$$module$build$src$core$utils$parsing(a.alt))}initView(){this.imageElement_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.IMAGE,{height:this.imageHeight_+\"px\",width:this.size_.width+\"px\",alt:this.altText_},this.fieldGroup_);this.imageElement_.setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",this.value_);this.clickHandler_&&(this.imageElement_.style.cursor=\n\"pointer\")}updateSize_(){}doClassValidation_(a){return\"string\"!==typeof a?null:a}doValueUpdate_(a){this.value_=a;this.imageElement_&&this.imageElement_.setAttributeNS(XLINK_NS$$module$build$src$core$utils$dom,\"xlink:href\",String(this.value_))}getFlipRtl(){return this.flipRtl_}setAlt(a){a!==this.altText_&&(this.altText_=a||\"\",this.imageElement_&&this.imageElement_.setAttribute(\"alt\",this.altText_))}showEditor_(){this.clickHandler_&&this.clickHandler_(this)}setOnClickHandler(a){this.clickHandler_=a}getText_(){return this.altText_}static fromJson(a){if(!a.src||\n!a.width||!a.height)throw Error(\"src, width, and height values for an image field arerequired. The width and height must be non-zero.\");return new this(a.src,a.width,a.height,void 0,void 0,void 0,a)}};$.FieldImage$$module$build$src$core$field_image.Y_PADDING=1;register$$module$build$src$core$field_registry(\"field_image\",$.FieldImage$$module$build$src$core$field_image);$.FieldImage$$module$build$src$core$field_image.prototype.DEFAULT_VALUE=\"\";var module$build$src$core$field_image={};\nmodule$build$src$core$field_image.FieldImage=$.FieldImage$$module$build$src$core$field_image;var FieldInput$$module$build$src$core$field_input=class extends Field$$module$build$src$core$field{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.spellcheck_=!0;this.htmlInput_=null;this.isTextValid_=this.isBeingEdited_=!1;this.onKeyInputWrapper_=this.onKeyDownWrapper_=null;this.fullBlockClickTarget_=!1;this.workspace_=null;this.SERIALIZABLE=!0;this.CURSOR=\"text\";a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(a),b&&this.setValidator(b))}configure_(a){super.configure_(a);\nvoid 0!==a.spellcheck&&(this.spellcheck_=a.spellcheck)}initView(){const a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;if(this.getConstants().FULL_BLOCK_FIELDS){let b=0,c=0;for(let d=0,e;e=a.inputList[d];d++){for(let f=0;e.fieldRow[f];f++)b++;e.connection&&c++}this.fullBlockClickTarget_=1>=b&&a.outputConnection&&!c}else this.fullBlockClickTarget_=!1;this.fullBlockClickTarget_?this.clickTarget_=this.sourceBlock_.getSvgRoot():this.createBorderRect_();this.createTextElement_()}doClassValidation_(a){return null===\na||void 0===a?null:String(a)}doValueInvalid_(a){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,a=this.value_,this.value_=this.htmlInput_.getAttribute(\"data-untyped-default-value\"),this.sourceBlock_&&isEnabled$$module$build$src$core$events$utils()&&fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,\"field\",this.name||null,a,this.value_)))}doValueUpdate_(a){this.isTextValid_=this.isDirty_=\n!0;this.value_=a}applyColour(){if(this.sourceBlock_&&this.getConstants().FULL_BLOCK_FIELDS){var a=this.sourceBlock_;this.borderRect_?this.borderRect_.setAttribute(\"stroke\",a.style.colourTertiary):a.pathObject.svgPath.setAttribute(\"fill\",this.getConstants().FIELD_BORDER_RECT_COLOUR)}}render_(){super.render_();if(this.isBeingEdited_){this.resizeEditor_();const a=this.htmlInput_;this.isTextValid_?(removeClass$$module$build$src$core$utils$dom(a,\"blocklyInvalidInput\"),setState$$module$build$src$core$utils$aria(a,\nState$$module$build$src$core$utils$aria.INVALID,!1)):(addClass$$module$build$src$core$utils$dom(a,\"blocklyInvalidInput\"),setState$$module$build$src$core$utils$aria(a,State$$module$build$src$core$utils$aria.INVALID,!0))}}setSpellcheck(a){a!==this.spellcheck_&&(this.spellcheck_=a,this.htmlInput_&&this.htmlInput_.setAttribute(\"spellcheck\",this.spellcheck_))}showEditor_(a,b){this.workspace_=this.sourceBlock_.workspace;a=b||!1;!a&&this.workspace_.options.modalInputs&&(MOBILE$$module$build$src$core$utils$useragent||\nANDROID$$module$build$src$core$utils$useragent||IPAD$$module$build$src$core$utils$useragent)?this.showPromptEditor_():this.showInlineEditor_(a)}showPromptEditor_(){prompt$$module$build$src$core$dialog(Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),a=>{null!==a&&this.setValue(this.getValueFromEditorText_(a))})}showInlineEditor_(a){const b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;show$$module$build$src$core$widgetdiv(this,b.RTL,this.widgetDispose_.bind(this));\nthis.htmlInput_=this.widgetCreate_();this.isBeingEdited_=!0;a||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;setGroup$$module$build$src$core$events$utils(!0);const b=getDiv$$module$build$src$core$widgetdiv();var c=this.getClickTarget_();if(!c)throw Error(\"A click target has not been set.\");addClass$$module$build$src$core$utils$dom(c,\"editing\");c=document.createElement(\"input\");\nc.className=\"blocklyHtmlInput\";c.setAttribute(\"spellcheck\",this.spellcheck_);const d=this.workspace_.getScale();var e=this.getConstants().FIELD_TEXT_FONTSIZE*d+\"pt\";b.style.fontSize=e;c.style.fontSize=e;e=FieldInput$$module$build$src$core$field_input.BORDERRADIUS*d+\"px\";this.fullBlockClickTarget_&&(e=this.getScaledBBox(),e=(e.bottom-e.top)/2+\"px\",a=a.getParent()?a.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,c.style.border=1*d+\"px solid \"+a,b.style.borderRadius=e,b.style.transition=\n\"box-shadow 0.25s ease 0s\",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(b.style.boxShadow=\"rgba(255, 255, 255, 0.3) 0 0 0 \"+4*d+\"px\"));c.style.borderRadius=e;b.appendChild(c);c.value=c.defaultValue=this.getEditorText_(this.value_);c.setAttribute(\"data-untyped-default-value\",this.value_);this.resizeEditor_();this.bindInputEvents_(c);return c}widgetDispose_(){this.isBeingEdited_=!1;this.isTextValid_=!0;this.forceRerender();this.onFinishEditing_(this.value_);setGroup$$module$build$src$core$events$utils(!1);\nthis.unbindInputEvents_();var a=getDiv$$module$build$src$core$widgetdiv().style;a.width=\"auto\";a.height=\"auto\";a.fontSize=\"\";a.transition=\"\";a.boxShadow=\"\";this.htmlInput_=null;a=this.getClickTarget_();if(!a)throw Error(\"A click target has not been set.\");removeClass$$module$build$src$core$utils$dom(a,\"editing\")}onFinishEditing_(a){}bindInputEvents_(a){this.onKeyDownWrapper_=conditionalBind$$module$build$src$core$browser_events(a,\"keydown\",this,this.onHtmlInputKeyDown_);this.onKeyInputWrapper_=conditionalBind$$module$build$src$core$browser_events(a,\n\"input\",this,this.onHtmlInputChange_)}unbindInputEvents_(){this.onKeyDownWrapper_&&(unbind$$module$build$src$core$browser_events(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null);this.onKeyInputWrapper_&&(unbind$$module$build$src$core$browser_events(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)}onHtmlInputKeyDown_(a){a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.ENTER?(hide$$module$build$src$core$widgetdiv(),hideWithoutAnimation$$module$build$src$core$dropdowndiv()):a.keyCode===\nKeyCodes$$module$build$src$core$utils$keycodes.ESC?(this.setValue(this.htmlInput_.getAttribute(\"data-untyped-default-value\")),hide$$module$build$src$core$widgetdiv(),hideWithoutAnimation$$module$build$src$core$dropdowndiv()):a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.TAB&&(hide$$module$build$src$core$widgetdiv(),hideWithoutAnimation$$module$build$src$core$dropdowndiv(),this.sourceBlock_.tab(this,!a.shiftKey),a.preventDefault())}onHtmlInputChange_(a){this.setValue(this.getValueFromEditorText_(this.htmlInput_.value))}setEditorValue_(a){this.isDirty_=\n!0;this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(a));this.setValue(a)}resizeEditor_(){var a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;const b=getDiv$$module$build$src$core$widgetdiv(),c=this.getScaledBBox();b.style.width=c.right-c.left+\"px\";b.style.height=c.bottom-c.top+\"px\";a=new Coordinate$$module$build$src$core$utils$coordinate(a.RTL?c.right-b.offsetWidth:c.left,c.top);b.style.left=a.x+\"px\";b.style.top=a.y+\"px\"}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&\nthis.htmlInput_?this.htmlInput_.value:null}getEditorText_(a){return String(a)}getValueFromEditorText_(a){return a}};FieldInput$$module$build$src$core$field_input.BORDERRADIUS=4;var module$build$src$core$field_input={};module$build$src$core$field_input.FieldInput=FieldInput$$module$build$src$core$field_input;$.FieldTextInput$$module$build$src$core$field_textinput=class extends FieldInput$$module$build$src$core$field_input{constructor(a,b,c){super(a,b,c)}static fromJson(a){return new this(replaceMessageReferences$$module$build$src$core$utils$parsing(a.text),void 0,a)}};register$$module$build$src$core$field_registry(\"field_input\",$.FieldTextInput$$module$build$src$core$field_textinput);$.FieldTextInput$$module$build$src$core$field_textinput.prototype.DEFAULT_VALUE=\"\";\nvar module$build$src$core$field_textinput={};module$build$src$core$field_textinput.FieldTextInput=$.FieldTextInput$$module$build$src$core$field_textinput;var BottomRow$$module$build$src$core$renderers$zelos$measurables$bottom_row=class extends BottomRow$$module$build$src$core$renderers$measurables$bottom_row{constructor(a){super(a)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(a){return!!a.outputConnection}hasRightSquareCorner(a){return!!a.outputConnection&&!a.statementInputCount&&!a.nextConnection}},module$build$src$core$renderers$zelos$measurables$bottom_row={};module$build$src$core$renderers$zelos$measurables$bottom_row.BottomRow=BottomRow$$module$build$src$core$renderers$zelos$measurables$bottom_row;var StatementInput$$module$build$src$core$renderers$zelos$measurables$inputs=class extends StatementInput$$module$build$src$core$renderers$measurables$statement_input{constructor(a,b){super(a,b);this.connectedBottomNextConnection=!1;if(this.connectedBlock){for(a=this.connectedBlock;b=a.getNextBlock();)a=b;a.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},module$build$src$core$renderers$zelos$measurables$inputs={};\nmodule$build$src$core$renderers$zelos$measurables$inputs.StatementInput=StatementInput$$module$build$src$core$renderers$zelos$measurables$inputs;var RightConnectionShape$$module$build$src$core$renderers$zelos$measurables$row_elements=class extends Measurable$$module$build$src$core$renderers$measurables$base{constructor(a){super(a);this.width=this.height=0;this.type|=Types$$module$build$src$core$renderers$measurables$types.getType(\"RIGHT_CONNECTION\")}},module$build$src$core$renderers$zelos$measurables$row_elements={};module$build$src$core$renderers$zelos$measurables$row_elements.RightConnectionShape=RightConnectionShape$$module$build$src$core$renderers$zelos$measurables$row_elements;var TopRow$$module$build$src$core$renderers$zelos$measurables$top_row=class extends TopRow$$module$build$src$core$renderers$measurables$top_row{constructor(a){super(a)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(a){const b=(a.hat?\"cap\"===a.hat:this.constants_.ADD_START_HATS)&&!a.outputConnection&&!a.previousConnection;return!!a.outputConnection||b}hasRightSquareCorner(a){return!!a.outputConnection&&!a.statementInputCount&&!a.nextConnection}},module$build$src$core$renderers$zelos$measurables$top_row=\n{};module$build$src$core$renderers$zelos$measurables$top_row.TopRow=TopRow$$module$build$src$core$renderers$zelos$measurables$top_row;var RenderInfo$$module$build$src$core$renderers$zelos$info=class extends RenderInfo$$module$build$src$core$renderers$common$info{constructor(a,b){super(a,b);this.isInline=!0;this.renderer_=a;this.constants_=this.renderer_.getConstants();this.topRow=new TopRow$$module$build$src$core$renderers$zelos$measurables$top_row(this.constants_);this.bottomRow=new BottomRow$$module$build$src$core$renderers$zelos$measurables$bottom_row(this.constants_);this.isMultiRow=!b.getInputsInline()||b.isCollapsed();this.hasStatementInput=\n0<b.statementInputCount;this.rightSide=this.outputConnection?new RightConnectionShape$$module$build$src$core$renderers$zelos$measurables$row_elements(this.constants_):null;this.rightAlignedDummyInputs_=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_();this.addElemSpacing_();this.addRowSpacing_();this.adjustXPosition_();this.computeBounds_();this.alignRowElements_();this.finalize_()}shouldStartNewRow_(a,b){return b?a.type===inputTypes$$module$build$src$core$input_types.STATEMENT||\nb.type===inputTypes$$module$build$src$core$input_types.STATEMENT?!0:a.type===inputTypes$$module$build$src$core$input_types.VALUE||a.type===inputTypes$$module$build$src$core$input_types.DUMMY?!this.isInline||this.isMultiRow:!1:!1}getDesiredRowWidth_(a){return a.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(a)}getInRowSpacing_(a,b){return a&&b||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?\n!a&&b&&Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:a&&Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a)&&b&&(Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(b)||Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b))?b.notchOffset-this.constants_.CORNER_RADIUS:a&&Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(a)&&\nb&&Types$$module$build$src$core$renderers$measurables$types.isHat(b)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(a,b){if(Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)&&Types$$module$build$src$core$renderers$measurables$types.isBottomRow(b))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const c=Types$$module$build$src$core$renderers$measurables$types.isInputRow(a)&&a.hasStatement,d=Types$$module$build$src$core$renderers$measurables$types.isInputRow(b)&&\nb.hasStatement;return d||c?(a=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),d&&c?Math.max(a,this.constants_.DUMMY_INPUT_MIN_HEIGHT):a):Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)?a.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):Types$$module$build$src$core$renderers$measurables$types.isBottomRow(b)?this.outputConnection?\n!b.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(a,b){const c=this.width-this.startX;return Types$$module$build$src$core$renderers$measurables$types.isInputRow(a)&&a.hasStatement||Types$$module$build$src$core$renderers$measurables$types.isInputRow(b)&&\nb.hasStatement?Math.max(c,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):c}getElemCenterline_(a,b){if(a.hasStatement&&!Types$$module$build$src$core$renderers$measurables$types.isSpacer(b)&&!Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b))return a.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)&&b instanceof InputConnection$$module$build$src$core$renderers$measurables$input_connection){const c=\nb.connectedBlock;if(c&&c.outputConnection&&c.nextConnection)return a.yPos+c.height/2}return super.getElemCenterline_(a,b)}addInput_(a,b){if(a.type===inputTypes$$module$build$src$core$input_types.DUMMY&&b.hasDummyInput&&b.align===$.Align$$module$build$src$core$input.LEFT&&a.align===$.Align$$module$build$src$core$input.RIGHT)this.rightAlignedDummyInputs_.set(b,a);else if(a.type===inputTypes$$module$build$src$core$input_types.STATEMENT){b.elements.push(new StatementInput$$module$build$src$core$renderers$zelos$measurables$inputs(this.constants_,\na));b.hasStatement=!0;null===b.align&&(b.align=a.align);return}super.addInput_(a,b)}addAlignmentPadding_(a,b){if(this.rightAlignedDummyInputs_.get(a)){let c;for(let d=0;d<a.elements.length;d++){const e=a.elements[d];Types$$module$build$src$core$renderers$measurables$types.isSpacer(e)&&(c=e);if(Types$$module$build$src$core$renderers$measurables$types.isField(e)&&e instanceof Field$$module$build$src$core$renderers$measurables$field&&e.parentInput===this.rightAlignedDummyInputs_.get(a))break}if(c){c.width+=\nb;a.width+=b;return}}super.addAlignmentPadding_(a,b)}adjustXPosition_(){const a=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let b=a;for(let e=2;e<this.rows.length-1;e+=2){var c=this.rows[e-1];const f=this.rows[e];var d=this.rows[e+1];c=2===e?!!this.topRow.hasPreviousConnection:!!c.followsStatement;d=e+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!d.precedesStatement;if(Types$$module$build$src$core$renderers$measurables$types.isInputRow(f)&&f.hasStatement){f.measure();\nlet g,h;b=f.width-(null!=(h=null==(g=f.getLastInput())?void 0:g.width)?h:0)+a}else if(c&&(2===e||d)&&Types$$module$build$src$core$renderers$measurables$types.isInputRow(f)&&!f.hasStatement){d=f.xPos;c=null;for(let g=0;g<f.elements.length;g++){const h=f.elements[g];Types$$module$build$src$core$renderers$measurables$types.isSpacer(h)&&(c=h);c&&(Types$$module$build$src$core$renderers$measurables$types.isField(h)||Types$$module$build$src$core$renderers$measurables$types.isInput(h))&&d<b&&!(Types$$module$build$src$core$renderers$measurables$types.isField(h)&&\nh instanceof Field$$module$build$src$core$renderers$measurables$field&&(h.field instanceof $.FieldLabel$$module$build$src$core$field_label||h.field instanceof $.FieldImage$$module$build$src$core$field_image))&&(c.width+=b-d);d+=h.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var a=this.outputConnection.shape;if(\"isDynamic\"in a&&a.isDynamic){var b=0;for(var c=0;c<this.rows.length;c++){const d=this.rows[c];d.yPos=b;b+=d.height}this.height=b;c=this.bottomRow.hasNextConnection?\nthis.height-this.bottomRow.descenderHeight:this.height;b=a.height(c);c=a.width(c);this.outputConnection.height=b;this.outputConnection.width=c;this.outputConnection.startX=c;this.outputConnection.connectionOffsetY=a.connectionOffsetY(b);this.outputConnection.connectionOffsetX=a.connectionOffsetX(c);a=0;this.hasStatementInput||this.bottomRow.hasNextConnection||(a=c,this.rightSide.height=b,this.rightSide.width=a,this.rightSide.centerline=b/2,this.rightSide.xPos=this.width+a);this.startX=c;this.width+=\nc+a;this.widthWithChildren+=c+a}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){var a=0;for(var b=0;b<this.rows.length;b++){var c=this.rows[b];if(!Types$$module$build$src$core$renderers$measurables$types.isInputRow(c))continue;a=c.elements[c.elements.length-2];let d=this.getNegativeSpacing_(c.elements[1]),e=this.getNegativeSpacing_(a);a=d+e;const f=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-a<f&&(a=\nthis.width-f,d=a/2,e=a/2);c.elements.unshift(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,-d));c.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,-e))}if(a)for(this.width-=a,this.widthWithChildren-=a,this.rightSide.xPos-=a,b=0;b<this.rows.length;b++)c=this.rows[b],Types$$module$build$src$core$renderers$measurables$types.isTopOrBottomRow(c)&&(c.elements[1].width-=a),c.width-=a,c.widthWithConnectedBlocks-=\na}}getNegativeSpacing_(a){if(!a||!this.outputConnection)return 0;const b=this.outputConnection.width;var c=this.outputConnection.shape.type;const d=this.constants_;if(this.isMultiRow&&1<this.inputRows.length)switch(c){case d.SHAPES.ROUND:return c=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,c=this.height/2>c?c:this.height/2,b-c*(1-Math.sin(Math.acos((c-this.constants_.SMALL_PADDING)/c)));default:return 0}if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(a)&&a instanceof\nInputConnection$$module$build$src$core$renderers$measurables$input_connection){const e=a.connectedBlock;a=e?e.pathObject.outputShapeType:a.shape.type;return null==a||e&&e.outputConnection&&(e.statementInputCount||e.nextConnection)||c===d.SHAPES.HEXAGONAL&&c!==a?0:b-this.constants_.SHAPE_IN_SHAPE_PADDING[c][a]}return Types$$module$build$src$core$renderers$measurables$types.isField(a)&&a instanceof Field$$module$build$src$core$renderers$measurables$field?c===d.SHAPES.ROUND&&a.field instanceof $.FieldTextInput$$module$build$src$core$field_textinput?\nb-2.75*d.GRID_UNIT:b-this.constants_.SHAPE_IN_SHAPE_PADDING[c][0]:Types$$module$build$src$core$renderers$measurables$types.isIcon(a)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let d=2;d<this.rows.length-1;d+=2){const e=this.rows[d-1],f=this.rows[d],g=this.rows[d+1];var a=2===d,b=d+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!g.precedesStatement;if(a?this.topRow.hasPreviousConnection:e.followsStatement){var c=f.elements[1];c=3===f.elements.length&&\nc instanceof Field$$module$build$src$core$renderers$measurables$field&&(c.field instanceof $.FieldLabel$$module$build$src$core$field_label||c.field instanceof $.FieldImage$$module$build$src$core$field_image);if(!a&&c)e.height-=this.constants_.SMALL_PADDING,g.height-=this.constants_.SMALL_PADDING,f.height-=this.constants_.MEDIUM_PADDING;else if(!a&&!b)e.height+=this.constants_.SMALL_PADDING;else if(b){a=!1;for(b=0;b<f.elements.length;b++)if(c=f.elements[b],c instanceof InputConnection$$module$build$src$core$renderers$measurables$input_connection&&\nTypes$$module$build$src$core$renderers$measurables$types.isInlineInput(c)&&c.connectedBlock&&!c.connectedBlock.isShadow()&&40<=c.connectedBlock.getHeightWidth().height){a=!0;break}a&&(e.height-=this.constants_.SMALL_PADDING,g.height-=this.constants_.SMALL_PADDING)}}}}finalize_(){this.finalizeOutputConnection_();this.finalizeHorizontalAlignment_();this.finalizeVerticalAlignment_();super.finalize_();this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},module$build$src$core$renderers$zelos$info=\n{};module$build$src$core$renderers$zelos$info.RenderInfo=RenderInfo$$module$build$src$core$renderers$zelos$info;var MarkerSvg$$module$build$src$core$renderers$zelos$marker_svg=class extends MarkerSvg$$module$build$src$core$renderers$common$marker_svg{constructor(a,b,c){super(a,b,c);this.markerCircle_=null}showWithInputOutput_(a){const b=a.getSourceBlock();a=a.getLocation().getOffsetInBlock();this.positionCircle_(a.x,a.y);this.setParent_(b);this.showCurrent_()}showWithOutput_(a){this.showWithInputOutput_(a)}showWithInput_(a){this.showWithInputOutput_(a)}showWithBlock_(a){a=a.getLocation();const b=a.getHeightWidth();\nthis.positionRect_(0,0,b.width,b.height);this.setParent_(a);this.showCurrent_()}positionCircle_(a,b){let c;null==(c=this.markerCircle_)||c.setAttribute(\"cx\",a.toString());let d;null==(d=this.markerCircle_)||d.setAttribute(\"cy\",b.toString());this.currentMarkerSvg=this.markerCircle_}hide(){super.hide();this.markerCircle_&&(this.markerCircle_.style.display=\"none\")}createDomInternal_(){super.createDomInternal_();this.markerCircle_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,\n{r:this.constants_.CURSOR_RADIUS,style:\"display: none\",\"stroke-width\":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_);if(this.isCursor()){const a=this.getBlinkProperties_();createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.ANIMATE,a,this.markerCircle_)}return this.markerSvg_}applyColour_(a){super.applyColour_(a);let b;null==(b=this.markerCircle_)||b.setAttribute(\"fill\",this.colour_);let c;null==(c=this.markerCircle_)||c.setAttribute(\"stroke\",this.colour_);\nif(this.isCursor()){a=this.colour_+\";transparent;transparent;\";let d;null==(d=this.markerCircle_)||d.firstElementChild.setAttribute(\"values\",a)}}},module$build$src$core$renderers$zelos$marker_svg={};module$build$src$core$renderers$zelos$marker_svg.MarkerSvg=MarkerSvg$$module$build$src$core$renderers$zelos$marker_svg;var PathObject$$module$build$src$core$renderers$zelos$path_object=class extends PathObject$$module$build$src$core$renderers$common$path_object{constructor(a,b,c){super(a,b,c);this.svgPathSelected_=null;this.outlines=new Map;this.remainingOutlines=new Set;this.outputShapeType=null;this.constants=c}setPath(a){super.setPath(a);this.svgPathSelected_&&this.svgPathSelected_.setAttribute(\"d\",a)}applyColour(a){super.applyColour(a);const b=a.getParent();a.isShadow()&&b&&this.svgPath.setAttribute(\"stroke\",\nb.style.colourTertiary);for(const c of this.outlines.values())c.setAttribute(\"fill\",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const a of this.outlines.values())a.setAttribute(\"transform\",\"scale(-1 1)\")}updateSelected(a){this.setClass_(\"blocklySelected\",a);a?this.svgPathSelected_||(this.svgPathSelected_=this.svgPath.cloneNode(!0),this.svgPathSelected_.setAttribute(\"fill\",\"none\"),this.svgPathSelected_.setAttribute(\"filter\",\"url(#\"+this.constants.selectedGlowFilterId+\")\"),this.svgRoot.appendChild(this.svgPathSelected_)):\nthis.svgPathSelected_&&(this.svgRoot.removeChild(this.svgPathSelected_),this.svgPathSelected_=null)}updateReplacementFade(a){this.setClass_(\"blocklyReplaceable\",a);a?this.svgPath.setAttribute(\"filter\",\"url(#\"+this.constants.replacementGlowFilterId+\")\"):this.svgPath.removeAttribute(\"filter\")}updateShapeForInputHighlight(a,b){a=a.getParentInput().name;(a=this.getOutlinePath_(a))&&(b?a.setAttribute(\"filter\",\"url(#\"+this.constants.replacementGlowFilterId+\")\"):a.removeAttribute(\"filter\"))}beginDrawing(){this.remainingOutlines.clear();\nfor(const a of this.outlines.keys())this.remainingOutlines.add(a)}endDrawing(){if(this.remainingOutlines.size)for(const a of this.remainingOutlines)this.removeOutlinePath_(a);this.remainingOutlines.clear()}setOutlinePath(a,b){a=this.getOutlinePath_(a);a.setAttribute(\"d\",b);a.setAttribute(\"fill\",this.style.colourTertiary)}getOutlinePath_(a){this.outlines.has(a)||this.outlines.set(a,createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyOutlinePath\",\nd:\"\"},this.svgRoot));this.remainingOutlines.delete(a);return this.outlines.get(a)}removeOutlinePath_(a){let b,c;null==(b=this.outlines.get(a))||null==(c=b.parentNode)||c.removeChild(this.outlines.get(a));this.outlines.delete(a)}},module$build$src$core$renderers$zelos$path_object={};module$build$src$core$renderers$zelos$path_object.PathObject=PathObject$$module$build$src$core$renderers$zelos$path_object;var Renderer$$module$build$src$core$renderers$zelos$renderer=class extends Renderer$$module$build$src$core$renderers$common$renderer{constructor(a){super(a)}makeConstants_(){return new ConstantProvider$$module$build$src$core$renderers$zelos$constants}makeRenderInfo_(a){return new RenderInfo$$module$build$src$core$renderers$zelos$info(this,a)}makeDrawer_(a,b){return new Drawer$$module$build$src$core$renderers$zelos$drawer(a,b)}makeMarkerDrawer(a,b){return new MarkerSvg$$module$build$src$core$renderers$zelos$marker_svg(a,\nthis.getConstants(),b)}makePathObject(a,b){return new PathObject$$module$build$src$core$renderers$zelos$path_object(a,b,this.getConstants())}getConstants(){return this.constants_}shouldHighlightConnection(a){return a.type!==ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE&&a.type!==ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE}getConnectionPreviewMethod(a,b,c){return b.type===ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE?a.isConnected()?InsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.REPLACEMENT_FADE:\nInsertionMarkerManager$$module$build$src$core$insertion_marker_manager.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(a,b,c)}};register$$module$build$src$core$renderers$common$block_rendering(\"zelos\",Renderer$$module$build$src$core$renderers$zelos$renderer);var module$build$src$core$renderers$zelos$renderer={};module$build$src$core$renderers$zelos$renderer.Renderer=Renderer$$module$build$src$core$renderers$zelos$renderer;var module$build$src$core$renderers$zelos$zelos={};module$build$src$core$renderers$zelos$zelos.BottomRow=BottomRow$$module$build$src$core$renderers$zelos$measurables$bottom_row;module$build$src$core$renderers$zelos$zelos.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$zelos$constants;module$build$src$core$renderers$zelos$zelos.Drawer=Drawer$$module$build$src$core$renderers$zelos$drawer;module$build$src$core$renderers$zelos$zelos.MarkerSvg=MarkerSvg$$module$build$src$core$renderers$zelos$marker_svg;\nmodule$build$src$core$renderers$zelos$zelos.PathObject=PathObject$$module$build$src$core$renderers$zelos$path_object;module$build$src$core$renderers$zelos$zelos.RenderInfo=RenderInfo$$module$build$src$core$renderers$zelos$info;module$build$src$core$renderers$zelos$zelos.Renderer=Renderer$$module$build$src$core$renderers$zelos$renderer;module$build$src$core$renderers$zelos$zelos.RightConnectionShape=RightConnectionShape$$module$build$src$core$renderers$zelos$measurables$row_elements;\nmodule$build$src$core$renderers$zelos$zelos.StatementInput=StatementInput$$module$build$src$core$renderers$zelos$measurables$inputs;module$build$src$core$renderers$zelos$zelos.TopRow=TopRow$$module$build$src$core$renderers$zelos$measurables$top_row;var RenderInfo$$module$build$src$core$renderers$thrasos$info=class extends RenderInfo$$module$build$src$core$renderers$common$info{constructor(a,b){super(a,b)}getRenderer(){return this.renderer_}addElemSpacing_(){let a=!1;for(var b=0;b<this.rows.length;b++)if(this.rows[b].hasExternalInput){a=!0;break}for(b=0;b<this.rows.length;b++){const d=this.rows[b];var c=d.elements;d.elements=[];d.startsWithElemSpacer()&&d.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,\nthis.getInRowSpacing_(null,c[0])));if(c.length){for(let e=0;e<c.length-1;e++){d.elements.push(c[e]);const f=this.getInRowSpacing_(c[e],c[e+1]);d.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,f))}d.elements.push(c[c.length-1]);d.endsWithElemSpacer()&&(c=this.getInRowSpacing_(c[c.length-1],null),a&&d.hasDummyInput&&(c+=this.constants_.TAB_WIDTH),d.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,\nc)))}}}getInRowSpacing_(a,b){if(!a)return b&&Types$$module$build$src$core$renderers$measurables$types.isField(b)&&b.isEditable?this.constants_.MEDIUM_PADDING:b&&Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)?this.constants_.MEDIUM_LARGE_PADDING:b&&Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&!b)return Types$$module$build$src$core$renderers$measurables$types.isField(a)&&\na.isEditable?this.constants_.MEDIUM_PADDING:Types$$module$build$src$core$renderers$measurables$types.isIcon(a)?2*this.constants_.LARGE_PADDING+1:Types$$module$build$src$core$renderers$measurables$types.isHat(a)?this.constants_.NO_PADDING:Types$$module$build$src$core$renderers$measurables$types.isPreviousOrNextConnection(a)?this.constants_.LARGE_PADDING:Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a)?this.constants_.MIN_BLOCK_WIDTH:Types$$module$build$src$core$renderers$measurables$types.isJaggedEdge(a)?\nthis.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&!b){if(Types$$module$build$src$core$renderers$measurables$types.isExternalInput(a))return this.constants_.NO_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(a))return this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isStatementInput(a))return this.constants_.NO_PADDING}if(!Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&\nb&&Types$$module$build$src$core$renderers$measurables$types.isInput(b)){if(Types$$module$build$src$core$renderers$measurables$types.isField(a)&&a.isEditable){if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)||Types$$module$build$src$core$renderers$measurables$types.isExternalInput(b))return this.constants_.SMALL_PADDING}else{if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)||Types$$module$build$src$core$renderers$measurables$types.isExternalInput(b))return this.constants_.MEDIUM_LARGE_PADDING;\nif(Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Types$$module$build$src$core$renderers$measurables$types.isIcon(a)&&b&&!Types$$module$build$src$core$renderers$measurables$types.isInput(b))return this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(a)&&b&&Types$$module$build$src$core$renderers$measurables$types.isField(b))return b.isEditable?\nthis.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(a)&&b){if(Types$$module$build$src$core$renderers$measurables$types.isHat(b))return this.constants_.NO_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(b)||Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b))return b.notchOffset}return Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a)&&\nb?b.notchOffset-this.constants_.CORNER_RADIUS:Types$$module$build$src$core$renderers$measurables$types.isField(a)&&b&&Types$$module$build$src$core$renderers$measurables$types.isField(b)&&a.isEditable===b.isEditable||b&&Types$$module$build$src$core$renderers$measurables$types.isJaggedEdge(b)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(a,b){return Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)&&Types$$module$build$src$core$renderers$measurables$types.isBottomRow(b)?\nthis.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)||Types$$module$build$src$core$renderers$measurables$types.isBottomRow(b)?this.constants_.NO_PADDING:a.hasExternalInput&&b.hasExternalInput?this.constants_.LARGE_PADDING:!a.hasStatement&&b.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:a.hasStatement&&b.hasStatement||a.hasDummyInput||b.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(a,\nb){if(Types$$module$build$src$core$renderers$measurables$types.isSpacer(b))return a.yPos+b.height/2;if(Types$$module$build$src$core$renderers$measurables$types.isBottomRow(a))return a=a.yPos+a.height-a.descenderHeight,Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b)?a+b.height/2:a-b.height/2;if(Types$$module$build$src$core$renderers$measurables$types.isTopRow(a))return Types$$module$build$src$core$renderers$measurables$types.isHat(b)?a.capline-b.height/2:a.capline+b.height/\n2;let c=a.yPos;return c=Types$$module$build$src$core$renderers$measurables$types.isField(b)&&a.hasStatement?c+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+b.height/2):c+a.height/2}finalize_(){let a=0,b=0;for(var c=0;c<this.rows.length;c++){const e=this.rows[c];e.yPos=b;e.xPos=this.startX;b+=e.height;a=Math.max(a,e.widthWithConnectedBlocks);var d=b-this.topRow.ascenderHeight;e===this.bottomRow&&d<this.constants_.MIN_BLOCK_HEIGHT&&(d=this.constants_.MIN_BLOCK_HEIGHT-d,this.bottomRow.height+=d,b+=d);this.recordElemPositions_(e)}this.outputConnection&&\nthis.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(c=this.block_.nextConnection.targetBlock())&&(a=Math.max(a,c.getHeightWidth().width));this.bottomRow.baseline=b-this.bottomRow.descenderHeight;this.widthWithChildren=a+this.startX;this.height=b;this.startY=this.topRow.capline}},module$build$src$core$renderers$thrasos$info={};module$build$src$core$renderers$thrasos$info.RenderInfo=RenderInfo$$module$build$src$core$renderers$thrasos$info;var Renderer$$module$build$src$core$renderers$thrasos$renderer=class extends Renderer$$module$build$src$core$renderers$common$renderer{constructor(a){super(a)}makeRenderInfo_(a){return new RenderInfo$$module$build$src$core$renderers$thrasos$info(this,a)}};register$$module$build$src$core$renderers$common$block_rendering(\"thrasos\",Renderer$$module$build$src$core$renderers$thrasos$renderer);var module$build$src$core$renderers$thrasos$renderer={};\nmodule$build$src$core$renderers$thrasos$renderer.Renderer=Renderer$$module$build$src$core$renderers$thrasos$renderer;var module$build$src$core$renderers$thrasos$thrasos={};module$build$src$core$renderers$thrasos$thrasos.RenderInfo=RenderInfo$$module$build$src$core$renderers$thrasos$info;module$build$src$core$renderers$thrasos$thrasos.Renderer=Renderer$$module$build$src$core$renderers$thrasos$renderer;var ConstantProvider$$module$build$src$core$renderers$minimalist$constants=class extends ConstantProvider$$module$build$src$core$renderers$common$constants{constructor(){super()}},module$build$src$core$renderers$minimalist$constants={};module$build$src$core$renderers$minimalist$constants.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$minimalist$constants;var Drawer$$module$build$src$core$renderers$minimalist$drawer=class extends Drawer$$module$build$src$core$renderers$common$drawer{constructor(a,b){super(a,b)}},module$build$src$core$renderers$minimalist$drawer={};module$build$src$core$renderers$minimalist$drawer.Drawer=Drawer$$module$build$src$core$renderers$minimalist$drawer;var RenderInfo$$module$build$src$core$renderers$minimalist$info=class extends RenderInfo$$module$build$src$core$renderers$common$info{constructor(a,b){super(a,b)}getRenderer(){return this.renderer_}},module$build$src$core$renderers$minimalist$info={};module$build$src$core$renderers$minimalist$info.RenderInfo=RenderInfo$$module$build$src$core$renderers$minimalist$info;var Renderer$$module$build$src$core$renderers$minimalist$renderer=class extends Renderer$$module$build$src$core$renderers$common$renderer{constructor(a){super(a)}makeConstants_(){return new ConstantProvider$$module$build$src$core$renderers$minimalist$constants}makeRenderInfo_(a){return new RenderInfo$$module$build$src$core$renderers$minimalist$info(this,a)}makeDrawer_(a,b){return new Drawer$$module$build$src$core$renderers$minimalist$drawer(a,b)}};\nregister$$module$build$src$core$renderers$common$block_rendering(\"minimalist\",Renderer$$module$build$src$core$renderers$minimalist$renderer);var module$build$src$core$renderers$minimalist$renderer={};module$build$src$core$renderers$minimalist$renderer.Renderer=Renderer$$module$build$src$core$renderers$minimalist$renderer;var module$build$src$core$renderers$minimalist$minimalist={};module$build$src$core$renderers$minimalist$minimalist.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$minimalist$constants;module$build$src$core$renderers$minimalist$minimalist.Drawer=Drawer$$module$build$src$core$renderers$minimalist$drawer;module$build$src$core$renderers$minimalist$minimalist.RenderInfo=RenderInfo$$module$build$src$core$renderers$minimalist$info;\nmodule$build$src$core$renderers$minimalist$minimalist.Renderer=Renderer$$module$build$src$core$renderers$minimalist$renderer;var ConstantProvider$$module$build$src$core$renderers$geras$constants=class extends ConstantProvider$$module$build$src$core$renderers$common$constants{constructor(){super();this.FIELD_TEXT_BASELINE_CENTER=!1;this.DARK_PATH_OFFSET=1;this.MAX_BOTTOM_WIDTH=30;this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(a){return super.getCSS_(a).concat([`${a} .blocklyInsertionMarker>.blocklyPathLight,`,`${a} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\"stroke: none;\",\n\"}\"])}},module$build$src$core$renderers$geras$constants={};module$build$src$core$renderers$geras$constants.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$geras$constants;var Highlighter$$module$build$src$core$renderers$geras$highlighter=class{constructor(a){this.inlineSteps_=this.steps_=\"\";this.info_=a;this.RTL_=this.info_.RTL;a=a.getRenderer();this.constants_=a.getConstants();this.highlightConstants_=a.getHighlightConstants();this.highlightOffset_=this.highlightConstants_.OFFSET;this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER;this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER;this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB;this.notchPaths_=\nthis.highlightConstants_.NOTCH;this.startPaths_=this.highlightConstants_.START_HAT;this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+\"\\n\"+this.inlineSteps_}drawTopCorner(a){this.steps_+=moveBy$$module$build$src$core$utils$svg_paths(a.xPos,this.info_.startY);for(let b=0,c;c=a.elements[b];b++)Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(c)?this.steps_+=this.highlightConstants_.START_POINT:Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(c)?\nthis.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(c)?this.steps_+=this.notchPaths_.pathLeft:Types$$module$build$src$core$renderers$measurables$types.isHat(c)?this.steps_+=this.startPaths_.path(this.RTL_):Types$$module$build$src$core$renderers$measurables$types.isSpacer(c)&&0!==c.width&&(this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",c.xPos+c.width-this.highlightOffset_));this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",\na.xPos+a.width-this.highlightOffset_)}drawJaggedEdge_(a){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a.height-this.jaggedTeethPaths_.height-this.highlightOffset_))}drawValueInput(a){const b=a.getLastInput();if(this.RTL_){const c=a.height-b.connectionHeight;this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(b.xPos+b.width-this.highlightOffset_,a.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",\nc)}else this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(b.xPos+b.width,a.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(a){const b=a.getLastInput();if(b)if(this.RTL_){const c=a.height-2*this.insideCornerPaths_.height;this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(b.xPos,a.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",c)+this.insideCornerPaths_.pathBottom(this.RTL_)+lineTo$$module$build$src$core$utils$svg_paths(a.width-\nb.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(b.xPos,a.yPos+a.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+lineTo$$module$build$src$core$utils$svg_paths(a.width-b.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(a){const b=a.xPos+a.width-this.highlightOffset_;a instanceof SpacerRow$$module$build$src$core$renderers$measurables$spacer_row&&a.followsStatement&&(this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",\nb));this.RTL_&&(this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",b),a.height>this.highlightOffset_&&(this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.yPos+a.height-this.highlightOffset_)))}drawBottomRow(a){if(this.RTL_)this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.baseline-this.highlightOffset_);else{const b=this.info_.bottomRow.elements[0];Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(b)?this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(a.xPos+\nthis.highlightOffset_,a.baseline-this.highlightOffset_):Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(b)&&(this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(a.xPos,a.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var a=this.info_.outputConnection;a&&(a=a.connectionOffsetY+a.height,this.RTL_?this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(this.info_.startX,a):(this.steps_+=moveTo$$module$build$src$core$utils$svg_paths(this.info_.startX+\nthis.highlightOffset_,this.info_.bottomRow.baseline-this.highlightOffset_),this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_));this.RTL_||(a=this.info_.topRow,Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a.elements[0])?this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",this.outsideCornerPaths_.height):this.steps_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.capline+this.highlightOffset_))}drawInlineInput(a){const b=\nthis.highlightOffset_,c=a.xPos+a.connectionWidth;var d=a.centerline-a.height/2;const e=a.width-a.connectionWidth,f=d+b;this.RTL_?(d=a.connectionOffsetY-b,a=a.height-(a.connectionOffsetY+a.connectionHeight)+b,this.inlineSteps_+=moveTo$$module$build$src$core$utils$svg_paths(c-b,f)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",d)+this.puzzleTabPaths_.pathDown(this.RTL_)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",e)):this.inlineSteps_+=\nmoveTo$$module$build$src$core$utils$svg_paths(a.xPos+a.width+b,f)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",a.height)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",-e)+moveTo$$module$build$src$core$utils$svg_paths(c,d+a.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},module$build$src$core$renderers$geras$highlighter={};module$build$src$core$renderers$geras$highlighter.Highlighter=Highlighter$$module$build$src$core$renderers$geras$highlighter;var Drawer$$module$build$src$core$renderers$geras$drawer=class extends Drawer$$module$build$src$core$renderers$common$drawer{constructor(a,b){super(a,b);this.highlighter_=new Highlighter$$module$build$src$core$renderers$geras$highlighter(b)}draw(){this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();const a=this.block_.pathObject;a.setPath(this.outlinePath_+\"\\n\"+this.inlinePath_);a.setHighlightPath(this.highlighter_.getPath());this.info_.RTL&&a.flipRTL();if(isDebuggerEnabled$$module$build$src$core$renderers$common$debug()){let b,\nc;null==(b=this.block_)||null==(c=b.renderingDebugger)||c.drawDebug(this.block_,this.info_)}this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow);this.highlighter_.drawRightSideRow(this.info_.topRow);super.drawTop_()}drawJaggedEdge_(a){this.highlighter_.drawJaggedEdge_(a);super.drawJaggedEdge_(a)}drawValueInput_(a){this.highlighter_.drawValueInput(a);super.drawValueInput_(a)}drawStatementInput_(a){this.highlighter_.drawStatementInput(a);super.drawStatementInput_(a)}drawRightSideRow_(a){this.highlighter_.drawRightSideRow(a);\nthis.outlinePath_+=lineOnAxis$$module$build$src$core$utils$svg_paths(\"H\",a.xPos+a.width)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"V\",a.yPos+a.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow);super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft();super.drawLeft_()}drawInlineInput_(a){this.highlighter_.drawInlineInput(a);super.drawInlineInput_(a)}positionInlineInputConnection_(a){const b=a.centerline-a.height/2;if(a.connectionModel){let c=a.xPos+a.connectionWidth+\nthis.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(c*=-1);a.connectionModel.setOffsetInBlock(c,b+a.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(a){const b=a.getLastInput();if(null==b?0:b.connectionModel){let c=a.xPos+a.statementEdge+b.notchOffset;c=this.info_.RTL?-1*c:c+this.constants_.DARK_PATH_OFFSET;b.connectionModel.setOffsetInBlock(c,a.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(a){const b=a.getLastInput();if(b&&b.connectionModel){let c=\na.xPos+a.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(c*=-1);b.connectionModel.setOffsetInBlock(c,a.yPos)}}positionNextConnection_(){const a=this.info_.bottomRow;if(a.connection){const b=a.connection,c=b.xPos;b.connectionModel.setOffsetInBlock((this.info_.RTL?-c:c)+this.constants_.DARK_PATH_OFFSET/2,a.baseline+this.constants_.DARK_PATH_OFFSET)}}},module$build$src$core$renderers$geras$drawer={};module$build$src$core$renderers$geras$drawer.Drawer=Drawer$$module$build$src$core$renderers$geras$drawer;var HighlightConstantProvider$$module$build$src$core$renderers$geras$highlight_constants=class{constructor(a){this.OFFSET=.5;this.constantProvider=a;this.START_POINT=moveBy$$module$build$src$core$utils$svg_paths(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner();this.OUTSIDE_CORNER=this.makeOutsideCorner();this.PUZZLE_TAB=this.makePuzzleTab();this.NOTCH=this.makeNotch();this.JAGGED_TEETH=this.makeJaggedTeeth();this.START_HAT=this.makeStartHat()}makeInsideCorner(){const a=this.constantProvider.CORNER_RADIUS,\nb=this.OFFSET,c=(1-Math.SQRT1_2)*(a+b)-b,d=moveBy$$module$build$src$core$utils$svg_paths(c,c)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a,point$$module$build$src$core$utils$svg_paths(-c-b,a-c)),e=arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a+b,point$$module$build$src$core$utils$svg_paths(a+b,a+b)),f=moveBy$$module$build$src$core$utils$svg_paths(c,-c)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,0\",a+b,point$$module$build$src$core$utils$svg_paths(a-c,c+b));return{width:a+\nb,height:a,pathTop(g){return g?d:\"\"},pathBottom(g){return g?e:f}}}makeOutsideCorner(){const a=this.constantProvider.CORNER_RADIUS,b=this.OFFSET,c=(1-Math.SQRT1_2)*(a-b)+b,d=moveBy$$module$build$src$core$utils$svg_paths(c,c)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a-b,point$$module$build$src$core$utils$svg_paths(a-c,-c+b)),e=moveBy$$module$build$src$core$utils$svg_paths(b,a)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a-b,point$$module$build$src$core$utils$svg_paths(a,-a+\nb)),f=-c,g=moveBy$$module$build$src$core$utils$svg_paths(c,f)+arc$$module$build$src$core$utils$svg_paths(\"a\",\"0 0,1\",a-b,point$$module$build$src$core$utils$svg_paths(-c+b,-f-a));return{height:a,topLeft(h){return h?d:e},bottomLeft(){return g}}}makePuzzleTab(){const a=this.constantProvider.TAB_WIDTH,b=this.constantProvider.TAB_HEIGHT,c=moveBy$$module$build$src$core$utils$svg_paths(-2,-b+3.4)+lineTo$$module$build$src$core$utils$svg_paths(-.45*a,-2.1),d=lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",\n2.5)+moveBy$$module$build$src$core$utils$svg_paths(.97*-a,2.5)+curve$$module$build$src$core$utils$svg_paths(\"q\",[point$$module$build$src$core$utils$svg_paths(.05*-a,10),point$$module$build$src$core$utils$svg_paths(.3*a,9.5)])+moveBy$$module$build$src$core$utils$svg_paths(.67*a,-1.9)+lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",2.5),e=lineOnAxis$$module$build$src$core$utils$svg_paths(\"v\",-1.5)+moveBy$$module$build$src$core$utils$svg_paths(-.92*a,-.5)+curve$$module$build$src$core$utils$svg_paths(\"q\",\n[point$$module$build$src$core$utils$svg_paths(-.19*a,-5.5),point$$module$build$src$core$utils$svg_paths(0,-11)])+moveBy$$module$build$src$core$utils$svg_paths(.92*a,1),f=moveBy$$module$build$src$core$utils$svg_paths(-5,b-.7)+lineTo$$module$build$src$core$utils$svg_paths(.46*a,-2.1);return{width:a,height:b,pathUp(g){return g?c:e},pathDown(g){return g?d:f}}}makeNotch(){return{pathLeft:lineOnAxis$$module$build$src$core$utils$svg_paths(\"h\",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:lineTo$$module$build$src$core$utils$svg_paths(5.1,\n2.6)+moveBy$$module$build$src$core$utils$svg_paths(-10.2,6.8)+lineTo$$module$build$src$core$utils$svg_paths(5.1,2.6),height:12,width:10.2}}makeStartHat(){const a=this.constantProvider.START_HAT.height,b=moveBy$$module$build$src$core$utils$svg_paths(25,-8.7)+curve$$module$build$src$core$utils$svg_paths(\"c\",[point$$module$build$src$core$utils$svg_paths(29.7,-6.2),point$$module$build$src$core$utils$svg_paths(57.2,-.5),point$$module$build$src$core$utils$svg_paths(75,8.7)]),c=curve$$module$build$src$core$utils$svg_paths(\"c\",\n[point$$module$build$src$core$utils$svg_paths(17.8,-9.2),point$$module$build$src$core$utils$svg_paths(45.3,-14.9),point$$module$build$src$core$utils$svg_paths(75,-8.7)])+moveTo$$module$build$src$core$utils$svg_paths(100.5,a+.5);return{path(d){return d?b:c}}}},module$build$src$core$renderers$geras$highlight_constants={};module$build$src$core$renderers$geras$highlight_constants.HighlightConstantProvider=HighlightConstantProvider$$module$build$src$core$renderers$geras$highlight_constants;var InlineInput$$module$build$src$core$renderers$geras$measurables$inline_input=class extends InlineInput$$module$build$src$core$renderers$measurables$inline_input{constructor(a,b){super(a,b);this.constants_=a;this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},module$build$src$core$renderers$geras$measurables$inline_input={};module$build$src$core$renderers$geras$measurables$inline_input.InlineInput=InlineInput$$module$build$src$core$renderers$geras$measurables$inline_input;var StatementInput$$module$build$src$core$renderers$geras$measurables$statement_input=class extends StatementInput$$module$build$src$core$renderers$measurables$statement_input{constructor(a,b){super(a,b);this.constants_=a;this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},module$build$src$core$renderers$geras$measurables$statement_input={};module$build$src$core$renderers$geras$measurables$statement_input.StatementInput=StatementInput$$module$build$src$core$renderers$geras$measurables$statement_input;var RenderInfo$$module$build$src$core$renderers$geras$info=class extends RenderInfo$$module$build$src$core$renderers$common$info{constructor(a,b){super(a,b);this.renderer_=a}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_();this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type===inputTypes$$module$build$src$core$input_types.STATEMENT||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(a,\nb){this.isInline&&a.type===inputTypes$$module$build$src$core$input_types.VALUE?(b.elements.push(new InlineInput$$module$build$src$core$renderers$geras$measurables$inline_input(this.constants_,a)),b.hasInlineInput=!0):a.type===inputTypes$$module$build$src$core$input_types.STATEMENT?(b.elements.push(new StatementInput$$module$build$src$core$renderers$geras$measurables$statement_input(this.constants_,a)),b.hasStatement=!0):a.type===inputTypes$$module$build$src$core$input_types.VALUE?(b.elements.push(new ExternalValueInput$$module$build$src$core$renderers$measurables$external_value_input(this.constants_,\na)),b.hasExternalInput=!0):a.type===inputTypes$$module$build$src$core$input_types.DUMMY&&(b.minHeight=Math.max(b.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),b.hasDummyInput=!0);this.isInline||null!==b.align||(b.align=a.align)}addElemSpacing_(){let a=!1;for(let c=0,d;d=this.rows[c];c++)d.hasExternalInput&&(a=!0);for(let c=0,d;d=this.rows[c];c++){var b=d.elements;d.elements=[];d.startsWithElemSpacer()&&d.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,\nthis.getInRowSpacing_(null,b[0])));if(b.length){for(let e=0;e<b.length-1;e++){d.elements.push(b[e]);const f=this.getInRowSpacing_(b[e],b[e+1]);d.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,f))}d.elements.push(b[b.length-1]);d.endsWithElemSpacer()&&(b=this.getInRowSpacing_(b[b.length-1],null),a&&d.hasDummyInput&&(b+=this.constants_.TAB_WIDTH),d.elements.push(new InRowSpacer$$module$build$src$core$renderers$measurables$in_row_spacer(this.constants_,\nb)))}}}getInRowSpacing_(a,b){if(!a)return b&&Types$$module$build$src$core$renderers$measurables$types.isField(b)&&b.isEditable?this.constants_.MEDIUM_PADDING:b&&Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)?this.constants_.MEDIUM_LARGE_PADDING:b&&Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&(!b||\nTypes$$module$build$src$core$renderers$measurables$types.isStatementInput(b)))return Types$$module$build$src$core$renderers$measurables$types.isField(a)&&a.isEditable?this.constants_.MEDIUM_PADDING:Types$$module$build$src$core$renderers$measurables$types.isIcon(a)?2*this.constants_.LARGE_PADDING+1:Types$$module$build$src$core$renderers$measurables$types.isHat(a)?this.constants_.NO_PADDING:Types$$module$build$src$core$renderers$measurables$types.isPreviousOrNextConnection(a)?this.constants_.LARGE_PADDING:\nTypes$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a)?this.constants_.MIN_BLOCK_WIDTH:Types$$module$build$src$core$renderers$measurables$types.isJaggedEdge(a)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&!b){if(Types$$module$build$src$core$renderers$measurables$types.isExternalInput(a))return this.constants_.NO_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(a))return this.constants_.LARGE_PADDING;\nif(Types$$module$build$src$core$renderers$measurables$types.isStatementInput(a))return this.constants_.NO_PADDING}if(!Types$$module$build$src$core$renderers$measurables$types.isInput(a)&&b&&Types$$module$build$src$core$renderers$measurables$types.isInput(b)){if(Types$$module$build$src$core$renderers$measurables$types.isField(a)&&a.isEditable){if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)||Types$$module$build$src$core$renderers$measurables$types.isExternalInput(b))return this.constants_.SMALL_PADDING}else{if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)||\nTypes$$module$build$src$core$renderers$measurables$types.isExternalInput(b))return this.constants_.MEDIUM_LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isStatementInput(b))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Types$$module$build$src$core$renderers$measurables$types.isIcon(a)&&b&&!Types$$module$build$src$core$renderers$measurables$types.isInput(b))return this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isInlineInput(a)&&\nb&&Types$$module$build$src$core$renderers$measurables$types.isField(b))return b.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isLeftSquareCorner(a)&&b){if(Types$$module$build$src$core$renderers$measurables$types.isHat(b))return this.constants_.NO_PADDING;if(Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(b))return b.notchOffset;if(Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b))return b.notchOffset+\n(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(Types$$module$build$src$core$renderers$measurables$types.isLeftRoundedCorner(a)&&b){if(Types$$module$build$src$core$renderers$measurables$types.isPreviousConnection(b))return b.notchOffset-this.constants_.CORNER_RADIUS;if(Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b))return b.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return Types$$module$build$src$core$renderers$measurables$types.isField(a)&&\nb&&Types$$module$build$src$core$renderers$measurables$types.isField(b)&&a.isEditable===b.isEditable||b&&Types$$module$build$src$core$renderers$measurables$types.isJaggedEdge(b)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(a,b){return Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)&&Types$$module$build$src$core$renderers$measurables$types.isBottomRow(b)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Types$$module$build$src$core$renderers$measurables$types.isTopRow(a)||\nTypes$$module$build$src$core$renderers$measurables$types.isBottomRow(b)?this.constants_.NO_PADDING:a.hasExternalInput&&b.hasExternalInput?this.constants_.LARGE_PADDING:!a.hasStatement&&b.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:a.hasStatement&&b.hasStatement||!a.hasStatement&&b.hasDummyInput||a.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(a,b){if(Types$$module$build$src$core$renderers$measurables$types.isSpacer(b))return a.yPos+b.height/\n2;if(Types$$module$build$src$core$renderers$measurables$types.isBottomRow(a))return a=a.yPos+a.height-a.descenderHeight,Types$$module$build$src$core$renderers$measurables$types.isNextConnection(b)?a+b.height/2:a-b.height/2;if(Types$$module$build$src$core$renderers$measurables$types.isTopRow(a))return Types$$module$build$src$core$renderers$measurables$types.isHat(b)?a.capline-b.height/2:a.capline+b.height/2;let c=a.yPos;Types$$module$build$src$core$renderers$measurables$types.isField(b)||Types$$module$build$src$core$renderers$measurables$types.isIcon(b)?\n(c+=b.height/2,(a.hasInlineInput||a.hasStatement)&&b.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=a.height&&(c+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):c=Types$$module$build$src$core$renderers$measurables$types.isInlineInput(b)?c+b.height/2:c+a.height/2;return c}alignRowElements_(){if(this.isInline){var a=0,b=new WeakMap,c=null;for(let d=this.rows.length-1,e;e=this.rows[d];d--)b.set(e,a),Types$$module$build$src$core$renderers$measurables$types.isInputRow(e)&&(e.hasStatement&&this.alignStatementRow_(e),\nc&&c.hasStatement&&e.width<c.width?b.set(e,c.width):a=e.width,c=e);a=0;for(let d=0,e;e=this.rows[d];d++)e.hasStatement?a=this.getDesiredRowWidth_(e):Types$$module$build$src$core$renderers$measurables$types.isSpacer(e)?e.width=Math.max(a,b.get(e)):(c=e.width,a=Math.max(a,b.get(e))-c,0<a&&this.addAlignmentPadding_(e,a),a=e.width)}else super.alignRowElements_()}getDesiredRowWidth_(a){return this.isInline&&a.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(a)}finalize_(){let a=\n0,b=0;for(let d=0,e;e=this.rows[d];d++){e.yPos=b;e.xPos=this.startX;b+=e.height;a=Math.max(a,e.widthWithConnectedBlocks);var c=b-this.topRow.ascenderHeight;e===this.bottomRow&&c<this.constants_.MIN_BLOCK_HEIGHT&&(c=this.constants_.MIN_BLOCK_HEIGHT-c,this.bottomRow.height+=c,b+=c);this.recordElemPositions_(e)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(c=this.block_.nextConnection.targetBlock())&&(a=Math.max(a,c.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET));\nthis.bottomRow.baseline=b-this.bottomRow.descenderHeight;this.widthWithChildren=a+this.startX+this.constants_.DARK_PATH_OFFSET;this.width+=this.constants_.DARK_PATH_OFFSET;this.height=b+this.constants_.DARK_PATH_OFFSET;this.startY=this.topRow.capline}},module$build$src$core$renderers$geras$info={};module$build$src$core$renderers$geras$info.RenderInfo=RenderInfo$$module$build$src$core$renderers$geras$info;var PathObject$$module$build$src$core$renderers$geras$path_object=class extends PathObject$$module$build$src$core$renderers$common$path_object{constructor(a,b,c){super(a,b,c);this.constants=c;this.colourDark=\"#000000\";this.svgPathDark=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyPathDark\",transform:\"translate(1,1)\"});this.svgRoot.insertBefore(this.svgPathDark,this.svgPath);this.svgPathLight=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,\n{\"class\":\"blocklyPathLight\"},this.svgRoot)}setPath(a){this.svgPath.setAttribute(\"d\",a);this.svgPathDark.setAttribute(\"d\",a)}setHighlightPath(a){this.svgPathLight.setAttribute(\"d\",a)}flipRTL(){this.svgPath.setAttribute(\"transform\",\"scale(-1 1)\");this.svgPathLight.setAttribute(\"transform\",\"scale(-1 1)\");this.svgPathDark.setAttribute(\"transform\",\"translate(1,1) scale(-1 1)\")}applyColour(a){this.svgPathLight.style.display=\"\";this.svgPathDark.style.display=\"\";if(!this.style.colourTertiary)throw Error(\"The renderer did not properly initialize the tertiary colour of the block style\");\nthis.svgPathLight.setAttribute(\"stroke\",this.style.colourTertiary);this.svgPathDark.setAttribute(\"fill\",this.colourDark);super.applyColour(a);this.svgPath.setAttribute(\"stroke\",\"none\")}setStyle(a){this.style=a;this.colourDark=blend$$module$build$src$core$utils$colour(\"#000\",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(a){a?(this.svgPath.setAttribute(\"filter\",\"url(#\"+this.constants.embossFilterId+\")\"),this.svgPathLight.style.display=\"none\"):(this.svgPath.setAttribute(\"filter\",\"none\"),\nthis.svgPathLight.style.display=\"inline\")}updateShadow_(a){if(a){this.svgPathLight.style.display=\"none\";if(!this.style.colourSecondary)throw Error(\"The renderer did not properly initialize the secondary colour of the block style block style\");this.svgPathDark.setAttribute(\"fill\",this.style.colourSecondary);this.svgPath.setAttribute(\"stroke\",\"none\");this.svgPath.setAttribute(\"fill\",this.style.colourSecondary)}}updateDisabled_(a){super.updateDisabled_(a);a&&this.svgPath.setAttribute(\"stroke\",\"none\")}},\nmodule$build$src$core$renderers$geras$path_object={};module$build$src$core$renderers$geras$path_object.PathObject=PathObject$$module$build$src$core$renderers$geras$path_object;var Renderer$$module$build$src$core$renderers$geras$renderer=class extends Renderer$$module$build$src$core$renderers$common$renderer{constructor(a){super(a);this.highlightConstants_=null}init(a,b){super.init(a,b);this.highlightConstants_=this.makeHighlightConstants_();this.highlightConstants_.init()}refreshDom(a,b){super.refreshDom(a,b);this.getHighlightConstants().init()}makeConstants_(){return new ConstantProvider$$module$build$src$core$renderers$geras$constants}makeRenderInfo_(a){return new RenderInfo$$module$build$src$core$renderers$geras$info(this,\na)}makeDrawer_(a,b){return new Drawer$$module$build$src$core$renderers$geras$drawer(a,b)}makePathObject(a,b){return new PathObject$$module$build$src$core$renderers$geras$path_object(a,b,this.getConstants())}makeHighlightConstants_(){return new HighlightConstantProvider$$module$build$src$core$renderers$geras$highlight_constants(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants_)throw Error(\"Cannot access the highlight constants because init has not been called\");return this.highlightConstants_}};\nregister$$module$build$src$core$renderers$common$block_rendering(\"geras\",Renderer$$module$build$src$core$renderers$geras$renderer);var module$build$src$core$renderers$geras$renderer={};module$build$src$core$renderers$geras$renderer.Renderer=Renderer$$module$build$src$core$renderers$geras$renderer;var module$build$src$core$renderers$geras$geras={};module$build$src$core$renderers$geras$geras.ConstantProvider=ConstantProvider$$module$build$src$core$renderers$geras$constants;module$build$src$core$renderers$geras$geras.Drawer=Drawer$$module$build$src$core$renderers$geras$drawer;module$build$src$core$renderers$geras$geras.HighlightConstantProvider=HighlightConstantProvider$$module$build$src$core$renderers$geras$highlight_constants;module$build$src$core$renderers$geras$geras.Highlighter=Highlighter$$module$build$src$core$renderers$geras$highlighter;\nmodule$build$src$core$renderers$geras$geras.InlineInput=InlineInput$$module$build$src$core$renderers$geras$measurables$inline_input;module$build$src$core$renderers$geras$geras.PathObject=PathObject$$module$build$src$core$renderers$geras$path_object;module$build$src$core$renderers$geras$geras.RenderInfo=RenderInfo$$module$build$src$core$renderers$geras$info;module$build$src$core$renderers$geras$geras.Renderer=Renderer$$module$build$src$core$renderers$geras$renderer;\nmodule$build$src$core$renderers$geras$geras.StatementInput=StatementInput$$module$build$src$core$renderers$geras$measurables$statement_input;var WorkspaceDragSurfaceSvg$$module$build$src$core$workspace_drag_surface_svg=class{constructor(a){this.container=a;this.previousSibling=null;this.createDom()}createDom(){this.SVG||(this.SVG=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.SVG,{xmlns:SVG_NS$$module$build$src$core$utils$dom,\"xmlns:html\":HTML_NS$$module$build$src$core$utils$dom,\"xmlns:xlink\":XLINK_NS$$module$build$src$core$utils$dom,version:\"1.1\",\"class\":\"blocklyWsDragSurface blocklyOverflowVisible\"}),\nthis.container.appendChild(this.SVG))}translateSurface(a,b){a=Math.round(a);b=Math.round(b);this.SVG.style.display=\"block\";setCssTransform$$module$build$src$core$utils$dom(this.SVG,\"translate3d(\"+a+\"px, \"+b+\"px, 0)\")}getSurfaceTranslation(){return getRelativeXY$$module$build$src$core$utils$svg_math(this.SVG)}clearAndHide(a){if(!a)throw Error(\"Couldn't clear and hide the drag surface: missing new surface.\");const b=this.SVG.childNodes[0],c=this.SVG.childNodes[1];if(!b||!c||!b.classList.contains(\"blocklyBlockCanvas\")&&\nc.classList.contains(\"blocklyBubbleCanvas\"))throw Error(\"Couldn't clear and hide the drag surface. A node was missing.\");null!==this.previousSibling?insertAfter$$module$build$src$core$utils$dom(b,this.previousSibling):a.insertBefore(b,a.firstChild);insertAfter$$module$build$src$core$utils$dom(c,b);this.SVG.style.display=\"none\";if(this.SVG.childNodes.length)throw Error(\"Drag surface was not cleared.\");setCssTransform$$module$build$src$core$utils$dom(this.SVG,\"\");this.previousSibling=null}setContentsAndShow(a,\nb,c,d,e,f){if(this.SVG.childNodes.length)throw Error(\"Already dragging a block.\");this.previousSibling=c;a.setAttribute(\"transform\",\"translate(0, 0) scale(\"+f+\")\");b.setAttribute(\"transform\",\"translate(0, 0) scale(\"+f+\")\");this.SVG.setAttribute(\"width\",String(d));this.SVG.setAttribute(\"height\",String(e));this.SVG.appendChild(a);this.SVG.appendChild(b);this.SVG.style.display=\"block\"}},module$build$src$core$workspace_drag_surface_svg={};\nmodule$build$src$core$workspace_drag_surface_svg.WorkspaceDragSurfaceSvg=WorkspaceDragSurfaceSvg$$module$build$src$core$workspace_drag_surface_svg;var BlockDragSurfaceSvg$$module$build$src$core$block_drag_surface=class{constructor(a){this.container=a;this.scale=1;this.surfaceXY=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.childSurfaceXY=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.svg=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.SVG,{xmlns:SVG_NS$$module$build$src$core$utils$dom,\"xmlns:html\":HTML_NS$$module$build$src$core$utils$dom,\"xmlns:xlink\":XLINK_NS$$module$build$src$core$utils$dom,\nversion:\"1.1\",\"class\":\"blocklyBlockDragSurface\"},this.container);this.dragGroup=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{},this.svg)}createDom(){warn$$module$build$src$core$utils$deprecation(\"BlockDragSurfaceSvg createDom\",\"June 2022\",\"June 2023\")}setBlocksAndShow(a){if(this.dragGroup.childNodes.length)throw Error(\"Already dragging a block.\");this.dragGroup.appendChild(a);this.svg.style.display=\"block\";this.surfaceXY=new Coordinate$$module$build$src$core$utils$coordinate(0,\n0)}translateAndScaleGroup(a,b,c){this.scale=c;a=Math.round(a);b=Math.round(b);this.childSurfaceXY.x=a;this.childSurfaceXY.y=b;this.dragGroup.setAttribute(\"transform\",\"translate(\"+a+\",\"+b+\") scale(\"+c+\")\")}translateSurfaceInternal_(){const a=Math.round(this.surfaceXY.x),b=Math.round(this.surfaceXY.y);this.svg.style.display=\"block\";setCssTransform$$module$build$src$core$utils$dom(this.svg,\"translate3d(\"+a+\"px, \"+b+\"px, 0)\")}translateBy(a,b){this.surfaceXY=new Coordinate$$module$build$src$core$utils$coordinate(this.surfaceXY.x+\na,this.surfaceXY.y+b);this.translateSurfaceInternal_()}translateSurface(a,b){this.surfaceXY=new Coordinate$$module$build$src$core$utils$coordinate(a*this.scale,b*this.scale);this.translateSurfaceInternal_()}getSurfaceTranslation(){const a=getRelativeXY$$module$build$src$core$utils$svg_math(this.svg);return new Coordinate$$module$build$src$core$utils$coordinate(a.x/this.scale,a.y/this.scale)}getGroup(){return this.dragGroup}getSvgRoot(){return this.svg}getCurrentBlock(){return this.dragGroup.firstChild}getWsTranslation(){return this.childSurfaceXY.clone()}clearAndHide(a){const b=\nthis.getCurrentBlock();b&&(a?a.appendChild(b):this.dragGroup.removeChild(b));this.svg.style.display=\"none\";if(this.dragGroup.childNodes.length)throw Error(\"Drag group was not cleared.\");this.surfaceXY=new Coordinate$$module$build$src$core$utils$coordinate(0,0)}},module$build$src$core$block_drag_surface={};module$build$src$core$block_drag_surface.BlockDragSurfaceSvg=BlockDragSurfaceSvg$$module$build$src$core$block_drag_surface;var bumpIntoBounds$$module$build$src$core$bump_objects=bumpObjectIntoBounds$$module$build$src$core$bump_objects,module$build$src$core$bump_objects={};module$build$src$core$bump_objects.bumpIntoBounds=bumpObjectIntoBounds$$module$build$src$core$bump_objects;module$build$src$core$bump_objects.bumpIntoBoundsHandler=bumpIntoBoundsHandler$$module$build$src$core$bump_objects;module$build$src$core$bump_objects.bumpTopObjectsIntoBounds=bumpTopObjectsIntoBounds$$module$build$src$core$bump_objects;var ScrollbarPair$$module$build$src$core$scrollbar_pair=class{constructor(a,b,c,d,e){this.workspace=a;this.oldHostMetrics_=this.corner_=this.vScroll=this.hScroll=null;b=void 0===b?!0:b;c=void 0===c?!0:c;const f=b&&c;b&&(this.hScroll=new Scrollbar$$module$build$src$core$scrollbar(a,!0,f,d,e));c&&(this.vScroll=new Scrollbar$$module$build$src$core$scrollbar(a,!1,f,d,e));f&&(this.corner_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{height:Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness,\nwidth:Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness,\"class\":\"blocklyScrollbarBackground\"}),insertAfter$$module$build$src$core$utils$dom(this.corner_,a.getBubbleCanvas()))}dispose(){removeNode$$module$build$src$core$utils$dom(this.corner_);this.oldHostMetrics_=this.corner_=null;this.hScroll&&(this.hScroll.dispose(),this.hScroll=null);this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const a=this.workspace.getMetrics();if(a){var b=!1,c=!1;this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth===\na.viewWidth&&this.oldHostMetrics_.viewHeight===a.viewHeight&&this.oldHostMetrics_.absoluteTop===a.absoluteTop&&this.oldHostMetrics_.absoluteLeft===a.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth===a.scrollWidth&&this.oldHostMetrics_.viewLeft===a.viewLeft&&this.oldHostMetrics_.scrollLeft===a.scrollLeft||(b=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight===a.scrollHeight&&this.oldHostMetrics_.viewTop===a.viewTop&&this.oldHostMetrics_.scrollTop===a.scrollTop||(c=!0)):\nc=b=!0;if(b||c){try{disable$$module$build$src$core$events$utils(),this.hScroll&&b&&this.hScroll.resize(a),this.vScroll&&c&&this.vScroll.resize(a)}finally{enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!==a.viewWidth||this.oldHostMetrics_.absoluteLeft!==a.absoluteLeft){let d;null==(d=this.corner_)||d.setAttribute(\"x\",String(this.vScroll.position.x))}if(!this.oldHostMetrics_||\nthis.oldHostMetrics_.viewHeight!==a.viewHeight||this.oldHostMetrics_.absoluteTop!==a.absoluteTop){let d;null==(d=this.corner_)||d.setAttribute(\"y\",String(this.hScroll.position.y))}}this.oldHostMetrics_=a}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(a,b){this.hScroll&&this.hScroll.setOrigin(a,b);this.vScroll&&this.vScroll.setOrigin(a,b)}set(a,b,c){this.hScroll&&this.hScroll.set(a,!1);this.vScroll&&this.vScroll.set(b,!1);if(c||void 0===c)a={},this.hScroll&&\n(a.x=this.hScroll.getRatio_()),this.vScroll&&(a.y=this.vScroll.getRatio_()),this.workspace.setMetrics(a)}setX(a){this.hScroll&&this.hScroll.set(a,!0)}setY(a){this.vScroll&&this.vScroll.set(a,!0)}setContainerVisible(a){this.hScroll&&this.hScroll.setContainerVisible(a);this.vScroll&&this.vScroll.setContainerVisible(a)}isVisible(){let a=!1;this.hScroll&&(a=this.hScroll.isVisible());this.vScroll&&(a=a||this.vScroll.isVisible());return a}resizeContent(a){this.hScroll&&this.hScroll.resizeContentHorizontal(a);\nthis.vScroll&&this.vScroll.resizeContentVertical(a)}resizeView(a){this.hScroll&&this.hScroll.resizeViewHorizontal(a);this.vScroll&&this.vScroll.resizeViewVertical(a)}},module$build$src$core$scrollbar_pair={};module$build$src$core$scrollbar_pair.ScrollbarPair=ScrollbarPair$$module$build$src$core$scrollbar_pair;var documentEventsBound$$module$build$src$core$inject=!1,module$build$src$core$inject={};module$build$src$core$inject.inject=inject$$module$build$src$core$inject;$.CodeGenerator$$module$build$src$core$generator=class{constructor(a){this.FUNCTION_NAME_PLACEHOLDER_=\"{leCUI8hutHZI4480Dc}\";this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null;this.INDENT=\"  \";this.COMMENT_WRAP=60;this.ORDER_OVERRIDES=[];this.isInitialized=null;this.RESERVED_WORDS_=\"\";this.definitions_=Object.create(null);this.functionNames_=Object.create(null);this.nameDB_=void 0;this.name_=a;this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,\n\"g\")}workspaceToCode(a){a||(console.warn(\"No workspace specified in workspaceToCode call.  Guessing.\"),a=getMainWorkspace$$module$build$src$core$common());var b=[];this.init(a);a=a.getTopBlocks(!0);for(let c=0,d;d=a[c];c++){let e=this.blockToCode(d);Array.isArray(e)&&(e=e[0]);e&&(d.outputConnection&&(e=this.scrubNakedValue(e),this.STATEMENT_PREFIX&&!d.suppressPrefixSuffix&&(e=this.injectId(this.STATEMENT_PREFIX,d)+e),this.STATEMENT_SUFFIX&&!d.suppressPrefixSuffix&&(e+=this.injectId(this.STATEMENT_SUFFIX,\nd))),b.push(e))}b=b.join(\"\\n\");b=this.finish(b);b=b.replace(/^\\s+\\n/,\"\");b=b.replace(/\\n\\s+$/,\"\\n\");return b=b.replace(/[ \\t]+\\n/g,\"\\n\")}prefixLines(a,b){return b+a.replace(/(?!\\n$)\\n/g,\"\\n\"+b)}allNestedComments(a){const b=[];a=a.getDescendants(!0);for(let c=0;c<a.length;c++){const d=a[c].getCommentText();d&&b.push(d)}b.length&&b.push(\"\");return b.join(\"\\n\")}blockToCode(a,b){!1===this.isInitialized&&console.warn(\"CodeGenerator init was not called before blockToCode was called.\");if(!a)return\"\";if(!a.isEnabled())return b?\n\"\":this.blockToCode(a.getNextBlock());if(a.isInsertionMarker())return b?\"\":this.blockToCode(a.getChildren(!1)[0]);var c=this[a.type];if(\"function\"!==typeof c)throw Error('Language \"'+this.name_+'\" does not know how to generate code for block type \"'+a.type+'\".');c=c.call(a,a);if(Array.isArray(c)){if(!a.outputConnection)throw TypeError(\"Expecting string from statement block: \"+a.type);return[this.scrub_(a,c[0],b),c[1]]}if(\"string\"===typeof c)return this.STATEMENT_PREFIX&&!a.suppressPrefixSuffix&&(c=\nthis.injectId(this.STATEMENT_PREFIX,a)+c),this.STATEMENT_SUFFIX&&!a.suppressPrefixSuffix&&(c+=this.injectId(this.STATEMENT_SUFFIX,a)),this.scrub_(a,c,b);if(null===c)return\"\";throw SyntaxError(\"Invalid code generated: \"+c);}valueToCode(a,b,c){if(isNaN(c))throw TypeError(\"Expecting valid order from block: \"+a.type);var d=a.getInputTargetBlock(b);if(!d)return\"\";b=this.blockToCode(d);if(\"\"===b)return\"\";if(!Array.isArray(b))throw TypeError(\"Expecting tuple from value block: \"+d.type);a=b[0];b=b[1];if(isNaN(b))throw TypeError(\"Expecting valid order from value block: \"+\nd.type);if(!a)return\"\";d=!1;var e=Math.floor(c);const f=Math.floor(b);if(e<=f&&(e!==f||0!==e&&99!==e))for(d=!0,e=0;e<this.ORDER_OVERRIDES.length;e++)if(this.ORDER_OVERRIDES[e][0]===c&&this.ORDER_OVERRIDES[e][1]===b){d=!1;break}d&&(a=\"(\"+a+\")\");return a}statementToCode(a,b){a=a.getInputTargetBlock(b);b=this.blockToCode(a);if(\"string\"!==typeof b)throw TypeError(\"Expecting code from statement block: \"+(a&&a.type));b&&(b=this.prefixLines(b,this.INDENT));return b}addLoopTrap(a,b){this.INFINITE_LOOP_TRAP&&\n(a=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,b),this.INDENT)+a);this.STATEMENT_SUFFIX&&!b.suppressPrefixSuffix&&(a=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,b),this.INDENT)+a);this.STATEMENT_PREFIX&&!b.suppressPrefixSuffix&&(a+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,b),this.INDENT));return a}injectId(a,b){b=b.id.replace(/\\$/g,\"$$$$\");return a.replace(/%1/g,\"'\"+b+\"'\")}addReservedWords(a){this.RESERVED_WORDS_+=a+\",\"}provideFunction_(a,b){if(!this.definitions_[a]){const c=\nthis.nameDB_.getDistinctName(a,$.NameType$$module$build$src$core$names.PROCEDURE);this.functionNames_[a]=c;Array.isArray(b)&&(b=b.join(\"\\n\"));b=b.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,c);let d;for(;d!==b;)d=b,b=b.replace(/^(( {2})*) {2}/gm,\"$1\\x00\");b=b.replace(/\\0/g,this.INDENT);this.definitions_[a]=b}return this.functionNames_[a]}init(a){this.definitions_=Object.create(null);this.functionNames_=Object.create(null)}scrub_(a,b,c){return b}finish(a){this.definitions_=Object.create(null);\nthis.functionNames_=Object.create(null);return a}scrubNakedValue(a){return a}};Object.defineProperties($.CodeGenerator$$module$build$src$core$generator.prototype,{variableDB_:{get(){warn$$module$build$src$core$utils$deprecation(\"variableDB_\",\"version 9\",\"version 10\",\"nameDB_\");return this.nameDB_},set(a){warn$$module$build$src$core$utils$deprecation(\"variableDB_\",\"version 9\",\"version 10\",\"nameDB_\");this.nameDB_=a}}});var module$build$src$core$generator={};\nmodule$build$src$core$generator.CodeGenerator=$.CodeGenerator$$module$build$src$core$generator;var FlyoutButton$$module$build$src$core$flyout_button=class{constructor(a,b,c,d){this.workspace=a;this.targetWorkspace=b;this.isLabel_=d;this.onMouseUpWrapper_=null;this.height=this.width=0;this.svgText_=this.svgGroup_=null;this.text_=c.text;this.position_=new Coordinate$$module$build$src$core$utils$coordinate(0,0);this.callbackKey_=c.callbackKey||c.callbackkey;this.cssClass_=c[\"web-class\"]||null;this.info=c}createDom(){var a=this.isLabel_?\"blocklyFlyoutLabel\":\"blocklyFlyoutButton\";this.cssClass_&&\n(a+=\" \"+this.cssClass_);this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":a},this.workspace.getCanvas());let b;this.isLabel_||(b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":\"blocklyFlyoutButtonShadow\",rx:4,ry:4,x:1,y:1},this.svgGroup_));a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"class\":this.isLabel_?\"blocklyFlyoutLabelBackground\":\n\"blocklyFlyoutButtonBackground\",rx:4,ry:4},this.svgGroup_);const c=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TEXT,{\"class\":this.isLabel_?\"blocklyFlyoutLabelText\":\"blocklyText\",x:0,y:0,\"text-anchor\":\"middle\"},this.svgGroup_);var d=replaceMessageReferences$$module$build$src$core$utils$parsing(this.text_);this.workspace.RTL&&(d+=\"\\u200f\");c.textContent=d;this.isLabel_&&(this.svgText_=c,this.workspace.getThemeManager().subscribe(this.svgText_,\"flyoutForegroundColour\",\n\"fill\"));const e=getComputedStyle$$module$build$src$core$utils$style(c,\"fontSize\"),f=getComputedStyle$$module$build$src$core$utils$style(c,\"fontWeight\"),g=getComputedStyle$$module$build$src$core$utils$style(c,\"fontFamily\");this.width=getFastTextWidthWithSizeString$$module$build$src$core$utils$dom(c,e,f,g);d=measureFontMetrics$$module$build$src$core$utils$dom(d,e,f,g);this.height=d.height;if(!this.isLabel_){this.width+=2*FlyoutButton$$module$build$src$core$flyout_button.TEXT_MARGIN_X;this.height+=\n2*FlyoutButton$$module$build$src$core$flyout_button.TEXT_MARGIN_Y;let h;null==(h=b)||h.setAttribute(\"width\",this.width.toString());let k;null==(k=b)||k.setAttribute(\"height\",this.height.toString())}a.setAttribute(\"width\",this.width.toString());a.setAttribute(\"height\",this.height.toString());c.setAttribute(\"x\",(this.width/2).toString());c.setAttribute(\"y\",(this.height/2-d.height/2+d.baseline).toString());this.updateTransform_();this.onMouseUpWrapper_=conditionalBind$$module$build$src$core$browser_events(this.svgGroup_,\n\"pointerup\",this,this.onMouseUp_);return this.svgGroup_}show(){this.updateTransform_();this.svgGroup_.setAttribute(\"display\",\"block\")}updateTransform_(){this.svgGroup_.setAttribute(\"transform\",\"translate(\"+this.position_.x+\",\"+this.position_.y+\")\")}moveTo(a,b){this.position_.x=a;this.position_.y=b;this.updateTransform_()}isLabel(){return this.isLabel_}getPosition(){return this.position_}getButtonText(){return this.text_}getTargetWorkspace(){return this.targetWorkspace}dispose(){this.onMouseUpWrapper_&&\nunbind$$module$build$src$core$browser_events(this.onMouseUpWrapper_);this.svgGroup_&&removeNode$$module$build$src$core$utils$dom(this.svgGroup_);this.svgText_&&this.workspace.getThemeManager().unsubscribe(this.svgText_)}onMouseUp_(a){(a=this.targetWorkspace.getGesture(a))&&a.cancel();this.isLabel_&&this.callbackKey_?console.warn(\"Labels should not have callbacks. Label text: \"+this.text_):this.isLabel_||this.callbackKey_&&this.targetWorkspace.getButtonCallback(this.callbackKey_)?this.isLabel_||(a=\nthis.targetWorkspace.getButtonCallback(this.callbackKey_))&&a(this):console.warn(\"Buttons should have callbacks. Button text: \"+this.text_)}};FlyoutButton$$module$build$src$core$flyout_button.TEXT_MARGIN_X=5;FlyoutButton$$module$build$src$core$flyout_button.TEXT_MARGIN_Y=2;register$$module$build$src$core$css(\"\\n.blocklyFlyoutButton {\\n  fill: #888;\\n  cursor: default;\\n}\\n\\n.blocklyFlyoutButtonShadow {\\n  fill: #666;\\n}\\n\\n.blocklyFlyoutButton:hover {\\n  fill: #aaa;\\n}\\n\\n.blocklyFlyoutLabel {\\n  cursor: default;\\n}\\n\\n.blocklyFlyoutLabelBackground {\\n  opacity: 0;\\n}\\n\");\nvar module$build$src$core$flyout_button={};module$build$src$core$flyout_button.FlyoutButton=FlyoutButton$$module$build$src$core$flyout_button;var MetricsManager$$module$build$src$core$metrics_manager=class{constructor(a){this.workspace_=a}getDimensionsPx_(a){let b=0,c=0;a&&(b=a.getWidth(),c=a.getHeight());return new Size$$module$build$src$core$utils$size(b,c)}getFlyoutMetrics(a){a=this.getDimensionsPx_(this.workspace_.getFlyout(a));return{width:a.width,height:a.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const a=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:a.width,height:a.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let a=\n0;const b=this.getToolboxMetrics(),c=this.getFlyoutMetrics(!0),d=!!this.workspace_.getToolbox(),e=!!this.workspace_.getFlyout(!0);var f=d?b.position:c.position,g=f===Position$$module$build$src$core$utils$toolbox.LEFT;f=f===Position$$module$build$src$core$utils$toolbox.TOP;d&&g?a=b.width:e&&g&&(a=c.width);g=0;d&&f?g=b.height:e&&f&&(g=c.height);return{top:g,left:a}}getViewMetrics(a){a=a?this.workspace_.scale:1;const b=this.getSvgMetrics(),c=this.getToolboxMetrics(),d=this.getFlyoutMetrics(!0),e=this.workspace_.getToolbox()?\nc.position:d.position;if(this.workspace_.getToolbox())if(e===Position$$module$build$src$core$utils$toolbox.TOP||e===Position$$module$build$src$core$utils$toolbox.BOTTOM)b.height-=c.height;else{if(e===Position$$module$build$src$core$utils$toolbox.LEFT||e===Position$$module$build$src$core$utils$toolbox.RIGHT)b.width-=c.width}else if(this.workspace_.getFlyout(!0))if(e===Position$$module$build$src$core$utils$toolbox.TOP||e===Position$$module$build$src$core$utils$toolbox.BOTTOM)b.height-=d.height;else if(e===\nPosition$$module$build$src$core$utils$toolbox.LEFT||e===Position$$module$build$src$core$utils$toolbox.RIGHT)b.width-=d.width;return{height:b.height/a,width:b.width/a,top:-this.workspace_.scrollY/a,left:-this.workspace_.scrollX/a}}getContentMetrics(a){a=a?1:this.workspace_.scale;const b=this.workspace_.getBlocksBoundingBox();return{height:(b.bottom-b.top)*a,width:(b.right-b.left)*a,top:b.top*a,left:b.left*a}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(a){if(!this.hasFixedEdges())return{};\nconst b=this.workspace_.isMovableHorizontally(),c=this.workspace_.isMovableVertically();a=a||this.getViewMetrics(!1);const d={};c||(d.top=a.top,d.bottom=a.top+a.height);b||(d.left=a.left,d.right=a.left+a.width);return d}getPaddedContent_(a,b){const c=b.top+b.height,d=b.left+b.width,e=a.width;a=a.height;const f=e/2,g=a/2;return{top:Math.min(b.top-g,c-a),bottom:Math.max(c+g,b.top+a),left:Math.min(b.left-f,d-e),right:Math.max(d+f,b.left+e)}}getScrollMetrics(a,b,c){a=a?this.workspace_.scale:1;b=b||this.getViewMetrics(!1);\nvar d=c||this.getContentMetrics();c=this.getComputedFixedEdges_(b);b=this.getPaddedContent_(b,d);d=void 0!==c.top?c.top:b.top;const e=void 0!==c.left?c.left:b.left;return{top:d/a,left:e/a,width:((void 0!==c.right?c.right:b.right)-e)/a,height:((void 0!==c.bottom?c.bottom:b.bottom)-d)/a}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const a=this.getToolboxMetrics(),b=this.getFlyoutMetrics(!0),c=\nthis.getSvgMetrics(),d=this.getAbsoluteMetrics(),e=this.getViewMetrics(),f=this.getContentMetrics(),g=this.getScrollMetrics(!1,e,f);return{contentHeight:f.height,contentWidth:f.width,contentTop:f.top,contentLeft:f.left,scrollHeight:g.height,scrollWidth:g.width,scrollTop:g.top,scrollLeft:g.left,viewHeight:e.height,viewWidth:e.width,viewTop:e.top,viewLeft:e.left,absoluteTop:d.top,absoluteLeft:d.left,svgHeight:c.height,svgWidth:c.width,toolboxWidth:a.width,toolboxHeight:a.height,toolboxPosition:a.position,\nflyoutWidth:b.width,flyoutHeight:b.height}}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.METRICS_MANAGER,DEFAULT$$module$build$src$core$registry,MetricsManager$$module$build$src$core$metrics_manager);var module$build$src$core$metrics_manager={};module$build$src$core$metrics_manager.MetricsManager=MetricsManager$$module$build$src$core$metrics_manager;var FlyoutMetricsManager$$module$build$src$core$flyout_metrics_manager=class extends MetricsManager$$module$build$src$core$metrics_manager{constructor(a,b){super(a);this.flyout_=b}getBoundingBox_(){let a;try{a=this.workspace_.getCanvas().getBBox()}catch(b){a={height:0,y:0,width:0,x:0}}return a}getContentMetrics(a){const b=this.getBoundingBox_();a=a?1:this.workspace_.scale;return{height:b.height*a,width:b.width*a,top:b.y*a,left:b.x*a}}getScrollMetrics(a,b,c){b=c||this.getContentMetrics();c=this.flyout_.MARGIN*\nthis.workspace_.scale;a=a?this.workspace_.scale:1;return{height:(b.height+2*c)/a,width:(b.width+b.left+c)/a,top:0,left:0}}},module$build$src$core$flyout_metrics_manager={};module$build$src$core$flyout_metrics_manager.FlyoutMetricsManager=FlyoutMetricsManager$$module$build$src$core$flyout_metrics_manager;var FlyoutItemType$$module$build$src$core$flyout_base;(function(a){a.BLOCK=\"block\";a.BUTTON=\"button\"})(FlyoutItemType$$module$build$src$core$flyout_base||(FlyoutItemType$$module$build$src$core$flyout_base={}));\nvar Flyout$$module$build$src$core$flyout_base=class extends DeleteArea$$module$build$src$core$delete_area{constructor(a){super();this.horizontalLayout=!1;this.eventWrappers_=[];this.filterWrapper_=this.reflowWrapper_=null;this.mats_=[];this.buttons_=[];this.listeners_=[];this.permanentlyDisabled_=[];this.recycledBlocks_=[];this.autoClose=!0;this.isVisible_=!1;this.containerVisible_=!0;this.CORNER_RADIUS=8;this.SCROLLBAR_MARGIN=2.5;this.height_=this.width_=0;this.dragAngleRange_=70;this.svgGroup_=\nthis.svgBackground_=null;a.setMetrics=this.setMetrics_.bind(this);this.workspace_=new WorkspaceSvg$$module$build$src$core$workspace_svg(a);this.workspace_.setMetricsManager(new FlyoutMetricsManager$$module$build$src$core$flyout_metrics_manager(this.workspace_,this));this.workspace_.internalIsFlyout=!0;this.workspace_.setVisible(this.isVisible_);this.id=genUid$$module$build$src$core$utils$idgenerator();this.RTL=!!a.RTL;this.toolboxPosition_=a.toolboxPosition;this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH;\nthis.rectMap_=new WeakMap;this.MARGIN=this.CORNER_RADIUS;this.GAP_X=3*this.MARGIN;this.GAP_Y=3*this.MARGIN}createDom(a){this.svgGroup_=createSvgElement$$module$build$src$core$utils$dom(a,{\"class\":\"blocklyFlyout\",style:\"display: none\"});this.svgBackground_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyFlyoutBackground\"},this.svgGroup_);this.svgGroup_.appendChild(this.workspace_.createDom());this.workspace_.getThemeManager().subscribe(this.svgBackground_,\n\"flyoutBackgroundColour\",\"fill\");this.workspace_.getThemeManager().subscribe(this.svgBackground_,\"flyoutOpacity\",\"fill-opacity\");return this.svgGroup_}init(a){this.targetWorkspace=a;this.workspace_.targetWorkspace=a;this.workspace_.scrollbar=new ScrollbarPair$$module$build$src$core$scrollbar_pair(this.workspace_,this.horizontalLayout,!this.horizontalLayout,\"blocklyFlyoutScrollbar\",this.SCROLLBAR_MARGIN);this.hide();Array.prototype.push.apply(this.eventWrappers_,conditionalBind$$module$build$src$core$browser_events(this.svgGroup_,\n\"wheel\",this,this.wheel_));this.autoClose||(this.filterWrapper_=this.filterForCapacity_.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper_));Array.prototype.push.apply(this.eventWrappers_,conditionalBind$$module$build$src$core$browser_events(this.svgBackground_,\"pointerdown\",this,this.onMouseDown_));this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace);this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());this.workspace_.createPotentialVariableMap();\na.getComponentManager().addComponent({component:this,weight:1,capabilities:[ComponentManager$$module$build$src$core$component_manager.Capability.DELETE_AREA,ComponentManager$$module$build$src$core$component_manager.Capability.DRAG_TARGET]})}dispose(){this.hide();this.workspace_.getComponentManager().removeComponent(this.id);unbind$$module$build$src$core$browser_events(this.eventWrappers_);this.filterWrapper_&&(this.targetWorkspace.removeChangeListener(this.filterWrapper_),this.filterWrapper_=null);\nthis.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose());this.svgGroup_&&(removeNode$$module$build$src$core$utils$dom(this.svgGroup_),this.svgGroup_=null);this.svgBackground_=null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}isVisible(){return this.isVisible_}setVisible(a){const b=a!==this.isVisible();this.isVisible_=a;b&&(this.autoClose||\nthis.workspace_.recordDragTargets(),this.updateDisplay_())}setContainerVisible(a){const b=a!==this.containerVisible_;this.containerVisible_=a;b&&this.updateDisplay_()}updateDisplay_(){let a;a=this.containerVisible_?this.isVisible():!1;this.svgGroup_&&(this.svgGroup_.style.display=a?\"block\":\"none\");let b;null==(b=this.workspace_.scrollbar)||b.setContainerVisible(a)}positionAt_(a,b,c,d){let e;null==(e=this.svgGroup_)||e.setAttribute(\"width\",a.toString());let f;null==(f=this.svgGroup_)||f.setAttribute(\"height\",\nb.toString());this.workspace_.setCachedParentSvgSize(a,b);let g;if(\"svg\"===(null==(g=this.svgGroup_)?void 0:g.tagName))setCssTransform$$module$build$src$core$utils$dom(this.svgGroup_,\"translate(\"+c+\"px,\"+d+\"px)\");else{let h;null==(h=this.svgGroup_)||h.setAttribute(\"transform\",\"translate(\"+c+\",\"+d+\")\")}if(a=this.workspace_.scrollbar)a.setOrigin(c,d),a.resize(),a.hScroll&&a.hScroll.setPosition(a.hScroll.position.x,a.hScroll.position.y),a.vScroll&&a.vScroll.setPosition(a.vScroll.position.x,a.vScroll.position.y)}hide(){if(this.isVisible()){this.setVisible(!1);\nfor(let a=0,b;b=this.listeners_[a];a++)unbind$$module$build$src$core$browser_events(b);this.listeners_.length=0;this.reflowWrapper_&&(this.workspace_.removeChangeListener(this.reflowWrapper_),this.reflowWrapper_=null)}}show(a){this.workspace_.setResizesEnabled(!1);this.hide();this.clearOldBlocks_();\"string\"===typeof a&&(a=this.getDynamicCategoryContents_(a));this.setVisible(!0);a=convertFlyoutDefToJsonArray$$module$build$src$core$utils$toolbox(a);a=this.createFlyoutInfo_(a);this.layout_(a.contents,\na.gaps);this.listeners_.push(conditionalBind$$module$build$src$core$browser_events(this.svgBackground_,\"pointerover\",this,function(){const b=this.workspace_.getTopBlocks(!1);for(let c=0,d;d=b[c];c++)d.removeSelect()}));this.horizontalLayout?this.height_=0:this.width_=0;this.workspace_.setResizesEnabled(!0);this.reflow();this.filterForCapacity_();this.position();this.reflowWrapper_=this.reflow.bind(this);this.workspace_.addChangeListener(this.reflowWrapper_);this.emptyRecycledBlocks_()}createFlyoutInfo_(a){const b=\n[],c=[];this.permanentlyDisabled_.length=0;const d=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(let f=0,g;g=a[f];f++){if(\"custom\"in g){var e=this.getDynamicCategoryContents_(g.custom);e=convertFlyoutDefToJsonArray$$module$build$src$core$utils$toolbox(e);a.splice.apply(a,[f,1,...e]);g=a[f]}switch(g.kind.toUpperCase()){case \"BLOCK\":e=g;const h=this.createFlyoutBlock_(e);b.push({type:FlyoutItemType$$module$build$src$core$flyout_base.BLOCK,block:h});this.addBlockGap_(e,c,d);break;case \"SEP\":this.addSeparatorGap_(g,\nc,d);break;case \"LABEL\":e=this.createButton_(g,!0);b.push({type:FlyoutItemType$$module$build$src$core$flyout_base.BUTTON,button:e});c.push(d);break;case \"BUTTON\":e=this.createButton_(g,!1),b.push({type:FlyoutItemType$$module$build$src$core$flyout_base.BUTTON,button:e}),c.push(d)}}return{contents:b,gaps:c}}getDynamicCategoryContents_(a){a=this.workspace_.targetWorkspace.getToolboxCategoryCallback(a);if(\"function\"!==typeof a)throw TypeError(\"Couldn't find a callback function when opening a toolbox category.\");\nreturn a(this.workspace_.targetWorkspace)}createButton_(a,b){return new FlyoutButton$$module$build$src$core$flyout_button(this.workspace_,this.targetWorkspace,a,b)}createFlyoutBlock_(a){let b;a.blockxml?(a=\"string\"===typeof a.blockxml?textToDom$$module$build$src$core$xml(a.blockxml):a.blockxml,(b=this.getRecycledBlock_(a.getAttribute(\"type\")))||(b=domToBlock$$module$build$src$core$xml(a,this.workspace_))):(b=this.getRecycledBlock_(a.type),b||(void 0===a.enabled&&(a.enabled=\"true\"!==a.disabled&&!0!==\na.disabled),b=append$$module$build$src$core$serialization$blocks(a,this.workspace_)));b.isEnabled()||this.permanentlyDisabled_.push(b);return b}getRecycledBlock_(a){let b=-1;for(let c=0;c<this.recycledBlocks_.length;c++)if(this.recycledBlocks_[c].type===a){b=c;break}return-1===b?void 0:this.recycledBlocks_.splice(b,1)[0]}addBlockGap_(a,b,c){let d;a.gap?d=parseInt(a.gap.toString()):a.blockxml&&(a=\"string\"===typeof a.blockxml?textToDom$$module$build$src$core$xml(a.blockxml):a.blockxml,d=parseInt(a.getAttribute(\"gap\")));\nb.push(!d||isNaN(d)?c:d)}addSeparatorGap_(a,b,c){a=parseInt(a.gap.toString());!isNaN(a)&&0<b.length?b[b.length-1]=a:b.push(c)}clearOldBlocks_(){var a=this.workspace_.getTopBlocks(!1);for(let c=0,d;d=a[c];c++)this.blockIsRecyclable_(d)?this.recycleBlock_(d):d.dispose(!1,!1);for(a=0;a<this.mats_.length;a++){const c=this.mats_[a];c&&(unbindMouseEvents$$module$build$src$core$tooltip(c),removeNode$$module$build$src$core$utils$dom(c))}this.mats_.length=0;for(let c=0,d;d=this.buttons_[c];c++)d.dispose();\nthis.buttons_.length=0;let b;null==(b=this.workspace_.getPotentialVariableMap())||b.clear()}emptyRecycledBlocks_(){for(let a=0;a<this.recycledBlocks_.length;a++)this.recycledBlocks_[a].dispose();this.recycledBlocks_=[]}blockIsRecyclable_(a){return!1}recycleBlock_(a){const b=a.getRelativeToSurfaceXY();a.moveBy(-b.x,-b.y);this.recycledBlocks_.push(a)}addBlockListeners_(a,b,c){this.listeners_.push(conditionalBind$$module$build$src$core$browser_events(a,\"pointerdown\",null,this.blockMouseDown_(b)));this.listeners_.push(conditionalBind$$module$build$src$core$browser_events(c,\n\"pointerdown\",null,this.blockMouseDown_(b)));this.listeners_.push(bind$$module$build$src$core$browser_events(a,\"pointerenter\",b,b.addSelect));this.listeners_.push(bind$$module$build$src$core$browser_events(a,\"pointerleave\",b,b.removeSelect));this.listeners_.push(bind$$module$build$src$core$browser_events(c,\"pointerenter\",b,b.addSelect));this.listeners_.push(bind$$module$build$src$core$browser_events(c,\"pointerleave\",b,b.removeSelect))}blockMouseDown_(a){return b=>{const c=this.targetWorkspace.getGesture(b);\nc&&(c.setStartBlock(a),c.handleFlyoutStart(b,this))}}onMouseDown_(a){const b=this.targetWorkspace.getGesture(a);b&&b.handleFlyoutStart(a,this)}isBlockCreatable(a){return a.isEnabled()}createBlock(a){let b=null;disable$$module$build$src$core$events$utils();var c=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{b=this.placeNewBlock_(a)}finally{enable$$module$build$src$core$events$utils()}this.targetWorkspace.hideChaff();a=getAddedVariables$$module$build$src$core$variables(this.targetWorkspace,\nc);if(isEnabled$$module$build$src$core$events$utils()){setGroup$$module$build$src$core$events$utils(!0);for(c=0;c<a.length;c++){const d=a[c];fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(VAR_CREATE$$module$build$src$core$events$utils))(d))}fire$$module$build$src$core$events$utils(new (get$$module$build$src$core$events$utils(CREATE$$module$build$src$core$events$utils))(b))}this.autoClose?this.hide():this.filterForCapacity_();return b}initFlyoutButton_(a,b,c){const d=\na.createDom();a.moveTo(b,c);a.show();this.listeners_.push(conditionalBind$$module$build$src$core$browser_events(d,\"pointerdown\",this,this.onMouseDown_));this.buttons_.push(a)}createRect_(a,b,c,d,e){b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.RECT,{\"fill-opacity\":0,x:b,y:c,height:d.height,width:d.width});b.tooltip=a;bindMouseEvents$$module$build$src$core$tooltip(b);this.workspace_.getCanvas().insertBefore(b,a.getSvgRoot());this.rectMap_.set(a,b);return this.mats_[e]=\nb}moveRectToBlock_(a,b){const c=b.getHeightWidth();a.setAttribute(\"width\",c.width.toString());a.setAttribute(\"height\",c.height.toString());b=b.getRelativeToSurfaceXY();a.setAttribute(\"y\",b.y.toString());a.setAttribute(\"x\",(this.RTL?b.x-c.width:b.x).toString())}filterForCapacity_(){const a=this.workspace_.getTopBlocks(!1);for(let b=0,c;c=a[b];b++)if(-1===this.permanentlyDisabled_.indexOf(c)){const d=this.targetWorkspace.isCapacityAvailable(getBlockTypeCounts$$module$build$src$core$common(c));for(;c;)c.setEnabled(d),\nc=c.getNextBlock()}}reflow(){this.reflowWrapper_&&this.workspace_.removeChangeListener(this.reflowWrapper_);this.reflowInternal_();this.reflowWrapper_&&this.workspace_.addChangeListener(this.reflowWrapper_)}isScrollable(){return this.workspace_.scrollbar?this.workspace_.scrollbar.isVisible():!1}placeNewBlock_(a){var b=this.targetWorkspace;if(!a.getSvgRoot())throw Error(\"oldBlock is not rendered.\");const c=save$$module$build$src$core$serialization$blocks(a);b.setResizesEnabled(!1);b=append$$module$build$src$core$serialization$blocks(c,\nb);this.positionNewBlock_(a,b);return b}positionNewBlock_(a,b){const c=this.targetWorkspace;var d=c.getOriginOffsetInPixels(),e=this.workspace_.getOriginOffsetInPixels();a=a.getRelativeToSurfaceXY();a.scale(this.workspace_.scale);e=Coordinate$$module$build$src$core$utils$coordinate.sum(e,a);d=Coordinate$$module$build$src$core$utils$coordinate.difference(e,d);d.scale(1/c.scale);b.moveTo(new Coordinate$$module$build$src$core$utils$coordinate(d.x,d.y))}};\nFlyout$$module$build$src$core$flyout_base.FlyoutItemType=FlyoutItemType$$module$build$src$core$flyout_base;var module$build$src$core$flyout_base={};module$build$src$core$flyout_base.Flyout=Flyout$$module$build$src$core$flyout_base;var VerticalFlyout$$module$build$src$core$flyout_vertical=class extends Flyout$$module$build$src$core$flyout_base{constructor(a){super(a)}setMetrics_(a){if(this.isVisible()){var b=this.workspace_.getMetricsManager(),c=b.getScrollMetrics(),d=b.getViewMetrics();b=b.getAbsoluteMetrics();\"number\"===typeof a.y&&(this.workspace_.scrollY=-(c.top+(c.height-d.height)*a.y));this.workspace_.translate(this.workspace_.scrollX+b.left,this.workspace_.scrollY+b.top)}}getX(){if(!this.isVisible())return 0;var a=this.targetWorkspace.getMetricsManager();\nconst b=a.getAbsoluteMetrics(),c=a.getViewMetrics();a=a.getToolboxMetrics();return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.LEFT?a.width:c.width-this.width_:this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.LEFT?0:c.width:this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.LEFT?0:c.width+b.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&\nthis.targetWorkspace.isVisible()){var a=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=a.height;this.setBackgroundPath_(this.width_-this.CORNER_RADIUS,a.height-2*this.CORNER_RADIUS);a=this.getX();var b=this.getY();this.positionAt_(this.width_,this.height_,a,b)}}setBackgroundPath_(a,b){const c=this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.RIGHT;var d=a+this.CORNER_RADIUS;d=[\"M \"+(c?d:0)+\",0\"];d.push(\"h\",c?-a:a);d.push(\"a\",this.CORNER_RADIUS,this.CORNER_RADIUS,\n0,0,c?0:1,c?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS);d.push(\"v\",Math.max(0,b));d.push(\"a\",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,c?0:1,c?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS);d.push(\"h\",c?a:-a);d.push(\"z\");this.svgBackground_.setAttribute(\"d\",d.join(\" \"))}scrollToStart(){let a;null==(a=this.workspace_.scrollbar)||a.setY(0)}wheel_(a){var b=getScrollDeltaPixels$$module$build$src$core$browser_events(a);if(b.y){const c=this.workspace_.getMetricsManager(),d=c.getScrollMetrics();\nb=c.getViewMetrics().top-d.top+b.y;let e;null==(e=this.workspace_.scrollbar)||e.setY(b);hide$$module$build$src$core$widgetdiv();hideWithoutAnimation$$module$build$src$core$dropdowndiv()}a.preventDefault();a.stopPropagation()}layout_(a,b){this.workspace_.scale=this.targetWorkspace.scale;var c=this.MARGIN;const d=this.RTL?c:c+this.tabWidth_;for(let h=0,k;k=a[h];h++)if(\"block\"===k.type){var e=k.block,f=e.getDescendants(!1);for(let m=0,n;n=f[m];m++)n.isInFlyout=!0;e.render();f=e.getSvgRoot();const l=\ne.getHeightWidth();var g=e.outputConnection?d-this.tabWidth_:d;e.moveBy(g,c);g=this.createRect_(e,this.RTL?g-l.width:g,c,l,h);this.addBlockListeners_(f,e,g);c+=l.height+b[h]}else\"button\"===k.type&&(e=k.button,this.initFlyoutButton_(e,d,c),c+=e.height+b[h])}isDragTowardWorkspace(a){a=Math.atan2(a.y,a.x)/Math.PI*180;const b=this.dragAngleRange_;return a<b&&a>-b||a<-180+b||a>180-b?!0:!1}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const a=this.svgGroup_.getBoundingClientRect(),\nb=a.left;return this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.LEFT?new Rect$$module$build$src$core$utils$rect(-1E9,1E9,-1E9,b+a.width):new Rect$$module$build$src$core$utils$rect(-1E9,1E9,b,1E9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let a=0;var b=this.workspace_.getTopBlocks(!1);for(let d=0,e;e=b[d];d++){var c=e.getHeightWidth().width;e.outputConnection&&(c-=this.tabWidth_);a=Math.max(a,c)}for(let d=0,e;e=this.buttons_[d];d++)a=Math.max(a,e.width);a+=\n1.5*this.MARGIN+this.tabWidth_;a*=this.workspace_.scale;a+=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness;if(this.width_!==a){for(let d=0,e;e=b[d];d++){if(this.RTL){c=e.getRelativeToSurfaceXY().x;let f=a/this.workspace_.scale-this.MARGIN;e.outputConnection||(f-=this.tabWidth_);e.moveBy(f-c,0)}this.rectMap_.has(e)&&this.moveRectToBlock_(this.rectMap_.get(e),e)}if(this.RTL)for(let d=0,e;e=this.buttons_[d];d++)b=e.getPosition().y,e.moveTo(a/this.workspace_.scale-e.width-this.MARGIN-this.tabWidth_,\nb);this.targetWorkspace.toolboxPosition!==this.toolboxPosition_||this.toolboxPosition_!==Position$$module$build$src$core$utils$toolbox.LEFT||this.targetWorkspace.getToolbox()||this.targetWorkspace.translate(this.targetWorkspace.scrollX+a,this.targetWorkspace.scrollY);this.width_=a;this.position();this.targetWorkspace.recordDragTargets()}}};VerticalFlyout$$module$build$src$core$flyout_vertical.registryName=\"verticalFlyout\";\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_VERTICAL_TOOLBOX,DEFAULT$$module$build$src$core$registry,VerticalFlyout$$module$build$src$core$flyout_vertical);var module$build$src$core$flyout_vertical={};module$build$src$core$flyout_vertical.VerticalFlyout=VerticalFlyout$$module$build$src$core$flyout_vertical;var HorizontalFlyout$$module$build$src$core$flyout_horizontal=class extends Flyout$$module$build$src$core$flyout_base{constructor(a){super(a);this.horizontalLayout=!0}setMetrics_(a){if(this.isVisible()){var b=this.workspace_.getMetricsManager(),c=b.getScrollMetrics(),d=b.getViewMetrics();b=b.getAbsoluteMetrics();\"number\"===typeof a.x&&(this.workspace_.scrollX=-(c.left+(c.width-d.width)*a.x));this.workspace_.translate(this.workspace_.scrollX+b.left,this.workspace_.scrollY+b.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;\nvar a=this.targetWorkspace.getMetricsManager();const b=a.getAbsoluteMetrics(),c=a.getViewMetrics();a=a.getToolboxMetrics();const d=this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?d?a.height:c.height-this.height_:d?0:c.height:d?0:c.height+b.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var a=this.targetWorkspace.getMetricsManager().getViewMetrics();\nthis.width_=a.width;this.setBackgroundPath_(a.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS);a=this.getX();var b=this.getY();this.positionAt_(this.width_,this.height_,a,b)}}setBackgroundPath_(a,b){const c=this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.TOP,d=[\"M 0,\"+(c?0:this.CORNER_RADIUS)];c?(d.push(\"h\",a+2*this.CORNER_RADIUS),d.push(\"v\",b),d.push(\"a\",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),d.push(\"h\",-a),d.push(\"a\",\nthis.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(d.push(\"a\",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),d.push(\"h\",a),d.push(\"a\",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),d.push(\"v\",b),d.push(\"h\",-a-2*this.CORNER_RADIUS));d.push(\"z\");this.svgBackground_.setAttribute(\"d\",d.join(\" \"))}scrollToStart(){let a;null==(a=this.workspace_.scrollbar)||a.setX(this.RTL?Infinity:0)}wheel_(a){var b=\ngetScrollDeltaPixels$$module$build$src$core$browser_events(a);if(b=b.x||b.y){const c=this.workspace_.getMetricsManager(),d=c.getScrollMetrics();b=c.getViewMetrics().left-d.left+b;let e;null==(e=this.workspace_.scrollbar)||e.setX(b);hide$$module$build$src$core$widgetdiv();hideWithoutAnimation$$module$build$src$core$dropdowndiv()}a.preventDefault();a.stopPropagation()}layout_(a,b){this.workspace_.scale=this.targetWorkspace.scale;const c=this.MARGIN;let d=c+this.tabWidth_;this.RTL&&(a=a.reverse());for(let h=\n0,k;k=a[h];h++)if(\"block\"===k.type){var e=k.block,f=e.getDescendants(!1);for(let m=0,n;n=f[m];m++)n.isInFlyout=!0;e.render();f=e.getSvgRoot();const l=e.getHeightWidth();var g=e.outputConnection?this.tabWidth_:0;g=this.RTL?d+l.width:d-g;e.moveBy(g,c);g=this.createRect_(e,g,c,l,h);d+=l.width+b[h];this.addBlockListeners_(f,e,g)}else\"button\"===k.type&&(e=k.button,this.initFlyoutButton_(e,d,c),d+=e.width+b[h])}isDragTowardWorkspace(a){a=Math.atan2(a.y,a.x)/Math.PI*180;const b=this.dragAngleRange_;return a<\n90+b&&a>90-b||a>-90-b&&a<-90+b?!0:!1}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const a=this.svgGroup_.getBoundingClientRect(),b=a.top;return this.toolboxPosition_===Position$$module$build$src$core$utils$toolbox.TOP?new Rect$$module$build$src$core$utils$rect(-1E9,b+a.height,-1E9,1E9):new Rect$$module$build$src$core$utils$rect(b,1E9,-1E9,1E9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let a=0;const b=this.workspace_.getTopBlocks(!1);for(let d=\n0,e;e=b[d];d++)a=Math.max(a,e.getHeightWidth().height);const c=this.buttons_;for(let d=0,e;e=c[d];d++)a=Math.max(a,e.height);a+=1.5*this.MARGIN;a*=this.workspace_.scale;a+=Scrollbar$$module$build$src$core$scrollbar.scrollbarThickness;if(this.height_!==a){for(let d=0,e;e=b[d];d++)this.rectMap_.has(e)&&this.moveRectToBlock_(this.rectMap_.get(e),e);this.targetWorkspace.toolboxPosition!==this.toolboxPosition_||this.toolboxPosition_!==Position$$module$build$src$core$utils$toolbox.TOP||this.targetWorkspace.getToolbox()||\nthis.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+a);this.height_=a;this.position();this.targetWorkspace.recordDragTargets()}}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.FLYOUTS_HORIZONTAL_TOOLBOX,DEFAULT$$module$build$src$core$registry,HorizontalFlyout$$module$build$src$core$flyout_horizontal);var module$build$src$core$flyout_horizontal={};module$build$src$core$flyout_horizontal.HorizontalFlyout=HorizontalFlyout$$module$build$src$core$flyout_horizontal;var FieldVariable$$module$build$src$core$field_variable=class extends FieldDropdown$$module$build$src$core$field_dropdown{constructor(a,b,c,d,e){super(Field$$module$build$src$core$field.SKIP_SETUP);this.defaultType_=\"\";this.variableTypes=[];this.variable_=null;this.SERIALIZABLE=!0;this.menuGenerator_=FieldVariable$$module$build$src$core$field_variable.dropdownCreate;this.defaultVariableName=\"string\"===typeof a?a:\"\";this.size_=new Size$$module$build$src$core$utils$size(0,0);a!==Field$$module$build$src$core$field.SKIP_SETUP&&\n(e?this.configure_(e):this.setTypes_(c,d),b&&this.setValidator(b))}configure_(a){super.configure_(a);this.setTypes_(a.variableTypes,a.defaultType)}initModel(){var a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;this.variable_||(a=getOrCreateVariablePackage$$module$build$src$core$variables(a.workspace,null,this.defaultVariableName,this.defaultType_),this.doValueUpdate_(a.getId()))}shouldAddBorderRect_(){const a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;\nreturn super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||\"variables_get\"!==a.type)}fromXml(a){var b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;const c=a.getAttribute(\"id\"),d=a.textContent,e=a.getAttribute(\"variabletype\")||a.getAttribute(\"variableType\")||\"\";b=getOrCreateVariablePackage$$module$build$src$core$variables(b.workspace,c,d,e);if(null!==e&&e!==b.type)throw Error(\"Serialized variable type with id '\"+b.getId()+\n\"' had type \"+b.type+\", and does not match variable field that references it: \"+domToText$$module$build$src$core$xml(a)+\".\");this.setValue(b.getId())}toXml(a){this.initModel();a.id=this.variable_.getId();a.textContent=this.variable_.name;this.variable_.type&&a.setAttribute(\"variabletype\",this.variable_.type);return a}saveState(a){var b=this.saveLegacyState(FieldVariable$$module$build$src$core$field_variable);if(null!==b)return b;this.initModel();b={id:this.variable_.getId()};a&&(b.name=this.variable_.name,\nb.type=this.variable_.type);return b}loadState(a){const b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;this.loadLegacyState(FieldVariable$$module$build$src$core$field_variable,a)||(a=getOrCreateVariablePackage$$module$build$src$core$variables(b.workspace,a.id||null,a.name,a.type||\"\"),this.setValue(a.getId()))}setSourceBlock(a){if(a.isShadow())throw Error(\"Variable fields are not allowed to exist on shadow blocks.\");super.setSourceBlock(a)}getValue(){return this.variable_?\nthis.variable_.getId():null}getText(){return this.variable_?this.variable_.name:\"\"}getVariable(){return this.variable_}getValidator(){return this.variable_?this.validator_:null}doClassValidation_(a){if(null===a)return null;var b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;b=getVariable$$module$build$src$core$variables(b.workspace,a);if(!b)return console.warn(\"Variable id doesn't point to a real variable! ID was \"+a),null;b=b.type;return this.typeIsAllowed_(b)?\na:(console.warn(\"Variable type doesn't match this field!  Type was \"+b),null)}doValueUpdate_(a){const b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;this.variable_=getVariable$$module$build$src$core$variables(b.workspace,a);super.doValueUpdate_(a)}typeIsAllowed_(a){const b=this.getVariableTypes_();if(!b)return!0;for(let c=0;c<b.length;c++)if(a===b[c])return!0;return!1}getVariableTypes_(){var a=this.variableTypes;if(null===a&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();\na=a||[\"\"];if(0===a.length)throw a=this.getText(),Error(\"'variableTypes' of field variable \"+a+\" was an empty list\");return a}setTypes_(a,b){b=b||\"\";if(null===a||void 0===a)a=null;else if(Array.isArray(a)){let c=!1;for(let d=0;d<a.length;d++)a[d]===b&&(c=!0);if(!c)throw Error(\"Invalid default type '\"+b+\"' in the definition of a FieldVariable\");}else throw Error(\"'variableTypes' was not an array in the definition of a FieldVariable\");this.defaultType_=b;this.variableTypes=a}refreshVariableName(){this.forceRerender()}onItemSelected_(a,\nb){a=b.getValue();if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if(a===RENAME_VARIABLE_ID$$module$build$src$core$internal_constants){renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable_);return}if(a===DELETE_VARIABLE_ID$$module$build$src$core$internal_constants){this.sourceBlock_.workspace.deleteVariableById(this.variable_.getId());return}}this.setValue(a)}referencesVariables(){return!0}static fromJson(a){return new this(replaceMessageReferences$$module$build$src$core$utils$parsing(a.variable),\nvoid 0,void 0,void 0,a)}static dropdownCreate(){if(!this.variable_)throw Error(\"Tried to call dropdownCreate on a variable field with no variable selected.\");const a=this.getText();let b=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){var c=this.getVariableTypes_();for(var d=0;d<c.length;d++){const e=this.sourceBlock_.workspace.getVariablesOfType(c[d]);b=b.concat(e)}}b.sort(VariableModel$$module$build$src$core$variable_model.compareByName);c=[];for(d=0;d<b.length;d++)c[d]=[b[d].name,\nb[d].getId()];c.push([Msg$$module$build$src$core$msg.RENAME_VARIABLE,RENAME_VARIABLE_ID$$module$build$src$core$internal_constants]);Msg$$module$build$src$core$msg.DELETE_VARIABLE&&c.push([Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace(\"%1\",a),DELETE_VARIABLE_ID$$module$build$src$core$internal_constants]);return c}};register$$module$build$src$core$field_registry(\"field_variable\",FieldVariable$$module$build$src$core$field_variable);var module$build$src$core$field_variable={};\nmodule$build$src$core$field_variable.FieldVariable=FieldVariable$$module$build$src$core$field_variable;var FieldNumber$$module$build$src$core$field_number=class extends FieldInput$$module$build$src$core$field_input{constructor(a,b,c,d,e,f){super(Field$$module$build$src$core$field.SKIP_SETUP);this.min_=-Infinity;this.max_=Infinity;this.precision_=0;this.decimalPlaces_=null;this.SERIALIZABLE=!0;this.spellcheck_=!1;a!==Field$$module$build$src$core$field.SKIP_SETUP&&(f?this.configure_(f):this.setConstraints(b,c,d),this.setValue(a),e&&this.setValidator(e))}configure_(a){super.configure_(a);this.setMinInternal_(a.min);\nthis.setMaxInternal_(a.max);this.setPrecisionInternal_(a.precision)}setConstraints(a,b,c){this.setMinInternal_(a);this.setMaxInternal_(b);this.setPrecisionInternal_(c);this.setValue(this.getValue())}setMin(a){this.setMinInternal_(a);this.setValue(this.getValue())}setMinInternal_(a){null==a?this.min_=-Infinity:(a=Number(a),isNaN(a)||(this.min_=a))}getMin(){return this.min_}setMax(a){this.setMaxInternal_(a);this.setValue(this.getValue())}setMaxInternal_(a){null==a?this.max_=Infinity:(a=Number(a),isNaN(a)||\n(this.max_=a))}getMax(){return this.max_}setPrecision(a){this.setPrecisionInternal_(a);this.setValue(this.getValue())}setPrecisionInternal_(a){this.precision_=Number(a)||0;let b=String(this.precision_);-1!==b.indexOf(\"e\")&&(b=this.precision_.toLocaleString(\"en-US\",{maximumFractionDigits:20}));const c=b.indexOf(\".\");this.decimalPlaces_=-1===c?a?0:null:b.length-c-1}getPrecision(){return this.precision_}doClassValidation_(a){if(null===a)return null;a=String(a);a=a.replace(/O/ig,\"0\");a=a.replace(/,/g,\n\"\");a=a.replace(/infinity/i,\"Infinity\");a=Number(a||0);if(isNaN(a))return null;a=Math.min(Math.max(a,this.min_),this.max_);this.precision_&&isFinite(a)&&(a=Math.round(a/this.precision_)*this.precision_);null!==this.decimalPlaces_&&(a=Number(a.toFixed(this.decimalPlaces_)));return a}widgetCreate_(){const a=super.widgetCreate_();-Infinity<this.min_&&setState$$module$build$src$core$utils$aria(a,State$$module$build$src$core$utils$aria.VALUEMIN,this.min_);Infinity>this.max_&&setState$$module$build$src$core$utils$aria(a,\nState$$module$build$src$core$utils$aria.VALUEMAX,this.max_);return a}static fromJson(a){return new this(a.value,void 0,void 0,void 0,void 0,a)}};register$$module$build$src$core$field_registry(\"field_number\",FieldNumber$$module$build$src$core$field_number);FieldNumber$$module$build$src$core$field_number.prototype.DEFAULT_VALUE=0;var module$build$src$core$field_number={};module$build$src$core$field_number.FieldNumber=FieldNumber$$module$build$src$core$field_number;var FieldMultilineInput$$module$build$src$core$field_multilineinput=class extends $.FieldTextInput$$module$build$src$core$field_textinput{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.textGroup_=null;this.maxLines_=Infinity;this.isOverflowedY_=!1;a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(a),b&&this.setValidator(b))}configure_(a){super.configure_(a);a.maxLines&&this.setMaxLines(a.maxLines)}toXml(a){a.textContent=this.getValue().replace(/\\n/g,\n\"&#10;\");return a}fromXml(a){this.setValue(a.textContent.replace(/&#10;/g,\"\\n\"))}saveState(){const a=this.saveLegacyState(FieldMultilineInput$$module$build$src$core$field_multilineinput);return null!==a?a:this.getValue()}loadState(a){this.loadLegacyState(Field$$module$build$src$core$field,a)||this.setValue(a)}initView(){this.createBorderRect_();this.textGroup_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.G,{\"class\":\"blocklyEditableText\"},this.fieldGroup_)}getDisplayText_(){const a=\nthis.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;let b=this.getText();if(!b)return Field$$module$build$src$core$field.NBSP;const c=b.split(\"\\n\");b=\"\";const d=this.isOverflowedY_?this.maxLines_:c.length;for(let e=0;e<d;e++){let f=c[e];f.length>this.maxDisplayLength?f=f.substring(0,this.maxDisplayLength-4)+\"...\":this.isOverflowedY_&&e===d-1&&(f=f.substring(0,f.length-3)+\"...\");f=f.replace(/\\s/g,Field$$module$build$src$core$field.NBSP);b+=f;e!==d-1&&(b+=\"\\n\")}a.RTL&&\n(b+=\"\\u200f\");return b}doValueUpdate_(a){super.doValueUpdate_(a);this.isOverflowedY_=this.value_.split(\"\\n\").length>this.maxLines_}render_(){var a=this.getSourceBlock();if(!a)throw new UnattachedFieldError$$module$build$src$core$field;for(var b;b=this.textGroup_.firstChild;)this.textGroup_.removeChild(b);b=this.getDisplayText_().split(\"\\n\");let c=0;for(let d=0;d<b.length;d++){const e=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TEXT,\n{\"class\":\"blocklyText blocklyMultilineText\",x:this.getConstants().FIELD_BORDER_RECT_X_PADDING,y:c+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,dy:this.getConstants().FIELD_TEXT_BASELINE},this.textGroup_).appendChild(document.createTextNode(b[d]));c+=e}this.isBeingEdited_&&(b=this.htmlInput_,this.isOverflowedY_?addClass$$module$build$src$core$utils$dom(b,\"blocklyHtmlTextAreaInputOverflowedY\"):removeClass$$module$build$src$core$utils$dom(b,\"blocklyHtmlTextAreaInputOverflowedY\"));this.updateSize_();\nthis.isBeingEdited_&&(a.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),a=this.htmlInput_,this.isTextValid_?(removeClass$$module$build$src$core$utils$dom(a,\"blocklyInvalidInput\"),setState$$module$build$src$core$utils$aria(a,State$$module$build$src$core$utils$aria.INVALID,!1)):(addClass$$module$build$src$core$utils$dom(a,\"blocklyInvalidInput\"),setState$$module$build$src$core$utils$aria(a,State$$module$build$src$core$utils$aria.INVALID,!0)))}updateSize_(){var a=this.textGroup_.childNodes;\nconst b=this.getConstants().FIELD_TEXT_FONTSIZE,c=this.getConstants().FIELD_TEXT_FONTWEIGHT,d=this.getConstants().FIELD_TEXT_FONTFAMILY;let e=0,f=0;for(var g=0;g<a.length;g++){var h=getFastTextWidth$$module$build$src$core$utils$dom(a[g],b,c,d);h>e&&(e=h);f+=this.getConstants().FIELD_TEXT_HEIGHT+(0<g?this.getConstants().FIELD_BORDER_RECT_Y_PADDING:0)}if(this.isBeingEdited_){a=this.value_.split(\"\\n\");g=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TEXT,{\"class\":\"blocklyText blocklyMultilineText\"});\nfor(h=0;h<a.length;h++){a[h].length>this.maxDisplayLength&&(a[h]=a[h].substring(0,this.maxDisplayLength));g.textContent=a[h];const k=getFastTextWidth$$module$build$src$core$utils$dom(g,b,c,d);k>e&&(e=k)}e+=this.htmlInput_.offsetWidth-this.htmlInput_.clientWidth}this.borderRect_&&(f+=2*this.getConstants().FIELD_BORDER_RECT_Y_PADDING,e+=2*this.getConstants().FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute(\"width\",e),this.borderRect_.setAttribute(\"height\",f));this.size_.width=e;this.size_.height=\nf;this.positionBorderRect_()}showEditor_(a,b){super.showEditor_(a,b);this.forceRerender()}widgetCreate_(){const a=getDiv$$module$build$src$core$widgetdiv(),b=this.workspace_.getScale(),c=document.createElement(\"textarea\");c.className=\"blocklyHtmlInput blocklyHtmlTextAreaInput\";c.setAttribute(\"spellcheck\",this.spellcheck_);var d=this.getConstants().FIELD_TEXT_FONTSIZE*b+\"pt\";a.style.fontSize=d;c.style.fontSize=d;c.style.borderRadius=$.FieldTextInput$$module$build$src$core$field_textinput.BORDERRADIUS*\nb+\"px\";d=this.getConstants().FIELD_BORDER_RECT_X_PADDING*b;const e=this.getConstants().FIELD_BORDER_RECT_Y_PADDING*b/2;c.style.padding=e+\"px \"+d+\"px \"+e+\"px \"+d+\"px\";d=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;c.style.lineHeight=d*b+\"px\";a.appendChild(c);c.value=c.defaultValue=this.getEditorText_(this.value_);c.setAttribute(\"data-untyped-default-value\",this.value_);c.setAttribute(\"data-old-value\",\"\");GECKO$$module$build$src$core$utils$useragent?setTimeout(this.resizeEditor_.bind(this),\n0):this.resizeEditor_();this.bindInputEvents_(c);return c}setMaxLines(a){\"number\"===typeof a&&0<a&&a!==this.maxLines_&&(this.maxLines_=a,this.forceRerender())}getMaxLines(){return this.maxLines_}onHtmlInputKeyDown_(a){if(a.keyCode!==KeyCodes$$module$build$src$core$utils$keycodes.ENTER)super.onHtmlInputKeyDown_(a)}static fromJson(a){return new this(replaceMessageReferences$$module$build$src$core$utils$parsing(a.text),void 0,a)}};register$$module$build$src$core$css(\"\\n.blocklyHtmlTextAreaInput {\\n  font-family: monospace;\\n  resize: none;\\n  overflow: hidden;\\n  height: 100%;\\n  text-align: left;\\n}\\n\\n.blocklyHtmlTextAreaInputOverflowedY {\\n  overflow-y: scroll;\\n}\\n\");\nregister$$module$build$src$core$field_registry(\"field_multilinetext\",FieldMultilineInput$$module$build$src$core$field_multilineinput);var module$build$src$core$field_multilineinput={};module$build$src$core$field_multilineinput.FieldMultilineInput=FieldMultilineInput$$module$build$src$core$field_multilineinput;var FieldLabelSerializable$$module$build$src$core$field_label_serializable=class extends $.FieldLabel$$module$build$src$core$field_label{constructor(a,b,c){super(String(null!=a?a:\"\"),b,c);this.EDITABLE=!1;this.SERIALIZABLE=!0}static fromJson(a){return new this(replaceMessageReferences$$module$build$src$core$utils$parsing(a.text),void 0,a)}};register$$module$build$src$core$field_registry(\"field_label_serializable\",FieldLabelSerializable$$module$build$src$core$field_label_serializable);\nvar module$build$src$core$field_label_serializable={};module$build$src$core$field_label_serializable.FieldLabelSerializable=FieldLabelSerializable$$module$build$src$core$field_label_serializable;var FieldColour$$module$build$src$core$field_colour=class extends Field$$module$build$src$core$field{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.onKeyDownWrapper_=this.onMouseLeaveWrapper_=this.onMouseEnterWrapper_=this.onMouseMoveWrapper_=this.onClickWrapper_=this.highlightedIndex_=this.picker_=null;this.SERIALIZABLE=!0;this.CURSOR=\"default\";this.isDirty_=!1;this.titles_=this.colours_=null;this.columns_=0;a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c&&this.configure_(c),\nthis.setValue(a),b&&this.setValidator(b))}configure_(a){super.configure_(a);a.colourOptions&&(this.colours_=a.colourOptions);a.colourTitles&&(this.titles_=a.colourTitles);a.columns&&(this.columns_=a.columns)}initView(){this.size_=new Size$$module$build$src$core$utils$size(this.getConstants().FIELD_COLOUR_DEFAULT_WIDTH,this.getConstants().FIELD_COLOUR_DEFAULT_HEIGHT);this.getConstants().FIELD_COLOUR_FULL_BLOCK?this.sourceBlock_ instanceof BlockSvg$$module$build$src$core$block_svg&&(this.clickTarget_=\nthis.sourceBlock_.getSvgRoot()):(this.createBorderRect_(),this.getBorderRect().style.fillOpacity=\"1\")}applyColour(){this.getConstants().FIELD_COLOUR_FULL_BLOCK?this.sourceBlock_ instanceof BlockSvg$$module$build$src$core$block_svg&&(this.sourceBlock_.pathObject.svgPath.setAttribute(\"fill\",this.getValue()),this.sourceBlock_.pathObject.svgPath.setAttribute(\"stroke\",\"#fff\")):this.borderRect_&&(this.borderRect_.style.fill=this.getValue())}doClassValidation_(a){return\"string\"!==typeof a?null:parse$$module$build$src$core$utils$colour(a)}doValueUpdate_(a){this.value_=\na;this.borderRect_?this.borderRect_.style.fill=a:this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_ instanceof BlockSvg$$module$build$src$core$block_svg&&(this.sourceBlock_.pathObject.svgPath.setAttribute(\"fill\",a),this.sourceBlock_.pathObject.svgPath.setAttribute(\"stroke\",\"#fff\"))}getText(){let a=this.value_;/^#(.)\\1(.)\\2(.)\\3$/.test(a)&&(a=\"#\"+a[1]+a[3]+a[5]);return a}setColours(a,b){this.colours_=a;b&&(this.titles_=b);return this}setColumns(a){this.columns_=a;return this}showEditor_(){this.dropdownCreate_();\ngetContentDiv$$module$build$src$core$dropdowndiv().appendChild(this.picker_);showPositionedByField$$module$build$src$core$dropdowndiv(this,this.dropdownDispose_.bind(this));this.picker_.focus({preventScroll:!0})}onClick_(a){a=(a=a.target)&&a.getAttribute(\"data-colour\");null!==a&&(this.setValue(a),hideIfOwner$$module$build$src$core$dropdowndiv(this))}onKeyDown_(a){var b=!1;if(a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.UP)this.moveHighlightBy_(0,-1),b=!0;else if(a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.DOWN)this.moveHighlightBy_(0,\n1),b=!0;else if(a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.LEFT)this.moveHighlightBy_(-1,0),b=!0;else if(a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.RIGHT)this.moveHighlightBy_(1,0),b=!0;else if(a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.ENTER){if(b=this.getHighlighted_())b=b&&b.getAttribute(\"data-colour\"),null!==b&&this.setValue(b);hideWithoutAnimation$$module$build$src$core$dropdowndiv();b=!0}b&&a.stopPropagation()}moveHighlightBy_(a,b){if(this.highlightedIndex_){var c=\nthis.colours_||FieldColour$$module$build$src$core$field_colour.COLOURS,d=this.columns_||FieldColour$$module$build$src$core$field_colour.COLUMNS,e=this.highlightedIndex_%d,f=Math.floor(this.highlightedIndex_/d);e+=a;f+=b;0>a?0>e&&0<f?(e=d-1,f--):0>e&&(e=0):0<a?e>d-1&&f<Math.floor(c.length/d)-1?(e=0,f++):e>d-1&&e--:0>b?0>f&&(f=0):0<b&&f>Math.floor(c.length/d)-1&&(f=Math.floor(c.length/d)-1);this.setHighlightedCell_(this.picker_.childNodes[f].childNodes[e],f*d+e)}}onMouseMove_(a){const b=(a=a.target)&&\nNumber(a.getAttribute(\"data-index\"));null!==b&&b!==this.highlightedIndex_&&this.setHighlightedCell_(a,b)}onMouseEnter_(){this.picker_.focus({preventScroll:!0})}onMouseLeave_(){this.picker_.blur();const a=this.getHighlighted_();a&&removeClass$$module$build$src$core$utils$dom(a,\"blocklyColourHighlighted\")}getHighlighted_(){if(!this.highlightedIndex_)return null;const a=this.columns_||FieldColour$$module$build$src$core$field_colour.COLUMNS,b=this.picker_.childNodes[Math.floor(this.highlightedIndex_/\na)];return b?b.childNodes[this.highlightedIndex_%a]:null}setHighlightedCell_(a,b){const c=this.getHighlighted_();c&&removeClass$$module$build$src$core$utils$dom(c,\"blocklyColourHighlighted\");addClass$$module$build$src$core$utils$dom(a,\"blocklyColourHighlighted\");this.highlightedIndex_=b;setState$$module$build$src$core$utils$aria(this.picker_,State$$module$build$src$core$utils$aria.ACTIVEDESCENDANT,a.getAttribute(\"id\"))}dropdownCreate_(){const a=this.columns_||FieldColour$$module$build$src$core$field_colour.COLUMNS,\nb=this.colours_||FieldColour$$module$build$src$core$field_colour.COLOURS,c=this.titles_||FieldColour$$module$build$src$core$field_colour.TITLES,d=this.getValue(),e=document.createElement(\"table\");e.className=\"blocklyColourTable\";e.tabIndex=0;e.dir=\"ltr\";setRole$$module$build$src$core$utils$aria(e,Role$$module$build$src$core$utils$aria.GRID);setState$$module$build$src$core$utils$aria(e,State$$module$build$src$core$utils$aria.EXPANDED,!0);setState$$module$build$src$core$utils$aria(e,State$$module$build$src$core$utils$aria.ROWCOUNT,\nMath.floor(b.length/a));setState$$module$build$src$core$utils$aria(e,State$$module$build$src$core$utils$aria.COLCOUNT,a);let f;for(let g=0;g<b.length;g++){0===g%a&&(f=document.createElement(\"tr\"),setRole$$module$build$src$core$utils$aria(f,Role$$module$build$src$core$utils$aria.ROW),e.appendChild(f));const h=document.createElement(\"td\");f.appendChild(h);h.setAttribute(\"data-colour\",b[g]);h.title=c[g]||b[g];h.id=getNextUniqueId$$module$build$src$core$utils$idgenerator();h.setAttribute(\"data-index\",\ng);setRole$$module$build$src$core$utils$aria(h,Role$$module$build$src$core$utils$aria.GRIDCELL);setState$$module$build$src$core$utils$aria(h,State$$module$build$src$core$utils$aria.LABEL,b[g]);setState$$module$build$src$core$utils$aria(h,State$$module$build$src$core$utils$aria.SELECTED,b[g]===d);h.style.backgroundColor=b[g];b[g]===d&&(h.className=\"blocklyColourSelected\",this.highlightedIndex_=g)}this.onClickWrapper_=conditionalBind$$module$build$src$core$browser_events(e,\"pointerdown\",this,this.onClick_,\n!0);this.onMouseMoveWrapper_=conditionalBind$$module$build$src$core$browser_events(e,\"pointermove\",this,this.onMouseMove_,!0);this.onMouseEnterWrapper_=conditionalBind$$module$build$src$core$browser_events(e,\"pointerenter\",this,this.onMouseEnter_,!0);this.onMouseLeaveWrapper_=conditionalBind$$module$build$src$core$browser_events(e,\"pointerleave\",this,this.onMouseLeave_,!0);this.onKeyDownWrapper_=conditionalBind$$module$build$src$core$browser_events(e,\"keydown\",this,this.onKeyDown_);this.picker_=e}dropdownDispose_(){this.onClickWrapper_&&\n(unbind$$module$build$src$core$browser_events(this.onClickWrapper_),this.onClickWrapper_=null);this.onMouseMoveWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null);this.onMouseEnterWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseEnterWrapper_),this.onMouseEnterWrapper_=null);this.onMouseLeaveWrapper_&&(unbind$$module$build$src$core$browser_events(this.onMouseLeaveWrapper_),this.onMouseLeaveWrapper_=null);this.onKeyDownWrapper_&&\n(unbind$$module$build$src$core$browser_events(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null);this.highlightedIndex_=this.picker_=null}static fromJson(a){return new this(a.colour,void 0,a)}};FieldColour$$module$build$src$core$field_colour.COLOURS=\"#ffffff #cccccc #c0c0c0 #999999 #666666 #333333 #000000 #ffcccc #ff6666 #ff0000 #cc0000 #990000 #660000 #330000 #ffcc99 #ff9966 #ff9900 #ff6600 #cc6600 #993300 #663300 #ffff99 #ffff66 #ffcc66 #ffcc33 #cc9933 #996633 #663333 #ffffcc #ffff33 #ffff00 #ffcc00 #999900 #666600 #333300 #99ff99 #66ff99 #33ff33 #33cc00 #009900 #006600 #003300 #99ffff #33ffff #66cccc #00cccc #339999 #336666 #003333 #ccffff #66ffff #33ccff #3366ff #3333ff #000099 #000066 #ccccff #9999ff #6666cc #6633ff #6600cc #333399 #330099 #ffccff #ff99ff #cc66cc #cc33cc #993399 #663366 #330033\".split(\" \");\nFieldColour$$module$build$src$core$field_colour.TITLES=[];FieldColour$$module$build$src$core$field_colour.COLUMNS=7;FieldColour$$module$build$src$core$field_colour.prototype.DEFAULT_VALUE=FieldColour$$module$build$src$core$field_colour.COLOURS[0];register$$module$build$src$core$css(\"\\n.blocklyColourTable {\\n  border-collapse: collapse;\\n  display: block;\\n  outline: none;\\n  padding: 1px;\\n}\\n\\n.blocklyColourTable>tr>td {\\n  border: .5px solid #888;\\n  box-sizing: border-box;\\n  cursor: pointer;\\n  display: inline-block;\\n  height: 20px;\\n  padding: 0;\\n  width: 20px;\\n}\\n\\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\\n  border-color: #eee;\\n  box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);\\n  position: relative;\\n}\\n\\n.blocklyColourSelected, .blocklyColourSelected:hover {\\n  border-color: #eee !important;\\n  outline: 1px solid #333;\\n  position: relative;\\n}\\n\");\nregister$$module$build$src$core$field_registry(\"field_colour\",FieldColour$$module$build$src$core$field_colour);var module$build$src$core$field_colour={};module$build$src$core$field_colour.FieldColour=FieldColour$$module$build$src$core$field_colour;$.FieldCheckbox$$module$build$src$core$field_checkbox=class extends Field$$module$build$src$core$field{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.SERIALIZABLE=!0;this.CURSOR=\"default\";this.checkChar_=$.FieldCheckbox$$module$build$src$core$field_checkbox.CHECK_CHAR;a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(a),b&&this.setValidator(b))}configure_(a){super.configure_(a);a.checkCharacter&&(this.checkChar_=a.checkCharacter)}saveState(){const a=\nthis.saveLegacyState($.FieldCheckbox$$module$build$src$core$field_checkbox);return null!==a?a:this.getValueBoolean()}initView(){super.initView();const a=this.getTextElement();addClass$$module$build$src$core$utils$dom(a,\"blocklyCheckbox\");a.style.display=this.value_?\"block\":\"none\"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_());this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar_}setCheckCharacter(a){this.checkChar_=\na||$.FieldCheckbox$$module$build$src$core$field_checkbox.CHECK_CHAR;this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(a){return!0===a||\"TRUE\"===a?\"TRUE\":!1===a||\"FALSE\"===a?\"FALSE\":null}doValueUpdate_(a){this.value_=this.convertValueToBool_(a);this.textElement_&&(this.textElement_.style.display=this.value_?\"block\":\"none\")}getValue(){return this.value_?\"TRUE\":\"FALSE\"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool_(this.value_))}convertValueToBool_(a){return\"string\"===\ntypeof a?\"TRUE\"===a:!!a}static fromJson(a){return new this(a.checked,void 0,a)}};$.FieldCheckbox$$module$build$src$core$field_checkbox.CHECK_CHAR=\"\\u2713\";register$$module$build$src$core$field_registry(\"field_checkbox\",$.FieldCheckbox$$module$build$src$core$field_checkbox);$.FieldCheckbox$$module$build$src$core$field_checkbox.prototype.DEFAULT_VALUE=!1;var module$build$src$core$field_checkbox={};module$build$src$core$field_checkbox.FieldCheckbox=$.FieldCheckbox$$module$build$src$core$field_checkbox;var FieldAngle$$module$build$src$core$field_angle=class extends FieldInput$$module$build$src$core$field_input{constructor(a,b,c){super(Field$$module$build$src$core$field.SKIP_SETUP);this.clockwise_=FieldAngle$$module$build$src$core$field_angle.CLOCKWISE;this.offset_=FieldAngle$$module$build$src$core$field_angle.OFFSET;this.wrap_=FieldAngle$$module$build$src$core$field_angle.WRAP;this.round_=FieldAngle$$module$build$src$core$field_angle.ROUND;this.moveSurfaceWrapper_=this.clickSurfaceWrapper_=this.clickWrapper_=\nthis.symbol_=this.line_=this.gauge_=this.editor_=null;this.SERIALIZABLE=!0;a!==Field$$module$build$src$core$field.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(a),b&&this.setValidator(b))}configure_(a){super.configure_(a);switch(a.mode){case Mode$$module$build$src$core$field_angle.COMPASS:this.clockwise_=!0;this.offset_=90;break;case Mode$$module$build$src$core$field_angle.PROTRACTOR:this.clockwise_=!1,this.offset_=0}a.clockwise&&(this.clockwise_=a.clockwise);a.offset&&(this.offset_=a.offset);\na.wrap&&(this.wrap_=a.wrap);a.round&&(this.round_=a.round)}initView(){super.initView();this.symbol_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.TSPAN,{});this.symbol_.appendChild(document.createTextNode(\"\\u00b0\"));this.getTextElement().appendChild(this.symbol_)}render_(){super.render_();this.updateGraph_()}showEditor_(a){super.showEditor_(a,MOBILE$$module$build$src$core$utils$useragent||ANDROID$$module$build$src$core$utils$useragent||IPAD$$module$build$src$core$utils$useragent);\nthis.dropdownCreate_();getContentDiv$$module$build$src$core$dropdowndiv().appendChild(this.editor_);this.sourceBlock_ instanceof BlockSvg$$module$build$src$core$block_svg&&setColour$$module$build$src$core$dropdowndiv(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary);showPositionedByField$$module$build$src$core$dropdowndiv(this,this.dropdownDispose_.bind(this));this.updateGraph_()}dropdownCreate_(){const a=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.SVG,\n{xmlns:SVG_NS$$module$build$src$core$utils$dom,\"xmlns:html\":HTML_NS$$module$build$src$core$utils$dom,\"xmlns:xlink\":XLINK_NS$$module$build$src$core$utils$dom,version:\"1.1\",height:2*FieldAngle$$module$build$src$core$field_angle.HALF+\"px\",width:2*FieldAngle$$module$build$src$core$field_angle.HALF+\"px\",style:\"touch-action: none\"}),b=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.CIRCLE,{cx:FieldAngle$$module$build$src$core$field_angle.HALF,cy:FieldAngle$$module$build$src$core$field_angle.HALF,\nr:FieldAngle$$module$build$src$core$field_angle.RADIUS,\"class\":\"blocklyAngleCircle\"},a);this.gauge_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.PATH,{\"class\":\"blocklyAngleGauge\"},a);this.line_=createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,{x1:FieldAngle$$module$build$src$core$field_angle.HALF,y1:FieldAngle$$module$build$src$core$field_angle.HALF,\"class\":\"blocklyAngleLine\"},a);for(let c=0;360>c;c+=15)createSvgElement$$module$build$src$core$utils$dom(Svg$$module$build$src$core$utils$svg.LINE,\n{x1:FieldAngle$$module$build$src$core$field_angle.HALF+FieldAngle$$module$build$src$core$field_angle.RADIUS,y1:FieldAngle$$module$build$src$core$field_angle.HALF,x2:FieldAngle$$module$build$src$core$field_angle.HALF+FieldAngle$$module$build$src$core$field_angle.RADIUS-(0===c%45?10:5),y2:FieldAngle$$module$build$src$core$field_angle.HALF,\"class\":\"blocklyAngleMarks\",transform:\"rotate(\"+c+\",\"+FieldAngle$$module$build$src$core$field_angle.HALF+\",\"+FieldAngle$$module$build$src$core$field_angle.HALF+\")\"},\na);this.clickWrapper_=conditionalBind$$module$build$src$core$browser_events(a,\"click\",this,this.hide_);this.clickSurfaceWrapper_=conditionalBind$$module$build$src$core$browser_events(b,\"pointerdown\",this,this.onMouseMove_,!0);this.moveSurfaceWrapper_=conditionalBind$$module$build$src$core$browser_events(b,\"pointermove\",this,this.onMouseMove_,!0);this.editor_=a}dropdownDispose_(){this.clickWrapper_&&(unbind$$module$build$src$core$browser_events(this.clickWrapper_),this.clickWrapper_=null);this.clickSurfaceWrapper_&&\n(unbind$$module$build$src$core$browser_events(this.clickSurfaceWrapper_),this.clickSurfaceWrapper_=null);this.moveSurfaceWrapper_&&(unbind$$module$build$src$core$browser_events(this.moveSurfaceWrapper_),this.moveSurfaceWrapper_=null);this.line_=this.gauge_=null}hide_(){hideIfOwner$$module$build$src$core$dropdowndiv(this);hide$$module$build$src$core$widgetdiv()}onMouseMove_(a){var b=this.gauge_.ownerSVGElement.getBoundingClientRect();const c=a.clientX-b.left-FieldAngle$$module$build$src$core$field_angle.HALF;\na=a.clientY-b.top-FieldAngle$$module$build$src$core$field_angle.HALF;b=Math.atan(-a/c);isNaN(b)||(b=toDegrees$$module$build$src$core$utils$math(b),0>c?b+=180:0<a&&(b+=360),b=this.clockwise_?this.offset_+360-b:360-(this.offset_-b),this.displayMouseOrKeyboardValue_(b))}displayMouseOrKeyboardValue_(a){this.round_&&(a=Math.round(a/this.round_)*this.round_);a=this.wrapValue_(a);a!==this.value_&&this.setEditorValue_(a)}updateGraph_(){if(this.gauge_){var a=Number(this.getText())+this.offset_,b=toRadians$$module$build$src$core$utils$math(a%\n360);a=[\"M \",FieldAngle$$module$build$src$core$field_angle.HALF,\",\",FieldAngle$$module$build$src$core$field_angle.HALF];var c=FieldAngle$$module$build$src$core$field_angle.HALF,d=FieldAngle$$module$build$src$core$field_angle.HALF;if(!isNaN(b)){const e=Number(this.clockwise_),f=toRadians$$module$build$src$core$utils$math(this.offset_),g=Math.cos(f)*FieldAngle$$module$build$src$core$field_angle.RADIUS,h=Math.sin(f)*-FieldAngle$$module$build$src$core$field_angle.RADIUS;e&&(b=2*f-b);c+=Math.cos(b)*FieldAngle$$module$build$src$core$field_angle.RADIUS;\nd-=Math.sin(b)*FieldAngle$$module$build$src$core$field_angle.RADIUS;b=Math.abs(Math.floor((b-f)/Math.PI)%2);e&&(b=1-b);a.push(\" l \",g,\",\",h,\" A \",FieldAngle$$module$build$src$core$field_angle.RADIUS,\",\",FieldAngle$$module$build$src$core$field_angle.RADIUS,\" 0 \",b,\" \",e,\" \",c,\",\",d,\" z\")}this.gauge_.setAttribute(\"d\",a.join(\"\"));this.line_.setAttribute(\"x2\",c);this.line_.setAttribute(\"y2\",d)}}onHtmlInputKeyDown_(a){super.onHtmlInputKeyDown_(a);var b=this.getSourceBlock();if(!b)throw new UnattachedFieldError$$module$build$src$core$field;\nlet c;a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.LEFT?c=b.RTL?1:-1:a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.RIGHT?c=b.RTL?-1:1:a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.DOWN?c=-1:a.keyCode===KeyCodes$$module$build$src$core$utils$keycodes.UP&&(c=1);c&&(b=this.getValue(),this.displayMouseOrKeyboardValue_(b+c*this.round_),a.preventDefault(),a.stopPropagation())}doClassValidation_(a){a=Number(a);return isNaN(a)||!isFinite(a)?null:this.wrapValue_(a)}wrapValue_(a){a%=\n360;0>a&&(a+=360);a>this.wrap_&&(a-=360);return a}static fromJson(a){return new this(a.angle,void 0,a)}};FieldAngle$$module$build$src$core$field_angle.ROUND=15;FieldAngle$$module$build$src$core$field_angle.HALF=50;FieldAngle$$module$build$src$core$field_angle.CLOCKWISE=!1;FieldAngle$$module$build$src$core$field_angle.OFFSET=0;FieldAngle$$module$build$src$core$field_angle.WRAP=360;FieldAngle$$module$build$src$core$field_angle.RADIUS=FieldAngle$$module$build$src$core$field_angle.HALF-1;register$$module$build$src$core$css(\"\\n.blocklyAngleCircle {\\n  stroke: #444;\\n  stroke-width: 1;\\n  fill: #ddd;\\n  fill-opacity: .8;\\n}\\n\\n.blocklyAngleMarks {\\n  stroke: #444;\\n  stroke-width: 1;\\n}\\n\\n.blocklyAngleGauge {\\n  fill: #f88;\\n  fill-opacity: .8;\\n  pointer-events: none;\\n}\\n\\n.blocklyAngleLine {\\n  stroke: #f00;\\n  stroke-width: 2;\\n  stroke-linecap: round;\\n  pointer-events: none;\\n}\\n\");\nregister$$module$build$src$core$field_registry(\"field_angle\",FieldAngle$$module$build$src$core$field_angle);FieldAngle$$module$build$src$core$field_angle.prototype.DEFAULT_VALUE=0;var Mode$$module$build$src$core$field_angle;(function(a){a.COMPASS=\"compass\";a.PROTRACTOR=\"protractor\"})(Mode$$module$build$src$core$field_angle||(Mode$$module$build$src$core$field_angle={}));var module$build$src$core$field_angle={};module$build$src$core$field_angle.FieldAngle=FieldAngle$$module$build$src$core$field_angle;\nmodule$build$src$core$field_angle.Mode=Mode$$module$build$src$core$field_angle;var BlockMove$$module$build$src$core$events$events_block_move=class extends BlockBase$$module$build$src$core$events$events_block_base{constructor(a){super(a);this.type=MOVE$$module$build$src$core$events$utils;a&&(a.isShadow()&&(this.recordUndo=!1),a=this.currentLocation_(),this.oldParentId=a.parentId,this.oldInputName=a.inputName,this.oldCoordinate=a.coordinate)}toJson(){const a=super.toJson();a.oldParentId=this.oldParentId;a.oldInputName=this.oldInputName;this.oldCoordinate&&(a.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, `+\n`${Math.round(this.oldCoordinate.y)}`);a.newParentId=this.newParentId;a.newInputName=this.newInputName;this.newCoordinate&&(a.newCoordinate=`${Math.round(this.newCoordinate.x)}, `+`${Math.round(this.newCoordinate.y)}`);this.recordUndo||(a.recordUndo=this.recordUndo);return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BlockMove.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.oldParentId=a.oldParentId;this.oldInputName=a.oldInputName;\nif(a.oldCoordinate){var b=a.oldCoordinate.split(\",\");this.oldCoordinate=new Coordinate$$module$build$src$core$utils$coordinate(Number(b[0]),Number(b[1]))}this.newParentId=a.newParentId;this.newInputName=a.newInputName;a.newCoordinate&&(b=a.newCoordinate.split(\",\"),this.newCoordinate=new Coordinate$$module$build$src$core$utils$coordinate(Number(b[0]),Number(b[1])));void 0!==a.recordUndo&&(this.recordUndo=a.recordUndo)}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BlockMove$$module$build$src$core$events$events_block_move);\nb.oldParentId=a.oldParentId;b.oldInputName=a.oldInputName;a.oldCoordinate&&(c=a.oldCoordinate.split(\",\"),b.oldCoordinate=new Coordinate$$module$build$src$core$utils$coordinate(Number(c[0]),Number(c[1])));b.newParentId=a.newParentId;b.newInputName=a.newInputName;a.newCoordinate&&(c=a.newCoordinate.split(\",\"),b.newCoordinate=new Coordinate$$module$build$src$core$utils$coordinate(Number(c[0]),Number(c[1])));void 0!==a.recordUndo&&(b.recordUndo=a.recordUndo);return b}recordNew(){const a=this.currentLocation_();\nthis.newParentId=a.parentId;this.newInputName=a.inputName;this.newCoordinate=a.coordinate}currentLocation_(){var a=this.getEventWorkspace_();if(!this.blockId)throw Error(\"The block ID is undefined. Either pass a block to the constructor, or call fromJson\");var b=a.getBlockById(this.blockId);if(!b)throw Error(\"The block associated with the block move event could not be found\");a={};const c=b.getParent();if(c){if(a.parentId=c.id,b=c.getInputWithBlock(b))a.inputName=b.name}else a.coordinate=b.getRelativeToSurfaceXY();\nreturn a}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&Coordinate$$module$build$src$core$utils$coordinate.equals(this.oldCoordinate,this.newCoordinate)}run(a){var b=this.getEventWorkspace_();if(!this.blockId)throw Error(\"The block ID is undefined. Either pass a block to the constructor, or call fromJson\");var c=b.getBlockById(this.blockId);if(c){var d=a?this.newParentId:this.oldParentId,e=a?this.newInputName:this.oldInputName;a=a?this.newCoordinate:this.oldCoordinate;\nif(d){var f=b.getBlockById(d);if(!f){console.warn(\"Can't connect to non-existent block: \"+d);return}}c.getParent()&&c.unplug();if(a)e=c.getRelativeToSurfaceXY(),c.moveBy(a.x-e.x,a.y-e.y);else{b=c.outputConnection;if(!b||c.previousConnection&&c.previousConnection.isConnected())b=c.previousConnection;let g;c=b.type;if(e){if(c=f.getInput(e))g=c.connection}else c===ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT&&(g=f.nextConnection);g?b.connect(g):console.warn(\"Can't connect to non-existent input: \"+\ne)}}else console.warn(\"Can't move non-existent block: \"+this.blockId)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,MOVE$$module$build$src$core$events$utils,BlockMove$$module$build$src$core$events$events_block_move);var module$build$src$core$events$events_block_move={};module$build$src$core$events$events_block_move.BlockMove=BlockMove$$module$build$src$core$events$events_block_move;var CommentBase$$module$build$src$core$events$events_comment_base=class extends Abstract$$module$build$src$core$events$events_abstract{constructor(a){super();this.isBlank=!a;a&&(this.commentId=a.id,this.workspaceId=a.workspace.id,this.group=getGroup$$module$build$src$core$events$utils(),this.recordUndo=getRecordUndo$$module$build$src$core$events$utils())}toJson(){const a=super.toJson();if(!this.commentId)throw Error(\"The comment ID is undefined. Either pass a comment to the constructor, or call fromJson\");\na.commentId=this.commentId;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.CommentBase.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.commentId=a.commentId}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new CommentBase$$module$build$src$core$events$events_comment_base);b.commentId=a.commentId;return b}static CommentCreateDeleteHelper(a,b){var c=a.getEventWorkspace_();if(b){b=createElement$$module$build$src$core$utils$xml(\"xml\");\nif(!a.xml)throw Error(\"Ecountered a comment event without proper xml\");b.appendChild(a.xml);domToWorkspace$$module$build$src$core$xml(b,c)}else{if(!a.commentId)throw Error(\"The comment ID is undefined. Either pass a comment to the constructor, or call fromJson\");(c=c.getCommentById(a.commentId))?c.dispose():console.warn(\"Can't uncreate non-existent comment: \"+a.commentId)}}},module$build$src$core$events$events_comment_base={};module$build$src$core$events$events_comment_base.CommentBase=CommentBase$$module$build$src$core$events$events_comment_base;var CommentChange$$module$build$src$core$events$events_comment_change=class extends CommentBase$$module$build$src$core$events$events_comment_base{constructor(a,b,c){super(a);this.type=COMMENT_CHANGE$$module$build$src$core$events$utils;a&&(this.oldContents_=\"undefined\"===typeof b?\"\":b,this.newContents_=\"undefined\"===typeof c?\"\":c)}toJson(){const a=super.toJson();if(!this.oldContents_)throw Error(\"The old contents is undefined. Either pass a value to the constructor, or call fromJson\");if(!this.newContents_)throw Error(\"The new contents is undefined. Either pass a value to the constructor, or call fromJson\");\na.oldContents=this.oldContents_;a.newContents=this.newContents_;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.CommentChange.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.oldContents_=a.oldContents;this.newContents_=a.newContents}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new CommentChange$$module$build$src$core$events$events_comment_change);b.oldContents_=a.oldContents;b.newContents_=a.newContents;return b}isNull(){return this.oldContents_===\nthis.newContents_}run(a){var b=this.getEventWorkspace_();if(!this.commentId)throw Error(\"The comment ID is undefined. Either pass a comment to the constructor, or call fromJson\");if(b=b.getCommentById(this.commentId)){var c=a?this.newContents_:this.oldContents_;if(!c){if(a)throw Error(\"The new contents is undefined. Either pass a value to the constructor, or call fromJson\");throw Error(\"The old contents is undefined. Either pass a value to the constructor, or call fromJson\");}b.setContent(c)}else console.warn(\"Can't change non-existent comment: \"+\nthis.commentId)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,COMMENT_CHANGE$$module$build$src$core$events$utils,CommentChange$$module$build$src$core$events$events_comment_change);var module$build$src$core$events$events_comment_change={};module$build$src$core$events$events_comment_change.CommentChange=CommentChange$$module$build$src$core$events$events_comment_change;var CommentCreate$$module$build$src$core$events$events_comment_create=class extends CommentBase$$module$build$src$core$events$events_comment_base{constructor(a){super(a);this.type=COMMENT_CREATE$$module$build$src$core$events$utils;a&&(this.xml=a.toXmlWithXY())}toJson(){const a=super.toJson();if(!this.xml)throw Error(\"The comment XML is undefined. Either pass a comment to the constructor, or call fromJson\");a.xml=domToText$$module$build$src$core$xml(this.xml);return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.CommentCreate.prototype.fromJson\",\n\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.xml=textToDom$$module$build$src$core$xml(a.xml)}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new CommentCreate$$module$build$src$core$events$events_comment_create);b.xml=textToDom$$module$build$src$core$xml(a.xml);return b}run(a){CommentBase$$module$build$src$core$events$events_comment_base.CommentCreateDeleteHelper(this,a)}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,COMMENT_CREATE$$module$build$src$core$events$utils,CommentCreate$$module$build$src$core$events$events_comment_create);var module$build$src$core$events$events_comment_create={};module$build$src$core$events$events_comment_create.CommentCreate=CommentCreate$$module$build$src$core$events$events_comment_create;var CommentDelete$$module$build$src$core$events$events_comment_delete=class extends CommentBase$$module$build$src$core$events$events_comment_base{constructor(a){super(a);this.type=COMMENT_DELETE$$module$build$src$core$events$utils;a&&(this.xml=a.toXmlWithXY())}run(a){CommentBase$$module$build$src$core$events$events_comment_base.CommentCreateDeleteHelper(this,!a)}toJson(){const a=super.toJson();if(!this.xml)throw Error(\"The comment XML is undefined. Either pass a comment to the constructor, or call fromJson\");\na.xml=domToText$$module$build$src$core$xml(this.xml);return a}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new CommentDelete$$module$build$src$core$events$events_comment_delete);b.xml=textToDom$$module$build$src$core$xml(a.xml);return b}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,COMMENT_DELETE$$module$build$src$core$events$utils,CommentDelete$$module$build$src$core$events$events_comment_delete);\nvar module$build$src$core$events$events_comment_delete={};module$build$src$core$events$events_comment_delete.CommentDelete=CommentDelete$$module$build$src$core$events$events_comment_delete;var CommentMove$$module$build$src$core$events$events_comment_move=class extends CommentBase$$module$build$src$core$events$events_comment_base{constructor(a){super(a);this.type=COMMENT_MOVE$$module$build$src$core$events$utils;a&&(this.comment_=a,this.oldCoordinate_=a.getXY())}recordNew(){if(this.newCoordinate_)throw Error(\"Tried to record the new position of a comment on the same event twice.\");if(!this.comment_)throw Error(\"The comment is undefined. Pass a comment to the constructor if you want to use the record functionality\");\nthis.newCoordinate_=this.comment_.getXY()}setOldCoordinate(a){this.oldCoordinate_=a}toJson(){const a=super.toJson();if(!this.oldCoordinate_)throw Error(\"The old comment position is undefined. Either pass a comment to the constructor, or call fromJson\");if(!this.newCoordinate_)throw Error(\"The new comment position is undefined. Either call recordNew, or call fromJson\");a.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, `+`${Math.round(this.oldCoordinate_.y)}`;a.newCoordinate=Math.round(this.newCoordinate_.x)+\n\",\"+Math.round(this.newCoordinate_.y);return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.CommentMove.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);let b=a.oldCoordinate.split(\",\");this.oldCoordinate_=new Coordinate$$module$build$src$core$utils$coordinate(Number(b[0]),Number(b[1]));b=a.newCoordinate.split(\",\");this.newCoordinate_=new Coordinate$$module$build$src$core$utils$coordinate(Number(b[0]),Number(b[1]))}static fromJson(a,\nb,c){b=super.fromJson(a,b,null!=c?c:new CommentMove$$module$build$src$core$events$events_comment_move);c=a.oldCoordinate.split(\",\");b.oldCoordinate_=new Coordinate$$module$build$src$core$utils$coordinate(Number(c[0]),Number(c[1]));c=a.newCoordinate.split(\",\");b.newCoordinate_=new Coordinate$$module$build$src$core$utils$coordinate(Number(c[0]),Number(c[1]));return b}isNull(){return Coordinate$$module$build$src$core$utils$coordinate.equals(this.oldCoordinate_,this.newCoordinate_)}run(a){var b=this.getEventWorkspace_();\nif(!this.commentId)throw Error(\"The comment ID is undefined. Either pass a comment to the constructor, or call fromJson\");if(b=b.getCommentById(this.commentId)){a=a?this.newCoordinate_:this.oldCoordinate_;if(!a)throw Error(\"Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson\");var c=b.getXY();b.moveBy(a.x-c.x,a.y-c.y)}else console.warn(\"Can't move non-existent comment: \"+this.commentId)}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,COMMENT_MOVE$$module$build$src$core$events$utils,CommentMove$$module$build$src$core$events$events_comment_move);var module$build$src$core$events$events_comment_move={};module$build$src$core$events$events_comment_move.CommentMove=CommentMove$$module$build$src$core$events$events_comment_move;var ProcedureBase$$module$build$src$core$events$events_procedure_base=class extends Abstract$$module$build$src$core$events$events_abstract{constructor(a,b){super();this.model=b;this.isBlank=!1;this.workspaceId=a.id}toJson(){const a=super.toJson();a.procedureId=this.model.getId();return a}},module$build$src$core$events$events_procedure_base={};module$build$src$core$events$events_procedure_base.ProcedureBase=ProcedureBase$$module$build$src$core$events$events_procedure_base;var ProcedureChangeReturn$$module$build$src$core$events$events_procedure_change_return=class extends ProcedureBase$$module$build$src$core$events$events_procedure_base{constructor(a,b,c){super(a,b);this.oldTypes=c;this.type=PROCEDURE_CHANGE_RETURN$$module$build$src$core$events$utils;this.newTypes=b.getReturnTypes()}run(a){const b=this.getEventWorkspace_().getProcedureMap().get(this.model.getId());if(!b)throw Error(\"Cannot change the type of a procedure that does not exist in the procedure map\");a?\nb.setReturnTypes(this.newTypes):b.setReturnTypes(this.oldTypes)}toJson(){const a=super.toJson();a.oldTypes=this.oldTypes;return a}static fromJson(a,b){const c=b.getProcedureMap().get(a.procedureId);if(!c)throw Error(\"Cannot deserialize procedure change return event because the target procedure does not exist\");return new ProcedureChangeReturn$$module$build$src$core$events$events_procedure_change_return(b,c,a.oldTypes)}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_CHANGE_RETURN$$module$build$src$core$events$utils,ProcedureChangeReturn$$module$build$src$core$events$events_procedure_change_return);var module$build$src$core$events$events_procedure_change_return={};module$build$src$core$events$events_procedure_change_return.ProcedureChangeReturn=ProcedureChangeReturn$$module$build$src$core$events$events_procedure_change_return;var ProcedureCreate$$module$build$src$core$events$events_procedure_create=class extends ProcedureBase$$module$build$src$core$events$events_procedure_base{constructor(a,b){super(a,b);this.type=PROCEDURE_CREATE$$module$build$src$core$events$utils}run(a){const b=this.getEventWorkspace_(),c=b.getProcedureMap(),d=c.get(this.model.getId());a?d||c.add(new ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model(b,this.model.getName(),this.model.getId())):d&&c.delete(this.model.getId())}toJson(){const a=\nsuper.toJson();a.model=saveProcedure$$module$build$src$core$serialization$procedures(this.model);return a}static fromJson(a,b){return new ProcedureCreate$$module$build$src$core$events$events_procedure_create(b,loadProcedure$$module$build$src$core$serialization$procedures(ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model,ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model,a.model,b))}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_CREATE$$module$build$src$core$events$utils,ProcedureCreate$$module$build$src$core$events$events_procedure_create);var module$build$src$core$events$events_procedure_create={};module$build$src$core$events$events_procedure_create.ProcedureCreate=ProcedureCreate$$module$build$src$core$events$events_procedure_create;var ProcedureDelete$$module$build$src$core$events$events_procedure_delete=class extends ProcedureBase$$module$build$src$core$events$events_procedure_base{constructor(a,b){super(a,b);this.type=PROCEDURE_DELETE$$module$build$src$core$events$utils}run(a){const b=this.getEventWorkspace_(),c=b.getProcedureMap(),d=c.get(this.model.getId());a?d&&c.delete(this.model.getId()):d||c.add(new ObservableProcedureModel$$module$build$src$core$procedures$observable_procedure_model(b,this.model.getName(),this.model.getId()))}toJson(){return super.toJson()}static fromJson(a,\nb){a=b.getProcedureMap().get(a.procedureId);if(!a)throw Error(\"Cannot deserialize procedure delete event because the target procedure does not exist\");return new ProcedureDelete$$module$build$src$core$events$events_procedure_delete(b,a)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_DELETE$$module$build$src$core$events$utils,ProcedureDelete$$module$build$src$core$events$events_procedure_delete);\nvar module$build$src$core$events$events_procedure_delete={};module$build$src$core$events$events_procedure_delete.ProcedureDelete=ProcedureDelete$$module$build$src$core$events$events_procedure_delete;var ProcedureEnable$$module$build$src$core$events$events_procedure_enable=class extends ProcedureBase$$module$build$src$core$events$events_procedure_base{constructor(a,b){super(a,b);this.type=PROCEDURE_ENABLE$$module$build$src$core$events$utils;this.oldState=!b.getEnabled();this.newState=b.getEnabled()}run(a){const b=this.getEventWorkspace_().getProcedureMap().get(this.model.getId());if(!b)throw Error(\"Cannot change the enabled state of a procedure that does not exist in the procedure map\");a?b.setEnabled(this.newState):\nb.setEnabled(this.oldState)}toJson(){return super.toJson()}static fromJson(a,b){a=b.getProcedureMap().get(a.procedureId);if(!a)throw Error(\"Cannot deserialize procedure enable event because the target procedure does not exist\");return new ProcedureEnable$$module$build$src$core$events$events_procedure_enable(b,a)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_ENABLE$$module$build$src$core$events$utils,ProcedureEnable$$module$build$src$core$events$events_procedure_enable);\nvar module$build$src$core$events$events_procedure_enable={};module$build$src$core$events$events_procedure_enable.ProcedureEnable=ProcedureEnable$$module$build$src$core$events$events_procedure_enable;var ProcedureRename$$module$build$src$core$events$events_procedure_rename=class extends ProcedureBase$$module$build$src$core$events$events_procedure_base{constructor(a,b,c){super(a,b);this.oldName=c;this.type=PROCEDURE_RENAME$$module$build$src$core$events$utils;this.newName=b.getName()}run(a){const b=this.getEventWorkspace_().getProcedureMap().get(this.model.getId());if(!b)throw Error(\"Cannot change the type of a procedure that does not exist in the procedure map\");a?b.setName(this.newName):b.setName(this.oldName)}toJson(){const a=\nsuper.toJson();a.oldName=this.oldName;return a}static fromJson(a,b){const c=b.getProcedureMap().get(a.procedureId);if(!c)throw Error(\"Cannot deserialize procedure rename event because the target procedure does not exist\");return new ProcedureRename$$module$build$src$core$events$events_procedure_rename(b,c,a.oldName)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_RENAME$$module$build$src$core$events$utils,ProcedureRename$$module$build$src$core$events$events_procedure_rename);\nvar module$build$src$core$events$events_procedure_rename={};module$build$src$core$events$events_procedure_rename.ProcedureRename=ProcedureRename$$module$build$src$core$events$events_procedure_rename;var ProcedureParameterBase$$module$build$src$core$events$events_procedure_parameter_base=class extends ProcedureBase$$module$build$src$core$events$events_procedure_base{constructor(a,b,c){super(a,b);this.parameter=c}toJson(){const a=super.toJson();a.parameterId=this.model.getId();return a}},module$build$src$core$events$events_procedure_parameter_base={};module$build$src$core$events$events_procedure_parameter_base.ProcedureParameterBase=ProcedureParameterBase$$module$build$src$core$events$events_procedure_parameter_base;var ProcedureParameterCreate$$module$build$src$core$events$events_procedure_parameter_create=class extends ProcedureParameterBase$$module$build$src$core$events$events_procedure_parameter_base{constructor(a,b,c,d){super(a,b,c);this.index=d;this.type=PROCEDURE_PARAMETER_CREATE$$module$build$src$core$events$utils}run(a){const b=this.getEventWorkspace_(),c=b.getProcedureMap().get(this.model.getId());if(!c)throw Error(\"Cannot add a parameter to a procedure that does not exist in the procedure map\");const d=\nc.getParameter(this.index);a?this.parameterMatches(d)||c.insertParameter(new ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model(b,this.parameter.getName(),this.parameter.getId()),this.index):this.parameterMatches(d)&&c.deleteParameter(this.index)}parameterMatches(a){return a&&a.getId()===this.parameter.getId()}toJson(){const a=super.toJson();a.parameter=saveParameter$$module$build$src$core$serialization$procedures(this.parameter);a.index=this.index;return a}static fromJson(a,\nb){const c=b.getProcedureMap().get(a.procedureId);if(!c)throw Error(\"Cannot deserialize parameter create event because the target procedure does not exist\");return new ProcedureParameterCreate$$module$build$src$core$events$events_procedure_parameter_create(b,c,loadParameter$$module$build$src$core$serialization$procedures(ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model,a.parameter,b),a.index)}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_PARAMETER_CREATE$$module$build$src$core$events$utils,ProcedureParameterCreate$$module$build$src$core$events$events_procedure_parameter_create);var module$build$src$core$events$events_procedure_parameter_create={};module$build$src$core$events$events_procedure_parameter_create.ProcedureParameterCreate=ProcedureParameterCreate$$module$build$src$core$events$events_procedure_parameter_create;var ProcedureParameterDelete$$module$build$src$core$events$events_procedure_parameter_delete=class extends ProcedureParameterBase$$module$build$src$core$events$events_procedure_parameter_base{constructor(a,b,c,d){super(a,b,c);this.index=d;this.type=PROCEDURE_PARAMETER_DELETE$$module$build$src$core$events$utils}run(a){const b=this.getEventWorkspace_(),c=b.getProcedureMap().get(this.model.getId());if(!c)throw Error(\"Cannot add a parameter to a procedure that does not exist in the procedure map\");const d=\nc.getParameter(this.index);a?this.parameterMatches(d)&&c.deleteParameter(this.index):this.parameterMatches(d)||c.insertParameter(new ObservableParameterModel$$module$build$src$core$procedures$observable_parameter_model(b,this.parameter.getName(),this.parameter.getId()),this.index)}parameterMatches(a){return a&&a.getId()===this.parameter.getId()}toJson(){const a=super.toJson();a.index=this.index;return a}static fromJson(a,b){const c=b.getProcedureMap().get(a.procedureId);if(!c)throw Error(\"Cannot deserialize procedure delete event because the target procedure does not exist\");\nconst d=c.getParameter(a.index);return new ProcedureParameterDelete$$module$build$src$core$events$events_procedure_parameter_delete(b,c,d,a.index)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_PARAMETER_DELETE$$module$build$src$core$events$utils,ProcedureParameterDelete$$module$build$src$core$events$events_procedure_parameter_delete);var module$build$src$core$events$events_procedure_parameter_delete={};\nmodule$build$src$core$events$events_procedure_parameter_delete.ProcedureParameterDelete=ProcedureParameterDelete$$module$build$src$core$events$events_procedure_parameter_delete;var ProcedureParameterRename$$module$build$src$core$events$events_procedure_parameter_rename=class extends ProcedureParameterBase$$module$build$src$core$events$events_procedure_parameter_base{constructor(a,b,c,d){super(a,b,c);this.oldName=d;this.type=PROCEDURE_PARAMETER_RENAME$$module$build$src$core$events$utils;this.newName=c.getName()}run(a){const b=findMatchingParameter$$module$build$src$core$events$events_procedure_parameter_rename(this.getEventWorkspace_(),this.model.getId(),this.parameter.getId());\nif(!b)throw Error(\"Cannot rename a parameter that does not exist in the procedure map\");a?b.setName(this.newName):b.setName(this.oldName)}toJson(){const a=super.toJson();a.oldName=this.oldName;return a}static fromJson(a,b){const c=b.getProcedureMap().get(a.procedureId);if(!c)throw Error(\"Cannot deserialize procedure delete event because the target procedure does not exist\");const d=findMatchingParameter$$module$build$src$core$events$events_procedure_parameter_rename(b,a.procedureId,a.parameterId);\nif(!d)throw Error(\"Cannot deserialize parameter rename event because the target parameter does not exist\");return new ProcedureParameterRename$$module$build$src$core$events$events_procedure_parameter_rename(b,c,d,a.oldName)}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,PROCEDURE_PARAMETER_RENAME$$module$build$src$core$events$utils,ProcedureParameterRename$$module$build$src$core$events$events_procedure_parameter_rename);\nvar module$build$src$core$events$events_procedure_parameter_rename={};module$build$src$core$events$events_procedure_parameter_rename.ProcedureParameterRename=ProcedureParameterRename$$module$build$src$core$events$events_procedure_parameter_rename;var BlockDrag$$module$build$src$core$events$events_block_drag=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c){super(a?a.workspace.id:void 0);this.type=BLOCK_DRAG$$module$build$src$core$events$utils;a&&(this.blockId=a.id,this.isStart=b,this.blocks=c)}toJson(){const a=super.toJson();if(void 0===this.isStart)throw Error(\"Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson\");if(void 0===this.blockId)throw Error(\"The block ID is undefined. Either pass a block to the constructor, or call fromJson\");\na.isStart=this.isStart;a.blockId=this.blockId;a.blocks=this.blocks;return a}fromJson(a){warn$$module$build$src$core$utils$deprecation(\"Blockly.Events.BlockDrag.prototype.fromJson\",\"version 9\",\"version 10\",\"Blockly.Events.fromJson\");super.fromJson(a);this.isStart=a.isStart;this.blockId=a.blockId;this.blocks=a.blocks}static fromJson(a,b,c){b=super.fromJson(a,b,null!=c?c:new BlockDrag$$module$build$src$core$events$events_block_drag);b.isStart=a.isStart;b.blockId=a.blockId;b.blocks=a.blocks;return b}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,BLOCK_DRAG$$module$build$src$core$events$utils,BlockDrag$$module$build$src$core$events$events_block_drag);var module$build$src$core$events$events_block_drag={};module$build$src$core$events$events_block_drag.BlockDrag=BlockDrag$$module$build$src$core$events$events_block_drag;var Ui$$module$build$src$core$events$events_ui=class extends UiBase$$module$build$src$core$events$events_ui_base{constructor(a,b,c,d){super(a?a.workspace.id:void 0);this.type=UI$$module$build$src$core$events$utils;this.blockId=a?a.id:null;this.element=\"undefined\"===typeof b?\"\":b;this.oldValue=\"undefined\"===typeof c?\"\":c;this.newValue=\"undefined\"===typeof d?\"\":d}toJson(){const a=super.toJson();a.element=this.element;void 0!==this.newValue&&(a.newValue=this.newValue);this.blockId&&(a.blockId=this.blockId);\nreturn a}fromJson(a){super.fromJson(a);this.element=a.element;this.newValue=a.newValue;this.blockId=a.blockId}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,UI$$module$build$src$core$events$utils,Ui$$module$build$src$core$events$events_ui);var module$build$src$core$events$events_ui={};module$build$src$core$events$events_ui.Ui=Ui$$module$build$src$core$events$events_ui;var FinishedLoading$$module$build$src$core$events$workspace_events=class extends Abstract$$module$build$src$core$events$events_abstract{constructor(a){super();this.isBlank=!0;this.recordUndo=!1;this.type=FINISHED_LOADING$$module$build$src$core$events$utils;this.isBlank=!!a;a&&(this.workspaceId=a.id)}toJson(){const a=super.toJson();if(!this.workspaceId)throw Error(\"The workspace ID is undefined. Either pass a workspace to the constructor, or call fromJson\");a.workspaceId=this.workspaceId;return a}fromJson(a){super.fromJson(a);\nthis.workspaceId=a.workspaceId}};register$$module$build$src$core$registry(Type$$module$build$src$core$registry.EVENT,FINISHED_LOADING$$module$build$src$core$events$utils,FinishedLoading$$module$build$src$core$events$workspace_events);var module$build$src$core$events$workspace_events={};module$build$src$core$events$workspace_events.FinishedLoading=FinishedLoading$$module$build$src$core$events$workspace_events;var Abstract$$module$build$src$core$events$events,BLOCK_CHANGE$$module$build$src$core$events$events,BLOCK_CREATE$$module$build$src$core$events$events,BLOCK_DELETE$$module$build$src$core$events$events,BLOCK_DRAG$$module$build$src$core$events$events,BLOCK_MOVE$$module$build$src$core$events$events,BUBBLE_OPEN$$module$build$src$core$events$events,BUMP_EVENTS$$module$build$src$core$events$events,CHANGE$$module$build$src$core$events$events,CLICK$$module$build$src$core$events$events,COMMENT_CHANGE$$module$build$src$core$events$events,\nCOMMENT_CREATE$$module$build$src$core$events$events,COMMENT_DELETE$$module$build$src$core$events$events,COMMENT_MOVE$$module$build$src$core$events$events,CREATE$$module$build$src$core$events$events,DELETE$$module$build$src$core$events$events,FINISHED_LOADING$$module$build$src$core$events$events,MARKER_MOVE$$module$build$src$core$events$events,MOVE$$module$build$src$core$events$events,SELECTED$$module$build$src$core$events$events,THEME_CHANGE$$module$build$src$core$events$events,TOOLBOX_ITEM_SELECT$$module$build$src$core$events$events,\nTRASHCAN_OPEN$$module$build$src$core$events$events,UI$$module$build$src$core$events$events,VAR_CREATE$$module$build$src$core$events$events,VAR_DELETE$$module$build$src$core$events$events,VAR_RENAME$$module$build$src$core$events$events,VIEWPORT_CHANGE$$module$build$src$core$events$events,clearPendingUndo$$module$build$src$core$events$events,disable$$module$build$src$core$events$events,enable$$module$build$src$core$events$events,filter$$module$build$src$core$events$events,fire$$module$build$src$core$events$events,\nfromJson$$module$build$src$core$events$events,getDescendantIds$$module$build$src$core$events$events,get$$module$build$src$core$events$events,getGroup$$module$build$src$core$events$events,getRecordUndo$$module$build$src$core$events$events,isEnabled$$module$build$src$core$events$events,setGroup$$module$build$src$core$events$events,setRecordUndo$$module$build$src$core$events$events,disableOrphans$$module$build$src$core$events$events;Abstract$$module$build$src$core$events$events=Abstract$$module$build$src$core$events$events_abstract;\nBLOCK_CHANGE$$module$build$src$core$events$events=CHANGE$$module$build$src$core$events$utils;BLOCK_CREATE$$module$build$src$core$events$events=CREATE$$module$build$src$core$events$utils;BLOCK_DELETE$$module$build$src$core$events$events=DELETE$$module$build$src$core$events$utils;BLOCK_DRAG$$module$build$src$core$events$events=BLOCK_DRAG$$module$build$src$core$events$utils;BLOCK_MOVE$$module$build$src$core$events$events=MOVE$$module$build$src$core$events$utils;\nBUBBLE_OPEN$$module$build$src$core$events$events=BUBBLE_OPEN$$module$build$src$core$events$utils;BUMP_EVENTS$$module$build$src$core$events$events=BUMP_EVENTS$$module$build$src$core$events$utils;CHANGE$$module$build$src$core$events$events=CHANGE$$module$build$src$core$events$utils;CLICK$$module$build$src$core$events$events=CLICK$$module$build$src$core$events$utils;COMMENT_CHANGE$$module$build$src$core$events$events=COMMENT_CHANGE$$module$build$src$core$events$utils;\nCOMMENT_CREATE$$module$build$src$core$events$events=COMMENT_CREATE$$module$build$src$core$events$utils;COMMENT_DELETE$$module$build$src$core$events$events=COMMENT_DELETE$$module$build$src$core$events$utils;COMMENT_MOVE$$module$build$src$core$events$events=COMMENT_MOVE$$module$build$src$core$events$utils;CREATE$$module$build$src$core$events$events=CREATE$$module$build$src$core$events$utils;DELETE$$module$build$src$core$events$events=DELETE$$module$build$src$core$events$utils;\nFINISHED_LOADING$$module$build$src$core$events$events=FINISHED_LOADING$$module$build$src$core$events$utils;MARKER_MOVE$$module$build$src$core$events$events=MARKER_MOVE$$module$build$src$core$events$utils;MOVE$$module$build$src$core$events$events=MOVE$$module$build$src$core$events$utils;SELECTED$$module$build$src$core$events$events=SELECTED$$module$build$src$core$events$utils;THEME_CHANGE$$module$build$src$core$events$events=THEME_CHANGE$$module$build$src$core$events$utils;\nTOOLBOX_ITEM_SELECT$$module$build$src$core$events$events=TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils;TRASHCAN_OPEN$$module$build$src$core$events$events=TRASHCAN_OPEN$$module$build$src$core$events$utils;UI$$module$build$src$core$events$events=UI$$module$build$src$core$events$utils;VAR_CREATE$$module$build$src$core$events$events=VAR_CREATE$$module$build$src$core$events$utils;VAR_DELETE$$module$build$src$core$events$events=VAR_DELETE$$module$build$src$core$events$utils;\nVAR_RENAME$$module$build$src$core$events$events=VAR_RENAME$$module$build$src$core$events$utils;VIEWPORT_CHANGE$$module$build$src$core$events$events=VIEWPORT_CHANGE$$module$build$src$core$events$utils;clearPendingUndo$$module$build$src$core$events$events=clearPendingUndo$$module$build$src$core$events$utils;disable$$module$build$src$core$events$events=disable$$module$build$src$core$events$utils;enable$$module$build$src$core$events$events=enable$$module$build$src$core$events$utils;\nfilter$$module$build$src$core$events$events=filter$$module$build$src$core$events$utils;fire$$module$build$src$core$events$events=fire$$module$build$src$core$events$utils;fromJson$$module$build$src$core$events$events=fromJson$$module$build$src$core$events$utils;getDescendantIds$$module$build$src$core$events$events=getDescendantIds$$module$build$src$core$events$utils;get$$module$build$src$core$events$events=get$$module$build$src$core$events$utils;getGroup$$module$build$src$core$events$events=getGroup$$module$build$src$core$events$utils;\ngetRecordUndo$$module$build$src$core$events$events=getRecordUndo$$module$build$src$core$events$utils;isEnabled$$module$build$src$core$events$events=isEnabled$$module$build$src$core$events$utils;setGroup$$module$build$src$core$events$events=setGroup$$module$build$src$core$events$utils;setRecordUndo$$module$build$src$core$events$events=setRecordUndo$$module$build$src$core$events$utils;disableOrphans$$module$build$src$core$events$events=disableOrphans$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events={};$.module$build$src$core$events$events.Abstract=Abstract$$module$build$src$core$events$events_abstract;$.module$build$src$core$events$events.BLOCK_CHANGE=CHANGE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.BLOCK_CREATE=CREATE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.BLOCK_DELETE=DELETE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.BLOCK_DRAG=BLOCK_DRAG$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.BLOCK_MOVE=MOVE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.BUBBLE_OPEN=BUBBLE_OPEN$$module$build$src$core$events$utils;$.module$build$src$core$events$events.BUMP_EVENTS=BUMP_EVENTS$$module$build$src$core$events$utils;$.module$build$src$core$events$events.BlockBase=BlockBase$$module$build$src$core$events$events_block_base;$.module$build$src$core$events$events.BlockChange=BlockChange$$module$build$src$core$events$events_block_change;\n$.module$build$src$core$events$events.BlockCreate=BlockCreate$$module$build$src$core$events$events_block_create;$.module$build$src$core$events$events.BlockDelete=BlockDelete$$module$build$src$core$events$events_block_delete;$.module$build$src$core$events$events.BlockDrag=BlockDrag$$module$build$src$core$events$events_block_drag;$.module$build$src$core$events$events.BlockMove=BlockMove$$module$build$src$core$events$events_block_move;$.module$build$src$core$events$events.BubbleOpen=BubbleOpen$$module$build$src$core$events$events_bubble_open;\n$.module$build$src$core$events$events.BubbleType=BubbleType$$module$build$src$core$events$events_bubble_open;$.module$build$src$core$events$events.CHANGE=CHANGE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.CLICK=CLICK$$module$build$src$core$events$utils;$.module$build$src$core$events$events.COMMENT_CHANGE=COMMENT_CHANGE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.COMMENT_CREATE=COMMENT_CREATE$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.COMMENT_DELETE=COMMENT_DELETE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.COMMENT_MOVE=COMMENT_MOVE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.CREATE=CREATE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.Click=Click$$module$build$src$core$events$events_click;$.module$build$src$core$events$events.ClickTarget=ClickTarget$$module$build$src$core$events$events_click;\n$.module$build$src$core$events$events.CommentBase=CommentBase$$module$build$src$core$events$events_comment_base;$.module$build$src$core$events$events.CommentChange=CommentChange$$module$build$src$core$events$events_comment_change;$.module$build$src$core$events$events.CommentCreate=CommentCreate$$module$build$src$core$events$events_comment_create;$.module$build$src$core$events$events.CommentDelete=CommentDelete$$module$build$src$core$events$events_comment_delete;\n$.module$build$src$core$events$events.CommentMove=CommentMove$$module$build$src$core$events$events_comment_move;$.module$build$src$core$events$events.DELETE=DELETE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.FINISHED_LOADING=FINISHED_LOADING$$module$build$src$core$events$utils;$.module$build$src$core$events$events.FinishedLoading=FinishedLoading$$module$build$src$core$events$workspace_events;$.module$build$src$core$events$events.MARKER_MOVE=MARKER_MOVE$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.MOVE=MOVE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.MarkerMove=MarkerMove$$module$build$src$core$events$events_marker_move;$.module$build$src$core$events$events.ProcedureBase=ProcedureBase$$module$build$src$core$events$events_procedure_base;$.module$build$src$core$events$events.ProcedureChangeReturn=ProcedureChangeReturn$$module$build$src$core$events$events_procedure_change_return;\n$.module$build$src$core$events$events.ProcedureCreate=ProcedureCreate$$module$build$src$core$events$events_procedure_create;$.module$build$src$core$events$events.ProcedureDelete=ProcedureDelete$$module$build$src$core$events$events_procedure_delete;$.module$build$src$core$events$events.ProcedureEnable=ProcedureEnable$$module$build$src$core$events$events_procedure_enable;$.module$build$src$core$events$events.ProcedureParameterBase=ProcedureParameterBase$$module$build$src$core$events$events_procedure_parameter_base;\n$.module$build$src$core$events$events.ProcedureParameterCreate=ProcedureParameterCreate$$module$build$src$core$events$events_procedure_parameter_create;$.module$build$src$core$events$events.ProcedureParameterDelete=ProcedureParameterDelete$$module$build$src$core$events$events_procedure_parameter_delete;$.module$build$src$core$events$events.ProcedureParameterRename=ProcedureParameterRename$$module$build$src$core$events$events_procedure_parameter_rename;\n$.module$build$src$core$events$events.ProcedureRename=ProcedureRename$$module$build$src$core$events$events_procedure_rename;$.module$build$src$core$events$events.SELECTED=SELECTED$$module$build$src$core$events$utils;$.module$build$src$core$events$events.Selected=Selected$$module$build$src$core$events$events_selected;$.module$build$src$core$events$events.THEME_CHANGE=THEME_CHANGE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.TOOLBOX_ITEM_SELECT=TOOLBOX_ITEM_SELECT$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.TRASHCAN_OPEN=TRASHCAN_OPEN$$module$build$src$core$events$utils;$.module$build$src$core$events$events.ThemeChange=ThemeChange$$module$build$src$core$events$events_theme_change;$.module$build$src$core$events$events.ToolboxItemSelect=ToolboxItemSelect$$module$build$src$core$events$events_toolbox_item_select;$.module$build$src$core$events$events.TrashcanOpen=TrashcanOpen$$module$build$src$core$events$events_trashcan_open;\n$.module$build$src$core$events$events.UI=UI$$module$build$src$core$events$utils;$.module$build$src$core$events$events.Ui=Ui$$module$build$src$core$events$events_ui;$.module$build$src$core$events$events.UiBase=UiBase$$module$build$src$core$events$events_ui_base;$.module$build$src$core$events$events.VAR_CREATE=VAR_CREATE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.VAR_DELETE=VAR_DELETE$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.VAR_RENAME=VAR_RENAME$$module$build$src$core$events$utils;$.module$build$src$core$events$events.VIEWPORT_CHANGE=VIEWPORT_CHANGE$$module$build$src$core$events$utils;$.module$build$src$core$events$events.VarBase=VarBase$$module$build$src$core$events$events_var_base;$.module$build$src$core$events$events.VarCreate=VarCreate$$module$build$src$core$events$events_var_create;$.module$build$src$core$events$events.VarDelete=VarDelete$$module$build$src$core$events$events_var_delete;\n$.module$build$src$core$events$events.VarRename=VarRename$$module$build$src$core$events$events_var_rename;$.module$build$src$core$events$events.ViewportChange=ViewportChange$$module$build$src$core$events$events_viewport;$.module$build$src$core$events$events.clearPendingUndo=clearPendingUndo$$module$build$src$core$events$utils;$.module$build$src$core$events$events.disable=disable$$module$build$src$core$events$utils;$.module$build$src$core$events$events.disableOrphans=disableOrphans$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.enable=enable$$module$build$src$core$events$utils;$.module$build$src$core$events$events.filter=filter$$module$build$src$core$events$utils;$.module$build$src$core$events$events.fire=fire$$module$build$src$core$events$utils;$.module$build$src$core$events$events.fromJson=fromJson$$module$build$src$core$events$utils;$.module$build$src$core$events$events.get=get$$module$build$src$core$events$utils;$.module$build$src$core$events$events.getDescendantIds=getDescendantIds$$module$build$src$core$events$utils;\n$.module$build$src$core$events$events.getGroup=getGroup$$module$build$src$core$events$utils;$.module$build$src$core$events$events.getRecordUndo=getRecordUndo$$module$build$src$core$events$utils;$.module$build$src$core$events$events.isEnabled=isEnabled$$module$build$src$core$events$utils;$.module$build$src$core$events$events.setGroup=setGroup$$module$build$src$core$events$utils;$.module$build$src$core$events$events.setRecordUndo=setRecordUndo$$module$build$src$core$events$utils;registerDefaultOptions$$module$build$src$core$contextmenu_items();var module$build$src$core$contextmenu_items={};module$build$src$core$contextmenu_items.registerCleanup=registerCleanup$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerCollapse=registerCollapse$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerCollapseExpandBlock=registerCollapseExpandBlock$$module$build$src$core$contextmenu_items;\nmodule$build$src$core$contextmenu_items.registerComment=registerComment$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerDefaultOptions=registerDefaultOptions$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerDelete=registerDelete$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerDeleteAll=registerDeleteAll$$module$build$src$core$contextmenu_items;\nmodule$build$src$core$contextmenu_items.registerDisable=registerDisable$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerDuplicate=registerDuplicate$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerExpand=registerExpand$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerHelp=registerHelp$$module$build$src$core$contextmenu_items;\nmodule$build$src$core$contextmenu_items.registerInline=registerInline$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerRedo=registerRedo$$module$build$src$core$contextmenu_items;module$build$src$core$contextmenu_items.registerUndo=registerUndo$$module$build$src$core$contextmenu_items;var BlockDragger$$module$build$src$core$block_dragger=class{constructor(a,b){this.dragTarget_=null;this.wouldDeleteBlock_=!1;this.draggingBlock_=a;this.draggedConnectionManager_=new InsertionMarkerManager$$module$build$src$core$insertion_marker_manager(this.draggingBlock_);this.workspace_=b;this.startXY_=this.draggingBlock_.getRelativeToSurfaceXY();this.dragIconData_=initIconData$$module$build$src$core$block_dragger(a)}dispose(){this.dragIconData_.length=0;this.draggedConnectionManager_&&this.draggedConnectionManager_.dispose()}startDrag(a,\nb){getGroup$$module$build$src$core$events$utils()||setGroup$$module$build$src$core$events$utils(!0);this.fireDragStartEvent_();this.workspace_.isMutator&&this.draggingBlock_.bringToFront();startTextWidthCache$$module$build$src$core$utils$dom();this.workspace_.setResizesEnabled(!1);disconnectUiStop$$module$build$src$core$block_animations();this.shouldDisconnect_(b)&&this.disconnectBlock_(b,a);this.draggingBlock_.setDragging(!0);this.draggingBlock_.moveToDragSurface()}shouldDisconnect_(a){return!!(this.draggingBlock_.getParent()||\na&&this.draggingBlock_.nextConnection&&this.draggingBlock_.nextConnection.targetBlock())}disconnectBlock_(a,b){this.draggingBlock_.unplug(a);a=this.pixelsToWorkspaceUnits_(b);a=Coordinate$$module$build$src$core$utils$coordinate.sum(this.startXY_,a);this.draggingBlock_.translate(a.x,a.y);disconnectUiEffect$$module$build$src$core$block_animations(this.draggingBlock_);this.draggedConnectionManager_.updateAvailableConnections()}fireDragStartEvent_(){const a=new (get$$module$build$src$core$events$utils(BLOCK_DRAG$$module$build$src$core$events$utils))(this.draggingBlock_,\n!0,this.draggingBlock_.getDescendants(!1));fire$$module$build$src$core$events$utils(a)}drag(a,b){b=this.pixelsToWorkspaceUnits_(b);var c=Coordinate$$module$build$src$core$utils$coordinate.sum(this.startXY_,b);this.draggingBlock_.moveDuringDrag(c);this.dragIcons_(b);c=this.dragTarget_;this.dragTarget_=this.workspace_.getDragTarget(a);this.draggedConnectionManager_.update(b,this.dragTarget_);a=this.wouldDeleteBlock_;this.wouldDeleteBlock_=this.draggedConnectionManager_.wouldDeleteBlock;a!==this.wouldDeleteBlock_&&\nthis.updateCursorDuringBlockDrag_();this.dragTarget_!==c&&(c&&c.onDragExit(this.draggingBlock_),this.dragTarget_&&this.dragTarget_.onDragEnter(this.draggingBlock_));this.dragTarget_&&this.dragTarget_.onDragOver(this.draggingBlock_)}endDrag(a,b){this.drag(a,b);this.dragIconData_=[];this.fireDragEndEvent_();stopTextWidthCache$$module$build$src$core$utils$dom();disconnectUiStop$$module$build$src$core$block_animations();a=null;this.dragTarget_&&this.dragTarget_.shouldPreventMove(this.draggingBlock_)?\nb=this.startXY_:(b=this.getNewLocationAfterDrag_(b),a=b.delta,b=b.newLocation);this.draggingBlock_.moveOffDragSurface(b);if(this.dragTarget_)this.dragTarget_.onDrop(this.draggingBlock_);this.maybeDeleteBlock_()||(this.draggingBlock_.setDragging(!1),a?this.updateBlockAfterMove_(a):bumpObjectIntoBounds$$module$build$src$core$bump_objects(this.draggingBlock_.workspace,this.workspace_.getMetricsManager().getScrollMetrics(!0),this.draggingBlock_));this.workspace_.setResizesEnabled(!0);setGroup$$module$build$src$core$events$utils(!1)}getNewLocationAfterDrag_(a){a=\nthis.pixelsToWorkspaceUnits_(a);const b=Coordinate$$module$build$src$core$utils$coordinate.sum(this.startXY_,a);return{delta:a,newLocation:b}}maybeDeleteBlock_(){return this.wouldDeleteBlock_?(this.fireMoveEvent_(),this.draggingBlock_.dispose(!1,!0),draggingConnections$$module$build$src$core$common.length=0,!0):!1}updateBlockAfterMove_(a){this.draggingBlock_.moveConnections(a.x,a.y);this.fireMoveEvent_();this.draggedConnectionManager_.wouldConnectBlock()?this.draggedConnectionManager_.applyConnections():\nthis.draggingBlock_.render();this.draggingBlock_.scheduleSnapAndBump()}fireDragEndEvent_(){const a=new (get$$module$build$src$core$events$utils(BLOCK_DRAG$$module$build$src$core$events$utils))(this.draggingBlock_,!1,this.draggingBlock_.getDescendants(!1));fire$$module$build$src$core$events$utils(a)}updateToolboxStyle_(a){const b=this.workspace_.getToolbox();if(b){const c=this.draggingBlock_.isDeletable()?\"blocklyToolboxDelete\":\"blocklyToolboxGrab\";a&&\"function\"===typeof b.removeStyle?b.removeStyle(c):\na||\"function\"!==typeof b.addStyle||b.addStyle(c)}}fireMoveEvent_(){const a=new (get$$module$build$src$core$events$utils(MOVE$$module$build$src$core$events$utils))(this.draggingBlock_);a.oldCoordinate=this.startXY_;a.recordNew();fire$$module$build$src$core$events$utils(a)}updateCursorDuringBlockDrag_(){this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_)}pixelsToWorkspaceUnits_(a){a=new Coordinate$$module$build$src$core$utils$coordinate(a.x/this.workspace_.scale,a.y/this.workspace_.scale);this.workspace_.isMutator&&\na.scale(1/this.workspace_.options.parentWorkspace.scale);return a}dragIcons_(a){for(let b=0;b<this.dragIconData_.length;b++){const c=this.dragIconData_[b];c.icon.setIconLocation(Coordinate$$module$build$src$core$utils$coordinate.sum(c.location,a))}}getInsertionMarkers(){return this.draggedConnectionManager_&&this.draggedConnectionManager_.getInsertionMarkers?this.draggedConnectionManager_.getInsertionMarkers():[]}};\nregister$$module$build$src$core$registry(Type$$module$build$src$core$registry.BLOCK_DRAGGER,DEFAULT$$module$build$src$core$registry,BlockDragger$$module$build$src$core$block_dragger);var module$build$src$core$block_dragger={};module$build$src$core$block_dragger.BlockDragger=BlockDragger$$module$build$src$core$block_dragger;var VERSION$$module$build$src$core$blockly=\"9.2.0\",ALIGN_LEFT$$module$build$src$core$blockly=$.Align$$module$build$src$core$input.LEFT,ALIGN_CENTRE$$module$build$src$core$blockly=$.Align$$module$build$src$core$input.CENTRE,ALIGN_RIGHT$$module$build$src$core$blockly=$.Align$$module$build$src$core$input.RIGHT,INPUT_VALUE$$module$build$src$core$blockly=ConnectionType$$module$build$src$core$connection_type.INPUT_VALUE,OUTPUT_VALUE$$module$build$src$core$blockly=ConnectionType$$module$build$src$core$connection_type.OUTPUT_VALUE,\nNEXT_STATEMENT$$module$build$src$core$blockly=ConnectionType$$module$build$src$core$connection_type.NEXT_STATEMENT,PREVIOUS_STATEMENT$$module$build$src$core$blockly=ConnectionType$$module$build$src$core$connection_type.PREVIOUS_STATEMENT,DUMMY_INPUT$$module$build$src$core$blockly=inputTypes$$module$build$src$core$input_types.DUMMY,TOOLBOX_AT_TOP$$module$build$src$core$blockly=Position$$module$build$src$core$utils$toolbox.TOP,TOOLBOX_AT_BOTTOM$$module$build$src$core$blockly=Position$$module$build$src$core$utils$toolbox.BOTTOM,\nTOOLBOX_AT_LEFT$$module$build$src$core$blockly=Position$$module$build$src$core$utils$toolbox.LEFT,TOOLBOX_AT_RIGHT$$module$build$src$core$blockly=Position$$module$build$src$core$utils$toolbox.RIGHT,svgResize$$module$build$src$core$blockly=svgResize$$module$build$src$core$common,getMainWorkspace$$module$build$src$core$blockly=getMainWorkspace$$module$build$src$core$common,getSelected$$module$build$src$core$blockly=getSelected$$module$build$src$core$common,defineBlocksWithJsonArray$$module$build$src$core$blockly=\ndefineBlocksWithJsonArray$$module$build$src$core$common,setParentContainer$$module$build$src$core$blockly=setParentContainer$$module$build$src$core$common,resizeSvgContents$$module$build$src$core$blockly=resizeSvgContentsLocal$$module$build$src$core$blockly,COLLAPSE_CHARS$$module$build$src$core$blockly=COLLAPSE_CHARS$$module$build$src$core$internal_constants,DRAG_STACK$$module$build$src$core$blockly=DRAG_STACK$$module$build$src$core$internal_constants,OPPOSITE_TYPE$$module$build$src$core$blockly=\nOPPOSITE_TYPE$$module$build$src$core$internal_constants,RENAME_VARIABLE_ID$$module$build$src$core$blockly=RENAME_VARIABLE_ID$$module$build$src$core$internal_constants,DELETE_VARIABLE_ID$$module$build$src$core$blockly=DELETE_VARIABLE_ID$$module$build$src$core$internal_constants,COLLAPSED_INPUT_NAME$$module$build$src$core$blockly=COLLAPSED_INPUT_NAME$$module$build$src$core$constants,COLLAPSED_FIELD_NAME$$module$build$src$core$blockly=COLLAPSED_FIELD_NAME$$module$build$src$core$constants,VARIABLE_CATEGORY_NAME$$module$build$src$core$blockly=\nCATEGORY_NAME$$module$build$src$core$variables,VARIABLE_DYNAMIC_CATEGORY_NAME$$module$build$src$core$blockly=CATEGORY_NAME$$module$build$src$core$variables_dynamic,PROCEDURE_CATEGORY_NAME$$module$build$src$core$blockly=CATEGORY_NAME$$module$build$src$core$procedures;Workspace$$module$build$src$core$workspace.prototype.newBlock=function(a,b){return new Block$$module$build$src$core$block(this,a,b)};\nWorkspaceSvg$$module$build$src$core$workspace_svg.prototype.newBlock=function(a,b){return new BlockSvg$$module$build$src$core$block_svg(this,a,b)};WorkspaceSvg$$module$build$src$core$workspace_svg.newTrashcan=function(a){return new Trashcan$$module$build$src$core$trashcan(a)};\nWorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg.prototype.showContextMenu=function(a){if(!this.workspace.options.readOnly){var b=[];this.isDeletable()&&this.isMovable()&&(b.push(commentDuplicateOption$$module$build$src$core$contextmenu(this)),b.push(commentDeleteOption$$module$build$src$core$contextmenu(this)));show$$module$build$src$core$contextmenu(a,b,this.RTL)}};$.Mutator$$module$build$src$core$mutator.prototype.newWorkspaceSvg=function(a){return new WorkspaceSvg$$module$build$src$core$workspace_svg(a)};\nNames$$module$build$src$core$names.prototype.populateProcedures=function(a){a=allProcedures$$module$build$src$core$procedures(a);a=a[0].concat(a[1]);for(let b=0;b<a.length;b++)this.getName(a[b][0],Names$$module$build$src$core$names.NameType.PROCEDURE)};var DropDownDiv$$module$build$src$core$blockly=module$build$src$core$dropdowndiv,connectionTypes$$module$build$src$core$blockly=ConnectionType$$module$build$src$core$connection_type,module$build$src$core$blockly={};\nmodule$build$src$core$blockly.ALIGN_CENTRE=ALIGN_CENTRE$$module$build$src$core$blockly;module$build$src$core$blockly.ALIGN_LEFT=ALIGN_LEFT$$module$build$src$core$blockly;module$build$src$core$blockly.ALIGN_RIGHT=ALIGN_RIGHT$$module$build$src$core$blockly;module$build$src$core$blockly.ASTNode=ASTNode$$module$build$src$core$keyboard_nav$ast_node;module$build$src$core$blockly.BasicCursor=BasicCursor$$module$build$src$core$keyboard_nav$basic_cursor;module$build$src$core$blockly.Block=Block$$module$build$src$core$block;\nmodule$build$src$core$blockly.BlockDragSurfaceSvg=BlockDragSurfaceSvg$$module$build$src$core$block_drag_surface;module$build$src$core$blockly.BlockDragger=BlockDragger$$module$build$src$core$block_dragger;module$build$src$core$blockly.BlockSvg=BlockSvg$$module$build$src$core$block_svg;module$build$src$core$blockly.Blocks=Blocks$$module$build$src$core$blocks;module$build$src$core$blockly.Bubble=Bubble$$module$build$src$core$bubble;module$build$src$core$blockly.BubbleDragger=BubbleDragger$$module$build$src$core$bubble_dragger;\nmodule$build$src$core$blockly.COLLAPSED_FIELD_NAME=COLLAPSED_FIELD_NAME$$module$build$src$core$constants;module$build$src$core$blockly.COLLAPSED_INPUT_NAME=COLLAPSED_INPUT_NAME$$module$build$src$core$constants;module$build$src$core$blockly.COLLAPSE_CHARS=COLLAPSE_CHARS$$module$build$src$core$internal_constants;module$build$src$core$blockly.CodeGenerator=$.CodeGenerator$$module$build$src$core$generator;module$build$src$core$blockly.CollapsibleToolboxCategory=CollapsibleToolboxCategory$$module$build$src$core$toolbox$collapsible_category;\nmodule$build$src$core$blockly.Comment=Comment$$module$build$src$core$comment;module$build$src$core$blockly.ComponentManager=ComponentManager$$module$build$src$core$component_manager;module$build$src$core$blockly.Connection=Connection$$module$build$src$core$connection;module$build$src$core$blockly.ConnectionChecker=ConnectionChecker$$module$build$src$core$connection_checker;module$build$src$core$blockly.ConnectionDB=ConnectionDB$$module$build$src$core$connection_db;\nmodule$build$src$core$blockly.ConnectionType=ConnectionType$$module$build$src$core$connection_type;module$build$src$core$blockly.ContextMenu=$.module$build$src$core$contextmenu;module$build$src$core$blockly.ContextMenuItems=module$build$src$core$contextmenu_items;module$build$src$core$blockly.ContextMenuRegistry=ContextMenuRegistry$$module$build$src$core$contextmenu_registry;module$build$src$core$blockly.Css=module$build$src$core$css;module$build$src$core$blockly.Cursor=Cursor$$module$build$src$core$keyboard_nav$cursor;\nmodule$build$src$core$blockly.DELETE_VARIABLE_ID=DELETE_VARIABLE_ID$$module$build$src$core$internal_constants;module$build$src$core$blockly.DRAG_STACK=DRAG_STACK$$module$build$src$core$internal_constants;module$build$src$core$blockly.DUMMY_INPUT=DUMMY_INPUT$$module$build$src$core$blockly;module$build$src$core$blockly.DeleteArea=DeleteArea$$module$build$src$core$delete_area;module$build$src$core$blockly.DragTarget=DragTarget$$module$build$src$core$drag_target;\nmodule$build$src$core$blockly.DropDownDiv=module$build$src$core$dropdowndiv;module$build$src$core$blockly.Events=$.module$build$src$core$events$events;module$build$src$core$blockly.Extensions=$.module$build$src$core$extensions;module$build$src$core$blockly.Field=Field$$module$build$src$core$field;module$build$src$core$blockly.FieldAngle=FieldAngle$$module$build$src$core$field_angle;module$build$src$core$blockly.FieldCheckbox=$.FieldCheckbox$$module$build$src$core$field_checkbox;\nmodule$build$src$core$blockly.FieldColour=FieldColour$$module$build$src$core$field_colour;module$build$src$core$blockly.FieldDropdown=FieldDropdown$$module$build$src$core$field_dropdown;module$build$src$core$blockly.FieldImage=$.FieldImage$$module$build$src$core$field_image;module$build$src$core$blockly.FieldLabel=$.FieldLabel$$module$build$src$core$field_label;module$build$src$core$blockly.FieldLabelSerializable=FieldLabelSerializable$$module$build$src$core$field_label_serializable;\nmodule$build$src$core$blockly.FieldMultilineInput=FieldMultilineInput$$module$build$src$core$field_multilineinput;module$build$src$core$blockly.FieldNumber=FieldNumber$$module$build$src$core$field_number;module$build$src$core$blockly.FieldTextInput=$.FieldTextInput$$module$build$src$core$field_textinput;module$build$src$core$blockly.FieldVariable=FieldVariable$$module$build$src$core$field_variable;module$build$src$core$blockly.Flyout=Flyout$$module$build$src$core$flyout_base;\nmodule$build$src$core$blockly.FlyoutButton=FlyoutButton$$module$build$src$core$flyout_button;module$build$src$core$blockly.FlyoutMetricsManager=FlyoutMetricsManager$$module$build$src$core$flyout_metrics_manager;module$build$src$core$blockly.Generator=$.CodeGenerator$$module$build$src$core$generator;module$build$src$core$blockly.Gesture=Gesture$$module$build$src$core$gesture;module$build$src$core$blockly.Grid=Grid$$module$build$src$core$grid;module$build$src$core$blockly.HorizontalFlyout=HorizontalFlyout$$module$build$src$core$flyout_horizontal;\nmodule$build$src$core$blockly.INPUT_VALUE=INPUT_VALUE$$module$build$src$core$blockly;module$build$src$core$blockly.Icon=Icon$$module$build$src$core$icon;module$build$src$core$blockly.Input=Input$$module$build$src$core$input;module$build$src$core$blockly.InsertionMarkerManager=InsertionMarkerManager$$module$build$src$core$insertion_marker_manager;module$build$src$core$blockly.Marker=Marker$$module$build$src$core$keyboard_nav$marker;module$build$src$core$blockly.MarkerManager=MarkerManager$$module$build$src$core$marker_manager;\nmodule$build$src$core$blockly.Menu=Menu$$module$build$src$core$menu;module$build$src$core$blockly.MenuItem=MenuItem$$module$build$src$core$menuitem;module$build$src$core$blockly.MetricsManager=MetricsManager$$module$build$src$core$metrics_manager;module$build$src$core$blockly.Msg=Msg$$module$build$src$core$msg;module$build$src$core$blockly.Mutator=$.Mutator$$module$build$src$core$mutator;module$build$src$core$blockly.NEXT_STATEMENT=NEXT_STATEMENT$$module$build$src$core$blockly;\nmodule$build$src$core$blockly.Names=Names$$module$build$src$core$names;module$build$src$core$blockly.OPPOSITE_TYPE=OPPOSITE_TYPE$$module$build$src$core$internal_constants;module$build$src$core$blockly.OUTPUT_VALUE=OUTPUT_VALUE$$module$build$src$core$blockly;module$build$src$core$blockly.Options=Options$$module$build$src$core$options;module$build$src$core$blockly.PREVIOUS_STATEMENT=PREVIOUS_STATEMENT$$module$build$src$core$blockly;module$build$src$core$blockly.PROCEDURE_CATEGORY_NAME=CATEGORY_NAME$$module$build$src$core$procedures;\nmodule$build$src$core$blockly.Procedures=$.module$build$src$core$procedures;module$build$src$core$blockly.RENAME_VARIABLE_ID=RENAME_VARIABLE_ID$$module$build$src$core$internal_constants;module$build$src$core$blockly.RenderedConnection=RenderedConnection$$module$build$src$core$rendered_connection;module$build$src$core$blockly.Scrollbar=Scrollbar$$module$build$src$core$scrollbar;module$build$src$core$blockly.ScrollbarPair=ScrollbarPair$$module$build$src$core$scrollbar_pair;\nmodule$build$src$core$blockly.ShortcutItems=module$build$src$core$shortcut_items;module$build$src$core$blockly.ShortcutRegistry=ShortcutRegistry$$module$build$src$core$shortcut_registry;module$build$src$core$blockly.TOOLBOX_AT_BOTTOM=TOOLBOX_AT_BOTTOM$$module$build$src$core$blockly;module$build$src$core$blockly.TOOLBOX_AT_LEFT=TOOLBOX_AT_LEFT$$module$build$src$core$blockly;module$build$src$core$blockly.TOOLBOX_AT_RIGHT=TOOLBOX_AT_RIGHT$$module$build$src$core$blockly;\nmodule$build$src$core$blockly.TOOLBOX_AT_TOP=TOOLBOX_AT_TOP$$module$build$src$core$blockly;module$build$src$core$blockly.TabNavigateCursor=TabNavigateCursor$$module$build$src$core$keyboard_nav$tab_navigate_cursor;module$build$src$core$blockly.Theme=Theme$$module$build$src$core$theme;module$build$src$core$blockly.ThemeManager=ThemeManager$$module$build$src$core$theme_manager;module$build$src$core$blockly.Themes=module$build$src$core$theme$themes;module$build$src$core$blockly.Toolbox=Toolbox$$module$build$src$core$toolbox$toolbox;\nmodule$build$src$core$blockly.ToolboxCategory=ToolboxCategory$$module$build$src$core$toolbox$category;module$build$src$core$blockly.ToolboxItem=ToolboxItem$$module$build$src$core$toolbox$toolbox_item;module$build$src$core$blockly.ToolboxSeparator=ToolboxSeparator$$module$build$src$core$toolbox$separator;module$build$src$core$blockly.Tooltip=module$build$src$core$tooltip;module$build$src$core$blockly.Touch=module$build$src$core$touch;module$build$src$core$blockly.TouchGesture=Gesture$$module$build$src$core$gesture;\nmodule$build$src$core$blockly.Trashcan=Trashcan$$module$build$src$core$trashcan;module$build$src$core$blockly.VARIABLE_CATEGORY_NAME=CATEGORY_NAME$$module$build$src$core$variables;module$build$src$core$blockly.VARIABLE_DYNAMIC_CATEGORY_NAME=CATEGORY_NAME$$module$build$src$core$variables_dynamic;module$build$src$core$blockly.VERSION=VERSION$$module$build$src$core$blockly;module$build$src$core$blockly.VariableMap=VariableMap$$module$build$src$core$variable_map;\nmodule$build$src$core$blockly.VariableModel=VariableModel$$module$build$src$core$variable_model;module$build$src$core$blockly.Variables=$.module$build$src$core$variables;module$build$src$core$blockly.VariablesDynamic=module$build$src$core$variables_dynamic;module$build$src$core$blockly.VerticalFlyout=VerticalFlyout$$module$build$src$core$flyout_vertical;module$build$src$core$blockly.Warning=Warning$$module$build$src$core$warning;module$build$src$core$blockly.WidgetDiv=module$build$src$core$widgetdiv;\nmodule$build$src$core$blockly.Workspace=Workspace$$module$build$src$core$workspace;module$build$src$core$blockly.WorkspaceAudio=WorkspaceAudio$$module$build$src$core$workspace_audio;module$build$src$core$blockly.WorkspaceComment=WorkspaceComment$$module$build$src$core$workspace_comment;module$build$src$core$blockly.WorkspaceCommentSvg=WorkspaceCommentSvg$$module$build$src$core$workspace_comment_svg;module$build$src$core$blockly.WorkspaceDragSurfaceSvg=WorkspaceDragSurfaceSvg$$module$build$src$core$workspace_drag_surface_svg;\nmodule$build$src$core$blockly.WorkspaceDragger=WorkspaceDragger$$module$build$src$core$workspace_dragger;module$build$src$core$blockly.WorkspaceSvg=WorkspaceSvg$$module$build$src$core$workspace_svg;module$build$src$core$blockly.Xml=$.module$build$src$core$xml;module$build$src$core$blockly.ZoomControls=ZoomControls$$module$build$src$core$zoom_controls;module$build$src$core$blockly.bindEventWithChecks_=bindEventWithChecks_$$module$build$src$core$blockly;module$build$src$core$blockly.bindEvent_=bindEvent_$$module$build$src$core$blockly;\nmodule$build$src$core$blockly.blockAnimations=module$build$src$core$block_animations;module$build$src$core$blockly.blockRendering=module$build$src$core$renderers$common$block_rendering;module$build$src$core$blockly.browserEvents=module$build$src$core$browser_events;module$build$src$core$blockly.bumpObjects=module$build$src$core$bump_objects;module$build$src$core$blockly.clipboard=module$build$src$core$clipboard;module$build$src$core$blockly.common=$.module$build$src$core$common;\nmodule$build$src$core$blockly.config=$.config$$module$build$src$core$config;module$build$src$core$blockly.connectionTypes=connectionTypes$$module$build$src$core$blockly;module$build$src$core$blockly.constants=module$build$src$core$constants;module$build$src$core$blockly.copy=copy$$module$build$src$core$blockly;module$build$src$core$blockly.defineBlocksWithJsonArray=defineBlocksWithJsonArray$$module$build$src$core$common;module$build$src$core$blockly.dialog=module$build$src$core$dialog;\nmodule$build$src$core$blockly.duplicate=duplicate$$module$build$src$core$blockly;module$build$src$core$blockly.fieldRegistry=module$build$src$core$field_registry;module$build$src$core$blockly.geras=module$build$src$core$renderers$geras$geras;module$build$src$core$blockly.getMainWorkspace=getMainWorkspace$$module$build$src$core$common;module$build$src$core$blockly.getSelected=getSelected$$module$build$src$core$common;module$build$src$core$blockly.hideChaff=hideChaff$$module$build$src$core$blockly;\nmodule$build$src$core$blockly.hueToHex=hueToHex$$module$build$src$core$blockly;module$build$src$core$blockly.inject=inject$$module$build$src$core$inject;module$build$src$core$blockly.inputTypes=inputTypes$$module$build$src$core$input_types;module$build$src$core$blockly.isNumber=isNumber$$module$build$src$core$blockly;module$build$src$core$blockly.minimalist=module$build$src$core$renderers$minimalist$minimalist;module$build$src$core$blockly.paste=paste$$module$build$src$core$blockly;\nmodule$build$src$core$blockly.procedures=$.module$build$src$core$procedures;module$build$src$core$blockly.registry=module$build$src$core$registry;module$build$src$core$blockly.resizeSvgContents=resizeSvgContentsLocal$$module$build$src$core$blockly;module$build$src$core$blockly.serialization=module$build$src$core$serialization;module$build$src$core$blockly.setLocale=setLocale$$module$build$src$core$msg;module$build$src$core$blockly.setParentContainer=setParentContainer$$module$build$src$core$common;\nmodule$build$src$core$blockly.svgResize=svgResize$$module$build$src$core$common;module$build$src$core$blockly.thrasos=module$build$src$core$renderers$thrasos$thrasos;module$build$src$core$blockly.uiPosition=module$build$src$core$positionable_helpers;module$build$src$core$blockly.unbindEvent_=unbindEvent_$$module$build$src$core$blockly;module$build$src$core$blockly.utils=module$build$src$core$utils;module$build$src$core$blockly.zelos=module$build$src$core$renderers$zelos$zelos;var module$exports$Blockly$main={},module$contents$Blockly$main_Blockly=module$build$src$core$blockly,module$contents$Blockly$main_ContextMenu=$.module$build$src$core$contextmenu,module$contents$Blockly$main_Events=$.module$build$src$core$events$events,module$contents$Blockly$main_Msg=$.module$build$src$core$msg,module$contents$Blockly$main_Tooltip=module$build$src$core$tooltip,module$contents$Blockly$main_WidgetDiv=module$build$src$core$widgetdiv,module$contents$Blockly$main_colour=module$build$src$core$utils$colour,\nmodule$contents$Blockly$main_common=$.module$build$src$core$common,module$contents$Blockly$main_deprecation=module$build$src$core$utils$deprecation,module$contents$Blockly$main_dialog=module$build$src$core$dialog,module$contents$Blockly$main_eventUtils=module$build$src$core$events$utils;\nObject.defineProperties(module$build$src$core$blockly,{alert:{set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.alert\",\"December 2021\",\"December 2022\");module$build$src$core$dialog.setAlert(a)},get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.alert\",\"December 2021\",\"December 2022\",\"Blockly.dialog.alert()\");return module$build$src$core$dialog.alert}},confirm:{set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.confirm\",\"December 2021\",\"December 2022\");\nmodule$build$src$core$dialog.setConfirm(a)},get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.confirm\",\"December 2021\",\"December 2022\",\"Blockly.dialog.confirm()\");return module$build$src$core$dialog.confirm}},mainWorkspace:{set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.mainWorkspace\",\"version 9\",\"version 10\",\"Blockly.getMainWorkspace\");$.module$build$src$core$common.setMainWorkspace(a)},get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.mainWorkspace\",\n\"version 9\",\"version 10\",\"Blockly.getMainWorkspace\");return $.module$build$src$core$common.getMainWorkspace()}},prompt:{set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.prompt\",\"December 2021\",\"December 2022\");module$build$src$core$dialog.setPrompt(a)},get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.prompt\",\"December 2021\",\"December 2022\",\"Blockly.dialog.prompt()\");return module$build$src$core$dialog.prompt}},selected:{get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.selected\",\n\"version 9\",\"version 10\",\"Blockly.getSelected\");return $.module$build$src$core$common.getSelected()},set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.selected\",\"version 9\",\"version 10\",\"Blockly.getSelected\");$.module$build$src$core$common.setSelected(a)}},HSV_SATURATION:{get:function(){return module$build$src$core$utils$colour.getHsvSaturation()},set:function(a){module$build$src$core$utils$colour.setHsvSaturation(a)}},HSV_VALUE:{get:function(){return module$build$src$core$utils$colour.getHsvValue()},\nset:function(a){module$build$src$core$utils$colour.setHsvValue(a)}}});\nObject.defineProperties($.module$build$src$core$contextmenu,{currentBlock:{get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.ContextMenu.currentBlock\",\"September 2021\",\"September 2022\",\"Blockly.Tooltip.getCurrentBlock()\");return $.module$build$src$core$contextmenu.getCurrentBlock()},set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.ContextMenu.currentBlock\",\"September 2021\",\"September 2022\",\"Blockly.Tooltip.setCurrentBlock(block)\");$.module$build$src$core$contextmenu.setCurrentBlock(a)}}});\nObject.defineProperties($.module$build$src$core$events$events,{recordUndo:{get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.Events.recordUndo\",\"September 2021\",\"September 2022\",\"Blockly.Events.getRecordUndo()\");return module$build$src$core$events$utils.getRecordUndo()},set:function(a){module$build$src$core$utils$deprecation.warn(\"Blockly.Events.recordUndo\",\"September 2021\",\"September 2022\",\"Blockly.Events.setRecordUndo()\");module$build$src$core$events$utils.setRecordUndo(a)}}});\nObject.defineProperties(module$build$src$core$tooltip,{visible:{get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.Tooltip.visible\",\"September 2021\",\"September 2022\",\"Blockly.Tooltip.isVisible()\");return module$build$src$core$tooltip.isVisible()}},DIV:{get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.Tooltip.DIV\",\"September 2021\",\"September 2022\",\"Blockly.Tooltip.getDiv()\");return module$build$src$core$tooltip.getDiv()}}});\nObject.defineProperties(module$build$src$core$widgetdiv,{DIV:{get:function(){module$build$src$core$utils$deprecation.warn(\"Blockly.WidgetDiv.DIV\",\"September 2021\",\"September 2022\",\"Blockly.WidgetDiv.getDiv()\");return module$build$src$core$widgetdiv.getDiv()}}});\"Blockly\"in globalThis||(globalThis.Blockly={Msg:$.module$build$src$core$msg});\nmodule$build$src$core$blockly.__namespace__=$;\nreturn module$build$src$core$blockly;\n}));\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYmxvY2tseS9ibG9ja2x5X2NvbXByZXNzZWQuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBNEJBO0FDMEVBO0FBMkRBO0FBaURBO0FBNkJBO0FDaExBO0FBZ0VBO0FBZ0RBO0FBZ0RBO0FDN0xBO0FBaURBO0FBa0VBO0FBbUNBO0FBc0VBO0FBMEJBO0FDMUxBO0FBNERBO0FBa0RBO0FBcUNBO0FBNkRBO0FBaUNBO0FBcUNBO0FFdFZBO0FBK0JBO0FBa0VBO0FBMEJBO0FBbUJBO0FBcURBO0FDeEdBO0FBVUE7QUFZQTtBQWlDQTtBQThDQTtBQThCQTtBQTJEQTtBQVlBO0FBMEdBO0FBd0JBO0FBcUVBO0FBb0NBO0FBaUJBO0FBbUJBO0FBWUE7QUFzQkE7QUFzQkE7QUE4QkE7QUM5aUJBO0FBcUJBO0FBNENBO0FBa0NBO0FBK0VBO0FBMENBO0FFalNBO0FBeVFBO0FBbUNBO0FBK0JBO0FBMENBO0FBeURBO0FBd0NBO0FBa0RBO0FBdUJBO0FDeGhCQTtBQ1BBO0FBOERBO0FDZEE7QUE4QkE7QUFXQTtBQWdCQTtBQWdDQTtBQXVFQTtBQWtEQTtBQXNDQTtBQWdEQTtBQThDQTtBQW9FQTtBQ2xlQTtBQ2tCQTtBQStDQTtBQTRCQTtBQTJDQTtBQ3pIQTtBQTZCQTtBQXFEQTtBQTZDQTtBQThCQTtBQTJCQTtBQXNCQTtBQXdCQTtBQXVDQTtBQWtEQTtBQTZDQTtBQTBDQTtBQTJCQTtBQTJCQTtBQW1EQTtBQStDQTtBQWdDQTtBQWlEQTtBQXlEQTtBQW1DQTtBQXNDQTtBQXVDQTtBQWdDQTtBQXdDQTtBQXdCQTtBQTRDQTtBQ244QkE7QUEyQ0E7QUFtREE7QUEyREE7QUE2Q0E7QUFvREE7QUN0TUE7QUFzSEE7QUErQkE7QUEwQkE7QUErQkE7QUFxQ0E7QUFpQkE7QUE2QkE7QUFrQ0E7QUEwQkE7QUFlQTtBQXlCQTtBQWlCQTtBQzdaQTtBQXVDQTtBQWdFQTtBQStEQTtBQ3JOQTtBQThEQTtBQXdEQTtBQTJEQTtBQXdDQTtBQy9LQTtBQXFCQTtBQWtCQTtBQWlCQTtBQTJCQTtBQXlDQTtBQzVKQTtBQStDQTtBQ3NFQTtBQ2dpQkE7QUF3Q0E7QUF1Q0E7QUM5dUJBO0FBZ0RBO0FDaUpBO0FBbUNBO0FBa0RBO0FBaURBO0FBZ0RBO0FDeFdBO0FBMkNBO0FBa0NBO0FBb0NBO0FBa0NBO0FBbURBO0FBd0NBO0FBb0NBO0FBOENBO0FBdURBO0FBbUNBO0FBd0NBO0FFL2JBO0FBaUdBO0FDMUNBO0FBcUNBO0FBZ0NBO0FBa0NBO0FBa0NBO0FBcUNBO0FDclBBO0FDK0VBO0FBeUNBO0FBdUNBO0FBd0NBO0FBOENBO0FBa0RBO0FBc0NBO0FBeUNBO0FBU0E7QUFtREE7QUFpQ0E7QUFvQ0E7QUFpREE7QUEyQkE7QUErQ0E7QUNrREE7QUVqcEJBO0FBNkJBO0FBdUNBO0FBa0NBO0FBMEJBO0FBOEJBO0FDaktBO0FBaUNBO0FDbkJBO0FBMkNBO0FBMENBO0FBcUNBO0FBMEJBO0FBcUNBO0FBK0JBO0FBaURBO0FBNkJBO0FDelBBO0FBNkJBO0FBNkJBO0FDNUdBO0FBK0JBO0FBZ0JBO0FBU0E7QUEwQkE7QUFTQTtBQTRCQTtBQU9BO0FBcUJBO0FBWUE7QUFrQkE7QUFTQTtBQTJCQTtBR3pQQTtBQ29GQTtBQXdEQTtBQTBDQTtBQW1GQTtBQS9DQTtBQWFBO0FBK0RBO0FBMkJBO0FBdUJBO0FBMENBO0FBb0JBO0FFbFlBO0FBaUJBO0FDYUE7QUFpQ0E7QUNuQ0E7QUF5QkE7QUFzQkE7QUFlQTtBRTlGQTtBQW9DQTtBQThCQTtBQ3JCQTtBQ3hDQTtBQXdEQTtBQTRCQTtBQWtDQTtBQ3BHQTtBQW9CQTtBQWtEQTtBQWtDQTtBQXVCQTtBQWdDQTtBQXNCQTtBQTZCQTtBQXNEQTtBQVlBO0FBb0JBO0FDaFJBO0FDcENBO0FBMkJBO0FBOEJBO0FBMkNBO0FBK0JBO0FBeUJBO0FBbUNBO0FBb0NBO0FBcUJBO0FBcUJBO0FBbUJBO0FBZ0NBO0FBb0NBO0FBcUJBO0FBNkJBO0FBK0JBO0FBK0JBO0FBZ0NBO0FBd0JBO0FDcklBO0FDckZBO0FBMENBO0FBa0NBO0FBeUNBO0FFaGJBO0FFSEE7QUVZQTtBQW9GQTtBQXdDQTtBQXVEQTtBR3JNQTtBRUdBO0FHWEE7QUVBQTtBQ21CQTs7Ozs7QUNyQkE7QXpFMkNBO0FBcURBO0FBZEE7QTBFN0RBO0FBK0JBO0FBUUE7QUFJQTtBQWVBO0FBQUE7QXpFc0dBO0FDdE1BO0FBMkNBO0FBVEE7QUFpSUE7QUNySEE7QUFmQTtBQXdDQTtBQThGQTtBQW9DQTtBMEV2RkE7QXhFaUdBO0FDL0lBO0FBeVJBO0FBd0NBO0FBNVZBO0FBcUlBO0FBc1lBO0FBM1pBO0FDOUVBO0FBVUE7QUFTQTtBQWxDQTtBQXdEQTtBQ2xFQTtBQ2tEQTtBQXdEQTtBQXdEQTtBQXdDQTtBQW1DQTtBQS9SQTtBQWlMQTtBQW1DQTtBQTRCQTtBQU1BO0FBa0JBO0FBekVBO0FBeERBO0FBc1RBO0FBb0JBO0FDM1lBO0FDN0JBO0FzRXFEQTtBQ3pCQTtBQ05BO0FBaURBO0FBcEZBO0F2RUtBO0FBOE5BO0FBaUtBO0FBbkVBO0F5RTNQQTtBQXdFQTtBQW1GQTtBQXFDQTtBQXVDQTtBQW9EQTtBRXBUQTtBQXpFQTtBMUVBQTtBMkUrQkE7QUFXQTtBQVdBO0FBVUE7QTFFc0ZBO0FBZ0JBO0EyRXhGQTtBQTJDQTtBQWtDQTtBQTJCQTtBQStDQTtBQXdCQTtBQTBDQTtBQTRDQTtBQW9EQTtBQTBEQTtBQW9EQTtBQWlFQTtBQXFFQTtBQTRCQTtBQThCQTtBQStCQTtBQWFBO0FBc0JBO0FBZ0JBO0FBa0JBO0FBMENBO0FBc0JBO0FBc0NBO0FBeUNBO0FBNkJBO0FBbUJBO0FBU0E7QUErQ0E7QUFzQ0E7QUFyakNBO0ExRTBqQkE7QUF2ZkE7QTJFR0E7QUNFQTtBQXNDQTtBQTRDQTtBQXdCQTtBQWxMQTtBQzBFQTtBQXFEQTtBQXJHQTtBNUVHQTtBQ3VHQTtBQUFBO0FBaEVBO0FBcUxBO0FDM05BO0FBa09BO0FFekdBO0EwRW1EQTtBQW9EQTtBQXVDQTtBQWlEQTtBQW9CQTtBQXlFQTtBQXlDQTtBQXFCQTtBQTJEQTtBQXlGQTtBQW1GQTtBQW9DQTtBQTJCQTtBQWlEQTtBQXNDQTtBQXFFQTtBQXNEQTtBQW9HQTtBQTRFQTtBQWtGQTtBQXVDQTtBeEU3c0NBO0FBeENBO0F5RUZBO0FBcUJBO0FBdUJBO0FBOEJBO0FBbUJBO0FBdUJBO0FBL0lBO0FDcUdBO0FBWUE7QUFzREE7QUFpQkE7QUE0REE7QUFpREE7QUFzREE7QUE2REE7QUFpQ0E7QUNoWEE7QUF1QkE7QUE2REE7QUFrRUE7QTFFNUZBO0FBZ0RBO0FBcUNBO0FBV0E7QUFnQkE7QUEwQkE7QUEyQkE7QUF3QkE7QUFrRUE7QUF3QkE7QUEyQ0E7QUFrQ0E7QUFzQkE7QUEwQkE7QUFjQTtBQWtDQTtBQWhpQkE7QUF2Q0E7QTJFeUVBO0FBcUNBO0FBOUdBO0FDbUtBO0FBd0JBO0FBYUE7QUF1QkE7QUF3QkE7QUE0REE7QUFxREE7QUEyQ0E7QUE4Q0E7QUF5REE7QUE0Q0E7QUE4REE7QUF5REE7QUFzQ0E7QUErQkE7QUF3Q0E7QUF5REE7QUM1cUJBO0FBNENBO0FBZUE7QUFnQkE7QUF5QkE7QUEyRUE7QUFlQTtBQWlEQTtBQTZDQTtBQXdFQTtBQWtEQTtBQXlEQTtBQW1EQTtBQXFDQTtBQTRDQTtBQThCQTtBQStCQTtBQWlDQTtBQTRCQTtBQWlDQTtBQXgwQkE7QUVVQTtBQXlDQTtBQWtDQTtBQzNCQTtBQW1EQTtBQ3pJQTtBQWdCQTtBL0VnWUE7QUFwT0E7QWdGM0ZBO0FBZ0NBO0FBNEJBO0FBcUJBO0FBeUNBO0FBMkRBO0FBeUNBO0FDclNBO0FBb0JBO0FBaUZBO0FBb0NBO0FBcUJBO0FBd0JBO0FBcUNBO0FBNEJBO0FBa0NBO0FBa0NBO0FBMkJBO0FBMENBO0FBb0NBO0FBd0JBO0FBaUNBO0FoRmpJQTtBQWxUQTtBRVhBO0FDOUJBO0FBS0E7QUE4QkE7QUFnTUE7QUFsTkE7QThFT0E7QUF4Q0E7QUNGQTtBQXNCQTtBQWtDQTtBQWdDQTtBQWdDQTtBQXFDQTtBQXZJQTtBQ0dBO0FBQ0E7QUF3QkE7QUFiQTtBQXlCQTtBQ2xFQTtBL0VrckJBO0FBL1dBO0FnRnJSQTtBQTJCQTtBQTZDQTtBQTVJQTtBQzZEQTtBQThCQTtBQXdCQTtBQTJDQTtBQTlKQTtBaEY2R0E7QUEyQ0E7QUF5RUE7QUFzQ0E7QUFzQ0E7QUFvREE7QUFtRUE7QUE2REE7QUF3REE7QUF5Q0E7QUF1QkE7QUF3Q0E7QUE1bEJBO0FtRm9EQTtBQTBDQTtBQ3RDQTtBQXlDQTtBQXFFQTtBQXlFQTtBQXBSQTtBbkZpSkE7QUE4QkE7QUFrQ0E7QUE4QkE7QUFrQkE7QUE0REE7QUFtQ0E7QUFxQ0E7QUEwQkE7QUFlQTtBQStCQTtBQStCQTtBQWdCQTtBQXdCQTtBQW1CQTtBQWdEQTtBQTRCQTtBQUlBO0FBOENBO0FBaG9CQTtBQUpBO0FvRnVJQTtBQWlGQTtBQXVDQTtBQXFCQTtBQXFDQTtBQStDQTtBQTREQTtBQWdEQTtBQW9GQTtBQWdFQTtBQXFGQTtBQTZDQTtBQTZEQTtBQXdGQTtBQXNGQTtBQXVDQTtBQTZEQTtBQXFFQTtBQXdDQTtBQTZDQTtBQTBCQTtBQThDQTtBQTJFQTtBQWVBO0FBdUNBO0FBMkRBO0FBaURBO0FBcUJBO0FBd0JBO0FBa0VBO0FBOERBO0FBd0RBO0FBbURBO0FBd0RBO0FBbURBO0FBd0NBO0FBd0VBO0FBcURBO0FBamhFQTtBbkZ2QkE7QW9Ga0RBO0FBeUNBO0FBV0E7QUFnQkE7QUErQkE7QUE0Q0E7QUF3QkE7QUF5QkE7QUFnQ0E7QUEzVEE7QW5GNkNBO0FDdVBBO0FBek5BO0FtRllBO0FBMEJBO0FBNkRBO0FDbElBO0FBYUE7QUFoQkE7QUN6Q0E7QUN5RUE7QUFrQ0E7QUNTQTtBQXlEQTtBQS9JQTtBRXVEQTtBQTZEQTtBQTZCQTtBQWtCQTtBQWlFQTtBQW9DQTtBQWdCQTtBQThCQTtBQTRCQTtBQTBDQTtBQW9DQTtBQXlFQTtBQXNDQTtBQTRCQTtBQ3pnQkE7QUFxQ0E7QUErQ0E7QUNvQ0E7QUFxQ0E7QUF5Q0E7QUFzQkE7QUFpQ0E7QUF3REE7QUF5Q0E7QUEyQ0E7QUFtREE7QUEyQ0E7QUErREE7QUFZQTtBQW9FQTtBQXdDQTtBQStDQTtBQXFEQTtBQTZDQTtBQWdDQTtBQStDQTtBQW1FQTtBQTRDQTtBQWdDQTtBQXFEQTtBQXVGQTtBQWlFQTtBQW9GQTtBQW1EQTtBQTJFQTtBQTBDQTtBQTREQTtBQW9EQTtBQW9DQTtBQTBEQTtBQXB1REE7QTFGNkRBO0FBb0VBO0E4RmxCQTtBQWNBO0FBbUNBO0FBU0E7QUFhQTtBQVNBO0FBZ0JBO0FBaUJBO0FBMENBO0FBcURBO0FBeUJBO0FBdUJBO0FBbUJBO0FBc0RBO0FBZUE7QUE4QkE7QUFxRUE7QUErQ0E7QUF5REE7QUFscEJBO0FDd0VBO0FBeEVBO0FDQUE7QUNrSEE7QUFxREE7QUFrQkE7QUFlQTtBQW9DQTtBQWtDQTtBQTBDQTtBQXlFQTtBQXFDQTtBQXNFQTtBQTBDQTtBQTJEQTtBQWtCQTtBQXdHQTtBQzVxQkE7QUF5RUE7QUNuQkE7QUE4QkE7QUEyQkE7QUE0Q0E7QUEwQkE7QUErREE7QUNySkE7QUFnQ0E7QUF5QkE7QUE4QkE7QUFxQ0E7QUErQkE7QUEyQ0E7QUFrQkE7QUEwREE7QUF1REE7QUE0Q0E7QUFnRUE7QUE4R0E7QUF1Q0E7QUEwQ0E7QUEwREE7QUFzRUE7QUFxREE7QUF3Q0E7QUFnREE7QUFpRUE7QUNyaENBO0FBNEJBO0FBdkVBO0FFa0ZBO0FBeUJBO0FBQUE7QUNqQ0E7QUFpQ0E7QUE4Q0E7QUErQkE7QUE2QkE7QUNuSUE7QUF0REE7QUNpRkE7QUFzR0E7QUE0QkE7QUE4Q0E7QUFlQTtBQTZFQTtBQXVDQTtBQW1CQTtBQXdCQTtBQStCQTtBQTRCQTtBQXNDQTtBQWdDQTtBQXdCQTtBQStDQTtBQTJCQTtBQTRCQTtBQW1EQTtBQXlDQTtBQTZDQTtBQTRDQTtBQThCQTtBQWlDQTtBQW9FQTtBQThFQTtBQXVFQTtBQ3BrQ0E7QUF3RUE7QUFxRUE7QUFtREE7QUE2Q0E7QUFoVUE7QTFHaUdBO0FBeUVBO0EyR3hHQTtBQWxFQTtBQ3NGQTtBQTBCQTtBQWhIQTtBQ3NGQTtBQTBGQTtBQXdFQTtBQXNDQTtBQzNMQTtBQXlEQTtBQXNCQTtBQ25GQTtBQXFEQTtBQW1EQTtBQTJDQTtBQXhOQTtBQ2FBO0FBaUJBO0FDbkJBO0FBOEJBO0FBbUJBO0FBMkJBO0FBK0RBO0FDNUlBO0FBMERBO0E5RzJXQTtBQWpQQTtBQXNIQTtBK0dqU0E7QUEwRUE7QUFnSEE7QUE4R0E7QUU5S0E7QUE2REE7QUNySUE7QUFoRUE7QUNGQTtBQzJCQTtBQ0ZBO0FJM0JBO0FDeUJBO0FBcERBO0FDQUE7QUMwREE7QUFPQTtBR2pFQTtBRUFBO0FDOENBO0FDOUNBO0FDNEVBO0FBOEJBO0FuSTZEQTtBQWdFQTtBQTRGQTtBQWdIQTtBQXFDQTtBQWlCQTtBQTREQTtBQXNDQTtBQXNCQTtBQTJEQTtBQThCQTtBQWlDQTtBQW9EQTtBQStDQTtBQTZCQTtBQStCQTtBQW9CQTtBQXFEQTtBQXFCQTtBQStCQTtBQTBCQTtBQXFCQTtBQTZDQTtBQW1DQTtBQTJCQTtBb0l6aUNBO0FBcUNBO0FBaUNBO0FBZ0JBO0FBaUNBO0FBb0JBO0FBcUNBO0FBMkJBO0FBOEJBO0FBMEJBO0FBb0NBO0FBcldBO0FDdUNBO0FBa0NBO0FBd0JBO0FBUUE7QUFnQ0E7QUF3QkE7QUE4QkE7QUFTQTtBQTZCQTtBQTZCQTtBQXlDQTtBQXNCQTtBQStDQTtBQTJCQTtBQy9UQTtBQTREQTtBQTBCQTtBQThCQTtBQWNBO0FBbUJBO0FBdUJBO0FBY0E7QUFzQkE7QUFXQTtBQWdDQTtBQXdCQTtBQStCQTtBQWVBO0FBOEJBO0FBbUNBO0FBZ0RBO0FBa0RBO0FBb0RBO0FBOEJBO0FBNXFCQTtBQ2lGQTtBQXFDQTtBQXhGQTtBQ3NEQTtBQWdEQTtBQThDQTtBQXlCQTtBQXdCQTtBQXVEQTtBQW9EQTtBQTBDQTtBQW1DQTtBQXNDQTtBQXVCQTtBQTJCQTtBQXlCQTtBQXdCQTtBQWlEQTtBQXdCQTtBQW9CQTtBQXFCQTtBQXRwQkE7QUNzR0E7QUFvRUE7QUErREE7QUN2R0E7QUE2REE7QUFvQ0E7QUFxQ0E7QUFtQ0E7QUF1Q0E7QUFnRUE7QUErQ0E7QUFnQ0E7QUFtREE7QUFzQ0E7QUE0Q0E7QUF1Q0E7QUF5Q0E7QUFzQ0E7QUFhQTtBQ3ZuQkE7QUFrREE7QUEyRUE7QUE4QkE7QXpJaEtBO0FBSUE7QUFJQTtBQUtBO0FBSUE7QUFJQTtBQUlBO0FBdkRBO0EwSUNBO0FBd0RBO0F6SXhJQTtBQXlEQTtBMEllQTtBQWlDQTtBQWVBO0FBcUNBO0FBZUE7QUF1REE7QUFrQ0E7QUF4T0E7QUNrQ0E7QUFpREE7QUFwRkE7QUNvQ0E7QUFpREE7QUFqSEE7QUN5RkE7QUF1REE7QUFnQ0E7QUEyQkE7QUFzQ0E7QUFxREE7QUF3RUE7QUNsUEE7QUF1QkE7QUE0REE7QUFpREE7QUFrREE7QUF3Q0E7QUF1REE7QUF3RUE7QUE0RkE7QUF3RkE7QUFrREE7QUFzRUE7QUFsdEJBO0FDMkNBO0FBcURBO0FDbENBO0FBbUNBO0FBb0NBO0FBa0JBO0FBa0JBO0FBbUNBO0FBbUJBO0FBNEJBO0FBa0JBO0FBMkNBO0FBVUE7QUE4QkE7QUFuWkE7QS9Jb05BO0FBeUlBO0FBNkJBO0FBZ0JBO0FBWUE7QUFjQTtBQXVGQTtBQWlFQTtBQXNDQTtBQW1EQTtBQXFFQTtBQW1DQTtBQWVBO0FBb0JBO0FBMkNBO0FBbUNBO0FBaUNBO0FBMEJBO0FBNERBO0FBa0RBO0FBMkRBO0FBbUNBO0FBOENBO0FBc0NBO0FBaURBO0FBc0RBO0FBd0NBO0FBMENBO0FBZ0NBO0FBdUJBO0FBcUNBO0FBNkRBO0FBb0VBO0FBcUNBO0FBeUNBO0FBeUNBO0FBNkNBO0FBaUNBO0FBMkNBO0FBb0JBO0FBK0RBO0FBaURBO0FBNkNBO0FBeUJBO0FBNkNBO0FBaURBO0FBeURBO0FBNkVBO0FBcUVBO0FBdUVBO0FBMkVBO0FBbURBO0FnSnZnRkE7QTlJMkpBO0FBN0NBO0FBcERBO0FnSndCQTtBQXFDQTtBQXdFQTtBQW1CQTtBQXNCQTtBQTBCQTtBQW9CQTtBQXdCQTtBQW1EQTtBQTJEQTtBQStEQTtBQWdDQTtBQThCQTtBQXNDQTtBQWVBO0FBZ0JBO0FBb0JBO0FBaUNBO0FBaUJBO0FBd0JBO0FBaUJBO0FBcUJBO0FBMkJBO0FBMkJBO0FBMEJBO0FDcnZCQTtBQTRCQTtBQWtDQTtBQTZCQTtBQXVCQTtBQXNCQTtBQXFCQTtBQzdIQTtBQXNDQTtBQXVCQTtBQXFHQTtBQXBPQTtBQytGQTtBQWlEQTtBQXVDQTtBQXVDQTtBQXNDQTtBQWlDQTtBQTZCQTtBQXNCQTtBQWtDQTtBQWtDQTtBQTRCQTtBQW9DQTtBQWlEQTtBQ3hpQkE7QUUyQkE7QUUzQkE7QUMwRkE7QUE2Q0E7QUE2QkE7QUFhQTtBQVlBO0FBNkJBO0FBWUE7QUFZQTtBQWtCQTtBQXlCQTtBQWtDQTtBQWFBO0FBeUNBO0FBd0JBO0FBK0JBO0FBa0JBO0FBa0NBO0FBeUJBO0FBb0NBO0FBaUJBO0FBOWlCQTtBQ29GQTtBQXNDQTtBQXNCQTtBQ2pFQTtBQTRCQTtBQXNDQTtBQW1EQTtBQ3pHQTtBQW9DQTtBQzlGQTtBQUlBO0FDd0NBO0FBa0JBO0FBeUJBO0FBcUJBO0FBaUJBO0FBYUE7QUFnQkE7QUFrQkE7QUFxQkE7QUFxQkE7QUFrQkE7QUF1Q0E7QUN0UkE7QUs2Q0E7QUNqREE7QUMrQkE7QUN5QkE7QUEyQkE7QUFlQTtBQWtDQTtBQXVCQTtBQWtCQTtBQTJCQTtBQXVCQTtBQTJCQTtBQXVCQTtBQzFPQTtBQWlDQTtBQWdDQTtBQTJCQTtBQ0FBO0FBMEJBO0FBdUNBO0FBZ0NBO0FBcUJBO0FBb0NBO0FBa0JBO0FHL09BO0FBU0E7QUE2QkE7QUFrQkE7QUF1QkE7QUFrQkE7QUFpQkE7QUFpQkE7QUFjQTtBQXVCQTtBQW9CQTtBQW1CQTtBQXVCQTtBQXFCQTtBQThCQTtBQTRDQTtBQStCQTtBQzFYQTtBQWlDQTtBQXFCQTtBQXRIQTtBQ3lFQTtBQXVEQTtBQ2hHQTtBQUlBO0FDK0JBO0FBa0RBO0FBeUNBO0FBaElBO0FDeUNBO0FBZ0NBO0FBMkNBO0FBbUZBO0FDdktBO0FBMkNBO0FBTUE7QUF3Q0E7QUEwRUE7QUEyRUE7QUNwTUE7QUFtQ0E7QUEyRUE7QUEyQkE7QUE2Q0E7QUE4RUE7QUFnRUE7QUFxRUE7QUFyZEE7QUNrRUE7QUF1QkE7QUF1QkE7QUFjQTtBQWtCQTtBQThEQTtBQStCQTtBQXpRQTtBQ2dIQTtBQTRDQTtBQWdCQTtBQThEQTtBQW1FQTtBQTJFQTtBQWlDQTtBQzlVQTtBQzNCQTtBQW9NQTtBQWlEQTtBQTZDQTtBQXlCQTtBQXNCQTtBQXdCQTtBQXdFQTtBQWdEQTtBQXlDQTtBQWtDQTtBQTJDQTtBQTJCQTtBQTBDQTtBQXlDQTtBQW9EQTtBQXFEQTtBQXFEQTtBQW9CQTtBQXVEQTtBQWdDQTtBQTBDQTtBQW9DQTtBQThDQTtBQXBnQ0E7QUMxQ0E7QUFtREE7QUFtQ0E7QUErQkE7QUFzQ0E7QUFpRUE7QUE0QkE7QUF5QkE7QUFxQkE7QUM1UkE7QUFnREE7QUFtQ0E7QUFpQ0E7QUFvQ0E7QUFxREE7QUE2Q0E7QUF3QkE7QUM3UEE7QUE4Q0E7QUFnQ0E7QUE4Q0E7QUE0Q0E7QUEwREE7QUFxRUE7QUF3RUE7QUE2Q0E7QUFpQ0E7QUFqZ0JBO0FDOERBO0FBdUZBO0FBZ0ZBO0FBb0NBO0FDek1BO0FBK0RBO0FBZ0NBO0FBc0NBO0FBc0JBO0FBdUJBO0FBeUJBO0FBNkJBO0FBc0NBO0FBa0JBO0FBZ0ZBO0FDdmRBO0FDcUtBO0FBK0JBO0FBcUNBO0FBNERBO0FBb0NBO0FBb0NBO0FBc0RBO0FBdUNBO0FBcUNBO0FBV0E7QUFpQkE7QUFhQTtBQWdCQTtBQWdCQTtBQS9lQTtBQXdpQkE7QUM1Z0JBO0FBc0NBO0FBNkVBO0FDaEhBO0FBdUVBO0FBbUNBO0FBbUJBO0FBYUE7QUFnQkE7QUFVQTtBQXlCQTtBQTBCQTtBQWdEQTtBQWNBO0FBaUNBO0FBNENBO0FBcURBO0FBa0JBO0FDcmNBO0FBMEJBO0FBNEJBO0FBcUJBO0FBbUNBO0FBbUNBO0FBZ0NBO0FDbExBO0FBOENBO0FDbERBO0FBNENBO0FBaUJBO0FDNURBO0FBc0NBO0FDM0NBO0FBbkVBO0FDdUVBO0FBaUNBO0FBOEJBO0FBNEJBO0FBNkJBO0FFakpBO0FBc0NBO0FDcENBO0FBd0JBO0FDakJBO0FBdERBO0FDeUNBO0FBekNBO0FDaURBO0FBbERBO0FFMkNBO0FBbUNBO0FBb0JBO0FDeERBO0FBMENBO0FBbEVBO0E1TWVBO0FBc0NBO0FBdkVBO0E2TXlFQTtBQWlEQTtBQ3ZEQTtBQ0lBO0FDNkRBO0FBV0E7QUFhQTtBQW5DQTtBQUtBO0FBTUE7QUFLQTtBQUtBO0FBS0E7QUFPQTtBQU1BO0FBaEtBO0FBNkhBO0FBNURBO0FBTEE7QUF5RUE7QUF6REE7QUFPQTtBQXdEQTtBQWhEQTtBQUtBO0FBRkE7QUFpREE7QUFDQTtBQUdBO0FBaENBO0FBc0NBO0FBTUE7QS9NeU1BO0FBc0dBO0FBaEVBO0FDeFNBO0FBdUNBO0FBeUJBO0FBMEJBO0FBa0NBO0FBMENBO0FBdUNBO0FBb0NBO0FBNENBO0FBdUVBO0FDbk9BO0FBZ0NBO0FBNkRBO0FBc0xBO0FBYUE7QUE4QkE7QUFTQTtBQW9CQTtBQXRYQTtBQXdhQTtBQXRIQTtBQTRIQTtBQUdBO0FBaklBO0FBd0lBO0FBSUE7QUFXQTtBQUtBO0FBN2JBO0FBcWVBO0FBS0E7QUEvR0E7QUFFQTtBQTdWQTtBQW9kQTtBQUdBO0FBRUE7QUFHQTtBQUtBO0FBNUhBO0FBK0hBO0FBdFZBO0FBZ0NBO0FBOEtBO0FBelRBO0E4TXhRQTtBQWFBO0FBa0NBO0FBeUJBO0FBc0NBO0FBbUNBO0FBUUE7QUEyQkE7QUE0QkE7QUFxQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL2RlcHJlY2F0aW9uLnRzP2RjYzYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS90b3VjaC50cz9kMTljIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvYnJvd3Nlcl9ldmVudHMudHM/N2NiMiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2NvbW1vbi50cz81MmYwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdXRpbHMvZG9tLnRzP2M1MjMiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9tYXRoLnRzP2UxNGYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9zdHlsZS50cz9jOWNhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZHJvcGRvd25kaXYudHM/ZjUyYyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlZ2lzdHJ5LnRzP2Y4OTIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9pZGdlbmVyYXRvci50cz9mZDlhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL3V0aWxzLnRzPzJhYjciLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy94bWwudHM/NDcxYiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2RpYWxvZy50cz81NzcwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdmFyaWFibGVzLnRzP2FkYzIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9jc3MudHM/ZTM5NiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL3N2Z19tYXRoLnRzP2JlZTkiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS94bWwudHM/OTY2OSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL3N0cmluZy50cz85NGEzIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdG9vbHRpcC50cz8zN2I4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdXRpbHMvY29sb3VyLnRzPzQwMmUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9wYXJzaW5nLnRzPzZjOWEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS93aWRnZXRkaXYudHM/ZDc1NiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkX3JlZ2lzdHJ5LnRzPzQyZjEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9hcmlhLnRzP2ZjYTIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9maWVsZF9kcm9wZG93bi50cz8xMTAwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdXRpbHMvb2JqZWN0LnRzP2E1MjgiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy90b29sYm94LnRzP2FmNDEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9leHRlbnNpb25zLnRzPzYzZjciLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9hcnJheS50cz82ZDg4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdXRpbHMvc3ZnX3BhdGhzLnRzPzAxMmQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy50cz9hYWM4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvc2VyaWFsaXphdGlvbi9yZWdpc3RyeS50cz84OWM4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvc2VyaWFsaXphdGlvbi9ibG9ja3MudHM/Njk4ZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2Nvbm5lY3Rpb24udHM/ODI0MCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2tleWJvYXJkX25hdi9hc3Rfbm9kZS50cz81MTRmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvYmxvY2tfYW5pbWF0aW9ucy50cz9hYjk2Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvY2xpcGJvYXJkLnRzPzVkNjAiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9jb250ZXh0bWVudS50cz8yZmI0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcG9zaXRpb25hYmxlX2hlbHBlcnMudHM/NDJhNyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3Nob3J0Y3V0X2l0ZW1zLnRzPzQ5MmIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9pbnRlcmZhY2VzL2lfb2JzZXJ2YWJsZS50cz9mZGY5Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9ibG9jay50cz9lZjViIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcHJvY2VkdXJlcy91cGRhdGVfcHJvY2VkdXJlcy50cz8wZDc0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcHJvY2VkdXJlcy50cz9lOWUwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2NvbW1vbi9jb25zdGFudHMudHM/NmMwNSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9jb21tb24vZGVidWcudHM/MDRiZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9jb21tb24vYmxvY2tfcmVuZGVyaW5nLnRzP2MwOGYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS92YXJpYWJsZXNfZHluYW1pYy50cz82MWQzIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvd29ya3NwYWNlX3N2Zy50cz8yZDgxIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvc2VyaWFsaXphdGlvbi93b3Jrc3BhY2VzLnRzPzk1ZDQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9zZXJpYWxpemF0aW9uL3Byb2NlZHVyZXMudHM/MGRiZSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2J1bXBfb2JqZWN0cy50cz8xYWYyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvaW5qZWN0LnRzPzI5YTQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3Byb2NlZHVyZV9wYXJhbWV0ZXJfcmVuYW1lLnRzPzViODYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9jb250ZXh0bWVudV9pdGVtcy50cz9kMTFkIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvYmxvY2tfZHJhZ2dlci50cz9iNjk3Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvYmxvY2tseS50cz9lOTNmIiwid2VicGFjazovL3NiMS9zcmMvY29tL2dvb2dsZS9qYXZhc2NyaXB0L2pzY29tcC9qcy9iYXNlLmpzPzc4NmQiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL3V0aWwvZGVmaW5lcy5qcz8wMmRjIiwid2VicGFjazovL3NiMS9zcmMvY29tL2dvb2dsZS9qYXZhc2NyaXB0L2pzY29tcC9qcy91dGlsL2RlZmluZXByb3BlcnR5LmpzP2ZiNjQiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL3V0aWwvZ2xvYmFsLmpzPzdhOGQiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL3V0aWwvc2hvdWxkcG9seWZpbGwuanM/NTE2ZCIsIndlYnBhY2s6Ly9zYjEvc3JjL2NvbS9nb29nbGUvamF2YXNjcmlwdC9qc2NvbXAvanMvdXRpbC9wb2x5ZmlsbC5qcz9hZjM0Iiwid2VicGFjazovL3NiMS9zcmMvY29tL2dvb2dsZS9qYXZhc2NyaXB0L2pzY29tcC9qcy9lczYvZ2xvYmFsdGhpcy5qcz9mODAxIiwid2VicGFjazovL3NiMS9zcmMvY29tL2dvb2dsZS9qYXZhc2NyaXB0L2pzY29tcC9qcy9lczYvb2JqZWN0L2dldG93bnByb3BlcnR5ZGVzY3JpcHRvcnMuanM/MGNiYyIsIndlYnBhY2s6Ly9zYjEvc3JjL2NvbS9nb29nbGUvamF2YXNjcmlwdC9qc2NvbXAvanMvZXM2L3V0aWwvYXJyYXlpdGVyYXRvci5qcz80N2YyIiwid2VicGFjazovL3NiMS9zcmMvY29tL2dvb2dsZS9qYXZhc2NyaXB0L2pzY29tcC9qcy9lczYvc3ltYm9sLmpzPzE0ZTEiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL2VzNi91dGlsL2l0ZXJhdG9yZnJvbWFycmF5LmpzPzgwNWQiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL2VzNi9hcnJheS92YWx1ZXMuanM/YjljNiIsIndlYnBhY2s6Ly9zYjEvc3JjL2NvbS9nb29nbGUvamF2YXNjcmlwdC9qc2NvbXAvanMvdXRpbC9vd25zLmpzPzAwNGQiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL2VzNi9vYmplY3QvdmFsdWVzLmpzP2MwZDYiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL2VzNi9hcnJheS9mbGF0LmpzP2JlZjUiLCJ3ZWJwYWNrOi8vc2IxL3NyYy9jb20vZ29vZ2xlL2phdmFzY3JpcHQvanNjb21wL2pzL2VzNi9vYmplY3QvZW50cmllcy5qcz9mYzJmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2Nsb3N1cmUvZ29vZy9nb29nLmpzP2ZkZDEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY2xvc3VyZS9nb29nL2Jhc2VfbWluaW1hbC5qcz9hMzA1Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdXRpbHMvdXNlcmFnZW50LnRzPzg4Y2QiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ibG9ja3MudHM/Mzg4NCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL3JlY3QudHM/N2YzZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL2Nvb3JkaW5hdGUudHM/OTBiMSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL3NpemUudHM/MjdhOCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2lucHV0X3R5cGVzLnRzPzMxNGMiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9tc2cudHM/YzhiOCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfYWJzdHJhY3QudHM/NTRhYSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfdmFyX2Jhc2UudHM/ODExZSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfdmFyX2NyZWF0ZS50cz8zZDc5Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdmFyaWFibGVfbW9kZWwudHM/MjZhOSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3dvcmtzcGFjZV9jb21tZW50LnRzPzkxYjciLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3VpX2Jhc2UudHM/ZTU5MCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfc2VsZWN0ZWQudHM/NTdjMSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3V0aWxzL3N2Zy50cz9lNzAyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvd29ya3NwYWNlX2NvbW1lbnRfc3ZnLnRzPzgwMzEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX2Jsb2NrX2Jhc2UudHM/MDE2ZSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfYmxvY2tfY2hhbmdlLnRzP2Y0MGUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9tYXJrZXJfbWFuYWdlci50cz8zMmU2Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdXRpbHMvc2VudGluZWwudHM/OTBlNSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkLnRzPzFkMGEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS91dGlscy9rZXljb2Rlcy50cz8yNjA1Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvbWVudS50cz85N2ZiIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvbWVudWl0ZW0udHM/ZjRjZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfYnViYmxlX29wZW4udHM/YzBkZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3Njcm9sbGJhci50cz8yYmNjIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvYnViYmxlLnRzPzYzNjQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9jb25maWcudHM/NjQwZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ljb24udHM/YTY0YyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3RoZW1lLnRzPzhjMjAiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS90aGVtZS9jbGFzc2ljLnRzP2ZiNzUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9vcHRpb25zLnRzPzM5YzMiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9tdXRhdG9yLnRzP2YwNDEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3RyYXNoY2FuX29wZW4udHM/YmE3NCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2NvbXBvbmVudF9tYW5hZ2VyLnRzP2JlYmYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9zZXJpYWxpemF0aW9uL2V4Y2VwdGlvbnMudHM/MjFmNiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3NlcmlhbGl6YXRpb24vcHJpb3JpdGllcy50cz9kZDQ3Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19ibG9ja19jcmVhdGUudHM/YTBmNiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfYmxvY2tfZGVsZXRlLnRzPzc5NWUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9jb25uZWN0aW9uX3R5cGUudHM/ZDFlYiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2NvbnN0YW50cy50cz9lZWYxIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZmllbGRfbGFiZWwudHM/M2M0YiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2lucHV0LnRzP2Y0NjEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ibG9jay50cz82NDMyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvY29tbWVudC50cz85Y2JjIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvY29udGV4dG1lbnVfcmVnaXN0cnkudHM/YTkzNiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ludGVybmFsX2NvbnN0YW50cy50cz9lODkwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUva2V5Ym9hcmRfbmF2L21hcmtlci50cz81MjhmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUva2V5Ym9hcmRfbmF2L2N1cnNvci50cz8yNTkxIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUva2V5Ym9hcmRfbmF2L2Jhc2ljX2N1cnNvci50cz8yMmNiIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUva2V5Ym9hcmRfbmF2L3RhYl9uYXZpZ2F0ZV9jdXJzb3IudHM/NmQxOCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVkX2Nvbm5lY3Rpb24udHM/M2RlMCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3dhcm5pbmcudHM/M2Y2NiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2Jsb2NrX3N2Zy50cz84OTA0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZHJhZ190YXJnZXQudHM/Mzc0YyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2RlbGV0ZV9hcmVhLnRzPzc4YjIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9zcHJpdGVzLnRzPzcyZWEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS90cmFzaGNhbi50cz80ODYwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c190b29sYm94X2l0ZW1fc2VsZWN0LnRzPzQwYTciLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS90b29sYm94L3Rvb2xib3hfaXRlbS50cz8zNWU0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdG9vbGJveC9jYXRlZ29yeS50cz80NGUyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdG9vbGJveC9zZXBhcmF0b3IudHM/ZDIyZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3Rvb2xib3gvY29sbGFwc2libGVfY2F0ZWdvcnkudHM/ZGQzYyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3Rvb2xib3gvdG9vbGJveC50cz9hNGEyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdGhlbWUvemVsb3MudHM/NjBiNiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3RoZW1lL3RoZW1lcy50cz84NWU4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19jbGljay50cz8zODUzIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvYnViYmxlX2RyYWdnZXIudHM/MjgxMiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3dvcmtzcGFjZV9kcmFnZ2VyLnRzPzNhODAiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9nZXN0dXJlLnRzP2RhMTEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9zaG9ydGN1dF9yZWdpc3RyeS50cz8wNWIwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c190aGVtZV9jaGFuZ2UudHM/M2YwYyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfdmlld3BvcnQudHM/MWQ0MyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2Nvbm5lY3Rpb25fZGIudHM/YjRkZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2dyaWQudHM/NzJmZSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL25hbWVzLnRzPzJiZWMiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9wcm9jZWR1cmVzL29ic2VydmFibGVfcHJvY2VkdXJlX21hcC50cz9mODBhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcHJvY2VkdXJlcy9vYnNlcnZhYmxlX3Byb2NlZHVyZV9tb2RlbC50cz81NWMyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcHJvY2VkdXJlcy9vYnNlcnZhYmxlX3BhcmFtZXRlcl9tb2RlbC50cz9jN2FlIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL3R5cGVzLnRzPzlhZWIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvYmFzZS50cz9mODFkIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL3Jvdy50cz9hYTQ0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL2JvdHRvbV9yb3cudHM/YzQ3ZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9jb25uZWN0aW9uLnRzPzhmZDMiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvaW5wdXRfY29ubmVjdGlvbi50cz9kM2E3Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL2V4dGVybmFsX3ZhbHVlX2lucHV0LnRzP2M2YmIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvZmllbGQudHM/ZmZkOSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9oYXQudHM/ZDE2MyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9pY29uLnRzP2RiOWUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvaW5fcm93X3NwYWNlci50cz9lYzQwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL2lubGluZV9pbnB1dC50cz8yZjA0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL3N0YXRlbWVudF9pbnB1dC50cz80NDdkIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL2lucHV0X3Jvdy50cz9jNDAxIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL2phZ2dlZF9lZGdlLnRzP2Q3NDgiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvbmV4dF9jb25uZWN0aW9uLnRzP2FhZjQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvb3V0cHV0X2Nvbm5lY3Rpb24udHM/NTIwZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9wcmV2aW91c19jb25uZWN0aW9uLnRzPzUwYzQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvcm91bmRfY29ybmVyLnRzPzcxYTYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvc3BhY2VyX3Jvdy50cz9mNjAwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21lYXN1cmFibGVzL3NxdWFyZV9jb3JuZXIudHM/ZTRiNyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9tZWFzdXJhYmxlcy90b3Bfcm93LnRzP2M2OGYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvY29tbW9uL2RlYnVnZ2VyLnRzPzdlZDYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvY29tbW9uL2RyYXdlci50cz8wZDFmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2NvbW1vbi9pbmZvLnRzPzEyMjIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX21hcmtlcl9tb3ZlLnRzPzJmMDIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvY29tbW9uL21hcmtlcl9zdmcudHM/NTQ4YSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9jb21tb24vcGF0aF9vYmplY3QudHM/NWQyZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2luc2VydGlvbl9tYXJrZXJfbWFuYWdlci50cz9iOWVkIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2NvbW1vbi9yZW5kZXJlci50cz8xZGRlIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdGhlbWVfbWFuYWdlci50cz9jN2ViIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvY29ubmVjdGlvbl9jaGVja2VyLnRzP2U3YjAiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3Zhcl9kZWxldGUudHM/ZGNhOCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfdmFyX3JlbmFtZS50cz85MjBmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvdmFyaWFibGVfbWFwLnRzP2E0ZWUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS93b3Jrc3BhY2UudHM/NGUxZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3dvcmtzcGFjZV9hdWRpby50cz8yNmVmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvem9vbV9jb250cm9scy50cz8zY2FiIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvc2VyaWFsaXphdGlvbi92YXJpYWJsZXMudHM/YjhhNyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3NlcmlhbGl6YXRpb24udHM/NzYxMiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy96ZWxvcy9jb25zdGFudHMudHM/MTQ4YSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy96ZWxvcy9kcmF3ZXIudHM/OWI3MSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkX2ltYWdlLnRzPzY5NTYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9maWVsZF9pbnB1dC50cz9hOGJhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZmllbGRfdGV4dGlucHV0LnRzP2RjNjIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvemVsb3MvbWVhc3VyYWJsZXMvYm90dG9tX3Jvdy50cz8yMWVhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL3plbG9zL21lYXN1cmFibGVzL2lucHV0cy50cz9jYTg0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL3plbG9zL21lYXN1cmFibGVzL3Jvd19lbGVtZW50cy50cz9lZGMyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL3plbG9zL21lYXN1cmFibGVzL3RvcF9yb3cudHM/MDUwOCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy96ZWxvcy9pbmZvLnRzP2RjZGUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvemVsb3MvbWFya2VyX3N2Zy50cz9mMzM0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL3plbG9zL3BhdGhfb2JqZWN0LnRzP2VjMTgiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvemVsb3MvcmVuZGVyZXIudHM/NGJjMSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy96ZWxvcy96ZWxvcy50cz80ZTgwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL3RocmFzb3MvaW5mby50cz9hMjA1Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL3RocmFzb3MvcmVuZGVyZXIudHM/MWUzOSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy90aHJhc29zL3RocmFzb3MudHM/ZDA0OCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9taW5pbWFsaXN0L2NvbnN0YW50cy50cz9mNTI4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21pbmltYWxpc3QvZHJhd2VyLnRzPzRmNTIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWluaW1hbGlzdC9pbmZvLnRzPzQwN2IiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvbWluaW1hbGlzdC9yZW5kZXJlci50cz85ODY5Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL21pbmltYWxpc3QvbWluaW1hbGlzdC50cz9hNGEyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2dlcmFzL2NvbnN0YW50cy50cz85N2RlIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2dlcmFzL2hpZ2hsaWdodGVyLnRzPzZiOWMiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvZ2VyYXMvZHJhd2VyLnRzPzMxM2YiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvZ2VyYXMvaGlnaGxpZ2h0X2NvbnN0YW50cy50cz8yYTVmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2dlcmFzL21lYXN1cmFibGVzL2lubGluZV9pbnB1dC50cz82NjBkIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2dlcmFzL21lYXN1cmFibGVzL3N0YXRlbWVudF9pbnB1dC50cz9iYzJmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2dlcmFzL2luZm8udHM/MjVmYiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3JlbmRlcmVycy9nZXJhcy9wYXRoX29iamVjdC50cz9jZDMyIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvcmVuZGVyZXJzL2dlcmFzL3JlbmRlcmVyLnRzPzQ0NWUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9yZW5kZXJlcnMvZ2VyYXMvZ2VyYXMudHM/MjE4NyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3dvcmtzcGFjZV9kcmFnX3N1cmZhY2Vfc3ZnLnRzPzFhMTEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ibG9ja19kcmFnX3N1cmZhY2UudHM/Yzk2NSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL3Njcm9sbGJhcl9wYWlyLnRzPzY3MjAiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9nZW5lcmF0b3IudHM/MmJmMCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZseW91dF9idXR0b24udHM/YzhlOCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL21ldHJpY3NfbWFuYWdlci50cz8yN2ZlIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZmx5b3V0X21ldHJpY3NfbWFuYWdlci50cz9iMTk2Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZmx5b3V0X2Jhc2UudHM/MGI0ZiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZseW91dF92ZXJ0aWNhbC50cz83NDJmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZmx5b3V0X2hvcml6b250YWwudHM/NGQxMyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkX3ZhcmlhYmxlLnRzPzU5ZWQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9maWVsZF9udW1iZXIudHM/NTUzYSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkX211bHRpbGluZWlucHV0LnRzPzMyYzIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9maWVsZF9sYWJlbF9zZXJpYWxpemFibGUudHM/NjYwYyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkX2NvbG91ci50cz9iNzcwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZmllbGRfY2hlY2tib3gudHM/NWE0MyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2ZpZWxkX2FuZ2xlLnRzPzUzNDIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX2Jsb2NrX21vdmUudHM/NmFmZCIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfY29tbWVudF9iYXNlLnRzPzg2MGYiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX2NvbW1lbnRfY2hhbmdlLnRzP2RjY2QiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX2NvbW1lbnRfY3JlYXRlLnRzPzNkZDkiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX2NvbW1lbnRfZGVsZXRlLnRzP2JjYjkiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX2NvbW1lbnRfbW92ZS50cz8wMzU1Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19wcm9jZWR1cmVfYmFzZS50cz8xNmMwIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19wcm9jZWR1cmVfY2hhbmdlX3JldHVybi50cz83MWFhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19wcm9jZWR1cmVfY3JlYXRlLnRzPzQ0YTUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3Byb2NlZHVyZV9kZWxldGUudHM/MjY5YiIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlL2V2ZW50cy9ldmVudHNfcHJvY2VkdXJlX2VuYWJsZS50cz9mN2Q0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19wcm9jZWR1cmVfcmVuYW1lLnRzP2I2YTQiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3Byb2NlZHVyZV9wYXJhbWV0ZXJfYmFzZS50cz8yYTFmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19wcm9jZWR1cmVfcGFyYW1ldGVyX2NyZWF0ZS50cz9jYzNiIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19wcm9jZWR1cmVfcGFyYW1ldGVyX2RlbGV0ZS50cz9mZDg3Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50c19ibG9ja19kcmFnLnRzP2Q4M2YiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvZXZlbnRzX3VpLnRzPzgyOWIiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvY29yZS9ldmVudHMvd29ya3NwYWNlX2V2ZW50cy50cz8yMjYxIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvZXZlbnRzL2V2ZW50cy50cz84MjQ0Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUvbWFpbi5qcz85MTlmIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gZm9yIHdhcm5pbmcgZGV2ZWxvcGVycyBhYm91dCBkZXByZWNhdGlvbnMuXG4gKiBUaGlzIG1ldGhvZCBpcyBub3Qgc3BlY2lmaWMgdG8gQmxvY2tseS5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMuZGVwcmVjYXRpb25cbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5kZXByZWNhdGlvbicpO1xuXG5cbi8qKlxuICogV2FybiBkZXZlbG9wZXJzIHRoYXQgYSBmdW5jdGlvbiBvciBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkLlxuICpcbiAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBmdW5jdGlvbiBvciBwcm9wZXJ0eS5cbiAqIEBwYXJhbSBkZXByZWNhdGlvbkRhdGUgVGhlIGRhdGUgb2YgZGVwcmVjYXRpb24uIFByZWZlciAndmVyc2lvbiBuLjAuMCdcbiAqICAgICBmb3JtYXQsIGFuZCBmYWxsIGJhY2sgdG8gJ21vbnRoIHl5eXknIG9yICdxdWFydGVyIHl5eXknIGZvcm1hdC5cbiAqIEBwYXJhbSBkZWxldGlvbkRhdGUgVGhlIGRhdGUgb2YgZGVsZXRpb24uIFByZWZlciAndmVyc2lvbiBuLjAuMCdcbiAqICAgICBmb3JtYXQsIGFuZCBmYWxsIGJhY2sgdG8gJ21vbnRoIHl5eXknIG9yICdxdWFydGVyIHl5eXknIGZvcm1hdC5cbiAqIEBwYXJhbSBvcHRfdXNlIFRoZSBuYW1lIG9mIGEgZnVuY3Rpb24gb3IgcHJvcGVydHkgdG8gdXNlIGluc3RlYWQsIGlmIGFueS5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRlcHJlY2F0aW9uLndhcm5cbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gd2FybihcbiAgICBuYW1lOiBzdHJpbmcsIGRlcHJlY2F0aW9uRGF0ZTogc3RyaW5nLCBkZWxldGlvbkRhdGU6IHN0cmluZyxcbiAgICBvcHRfdXNlPzogc3RyaW5nKSB7XG4gIGxldCBtc2cgPSBuYW1lICsgJyB3YXMgZGVwcmVjYXRlZCBpbiAnICsgZGVwcmVjYXRpb25EYXRlICtcbiAgICAgICcgYW5kIHdpbGwgYmUgZGVsZXRlZCBpbiAnICsgZGVsZXRpb25EYXRlICsgJy4nO1xuICBpZiAob3B0X3VzZSkge1xuICAgIG1zZyArPSAnXFxuVXNlICcgKyBvcHRfdXNlICsgJyBpbnN0ZWFkLic7XG4gIH1cbiAgY29uc29sZS53YXJuKG1zZyk7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVG91Y2ggaGFuZGxpbmcgZm9yIEJsb2NrbHkuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LlRvdWNoXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVG91Y2gnKTtcblxuaW1wb3J0IHR5cGUge0dlc3R1cmV9IGZyb20gJy4vZ2VzdHVyZS5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcblxuXG4vKipcbiAqIEEgbW9jayBldmVudCwgY3JlYXRlZCBmcm9tIGVpdGhlciBhIG1vdXNlIG9yIHRvdWNoIGV2ZW50LFxuICogd2l0aCBubyBtb3JlIHRoYW4gb25lIGVudHJ5IGluIHRoZSBjaGFuZ2VkVG91Y2hlcyBhcnJheS5cbiAqL1xuaW50ZXJmYWNlIFBzZXVkb0V2ZW50IHtcbiAgdHlwZTogc3RyaW5nO1xuICBjaGFuZ2VkVG91Y2hlczogVG91Y2hbXTtcbiAgdGFyZ2V0OiBFbGVtZW50O1xuICBzdG9wUHJvcGFnYXRpb246ICgpID0+IHZvaWQ7XG4gIHByZXZlbnREZWZhdWx0OiAoKSA9PiB2b2lkO1xufVxuXG4vKiogTGVuZ3RoIGluIG1zIGZvciBhIHRvdWNoIHRvIGJlY29tZSBhIGxvbmcgcHJlc3MuICovXG5jb25zdCBMT05HUFJFU1MgPSA3NTA7XG5cbi8qKlxuICogV2hldGhlciB0b3VjaCBpcyBlbmFibGVkIGluIHRoZSBicm93c2VyLlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuZXZlbnRzLkJyb3dzZXJGZWF0dXJlLlRPVUNIX0VOQUJMRURcbiAqL1xuZXhwb3J0IGNvbnN0IFRPVUNIX0VOQUJMRUQgPSAnb250b3VjaHN0YXJ0JyBpbiBnbG9iYWxUaGlzIHx8XG4gICAgISEoZ2xvYmFsVGhpc1snZG9jdW1lbnQnXSAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiZcbiAgICAgICAnb250b3VjaHN0YXJ0JyBpblxuICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHx8ICAvLyBJRTEwIHVzZXMgbm9uLXN0YW5kYXJkIHRvdWNoIGV2ZW50cyxcbiAgICAvLyBzbyBpdCBoYXMgYSBkaWZmZXJlbnQgY2hlY2suXG4gICAgISEoZ2xvYmFsVGhpc1snbmF2aWdhdG9yJ10gJiZcbiAgICAgICAoZ2xvYmFsVGhpc1snbmF2aWdhdG9yJ11bJ21heFRvdWNoUG9pbnRzJ10gfHxcbiAgICAgICAgKGdsb2JhbFRoaXNbJ25hdmlnYXRvciddIGFzIGFueSlbJ21zTWF4VG91Y2hQb2ludHMnXSkpO1xuXG4vKiogV2hpY2ggdG91Y2ggZXZlbnRzIGFyZSB3ZSBjdXJyZW50bHkgcGF5aW5nIGF0dGVudGlvbiB0bz8gKi9cbmxldCB0b3VjaElkZW50aWZpZXJfOiBzdHJpbmd8bnVsbCA9IG51bGw7XG5cbi8qKlxuICogVGhlIFRPVUNIX01BUCBsb29rdXAgZGljdGlvbmFyeSBzcGVjaWZpZXMgYWRkaXRpb25hbCB0b3VjaCBldmVudHMgdG8gZmlyZSxcbiAqIGluIGNvbmp1bmN0aW9uIHdpdGggbW91c2UgZXZlbnRzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLlRPVUNIX01BUFxuICovXG5leHBvcnQgY29uc3QgVE9VQ0hfTUFQOiB7W2tleTogc3RyaW5nXTogc3RyaW5nW119ID0ge1xuICAnbW91c2Vkb3duJzogWydwb2ludGVyZG93biddLFxuICAnbW91c2VlbnRlcic6IFsncG9pbnRlcmVudGVyJ10sXG4gICdtb3VzZWxlYXZlJzogWydwb2ludGVybGVhdmUnXSxcbiAgJ21vdXNlbW92ZSc6IFsncG9pbnRlcm1vdmUnXSxcbiAgJ21vdXNlb3V0JzogWydwb2ludGVyb3V0J10sXG4gICdtb3VzZW92ZXInOiBbJ3BvaW50ZXJvdmVyJ10sXG4gICdtb3VzZXVwJzogWydwb2ludGVydXAnLCAncG9pbnRlcmNhbmNlbCddLFxuICAndG91Y2hlbmQnOiBbJ3BvaW50ZXJ1cCddLFxuICAndG91Y2hjYW5jZWwnOiBbJ3BvaW50ZXJjYW5jZWwnXSxcbn07XG5cbi8qKiBQSUQgb2YgcXVldWVkIGxvbmctcHJlc3MgdGFzay4gKi9cbmxldCBsb25nUGlkXzogQW55RHVyaW5nTWlncmF0aW9uID0gMDtcblxuLyoqXG4gKiBDb250ZXh0IG1lbnVzIG9uIHRvdWNoIGRldmljZXMgYXJlIGFjdGl2YXRlZCB1c2luZyBhIGxvbmctcHJlc3MuXG4gKiBVbmZvcnR1bmF0ZWx5IHRoZSBjb250ZXh0bWVudSB0b3VjaCBldmVudCBpcyBjdXJyZW50bHkgKDIwMTUpIG9ubHkgc3VwcG9ydGVkXG4gKiBieSBDaHJvbWUuICBUaGlzIGZ1bmN0aW9uIGlzIGZpcmVkIG9uIGFueSB0b3VjaHN0YXJ0IGV2ZW50LCBxdWV1ZXMgYSB0YXNrLFxuICogd2hpY2ggYWZ0ZXIgYWJvdXQgYSBzZWNvbmQgb3BlbnMgdGhlIGNvbnRleHQgbWVudS4gIFRoZSB0YXNrcyBpcyBraWxsZWRcbiAqIGlmIHRoZSB0b3VjaCBldmVudCB0ZXJtaW5hdGVzIGVhcmx5LlxuICpcbiAqIEBwYXJhbSBlIFRvdWNoIHN0YXJ0IGV2ZW50LlxuICogQHBhcmFtIGdlc3R1cmUgVGhlIGdlc3R1cmUgdGhhdCB0cmlnZ2VyZWQgdGhpcyBsb25nU3RhcnQuXG4gKiBAYWxpYXMgQmxvY2tseS5Ub3VjaC5sb25nU3RhcnRcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gbG9uZ1N0YXJ0KGU6IFBvaW50ZXJFdmVudCwgZ2VzdHVyZTogR2VzdHVyZSkge1xuICBsb25nU3RvcCgpO1xuICBsb25nUGlkXyA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgLy8gTGV0IHRoZSBnZXN0dXJlIHJvdXRlIHRoZSByaWdodC1jbGljayBjb3JyZWN0bHkuXG4gICAgaWYgKGdlc3R1cmUpIHtcbiAgICAgIGdlc3R1cmUuaGFuZGxlUmlnaHRDbGljayhlKTtcbiAgICB9XG4gIH0sIExPTkdQUkVTUyk7XG59XG5cbi8qKlxuICogTm9wZSwgdGhhdCdzIG5vdCBhIGxvbmctcHJlc3MuICBFaXRoZXIgdG91Y2hlbmQgb3IgdG91Y2hjYW5jZWwgd2FzIGZpcmVkLFxuICogb3IgYSBkcmFnIGhhdGggYmVndW4uICBLaWxsIHRoZSBxdWV1ZWQgbG9uZy1wcmVzcyB0YXNrLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLmxvbmdTdG9wXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvbmdTdG9wKCkge1xuICBpZiAobG9uZ1BpZF8pIHtcbiAgICBjbGVhclRpbWVvdXQobG9uZ1BpZF8pO1xuICAgIGxvbmdQaWRfID0gMDtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFyIHRoZSB0b3VjaCBpZGVudGlmaWVyIHRoYXQgdHJhY2tzIHdoaWNoIHRvdWNoIHN0cmVhbSB0byBwYXkgYXR0ZW50aW9uXG4gKiB0by4gIFRoaXMgZW5kcyB0aGUgY3VycmVudCBkcmFnL2dlc3R1cmUgYW5kIGFsbG93cyBvdGhlciBwb2ludGVycyB0byBiZVxuICogY2FwdHVyZWQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVG91Y2guY2xlYXJUb3VjaElkZW50aWZpZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVG91Y2hJZGVudGlmaWVyKCkge1xuICB0b3VjaElkZW50aWZpZXJfID0gbnVsbDtcbn1cblxuLyoqXG4gKiBEZWNpZGUgd2hldGhlciBCbG9ja2x5IHNob3VsZCBoYW5kbGUgb3IgaWdub3JlIHRoaXMgZXZlbnQuXG4gKiBNb3VzZSBhbmQgdG91Y2ggZXZlbnRzIHJlcXVpcmUgc3BlY2lhbCBjaGVja3MgYmVjYXVzZSB3ZSBvbmx5IHdhbnQgdG8gZGVhbFxuICogd2l0aCBvbmUgdG91Y2ggc3RyZWFtIGF0IGEgdGltZS4gIEFsbCBvdGhlciBldmVudHMgc2hvdWxkIGFsd2F5cyBiZSBoYW5kbGVkLlxuICpcbiAqIEBwYXJhbSBlIFRoZSBldmVudCB0byBjaGVjay5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhpcyBldmVudCBzaG91bGQgYmUgcGFzc2VkIHRocm91Z2ggdG8gdGhlIHJlZ2lzdGVyZWRcbiAqICAgICBoYW5kbGVyOyBmYWxzZSBpZiBpdCBzaG91bGQgYmUgYmxvY2tlZC5cbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLnNob3VsZEhhbmRsZUV2ZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG91bGRIYW5kbGVFdmVudChlOiBFdmVudCk6IGJvb2xlYW4ge1xuICAvLyBEbyBub3QgcmVwbGFjZSB0aGUgc3RhcnRzV2l0aCB3aXRoIGEgY2hlY2sgZm9yIGBpbnN0YW5jZW9mIFBvaW50ZXJFdmVudGAuXG4gIC8vIGBjbGlja2AgYW5kIGBjb250ZXh0bWVudWAgYXJlIFBvaW50ZXJFdmVudHMgaW4gc29tZSBicm93c2VycyxcbiAgLy8gZGVzcGl0ZSBub3Qgc3RhcnRpbmcgd2l0aCBgcG9pbnRlcmAsIGJ1dCB3ZSB3YW50IHRvIGFsd2F5cyBoYW5kbGUgdGhlbVxuICAvLyB3aXRob3V0IHdvcnJ5aW5nIGFib3V0IHRvdWNoIGlkZW50aWZpZXJzLlxuICByZXR1cm4gIShlLnR5cGUuc3RhcnRzV2l0aCgncG9pbnRlcicpKSB8fFxuICAgICAgKGUgaW5zdGFuY2VvZiBQb2ludGVyRXZlbnQgJiYgY2hlY2tUb3VjaElkZW50aWZpZXIoZSkpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgcG9pbnRlciBpZGVudGlmaWVyIGZyb20gdGhlIGdpdmVuIGV2ZW50LlxuICpcbiAqIEBwYXJhbSBlIFBvaW50ZXIgZXZlbnQuXG4gKiBAcmV0dXJucyBUaGUgcG9pbnRlcklkIG9mIHRoZSBldmVudC5cbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLmdldFRvdWNoSWRlbnRpZmllckZyb21FdmVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0VG91Y2hJZGVudGlmaWVyRnJvbUV2ZW50KGU6IFBvaW50ZXJFdmVudCk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtlLnBvaW50ZXJJZH1gO1xufVxuXG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdGhlIHBvaW50ZXIgaWRlbnRpZmllciBvbiB0aGUgZXZlbnQgbWF0Y2hlcyB0aGUgY3VycmVudCBzYXZlZFxuICogaWRlbnRpZmllci4gSWYgdGhlIGN1cnJlbnQgaWRlbnRpZmllciB3YXMgdW5zZXQsIHNhdmUgdGhlIGlkZW50aWZpZXIgZnJvbVxuICogdGhlIGV2ZW50LiBUaGlzIHN0YXJ0cyBhIGRyYWcvZ2VzdHVyZSwgZHVyaW5nIHdoaWNoIHBvaW50ZXIgZXZlbnRzIHdpdGhcbiAqIG90aGVyIGlkZW50aWZpZXJzIHdpbGwgYmUgc2lsZW50bHkgaWdub3JlZC5cbiAqXG4gKiBAcGFyYW0gZSBQb2ludGVyIGV2ZW50LlxuICogQHJldHVybnMgV2hldGhlciB0aGUgaWRlbnRpZmllciBvbiB0aGUgZXZlbnQgbWF0Y2hlcyB0aGUgY3VycmVudCBzYXZlZFxuICogICAgIGlkZW50aWZpZXIuXG4gKiBAYWxpYXMgQmxvY2tseS5Ub3VjaC5jaGVja1RvdWNoSWRlbnRpZmllclxuICovXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tUb3VjaElkZW50aWZpZXIoZTogUG9pbnRlckV2ZW50KTogYm9vbGVhbiB7XG4gIGNvbnN0IGlkZW50aWZpZXIgPSBnZXRUb3VjaElkZW50aWZpZXJGcm9tRXZlbnQoZSk7XG5cbiAgaWYgKHRvdWNoSWRlbnRpZmllcl8pIHtcbiAgICAvLyBXZSdyZSBhbHJlYWR5IHRyYWNraW5nIHNvbWUgdG91Y2gvbW91c2UgZXZlbnQuICBJcyB0aGlzIGZyb20gdGhlIHNhbWVcbiAgICAvLyBzb3VyY2U/XG4gICAgcmV0dXJuIHRvdWNoSWRlbnRpZmllcl8gPT09IGlkZW50aWZpZXI7XG4gIH1cbiAgaWYgKGUudHlwZSA9PT0gJ3BvaW50ZXJkb3duJykge1xuICAgIC8vIE5vIGlkZW50aWZpZXIgc2V0IHlldCwgYW5kIHRoaXMgaXMgdGhlIHN0YXJ0IG9mIGEgZHJhZy4gIFNldCBpdCBhbmRcbiAgICAvLyByZXR1cm4uXG4gICAgdG91Y2hJZGVudGlmaWVyXyA9IGlkZW50aWZpZXI7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgLy8gVGhlcmUgd2FzIG5vIGlkZW50aWZpZXIgeWV0LCBidXQgdGhpcyB3YXNuJ3QgYSBzdGFydCBldmVudCBzbyB3ZSdyZSBnb2luZ1xuICAvLyB0byBpZ25vcmUgaXQuICBUaGlzIHByb2JhYmx5IG1lYW5zIHRoYXQgYW5vdGhlciBkcmFnIGZpbmlzaGVkIHdoaWxlIHRoaXNcbiAgLy8gcG9pbnRlciB3YXMgZG93bi5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqIFNldCBhbiBldmVudCdzIGNsaWVudFggYW5kIGNsaWVudFkgZnJvbSBpdHMgZmlyc3QgY2hhbmdlZCB0b3VjaC4gIFVzZSB0aGlzIHRvXG4gKiBtYWtlIGEgdG91Y2ggZXZlbnQgd29yayBpbiBhIG1vdXNlIGV2ZW50IGhhbmRsZXIuXG4gKlxuICogQHBhcmFtIGUgQSB0b3VjaCBldmVudC5cbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLnNldENsaWVudEZyb21Ub3VjaFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q2xpZW50RnJvbVRvdWNoKGU6IEV2ZW50fFBzZXVkb0V2ZW50KSB7XG4gIGRlcHJlY2F0aW9uLndhcm4oJ3NldENsaWVudEZyb21Ub3VjaCgpJywgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJyk7XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2NoYW5nZWRUb3VjaGVzJyBkb2VzIG5vdCBleGlzdCBvblxuICAvLyB0eXBlICdQc2V1ZG9FdmVudCB8IEV2ZW50Jy5cbiAgaWYgKGUudHlwZS5zdGFydHNXaXRoKCd0b3VjaCcpICYmIChlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY2hhbmdlZFRvdWNoZXMpIHtcbiAgICAvLyBNYXAgdGhlIHRvdWNoIGV2ZW50J3MgcHJvcGVydGllcyB0byB0aGUgZXZlbnQuXG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnY2hhbmdlZFRvdWNoZXMnIGRvZXMgbm90IGV4aXN0IG9uXG4gICAgLy8gdHlwZSAnUHNldWRvRXZlbnQgfCBFdmVudCcuXG4gICAgY29uc3QgdG91Y2hQb2ludCA9IChlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnY2xpZW50WCcgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICdQc2V1ZG9FdmVudCB8IEV2ZW50Jy5cbiAgICAoZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmNsaWVudFggPSB0b3VjaFBvaW50LmNsaWVudFg7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnY2xpZW50WScgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICdQc2V1ZG9FdmVudCB8IEV2ZW50Jy5cbiAgICAoZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmNsaWVudFkgPSB0b3VjaFBvaW50LmNsaWVudFk7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIGEgZ2l2ZW4gZXZlbnQgaXMgYSBtb3VzZSwgdG91Y2gsIG9yIHBvaW50ZXIgZXZlbnQuXG4gKlxuICogQHBhcmFtIGUgQW4gZXZlbnQuXG4gKiBAcmV0dXJucyBUcnVlIGlmIGl0IGlzIGEgbW91c2UsIHRvdWNoLCBvciBwb2ludGVyIGV2ZW50OyBmYWxzZSBvdGhlcndpc2UuXG4gKiBAYWxpYXMgQmxvY2tseS5Ub3VjaC5pc01vdXNlT3JUb3VjaEV2ZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc01vdXNlT3JUb3VjaEV2ZW50KGU6IEV2ZW50fFBzZXVkb0V2ZW50KTogYm9vbGVhbiB7XG4gIGRlcHJlY2F0aW9uLndhcm4oJ2lzTW91c2VPclRvdWNoRXZlbnQoKScsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcpO1xuICByZXR1cm4gZS50eXBlLnN0YXJ0c1dpdGgoJ3RvdWNoJykgfHwgZS50eXBlLnN0YXJ0c1dpdGgoJ21vdXNlJykgfHxcbiAgICAgIGUudHlwZS5zdGFydHNXaXRoKCdwb2ludGVyJyk7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciBhIGdpdmVuIGV2ZW50IGlzIGEgdG91Y2ggZXZlbnQgb3IgYSBwb2ludGVyIGV2ZW50LlxuICpcbiAqIEBwYXJhbSBlIEFuIGV2ZW50LlxuICogQHJldHVybnMgVHJ1ZSBpZiBpdCBpcyBhIHRvdWNoIG9yIHBvaW50ZXIgZXZlbnQ7IGZhbHNlIG90aGVyd2lzZS5cbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLmlzVG91Y2hFdmVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUb3VjaEV2ZW50KGU6IEV2ZW50fFBzZXVkb0V2ZW50KTogYm9vbGVhbiB7XG4gIGRlcHJlY2F0aW9uLndhcm4oJ2lzVG91Y2hFdmVudCgpJywgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJyk7XG4gIHJldHVybiBlLnR5cGUuc3RhcnRzV2l0aCgndG91Y2gnKSB8fCBlLnR5cGUuc3RhcnRzV2l0aCgncG9pbnRlcicpO1xufVxuXG4vKipcbiAqIFNwbGl0IGFuIGV2ZW50IGludG8gYW4gYXJyYXkgb2YgZXZlbnRzLCBvbmUgcGVyIGNoYW5nZWQgdG91Y2ggb3IgbW91c2VcbiAqIHBvaW50LlxuICpcbiAqIEBwYXJhbSBlIEEgbW91c2UgZXZlbnQgb3IgYSB0b3VjaCBldmVudCB3aXRoIG9uZSBvciBtb3JlIGNoYW5nZWQgdG91Y2hlcy5cbiAqIEByZXR1cm5zIEFuIGFycmF5IG9mIGV2ZW50cyBvciBwc2V1ZG8gZXZlbnRzLlxuICogICAgIEVhY2ggcHNldWRvLXRvdWNoIGV2ZW50IHdpbGwgaGF2ZSBleGFjdGx5IG9uZSBjaGFuZ2VkIHRvdWNoIGFuZCB0aGVyZVxuICogd2lsbCBiZSBubyByZWFsIHRvdWNoIGV2ZW50cy5cbiAqIEBhbGlhcyBCbG9ja2x5LlRvdWNoLnNwbGl0RXZlbnRCeVRvdWNoZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNwbGl0RXZlbnRCeVRvdWNoZXMoZTogRXZlbnQpOiBBcnJheTxFdmVudHxQc2V1ZG9FdmVudD4ge1xuICBkZXByZWNhdGlvbi53YXJuKCdzcGxpdEV2ZW50QnlUb3VjaGVzKCknLCAndmVyc2lvbiA5JywgJ3ZlcnNpb24gMTAnKTtcbiAgY29uc3QgZXZlbnRzID0gW107XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2NoYW5nZWRUb3VjaGVzJyBkb2VzIG5vdCBleGlzdCBvblxuICAvLyB0eXBlICdQc2V1ZG9FdmVudCB8IEV2ZW50Jy5cbiAgaWYgKChlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY2hhbmdlZFRvdWNoZXMpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdjaGFuZ2VkVG91Y2hlcycgZG9lcyBub3QgZXhpc3Qgb25cbiAgICAvLyB0eXBlICdQc2V1ZG9FdmVudCB8IEV2ZW50Jy5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IChlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY2hhbmdlZFRvdWNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG5ld0V2ZW50ID0ge1xuICAgICAgICB0eXBlOiBlLnR5cGUsXG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2NoYW5nZWRUb3VjaGVzJyBkb2VzIG5vdCBleGlzdFxuICAgICAgICAvLyBvbiB0eXBlICdQc2V1ZG9FdmVudCB8IEV2ZW50Jy5cbiAgICAgICAgY2hhbmdlZFRvdWNoZXM6IFsoZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmNoYW5nZWRUb3VjaGVzW2ldXSxcbiAgICAgICAgdGFyZ2V0OiBlLnRhcmdldCxcbiAgICAgICAgc3RvcFByb3BhZ2F0aW9uKCkge1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHByZXZlbnREZWZhdWx0KCkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBldmVudHNbaV0gPSBuZXdFdmVudDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZXZlbnRzLnB1c2goZSk7XG4gIH1cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICcoRXZlbnQgfCB7IHR5cGU6IHN0cmluZzsgY2hhbmdlZFRvdWNoZXM6XG4gIC8vIFRvdWNoW107IHRhcmdldDogRXZlbnRUYXJnZXQgfCBudWxsOyBzdG9wUHJvcGFnYXRpb24oKTogdm9pZDtcbiAgLy8gcHJldmVudERlZmF1bHQoKTogdm9pZDsgfSlbXScgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZSAnKFBzZXVkb0V2ZW50IHxcbiAgLy8gRXZlbnQpW10nLlxuICByZXR1cm4gZXZlbnRzIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBCcm93c2VyIGV2ZW50IGhhbmRsaW5nLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5icm93c2VyRXZlbnRzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYnJvd3NlckV2ZW50cycpO1xuXG5pbXBvcnQgKiBhcyBUb3VjaCBmcm9tICcuL3RvdWNoLmpzJztcbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgdXNlckFnZW50IGZyb20gJy4vdXRpbHMvdXNlcmFnZW50LmpzJztcblxuXG4vKipcbiAqIEJsb2NrbHkgb3BhcXVlIGV2ZW50IGRhdGEgdXNlZCB0byB1bmJpbmQgZXZlbnRzIHdoZW4gdXNpbmdcbiAqIGBiaW5kYCBhbmQgYGNvbmRpdGlvbmFsQmluZGAuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYnJvd3NlckV2ZW50cy5EYXRhXG4gKi9cbmV4cG9ydCB0eXBlIERhdGEgPSBbRXZlbnRUYXJnZXQsIHN0cmluZywgKGU6IEV2ZW50KSA9PiB2b2lkXVtdO1xuXG4vKipcbiAqIFRoZSBtdWx0aXBsaWVyIGZvciBzY3JvbGwgd2hlZWwgZGVsdGFzIHVzaW5nIHRoZSBsaW5lIGRlbHRhIG1vZGUuXG4gKiBTZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1doZWVsRXZlbnQvZGVsdGFNb2RlXG4gKiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBkZWx0YU1vZGUuXG4gKi9cbmNvbnN0IExJTkVfTU9ERV9NVUxUSVBMSUVSID0gNDA7XG5cbi8qKlxuICogVGhlIG11bHRpcGxpZXIgZm9yIHNjcm9sbCB3aGVlbCBkZWx0YXMgdXNpbmcgdGhlIHBhZ2UgZGVsdGEgbW9kZS5cbiAqIFNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvV2hlZWxFdmVudC9kZWx0YU1vZGVcbiAqIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGRlbHRhTW9kZS5cbiAqL1xuY29uc3QgUEFHRV9NT0RFX01VTFRJUExJRVIgPSAxMjU7XG5cbi8qKlxuICogQmluZCBhbiBldmVudCBoYW5kbGVyIHRoYXQgY2FuIGJlIGlnbm9yZWQgaWYgaXQgaXMgbm90IHBhcnQgb2YgdGhlIGFjdGl2ZVxuICogdG91Y2ggc3RyZWFtLlxuICogVXNlIHRoaXMgZm9yIGV2ZW50cyB0aGF0IGVpdGhlciBzdGFydCBvciBjb250aW51ZSBhIG11bHRpLXBhcnQgZ2VzdHVyZSAoZS5nLlxuICogbW91c2Vkb3duIG9yIG1vdXNlbW92ZSwgd2hpY2ggbWF5IGJlIHBhcnQgb2YgYSBkcmFnIG9yIGNsaWNrKS5cbiAqXG4gKiBAcGFyYW0gbm9kZSBOb2RlIHVwb24gd2hpY2ggdG8gbGlzdGVuLlxuICogQHBhcmFtIG5hbWUgRXZlbnQgbmFtZSB0byBsaXN0ZW4gdG8gKGUuZy4gJ21vdXNlZG93bicpLlxuICogQHBhcmFtIHRoaXNPYmplY3QgVGhlIHZhbHVlIG9mICd0aGlzJyBpbiB0aGUgZnVuY3Rpb24uXG4gKiBAcGFyYW0gZnVuYyBGdW5jdGlvbiB0byBjYWxsIHdoZW4gZXZlbnQgaXMgdHJpZ2dlcmVkLlxuICogQHBhcmFtIG9wdF9ub0NhcHR1cmVJZGVudGlmaWVyIFRydWUgaWYgdHJpZ2dlcmluZyBvbiB0aGlzIGV2ZW50IHNob3VsZCBub3RcbiAqICAgICBibG9jayBleGVjdXRpb24gb2Ygb3RoZXIgZXZlbnQgaGFuZGxlcnMgb24gdGhpcyB0b3VjaCBvciBvdGhlclxuICogICAgIHNpbXVsdGFuZW91cyB0b3VjaGVzLiAgRmFsc2UgYnkgZGVmYXVsdC5cbiAqIEBwYXJhbSBvcHRfbm9QcmV2ZW50RGVmYXVsdCBOby1vcCwgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHYxMC5cbiAqIEByZXR1cm5zIE9wYXF1ZSBkYXRhIHRoYXQgY2FuIGJlIHBhc3NlZCB0byB1bmJpbmRFdmVudF8uXG4gKiBAYWxpYXMgQmxvY2tseS5icm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZFxuICovXG5leHBvcnQgZnVuY3Rpb24gY29uZGl0aW9uYWxCaW5kKFxuICAgIG5vZGU6IEV2ZW50VGFyZ2V0LCBuYW1lOiBzdHJpbmcsIHRoaXNPYmplY3Q6IE9iamVjdHxudWxsLCBmdW5jOiBGdW5jdGlvbixcbiAgICBvcHRfbm9DYXB0dXJlSWRlbnRpZmllcj86IGJvb2xlYW4sIG9wdF9ub1ByZXZlbnREZWZhdWx0PzogYm9vbGVhbik6IERhdGEge1xuICBpZiAob3B0X25vUHJldmVudERlZmF1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdUaGUgb3B0X25vUHJldmVudERlZmF1bHQgYXJndW1lbnQgb2YgY29uZGl0aW9uYWxCaW5kJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJyk7XG4gIH1cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBlXG4gICAqL1xuICBmdW5jdGlvbiB3cmFwRnVuYyhlOiBFdmVudCkge1xuICAgIGNvbnN0IGNhcHR1cmVJZGVudGlmaWVyID0gIW9wdF9ub0NhcHR1cmVJZGVudGlmaWVyO1xuXG4gICAgaWYgKCEoY2FwdHVyZUlkZW50aWZpZXIgJiYgIVRvdWNoLnNob3VsZEhhbmRsZUV2ZW50KGUpKSkge1xuICAgICAgaWYgKHRoaXNPYmplY3QpIHtcbiAgICAgICAgZnVuYy5jYWxsKHRoaXNPYmplY3QsIGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZnVuYyhlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjb25zdCBiaW5kRGF0YTogRGF0YSA9IFtdO1xuICBpZiAobmFtZSBpbiBUb3VjaC5UT1VDSF9NQVApIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRvdWNoLlRPVUNIX01BUFtuYW1lXS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdHlwZSA9IFRvdWNoLlRPVUNIX01BUFtuYW1lXVtpXTtcbiAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCB3cmFwRnVuYywgZmFsc2UpO1xuICAgICAgYmluZERhdGEucHVzaChbbm9kZSwgdHlwZSwgd3JhcEZ1bmNdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKG5hbWUsIHdyYXBGdW5jLCBmYWxzZSk7XG4gICAgYmluZERhdGEucHVzaChbbm9kZSwgbmFtZSwgd3JhcEZ1bmNdKTtcbiAgfVxuICByZXR1cm4gYmluZERhdGE7XG59XG5cbi8qKlxuICogQmluZCBhbiBldmVudCBoYW5kbGVyIHRoYXQgc2hvdWxkIGJlIGNhbGxlZCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgaXQgaXMgcGFydFxuICogb2YgdGhlIGFjdGl2ZSB0b3VjaCBzdHJlYW0uXG4gKiBVc2UgdGhpcyBmb3IgZXZlbnRzIHRoYXQgYXJlIG5vdCBwYXJ0IG9mIGEgbXVsdGktcGFydCBnZXN0dXJlIChlLmcuXG4gKiBtb3VzZW92ZXIgZm9yIHRvb2x0aXBzKS5cbiAqXG4gKiBAcGFyYW0gbm9kZSBOb2RlIHVwb24gd2hpY2ggdG8gbGlzdGVuLlxuICogQHBhcmFtIG5hbWUgRXZlbnQgbmFtZSB0byBsaXN0ZW4gdG8gKGUuZy4gJ21vdXNlZG93bicpLlxuICogQHBhcmFtIHRoaXNPYmplY3QgVGhlIHZhbHVlIG9mICd0aGlzJyBpbiB0aGUgZnVuY3Rpb24uXG4gKiBAcGFyYW0gZnVuYyBGdW5jdGlvbiB0byBjYWxsIHdoZW4gZXZlbnQgaXMgdHJpZ2dlcmVkLlxuICogQHJldHVybnMgT3BhcXVlIGRhdGEgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIHVuYmluZEV2ZW50Xy5cbiAqIEBhbGlhcyBCbG9ja2x5LmJyb3dzZXJFdmVudHMuYmluZFxuICovXG5leHBvcnQgZnVuY3Rpb24gYmluZChcbiAgICBub2RlOiBFdmVudFRhcmdldCwgbmFtZTogc3RyaW5nLCB0aGlzT2JqZWN0OiBPYmplY3R8bnVsbCxcbiAgICBmdW5jOiBGdW5jdGlvbik6IERhdGEge1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGVcbiAgICovXG4gIGZ1bmN0aW9uIHdyYXBGdW5jKGU6IEV2ZW50KSB7XG4gICAgaWYgKHRoaXNPYmplY3QpIHtcbiAgICAgIGZ1bmMuY2FsbCh0aGlzT2JqZWN0LCBlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZnVuYyhlKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBiaW5kRGF0YTogRGF0YSA9IFtdO1xuICBpZiAobmFtZSBpbiBUb3VjaC5UT1VDSF9NQVApIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRvdWNoLlRPVUNIX01BUFtuYW1lXS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdHlwZSA9IFRvdWNoLlRPVUNIX01BUFtuYW1lXVtpXTtcbiAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCB3cmFwRnVuYywgZmFsc2UpO1xuICAgICAgYmluZERhdGEucHVzaChbbm9kZSwgdHlwZSwgd3JhcEZ1bmNdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKG5hbWUsIHdyYXBGdW5jLCBmYWxzZSk7XG4gICAgYmluZERhdGEucHVzaChbbm9kZSwgbmFtZSwgd3JhcEZ1bmNdKTtcbiAgfVxuICByZXR1cm4gYmluZERhdGE7XG59XG5cbi8qKlxuICogVW5iaW5kIG9uZSBvciBtb3JlIGV2ZW50cyBldmVudCBmcm9tIGEgZnVuY3Rpb24gY2FsbC5cbiAqXG4gKiBAcGFyYW0gYmluZERhdGEgT3BhcXVlIGRhdGEgZnJvbSBiaW5kRXZlbnRfLlxuICogICAgIFRoaXMgbGlzdCBpcyBlbXB0aWVkIGR1cmluZyB0aGUgY291cnNlIG9mIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi5cbiAqIEByZXR1cm5zIFRoZSBmdW5jdGlvbiBjYWxsLlxuICogQGFsaWFzIEJsb2NrbHkuYnJvd3NlckV2ZW50cy51bmJpbmRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVuYmluZChiaW5kRGF0YTogRGF0YSk6IChlOiBFdmVudCkgPT4gdm9pZCB7XG4gIC8vIEFjY2Vzc2luZyBhbiBlbGVtZW50IG9mIHRoZSBsYXN0IHByb3BlcnR5IG9mIHRoZSBhcnJheSBpcyB1bnNhZmUgaWYgdGhlXG4gIC8vIGJpbmREYXRhIGlzIGFuIGVtcHR5IGFycmF5LiBCdXQgdGhhdCBzaG91bGQgbmV2ZXIgaGFwcGVuIGJlY2F1c2UgZGV2ZWxvcGVyc1xuICAvLyBzaG91bGQgb25seSBwYXNzIERhdGEgZnJvbSBiaW5kIG9yIGNvbmRpdGlvbmFsQmluZC5cbiAgY29uc3QgY2FsbGJhY2sgPSBiaW5kRGF0YVtiaW5kRGF0YS5sZW5ndGggLSAxXVsyXTtcbiAgd2hpbGUgKGJpbmREYXRhLmxlbmd0aCkge1xuICAgIGNvbnN0IGJpbmREYXR1bSA9IGJpbmREYXRhLnBvcCgpO1xuICAgIGNvbnN0IG5vZGUgPSBiaW5kRGF0dW0hWzBdO1xuICAgIGNvbnN0IG5hbWUgPSBiaW5kRGF0dW0hWzFdO1xuICAgIGNvbnN0IGZ1bmMgPSBiaW5kRGF0dW0hWzJdO1xuICAgIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCBmdW5jLCBmYWxzZSk7XG4gIH1cbiAgcmV0dXJuIGNhbGxiYWNrO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGV2ZW50IGlzIHRhcmdldGluZyBhIHRleHQgaW5wdXQgd2lkZ2V0P1xuICpcbiAqIEBwYXJhbSBlIEFuIGV2ZW50LlxuICogQHJldHVybnMgVHJ1ZSBpZiB0ZXh0IGlucHV0LlxuICogQGFsaWFzIEJsb2NrbHkuYnJvd3NlckV2ZW50cy5pc1RhcmdldElucHV0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RhcmdldElucHV0KGU6IEV2ZW50KTogYm9vbGVhbiB7XG4gIGlmIChlLnRhcmdldCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgaWYgKGUudGFyZ2V0LmlzQ29udGVudEVkaXRhYmxlIHx8XG4gICAgICAgIGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pcy10ZXh0LWlucHV0JykgPT09ICd0cnVlJykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGUudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICByZXR1cm4gdGFyZ2V0LnR5cGUgPT09ICd0ZXh0JyB8fCB0YXJnZXQudHlwZSA9PT0gJ251bWJlcicgfHxcbiAgICAgICAgICB0YXJnZXQudHlwZSA9PT0gJ2VtYWlsJyB8fCB0YXJnZXQudHlwZSA9PT0gJ3Bhc3N3b3JkJyB8fFxuICAgICAgICAgIHRhcmdldC50eXBlID09PSAnc2VhcmNoJyB8fCB0YXJnZXQudHlwZSA9PT0gJ3RlbCcgfHxcbiAgICAgICAgICB0YXJnZXQudHlwZSA9PT0gJ3VybCc7XG4gICAgfVxuXG4gICAgaWYgKGUudGFyZ2V0IGluc3RhbmNlb2YgSFRNTFRleHRBcmVhRWxlbWVudCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSB0aGlzIGV2ZW50IGlzIGEgcmlnaHQtY2xpY2suXG4gKlxuICogQHBhcmFtIGUgTW91c2UgZXZlbnQuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHJpZ2h0LWNsaWNrLlxuICogQGFsaWFzIEJsb2NrbHkuYnJvd3NlckV2ZW50cy5pc1JpZ2h0QnV0dG9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1JpZ2h0QnV0dG9uKGU6IE1vdXNlRXZlbnQpOiBib29sZWFuIHtcbiAgaWYgKGUuY3RybEtleSAmJiB1c2VyQWdlbnQuTUFDKSB7XG4gICAgLy8gQ29udHJvbC1jbGlja2luZyBvbiBNYWMgT1MgWCBpcyB0cmVhdGVkIGFzIGEgcmlnaHQtY2xpY2suXG4gICAgLy8gV2ViS2l0IG9uIE1hYyBPUyBYIGZhaWxzIHRvIGNoYW5nZSBidXR0b24gdG8gMiAoYnV0IEdlY2tvIGRvZXMpLlxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBlLmJ1dHRvbiA9PT0gMjtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgY29vcmRpbmF0ZXMgb2YgdGhlIGdpdmVuIG1vdXNlIGV2ZW50LlxuICogVGhlIG9yaWdpbiAoMCwwKSBpcyB0aGUgdG9wLWxlZnQgY29ybmVyIG9mIHRoZSBCbG9ja2x5IFNWRy5cbiAqXG4gKiBAcGFyYW0gZSBNb3VzZSBldmVudC5cbiAqIEBwYXJhbSBzdmcgU1ZHIGVsZW1lbnQuXG4gKiBAcGFyYW0gbWF0cml4IEludmVydGVkIHNjcmVlbiBDVE0gdG8gdXNlLlxuICogQHJldHVybnMgT2JqZWN0IHdpdGggLnggYW5kIC55IHByb3BlcnRpZXMuXG4gKiBAYWxpYXMgQmxvY2tseS5icm93c2VyRXZlbnRzLm1vdXNlVG9TdmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1vdXNlVG9TdmcoXG4gICAgZTogTW91c2VFdmVudCwgc3ZnOiBTVkdTVkdFbGVtZW50LCBtYXRyaXg6IFNWR01hdHJpeHxudWxsKTogU1ZHUG9pbnQge1xuICBjb25zdCBzdmdQb2ludCA9IHN2Zy5jcmVhdGVTVkdQb2ludCgpO1xuICBzdmdQb2ludC54ID0gZS5jbGllbnRYO1xuICBzdmdQb2ludC55ID0gZS5jbGllbnRZO1xuXG4gIGlmICghbWF0cml4KSB7XG4gICAgbWF0cml4ID0gc3ZnLmdldFNjcmVlbkNUTSgpIS5pbnZlcnNlKCk7XG4gIH1cbiAgcmV0dXJuIHN2Z1BvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHNjcm9sbCBkZWx0YSBvZiBhIG1vdXNlIGV2ZW50IGluIHBpeGVsIHVuaXRzLlxuICpcbiAqIEBwYXJhbSBlIE1vdXNlIGV2ZW50LlxuICogQHJldHVybnMgU2Nyb2xsIGRlbHRhIG9iamVjdCB3aXRoIC54IGFuZCAueSBwcm9wZXJ0aWVzLlxuICogQGFsaWFzIEJsb2NrbHkuYnJvd3NlckV2ZW50cy5nZXRTY3JvbGxEZWx0YVBpeGVsc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2Nyb2xsRGVsdGFQaXhlbHMoZTogV2hlZWxFdmVudCk6IHt4OiBudW1iZXIsIHk6IG51bWJlcn0ge1xuICBzd2l0Y2ggKGUuZGVsdGFNb2RlKSB7XG4gICAgY2FzZSAweDAwOiAgLy8gUGl4ZWwgbW9kZS5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHt4OiBlLmRlbHRhWCwgeTogZS5kZWx0YVl9O1xuICAgIGNhc2UgMHgwMTogIC8vIExpbmUgbW9kZS5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IGUuZGVsdGFYICogTElORV9NT0RFX01VTFRJUExJRVIsXG4gICAgICAgIHk6IGUuZGVsdGFZICogTElORV9NT0RFX01VTFRJUExJRVIsXG4gICAgICB9O1xuICAgIGNhc2UgMHgwMjogIC8vIFBhZ2UgbW9kZS5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IGUuZGVsdGFYICogUEFHRV9NT0RFX01VTFRJUExJRVIsXG4gICAgICAgIHk6IGUuZGVsdGFZICogUEFHRV9NT0RFX01VTFRJUExJRVIsXG4gICAgICB9O1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ29tbW9uIGZ1bmN0aW9ucyB1c2VkIGJvdGggaW50ZXJuYWxseSBhbmQgZXh0ZXJuYWxseSwgYnV0IHdoaWNoXG4gKiBtdXN0IG5vdCBiZSBhdCB0aGUgdG9wIGxldmVsIHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY2llcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuY29tbW9uXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuY29tbW9uJyk7XG5cbi8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycyAqL1xuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCB7QmxvY2tEZWZpbml0aW9uLCBCbG9ja3N9IGZyb20gJy4vYmxvY2tzLmpzJztcbmltcG9ydCB0eXBlIHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge0lDb3B5YWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29weWFibGUuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi93b3Jrc3BhY2UuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKiogRGF0YWJhc2Ugb2YgYWxsIHdvcmtzcGFjZXMuICovXG5jb25zdCBXb3Jrc3BhY2VEQl8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG5cbi8qKlxuICogRmluZCB0aGUgd29ya3NwYWNlIHdpdGggdGhlIHNwZWNpZmllZCBJRC5cbiAqXG4gKiBAcGFyYW0gaWQgSUQgb2Ygd29ya3NwYWNlIHRvIGZpbmQuXG4gKiBAcmV0dXJucyBUaGUgc291Z2h0IGFmdGVyIHdvcmtzcGFjZSBvciBudWxsIGlmIG5vdCBmb3VuZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFdvcmtzcGFjZUJ5SWQoaWQ6IHN0cmluZyk6IFdvcmtzcGFjZXxudWxsIHtcbiAgcmV0dXJuIFdvcmtzcGFjZURCX1tpZF0gfHwgbnVsbDtcbn1cblxuLyoqXG4gKiBGaW5kIGFsbCB3b3Jrc3BhY2VzLlxuICpcbiAqIEByZXR1cm5zIEFycmF5IG9mIHdvcmtzcGFjZXMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxXb3Jrc3BhY2VzKCk6IFdvcmtzcGFjZVtdIHtcbiAgY29uc3Qgd29ya3NwYWNlcyA9IFtdO1xuICBmb3IgKGNvbnN0IHdvcmtzcGFjZUlkIGluIFdvcmtzcGFjZURCXykge1xuICAgIHdvcmtzcGFjZXMucHVzaChXb3Jrc3BhY2VEQl9bd29ya3NwYWNlSWRdKTtcbiAgfVxuICByZXR1cm4gd29ya3NwYWNlcztcbn1cblxuLyoqXG4gKiBSZWdpc3RlciBhIHdvcmtzcGFjZSBpbiB0aGUgd29ya3NwYWNlIGRiLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyV29ya3NwYWNlKHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XG4gIFdvcmtzcGFjZURCX1t3b3Jrc3BhY2UuaWRdID0gd29ya3NwYWNlO1xufVxuXG4vKipcbiAqIFVucmVnaXN0ZXIgYSB3b3Jrc3BhY2UgZnJvbSB0aGUgd29ya3NwYWNlIGRiLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVucmVnaXN0ZXJXb3JrcGFjZSh3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICBkZWxldGUgV29ya3NwYWNlREJfW3dvcmtzcGFjZS5pZF07XG59XG5cbi8qKlxuICogVGhlIG1haW4gd29ya3NwYWNlIG1vc3QgcmVjZW50bHkgdXNlZC5cbiAqIFNldCBieSBCbG9ja2x5LldvcmtzcGFjZVN2Zy5wcm90b3R5cGUubWFya0ZvY3VzZWRcbiAqL1xubGV0IG1haW5Xb3Jrc3BhY2U6IFdvcmtzcGFjZTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXN0IHVzZWQgdG9wIGxldmVsIHdvcmtzcGFjZSAoYmFzZWQgb24gZm9jdXMpLiAgVHJ5IG5vdCB0byB1c2VcbiAqIHRoaXMgZnVuY3Rpb24sIHBhcnRpY3VsYXJseSBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgQmxvY2tseSBpbnN0YW5jZXMgb24gYVxuICogcGFnZS5cbiAqXG4gKiBAcmV0dXJucyBUaGUgbWFpbiB3b3Jrc3BhY2UuXG4gKiBAYWxpYXMgQmxvY2tseS5jb21tb24uZ2V0TWFpbldvcmtzcGFjZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWFpbldvcmtzcGFjZSgpOiBXb3Jrc3BhY2Uge1xuICByZXR1cm4gbWFpbldvcmtzcGFjZTtcbn1cblxuLyoqXG4gKiBTZXRzIGxhc3QgdXNlZCBtYWluIHdvcmtzcGFjZS5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSBtb3N0IHJlY2VudGx5IHVzZWQgdG9wIGxldmVsIHdvcmtzcGFjZS5cbiAqIEBhbGlhcyBCbG9ja2x5LmNvbW1vbi5zZXRNYWluV29ya3NwYWNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRNYWluV29ya3NwYWNlKHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XG4gIG1haW5Xb3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG59XG5cbi8qKlxuICogQ3VycmVudGx5IHNlbGVjdGVkIGNvcHlhYmxlIG9iamVjdC5cbiAqL1xubGV0IHNlbGVjdGVkOiBJQ29weWFibGV8bnVsbCA9IG51bGw7XG5cbi8qKlxuICogUmV0dXJucyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGNvcHlhYmxlIG9iamVjdC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5jb21tb24uZ2V0U2VsZWN0ZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNlbGVjdGVkKCk6IElDb3B5YWJsZXxudWxsIHtcbiAgcmV0dXJuIHNlbGVjdGVkO1xufVxuXG4vKipcbiAqIFNldHMgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBibG9jay4gVGhpcyBmdW5jdGlvbiBkb2VzIG5vdCB2aXN1YWxseSBtYXJrIHRoZVxuICogYmxvY2sgYXMgc2VsZWN0ZWQgb3IgZmlyZSB0aGUgcmVxdWlyZWQgZXZlbnRzLiBJZiB5b3Ugd2lzaCB0b1xuICogcHJvZ3JhbW1hdGljYWxseSBzZWxlY3QgYSBibG9jaywgdXNlIGBCbG9ja1N2ZyNzZWxlY3RgLlxuICpcbiAqIEBwYXJhbSBuZXdTZWxlY3Rpb24gVGhlIG5ld2x5IHNlbGVjdGVkIGJsb2NrLlxuICogQGFsaWFzIEJsb2NrbHkuY29tbW9uLnNldFNlbGVjdGVkXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldFNlbGVjdGVkKG5ld1NlbGVjdGlvbjogSUNvcHlhYmxlfG51bGwpIHtcbiAgc2VsZWN0ZWQgPSBuZXdTZWxlY3Rpb247XG59XG5cbi8qKlxuICogQ29udGFpbmVyIGVsZW1lbnQgaW4gd2hpY2ggdG8gcmVuZGVyIHRoZSBXaWRnZXREaXYsIERyb3BEb3duRGl2IGFuZCBUb29sdGlwLlxuICovXG5sZXQgcGFyZW50Q29udGFpbmVyOiBFbGVtZW50fG51bGw7XG5cbi8qKlxuICogR2V0IHRoZSBjb250YWluZXIgZWxlbWVudCBpbiB3aGljaCB0byByZW5kZXIgdGhlIFdpZGdldERpdiwgRHJvcERvd25EaXYgYW5kXG4gKiBUb29sdGlwLlxuICpcbiAqIEByZXR1cm5zIFRoZSBwYXJlbnQgY29udGFpbmVyLlxuICogQGFsaWFzIEJsb2NrbHkuY29tbW9uLmdldFBhcmVudENvbnRhaW5lclxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyZW50Q29udGFpbmVyKCk6IEVsZW1lbnR8bnVsbCB7XG4gIHJldHVybiBwYXJlbnRDb250YWluZXI7XG59XG5cbi8qKlxuICogU2V0IHRoZSBwYXJlbnQgY29udGFpbmVyLiAgVGhpcyBpcyB0aGUgY29udGFpbmVyIGVsZW1lbnQgdGhhdCB0aGUgV2lkZ2V0RGl2LFxuICogRHJvcERvd25EaXYsIGFuZCBUb29sdGlwIGFyZSByZW5kZXJlZCBpbnRvIHRoZSBmaXJzdCB0aW1lIGBCbG9ja2x5LmluamVjdGBcbiAqIGlzIGNhbGxlZC5cbiAqIFRoaXMgbWV0aG9kIGlzIGEgTk9QIGlmIGNhbGxlZCBhZnRlciB0aGUgZmlyc3QgYEJsb2NrbHkuaW5qZWN0YC5cbiAqXG4gKiBAcGFyYW0gbmV3UGFyZW50IFRoZSBjb250YWluZXIgZWxlbWVudC5cbiAqIEBhbGlhcyBCbG9ja2x5LmNvbW1vbi5zZXRQYXJlbnRDb250YWluZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldFBhcmVudENvbnRhaW5lcihuZXdQYXJlbnQ6IEVsZW1lbnQpIHtcbiAgcGFyZW50Q29udGFpbmVyID0gbmV3UGFyZW50O1xufVxuXG4vKipcbiAqIFNpemUgdGhlIFNWRyBpbWFnZSB0byBjb21wbGV0ZWx5IGZpbGwgaXRzIGNvbnRhaW5lci4gQ2FsbCB0aGlzIHdoZW4gdGhlIHZpZXdcbiAqIGFjdHVhbGx5IGNoYW5nZXMgc2l6ZXMgKGUuZy4gb24gYSB3aW5kb3cgcmVzaXplL2RldmljZSBvcmllbnRhdGlvbiBjaGFuZ2UpLlxuICogU2VlIHdvcmtzcGFjZS5yZXNpemVDb250ZW50cyB0byByZXNpemUgdGhlIHdvcmtzcGFjZSB3aGVuIHRoZSBjb250ZW50c1xuICogY2hhbmdlIChlLmcuIHdoZW4gYSBibG9jayBpcyBhZGRlZCBvciByZW1vdmVkKS5cbiAqIFJlY29yZCB0aGUgaGVpZ2h0L3dpZHRoIG9mIHRoZSBTVkcgaW1hZ2UuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBBbnkgd29ya3NwYWNlIGluIHRoZSBTVkcuXG4gKiBAYWxpYXMgQmxvY2tseS5jb21tb24uc3ZnUmVzaXplXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdmdSZXNpemUod29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpIHtcbiAgbGV0IG1haW5Xb3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG4gIHdoaWxlIChtYWluV29ya3NwYWNlLm9wdGlvbnMucGFyZW50V29ya3NwYWNlKSB7XG4gICAgbWFpbldvcmtzcGFjZSA9IG1haW5Xb3Jrc3BhY2Uub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2U7XG4gIH1cbiAgY29uc3Qgc3ZnID0gbWFpbldvcmtzcGFjZS5nZXRQYXJlbnRTdmcoKTtcbiAgY29uc3QgY2FjaGVkU2l6ZSA9IG1haW5Xb3Jrc3BhY2UuZ2V0Q2FjaGVkUGFyZW50U3ZnU2l6ZSgpO1xuICBjb25zdCBkaXYgPSBzdmcucGFyZW50RWxlbWVudDtcbiAgaWYgKCEoZGl2IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB7XG4gICAgLy8gV29ya3NwYWNlIGRlbGV0ZWQsIG9yIHNvbWV0aGluZy5cbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB3aWR0aCA9IGRpdi5vZmZzZXRXaWR0aDtcbiAgY29uc3QgaGVpZ2h0ID0gZGl2Lm9mZnNldEhlaWdodDtcbiAgaWYgKGNhY2hlZFNpemUud2lkdGggIT09IHdpZHRoKSB7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCArICdweCcpO1xuICAgIG1haW5Xb3Jrc3BhY2Uuc2V0Q2FjaGVkUGFyZW50U3ZnU2l6ZSh3aWR0aCwgbnVsbCk7XG4gIH1cbiAgaWYgKGNhY2hlZFNpemUuaGVpZ2h0ICE9PSBoZWlnaHQpIHtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQgKyAncHgnKTtcbiAgICBtYWluV29ya3NwYWNlLnNldENhY2hlZFBhcmVudFN2Z1NpemUobnVsbCwgaGVpZ2h0KTtcbiAgfVxuICBtYWluV29ya3NwYWNlLnJlc2l6ZSgpO1xufVxuXG4vKipcbiAqIEFsbCBvZiB0aGUgY29ubmVjdGlvbnMgb24gYmxvY2tzIHRoYXQgYXJlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICovXG5leHBvcnQgY29uc3QgZHJhZ2dpbmdDb25uZWN0aW9uczogQ29ubmVjdGlvbltdID0gW107XG5cbi8qKlxuICogR2V0IGEgbWFwIG9mIGFsbCB0aGUgYmxvY2sncyBkZXNjZW5kYW50cyBtYXBwaW5nIHRoZWlyIHR5cGUgdG8gdGhlIG51bWJlciBvZlxuICogICAgY2hpbGRyZW4gd2l0aCB0aGF0IHR5cGUuXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBtYXAuXG4gKiBAcGFyYW0gb3B0X3N0cmlwRm9sbG93aW5nIE9wdGlvbmFsbHkgaWdub3JlIGFsbCBmb2xsb3dpbmdcbiAqICAgIHN0YXRlbWVudHMgKGJsb2NrcyB0aGF0IGFyZSBub3QgaW5zaWRlIGEgdmFsdWUgb3Igc3RhdGVtZW50IGlucHV0XG4gKiAgICBvZiB0aGUgYmxvY2spLlxuICogQHJldHVybnMgTWFwIG9mIHR5cGVzIHRvIHR5cGUgY291bnRzIGZvciBkZXNjZW5kYW50cyBvZiB0aGUgYm9jay5cbiAqIEBhbGlhcyBCbG9ja2x5LmNvbW1vbi5nZXRCbG9ja1R5cGVDb3VudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEJsb2NrVHlwZUNvdW50cyhcbiAgICBibG9jazogQmxvY2ssIG9wdF9zdHJpcEZvbGxvd2luZz86IGJvb2xlYW4pOiB7W2tleTogc3RyaW5nXTogbnVtYmVyfSB7XG4gIGNvbnN0IHR5cGVDb3VudHNNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBjb25zdCBkZXNjZW5kYW50cyA9IGJsb2NrLmdldERlc2NlbmRhbnRzKHRydWUpO1xuICBpZiAob3B0X3N0cmlwRm9sbG93aW5nKSB7XG4gICAgY29uc3QgbmV4dEJsb2NrID0gYmxvY2suZ2V0TmV4dEJsb2NrKCk7XG4gICAgaWYgKG5leHRCbG9jaykge1xuICAgICAgY29uc3QgaW5kZXggPSBkZXNjZW5kYW50cy5pbmRleE9mKG5leHRCbG9jayk7XG4gICAgICBkZXNjZW5kYW50cy5zcGxpY2UoaW5kZXgsIGRlc2NlbmRhbnRzLmxlbmd0aCAtIGluZGV4KTtcbiAgICB9XG4gIH1cbiAgZm9yIChsZXQgaSA9IDAsIGNoZWNrQmxvY2s7IGNoZWNrQmxvY2sgPSBkZXNjZW5kYW50c1tpXTsgaSsrKSB7XG4gICAgaWYgKHR5cGVDb3VudHNNYXBbY2hlY2tCbG9jay50eXBlXSkge1xuICAgICAgdHlwZUNvdW50c01hcFtjaGVja0Jsb2NrLnR5cGVdKys7XG4gICAgfSBlbHNlIHtcbiAgICAgIHR5cGVDb3VudHNNYXBbY2hlY2tCbG9jay50eXBlXSA9IDE7XG4gICAgfVxuICB9XG4gIHJldHVybiB0eXBlQ291bnRzTWFwO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiBmb3IgZGVmaW5pbmcgYSBibG9jayBmcm9tIEpTT04uICBUaGUgcmVzdWx0aW5nIGZ1bmN0aW9uIGhhc1xuICogdGhlIGNvcnJlY3QgdmFsdWUgb2YganNvbkRlZiBhdCB0aGUgcG9pbnQgaW4gY29kZSB3aGVyZSBqc29uSW5pdCBpcyBjYWxsZWQuXG4gKlxuICogQHBhcmFtIGpzb25EZWYgVGhlIEpTT04gZGVmaW5pdGlvbiBvZiBhIGJsb2NrLlxuICogQHJldHVybnMgQSBmdW5jdGlvbiB0aGF0IGNhbGxzIGpzb25Jbml0IHdpdGggdGhlIGNvcnJlY3QgdmFsdWVcbiAqICAgICBvZiBqc29uRGVmLlxuICovXG5mdW5jdGlvbiBqc29uSW5pdEZhY3RvcnkoanNvbkRlZjogQW55RHVyaW5nTWlncmF0aW9uKTogKCkgPT4gdm9pZCB7XG4gIHJldHVybiBmdW5jdGlvbih0aGlzOiBCbG9jaykge1xuICAgIHRoaXMuanNvbkluaXQoanNvbkRlZik7XG4gIH07XG59XG5cbi8qKlxuICogRGVmaW5lIGJsb2NrcyBmcm9tIGFuIGFycmF5IG9mIEpTT04gYmxvY2sgZGVmaW5pdGlvbnMsIGFzIG1pZ2h0IGJlIGdlbmVyYXRlZFxuICogYnkgdGhlIEJsb2NrbHkgRGV2ZWxvcGVyIFRvb2xzLlxuICpcbiAqIEBwYXJhbSBqc29uQXJyYXkgQW4gYXJyYXkgb2YgSlNPTiBibG9jayBkZWZpbml0aW9ucy5cbiAqIEBhbGlhcyBCbG9ja2x5LmNvbW1vbi5kZWZpbmVCbG9ja3NXaXRoSnNvbkFycmF5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVCbG9ja3NXaXRoSnNvbkFycmF5KGpzb25BcnJheTogQW55RHVyaW5nTWlncmF0aW9uW10pIHtcbiAgVEVTVF9PTkxZLmRlZmluZUJsb2Nrc1dpdGhKc29uQXJyYXlJbnRlcm5hbChqc29uQXJyYXkpO1xufVxuXG4vKipcbiAqIFByaXZhdGUgdmVyc2lvbiBvZiBkZWZpbmVCbG9ja3NXaXRoSnNvbkFycmF5IGZvciBzdHViYmluZyBpbiB0ZXN0cy5cbiAqL1xuZnVuY3Rpb24gZGVmaW5lQmxvY2tzV2l0aEpzb25BcnJheUludGVybmFsKGpzb25BcnJheTogQW55RHVyaW5nTWlncmF0aW9uW10pIHtcbiAgZGVmaW5lQmxvY2tzKGNyZWF0ZUJsb2NrRGVmaW5pdGlvbnNGcm9tSnNvbkFycmF5KGpzb25BcnJheSkpO1xufVxuXG4vKipcbiAqIERlZmluZSBibG9ja3MgZnJvbSBhbiBhcnJheSBvZiBKU09OIGJsb2NrIGRlZmluaXRpb25zLCBhcyBtaWdodCBiZSBnZW5lcmF0ZWRcbiAqIGJ5IHRoZSBCbG9ja2x5IERldmVsb3BlciBUb29scy5cbiAqXG4gKiBAcGFyYW0ganNvbkFycmF5IEFuIGFycmF5IG9mIEpTT04gYmxvY2sgZGVmaW5pdGlvbnMuXG4gKiBAcmV0dXJucyBBIG1hcCBvZiB0aGUgYmxvY2tcbiAqICAgICBkZWZpbml0aW9ucyBjcmVhdGVkLlxuICogQGFsaWFzIEJsb2NrbHkuY29tbW9uLmRlZmluZUJsb2Nrc1dpdGhKc29uQXJyYXlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUJsb2NrRGVmaW5pdGlvbnNGcm9tSnNvbkFycmF5KFxuICAgIGpzb25BcnJheTogQW55RHVyaW5nTWlncmF0aW9uW10pOiB7W2tleTogc3RyaW5nXTogQmxvY2tEZWZpbml0aW9ufSB7XG4gIGNvbnN0IGJsb2Nrczoge1trZXk6IHN0cmluZ106IEJsb2NrRGVmaW5pdGlvbn0gPSB7fTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBqc29uQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBlbGVtID0ganNvbkFycmF5W2ldO1xuICAgIGlmICghZWxlbSkge1xuICAgICAgY29uc29sZS53YXJuKGBCbG9jayBkZWZpbml0aW9uICMke2l9IGluIEpTT04gYXJyYXkgaXMgJHtlbGVtfS4gU2tpcHBpbmdgKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCB0eXBlID0gZWxlbVsndHlwZSddO1xuICAgIGlmICghdHlwZSkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIGBCbG9jayBkZWZpbml0aW9uICMke2l9IGluIEpTT04gYXJyYXkgaXMgbWlzc2luZyBhIHR5cGUgYXR0cmlidXRlLiBgICtcbiAgICAgICAgICAnU2tpcHBpbmcuJyk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgYmxvY2tzW3R5cGVdID0ge2luaXQ6IGpzb25Jbml0RmFjdG9yeShlbGVtKX07XG4gIH1cbiAgcmV0dXJuIGJsb2Nrcztcbn1cblxuLyoqXG4gKiBBZGQgdGhlIHNwZWNpZmllZCBibG9jayBkZWZpbml0aW9ucyB0byB0aGUgYmxvY2sgZGVmaW5pdGlvbnNcbiAqIGRpY3Rpb25hcnkgKEJsb2NrbHkuQmxvY2tzKS5cbiAqXG4gKiBAcGFyYW0gYmxvY2tzIEEgbWFwIG9mIGJsb2NrXG4gKiAgICAgdHlwZSBuYW1lcyB0byBibG9jayBkZWZpbml0aW9ucy5cbiAqIEBhbGlhcyBCbG9ja2x5LmNvbW1vbi5kZWZpbmVCbG9ja3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZmluZUJsb2NrcyhibG9ja3M6IHtba2V5OiBzdHJpbmddOiBCbG9ja0RlZmluaXRpb259KSB7XG4gIC8vIEl0ZXJhdGUgb3ZlciBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzLlxuICBmb3IgKGNvbnN0IHR5cGUgb2YgT2JqZWN0LmtleXMoYmxvY2tzKSkge1xuICAgIGNvbnN0IGRlZmluaXRpb24gPSBibG9ja3NbdHlwZV07XG4gICAgaWYgKHR5cGUgaW4gQmxvY2tzKSB7XG4gICAgICBjb25zb2xlLndhcm4oYEJsb2NrIGRlZmluaXRvbiBcIiR7dHlwZX1cIiBvdmVyd3JpdGVzIHByZXZpb3VzIGRlZmluaXRpb24uYCk7XG4gICAgfVxuICAgIEJsb2Nrc1t0eXBlXSA9IGRlZmluaXRpb247XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IHtkZWZpbmVCbG9ja3NXaXRoSnNvbkFycmF5SW50ZXJuYWx9O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3IgRE9NIG1hbmlwdWxhdGlvbi5cbiAqIFRoZXNlIG1ldGhvZHMgYXJlIG5vdCBzcGVjaWZpYyB0byBCbG9ja2x5LCBhbmQgY291bGQgYmUgZmFjdG9yZWQgb3V0IGludG9cbiAqIGEgSmF2YVNjcmlwdCBmcmFtZXdvcmsgc3VjaCBhcyBDbG9zdXJlLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS51dGlscy5kb21cbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5kb20nKTtcblxuaW1wb3J0IHR5cGUge1N2Z30gZnJvbSAnLi9zdmcuanMnO1xuXG5cbi8qKlxuICogUmVxdWlyZWQgbmFtZSBzcGFjZSBmb3IgU1ZHIGVsZW1lbnRzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5TVkdfTlNcbiAqL1xuZXhwb3J0IGNvbnN0IFNWR19OUyA9ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc7XG5cbi8qKlxuICogUmVxdWlyZWQgbmFtZSBzcGFjZSBmb3IgSFRNTCBlbGVtZW50cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5kb20uSFRNTF9OU1xuICovXG5leHBvcnQgY29uc3QgSFRNTF9OUyA9ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJztcblxuLyoqXG4gKiBSZXF1aXJlZCBuYW1lIHNwYWNlIGZvciBYTElOSyBlbGVtZW50cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5kb20uWExJTktfTlNcbiAqL1xuZXhwb3J0IGNvbnN0IFhMSU5LX05TID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnO1xuXG4vKipcbiAqIE5vZGUgdHlwZSBjb25zdGFudHMuXG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvTm9kZS9ub2RlVHlwZVxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5Ob2RlVHlwZVxuICovXG5leHBvcnQgZW51bSBOb2RlVHlwZSB7XG4gIEVMRU1FTlRfTk9ERSA9IDEsXG4gIFRFWFRfTk9ERSA9IDMsXG4gIENPTU1FTlRfTk9ERSA9IDgsXG4gIERPQ1VNRU5UX1BPU0lUSU9OX0NPTlRBSU5FRF9CWSA9IDE2XG59XG5cbi8qKiBUZW1wb3JhcnkgY2FjaGUgb2YgdGV4dCB3aWR0aHMuICovXG5sZXQgY2FjaGVXaWR0aHM6IHtba2V5OiBzdHJpbmddOiBudW1iZXJ9fG51bGwgPSBudWxsO1xuXG4vKiogTnVtYmVyIG9mIGN1cnJlbnQgcmVmZXJlbmNlcyB0byBjYWNoZS4gKi9cbmxldCBjYWNoZVJlZmVyZW5jZSA9IDA7XG5cbi8qKiBBIEhUTUwgY2FudmFzIGNvbnRleHQgdXNlZCBmb3IgY29tcHV0aW5nIHRleHQgd2lkdGguICovXG5sZXQgY2FudmFzQ29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfG51bGwgPSBudWxsO1xuXG4vKipcbiAqIEhlbHBlciBtZXRob2QgZm9yIGNyZWF0aW5nIFNWRyBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0gbmFtZSBFbGVtZW50J3MgdGFnIG5hbWUuXG4gKiBAcGFyYW0gYXR0cnMgRGljdGlvbmFyeSBvZiBhdHRyaWJ1dGUgbmFtZXMgYW5kIHZhbHVlcy5cbiAqIEBwYXJhbSBvcHRfcGFyZW50IE9wdGlvbmFsIHBhcmVudCBvbiB3aGljaCB0byBhcHBlbmQgdGhlIGVsZW1lbnQuXG4gKiBAcmV0dXJucyBpZiBuYW1lIGlzIGEgc3RyaW5nIG9yIGEgbW9yZSBzcGVjaWZpYyB0eXBlIGlmIGl0IGEgbWVtYmVyIG9mIFN2Zy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5jcmVhdGVTdmdFbGVtZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTdmdFbGVtZW50PFQgZXh0ZW5kcyBTVkdFbGVtZW50PihcbiAgICBuYW1lOiBzdHJpbmd8U3ZnPFQ+LCBhdHRyczoge1trZXk6IHN0cmluZ106IHN0cmluZ3xudW1iZXJ9LFxuICAgIG9wdF9wYXJlbnQ/OiBFbGVtZW50fG51bGwpOiBUIHtcbiAgY29uc3QgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsIFN0cmluZyhuYW1lKSkgYXMgVDtcbiAgZm9yIChjb25zdCBrZXkgaW4gYXR0cnMpIHtcbiAgICBlLnNldEF0dHJpYnV0ZShrZXksIGAke2F0dHJzW2tleV19YCk7XG4gIH1cbiAgaWYgKG9wdF9wYXJlbnQpIHtcbiAgICBvcHRfcGFyZW50LmFwcGVuZENoaWxkKGUpO1xuICB9XG4gIHJldHVybiBlO1xufVxuXG4vKipcbiAqIEFkZCBhIENTUyBjbGFzcyB0byBhIGVsZW1lbnQuXG4gKlxuICogSGFuZGxlcyBtdWx0aXBsZSBzcGFjZS1zZXBhcmF0ZWQgY2xhc3NlcyBmb3IgbGVnYWN5IHJlYXNvbnMuXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgRE9NIGVsZW1lbnQgdG8gYWRkIGNsYXNzIHRvLlxuICogQHBhcmFtIGNsYXNzTmFtZSBOYW1lIG9mIGNsYXNzIHRvIGFkZC5cbiAqIEByZXR1cm5zIFRydWUgaWYgY2xhc3Mgd2FzIGFkZGVkLCBmYWxzZSBpZiBhbHJlYWR5IHByZXNlbnQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5kb20uYWRkQ2xhc3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFkZENsYXNzKGVsZW1lbnQ6IEVsZW1lbnQsIGNsYXNzTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGNvbnN0IGNsYXNzTmFtZXMgPSBjbGFzc05hbWUuc3BsaXQoJyAnKTtcbiAgaWYgKGNsYXNzTmFtZXMuZXZlcnkoKG5hbWUpID0+IGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKG5hbWUpKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoLi4uY2xhc3NOYW1lcyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIFJlbW92ZXMgbXVsdGlwbGUgY2xhc3NlcyBmcm9tIGFuIGVsZW1lbnQuXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgRE9NIGVsZW1lbnQgdG8gcmVtb3ZlIGNsYXNzZXMgZnJvbS5cbiAqIEBwYXJhbSBjbGFzc05hbWVzIEEgc3RyaW5nIG9mIG9uZSBvciBtdWx0aXBsZSBjbGFzcyBuYW1lcyBmb3IgYW4gZWxlbWVudC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5yZW1vdmVDbGFzc2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVDbGFzc2VzKGVsZW1lbnQ6IEVsZW1lbnQsIGNsYXNzTmFtZXM6IHN0cmluZykge1xuICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoLi4uY2xhc3NOYW1lcy5zcGxpdCgnICcpKTtcbn1cblxuLyoqXG4gKiBSZW1vdmUgYSBDU1MgY2xhc3MgZnJvbSBhIGVsZW1lbnQuXG4gKlxuICogSGFuZGxlcyBtdWx0aXBsZSBzcGFjZS1zZXBhcmF0ZWQgY2xhc3NlcyBmb3IgbGVnYWN5IHJlYXNvbnMuXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgRE9NIGVsZW1lbnQgdG8gcmVtb3ZlIGNsYXNzIGZyb20uXG4gKiBAcGFyYW0gY2xhc3NOYW1lIE5hbWUgb2YgY2xhc3MgdG8gcmVtb3ZlLlxuICogQHJldHVybnMgVHJ1ZSBpZiBjbGFzcyB3YXMgcmVtb3ZlZCwgZmFsc2UgaWYgbmV2ZXIgcHJlc2VudC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5yZW1vdmVDbGFzc1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWxlbWVudDogRWxlbWVudCwgY2xhc3NOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgY2xhc3NOYW1lcyA9IGNsYXNzTmFtZS5zcGxpdCgnICcpO1xuICBpZiAoY2xhc3NOYW1lcy5ldmVyeSgobmFtZSkgPT4gIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKG5hbWUpKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoLi4uY2xhc3NOYW1lcyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIENoZWNrcyBpZiBhbiBlbGVtZW50IGhhcyB0aGUgc3BlY2lmaWVkIENTUyBjbGFzcy5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBET00gZWxlbWVudCB0byBjaGVjay5cbiAqIEBwYXJhbSBjbGFzc05hbWUgTmFtZSBvZiBjbGFzcyB0byBjaGVjay5cbiAqIEByZXR1cm5zIFRydWUgaWYgY2xhc3MgZXhpc3RzLCBmYWxzZSBvdGhlcndpc2UuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5kb20uaGFzQ2xhc3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhhc0NsYXNzKGVsZW1lbnQ6IEVsZW1lbnQsIGNsYXNzTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpO1xufVxuXG4vKipcbiAqIFJlbW92ZXMgYSBub2RlIGZyb20gaXRzIHBhcmVudC4gTm8tb3AgaWYgbm90IGF0dGFjaGVkIHRvIGEgcGFyZW50LlxuICpcbiAqIEBwYXJhbSBub2RlIFRoZSBub2RlIHRvIHJlbW92ZS5cbiAqIEByZXR1cm5zIFRoZSBub2RlIHJlbW92ZWQgaWYgcmVtb3ZlZDsgZWxzZSwgbnVsbC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5yZW1vdmVOb2RlXG4gKi9cbi8vIENvcGllZCBmcm9tIENsb3N1cmUgZ29vZy5kb20ucmVtb3ZlTm9kZVxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU5vZGUobm9kZTogTm9kZXxudWxsKTogTm9kZXxudWxsIHtcbiAgcmV0dXJuIG5vZGUgJiYgbm9kZS5wYXJlbnROb2RlID8gbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpIDogbnVsbDtcbn1cblxuLyoqXG4gKiBJbnNlcnQgYSBub2RlIGFmdGVyIGEgcmVmZXJlbmNlIG5vZGUuXG4gKiBDb250cmFzdCB3aXRoIG5vZGUuaW5zZXJ0QmVmb3JlIGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSBuZXdOb2RlIE5ldyBlbGVtZW50IHRvIGluc2VydC5cbiAqIEBwYXJhbSByZWZOb2RlIEV4aXN0aW5nIGVsZW1lbnQgdG8gcHJlY2VkZSBuZXcgbm9kZS5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5pbnNlcnRBZnRlclxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0QWZ0ZXIobmV3Tm9kZTogRWxlbWVudCwgcmVmTm9kZTogRWxlbWVudCkge1xuICBjb25zdCBzaWJsaW5nTm9kZSA9IHJlZk5vZGUubmV4dFNpYmxpbmc7XG4gIGNvbnN0IHBhcmVudE5vZGUgPSByZWZOb2RlLnBhcmVudE5vZGU7XG4gIGlmICghcGFyZW50Tm9kZSkge1xuICAgIHRocm93IEVycm9yKCdSZWZlcmVuY2Ugbm9kZSBoYXMgbm8gcGFyZW50LicpO1xuICB9XG4gIGlmIChzaWJsaW5nTm9kZSkge1xuICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld05vZGUsIHNpYmxpbmdOb2RlKTtcbiAgfSBlbHNlIHtcbiAgICBwYXJlbnROb2RlLmFwcGVuZENoaWxkKG5ld05vZGUpO1xuICB9XG59XG5cbi8qKlxuICogV2hldGhlciBhIG5vZGUgY29udGFpbnMgYW5vdGhlciBub2RlLlxuICpcbiAqIEBwYXJhbSBwYXJlbnQgVGhlIG5vZGUgdGhhdCBzaG91bGQgY29udGFpbiB0aGUgb3RoZXIgbm9kZS5cbiAqIEBwYXJhbSBkZXNjZW5kYW50IFRoZSBub2RlIHRvIHRlc3QgcHJlc2VuY2Ugb2YuXG4gKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBwYXJlbnQgbm9kZSBjb250YWlucyB0aGUgZGVzY2VuZGFudCBub2RlLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZG9tLmNvbnRhaW5zTm9kZVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29udGFpbnNOb2RlKHBhcmVudDogTm9kZSwgZGVzY2VuZGFudDogTm9kZSk6IGJvb2xlYW4ge1xuICByZXR1cm4gISEoXG4gICAgICBwYXJlbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24oZGVzY2VuZGFudCkgJlxuICAgICAgTm9kZVR5cGUuRE9DVU1FTlRfUE9TSVRJT05fQ09OVEFJTkVEX0JZKTtcbn1cblxuLyoqXG4gKiBTZXRzIHRoZSBDU1MgdHJhbnNmb3JtIHByb3BlcnR5IG9uIGFuIGVsZW1lbnQuIFRoaXMgZnVuY3Rpb24gc2V0cyB0aGVcbiAqIG5vbi12ZW5kb3ItcHJlZml4ZWQgYW5kIHZlbmRvci1wcmVmaXhlZCB2ZXJzaW9ucyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHlcbiAqIHdpdGggb2xkZXIgYnJvd3NlcnMuIFNlZSBodHRwczovL2Nhbml1c2UuY29tLyNmZWF0PXRyYW5zZm9ybXMyZFxuICpcbiAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgdG8gd2hpY2ggdGhlIENTUyB0cmFuc2Zvcm0gd2lsbCBiZSBhcHBsaWVkLlxuICogQHBhcmFtIHRyYW5zZm9ybSBUaGUgdmFsdWUgb2YgdGhlIENTUyBgdHJhbnNmb3JtYCBwcm9wZXJ0eS5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5zZXRDc3NUcmFuc2Zvcm1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENzc1RyYW5zZm9ybShcbiAgICBlbGVtZW50OiBIVE1MRWxlbWVudHxTVkdFbGVtZW50LCB0cmFuc2Zvcm06IHN0cmluZykge1xuICBlbGVtZW50LnN0eWxlWyd0cmFuc2Zvcm0nXSA9IHRyYW5zZm9ybTtcbiAgZWxlbWVudC5zdHlsZVsnLXdlYmtpdC10cmFuc2Zvcm0nIGFzIGFueV0gPSB0cmFuc2Zvcm07XG59XG5cbi8qKlxuICogU3RhcnQgY2FjaGluZyB0ZXh0IHdpZHRocy4gRXZlcnkgY2FsbCB0byB0aGlzIGZ1bmN0aW9uIE1VU1QgYWxzbyBjYWxsXG4gKiBzdG9wVGV4dFdpZHRoQ2FjaGUuIENhY2hlcyBtdXN0IG5vdCBzdXJ2aXZlIGJldHdlZW4gZXhlY3V0aW9uIHRocmVhZHMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZG9tLnN0YXJ0VGV4dFdpZHRoQ2FjaGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0VGV4dFdpZHRoQ2FjaGUoKSB7XG4gIGNhY2hlUmVmZXJlbmNlKys7XG4gIGlmICghY2FjaGVXaWR0aHMpIHtcbiAgICBjYWNoZVdpZHRocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIH1cbn1cblxuLyoqXG4gKiBTdG9wIGNhY2hpbmcgZmllbGQgd2lkdGhzLiBVbmxlc3MgY2FjaGluZyB3YXMgYWxyZWFkeSBvbiB3aGVuIHRoZVxuICogY29ycmVzcG9uZGluZyBjYWxsIHRvIHN0YXJ0VGV4dFdpZHRoQ2FjaGUgd2FzIG1hZGUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZG9tLnN0b3BUZXh0V2lkdGhDYWNoZVxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RvcFRleHRXaWR0aENhY2hlKCkge1xuICBjYWNoZVJlZmVyZW5jZS0tO1xuICBpZiAoIWNhY2hlUmVmZXJlbmNlKSB7XG4gICAgY2FjaGVXaWR0aHMgPSBudWxsO1xuICB9XG59XG5cbi8qKlxuICogR2V0cyB0aGUgd2lkdGggb2YgYSB0ZXh0IGVsZW1lbnQsIGNhY2hpbmcgaXQgaW4gdGhlIHByb2Nlc3MuXG4gKlxuICogQHBhcmFtIHRleHRFbGVtZW50IEFuIFNWRyAndGV4dCcgZWxlbWVudC5cbiAqIEByZXR1cm5zIFdpZHRoIG9mIGVsZW1lbnQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5kb20uZ2V0VGV4dFdpZHRoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRUZXh0V2lkdGgodGV4dEVsZW1lbnQ6IFNWR1RleHRFbGVtZW50KTogbnVtYmVyIHtcbiAgY29uc3Qga2V5ID0gdGV4dEVsZW1lbnQudGV4dENvbnRlbnQgKyAnXFxuJyArIHRleHRFbGVtZW50LmNsYXNzTmFtZS5iYXNlVmFsO1xuICBsZXQgd2lkdGg7XG4gIC8vIFJldHVybiB0aGUgY2FjaGVkIHdpZHRoIGlmIGl0IGV4aXN0cy5cbiAgaWYgKGNhY2hlV2lkdGhzKSB7XG4gICAgd2lkdGggPSBjYWNoZVdpZHRoc1trZXldO1xuICAgIGlmICh3aWR0aCkge1xuICAgICAgcmV0dXJuIHdpZHRoO1xuICAgIH1cbiAgfVxuXG4gIC8vIEF0dGVtcHQgdG8gY29tcHV0ZSBmZXRjaCB0aGUgd2lkdGggb2YgdGhlIFNWRyB0ZXh0IGVsZW1lbnQuXG4gIHRyeSB7XG4gICAgd2lkdGggPSB0ZXh0RWxlbWVudC5nZXRDb21wdXRlZFRleHRMZW5ndGgoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIEluIG90aGVyIGNhc2VzIHdoZXJlIHdlIGZhaWwgdG8gZ2V0IHRoZSBjb21wdXRlZCB0ZXh0LiBJbnN0ZWFkLCB1c2UgYW5cbiAgICAvLyBhcHByb3hpbWF0aW9uIGFuZCBkbyBub3QgY2FjaGUgdGhlIHJlc3VsdC4gQXQgc29tZSBsYXRlciBwb2ludCBpbiB0aW1lXG4gICAgLy8gd2hlbiB0aGUgYmxvY2sgaXMgaW5zZXJ0ZWQgaW50byB0aGUgdmlzaWJsZSBET00sIHRoaXMgbWV0aG9kIHdpbGwgYmVcbiAgICAvLyBjYWxsZWQgYWdhaW4gYW5kLCBhdCB0aGF0IHBvaW50IGluIHRpbWUsIHdpbGwgbm90IHRocm93IGFuIGV4Y2VwdGlvbi5cbiAgICByZXR1cm4gdGV4dEVsZW1lbnQudGV4dENvbnRlbnQhLmxlbmd0aCAqIDg7XG4gIH1cblxuICAvLyBDYWNoZSB0aGUgY29tcHV0ZWQgd2lkdGggYW5kIHJldHVybi5cbiAgaWYgKGNhY2hlV2lkdGhzKSB7XG4gICAgY2FjaGVXaWR0aHNba2V5XSA9IHdpZHRoO1xuICB9XG4gIHJldHVybiB3aWR0aDtcbn1cblxuLyoqXG4gKiBHZXRzIHRoZSB3aWR0aCBvZiBhIHRleHQgZWxlbWVudCB1c2luZyBhIGZhc3RlciBtZXRob2QgdGhhbiBgZ2V0VGV4dFdpZHRoYC5cbiAqIFRoaXMgbWV0aG9kIHJlcXVpcmVzIHRoYXQgd2Uga25vdyB0aGUgdGV4dCBlbGVtZW50J3MgZm9udCBmYW1pbHkgYW5kIHNpemUgaW5cbiAqIGFkdmFuY2UuIFNpbWlsYXIgdG8gYGdldFRleHRXaWR0aGAsIHdlIGNhY2hlIHRoZSB3aWR0aCB3ZSBjb21wdXRlLlxuICpcbiAqIEBwYXJhbSB0ZXh0RWxlbWVudCBBbiBTVkcgJ3RleHQnIGVsZW1lbnQuXG4gKiBAcGFyYW0gZm9udFNpemUgVGhlIGZvbnQgc2l6ZSB0byB1c2UuXG4gKiBAcGFyYW0gZm9udFdlaWdodCBUaGUgZm9udCB3ZWlnaHQgdG8gdXNlLlxuICogQHBhcmFtIGZvbnRGYW1pbHkgVGhlIGZvbnQgZmFtaWx5IHRvIHVzZS5cbiAqIEByZXR1cm5zIFdpZHRoIG9mIGVsZW1lbnQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5kb20uZ2V0RmFzdFRleHRXaWR0aFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmFzdFRleHRXaWR0aChcbiAgICB0ZXh0RWxlbWVudDogU1ZHVGV4dEVsZW1lbnQsIGZvbnRTaXplOiBudW1iZXIsIGZvbnRXZWlnaHQ6IHN0cmluZyxcbiAgICBmb250RmFtaWx5OiBzdHJpbmcpOiBudW1iZXIge1xuICByZXR1cm4gZ2V0RmFzdFRleHRXaWR0aFdpdGhTaXplU3RyaW5nKFxuICAgICAgdGV4dEVsZW1lbnQsIGZvbnRTaXplICsgJ3B0JywgZm9udFdlaWdodCwgZm9udEZhbWlseSk7XG59XG5cbi8qKlxuICogR2V0cyB0aGUgd2lkdGggb2YgYSB0ZXh0IGVsZW1lbnQgdXNpbmcgYSBmYXN0ZXIgbWV0aG9kIHRoYW4gYGdldFRleHRXaWR0aGAuXG4gKiBUaGlzIG1ldGhvZCByZXF1aXJlcyB0aGF0IHdlIGtub3cgdGhlIHRleHQgZWxlbWVudCdzIGZvbnQgZmFtaWx5IGFuZCBzaXplIGluXG4gKiBhZHZhbmNlLiBTaW1pbGFyIHRvIGBnZXRUZXh0V2lkdGhgLCB3ZSBjYWNoZSB0aGUgd2lkdGggd2UgY29tcHV0ZS5cbiAqIFRoaXMgbWV0aG9kIGlzIHNpbWlsYXIgdG8gYGdldEZhc3RUZXh0V2lkdGhgIGJ1dCBleHBlY3RzIHRoZSBmb250IHNpemVcbiAqIHBhcmFtZXRlciB0byBiZSBhIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0gdGV4dEVsZW1lbnQgQW4gU1ZHICd0ZXh0JyBlbGVtZW50LlxuICogQHBhcmFtIGZvbnRTaXplIFRoZSBmb250IHNpemUgdG8gdXNlLlxuICogQHBhcmFtIGZvbnRXZWlnaHQgVGhlIGZvbnQgd2VpZ2h0IHRvIHVzZS5cbiAqIEBwYXJhbSBmb250RmFtaWx5IFRoZSBmb250IGZhbWlseSB0byB1c2UuXG4gKiBAcmV0dXJucyBXaWR0aCBvZiBlbGVtZW50LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZG9tLmdldEZhc3RUZXh0V2lkdGhXaXRoU2l6ZVN0cmluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmFzdFRleHRXaWR0aFdpdGhTaXplU3RyaW5nKFxuICAgIHRleHRFbGVtZW50OiBTVkdUZXh0RWxlbWVudCwgZm9udFNpemU6IHN0cmluZywgZm9udFdlaWdodDogc3RyaW5nLFxuICAgIGZvbnRGYW1pbHk6IHN0cmluZyk6IG51bWJlciB7XG4gIGNvbnN0IHRleHQgPSB0ZXh0RWxlbWVudC50ZXh0Q29udGVudDtcbiAgY29uc3Qga2V5ID0gdGV4dCArICdcXG4nICsgdGV4dEVsZW1lbnQuY2xhc3NOYW1lLmJhc2VWYWw7XG4gIGxldCB3aWR0aDtcblxuICAvLyBSZXR1cm4gdGhlIGNhY2hlZCB3aWR0aCBpZiBpdCBleGlzdHMuXG4gIGlmIChjYWNoZVdpZHRocykge1xuICAgIHdpZHRoID0gY2FjaGVXaWR0aHNba2V5XTtcbiAgICBpZiAod2lkdGgpIHtcbiAgICAgIHJldHVybiB3aWR0aDtcbiAgICB9XG4gIH1cblxuICBpZiAoIWNhbnZhc0NvbnRleHQpIHtcbiAgICAvLyBJbmplY3QgdGhlIGNhbnZhcyBlbGVtZW50IHVzZWQgZm9yIGNvbXB1dGluZyB0ZXh0IHdpZHRocy5cbiAgICBjb25zdCBjb21wdXRlQ2FudmFzID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpKTtcbiAgICBjb21wdXRlQ2FudmFzLmNsYXNzTmFtZSA9ICdibG9ja2x5Q29tcHV0ZUNhbnZhcyc7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb21wdXRlQ2FudmFzKTtcblxuICAgIC8vIEluaXRpYWxpemUgdGhlIEhUTUwgY2FudmFzIGNvbnRleHQgYW5kIHNldCB0aGUgZm9udC5cbiAgICAvLyBUaGUgY29udGV4dCBmb250IG11c3QgbWF0Y2ggYmxvY2tseVRleHQncyBmb250c2l6ZSBhbmQgZm9udC1mYW1pbHlcbiAgICAvLyBzZXQgaW4gQ1NTLlxuICAgIGNhbnZhc0NvbnRleHQgPSBjb21wdXRlQ2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuICB9XG4gIC8vIFNldCB0aGUgZGVzaXJlZCBmb250IHNpemUgYW5kIGZhbWlseS5cbiAgY2FudmFzQ29udGV4dC5mb250ID0gZm9udFdlaWdodCArICcgJyArIGZvbnRTaXplICsgJyAnICsgZm9udEZhbWlseTtcblxuICAvLyBNZWFzdXJlIHRoZSB0ZXh0IHdpZHRoIHVzaW5nIHRoZSBoZWxwZXIgY2FudmFzIGNvbnRleHQuXG4gIGlmICh0ZXh0KSB7XG4gICAgd2lkdGggPSBjYW52YXNDb250ZXh0Lm1lYXN1cmVUZXh0KHRleHQpLndpZHRoO1xuICB9IGVsc2Uge1xuICAgIHdpZHRoID0gMDtcbiAgfVxuXG4gIC8vIENhY2hlIHRoZSBjb21wdXRlZCB3aWR0aCBhbmQgcmV0dXJuLlxuICBpZiAoY2FjaGVXaWR0aHMpIHtcbiAgICBjYWNoZVdpZHRoc1trZXldID0gd2lkdGg7XG4gIH1cbiAgcmV0dXJuIHdpZHRoO1xufVxuXG4vKipcbiAqIE1lYXN1cmUgYSBmb250J3MgbWV0cmljcy4gVGhlIGhlaWdodCBhbmQgYmFzZWxpbmUgdmFsdWVzLlxuICpcbiAqIEBwYXJhbSB0ZXh0IFRleHQgdG8gbWVhc3VyZSB0aGUgZm9udCBkaW1lbnNpb25zIG9mLlxuICogQHBhcmFtIGZvbnRTaXplIFRoZSBmb250IHNpemUgdG8gdXNlLlxuICogQHBhcmFtIGZvbnRXZWlnaHQgVGhlIGZvbnQgd2VpZ2h0IHRvIHVzZS5cbiAqIEBwYXJhbSBmb250RmFtaWx5IFRoZSBmb250IGZhbWlseSB0byB1c2UuXG4gKiBAcmV0dXJucyBGb250IG1lYXN1cmVtZW50cy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmRvbS5tZWFzdXJlRm9udE1ldHJpY3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lYXN1cmVGb250TWV0cmljcyhcbiAgICB0ZXh0OiBzdHJpbmcsIGZvbnRTaXplOiBzdHJpbmcsIGZvbnRXZWlnaHQ6IHN0cmluZyxcbiAgICBmb250RmFtaWx5OiBzdHJpbmcpOiB7aGVpZ2h0OiBudW1iZXIsIGJhc2VsaW5lOiBudW1iZXJ9IHtcbiAgY29uc3Qgc3BhbiA9IChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykpO1xuICBzcGFuLnN0eWxlLmZvbnQgPSBmb250V2VpZ2h0ICsgJyAnICsgZm9udFNpemUgKyAnICcgKyBmb250RmFtaWx5O1xuICBzcGFuLnRleHRDb250ZW50ID0gdGV4dDtcblxuICBjb25zdCBibG9jayA9IChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XG4gIGJsb2NrLnN0eWxlLndpZHRoID0gJzFweCc7XG4gIGJsb2NrLnN0eWxlLmhlaWdodCA9ICcwJztcblxuICBjb25zdCBkaXYgPSAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICBkaXYuc2V0QXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogZml4ZWQ7IHRvcDogMDsgbGVmdDogMDsgZGlzcGxheTogZmxleDsnKTtcbiAgZGl2LmFwcGVuZENoaWxkKHNwYW4pO1xuICBkaXYuYXBwZW5kQ2hpbGQoYmxvY2spO1xuXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIGhlaWdodDogMCxcbiAgICBiYXNlbGluZTogMCxcbiAgfTtcbiAgdHJ5IHtcbiAgICBkaXYuc3R5bGUuYWxpZ25JdGVtcyA9ICdiYXNlbGluZSc7XG4gICAgcmVzdWx0LmJhc2VsaW5lID0gYmxvY2sub2Zmc2V0VG9wIC0gc3Bhbi5vZmZzZXRUb3A7XG4gICAgZGl2LnN0eWxlLmFsaWduSXRlbXMgPSAnZmxleC1lbmQnO1xuICAgIHJlc3VsdC5oZWlnaHQgPSBibG9jay5vZmZzZXRUb3AgLSBzcGFuLm9mZnNldFRvcDtcbiAgfSBmaW5hbGx5IHtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRpdik7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IG1ldGhvZHMgZm9yIG1hdGguXG4gKiBUaGVzZSBtZXRob2RzIGFyZSBub3Qgc3BlY2lmaWMgdG8gQmxvY2tseSwgYW5kIGNvdWxkIGJlIGZhY3RvcmVkIG91dCBpbnRvXG4gKiBhIEphdmFTY3JpcHQgZnJhbWV3b3JrIHN1Y2ggYXMgQ2xvc3VyZS5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMubWF0aFxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnV0aWxzLm1hdGgnKTtcblxuXG4vKipcbiAqIENvbnZlcnRzIGRlZ3JlZXMgdG8gcmFkaWFucy5cbiAqIENvcGllZCBmcm9tIENsb3N1cmUncyBnb29nLm1hdGgudG9SYWRpYW5zLlxuICpcbiAqIEBwYXJhbSBhbmdsZURlZ3JlZXMgQW5nbGUgaW4gZGVncmVlcy5cbiAqIEByZXR1cm5zIEFuZ2xlIGluIHJhZGlhbnMuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5tYXRoLnRvUmFkaWFuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdG9SYWRpYW5zKGFuZ2xlRGVncmVlczogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIGFuZ2xlRGVncmVlcyAqIE1hdGguUEkgLyAxODA7XG59XG5cbi8qKlxuICogQ29udmVydHMgcmFkaWFucyB0byBkZWdyZWVzLlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cubWF0aC50b0RlZ3JlZXMuXG4gKlxuICogQHBhcmFtIGFuZ2xlUmFkaWFucyBBbmdsZSBpbiByYWRpYW5zLlxuICogQHJldHVybnMgQW5nbGUgaW4gZGVncmVlcy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLm1hdGgudG9EZWdyZWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b0RlZ3JlZXMoYW5nbGVSYWRpYW5zOiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gYW5nbGVSYWRpYW5zICogMTgwIC8gTWF0aC5QSTtcbn1cblxuLyoqXG4gKiBDbGFtcCB0aGUgcHJvdmlkZWQgbnVtYmVyIGJldHdlZW4gdGhlIGxvd2VyIGJvdW5kIGFuZCB0aGUgdXBwZXIgYm91bmQuXG4gKlxuICogQHBhcmFtIGxvd2VyQm91bmQgVGhlIGRlc2lyZWQgbG93ZXIgYm91bmQuXG4gKiBAcGFyYW0gbnVtYmVyIFRoZSBudW1iZXIgdG8gY2xhbXAuXG4gKiBAcGFyYW0gdXBwZXJCb3VuZCBUaGUgZGVzaXJlZCB1cHBlciBib3VuZC5cbiAqIEByZXR1cm5zIFRoZSBjbGFtcGVkIG51bWJlci5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLm1hdGguY2xhbXBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsYW1wKFxuICAgIGxvd2VyQm91bmQ6IG51bWJlciwgbnVtYmVyOiBudW1iZXIsIHVwcGVyQm91bmQ6IG51bWJlcik6IG51bWJlciB7XG4gIGlmICh1cHBlckJvdW5kIDwgbG93ZXJCb3VuZCkge1xuICAgIGNvbnN0IHRlbXAgPSB1cHBlckJvdW5kO1xuICAgIHVwcGVyQm91bmQgPSBsb3dlckJvdW5kO1xuICAgIGxvd2VyQm91bmQgPSB0ZW1wO1xuICB9XG4gIHJldHVybiBNYXRoLm1heChsb3dlckJvdW5kLCBNYXRoLm1pbihudW1iZXIsIHVwcGVyQm91bmQpKTtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXRpZXMgZm9yIGVsZW1lbnQgc3R5bGVzLlxuICogVGhlc2UgbWV0aG9kcyBhcmUgbm90IHNwZWNpZmljIHRvIEJsb2NrbHksIGFuZCBjb3VsZCBiZSBmYWN0b3JlZCBvdXQgaW50b1xuICogYSBKYXZhU2NyaXB0IGZyYW1ld29yayBzdWNoIGFzIENsb3N1cmUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnV0aWxzLnN0eWxlXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMuc3R5bGUnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQge1JlY3R9IGZyb20gJy4vcmVjdC5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vc2l6ZS5qcyc7XG5cblxuLyoqXG4gKiBHZXRzIHRoZSBoZWlnaHQgYW5kIHdpZHRoIG9mIGFuIGVsZW1lbnQuXG4gKiBTaW1pbGFyIHRvIENsb3N1cmUncyBnb29nLnN0eWxlLmdldFNpemVcbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRvIGdldCBzaXplIG9mLlxuICogQHJldHVybnMgT2JqZWN0IHdpdGggd2lkdGgvaGVpZ2h0IHByb3BlcnRpZXMuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdHlsZS5nZXRTaXplXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTaXplKGVsZW1lbnQ6IEVsZW1lbnQpOiBTaXplIHtcbiAgcmV0dXJuIFRFU1RfT05MWS5nZXRTaXplSW50ZXJuYWwoZWxlbWVudCk7XG59XG5cbi8qKlxuICogUHJpdmF0ZSB2ZXJzaW9uIG9mIGdldFNpemUgZm9yIHN0dWJiaW5nIGluIHRlc3RzLlxuICovXG5mdW5jdGlvbiBnZXRTaXplSW50ZXJuYWwoZWxlbWVudDogRWxlbWVudCk6IFNpemUge1xuICBpZiAoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCAnZGlzcGxheScpICE9PSAnbm9uZScpIHtcbiAgICByZXR1cm4gZ2V0U2l6ZVdpdGhEaXNwbGF5KGVsZW1lbnQpO1xuICB9XG5cbiAgLy8gRXZhbHVhdGUgc2l6ZSB3aXRoIGEgdGVtcG9yYXJ5IGVsZW1lbnQuXG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ3N0eWxlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gIC8vICdFbGVtZW50Jy5cbiAgY29uc3Qgc3R5bGUgPSAoZWxlbWVudCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnN0eWxlO1xuICBjb25zdCBvcmlnaW5hbERpc3BsYXkgPSBzdHlsZS5kaXNwbGF5O1xuICBjb25zdCBvcmlnaW5hbFZpc2liaWxpdHkgPSBzdHlsZS52aXNpYmlsaXR5O1xuICBjb25zdCBvcmlnaW5hbFBvc2l0aW9uID0gc3R5bGUucG9zaXRpb247XG5cbiAgc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuICBzdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gIHN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJztcblxuICBjb25zdCBvZmZzZXRXaWR0aCA9IChlbGVtZW50IGFzIEhUTUxFbGVtZW50KS5vZmZzZXRXaWR0aDtcbiAgY29uc3Qgb2Zmc2V0SGVpZ2h0ID0gKGVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpLm9mZnNldEhlaWdodDtcblxuICBzdHlsZS5kaXNwbGF5ID0gb3JpZ2luYWxEaXNwbGF5O1xuICBzdHlsZS5wb3NpdGlvbiA9IG9yaWdpbmFsUG9zaXRpb247XG4gIHN0eWxlLnZpc2liaWxpdHkgPSBvcmlnaW5hbFZpc2liaWxpdHk7XG5cbiAgcmV0dXJuIG5ldyBTaXplKG9mZnNldFdpZHRoLCBvZmZzZXRIZWlnaHQpO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIGhlaWdodCBhbmQgd2lkdGggb2YgYW4gZWxlbWVudCB3aGVuIHRoZSBkaXNwbGF5IGlzIG5vdCBub25lLlxuICpcbiAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgdG8gZ2V0IHNpemUgb2YuXG4gKiBAcmV0dXJucyBPYmplY3Qgd2l0aCB3aWR0aC9oZWlnaHQgcHJvcGVydGllcy5cbiAqL1xuZnVuY3Rpb24gZ2V0U2l6ZVdpdGhEaXNwbGF5KGVsZW1lbnQ6IEVsZW1lbnQpOiBTaXplIHtcbiAgY29uc3Qgb2Zmc2V0V2lkdGggPSAoZWxlbWVudCBhcyBIVE1MRWxlbWVudCkub2Zmc2V0V2lkdGg7XG4gIGNvbnN0IG9mZnNldEhlaWdodCA9IChlbGVtZW50IGFzIEhUTUxFbGVtZW50KS5vZmZzZXRIZWlnaHQ7XG4gIHJldHVybiBuZXcgU2l6ZShvZmZzZXRXaWR0aCwgb2Zmc2V0SGVpZ2h0KTtcbn1cblxuLyoqXG4gKiBSZXRyaWV2ZXMgYSBjb21wdXRlZCBzdHlsZSB2YWx1ZSBvZiBhIG5vZGUuIEl0IHJldHVybnMgZW1wdHkgc3RyaW5nXG4gKiBpZiB0aGUgcHJvcGVydHkgcmVxdWVzdGVkIGlzIGFuIFNWRyBvbmUgYW5kIGl0IGhhcyBub3QgYmVlblxuICogZXhwbGljaXRseSBzZXQgKGZpcmVmb3ggYW5kIHdlYmtpdCkuXG4gKlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuc3R5bGUuZ2V0Q29tcHV0ZWRTdHlsZVxuICpcbiAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgdG8gZ2V0IHN0eWxlIG9mLlxuICogQHBhcmFtIHByb3BlcnR5IFByb3BlcnR5IHRvIGdldCAoY2FtZWwtY2FzZSkuXG4gKiBAcmV0dXJucyBTdHlsZSB2YWx1ZS5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0eWxlLmdldENvbXB1dGVkU3R5bGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXB1dGVkU3R5bGUoZWxlbWVudDogRWxlbWVudCwgcHJvcGVydHk6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuICAvLyBlbGVtZW50LnN0eWxlWy4uXSBpcyB1bmRlZmluZWQgZm9yIGJyb3dzZXIgc3BlY2lmaWMgc3R5bGVzXG4gIC8vIGFzICdmaWx0ZXInLlxuICByZXR1cm4gKHN0eWxlcyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pW3Byb3BlcnR5XSB8fFxuICAgICAgc3R5bGVzLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHkpO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIGNhc2NhZGVkIHN0eWxlIHZhbHVlIG9mIGEgbm9kZSwgb3IgbnVsbCBpZiB0aGUgdmFsdWUgY2Fubm90IGJlXG4gKiBjb21wdXRlZCAob25seSBJbnRlcm5ldCBFeHBsb3JlciBjYW4gZG8gdGhpcykuXG4gKlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuc3R5bGUuZ2V0Q2FzY2FkZWRTdHlsZVxuICpcbiAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgdG8gZ2V0IHN0eWxlIG9mLlxuICogQHBhcmFtIHN0eWxlIFByb3BlcnR5IHRvIGdldCAoY2FtZWwtY2FzZSkuXG4gKiBAcmV0dXJucyBTdHlsZSB2YWx1ZS5cbiAqIEBkZXByZWNhdGVkIE5vIGxvbmdlciBwcm92aWRlZCBieSBCbG9ja2x5LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3R5bGUuZ2V0Q2FzY2FkZWRTdHlsZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FzY2FkZWRTdHlsZShlbGVtZW50OiBFbGVtZW50LCBzdHlsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLnN0eWxlLmdldENhc2NhZGVkU3R5bGUnLCAndmVyc2lvbiA5JywgJ3ZlcnNpb24gMTAnKTtcbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnY3VycmVudFN0eWxlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gIC8vICdFbGVtZW50Jy4gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnY3VycmVudFN0eWxlJyBkb2VzIG5vdFxuICAvLyBleGlzdCBvbiB0eXBlICdFbGVtZW50Jy5cbiAgcmV0dXJuIChlbGVtZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY3VycmVudFN0eWxlID9cbiAgICAgIChlbGVtZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY3VycmVudFN0eWxlW3N0eWxlXSA6XG4gICAgICAnJyBhcyBzdHJpbmc7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIENvb3JkaW5hdGUgb2JqZWN0IHJlbGF0aXZlIHRvIHRoZSB0b3AtbGVmdCBvZiB0aGUgSFRNTCBkb2N1bWVudC5cbiAqIFNpbWlsYXIgdG8gQ2xvc3VyZSdzIGdvb2cuc3R5bGUuZ2V0UGFnZU9mZnNldFxuICpcbiAqIEBwYXJhbSBlbCBFbGVtZW50IHRvIGdldCB0aGUgcGFnZSBvZmZzZXQgZm9yLlxuICogQHJldHVybnMgVGhlIHBhZ2Ugb2Zmc2V0LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3R5bGUuZ2V0UGFnZU9mZnNldFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFnZU9mZnNldChlbDogRWxlbWVudCk6IENvb3JkaW5hdGUge1xuICBjb25zdCBwb3MgPSBuZXcgQ29vcmRpbmF0ZSgwLCAwKTtcbiAgY29uc3QgYm94ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIGNvbnN0IGRvY3VtZW50RWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgLy8gTXVzdCBhZGQgdGhlIHNjcm9sbCBjb29yZGluYXRlcyBpbiB0byBnZXQgdGhlIGFic29sdXRlIHBhZ2Ugb2Zmc2V0XG4gIC8vIG9mIGVsZW1lbnQgc2luY2UgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IHJldHVybnMgcmVsYXRpdmUgY29vcmRpbmF0ZXMgdG9cbiAgLy8gdGhlIHZpZXdwb3J0LlxuICBjb25zdCBzY3JvbGxDb29yZCA9IG5ldyBDb29yZGluYXRlKFxuICAgICAgd2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0LFxuICAgICAgd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApO1xuICBwb3MueCA9IGJveC5sZWZ0ICsgc2Nyb2xsQ29vcmQueDtcbiAgcG9zLnkgPSBib3gudG9wICsgc2Nyb2xsQ29vcmQueTtcblxuICByZXR1cm4gcG9zO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHZpZXdwb3J0IGNvb3JkaW5hdGVzIHJlbGF0aXZlIHRvIHRoZSBkb2N1bWVudC5cbiAqIFNpbWlsYXIgdG8gQ2xvc3VyZSdzIGdvb2cuc3R5bGUuZ2V0Vmlld3BvcnRQYWdlT2Zmc2V0XG4gKlxuICogQHJldHVybnMgVGhlIHBhZ2Ugb2Zmc2V0IG9mIHRoZSB2aWV3cG9ydC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0eWxlLmdldFZpZXdwb3J0UGFnZU9mZnNldFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Vmlld3BvcnRQYWdlT2Zmc2V0KCk6IENvb3JkaW5hdGUge1xuICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcbiAgY29uc3QgZG9jdW1lbnRFbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICBjb25zdCBzY3JvbGxMZWZ0ID0gYm9keS5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0O1xuICBjb25zdCBzY3JvbGxUb3AgPSBib2R5LnNjcm9sbFRvcCB8fCBkb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICByZXR1cm4gbmV3IENvb3JkaW5hdGUoc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wKTtcbn1cblxuLyoqXG4gKiBHZXRzIHRoZSBjb21wdXRlZCBib3JkZXIgd2lkdGhzIChvbiBhbGwgc2lkZXMpIGluIHBpeGVsc1xuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuc3R5bGUuZ2V0Qm9yZGVyQm94XG4gKlxuICogQHBhcmFtIGVsZW1lbnQgIFRoZSBlbGVtZW50IHRvIGdldCB0aGUgYm9yZGVyIHdpZHRocyBmb3IuXG4gKiBAcmV0dXJucyBUaGUgY29tcHV0ZWQgYm9yZGVyIHdpZHRocy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0eWxlLmdldEJvcmRlckJveFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Qm9yZGVyQm94KGVsZW1lbnQ6IEVsZW1lbnQpOiBSZWN0IHtcbiAgY29uc3QgbGVmdCA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCAnYm9yZGVyTGVmdFdpZHRoJykpO1xuICBjb25zdCByaWdodCA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCAnYm9yZGVyUmlnaHRXaWR0aCcpKTtcbiAgY29uc3QgdG9wID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsICdib3JkZXJUb3BXaWR0aCcpKTtcbiAgY29uc3QgYm90dG9tID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsICdib3JkZXJCb3R0b21XaWR0aCcpKTtcblxuICByZXR1cm4gbmV3IFJlY3QodG9wLCBib3R0b20sIGxlZnQsIHJpZ2h0KTtcbn1cblxuLyoqXG4gKiBDaGFuZ2VzIHRoZSBzY3JvbGwgcG9zaXRpb24gb2YgYGNvbnRhaW5lcmAgd2l0aCB0aGUgbWluaW11bSBhbW91bnQgc29cbiAqIHRoYXQgdGhlIGNvbnRlbnQgYW5kIHRoZSBib3JkZXJzIG9mIHRoZSBnaXZlbiBgZWxlbWVudGAgYmVjb21lIHZpc2libGUuXG4gKiBJZiB0aGUgZWxlbWVudCBpcyBiaWdnZXIgdGhhbiB0aGUgY29udGFpbmVyLCBpdHMgdG9wIGxlZnQgY29ybmVyIHdpbGwgYmVcbiAqIGFsaWduZWQgYXMgY2xvc2UgdG8gdGhlIGNvbnRhaW5lcidzIHRvcCBsZWZ0IGNvcm5lciBhcyBwb3NzaWJsZS5cbiAqIENvcGllZCBmcm9tIENsb3N1cmUncyBnb29nLnN0eWxlLnNjcm9sbEludG9Db250YWluZXJWaWV3XG4gKlxuICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gbWFrZSB2aXNpYmxlLlxuICogQHBhcmFtIGNvbnRhaW5lciBUaGUgY29udGFpbmVyIHRvIHNjcm9sbC4gSWYgbm90IHNldCwgdGhlbiB0aGUgZG9jdW1lbnRcbiAqICAgICBzY3JvbGwgZWxlbWVudCB3aWxsIGJlIHVzZWQuXG4gKiBAcGFyYW0gb3B0X2NlbnRlciBXaGV0aGVyIHRvIGNlbnRlciB0aGUgZWxlbWVudCBpbiB0aGUgY29udGFpbmVyLlxuICogICAgIERlZmF1bHRzIHRvIGZhbHNlLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3R5bGUuc2Nyb2xsSW50b0NvbnRhaW5lclZpZXdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNjcm9sbEludG9Db250YWluZXJWaWV3KFxuICAgIGVsZW1lbnQ6IEVsZW1lbnQsIGNvbnRhaW5lcjogRWxlbWVudCwgb3B0X2NlbnRlcj86IGJvb2xlYW4pIHtcbiAgY29uc3Qgb2Zmc2V0ID0gZ2V0Q29udGFpbmVyT2Zmc2V0VG9TY3JvbGxJbnRvKGVsZW1lbnQsIGNvbnRhaW5lciwgb3B0X2NlbnRlcik7XG4gIGNvbnRhaW5lci5zY3JvbGxMZWZ0ID0gb2Zmc2V0Lng7XG4gIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBvZmZzZXQueTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBwb3NpdGlvbiBvZiBgY29udGFpbmVyYCB3aXRoIHRoZSBtaW5pbXVtIGFtb3VudCBzb1xuICogdGhhdCB0aGUgY29udGVudCBhbmQgdGhlIGJvcmRlcnMgb2YgdGhlIGdpdmVuIGBlbGVtZW50YCBiZWNvbWUgdmlzaWJsZS5cbiAqIElmIHRoZSBlbGVtZW50IGlzIGJpZ2dlciB0aGFuIHRoZSBjb250YWluZXIsIGl0cyB0b3AgbGVmdCBjb3JuZXIgd2lsbCBiZVxuICogYWxpZ25lZCBhcyBjbG9zZSB0byB0aGUgY29udGFpbmVyJ3MgdG9wIGxlZnQgY29ybmVyIGFzIHBvc3NpYmxlLlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuc3R5bGUuZ2V0Q29udGFpbmVyT2Zmc2V0VG9TY3JvbGxJbnRvXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gbWFrZSB2aXNpYmxlLlxuICogQHBhcmFtIGNvbnRhaW5lciBUaGUgY29udGFpbmVyIHRvIHNjcm9sbC4gSWYgbm90IHNldCwgdGhlbiB0aGUgZG9jdW1lbnRcbiAqICAgICBzY3JvbGwgZWxlbWVudCB3aWxsIGJlIHVzZWQuXG4gKiBAcGFyYW0gb3B0X2NlbnRlciBXaGV0aGVyIHRvIGNlbnRlciB0aGUgZWxlbWVudCBpbiB0aGUgY29udGFpbmVyLlxuICogICAgIERlZmF1bHRzIHRvIGZhbHNlLlxuICogQHJldHVybnMgVGhlIG5ldyBzY3JvbGwgcG9zaXRpb24gb2YgdGhlIGNvbnRhaW5lci5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0eWxlLmdldENvbnRhaW5lck9mZnNldFRvU2Nyb2xsSW50b1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29udGFpbmVyT2Zmc2V0VG9TY3JvbGxJbnRvKFxuICAgIGVsZW1lbnQ6IEVsZW1lbnQsIGNvbnRhaW5lcjogRWxlbWVudCwgb3B0X2NlbnRlcj86IGJvb2xlYW4pOiBDb29yZGluYXRlIHtcbiAgLy8gQWJzb2x1dGUgcG9zaXRpb24gb2YgdGhlIGVsZW1lbnQncyBib3JkZXIncyB0b3AgbGVmdCBjb3JuZXIuXG4gIGNvbnN0IGVsZW1lbnRQb3MgPSBnZXRQYWdlT2Zmc2V0KGVsZW1lbnQpO1xuICAvLyBBYnNvbHV0ZSBwb3NpdGlvbiBvZiB0aGUgY29udGFpbmVyJ3MgYm9yZGVyJ3MgdG9wIGxlZnQgY29ybmVyLlxuICBjb25zdCBjb250YWluZXJQb3MgPSBnZXRQYWdlT2Zmc2V0KGNvbnRhaW5lcik7XG4gIGNvbnN0IGNvbnRhaW5lckJvcmRlciA9IGdldEJvcmRlckJveChjb250YWluZXIpO1xuICAvLyBSZWxhdGl2ZSBwb3MuIG9mIHRoZSBlbGVtZW50J3MgYm9yZGVyIGJveCB0byB0aGUgY29udGFpbmVyJ3MgY29udGVudCBib3guXG4gIGNvbnN0IHJlbFggPSBlbGVtZW50UG9zLnggLSBjb250YWluZXJQb3MueCAtIGNvbnRhaW5lckJvcmRlci5sZWZ0O1xuICBjb25zdCByZWxZID0gZWxlbWVudFBvcy55IC0gY29udGFpbmVyUG9zLnkgLSBjb250YWluZXJCb3JkZXIudG9wO1xuICAvLyBIb3cgbXVjaCB0aGUgZWxlbWVudCBjYW4gbW92ZSBpbiB0aGUgY29udGFpbmVyLCBpLmUuIHRoZSBkaWZmZXJlbmNlIGJldHdlZW5cbiAgLy8gdGhlIGVsZW1lbnQncyBib3R0b20tcmlnaHQtbW9zdCBhbmQgdG9wLWxlZnQtbW9zdCBwb3NpdGlvbiB3aGVyZSBpdCdzXG4gIC8vIGZ1bGx5IHZpc2libGUuXG4gIGNvbnN0IGVsZW1lbnRTaXplID0gZ2V0U2l6ZVdpdGhEaXNwbGF5KGVsZW1lbnQpO1xuICBjb25zdCBzcGFjZVggPSBjb250YWluZXIuY2xpZW50V2lkdGggLSBlbGVtZW50U2l6ZS53aWR0aDtcbiAgY29uc3Qgc3BhY2VZID0gY29udGFpbmVyLmNsaWVudEhlaWdodCAtIGVsZW1lbnRTaXplLmhlaWdodDtcbiAgbGV0IHNjcm9sbExlZnQgPSBjb250YWluZXIuc2Nyb2xsTGVmdDtcbiAgbGV0IHNjcm9sbFRvcCA9IGNvbnRhaW5lci5zY3JvbGxUb3A7XG4gIGlmIChvcHRfY2VudGVyKSB7XG4gICAgLy8gQWxsIGJyb3dzZXJzIHJvdW5kIG5vbi1pbnRlZ2VyIHNjcm9sbCBwb3NpdGlvbnMgZG93bi5cbiAgICBzY3JvbGxMZWZ0ICs9IHJlbFggLSBzcGFjZVggLyAyO1xuICAgIHNjcm9sbFRvcCArPSByZWxZIC0gc3BhY2VZIC8gMjtcbiAgfSBlbHNlIHtcbiAgICAvLyBUaGlzIGZvcm11bGEgd2FzIGRlc2lnbmVkIHRvIGdpdmUgdGhlIGNvcnJlY3Qgc2Nyb2xsIHZhbHVlcyBpbiB0aGVcbiAgICAvLyBmb2xsb3dpbmcgY2FzZXM6XG4gICAgLy8gLSBlbGVtZW50IGlzIGhpZ2hlciB0aGFuIGNvbnRhaW5lciAoc3BhY2VZIDwgMCkgPT4gc2Nyb2xsIGRvd24gYnkgcmVsWVxuICAgIC8vIC0gZWxlbWVudCBpcyBub3QgaGlnaGVyIHRoYXQgY29udGFpbmVyIChzcGFjZVkgPj0gMCk6XG4gICAgLy8gICAtIGl0IGlzIGFib3ZlIGNvbnRhaW5lciAocmVsWSA8IDApID0+IHNjcm9sbCB1cCBieSBhYnMocmVsWSlcbiAgICAvLyAgIC0gaXQgaXMgYmVsb3cgY29udGFpbmVyIChyZWxZID4gc3BhY2VZKSA9PiBzY3JvbGwgZG93biBieSByZWxZIC0gc3BhY2VZXG4gICAgLy8gICAtIGl0IGlzIGluIHRoZSBjb250YWluZXIgPT4gZG9uJ3Qgc2Nyb2xsXG4gICAgc2Nyb2xsTGVmdCArPSBNYXRoLm1pbihyZWxYLCBNYXRoLm1heChyZWxYIC0gc3BhY2VYLCAwKSk7XG4gICAgc2Nyb2xsVG9wICs9IE1hdGgubWluKHJlbFksIE1hdGgubWF4KHJlbFkgLSBzcGFjZVksIDApKTtcbiAgfVxuICByZXR1cm4gbmV3IENvb3JkaW5hdGUoc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wKTtcbn1cblxuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IHtcbiAgZ2V0U2l6ZUludGVybmFsLFxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IE1hc3NhY2h1c2V0dHMgSW5zdGl0dXRlIG9mIFRlY2hub2xvZ3lcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQSBkaXYgdGhhdCBmbG9hdHMgb24gdG9wIG9mIHRoZSB3b3Jrc3BhY2UsIGZvciBkcm9wLWRvd24gbWVudXMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuZHJvcERvd25EaXYnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB0eXBlIHtGaWVsZH0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgKiBhcyBtYXRoIGZyb20gJy4vdXRpbHMvbWF0aC5qcyc7XG5pbXBvcnQge1JlY3R9IGZyb20gJy4vdXRpbHMvcmVjdC5qcyc7XG5pbXBvcnQgdHlwZSB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCAqIGFzIHN0eWxlIGZyb20gJy4vdXRpbHMvc3R5bGUuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIEFycm93IHNpemUgaW4gcHguIFNob3VsZCBtYXRjaCB0aGUgdmFsdWUgaW4gQ1NTXG4gKiAobmVlZCB0byBwb3NpdGlvbiBwcmUtcmVuZGVyKS5cbiAqL1xuZXhwb3J0IGNvbnN0IEFSUk9XX1NJWkUgPSAxNjtcblxuLyoqXG4gKiBEcm9wLWRvd24gYm9yZGVyIHNpemUgaW4gcHguIFNob3VsZCBtYXRjaCB0aGUgdmFsdWUgaW4gQ1NTIChuZWVkIHRvIHBvc2l0aW9uXG4gKiB0aGUgYXJyb3cpLlxuICovXG5leHBvcnQgY29uc3QgQk9SREVSX1NJWkUgPSAxO1xuXG4vKipcbiAqIEFtb3VudCB0aGUgYXJyb3cgbXVzdCBiZSBrZXB0IGF3YXkgZnJvbSB0aGUgZWRnZXMgb2YgdGhlIG1haW4gZHJvcC1kb3duIGRpdixcbiAqIGluIHB4LlxuICovXG5leHBvcnQgY29uc3QgQVJST1dfSE9SSVpPTlRBTF9QQURESU5HID0gMTI7XG5cbi8qKiBBbW91bnQgZHJvcC1kb3ducyBzaG91bGQgYmUgcGFkZGVkIGF3YXkgZnJvbSB0aGUgc291cmNlLCBpbiBweC4gKi9cbmV4cG9ydCBjb25zdCBQQURESU5HX1kgPSAxNjtcblxuLyoqIExlbmd0aCBvZiBhbmltYXRpb25zIGluIHNlY29uZHMuICovXG5leHBvcnQgY29uc3QgQU5JTUFUSU9OX1RJTUUgPSAwLjI1O1xuXG4vKipcbiAqIFRpbWVyIGZvciBhbmltYXRpb24gb3V0LCB0byBiZSBjbGVhcmVkIGlmIHdlIG5lZWQgdG8gaW1tZWRpYXRlbHkgaGlkZVxuICogd2l0aG91dCBkaXNydXB0aW5nIG5ldyBzaG93cy5cbiAqL1xubGV0IGFuaW1hdGVPdXRUaW1lcjogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD58bnVsbCA9IG51bGw7XG5cbi8qKiBDYWxsYmFjayBmb3Igd2hlbiB0aGUgZHJvcC1kb3duIGlzIGhpZGRlbi4gKi9cbmxldCBvbkhpZGU6IEZ1bmN0aW9ufG51bGwgPSBudWxsO1xuXG4vKiogQSBjbGFzcyBuYW1lIHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBvd25lcidzIHdvcmtzcGFjZSByZW5kZXJlci4gKi9cbmxldCByZW5kZXJlZENsYXNzTmFtZSA9ICcnO1xuXG4vKiogQSBjbGFzcyBuYW1lIHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBvd25lcidzIHdvcmtzcGFjZSB0aGVtZS4gKi9cbmxldCB0aGVtZUNsYXNzTmFtZSA9ICcnO1xuXG4vKiogVGhlIGNvbnRlbnQgZWxlbWVudC4gKi9cbmxldCBkaXY6IEhUTUxEaXZFbGVtZW50O1xuXG4vKiogVGhlIGNvbnRlbnQgZWxlbWVudC4gKi9cbmxldCBjb250ZW50OiBIVE1MRGl2RWxlbWVudDtcblxuLyoqIFRoZSBhcnJvdyBlbGVtZW50LiAqL1xubGV0IGFycm93OiBIVE1MRGl2RWxlbWVudDtcblxuLyoqXG4gKiBEcm9wLWRvd25zIHdpbGwgYXBwZWFyIHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoaXMgZWxlbWVudCBpZiBwb3NzaWJsZS5cbiAqIFNldCBpbiBzZXRCb3VuZHNFbGVtZW50LlxuICovXG5sZXQgYm91bmRzRWxlbWVudDogRWxlbWVudHxudWxsID0gbnVsbDtcblxuLyoqIFRoZSBvYmplY3QgY3VycmVudGx5IHVzaW5nIHRoZSBkcm9wLWRvd24uICovXG5sZXQgb3duZXI6IEZpZWxkfG51bGwgPSBudWxsO1xuXG4vKiogV2hldGhlciB0aGUgZHJvcGRvd24gd2FzIHBvc2l0aW9uZWQgdG8gYSBmaWVsZCBvciB0aGUgc291cmNlIGJsb2NrLiAqL1xubGV0IHBvc2l0aW9uVG9GaWVsZDogYm9vbGVhbnxudWxsID0gbnVsbDtcblxuLyoqXG4gKiBEcm9wZG93biBib3VuZHMgaW5mbyBvYmplY3QgdXNlZCB0byBlbmNhcHN1bGF0ZSBzaXppbmcgaW5mb3JtYXRpb24gYWJvdXQgYVxuICogYm91bmRpbmcgZWxlbWVudCAoYm91bmRpbmcgYm94IGFuZCB3aWR0aC9oZWlnaHQpLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJvdW5kc0luZm8ge1xuICB0b3A6IG51bWJlcjtcbiAgbGVmdDogbnVtYmVyO1xuICBib3R0b206IG51bWJlcjtcbiAgcmlnaHQ6IG51bWJlcjtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG59XG5cbi8qKiBEcm9wZG93biBwb3NpdGlvbiBtZXRyaWNzLiAqL1xuZXhwb3J0IGludGVyZmFjZSBQb3NpdGlvbk1ldHJpY3Mge1xuICBpbml0aWFsWDogbnVtYmVyO1xuICBpbml0aWFsWTogbnVtYmVyO1xuICBmaW5hbFg6IG51bWJlcjtcbiAgZmluYWxZOiBudW1iZXI7XG4gIGFycm93WDogbnVtYmVyfG51bGw7XG4gIGFycm93WTogbnVtYmVyfG51bGw7XG4gIGFycm93QXRUb3A6IGJvb2xlYW58bnVsbDtcbiAgYXJyb3dWaXNpYmxlOiBib29sZWFuO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhbmQgaW5zZXJ0IHRoZSBET00gZWxlbWVudCBmb3IgdGhpcyBkaXYuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEb20oKSB7XG4gIGlmIChkaXYpIHtcbiAgICByZXR1cm47ICAvLyBBbHJlYWR5IGNyZWF0ZWQuXG4gIH1cbiAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpdi5jbGFzc05hbWUgPSAnYmxvY2tseURyb3BEb3duRGl2JztcbiAgY29uc3QgcGFyZW50RGl2ID0gY29tbW9uLmdldFBhcmVudENvbnRhaW5lcigpIHx8IGRvY3VtZW50LmJvZHk7XG4gIHBhcmVudERpdi5hcHBlbmRDaGlsZChkaXYpO1xuXG4gIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29udGVudC5jbGFzc05hbWUgPSAnYmxvY2tseURyb3BEb3duQ29udGVudCc7XG4gIGRpdi5hcHBlbmRDaGlsZChjb250ZW50KTtcblxuICBhcnJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBhcnJvdy5jbGFzc05hbWUgPSAnYmxvY2tseURyb3BEb3duQXJyb3cnO1xuICBkaXYuYXBwZW5kQ2hpbGQoYXJyb3cpO1xuXG4gIGRpdi5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuICAvLyBUcmFuc2l0aW9uIGFuaW1hdGlvbiBmb3IgdHJhbnNmb3JtOiB0cmFuc2xhdGUoKSBhbmQgb3BhY2l0eS5cbiAgZGl2LnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtICcgKyBBTklNQVRJT05fVElNRSArICdzLCAnICtcbiAgICAgICdvcGFjaXR5ICcgKyBBTklNQVRJT05fVElNRSArICdzJztcblxuICAvLyBIYW5kbGUgZm9jdXNpbi9vdXQgZXZlbnRzIHRvIGFkZCBhIHZpc3VhbCBpbmRpY2F0b3Igd2hlblxuICAvLyBhIGNoaWxkIGlzIGZvY3VzZWQgb3IgYmx1cnJlZC5cbiAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCBmdW5jdGlvbigpIHtcbiAgICBkb20uYWRkQ2xhc3MoZGl2LCAnYmxvY2tseUZvY3VzZWQnKTtcbiAgfSk7XG4gIGRpdi5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsIGZ1bmN0aW9uKCkge1xuICAgIGRvbS5yZW1vdmVDbGFzcyhkaXYsICdibG9ja2x5Rm9jdXNlZCcpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBTZXQgYW4gZWxlbWVudCB0byBtYWludGFpbiBib3VuZHMgd2l0aGluLiBEcm9wLWRvd25zIHdpbGwgYXBwZWFyXG4gKiB3aXRoaW4gdGhlIGJveCBvZiB0aGlzIGVsZW1lbnQgaWYgcG9zc2libGUuXG4gKlxuICogQHBhcmFtIGJvdW5kc0VsZW0gRWxlbWVudCB0byBiaW5kIGRyb3AtZG93biB0by5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEJvdW5kc0VsZW1lbnQoYm91bmRzRWxlbTogRWxlbWVudHxudWxsKSB7XG4gIGJvdW5kc0VsZW1lbnQgPSBib3VuZHNFbGVtO1xufVxuXG4vKipcbiAqIEByZXR1cm5zIFRoZSBmaWVsZCB0aGF0IGN1cnJlbnRseSBvd25zIHRoaXMsIG9yIG51bGwuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRPd25lcigpOiBGaWVsZHxudWxsIHtcbiAgcmV0dXJuIG93bmVyO1xufVxuXG4vKipcbiAqIFByb3ZpZGUgdGhlIGRpdiBmb3IgaW5zZXJ0aW5nIGNvbnRlbnQgaW50byB0aGUgZHJvcC1kb3duLlxuICpcbiAqIEByZXR1cm5zIERpdiB0byBwb3B1bGF0ZSB3aXRoIGNvbnRlbnQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb250ZW50RGl2KCk6IEVsZW1lbnQge1xuICByZXR1cm4gY29udGVudDtcbn1cblxuLyoqIENsZWFyIHRoZSBjb250ZW50IG9mIHRoZSBkcm9wLWRvd24uICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJDb250ZW50KCkge1xuICBjb250ZW50LnRleHRDb250ZW50ID0gJyc7XG4gIGNvbnRlbnQuc3R5bGUud2lkdGggPSAnJztcbn1cblxuLyoqXG4gKiBTZXQgdGhlIGNvbG91ciBmb3IgdGhlIGRyb3AtZG93bi5cbiAqXG4gKiBAcGFyYW0gYmFja2dyb3VuZENvbG91ciBBbnkgQ1NTIGNvbG91ciBmb3IgdGhlIGJhY2tncm91bmQuXG4gKiBAcGFyYW0gYm9yZGVyQ29sb3VyIEFueSBDU1MgY29sb3VyIGZvciB0aGUgYm9yZGVyLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29sb3VyKGJhY2tncm91bmRDb2xvdXI6IHN0cmluZywgYm9yZGVyQ29sb3VyOiBzdHJpbmcpIHtcbiAgZGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGJhY2tncm91bmRDb2xvdXI7XG4gIGRpdi5zdHlsZS5ib3JkZXJDb2xvciA9IGJvcmRlckNvbG91cjtcbn1cblxuLyoqXG4gKiBTaG9ydGN1dCB0byBzaG93IGFuZCBwbGFjZSB0aGUgZHJvcC1kb3duIHdpdGggcG9zaXRpb25pbmcgZGV0ZXJtaW5lZFxuICogYnkgYSBwYXJ0aWN1bGFyIGJsb2NrLiBUaGUgcHJpbWFyeSBwb3NpdGlvbiB3aWxsIGJlIGJlbG93IHRoZSBibG9jayxcbiAqIGFuZCB0aGUgc2Vjb25kYXJ5IHBvc2l0aW9uIGFib3ZlIHRoZSBibG9jay4gRHJvcC1kb3duIHdpbGwgYmVcbiAqIGNvbnN0cmFpbmVkIHRvIHRoZSBibG9jaydzIHdvcmtzcGFjZS5cbiAqXG4gKiBAcGFyYW0gZmllbGQgVGhlIGZpZWxkIHNob3dpbmcgdGhlIGRyb3AtZG93bi5cbiAqIEBwYXJhbSBibG9jayBCbG9jayB0byBwb3NpdGlvbiB0aGUgZHJvcC1kb3duIGFyb3VuZC5cbiAqIEBwYXJhbSBvcHRfb25IaWRlIE9wdGlvbmFsIGNhbGxiYWNrIGZvciB3aGVuIHRoZSBkcm9wLWRvd24gaXMgaGlkZGVuLlxuICogQHBhcmFtIG9wdF9zZWNvbmRhcnlZT2Zmc2V0IE9wdGlvbmFsIFkgb2Zmc2V0IGZvciBhYm92ZS1ibG9jayBwb3NpdGlvbmluZy5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG1lbnUgcmVuZGVyZWQgYmVsb3cgYmxvY2s7IGZhbHNlIGlmIGFib3ZlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd1Bvc2l0aW9uZWRCeUJsb2NrPFQ+KFxuICAgIGZpZWxkOiBGaWVsZDxUPiwgYmxvY2s6IEJsb2NrU3ZnLCBvcHRfb25IaWRlPzogRnVuY3Rpb24sXG4gICAgb3B0X3NlY29uZGFyeVlPZmZzZXQ/OiBudW1iZXIpOiBib29sZWFuIHtcbiAgcmV0dXJuIHNob3dQb3NpdGlvbmVkQnlSZWN0KFxuICAgICAgZ2V0U2NhbGVkQmJveE9mQmxvY2soYmxvY2spLCBmaWVsZCBhcyBGaWVsZCwgb3B0X29uSGlkZSxcbiAgICAgIG9wdF9zZWNvbmRhcnlZT2Zmc2V0KTtcbn1cblxuLyoqXG4gKiBTaG9ydGN1dCB0byBzaG93IGFuZCBwbGFjZSB0aGUgZHJvcC1kb3duIHdpdGggcG9zaXRpb25pbmcgZGV0ZXJtaW5lZFxuICogYnkgYSBwYXJ0aWN1bGFyIGZpZWxkLiBUaGUgcHJpbWFyeSBwb3NpdGlvbiB3aWxsIGJlIGJlbG93IHRoZSBmaWVsZCxcbiAqIGFuZCB0aGUgc2Vjb25kYXJ5IHBvc2l0aW9uIGFib3ZlIHRoZSBmaWVsZC4gRHJvcC1kb3duIHdpbGwgYmVcbiAqIGNvbnN0cmFpbmVkIHRvIHRoZSBibG9jaydzIHdvcmtzcGFjZS5cbiAqXG4gKiBAcGFyYW0gZmllbGQgVGhlIGZpZWxkIHRvIHBvc2l0aW9uIHRoZSBkcm9wZG93biBhZ2FpbnN0LlxuICogQHBhcmFtIG9wdF9vbkhpZGUgT3B0aW9uYWwgY2FsbGJhY2sgZm9yIHdoZW4gdGhlIGRyb3AtZG93biBpcyBoaWRkZW4uXG4gKiBAcGFyYW0gb3B0X3NlY29uZGFyeVlPZmZzZXQgT3B0aW9uYWwgWSBvZmZzZXQgZm9yIGFib3ZlLWJsb2NrIHBvc2l0aW9uaW5nLlxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbWVudSByZW5kZXJlZCBiZWxvdyBibG9jazsgZmFsc2UgaWYgYWJvdmUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93UG9zaXRpb25lZEJ5RmllbGQ8VD4oXG4gICAgZmllbGQ6IEZpZWxkPFQ+LCBvcHRfb25IaWRlPzogRnVuY3Rpb24sXG4gICAgb3B0X3NlY29uZGFyeVlPZmZzZXQ/OiBudW1iZXIpOiBib29sZWFuIHtcbiAgcG9zaXRpb25Ub0ZpZWxkID0gdHJ1ZTtcbiAgcmV0dXJuIHNob3dQb3NpdGlvbmVkQnlSZWN0KFxuICAgICAgZ2V0U2NhbGVkQmJveE9mRmllbGQoZmllbGQgYXMgRmllbGQpLCBmaWVsZCBhcyBGaWVsZCwgb3B0X29uSGlkZSxcbiAgICAgIG9wdF9zZWNvbmRhcnlZT2Zmc2V0KTtcbn1cbi8qKlxuICogR2V0IHRoZSBzY2FsZWQgYm91bmRpbmcgYm94IG9mIGEgYmxvY2suXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jay5cbiAqIEByZXR1cm5zIFRoZSBzY2FsZWQgYm91bmRpbmcgYm94IG9mIHRoZSBibG9jay5cbiAqL1xuZnVuY3Rpb24gZ2V0U2NhbGVkQmJveE9mQmxvY2soYmxvY2s6IEJsb2NrU3ZnKTogUmVjdCB7XG4gIGNvbnN0IGJsb2NrU3ZnID0gYmxvY2suZ2V0U3ZnUm9vdCgpO1xuICBjb25zdCBzY2FsZSA9IGJsb2NrLndvcmtzcGFjZS5zY2FsZTtcbiAgY29uc3Qgc2NhbGVkSGVpZ2h0ID0gYmxvY2suaGVpZ2h0ICogc2NhbGU7XG4gIGNvbnN0IHNjYWxlZFdpZHRoID0gYmxvY2sud2lkdGggKiBzY2FsZTtcbiAgY29uc3QgeHkgPSBzdHlsZS5nZXRQYWdlT2Zmc2V0KGJsb2NrU3ZnKTtcbiAgcmV0dXJuIG5ldyBSZWN0KHh5LnksIHh5LnkgKyBzY2FsZWRIZWlnaHQsIHh5LngsIHh5LnggKyBzY2FsZWRXaWR0aCk7XG59XG5cbi8qKlxuICogR2V0IHRoZSBzY2FsZWQgYm91bmRpbmcgYm94IG9mIGEgZmllbGQuXG4gKlxuICogQHBhcmFtIGZpZWxkIFRoZSBmaWVsZC5cbiAqIEByZXR1cm5zIFRoZSBzY2FsZWQgYm91bmRpbmcgYm94IG9mIHRoZSBmaWVsZC5cbiAqL1xuZnVuY3Rpb24gZ2V0U2NhbGVkQmJveE9mRmllbGQoZmllbGQ6IEZpZWxkKTogUmVjdCB7XG4gIGNvbnN0IGJCb3ggPSBmaWVsZC5nZXRTY2FsZWRCQm94KCk7XG4gIHJldHVybiBuZXcgUmVjdChiQm94LnRvcCwgYkJveC5ib3R0b20sIGJCb3gubGVmdCwgYkJveC5yaWdodCk7XG59XG5cbi8qKlxuICogSGVscGVyIG1ldGhvZCB0byBzaG93IGFuZCBwbGFjZSB0aGUgZHJvcC1kb3duIHdpdGggcG9zaXRpb25pbmcgZGV0ZXJtaW5lZFxuICogYnkgYSBzY2FsZWQgYm91bmRpbmcgYm94LiAgVGhlIHByaW1hcnkgcG9zaXRpb24gd2lsbCBiZSBiZWxvdyB0aGUgcmVjdCxcbiAqIGFuZCB0aGUgc2Vjb25kYXJ5IHBvc2l0aW9uIGFib3ZlIHRoZSByZWN0LiBEcm9wLWRvd24gd2lsbCBiZSBjb25zdHJhaW5lZCB0b1xuICogdGhlIGJsb2NrJ3Mgd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSBiQm94IFRoZSBzY2FsZWQgYm91bmRpbmcgYm94LlxuICogQHBhcmFtIGZpZWxkIFRoZSBmaWVsZCB0byBwb3NpdGlvbiB0aGUgZHJvcGRvd24gYWdhaW5zdC5cbiAqIEBwYXJhbSBvcHRfb25IaWRlIE9wdGlvbmFsIGNhbGxiYWNrIGZvciB3aGVuIHRoZSBkcm9wLWRvd24gaXMgaGlkZGVuLlxuICogQHBhcmFtIG9wdF9zZWNvbmRhcnlZT2Zmc2V0IE9wdGlvbmFsIFkgb2Zmc2V0IGZvciBhYm92ZS1ibG9jayBwb3NpdGlvbmluZy5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG1lbnUgcmVuZGVyZWQgYmVsb3cgYmxvY2s7IGZhbHNlIGlmIGFib3ZlLlxuICovXG5mdW5jdGlvbiBzaG93UG9zaXRpb25lZEJ5UmVjdChcbiAgICBiQm94OiBSZWN0LCBmaWVsZDogRmllbGQsIG9wdF9vbkhpZGU/OiBGdW5jdGlvbixcbiAgICBvcHRfc2Vjb25kYXJ5WU9mZnNldD86IG51bWJlcik6IGJvb2xlYW4ge1xuICAvLyBJZiB3ZSBjYW4gZml0IGl0LCByZW5kZXIgYmVsb3cgdGhlIGJsb2NrLlxuICBjb25zdCBwcmltYXJ5WCA9IGJCb3gubGVmdCArIChiQm94LnJpZ2h0IC0gYkJveC5sZWZ0KSAvIDI7XG4gIGNvbnN0IHByaW1hcnlZID0gYkJveC5ib3R0b207XG4gIC8vIElmIHdlIGNhbid0IGZpdCBpdCwgcmVuZGVyIGFib3ZlIHRoZSBlbnRpcmUgcGFyZW50IGJsb2NrLlxuICBjb25zdCBzZWNvbmRhcnlYID0gcHJpbWFyeVg7XG4gIGxldCBzZWNvbmRhcnlZID0gYkJveC50b3A7XG4gIGlmIChvcHRfc2Vjb25kYXJ5WU9mZnNldCkge1xuICAgIHNlY29uZGFyeVkgKz0gb3B0X3NlY29uZGFyeVlPZmZzZXQ7XG4gIH1cbiAgY29uc3Qgc291cmNlQmxvY2sgPSBmaWVsZC5nZXRTb3VyY2VCbG9jaygpIGFzIEJsb2NrU3ZnO1xuICAvLyBTZXQgYm91bmRzIHRvIG1haW4gd29ya3NwYWNlOyBzaG93IHRoZSBkcm9wLWRvd24uXG4gIGxldCB3b3Jrc3BhY2UgPSBzb3VyY2VCbG9jay53b3Jrc3BhY2U7XG4gIHdoaWxlICh3b3Jrc3BhY2Uub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2UpIHtcbiAgICB3b3Jrc3BhY2UgPSB3b3Jrc3BhY2Uub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2U7XG4gIH1cbiAgc2V0Qm91bmRzRWxlbWVudCh3b3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCkucGFyZW50Tm9kZSBhcyBFbGVtZW50IHwgbnVsbCk7XG4gIHJldHVybiBzaG93KFxuICAgICAgZmllbGQsIHNvdXJjZUJsb2NrLlJUTCwgcHJpbWFyeVgsIHByaW1hcnlZLCBzZWNvbmRhcnlYLCBzZWNvbmRhcnlZLFxuICAgICAgb3B0X29uSGlkZSk7XG59XG5cbi8qKlxuICogU2hvdyBhbmQgcGxhY2UgdGhlIGRyb3AtZG93bi5cbiAqIFRoZSBkcm9wLWRvd24gaXMgcGxhY2VkIHdpdGggYW4gYWJzb2x1dGUgXCJvcmlnaW4gcG9pbnRcIiAoeCwgeSkgLSBpLmUuLFxuICogdGhlIGFycm93IHdpbGwgcG9pbnQgYXQgdGhpcyBvcmlnaW4gYW5kIGJveCB3aWxsIHBvc2l0aW9uZWQgYmVsb3cgb3IgYWJvdmVcbiAqIGl0LiAgSWYgd2UgY2FuIG1haW50YWluIHRoZSBjb250YWluZXIgYm91bmRzIGF0IHRoZSBwcmltYXJ5IHBvaW50LCB0aGUgYXJyb3dcbiAqIHdpbGwgcG9pbnQgdGhlcmUsIGFuZCB0aGUgY29udGFpbmVyIHdpbGwgYmUgcG9zaXRpb25lZCBiZWxvdyBpdC5cbiAqIElmIHdlIGNhbid0IG1haW50YWluIHRoZSBjb250YWluZXIgYm91bmRzIGF0IHRoZSBwcmltYXJ5IHBvaW50LCBmYWxsLWJhY2sgdG9cbiAqIHRoZSBzZWNvbmRhcnkgcG9pbnQgYW5kIHBvc2l0aW9uIGFib3ZlLlxuICpcbiAqIEBwYXJhbSBuZXdPd25lciBUaGUgb2JqZWN0IHNob3dpbmcgdGhlIGRyb3AtZG93blxuICogQHBhcmFtIHJ0bCBSaWdodC10by1sZWZ0ICh0cnVlKSBvciBsZWZ0LXRvLXJpZ2h0IChmYWxzZSkuXG4gKiBAcGFyYW0gcHJpbWFyeVggRGVzaXJlZCBvcmlnaW4gcG9pbnQgeCwgaW4gYWJzb2x1dGUgcHguXG4gKiBAcGFyYW0gcHJpbWFyeVkgRGVzaXJlZCBvcmlnaW4gcG9pbnQgeSwgaW4gYWJzb2x1dGUgcHguXG4gKiBAcGFyYW0gc2Vjb25kYXJ5WCBTZWNvbmRhcnkvYWx0ZXJuYXRpdmUgb3JpZ2luIHBvaW50IHgsIGluIGFic29sdXRlIHB4LlxuICogQHBhcmFtIHNlY29uZGFyeVkgU2Vjb25kYXJ5L2FsdGVybmF0aXZlIG9yaWdpbiBwb2ludCB5LCBpbiBhYnNvbHV0ZSBweC5cbiAqIEBwYXJhbSBvcHRfb25IaWRlIE9wdGlvbmFsIGNhbGxiYWNrIGZvciB3aGVuIHRoZSBkcm9wLWRvd24gaXMgaGlkZGVuLlxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbWVudSByZW5kZXJlZCBhdCB0aGUgcHJpbWFyeSBvcmlnaW4gcG9pbnQuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3c8VD4oXG4gICAgbmV3T3duZXI6IEZpZWxkPFQ+LCBydGw6IGJvb2xlYW4sIHByaW1hcnlYOiBudW1iZXIsIHByaW1hcnlZOiBudW1iZXIsXG4gICAgc2Vjb25kYXJ5WDogbnVtYmVyLCBzZWNvbmRhcnlZOiBudW1iZXIsIG9wdF9vbkhpZGU/OiBGdW5jdGlvbik6IGJvb2xlYW4ge1xuICBvd25lciA9IG5ld093bmVyIGFzIEZpZWxkO1xuICBvbkhpZGUgPSBvcHRfb25IaWRlIHx8IG51bGw7XG4gIC8vIFNldCBkaXJlY3Rpb24uXG4gIGRpdi5zdHlsZS5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInO1xuXG4gIGNvbnN0IG1haW5Xb3Jrc3BhY2UgPSBjb21tb24uZ2V0TWFpbldvcmtzcGFjZSgpIGFzIFdvcmtzcGFjZVN2ZztcbiAgcmVuZGVyZWRDbGFzc05hbWUgPSBtYWluV29ya3NwYWNlLmdldFJlbmRlcmVyKCkuZ2V0Q2xhc3NOYW1lKCk7XG4gIHRoZW1lQ2xhc3NOYW1lID0gbWFpbldvcmtzcGFjZS5nZXRUaGVtZSgpLmdldENsYXNzTmFtZSgpO1xuICBpZiAocmVuZGVyZWRDbGFzc05hbWUpIHtcbiAgICBkb20uYWRkQ2xhc3MoZGl2LCByZW5kZXJlZENsYXNzTmFtZSk7XG4gIH1cbiAgaWYgKHRoZW1lQ2xhc3NOYW1lKSB7XG4gICAgZG9tLmFkZENsYXNzKGRpdiwgdGhlbWVDbGFzc05hbWUpO1xuICB9XG5cbiAgLy8gV2hlbiB3ZSBjaGFuZ2UgYHRyYW5zbGF0ZWAgbXVsdGlwbGUgdGltZXMgaW4gY2xvc2Ugc3VjY2Vzc2lvbixcbiAgLy8gQ2hyb21lIG1heSBjaG9vc2UgdG8gd2FpdCBhbmQgYXBwbHkgdGhlbSBhbGwgYXQgb25jZS5cbiAgLy8gU2luY2Ugd2Ugd2FudCB0aGUgdHJhbnNsYXRpb24gdG8gaW5pdGlhbCBYLCBZIHRvIGJlIGltbWVkaWF0ZSxcbiAgLy8gYW5kIHRoZSB0cmFuc2xhdGlvbiB0byBmaW5hbCBYLCBZIHRvIGJlIGFuaW1hdGVkLFxuICAvLyB3ZSBzYXcgcHJvYmxlbXMgd2hlcmUgYm90aCB3b3VsZCBiZSBhcHBsaWVkIGFmdGVyIGFuaW1hdGlvbiB3YXMgdHVybmVkIG9uLFxuICAvLyBtYWtpbmcgdGhlIGRyb3Bkb3duIGFwcGVhciB0byBmbHkgaW4gZnJvbSAoMCwgMCkuXG4gIC8vIFVzaW5nIGJvdGggYGxlZnRgLCBgdG9wYCBmb3IgdGhlIGluaXRpYWwgdHJhbnNsYXRpb24gYW5kIHRoZW4gYHRyYW5zbGF0ZWBcbiAgLy8gZm9yIHRoZSBhbmltYXRlZCB0cmFuc2l0aW9uIHRvIGZpbmFsIFgsIFkgaXMgYSB3b3JrYXJvdW5kLlxuICByZXR1cm4gcG9zaXRpb25JbnRlcm5hbChwcmltYXJ5WCwgcHJpbWFyeVksIHNlY29uZGFyeVgsIHNlY29uZGFyeVkpO1xufVxuXG5jb25zdCBpbnRlcm5hbCA9IHtcbiAgLyoqXG4gICAqIEdldCBzaXppbmcgaW5mbyBhYm91dCB0aGUgYm91bmRpbmcgZWxlbWVudC5cbiAgICpcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6ZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYm91bmRpbmcgZWxlbWVudFxuICAgKiAgICAgKGJvdW5kaW5nIGJveCBhbmQgd2lkdGgvaGVpZ2h0KS5cbiAgICovXG4gIGdldEJvdW5kc0luZm86IGZ1bmN0aW9uKCk6IEJvdW5kc0luZm8ge1xuICAgIGNvbnN0IGJvdW5kUG9zaXRpb24gPSBzdHlsZS5nZXRQYWdlT2Zmc2V0KGJvdW5kc0VsZW1lbnQgYXMgRWxlbWVudCk7XG4gICAgY29uc3QgYm91bmRTaXplID0gc3R5bGUuZ2V0U2l6ZShib3VuZHNFbGVtZW50IGFzIEVsZW1lbnQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxlZnQ6IGJvdW5kUG9zaXRpb24ueCxcbiAgICAgIHJpZ2h0OiBib3VuZFBvc2l0aW9uLnggKyBib3VuZFNpemUud2lkdGgsXG4gICAgICB0b3A6IGJvdW5kUG9zaXRpb24ueSxcbiAgICAgIGJvdHRvbTogYm91bmRQb3NpdGlvbi55ICsgYm91bmRTaXplLmhlaWdodCxcbiAgICAgIHdpZHRoOiBib3VuZFNpemUud2lkdGgsXG4gICAgICBoZWlnaHQ6IGJvdW5kU2l6ZS5oZWlnaHQsXG4gICAgfTtcbiAgfSxcblxuICAvKipcbiAgICogSGVscGVyIHRvIHBvc2l0aW9uIHRoZSBkcm9wLWRvd24gYW5kIHRoZSBhcnJvdywgbWFpbnRhaW5pbmcgYm91bmRzLlxuICAgKiBTZWUgZXhwbGFuYXRpb24gb2Ygb3JpZ2luIHBvaW50cyBpbiBzaG93LlxuICAgKlxuICAgKiBAcGFyYW0gcHJpbWFyeVggRGVzaXJlZCBvcmlnaW4gcG9pbnQgeCwgaW4gYWJzb2x1dGUgcHguXG4gICAqIEBwYXJhbSBwcmltYXJ5WSBEZXNpcmVkIG9yaWdpbiBwb2ludCB5LCBpbiBhYnNvbHV0ZSBweC5cbiAgICogQHBhcmFtIHNlY29uZGFyeVggU2Vjb25kYXJ5L2FsdGVybmF0aXZlIG9yaWdpbiBwb2ludCB4LCBpbiBhYnNvbHV0ZSBweC5cbiAgICogQHBhcmFtIHNlY29uZGFyeVkgU2Vjb25kYXJ5L2FsdGVybmF0aXZlIG9yaWdpbiBwb2ludCB5LCBpbiBhYnNvbHV0ZSBweC5cbiAgICogQHJldHVybnMgVmFyaW91cyBmaW5hbCBtZXRyaWNzLCBpbmNsdWRpbmcgcmVuZGVyZWQgcG9zaXRpb25zIGZvciBkcm9wLWRvd25cbiAgICogICAgIGFuZCBhcnJvdy5cbiAgICovXG4gIGdldFBvc2l0aW9uTWV0cmljczogZnVuY3Rpb24oXG4gICAgICBwcmltYXJ5WDogbnVtYmVyLCBwcmltYXJ5WTogbnVtYmVyLCBzZWNvbmRhcnlYOiBudW1iZXIsXG4gICAgICBzZWNvbmRhcnlZOiBudW1iZXIpOiBQb3NpdGlvbk1ldHJpY3Mge1xuICAgIGNvbnN0IGJvdW5kc0luZm8gPSBpbnRlcm5hbC5nZXRCb3VuZHNJbmZvKCk7XG4gICAgY29uc3QgZGl2U2l6ZSA9IHN0eWxlLmdldFNpemUoZGl2IGFzIEVsZW1lbnQpO1xuXG4gICAgLy8gQ2FuIHdlIGZpdCBpbi1ib3VuZHMgYmVsb3cgdGhlIHRhcmdldD9cbiAgICBpZiAocHJpbWFyeVkgKyBkaXZTaXplLmhlaWdodCA8IGJvdW5kc0luZm8uYm90dG9tKSB7XG4gICAgICByZXR1cm4gZ2V0UG9zaXRpb25CZWxvd01ldHJpY3MocHJpbWFyeVgsIHByaW1hcnlZLCBib3VuZHNJbmZvLCBkaXZTaXplKTtcbiAgICB9XG4gICAgLy8gQ2FuIHdlIGZpdCBpbi1ib3VuZHMgYWJvdmUgdGhlIHRhcmdldD9cbiAgICBpZiAoc2Vjb25kYXJ5WSAtIGRpdlNpemUuaGVpZ2h0ID4gYm91bmRzSW5mby50b3ApIHtcbiAgICAgIHJldHVybiBnZXRQb3NpdGlvbkFib3ZlTWV0cmljcyhcbiAgICAgICAgICBzZWNvbmRhcnlYLCBzZWNvbmRhcnlZLCBib3VuZHNJbmZvLCBkaXZTaXplKTtcbiAgICB9XG4gICAgLy8gQ2FuIHdlIGZpdCBvdXRzaWRlIHRoZSB3b3Jrc3BhY2UgYm91bmRzIChidXQgaW5zaWRlIHRoZSB3aW5kb3cpXG4gICAgLy8gYmVsb3c/XG4gICAgaWYgKHByaW1hcnlZICsgZGl2U2l6ZS5oZWlnaHQgPCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7XG4gICAgICByZXR1cm4gZ2V0UG9zaXRpb25CZWxvd01ldHJpY3MocHJpbWFyeVgsIHByaW1hcnlZLCBib3VuZHNJbmZvLCBkaXZTaXplKTtcbiAgICB9XG4gICAgLy8gQ2FuIHdlIGZpdCBvdXRzaWRlIHRoZSB3b3Jrc3BhY2UgYm91bmRzIChidXQgaW5zaWRlIHRoZSB3aW5kb3cpXG4gICAgLy8gYWJvdmU/XG4gICAgaWYgKHNlY29uZGFyeVkgLSBkaXZTaXplLmhlaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3ApIHtcbiAgICAgIHJldHVybiBnZXRQb3NpdGlvbkFib3ZlTWV0cmljcyhcbiAgICAgICAgICBzZWNvbmRhcnlYLCBzZWNvbmRhcnlZLCBib3VuZHNJbmZvLCBkaXZTaXplKTtcbiAgICB9XG5cbiAgICAvLyBMYXN0IHJlc29ydCwgcmVuZGVyIGF0IHRvcCBvZiBwYWdlLlxuICAgIHJldHVybiBnZXRQb3NpdGlvblRvcE9mUGFnZU1ldHJpY3MocHJpbWFyeVgsIGJvdW5kc0luZm8sIGRpdlNpemUpO1xuICB9LFxufTtcblxuLyoqXG4gKiBHZXQgdGhlIG1ldHJpY3MgZm9yIHBvc2l0aW9uaW5nIHRoZSBkaXYgYmVsb3cgdGhlIHNvdXJjZS5cbiAqXG4gKiBAcGFyYW0gcHJpbWFyeVggRGVzaXJlZCBvcmlnaW4gcG9pbnQgeCwgaW4gYWJzb2x1dGUgcHguXG4gKiBAcGFyYW0gcHJpbWFyeVkgRGVzaXJlZCBvcmlnaW4gcG9pbnQgeSwgaW4gYWJzb2x1dGUgcHguXG4gKiBAcGFyYW0gYm91bmRzSW5mbyBBbiBvYmplY3QgY29udGFpbmluZyBzaXplIGluZm9ybWF0aW9uIGFib3V0IHRoZSBib3VuZGluZ1xuICogICAgIGVsZW1lbnQgKGJvdW5kaW5nIGJveCBhbmQgd2lkdGgvaGVpZ2h0KS5cbiAqIEBwYXJhbSBkaXZTaXplIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzaXplIG9mIHRoZVxuICogICAgIERyb3BEb3duRGl2ICh3aWR0aCAmIGhlaWdodCkuXG4gKiBAcmV0dXJucyBWYXJpb3VzIGZpbmFsIG1ldHJpY3MsIGluY2x1ZGluZyByZW5kZXJlZCBwb3NpdGlvbnMgZm9yIGRyb3AtZG93blxuICogICAgIGFuZCBhcnJvdy5cbiAqL1xuZnVuY3Rpb24gZ2V0UG9zaXRpb25CZWxvd01ldHJpY3MoXG4gICAgcHJpbWFyeVg6IG51bWJlciwgcHJpbWFyeVk6IG51bWJlciwgYm91bmRzSW5mbzogQm91bmRzSW5mbyxcbiAgICBkaXZTaXplOiBTaXplKTogUG9zaXRpb25NZXRyaWNzIHtcbiAgY29uc3QgeENvb3JkcyA9XG4gICAgICBnZXRQb3NpdGlvblgocHJpbWFyeVgsIGJvdW5kc0luZm8ubGVmdCwgYm91bmRzSW5mby5yaWdodCwgZGl2U2l6ZS53aWR0aCk7XG5cbiAgY29uc3QgYXJyb3dZID0gLShBUlJPV19TSVpFIC8gMiArIEJPUkRFUl9TSVpFKTtcbiAgY29uc3QgZmluYWxZID0gcHJpbWFyeVkgKyBQQURESU5HX1k7XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0aWFsWDogeENvb3Jkcy5kaXZYLFxuICAgIGluaXRpYWxZOiBwcmltYXJ5WSxcbiAgICBmaW5hbFg6IHhDb29yZHMuZGl2WCwgIC8vIFggcG9zaXRpb24gcmVtYWlucyBjb25zdGFudCBkdXJpbmcgYW5pbWF0aW9uLlxuICAgIGZpbmFsWSxcbiAgICBhcnJvd1g6IHhDb29yZHMuYXJyb3dYLFxuICAgIGFycm93WSxcbiAgICBhcnJvd0F0VG9wOiB0cnVlLFxuICAgIGFycm93VmlzaWJsZTogdHJ1ZSxcbiAgfTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIG1ldHJpY3MgZm9yIHBvc2l0aW9uaW5nIHRoZSBkaXYgYWJvdmUgdGhlIHNvdXJjZS5cbiAqXG4gKiBAcGFyYW0gc2Vjb25kYXJ5WCBTZWNvbmRhcnkvYWx0ZXJuYXRpdmUgb3JpZ2luIHBvaW50IHgsIGluIGFic29sdXRlIHB4LlxuICogQHBhcmFtIHNlY29uZGFyeVkgU2Vjb25kYXJ5L2FsdGVybmF0aXZlIG9yaWdpbiBwb2ludCB5LCBpbiBhYnNvbHV0ZSBweC5cbiAqIEBwYXJhbSBib3VuZHNJbmZvIEFuIG9iamVjdCBjb250YWluaW5nIHNpemUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGJvdW5kaW5nXG4gKiAgICAgZWxlbWVudCAoYm91bmRpbmcgYm94IGFuZCB3aWR0aC9oZWlnaHQpLlxuICogQHBhcmFtIGRpdlNpemUgQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNpemUgb2YgdGhlXG4gKiAgICAgRHJvcERvd25EaXYgKHdpZHRoICYgaGVpZ2h0KS5cbiAqIEByZXR1cm5zIFZhcmlvdXMgZmluYWwgbWV0cmljcywgaW5jbHVkaW5nIHJlbmRlcmVkIHBvc2l0aW9ucyBmb3IgZHJvcC1kb3duXG4gKiAgICAgYW5kIGFycm93LlxuICovXG5mdW5jdGlvbiBnZXRQb3NpdGlvbkFib3ZlTWV0cmljcyhcbiAgICBzZWNvbmRhcnlYOiBudW1iZXIsIHNlY29uZGFyeVk6IG51bWJlciwgYm91bmRzSW5mbzogQm91bmRzSW5mbyxcbiAgICBkaXZTaXplOiBTaXplKTogUG9zaXRpb25NZXRyaWNzIHtcbiAgY29uc3QgeENvb3JkcyA9IGdldFBvc2l0aW9uWChcbiAgICAgIHNlY29uZGFyeVgsIGJvdW5kc0luZm8ubGVmdCwgYm91bmRzSW5mby5yaWdodCwgZGl2U2l6ZS53aWR0aCk7XG5cbiAgY29uc3QgYXJyb3dZID0gZGl2U2l6ZS5oZWlnaHQgLSBCT1JERVJfU0laRSAqIDIgLSBBUlJPV19TSVpFIC8gMjtcbiAgY29uc3QgZmluYWxZID0gc2Vjb25kYXJ5WSAtIGRpdlNpemUuaGVpZ2h0IC0gUEFERElOR19ZO1xuICBjb25zdCBpbml0aWFsWSA9IHNlY29uZGFyeVkgLSBkaXZTaXplLmhlaWdodDsgIC8vIE5vIHBhZGRpbmcgb24gWS5cblxuICByZXR1cm4ge1xuICAgIGluaXRpYWxYOiB4Q29vcmRzLmRpdlgsXG4gICAgaW5pdGlhbFksXG4gICAgZmluYWxYOiB4Q29vcmRzLmRpdlgsICAvLyBYIHBvc2l0aW9uIHJlbWFpbnMgY29uc3RhbnQgZHVyaW5nIGFuaW1hdGlvbi5cbiAgICBmaW5hbFksXG4gICAgYXJyb3dYOiB4Q29vcmRzLmFycm93WCxcbiAgICBhcnJvd1ksXG4gICAgYXJyb3dBdFRvcDogZmFsc2UsXG4gICAgYXJyb3dWaXNpYmxlOiB0cnVlLFxuICB9O1xufVxuXG4vKipcbiAqIEdldCB0aGUgbWV0cmljcyBmb3IgcG9zaXRpb25pbmcgdGhlIGRpdiBhdCB0aGUgdG9wIG9mIHRoZSBwYWdlLlxuICpcbiAqIEBwYXJhbSBzb3VyY2VYIERlc2lyZWQgb3JpZ2luIHBvaW50IHgsIGluIGFic29sdXRlIHB4LlxuICogQHBhcmFtIGJvdW5kc0luZm8gQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6ZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYm91bmRpbmdcbiAqICAgICBlbGVtZW50IChib3VuZGluZyBib3ggYW5kIHdpZHRoL2hlaWdodCkuXG4gKiBAcGFyYW0gZGl2U2l6ZSBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2l6ZSBvZiB0aGVcbiAqICAgICBEcm9wRG93bkRpdiAod2lkdGggJiBoZWlnaHQpLlxuICogQHJldHVybnMgVmFyaW91cyBmaW5hbCBtZXRyaWNzLCBpbmNsdWRpbmcgcmVuZGVyZWQgcG9zaXRpb25zIGZvciBkcm9wLWRvd25cbiAqICAgICBhbmQgYXJyb3cuXG4gKi9cbmZ1bmN0aW9uIGdldFBvc2l0aW9uVG9wT2ZQYWdlTWV0cmljcyhcbiAgICBzb3VyY2VYOiBudW1iZXIsIGJvdW5kc0luZm86IEJvdW5kc0luZm8sIGRpdlNpemU6IFNpemUpOiBQb3NpdGlvbk1ldHJpY3Mge1xuICBjb25zdCB4Q29vcmRzID1cbiAgICAgIGdldFBvc2l0aW9uWChzb3VyY2VYLCBib3VuZHNJbmZvLmxlZnQsIGJvdW5kc0luZm8ucmlnaHQsIGRpdlNpemUud2lkdGgpO1xuXG4gIC8vIE5vIG5lZWQgdG8gcHJvdmlkZSBhcnJvdy1zcGVjaWZpYyBpbmZvcm1hdGlvbiBiZWNhdXNlIGl0IHdvbid0IGJlIHZpc2libGUuXG4gIHJldHVybiB7XG4gICAgaW5pdGlhbFg6IHhDb29yZHMuZGl2WCxcbiAgICBpbml0aWFsWTogMCxcbiAgICBmaW5hbFg6IHhDb29yZHMuZGl2WCwgIC8vIFggcG9zaXRpb24gcmVtYWlucyBjb25zdGFudCBkdXJpbmcgYW5pbWF0aW9uLlxuICAgIGZpbmFsWTogMCwgICAgICAgICAgICAgLy8gWSBwb3NpdGlvbiByZW1haW5zIGNvbnN0YW50IGR1cmluZyBhbmltYXRpb24uXG4gICAgYXJyb3dBdFRvcDogbnVsbCxcbiAgICBhcnJvd1g6IG51bGwsXG4gICAgYXJyb3dZOiBudWxsLFxuICAgIGFycm93VmlzaWJsZTogZmFsc2UsXG4gIH07XG59XG5cbi8qKlxuICogR2V0IHRoZSB4IHBvc2l0aW9ucyBmb3IgdGhlIGxlZnQgc2lkZSBvZiB0aGUgRHJvcERvd25EaXYgYW5kIHRoZSBhcnJvdyxcbiAqIGFjY291bnRpbmcgZm9yIHRoZSBib3VuZHMgb2YgdGhlIHdvcmtzcGFjZS5cbiAqXG4gKiBAcGFyYW0gc291cmNlWCBEZXNpcmVkIG9yaWdpbiBwb2ludCB4LCBpbiBhYnNvbHV0ZSBweC5cbiAqIEBwYXJhbSBib3VuZHNMZWZ0IFRoZSBsZWZ0IGVkZ2Ugb2YgdGhlIGJvdW5kaW5nIGVsZW1lbnQsIGluIGFic29sdXRlIHB4LlxuICogQHBhcmFtIGJvdW5kc1JpZ2h0IFRoZSByaWdodCBlZGdlIG9mIHRoZSBib3VuZGluZyBlbGVtZW50LCBpbiBhYnNvbHV0ZSBweC5cbiAqIEBwYXJhbSBkaXZXaWR0aCBUaGUgd2lkdGggb2YgdGhlIGRpdiBpbiBweC5cbiAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIG1ldHJpY3MgZm9yIHRoZSB4IHBvc2l0aW9ucyBvZiB0aGUgbGVmdCBzaWRlIG9mXG4gKiAgICAgdGhlIERyb3BEb3duRGl2IGFuZCB0aGUgYXJyb3cuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFBvc2l0aW9uWChcbiAgICBzb3VyY2VYOiBudW1iZXIsIGJvdW5kc0xlZnQ6IG51bWJlciwgYm91bmRzUmlnaHQ6IG51bWJlcixcbiAgICBkaXZXaWR0aDogbnVtYmVyKToge2Rpdlg6IG51bWJlciwgYXJyb3dYOiBudW1iZXJ9IHtcbiAgbGV0IGRpdlggPSBzb3VyY2VYO1xuICAvLyBPZmZzZXQgdGhlIHRvcExlZnQgY29vcmQgc28gdGhhdCB0aGUgZHJvcGRvd25kaXYgaXMgY2VudGVyZWQuXG4gIGRpdlggLT0gZGl2V2lkdGggLyAyO1xuICAvLyBGaXQgdGhlIGRyb3Bkb3duZGl2IHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoZSB3b3Jrc3BhY2UuXG4gIGRpdlggPSBtYXRoLmNsYW1wKGJvdW5kc0xlZnQsIGRpdlgsIGJvdW5kc1JpZ2h0IC0gZGl2V2lkdGgpO1xuXG4gIGxldCBhcnJvd1ggPSBzb3VyY2VYO1xuICAvLyBPZmZzZXQgdGhlIGFycm93IGNvb3JkIHNvIHRoYXQgdGhlIGFycm93IGlzIGNlbnRlcmVkLlxuICBhcnJvd1ggLT0gQVJST1dfU0laRSAvIDI7XG4gIC8vIENvbnZlcnQgdGhlIGFycm93IHBvc2l0aW9uIHRvIGJlIHJlbGF0aXZlIHRvIHRoZSB0b3AgbGVmdCBvZiB0aGUgZGl2LlxuICBsZXQgcmVsYXRpdmVBcnJvd1ggPSBhcnJvd1ggLSBkaXZYO1xuICBjb25zdCBob3JpelBhZGRpbmcgPSBBUlJPV19IT1JJWk9OVEFMX1BBRERJTkc7XG4gIC8vIENsYW1wIHRoZSBhcnJvdyBwb3NpdGlvbiBzbyB0aGF0IGl0IHN0YXlzIGF0dGFjaGVkIHRvIHRoZSBkcm9wZG93bmRpdi5cbiAgcmVsYXRpdmVBcnJvd1ggPSBtYXRoLmNsYW1wKFxuICAgICAgaG9yaXpQYWRkaW5nLCByZWxhdGl2ZUFycm93WCwgZGl2V2lkdGggLSBob3JpelBhZGRpbmcgLSBBUlJPV19TSVpFKTtcblxuICByZXR1cm4ge2Fycm93WDogcmVsYXRpdmVBcnJvd1gsIGRpdlh9O1xufVxuXG4vKipcbiAqIElzIHRoZSBjb250YWluZXIgdmlzaWJsZT9cbiAqXG4gKiBAcmV0dXJucyBUcnVlIGlmIHZpc2libGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1Zpc2libGUoKTogYm9vbGVhbiB7XG4gIHJldHVybiAhIW93bmVyO1xufVxuXG4vKipcbiAqIEhpZGUgdGhlIG1lbnUgb25seSBpZiBpdCBpcyBvd25lZCBieSB0aGUgcHJvdmlkZWQgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSBkaXZPd25lciBPYmplY3Qgd2hpY2ggbXVzdCBiZSBvd25pbmcgdGhlIGRyb3AtZG93biB0byBoaWRlLlxuICogQHBhcmFtIG9wdF93aXRob3V0QW5pbWF0aW9uIFRydWUgaWYgd2Ugc2hvdWxkIGhpZGUgdGhlIGRyb3Bkb3duIHdpdGhvdXRcbiAqICAgICBhbmltYXRpbmcuXG4gKiBAcmV0dXJucyBUcnVlIGlmIGhpZGRlbi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGVJZk93bmVyPFQ+KFxuICAgIGRpdk93bmVyOiBGaWVsZDxUPiwgb3B0X3dpdGhvdXRBbmltYXRpb24/OiBib29sZWFuKTogYm9vbGVhbiB7XG4gIGlmIChvd25lciA9PT0gZGl2T3duZXIpIHtcbiAgICBpZiAob3B0X3dpdGhvdXRBbmltYXRpb24pIHtcbiAgICAgIGhpZGVXaXRob3V0QW5pbWF0aW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhpZGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKiogSGlkZSB0aGUgbWVudSwgdHJpZ2dlcmluZyBhbmltYXRpb24uICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZSgpIHtcbiAgLy8gU3RhcnQgdGhlIGFuaW1hdGlvbiBieSBzZXR0aW5nIHRoZSB0cmFuc2xhdGlvbiBhbmQgZmFkaW5nIG91dC5cbiAgLy8gUmVzZXQgdG8gKGluaXRpYWxYLCBpbml0aWFsWSkgLSBpLmUuLCBubyB0cmFuc2xhdGlvbi5cbiAgZGl2LnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoMCwgMCknO1xuICBkaXYuc3R5bGUub3BhY2l0eSA9ICcwJztcbiAgLy8gRmluaXNoIGFuaW1hdGlvbiAtIHJlc2V0IGFsbCB2YWx1ZXMgdG8gZGVmYXVsdC5cbiAgYW5pbWF0ZU91dFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICBoaWRlV2l0aG91dEFuaW1hdGlvbigpO1xuICB9LCBBTklNQVRJT05fVElNRSAqIDEwMDApO1xuICBpZiAob25IaWRlKSB7XG4gICAgb25IaWRlKCk7XG4gICAgb25IaWRlID0gbnVsbDtcbiAgfVxufVxuXG4vKiogSGlkZSB0aGUgbWVudSwgd2l0aG91dCBhbmltYXRpb24uICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZVdpdGhvdXRBbmltYXRpb24oKSB7XG4gIGlmICghaXNWaXNpYmxlKCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGFuaW1hdGVPdXRUaW1lcikge1xuICAgIGNsZWFyVGltZW91dChhbmltYXRlT3V0VGltZXIpO1xuICB9XG5cbiAgLy8gUmVzZXQgc3R5bGUgcHJvcGVydGllcyBpbiBjYXNlIHRoaXMgZ2V0cyBjYWxsZWQgZGlyZWN0bHlcbiAgLy8gaW5zdGVhZCBvZiBoaWRlKCkgLSBzZWUgZGlzY3Vzc2lvbiBvbiAjMjU1MS5cbiAgZGl2LnN0eWxlLnRyYW5zZm9ybSA9ICcnO1xuICBkaXYuc3R5bGUubGVmdCA9ICcnO1xuICBkaXYuc3R5bGUudG9wID0gJyc7XG4gIGRpdi5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuICBkaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgZGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcnO1xuICBkaXYuc3R5bGUuYm9yZGVyQ29sb3IgPSAnJztcblxuICBpZiAob25IaWRlKSB7XG4gICAgb25IaWRlKCk7XG4gICAgb25IaWRlID0gbnVsbDtcbiAgfVxuICBjbGVhckNvbnRlbnQoKTtcbiAgb3duZXIgPSBudWxsO1xuXG4gIGlmIChyZW5kZXJlZENsYXNzTmFtZSkge1xuICAgIGRvbS5yZW1vdmVDbGFzcyhkaXYsIHJlbmRlcmVkQ2xhc3NOYW1lKTtcbiAgICByZW5kZXJlZENsYXNzTmFtZSA9ICcnO1xuICB9XG4gIGlmICh0aGVtZUNsYXNzTmFtZSkge1xuICAgIGRvbS5yZW1vdmVDbGFzcyhkaXYsIHRoZW1lQ2xhc3NOYW1lKTtcbiAgICB0aGVtZUNsYXNzTmFtZSA9ICcnO1xuICB9XG4gIChjb21tb24uZ2V0TWFpbldvcmtzcGFjZSgpIGFzIFdvcmtzcGFjZVN2ZykubWFya0ZvY3VzZWQoKTtcbn1cblxuLyoqXG4gKiBTZXQgdGhlIGRyb3Bkb3duIGRpdidzIHBvc2l0aW9uLlxuICpcbiAqIEBwYXJhbSBwcmltYXJ5WCBEZXNpcmVkIG9yaWdpbiBwb2ludCB4LCBpbiBhYnNvbHV0ZSBweC5cbiAqIEBwYXJhbSBwcmltYXJ5WSBEZXNpcmVkIG9yaWdpbiBwb2ludCB5LCBpbiBhYnNvbHV0ZSBweC5cbiAqIEBwYXJhbSBzZWNvbmRhcnlYIFNlY29uZGFyeS9hbHRlcm5hdGl2ZSBvcmlnaW4gcG9pbnQgeCwgaW4gYWJzb2x1dGUgcHguXG4gKiBAcGFyYW0gc2Vjb25kYXJ5WSBTZWNvbmRhcnkvYWx0ZXJuYXRpdmUgb3JpZ2luIHBvaW50IHksIGluIGFic29sdXRlIHB4LlxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbWVudSByZW5kZXJlZCBhdCB0aGUgcHJpbWFyeSBvcmlnaW4gcG9pbnQuXG4gKi9cbmZ1bmN0aW9uIHBvc2l0aW9uSW50ZXJuYWwoXG4gICAgcHJpbWFyeVg6IG51bWJlciwgcHJpbWFyeVk6IG51bWJlciwgc2Vjb25kYXJ5WDogbnVtYmVyLFxuICAgIHNlY29uZGFyeVk6IG51bWJlcik6IGJvb2xlYW4ge1xuICBjb25zdCBtZXRyaWNzID1cbiAgICAgIGludGVybmFsLmdldFBvc2l0aW9uTWV0cmljcyhwcmltYXJ5WCwgcHJpbWFyeVksIHNlY29uZGFyeVgsIHNlY29uZGFyeVkpO1xuXG4gIC8vIFVwZGF0ZSBhcnJvdyBDU1MuXG4gIGlmIChtZXRyaWNzLmFycm93VmlzaWJsZSkge1xuICAgIGFycm93LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICBhcnJvdy5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlKCcgKyBtZXRyaWNzLmFycm93WCArICdweCwnICtcbiAgICAgICAgbWV0cmljcy5hcnJvd1kgKyAncHgpIHJvdGF0ZSg0NWRlZyknO1xuICAgIGFycm93LnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ2NsYXNzJyxcbiAgICAgICAgbWV0cmljcy5hcnJvd0F0VG9wID8gJ2Jsb2NrbHlEcm9wRG93bkFycm93IGJsb2NrbHlBcnJvd1RvcCcgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmxvY2tseURyb3BEb3duQXJyb3cgYmxvY2tseUFycm93Qm90dG9tJyk7XG4gIH0gZWxzZSB7XG4gICAgYXJyb3cuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgfVxuXG4gIGNvbnN0IGluaXRpYWxYID0gTWF0aC5mbG9vcihtZXRyaWNzLmluaXRpYWxYKTtcbiAgY29uc3QgaW5pdGlhbFkgPSBNYXRoLmZsb29yKG1ldHJpY3MuaW5pdGlhbFkpO1xuICBjb25zdCBmaW5hbFggPSBNYXRoLmZsb29yKG1ldHJpY3MuZmluYWxYKTtcbiAgY29uc3QgZmluYWxZID0gTWF0aC5mbG9vcihtZXRyaWNzLmZpbmFsWSk7XG5cbiAgLy8gRmlyc3QgYXBwbHkgaW5pdGlhbCB0cmFuc2xhdGlvbi5cbiAgZGl2LnN0eWxlLmxlZnQgPSBpbml0aWFsWCArICdweCc7XG4gIGRpdi5zdHlsZS50b3AgPSBpbml0aWFsWSArICdweCc7XG5cbiAgLy8gU2hvdyB0aGUgZGl2LlxuICBkaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIGRpdi5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAvLyBBZGQgZmluYWwgdHJhbnNsYXRlLCBhbmltYXRlZCB0aHJvdWdoIGB0cmFuc2l0aW9uYC5cbiAgLy8gQ29vcmRpbmF0ZXMgYXJlIHJlbGF0aXZlIHRvIChpbml0aWFsWCwgaW5pdGlhbFkpLFxuICAvLyB3aGVyZSB0aGUgZHJvcC1kb3duIGlzIGFic29sdXRlbHkgcG9zaXRpb25lZC5cbiAgY29uc3QgZHggPSBmaW5hbFggLSBpbml0aWFsWDtcbiAgY29uc3QgZHkgPSBmaW5hbFkgLSBpbml0aWFsWTtcbiAgZGl2LnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArIGR4ICsgJ3B4LCcgKyBkeSArICdweCknO1xuXG4gIHJldHVybiAhIW1ldHJpY3MuYXJyb3dBdFRvcDtcbn1cblxuLyoqXG4gKiBSZXBvc2l0aW9ucyB0aGUgZHJvcGRvd25EaXYgb24gd2luZG93IHJlc2l6ZS4gSWYgaXQgZG9lc24ndCBrbm93IGhvdyB0b1xuICogY2FsY3VsYXRlIHRoZSBuZXcgcG9zaXRpb24sIGl0IHdpbGwganVzdCBoaWRlIGl0IGluc3RlYWQuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXBvc2l0aW9uRm9yV2luZG93UmVzaXplKCkge1xuICAvLyBUaGlzIGNvbmRpdGlvbiBtYWlubHkgY2F0Y2hlcyB0aGUgZHJvcGRvd24gZGl2IHdoZW4gaXQgaXMgYmVpbmcgdXNlZCBhcyBhXG4gIC8vIGRyb3Bkb3duLiAgSXQgaXMgaW1wb3J0YW50IG5vdCB0byBjbG9zZSBpdCBpbiB0aGlzIGNhc2UgYmVjYXVzZSBvbiBBbmRyb2lkLFxuICAvLyB3aGVuIGEgZmllbGQgaXMgZm9jdXNlZCwgdGhlIHNvZnQga2V5Ym9hcmQgb3BlbnMgdHJpZ2dlcmluZyBhIHdpbmRvdyByZXNpemVcbiAgLy8gZXZlbnQgYW5kIHdlIHdhbnQgdGhlIGRyb3Bkb3duIGRpdiB0byBzdGljayBhcm91bmQgc28gdXNlcnMgY2FuIHR5cGUgaW50b1xuICAvLyBpdC5cbiAgaWYgKG93bmVyKSB7XG4gICAgY29uc3QgYmxvY2sgPSBvd25lci5nZXRTb3VyY2VCbG9jaygpIGFzIEJsb2NrU3ZnO1xuICAgIGNvbnN0IGJCb3ggPSBwb3NpdGlvblRvRmllbGQgPyBnZXRTY2FsZWRCYm94T2ZGaWVsZChvd25lcikgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRTY2FsZWRCYm94T2ZCbG9jayhibG9jayk7XG4gICAgLy8gSWYgd2UgY2FuIGZpdCBpdCwgcmVuZGVyIGJlbG93IHRoZSBibG9jay5cbiAgICBjb25zdCBwcmltYXJ5WCA9IGJCb3gubGVmdCArIChiQm94LnJpZ2h0IC0gYkJveC5sZWZ0KSAvIDI7XG4gICAgY29uc3QgcHJpbWFyeVkgPSBiQm94LmJvdHRvbTtcbiAgICAvLyBJZiB3ZSBjYW4ndCBmaXQgaXQsIHJlbmRlciBhYm92ZSB0aGUgZW50aXJlIHBhcmVudCBibG9jay5cbiAgICBjb25zdCBzZWNvbmRhcnlYID0gcHJpbWFyeVg7XG4gICAgY29uc3Qgc2Vjb25kYXJ5WSA9IGJCb3gudG9wO1xuICAgIHBvc2l0aW9uSW50ZXJuYWwocHJpbWFyeVgsIHByaW1hcnlZLCBzZWNvbmRhcnlYLCBzZWNvbmRhcnlZKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlKCk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IGludGVybmFsO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRoaXMgZmlsZSBpcyBhIHVuaXZlcnNhbCByZWdpc3RyeSB0aGF0IHByb3ZpZGVzIGdlbmVyaWMgbWV0aG9kc1xuICogICAgZm9yIHJlZ2lzdGVyaW5nIGFuZCB1bnJlZ2lzdGVyaW5nIGRpZmZlcmVudCB0eXBlcyBvZiBjbGFzc2VzLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5yZWdpc3RyeVxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnJlZ2lzdHJ5Jyk7XG5cbmltcG9ydCB0eXBlIHtBYnN0cmFjdH0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB0eXBlIHtGaWVsZH0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgdHlwZSB7SUJsb2NrRHJhZ2dlcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYmxvY2tfZHJhZ2dlci5qcyc7XG5pbXBvcnQgdHlwZSB7SUNvbm5lY3Rpb25DaGVja2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9jb25uZWN0aW9uX2NoZWNrZXIuanMnO1xuaW1wb3J0IHR5cGUge0lGbHlvdXR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2ZseW91dC5qcyc7XG5pbXBvcnQgdHlwZSB7SU1ldHJpY3NNYW5hZ2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge0lTZXJpYWxpemVyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9zZXJpYWxpemVyLmpzJztcbmltcG9ydCB0eXBlIHtJVG9vbGJveH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfdG9vbGJveC5qcyc7XG5pbXBvcnQgdHlwZSB7Q3Vyc29yfSBmcm9tICcuL2tleWJvYXJkX25hdi9jdXJzb3IuanMnO1xuaW1wb3J0IHR5cGUge09wdGlvbnN9IGZyb20gJy4vb3B0aW9ucy5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVyZXJ9IGZyb20gJy4vcmVuZGVyZXJzL2NvbW1vbi9yZW5kZXJlci5qcyc7XG5pbXBvcnQgdHlwZSB7VGhlbWV9IGZyb20gJy4vdGhlbWUuanMnO1xuaW1wb3J0IHR5cGUge1Rvb2xib3hJdGVtfSBmcm9tICcuL3Rvb2xib3gvdG9vbGJveF9pdGVtLmpzJztcblxuXG4vKipcbiAqIEEgbWFwIG9mIG1hcHMuIFdpdGggdGhlIGtleXMgYmVpbmcgdGhlIHR5cGUgYW5kIG5hbWUgb2YgdGhlIGNsYXNzIHdlIGFyZVxuICogcmVnaXN0ZXJpbmcgYW5kIHRoZSB2YWx1ZSBiZWluZyB0aGUgY29uc3RydWN0b3IgZnVuY3Rpb24uXG4gKiBlLmcuIHsnZmllbGQnOiB7J2ZpZWxkX2FuZ2xlJzogQmxvY2tseS5GaWVsZEFuZ2xlfX1cbiAqL1xuY29uc3QgdHlwZU1hcDoge1xuICBba2V5OiBzdHJpbmddOlxuICAgICAge1trZXk6IHN0cmluZ106IChuZXcgKCkgPT4gQW55RHVyaW5nTWlncmF0aW9uKXxBbnlEdXJpbmdNaWdyYXRpb259XG59ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbmV4cG9ydCBjb25zdCBURVNUX09OTFkgPSB7dHlwZU1hcH07XG5cbi8qKlxuICogQSBtYXAgb2YgbWFwcy4gV2l0aCB0aGUga2V5cyBiZWluZyB0aGUgdHlwZSBhbmQgY2FzZWxlc3MgbmFtZSBvZiB0aGUgY2xhc3Mgd2VcbiAqIGFyZSByZWdpc3RyaW5nLCBhbmQgdGhlIHZhbHVlIGJlaW5nIHRoZSBtb3N0IHJlY2VudCBjYXNlZCBuYW1lIGZvciB0aGF0XG4gKiByZWdpc3RyYXRpb24uXG4gKi9cbmNvbnN0IG5hbWVNYXA6IHtba2V5OiBzdHJpbmddOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfX0gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4vKipcbiAqIFRoZSBzdHJpbmcgdXNlZCB0byByZWdpc3RlciB0aGUgZGVmYXVsdCBjbGFzcyBmb3IgYSB0eXBlIG9mIHBsdWdpbi5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5yZWdpc3RyeS5ERUZBVUxUXG4gKi9cbmV4cG9ydCBjb25zdCBERUZBVUxUID0gJ2RlZmF1bHQnO1xuXG4vKipcbiAqIEEgbmFtZSB3aXRoIHRoZSB0eXBlIG9mIHRoZSBlbGVtZW50IHN0b3JlZCBpbiB0aGUgZ2VuZXJpYy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5yZWdpc3RyeS5UeXBlXG4gKi9cbmV4cG9ydCBjbGFzcyBUeXBlPF9UPiB7XG4gIC8qKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVnaXN0cnkgdHlwZS4gKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBuYW1lOiBzdHJpbmcpIHt9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG5hbWUgb2YgdGhlIHR5cGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuYW1lLlxuICAgKi9cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5uYW1lO1xuICB9XG5cbiAgc3RhdGljIENPTk5FQ1RJT05fQ0hFQ0tFUiA9IG5ldyBUeXBlPElDb25uZWN0aW9uQ2hlY2tlcj4oJ2Nvbm5lY3Rpb25DaGVja2VyJyk7XG5cbiAgc3RhdGljIENVUlNPUiA9IG5ldyBUeXBlPEN1cnNvcj4oJ2N1cnNvcicpO1xuXG4gIHN0YXRpYyBFVkVOVCA9IG5ldyBUeXBlPEFic3RyYWN0PignZXZlbnQnKTtcblxuICBzdGF0aWMgRklFTEQgPSBuZXcgVHlwZTxGaWVsZD4oJ2ZpZWxkJyk7XG5cbiAgc3RhdGljIFJFTkRFUkVSID0gbmV3IFR5cGU8UmVuZGVyZXI+KCdyZW5kZXJlcicpO1xuXG4gIHN0YXRpYyBUT09MQk9YID0gbmV3IFR5cGU8SVRvb2xib3g+KCd0b29sYm94Jyk7XG5cbiAgc3RhdGljIFRIRU1FID0gbmV3IFR5cGU8VGhlbWU+KCd0aGVtZScpO1xuXG4gIHN0YXRpYyBUT09MQk9YX0lURU0gPSBuZXcgVHlwZTxUb29sYm94SXRlbT4oJ3Rvb2xib3hJdGVtJyk7XG5cbiAgc3RhdGljIEZMWU9VVFNfVkVSVElDQUxfVE9PTEJPWCA9IG5ldyBUeXBlPElGbHlvdXQ+KCdmbHlvdXRzVmVydGljYWxUb29sYm94Jyk7XG5cbiAgc3RhdGljIEZMWU9VVFNfSE9SSVpPTlRBTF9UT09MQk9YID1cbiAgICAgIG5ldyBUeXBlPElGbHlvdXQ+KCdmbHlvdXRzSG9yaXpvbnRhbFRvb2xib3gnKTtcblxuICBzdGF0aWMgTUVUUklDU19NQU5BR0VSID0gbmV3IFR5cGU8SU1ldHJpY3NNYW5hZ2VyPignbWV0cmljc01hbmFnZXInKTtcblxuICBzdGF0aWMgQkxPQ0tfRFJBR0dFUiA9IG5ldyBUeXBlPElCbG9ja0RyYWdnZXI+KCdibG9ja0RyYWdnZXInKTtcblxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBTRVJJQUxJWkVSID0gbmV3IFR5cGU8SVNlcmlhbGl6ZXI+KCdzZXJpYWxpemVyJyk7XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGEgY2xhc3MgYmFzZWQgb24gYSB0eXBlIGFuZCBuYW1lLlxuICpcbiAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBwbHVnaW4uXG4gKiAgICAgKGUuZy4gRmllbGQsIFJlbmRlcmVyKVxuICogQHBhcmFtIG5hbWUgVGhlIHBsdWdpbidzIG5hbWUuIChFeC4gZmllbGRfYW5nbGUsIGdlcmFzKVxuICogQHBhcmFtIHJlZ2lzdHJ5SXRlbSBUaGUgY2xhc3Mgb3Igb2JqZWN0IHRvIHJlZ2lzdGVyLlxuICogQHBhcmFtIG9wdF9hbGxvd092ZXJyaWRlcyBUcnVlIHRvIHByZXZlbnQgYW4gZXJyb3Igd2hlbiBvdmVycmlkaW5nIGFuIGFscmVhZHlcbiAqICAgICByZWdpc3RlcmVkIGl0ZW0uXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlIHR5cGUgb3IgbmFtZSBpcyBlbXB0eSwgYSBuYW1lIHdpdGggdGhlIGdpdmVuIHR5cGUgaGFzXG4gKiAgICAgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQsIG9yIGlmIHRoZSBnaXZlbiBjbGFzcyBvciBvYmplY3QgaXMgbm90IHZhbGlkIGZvclxuICogICAgIGl0cyB0eXBlLlxuICogQGFsaWFzIEJsb2NrbHkucmVnaXN0cnkucmVnaXN0ZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyPFQ+KFxuICAgIHR5cGU6IHN0cmluZ3xUeXBlPFQ+LCBuYW1lOiBzdHJpbmcsXG4gICAgcmVnaXN0cnlJdGVtOiAobmV3ICguLi5wMTogQW55RHVyaW5nTWlncmF0aW9uW10pID0+IFQpfG51bGx8XG4gICAgQW55RHVyaW5nTWlncmF0aW9uLFxuICAgIG9wdF9hbGxvd092ZXJyaWRlcz86IGJvb2xlYW4pOiB2b2lkIHtcbiAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIFR5cGUpICYmIHR5cGVvZiB0eXBlICE9PSAnc3RyaW5nJyB8fFxuICAgICAgU3RyaW5nKHR5cGUpLnRyaW0oKSA9PT0gJycpIHtcbiAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgJ0ludmFsaWQgdHlwZSBcIicgKyB0eXBlICsgJ1wiLiBUaGUgdHlwZSBtdXN0IGJlIGEnICtcbiAgICAgICAgJyBub24tZW1wdHkgc3RyaW5nIG9yIGEgQmxvY2tseS5yZWdpc3RyeS5UeXBlLicpO1xuICB9XG4gIHR5cGUgPSBTdHJpbmcodHlwZSkudG9Mb3dlckNhc2UoKTtcblxuICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnIHx8IG5hbWUudHJpbSgpID09PSAnJykge1xuICAgIHRocm93IEVycm9yKFxuICAgICAgICAnSW52YWxpZCBuYW1lIFwiJyArIG5hbWUgKyAnXCIuIFRoZSBuYW1lIG11c3QgYmUgYScgK1xuICAgICAgICAnIG5vbi1lbXB0eSBzdHJpbmcuJyk7XG4gIH1cbiAgY29uc3QgY2FzZWxlc3NOYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuICBpZiAoIXJlZ2lzdHJ5SXRlbSkge1xuICAgIHRocm93IEVycm9yKCdDYW4gbm90IHJlZ2lzdGVyIGEgbnVsbCB2YWx1ZScpO1xuICB9XG4gIGxldCB0eXBlUmVnaXN0cnkgPSB0eXBlTWFwW3R5cGVdO1xuICBsZXQgbmFtZVJlZ2lzdHJ5ID0gbmFtZU1hcFt0eXBlXTtcbiAgLy8gSWYgdGhlIHR5cGUgcmVnaXN0cnkgaGFzIG5vdCBiZWVuIGNyZWF0ZWQsIGNyZWF0ZSBpdC5cbiAgaWYgKCF0eXBlUmVnaXN0cnkpIHtcbiAgICB0eXBlUmVnaXN0cnkgPSB0eXBlTWFwW3R5cGVdID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICBuYW1lUmVnaXN0cnkgPSBuYW1lTWFwW3R5cGVdID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIHRoYXQgdGhlIGdpdmVuIGNsYXNzIGhhcyBhbGwgdGhlIHJlcXVpcmVkIHByb3BlcnRpZXMuXG4gIHZhbGlkYXRlKHR5cGUsIHJlZ2lzdHJ5SXRlbSk7XG5cbiAgLy8gRG9uJ3QgdGhyb3cgYW4gZXJyb3IgaWYgb3B0X2FsbG93T3ZlcnJpZGVzIGlzIHRydWUuXG4gIGlmICghb3B0X2FsbG93T3ZlcnJpZGVzICYmIHR5cGVSZWdpc3RyeVtjYXNlbGVzc05hbWVdKSB7XG4gICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICdOYW1lIFwiJyArIGNhc2VsZXNzTmFtZSArICdcIiB3aXRoIHR5cGUgXCInICsgdHlwZSArXG4gICAgICAgICdcIiBhbHJlYWR5IHJlZ2lzdGVyZWQuJyk7XG4gIH1cbiAgdHlwZVJlZ2lzdHJ5W2Nhc2VsZXNzTmFtZV0gPSByZWdpc3RyeUl0ZW07XG4gIG5hbWVSZWdpc3RyeVtjYXNlbGVzc05hbWVdID0gbmFtZTtcbn1cblxuLyoqXG4gKiBDaGVja3MgdGhlIGdpdmVuIHJlZ2lzdHJ5IGl0ZW0gZm9yIHByb3BlcnRpZXMgdGhhdCBhcmUgcmVxdWlyZWQgYmFzZWQgb24gdGhlXG4gKiB0eXBlLlxuICpcbiAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBwbHVnaW4uIChlLmcuIEZpZWxkLCBSZW5kZXJlcilcbiAqIEBwYXJhbSByZWdpc3RyeUl0ZW0gQSBjbGFzcyBvciBvYmplY3QgdGhhdCB3ZSBhcmUgY2hlY2tpbmcgZm9yIHRoZSByZXF1aXJlZFxuICogICAgIHByb3BlcnRpZXMuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlKHR5cGU6IHN0cmluZywgcmVnaXN0cnlJdGVtOiBGdW5jdGlvbnxBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBTdHJpbmcoVHlwZS5GSUVMRCk6XG4gICAgICBpZiAodHlwZW9mIHJlZ2lzdHJ5SXRlbS5mcm9tSnNvbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBFcnJvcignVHlwZSBcIicgKyB0eXBlICsgJ1wiIG11c3QgaGF2ZSBhIGZyb21Kc29uIGZ1bmN0aW9uJyk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgfVxufVxuXG4vKipcbiAqIFVucmVnaXN0ZXJzIHRoZSByZWdpc3RyeSBpdGVtIHdpdGggdGhlIGdpdmVuIHR5cGUgYW5kIG5hbWUuXG4gKlxuICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgdGhlIHBsdWdpbi5cbiAqICAgICAoZS5nLiBGaWVsZCwgUmVuZGVyZXIpXG4gKiBAcGFyYW0gbmFtZSBUaGUgcGx1Z2luJ3MgbmFtZS4gKEV4LiBmaWVsZF9hbmdsZSwgZ2VyYXMpXG4gKiBAYWxpYXMgQmxvY2tseS5yZWdpc3RyeS51bnJlZ2lzdGVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bnJlZ2lzdGVyPFQ+KHR5cGU6IHN0cmluZ3xUeXBlPFQ+LCBuYW1lOiBzdHJpbmcpIHtcbiAgdHlwZSA9IFN0cmluZyh0eXBlKS50b0xvd2VyQ2FzZSgpO1xuICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCB0eXBlUmVnaXN0cnkgPSB0eXBlTWFwW3R5cGVdO1xuICBpZiAoIXR5cGVSZWdpc3RyeSB8fCAhdHlwZVJlZ2lzdHJ5W25hbWVdKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgICAnVW5hYmxlIHRvIHVucmVnaXN0ZXIgWycgKyBuYW1lICsgJ11bJyArIHR5cGUgKyAnXSBmcm9tIHRoZSAnICtcbiAgICAgICAgJ3JlZ2lzdHJ5LicpO1xuICAgIHJldHVybjtcbiAgfVxuICBkZWxldGUgdHlwZU1hcFt0eXBlXVtuYW1lXTtcbiAgZGVsZXRlIG5hbWVNYXBbdHlwZV1bbmFtZV07XG59XG5cbi8qKlxuICogR2V0cyB0aGUgcmVnaXN0cnkgaXRlbSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIHR5cGUuIFRoaXMgY2FuIGJlIGVpdGhlciBhXG4gKiBjbGFzcyBvciBhbiBvYmplY3QuXG4gKlxuICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgdGhlIHBsdWdpbi5cbiAqICAgICAoZS5nLiBGaWVsZCwgUmVuZGVyZXIpXG4gKiBAcGFyYW0gbmFtZSBUaGUgcGx1Z2luJ3MgbmFtZS4gKEV4LiBmaWVsZF9hbmdsZSwgZ2VyYXMpXG4gKiBAcGFyYW0gb3B0X3Rocm93SWZNaXNzaW5nIFdoZXRoZXIgb3Igbm90IHRvIHRocm93IGFuIGVycm9yIGlmIHdlIGFyZSB1bmFibGVcbiAqICAgICB0byBmaW5kIHRoZSBwbHVnaW4uXG4gKiBAcmV0dXJucyBUaGUgY2xhc3Mgb3Igb2JqZWN0IHdpdGggdGhlIGdpdmVuIG5hbWUgYW5kIHR5cGUgb3IgbnVsbCBpZiBub25lXG4gKiAgICAgZXhpc3RzLlxuICovXG5mdW5jdGlvbiBnZXRJdGVtPFQ+KFxuICAgIHR5cGU6IHN0cmluZ3xUeXBlPFQ+LCBuYW1lOiBzdHJpbmcsIG9wdF90aHJvd0lmTWlzc2luZz86IGJvb2xlYW4pOlxuICAgIChuZXcgKC4uLnAxOiBBbnlEdXJpbmdNaWdyYXRpb25bXSkgPT4gVCl8bnVsbHxBbnlEdXJpbmdNaWdyYXRpb24ge1xuICB0eXBlID0gU3RyaW5nKHR5cGUpLnRvTG93ZXJDYXNlKCk7XG4gIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHR5cGVSZWdpc3RyeSA9IHR5cGVNYXBbdHlwZV07XG4gIGlmICghdHlwZVJlZ2lzdHJ5IHx8ICF0eXBlUmVnaXN0cnlbbmFtZV0pIHtcbiAgICBjb25zdCBtc2cgPSAnVW5hYmxlIHRvIGZpbmQgWycgKyBuYW1lICsgJ11bJyArIHR5cGUgKyAnXSBpbiB0aGUgcmVnaXN0cnkuJztcbiAgICBpZiAob3B0X3Rocm93SWZNaXNzaW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgbXNnICsgJyBZb3UgbXVzdCByZXF1aXJlIG9yIHJlZ2lzdGVyIGEgJyArIHR5cGUgKyAnIHBsdWdpbi4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKG1zZyk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHJldHVybiB0eXBlUmVnaXN0cnlbbmFtZV07XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgcmVnaXN0cnkgY29udGFpbnMgYW4gaXRlbSB3aXRoIHRoZSBnaXZlbiB0eXBlIGFuZFxuICogbmFtZS5cbiAqXG4gKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgcGx1Z2luLlxuICogICAgIChlLmcuIEZpZWxkLCBSZW5kZXJlcilcbiAqIEBwYXJhbSBuYW1lIFRoZSBwbHVnaW4ncyBuYW1lLiAoRXguIGZpZWxkX2FuZ2xlLCBnZXJhcylcbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHJlZ2lzdHJ5IGhhcyBhbiBpdGVtIHdpdGggdGhlIGdpdmVuIHR5cGUgYW5kIG5hbWUsIGZhbHNlXG4gKiAgICAgb3RoZXJ3aXNlLlxuICogQGFsaWFzIEJsb2NrbHkucmVnaXN0cnkuaGFzSXRlbVxuICovXG5leHBvcnQgZnVuY3Rpb24gaGFzSXRlbTxUPih0eXBlOiBzdHJpbmd8VHlwZTxUPiwgbmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHR5cGUgPSBTdHJpbmcodHlwZSkudG9Mb3dlckNhc2UoKTtcbiAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgdHlwZVJlZ2lzdHJ5ID0gdHlwZU1hcFt0eXBlXTtcbiAgaWYgKCF0eXBlUmVnaXN0cnkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuICEhdHlwZVJlZ2lzdHJ5W25hbWVdO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIGNsYXNzIGZvciB0aGUgZ2l2ZW4gbmFtZSBhbmQgdHlwZS5cbiAqXG4gKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgcGx1Z2luLlxuICogICAgIChlLmcuIEZpZWxkLCBSZW5kZXJlcilcbiAqIEBwYXJhbSBuYW1lIFRoZSBwbHVnaW4ncyBuYW1lLiAoRXguIGZpZWxkX2FuZ2xlLCBnZXJhcylcbiAqIEBwYXJhbSBvcHRfdGhyb3dJZk1pc3NpbmcgV2hldGhlciBvciBub3QgdG8gdGhyb3cgYW4gZXJyb3IgaWYgd2UgYXJlIHVuYWJsZVxuICogICAgIHRvIGZpbmQgdGhlIHBsdWdpbi5cbiAqIEByZXR1cm5zIFRoZSBjbGFzcyB3aXRoIHRoZSBnaXZlbiBuYW1lIGFuZCB0eXBlIG9yIG51bGwgaWYgbm9uZSBleGlzdHMuXG4gKiBAYWxpYXMgQmxvY2tseS5yZWdpc3RyeS5nZXRDbGFzc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xhc3M8VD4oXG4gICAgdHlwZTogc3RyaW5nfFR5cGU8VD4sIG5hbWU6IHN0cmluZywgb3B0X3Rocm93SWZNaXNzaW5nPzogYm9vbGVhbik6XG4gICAgKG5ldyAoLi4ucDE6IEFueUR1cmluZ01pZ3JhdGlvbltdKSA9PiBUKXxudWxsIHtcbiAgcmV0dXJuIGdldEl0ZW0odHlwZSwgbmFtZSwgb3B0X3Rocm93SWZNaXNzaW5nKSBhcyAoXG4gICAgICAgICAgICAgbmV3ICguLi5wMTogQW55RHVyaW5nTWlncmF0aW9uW10pID0+IFQpIHxcbiAgICAgIG51bGw7XG59XG5cbi8qKlxuICogR2V0cyB0aGUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gbmFtZSBhbmQgdHlwZS5cbiAqXG4gKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgcGx1Z2luLlxuICogICAgIChlLmcuIENhdGVnb3J5KVxuICogQHBhcmFtIG5hbWUgVGhlIHBsdWdpbidzIG5hbWUuIChFeC4gbG9naWNfY2F0ZWdvcnkpXG4gKiBAcGFyYW0gb3B0X3Rocm93SWZNaXNzaW5nIFdoZXRoZXIgb3Igbm90IHRvIHRocm93IGFuIGVycm9yIGlmIHdlIGFyZSB1bmFibGVcbiAqICAgICB0byBmaW5kIHRoZSBvYmplY3QuXG4gKiBAcmV0dXJucyBUaGUgb2JqZWN0IHdpdGggdGhlIGdpdmVuIG5hbWUgYW5kIHR5cGUgb3IgbnVsbCBpZiBub25lIGV4aXN0cy5cbiAqIEBhbGlhcyBCbG9ja2x5LnJlZ2lzdHJ5LmdldE9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0T2JqZWN0PFQ+KFxuICAgIHR5cGU6IHN0cmluZ3xUeXBlPFQ+LCBuYW1lOiBzdHJpbmcsIG9wdF90aHJvd0lmTWlzc2luZz86IGJvb2xlYW4pOiBUfG51bGwge1xuICByZXR1cm4gZ2V0SXRlbSh0eXBlLCBuYW1lLCBvcHRfdGhyb3dJZk1pc3NpbmcpIGFzIFQ7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIG1hcCBvZiBpdGVtcyByZWdpc3RlcmVkIHdpdGggdGhlIGdpdmVuIHR5cGUuXG4gKlxuICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgdGhlIHBsdWdpbi4gKGUuZy4gQ2F0ZWdvcnkpXG4gKiBAcGFyYW0gb3B0X2Nhc2VkIFdoZXRoZXIgb3Igbm90IHRvIHJldHVybiBhIG1hcCB3aXRoIGNhc2VkIGtleXMgKHJhdGhlciB0aGFuXG4gKiAgICAgY2FzZWxlc3Mga2V5cykuIEZhbHNlIGJ5IGRlZmF1bHQuXG4gKiBAcGFyYW0gb3B0X3Rocm93SWZNaXNzaW5nIFdoZXRoZXIgb3Igbm90IHRvIHRocm93IGFuIGVycm9yIGlmIHdlIGFyZSB1bmFibGVcbiAqICAgICB0byBmaW5kIHRoZSBvYmplY3QuIEZhbHNlIGJ5IGRlZmF1bHQuXG4gKiBAcmV0dXJucyBBIG1hcCBvZiBvYmplY3RzIHdpdGggdGhlIGdpdmVuIHR5cGUsIG9yIG51bGwgaWYgbm9uZSBleGlzdHMuXG4gKiBAYWxpYXMgQmxvY2tseS5yZWdpc3RyeS5nZXRBbGxJdGVtc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWxsSXRlbXM8VD4oXG4gICAgdHlwZTogc3RyaW5nfFR5cGU8VD4sIG9wdF9jYXNlZD86IGJvb2xlYW4sIG9wdF90aHJvd0lmTWlzc2luZz86IGJvb2xlYW4pOlxuICAgIHtba2V5OiBzdHJpbmddOiBUfG51bGx8KG5ldyAoLi4ucDE6IEFueUR1cmluZ01pZ3JhdGlvbltdKSA9PiBUKX18bnVsbCB7XG4gIHR5cGUgPSBTdHJpbmcodHlwZSkudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgdHlwZVJlZ2lzdHJ5ID0gdHlwZU1hcFt0eXBlXTtcbiAgaWYgKCF0eXBlUmVnaXN0cnkpIHtcbiAgICBjb25zdCBtc2cgPSBgVW5hYmxlIHRvIGZpbmQgWyR7dHlwZX1dIGluIHRoZSByZWdpc3RyeS5gO1xuICAgIGlmIChvcHRfdGhyb3dJZk1pc3NpbmcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHttc2d9IFlvdSBtdXN0IHJlcXVpcmUgb3IgcmVnaXN0ZXIgYSAke3R5cGV9IHBsdWdpbi5gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKG1zZyk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGlmICghb3B0X2Nhc2VkKSB7XG4gICAgcmV0dXJuIHR5cGVSZWdpc3RyeTtcbiAgfVxuICBjb25zdCBuYW1lUmVnaXN0cnkgPSBuYW1lTWFwW3R5cGVdO1xuICBjb25zdCBjYXNlZFJlZ2lzdHJ5ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHR5cGVSZWdpc3RyeSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG4gICAgY2FzZWRSZWdpc3RyeVtuYW1lUmVnaXN0cnlba2V5XV0gPSB0eXBlUmVnaXN0cnlba2V5XTtcbiAgfVxuICByZXR1cm4gY2FzZWRSZWdpc3RyeTtcbn1cblxuLyoqXG4gKiBHZXRzIHRoZSBjbGFzcyBmcm9tIEJsb2NrbHkgb3B0aW9ucyBmb3IgdGhlIGdpdmVuIHR5cGUuXG4gKiBUaGlzIGlzIHVzZWQgZm9yIHBsdWdpbnMgdGhhdCBvdmVycmlkZSBhIGJ1aWx0IGluIGZlYXR1cmUuIChlLmcuIFRvb2xib3gpXG4gKlxuICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgdGhlIHBsdWdpbi5cbiAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb24gb2JqZWN0IHRvIGNoZWNrIGZvciB0aGUgZ2l2ZW4gcGx1Z2luLlxuICogQHBhcmFtIG9wdF90aHJvd0lmTWlzc2luZyBXaGV0aGVyIG9yIG5vdCB0byB0aHJvdyBhbiBlcnJvciBpZiB3ZSBhcmUgdW5hYmxlXG4gKiAgICAgdG8gZmluZCB0aGUgcGx1Z2luLlxuICogQHJldHVybnMgVGhlIGNsYXNzIGZvciB0aGUgcGx1Z2luLlxuICogQGFsaWFzIEJsb2NrbHkucmVnaXN0cnkuZ2V0Q2xhc3NGcm9tT3B0aW9uc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xhc3NGcm9tT3B0aW9uczxUPihcbiAgICB0eXBlOiBUeXBlPFQ+LCBvcHRpb25zOiBPcHRpb25zLCBvcHRfdGhyb3dJZk1pc3Npbmc/OiBib29sZWFuKTpcbiAgICAobmV3ICguLi5wMTogQW55RHVyaW5nTWlncmF0aW9uW10pID0+IFQpfG51bGwge1xuICBjb25zdCB0eXBlTmFtZSA9IHR5cGUudG9TdHJpbmcoKTtcbiAgY29uc3QgcGx1Z2luID0gb3B0aW9ucy5wbHVnaW5zW3R5cGVOYW1lXSB8fCBERUZBVUxUO1xuXG4gIC8vIElmIHRoZSB1c2VyIHBhc3NlZCBpbiBhIHBsdWdpbiBjbGFzcyBpbnN0ZWFkIG9mIGEgcmVnaXN0ZXJlZCBwbHVnaW4gbmFtZS5cbiAgaWYgKHR5cGVvZiBwbHVnaW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gcGx1Z2luO1xuICB9XG4gIHJldHVybiBnZXRDbGFzcyh0eXBlLCBwbHVnaW4sIG9wdF90aHJvd0lmTWlzc2luZyk7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogR2VuZXJhdG9ycyBmb3IgdW5pcXVlIElEcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMuaWRHZW5lcmF0b3JcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5pZEdlbmVyYXRvcicpO1xuXG4vKipcbiAqIExlZ2FsIGNoYXJhY3RlcnMgZm9yIHRoZSB1bml2ZXJzYWxseSB1bmlxdWUgSURzLiAgU2hvdWxkIGJlIGFsbCBvblxuICogYSBVUyBrZXlib2FyZC4gIE5vIGNoYXJhY3RlcnMgdGhhdCBjb25mbGljdCB3aXRoIFhNTCBvciBKU09OLlxuICogUmVxdWVzdHMgdG8gcmVtb3ZlIGFkZGl0aW9uYWwgJ3Byb2JsZW1hdGljJyBjaGFyYWN0ZXJzIGZyb20gdGhpc1xuICogc291cCB3aWxsIGJlIGRlbmllZC4gIFRoYXQncyB5b3VyIGZhaWx1cmUgdG8gcHJvcGVybHkgZXNjYXBlIGluXG4gKiB5b3VyIG93biBlbnZpcm9ubWVudC4gIElzc3VlcyAjMjUxLCAjNjI1LCAjNjgyLCAjMTMwNC5cbiAqL1xuY29uc3Qgc291cCA9ICchIyQlKCkqKywtLi86Oz0/QFtdXl9ge3x9ficgK1xuICAgICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSc7XG5cbi8qKlxuICogTmFtZXNwYWNlIG9iamVjdCBmb3IgaW50ZXJuYWwgaW1wbGVtZW50YXRpb25zIHdlIHdhbnQgdG8gYmUgYWJsZSB0b1xuICogc3R1YiBpbiB0ZXN0cy4gRG8gbm90IHVzZSBleHRlcm5hbGx5LlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5jb25zdCBpbnRlcm5hbCA9IHtcbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgcmFuZG9tIHVuaXF1ZSBJRC4gIFRoaXMgc2hvdWxkIGJlIGdsb2JhbGx5IHVuaXF1ZS5cbiAgICogODcgY2hhcmFjdGVycyBeIDIwIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gMTI4IGJpdHMgKGJldHRlciB0aGFuIGEgVVVJRCkuXG4gICAqXG4gICAqIEByZXR1cm5zIEEgZ2xvYmFsbHkgdW5pcXVlIElEIHN0cmluZy5cbiAgICovXG4gIGdlblVpZDogKCkgPT4ge1xuICAgIGNvbnN0IGxlbmd0aCA9IDIwO1xuICAgIGNvbnN0IHNvdXBMZW5ndGggPSBzb3VwLmxlbmd0aDtcbiAgICBjb25zdCBpZCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlkW2ldID0gc291cC5jaGFyQXQoTWF0aC5yYW5kb20oKSAqIHNvdXBMZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gaWQuam9pbignJyk7XG4gIH0sXG59O1xuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IGludGVybmFsO1xuXG4vKiogTmV4dCB1bmlxdWUgSUQgdG8gdXNlLiAqL1xubGV0IG5leHRJZCA9IDA7XG5cbi8qKlxuICogR2VuZXJhdGUgdGhlIG5leHQgdW5pcXVlIGVsZW1lbnQgSURzLlxuICogSURzIGFyZSBjb21wYXRpYmxlIHdpdGggdGhlIEhUTUw0ICdpZCcgYXR0cmlidXRlIHJlc3RyaWN0aW9uczpcbiAqIFVzZSBvbmx5IEFTQ0lJIGxldHRlcnMsIGRpZ2l0cywgJ18nLCAnLScgYW5kICcuJ1xuICpcbiAqIEZvciBVVUlEcyB1c2UgZ2VuVWlkIChiZWxvdykgaW5zdGVhZDsgdGhpcyBJRCBnZW5lcmF0b3Igc2hvdWxkXG4gKiBwcmltYXJpbHkgYmUgdXNlZCBmb3IgSURzIHRoYXQgZW5kIHVwIGluIHRoZSBET00uXG4gKlxuICogQHJldHVybnMgVGhlIG5leHQgdW5pcXVlIGlkZW50aWZpZXIuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5pZEdlbmVyYXRvci5nZXROZXh0VW5pcXVlSWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE5leHRVbmlxdWVJZCgpOiBzdHJpbmcge1xuICByZXR1cm4gJ2Jsb2NrbHktJyArIChuZXh0SWQrKykudG9TdHJpbmcoMzYpO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlIGEgcmFuZG9tIHVuaXF1ZSBJRC5cbiAqXG4gKiBAc2VlIGludGVybmFsLmdlblVpZFxuICogQHJldHVybnMgQSBnbG9iYWxseSB1bmlxdWUgSUQgc3RyaW5nLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuaWRHZW5lcmF0b3IuZ2VuVWlkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5VaWQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIGludGVybmFsLmdlblVpZCgpO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEhlbHBlciBtZXRob2RzIGZvciBldmVudHMgdGhhdCBhcmUgZmlyZWQgYXMgYSByZXN1bHQgb2ZcbiAqIGFjdGlvbnMgaW4gQmxvY2tseSdzIGVkaXRvci5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuRXZlbnRzLnV0aWxzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLnV0aWxzJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja30gZnJvbSAnLi4vYmxvY2suanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4uL2NvbW1vbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBpZEdlbmVyYXRvciBmcm9tICcuLi91dGlscy9pZGdlbmVyYXRvci5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cbmltcG9ydCB0eXBlIHtBYnN0cmFjdH0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrQ2hhbmdlfSBmcm9tICcuL2V2ZW50c19ibG9ja19jaGFuZ2UuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrQ3JlYXRlfSBmcm9tICcuL2V2ZW50c19ibG9ja19jcmVhdGUuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrTW92ZX0gZnJvbSAnLi9ldmVudHNfYmxvY2tfbW92ZS5qcyc7XG5pbXBvcnQgdHlwZSB7Q29tbWVudENyZWF0ZX0gZnJvbSAnLi9ldmVudHNfY29tbWVudF9jcmVhdGUuanMnO1xuaW1wb3J0IHR5cGUge0NvbW1lbnRNb3ZlfSBmcm9tICcuL2V2ZW50c19jb21tZW50X21vdmUuanMnO1xuaW1wb3J0IHR5cGUge1ZpZXdwb3J0Q2hhbmdlfSBmcm9tICcuL2V2ZW50c192aWV3cG9ydC5qcyc7XG5cblxuLyoqIEdyb3VwIElEIGZvciBuZXcgZXZlbnRzLiAgR3JvdXBlZCBldmVudHMgYXJlIGluZGl2aXNpYmxlLiAqL1xubGV0IGdyb3VwID0gJyc7XG5cbi8qKiBTZXRzIHdoZXRoZXIgdGhlIG5leHQgZXZlbnQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSB1bmRvIHN0YWNrLiAqL1xubGV0IHJlY29yZFVuZG8gPSB0cnVlO1xuXG4vKipcbiAqIFNldHMgd2hldGhlciBldmVudHMgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSB1bmRvIHN0YWNrLlxuICpcbiAqIEBwYXJhbSBuZXdWYWx1ZSBUcnVlIGlmIGV2ZW50cyBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIHVuZG8gc3RhY2suXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuc2V0UmVjb3JkVW5kb1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0UmVjb3JkVW5kbyhuZXdWYWx1ZTogYm9vbGVhbikge1xuICByZWNvcmRVbmRvID0gbmV3VmFsdWU7XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCBldmVudHMgd2lsbCBiZSBhZGRlZCB0byB0aGUgdW5kbyBzdGFjay5cbiAqXG4gKiBAcmV0dXJucyBUcnVlIGlmIGV2ZW50cyB3aWxsIGJlIGFkZGVkIHRvIHRoZSB1bmRvIHN0YWNrLlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLmdldFJlY29yZFVuZG9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJlY29yZFVuZG8oKTogYm9vbGVhbiB7XG4gIHJldHVybiByZWNvcmRVbmRvO1xufVxuXG4vKiogQWxsb3cgY2hhbmdlIGV2ZW50cyB0byBiZSBjcmVhdGVkIGFuZCBmaXJlZC4gKi9cbmxldCBkaXNhYmxlZCA9IDA7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGNyZWF0ZXMgYSBibG9jay4gV2lsbCBiZSBkZXByZWNhdGVkIGZvciBCTE9DS19DUkVBVEUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLkNSRUFURVxuICovXG5leHBvcnQgY29uc3QgQ1JFQVRFID0gJ2NyZWF0ZSc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGNyZWF0ZXMgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQkxPQ0tfQ1JFQVRFXG4gKi9cbmV4cG9ydCBjb25zdCBCTE9DS19DUkVBVEUgPSBDUkVBVEU7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGRlbGV0ZXMgYSBibG9jay4gV2lsbCBiZSBkZXByZWNhdGVkIGZvciBCTE9DS19ERUxFVEUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLkRFTEVURVxuICovXG5leHBvcnQgY29uc3QgREVMRVRFID0gJ2RlbGV0ZSc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGRlbGV0ZXMgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQkxPQ0tfREVMRVRFXG4gKi9cbmV4cG9ydCBjb25zdCBCTE9DS19ERUxFVEUgPSBERUxFVEU7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGNoYW5nZXMgYSBibG9jay4gV2lsbCBiZSBkZXByZWNhdGVkIGZvciBCTE9DS19DSEFOR0UuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLkNIQU5HRVxuICovXG5leHBvcnQgY29uc3QgQ0hBTkdFID0gJ2NoYW5nZSc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGNoYW5nZXMgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQkxPQ0tfQ0hBTkdFXG4gKi9cbmV4cG9ydCBjb25zdCBCTE9DS19DSEFOR0UgPSBDSEFOR0U7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IG1vdmVzIGEgYmxvY2suIFdpbGwgYmUgZGVwcmVjYXRlZCBmb3IgQkxPQ0tfTU9WRS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuTU9WRVxuICovXG5leHBvcnQgY29uc3QgTU9WRSA9ICdtb3ZlJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgbW92ZXMgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQkxPQ0tfTU9WRVxuICovXG5leHBvcnQgY29uc3QgQkxPQ0tfTU9WRSA9IE1PVkU7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGNyZWF0ZXMgYSB2YXJpYWJsZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuVkFSX0NSRUFURVxuICovXG5leHBvcnQgY29uc3QgVkFSX0NSRUFURSA9ICd2YXJfY3JlYXRlJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgZGVsZXRlcyBhIHZhcmlhYmxlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5WQVJfREVMRVRFXG4gKi9cbmV4cG9ydCBjb25zdCBWQVJfREVMRVRFID0gJ3Zhcl9kZWxldGUnO1xuXG4vKipcbiAqIE5hbWUgb2YgZXZlbnQgdGhhdCByZW5hbWVzIGEgdmFyaWFibGUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLlZBUl9SRU5BTUVcbiAqL1xuZXhwb3J0IGNvbnN0IFZBUl9SRU5BTUUgPSAndmFyX3JlbmFtZSc7XG5cbi8qKlxuICogTmFtZSBvZiBnZW5lcmljIGV2ZW50IHRoYXQgcmVjb3JkcyBhIFVJIGNoYW5nZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuVUlcbiAqL1xuZXhwb3J0IGNvbnN0IFVJID0gJ3VpJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgcmVjb3JkIGEgYmxvY2sgZHJhZ3MgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQkxPQ0tfRFJBR1xuICovXG5leHBvcnQgY29uc3QgQkxPQ0tfRFJBRyA9ICdkcmFnJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgcmVjb3JkcyBhIGNoYW5nZSBpbiBzZWxlY3RlZCBlbGVtZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5TRUxFQ1RFRFxuICovXG5leHBvcnQgY29uc3QgU0VMRUNURUQgPSAnc2VsZWN0ZWQnO1xuXG4vKipcbiAqIE5hbWUgb2YgZXZlbnQgdGhhdCByZWNvcmRzIGEgY2xpY2suXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLkNMSUNLXG4gKi9cbmV4cG9ydCBjb25zdCBDTElDSyA9ICdjbGljayc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IHJlY29yZHMgYSBtYXJrZXIgbW92ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuTUFSS0VSX01PVkVcbiAqL1xuZXhwb3J0IGNvbnN0IE1BUktFUl9NT1ZFID0gJ21hcmtlcl9tb3ZlJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgcmVjb3JkcyBhIGJ1YmJsZSBvcGVuLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5CVUJCTEVfT1BFTlxuICovXG5leHBvcnQgY29uc3QgQlVCQkxFX09QRU4gPSAnYnViYmxlX29wZW4nO1xuXG4vKipcbiAqIE5hbWUgb2YgZXZlbnQgdGhhdCByZWNvcmRzIGEgdHJhc2hjYW4gb3Blbi5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuVFJBU0hDQU5fT1BFTlxuICovXG5leHBvcnQgY29uc3QgVFJBU0hDQU5fT1BFTiA9ICd0cmFzaGNhbl9vcGVuJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgcmVjb3JkcyBhIHRvb2xib3ggaXRlbSBzZWxlY3QuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLlRPT0xCT1hfSVRFTV9TRUxFQ1RcbiAqL1xuZXhwb3J0IGNvbnN0IFRPT0xCT1hfSVRFTV9TRUxFQ1QgPSAndG9vbGJveF9pdGVtX3NlbGVjdCc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IHJlY29yZHMgYSB0aGVtZSBjaGFuZ2UuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLlRIRU1FX0NIQU5HRVxuICovXG5leHBvcnQgY29uc3QgVEhFTUVfQ0hBTkdFID0gJ3RoZW1lX2NoYW5nZSc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IHJlY29yZHMgYSB2aWV3cG9ydCBjaGFuZ2UuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLlZJRVdQT1JUX0NIQU5HRVxuICovXG5leHBvcnQgY29uc3QgVklFV1BPUlRfQ0hBTkdFID0gJ3ZpZXdwb3J0X2NoYW5nZSc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IGNyZWF0ZXMgYSBjb21tZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5DT01NRU5UX0NSRUFURVxuICovXG5leHBvcnQgY29uc3QgQ09NTUVOVF9DUkVBVEUgPSAnY29tbWVudF9jcmVhdGUnO1xuXG4vKipcbiAqIE5hbWUgb2YgZXZlbnQgdGhhdCBkZWxldGVzIGEgY29tbWVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQ09NTUVOVF9ERUxFVEVcbiAqL1xuZXhwb3J0IGNvbnN0IENPTU1FTlRfREVMRVRFID0gJ2NvbW1lbnRfZGVsZXRlJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgY2hhbmdlcyBhIGNvbW1lbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLkNPTU1FTlRfQ0hBTkdFXG4gKi9cbmV4cG9ydCBjb25zdCBDT01NRU5UX0NIQU5HRSA9ICdjb21tZW50X2NoYW5nZSc7XG5cbi8qKlxuICogTmFtZSBvZiBldmVudCB0aGF0IG1vdmVzIGEgY29tbWVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQ09NTUVOVF9NT1ZFXG4gKi9cbmV4cG9ydCBjb25zdCBDT01NRU5UX01PVkUgPSAnY29tbWVudF9tb3ZlJztcblxuLyoqXG4gKiBOYW1lIG9mIGV2ZW50IHRoYXQgcmVjb3JkcyBhIHdvcmtzcGFjZSBsb2FkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5GSU5JU0hFRF9MT0FESU5HXG4gKi9cbmV4cG9ydCBjb25zdCBGSU5JU0hFRF9MT0FESU5HID0gJ2ZpbmlzaGVkX2xvYWRpbmcnO1xuXG4vKiogTmFtZSBvZiBldmVudCB0aGF0IGNyZWF0ZXMgYSBwcm9jZWR1cmUgbW9kZWwuICovXG5leHBvcnQgY29uc3QgUFJPQ0VEVVJFX0NSRUFURSA9ICdwcm9jZWR1cmVfY3JlYXRlJztcblxuLyoqIE5hbWUgb2YgZXZlbnQgdGhhdCBkZWxldGVzIGEgcHJvY2VkdXJlIG1vZGVsLiAqL1xuZXhwb3J0IGNvbnN0IFBST0NFRFVSRV9ERUxFVEUgPSAncHJvY2VkdXJlX2RlbGV0ZSc7XG5cbi8qKiBOYW1lIG9mIGV2ZW50IHRoYXQgcmVuYW1lcyBhIHByb2NlZHVyZSBtb2RlbC4gKi9cbmV4cG9ydCBjb25zdCBQUk9DRURVUkVfUkVOQU1FID0gJ3Byb2NlZHVyZV9yZW5hbWUnO1xuXG4vKiogTmFtZSBvZiBldmVudCB0aGF0IGVuYWJsZXMvZGlzYWJsZXMgYSBwcm9jZWR1cmUgbW9kZWwuICovXG5leHBvcnQgY29uc3QgUFJPQ0VEVVJFX0VOQUJMRSA9ICdwcm9jZWR1cmVfZW5hYmxlJztcblxuLyoqIE5hbWUgb2YgZXZlbnQgdGhhdCBjaGFuZ2VzIHRoZSByZXR1cm50eXBlIG9mIGEgcHJvY2VkdXJlIG1vZGVsLiAqL1xuZXhwb3J0IGNvbnN0IFBST0NFRFVSRV9DSEFOR0VfUkVUVVJOID0gJ3Byb2NlZHVyZV9jaGFuZ2VfcmV0dXJuJztcblxuLyoqIE5hbWUgb2YgZXZlbnQgdGhhdCBjcmVhdGVzIGEgcHJvY2VkdXJlIHBhcmFtZXRlci4gKi9cbmV4cG9ydCBjb25zdCBQUk9DRURVUkVfUEFSQU1FVEVSX0NSRUFURSA9ICdwcm9jZWR1cmVfcGFyYW1ldGVyX2NyZWF0ZSc7XG5cbi8qKiBOYW1lIG9mIGV2ZW50IHRoYXQgZGVsZXRlcyBhIHByb2NlZHVyZSBwYXJhbWV0ZXIuICovXG5leHBvcnQgY29uc3QgUFJPQ0VEVVJFX1BBUkFNRVRFUl9ERUxFVEUgPSAncHJvY2VkdXJlX3BhcmFtZXRlcl9kZWxldGUnO1xuXG4vKiogTmFtZSBvZiBldmVudCB0aGF0IHJlbmFtZXMgYSBwcm9jZWR1cmUgcGFyYW1ldGVyLiAqL1xuZXhwb3J0IGNvbnN0IFBST0NFRFVSRV9QQVJBTUVURVJfUkVOQU1FID0gJ3Byb2NlZHVyZV9wYXJhbWV0ZXJfcmVuYW1lJztcblxuLyoqXG4gKiBUeXBlIG9mIGV2ZW50cyB0aGF0IGNhdXNlIG9iamVjdHMgdG8gYmUgYnVtcGVkIGJhY2sgaW50byB0aGUgdmlzaWJsZVxuICogcG9ydGlvbiBvZiB0aGUgd29ya3NwYWNlLlxuICpcbiAqIE5vdCB0byBiZSBjb25mdXNlZCB3aXRoIGJ1bXBpbmcgc28gdGhhdCBkaXNjb25uZWN0ZWQgY29ubmVjdGlvbnMgZG8gbm90XG4gKiBhcHBlYXIgY29ubmVjdGVkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5CdW1wRXZlbnRcbiAqL1xuZXhwb3J0IHR5cGUgQnVtcEV2ZW50ID0gQmxvY2tDcmVhdGV8QmxvY2tNb3ZlfENvbW1lbnRDcmVhdGV8Q29tbWVudE1vdmU7XG5cbi8qKlxuICogTGlzdCBvZiBldmVudHMgdGhhdCBjYXVzZSBvYmplY3RzIHRvIGJlIGJ1bXBlZCBiYWNrIGludG8gdGhlIHZpc2libGVcbiAqIHBvcnRpb24gb2YgdGhlIHdvcmtzcGFjZS5cbiAqXG4gKiBOb3QgdG8gYmUgY29uZnVzZWQgd2l0aCBidW1waW5nIHNvIHRoYXQgZGlzY29ubmVjdGVkIGNvbm5lY3Rpb25zIGRvIG5vdFxuICogYXBwZWFyIGNvbm5lY3RlZC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuQlVNUF9FVkVOVFNcbiAqL1xuZXhwb3J0IGNvbnN0IEJVTVBfRVZFTlRTOiBzdHJpbmdbXSA9XG4gICAgW0JMT0NLX0NSRUFURSwgQkxPQ0tfTU9WRSwgQ09NTUVOVF9DUkVBVEUsIENPTU1FTlRfTU9WRV07XG5cbi8qKiBMaXN0IG9mIGV2ZW50cyBxdWV1ZWQgZm9yIGZpcmluZy4gKi9cbmNvbnN0IEZJUkVfUVVFVUU6IEFic3RyYWN0W10gPSBbXTtcblxuLyoqXG4gKiBDcmVhdGUgYSBjdXN0b20gZXZlbnQgYW5kIGZpcmUgaXQuXG4gKlxuICogQHBhcmFtIGV2ZW50IEN1c3RvbSBkYXRhIGZvciBldmVudC5cbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5maXJlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaXJlKGV2ZW50OiBBYnN0cmFjdCkge1xuICBURVNUX09OTFkuZmlyZUludGVybmFsKGV2ZW50KTtcbn1cblxuLyoqXG4gKiBQcml2YXRlIHZlcnNpb24gb2YgZmlyZUludGVybmFsIGZvciBzdHViYmluZyBpbiB0ZXN0cy5cbiAqL1xuZnVuY3Rpb24gZmlyZUludGVybmFsKGV2ZW50OiBBYnN0cmFjdCkge1xuICBpZiAoIWlzRW5hYmxlZCgpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghRklSRV9RVUVVRS5sZW5ndGgpIHtcbiAgICAvLyBGaXJzdCBldmVudCBhZGRlZDsgc2NoZWR1bGUgYSBmaXJpbmcgb2YgdGhlIGV2ZW50IHF1ZXVlLlxuICAgIHNldFRpbWVvdXQoZmlyZU5vdywgMCk7XG4gIH1cbiAgRklSRV9RVUVVRS5wdXNoKGV2ZW50KTtcbn1cblxuXG4vKiogRmlyZSBhbGwgcXVldWVkIGV2ZW50cy4gKi9cbmZ1bmN0aW9uIGZpcmVOb3coKSB7XG4gIGNvbnN0IHF1ZXVlID0gZmlsdGVyKEZJUkVfUVVFVUUsIHRydWUpO1xuICBGSVJFX1FVRVVFLmxlbmd0aCA9IDA7XG4gIGZvciAobGV0IGkgPSAwLCBldmVudDsgZXZlbnQgPSBxdWV1ZVtpXTsgaSsrKSB7XG4gICAgaWYgKCFldmVudC53b3Jrc3BhY2VJZCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IGV2ZW50V29ya3NwYWNlID0gY29tbW9uLmdldFdvcmtzcGFjZUJ5SWQoZXZlbnQud29ya3NwYWNlSWQpO1xuICAgIGlmIChldmVudFdvcmtzcGFjZSkge1xuICAgICAgZXZlbnRXb3Jrc3BhY2UuZmlyZUNoYW5nZUxpc3RlbmVyKGV2ZW50KTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBGaWx0ZXIgdGhlIHF1ZXVlZCBldmVudHMgYW5kIG1lcmdlIGR1cGxpY2F0ZXMuXG4gKlxuICogQHBhcmFtIHF1ZXVlSW4gQXJyYXkgb2YgZXZlbnRzLlxuICogQHBhcmFtIGZvcndhcmQgVHJ1ZSBpZiBmb3J3YXJkIChyZWRvKSwgZmFsc2UgaWYgYmFja3dhcmQgKHVuZG8pLlxuICogQHJldHVybnMgQXJyYXkgb2YgZmlsdGVyZWQgZXZlbnRzLlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLmZpbHRlclxuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyKHF1ZXVlSW46IEFic3RyYWN0W10sIGZvcndhcmQ6IGJvb2xlYW4pOiBBYnN0cmFjdFtdIHtcbiAgbGV0IHF1ZXVlID0gcXVldWVJbi5zbGljZSgpO1xuICAvLyBTaGFsbG93IGNvcHkgb2YgcXVldWUuXG4gIGlmICghZm9yd2FyZCkge1xuICAgIC8vIFVuZG8gaXMgbWVyZ2VkIGluIHJldmVyc2Ugb3JkZXIuXG4gICAgcXVldWUucmV2ZXJzZSgpO1xuICB9XG4gIGNvbnN0IG1lcmdlZFF1ZXVlID0gW107XG4gIGNvbnN0IGhhc2ggPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAvLyBNZXJnZSBkdXBsaWNhdGVzLlxuICBmb3IgKGxldCBpID0gMCwgZXZlbnQ7IGV2ZW50ID0gcXVldWVbaV07IGkrKykge1xuICAgIGlmICghZXZlbnQuaXNOdWxsKCkpIHtcbiAgICAgIC8vIFRyZWF0IGFsbCBVSSBldmVudHMgYXMgdGhlIHNhbWUgdHlwZSBpbiBoYXNoIHRhYmxlLlxuICAgICAgY29uc3QgZXZlbnRUeXBlID0gZXZlbnQuaXNVaUV2ZW50ID8gVUkgOiBldmVudC50eXBlO1xuICAgICAgLy8gVE9ETygjNTkyNyk6IENoZWNrIHdoZXRoZXIgYGJsb2NrSWRgIGV4aXN0cyBiZWZvcmUgYWNjZXNzaW5nIGl0LlxuICAgICAgY29uc3QgYmxvY2tJZCA9IChldmVudCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmJsb2NrSWQ7XG4gICAgICBjb25zdCBrZXkgPSBbZXZlbnRUeXBlLCBibG9ja0lkLCBldmVudC53b3Jrc3BhY2VJZF0uam9pbignICcpO1xuXG4gICAgICBjb25zdCBsYXN0RW50cnkgPSBoYXNoW2tleV07XG4gICAgICBjb25zdCBsYXN0RXZlbnQgPSBsYXN0RW50cnkgPyBsYXN0RW50cnkuZXZlbnQgOiBudWxsO1xuICAgICAgaWYgKCFsYXN0RW50cnkpIHtcbiAgICAgICAgLy8gRWFjaCBpdGVtIGluIHRoZSBoYXNoIHRhYmxlIGhhcyB0aGUgZXZlbnQgYW5kIHRoZSBpbmRleCBvZiB0aGF0IGV2ZW50XG4gICAgICAgIC8vIGluIHRoZSBpbnB1dCBhcnJheS4gIFRoaXMgbGV0cyB1cyBtYWtlIHN1cmUgd2Ugb25seSBtZXJnZSBhZGphY2VudFxuICAgICAgICAvLyBtb3ZlIGV2ZW50cy5cbiAgICAgICAgaGFzaFtrZXldID0ge2V2ZW50LCBpbmRleDogaX07XG4gICAgICAgIG1lcmdlZFF1ZXVlLnB1c2goZXZlbnQpO1xuICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBNT1ZFICYmIGxhc3RFbnRyeS5pbmRleCA9PT0gaSAtIDEpIHtcbiAgICAgICAgY29uc3QgbW92ZUV2ZW50ID0gZXZlbnQgYXMgQmxvY2tNb3ZlO1xuICAgICAgICAvLyBNZXJnZSBtb3ZlIGV2ZW50cy5cbiAgICAgICAgbGFzdEV2ZW50Lm5ld1BhcmVudElkID0gbW92ZUV2ZW50Lm5ld1BhcmVudElkO1xuICAgICAgICBsYXN0RXZlbnQubmV3SW5wdXROYW1lID0gbW92ZUV2ZW50Lm5ld0lucHV0TmFtZTtcbiAgICAgICAgbGFzdEV2ZW50Lm5ld0Nvb3JkaW5hdGUgPSBtb3ZlRXZlbnQubmV3Q29vcmRpbmF0ZTtcbiAgICAgICAgbGFzdEVudHJ5LmluZGV4ID0gaTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgZXZlbnQudHlwZSA9PT0gQ0hBTkdFICYmXG4gICAgICAgICAgKGV2ZW50IGFzIEJsb2NrQ2hhbmdlKS5lbGVtZW50ID09PSBsYXN0RXZlbnQuZWxlbWVudCAmJlxuICAgICAgICAgIChldmVudCBhcyBCbG9ja0NoYW5nZSkubmFtZSA9PT0gbGFzdEV2ZW50Lm5hbWUpIHtcbiAgICAgICAgY29uc3QgY2hhbmdlRXZlbnQgPSBldmVudCBhcyBCbG9ja0NoYW5nZTtcbiAgICAgICAgLy8gTWVyZ2UgY2hhbmdlIGV2ZW50cy5cbiAgICAgICAgbGFzdEV2ZW50Lm5ld1ZhbHVlID0gY2hhbmdlRXZlbnQubmV3VmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IFZJRVdQT1JUX0NIQU5HRSkge1xuICAgICAgICBjb25zdCB2aWV3cG9ydEV2ZW50ID0gZXZlbnQgYXMgVmlld3BvcnRDaGFuZ2U7XG4gICAgICAgIC8vIE1lcmdlIHZpZXdwb3J0IGNoYW5nZSBldmVudHMuXG4gICAgICAgIGxhc3RFdmVudC52aWV3VG9wID0gdmlld3BvcnRFdmVudC52aWV3VG9wO1xuICAgICAgICBsYXN0RXZlbnQudmlld0xlZnQgPSB2aWV3cG9ydEV2ZW50LnZpZXdMZWZ0O1xuICAgICAgICBsYXN0RXZlbnQuc2NhbGUgPSB2aWV3cG9ydEV2ZW50LnNjYWxlO1xuICAgICAgICBsYXN0RXZlbnQub2xkU2NhbGUgPSB2aWV3cG9ydEV2ZW50Lm9sZFNjYWxlO1xuICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSBDTElDSyAmJiBsYXN0RXZlbnQudHlwZSA9PT0gQlVCQkxFX09QRU4pIHtcbiAgICAgICAgLy8gRHJvcCBjbGljayBldmVudHMgY2F1c2VkIGJ5IG9wZW5pbmcvY2xvc2luZyBidWJibGVzLlxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ29sbGlzaW9uOiBuZXdlciBldmVudHMgc2hvdWxkIG1lcmdlIGludG8gdGhpcyBldmVudCB0byBtYWludGFpblxuICAgICAgICAvLyBvcmRlci5cbiAgICAgICAgaGFzaFtrZXldID0ge2V2ZW50LCBpbmRleDogaX07XG4gICAgICAgIG1lcmdlZFF1ZXVlLnB1c2goZXZlbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBGaWx0ZXIgb3V0IGFueSBldmVudHMgdGhhdCBoYXZlIGJlY29tZSBudWxsIGR1ZSB0byBtZXJnaW5nLlxuICBxdWV1ZSA9IG1lcmdlZFF1ZXVlLmZpbHRlcihmdW5jdGlvbihlKSB7XG4gICAgcmV0dXJuICFlLmlzTnVsbCgpO1xuICB9KTtcbiAgaWYgKCFmb3J3YXJkKSB7XG4gICAgLy8gUmVzdG9yZSB1bmRvIG9yZGVyLlxuICAgIHF1ZXVlLnJldmVyc2UoKTtcbiAgfVxuICAvLyBNb3ZlIG11dGF0aW9uIGV2ZW50cyB0byB0aGUgdG9wIG9mIHRoZSBxdWV1ZS5cbiAgLy8gSW50ZW50aW9uYWxseSBza2lwIGZpcnN0IGV2ZW50LlxuICBmb3IgKGxldCBpID0gMSwgZXZlbnQ7IGV2ZW50ID0gcXVldWVbaV07IGkrKykge1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2VsZW1lbnQnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAvLyAnQWJzdHJhY3QnLlxuICAgIGlmIChldmVudC50eXBlID09PSBDSEFOR0UgJiZcbiAgICAgICAgKGV2ZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbikuZWxlbWVudCA9PT0gJ211dGF0aW9uJykge1xuICAgICAgcXVldWUudW5zaGlmdChxdWV1ZS5zcGxpY2UoaSwgMSlbMF0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcXVldWU7XG59XG5cbi8qKlxuICogTW9kaWZ5IHBlbmRpbmcgdW5kbyBldmVudHMgc28gdGhhdCB3aGVuIHRoZXkgYXJlIGZpcmVkIHRoZXkgZG9uJ3QgbGFuZFxuICogaW4gdGhlIHVuZG8gc3RhY2suICBDYWxsZWQgYnkgV29ya3NwYWNlLmNsZWFyVW5kby5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuY2xlYXJQZW5kaW5nVW5kb1xuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJQZW5kaW5nVW5kbygpIHtcbiAgZm9yIChsZXQgaSA9IDAsIGV2ZW50OyBldmVudCA9IEZJUkVfUVVFVUVbaV07IGkrKykge1xuICAgIGV2ZW50LnJlY29yZFVuZG8gPSBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFN0b3Agc2VuZGluZyBldmVudHMuICBFdmVyeSBjYWxsIHRvIHRoaXMgZnVuY3Rpb24gTVVTVCBhbHNvIGNhbGwgZW5hYmxlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5kaXNhYmxlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkaXNhYmxlKCkge1xuICBkaXNhYmxlZCsrO1xufVxuXG4vKipcbiAqIFN0YXJ0IHNlbmRpbmcgZXZlbnRzLiAgVW5sZXNzIGV2ZW50cyB3ZXJlIGFscmVhZHkgZGlzYWJsZWQgd2hlbiB0aGVcbiAqIGNvcnJlc3BvbmRpbmcgY2FsbCB0byBkaXNhYmxlIHdhcyBtYWRlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5lbmFibGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZSgpIHtcbiAgZGlzYWJsZWQtLTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgZXZlbnRzIG1heSBiZSBmaXJlZCBvciBub3QuXG4gKlxuICogQHJldHVybnMgVHJ1ZSBpZiBlbmFibGVkLlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLmlzRW5hYmxlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFbmFibGVkKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gZGlzYWJsZWQgPT09IDA7XG59XG5cbi8qKlxuICogQ3VycmVudCBncm91cC5cbiAqXG4gKiBAcmV0dXJucyBJRCBzdHJpbmcuXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMudXRpbHMuZ2V0R3JvdXBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEdyb3VwKCk6IHN0cmluZyB7XG4gIHJldHVybiBncm91cDtcbn1cblxuLyoqXG4gKiBTdGFydCBvciBzdG9wIGEgZ3JvdXAuXG4gKlxuICogQHBhcmFtIHN0YXRlIFRydWUgdG8gc3RhcnQgbmV3IGdyb3VwLCBmYWxzZSB0byBlbmQgZ3JvdXAuXG4gKiAgIFN0cmluZyB0byBzZXQgZ3JvdXAgZXhwbGljaXRseS5cbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5zZXRHcm91cFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0R3JvdXAoc3RhdGU6IGJvb2xlYW58c3RyaW5nKSB7XG4gIFRFU1RfT05MWS5zZXRHcm91cEludGVybmFsKHN0YXRlKTtcbn1cblxuLyoqXG4gKiBQcml2YXRlIHZlcnNpb24gb2Ygc2V0R3JvdXAgZm9yIHN0dWJiaW5nIGluIHRlc3RzLlxuICovXG5mdW5jdGlvbiBzZXRHcm91cEludGVybmFsKHN0YXRlOiBib29sZWFufHN0cmluZykge1xuICBpZiAodHlwZW9mIHN0YXRlID09PSAnYm9vbGVhbicpIHtcbiAgICBncm91cCA9IHN0YXRlID8gaWRHZW5lcmF0b3IuZ2VuVWlkKCkgOiAnJztcbiAgfSBlbHNlIHtcbiAgICBncm91cCA9IHN0YXRlO1xuICB9XG59XG5cbi8qKlxuICogQ29tcHV0ZSBhIGxpc3Qgb2YgdGhlIElEcyBvZiB0aGUgc3BlY2lmaWVkIGJsb2NrIGFuZCBhbGwgaXRzIGRlc2NlbmRhbnRzLlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgcm9vdCBibG9jay5cbiAqIEByZXR1cm5zIExpc3Qgb2YgYmxvY2sgSURzLlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLmdldERlc2NlbmRhbnRJZHNcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVzY2VuZGFudElkcyhibG9jazogQmxvY2spOiBzdHJpbmdbXSB7XG4gIGNvbnN0IGlkcyA9IFtdO1xuICBjb25zdCBkZXNjZW5kYW50cyA9IGJsb2NrLmdldERlc2NlbmRhbnRzKGZhbHNlKTtcbiAgZm9yIChsZXQgaSA9IDAsIGRlc2NlbmRhbnQ7IGRlc2NlbmRhbnQgPSBkZXNjZW5kYW50c1tpXTsgaSsrKSB7XG4gICAgaWRzW2ldID0gZGVzY2VuZGFudC5pZDtcbiAgfVxuICByZXR1cm4gaWRzO1xufVxuXG4vKipcbiAqIERlY29kZSB0aGUgSlNPTiBpbnRvIGFuIGV2ZW50LlxuICpcbiAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRhcmdldCB3b3Jrc3BhY2UgZm9yIGV2ZW50LlxuICogQHJldHVybnMgVGhlIGV2ZW50IHJlcHJlc2VudGVkIGJ5IHRoZSBKU09OLlxuICogQHRocm93cyB7RXJyb3J9IGlmIGFuIGV2ZW50IHR5cGUgaXMgbm90IGZvdW5kIGluIHRoZSByZWdpc3RyeS5cbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5mcm9tSnNvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbUpzb24oXG4gICAganNvbjogQW55RHVyaW5nTWlncmF0aW9uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IEFic3RyYWN0IHtcbiAgY29uc3QgZXZlbnRDbGFzcyA9IGdldChqc29uWyd0eXBlJ10pO1xuICBpZiAoIWV2ZW50Q2xhc3MpIHRocm93IEVycm9yKCdVbmtub3duIGV2ZW50IHR5cGUuJyk7XG5cbiAgaWYgKGV2ZW50Q2xhc3NIYXNTdGF0aWNGcm9tSnNvbihldmVudENsYXNzKSkge1xuICAgIHJldHVybiAoZXZlbnRDbGFzcyBhcyBhbnkpLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSk7XG4gIH1cblxuICAvLyBGYWxsYmFjayB0byB0aGUgb2xkIGRlc2VyaWFsaXphdGlvbiBtZXRob2QuXG4gIGNvbnN0IGV2ZW50ID0gbmV3IGV2ZW50Q2xhc3MoKTtcbiAgZXZlbnQuZnJvbUpzb24oanNvbik7XG4gIGV2ZW50LndvcmtzcGFjZUlkID0gd29ya3NwYWNlLmlkO1xuICByZXR1cm4gZXZlbnQ7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBldmVudCBjb25zdHJ1Y3RvciBoYXMgL2l0cyBvd24vIHN0YXRpYyBmcm9tSnNvblxuICogbWV0aG9kLlxuICpcbiAqIFJldHVybnMgZmFsc2UgaWYgbm8gc3RhdGljIGZyb21Kc29uIG1ldGhvZCBleGlzdHMgb24gdGhlIGNvbnRydWN0b3IsIG9yIGlmXG4gKiB0aGUgc3RhdGljIGZyb21Kc29uIG1ldGhvZCBpcyBpbmhlcml0dGVkLlxuICovXG5mdW5jdGlvbiBldmVudENsYXNzSGFzU3RhdGljRnJvbUpzb24oZXZlbnRDbGFzczogbmV3ICguLi5wOiBhbnlbXSkgPT4gQWJzdHJhY3QpOlxuICAgIGJvb2xlYW4ge1xuICBjb25zdCB1bnR5cGVkRXZlbnRDbGFzcyA9IGV2ZW50Q2xhc3MgYXMgYW55O1xuICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModW50eXBlZEV2ZW50Q2xhc3MpLmZyb21Kc29uICYmXG4gICAgICB0eXBlb2YgdW50eXBlZEV2ZW50Q2xhc3MuZnJvbUpzb24gPT09ICdmdW5jdGlvbic7XG59XG5cbi8qKlxuICogR2V0cyB0aGUgY2xhc3MgZm9yIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmcm9tIHRoZSByZWdpc3RyeS5cbiAqXG4gKiBAcGFyYW0gZXZlbnRUeXBlIFRoZSB0eXBlIG9mIHRoZSBldmVudCB0byBnZXQuXG4gKiBAcmV0dXJucyBUaGUgZXZlbnQgY2xhc3Mgd2l0aCB0aGUgZ2l2ZW4gdHlwZS5cbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy51dGlscy5nZXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldChldmVudFR5cGU6IHN0cmluZyk6XG4gICAgKG5ldyAoLi4ucDE6IEFueUR1cmluZ01pZ3JhdGlvbltdKSA9PiBBYnN0cmFjdCkge1xuICBjb25zdCBldmVudCA9IHJlZ2lzdHJ5LmdldENsYXNzKHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VHlwZSk7XG4gIGlmICghZXZlbnQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEV2ZW50IHR5cGUgJHtldmVudFR5cGV9IG5vdCBmb3VuZCBpbiByZWdpc3RyeS5gKTtcbiAgfVxuICByZXR1cm4gZXZlbnQ7XG59XG5cbi8qKlxuICogRW5hYmxlL2Rpc2FibGUgYSBibG9jayBkZXBlbmRpbmcgb24gd2hldGhlciBpdCBpcyBwcm9wZXJseSBjb25uZWN0ZWQuXG4gKiBVc2UgdGhpcyBvbiBhcHBsaWNhdGlvbnMgd2hlcmUgYWxsIGJsb2NrcyBzaG91bGQgYmUgY29ubmVjdGVkIHRvIGEgdG9wIGJsb2NrLlxuICogUmVjb21tZW5kIHNldHRpbmcgdGhlICdkaXNhYmxlJyBvcHRpb24gdG8gJ2ZhbHNlJyBpbiB0aGUgY29uZmlnIHNvIHRoYXRcbiAqIHVzZXJzIGRvbid0IHRyeSB0byByZS1lbmFibGUgZGlzYWJsZWQgb3JwaGFuIGJsb2Nrcy5cbiAqXG4gKiBAcGFyYW0gZXZlbnQgQ3VzdG9tIGRhdGEgZm9yIGV2ZW50LlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLnV0aWxzLmRpc2FibGVPcnBoYW5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkaXNhYmxlT3JwaGFucyhldmVudDogQWJzdHJhY3QpIHtcbiAgaWYgKGV2ZW50LnR5cGUgPT09IE1PVkUgfHwgZXZlbnQudHlwZSA9PT0gQ1JFQVRFKSB7XG4gICAgY29uc3QgYmxvY2tFdmVudCA9IGV2ZW50IGFzIEJsb2NrTW92ZSB8IEJsb2NrQ3JlYXRlO1xuICAgIGlmICghYmxvY2tFdmVudC53b3Jrc3BhY2VJZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBldmVudFdvcmtzcGFjZSA9XG4gICAgICAgIGNvbW1vbi5nZXRXb3Jrc3BhY2VCeUlkKGJsb2NrRXZlbnQud29ya3NwYWNlSWQpIGFzIFdvcmtzcGFjZVN2ZztcbiAgICBpZiAoIWJsb2NrRXZlbnQuYmxvY2tJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbmNvdW50ZXJlZCBhIGJsb2NrRXZlbnQgd2l0aG91dCBhIHByb3BlciBibG9ja0lkJyk7XG4gICAgfVxuICAgIGxldCBibG9jayA9IGV2ZW50V29ya3NwYWNlLmdldEJsb2NrQnlJZChibG9ja0V2ZW50LmJsb2NrSWQpO1xuICAgIGlmIChibG9jaykge1xuICAgICAgLy8gQ2hhbmdpbmcgYmxvY2tzIGFzIHBhcnQgb2YgdGhpcyBldmVudCBzaG91bGRuJ3QgYmUgdW5kb2FibGUuXG4gICAgICBjb25zdCBpbml0aWFsVW5kb0ZsYWcgPSByZWNvcmRVbmRvO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVjb3JkVW5kbyA9IGZhbHNlO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBibG9jay5nZXRQYXJlbnQoKTtcbiAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQuaXNFbmFibGVkKCkpIHtcbiAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGJsb2NrLmdldERlc2NlbmRhbnRzKGZhbHNlKTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgY2hpbGQ7IGNoaWxkID0gY2hpbGRyZW5baV07IGkrKykge1xuICAgICAgICAgICAgY2hpbGQuc2V0RW5hYmxlZCh0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAoYmxvY2sub3V0cHV0Q29ubmVjdGlvbiB8fCBibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24pICYmXG4gICAgICAgICAgICAhZXZlbnRXb3Jrc3BhY2UuaXNEcmFnZ2luZygpKSB7XG4gICAgICAgICAgZG8ge1xuICAgICAgICAgICAgYmxvY2suc2V0RW5hYmxlZChmYWxzZSk7XG4gICAgICAgICAgICBibG9jayA9IGJsb2NrLmdldE5leHRCbG9jaygpO1xuICAgICAgICAgIH0gd2hpbGUgKGJsb2NrKTtcbiAgICAgICAgfVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmVjb3JkVW5kbyA9IGluaXRpYWxVbmRvRmxhZztcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IHtcbiAgRklSRV9RVUVVRSxcbiAgZmlyZU5vdyxcbiAgZmlyZUludGVybmFsLFxuICBzZXRHcm91cEludGVybmFsLFxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBYTUwgZWxlbWVudCBtYW5pcHVsYXRpb24uXG4gKiBUaGVzZSBtZXRob2RzIGFyZSBub3Qgc3BlY2lmaWMgdG8gQmxvY2tseSwgYW5kIGNvdWxkIGJlIGZhY3RvcmVkIG91dCBpbnRvXG4gKiBhIEphdmFTY3JpcHQgZnJhbWV3b3JrIHN1Y2ggYXMgQ2xvc3VyZS5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMueG1sXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMueG1sJyk7XG5cblxuLyoqXG4gKiBOYW1lc3BhY2UgZm9yIEJsb2NrbHkncyBYTUwuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMueG1sLk5BTUVfU1BBQ0VcbiAqL1xuZXhwb3J0IGNvbnN0IE5BTUVfU1BBQ0UgPSAnaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYmxvY2tseS94bWwnO1xuXG4vKipcbiAqIFRoZSBEb2N1bWVudCBvYmplY3QgdG8gdXNlLiAgQnkgZGVmYXVsdCB0aGlzIGlzIGp1c3QgZG9jdW1lbnQsIGJ1dFxuICogdGhlIE5vZGUuanMgYnVpbGQgb2YgQmxvY2tseSAoc2VlIHNjcmlwdHMvcGFja2FnZS9ub2RlL2NvcmUuanMpXG4gKiBjYWxscyBzZXREb2N1bWVudCB0byBzdXBwbHkgYSBEb2N1bWVudCBpbXBsZW1lbnRhdGlvbiBmcm9tIHRoZVxuICoganNkb20gcGFja2FnZSBpbnN0ZWFkLlxuICovXG5sZXQgeG1sRG9jdW1lbnQ6IERvY3VtZW50ID0gZ2xvYmFsVGhpc1snZG9jdW1lbnQnXTtcblxuLyoqXG4gKiBHZXQgdGhlIGRvY3VtZW50IG9iamVjdCB0byB1c2UgZm9yIFhNTCBzZXJpYWxpemF0aW9uLlxuICpcbiAqIEByZXR1cm5zIFRoZSBkb2N1bWVudCBvYmplY3QuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy54bWwuZ2V0RG9jdW1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERvY3VtZW50KCk6IERvY3VtZW50IHtcbiAgcmV0dXJuIHhtbERvY3VtZW50O1xufVxuXG4vKipcbiAqIEdldCB0aGUgZG9jdW1lbnQgb2JqZWN0IHRvIHVzZSBmb3IgWE1MIHNlcmlhbGl6YXRpb24uXG4gKlxuICogQHBhcmFtIGRvY3VtZW50IFRoZSBkb2N1bWVudCBvYmplY3QgdG8gdXNlLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMueG1sLnNldERvY3VtZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXREb2N1bWVudChkb2N1bWVudDogRG9jdW1lbnQpIHtcbiAgeG1sRG9jdW1lbnQgPSBkb2N1bWVudDtcbn1cblxuLyoqXG4gKiBDcmVhdGUgRE9NIGVsZW1lbnQgZm9yIFhNTC5cbiAqXG4gKiBAcGFyYW0gdGFnTmFtZSBOYW1lIG9mIERPTSBlbGVtZW50LlxuICogQHJldHVybnMgTmV3IERPTSBlbGVtZW50LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMueG1sLmNyZWF0ZUVsZW1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodGFnTmFtZTogc3RyaW5nKTogRWxlbWVudCB7XG4gIHJldHVybiB4bWxEb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoTkFNRV9TUEFDRSwgdGFnTmFtZSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHRleHQgZWxlbWVudCBmb3IgWE1MLlxuICpcbiAqIEBwYXJhbSB0ZXh0IFRleHQgY29udGVudC5cbiAqIEByZXR1cm5zIE5ldyBET00gdGV4dCBub2RlLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMueG1sLmNyZWF0ZVRleHROb2RlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUZXh0Tm9kZSh0ZXh0OiBzdHJpbmcpOiBUZXh0IHtcbiAgcmV0dXJuIHhtbERvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGFuIFhNTCBzdHJpbmcgaW50byBhIERPTSB0cmVlLlxuICpcbiAqIEBwYXJhbSB0ZXh0IFhNTCBzdHJpbmcuXG4gKiBAcmV0dXJucyBUaGUgRE9NIGRvY3VtZW50LlxuICogQHRocm93cyBpZiBYTUwgZG9lc24ndCBwYXJzZS5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnhtbC50ZXh0VG9Eb21Eb2N1bWVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gdGV4dFRvRG9tRG9jdW1lbnQodGV4dDogc3RyaW5nKTogRG9jdW1lbnQge1xuICBjb25zdCBvUGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xuICByZXR1cm4gb1BhcnNlci5wYXJzZUZyb21TdHJpbmcodGV4dCwgJ3RleHQveG1sJyk7XG59XG5cbi8qKlxuICogQ29udmVydHMgYSBET00gc3RydWN0dXJlIGludG8gcGxhaW4gdGV4dC5cbiAqIEN1cnJlbnRseSB0aGUgdGV4dCBmb3JtYXQgaXMgZmFpcmx5IHVnbHk6IGFsbCBvbmUgbGluZSB3aXRoIG5vIHdoaXRlc3BhY2UuXG4gKlxuICogQHBhcmFtIGRvbSBBIHRyZWUgb2YgWE1MIG5vZGVzLlxuICogQHJldHVybnMgVGV4dCByZXByZXNlbnRhdGlvbi5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnhtbC5kb21Ub1RleHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRvbVRvVGV4dChkb206IE5vZGUpOiBzdHJpbmcge1xuICBjb25zdCBvU2VyaWFsaXplciA9IG5ldyBYTUxTZXJpYWxpemVyKCk7XG4gIHJldHVybiBvU2VyaWFsaXplci5zZXJpYWxpemVUb1N0cmluZyhkb20pO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFdyYXBwZXIgZnVuY3Rpb25zIGFyb3VuZCBKUyBmdW5jdGlvbnMgZm9yIHNob3dpbmcgYWxlcnQvY29uZmlybWF0aW9uIGRpYWxvZ3MuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LmRpYWxvZ1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmRpYWxvZycpO1xuXG5cbmxldCBhbGVydEltcGxlbWVudGF0aW9uID0gZnVuY3Rpb24obWVzc2FnZTogc3RyaW5nLCBvcHRfY2FsbGJhY2s/OiAoKSA9PiB2b2lkKSB7XG4gIHdpbmRvdy5hbGVydChtZXNzYWdlKTtcbiAgaWYgKG9wdF9jYWxsYmFjaykge1xuICAgIG9wdF9jYWxsYmFjaygpO1xuICB9XG59O1xuXG5sZXQgY29uZmlybUltcGxlbWVudGF0aW9uID0gZnVuY3Rpb24oXG4gICAgbWVzc2FnZTogc3RyaW5nLCBjYWxsYmFjazogKHJlc3VsdDogYm9vbGVhbikgPT4gdm9pZCkge1xuICBjYWxsYmFjayh3aW5kb3cuY29uZmlybShtZXNzYWdlKSk7XG59O1xuXG5sZXQgcHJvbXB0SW1wbGVtZW50YXRpb24gPSBmdW5jdGlvbihcbiAgICBtZXNzYWdlOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogc3RyaW5nLFxuICAgIGNhbGxiYWNrOiAocmVzdWx0OiBzdHJpbmd8bnVsbCkgPT4gdm9pZCkge1xuICBjYWxsYmFjayh3aW5kb3cucHJvbXB0KG1lc3NhZ2UsIGRlZmF1bHRWYWx1ZSkpO1xufTtcblxuLyoqXG4gKiBXcmFwcGVyIHRvIHdpbmRvdy5hbGVydCgpIHRoYXQgYXBwIGRldmVsb3BlcnMgbWF5IG92ZXJyaWRlIHZpYSBzZXRBbGVydCB0b1xuICogcHJvdmlkZSBhbHRlcm5hdGl2ZXMgdG8gdGhlIG1vZGFsIGJyb3dzZXIgd2luZG93LlxuICpcbiAqIEBwYXJhbSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGRpc3BsYXkgdG8gdGhlIHVzZXIuXG4gKiBAcGFyYW0gb3B0X2NhbGxiYWNrIFRoZSBjYWxsYmFjayB3aGVuIHRoZSBhbGVydCBpcyBkaXNtaXNzZWQuXG4gKiBAYWxpYXMgQmxvY2tseS5kaWFsb2cuYWxlcnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFsZXJ0KG1lc3NhZ2U6IHN0cmluZywgb3B0X2NhbGxiYWNrPzogKCkgPT4gdm9pZCkge1xuICBhbGVydEltcGxlbWVudGF0aW9uKG1lc3NhZ2UsIG9wdF9jYWxsYmFjayk7XG59XG5cbi8qKlxuICogU2V0cyB0aGUgZnVuY3Rpb24gdG8gYmUgcnVuIHdoZW4gQmxvY2tseS5kaWFsb2cuYWxlcnQoKSBpcyBjYWxsZWQuXG4gKlxuICogQHBhcmFtIGFsZXJ0RnVuY3Rpb24gVGhlIGZ1bmN0aW9uIHRvIGJlIHJ1bi5cbiAqIEBzZWUgQmxvY2tseS5kaWFsb2cuYWxlcnRcbiAqIEBhbGlhcyBCbG9ja2x5LmRpYWxvZy5zZXRBbGVydFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0QWxlcnQoYWxlcnRGdW5jdGlvbjogKHAxOiBzdHJpbmcsIHAyPzogKCkgPT4gdm9pZCkgPT4gdm9pZCkge1xuICBhbGVydEltcGxlbWVudGF0aW9uID0gYWxlcnRGdW5jdGlvbjtcbn1cblxuLyoqXG4gKiBXcmFwcGVyIHRvIHdpbmRvdy5jb25maXJtKCkgdGhhdCBhcHAgZGV2ZWxvcGVycyBtYXkgb3ZlcnJpZGUgdmlhIHNldENvbmZpcm1cbiAqIHRvIHByb3ZpZGUgYWx0ZXJuYXRpdmVzIHRvIHRoZSBtb2RhbCBicm93c2VyIHdpbmRvdy5cbiAqXG4gKiBAcGFyYW0gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBkaXNwbGF5IHRvIHRoZSB1c2VyLlxuICogQHBhcmFtIGNhbGxiYWNrIFRoZSBjYWxsYmFjayBmb3IgaGFuZGxpbmcgdXNlciByZXNwb25zZS5cbiAqIEBhbGlhcyBCbG9ja2x5LmRpYWxvZy5jb25maXJtXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb25maXJtKG1lc3NhZ2U6IHN0cmluZywgY2FsbGJhY2s6IChwMTogYm9vbGVhbikgPT4gdm9pZCkge1xuICBURVNUX09OTFkuY29uZmlybUludGVybmFsKG1lc3NhZ2UsIGNhbGxiYWNrKTtcbn1cblxuLyoqXG4gKiBQcml2YXRlIHZlcnNpb24gb2YgY29uZmlybSBmb3Igc3R1YmJpbmcgaW4gdGVzdHMuXG4gKi9cbmZ1bmN0aW9uIGNvbmZpcm1JbnRlcm5hbChtZXNzYWdlOiBzdHJpbmcsIGNhbGxiYWNrOiAocDE6IGJvb2xlYW4pID0+IHZvaWQpIHtcbiAgY29uZmlybUltcGxlbWVudGF0aW9uKG1lc3NhZ2UsIGNhbGxiYWNrKTtcbn1cblxuXG4vKipcbiAqIFNldHMgdGhlIGZ1bmN0aW9uIHRvIGJlIHJ1biB3aGVuIEJsb2NrbHkuZGlhbG9nLmNvbmZpcm0oKSBpcyBjYWxsZWQuXG4gKlxuICogQHBhcmFtIGNvbmZpcm1GdW5jdGlvbiBUaGUgZnVuY3Rpb24gdG8gYmUgcnVuLlxuICogQHNlZSBCbG9ja2x5LmRpYWxvZy5jb25maXJtXG4gKiBAYWxpYXMgQmxvY2tseS5kaWFsb2cuc2V0Q29uZmlybVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29uZmlybShcbiAgICBjb25maXJtRnVuY3Rpb246IChwMTogc3RyaW5nLCBwMjogKHAxOiBib29sZWFuKSA9PiB2b2lkKSA9PiB2b2lkKSB7XG4gIGNvbmZpcm1JbXBsZW1lbnRhdGlvbiA9IGNvbmZpcm1GdW5jdGlvbjtcbn1cblxuLyoqXG4gKiBXcmFwcGVyIHRvIHdpbmRvdy5wcm9tcHQoKSB0aGF0IGFwcCBkZXZlbG9wZXJzIG1heSBvdmVycmlkZSB2aWEgc2V0UHJvbXB0IHRvXG4gKiBwcm92aWRlIGFsdGVybmF0aXZlcyB0byB0aGUgbW9kYWwgYnJvd3NlciB3aW5kb3cuIEJ1aWx0LWluIGJyb3dzZXIgcHJvbXB0c1xuICogYXJlIG9mdGVuIHVzZWQgZm9yIGJldHRlciB0ZXh0IGlucHV0IGV4cGVyaWVuY2Ugb24gbW9iaWxlIGRldmljZS4gV2Ugc3Ryb25nbHlcbiAqIHJlY29tbWVuZCB0ZXN0aW5nIG1vYmlsZSB3aGVuIG92ZXJyaWRpbmcgdGhpcy5cbiAqXG4gKiBAcGFyYW0gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBkaXNwbGF5IHRvIHRoZSB1c2VyLlxuICogQHBhcmFtIGRlZmF1bHRWYWx1ZSBUaGUgdmFsdWUgdG8gaW5pdGlhbGl6ZSB0aGUgcHJvbXB0IHdpdGguXG4gKiBAcGFyYW0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIGZvciBoYW5kbGluZyB1c2VyIHJlc3BvbnNlLlxuICogQGFsaWFzIEJsb2NrbHkuZGlhbG9nLnByb21wdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcHJvbXB0KFxuICAgIG1lc3NhZ2U6IHN0cmluZywgZGVmYXVsdFZhbHVlOiBzdHJpbmcsXG4gICAgY2FsbGJhY2s6IChwMTogc3RyaW5nfG51bGwpID0+IHZvaWQpIHtcbiAgcHJvbXB0SW1wbGVtZW50YXRpb24obWVzc2FnZSwgZGVmYXVsdFZhbHVlLCBjYWxsYmFjayk7XG59XG5cbi8qKlxuICogU2V0cyB0aGUgZnVuY3Rpb24gdG8gYmUgcnVuIHdoZW4gQmxvY2tseS5kaWFsb2cucHJvbXB0KCkgaXMgY2FsbGVkLlxuICpcbiAqIEBwYXJhbSBwcm9tcHRGdW5jdGlvbiBUaGUgZnVuY3Rpb24gdG8gYmUgcnVuLlxuICogQHNlZSBCbG9ja2x5LmRpYWxvZy5wcm9tcHRcbiAqIEBhbGlhcyBCbG9ja2x5LmRpYWxvZy5zZXRQcm9tcHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldFByb21wdChcbiAgICBwcm9tcHRGdW5jdGlvbjogKHAxOiBzdHJpbmcsIHAyOiBzdHJpbmcsIHAzOiAocDE6IHN0cmluZ3xudWxsKSA9PiB2b2lkKSA9PlxuICAgICAgICB2b2lkKSB7XG4gIHByb21wdEltcGxlbWVudGF0aW9uID0gcHJvbXB0RnVuY3Rpb247XG59XG5cbmV4cG9ydCBjb25zdCBURVNUX09OTFkgPSB7XG4gIGNvbmZpcm1JbnRlcm5hbCxcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVXRpbGl0eSBmdW5jdGlvbnMgZm9yIGhhbmRsaW5nIHZhcmlhYmxlcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuVmFyaWFibGVzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVmFyaWFibGVzJyk7XG5cbmltcG9ydCB7QmxvY2tzfSBmcm9tICcuL2Jsb2Nrcy5qcyc7XG5pbXBvcnQgKiBhcyBkaWFsb2cgZnJvbSAnLi9kaWFsb2cuanMnO1xuaW1wb3J0IHtNc2d9IGZyb20gJy4vbXNnLmpzJztcbmltcG9ydCAqIGFzIHV0aWxzWG1sIGZyb20gJy4vdXRpbHMveG1sLmpzJztcbmltcG9ydCB7VmFyaWFibGVNb2RlbH0gZnJvbSAnLi92YXJpYWJsZV9tb2RlbC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuL3dvcmtzcGFjZS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4veG1sLmpzJztcblxuXG4vKipcbiAqIFN0cmluZyBmb3IgdXNlIGluIHRoZSBcImN1c3RvbVwiIGF0dHJpYnV0ZSBvZiBhIGNhdGVnb3J5IGluIHRvb2xib3ggWE1MLlxuICogVGhpcyBzdHJpbmcgaW5kaWNhdGVzIHRoYXQgdGhlIGNhdGVnb3J5IHNob3VsZCBiZSBkeW5hbWljYWxseSBwb3B1bGF0ZWQgd2l0aFxuICogdmFyaWFibGUgYmxvY2tzLlxuICogU2VlIGFsc28gQmxvY2tseS5Qcm9jZWR1cmVzLkNBVEVHT1JZX05BTUUgYW5kXG4gKiBCbG9ja2x5LlZhcmlhYmxlc0R5bmFtaWMuQ0FURUdPUllfTkFNRS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXMuQ0FURUdPUllfTkFNRVxuICovXG5leHBvcnQgY29uc3QgQ0FURUdPUllfTkFNRSA9ICdWQVJJQUJMRSc7XG5cbi8qKlxuICogRmluZCBhbGwgdXNlci1jcmVhdGVkIHZhcmlhYmxlcyB0aGF0IGFyZSBpbiB1c2UgaW4gdGhlIHdvcmtzcGFjZS5cbiAqIEZvciB1c2UgYnkgZ2VuZXJhdG9ycy5cbiAqIFRvIGdldCBhIGxpc3Qgb2YgYWxsIHZhcmlhYmxlcyBvbiBhIHdvcmtzcGFjZSwgaW5jbHVkaW5nIHVudXNlZCB2YXJpYWJsZXMsXG4gKiBjYWxsIFdvcmtzcGFjZS5nZXRBbGxWYXJpYWJsZXMuXG4gKlxuICogQHBhcmFtIHdzIFRoZSB3b3Jrc3BhY2UgdG8gc2VhcmNoIGZvciB2YXJpYWJsZXMuXG4gKiBAcmV0dXJucyBBcnJheSBvZiB2YXJpYWJsZSBtb2RlbHMuXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXMuYWxsVXNlZFZhck1vZGVsc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYWxsVXNlZFZhck1vZGVscyh3czogV29ya3NwYWNlKTogVmFyaWFibGVNb2RlbFtdIHtcbiAgY29uc3QgYmxvY2tzID0gd3MuZ2V0QWxsQmxvY2tzKGZhbHNlKTtcbiAgY29uc3QgdmFyaWFibGVzID0gbmV3IFNldDxWYXJpYWJsZU1vZGVsPigpO1xuICAvLyBJdGVyYXRlIHRocm91Z2ggZXZlcnkgYmxvY2sgYW5kIGFkZCBlYWNoIHZhcmlhYmxlIHRvIHRoZSBzZXQuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgYmxvY2tWYXJpYWJsZXMgPSBibG9ja3NbaV0uZ2V0VmFyTW9kZWxzKCk7XG4gICAgaWYgKGJsb2NrVmFyaWFibGVzKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJsb2NrVmFyaWFibGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlID0gYmxvY2tWYXJpYWJsZXNbal07XG4gICAgICAgIGNvbnN0IGlkID0gdmFyaWFibGUuZ2V0SWQoKTtcbiAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgdmFyaWFibGVzLmFkZCh2YXJpYWJsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gQ29udmVydCB0aGUgc2V0IGludG8gYSBsaXN0LlxuICByZXR1cm4gQXJyYXkuZnJvbSh2YXJpYWJsZXMudmFsdWVzKCkpO1xufVxuXG4vKipcbiAqIEZpbmQgYWxsIGRldmVsb3BlciB2YXJpYWJsZXMgdXNlZCBieSBibG9ja3MgaW4gdGhlIHdvcmtzcGFjZS5cbiAqIERldmVsb3BlciB2YXJpYWJsZXMgYXJlIG5ldmVyIHNob3duIHRvIHRoZSB1c2VyLCBidXQgYXJlIGRlY2xhcmVkIGFzIGdsb2JhbFxuICogdmFyaWFibGVzIGluIHRoZSBnZW5lcmF0ZWQgY29kZS5cbiAqIFRvIGRlY2xhcmUgZGV2ZWxvcGVyIHZhcmlhYmxlcywgZGVmaW5lIHRoZSBnZXREZXZlbG9wZXJWYXJpYWJsZXMgZnVuY3Rpb24gb25cbiAqIHlvdXIgYmxvY2sgYW5kIHJldHVybiBhIGxpc3Qgb2YgdmFyaWFibGUgbmFtZXMuXG4gKiBGb3IgdXNlIGJ5IGdlbmVyYXRvcnMuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNlYXJjaC5cbiAqIEByZXR1cm5zIEEgbGlzdCBvZiBub24tZHVwbGljYXRlZCB2YXJpYWJsZSBuYW1lcy5cbiAqIEBhbGlhcyBCbG9ja2x5LlZhcmlhYmxlcy5hbGxEZXZlbG9wZXJWYXJpYWJsZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFsbERldmVsb3BlclZhcmlhYmxlcyh3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IHN0cmluZ1tdIHtcbiAgY29uc3QgYmxvY2tzID0gd29ya3NwYWNlLmdldEFsbEJsb2NrcyhmYWxzZSk7XG4gIGNvbnN0IHZhcmlhYmxlcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICBmb3IgKGxldCBpID0gMCwgYmxvY2s7IGJsb2NrID0gYmxvY2tzW2ldOyBpKyspIHtcbiAgICBjb25zdCBnZXREZXZlbG9wZXJWYXJpYWJsZXMgPSBibG9jay5nZXREZXZlbG9wZXJWYXJpYWJsZXM7XG4gICAgaWYgKGdldERldmVsb3BlclZhcmlhYmxlcykge1xuICAgICAgY29uc3QgZGV2VmFycyA9IGdldERldmVsb3BlclZhcmlhYmxlcygpO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBkZXZWYXJzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIHZhcmlhYmxlcy5hZGQoZGV2VmFyc1tqXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIENvbnZlcnQgdGhlIHNldCBpbnRvIGEgbGlzdC5cbiAgcmV0dXJuIEFycmF5LmZyb20odmFyaWFibGVzLnZhbHVlcygpKTtcbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3QgdGhlIGVsZW1lbnRzIChibG9ja3MgYW5kIGJ1dHRvbikgcmVxdWlyZWQgYnkgdGhlIGZseW91dCBmb3IgdGhlXG4gKiB2YXJpYWJsZSBjYXRlZ29yeS5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgY29udGFpbmluZyB2YXJpYWJsZXMuXG4gKiBAcmV0dXJucyBBcnJheSBvZiBYTUwgZWxlbWVudHMuXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXMuZmx5b3V0Q2F0ZWdvcnlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZseW91dENhdGVnb3J5KHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKTogRWxlbWVudFtdIHtcbiAgbGV0IHhtbExpc3QgPSBuZXcgQXJyYXk8RWxlbWVudD4oKTtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3RleHQnLCAnJXtCS1lfTkVXX1ZBUklBQkxFfScpO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdjYWxsYmFja0tleScsICdDUkVBVEVfVkFSSUFCTEUnKTtcblxuICB3b3Jrc3BhY2UucmVnaXN0ZXJCdXR0b25DYWxsYmFjaygnQ1JFQVRFX1ZBUklBQkxFJywgZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgY3JlYXRlVmFyaWFibGVCdXR0b25IYW5kbGVyKGJ1dHRvbi5nZXRUYXJnZXRXb3Jrc3BhY2UoKSk7XG4gIH0pO1xuXG4gIHhtbExpc3QucHVzaChidXR0b24pO1xuXG4gIGNvbnN0IGJsb2NrTGlzdCA9IGZseW91dENhdGVnb3J5QmxvY2tzKHdvcmtzcGFjZSk7XG4gIHhtbExpc3QgPSB4bWxMaXN0LmNvbmNhdChibG9ja0xpc3QpO1xuICByZXR1cm4geG1sTGlzdDtcbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3QgdGhlIGJsb2NrcyByZXF1aXJlZCBieSB0aGUgZmx5b3V0IGZvciB0aGUgdmFyaWFibGUgY2F0ZWdvcnkuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIGNvbnRhaW5pbmcgdmFyaWFibGVzLlxuICogQHJldHVybnMgQXJyYXkgb2YgWE1MIGJsb2NrIGVsZW1lbnRzLlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzLmZseW91dENhdGVnb3J5QmxvY2tzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmbHlvdXRDYXRlZ29yeUJsb2Nrcyh3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IEVsZW1lbnRbXSB7XG4gIGNvbnN0IHZhcmlhYmxlTW9kZWxMaXN0ID0gd29ya3NwYWNlLmdldFZhcmlhYmxlc09mVHlwZSgnJyk7XG5cbiAgY29uc3QgeG1sTGlzdCA9IFtdO1xuICBpZiAodmFyaWFibGVNb2RlbExpc3QubGVuZ3RoID4gMCkge1xuICAgIC8vIE5ldyB2YXJpYWJsZXMgYXJlIGFkZGVkIHRvIHRoZSBlbmQgb2YgdGhlIHZhcmlhYmxlTW9kZWxMaXN0LlxuICAgIGNvbnN0IG1vc3RSZWNlbnRWYXJpYWJsZSA9IHZhcmlhYmxlTW9kZWxMaXN0W3ZhcmlhYmxlTW9kZWxMaXN0Lmxlbmd0aCAtIDFdO1xuICAgIGlmIChCbG9ja3NbJ3ZhcmlhYmxlc19zZXQnXSkge1xuICAgICAgY29uc3QgYmxvY2sgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdibG9jaycpO1xuICAgICAgYmxvY2suc2V0QXR0cmlidXRlKCd0eXBlJywgJ3ZhcmlhYmxlc19zZXQnKTtcbiAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZ2FwJywgQmxvY2tzWydtYXRoX2NoYW5nZSddID8gJzgnIDogJzI0Jyk7XG4gICAgICBibG9jay5hcHBlbmRDaGlsZChnZW5lcmF0ZVZhcmlhYmxlRmllbGREb20obW9zdFJlY2VudFZhcmlhYmxlKSk7XG4gICAgICB4bWxMaXN0LnB1c2goYmxvY2spO1xuICAgIH1cbiAgICBpZiAoQmxvY2tzWydtYXRoX2NoYW5nZSddKSB7XG4gICAgICBjb25zdCBibG9jayA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2Jsb2NrJyk7XG4gICAgICBibG9jay5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnbWF0aF9jaGFuZ2UnKTtcbiAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZ2FwJywgQmxvY2tzWyd2YXJpYWJsZXNfZ2V0J10gPyAnMjAnIDogJzgnKTtcbiAgICAgIGJsb2NrLmFwcGVuZENoaWxkKGdlbmVyYXRlVmFyaWFibGVGaWVsZERvbShtb3N0UmVjZW50VmFyaWFibGUpKTtcbiAgICAgIGNvbnN0IHZhbHVlID0gWG1sLnRleHRUb0RvbShcbiAgICAgICAgICAnPHZhbHVlIG5hbWU9XCJERUxUQVwiPicgK1xuICAgICAgICAgICc8c2hhZG93IHR5cGU9XCJtYXRoX251bWJlclwiPicgK1xuICAgICAgICAgICc8ZmllbGQgbmFtZT1cIk5VTVwiPjE8L2ZpZWxkPicgK1xuICAgICAgICAgICc8L3NoYWRvdz4nICtcbiAgICAgICAgICAnPC92YWx1ZT4nKTtcbiAgICAgIGJsb2NrLmFwcGVuZENoaWxkKHZhbHVlKTtcbiAgICAgIHhtbExpc3QucHVzaChibG9jayk7XG4gICAgfVxuXG4gICAgaWYgKEJsb2Nrc1sndmFyaWFibGVzX2dldCddKSB7XG4gICAgICB2YXJpYWJsZU1vZGVsTGlzdC5zb3J0KFZhcmlhYmxlTW9kZWwuY29tcGFyZUJ5TmFtZSk7XG4gICAgICBmb3IgKGxldCBpID0gMCwgdmFyaWFibGU7IHZhcmlhYmxlID0gdmFyaWFibGVNb2RlbExpc3RbaV07IGkrKykge1xuICAgICAgICBjb25zdCBibG9jayA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2Jsb2NrJyk7XG4gICAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgndHlwZScsICd2YXJpYWJsZXNfZ2V0Jyk7XG4gICAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZ2FwJywgJzgnKTtcbiAgICAgICAgYmxvY2suYXBwZW5kQ2hpbGQoZ2VuZXJhdGVWYXJpYWJsZUZpZWxkRG9tKHZhcmlhYmxlKSk7XG4gICAgICAgIHhtbExpc3QucHVzaChibG9jayk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB4bWxMaXN0O1xufVxuXG4vKiogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzLlZBUl9MRVRURVJfT1BUSU9OUyAqL1xuZXhwb3J0IGNvbnN0IFZBUl9MRVRURVJfT1BUSU9OUyA9ICdpamttbm9wcXJzdHV2d3h5emFiY2RlZmdoJztcblxuLyoqXG4gKiBSZXR1cm4gYSBuZXcgdmFyaWFibGUgbmFtZSB0aGF0IGlzIG5vdCB5ZXQgYmVpbmcgdXNlZC4gVGhpcyB3aWxsIHRyeSB0b1xuICogZ2VuZXJhdGUgc2luZ2xlIGxldHRlciB2YXJpYWJsZSBuYW1lcyBpbiB0aGUgcmFuZ2UgJ2knIHRvICd6JyB0byBzdGFydCB3aXRoLlxuICogSWYgbm8gdW5pcXVlIG5hbWUgaXMgbG9jYXRlZCBpdCB3aWxsIHRyeSAnaScgdG8gJ3onLCAnYScgdG8gJ2gnLFxuICogdGhlbiAnaTInIHRvICd6MicgZXRjLiAgU2tpcCAnbCcuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIGJlIHVuaXF1ZSBpbi5cbiAqIEByZXR1cm5zIE5ldyB2YXJpYWJsZSBuYW1lLlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzLmdlbmVyYXRlVW5pcXVlTmFtZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVVbmlxdWVOYW1lKHdvcmtzcGFjZTogV29ya3NwYWNlKTogc3RyaW5nIHtcbiAgcmV0dXJuIFRFU1RfT05MWS5nZW5lcmF0ZVVuaXF1ZU5hbWVJbnRlcm5hbCh3b3Jrc3BhY2UpO1xufVxuXG4vKipcbiAqIFByaXZhdGUgdmVyc2lvbiBvZiBnZW5lcmF0ZVVuaXF1ZU5hbWUgZm9yIHN0dWJiaW5nIGluIHRlc3RzLlxuICovXG5mdW5jdGlvbiBnZW5lcmF0ZVVuaXF1ZU5hbWVJbnRlcm5hbCh3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IHN0cmluZyB7XG4gIHJldHVybiBnZW5lcmF0ZVVuaXF1ZU5hbWVGcm9tT3B0aW9ucyhcbiAgICAgIFZBUl9MRVRURVJfT1BUSU9OUy5jaGFyQXQoMCksIHdvcmtzcGFjZS5nZXRBbGxWYXJpYWJsZU5hbWVzKCkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSB1bmlxdWUgbmFtZSB0aGF0IGlzIG5vdCBwcmVzZW50IGluIHRoZSB1c2VkTmFtZXMgYXJyYXkuIFRoaXNcbiAqIHdpbGwgdHJ5IHRvIGdlbmVyYXRlIHNpbmdsZSBsZXR0ZXIgbmFtZXMgaW4gdGhlIHJhbmdlIGEgLSB6IChza2lwIGwpLiBJdFxuICogd2lsbCBzdGFydCB3aXRoIHRoZSBjaGFyYWN0ZXIgcGFzc2VkIHRvIHN0YXJ0Q2hhci5cbiAqXG4gKiBAcGFyYW0gc3RhcnRDaGFyIFRoZSBjaGFyYWN0ZXIgdG8gc3RhcnQgdGhlIHNlYXJjaCBhdC5cbiAqIEBwYXJhbSB1c2VkTmFtZXMgQSBsaXN0IG9mIGFsbCBvZiB0aGUgdXNlZCBuYW1lcy5cbiAqIEByZXR1cm5zIEEgdW5pcXVlIG5hbWUgdGhhdCBpcyBub3QgcHJlc2VudCBpbiB0aGUgdXNlZE5hbWVzIGFycmF5LlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzLmdlbmVyYXRlVW5pcXVlTmFtZUZyb21PcHRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVVuaXF1ZU5hbWVGcm9tT3B0aW9ucyhcbiAgICBzdGFydENoYXI6IHN0cmluZywgdXNlZE5hbWVzOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gIGlmICghdXNlZE5hbWVzLmxlbmd0aCkge1xuICAgIHJldHVybiBzdGFydENoYXI7XG4gIH1cblxuICBjb25zdCBsZXR0ZXJzID0gVkFSX0xFVFRFUl9PUFRJT05TO1xuICBsZXQgc3VmZml4ID0gJyc7XG4gIGxldCBsZXR0ZXJJbmRleCA9IGxldHRlcnMuaW5kZXhPZihzdGFydENoYXIpO1xuICBsZXQgcG90TmFtZSA9IHN0YXJ0Q2hhcjtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc3RhbnQtY29uZGl0aW9uXG4gIHdoaWxlICh0cnVlKSB7XG4gICAgbGV0IGluVXNlID0gZmFsc2U7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VkTmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh1c2VkTmFtZXNbaV0udG9Mb3dlckNhc2UoKSA9PT0gcG90TmFtZSkge1xuICAgICAgICBpblVzZSA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWluVXNlKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICBsZXR0ZXJJbmRleCsrO1xuICAgIGlmIChsZXR0ZXJJbmRleCA9PT0gbGV0dGVycy5sZW5ndGgpIHtcbiAgICAgIC8vIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgY2hhcmFjdGVyIHNlcXVlbmNlIHNvIGJhY2sgdG8gJ2knLlxuICAgICAgbGV0dGVySW5kZXggPSAwO1xuICAgICAgc3VmZml4ID0gYCR7TnVtYmVyKHN1ZmZpeCkgKyAxfWA7XG4gICAgfVxuICAgIHBvdE5hbWUgPSBsZXR0ZXJzLmNoYXJBdChsZXR0ZXJJbmRleCkgKyBzdWZmaXg7XG4gIH1cbiAgcmV0dXJuIHBvdE5hbWU7XG59XG5cbi8qKlxuICogSGFuZGxlcyBcIkNyZWF0ZSBWYXJpYWJsZVwiIGJ1dHRvbiBpbiB0aGUgZGVmYXVsdCB2YXJpYWJsZXMgdG9vbGJveCBjYXRlZ29yeS5cbiAqIEl0IHdpbGwgcHJvbXB0IHRoZSB1c2VyIGZvciBhIHZhcmlhYmxlIG5hbWUsIGluY2x1ZGluZyByZS1wcm9tcHRzIGlmIGEgbmFtZVxuICogaXMgYWxyZWFkeSBpbiB1c2UgYW1vbmcgdGhlIHdvcmtzcGFjZSdzIHZhcmlhYmxlcy5cbiAqXG4gKiBDdXN0b20gYnV0dG9uIGhhbmRsZXJzIGNhbiBkZWxlZ2F0ZSB0byB0aGlzIGZ1bmN0aW9uLCBhbGxvd2luZyB2YXJpYWJsZXNcbiAqIHR5cGVzIGFuZCBhZnRlci1jcmVhdGlvbiBwcm9jZXNzaW5nLiBNb3JlIGNvbXBsZXggY3VzdG9taXphdGlvbiAoZS5nLixcbiAqIHByb21wdGluZyBmb3IgdmFyaWFibGUgdHlwZSkgaXMgYmV5b25kIHRoZSBzY29wZSBvZiB0aGlzIGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBvbiB3aGljaCB0byBjcmVhdGUgdGhlIHZhcmlhYmxlLlxuICogQHBhcmFtIG9wdF9jYWxsYmFjayBBIGNhbGxiYWNrLiBJdCB3aWxsIGJlIHBhc3NlZCBhbiBhY2NlcHRhYmxlIG5ldyB2YXJpYWJsZVxuICogICAgIG5hbWUsIG9yIG51bGwgaWYgY2hhbmdlIGlzIHRvIGJlIGFib3J0ZWQgKGNhbmNlbCBidXR0b24pLCBvciB1bmRlZmluZWQgaWZcbiAqICAgICBhbiBleGlzdGluZyB2YXJpYWJsZSB3YXMgY2hvc2VuLlxuICogQHBhcmFtIG9wdF90eXBlIFRoZSB0eXBlIG9mIHRoZSB2YXJpYWJsZSBsaWtlICdpbnQnLCAnc3RyaW5nJywgb3IgJycuIFRoaXNcbiAqICAgICB3aWxsIGRlZmF1bHQgdG8gJycsIHdoaWNoIGlzIGEgc3BlY2lmaWMgdHlwZS5cbiAqIEBhbGlhcyBCbG9ja2x5LlZhcmlhYmxlcy5jcmVhdGVWYXJpYWJsZUJ1dHRvbkhhbmRsZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVZhcmlhYmxlQnV0dG9uSGFuZGxlcihcbiAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgb3B0X2NhbGxiYWNrPzogKHAxPzogc3RyaW5nfG51bGwpID0+IHZvaWQsXG4gICAgb3B0X3R5cGU/OiBzdHJpbmcpIHtcbiAgY29uc3QgdHlwZSA9IG9wdF90eXBlIHx8ICcnO1xuICAvLyBUaGlzIGZ1bmN0aW9uIG5lZWRzIHRvIGJlIG5hbWVkIHNvIGl0IGNhbiBiZSBjYWxsZWQgcmVjdXJzaXZlbHkuXG4gIGZ1bmN0aW9uIHByb21wdEFuZENoZWNrV2l0aEFsZXJ0KGRlZmF1bHROYW1lOiBzdHJpbmcpIHtcbiAgICBwcm9tcHROYW1lKE1zZ1snTkVXX1ZBUklBQkxFX1RJVExFJ10sIGRlZmF1bHROYW1lLCBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICBjb25zdCBleGlzdGluZyA9IG5hbWVVc2VkV2l0aEFueVR5cGUodGV4dCwgd29ya3NwYWNlKTtcbiAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgbGV0IG1zZztcbiAgICAgICAgICBpZiAoZXhpc3RpbmcudHlwZSA9PT0gdHlwZSkge1xuICAgICAgICAgICAgbXNnID0gTXNnWydWQVJJQUJMRV9BTFJFQURZX0VYSVNUUyddLnJlcGxhY2UoJyUxJywgZXhpc3RpbmcubmFtZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1zZyA9IE1zZ1snVkFSSUFCTEVfQUxSRUFEWV9FWElTVFNfRk9SX0FOT1RIRVJfVFlQRSddO1xuICAgICAgICAgICAgbXNnID0gbXNnLnJlcGxhY2UoJyUxJywgZXhpc3RpbmcubmFtZSkucmVwbGFjZSgnJTInLCBleGlzdGluZy50eXBlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGlhbG9nLmFsZXJ0KG1zZywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBwcm9tcHRBbmRDaGVja1dpdGhBbGVydCh0ZXh0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBObyBjb25mbGljdFxuICAgICAgICAgIHdvcmtzcGFjZS5jcmVhdGVWYXJpYWJsZSh0ZXh0LCB0eXBlKTtcbiAgICAgICAgICBpZiAob3B0X2NhbGxiYWNrKSB7XG4gICAgICAgICAgICBvcHRfY2FsbGJhY2sodGV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2VyIGNhbmNlbGVkIHByb21wdC5cbiAgICAgICAgaWYgKG9wdF9jYWxsYmFjaykge1xuICAgICAgICAgIG9wdF9jYWxsYmFjayhudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHByb21wdEFuZENoZWNrV2l0aEFsZXJ0KCcnKTtcbn1cblxuLyoqXG4gKiBPcGVucyBhIHByb21wdCB0aGF0IGFsbG93cyB0aGUgdXNlciB0byBlbnRlciBhIG5ldyBuYW1lIGZvciBhIHZhcmlhYmxlLlxuICogVHJpZ2dlcnMgYSByZW5hbWUgaWYgdGhlIG5ldyBuYW1lIGlzIHZhbGlkLiBPciByZS1wcm9tcHRzIGlmIHRoZXJlIGlzIGFcbiAqIGNvbGxpc2lvbi5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2Ugb24gd2hpY2ggdG8gcmVuYW1lIHRoZSB2YXJpYWJsZS5cbiAqIEBwYXJhbSB2YXJpYWJsZSBWYXJpYWJsZSB0byByZW5hbWUuXG4gKiBAcGFyYW0gb3B0X2NhbGxiYWNrIEEgY2FsbGJhY2suIEl0IHdpbGwgYmUgcGFzc2VkIGFuIGFjY2VwdGFibGUgbmV3IHZhcmlhYmxlXG4gKiAgICAgbmFtZSwgb3IgbnVsbCBpZiBjaGFuZ2UgaXMgdG8gYmUgYWJvcnRlZCAoY2FuY2VsIGJ1dHRvbiksIG9yIHVuZGVmaW5lZCBpZlxuICogICAgIGFuIGV4aXN0aW5nIHZhcmlhYmxlIHdhcyBjaG9zZW4uXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXMucmVuYW1lVmFyaWFibGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbmFtZVZhcmlhYmxlKFxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlLCB2YXJpYWJsZTogVmFyaWFibGVNb2RlbCxcbiAgICBvcHRfY2FsbGJhY2s/OiAocDE/OiBzdHJpbmd8bnVsbCkgPT4gdm9pZCkge1xuICAvLyBUaGlzIGZ1bmN0aW9uIG5lZWRzIHRvIGJlIG5hbWVkIHNvIGl0IGNhbiBiZSBjYWxsZWQgcmVjdXJzaXZlbHkuXG4gIGZ1bmN0aW9uIHByb21wdEFuZENoZWNrV2l0aEFsZXJ0KGRlZmF1bHROYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBwcm9tcHRUZXh0ID1cbiAgICAgICAgTXNnWydSRU5BTUVfVkFSSUFCTEVfVElUTEUnXS5yZXBsYWNlKCclMScsIHZhcmlhYmxlLm5hbWUpO1xuICAgIHByb21wdE5hbWUocHJvbXB0VGV4dCwgZGVmYXVsdE5hbWUsIGZ1bmN0aW9uKG5ld05hbWUpIHtcbiAgICAgIGlmIChuZXdOYW1lKSB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID1cbiAgICAgICAgICAgIG5hbWVVc2VkV2l0aE90aGVyVHlwZShuZXdOYW1lLCB2YXJpYWJsZS50eXBlLCB3b3Jrc3BhY2UpO1xuICAgICAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgICAgICBjb25zdCBtc2cgPSBNc2dbJ1ZBUklBQkxFX0FMUkVBRFlfRVhJU1RTX0ZPUl9BTk9USEVSX1RZUEUnXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnJTEnLCBleGlzdGluZy5uYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnJTInLCBleGlzdGluZy50eXBlKTtcbiAgICAgICAgICBkaWFsb2cuYWxlcnQobXNnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHByb21wdEFuZENoZWNrV2l0aEFsZXJ0KG5ld05hbWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdvcmtzcGFjZS5yZW5hbWVWYXJpYWJsZUJ5SWQodmFyaWFibGUuZ2V0SWQoKSwgbmV3TmFtZSk7XG4gICAgICAgICAgaWYgKG9wdF9jYWxsYmFjaykge1xuICAgICAgICAgICAgb3B0X2NhbGxiYWNrKG5ld05hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVXNlciBjYW5jZWxlZCBwcm9tcHQuXG4gICAgICAgIGlmIChvcHRfY2FsbGJhY2spIHtcbiAgICAgICAgICBvcHRfY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBwcm9tcHRBbmRDaGVja1dpdGhBbGVydCgnJyk7XG59XG5cbi8qKlxuICogUHJvbXB0IHRoZSB1c2VyIGZvciBhIG5ldyB2YXJpYWJsZSBuYW1lLlxuICpcbiAqIEBwYXJhbSBwcm9tcHRUZXh0IFRoZSBzdHJpbmcgb2YgdGhlIHByb21wdC5cbiAqIEBwYXJhbSBkZWZhdWx0VGV4dCBUaGUgZGVmYXVsdCB2YWx1ZSB0byBzaG93IGluIHRoZSBwcm9tcHQncyBmaWVsZC5cbiAqIEBwYXJhbSBjYWxsYmFjayBBIGNhbGxiYWNrLiBJdCB3aWxsIGJlIHBhc3NlZCB0aGUgbmV3IHZhcmlhYmxlIG5hbWUsIG9yIG51bGxcbiAqICAgICBpZiB0aGUgdXNlciBwaWNrZWQgc29tZXRoaW5nIGlsbGVnYWwuXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXMucHJvbXB0TmFtZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcHJvbXB0TmFtZShcbiAgICBwcm9tcHRUZXh0OiBzdHJpbmcsIGRlZmF1bHRUZXh0OiBzdHJpbmcsXG4gICAgY2FsbGJhY2s6IChwMTogc3RyaW5nfG51bGwpID0+IHZvaWQpIHtcbiAgZGlhbG9nLnByb21wdChwcm9tcHRUZXh0LCBkZWZhdWx0VGV4dCwgZnVuY3Rpb24obmV3VmFyKSB7XG4gICAgLy8gTWVyZ2UgcnVucyBvZiB3aGl0ZXNwYWNlLiAgU3RyaXAgbGVhZGluZyBhbmQgdHJhaWxpbmcgd2hpdGVzcGFjZS5cbiAgICAvLyBCZXlvbmQgdGhpcywgYWxsIG5hbWVzIGFyZSBsZWdhbC5cbiAgICBpZiAobmV3VmFyKSB7XG4gICAgICBuZXdWYXIgPSBuZXdWYXIucmVwbGFjZSgvW1xcc1xceGEwXSsvZywgJyAnKS50cmltKCk7XG4gICAgICBpZiAobmV3VmFyID09PSBNc2dbJ1JFTkFNRV9WQVJJQUJMRSddIHx8IG5ld1ZhciA9PT0gTXNnWydORVdfVkFSSUFCTEUnXSkge1xuICAgICAgICAvLyBPaywgbm90IEFMTCBuYW1lcyBhcmUgbGVnYWwuLi5cbiAgICAgICAgbmV3VmFyID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgY2FsbGJhY2sobmV3VmFyKTtcbiAgfSk7XG59XG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdGhlcmUgZXhpc3RzIGEgdmFyaWFibGUgd2l0aCB0aGUgZ2l2ZW4gbmFtZSBidXQgYSBkaWZmZXJlbnRcbiAqIHR5cGUuXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgdG8gc2VhcmNoIGZvci5cbiAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIHRvIGV4Y2x1ZGUgZnJvbSB0aGUgc2VhcmNoLlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNlYXJjaCBmb3IgdGhlIHZhcmlhYmxlLlxuICogQHJldHVybnMgVGhlIHZhcmlhYmxlIHdpdGggdGhlIGdpdmVuIG5hbWUgYW5kIGEgZGlmZmVyZW50IHR5cGUsIG9yIG51bGwgaWZcbiAqICAgICBub25lIHdhcyBmb3VuZC5cbiAqL1xuZnVuY3Rpb24gbmFtZVVzZWRXaXRoT3RoZXJUeXBlKFxuICAgIG5hbWU6IHN0cmluZywgdHlwZTogc3RyaW5nLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IFZhcmlhYmxlTW9kZWx8bnVsbCB7XG4gIGNvbnN0IGFsbFZhcmlhYmxlcyA9IHdvcmtzcGFjZS5nZXRWYXJpYWJsZU1hcCgpLmdldEFsbFZhcmlhYmxlcygpO1xuXG4gIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGZvciAobGV0IGkgPSAwLCB2YXJpYWJsZTsgdmFyaWFibGUgPSBhbGxWYXJpYWJsZXNbaV07IGkrKykge1xuICAgIGlmICh2YXJpYWJsZS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgJiYgdmFyaWFibGUudHlwZSAhPT0gdHlwZSkge1xuICAgICAgcmV0dXJuIHZhcmlhYmxlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZXJlIGV4aXN0cyBhIHZhcmlhYmxlIHdpdGggdGhlIGdpdmVuIG5hbWUgb2YgYW55IHR5cGUuXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgdG8gc2VhcmNoIGZvci5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBzZWFyY2ggZm9yIHRoZSB2YXJpYWJsZS5cbiAqIEByZXR1cm5zIFRoZSB2YXJpYWJsZSB3aXRoIHRoZSBnaXZlbiBuYW1lLCBvciBudWxsIGlmIG5vbmUgd2FzIGZvdW5kLlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzLm5hbWVVc2VkV2l0aEFueVR5cGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5hbWVVc2VkV2l0aEFueVR5cGUoXG4gICAgbmFtZTogc3RyaW5nLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IFZhcmlhYmxlTW9kZWx8bnVsbCB7XG4gIGNvbnN0IGFsbFZhcmlhYmxlcyA9IHdvcmtzcGFjZS5nZXRWYXJpYWJsZU1hcCgpLmdldEFsbFZhcmlhYmxlcygpO1xuXG4gIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGZvciAobGV0IGkgPSAwLCB2YXJpYWJsZTsgdmFyaWFibGUgPSBhbGxWYXJpYWJsZXNbaV07IGkrKykge1xuICAgIGlmICh2YXJpYWJsZS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUpIHtcbiAgICAgIHJldHVybiB2YXJpYWJsZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogR2VuZXJhdGUgRE9NIG9iamVjdHMgcmVwcmVzZW50aW5nIGEgdmFyaWFibGUgZmllbGQuXG4gKlxuICogQHBhcmFtIHZhcmlhYmxlTW9kZWwgVGhlIHZhcmlhYmxlIG1vZGVsIHRvIHJlcHJlc2VudC5cbiAqIEByZXR1cm5zIFRoZSBnZW5lcmF0ZWQgRE9NLlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzLmdlbmVyYXRlVmFyaWFibGVGaWVsZERvbVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVWYXJpYWJsZUZpZWxkRG9tKHZhcmlhYmxlTW9kZWw6IFZhcmlhYmxlTW9kZWwpOlxuICAgIEVsZW1lbnQge1xuICAvKiBHZW5lcmF0ZXMgdGhlIGZvbGxvd2luZyBYTUw6XG4gICAqIDxmaWVsZCBuYW1lPVwiVkFSXCIgaWQ9XCJnb0tUS21ZSjhEaFZIcHJ1dlwiIHZhcmlhYmxldHlwZT1cImludFwiPmZvbzwvZmllbGQ+XG4gICAqL1xuICBjb25zdCBmaWVsZCA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2ZpZWxkJyk7XG4gIGZpZWxkLnNldEF0dHJpYnV0ZSgnbmFtZScsICdWQVInKTtcbiAgZmllbGQuc2V0QXR0cmlidXRlKCdpZCcsIHZhcmlhYmxlTW9kZWwuZ2V0SWQoKSk7XG4gIGZpZWxkLnNldEF0dHJpYnV0ZSgndmFyaWFibGV0eXBlJywgdmFyaWFibGVNb2RlbC50eXBlKTtcbiAgY29uc3QgbmFtZSA9IHV0aWxzWG1sLmNyZWF0ZVRleHROb2RlKHZhcmlhYmxlTW9kZWwubmFtZSk7XG4gIGZpZWxkLmFwcGVuZENoaWxkKG5hbWUpO1xuICByZXR1cm4gZmllbGQ7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGxvb2sgdXAgb3IgY3JlYXRlIGEgdmFyaWFibGUgb24gdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAqIElmIG5vIHZhcmlhYmxlIGV4aXN0cywgY3JlYXRlcyBhbmQgcmV0dXJucyBpdC5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gc2VhcmNoIGZvciB0aGUgdmFyaWFibGUuICBJdCBtYXkgYmUgYVxuICogICAgIGZseW91dCB3b3Jrc3BhY2Ugb3IgbWFpbiB3b3Jrc3BhY2UuXG4gKiBAcGFyYW0gaWQgVGhlIElEIHRvIHVzZSB0byBsb29rIHVwIG9yIGNyZWF0ZSB0aGUgdmFyaWFibGUsIG9yIG51bGwuXG4gKiBAcGFyYW0gb3B0X25hbWUgVGhlIHN0cmluZyB0byB1c2UgdG8gbG9vayB1cCBvciBjcmVhdGUgdGhlIHZhcmlhYmxlLlxuICogQHBhcmFtIG9wdF90eXBlIFRoZSB0eXBlIHRvIHVzZSB0byBsb29rIHVwIG9yIGNyZWF0ZSB0aGUgdmFyaWFibGUuXG4gKiBAcmV0dXJucyBUaGUgdmFyaWFibGUgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gSUQgb3IgbmFtZSArIHR5cGVcbiAqICAgICBjb21iaW5hdGlvbi5cbiAqIEBhbGlhcyBCbG9ja2x5LlZhcmlhYmxlcy5nZXRPckNyZWF0ZVZhcmlhYmxlUGFja2FnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0T3JDcmVhdGVWYXJpYWJsZVBhY2thZ2UoXG4gICAgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGlkOiBzdHJpbmd8bnVsbCwgb3B0X25hbWU/OiBzdHJpbmcsXG4gICAgb3B0X3R5cGU/OiBzdHJpbmcpOiBWYXJpYWJsZU1vZGVsIHtcbiAgbGV0IHZhcmlhYmxlID0gZ2V0VmFyaWFibGUod29ya3NwYWNlLCBpZCwgb3B0X25hbWUsIG9wdF90eXBlKTtcbiAgaWYgKCF2YXJpYWJsZSkge1xuICAgIHZhcmlhYmxlID0gY3JlYXRlVmFyaWFibGUod29ya3NwYWNlLCBpZCwgb3B0X25hbWUsIG9wdF90eXBlKTtcbiAgfVxuICByZXR1cm4gdmFyaWFibGU7XG59XG5cbi8qKlxuICogTG9vayB1cCAgYSB2YXJpYWJsZSBvbiB0aGUgZ2l2ZW4gd29ya3NwYWNlLlxuICogQWx3YXlzIGxvb2tzIGluIHRoZSBtYWluIHdvcmtzcGFjZSBiZWZvcmUgbG9va2luZyBpbiB0aGUgZmx5b3V0IHdvcmtzcGFjZS5cbiAqIEFsd2F5cyBwcmVmZXJzIGxvb2t1cCBieSBJRCB0byBsb29rdXAgYnkgbmFtZSArIHR5cGUuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNlYXJjaCBmb3IgdGhlIHZhcmlhYmxlLiAgSXQgbWF5IGJlIGFcbiAqICAgICBmbHlvdXQgd29ya3NwYWNlIG9yIG1haW4gd29ya3NwYWNlLlxuICogQHBhcmFtIGlkIFRoZSBJRCB0byB1c2UgdG8gbG9vayB1cCB0aGUgdmFyaWFibGUsIG9yIG51bGwuXG4gKiBAcGFyYW0gb3B0X25hbWUgVGhlIHN0cmluZyB0byB1c2UgdG8gbG9vayB1cCB0aGUgdmFyaWFibGUuXG4gKiAgICAgT25seSB1c2VkIGlmIGxvb2t1cCBieSBJRCBmYWlscy5cbiAqIEBwYXJhbSBvcHRfdHlwZSBUaGUgdHlwZSB0byB1c2UgdG8gbG9vayB1cCB0aGUgdmFyaWFibGUuXG4gKiAgICAgT25seSB1c2VkIGlmIGxvb2t1cCBieSBJRCBmYWlscy5cbiAqIEByZXR1cm5zIFRoZSB2YXJpYWJsZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBJRCBvciBuYW1lICsgdHlwZVxuICogICAgIGNvbWJpbmF0aW9uLCBvciBudWxsIGlmIG5vdCBmb3VuZC5cbiAqIEBhbGlhcyBCbG9ja2x5LlZhcmlhYmxlcy5nZXRWYXJpYWJsZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0VmFyaWFibGUoXG4gICAgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGlkOiBzdHJpbmd8bnVsbCwgb3B0X25hbWU/OiBzdHJpbmcsXG4gICAgb3B0X3R5cGU/OiBzdHJpbmcpOiBWYXJpYWJsZU1vZGVsfG51bGwge1xuICBjb25zdCBwb3RlbnRpYWxWYXJpYWJsZU1hcCA9IHdvcmtzcGFjZS5nZXRQb3RlbnRpYWxWYXJpYWJsZU1hcCgpO1xuICBsZXQgdmFyaWFibGUgPSBudWxsO1xuICAvLyBUcnkgdG8ganVzdCBnZXQgdGhlIHZhcmlhYmxlLCBieSBJRCBpZiBwb3NzaWJsZS5cbiAgaWYgKGlkKSB7XG4gICAgLy8gTG9vayBpbiB0aGUgcmVhbCB2YXJpYWJsZSBtYXAgYmVmb3JlIGNoZWNraW5nIHRoZSBwb3RlbnRpYWwgdmFyaWFibGUgbWFwLlxuICAgIHZhcmlhYmxlID0gd29ya3NwYWNlLmdldFZhcmlhYmxlQnlJZChpZCk7XG4gICAgaWYgKCF2YXJpYWJsZSAmJiBwb3RlbnRpYWxWYXJpYWJsZU1hcCkge1xuICAgICAgdmFyaWFibGUgPSBwb3RlbnRpYWxWYXJpYWJsZU1hcC5nZXRWYXJpYWJsZUJ5SWQoaWQpO1xuICAgIH1cbiAgICBpZiAodmFyaWFibGUpIHtcbiAgICAgIHJldHVybiB2YXJpYWJsZTtcbiAgICB9XG4gIH1cbiAgLy8gSWYgdGhlcmUgd2FzIG5vIElELCBvciB0aGVyZSB3YXMgYW4gSUQgYnV0IGl0IGRpZG4ndCBtYXRjaCBhbnkgdmFyaWFibGVzLFxuICAvLyBsb29rIHVwIGJ5IG5hbWUgYW5kIHR5cGUuXG4gIGlmIChvcHRfbmFtZSkge1xuICAgIGlmIChvcHRfdHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBFcnJvcignVHJpZWQgdG8gbG9vayB1cCBhIHZhcmlhYmxlIGJ5IG5hbWUgd2l0aG91dCBhIHR5cGUnKTtcbiAgICB9XG4gICAgLy8gT3RoZXJ3aXNlIGxvb2sgdXAgYnkgbmFtZSBhbmQgdHlwZS5cbiAgICB2YXJpYWJsZSA9IHdvcmtzcGFjZS5nZXRWYXJpYWJsZShvcHRfbmFtZSwgb3B0X3R5cGUpO1xuICAgIGlmICghdmFyaWFibGUgJiYgcG90ZW50aWFsVmFyaWFibGVNYXApIHtcbiAgICAgIHZhcmlhYmxlID0gcG90ZW50aWFsVmFyaWFibGVNYXAuZ2V0VmFyaWFibGUob3B0X25hbWUsIG9wdF90eXBlKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhcmlhYmxlO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgYSB2YXJpYWJsZSBvbiB0aGUgZ2l2ZW4gd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBpbiB3aGljaCB0byBjcmVhdGUgdGhlIHZhcmlhYmxlLiAgSXQgbWF5IGJlIGFcbiAqICAgICBmbHlvdXQgd29ya3NwYWNlIG9yIG1haW4gd29ya3NwYWNlLlxuICogQHBhcmFtIGlkIFRoZSBJRCB0byB1c2UgdG8gY3JlYXRlIHRoZSB2YXJpYWJsZSwgb3IgbnVsbC5cbiAqIEBwYXJhbSBvcHRfbmFtZSBUaGUgc3RyaW5nIHRvIHVzZSB0byBjcmVhdGUgdGhlIHZhcmlhYmxlLlxuICogQHBhcmFtIG9wdF90eXBlIFRoZSB0eXBlIHRvIHVzZSB0byBjcmVhdGUgdGhlIHZhcmlhYmxlLlxuICogQHJldHVybnMgVGhlIHZhcmlhYmxlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIElEIG9yIG5hbWUgKyB0eXBlXG4gKiAgICAgY29tYmluYXRpb24uXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVZhcmlhYmxlKFxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlLCBpZDogc3RyaW5nfG51bGwsIG9wdF9uYW1lPzogc3RyaW5nLFxuICAgIG9wdF90eXBlPzogc3RyaW5nKTogVmFyaWFibGVNb2RlbCB7XG4gIGNvbnN0IHBvdGVudGlhbFZhcmlhYmxlTWFwID0gd29ya3NwYWNlLmdldFBvdGVudGlhbFZhcmlhYmxlTWFwKCk7XG4gIC8vIFZhcmlhYmxlcyB3aXRob3V0IG5hbWVzIGdldCB1bmlxdWVseSBuYW1lZCBmb3IgdGhpcyB3b3Jrc3BhY2UuXG4gIGlmICghb3B0X25hbWUpIHtcbiAgICBjb25zdCB3cyA9XG4gICAgICAgICh3b3Jrc3BhY2UuaXNGbHlvdXQgPyAod29ya3NwYWNlIGFzIFdvcmtzcGFjZVN2ZykudGFyZ2V0V29ya3NwYWNlIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZSk7XG4gICAgb3B0X25hbWUgPSBnZW5lcmF0ZVVuaXF1ZU5hbWUod3MhKTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBhIHBvdGVudGlhbCB2YXJpYWJsZSBpZiBpbiB0aGUgZmx5b3V0LlxuICBsZXQgdmFyaWFibGUgPSBudWxsO1xuICBpZiAocG90ZW50aWFsVmFyaWFibGVNYXApIHtcbiAgICB2YXJpYWJsZSA9IHBvdGVudGlhbFZhcmlhYmxlTWFwLmNyZWF0ZVZhcmlhYmxlKG9wdF9uYW1lLCBvcHRfdHlwZSwgaWQpO1xuICB9IGVsc2Uge1xuICAgIC8vIEluIHRoZSBtYWluIHdvcmtzcGFjZSwgY3JlYXRlIGEgcmVhbCB2YXJpYWJsZS5cbiAgICB2YXJpYWJsZSA9IHdvcmtzcGFjZS5jcmVhdGVWYXJpYWJsZShvcHRfbmFtZSwgb3B0X3R5cGUsIGlkKTtcbiAgfVxuICByZXR1cm4gdmFyaWFibGU7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCB0aGUgbGlzdCBvZiB2YXJpYWJsZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gdGhlXG4gKiB3b3Jrc3BhY2UgYWZ0ZXIgYWRkaW5nIGEgbmV3IGJsb2NrLCB1c2luZyB0aGUgZ2l2ZW4gbGlzdCBvZiB2YXJpYWJsZXMgdGhhdFxuICogd2VyZSBpbiB0aGUgd29ya3NwYWNlIGJlZm9yZSB0aGUgbmV3IGJsb2NrIHdhcyBhZGRlZC5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gaW5zcGVjdC5cbiAqIEBwYXJhbSBvcmlnaW5hbFZhcmlhYmxlcyBUaGUgYXJyYXkgb2YgdmFyaWFibGVzIHRoYXQgZXhpc3RlZCBpbiB0aGUgd29ya3NwYWNlXG4gKiAgICAgYmVmb3JlIGFkZGluZyB0aGUgbmV3IGJsb2NrLlxuICogQHJldHVybnMgVGhlIG5ldyBhcnJheSBvZiB2YXJpYWJsZXMgdGhhdCB3ZXJlIGZyZXNobHkgYWRkZWQgdG8gdGhlIHdvcmtzcGFjZVxuICogICAgIGFmdGVyIGNyZWF0aW5nIHRoZSBuZXcgYmxvY2ssIG9yIFtdIGlmIG5vIG5ldyB2YXJpYWJsZXMgd2VyZSBhZGRlZCB0byB0aGVcbiAqICAgICB3b3Jrc3BhY2UuXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXMuZ2V0QWRkZWRWYXJpYWJsZXNcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWRkZWRWYXJpYWJsZXMoXG4gICAgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIG9yaWdpbmFsVmFyaWFibGVzOiBWYXJpYWJsZU1vZGVsW10pOiBWYXJpYWJsZU1vZGVsW10ge1xuICBjb25zdCBhbGxDdXJyZW50VmFyaWFibGVzID0gd29ya3NwYWNlLmdldEFsbFZhcmlhYmxlcygpO1xuICBjb25zdCBhZGRlZFZhcmlhYmxlcyA9IFtdO1xuICBpZiAob3JpZ2luYWxWYXJpYWJsZXMubGVuZ3RoICE9PSBhbGxDdXJyZW50VmFyaWFibGVzLmxlbmd0aCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxsQ3VycmVudFZhcmlhYmxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdmFyaWFibGUgPSBhbGxDdXJyZW50VmFyaWFibGVzW2ldO1xuICAgICAgLy8gRm9yIGFueSB2YXJpYWJsZSB0aGF0IGlzIHByZXNlbnQgaW4gYWxsQ3VycmVudFZhcmlhYmxlcyBidXQgbm90XG4gICAgICAvLyBwcmVzZW50IGluIG9yaWdpbmFsVmFyaWFibGVzLCBhZGQgdGhlIHZhcmlhYmxlIHRvIGFkZGVkVmFyaWFibGVzLlxuICAgICAgaWYgKG9yaWdpbmFsVmFyaWFibGVzLmluZGV4T2YodmFyaWFibGUpID09PSAtMSkge1xuICAgICAgICBhZGRlZFZhcmlhYmxlcy5wdXNoKHZhcmlhYmxlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFkZGVkVmFyaWFibGVzO1xufVxuXG5leHBvcnQgY29uc3QgVEVTVF9PTkxZID0ge1xuICBnZW5lcmF0ZVVuaXF1ZU5hbWVJbnRlcm5hbCxcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogSW5qZWN0IEJsb2NrbHkncyBDU1Mgc3luY2hyb25vdXNseS5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuQ3NzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuQ3NzJyk7XG5cblxuLyoqIEhhcyBDU1MgYWxyZWFkeSBiZWVuIGluamVjdGVkPyAqL1xubGV0IGluamVjdGVkID0gZmFsc2U7XG5cbi8qKlxuICogQWRkIHNvbWUgQ1NTIHRvIHRoZSBibG9iIHRoYXQgd2lsbCBiZSBpbmplY3RlZCBsYXRlci4gIEFsbG93cyBvcHRpb25hbFxuICogY29tcG9uZW50cyBzdWNoIGFzIGZpZWxkcyBhbmQgdGhlIHRvb2xib3ggdG8gc3RvcmUgc2VwYXJhdGUgQ1NTLlxuICpcbiAqIEBwYXJhbSBjc3NDb250ZW50IE11bHRpbGluZSBDU1Mgc3RyaW5nIG9yIGFuIGFycmF5IG9mIHNpbmdsZSBsaW5lcyBvZiBDU1MuXG4gKiBAYWxpYXMgQmxvY2tseS5Dc3MucmVnaXN0ZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyKGNzc0NvbnRlbnQ6IHN0cmluZykge1xuICBpZiAoaW5qZWN0ZWQpIHtcbiAgICB0aHJvdyBFcnJvcignQ1NTIGFscmVhZHkgaW5qZWN0ZWQnKTtcbiAgfVxuICBjb250ZW50ICs9ICdcXG4nICsgY3NzQ29udGVudDtcbn1cblxuLyoqXG4gKiBJbmplY3QgdGhlIENTUyBpbnRvIHRoZSBET00uICBUaGlzIGlzIHByZWZlcmFibGUgb3ZlciB1c2luZyBhIHJlZ3VsYXIgQ1NTXG4gKiBmaWxlIHNpbmNlOlxuICogYSkgSXQgbG9hZHMgc3luY2hyb25vdXNseSBhbmQgZG9lc24ndCBmb3JjZSBhIHJlZHJhdyBsYXRlci5cbiAqIGIpIEl0IHNwZWVkcyB1cCBsb2FkaW5nIGJ5IG5vdCBibG9ja2luZyBvbiBhIHNlcGFyYXRlIEhUVFAgdHJhbnNmZXIuXG4gKiBjKSBUaGUgQ1NTIGNvbnRlbnQgbWF5IGJlIG1hZGUgZHluYW1pYyBkZXBlbmRpbmcgb24gaW5pdCBvcHRpb25zLlxuICpcbiAqIEBwYXJhbSBoYXNDc3MgSWYgZmFsc2UsIGRvbid0IGluamVjdCBDU1MgKHByb3ZpZGluZyBDU1MgYmVjb21lcyB0aGVcbiAqICAgICBkb2N1bWVudCdzIHJlc3BvbnNpYmlsaXR5KS5cbiAqIEBwYXJhbSBwYXRoVG9NZWRpYSBQYXRoIGZyb20gcGFnZSB0byB0aGUgQmxvY2tseSBtZWRpYSBkaXJlY3RvcnkuXG4gKiBAYWxpYXMgQmxvY2tseS5Dc3MuaW5qZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmplY3QoaGFzQ3NzOiBib29sZWFuLCBwYXRoVG9NZWRpYTogc3RyaW5nKSB7XG4gIC8vIE9ubHkgaW5qZWN0IHRoZSBDU1Mgb25jZS5cbiAgaWYgKGluamVjdGVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGluamVjdGVkID0gdHJ1ZTtcbiAgaWYgKCFoYXNDc3MpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gU3RyaXAgb2ZmIGFueSB0cmFpbGluZyBzbGFzaCAoZWl0aGVyIFVuaXggb3IgV2luZG93cykuXG4gIGNvbnN0IG1lZGlhUGF0aCA9IHBhdGhUb01lZGlhLnJlcGxhY2UoL1tcXFxcL10kLywgJycpO1xuICBjb25zdCBjc3NDb250ZW50ID0gY29udGVudC5yZXBsYWNlKC88PDxQQVRIPj4+L2csIG1lZGlhUGF0aCk7XG4gIC8vIENsZWFudXAgdGhlIGNvbGxlY3RlZCBjc3MgY29udGVudCBhZnRlciBpbmplY3RpbmcgaXQgdG8gdGhlIERPTS5cbiAgY29udGVudCA9ICcnO1xuXG4gIC8vIEluamVjdCBDU1MgdGFnIGF0IHN0YXJ0IG9mIGhlYWQuXG4gIGNvbnN0IGNzc05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICBjc3NOb2RlLmlkID0gJ2Jsb2NrbHktY29tbW9uLXN0eWxlJztcbiAgY29uc3QgY3NzVGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3NDb250ZW50KTtcbiAgY3NzTm9kZS5hcHBlbmRDaGlsZChjc3NUZXh0Tm9kZSk7XG4gIGRvY3VtZW50LmhlYWQuaW5zZXJ0QmVmb3JlKGNzc05vZGUsIGRvY3VtZW50LmhlYWQuZmlyc3RDaGlsZCk7XG59XG5cbi8qKlxuICogVGhlIENTUyBjb250ZW50IGZvciBCbG9ja2x5LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNzcy5jb250ZW50XG4gKi9cbmxldCBjb250ZW50ID0gYFxuLmJsb2NrbHlTdmcge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO1xuICBvdXRsaW5lOiBub25lO1xuICBvdmVyZmxvdzogaGlkZGVuOyAgLyogSUUgb3ZlcmZsb3dzIGJ5IGRlZmF1bHQuICovXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgZGlzcGxheTogYmxvY2s7XG59XG5cbi5ibG9ja2x5V2lkZ2V0RGl2IHtcbiAgZGlzcGxheTogbm9uZTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB6LWluZGV4OiA5OTk5OTsgIC8qIGJpZyB2YWx1ZSBmb3IgYm9vdHN0cmFwMyBjb21wYXRpYmlsaXR5ICovXG59XG5cbi5pbmplY3Rpb25EaXYge1xuICBoZWlnaHQ6IDEwMCU7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjsgIC8qIFNvIGJsb2NrcyBpbiBkcmFnIHN1cmZhY2UgZGlzYXBwZWFyIGF0IGVkZ2VzICovXG4gIHRvdWNoLWFjdGlvbjogbm9uZTtcbn1cblxuLmJsb2NrbHlOb25TZWxlY3RhYmxlIHtcbiAgdXNlci1zZWxlY3Q6IG5vbmU7XG4gIC1tcy11c2VyLXNlbGVjdDogbm9uZTtcbiAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTtcbn1cblxuLmJsb2NrbHlXc0RyYWdTdXJmYWNlIHtcbiAgZGlzcGxheTogbm9uZTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IDA7XG4gIGxlZnQ6IDA7XG59XG5cbi8qIEFkZGVkIGFzIGEgc2VwYXJhdGUgcnVsZSB3aXRoIG11bHRpcGxlIGNsYXNzZXMgdG8gbWFrZSBpdCBtb3JlIHNwZWNpZmljXG4gICB0aGFuIGEgYm9vdHN0cmFwIHJ1bGUgdGhhdCBzZWxlY3RzIHN2Zzpyb290LiBTZWUgaXNzdWUgIzEyNzUgZm9yIGNvbnRleHQuXG4qL1xuLmJsb2NrbHlXc0RyYWdTdXJmYWNlLmJsb2NrbHlPdmVyZmxvd1Zpc2libGUge1xuICBvdmVyZmxvdzogdmlzaWJsZTtcbn1cblxuLmJsb2NrbHlCbG9ja0RyYWdTdXJmYWNlIHtcbiAgZGlzcGxheTogbm9uZTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IDA7XG4gIGxlZnQ6IDA7XG4gIHJpZ2h0OiAwO1xuICBib3R0b206IDA7XG4gIG92ZXJmbG93OiB2aXNpYmxlICFpbXBvcnRhbnQ7XG4gIHotaW5kZXg6IDUwOyAgLyogRGlzcGxheSBiZWxvdyB0b29sYm94LCBidXQgYWJvdmUgZXZlcnl0aGluZyBlbHNlLiAqL1xufVxuXG4uYmxvY2tseUJsb2NrQ2FudmFzLmJsb2NrbHlDYW52YXNUcmFuc2l0aW9uaW5nLFxuLmJsb2NrbHlCdWJibGVDYW52YXMuYmxvY2tseUNhbnZhc1RyYW5zaXRpb25pbmcge1xuICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjVzO1xufVxuXG4uYmxvY2tseVRvb2x0aXBEaXYge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmM3O1xuICBib3JkZXI6IDFweCBzb2xpZCAjZGRjO1xuICBib3gtc2hhZG93OiA0cHggNHB4IDIwcHggMXB4IHJnYmEoMCwwLDAsLjE1KTtcbiAgY29sb3I6ICMwMDA7XG4gIGRpc3BsYXk6IG5vbmU7XG4gIGZvbnQ6IDlwdCBzYW5zLXNlcmlmO1xuICBvcGFjaXR5OiAuOTtcbiAgcGFkZGluZzogMnB4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHotaW5kZXg6IDEwMDAwMDsgIC8qIGJpZyB2YWx1ZSBmb3IgYm9vdHN0cmFwMyBjb21wYXRpYmlsaXR5ICovXG59XG5cbi5ibG9ja2x5RHJvcERvd25EaXYge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGxlZnQ6IDA7XG4gIHRvcDogMDtcbiAgei1pbmRleDogMTAwMDtcbiAgZGlzcGxheTogbm9uZTtcbiAgYm9yZGVyOiAxcHggc29saWQ7XG4gIGJvcmRlci1jb2xvcjogI2RhZGNlMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcbiAgYm9yZGVyLXJhZGl1czogMnB4O1xuICBwYWRkaW5nOiA0cHg7XG4gIGJveC1zaGFkb3c6IDAgMCAzcHggMXB4IHJnYmEoMCwwLDAsLjMpO1xufVxuXG4uYmxvY2tseURyb3BEb3duRGl2LmJsb2NrbHlGb2N1c2VkIHtcbiAgYm94LXNoYWRvdzogMCAwIDZweCAxcHggcmdiYSgwLDAsMCwuMyk7XG59XG5cbi5ibG9ja2x5RHJvcERvd25Db250ZW50IHtcbiAgbWF4LWhlaWdodDogMzAwcHg7ICAvKiBAdG9kbzogc3BlYyBmb3IgbWF4aW11bSBoZWlnaHQuICovXG4gIG92ZXJmbG93OiBhdXRvO1xuICBvdmVyZmxvdy14OiBoaWRkZW47XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbn1cblxuLmJsb2NrbHlEcm9wRG93bkFycm93IHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBsZWZ0OiAwO1xuICB0b3A6IDA7XG4gIHdpZHRoOiAxNnB4O1xuICBoZWlnaHQ6IDE2cHg7XG4gIHotaW5kZXg6IC0xO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiBpbmhlcml0O1xuICBib3JkZXItY29sb3I6IGluaGVyaXQ7XG59XG5cbi5ibG9ja2x5RHJvcERvd25CdXR0b24ge1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIGZsb2F0OiBsZWZ0O1xuICBwYWRkaW5nOiAwO1xuICBtYXJnaW46IDRweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBvdXRsaW5lOiBub25lO1xuICBib3JkZXI6IDFweCBzb2xpZDtcbiAgdHJhbnNpdGlvbjogYm94LXNoYWRvdyAuMXM7XG4gIGN1cnNvcjogcG9pbnRlcjtcbn1cblxuLmJsb2NrbHlBcnJvd1RvcCB7XG4gIGJvcmRlci10b3A6IDFweCBzb2xpZDtcbiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZDtcbiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogNHB4O1xuICBib3JkZXItY29sb3I6IGluaGVyaXQ7XG59XG5cbi5ibG9ja2x5QXJyb3dCb3R0b20ge1xuICBib3JkZXItYm90dG9tOiAxcHggc29saWQ7XG4gIGJvcmRlci1yaWdodDogMXB4IHNvbGlkO1xuICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNHB4O1xuICBib3JkZXItY29sb3I6IGluaGVyaXQ7XG59XG5cbi5ibG9ja2x5UmVzaXplU0Uge1xuICBjdXJzb3I6IHNlLXJlc2l6ZTtcbiAgZmlsbDogI2FhYTtcbn1cblxuLmJsb2NrbHlSZXNpemVTVyB7XG4gIGN1cnNvcjogc3ctcmVzaXplO1xuICBmaWxsOiAjYWFhO1xufVxuXG4uYmxvY2tseVJlc2l6ZUxpbmUge1xuICBzdHJva2U6ICM1MTVBNUE7XG4gIHN0cm9rZS13aWR0aDogMTtcbn1cblxuLmJsb2NrbHlIaWdobGlnaHRlZENvbm5lY3Rpb25QYXRoIHtcbiAgZmlsbDogbm9uZTtcbiAgc3Ryb2tlOiAjZmMzO1xuICBzdHJva2Utd2lkdGg6IDRweDtcbn1cblxuLmJsb2NrbHlQYXRoTGlnaHQge1xuICBmaWxsOiBub25lO1xuICBzdHJva2UtbGluZWNhcDogcm91bmQ7XG4gIHN0cm9rZS13aWR0aDogMTtcbn1cblxuLmJsb2NrbHlTZWxlY3RlZD4uYmxvY2tseVBhdGhMaWdodCB7XG4gIGRpc3BsYXk6IG5vbmU7XG59XG5cbi5ibG9ja2x5RHJhZ2dhYmxlIHtcbiAgLyogYmFja3VwIGZvciBicm93c2VycyAoZS5nLiBJRTExKSB0aGF0IGRvbid0IHN1cHBvcnQgZ3JhYiAqL1xuICBjdXJzb3I6IHVybChcIjw8PFBBVEg+Pj4vaGFuZG9wZW4uY3VyXCIpLCBhdXRvO1xuICBjdXJzb3I6IGdyYWI7XG4gIGN1cnNvcjogLXdlYmtpdC1ncmFiO1xufVxuXG4gIC8qIGJhY2t1cCBmb3IgYnJvd3NlcnMgKGUuZy4gSUUxMSkgdGhhdCBkb24ndCBzdXBwb3J0IGdyYWJiaW5nICovXG4uYmxvY2tseURyYWdnaW5nIHtcbiAgLyogYmFja3VwIGZvciBicm93c2VycyAoZS5nLiBJRTExKSB0aGF0IGRvbid0IHN1cHBvcnQgZ3JhYmJpbmcgKi9cbiAgY3Vyc29yOiB1cmwoXCI8PDxQQVRIPj4+L2hhbmRjbG9zZWQuY3VyXCIpLCBhdXRvO1xuICBjdXJzb3I6IGdyYWJiaW5nO1xuICBjdXJzb3I6IC13ZWJraXQtZ3JhYmJpbmc7XG59XG5cbiAgLyogQ2hhbmdlcyBjdXJzb3Igb24gbW91c2UgZG93bi4gTm90IGVmZmVjdGl2ZSBpbiBGaXJlZm94IGJlY2F1c2Ugb2ZcbiAgICAgaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NzcxMjQxICovXG4uYmxvY2tseURyYWdnYWJsZTphY3RpdmUge1xuICAvKiBiYWNrdXAgZm9yIGJyb3dzZXJzIChlLmcuIElFMTEpIHRoYXQgZG9uJ3Qgc3VwcG9ydCBncmFiYmluZyAqL1xuICBjdXJzb3I6IHVybChcIjw8PFBBVEg+Pj4vaGFuZGNsb3NlZC5jdXJcIiksIGF1dG87XG4gIGN1cnNvcjogZ3JhYmJpbmc7XG4gIGN1cnNvcjogLXdlYmtpdC1ncmFiYmluZztcbn1cblxuLyogQ2hhbmdlIHRoZSBjdXJzb3Igb24gdGhlIHdob2xlIGRyYWcgc3VyZmFjZSBpbiBjYXNlIHRoZSBtb3VzZSBnZXRzXG4gICBhaGVhZCBvZiBibG9jayBkdXJpbmcgYSBkcmFnLiBUaGlzIHdheSB0aGUgY3Vyc29yIGlzIHN0aWxsIGEgY2xvc2VkIGhhbmQuXG4gICovXG4uYmxvY2tseUJsb2NrRHJhZ1N1cmZhY2UgLmJsb2NrbHlEcmFnZ2FibGUge1xuICAvKiBiYWNrdXAgZm9yIGJyb3dzZXJzIChlLmcuIElFMTEpIHRoYXQgZG9uJ3Qgc3VwcG9ydCBncmFiYmluZyAqL1xuICBjdXJzb3I6IHVybChcIjw8PFBBVEg+Pj4vaGFuZGNsb3NlZC5jdXJcIiksIGF1dG87XG4gIGN1cnNvcjogZ3JhYmJpbmc7XG4gIGN1cnNvcjogLXdlYmtpdC1ncmFiYmluZztcbn1cblxuLmJsb2NrbHlEcmFnZ2luZy5ibG9ja2x5RHJhZ2dpbmdEZWxldGUge1xuICBjdXJzb3I6IHVybChcIjw8PFBBVEg+Pj4vaGFuZGRlbGV0ZS5jdXJcIiksIGF1dG87XG59XG5cbi5ibG9ja2x5RHJhZ2dpbmc+LmJsb2NrbHlQYXRoLFxuLmJsb2NrbHlEcmFnZ2luZz4uYmxvY2tseVBhdGhMaWdodCB7XG4gIGZpbGwtb3BhY2l0eTogLjg7XG4gIHN0cm9rZS1vcGFjaXR5OiAuODtcbn1cblxuLmJsb2NrbHlEcmFnZ2luZz4uYmxvY2tseVBhdGhEYXJrIHtcbiAgZGlzcGxheTogbm9uZTtcbn1cblxuLmJsb2NrbHlEaXNhYmxlZD4uYmxvY2tseVBhdGgge1xuICBmaWxsLW9wYWNpdHk6IC41O1xuICBzdHJva2Utb3BhY2l0eTogLjU7XG59XG5cbi5ibG9ja2x5RGlzYWJsZWQ+LmJsb2NrbHlQYXRoTGlnaHQsXG4uYmxvY2tseURpc2FibGVkPi5ibG9ja2x5UGF0aERhcmsge1xuICBkaXNwbGF5OiBub25lO1xufVxuXG4uYmxvY2tseUluc2VydGlvbk1hcmtlcj4uYmxvY2tseVBhdGgsXG4uYmxvY2tseUluc2VydGlvbk1hcmtlcj4uYmxvY2tseVBhdGhMaWdodCxcbi5ibG9ja2x5SW5zZXJ0aW9uTWFya2VyPi5ibG9ja2x5UGF0aERhcmsge1xuICBmaWxsLW9wYWNpdHk6IC4yO1xuICBzdHJva2U6IG5vbmU7XG59XG5cbi5ibG9ja2x5TXVsdGlsaW5lVGV4dCB7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG5cbi5ibG9ja2x5Tm9uRWRpdGFibGVUZXh0PnRleHQge1xuICBwb2ludGVyLWV2ZW50czogbm9uZTtcbn1cblxuLmJsb2NrbHlGbHlvdXQge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHotaW5kZXg6IDIwO1xufVxuXG4uYmxvY2tseVRleHQgdGV4dCB7XG4gIGN1cnNvcjogZGVmYXVsdDtcbn1cblxuLypcbiAgRG9uJ3QgYWxsb3cgdXNlcnMgdG8gc2VsZWN0IHRleHQuICBJdCBnZXRzIGFubm95aW5nIHdoZW4gdHJ5aW5nIHRvXG4gIGRyYWcgYSBibG9jayBhbmQgc2VsZWN0ZWQgdGV4dCBtb3ZlcyBpbnN0ZWFkLlxuKi9cbi5ibG9ja2x5U3ZnIHRleHQsXG4uYmxvY2tseUJsb2NrRHJhZ1N1cmZhY2UgdGV4dCB7XG4gIHVzZXItc2VsZWN0OiBub25lO1xuICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7XG4gIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7XG4gIGN1cnNvcjogaW5oZXJpdDtcbn1cblxuLmJsb2NrbHlIaWRkZW4ge1xuICBkaXNwbGF5OiBub25lO1xufVxuXG4uYmxvY2tseUZpZWxkRHJvcGRvd246bm90KC5ibG9ja2x5SGlkZGVuKSB7XG4gIGRpc3BsYXk6IGJsb2NrO1xufVxuXG4uYmxvY2tseUljb25Hcm91cCB7XG4gIGN1cnNvcjogZGVmYXVsdDtcbn1cblxuLmJsb2NrbHlJY29uR3JvdXA6bm90KDpob3ZlciksXG4uYmxvY2tseUljb25Hcm91cFJlYWRvbmx5IHtcbiAgb3BhY2l0eTogLjY7XG59XG5cbi5ibG9ja2x5SWNvblNoYXBlIHtcbiAgZmlsbDogIzAwZjtcbiAgc3Ryb2tlOiAjZmZmO1xuICBzdHJva2Utd2lkdGg6IDFweDtcbn1cblxuLmJsb2NrbHlJY29uU3ltYm9sIHtcbiAgZmlsbDogI2ZmZjtcbn1cblxuLmJsb2NrbHlNaW5pbWFsQm9keSB7XG4gIG1hcmdpbjogMDtcbiAgcGFkZGluZzogMDtcbn1cblxuLmJsb2NrbHlIdG1sSW5wdXQge1xuICBib3JkZXI6IG5vbmU7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgaGVpZ2h0OiAxMDAlO1xuICBtYXJnaW46IDA7XG4gIG91dGxpbmU6IG5vbmU7XG4gIHBhZGRpbmc6IDA7XG4gIHdpZHRoOiAxMDAlO1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xufVxuXG4vKiBFZGdlIGFuZCBJRSBpbnRyb2R1Y2UgYSBjbG9zZSBpY29uIHdoZW4gdGhlIGlucHV0IHZhbHVlIGlzIGxvbmdlciB0aGFuIGFcbiAgIGNlcnRhaW4gbGVuZ3RoLiBUaGlzIGFmZmVjdHMgb3VyIHNpemluZyBjYWxjdWxhdGlvbnMgb2YgdGhlIHRleHQgaW5wdXQuXG4gICBIaWRpbmcgdGhlIGNsb3NlIGljb24gdG8gYXZvaWQgdGhhdC4gKi9cbi5ibG9ja2x5SHRtbElucHV0OjotbXMtY2xlYXIge1xuICBkaXNwbGF5OiBub25lO1xufVxuXG4uYmxvY2tseU1haW5CYWNrZ3JvdW5kIHtcbiAgc3Ryb2tlLXdpZHRoOiAxO1xuICBzdHJva2U6ICNjNmM2YzY7ICAvKiBFcXVhdGVzIHRvICNkZGQgZHVlIHRvIGJvcmRlciBiZWluZyBvZmYtcGl4ZWwuICovXG59XG5cbi5ibG9ja2x5TXV0YXRvckJhY2tncm91bmQge1xuICBmaWxsOiAjZmZmO1xuICBzdHJva2U6ICNkZGQ7XG4gIHN0cm9rZS13aWR0aDogMTtcbn1cblxuLmJsb2NrbHlGbHlvdXRCYWNrZ3JvdW5kIHtcbiAgZmlsbDogI2RkZDtcbiAgZmlsbC1vcGFjaXR5OiAuODtcbn1cblxuLmJsb2NrbHlNYWluV29ya3NwYWNlU2Nyb2xsYmFyIHtcbiAgei1pbmRleDogMjA7XG59XG5cbi5ibG9ja2x5Rmx5b3V0U2Nyb2xsYmFyIHtcbiAgei1pbmRleDogMzA7XG59XG5cbi5ibG9ja2x5U2Nyb2xsYmFySG9yaXpvbnRhbCxcbi5ibG9ja2x5U2Nyb2xsYmFyVmVydGljYWwge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIG91dGxpbmU6IG5vbmU7XG59XG5cbi5ibG9ja2x5U2Nyb2xsYmFyQmFja2dyb3VuZCB7XG4gIG9wYWNpdHk6IDA7XG59XG5cbi5ibG9ja2x5U2Nyb2xsYmFySGFuZGxlIHtcbiAgZmlsbDogI2NjYztcbn1cblxuLmJsb2NrbHlTY3JvbGxiYXJCYWNrZ3JvdW5kOmhvdmVyKy5ibG9ja2x5U2Nyb2xsYmFySGFuZGxlLFxuLmJsb2NrbHlTY3JvbGxiYXJIYW5kbGU6aG92ZXIge1xuICBmaWxsOiAjYmJiO1xufVxuXG4vKiBEYXJrZW4gZmx5b3V0IHNjcm9sbGJhcnMgZHVlIHRvIGJlaW5nIG9uIGEgZ3JleSBiYWNrZ3JvdW5kLiAqL1xuLyogQnkgY29udHJhc3QsIHdvcmtzcGFjZSBzY3JvbGxiYXJzIGFyZSBvbiBhIHdoaXRlIGJhY2tncm91bmQuICovXG4uYmxvY2tseUZseW91dCAuYmxvY2tseVNjcm9sbGJhckhhbmRsZSB7XG4gIGZpbGw6ICNiYmI7XG59XG5cbi5ibG9ja2x5Rmx5b3V0IC5ibG9ja2x5U2Nyb2xsYmFyQmFja2dyb3VuZDpob3ZlcisuYmxvY2tseVNjcm9sbGJhckhhbmRsZSxcbi5ibG9ja2x5Rmx5b3V0IC5ibG9ja2x5U2Nyb2xsYmFySGFuZGxlOmhvdmVyIHtcbiAgZmlsbDogI2FhYTtcbn1cblxuLmJsb2NrbHlJbnZhbGlkSW5wdXQge1xuICBiYWNrZ3JvdW5kOiAjZmFhO1xufVxuXG4uYmxvY2tseVZlcnRpY2FsTWFya2VyIHtcbiAgc3Ryb2tlLXdpZHRoOiAzcHg7XG4gIGZpbGw6IHJnYmEoMjU1LDI1NSwyNTUsLjUpO1xuICBwb2ludGVyLWV2ZW50czogbm9uZTtcbn1cblxuLmJsb2NrbHlDb21wdXRlQ2FudmFzIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB3aWR0aDogMDtcbiAgaGVpZ2h0OiAwO1xufVxuXG4uYmxvY2tseU5vUG9pbnRlckV2ZW50cyB7XG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xufVxuXG4uYmxvY2tseUNvbnRleHRNZW51IHtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBtYXgtaGVpZ2h0OiAxMDAlO1xufVxuXG4uYmxvY2tseURyb3Bkb3duTWVudSB7XG4gIGJvcmRlci1yYWRpdXM6IDJweDtcbiAgcGFkZGluZzogMCAhaW1wb3J0YW50O1xufVxuXG4uYmxvY2tseURyb3Bkb3duTWVudSAuYmxvY2tseU1lbnVJdGVtIHtcbiAgLyogMjhweCBvbiB0aGUgbGVmdCBmb3IgaWNvbiBvciBjaGVja2JveC4gKi9cbiAgcGFkZGluZy1sZWZ0OiAyOHB4O1xufVxuXG4vKiBCaURpIG92ZXJyaWRlIGZvciB0aGUgcmVzdGluZyBzdGF0ZS4gKi9cbi5ibG9ja2x5RHJvcGRvd25NZW51IC5ibG9ja2x5TWVudUl0ZW1SdGwge1xuICAvKiBGbGlwIGxlZnQvcmlnaHQgcGFkZGluZyBmb3IgQmlEaS4gKi9cbiAgcGFkZGluZy1sZWZ0OiA1cHg7XG4gIHBhZGRpbmctcmlnaHQ6IDI4cHg7XG59XG5cbi5ibG9ja2x5V2lkZ2V0RGl2IC5ibG9ja2x5TWVudSB7XG4gIGJhY2tncm91bmQ6ICNmZmY7XG4gIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50O1xuICBib3gtc2hhZG93OiAwIDAgM3B4IDFweCByZ2JhKDAsMCwwLC4zKTtcbiAgZm9udDogbm9ybWFsIDEzcHggQXJpYWwsIHNhbnMtc2VyaWY7XG4gIG1hcmdpbjogMDtcbiAgb3V0bGluZTogbm9uZTtcbiAgcGFkZGluZzogNHB4IDA7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgb3ZlcmZsb3cteDogaGlkZGVuO1xuICBtYXgtaGVpZ2h0OiAxMDAlO1xuICB6LWluZGV4OiAyMDAwMDsgIC8qIEFyYml0cmFyeSwgYnV0IHNvbWUgYXBwcyBkZXBlbmQgb24gaXQuLi4gKi9cbn1cblxuLmJsb2NrbHlXaWRnZXREaXYgLmJsb2NrbHlNZW51LmJsb2NrbHlGb2N1c2VkIHtcbiAgYm94LXNoYWRvdzogMCAwIDZweCAxcHggcmdiYSgwLDAsMCwuMyk7XG59XG5cbi5ibG9ja2x5RHJvcERvd25EaXYgLmJsb2NrbHlNZW51IHtcbiAgYmFja2dyb3VuZDogaW5oZXJpdDsgIC8qIENvbXBhdGliaWxpdHkgd2l0aCBnYXBpLCByZXNldCBmcm9tIGdvb2ctbWVudSAqL1xuICBib3JkZXI6IGluaGVyaXQ7ICAvKiBDb21wYXRpYmlsaXR5IHdpdGggZ2FwaSwgcmVzZXQgZnJvbSBnb29nLW1lbnUgKi9cbiAgZm9udDogbm9ybWFsIDEzcHggXCJIZWx2ZXRpY2EgTmV1ZVwiLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7XG4gIG91dGxpbmU6IG5vbmU7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTsgIC8qIENvbXBhdGliaWxpdHkgd2l0aCBnYXBpLCByZXNldCBmcm9tIGdvb2ctbWVudSAqL1xuICB6LWluZGV4OiAyMDAwMDsgIC8qIEFyYml0cmFyeSwgYnV0IHNvbWUgYXBwcyBkZXBlbmQgb24gaXQuLi4gKi9cbn1cblxuLyogU3RhdGU6IHJlc3RpbmcuICovXG4uYmxvY2tseU1lbnVJdGVtIHtcbiAgYm9yZGVyOiBub25lO1xuICBjb2xvcjogIzAwMDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBsaXN0LXN0eWxlOiBub25lO1xuICBtYXJnaW46IDA7XG4gIC8qIDdlbSBvbiB0aGUgcmlnaHQgZm9yIHNob3J0Y3V0LiAqL1xuICBtaW4td2lkdGg6IDdlbTtcbiAgcGFkZGluZzogNnB4IDE1cHg7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG59XG5cbi8qIFN0YXRlOiBkaXNhYmxlZC4gKi9cbi5ibG9ja2x5TWVudUl0ZW1EaXNhYmxlZCB7XG4gIGNvbG9yOiAjY2NjO1xuICBjdXJzb3I6IGluaGVyaXQ7XG59XG5cbi8qIFN0YXRlOiBob3Zlci4gKi9cbi5ibG9ja2x5TWVudUl0ZW1IaWdobGlnaHQge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLC4xKTtcbn1cblxuLyogU3RhdGU6IHNlbGVjdGVkL2NoZWNrZWQuICovXG4uYmxvY2tseU1lbnVJdGVtQ2hlY2tib3gge1xuICBoZWlnaHQ6IDE2cHg7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgd2lkdGg6IDE2cHg7XG59XG5cbi5ibG9ja2x5TWVudUl0ZW1TZWxlY3RlZCAuYmxvY2tseU1lbnVJdGVtQ2hlY2tib3gge1xuICBiYWNrZ3JvdW5kOiB1cmwoPDw8UEFUSD4+Pi9zcHJpdGVzLnBuZykgbm8tcmVwZWF0IC00OHB4IC0xNnB4O1xuICBmbG9hdDogbGVmdDtcbiAgbWFyZ2luLWxlZnQ6IC0yNHB4O1xuICBwb3NpdGlvbjogc3RhdGljOyAgLyogU2Nyb2xsIHdpdGggdGhlIG1lbnUuICovXG59XG5cbi5ibG9ja2x5TWVudUl0ZW1SdGwgLmJsb2NrbHlNZW51SXRlbUNoZWNrYm94IHtcbiAgZmxvYXQ6IHJpZ2h0O1xuICBtYXJnaW4tcmlnaHQ6IC0yNHB4O1xufVxuYDtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IG1ldGhvZHMgcmVhbHRlZCB0byBmaWd1cmluZyBvdXQgcG9zaXRpb25zIG9mIFNWRyBlbGVtZW50cy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMuc3ZnTWF0aFxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnV0aWxzLnN2Z01hdGgnKTtcblxuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4vZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0IHtSZWN0fSBmcm9tICcuL3JlY3QuanMnO1xuaW1wb3J0ICogYXMgc3R5bGUgZnJvbSAnLi9zdHlsZS5qcyc7XG5cblxuLyoqXG4gKiBTdGF0aWMgcmVnZXggdG8gcHVsbCB0aGUgeCx5IHZhbHVlcyBvdXQgb2YgYW4gU1ZHIHRyYW5zbGF0ZSgpIGRpcmVjdGl2ZS5cbiAqIE5vdGUgdGhhdCBGaXJlZm94IGFuZCBJRSAoOSwxMCkgcmV0dXJuICd0cmFuc2xhdGUoMTIpJyBpbnN0ZWFkIG9mXG4gKiAndHJhbnNsYXRlKDEyLCAwKScuXG4gKiBOb3RlIHRoYXQgSUUgKDksMTApIHJldHVybnMgJ3RyYW5zbGF0ZSgxNiA4KScgaW5zdGVhZCBvZiAndHJhbnNsYXRlKDE2LCA4KScuXG4gKiBOb3RlIHRoYXQgSUUgaGFzIGJlZW4gcmVwb3J0ZWQgdG8gcmV0dXJuIHNjaWVudGlmaWMgbm90YXRpb24gKDAuMTIzNDU2ZS00MikuXG4gKi9cbmNvbnN0IFhZX1JFR0VYID0gL3RyYW5zbGF0ZVxcKFxccyooWy0rXFxkLmVdKykoWyAsXVxccyooWy0rXFxkLmVdKylcXHMqKT8vO1xuXG4vKipcbiAqIFN0YXRpYyByZWdleCB0byBwdWxsIHRoZSB4LHkgdmFsdWVzIG91dCBvZiBhIHRyYW5zbGF0ZSgpIG9yIHRyYW5zbGF0ZTNkKClcbiAqIHN0eWxlIHByb3BlcnR5LlxuICogQWNjb3VudHMgZm9yIHNhbWUgZXhjZXB0aW9ucyBhcyBYWV9SRUdFWC5cbiAqL1xuY29uc3QgWFlfU1RZTEVfUkVHRVggPVxuICAgIC90cmFuc2Zvcm06XFxzKnRyYW5zbGF0ZSg/OjNkKT9cXChcXHMqKFstK1xcZC5lXSspXFxzKnB4KFsgLF1cXHMqKFstK1xcZC5lXSspXFxzKnB4KT8vO1xuXG4vKipcbiAqIFJldHVybiB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGlzIGVsZW1lbnQgcmVsYXRpdmUgdG9cbiAqIGl0cyBwYXJlbnQuICBPbmx5IGZvciBTVkcgZWxlbWVudHMgYW5kIGNoaWxkcmVuIChlLmcuIHJlY3QsIGcsIHBhdGgpLlxuICpcbiAqIEBwYXJhbSBlbGVtZW50IFNWRyBlbGVtZW50IHRvIGZpbmQgdGhlIGNvb3JkaW5hdGVzIG9mLlxuICogQHJldHVybnMgT2JqZWN0IHdpdGggLnggYW5kIC55IHByb3BlcnRpZXMuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdNYXRoLmdldFJlbGF0aXZlWFlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJlbGF0aXZlWFkoZWxlbWVudDogRWxlbWVudCk6IENvb3JkaW5hdGUge1xuICBjb25zdCB4eSA9IG5ldyBDb29yZGluYXRlKDAsIDApO1xuICAvLyBGaXJzdCwgY2hlY2sgZm9yIHggYW5kIHkgYXR0cmlidXRlcy5cbiAgLy8gQ2hlY2tpbmcgZm9yIHRoZSBleGlzdGVuY2Ugb2YgeC95IHByb3BlcnRpZXMgaXMgZmFzdGVyIHRoYW4gZ2V0QXR0cmlidXRlLlxuICAvLyBIb3dldmVyLCB4L3kgY29udGFpbnMgYW4gU1ZHQW5pbWF0ZWRMZW5ndGggb2JqZWN0LCBzbyByZWx5IG9uIGdldEF0dHJpYnV0ZVxuICAvLyB0byBnZXQgdGhlIG51bWJlci5cbiAgY29uc3QgeCA9IChlbGVtZW50IGFzIGFueSkueCAmJiBlbGVtZW50LmdldEF0dHJpYnV0ZSgneCcpO1xuICBjb25zdCB5ID0gKGVsZW1lbnQgYXMgYW55KS55ICYmIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCd5Jyk7XG4gIGlmICh4KSB7XG4gICAgeHkueCA9IHBhcnNlSW50KHgpO1xuICB9XG4gIGlmICh5KSB7XG4gICAgeHkueSA9IHBhcnNlSW50KHkpO1xuICB9XG4gIC8vIFNlY29uZCwgY2hlY2sgZm9yIHRyYW5zZm9ybT1cInRyYW5zbGF0ZSguLi4pXCIgYXR0cmlidXRlLlxuICBjb25zdCB0cmFuc2Zvcm0gPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyk7XG4gIGNvbnN0IHIgPSB0cmFuc2Zvcm0gJiYgdHJhbnNmb3JtLm1hdGNoKFhZX1JFR0VYKTtcbiAgaWYgKHIpIHtcbiAgICB4eS54ICs9IE51bWJlcihyWzFdKTtcbiAgICBpZiAoclszXSkge1xuICAgICAgeHkueSArPSBOdW1iZXIoclszXSk7XG4gICAgfVxuICB9XG5cbiAgLy8gVGhlbiBjaGVjayBmb3Igc3R5bGUgPSB0cmFuc2Zvcm06IHRyYW5zbGF0ZSguLi4pIG9yIHRyYW5zbGF0ZTNkKC4uLilcbiAgY29uc3Qgc3R5bGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgaWYgKHN0eWxlICYmIHN0eWxlLmluZGV4T2YoJ3RyYW5zbGF0ZScpID4gLTEpIHtcbiAgICBjb25zdCBzdHlsZUNvbXBvbmVudHMgPSBzdHlsZS5tYXRjaChYWV9TVFlMRV9SRUdFWCk7XG4gICAgaWYgKHN0eWxlQ29tcG9uZW50cykge1xuICAgICAgeHkueCArPSBOdW1iZXIoc3R5bGVDb21wb25lbnRzWzFdKTtcbiAgICAgIGlmIChzdHlsZUNvbXBvbmVudHNbM10pIHtcbiAgICAgICAgeHkueSArPSBOdW1iZXIoc3R5bGVDb21wb25lbnRzWzNdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHh5O1xufVxuXG4vKipcbiAqIFJldHVybiB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGlzIGVsZW1lbnQgcmVsYXRpdmUgdG9cbiAqIHRoZSBkaXYgQmxvY2tseSB3YXMgaW5qZWN0ZWQgaW50by5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBTVkcgZWxlbWVudCB0byBmaW5kIHRoZSBjb29yZGluYXRlcyBvZi4gSWYgdGhpcyBpcyBub3QgYSBjaGlsZFxuICogICAgIG9mIHRoZSBkaXYgQmxvY2tseSB3YXMgaW5qZWN0ZWQgaW50bywgdGhlIGJlaGF2aW91ciBpcyB1bmRlZmluZWQuXG4gKiBAcmV0dXJucyBPYmplY3Qgd2l0aCAueCBhbmQgLnkgcHJvcGVydGllcy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN2Z01hdGguZ2V0SW5qZWN0aW9uRGl2WFlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEluamVjdGlvbkRpdlhZKGVsZW1lbnQ6IEVsZW1lbnQpOiBDb29yZGluYXRlIHtcbiAgbGV0IHggPSAwO1xuICBsZXQgeSA9IDA7XG4gIHdoaWxlIChlbGVtZW50KSB7XG4gICAgY29uc3QgeHkgPSBnZXRSZWxhdGl2ZVhZKGVsZW1lbnQpO1xuICAgIHggPSB4ICsgeHkueDtcbiAgICB5ID0geSArIHh5Lnk7XG4gICAgY29uc3QgY2xhc3NlcyA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnO1xuICAgIGlmICgoJyAnICsgY2xhc3NlcyArICcgJykuaW5kZXhPZignIGluamVjdGlvbkRpdiAnKSAhPT0gLTEpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlIGFzIEVsZW1lbnQ7XG4gIH1cbiAgcmV0dXJuIG5ldyBDb29yZGluYXRlKHgsIHkpO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIDNEIHRyYW5zZm9ybXMgYXJlIHN1cHBvcnRlZCBieSBhZGRpbmcgYW4gZWxlbWVudFxuICogYW5kIGF0dGVtcHRpbmcgdG8gc2V0IHRoZSBwcm9wZXJ0eS5cbiAqXG4gKiBAcmV0dXJucyBUcnVlIGlmIDNEIHRyYW5zZm9ybXMgYXJlIHN1cHBvcnRlZC5cbiAqIEBkZXByZWNhdGVkIE5vIGxvbmdlciBwcm92aWRlZCBieSBCbG9ja2x5LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3ZnTWF0aC5pczNkU3VwcG9ydGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpczNkU3VwcG9ydGVkKCk6IGJvb2xlYW4ge1xuICAvLyBBbGwgYnJvd3NlcnMgc3VwcG9ydCB0cmFuc2xhdGUzZCBpbiAyMDIyLlxuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuc3ZnTWF0aC5pczNkU3VwcG9ydGVkJywgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgdmlld3BvcnQgaW4gd2luZG93IGNvb3JkaW5hdGVzLiAgVGhpcyB0YWtlc1xuICogc2Nyb2xsIGludG8gYWNjb3VudC5cbiAqXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyB3aW5kb3cgd2lkdGgsIGhlaWdodCwgYW5kIHNjcm9sbCBwb3NpdGlvbiBpblxuICogICAgIHdpbmRvdyBjb29yZGluYXRlcy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN2Z01hdGguZ2V0Vmlld3BvcnRCQm94XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFZpZXdwb3J0QkJveCgpOiBSZWN0IHtcbiAgLy8gUGl4ZWxzLCBpbiB3aW5kb3cgY29vcmRpbmF0ZXMuXG4gIGNvbnN0IHNjcm9sbE9mZnNldCA9IHN0eWxlLmdldFZpZXdwb3J0UGFnZU9mZnNldCgpO1xuICByZXR1cm4gbmV3IFJlY3QoXG4gICAgICBzY3JvbGxPZmZzZXQueSwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCArIHNjcm9sbE9mZnNldC55LFxuICAgICAgc2Nyb2xsT2Zmc2V0LngsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCArIHNjcm9sbE9mZnNldC54KTtcbn1cblxuLyoqXG4gKiBHZXRzIHRoZSBkb2N1bWVudCBzY3JvbGwgZGlzdGFuY2UgYXMgYSBjb29yZGluYXRlIG9iamVjdC5cbiAqIENvcGllZCBmcm9tIENsb3N1cmUncyBnb29nLmRvbS5nZXREb2N1bWVudFNjcm9sbC5cbiAqXG4gKiBAcmV0dXJucyBPYmplY3Qgd2l0aCB2YWx1ZXMgJ3gnIGFuZCAneScuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdNYXRoLmdldERvY3VtZW50U2Nyb2xsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREb2N1bWVudFNjcm9sbCgpOiBDb29yZGluYXRlIHtcbiAgY29uc3QgZWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gIGNvbnN0IHdpbiA9IHdpbmRvdztcbiAgcmV0dXJuIG5ldyBDb29yZGluYXRlKFxuICAgICAgd2luLnBhZ2VYT2Zmc2V0IHx8IGVsLnNjcm9sbExlZnQsIHdpbi5wYWdlWU9mZnNldCB8fCBlbC5zY3JvbGxUb3ApO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIHNjcmVlbiBjb29yZGluYXRlcyB0byB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gKlxuICogQHBhcmFtIHdzIFRoZSB3b3Jrc3BhY2UgdG8gZmluZCB0aGUgY29vcmRpbmF0ZXMgb24uXG4gKiBAcGFyYW0gc2NyZWVuQ29vcmRpbmF0ZXMgVGhlIHNjcmVlbiBjb29yZGluYXRlcyB0byBiZSBjb252ZXJ0ZWQgdG8gd29ya3NwYWNlXG4gKiAgICAgY29vcmRpbmF0ZXNcbiAqIEByZXR1cm5zIFRoZSB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdNYXRoLnNjcmVlblRvV3NDb29yZGluYXRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2NyZWVuVG9Xc0Nvb3JkaW5hdGVzKFxuICAgIHdzOiBXb3Jrc3BhY2VTdmcsIHNjcmVlbkNvb3JkaW5hdGVzOiBDb29yZGluYXRlKTogQ29vcmRpbmF0ZSB7XG4gIGNvbnN0IHNjcmVlblggPSBzY3JlZW5Db29yZGluYXRlcy54O1xuICBjb25zdCBzY3JlZW5ZID0gc2NyZWVuQ29vcmRpbmF0ZXMueTtcblxuICBjb25zdCBpbmplY3Rpb25EaXYgPSB3cy5nZXRJbmplY3Rpb25EaXYoKTtcbiAgLy8gQm91bmRpbmcgcmVjdCBjb29yZGluYXRlcyBhcmUgaW4gY2xpZW50IGNvb3JkaW5hdGVzLCBtZWFuaW5nIHRoYXQgdGhleVxuICAvLyBhcmUgaW4gcGl4ZWxzIHJlbGF0aXZlIHRvIHRoZSB1cHBlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlzaWJsZSBicm93c2VyXG4gIC8vIHdpbmRvdy4gIFRoZXNlIGNvb3JkaW5hdGVzIGNoYW5nZSB3aGVuIHlvdSBzY3JvbGwgdGhlIGJyb3dzZXIgd2luZG93LlxuICBjb25zdCBib3VuZGluZ1JlY3QgPSBpbmplY3Rpb25EaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgLy8gVGhlIGNsaWVudCBjb29yZGluYXRlcyBvZmZzZXQgYnkgdGhlIGluamVjdGlvbiBkaXYncyB1cHBlciBsZWZ0IGNvcm5lci5cbiAgY29uc3QgY2xpZW50T2Zmc2V0UGl4ZWxzID1cbiAgICAgIG5ldyBDb29yZGluYXRlKHNjcmVlblggLSBib3VuZGluZ1JlY3QubGVmdCwgc2NyZWVuWSAtIGJvdW5kaW5nUmVjdC50b3ApO1xuXG4gIC8vIFRoZSBvZmZzZXQgaW4gcGl4ZWxzIGJldHdlZW4gdGhlIG1haW4gd29ya3NwYWNlJ3Mgb3JpZ2luIGFuZCB0aGUgdXBwZXJcbiAgLy8gbGVmdCBjb3JuZXIgb2YgdGhlIGluamVjdGlvbiBkaXYuXG4gIGNvbnN0IG1haW5PZmZzZXRQaXhlbHMgPSB3cy5nZXRPcmlnaW5PZmZzZXRJblBpeGVscygpO1xuXG4gIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgbmV3IGNvbW1lbnQgaW4gcGl4ZWxzIHJlbGF0aXZlIHRvIHRoZSBvcmlnaW4gb2YgdGhlXG4gIC8vIG1haW4gd29ya3NwYWNlLlxuICBjb25zdCBmaW5hbE9mZnNldFBpeGVscyA9XG4gICAgICBDb29yZGluYXRlLmRpZmZlcmVuY2UoY2xpZW50T2Zmc2V0UGl4ZWxzLCBtYWluT2Zmc2V0UGl4ZWxzKTtcbiAgLy8gVGhlIHBvc2l0aW9uIGluIG1haW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICBjb25zdCBmaW5hbE9mZnNldE1haW5XcyA9IGZpbmFsT2Zmc2V0UGl4ZWxzLnNjYWxlKDEgLyB3cy5zY2FsZSk7XG4gIHJldHVybiBmaW5hbE9mZnNldE1haW5Xcztcbn1cblxuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IHtcbiAgWFlfUkVHRVgsXG4gIFhZX1NUWUxFX1JFR0VYLFxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBYTUwgcmVhZGVyIGFuZCB3cml0ZXIuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LlhtbFxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlhtbCcpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7Q29ubmVjdGlvbn0gZnJvbSAnLi9jb25uZWN0aW9uLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCB7aW5wdXRUeXBlc30gZnJvbSAnLi9pbnB1dF90eXBlcy5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTaXplfSBmcm9tICcuL3V0aWxzL3NpemUuanMnO1xuaW1wb3J0ICogYXMgdXRpbHNYbWwgZnJvbSAnLi91dGlscy94bWwuanMnO1xuaW1wb3J0IHR5cGUge1ZhcmlhYmxlTW9kZWx9IGZyb20gJy4vdmFyaWFibGVfbW9kZWwuanMnO1xuaW1wb3J0ICogYXMgVmFyaWFibGVzIGZyb20gJy4vdmFyaWFibGVzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4vd29ya3NwYWNlLmpzJztcbmltcG9ydCB7V29ya3NwYWNlQ29tbWVudH0gZnJvbSAnLi93b3Jrc3BhY2VfY29tbWVudC5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZUNvbW1lbnRTdmd9IGZyb20gJy4vd29ya3NwYWNlX2NvbW1lbnRfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBFbmNvZGUgYSBibG9jayB0cmVlIGFzIFhNTC5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgY29udGFpbmluZyBibG9ja3MuXG4gKiBAcGFyYW0gb3B0X25vSWQgVHJ1ZSBpZiB0aGUgZW5jb2RlciBzaG91bGQgc2tpcCB0aGUgYmxvY2sgSURzLlxuICogQHJldHVybnMgWE1MIERPTSBlbGVtZW50LlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLndvcmtzcGFjZVRvRG9tXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3b3Jrc3BhY2VUb0RvbShcbiAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgb3B0X25vSWQ/OiBib29sZWFuKTogRWxlbWVudCB7XG4gIGNvbnN0IHRyZWVYbWwgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCd4bWwnKTtcbiAgY29uc3QgdmFyaWFibGVzRWxlbWVudCA9XG4gICAgICB2YXJpYWJsZXNUb0RvbShWYXJpYWJsZXMuYWxsVXNlZFZhck1vZGVscyh3b3Jrc3BhY2UpKTtcbiAgaWYgKHZhcmlhYmxlc0VsZW1lbnQuaGFzQ2hpbGROb2RlcygpKSB7XG4gICAgdHJlZVhtbC5hcHBlbmRDaGlsZCh2YXJpYWJsZXNFbGVtZW50KTtcbiAgfVxuICBjb25zdCBjb21tZW50cyA9IHdvcmtzcGFjZS5nZXRUb3BDb21tZW50cyh0cnVlKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21tZW50cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNvbW1lbnQgPSBjb21tZW50c1tpXTtcbiAgICB0cmVlWG1sLmFwcGVuZENoaWxkKGNvbW1lbnQudG9YbWxXaXRoWFkob3B0X25vSWQpKTtcbiAgfVxuICBjb25zdCBibG9ja3MgPSB3b3Jrc3BhY2UuZ2V0VG9wQmxvY2tzKHRydWUpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGJsb2NrID0gYmxvY2tzW2ldO1xuICAgIHRyZWVYbWwuYXBwZW5kQ2hpbGQoYmxvY2tUb0RvbVdpdGhYWShibG9jaywgb3B0X25vSWQpKTtcbiAgfVxuICByZXR1cm4gdHJlZVhtbDtcbn1cblxuLyoqXG4gKiBFbmNvZGUgYSBsaXN0IG9mIHZhcmlhYmxlcyBhcyBYTUwuXG4gKlxuICogQHBhcmFtIHZhcmlhYmxlTGlzdCBMaXN0IG9mIGFsbCB2YXJpYWJsZSBtb2RlbHMuXG4gKiBAcmV0dXJucyBUcmVlIG9mIFhNTCBlbGVtZW50cy5cbiAqIEBhbGlhcyBCbG9ja2x5LlhtbC52YXJpYWJsZXNUb0RvbVxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFyaWFibGVzVG9Eb20odmFyaWFibGVMaXN0OiBWYXJpYWJsZU1vZGVsW10pOiBFbGVtZW50IHtcbiAgY29uc3QgdmFyaWFibGVzID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgndmFyaWFibGVzJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyaWFibGVMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgdmFyaWFibGUgPSB2YXJpYWJsZUxpc3RbaV07XG4gICAgY29uc3QgZWxlbWVudCA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ3ZhcmlhYmxlJyk7XG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZCh1dGlsc1htbC5jcmVhdGVUZXh0Tm9kZSh2YXJpYWJsZS5uYW1lKSk7XG4gICAgaWYgKHZhcmlhYmxlLnR5cGUpIHtcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgdmFyaWFibGUudHlwZSk7XG4gICAgfVxuICAgIGVsZW1lbnQuaWQgPSB2YXJpYWJsZS5nZXRJZCgpO1xuICAgIHZhcmlhYmxlcy5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgfVxuICByZXR1cm4gdmFyaWFibGVzO1xufVxuXG4vKipcbiAqIEVuY29kZSBhIGJsb2NrIHN1YnRyZWUgYXMgWE1MIHdpdGggWFkgY29vcmRpbmF0ZXMuXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSByb290IGJsb2NrIHRvIGVuY29kZS5cbiAqIEBwYXJhbSBvcHRfbm9JZCBUcnVlIGlmIHRoZSBlbmNvZGVyIHNob3VsZCBza2lwIHRoZSBibG9jayBJRC5cbiAqIEByZXR1cm5zIFRyZWUgb2YgWE1MIGVsZW1lbnRzIG9yIGFuIGVtcHR5IGRvY3VtZW50IGZyYWdtZW50IGlmIHRoZSBibG9jayB3YXNcbiAqICAgICBhbiBpbnNlcnRpb24gbWFya2VyLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLmJsb2NrVG9Eb21XaXRoWFlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJsb2NrVG9Eb21XaXRoWFkoYmxvY2s6IEJsb2NrLCBvcHRfbm9JZD86IGJvb2xlYW4pOiBFbGVtZW50fFxuICAgIERvY3VtZW50RnJhZ21lbnQge1xuICBpZiAoYmxvY2suaXNJbnNlcnRpb25NYXJrZXIoKSkgeyAgLy8gU2tpcCBvdmVyIGluc2VydGlvbiBtYXJrZXJzLlxuICAgIGJsb2NrID0gYmxvY2suZ2V0Q2hpbGRyZW4oZmFsc2UpWzBdO1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIC8vIERpc2FwcGVhcnMgd2hlbiBhcHBlbmRlZC5cbiAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIH1cbiAgfVxuXG4gIGxldCB3aWR0aCA9IDA7ICAvLyBOb3QgdXNlZCBpbiBMVFIuXG4gIGlmIChibG9jay53b3Jrc3BhY2UuUlRMKSB7XG4gICAgd2lkdGggPSBibG9jay53b3Jrc3BhY2UuZ2V0V2lkdGgoKTtcbiAgfVxuXG4gIGNvbnN0IGVsZW1lbnQgPSBibG9ja1RvRG9tKGJsb2NrLCBvcHRfbm9JZCk7XG4gIGNvbnN0IHh5ID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdzZXRBdHRyaWJ1dGUnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgLy8gJ0VsZW1lbnQgfCBEb2N1bWVudEZyYWdtZW50Jy5cbiAgKGVsZW1lbnQgYXMgQW55RHVyaW5nTWlncmF0aW9uKVxuICAgICAgLnNldEF0dHJpYnV0ZSgneCcsIE1hdGgucm91bmQoYmxvY2sud29ya3NwYWNlLlJUTCA/IHdpZHRoIC0geHkueCA6IHh5LngpKTtcbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnc2V0QXR0cmlidXRlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gIC8vICdFbGVtZW50IHwgRG9jdW1lbnRGcmFnbWVudCcuXG4gIChlbGVtZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc2V0QXR0cmlidXRlKCd5JywgTWF0aC5yb3VuZCh4eS55KSk7XG4gIHJldHVybiBlbGVtZW50O1xufVxuXG4vKipcbiAqIEVuY29kZSBhIGZpZWxkIGFzIFhNTC5cbiAqXG4gKiBAcGFyYW0gZmllbGQgVGhlIGZpZWxkIHRvIGVuY29kZS5cbiAqIEByZXR1cm5zIFhNTCBlbGVtZW50LCBvciBudWxsIGlmIHRoZSBmaWVsZCBkaWQgbm90IG5lZWQgdG8gYmUgc2VyaWFsaXplZC5cbiAqL1xuZnVuY3Rpb24gZmllbGRUb0RvbShmaWVsZDogRmllbGQpOiBFbGVtZW50fG51bGwge1xuICBpZiAoZmllbGQuaXNTZXJpYWxpemFibGUoKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2ZpZWxkJyk7XG4gICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnbmFtZScsIGZpZWxkLm5hbWUgfHwgJycpO1xuICAgIHJldHVybiBmaWVsZC50b1htbChjb250YWluZXIpO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIEVuY29kZSBhbGwgb2YgYSBibG9jaydzIGZpZWxkcyBhcyBYTUwgYW5kIGF0dGFjaCB0aGVtIHRvIHRoZSBnaXZlbiB0cmVlIG9mXG4gKiBYTUwgZWxlbWVudHMuXG4gKlxuICogQHBhcmFtIGJsb2NrIEEgYmxvY2sgd2l0aCBmaWVsZHMgdG8gYmUgZW5jb2RlZC5cbiAqIEBwYXJhbSBlbGVtZW50IFRoZSBYTUwgZWxlbWVudCB0byB3aGljaCB0aGUgZmllbGQgRE9NIHNob3VsZCBiZSBhdHRhY2hlZC5cbiAqL1xuZnVuY3Rpb24gYWxsRmllbGRzVG9Eb20oYmxvY2s6IEJsb2NrLCBlbGVtZW50OiBFbGVtZW50KSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2suaW5wdXRMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgaW5wdXQgPSBibG9jay5pbnB1dExpc3RbaV07XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbnB1dC5maWVsZFJvdy5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgZmllbGQgPSBpbnB1dC5maWVsZFJvd1tqXTtcbiAgICAgIGNvbnN0IGZpZWxkRG9tID0gZmllbGRUb0RvbShmaWVsZCk7XG4gICAgICBpZiAoZmllbGREb20pIHtcbiAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChmaWVsZERvbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRW5jb2RlIGEgYmxvY2sgc3VidHJlZSBhcyBYTUwuXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSByb290IGJsb2NrIHRvIGVuY29kZS5cbiAqIEBwYXJhbSBvcHRfbm9JZCBUcnVlIGlmIHRoZSBlbmNvZGVyIHNob3VsZCBza2lwIHRoZSBibG9jayBJRC5cbiAqIEByZXR1cm5zIFRyZWUgb2YgWE1MIGVsZW1lbnRzIG9yIGFuIGVtcHR5IGRvY3VtZW50IGZyYWdtZW50IGlmIHRoZSBibG9jayB3YXNcbiAqICAgICBhbiBpbnNlcnRpb24gbWFya2VyLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLmJsb2NrVG9Eb21cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJsb2NrVG9Eb20oYmxvY2s6IEJsb2NrLCBvcHRfbm9JZD86IGJvb2xlYW4pOiBFbGVtZW50fFxuICAgIERvY3VtZW50RnJhZ21lbnQge1xuICAvLyBTa2lwIG92ZXIgaW5zZXJ0aW9uIG1hcmtlcnMuXG4gIGlmIChibG9jay5pc0luc2VydGlvbk1hcmtlcigpKSB7XG4gICAgY29uc3QgY2hpbGQgPSBibG9jay5nZXRDaGlsZHJlbihmYWxzZSlbMF07XG4gICAgaWYgKGNoaWxkKSB7XG4gICAgICByZXR1cm4gYmxvY2tUb0RvbShjaGlsZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIERpc2FwcGVhcnMgd2hlbiBhcHBlbmRlZC5cbiAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGVsZW1lbnQgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KGJsb2NrLmlzU2hhZG93KCkgPyAnc2hhZG93JyA6ICdibG9jaycpO1xuICBlbGVtZW50LnNldEF0dHJpYnV0ZSgndHlwZScsIGJsb2NrLnR5cGUpO1xuICBpZiAoIW9wdF9ub0lkKSB7XG4gICAgLy8gSXQncyBpbXBvcnRhbnQgdG8gdXNlIHNldEF0dHJpYnV0ZSBoZXJlIG90aGVyd2lzZSBJRTExIHdvbid0IHNlcmlhbGl6ZVxuICAgIC8vIHRoZSBibG9jaydzIElEIHdoZW4gZG9tVG9UZXh0IGlzIGNhbGxlZC5cbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaWQnLCBibG9jay5pZCk7XG4gIH1cbiAgaWYgKGJsb2NrLm11dGF0aW9uVG9Eb20pIHtcbiAgICAvLyBDdXN0b20gZGF0YSBmb3IgYW4gYWR2YW5jZWQgYmxvY2suXG4gICAgY29uc3QgbXV0YXRpb24gPSBibG9jay5tdXRhdGlvblRvRG9tKCk7XG4gICAgaWYgKG11dGF0aW9uICYmIChtdXRhdGlvbi5oYXNDaGlsZE5vZGVzKCkgfHwgbXV0YXRpb24uaGFzQXR0cmlidXRlcygpKSkge1xuICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChtdXRhdGlvbik7XG4gICAgfVxuICB9XG5cbiAgYWxsRmllbGRzVG9Eb20oYmxvY2ssIGVsZW1lbnQpO1xuXG4gIGNvbnN0IGNvbW1lbnRUZXh0ID0gYmxvY2suZ2V0Q29tbWVudFRleHQoKTtcbiAgaWYgKGNvbW1lbnRUZXh0KSB7XG4gICAgY29uc3Qgc2l6ZSA9IGJsb2NrLmNvbW1lbnRNb2RlbC5zaXplO1xuICAgIGNvbnN0IHBpbm5lZCA9IGJsb2NrLmNvbW1lbnRNb2RlbC5waW5uZWQ7XG5cbiAgICBjb25zdCBjb21tZW50RWxlbWVudCA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2NvbW1lbnQnKTtcbiAgICBjb21tZW50RWxlbWVudC5hcHBlbmRDaGlsZCh1dGlsc1htbC5jcmVhdGVUZXh0Tm9kZShjb21tZW50VGV4dCkpO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnYm9vbGVhbicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBjb21tZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3Bpbm5lZCcsIHBpbm5lZCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnbnVtYmVyJyBpcyBub3QgYXNzaWduYWJsZVxuICAgIC8vIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgIGNvbW1lbnRFbGVtZW50LnNldEF0dHJpYnV0ZSgnaCcsIHNpemUuaGVpZ2h0IGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdudW1iZXInIGlzIG5vdCBhc3NpZ25hYmxlXG4gICAgLy8gdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZycuXG4gICAgY29tbWVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCd3Jywgc2l6ZS53aWR0aCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuXG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChjb21tZW50RWxlbWVudCk7XG4gIH1cblxuICBpZiAoYmxvY2suZGF0YSkge1xuICAgIGNvbnN0IGRhdGFFbGVtZW50ID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgnZGF0YScpO1xuICAgIGRhdGFFbGVtZW50LmFwcGVuZENoaWxkKHV0aWxzWG1sLmNyZWF0ZVRleHROb2RlKGJsb2NrLmRhdGEpKTtcbiAgICBlbGVtZW50LmFwcGVuZENoaWxkKGRhdGFFbGVtZW50KTtcbiAgfVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2suaW5wdXRMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgaW5wdXQgPSBibG9jay5pbnB1dExpc3RbaV07XG4gICAgbGV0IGNvbnRhaW5lcjogRWxlbWVudDtcbiAgICBsZXQgZW1wdHkgPSB0cnVlO1xuICAgIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLkRVTU1ZKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY2hpbGRCbG9jayA9IGlucHV0LmNvbm5lY3Rpb24hLnRhcmdldEJsb2NrKCk7XG4gICAgICBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSkge1xuICAgICAgICBjb250YWluZXIgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCd2YWx1ZScpO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLlNUQVRFTUVOVCkge1xuICAgICAgICBjb250YWluZXIgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdzdGF0ZW1lbnQnKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNoaWxkU2hhZG93ID0gaW5wdXQuY29ubmVjdGlvbiEuZ2V0U2hhZG93RG9tKCk7XG4gICAgICBpZiAoY2hpbGRTaGFkb3cgJiYgKCFjaGlsZEJsb2NrIHx8ICFjaGlsZEJsb2NrLmlzU2hhZG93KCkpKSB7XG4gICAgICAgIGNvbnRhaW5lciEuYXBwZW5kQ2hpbGQoY2xvbmVTaGFkb3coY2hpbGRTaGFkb3csIG9wdF9ub0lkKSk7XG4gICAgICB9XG4gICAgICBpZiAoY2hpbGRCbG9jaykge1xuICAgICAgICBjb25zdCBjaGlsZEVsZW0gPSBibG9ja1RvRG9tKGNoaWxkQmxvY2ssIG9wdF9ub0lkKTtcbiAgICAgICAgaWYgKGNoaWxkRWxlbS5ub2RlVHlwZSA9PT0gZG9tLk5vZGVUeXBlLkVMRU1FTlRfTk9ERSkge1xuICAgICAgICAgIGNvbnRhaW5lciEuYXBwZW5kQ2hpbGQoY2hpbGRFbGVtKTtcbiAgICAgICAgICBlbXB0eSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnRhaW5lciEuc2V0QXR0cmlidXRlKCduYW1lJywgaW5wdXQubmFtZSk7XG4gICAgaWYgKCFlbXB0eSkge1xuICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChjb250YWluZXIhKTtcbiAgICB9XG4gIH1cbiAgaWYgKGJsb2NrLmlucHV0c0lubGluZSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICBibG9jay5pbnB1dHNJbmxpbmUgIT09IGJsb2NrLmlucHV0c0lubGluZURlZmF1bHQpIHtcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaW5saW5lJywgYmxvY2suaW5wdXRzSW5saW5lLnRvU3RyaW5nKCkpO1xuICB9XG4gIGlmIChibG9jay5pc0NvbGxhcHNlZCgpKSB7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NvbGxhcHNlZCcsICd0cnVlJyk7XG4gIH1cbiAgaWYgKCFibG9jay5pc0VuYWJsZWQoKSkge1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICd0cnVlJyk7XG4gIH1cbiAgaWYgKCFibG9jay5pc0RlbGV0YWJsZSgpICYmICFibG9jay5pc1NoYWRvdygpKSB7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RlbGV0YWJsZScsICdmYWxzZScpO1xuICB9XG4gIGlmICghYmxvY2suaXNNb3ZhYmxlKCkgJiYgIWJsb2NrLmlzU2hhZG93KCkpIHtcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnbW92YWJsZScsICdmYWxzZScpO1xuICB9XG4gIGlmICghYmxvY2suaXNFZGl0YWJsZSgpKSB7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2VkaXRhYmxlJywgJ2ZhbHNlJyk7XG4gIH1cblxuICBjb25zdCBuZXh0QmxvY2sgPSBibG9jay5nZXROZXh0QmxvY2soKTtcbiAgbGV0IGNvbnRhaW5lcjogRWxlbWVudDtcbiAgaWYgKG5leHRCbG9jaykge1xuICAgIGNvbnN0IG5leHRFbGVtID0gYmxvY2tUb0RvbShuZXh0QmxvY2ssIG9wdF9ub0lkKTtcbiAgICBpZiAobmV4dEVsZW0ubm9kZVR5cGUgPT09IGRvbS5Ob2RlVHlwZS5FTEVNRU5UX05PREUpIHtcbiAgICAgIGNvbnRhaW5lciA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ25leHQnKTtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChuZXh0RWxlbSk7XG4gICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gICAgfVxuICB9XG4gIGNvbnN0IG5leHRTaGFkb3cgPVxuICAgICAgYmxvY2submV4dENvbm5lY3Rpb24gJiYgYmxvY2submV4dENvbm5lY3Rpb24uZ2V0U2hhZG93RG9tKCk7XG4gIGlmIChuZXh0U2hhZG93ICYmICghbmV4dEJsb2NrIHx8ICFuZXh0QmxvY2suaXNTaGFkb3coKSkpIHtcbiAgICBjb250YWluZXIhLmFwcGVuZENoaWxkKGNsb25lU2hhZG93KG5leHRTaGFkb3csIG9wdF9ub0lkKSk7XG4gIH1cblxuICByZXR1cm4gZWxlbWVudDtcbn1cblxuLyoqXG4gKiBEZWVwbHkgY2xvbmUgdGhlIHNoYWRvdydzIERPTSBzbyB0aGF0IGNoYW5nZXMgZG9uJ3QgYmFjay13YXNoIHRvIHRoZSBibG9jay5cbiAqXG4gKiBAcGFyYW0gc2hhZG93IEEgdHJlZSBvZiBYTUwgZWxlbWVudHMuXG4gKiBAcGFyYW0gb3B0X25vSWQgVHJ1ZSBpZiB0aGUgZW5jb2RlciBzaG91bGQgc2tpcCB0aGUgYmxvY2sgSUQuXG4gKiBAcmV0dXJucyBBIHRyZWUgb2YgWE1MIGVsZW1lbnRzLlxuICovXG5mdW5jdGlvbiBjbG9uZVNoYWRvdyhzaGFkb3c6IEVsZW1lbnQsIG9wdF9ub0lkPzogYm9vbGVhbik6IEVsZW1lbnQge1xuICBzaGFkb3cgPSBzaGFkb3cuY2xvbmVOb2RlKHRydWUpIGFzIEVsZW1lbnQ7XG4gIC8vIFdhbGsgdGhlIHRyZWUgbG9va2luZyBmb3Igd2hpdGVzcGFjZS4gIERvbid0IHBydW5lIHdoaXRlc3BhY2UgaW4gYSB0YWcuXG4gIGxldCBub2RlOiBOb2RlfG51bGwgPSBzaGFkb3c7XG4gIGxldCB0ZXh0Tm9kZTtcbiAgd2hpbGUgKG5vZGUpIHtcbiAgICBpZiAob3B0X25vSWQgJiYgbm9kZS5ub2RlTmFtZSA9PT0gJ3NoYWRvdycpIHtcbiAgICAgIC8vIFN0cmlwIG9mZiBJRHMgZnJvbSBzaGFkb3cgYmxvY2tzLiAgVGhlcmUgc2hvdWxkIG5ldmVyIGJlIGEgJ2Jsb2NrJyBhc1xuICAgICAgLy8gYSBjaGlsZCBvZiBhICdzaGFkb3cnLCBzbyBubyBuZWVkIHRvIGNoZWNrIHRoYXQuXG4gICAgICAobm9kZSBhcyBFbGVtZW50KS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7XG4gICAgfVxuICAgIGlmIChub2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgIG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdoaWxlIChub2RlICYmICFub2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgIHRleHROb2RlID0gbm9kZTtcbiAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRleHROb2RlLm5vZGVUeXBlID09PSBkb20uTm9kZVR5cGUuVEVYVF9OT0RFICYmXG4gICAgICAgICAgICAodGV4dE5vZGUgYXMgVGV4dCkuZGF0YS50cmltKCkgPT09ICcnICYmXG4gICAgICAgICAgICBub2RlPy5maXJzdENoaWxkICE9PSB0ZXh0Tm9kZSkge1xuICAgICAgICAgIC8vIFBydW5lIHdoaXRlc3BhY2UgYWZ0ZXIgYSB0YWcuXG4gICAgICAgICAgZG9tLnJlbW92ZU5vZGUodGV4dE5vZGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobm9kZSkge1xuICAgICAgICB0ZXh0Tm9kZSA9IG5vZGU7XG4gICAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgICBpZiAodGV4dE5vZGUubm9kZVR5cGUgPT09IGRvbS5Ob2RlVHlwZS5URVhUX05PREUgJiZcbiAgICAgICAgICAgICh0ZXh0Tm9kZSBhcyBUZXh0KS5kYXRhLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAvLyBQcnVuZSB3aGl0ZXNwYWNlIGJlZm9yZSBhIHRhZy5cbiAgICAgICAgICBkb20ucmVtb3ZlTm9kZSh0ZXh0Tm9kZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHNoYWRvdztcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIERPTSBzdHJ1Y3R1cmUgaW50byBwbGFpbiB0ZXh0LlxuICogQ3VycmVudGx5IHRoZSB0ZXh0IGZvcm1hdCBpcyBmYWlybHkgdWdseTogYWxsIG9uZSBsaW5lIHdpdGggbm8gd2hpdGVzcGFjZSxcbiAqIHVubGVzcyB0aGUgRE9NIGl0c2VsZiBoYXMgd2hpdGVzcGFjZSBidWlsdC1pbi5cbiAqXG4gKiBAcGFyYW0gZG9tIEEgdHJlZSBvZiBYTUwgbm9kZXMuXG4gKiBAcmV0dXJucyBUZXh0IHJlcHJlc2VudGF0aW9uLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLmRvbVRvVGV4dFxuICovXG5leHBvcnQgZnVuY3Rpb24gZG9tVG9UZXh0KGRvbTogTm9kZSk6IHN0cmluZyB7XG4gIGNvbnN0IHRleHQgPSB1dGlsc1htbC5kb21Ub1RleHQoZG9tKTtcbiAgLy8gVW5wYWNrIHNlbGYtY2xvc2luZyB0YWdzLiAgVGhlc2UgdGFncyBmYWlsIHdoZW4gZW1iZWRkZWQgaW4gSFRNTC5cbiAgLy8gPGJsb2NrIG5hbWU9XCJmb29cIi8+IC0+IDxibG9jayBuYW1lPVwiZm9vXCI+PC9ibG9jaz5cbiAgcmV0dXJuIHRleHQucmVwbGFjZSgvPChcXHcrKShbXjxdKilcXC8+L2csICc8JDEkMj48LyQxPicpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGEgRE9NIHN0cnVjdHVyZSBpbnRvIHByb3Blcmx5IGluZGVudGVkIHRleHQuXG4gKlxuICogQHBhcmFtIGRvbSBBIHRyZWUgb2YgWE1MIGVsZW1lbnRzLlxuICogQHJldHVybnMgVGV4dCByZXByZXNlbnRhdGlvbi5cbiAqIEBhbGlhcyBCbG9ja2x5LlhtbC5kb21Ub1ByZXR0eVRleHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRvbVRvUHJldHR5VGV4dChkb206IE5vZGUpOiBzdHJpbmcge1xuICAvLyBUaGlzIGZ1bmN0aW9uIGlzIG5vdCBndWFyYW50ZWVkIHRvIGJlIGNvcnJlY3QgZm9yIGFsbCBYTUwuXG4gIC8vIEJ1dCBpdCBoYW5kbGVzIHRoZSBYTUwgdGhhdCBCbG9ja2x5IGdlbmVyYXRlcy5cbiAgY29uc3QgYmxvYiA9IGRvbVRvVGV4dChkb20pO1xuICAvLyBQbGFjZSBldmVyeSBvcGVuIGFuZCBjbG9zZSB0YWcgb24gaXRzIG93biBsaW5lLlxuICBjb25zdCBsaW5lcyA9IGJsb2Iuc3BsaXQoJzwnKTtcbiAgLy8gSW5kZW50IGV2ZXJ5IGxpbmUuXG4gIGxldCBpbmRlbnQgPSAnJztcbiAgZm9yIChsZXQgaSA9IDE7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTtcbiAgICBpZiAobGluZVswXSA9PT0gJy8nKSB7XG4gICAgICBpbmRlbnQgPSBpbmRlbnQuc3Vic3RyaW5nKDIpO1xuICAgIH1cbiAgICBsaW5lc1tpXSA9IGluZGVudCArICc8JyArIGxpbmU7XG4gICAgaWYgKGxpbmVbMF0gIT09ICcvJyAmJiBsaW5lLnNsaWNlKC0yKSAhPT0gJy8+Jykge1xuICAgICAgaW5kZW50ICs9ICcgICc7XG4gICAgfVxuICB9XG4gIC8vIFB1bGwgc2ltcGxlIHRhZ3MgYmFjayB0b2dldGhlci5cbiAgLy8gRS5nLiA8Zm9vPjwvZm9vPlxuICBsZXQgdGV4dCA9IGxpbmVzLmpvaW4oJ1xcbicpO1xuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oPChcXHcrKVxcYltePl0qPlteXFxuXSopXFxuICo8XFwvXFwyPi9nLCAnJDE8LyQyPicpO1xuICAvLyBUcmltIGxlYWRpbmcgYmxhbmsgbGluZS5cbiAgcmV0dXJuIHRleHQucmVwbGFjZSgvXlxcbi8sICcnKTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhbiBYTUwgc3RyaW5nIGludG8gYSBET00gc3RydWN0dXJlLlxuICpcbiAqIEBwYXJhbSB0ZXh0IEFuIFhNTCBzdHJpbmcuXG4gKiBAcmV0dXJucyBBIERPTSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzaW5ndWxhciBjaGlsZCBvZiB0aGUgZG9jdW1lbnRcbiAqICAgICBlbGVtZW50LlxuICogQHRocm93cyBpZiB0aGUgdGV4dCBkb2Vzbid0IHBhcnNlLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLnRleHRUb0RvbVxuICovXG5leHBvcnQgZnVuY3Rpb24gdGV4dFRvRG9tKHRleHQ6IHN0cmluZyk6IEVsZW1lbnQge1xuICBjb25zdCBkb2MgPSB1dGlsc1htbC50ZXh0VG9Eb21Eb2N1bWVudCh0ZXh0KTtcbiAgaWYgKCFkb2MgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQgfHxcbiAgICAgIGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgncGFyc2VyZXJyb3InKS5sZW5ndGgpIHtcbiAgICB0aHJvdyBFcnJvcigndGV4dFRvRG9tIHdhcyB1bmFibGUgdG8gcGFyc2U6ICcgKyB0ZXh0KTtcbiAgfVxuICByZXR1cm4gZG9jLmRvY3VtZW50RWxlbWVudDtcbn1cblxuLyoqXG4gKiBDbGVhciB0aGUgZ2l2ZW4gd29ya3NwYWNlIHRoZW4gZGVjb2RlIGFuIFhNTCBET00gYW5kXG4gKiBjcmVhdGUgYmxvY2tzIG9uIHRoZSB3b3Jrc3BhY2UuXG4gKlxuICogQHBhcmFtIHhtbCBYTUwgRE9NLlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlLlxuICogQHJldHVybnMgQW4gYXJyYXkgY29udGFpbmluZyBuZXcgYmxvY2sgSURzLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLmNsZWFyV29ya3NwYWNlQW5kTG9hZEZyb21YbWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyV29ya3NwYWNlQW5kTG9hZEZyb21YbWwoXG4gICAgeG1sOiBFbGVtZW50LCB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zyk6IHN0cmluZ1tdIHtcbiAgd29ya3NwYWNlLnNldFJlc2l6ZXNFbmFibGVkKGZhbHNlKTtcbiAgd29ya3NwYWNlLmNsZWFyKCk7XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnV29ya3NwYWNlU3ZnJyBpcyBub3RcbiAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnV29ya3NwYWNlJy5cbiAgY29uc3QgYmxvY2tJZHMgPSBkb21Ub1dvcmtzcGFjZSh4bWwsIHdvcmtzcGFjZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICB3b3Jrc3BhY2Uuc2V0UmVzaXplc0VuYWJsZWQodHJ1ZSk7XG4gIHJldHVybiBibG9ja0lkcztcbn1cblxuLyoqXG4gKiBEZWNvZGUgYW4gWE1MIERPTSBhbmQgY3JlYXRlIGJsb2NrcyBvbiB0aGUgd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSB4bWwgWE1MIERPTS5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZS5cbiAqIEByZXR1cm5zIEFuIGFycmF5IGNvbnRhaW5pbmcgbmV3IGJsb2NrIElEcy5cbiAqIEBzdXBwcmVzcyB7c3RyaWN0TW9kdWxlRGVwQ2hlY2t9IFN1cHByZXNzIG1vZHVsZSBjaGVjayB3aGlsZSB3b3Jrc3BhY2VcbiAqIGNvbW1lbnRzIGFyZSBub3QgYnVuZGxlZCBpbi5cbiAqIEBhbGlhcyBCbG9ja2x5LlhtbC5kb21Ub1dvcmtzcGFjZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZG9tVG9Xb3Jrc3BhY2UoeG1sOiBFbGVtZW50LCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IHN0cmluZ1tdIHtcbiAgbGV0IHdpZHRoID0gMDsgIC8vIE5vdCB1c2VkIGluIExUUi5cbiAgaWYgKHdvcmtzcGFjZS5SVEwpIHtcbiAgICB3aWR0aCA9IHdvcmtzcGFjZS5nZXRXaWR0aCgpO1xuICB9XG4gIGNvbnN0IG5ld0Jsb2NrSWRzID0gW107ICAvLyBBIGxpc3Qgb2YgYmxvY2sgSURzIGFkZGVkIGJ5IHRoaXMgY2FsbC5cbiAgZG9tLnN0YXJ0VGV4dFdpZHRoQ2FjaGUoKTtcbiAgY29uc3QgZXhpc3RpbmdHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgfVxuXG4gIC8vIERpc2FibGUgd29ya3NwYWNlIHJlc2l6ZXMgYXMgYW4gb3B0aW1pemF0aW9uLlxuICAvLyBBc3N1bWUgaXQgaXMgcmVuZGVyZWQgc28gd2UgY2FuIGNoZWNrLlxuICBpZiAoKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLnNldFJlc2l6ZXNFbmFibGVkKSB7XG4gICAgKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLnNldFJlc2l6ZXNFbmFibGVkKGZhbHNlKTtcbiAgfVxuICBsZXQgdmFyaWFibGVzRmlyc3QgPSB0cnVlO1xuICB0cnkge1xuICAgIGZvciAobGV0IGkgPSAwLCB4bWxDaGlsZDsgeG1sQ2hpbGQgPSB4bWwuY2hpbGROb2Rlc1tpXTsgaSsrKSB7XG4gICAgICBjb25zdCBuYW1lID0geG1sQ2hpbGQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IHhtbENoaWxkRWxlbWVudCA9IHhtbENoaWxkIGFzIEVsZW1lbnQ7XG4gICAgICBpZiAobmFtZSA9PT0gJ2Jsb2NrJyB8fFxuICAgICAgICAgIG5hbWUgPT09ICdzaGFkb3cnICYmICFldmVudFV0aWxzLmdldFJlY29yZFVuZG8oKSkge1xuICAgICAgICAvLyBBbGxvdyB0b3AtbGV2ZWwgc2hhZG93IGJsb2NrcyBpZiByZWNvcmRVbmRvIGlzIGRpc2FibGVkIHNpbmNlXG4gICAgICAgIC8vIHRoYXQgbWVhbnMgYW4gdW5kbyBpcyBpbiBwcm9ncmVzcy4gIFN1Y2ggYSBibG9jayBpcyBleHBlY3RlZFxuICAgICAgICAvLyB0byBiZSBtb3ZlZCB0byBhIG5lc3RlZCBkZXN0aW5hdGlvbiBpbiB0aGUgbmV4dCBvcGVyYXRpb24uXG4gICAgICAgIGNvbnN0IGJsb2NrID0gZG9tVG9CbG9jayh4bWxDaGlsZEVsZW1lbnQsIHdvcmtzcGFjZSk7XG4gICAgICAgIG5ld0Jsb2NrSWRzLnB1c2goYmxvY2suaWQpO1xuICAgICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ3N0cmluZyB8IG51bGwnIGlzIG5vdFxuICAgICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgICAgICBjb25zdCBibG9ja1ggPSB4bWxDaGlsZEVsZW1lbnQuaGFzQXR0cmlidXRlKCd4JykgP1xuICAgICAgICAgICAgcGFyc2VJbnQoeG1sQ2hpbGRFbGVtZW50LmdldEF0dHJpYnV0ZSgneCcpIGFzIEFueUR1cmluZ01pZ3JhdGlvbikgOlxuICAgICAgICAgICAgMTA7XG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnc3RyaW5nIHwgbnVsbCcgaXMgbm90XG4gICAgICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZycuXG4gICAgICAgIGNvbnN0IGJsb2NrWSA9IHhtbENoaWxkRWxlbWVudC5oYXNBdHRyaWJ1dGUoJ3knKSA/XG4gICAgICAgICAgICBwYXJzZUludCh4bWxDaGlsZEVsZW1lbnQuZ2V0QXR0cmlidXRlKCd5JykgYXMgQW55RHVyaW5nTWlncmF0aW9uKSA6XG4gICAgICAgICAgICAxMDtcbiAgICAgICAgaWYgKCFpc05hTihibG9ja1gpICYmICFpc05hTihibG9ja1kpKSB7XG4gICAgICAgICAgYmxvY2subW92ZUJ5KHdvcmtzcGFjZS5SVEwgPyB3aWR0aCAtIGJsb2NrWCA6IGJsb2NrWCwgYmxvY2tZKTtcbiAgICAgICAgfVxuICAgICAgICB2YXJpYWJsZXNGaXJzdCA9IGZhbHNlO1xuICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnc2hhZG93Jykge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ1NoYWRvdyBibG9jayBjYW5ub3QgYmUgYSB0b3AtbGV2ZWwgYmxvY2suJyk7XG4gICAgICB9IGVsc2UgaWYgKG5hbWUgPT09ICdjb21tZW50Jykge1xuICAgICAgICBpZiAod29ya3NwYWNlLnJlbmRlcmVkKSB7XG4gICAgICAgICAgV29ya3NwYWNlQ29tbWVudFN2Zy5mcm9tWG1sUmVuZGVyZWQoXG4gICAgICAgICAgICAgIHhtbENoaWxkRWxlbWVudCwgd29ya3NwYWNlIGFzIFdvcmtzcGFjZVN2Zywgd2lkdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIFdvcmtzcGFjZUNvbW1lbnQuZnJvbVhtbCh4bWxDaGlsZEVsZW1lbnQsIHdvcmtzcGFjZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ3ZhcmlhYmxlcycpIHtcbiAgICAgICAgaWYgKHZhcmlhYmxlc0ZpcnN0KSB7XG4gICAgICAgICAgZG9tVG9WYXJpYWJsZXMoeG1sQ2hpbGRFbGVtZW50LCB3b3Jrc3BhY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgICAnXFwndmFyaWFibGVzXFwnIHRhZyBtdXN0IGV4aXN0IG9uY2UgYmVmb3JlIGJsb2NrIGFuZCAnICtcbiAgICAgICAgICAgICAgJ3NoYWRvdyB0YWcgZWxlbWVudHMgaW4gdGhlIHdvcmtzcGFjZSBYTUwsIGJ1dCBpdCB3YXMgZm91bmQgaW4gJyArXG4gICAgICAgICAgICAgICdhbm90aGVyIGxvY2F0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIHZhcmlhYmxlc0ZpcnN0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9IGZpbmFsbHkge1xuICAgIGlmICghZXhpc3RpbmdHcm91cCkge1xuICAgICAgZXZlbnRVdGlscy5zZXRHcm91cChmYWxzZSk7XG4gICAgfVxuICAgIGRvbS5zdG9wVGV4dFdpZHRoQ2FjaGUoKTtcbiAgfVxuICAvLyBSZS1lbmFibGUgd29ya3NwYWNlIHJlc2l6aW5nLlxuICBpZiAoKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLnNldFJlc2l6ZXNFbmFibGVkKSB7XG4gICAgKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLnNldFJlc2l6ZXNFbmFibGVkKHRydWUpO1xuICB9XG4gIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuRklOSVNIRURfTE9BRElORykpKHdvcmtzcGFjZSkpO1xuICByZXR1cm4gbmV3QmxvY2tJZHM7XG59XG5cbi8qKlxuICogRGVjb2RlIGFuIFhNTCBET00gYW5kIGNyZWF0ZSBibG9ja3Mgb24gdGhlIHdvcmtzcGFjZS4gUG9zaXRpb24gdGhlIG5ld1xuICogYmxvY2tzIGltbWVkaWF0ZWx5IGJlbG93IHByaW9yIGJsb2NrcywgYWxpZ25lZCBieSB0aGVpciBzdGFydGluZyBlZGdlLlxuICpcbiAqIEBwYXJhbSB4bWwgVGhlIFhNTCBET00uXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gYWRkIHRvLlxuICogQHJldHVybnMgQW4gYXJyYXkgY29udGFpbmluZyBuZXcgYmxvY2sgSURzLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLmFwcGVuZERvbVRvV29ya3NwYWNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBlbmREb21Ub1dvcmtzcGFjZShcbiAgICB4bWw6IEVsZW1lbnQsIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKTogc3RyaW5nW10ge1xuICAvLyBGaXJzdCBjaGVjayBpZiB3ZSBoYXZlIGEgV29ya3NwYWNlU3ZnLCBvdGhlcndpc2UgdGhlIGJsb2NrcyBoYXZlIG5vIHNoYXBlXG4gIC8vIGFuZCB0aGUgcG9zaXRpb24gZG9lcyBub3QgbWF0dGVyLlxuICAvLyBBc3N1bWUgaXQgaXMgcmVuZGVyZWQgc28gd2UgY2FuIGNoZWNrLlxuICBpZiAoISh3b3Jrc3BhY2UgYXMgV29ya3NwYWNlU3ZnKS5nZXRCbG9ja3NCb3VuZGluZ0JveCkge1xuICAgIHJldHVybiBkb21Ub1dvcmtzcGFjZSh4bWwsIHdvcmtzcGFjZSk7XG4gIH1cblxuICBjb25zdCBiYm94ID0gKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLmdldEJsb2Nrc0JvdW5kaW5nQm94KCk7XG4gIC8vIExvYWQgdGhlIG5ldyBibG9ja3MgaW50byB0aGUgd29ya3NwYWNlIGFuZCBnZXQgdGhlIElEcyBvZiB0aGUgbmV3IGJsb2Nrcy5cbiAgY29uc3QgbmV3QmxvY2tJZHMgPSBkb21Ub1dvcmtzcGFjZSh4bWwsIHdvcmtzcGFjZSk7XG4gIGlmIChiYm94ICYmIGJib3gudG9wICE9PSBiYm94LmJvdHRvbSkgeyAgLy8gQ2hlY2sgaWYgYW55IHByZXZpb3VzIGJsb2NrLlxuICAgIGxldCBvZmZzZXRZID0gMDsgIC8vIE9mZnNldCB0byBhZGQgdG8geSBvZiB0aGUgbmV3IGJsb2NrLlxuICAgIGxldCBvZmZzZXRYID0gMDtcbiAgICBjb25zdCBmYXJZID0gYmJveC5ib3R0b207ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBCb3R0b20gcG9zaXRpb24uXG4gICAgY29uc3QgdG9wWCA9IHdvcmtzcGFjZS5SVEwgPyBiYm94LnJpZ2h0IDogYmJveC5sZWZ0OyAgLy8gWCBvZiBib3VuZGluZyBib3guXG4gICAgLy8gQ2hlY2sgcG9zaXRpb24gb2YgdGhlIG5ldyBibG9ja3MuXG4gICAgbGV0IG5ld0xlZnRYID0gSW5maW5pdHk7ICAgIC8vIFggb2YgdG9wIGxlZnQgY29ybmVyLlxuICAgIGxldCBuZXdSaWdodFggPSAtSW5maW5pdHk7ICAvLyBYIG9mIHRvcCByaWdodCBjb3JuZXIuXG4gICAgbGV0IG5ld1kgPSBJbmZpbml0eTsgICAgICAgIC8vIFkgb2YgdG9wIGNvcm5lci5cbiAgICBjb25zdCB5U2VwYXJhdGlvbiA9IDEwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3QmxvY2tJZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGJsb2NrWFkgPVxuICAgICAgICAgIHdvcmtzcGFjZS5nZXRCbG9ja0J5SWQobmV3QmxvY2tJZHNbaV0pIS5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgICBpZiAoYmxvY2tYWS55IDwgbmV3WSkge1xuICAgICAgICBuZXdZID0gYmxvY2tYWS55O1xuICAgICAgfVxuICAgICAgaWYgKGJsb2NrWFkueCA8IG5ld0xlZnRYKSB7ICAvLyBpZiB3ZSBsZWZ0IGFsaWduIGFsc28gb24geFxuICAgICAgICBuZXdMZWZ0WCA9IGJsb2NrWFkueDtcbiAgICAgIH1cbiAgICAgIGlmIChibG9ja1hZLnggPiBuZXdSaWdodFgpIHsgIC8vIGlmIHdlIHJpZ2h0IGFsaWduIGFsc28gb24geFxuICAgICAgICBuZXdSaWdodFggPSBibG9ja1hZLng7XG4gICAgICB9XG4gICAgfVxuICAgIG9mZnNldFkgPSBmYXJZIC0gbmV3WSArIHlTZXBhcmF0aW9uO1xuICAgIG9mZnNldFggPSB3b3Jrc3BhY2UuUlRMID8gdG9wWCAtIG5ld1JpZ2h0WCA6IHRvcFggLSBuZXdMZWZ0WDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld0Jsb2NrSWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBibG9jayA9IHdvcmtzcGFjZS5nZXRCbG9ja0J5SWQobmV3QmxvY2tJZHNbaV0pO1xuICAgICAgYmxvY2shLm1vdmVCeShvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ld0Jsb2NrSWRzO1xufVxuXG4vKipcbiAqIERlY29kZSBhbiBYTUwgYmxvY2sgdGFnIGFuZCBjcmVhdGUgYSBibG9jayAoYW5kIHBvc3NpYmx5IHN1YiBibG9ja3MpIG9uIHRoZVxuICogd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSB4bWxCbG9jayBYTUwgYmxvY2sgZWxlbWVudC5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZS5cbiAqIEByZXR1cm5zIFRoZSByb290IGJsb2NrIGNyZWF0ZWQuXG4gKiBAYWxpYXMgQmxvY2tseS5YbWwuZG9tVG9CbG9ja1xuICovXG5leHBvcnQgZnVuY3Rpb24gZG9tVG9CbG9jayh4bWxCbG9jazogRWxlbWVudCwgd29ya3NwYWNlOiBXb3Jrc3BhY2UpOiBCbG9jayB7XG4gIC8vIENyZWF0ZSB0b3AtbGV2ZWwgYmxvY2suXG4gIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuICBjb25zdCB2YXJpYWJsZXNCZWZvcmVDcmVhdGlvbiA9IHdvcmtzcGFjZS5nZXRBbGxWYXJpYWJsZXMoKTtcbiAgbGV0IHRvcEJsb2NrO1xuICB0cnkge1xuICAgIHRvcEJsb2NrID0gZG9tVG9CbG9ja0hlYWRsZXNzKHhtbEJsb2NrLCB3b3Jrc3BhY2UpO1xuICAgIC8vIEdlbmVyYXRlIGxpc3Qgb2YgYWxsIGJsb2Nrcy5cbiAgICBpZiAod29ya3NwYWNlLnJlbmRlcmVkKSB7XG4gICAgICBjb25zdCB0b3BCbG9ja1N2ZyA9IHRvcEJsb2NrIGFzIEJsb2NrU3ZnO1xuICAgICAgY29uc3QgYmxvY2tzID0gdG9wQmxvY2suZ2V0RGVzY2VuZGFudHMoZmFsc2UpO1xuICAgICAgdG9wQmxvY2tTdmcuc2V0Q29ubmVjdGlvblRyYWNraW5nKGZhbHNlKTtcbiAgICAgIC8vIFJlbmRlciBlYWNoIGJsb2NrLlxuICAgICAgZm9yIChsZXQgaSA9IGJsb2Nrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAoYmxvY2tzW2ldIGFzIEJsb2NrU3ZnKS5pbml0U3ZnKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpID0gYmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIChibG9ja3NbaV0gYXMgQmxvY2tTdmcpLnJlbmRlcihmYWxzZSk7XG4gICAgICB9XG4gICAgICAvLyBQb3B1bGF0aW5nIHRoZSBjb25uZWN0aW9uIGRhdGFiYXNlIG1heSBiZSBkZWZlcnJlZCB1bnRpbCBhZnRlciB0aGVcbiAgICAgIC8vIGJsb2NrcyBoYXZlIHJlbmRlcmVkLlxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0b3BCbG9ja1N2Zy5kaXNwb3NlZCkge1xuICAgICAgICAgIHRvcEJsb2NrU3ZnLnNldENvbm5lY3Rpb25UcmFja2luZyh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSwgMSk7XG4gICAgICB0b3BCbG9ja1N2Zy51cGRhdGVEaXNhYmxlZCgpO1xuICAgICAgLy8gQWxsb3cgdGhlIHNjcm9sbGJhcnMgdG8gcmVzaXplIGFuZCBtb3ZlIGJhc2VkIG9uIHRoZSBuZXcgY29udGVudHMuXG4gICAgICAvLyBUT0RPKEBwaWNrbGVzcnVzKTogIzM4Ny4gUmVtb3ZlIHdoZW4gZG9tVG9CbG9jayBhdm9pZHMgcmVzaXppbmcuXG4gICAgICAod29ya3NwYWNlIGFzIFdvcmtzcGFjZVN2ZykucmVzaXplQ29udGVudHMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgYmxvY2tzID0gdG9wQmxvY2suZ2V0RGVzY2VuZGFudHMoZmFsc2UpO1xuICAgICAgZm9yIChsZXQgaSA9IGJsb2Nrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICBibG9ja3NbaV0uaW5pdE1vZGVsKCk7XG4gICAgICB9XG4gICAgfVxuICB9IGZpbmFsbHkge1xuICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gIH1cbiAgaWYgKGV2ZW50VXRpbHMuaXNFbmFibGVkKCkpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdnZXQnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAvLyAnKG5hbWU6IHN0cmluZykgPT4gdm9pZCcuXG4gICAgY29uc3QgbmV3VmFyaWFibGVzID1cbiAgICAgICAgVmFyaWFibGVzLmdldEFkZGVkVmFyaWFibGVzKHdvcmtzcGFjZSwgdmFyaWFibGVzQmVmb3JlQ3JlYXRpb24pO1xuICAgIC8vIEZpcmUgYSBWYXJDcmVhdGUgZXZlbnQgZm9yIGVhY2ggKGlmIGFueSkgbmV3IHZhcmlhYmxlIGNyZWF0ZWQuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdWYXJpYWJsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHRoaXNWYXJpYWJsZSA9IG5ld1ZhcmlhYmxlc1tpXTtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShcbiAgICAgICAgICBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuVkFSX0NSRUFURSkpKHRoaXNWYXJpYWJsZSkpO1xuICAgIH1cbiAgICAvLyBCbG9jayBldmVudHMgY29tZSBhZnRlciB2YXIgZXZlbnRzLCBpbiBjYXNlIHRoZXkgcmVmZXIgdG8gbmV3bHkgY3JlYXRlZFxuICAgIC8vIHZhcmlhYmxlcy5cbiAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkNSRUFURSkpKHRvcEJsb2NrKSk7XG4gIH1cbiAgcmV0dXJuIHRvcEJsb2NrO1xufVxuXG4vKipcbiAqIERlY29kZSBhbiBYTUwgbGlzdCBvZiB2YXJpYWJsZXMgYW5kIGFkZCB0aGUgdmFyaWFibGVzIHRvIHRoZSB3b3Jrc3BhY2UuXG4gKlxuICogQHBhcmFtIHhtbFZhcmlhYmxlcyBMaXN0IG9mIFhNTCB2YXJpYWJsZSBlbGVtZW50cy5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byB3aGljaCB0aGUgdmFyaWFibGUgc2hvdWxkIGJlIGFkZGVkLlxuICogQGFsaWFzIEJsb2NrbHkuWG1sLmRvbVRvVmFyaWFibGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkb21Ub1ZhcmlhYmxlcyh4bWxWYXJpYWJsZXM6IEVsZW1lbnQsIHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeG1sVmFyaWFibGVzLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeG1sQ2hpbGQgPSB4bWxWYXJpYWJsZXMuY2hpbGRyZW5baV07XG4gICAgY29uc3QgdHlwZSA9IHhtbENoaWxkLmdldEF0dHJpYnV0ZSgndHlwZScpO1xuICAgIGNvbnN0IGlkID0geG1sQ2hpbGQuZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAgIGNvbnN0IG5hbWUgPSB4bWxDaGlsZC50ZXh0Q29udGVudDtcblxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnc3RyaW5nIHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICB3b3Jrc3BhY2UuY3JlYXRlVmFyaWFibGUobmFtZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24sIHR5cGUsIGlkKTtcbiAgfVxufVxuXG4vKiogQSBtYXBwaW5nIG9mIG5vZGVOYW1lIHRvIG5vZGUgZm9yIGNoaWxkIG5vZGVzIG9mIHhtbEJsb2NrLiAqL1xuaW50ZXJmYWNlIGNoaWxkTm9kZVRhZ01hcCB7XG4gIG11dGF0aW9uOiBFbGVtZW50W107XG4gIGNvbW1lbnQ6IEVsZW1lbnRbXTtcbiAgZGF0YTogRWxlbWVudFtdO1xuICBmaWVsZDogRWxlbWVudFtdO1xuICBpbnB1dDogRWxlbWVudFtdO1xuICBuZXh0OiBFbGVtZW50W107XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hcHBpbmcgb2YgY2hpbGROb2RlcyBmb3IgZWFjaCBzdXBwb3J0ZWQgWE1MIHRhZyBmb3IgdGhlIHByb3ZpZGVkXG4gKiB4bWxCbG9jay4gTG9ncyBhIHdhcm5pbmcgZm9yIGFueSBlbmNvdW50ZXJlZCB1bnN1cHBvcnRlZCB0YWdzLlxuICpcbiAqIEBwYXJhbSB4bWxCbG9jayBYTUwgYmxvY2sgZWxlbWVudC5cbiAqIEByZXR1cm5zIFRoZSBjaGlsZE5vZGUgbWFwIGZyb20gbm9kZU5hbWUgdG8gbm9kZS5cbiAqL1xuZnVuY3Rpb24gbWFwU3VwcG9ydGVkWG1sVGFncyh4bWxCbG9jazogRWxlbWVudCk6IGNoaWxkTm9kZVRhZ01hcCB7XG4gIGNvbnN0IGNoaWxkTm9kZU1hcCA9IHtcbiAgICBtdXRhdGlvbjogbmV3IEFycmF5PEVsZW1lbnQ+KCksXG4gICAgY29tbWVudDogbmV3IEFycmF5PEVsZW1lbnQ+KCksXG4gICAgZGF0YTogbmV3IEFycmF5PEVsZW1lbnQ+KCksXG4gICAgZmllbGQ6IG5ldyBBcnJheTxFbGVtZW50PigpLFxuICAgIGlucHV0OiBuZXcgQXJyYXk8RWxlbWVudD4oKSxcbiAgICBuZXh0OiBuZXcgQXJyYXk8RWxlbWVudD4oKSxcbiAgfTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB4bWxCbG9jay5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHhtbENoaWxkID0geG1sQmxvY2suY2hpbGRyZW5baV07XG4gICAgaWYgKHhtbENoaWxkLm5vZGVUeXBlID09PSBkb20uTm9kZVR5cGUuVEVYVF9OT0RFKSB7XG4gICAgICAvLyBJZ25vcmUgYW55IHRleHQgYXQgdGhlIDxibG9jaz4gbGV2ZWwuICBJdCdzIGFsbCB3aGl0ZXNwYWNlIGFueXdheS5cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBzd2l0Y2ggKHhtbENoaWxkLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGNhc2UgJ211dGF0aW9uJzpcbiAgICAgICAgY2hpbGROb2RlTWFwLm11dGF0aW9uLnB1c2goeG1sQ2hpbGQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NvbW1lbnQnOlxuICAgICAgICBjaGlsZE5vZGVNYXAuY29tbWVudC5wdXNoKHhtbENoaWxkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdkYXRhJzpcbiAgICAgICAgY2hpbGROb2RlTWFwLmRhdGEucHVzaCh4bWxDaGlsZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndGl0bGUnOlxuICAgICAgLy8gVGl0bGVzIHdlcmUgcmVuYW1lZCB0byBmaWVsZCBpbiBEZWNlbWJlciAyMDEzLlxuICAgICAgLy8gRmFsbCB0aHJvdWdoLlxuICAgICAgY2FzZSAnZmllbGQnOlxuICAgICAgICBjaGlsZE5vZGVNYXAuZmllbGQucHVzaCh4bWxDaGlsZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndmFsdWUnOlxuICAgICAgY2FzZSAnc3RhdGVtZW50JzpcbiAgICAgICAgY2hpbGROb2RlTWFwLmlucHV0LnB1c2goeG1sQ2hpbGQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ25leHQnOlxuICAgICAgICBjaGlsZE5vZGVNYXAubmV4dC5wdXNoKHhtbENoaWxkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAvLyBVbmtub3duIHRhZzsgaWdub3JlLiAgU2FtZSBwcmluY2lwbGUgYXMgSFRNTCBwYXJzZXJzLlxuICAgICAgICBjb25zb2xlLndhcm4oJ0lnbm9yaW5nIHVua25vd24gdGFnOiAnICsgeG1sQ2hpbGQubm9kZU5hbWUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY2hpbGROb2RlTWFwO1xufVxuXG4vKipcbiAqIEFwcGxpZXMgbXV0YXRpb24gdGFnIGNoaWxkIG5vZGVzIHRvIHRoZSBnaXZlbiBibG9jay5cbiAqXG4gKiBAcGFyYW0geG1sQ2hpbGRyZW4gQ2hpbGQgbm9kZXMuXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGFwcGx5IHRoZSBjaGlsZCBub2RlcyBvbi5cbiAqIEByZXR1cm5zIFRydWUgaWYgbXV0YXRpb24gbWF5IGhhdmUgYWRkZWQgc29tZSBlbGVtZW50cyB0aGF0IG5lZWRcbiAqICAgICBpbml0aWFsaXphdGlvbiAocmVxdWlyaW5nIGluaXRTdmcgY2FsbCkuXG4gKi9cbmZ1bmN0aW9uIGFwcGx5TXV0YXRpb25UYWdOb2Rlcyh4bWxDaGlsZHJlbjogRWxlbWVudFtdLCBibG9jazogQmxvY2spOiBib29sZWFuIHtcbiAgbGV0IHNob3VsZENhbGxJbml0U3ZnID0gZmFsc2U7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeG1sQ2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCB4bWxDaGlsZCA9IHhtbENoaWxkcmVuW2ldO1xuICAgIC8vIEN1c3RvbSBkYXRhIGZvciBhbiBhZHZhbmNlZCBibG9jay5cbiAgICBpZiAoYmxvY2suZG9tVG9NdXRhdGlvbikge1xuICAgICAgYmxvY2suZG9tVG9NdXRhdGlvbih4bWxDaGlsZCk7XG4gICAgICBpZiAoKGJsb2NrIGFzIEJsb2NrU3ZnKS5pbml0U3ZnKSB7XG4gICAgICAgIC8vIE11dGF0aW9uIG1heSBoYXZlIGFkZGVkIHNvbWUgZWxlbWVudHMgdGhhdCBuZWVkIGluaXRpYWxpemluZy5cbiAgICAgICAgc2hvdWxkQ2FsbEluaXRTdmcgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gc2hvdWxkQ2FsbEluaXRTdmc7XG59XG5cbi8qKlxuICogQXBwbGllcyBjb21tZW50IHRhZyBjaGlsZCBub2RlcyB0byB0aGUgZ2l2ZW4gYmxvY2suXG4gKlxuICogQHBhcmFtIHhtbENoaWxkcmVuIENoaWxkIG5vZGVzLlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBhcHBseSB0aGUgY2hpbGQgbm9kZXMgb24uXG4gKi9cbmZ1bmN0aW9uIGFwcGx5Q29tbWVudFRhZ05vZGVzKHhtbENoaWxkcmVuOiBFbGVtZW50W10sIGJsb2NrOiBCbG9jaykge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHhtbENoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeG1sQ2hpbGQgPSB4bWxDaGlsZHJlbltpXTtcbiAgICBjb25zdCB0ZXh0ID0geG1sQ2hpbGQudGV4dENvbnRlbnQ7XG4gICAgY29uc3QgcGlubmVkID0geG1sQ2hpbGQuZ2V0QXR0cmlidXRlKCdwaW5uZWQnKSA9PT0gJ3RydWUnO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnc3RyaW5nIHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBjb25zdCB3aWR0aCA9IHBhcnNlSW50KHhtbENoaWxkLmdldEF0dHJpYnV0ZSgndycpIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdzdHJpbmcgfCBudWxsJyBpcyBub3RcbiAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgIGNvbnN0IGhlaWdodCA9IHBhcnNlSW50KHhtbENoaWxkLmdldEF0dHJpYnV0ZSgnaCcpIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG5cbiAgICBibG9jay5zZXRDb21tZW50VGV4dCh0ZXh0KTtcbiAgICBibG9jay5jb21tZW50TW9kZWwucGlubmVkID0gcGlubmVkO1xuICAgIGlmICghaXNOYU4od2lkdGgpICYmICFpc05hTihoZWlnaHQpKSB7XG4gICAgICBibG9jay5jb21tZW50TW9kZWwuc2l6ZSA9IG5ldyBTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cblxuICAgIGlmIChwaW5uZWQgJiYgKGJsb2NrIGFzIEJsb2NrU3ZnKS5nZXRDb21tZW50SWNvbiAmJiAhYmxvY2suaXNJbkZseW91dCkge1xuICAgICAgY29uc3QgYmxvY2tTdmcgPSBibG9jayBhcyBCbG9ja1N2ZztcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIGJsb2NrU3ZnLmdldENvbW1lbnRJY29uKCkhLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICB9LCAxKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBBcHBsaWVzIGRhdGEgdGFnIGNoaWxkIG5vZGVzIHRvIHRoZSBnaXZlbiBibG9jay5cbiAqXG4gKiBAcGFyYW0geG1sQ2hpbGRyZW4gQ2hpbGQgbm9kZXMuXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGFwcGx5IHRoZSBjaGlsZCBub2RlcyBvbi5cbiAqL1xuZnVuY3Rpb24gYXBwbHlEYXRhVGFnTm9kZXMoeG1sQ2hpbGRyZW46IEVsZW1lbnRbXSwgYmxvY2s6IEJsb2NrKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeG1sQ2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCB4bWxDaGlsZCA9IHhtbENoaWxkcmVuW2ldO1xuICAgIGJsb2NrLmRhdGEgPSB4bWxDaGlsZC50ZXh0Q29udGVudDtcbiAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgZmllbGQgdGFnIGNoaWxkIG5vZGVzIHRvIHRoZSBnaXZlbiBibG9jay5cbiAqXG4gKiBAcGFyYW0geG1sQ2hpbGRyZW4gQ2hpbGQgbm9kZXMuXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGFwcGx5IHRoZSBjaGlsZCBub2RlcyBvbi5cbiAqL1xuZnVuY3Rpb24gYXBwbHlGaWVsZFRhZ05vZGVzKHhtbENoaWxkcmVuOiBFbGVtZW50W10sIGJsb2NrOiBCbG9jaykge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHhtbENoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeG1sQ2hpbGQgPSB4bWxDaGlsZHJlbltpXTtcbiAgICBjb25zdCBub2RlTmFtZSA9IHhtbENoaWxkLmdldEF0dHJpYnV0ZSgnbmFtZScpO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnc3RyaW5nIHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBkb21Ub0ZpZWxkKGJsb2NrLCBub2RlTmFtZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24sIHhtbENoaWxkKTtcbiAgfVxufVxuXG4vKipcbiAqIEZpbmRzIGFueSBlbmNsb3NlZCBibG9ja3Mgb3Igc2hhZG93cyB3aXRoaW4gdGhpcyBYTUwgbm9kZS5cbiAqXG4gKiBAcGFyYW0geG1sTm9kZSBUaGUgWE1MIG5vZGUgdG8gZXh0cmFjdCBjaGlsZCBibG9jayBpbmZvIGZyb20uXG4gKiBAcmV0dXJucyBBbnkgZm91bmQgY2hpbGQgYmxvY2suXG4gKi9cbmZ1bmN0aW9uIGZpbmRDaGlsZEJsb2Nrcyh4bWxOb2RlOiBFbGVtZW50KTpcbiAgICB7Y2hpbGRCbG9ja0VsZW1lbnQ6IEVsZW1lbnR8bnVsbCwgY2hpbGRTaGFkb3dFbGVtZW50OiBFbGVtZW50fG51bGx9IHtcbiAgY29uc3QgY2hpbGRCbG9ja0luZm8gPSB7Y2hpbGRCbG9ja0VsZW1lbnQ6IG51bGwsIGNoaWxkU2hhZG93RWxlbWVudDogbnVsbH07XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeG1sTm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeG1sQ2hpbGQgPSB4bWxOb2RlLmNoaWxkTm9kZXNbaV07XG4gICAgaWYgKHhtbENoaWxkLm5vZGVUeXBlID09PSBkb20uTm9kZVR5cGUuRUxFTUVOVF9OT0RFKSB7XG4gICAgICBpZiAoeG1sQ2hpbGQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2Jsb2NrJykge1xuICAgICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ0VsZW1lbnQnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgICAgICAgLy8gJ251bGwnLlxuICAgICAgICBjaGlsZEJsb2NrSW5mby5jaGlsZEJsb2NrRWxlbWVudCA9XG4gICAgICAgICAgICB4bWxDaGlsZCBhcyBFbGVtZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgICAgIH0gZWxzZSBpZiAoeG1sQ2hpbGQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NoYWRvdycpIHtcbiAgICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdFbGVtZW50JyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gICAgICAgIC8vICdudWxsJy5cbiAgICAgICAgY2hpbGRCbG9ja0luZm8uY2hpbGRTaGFkb3dFbGVtZW50ID1cbiAgICAgICAgICAgIHhtbENoaWxkIGFzIEVsZW1lbnQgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gY2hpbGRCbG9ja0luZm87XG59XG4vKipcbiAqIEFwcGxpZXMgaW5wdXQgY2hpbGQgbm9kZXMgKHZhbHVlIG9yIHN0YXRlbWVudCkgdG8gdGhlIGdpdmVuIGJsb2NrLlxuICpcbiAqIEBwYXJhbSB4bWxDaGlsZHJlbiBDaGlsZCBub2Rlcy5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBjb250YWluaW5nIHRoZSBnaXZlbiBibG9jay5cbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gYXBwbHkgdGhlIGNoaWxkIG5vZGVzIG9uLlxuICogQHBhcmFtIHByb3RvdHlwZU5hbWUgVGhlIHByb3RvdHlwZSBuYW1lIG9mIHRoZSBibG9jay5cbiAqL1xuZnVuY3Rpb24gYXBwbHlJbnB1dFRhZ05vZGVzKFxuICAgIHhtbENoaWxkcmVuOiBFbGVtZW50W10sIHdvcmtzcGFjZTogV29ya3NwYWNlLCBibG9jazogQmxvY2ssXG4gICAgcHJvdG90eXBlTmFtZTogc3RyaW5nKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeG1sQ2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCB4bWxDaGlsZCA9IHhtbENoaWxkcmVuW2ldO1xuICAgIGNvbnN0IG5vZGVOYW1lID0geG1sQ2hpbGQuZ2V0QXR0cmlidXRlKCduYW1lJyk7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdzdHJpbmcgfCBudWxsJyBpcyBub3RcbiAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgIGNvbnN0IGlucHV0ID0gYmxvY2suZ2V0SW5wdXQobm9kZU5hbWUgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICBpZiAoIWlucHV0KSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ0lnbm9yaW5nIG5vbi1leGlzdGVudCBpbnB1dCAnICsgbm9kZU5hbWUgKyAnIGluIGJsb2NrICcgK1xuICAgICAgICAgIHByb3RvdHlwZU5hbWUpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IGNoaWxkQmxvY2tJbmZvID0gZmluZENoaWxkQmxvY2tzKHhtbENoaWxkKTtcbiAgICBpZiAoY2hpbGRCbG9ja0luZm8uY2hpbGRCbG9ja0VsZW1lbnQpIHtcbiAgICAgIGlmICghaW5wdXQuY29ubmVjdGlvbikge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ0lucHV0IGNvbm5lY3Rpb24gZG9lcyBub3QgZXhpc3QuJyk7XG4gICAgICB9XG4gICAgICBkb21Ub0Jsb2NrSGVhZGxlc3MoXG4gICAgICAgICAgY2hpbGRCbG9ja0luZm8uY2hpbGRCbG9ja0VsZW1lbnQsIHdvcmtzcGFjZSwgaW5wdXQuY29ubmVjdGlvbiwgZmFsc2UpO1xuICAgIH1cbiAgICAvLyBTZXQgc2hhZG93IGFmdGVyIHNvIHdlIGRvbid0IGNyZWF0ZSBhIHNoYWRvdyB3ZSBkZWxldGUgaW1tZWRpYXRlbHkuXG4gICAgaWYgKGNoaWxkQmxvY2tJbmZvLmNoaWxkU2hhZG93RWxlbWVudCkge1xuICAgICAgaW5wdXQuY29ubmVjdGlvbj8uc2V0U2hhZG93RG9tKGNoaWxkQmxvY2tJbmZvLmNoaWxkU2hhZG93RWxlbWVudCk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQXBwbGllcyBuZXh0IGNoaWxkIG5vZGVzIHRvIHRoZSBnaXZlbiBibG9jay5cbiAqXG4gKiBAcGFyYW0geG1sQ2hpbGRyZW4gQ2hpbGQgbm9kZXMuXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgY29udGFpbmluZyB0aGUgZ2l2ZW4gYmxvY2suXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGFwcGx5IHRoZSBjaGlsZCBub2RlcyBvbi5cbiAqL1xuZnVuY3Rpb24gYXBwbHlOZXh0VGFnTm9kZXMoXG4gICAgeG1sQ2hpbGRyZW46IEVsZW1lbnRbXSwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGJsb2NrOiBCbG9jaykge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHhtbENoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeG1sQ2hpbGQgPSB4bWxDaGlsZHJlbltpXTtcbiAgICBjb25zdCBjaGlsZEJsb2NrSW5mbyA9IGZpbmRDaGlsZEJsb2Nrcyh4bWxDaGlsZCk7XG4gICAgaWYgKGNoaWxkQmxvY2tJbmZvLmNoaWxkQmxvY2tFbGVtZW50KSB7XG4gICAgICBpZiAoIWJsb2NrLm5leHRDb25uZWN0aW9uKSB7XG4gICAgICAgIHRocm93IFR5cGVFcnJvcignTmV4dCBzdGF0ZW1lbnQgZG9lcyBub3QgZXhpc3QuJyk7XG4gICAgICB9XG4gICAgICAvLyBJZiB0aGVyZSBpcyBtb3JlIHRoYW4gb25lIFhNTCAnbmV4dCcgdGFnLlxuICAgICAgaWYgKGJsb2NrLm5leHRDb25uZWN0aW9uLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdOZXh0IHN0YXRlbWVudCBpcyBhbHJlYWR5IGNvbm5lY3RlZC4nKTtcbiAgICAgIH1cbiAgICAgIC8vIENyZWF0ZSBjaGlsZCBibG9jay5cbiAgICAgIGRvbVRvQmxvY2tIZWFkbGVzcyhcbiAgICAgICAgICBjaGlsZEJsb2NrSW5mby5jaGlsZEJsb2NrRWxlbWVudCwgd29ya3NwYWNlLCBibG9jay5uZXh0Q29ubmVjdGlvbixcbiAgICAgICAgICB0cnVlKTtcbiAgICB9XG4gICAgLy8gU2V0IHNoYWRvdyBhZnRlciBzbyB3ZSBkb24ndCBjcmVhdGUgYSBzaGFkb3cgd2UgZGVsZXRlIGltbWVkaWF0ZWx5LlxuICAgIGlmIChjaGlsZEJsb2NrSW5mby5jaGlsZFNoYWRvd0VsZW1lbnQgJiYgYmxvY2submV4dENvbm5lY3Rpb24pIHtcbiAgICAgIGJsb2NrLm5leHRDb25uZWN0aW9uLnNldFNoYWRvd0RvbShjaGlsZEJsb2NrSW5mby5jaGlsZFNoYWRvd0VsZW1lbnQpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIERlY29kZSBhbiBYTUwgYmxvY2sgdGFnIGFuZCBjcmVhdGUgYSBibG9jayAoYW5kIHBvc3NpYmx5IHN1YiBibG9ja3MpIG9uIHRoZVxuICogd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSB4bWxCbG9jayBYTUwgYmxvY2sgZWxlbWVudC5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZS5cbiAqIEBwYXJhbSBwYXJlbnRDb25uZWN0aW9uIFRoZSBwYXJlbnQgY29ubmVjdGlvbiB0byB0byBjb25uZWN0IHRoaXMgYmxvY2sgdG9cbiAqICAgICBhZnRlciBpbnN0YW50aWF0aW5nLlxuICogQHBhcmFtIGNvbm5lY3RlZFRvUGFyZW50TmV4dCBXaGV0aGVyIHRoZSBwcm92aWRlZCBwYXJlbnQgY29ubmVjdGlvbiBpcyBhIG5leHRcbiAqICAgICBjb25uZWN0aW9uLCByYXRoZXIgdGhhbiBvdXRwdXQgb3Igc3RhdGVtZW50LlxuICogQHJldHVybnMgVGhlIHJvb3QgYmxvY2sgY3JlYXRlZC5cbiAqL1xuZnVuY3Rpb24gZG9tVG9CbG9ja0hlYWRsZXNzKFxuICAgIHhtbEJsb2NrOiBFbGVtZW50LCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgcGFyZW50Q29ubmVjdGlvbj86IENvbm5lY3Rpb24sXG4gICAgY29ubmVjdGVkVG9QYXJlbnROZXh0PzogYm9vbGVhbik6IEJsb2NrIHtcbiAgbGV0IGJsb2NrID0gbnVsbDtcbiAgY29uc3QgcHJvdG90eXBlTmFtZSA9IHhtbEJsb2NrLmdldEF0dHJpYnV0ZSgndHlwZScpO1xuICBpZiAoIXByb3RvdHlwZU5hbWUpIHtcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ0Jsb2NrIHR5cGUgdW5zcGVjaWZpZWQ6ICcgKyB4bWxCbG9jay5vdXRlckhUTUwpO1xuICB9XG4gIGNvbnN0IGlkID0geG1sQmxvY2suZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ3N0cmluZyB8IG51bGwnIGlzIG5vdFxuICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcgfCB1bmRlZmluZWQnLlxuICBibG9jayA9IHdvcmtzcGFjZS5uZXdCbG9jayhwcm90b3R5cGVOYW1lLCBpZCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuXG4gIC8vIFByZXByb2Nlc3MgY2hpbGROb2RlcyBzbyB0YWdzIGNhbiBiZSBwcm9jZXNzZWQgaW4gYSBjb25zaXN0ZW50IG9yZGVyLlxuICBjb25zdCB4bWxDaGlsZE5hbWVNYXAgPSBtYXBTdXBwb3J0ZWRYbWxUYWdzKHhtbEJsb2NrKTtcblxuICBjb25zdCBzaG91bGRDYWxsSW5pdFN2ZyA9XG4gICAgICBhcHBseU11dGF0aW9uVGFnTm9kZXMoeG1sQ2hpbGROYW1lTWFwLm11dGF0aW9uLCBibG9jayk7XG4gIGFwcGx5Q29tbWVudFRhZ05vZGVzKHhtbENoaWxkTmFtZU1hcC5jb21tZW50LCBibG9jayk7XG4gIGFwcGx5RGF0YVRhZ05vZGVzKHhtbENoaWxkTmFtZU1hcC5kYXRhLCBibG9jayk7XG5cbiAgLy8gQ29ubmVjdCBwYXJlbnQgYWZ0ZXIgcHJvY2Vzc2luZyBtdXRhdGlvbiBhbmQgYmVmb3JlIHNldHRpbmcgZmllbGRzLlxuICBpZiAocGFyZW50Q29ubmVjdGlvbikge1xuICAgIGlmIChjb25uZWN0ZWRUb1BhcmVudE5leHQpIHtcbiAgICAgIGlmIChibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24pIHtcbiAgICAgICAgcGFyZW50Q29ubmVjdGlvbi5jb25uZWN0KGJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ05leHQgYmxvY2sgZG9lcyBub3QgaGF2ZSBwcmV2aW91cyBzdGF0ZW1lbnQuJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChibG9jay5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICAgIHBhcmVudENvbm5lY3Rpb24uY29ubmVjdChibG9jay5vdXRwdXRDb25uZWN0aW9uKTtcbiAgICAgIH0gZWxzZSBpZiAoYmxvY2sucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICAgIHBhcmVudENvbm5lY3Rpb24uY29ubmVjdChibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFxuICAgICAgICAgICAgJ0NoaWxkIGJsb2NrIGRvZXMgbm90IGhhdmUgb3V0cHV0IG9yIHByZXZpb3VzIHN0YXRlbWVudC4nKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhcHBseUZpZWxkVGFnTm9kZXMoeG1sQ2hpbGROYW1lTWFwLmZpZWxkLCBibG9jayk7XG4gIGFwcGx5SW5wdXRUYWdOb2Rlcyh4bWxDaGlsZE5hbWVNYXAuaW5wdXQsIHdvcmtzcGFjZSwgYmxvY2ssIHByb3RvdHlwZU5hbWUpO1xuICBhcHBseU5leHRUYWdOb2Rlcyh4bWxDaGlsZE5hbWVNYXAubmV4dCwgd29ya3NwYWNlLCBibG9jayk7XG5cbiAgaWYgKHNob3VsZENhbGxJbml0U3ZnKSB7XG4gICAgLy8gVGhpcyBzaG91bGRuJ3QgZXZlbiBiZSBjYWxsZWQgaGVyZVxuICAgIC8vIChyZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvYmxvY2tseS9wdWxsLzQyOTYjaXNzdWVjb21tZW50LTg4NDIyNjAyMVxuICAgIC8vIEJ1dCB0aGUgWE1MIHNlcmlhbGl6ZXIvZGVzZXJpYWxpemVyIGlzIGljZWJveGVkIHNvIEknbSBub3QgZ29pbmcgdG8gZml4XG4gICAgLy8gaXQuXG4gICAgKGJsb2NrIGFzIEJsb2NrU3ZnKS5pbml0U3ZnKCk7XG4gIH1cblxuICBjb25zdCBpbmxpbmUgPSB4bWxCbG9jay5nZXRBdHRyaWJ1dGUoJ2lubGluZScpO1xuICBpZiAoaW5saW5lKSB7XG4gICAgYmxvY2suc2V0SW5wdXRzSW5saW5lKGlubGluZSA9PT0gJ3RydWUnKTtcbiAgfVxuICBjb25zdCBkaXNhYmxlZCA9IHhtbEJsb2NrLmdldEF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgaWYgKGRpc2FibGVkKSB7XG4gICAgYmxvY2suc2V0RW5hYmxlZChkaXNhYmxlZCAhPT0gJ3RydWUnICYmIGRpc2FibGVkICE9PSAnZGlzYWJsZWQnKTtcbiAgfVxuICBjb25zdCBkZWxldGFibGUgPSB4bWxCbG9jay5nZXRBdHRyaWJ1dGUoJ2RlbGV0YWJsZScpO1xuICBpZiAoZGVsZXRhYmxlKSB7XG4gICAgYmxvY2suc2V0RGVsZXRhYmxlKGRlbGV0YWJsZSA9PT0gJ3RydWUnKTtcbiAgfVxuICBjb25zdCBtb3ZhYmxlID0geG1sQmxvY2suZ2V0QXR0cmlidXRlKCdtb3ZhYmxlJyk7XG4gIGlmIChtb3ZhYmxlKSB7XG4gICAgYmxvY2suc2V0TW92YWJsZShtb3ZhYmxlID09PSAndHJ1ZScpO1xuICB9XG4gIGNvbnN0IGVkaXRhYmxlID0geG1sQmxvY2suZ2V0QXR0cmlidXRlKCdlZGl0YWJsZScpO1xuICBpZiAoZWRpdGFibGUpIHtcbiAgICBibG9jay5zZXRFZGl0YWJsZShlZGl0YWJsZSA9PT0gJ3RydWUnKTtcbiAgfVxuICBjb25zdCBjb2xsYXBzZWQgPSB4bWxCbG9jay5nZXRBdHRyaWJ1dGUoJ2NvbGxhcHNlZCcpO1xuICBpZiAoY29sbGFwc2VkKSB7XG4gICAgYmxvY2suc2V0Q29sbGFwc2VkKGNvbGxhcHNlZCA9PT0gJ3RydWUnKTtcbiAgfVxuICBpZiAoeG1sQmxvY2subm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NoYWRvdycpIHtcbiAgICAvLyBFbnN1cmUgYWxsIGNoaWxkcmVuIGFyZSBhbHNvIHNoYWRvd3MuXG4gICAgY29uc3QgY2hpbGRyZW4gPSBibG9jay5nZXRDaGlsZHJlbihmYWxzZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTtcbiAgICAgIGlmICghY2hpbGQuaXNTaGFkb3coKSkge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ1NoYWRvdyBibG9jayBub3QgYWxsb3dlZCBub24tc2hhZG93IGNoaWxkLicpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBFbnN1cmUgdGhpcyBibG9jayBkb2Vzbid0IGhhdmUgYW55IHZhcmlhYmxlIGlucHV0cy5cbiAgICBpZiAoYmxvY2suZ2V0VmFyTW9kZWxzKCkubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ1NoYWRvdyBibG9ja3MgY2Fubm90IGhhdmUgdmFyaWFibGUgcmVmZXJlbmNlcy4nKTtcbiAgICB9XG4gICAgYmxvY2suc2V0U2hhZG93KHRydWUpO1xuICB9XG4gIHJldHVybiBibG9jaztcbn1cblxuLyoqXG4gKiBEZWNvZGUgYW4gWE1MIGZpZWxkIHRhZyBhbmQgc2V0IHRoZSB2YWx1ZSBvZiB0aGF0IGZpZWxkIG9uIHRoZSBnaXZlbiBibG9jay5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRoYXQgaXMgY3VycmVudGx5IGJlaW5nIGRlc2VyaWFsaXplZC5cbiAqIEBwYXJhbSBmaWVsZE5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpZWxkIG9uIHRoZSBibG9jay5cbiAqIEBwYXJhbSB4bWwgVGhlIGZpZWxkIHRhZyB0byBkZWNvZGUuXG4gKi9cbmZ1bmN0aW9uIGRvbVRvRmllbGQoYmxvY2s6IEJsb2NrLCBmaWVsZE5hbWU6IHN0cmluZywgeG1sOiBFbGVtZW50KSB7XG4gIGNvbnN0IGZpZWxkID0gYmxvY2suZ2V0RmllbGQoZmllbGROYW1lKTtcbiAgaWYgKCFmaWVsZCkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ0lnbm9yaW5nIG5vbi1leGlzdGVudCBmaWVsZCAnICsgZmllbGROYW1lICsgJyBpbiBibG9jayAnICsgYmxvY2sudHlwZSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZpZWxkLmZyb21YbWwoeG1sKTtcbn1cblxuLyoqXG4gKiBSZW1vdmUgYW55ICduZXh0JyBibG9jayAoc3RhdGVtZW50cyBpbiBhIHN0YWNrKS5cbiAqXG4gKiBAcGFyYW0geG1sQmxvY2sgWE1MIGJsb2NrIGVsZW1lbnQgb3IgYW4gZW1wdHkgRG9jdW1lbnRGcmFnbWVudCBpZiB0aGUgYmxvY2tcbiAqICAgICB3YXMgYW4gaW5zZXJ0aW9uIG1hcmtlci5cbiAqIEBhbGlhcyBCbG9ja2x5LlhtbC5kZWxldGVOZXh0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVOZXh0KHhtbEJsb2NrOiBFbGVtZW50fERvY3VtZW50RnJhZ21lbnQpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB4bWxCbG9jay5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hpbGQgPSB4bWxCbG9jay5jaGlsZE5vZGVzW2ldO1xuICAgIGlmIChjaGlsZC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnbmV4dCcpIHtcbiAgICAgIHhtbEJsb2NrLnJlbW92ZUNoaWxkKGNoaWxkKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3Igc3RyaW5nIG1hbmlwdWxhdGlvbi5cbiAqIFRoZXNlIG1ldGhvZHMgYXJlIG5vdCBzcGVjaWZpYyB0byBCbG9ja2x5LCBhbmQgY291bGQgYmUgZmFjdG9yZWQgb3V0IGludG9cbiAqIGEgSmF2YVNjcmlwdCBmcmFtZXdvcmsgc3VjaCBhcyBDbG9zdXJlLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS51dGlscy5zdHJpbmdcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5zdHJpbmcnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi9kZXByZWNhdGlvbi5qcyc7XG5cblxuLyoqXG4gKiBGYXN0IHByZWZpeC1jaGVja2VyLlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuc3RyaW5nLnN0YXJ0c1dpdGguXG4gKlxuICogQHBhcmFtIHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHBhcmFtIHByZWZpeCBBIHN0cmluZyB0byBsb29rIGZvciBhdCB0aGUgc3RhcnQgb2YgYHN0cmAuXG4gKiBAcmV0dXJucyBUcnVlIGlmIGBzdHJgIGJlZ2lucyB3aXRoIGBwcmVmaXhgLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3RyaW5nLnN0YXJ0c1dpdGhcbiAqIEBkZXByZWNhdGVkIFVzZSBidWlsdC1pbiAqKnN0cmluZy5zdGFydHNXaXRoKiogaW5zdGVhZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyOiBzdHJpbmcsIHByZWZpeDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS51dGlscy5zdHJpbmcuc3RhcnRzV2l0aCgpJywgJ0FwcmlsIDIwMjInLCAnQXByaWwgMjAyMycsXG4gICAgICAnVXNlIGJ1aWx0LWluIHN0cmluZy5zdGFydHNXaXRoJyk7XG4gIHJldHVybiBzdHIuc3RhcnRzV2l0aChwcmVmaXgpO1xufVxuXG4vKipcbiAqIEdpdmVuIGFuIGFycmF5IG9mIHN0cmluZ3MsIHJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBzaG9ydGVzdCBvbmUuXG4gKlxuICogQHBhcmFtIGFycmF5IEFycmF5IG9mIHN0cmluZ3MuXG4gKiBAcmV0dXJucyBMZW5ndGggb2Ygc2hvcnRlc3Qgc3RyaW5nLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3RyaW5nLnNob3J0ZXN0U3RyaW5nTGVuZ3RoXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG9ydGVzdFN0cmluZ0xlbmd0aChhcnJheTogc3RyaW5nW10pOiBudW1iZXIge1xuICBpZiAoIWFycmF5Lmxlbmd0aCkge1xuICAgIHJldHVybiAwO1xuICB9XG4gIHJldHVybiBhcnJheVxuICAgICAgLnJlZHVjZShmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHJldHVybiBhLmxlbmd0aCA8IGIubGVuZ3RoID8gYSA6IGI7XG4gICAgICB9KVxuICAgICAgLmxlbmd0aDtcbn1cblxuLyoqXG4gKiBHaXZlbiBhbiBhcnJheSBvZiBzdHJpbmdzLCByZXR1cm4gdGhlIGxlbmd0aCBvZiB0aGUgY29tbW9uIHByZWZpeC5cbiAqIFdvcmRzIG1heSBub3QgYmUgc3BsaXQuICBBbnkgc3BhY2UgYWZ0ZXIgYSB3b3JkIGlzIGluY2x1ZGVkIGluIHRoZSBsZW5ndGguXG4gKlxuICogQHBhcmFtIGFycmF5IEFycmF5IG9mIHN0cmluZ3MuXG4gKiBAcGFyYW0gb3B0X3Nob3J0ZXN0IExlbmd0aCBvZiBzaG9ydGVzdCBzdHJpbmcuXG4gKiBAcmV0dXJucyBMZW5ndGggb2YgY29tbW9uIHByZWZpeC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0cmluZy5jb21tb25Xb3JkUHJlZml4XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21tb25Xb3JkUHJlZml4KFxuICAgIGFycmF5OiBzdHJpbmdbXSwgb3B0X3Nob3J0ZXN0PzogbnVtYmVyKTogbnVtYmVyIHtcbiAgaWYgKCFhcnJheS5sZW5ndGgpIHtcbiAgICByZXR1cm4gMDtcbiAgfSBlbHNlIGlmIChhcnJheS5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gYXJyYXlbMF0ubGVuZ3RoO1xuICB9XG4gIGxldCB3b3JkUHJlZml4ID0gMDtcbiAgY29uc3QgbWF4ID0gb3B0X3Nob3J0ZXN0IHx8IHNob3J0ZXN0U3RyaW5nTGVuZ3RoKGFycmF5KTtcbiAgbGV0IGxlbjtcbiAgZm9yIChsZW4gPSAwOyBsZW4gPCBtYXg7IGxlbisrKSB7XG4gICAgY29uc3QgbGV0dGVyID0gYXJyYXlbMF1bbGVuXTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAobGV0dGVyICE9PSBhcnJheVtpXVtsZW5dKSB7XG4gICAgICAgIHJldHVybiB3b3JkUHJlZml4O1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAobGV0dGVyID09PSAnICcpIHtcbiAgICAgIHdvcmRQcmVmaXggPSBsZW4gKyAxO1xuICAgIH1cbiAgfVxuICBmb3IgKGxldCBpID0gMTsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgbGV0dGVyID0gYXJyYXlbaV1bbGVuXTtcbiAgICBpZiAobGV0dGVyICYmIGxldHRlciAhPT0gJyAnKSB7XG4gICAgICByZXR1cm4gd29yZFByZWZpeDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1heDtcbn1cblxuLyoqXG4gKiBHaXZlbiBhbiBhcnJheSBvZiBzdHJpbmdzLCByZXR1cm4gdGhlIGxlbmd0aCBvZiB0aGUgY29tbW9uIHN1ZmZpeC5cbiAqIFdvcmRzIG1heSBub3QgYmUgc3BsaXQuICBBbnkgc3BhY2UgYWZ0ZXIgYSB3b3JkIGlzIGluY2x1ZGVkIGluIHRoZSBsZW5ndGguXG4gKlxuICogQHBhcmFtIGFycmF5IEFycmF5IG9mIHN0cmluZ3MuXG4gKiBAcGFyYW0gb3B0X3Nob3J0ZXN0IExlbmd0aCBvZiBzaG9ydGVzdCBzdHJpbmcuXG4gKiBAcmV0dXJucyBMZW5ndGggb2YgY29tbW9uIHN1ZmZpeC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0cmluZy5jb21tb25Xb3JkU3VmZml4XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21tb25Xb3JkU3VmZml4KFxuICAgIGFycmF5OiBzdHJpbmdbXSwgb3B0X3Nob3J0ZXN0PzogbnVtYmVyKTogbnVtYmVyIHtcbiAgaWYgKCFhcnJheS5sZW5ndGgpIHtcbiAgICByZXR1cm4gMDtcbiAgfSBlbHNlIGlmIChhcnJheS5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gYXJyYXlbMF0ubGVuZ3RoO1xuICB9XG4gIGxldCB3b3JkUHJlZml4ID0gMDtcbiAgY29uc3QgbWF4ID0gb3B0X3Nob3J0ZXN0IHx8IHNob3J0ZXN0U3RyaW5nTGVuZ3RoKGFycmF5KTtcbiAgbGV0IGxlbjtcbiAgZm9yIChsZW4gPSAwOyBsZW4gPCBtYXg7IGxlbisrKSB7XG4gICAgY29uc3QgbGV0dGVyID0gYXJyYXlbMF0uc3Vic3RyKC1sZW4gLSAxLCAxKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAobGV0dGVyICE9PSBhcnJheVtpXS5zdWJzdHIoLWxlbiAtIDEsIDEpKSB7XG4gICAgICAgIHJldHVybiB3b3JkUHJlZml4O1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAobGV0dGVyID09PSAnICcpIHtcbiAgICAgIHdvcmRQcmVmaXggPSBsZW4gKyAxO1xuICAgIH1cbiAgfVxuICBmb3IgKGxldCBpID0gMTsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgbGV0dGVyID0gYXJyYXlbaV0uY2hhckF0KGFycmF5W2ldLmxlbmd0aCAtIGxlbiAtIDEpO1xuICAgIGlmIChsZXR0ZXIgJiYgbGV0dGVyICE9PSAnICcpIHtcbiAgICAgIHJldHVybiB3b3JkUHJlZml4O1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWF4O1xufVxuXG4vKipcbiAqIFdyYXAgdGV4dCB0byB0aGUgc3BlY2lmaWVkIHdpZHRoLlxuICpcbiAqIEBwYXJhbSB0ZXh0IFRleHQgdG8gd3JhcC5cbiAqIEBwYXJhbSBsaW1pdCBXaWR0aCB0byB3cmFwIGVhY2ggbGluZS5cbiAqIEByZXR1cm5zIFdyYXBwZWQgdGV4dC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN0cmluZy53cmFwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3cmFwKHRleHQ6IHN0cmluZywgbGltaXQ6IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgnXFxuJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICBsaW5lc1tpXSA9IHdyYXBMaW5lKGxpbmVzW2ldLCBsaW1pdCk7XG4gIH1cbiAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xufVxuXG4vKipcbiAqIFdyYXAgc2luZ2xlIGxpbmUgb2YgdGV4dCB0byB0aGUgc3BlY2lmaWVkIHdpZHRoLlxuICpcbiAqIEBwYXJhbSB0ZXh0IFRleHQgdG8gd3JhcC5cbiAqIEBwYXJhbSBsaW1pdCBXaWR0aCB0byB3cmFwIGVhY2ggbGluZS5cbiAqIEByZXR1cm5zIFdyYXBwZWQgdGV4dC5cbiAqL1xuZnVuY3Rpb24gd3JhcExpbmUodGV4dDogc3RyaW5nLCBsaW1pdDogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKHRleHQubGVuZ3RoIDw9IGxpbWl0KSB7XG4gICAgLy8gU2hvcnQgdGV4dCwgbm8gbmVlZCB0byB3cmFwLlxuICAgIHJldHVybiB0ZXh0O1xuICB9XG4gIC8vIFNwbGl0IHRoZSB0ZXh0IGludG8gd29yZHMuXG4gIGNvbnN0IHdvcmRzID0gdGV4dC50cmltKCkuc3BsaXQoL1xccysvKTtcbiAgLy8gU2V0IGxpbWl0IHRvIGJlIHRoZSBsZW5ndGggb2YgdGhlIGxhcmdlc3Qgd29yZC5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgIGlmICh3b3Jkc1tpXS5sZW5ndGggPiBsaW1pdCkge1xuICAgICAgbGltaXQgPSB3b3Jkc1tpXS5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgbGV0IGxhc3RTY29yZTtcbiAgbGV0IHNjb3JlID0gLUluZmluaXR5O1xuICBsZXQgbGFzdFRleHQ7XG4gIGxldCBsaW5lQ291bnQgPSAxO1xuICBkbyB7XG4gICAgbGFzdFNjb3JlID0gc2NvcmU7XG4gICAgbGFzdFRleHQgPSB0ZXh0O1xuICAgIC8vIENyZWF0ZSBhIGxpc3Qgb2YgYm9vbGVhbnMgcmVwcmVzZW50aW5nIGlmIGEgc3BhY2UgKGZhbHNlKSBvclxuICAgIC8vIGEgYnJlYWsgKHRydWUpIGFwcGVhcnMgYWZ0ZXIgZWFjaCB3b3JkLlxuICAgIGxldCB3b3JkQnJlYWtzID0gW107XG4gICAgLy8gU2VlZCB0aGUgbGlzdCB3aXRoIGV2ZW5seSBzcGFjZWQgbGluZWJyZWFrcy5cbiAgICBjb25zdCBzdGVwcyA9IHdvcmRzLmxlbmd0aCAvIGxpbmVDb3VudDtcbiAgICBsZXQgaW5zZXJ0ZWRCcmVha3MgPSAxO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICBpZiAoaW5zZXJ0ZWRCcmVha3MgPCAoaSArIDEuNSkgLyBzdGVwcykge1xuICAgICAgICBpbnNlcnRlZEJyZWFrcysrO1xuICAgICAgICB3b3JkQnJlYWtzW2ldID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdvcmRCcmVha3NbaV0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgd29yZEJyZWFrcyA9IHdyYXBNdXRhdGUod29yZHMsIHdvcmRCcmVha3MsIGxpbWl0KTtcbiAgICBzY29yZSA9IHdyYXBTY29yZSh3b3Jkcywgd29yZEJyZWFrcywgbGltaXQpO1xuICAgIHRleHQgPSB3cmFwVG9UZXh0KHdvcmRzLCB3b3JkQnJlYWtzKTtcbiAgICBsaW5lQ291bnQrKztcbiAgfSB3aGlsZSAoc2NvcmUgPiBsYXN0U2NvcmUpO1xuICByZXR1cm4gbGFzdFRleHQ7XG59XG5cbi8qKlxuICogQ29tcHV0ZSBhIHNjb3JlIGZvciBob3cgZ29vZCB0aGUgd3JhcHBpbmcgaXMuXG4gKlxuICogQHBhcmFtIHdvcmRzIEFycmF5IG9mIGVhY2ggd29yZC5cbiAqIEBwYXJhbSB3b3JkQnJlYWtzIEFycmF5IG9mIGxpbmUgYnJlYWtzLlxuICogQHBhcmFtIGxpbWl0IFdpZHRoIHRvIHdyYXAgZWFjaCBsaW5lLlxuICogQHJldHVybnMgTGFyZ2VyIHRoZSBiZXR0ZXIuXG4gKi9cbmZ1bmN0aW9uIHdyYXBTY29yZShcbiAgICB3b3Jkczogc3RyaW5nW10sIHdvcmRCcmVha3M6IGJvb2xlYW5bXSwgbGltaXQ6IG51bWJlcik6IG51bWJlciB7XG4gIC8vIElmIHRoaXMgZnVuY3Rpb24gYmVjb21lcyBhIHBlcmZvcm1hbmNlIGxpYWJpbGl0eSwgYWRkIGNhY2hpbmcuXG4gIC8vIENvbXB1dGUgdGhlIGxlbmd0aCBvZiBlYWNoIGxpbmUuXG4gIGNvbnN0IGxpbmVMZW5ndGhzID0gWzBdO1xuICBjb25zdCBsaW5lUHVuY3R1YXRpb24gPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgIGxpbmVMZW5ndGhzW2xpbmVMZW5ndGhzLmxlbmd0aCAtIDFdICs9IHdvcmRzW2ldLmxlbmd0aDtcbiAgICBpZiAod29yZEJyZWFrc1tpXSA9PT0gdHJ1ZSkge1xuICAgICAgbGluZUxlbmd0aHMucHVzaCgwKTtcbiAgICAgIGxpbmVQdW5jdHVhdGlvbi5wdXNoKHdvcmRzW2ldLmNoYXJBdCh3b3Jkc1tpXS5sZW5ndGggLSAxKSk7XG4gICAgfSBlbHNlIGlmICh3b3JkQnJlYWtzW2ldID09PSBmYWxzZSkge1xuICAgICAgbGluZUxlbmd0aHNbbGluZUxlbmd0aHMubGVuZ3RoIC0gMV0rKztcbiAgICB9XG4gIH1cbiAgY29uc3QgbWF4TGVuZ3RoID0gTWF0aC5tYXgoLi4ubGluZUxlbmd0aHMpO1xuXG4gIGxldCBzY29yZSA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZUxlbmd0aHMubGVuZ3RoOyBpKyspIHtcbiAgICAvLyBPcHRpbWl6ZSBmb3Igd2lkdGguXG4gICAgLy8gLTIgcG9pbnRzIHBlciBjaGFyIG92ZXIgbGltaXQgKHNjYWxlZCB0byB0aGUgcG93ZXIgb2YgMS41KS5cbiAgICBzY29yZSAtPSBNYXRoLnBvdyhNYXRoLmFicyhsaW1pdCAtIGxpbmVMZW5ndGhzW2ldKSwgMS41KSAqIDI7XG4gICAgLy8gT3B0aW1pemUgZm9yIGV2ZW4gbGluZXMuXG4gICAgLy8gLTEgcG9pbnQgcGVyIGNoYXIgc21hbGxlciB0aGFuIG1heCAoc2NhbGVkIHRvIHRoZSBwb3dlciBvZiAxLjUpLlxuICAgIHNjb3JlIC09IE1hdGgucG93KG1heExlbmd0aCAtIGxpbmVMZW5ndGhzW2ldLCAxLjUpO1xuICAgIC8vIE9wdGltaXplIGZvciBzdHJ1Y3R1cmUuXG4gICAgLy8gQWRkIHNjb3JlIHRvIGxpbmUgZW5kaW5ncyBhZnRlciBwdW5jdHVhdGlvbi5cbiAgICBpZiAoJy4/IScuaW5kZXhPZihsaW5lUHVuY3R1YXRpb25baV0pICE9PSAtMSkge1xuICAgICAgc2NvcmUgKz0gbGltaXQgLyAzO1xuICAgIH0gZWxzZSBpZiAoJyw7KV19Jy5pbmRleE9mKGxpbmVQdW5jdHVhdGlvbltpXSkgIT09IC0xKSB7XG4gICAgICBzY29yZSArPSBsaW1pdCAvIDQ7XG4gICAgfVxuICB9XG4gIC8vIEFsbCBlbHNlIGJlaW5nIGVxdWFsLCB0aGUgbGFzdCBsaW5lIHNob3VsZCBub3QgYmUgbG9uZ2VyIHRoYW4gdGhlXG4gIC8vIHByZXZpb3VzIGxpbmUuICBGb3IgZXhhbXBsZSwgdGhpcyBsb29rcyB3cm9uZzpcbiAgLy8gYWFhIGJiYlxuICAvLyBjY2MgZGRkIGVlZVxuICBpZiAobGluZUxlbmd0aHMubGVuZ3RoID4gMSAmJlxuICAgICAgbGluZUxlbmd0aHNbbGluZUxlbmd0aHMubGVuZ3RoIC0gMV0gPD1cbiAgICAgICAgICBsaW5lTGVuZ3Roc1tsaW5lTGVuZ3Rocy5sZW5ndGggLSAyXSkge1xuICAgIHNjb3JlICs9IDAuNTtcbiAgfVxuICByZXR1cm4gc2NvcmU7XG59XG4vKipcbiAqIE11dGF0ZSB0aGUgYXJyYXkgb2YgbGluZSBicmVhayBsb2NhdGlvbnMgdW50aWwgYW4gb3B0aW1hbCBzb2x1dGlvbiBpcyBmb3VuZC5cbiAqIE5vIGxpbmUgYnJlYWtzIGFyZSBhZGRlZCBvciBkZWxldGVkLCB0aGV5IGFyZSBzaW1wbHkgbW92ZWQgYXJvdW5kLlxuICpcbiAqIEBwYXJhbSB3b3JkcyBBcnJheSBvZiBlYWNoIHdvcmQuXG4gKiBAcGFyYW0gd29yZEJyZWFrcyBBcnJheSBvZiBsaW5lIGJyZWFrcy5cbiAqIEBwYXJhbSBsaW1pdCBXaWR0aCB0byB3cmFwIGVhY2ggbGluZS5cbiAqIEByZXR1cm5zIE5ldyBhcnJheSBvZiBvcHRpbWFsIGxpbmUgYnJlYWtzLlxuICovXG5mdW5jdGlvbiB3cmFwTXV0YXRlKFxuICAgIHdvcmRzOiBzdHJpbmdbXSwgd29yZEJyZWFrczogYm9vbGVhbltdLCBsaW1pdDogbnVtYmVyKTogYm9vbGVhbltdIHtcbiAgbGV0IGJlc3RTY29yZSA9IHdyYXBTY29yZSh3b3Jkcywgd29yZEJyZWFrcywgbGltaXQpO1xuICBsZXQgYmVzdEJyZWFrcztcbiAgLy8gVHJ5IHNoaWZ0aW5nIGV2ZXJ5IGxpbmUgYnJlYWsgZm9yd2FyZCBvciBiYWNrd2FyZC5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JkQnJlYWtzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIGlmICh3b3JkQnJlYWtzW2ldID09PSB3b3JkQnJlYWtzW2kgKyAxXSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IG11dGF0ZWRXb3JkQnJlYWtzID0gKG5ldyBBcnJheTxib29sZWFuPigpKS5jb25jYXQod29yZEJyZWFrcyk7XG4gICAgbXV0YXRlZFdvcmRCcmVha3NbaV0gPSAhbXV0YXRlZFdvcmRCcmVha3NbaV07XG4gICAgbXV0YXRlZFdvcmRCcmVha3NbaSArIDFdID0gIW11dGF0ZWRXb3JkQnJlYWtzW2kgKyAxXTtcbiAgICBjb25zdCBtdXRhdGVkU2NvcmUgPSB3cmFwU2NvcmUod29yZHMsIG11dGF0ZWRXb3JkQnJlYWtzLCBsaW1pdCk7XG4gICAgaWYgKG11dGF0ZWRTY29yZSA+IGJlc3RTY29yZSkge1xuICAgICAgYmVzdFNjb3JlID0gbXV0YXRlZFNjb3JlO1xuICAgICAgYmVzdEJyZWFrcyA9IG11dGF0ZWRXb3JkQnJlYWtzO1xuICAgIH1cbiAgfVxuICBpZiAoYmVzdEJyZWFrcykge1xuICAgIC8vIEZvdW5kIGFuIGltcHJvdmVtZW50LiAgU2VlIGlmIGl0IG1heSBiZSBpbXByb3ZlZCBmdXJ0aGVyLlxuICAgIHJldHVybiB3cmFwTXV0YXRlKHdvcmRzLCBiZXN0QnJlYWtzLCBsaW1pdCk7XG4gIH1cbiAgLy8gTm8gaW1wcm92ZW1lbnRzIGZvdW5kLiAgRG9uZS5cbiAgcmV0dXJuIHdvcmRCcmVha3M7XG59XG5cbi8qKlxuICogUmVhc3NlbWJsZSB0aGUgYXJyYXkgb2Ygd29yZHMgaW50byB0ZXh0LCB3aXRoIHRoZSBzcGVjaWZpZWQgbGluZSBicmVha3MuXG4gKlxuICogQHBhcmFtIHdvcmRzIEFycmF5IG9mIGVhY2ggd29yZC5cbiAqIEBwYXJhbSB3b3JkQnJlYWtzIEFycmF5IG9mIGxpbmUgYnJlYWtzLlxuICogQHJldHVybnMgUGxhaW4gdGV4dC5cbiAqL1xuZnVuY3Rpb24gd3JhcFRvVGV4dCh3b3Jkczogc3RyaW5nW10sIHdvcmRCcmVha3M6IGJvb2xlYW5bXSk6IHN0cmluZyB7XG4gIGNvbnN0IHRleHQgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgIHRleHQucHVzaCh3b3Jkc1tpXSk7XG4gICAgaWYgKHdvcmRCcmVha3NbaV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGV4dC5wdXNoKHdvcmRCcmVha3NbaV0gPyAnXFxuJyA6ICcgJyk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0ZXh0LmpvaW4oJycpO1xufVxuXG4vKipcbiAqIElzIHRoZSBnaXZlbiBzdHJpbmcgYSBudW1iZXIgKGluY2x1ZGVzIG5lZ2F0aXZlIGFuZCBkZWNpbWFscykuXG4gKlxuICogQHBhcmFtIHN0ciBJbnB1dCBzdHJpbmcuXG4gKiBAcmV0dXJucyBUcnVlIGlmIG51bWJlciwgZmFsc2Ugb3RoZXJ3aXNlLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3RyaW5nLmlzTnVtYmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcihzdHI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gL15cXHMqLT9cXGQrKFxcLlxcZCspP1xccyokLy50ZXN0KHN0cik7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTGlicmFyeSB0byBjcmVhdGUgdG9vbHRpcHMgZm9yIEJsb2NrbHkuXG4gKiBGaXJzdCwgY2FsbCBjcmVhdGVEb20oKSBhZnRlciBvbmxvYWQuXG4gKiBTZWNvbmQsIHNldCB0aGUgJ3Rvb2x0aXAnIHByb3BlcnR5IG9uIGFueSBTVkcgZWxlbWVudCB0aGF0IG5lZWRzIGEgdG9vbHRpcC5cbiAqIElmIHRoZSB0b29sdGlwIGlzIGEgc3RyaW5nLCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIHN0cmluZywgdGhhdCBtZXNzYWdlXG4gKiB3aWxsIGJlIGRpc3BsYXllZC4gSWYgdGhlIHRvb2x0aXAgaXMgYW4gU1ZHIGVsZW1lbnQsIHRoZW4gdGhhdCBvYmplY3Qnc1xuICogdG9vbHRpcCB3aWxsIGJlIHVzZWQuIFRoaXJkLCBjYWxsIGJpbmRNb3VzZUV2ZW50cyhlKSBwYXNzaW5nIHRoZSBTVkcgZWxlbWVudC5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuVG9vbHRpcFxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRvb2x0aXAnKTtcblxuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja2x5U3RyaW5nIGZyb20gJy4vdXRpbHMvc3RyaW5nLmpzJztcblxuXG4vKipcbiAqIEEgdHlwZSB3aGljaCBjYW4gZGVmaW5lIGEgdG9vbHRpcC5cbiAqIEVpdGhlciBhIHN0cmluZywgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYSB0b29sdGlwIHByb3BlcnR5LCBvciBhIGZ1bmN0aW9uIHdoaWNoXG4gKiByZXR1cm5zIGVpdGhlciBhIHN0cmluZywgb3IgYW5vdGhlciBhcmJpdHJhcmlseSBuZXN0ZWQgZnVuY3Rpb24gd2hpY2hcbiAqIGV2ZW50dWFsbHkgdW53aW5kcyB0byBhIHN0cmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sdGlwLlRpcEluZm9cbiAqL1xuZXhwb3J0IHR5cGUgVGlwSW5mbyA9XG4gICAgc3RyaW5nfHt0b29sdGlwOiBBbnlEdXJpbmdNaWdyYXRpb259fCgoKSA9PiBUaXBJbmZvfHN0cmluZ3xGdW5jdGlvbik7XG5cbi8qKlxuICogQSBmdW5jdGlvbiB0aGF0IHJlbmRlcnMgY3VzdG9tIHRvb2x0aXAgVUkuXG4gKiAxc3QgcGFyYW1ldGVyOiB0aGUgZGl2IGVsZW1lbnQgdG8gcmVuZGVyIGNvbnRlbnQgaW50by5cbiAqIDJuZCBwYXJhbWV0ZXI6IHRoZSBlbGVtZW50IGJlaW5nIG1vdXNlZCBvdmVyIChpLmUuLCB0aGUgZWxlbWVudCBmb3Igd2hpY2ggdGhlXG4gKiB0b29sdGlwIHNob3VsZCBiZSBzaG93bikuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVG9vbHRpcC5DdXN0b21Ub29sdGlwXG4gKi9cbmV4cG9ydCB0eXBlIEN1c3RvbVRvb2x0aXAgPSAocDE6IEVsZW1lbnQsIHAyOiBFbGVtZW50KSA9PiBBbnlEdXJpbmdNaWdyYXRpb247XG5cbi8qKlxuICogQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCByZW5kZXJzIGN1c3RvbSB0b29sdGlwcyBpbnRvIHRoZSBwcm92aWRlZCBESVYuIElmXG4gKiB0aGlzIGlzIGRlZmluZWQsIHRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBpbnN0ZWFkIG9mIHJlbmRlcmluZyB0aGUgZGVmYXVsdFxuICogdG9vbHRpcCBVSS5cbiAqL1xubGV0IGN1c3RvbVRvb2x0aXA6IEN1c3RvbVRvb2x0aXB8dW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuXG4vKipcbiAqIFNldHMgYSBjdXN0b20gZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBpZiBwcmVzZW50IGluc3RlYWQgb2YgdGhlIGRlZmF1bHRcbiAqIHRvb2x0aXAgVUkuXG4gKlxuICogQHBhcmFtIGN1c3RvbUZuIEEgY3VzdG9tIHRvb2x0aXAgdXNlZCB0byByZW5kZXIgYW4gYWx0ZXJuYXRlIHRvb2x0aXAgVUkuXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sdGlwLnNldEN1c3RvbVRvb2x0aXBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEN1c3RvbVRvb2x0aXAoY3VzdG9tRm46IEN1c3RvbVRvb2x0aXApIHtcbiAgY3VzdG9tVG9vbHRpcCA9IGN1c3RvbUZuO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIGN1c3RvbSB0b29sdGlwIGZ1bmN0aW9uLlxuICpcbiAqIEByZXR1cm5zIFRoZSBjdXN0b20gdG9vbHRpcCBmdW5jdGlvbiwgaWYgZGVmaW5lZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1c3RvbVRvb2x0aXAoKTogQ3VzdG9tVG9vbHRpcHx1bmRlZmluZWQge1xuICByZXR1cm4gY3VzdG9tVG9vbHRpcDtcbn1cblxuLyoqIElzIGEgdG9vbHRpcCBjdXJyZW50bHkgc2hvd2luZz8gKi9cbmxldCB2aXNpYmxlID0gZmFsc2U7XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCBhIHRvb2x0aXAgaXMgc2hvd2luZ1xuICpcbiAqIEByZXR1cm5zIFRydWUgaWYgYSB0b29sdGlwIGlzIHNob3dpbmdcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuaXNWaXNpYmxlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1Zpc2libGUoKTogYm9vbGVhbiB7XG4gIHJldHVybiB2aXNpYmxlO1xufVxuXG4vKiogSXMgc29tZW9uZSBlbHNlIGJsb2NraW5nIHRoZSB0b29sdGlwIGZyb20gYmVpbmcgc2hvd24/ICovXG5sZXQgYmxvY2tlZCA9IGZhbHNlO1xuXG4vKipcbiAqIE1heGltdW0gd2lkdGggKGluIGNoYXJhY3RlcnMpIG9mIGEgdG9vbHRpcC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sdGlwLkxJTUlUXG4gKi9cbmV4cG9ydCBjb25zdCBMSU1JVCA9IDUwO1xuXG4vKiogUElEIG9mIHN1c3BlbmRlZCB0aHJlYWQgdG8gY2xlYXIgdG9vbHRpcCBvbiBtb3VzZSBvdXQuICovXG5sZXQgbW91c2VPdXRQaWQ6IEFueUR1cmluZ01pZ3JhdGlvbiA9IDA7XG5cbi8qKiBQSUQgb2Ygc3VzcGVuZGVkIHRocmVhZCB0byBzaG93IHRoZSB0b29sdGlwLiAqL1xubGV0IHNob3dQaWQ6IEFueUR1cmluZ01pZ3JhdGlvbiA9IDA7XG5cbi8qKlxuICogTGFzdCBvYnNlcnZlZCBYIGxvY2F0aW9uIG9mIHRoZSBtb3VzZSBwb2ludGVyIChmcmVlemVzIHdoZW4gdG9vbHRpcCBhcHBlYXJzKS5cbiAqL1xubGV0IGxhc3RYID0gMDtcblxuLyoqXG4gKiBMYXN0IG9ic2VydmVkIFkgbG9jYXRpb24gb2YgdGhlIG1vdXNlIHBvaW50ZXIgKGZyZWV6ZXMgd2hlbiB0b29sdGlwIGFwcGVhcnMpLlxuICovXG5sZXQgbGFzdFkgPSAwO1xuXG4vKiogQ3VycmVudCBlbGVtZW50IGJlaW5nIHBvaW50ZWQgYXQuICovXG5sZXQgZWxlbWVudDogQW55RHVyaW5nTWlncmF0aW9uID0gbnVsbDtcblxuLyoqXG4gKiBPbmNlIGEgdG9vbHRpcCBoYXMgb3BlbmVkIGZvciBhbiBlbGVtZW50LCB0aGF0IGVsZW1lbnQgaXMgJ3BvaXNvbmVkJyBhbmRcbiAqIGNhbm5vdCByZXNwYXduIGEgdG9vbHRpcCB1bnRpbCB0aGUgcG9pbnRlciBtb3ZlcyBvdmVyIGEgZGlmZmVyZW50IGVsZW1lbnQuXG4gKi9cbmxldCBwb2lzb25lZEVsZW1lbnQ6IEFueUR1cmluZ01pZ3JhdGlvbiA9IG51bGw7XG5cbi8qKlxuICogSG9yaXpvbnRhbCBvZmZzZXQgYmV0d2VlbiBtb3VzZSBjdXJzb3IgYW5kIHRvb2x0aXAuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVG9vbHRpcC5PRkZTRVRfWFxuICovXG5leHBvcnQgY29uc3QgT0ZGU0VUX1ggPSAwO1xuXG4vKipcbiAqIFZlcnRpY2FsIG9mZnNldCBiZXR3ZWVuIG1vdXNlIGN1cnNvciBhbmQgdG9vbHRpcC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sdGlwLk9GRlNFVF9ZXG4gKi9cbmV4cG9ydCBjb25zdCBPRkZTRVRfWSA9IDEwO1xuXG4vKipcbiAqIFJhZGl1cyBtb3VzZSBjYW4gbW92ZSBiZWZvcmUga2lsbGluZyB0b29sdGlwLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuUkFESVVTX09LXG4gKi9cbmV4cG9ydCBjb25zdCBSQURJVVNfT0sgPSAxMDtcblxuLyoqXG4gKiBEZWxheSBiZWZvcmUgdG9vbHRpcCBhcHBlYXJzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuSE9WRVJfTVNcbiAqL1xuZXhwb3J0IGNvbnN0IEhPVkVSX01TID0gNzUwO1xuXG4vKipcbiAqIEhvcml6b250YWwgcGFkZGluZyBiZXR3ZWVuIHRvb2x0aXAgYW5kIHNjcmVlbiBlZGdlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuTUFSR0lOU1xuICovXG5leHBvcnQgY29uc3QgTUFSR0lOUyA9IDU7XG5cbi8qKiBUaGUgSFRNTCBjb250YWluZXIuICBTZXQgb25jZSBieSBjcmVhdGVEb20uICovXG5sZXQgY29udGFpbmVyRGl2OiBIVE1MRGl2RWxlbWVudHxudWxsID0gbnVsbDtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBIVE1MIHRvb2x0aXAgY29udGFpbmVyLlxuICpcbiAqIEByZXR1cm5zIFRoZSBIVE1MIHRvb2x0aXAgY29udGFpbmVyLlxuICogQGFsaWFzIEJsb2NrbHkuVG9vbHRpcC5nZXREaXZcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERpdigpOiBIVE1MRGl2RWxlbWVudHxudWxsIHtcbiAgcmV0dXJuIGNvbnRhaW5lckRpdjtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB0b29sdGlwIHRleHQgZm9yIHRoZSBnaXZlbiBlbGVtZW50LlxuICpcbiAqIEBwYXJhbSBvYmplY3QgVGhlIG9iamVjdCB0byBnZXQgdGhlIHRvb2x0aXAgdGV4dCBvZi5cbiAqIEByZXR1cm5zIFRoZSB0b29sdGlwIHRleHQgb2YgdGhlIGVsZW1lbnQuXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sdGlwLmdldFRvb2x0aXBPZk9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0VG9vbHRpcE9mT2JqZWN0KG9iamVjdDogQW55RHVyaW5nTWlncmF0aW9ufG51bGwpOiBzdHJpbmcge1xuICBjb25zdCBvYmogPSBnZXRUYXJnZXRPYmplY3Qob2JqZWN0KTtcbiAgaWYgKG9iaikge1xuICAgIGxldCB0b29sdGlwID0gb2JqLnRvb2x0aXA7XG4gICAgd2hpbGUgKHR5cGVvZiB0b29sdGlwID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0b29sdGlwID0gdG9vbHRpcCgpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRvb2x0aXAgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBFcnJvcignVG9vbHRpcCBmdW5jdGlvbiBtdXN0IHJldHVybiBhIHN0cmluZy4nKTtcbiAgICB9XG4gICAgcmV0dXJuIHRvb2x0aXA7XG4gIH1cbiAgcmV0dXJuICcnO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHRhcmdldCBvYmplY3QgdGhhdCB0aGUgZ2l2ZW4gb2JqZWN0IGlzIHRhcmdldGluZyBmb3IgaXRzXG4gKiB0b29sdGlwLiBDb3VsZCBiZSB0aGUgb2JqZWN0IGl0c2VsZi5cbiAqXG4gKiBAcGFyYW0gb2JqIFRoZSBvYmplY3QgYXJlIHRyeWluZyB0byBmaW5kIHRoZSB0YXJnZXQgdG9vbHRpcCBvYmplY3Qgb2YuXG4gKiBAcmV0dXJucyBUaGUgdGFyZ2V0IHRvb2x0aXAgb2JqZWN0LlxuICovXG5mdW5jdGlvbiBnZXRUYXJnZXRPYmplY3Qob2JqOiBvYmplY3R8bnVsbCk6IHt0b29sdGlwOiBBbnlEdXJpbmdNaWdyYXRpb259fG51bGwge1xuICB3aGlsZSAob2JqICYmIChvYmogYXMgYW55KS50b29sdGlwKSB7XG4gICAgaWYgKHR5cGVvZiAob2JqIGFzIGFueSkudG9vbHRpcCA9PT0gJ3N0cmluZycgfHxcbiAgICAgICAgdHlwZW9mIChvYmogYXMgYW55KS50b29sdGlwID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gb2JqIGFzIHt0b29sdGlwOiBzdHJpbmcgfCAoKCkgPT4gc3RyaW5nKX07XG4gICAgfVxuICAgIG9iaiA9IChvYmogYXMgYW55KS50b29sdGlwO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIENyZWF0ZSB0aGUgdG9vbHRpcCBkaXYgYW5kIGluamVjdCBpdCBvbnRvIHRoZSBwYWdlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuY3JlYXRlRG9tXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEb20oKSB7XG4gIGlmIChjb250YWluZXJEaXYpIHtcbiAgICByZXR1cm47ICAvLyBBbHJlYWR5IGNyZWF0ZWQuXG4gIH1cbiAgLy8gQ3JlYXRlIGFuIEhUTUwgY29udGFpbmVyIGZvciBwb3B1cCBvdmVybGF5cyAoZS5nLiBlZGl0b3Igd2lkZ2V0cykuXG4gIGNvbnRhaW5lckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBjb250YWluZXJEaXYuY2xhc3NOYW1lID0gJ2Jsb2NrbHlUb29sdGlwRGl2JztcbiAgY29uc3QgY29udGFpbmVyID0gY29tbW9uLmdldFBhcmVudENvbnRhaW5lcigpIHx8IGRvY3VtZW50LmJvZHk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250YWluZXJEaXYpO1xufVxuXG4vKipcbiAqIEJpbmRzIHRoZSByZXF1aXJlZCBtb3VzZSBldmVudHMgb250byBhbiBTVkcgZWxlbWVudC5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBTVkcgZWxlbWVudCBvbnRvIHdoaWNoIHRvb2x0aXAgaXMgdG8gYmUgYm91bmQuXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sdGlwLmJpbmRNb3VzZUV2ZW50c1xuICovXG5leHBvcnQgZnVuY3Rpb24gYmluZE1vdXNlRXZlbnRzKGVsZW1lbnQ6IEVsZW1lbnQpIHtcbiAgLy8gVE9ETyAoIzYwOTcpOiBEb24ndCBzdGFzaCB3cmFwcGVyIGluZm8gb24gdGhlIERPTS5cbiAgKGVsZW1lbnQgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5tb3VzZU92ZXJXcmFwcGVyXyA9XG4gICAgICBicm93c2VyRXZlbnRzLmJpbmQoZWxlbWVudCwgJ3BvaW50ZXJvdmVyJywgbnVsbCwgb25Nb3VzZU92ZXIpO1xuICAoZWxlbWVudCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLm1vdXNlT3V0V3JhcHBlcl8gPVxuICAgICAgYnJvd3NlckV2ZW50cy5iaW5kKGVsZW1lbnQsICdwb2ludGVyb3V0JywgbnVsbCwgb25Nb3VzZU91dCk7XG5cbiAgLy8gRG9uJ3QgdXNlIGJpbmRFdmVudF8gZm9yIG1vdXNlbW92ZSBzaW5jZSB0aGF0IHdvdWxkIGNyZWF0ZSBhXG4gIC8vIGNvcnJlc3BvbmRpbmcgdG91Y2ggaGFuZGxlciwgZXZlbiB0aG91Z2ggdGhpcyBvbmx5IG1ha2VzIHNlbnNlIGluIHRoZVxuICAvLyBjb250ZXh0IG9mIGEgbW91c2VvdmVyL21vdXNlb3V0LlxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJtb3ZlJywgb25Nb3VzZU1vdmUsIGZhbHNlKTtcbn1cblxuLyoqXG4gKiBVbmJpbmRzIHRvb2x0aXAgbW91c2UgZXZlbnRzIGZyb20gdGhlIFNWRyBlbGVtZW50LlxuICpcbiAqIEBwYXJhbSBlbGVtZW50IFNWRyBlbGVtZW50IG9udG8gd2hpY2ggdG9vbHRpcCBpcyBib3VuZC5cbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAudW5iaW5kTW91c2VFdmVudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVuYmluZE1vdXNlRXZlbnRzKGVsZW1lbnQ6IEVsZW1lbnR8bnVsbCkge1xuICBpZiAoIWVsZW1lbnQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gVE9ETyAoIzYwOTcpOiBEb24ndCBzdGFzaCB3cmFwcGVyIGluZm8gb24gdGhlIERPTS5cbiAgYnJvd3NlckV2ZW50cy51bmJpbmQoKGVsZW1lbnQgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5tb3VzZU92ZXJXcmFwcGVyXyk7XG4gIGJyb3dzZXJFdmVudHMudW5iaW5kKChlbGVtZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbikubW91c2VPdXRXcmFwcGVyXyk7XG4gIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBvbk1vdXNlTW92ZSk7XG59XG5cbi8qKlxuICogSGlkZSB0aGUgdG9vbHRpcCBpZiB0aGUgbW91c2UgaXMgb3ZlciBhIGRpZmZlcmVudCBvYmplY3QuXG4gKiBJbml0aWFsaXplIHRoZSB0b29sdGlwIHRvIHBvdGVudGlhbGx5IGFwcGVhciBmb3IgdGhpcyBvYmplY3QuXG4gKlxuICogQHBhcmFtIGUgTW91c2UgZXZlbnQuXG4gKi9cbmZ1bmN0aW9uIG9uTW91c2VPdmVyKGU6IFBvaW50ZXJFdmVudCkge1xuICBpZiAoYmxvY2tlZCkge1xuICAgIC8vIFNvbWVvbmUgZG9lc24ndCB3YW50IHVzIHRvIHNob3cgdG9vbHRpcHMuXG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIElmIHRoZSB0b29sdGlwIGlzIGFuIG9iamVjdCwgdHJlYXQgaXQgYXMgYSBwb2ludGVyIHRvIHRoZSBuZXh0IG9iamVjdCBpblxuICAvLyB0aGUgY2hhaW4gdG8gbG9vayBhdC4gIFRlcm1pbmF0ZSB3aGVuIGEgc3RyaW5nIG9yIGZ1bmN0aW9uIGlzIGZvdW5kLlxuICBjb25zdCBuZXdFbGVtZW50ID0gZ2V0VGFyZ2V0T2JqZWN0KGUuY3VycmVudFRhcmdldCk7XG4gIGlmIChlbGVtZW50ICE9PSBuZXdFbGVtZW50KSB7XG4gICAgaGlkZSgpO1xuICAgIHBvaXNvbmVkRWxlbWVudCA9IG51bGw7XG4gICAgZWxlbWVudCA9IG5ld0VsZW1lbnQ7XG4gIH1cbiAgLy8gRm9yZ2V0IGFib3V0IGFueSBpbW1lZGlhdGVseSBwcmVjZWRpbmcgbW91c2VPdXQgZXZlbnQuXG4gIGNsZWFyVGltZW91dChtb3VzZU91dFBpZCk7XG59XG5cbi8qKlxuICogSGlkZSB0aGUgdG9vbHRpcCBpZiB0aGUgbW91c2UgbGVhdmVzIHRoZSBvYmplY3QgYW5kIGVudGVycyB0aGUgd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSBfZSBNb3VzZSBldmVudC5cbiAqL1xuZnVuY3Rpb24gb25Nb3VzZU91dChfZTogUG9pbnRlckV2ZW50KSB7XG4gIGlmIChibG9ja2VkKSB7XG4gICAgLy8gU29tZW9uZSBkb2Vzbid0IHdhbnQgdXMgdG8gc2hvdyB0b29sdGlwcy5cbiAgICByZXR1cm47XG4gIH1cbiAgLy8gTW92aW5nIGZyb20gb25lIGVsZW1lbnQgdG8gYW5vdGhlciAob3ZlcmxhcHBpbmcgb3Igd2l0aCBubyBnYXApIGdlbmVyYXRlc1xuICAvLyBhIG1vdXNlT3V0IGZvbGxvd2VkIGluc3RhbnRseSBieSBhIG1vdXNlT3Zlci4gIEZvcmsgb2ZmIHRoZSBtb3VzZU91dFxuICAvLyBldmVudCBhbmQga2lsbCBpdCBpZiBhIG1vdXNlT3ZlciBpcyByZWNlaXZlZCBpbW1lZGlhdGVseS5cbiAgLy8gVGhpcyB3YXkgdGhlIHRhc2sgb25seSBmdWxseSBleGVjdXRlcyBpZiBtb3VzaW5nIGludG8gdGhlIHZvaWQuXG4gIG1vdXNlT3V0UGlkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICBlbGVtZW50ID0gbnVsbDtcbiAgICBwb2lzb25lZEVsZW1lbnQgPSBudWxsO1xuICAgIGhpZGUoKTtcbiAgfSwgMSk7XG4gIGNsZWFyVGltZW91dChzaG93UGlkKTtcbn1cblxuLyoqXG4gKiBXaGVuIGhvdmVyaW5nIG92ZXIgYW4gZWxlbWVudCwgc2NoZWR1bGUgYSB0b29sdGlwIHRvIGJlIHNob3duLiAgSWYgYSB0b29sdGlwXG4gKiBpcyBhbHJlYWR5IHZpc2libGUsIGhpZGUgaXQgaWYgdGhlIG1vdXNlIHN0cmF5cyBvdXQgb2YgYSBjZXJ0YWluIHJhZGl1cy5cbiAqXG4gKiBAcGFyYW0gZSBNb3VzZSBldmVudC5cbiAqL1xuZnVuY3Rpb24gb25Nb3VzZU1vdmUoZTogRXZlbnQpIHtcbiAgaWYgKCFlbGVtZW50IHx8ICEoZWxlbWVudCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRvb2x0aXApIHtcbiAgICAvLyBObyB0b29sdGlwIGhlcmUgdG8gc2hvdy5cbiAgICByZXR1cm47XG4gIH0gZWxzZSBpZiAoYmxvY2tlZCkge1xuICAgIC8vIFNvbWVvbmUgZG9lc24ndCB3YW50IHVzIHRvIHNob3cgdG9vbHRpcHMuICBXZSBhcmUgcHJvYmFibHkgaGFuZGxpbmcgYVxuICAgIC8vIHVzZXIgZ2VzdHVyZSwgc3VjaCBhcyBhIGNsaWNrIG9yIGRyYWcuXG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICh2aXNpYmxlKSB7XG4gICAgLy8gQ29tcHV0ZSB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0aGUgbW91c2UgcG9zaXRpb24gd2hlbiB0aGUgdG9vbHRpcCB3YXNcbiAgICAvLyBzaG93biBhbmQgdGhlIGN1cnJlbnQgbW91c2UgcG9zaXRpb24uICBQeXRoYWdvcmVhbiB0aGVvcmVtLlxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ3BhZ2VYJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJ0V2ZW50Jy5cbiAgICBjb25zdCBkeCA9IGxhc3RYIC0gKGUgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5wYWdlWDtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdwYWdlWScgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICdFdmVudCcuXG4gICAgY29uc3QgZHkgPSBsYXN0WSAtIChlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikucGFnZVk7XG4gICAgaWYgKE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSkgPiBSQURJVVNfT0spIHtcbiAgICAgIGhpZGUoKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocG9pc29uZWRFbGVtZW50ICE9PSBlbGVtZW50KSB7XG4gICAgLy8gVGhlIG1vdXNlIG1vdmVkLCBjbGVhciBhbnkgcHJldmlvdXNseSBzY2hlZHVsZWQgdG9vbHRpcC5cbiAgICBjbGVhclRpbWVvdXQoc2hvd1BpZCk7XG4gICAgLy8gTWF5YmUgdGhpcyB0aW1lIHRoZSBtb3VzZSB3aWxsIHN0YXkgcHV0LiAgU2NoZWR1bGUgc2hvd2luZyBvZiB0b29sdGlwLlxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ3BhZ2VYJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJ0V2ZW50Jy5cbiAgICBsYXN0WCA9IChlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikucGFnZVg7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAncGFnZVknIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAvLyAnRXZlbnQnLlxuICAgIGxhc3RZID0gKGUgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5wYWdlWTtcbiAgICBzaG93UGlkID0gc2V0VGltZW91dChzaG93LCBIT1ZFUl9NUyk7XG4gIH1cbn1cblxuLyoqXG4gKiBEaXNwb3NlIG9mIHRoZSB0b29sdGlwLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuZGlzcG9zZVxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICBlbGVtZW50ID0gbnVsbDtcbiAgcG9pc29uZWRFbGVtZW50ID0gbnVsbDtcbiAgaGlkZSgpO1xufVxuXG4vKipcbiAqIEhpZGUgdGhlIHRvb2x0aXAuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVG9vbHRpcC5oaWRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoaWRlKCkge1xuICBpZiAodmlzaWJsZSkge1xuICAgIHZpc2libGUgPSBmYWxzZTtcbiAgICBpZiAoY29udGFpbmVyRGl2KSB7XG4gICAgICBjb250YWluZXJEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9XG4gIH1cbiAgaWYgKHNob3dQaWQpIHtcbiAgICBjbGVhclRpbWVvdXQoc2hvd1BpZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBIaWRlIGFueSBpbi1wcm9ncmVzcyB0b29sdGlwcyBhbmQgYmxvY2sgc2hvd2luZyBuZXcgdG9vbHRpcHMgdW50aWwgdGhlIG5leHRcbiAqIGNhbGwgdG8gdW5ibG9jaygpLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAuYmxvY2tcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gYmxvY2soKSB7XG4gIGhpZGUoKTtcbiAgYmxvY2tlZCA9IHRydWU7XG59XG5cbi8qKlxuICogVW5ibG9jayB0b29sdGlwczogYWxsb3cgdGhlbSB0byBiZSBzY2hlZHVsZWQgYW5kIHNob3duIGFjY29yZGluZyB0byB0aGVpciBvd25cbiAqIGxvZ2ljLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2x0aXAudW5ibG9ja1xuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bmJsb2NrKCkge1xuICBibG9ja2VkID0gZmFsc2U7XG59XG5cbi8qKiBSZW5kZXJzIHRoZSB0b29sdGlwIGNvbnRlbnQgaW50byB0aGUgdG9vbHRpcCBkaXYuICovXG5mdW5jdGlvbiByZW5kZXJDb250ZW50KCkge1xuICBpZiAoIWNvbnRhaW5lckRpdiB8fCAhZWxlbWVudCkge1xuICAgIC8vIFRoaXMgc2hvdWxkbid0IGhhcHBlbiwgYnV0IGlmIGl0IGRvZXMsIHdlIGNhbid0IHJlbmRlci5cbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKHR5cGVvZiBjdXN0b21Ub29sdGlwID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY3VzdG9tVG9vbHRpcChjb250YWluZXJEaXYsIGVsZW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIHJlbmRlckRlZmF1bHRDb250ZW50KCk7XG4gIH1cbn1cblxuLyoqIFJlbmRlcnMgdGhlIGRlZmF1bHQgdG9vbHRpcCBVSS4gKi9cbmZ1bmN0aW9uIHJlbmRlckRlZmF1bHRDb250ZW50KCkge1xuICBsZXQgdGlwID0gZ2V0VG9vbHRpcE9mT2JqZWN0KGVsZW1lbnQpO1xuICB0aXAgPSBibG9ja2x5U3RyaW5nLndyYXAodGlwLCBMSU1JVCk7XG4gIC8vIENyZWF0ZSBuZXcgdGV4dCwgbGluZSBieSBsaW5lLlxuICBjb25zdCBsaW5lcyA9IHRpcC5zcGxpdCgnXFxuJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBkaXYgPSAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICAgIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsaW5lc1tpXSkpO1xuICAgIGNvbnRhaW5lckRpdiEuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgdGhlIGNvb3JkaW5hdGVzIGZvciB0aGUgdG9vbHRpcCBkaXYsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIGVkZ2VzIG9mXG4gKiB0aGUgc2NyZWVuIHRvIHByZXZlbnQgc2hvd2luZyB0aGUgdG9vbHRpcCBvZmZzY3JlZW4uXG4gKlxuICogQHBhcmFtIHJ0bCBUcnVlIGlmIHRoZSB0b29sdGlwIHNob3VsZCBiZSBpbiByaWdodC10by1sZWZ0IGxheW91dC5cbiAqIEByZXR1cm5zIENvb3JkaW5hdGVzIGF0IHdoaWNoIHRoZSB0b29sdGlwIGRpdiBzaG91bGQgYmUgcGxhY2VkLlxuICovXG5mdW5jdGlvbiBnZXRQb3NpdGlvbihydGw6IGJvb2xlYW4pOiB7eDogbnVtYmVyLCB5OiBudW1iZXJ9IHtcbiAgLy8gUG9zaXRpb24gdGhlIHRvb2x0aXAganVzdCBiZWxvdyB0aGUgY3Vyc29yLlxuICBjb25zdCB3aW5kb3dXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcbiAgY29uc3Qgd2luZG93SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcblxuICBsZXQgYW5jaG9yWCA9IGxhc3RYO1xuICBpZiAocnRsKSB7XG4gICAgYW5jaG9yWCAtPSBPRkZTRVRfWCArIGNvbnRhaW5lckRpdiEub2Zmc2V0V2lkdGg7XG4gIH0gZWxzZSB7XG4gICAgYW5jaG9yWCArPSBPRkZTRVRfWDtcbiAgfVxuXG4gIGxldCBhbmNob3JZID0gbGFzdFkgKyBPRkZTRVRfWTtcbiAgaWYgKGFuY2hvclkgKyBjb250YWluZXJEaXYhLm9mZnNldEhlaWdodCA+IHdpbmRvd0hlaWdodCArIHdpbmRvdy5zY3JvbGxZKSB7XG4gICAgLy8gRmFsbGluZyBvZmYgdGhlIGJvdHRvbSBvZiB0aGUgc2NyZWVuOyBzaGlmdCB0aGUgdG9vbHRpcCB1cC5cbiAgICBhbmNob3JZIC09IGNvbnRhaW5lckRpdiEub2Zmc2V0SGVpZ2h0ICsgMiAqIE9GRlNFVF9ZO1xuICB9XG5cbiAgaWYgKHJ0bCkge1xuICAgIC8vIFByZXZlbnQgZmFsbGluZyBvZmYgbGVmdCBlZGdlIGluIFJUTCBtb2RlLlxuICAgIGFuY2hvclggPSBNYXRoLm1heChNQVJHSU5TIC0gd2luZG93LnNjcm9sbFgsIGFuY2hvclgpO1xuICB9IGVsc2Uge1xuICAgIGlmIChhbmNob3JYICsgY29udGFpbmVyRGl2IS5vZmZzZXRXaWR0aCA+XG4gICAgICAgIHdpbmRvd1dpZHRoICsgd2luZG93LnNjcm9sbFggLSAyICogTUFSR0lOUykge1xuICAgICAgLy8gRmFsbGluZyBvZmYgdGhlIHJpZ2h0IGVkZ2Ugb2YgdGhlIHNjcmVlbjtcbiAgICAgIC8vIGNsYW1wIHRoZSB0b29sdGlwIG9uIHRoZSBlZGdlLlxuICAgICAgYW5jaG9yWCA9IHdpbmRvd1dpZHRoIC0gY29udGFpbmVyRGl2IS5vZmZzZXRXaWR0aCAtIDIgKiBNQVJHSU5TO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7eDogYW5jaG9yWCwgeTogYW5jaG9yWX07XG59XG5cbi8qKiBDcmVhdGUgdGhlIHRvb2x0aXAgYW5kIHNob3cgaXQuICovXG5mdW5jdGlvbiBzaG93KCkge1xuICBpZiAoYmxvY2tlZCkge1xuICAgIC8vIFNvbWVvbmUgZG9lc24ndCB3YW50IHVzIHRvIHNob3cgdG9vbHRpcHMuXG4gICAgcmV0dXJuO1xuICB9XG4gIHBvaXNvbmVkRWxlbWVudCA9IGVsZW1lbnQ7XG4gIGlmICghY29udGFpbmVyRGl2KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIEVyYXNlIGFsbCBleGlzdGluZyB0ZXh0LlxuICBjb250YWluZXJEaXYudGV4dENvbnRlbnQgPSAnJztcblxuICAvLyBBZGQgbmV3IGNvbnRlbnQuXG4gIHJlbmRlckNvbnRlbnQoKTtcblxuICAvLyBEaXNwbGF5IHRoZSB0b29sdGlwLlxuICBjb25zdCBydGwgPSAoZWxlbWVudCBhcyBhbnkpLlJUTDtcbiAgY29udGFpbmVyRGl2LnN0eWxlLmRpcmVjdGlvbiA9IHJ0bCA/ICdydGwnIDogJ2x0cic7XG4gIGNvbnRhaW5lckRpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgdmlzaWJsZSA9IHRydWU7XG5cbiAgY29uc3Qge3gsIHl9ID0gZ2V0UG9zaXRpb24ocnRsKTtcbiAgY29udGFpbmVyRGl2LnN0eWxlLmxlZnQgPSB4ICsgJ3B4JztcbiAgY29udGFpbmVyRGl2LnN0eWxlLnRvcCA9IHkgKyAncHgnO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3IgY29sb3VyIG1hbmlwdWxhdGlvbi5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMuY29sb3VyXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMuY29sb3VyJyk7XG5cblxuLyoqXG4gKiBUaGUgcmljaG5lc3Mgb2YgYmxvY2sgY29sb3VycywgcmVnYXJkbGVzcyBvZiB0aGUgaHVlLlxuICogTXVzdCBiZSBpbiB0aGUgcmFuZ2Ugb2YgMCAoaW5jbHVzaXZlKSB0byAxIChleGNsdXNpdmUpLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmNvbG91ci5oc3ZTYXR1cmF0aW9uXG4gKi9cbmxldCBoc3ZTYXR1cmF0aW9uID0gMC40NTtcblxuLyoqXG4gKiBHZXQgdGhlIHJpY2huZXNzIG9mIGJsb2NrIGNvbG91cnMsIHJlZ2FyZGxlc3Mgb2YgdGhlIGh1ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5jb2xvdXIuZ2V0SHN2U2F0dXJhdGlvblxuICogQHJldHVybnMgVGhlIGN1cnJlbnQgcmljaG5lc3MuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEhzdlNhdHVyYXRpb24oKTogbnVtYmVyIHtcbiAgcmV0dXJuIGhzdlNhdHVyYXRpb247XG59XG5cbi8qKlxuICogU2V0IHRoZSByaWNobmVzcyBvZiBibG9jayBjb2xvdXJzLCByZWdhcmRsZXNzIG9mIHRoZSBodWUuXG4gKlxuICogQHBhcmFtIG5ld1NhdHVyYXRpb24gVGhlIG5ldyByaWNobmVzcywgaW4gdGhlIHJhbmdlIG9mICAwIChpbmNsdXNpdmUpIHRvIDFcbiAqICAgICAoZXhjbHVzaXZlKVxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuY29sb3VyLnNldEhzdlNhdHVyYXRpb25cbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0SHN2U2F0dXJhdGlvbihuZXdTYXR1cmF0aW9uOiBudW1iZXIpIHtcbiAgaHN2U2F0dXJhdGlvbiA9IG5ld1NhdHVyYXRpb247XG59XG5cbi8qKlxuICogVGhlIGludGVuc2l0eSBvZiBibG9jayBjb2xvdXJzLCByZWdhcmRsZXNzIG9mIHRoZSBodWUuXG4gKiBNdXN0IGJlIGluIHRoZSByYW5nZSBvZiAwIChpbmNsdXNpdmUpIHRvIDEgKGV4Y2x1c2l2ZSkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuY29sb3VyLmhzdlZhbHVlXG4gKi9cbmxldCBoc3ZWYWx1ZSA9IDAuNjU7XG5cbi8qKlxuICogR2V0IHRoZSBpbnRlbnNpdHkgb2YgYmxvY2sgY29sb3VycywgcmVnYXJkbGVzcyBvZiB0aGUgaHVlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmNvbG91ci5nZXRIc3ZWYWx1ZVxuICogQHJldHVybnMgVGhlIGN1cnJlbnQgaW50ZW5zaXR5LlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRIc3ZWYWx1ZSgpOiBudW1iZXIge1xuICByZXR1cm4gaHN2VmFsdWU7XG59XG5cbi8qKlxuICogU2V0IHRoZSBpbnRlbnNpdHkgb2YgYmxvY2sgY29sb3VycywgcmVnYXJkbGVzcyBvZiB0aGUgaHVlLlxuICpcbiAqIEBwYXJhbSBuZXdWYWx1ZSBUaGUgbmV3IGludGVuc2l0eSwgaW4gdGhlIHJhbmdlIG9mICAwIChpbmNsdXNpdmUpIHRvIDFcbiAqICAgICAoZXhjbHVzaXZlKVxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuY29sb3VyLnNldEhzdlZhbHVlXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEhzdlZhbHVlKG5ld1ZhbHVlOiBudW1iZXIpIHtcbiAgaHN2VmFsdWUgPSBuZXdWYWx1ZTtcbn1cblxuLyoqXG4gKiBQYXJzZXMgYSBjb2xvdXIgZnJvbSBhIHN0cmluZy5cbiAqIC5wYXJzZSgncmVkJykgPSAnI2ZmMDAwMCdcbiAqIC5wYXJzZSgnI2YwMCcpID0gJyNmZjAwMDAnXG4gKiAucGFyc2UoJyNmZjAwMDAnKSA9ICcjZmYwMDAwJ1xuICogLnBhcnNlKCcweGZmMDAwMCcpID0gJyNmZjAwMDAnXG4gKiAucGFyc2UoJ3JnYigyNTUsIDAsIDApJykgPSAnI2ZmMDAwMCdcbiAqXG4gKiBAcGFyYW0gc3RyIENvbG91ciBpbiBzb21lIENTUyBmb3JtYXQuXG4gKiBAcmV0dXJucyBBIHN0cmluZyBjb250YWluaW5nIGEgaGV4IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb2xvdXIsIG9yIG51bGwgaWZcbiAqICAgICBjYW4ndCBiZSBwYXJzZWQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5jb2xvdXIucGFyc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHN0cjogc3RyaW5nfG51bWJlcik6IHN0cmluZ3xudWxsIHtcbiAgc3RyID0gU3RyaW5nKHN0cikudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gIGxldCBoZXggPSBuYW1lc1tzdHJdO1xuICBpZiAoaGV4KSB7XG4gICAgLy8gZS5nLiAncmVkJ1xuICAgIHJldHVybiBoZXg7XG4gIH1cbiAgaGV4ID0gc3RyLnN1YnN0cmluZygwLCAyKSA9PT0gJzB4JyA/ICcjJyArIHN0ci5zdWJzdHJpbmcoMikgOiBzdHI7XG4gIGhleCA9IGhleFswXSA9PT0gJyMnID8gaGV4IDogJyMnICsgaGV4O1xuICBpZiAoL14jWzAtOWEtZl17Nn0kLy50ZXN0KGhleCkpIHtcbiAgICAvLyBlLmcuICcjMDBmZjg4J1xuICAgIHJldHVybiBoZXg7XG4gIH1cbiAgaWYgKC9eI1swLTlhLWZdezN9JC8udGVzdChoZXgpKSB7XG4gICAgLy8gZS5nLiAnIzBmOCdcbiAgICByZXR1cm4gWycjJywgaGV4WzFdLCBoZXhbMV0sIGhleFsyXSwgaGV4WzJdLCBoZXhbM10sIGhleFszXV0uam9pbignJyk7XG4gIH1cbiAgY29uc3QgcmdiID0gc3RyLm1hdGNoKC9eKD86cmdiKT9cXHMqXFwoXFxzKihcXGQrKVxccyosXFxzKihcXGQrKVxccyosXFxzKihcXGQrKVxccypcXCkkLyk7XG4gIGlmIChyZ2IpIHtcbiAgICAvLyBlLmcuICdyZ2IoMCwgMTI4LCAyNTUpJ1xuICAgIGNvbnN0IHIgPSBOdW1iZXIocmdiWzFdKTtcbiAgICBjb25zdCBnID0gTnVtYmVyKHJnYlsyXSk7XG4gICAgY29uc3QgYiA9IE51bWJlcihyZ2JbM10pO1xuICAgIGlmIChyID49IDAgJiYgciA8IDI1NiAmJiBnID49IDAgJiYgZyA8IDI1NiAmJiBiID49IDAgJiYgYiA8IDI1Nikge1xuICAgICAgcmV0dXJuIHJnYlRvSGV4KHIsIGcsIGIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIGNvbG91ciBmcm9tIFJHQiB0byBoZXggcmVwcmVzZW50YXRpb24uXG4gKlxuICogQHBhcmFtIHIgQW1vdW50IG9mIHJlZCwgaW50IGJldHdlZW4gMCBhbmQgMjU1LlxuICogQHBhcmFtIGcgQW1vdW50IG9mIGdyZWVuLCBpbnQgYmV0d2VlbiAwIGFuZCAyNTUuXG4gKiBAcGFyYW0gYiBBbW91bnQgb2YgYmx1ZSwgaW50IGJldHdlZW4gMCBhbmQgMjU1LlxuICogQHJldHVybnMgSGV4IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb2xvdXIuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5jb2xvdXIucmdiVG9IZXhcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJnYlRvSGV4KHI6IG51bWJlciwgZzogbnVtYmVyLCBiOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCByZ2IgPSByIDw8IDE2IHwgZyA8PCA4IHwgYjtcbiAgaWYgKHIgPCAweDEwKSB7XG4gICAgcmV0dXJuICcjJyArICgweDEwMDAwMDAgfCByZ2IpLnRvU3RyaW5nKDE2KS5zdWJzdHIoMSk7XG4gIH1cbiAgcmV0dXJuICcjJyArIHJnYi50b1N0cmluZygxNik7XG59XG5cbi8qKlxuICogQ29udmVydHMgYSBjb2xvdXIgdG8gUkdCLlxuICpcbiAqIEBwYXJhbSBjb2xvdXIgU3RyaW5nIHJlcHJlc2VudGluZyBjb2xvdXIgaW4gYW55IGNvbG91ciBmb3JtYXQgKCcjZmYwMDAwJyxcbiAqICAgICAncmVkJywgJzB4ZmYwMDAnLCBldGMpLlxuICogQHJldHVybnMgUkdCIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb2xvdXIuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5jb2xvdXIuaGV4VG9SZ2JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhleFRvUmdiKGNvbG91cjogc3RyaW5nKTogbnVtYmVyW10ge1xuICBjb25zdCBoZXggPSBwYXJzZShjb2xvdXIpO1xuICBpZiAoIWhleCkge1xuICAgIHJldHVybiBbMCwgMCwgMF07XG4gIH1cblxuICBjb25zdCByZ2IgPSBwYXJzZUludChoZXguc3Vic3RyKDEpLCAxNik7XG4gIGNvbnN0IHIgPSByZ2IgPj4gMTY7XG4gIGNvbnN0IGcgPSByZ2IgPj4gOCAmIDI1NTtcbiAgY29uc3QgYiA9IHJnYiAmIDI1NTtcblxuICByZXR1cm4gW3IsIGcsIGJdO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGFuIEhTViB0cmlwbGV0IHRvIGhleCByZXByZXNlbnRhdGlvbi5cbiAqXG4gKiBAcGFyYW0gaCBIdWUgdmFsdWUgaW4gWzAsIDM2MF0uXG4gKiBAcGFyYW0gcyBTYXR1cmF0aW9uIHZhbHVlIGluIFswLCAxXS5cbiAqIEBwYXJhbSB2IEJyaWdodG5lc3MgaW4gWzAsIDI1NV0uXG4gKiBAcmV0dXJucyBIZXggcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbG91ci5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmNvbG91ci5oc3ZUb0hleFxuICovXG5leHBvcnQgZnVuY3Rpb24gaHN2VG9IZXgoaDogbnVtYmVyLCBzOiBudW1iZXIsIHY6IG51bWJlcik6IHN0cmluZyB7XG4gIGxldCByZWQgPSAwO1xuICBsZXQgZ3JlZW4gPSAwO1xuICBsZXQgYmx1ZSA9IDA7XG4gIGlmIChzID09PSAwKSB7XG4gICAgcmVkID0gdjtcbiAgICBncmVlbiA9IHY7XG4gICAgYmx1ZSA9IHY7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc2V4dGFudCA9IE1hdGguZmxvb3IoaCAvIDYwKTtcbiAgICBjb25zdCByZW1haW5kZXIgPSBoIC8gNjAgLSBzZXh0YW50O1xuICAgIGNvbnN0IHZhbDEgPSB2ICogKDEgLSBzKTtcbiAgICBjb25zdCB2YWwyID0gdiAqICgxIC0gcyAqIHJlbWFpbmRlcik7XG4gICAgY29uc3QgdmFsMyA9IHYgKiAoMSAtIHMgKiAoMSAtIHJlbWFpbmRlcikpO1xuICAgIHN3aXRjaCAoc2V4dGFudCkge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByZWQgPSB2YWwyO1xuICAgICAgICBncmVlbiA9IHY7XG4gICAgICAgIGJsdWUgPSB2YWwxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmVkID0gdmFsMTtcbiAgICAgICAgZ3JlZW4gPSB2O1xuICAgICAgICBibHVlID0gdmFsMztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHJlZCA9IHZhbDE7XG4gICAgICAgIGdyZWVuID0gdmFsMjtcbiAgICAgICAgYmx1ZSA9IHY7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICByZWQgPSB2YWwzO1xuICAgICAgICBncmVlbiA9IHZhbDE7XG4gICAgICAgIGJsdWUgPSB2O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgcmVkID0gdjtcbiAgICAgICAgZ3JlZW4gPSB2YWwxO1xuICAgICAgICBibHVlID0gdmFsMjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICBjYXNlIDA6XG4gICAgICAgIHJlZCA9IHY7XG4gICAgICAgIGdyZWVuID0gdmFsMztcbiAgICAgICAgYmx1ZSA9IHZhbDE7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmdiVG9IZXgoTWF0aC5mbG9vcihyZWQpLCBNYXRoLmZsb29yKGdyZWVuKSwgTWF0aC5mbG9vcihibHVlKSk7XG59XG5cbi8qKlxuICogQmxlbmQgdHdvIGNvbG91cnMgdG9nZXRoZXIsIHVzaW5nIHRoZSBzcGVjaWZpZWQgZmFjdG9yIHRvIGluZGljYXRlIHRoZVxuICogd2VpZ2h0IGdpdmVuIHRvIHRoZSBmaXJzdCBjb2xvdXIuXG4gKlxuICogQHBhcmFtIGNvbG91cjEgRmlyc3QgY29sb3VyLlxuICogQHBhcmFtIGNvbG91cjIgU2Vjb25kIGNvbG91ci5cbiAqIEBwYXJhbSBmYWN0b3IgVGhlIHdlaWdodCB0byBiZSBnaXZlbiB0byBjb2xvdXIxIG92ZXIgY29sb3VyMi5cbiAqICAgICBWYWx1ZXMgc2hvdWxkIGJlIGluIHRoZSByYW5nZSBbMCwgMV0uXG4gKiBAcmV0dXJucyBDb21iaW5lZCBjb2xvdXIgcmVwcmVzZW50ZWQgaW4gaGV4LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuY29sb3VyLmJsZW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBibGVuZChjb2xvdXIxOiBzdHJpbmcsIGNvbG91cjI6IHN0cmluZywgZmFjdG9yOiBudW1iZXIpOiBzdHJpbmd8XG4gICAgbnVsbCB7XG4gIGNvbnN0IGhleDEgPSBwYXJzZShjb2xvdXIxKTtcbiAgaWYgKCFoZXgxKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgaGV4MiA9IHBhcnNlKGNvbG91cjIpO1xuICBpZiAoIWhleDIpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCByZ2IxID0gaGV4VG9SZ2IoaGV4MSk7XG4gIGNvbnN0IHJnYjIgPSBoZXhUb1JnYihoZXgyKTtcbiAgY29uc3QgciA9IE1hdGgucm91bmQocmdiMlswXSArIGZhY3RvciAqIChyZ2IxWzBdIC0gcmdiMlswXSkpO1xuICBjb25zdCBnID0gTWF0aC5yb3VuZChyZ2IyWzFdICsgZmFjdG9yICogKHJnYjFbMV0gLSByZ2IyWzFdKSk7XG4gIGNvbnN0IGIgPSBNYXRoLnJvdW5kKHJnYjJbMl0gKyBmYWN0b3IgKiAocmdiMVsyXSAtIHJnYjJbMl0pKTtcbiAgcmV0dXJuIHJnYlRvSGV4KHIsIGcsIGIpO1xufVxuXG4vKipcbiAqIEEgbWFwIHRoYXQgY29udGFpbnMgdGhlIDE2IGJhc2ljIGNvbG91ciBrZXl3b3JkcyBhcyBkZWZpbmVkIGJ5IFczQzpcbiAqIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDE4L1JFQy1jc3MtY29sb3ItMy0yMDE4MDYxOS8jaHRtbDRcbiAqIFRoZSBrZXlzIG9mIHRoaXMgbWFwIGFyZSB0aGUgbG93ZXJjYXNlIFwicmVhZGFibGVcIiBuYW1lcyBvZiB0aGUgY29sb3VycyxcbiAqIHdoaWxlIHRoZSB2YWx1ZXMgYXJlIHRoZSBcImhleFwiIHZhbHVlcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5jb2xvdXIubmFtZXNcbiAqL1xuZXhwb3J0IGNvbnN0IG5hbWVzOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfSA9IHtcbiAgJ2FxdWEnOiAnIzAwZmZmZicsXG4gICdibGFjayc6ICcjMDAwMDAwJyxcbiAgJ2JsdWUnOiAnIzAwMDBmZicsXG4gICdmdWNoc2lhJzogJyNmZjAwZmYnLFxuICAnZ3JheSc6ICcjODA4MDgwJyxcbiAgJ2dyZWVuJzogJyMwMDgwMDAnLFxuICAnbGltZSc6ICcjMDBmZjAwJyxcbiAgJ21hcm9vbic6ICcjODAwMDAwJyxcbiAgJ25hdnknOiAnIzAwMDA4MCcsXG4gICdvbGl2ZSc6ICcjODA4MDAwJyxcbiAgJ3B1cnBsZSc6ICcjODAwMDgwJyxcbiAgJ3JlZCc6ICcjZmYwMDAwJyxcbiAgJ3NpbHZlcic6ICcjYzBjMGMwJyxcbiAgJ3RlYWwnOiAnIzAwODA4MCcsXG4gICd3aGl0ZSc6ICcjZmZmZmZmJyxcbiAgJ3llbGxvdyc6ICcjZmZmZjAwJyxcbn07XG5cbi8qKlxuICogQ29udmVydCBhIGh1ZSAoSFNWIG1vZGVsKSBpbnRvIGFuIFJHQiBoZXggdHJpcGxldC5cbiAqXG4gKiBAcGFyYW0gaHVlIEh1ZSBvbiBhIGNvbG91ciB3aGVlbCAoMC0zNjApLlxuICogQHJldHVybnMgUkdCIGNvZGUsIGUuZy4gJyM1YmE2NWInLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuY29sb3VyLmh1ZVRvSGV4XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBodWVUb0hleChodWU6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBoc3ZUb0hleChodWUsIGhzdlNhdHVyYXRpb24sIGhzdlZhbHVlICogMjU1KTtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMucGFyc2luZ1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnV0aWxzLnBhcnNpbmcnKTtcblxuaW1wb3J0IHtNc2d9IGZyb20gJy4uL21zZy5qcyc7XG5cbmltcG9ydCAqIGFzIGNvbG91clV0aWxzIGZyb20gJy4vY29sb3VyLmpzJztcblxuXG4vKipcbiAqIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIHRoZSBtZXNzYWdlIHJlZmVyZW5jZSBhbmQgaW50ZXJwb2xhdGlvbiB0b2tlblxuICogcGFyc2luZyB1c2VkIGJ5IHRva2VuaXplSW50ZXJwb2xhdGlvbigpIGFuZCByZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMoKS5cbiAqXG4gKiBAcGFyYW0gbWVzc2FnZSBUZXh0IHdoaWNoIG1pZ2h0IGNvbnRhaW4gc3RyaW5nIHRhYmxlIHJlZmVyZW5jZXMgYW5kXG4gKiAgICAgaW50ZXJwb2xhdGlvbiB0b2tlbnMuXG4gKiBAcGFyYW0gcGFyc2VJbnRlcnBvbGF0aW9uVG9rZW5zIE9wdGlvbiB0byBwYXJzZSBudW1lcmljXG4gKiAgICAgaW50ZXJwb2xhdGlvbiB0b2tlbnMgKCUxLCAlMiwgLi4uKSB3aGVuIHRydWUuXG4gKiBAcmV0dXJucyBBcnJheSBvZiBzdHJpbmdzIGFuZCBudW1iZXJzLlxuICovXG5mdW5jdGlvbiB0b2tlbml6ZUludGVycG9sYXRpb25JbnRlcm5hbChcbiAgICBtZXNzYWdlOiBzdHJpbmcsIHBhcnNlSW50ZXJwb2xhdGlvblRva2VuczogYm9vbGVhbik6IChzdHJpbmd8bnVtYmVyKVtdIHtcbiAgY29uc3QgdG9rZW5zID0gW107XG4gIGNvbnN0IGNoYXJzID0gbWVzc2FnZS5zcGxpdCgnJyk7XG4gIGNoYXJzLnB1c2goJycpOyAgLy8gRW5kIG1hcmtlci5cbiAgLy8gUGFyc2UgdGhlIG1lc3NhZ2Ugd2l0aCBhIGZpbml0ZSBzdGF0ZSBtYWNoaW5lLlxuICAvLyAwIC0gQmFzZSBjYXNlLlxuICAvLyAxIC0gJSBmb3VuZC5cbiAgLy8gMiAtIERpZ2l0IGZvdW5kLlxuICAvLyAzIC0gTWVzc2FnZSByZWYgZm91bmQuXG4gIGxldCBzdGF0ZSA9IDA7XG4gIGNvbnN0IGJ1ZmZlciA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XG4gIGxldCBudW1iZXIgPSBudWxsO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgYyA9IGNoYXJzW2ldO1xuICAgIGlmIChzdGF0ZSA9PT0gMCkgeyAgLy8gU3RhcnQgZXNjYXBlLlxuICAgICAgaWYgKGMgPT09ICclJykge1xuICAgICAgICBjb25zdCB0ZXh0ID0gYnVmZmVyLmpvaW4oJycpO1xuICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgIHRva2Vucy5wdXNoKHRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwO1xuICAgICAgICBzdGF0ZSA9IDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBidWZmZXIucHVzaChjKTsgIC8vIFJlZ3VsYXIgY2hhci5cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7XG4gICAgICBpZiAoYyA9PT0gJyUnKSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKGMpOyAgLy8gRXNjYXBlZCAlOiAlJVxuICAgICAgICBzdGF0ZSA9IDA7XG4gICAgICB9IGVsc2UgaWYgKHBhcnNlSW50ZXJwb2xhdGlvblRva2VucyAmJiAnMCcgPD0gYyAmJiBjIDw9ICc5Jykge1xuICAgICAgICBzdGF0ZSA9IDI7XG4gICAgICAgIG51bWJlciA9IGM7XG4gICAgICAgIGNvbnN0IHRleHQgPSBidWZmZXIuam9pbignJyk7XG4gICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgdG9rZW5zLnB1c2godGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7XG4gICAgICB9IGVsc2UgaWYgKGMgPT09ICd7Jykge1xuICAgICAgICBzdGF0ZSA9IDM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBidWZmZXIucHVzaCgnJScsIGMpOyAgLy8gTm90IHJlY29nbml6ZWQuIFJldHVybiBhcyBsaXRlcmFsLlxuICAgICAgICBzdGF0ZSA9IDA7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMikge1xuICAgICAgaWYgKCcwJyA8PSBjICYmIGMgPD0gJzknKSB7XG4gICAgICAgIG51bWJlciArPSBjOyAgLy8gTXVsdGktZGlnaXQgbnVtYmVyLlxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdG9rZW5zLnB1c2gocGFyc2VJbnQobnVtYmVyID8/ICcnLCAxMCkpO1xuICAgICAgICBpLS07ICAvLyBQYXJzZSB0aGlzIGNoYXIgYWdhaW4uXG4gICAgICAgIHN0YXRlID0gMDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAzKSB7ICAvLyBTdHJpbmcgdGFibGUgcmVmZXJlbmNlXG4gICAgICBpZiAoYyA9PT0gJycpIHtcbiAgICAgICAgLy8gUHJlbWF0dXJlIGVuZCBiZWZvcmUgY2xvc2luZyAnfSdcbiAgICAgICAgYnVmZmVyLnNwbGljZSgwLCAwLCAnJXsnKTsgIC8vIFJlLWluc2VydCBsZWFkaW5nIGRlbGltaXRlclxuICAgICAgICBpLS07ICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2UgdGhpcyBjaGFyIGFnYWluLlxuICAgICAgICBzdGF0ZSA9IDA7ICAgICAgICAgICAgICAgICAgLy8gYW5kIHBhcnNlIGFzIHN0cmluZyBsaXRlcmFsLlxuICAgICAgfSBlbHNlIGlmIChjICE9PSAnfScpIHtcbiAgICAgICAgYnVmZmVyLnB1c2goYyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByYXdLZXkgPSBidWZmZXIuam9pbignJyk7XG4gICAgICAgIGlmICgvW0EtWl1cXHcqL2kudGVzdChyYXdLZXkpKSB7ICAvLyBTdHJpY3QgbWF0Y2hpbmdcbiAgICAgICAgICAvLyBGb3VuZCBhIHZhbGlkIHN0cmluZyBrZXkuIEF0dGVtcHQgY2FzZSBpbnNlbnNpdGl2ZSBtYXRjaC5cbiAgICAgICAgICBjb25zdCBrZXlVcHBlciA9IHJhd0tleS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICAgICAgLy8gQktZXyBpcyB0aGUgcHJlZml4IHVzZWQgdG8gbmFtZXNwYWNlIHRoZSBzdHJpbmdzIHVzZWQgaW5cbiAgICAgICAgICAvLyBCbG9ja2x5IGNvcmUgZmlsZXMgYW5kIHRoZSBwcmVkZWZpbmVkIGJsb2NrcyBpbiAuLi9ibG9ja3MvLlxuICAgICAgICAgIC8vIFRoZXNlIHN0cmluZ3MgYXJlIGRlZmluZWQgaW4gLi4vbXNncy8gZmlsZXMuXG4gICAgICAgICAgY29uc3QgYmtseUtleSA9XG4gICAgICAgICAgICAgIGtleVVwcGVyLnN0YXJ0c1dpdGgoJ0JLWV8nKSA/IGtleVVwcGVyLnN1YnN0cmluZyg0KSA6IG51bGw7XG4gICAgICAgICAgaWYgKGJrbHlLZXkgJiYgYmtseUtleSBpbiBNc2cpIHtcbiAgICAgICAgICAgIGNvbnN0IHJhd1ZhbHVlID0gTXNnW2JrbHlLZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByYXdWYWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBkZXJlZmVyZW5jZSBzdWJzdHJpbmdzLCB0b28sIGFwcGVuZGluZyB0byB0aGVcbiAgICAgICAgICAgICAgLy8gZW5kLlxuICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShcbiAgICAgICAgICAgICAgICAgIHRva2VucyxcbiAgICAgICAgICAgICAgICAgIHRva2VuaXplSW50ZXJwb2xhdGlvbkludGVybmFsKFxuICAgICAgICAgICAgICAgICAgICAgIHJhd1ZhbHVlLCBwYXJzZUludGVycG9sYXRpb25Ub2tlbnMpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyc2VJbnRlcnBvbGF0aW9uVG9rZW5zKSB7XG4gICAgICAgICAgICAgIC8vIFdoZW4gcGFyc2luZyBpbnRlcnBvbGF0aW9uIHRva2VucywgbnVtYmVycyBhcmUgc3BlY2lhbFxuICAgICAgICAgICAgICAvLyBwbGFjZWhvbGRlcnMgKCUxLCAlMiwgZXRjKS4gTWFrZSBzdXJlIGFsbCBvdGhlciB2YWx1ZXMgYXJlXG4gICAgICAgICAgICAgIC8vIHN0cmluZ3MuXG4gICAgICAgICAgICAgIHRva2Vucy5wdXNoKFN0cmluZyhyYXdWYWx1ZSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2gocmF3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBObyBlbnRyeSBmb3VuZCBpbiB0aGUgc3RyaW5nIHRhYmxlLiBQYXNzIHJlZmVyZW5jZSBhcyBzdHJpbmcuXG4gICAgICAgICAgICB0b2tlbnMucHVzaCgnJXsnICsgcmF3S2V5ICsgJ30nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7ICAvLyBDbGVhciB0aGUgYXJyYXlcbiAgICAgICAgICBzdGF0ZSA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG9rZW5zLnB1c2goJyV7JyArIHJhd0tleSArICd9Jyk7XG4gICAgICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7XG4gICAgICAgICAgc3RhdGUgPSAwOyAgLy8gYW5kIHBhcnNlIGFzIHN0cmluZyBsaXRlcmFsLlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGxldCB0ZXh0ID0gYnVmZmVyLmpvaW4oJycpO1xuICBpZiAodGV4dCkge1xuICAgIHRva2Vucy5wdXNoKHRleHQpO1xuICB9XG5cbiAgLy8gTWVyZ2UgYWRqYWNlbnQgdGV4dCB0b2tlbnMgaW50byBhIHNpbmdsZSBzdHJpbmcuXG4gIGNvbnN0IG1lcmdlZFRva2VucyA9IFtdO1xuICBidWZmZXIubGVuZ3RoID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodHlwZW9mIHRva2Vuc1tpXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGJ1ZmZlci5wdXNoKHRva2Vuc1tpXSBhcyBzdHJpbmcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZXh0ID0gYnVmZmVyLmpvaW4oJycpO1xuICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgbWVyZ2VkVG9rZW5zLnB1c2godGV4dCk7XG4gICAgICB9XG4gICAgICBidWZmZXIubGVuZ3RoID0gMDtcbiAgICAgIG1lcmdlZFRva2Vucy5wdXNoKHRva2Vuc1tpXSk7XG4gICAgfVxuICB9XG4gIHRleHQgPSBidWZmZXIuam9pbignJyk7XG4gIGlmICh0ZXh0KSB7XG4gICAgbWVyZ2VkVG9rZW5zLnB1c2godGV4dCk7XG4gIH1cbiAgYnVmZmVyLmxlbmd0aCA9IDA7XG5cbiAgcmV0dXJuIG1lcmdlZFRva2Vucztcbn1cblxuLyoqXG4gKiBQYXJzZSBhIHN0cmluZyB3aXRoIGFueSBudW1iZXIgb2YgaW50ZXJwb2xhdGlvbiB0b2tlbnMgKCUxLCAlMiwgLi4uKS5cbiAqIEl0IHdpbGwgYWxzbyByZXBsYWNlIHN0cmluZyB0YWJsZSByZWZlcmVuY2VzIChlLmcuLCAle2JreV9teV9tc2d9IGFuZFxuICogJXtCS1lfTVlfTVNHfSB3aWxsIGJvdGggYmUgcmVwbGFjZWQgd2l0aCB0aGUgdmFsdWUgaW5cbiAqIE1zZ1snTVlfTVNHJ10pLiBQZXJjZW50YWdlIHNpZ24gY2hhcmFjdGVycyAnJScgbWF5IGJlIHNlbGYtZXNjYXBlZFxuICogKGUuZy4sICclJScpLlxuICpcbiAqIEBwYXJhbSBtZXNzYWdlIFRleHQgd2hpY2ggbWlnaHQgY29udGFpbiBzdHJpbmcgdGFibGUgcmVmZXJlbmNlcyBhbmRcbiAqICAgICBpbnRlcnBvbGF0aW9uIHRva2Vucy5cbiAqIEByZXR1cm5zIEFycmF5IG9mIHN0cmluZ3MgYW5kIG51bWJlcnMuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5wYXJzaW5nLnRva2VuaXplSW50ZXJwb2xhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9rZW5pemVJbnRlcnBvbGF0aW9uKG1lc3NhZ2U6IHN0cmluZyk6IChzdHJpbmd8bnVtYmVyKVtdIHtcbiAgcmV0dXJuIHRva2VuaXplSW50ZXJwb2xhdGlvbkludGVybmFsKG1lc3NhZ2UsIHRydWUpO1xufVxuXG4vKipcbiAqIFJlcGxhY2VzIHN0cmluZyB0YWJsZSByZWZlcmVuY2VzIGluIGEgbWVzc2FnZSwgaWYgdGhlIG1lc3NhZ2UgaXMgYSBzdHJpbmcuXG4gKiBGb3IgZXhhbXBsZSwgXCIle2JreV9teV9tc2d9XCIgYW5kIFwiJXtCS1lfTVlfTVNHfVwiIHdpbGwgYm90aCBiZSByZXBsYWNlZCB3aXRoXG4gKiB0aGUgdmFsdWUgaW4gTXNnWydNWV9NU0cnXS5cbiAqXG4gKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlLCB3aGljaCBtYXkgYmUgYSBzdHJpbmcgdGhhdCBjb250YWluc1xuICogICAgIHN0cmluZyB0YWJsZSByZWZlcmVuY2VzLlxuICogQHJldHVybnMgU3RyaW5nIHdpdGggbWVzc2FnZSByZWZlcmVuY2VzIHJlcGxhY2VkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMucGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcyhtZXNzYWdlOiBzdHJpbmd8YW55KTogc3RyaW5nIHtcbiAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBtZXNzYWdlO1xuICB9XG4gIGNvbnN0IGludGVycG9sYXRlZFJlc3VsdCA9IHRva2VuaXplSW50ZXJwb2xhdGlvbkludGVybmFsKG1lc3NhZ2UsIGZhbHNlKTtcbiAgLy8gV2hlbiBwYXJzZUludGVycG9sYXRpb25Ub2tlbnMgPT09IGZhbHNlLCBpbnRlcnBvbGF0ZWRSZXN1bHQgc2hvdWxkIGJlIGF0XG4gIC8vIG1vc3QgbGVuZ3RoIDEuXG4gIHJldHVybiBpbnRlcnBvbGF0ZWRSZXN1bHQubGVuZ3RoID8gU3RyaW5nKGludGVycG9sYXRlZFJlc3VsdFswXSkgOiAnJztcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBhbnkgJXtNU0dfS0VZfSByZWZlcmVuY2VzIGluIHRoZSBtZXNzYWdlIHJlZmVyIHRvIGtleXMgb2ZcbiAqIHRoZSBNc2cgc3RyaW5nIHRhYmxlLlxuICpcbiAqIEBwYXJhbSBtZXNzYWdlIFRleHQgd2hpY2ggbWlnaHQgY29udGFpbiBzdHJpbmcgdGFibGUgcmVmZXJlbmNlcy5cbiAqIEByZXR1cm5zIFRydWUgaWYgYWxsIG1lc3NhZ2UgcmVmZXJlbmNlcyBoYXZlIG1hdGNoaW5nIHZhbHVlcy5cbiAqICAgICBPdGhlcndpc2UsIGZhbHNlLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMucGFyc2luZy5jaGVja01lc3NhZ2VSZWZlcmVuY2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjaGVja01lc3NhZ2VSZWZlcmVuY2VzKG1lc3NhZ2U6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBsZXQgdmFsaWRTb0ZhciA9IHRydWU7XG5cbiAgY29uc3QgbXNnVGFibGUgPSBNc2c7XG4gIC8vIFRPRE8gKCMxMTY5KTogSW1wbGVtZW50IHN1cHBvcnQgZm9yIG90aGVyIHN0cmluZyB0YWJsZXMsXG4gIC8vIHByZWZpeGVzIG90aGVyIHRoYW4gQktZXy5cbiAgY29uc3QgbSA9IG1lc3NhZ2UubWF0Y2goLyV7QktZX1tBLVpdXFx3Kn0vaWcpO1xuICBpZiAobSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbXNnS2V5ID0gbVtpXS50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKG1zZ1RhYmxlW21zZ0tleS5zbGljZSg2LCAtMSldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdObyBtZXNzYWdlIHN0cmluZyBmb3IgJyArIG1baV0gKyAnIGluICcgKyBtZXNzYWdlKTtcbiAgICAgICAgdmFsaWRTb0ZhciA9IGZhbHNlOyAgLy8gQ29udGludWUgdG8gcmVwb3J0IG90aGVyIGVycm9ycy5cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdmFsaWRTb0Zhcjtcbn1cblxuLyoqXG4gKiBQYXJzZSBhIGJsb2NrIGNvbG91ciBmcm9tIGEgbnVtYmVyIG9yIHN0cmluZywgYXMgcHJvdmlkZWQgaW4gYSBibG9ja1xuICogZGVmaW5pdGlvbi5cbiAqXG4gKiBAcGFyYW0gY29sb3VyIEhTViBodWUgdmFsdWUgKDAgdG8gMzYwKSwgI1JSR0dCQiBzdHJpbmcsXG4gKiAgICAgb3IgYSBtZXNzYWdlIHJlZmVyZW5jZSBzdHJpbmcgcG9pbnRpbmcgdG8gb25lIG9mIHRob3NlIHR3byB2YWx1ZXMuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgY29sb3VyIGFzXG4gKiAgICAgYSAjUlJHR0JCIHN0cmluZywgYW5kIHRoZSBodWUgaWYgdGhlIGlucHV0IHdhcyBhbiBIU1YgaHVlIHZhbHVlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb2xvdXIgY2Fubm90IGJlIHBhcnNlZC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnBhcnNpbmcucGFyc2VCbG9ja0NvbG91clxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VCbG9ja0NvbG91cihjb2xvdXI6IG51bWJlcnxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyk6IHtodWU6IG51bWJlcnxudWxsLCBoZXg6IHN0cmluZ30ge1xuICBjb25zdCBkZXJlZmVyZW5jZWQgPVxuICAgICAgdHlwZW9mIGNvbG91ciA9PT0gJ3N0cmluZycgPyByZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMoY29sb3VyKSA6IGNvbG91cjtcblxuICBjb25zdCBodWUgPSBOdW1iZXIoZGVyZWZlcmVuY2VkKTtcbiAgaWYgKCFpc05hTihodWUpICYmIDAgPD0gaHVlICYmIGh1ZSA8PSAzNjApIHtcbiAgICByZXR1cm4ge1xuICAgICAgaHVlOiBodWUsXG4gICAgICBoZXg6IGNvbG91clV0aWxzLmhzdlRvSGV4KFxuICAgICAgICAgIGh1ZSwgY29sb3VyVXRpbHMuZ2V0SHN2U2F0dXJhdGlvbigpLCBjb2xvdXJVdGlscy5nZXRIc3ZWYWx1ZSgpICogMjU1KSxcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGhleCA9IGNvbG91clV0aWxzLnBhcnNlKGRlcmVmZXJlbmNlZCk7XG4gICAgaWYgKGhleCkge1xuICAgICAgLy8gT25seSBzdG9yZSBodWUgaWYgY29sb3VyIGlzIHNldCBhcyBhIGh1ZS5cbiAgICAgIHJldHVybiB7aHVlOiBudWxsLCBoZXg6IGhleH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBlcnJvck1zZyA9ICdJbnZhbGlkIGNvbG91cjogXCInICsgZGVyZWZlcmVuY2VkICsgJ1wiJztcbiAgICAgIGlmIChjb2xvdXIgIT09IGRlcmVmZXJlbmNlZCkge1xuICAgICAgICBlcnJvck1zZyArPSAnIChmcm9tIFwiJyArIGNvbG91ciArICdcIiknO1xuICAgICAgfVxuICAgICAgdGhyb3cgRXJyb3IoZXJyb3JNc2cpO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTMgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEEgZGl2IHRoYXQgZmxvYXRzIG9uIHRvcCBvZiBCbG9ja2x5LiAgVGhpcyBzaW5nbGV0b24gY29udGFpbnNcbiAqICAgICB0ZW1wb3JhcnkgSFRNTCBVSSB3aWRnZXRzIHRoYXQgdGhlIHVzZXIgaXMgY3VycmVudGx5IGludGVyYWN0aW5nIHdpdGguXG4gKiAgICAgRS5nLiB0ZXh0IGlucHV0IGFyZWFzLCBjb2xvdXIgcGlja2VycywgY29udGV4dCBtZW51cy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuV2lkZ2V0RGl2XG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuV2lkZ2V0RGl2Jyk7XG5cbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHR5cGUge1JlY3R9IGZyb20gJy4vdXRpbHMvcmVjdC5qcyc7XG5pbXBvcnQgdHlwZSB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqIFRoZSBvYmplY3QgY3VycmVudGx5IHVzaW5nIHRoaXMgY29udGFpbmVyLiAqL1xubGV0IG93bmVyOiB1bmtub3duID0gbnVsbDtcblxuLyoqIE9wdGlvbmFsIGNsZWFudXAgZnVuY3Rpb24gc2V0IGJ5IHdoaWNoZXZlciBvYmplY3QgdXNlcyB0aGUgd2lkZ2V0LiAqL1xubGV0IGRpc3Bvc2U6ICgoKSA9PiB2b2lkKXxudWxsID0gbnVsbDtcblxuLyoqIEEgY2xhc3MgbmFtZSByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgb3duZXIncyB3b3Jrc3BhY2UgcmVuZGVyZXIuICovXG5sZXQgcmVuZGVyZXJDbGFzc05hbWUgPSAnJztcblxuLyoqIEEgY2xhc3MgbmFtZSByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgb3duZXIncyB3b3Jrc3BhY2UgdGhlbWUuICovXG5sZXQgdGhlbWVDbGFzc05hbWUgPSAnJztcblxuLyoqIFRoZSBIVE1MIGNvbnRhaW5lciBmb3IgcG9wdXAgb3ZlcmxheXMgKGUuZy4gZWRpdG9yIHdpZGdldHMpLiAqL1xubGV0IGNvbnRhaW5lckRpdjogSFRNTERpdkVsZW1lbnR8bnVsbDtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBIVE1MIGNvbnRhaW5lciBmb3IgZWRpdG9yIHdpZGdldHMuXG4gKlxuICogQHJldHVybnMgVGhlIGVkaXRvciB3aWRnZXQgY29udGFpbmVyLlxuICogQGFsaWFzIEJsb2NrbHkuV2lkZ2V0RGl2LmdldERpdlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGl2KCk6IEhUTUxEaXZFbGVtZW50fG51bGwge1xuICByZXR1cm4gY29udGFpbmVyRGl2O1xufVxuXG4vKipcbiAqIEFsbG93cyB1bml0IHRlc3RzIHRvIHJlc2V0IHRoZSBkaXYuIERvIG5vdCB1c2Ugb3V0c2lkZSBvZiB0ZXN0cy5cbiAqXG4gKiBAcGFyYW0gbmV3RGl2IFRoZSBuZXcgdmFsdWUgZm9yIHRoZSBESVYgZmllbGQuXG4gKiBAYWxpYXMgQmxvY2tseS5XaWRnZXREaXYudGVzdE9ubHlfc2V0RGl2XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRlc3RPbmx5X3NldERpdihuZXdEaXY6IEhUTUxEaXZFbGVtZW50fG51bGwpIHtcbiAgY29udGFpbmVyRGl2ID0gbmV3RGl2O1xufVxuXG4vKipcbiAqIENyZWF0ZSB0aGUgd2lkZ2V0IGRpdiBhbmQgaW5qZWN0IGl0IG9udG8gdGhlIHBhZ2UuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuV2lkZ2V0RGl2LmNyZWF0ZURvbVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRG9tKCkge1xuICBpZiAoY29udGFpbmVyRGl2KSB7XG4gICAgcmV0dXJuOyAgLy8gQWxyZWFkeSBjcmVhdGVkLlxuICB9XG5cbiAgY29udGFpbmVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykgYXMgSFRNTERpdkVsZW1lbnQ7XG4gIGNvbnRhaW5lckRpdi5jbGFzc05hbWUgPSAnYmxvY2tseVdpZGdldERpdic7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGNvbW1vbi5nZXRQYXJlbnRDb250YWluZXIoKSB8fCBkb2N1bWVudC5ib2R5O1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyRGl2KTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIGFuZCBkaXNwbGF5IHRoZSB3aWRnZXQgZGl2LiAgQ2xvc2UgdGhlIG9sZCBvbmUgaWYgbmVlZGVkLlxuICpcbiAqIEBwYXJhbSBuZXdPd25lciBUaGUgb2JqZWN0IHRoYXQgd2lsbCBiZSB1c2luZyB0aGlzIGNvbnRhaW5lci5cbiAqIEBwYXJhbSBydGwgUmlnaHQtdG8tbGVmdCAodHJ1ZSkgb3IgbGVmdC10by1yaWdodCAoZmFsc2UpLlxuICogQHBhcmFtIG5ld0Rpc3Bvc2UgT3B0aW9uYWwgY2xlYW51cCBmdW5jdGlvbiB0byBiZSBydW4gd2hlbiB0aGUgd2lkZ2V0IGlzXG4gKiAgICAgY2xvc2VkLlxuICogQGFsaWFzIEJsb2NrbHkuV2lkZ2V0RGl2LnNob3dcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3cobmV3T3duZXI6IHVua25vd24sIHJ0bDogYm9vbGVhbiwgbmV3RGlzcG9zZTogKCkgPT4gdm9pZCkge1xuICBoaWRlKCk7XG4gIG93bmVyID0gbmV3T3duZXI7XG4gIGRpc3Bvc2UgPSBuZXdEaXNwb3NlO1xuICBjb25zdCBkaXYgPSBjb250YWluZXJEaXY7XG4gIGlmICghZGl2KSByZXR1cm47XG4gIGRpdi5zdHlsZS5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInO1xuICBkaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIGNvbnN0IG1haW5Xb3Jrc3BhY2UgPSBjb21tb24uZ2V0TWFpbldvcmtzcGFjZSgpIGFzIFdvcmtzcGFjZVN2ZztcbiAgcmVuZGVyZXJDbGFzc05hbWUgPSBtYWluV29ya3NwYWNlLmdldFJlbmRlcmVyKCkuZ2V0Q2xhc3NOYW1lKCk7XG4gIHRoZW1lQ2xhc3NOYW1lID0gbWFpbldvcmtzcGFjZS5nZXRUaGVtZSgpLmdldENsYXNzTmFtZSgpO1xuICBpZiAocmVuZGVyZXJDbGFzc05hbWUpIHtcbiAgICBkb20uYWRkQ2xhc3MoZGl2LCByZW5kZXJlckNsYXNzTmFtZSk7XG4gIH1cbiAgaWYgKHRoZW1lQ2xhc3NOYW1lKSB7XG4gICAgZG9tLmFkZENsYXNzKGRpdiwgdGhlbWVDbGFzc05hbWUpO1xuICB9XG59XG5cbi8qKlxuICogRGVzdHJveSB0aGUgd2lkZ2V0IGFuZCBoaWRlIHRoZSBkaXYuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuV2lkZ2V0RGl2LmhpZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGUoKSB7XG4gIGlmICghaXNWaXNpYmxlKCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb3duZXIgPSBudWxsO1xuXG4gIGNvbnN0IGRpdiA9IGNvbnRhaW5lckRpdjtcbiAgaWYgKCFkaXYpIHJldHVybjtcbiAgZGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIGRpdi5zdHlsZS5sZWZ0ID0gJyc7XG4gIGRpdi5zdHlsZS50b3AgPSAnJztcbiAgZGlzcG9zZSAmJiBkaXNwb3NlKCk7XG4gIGRpc3Bvc2UgPSBudWxsO1xuICBkaXYudGV4dENvbnRlbnQgPSAnJztcblxuICBpZiAocmVuZGVyZXJDbGFzc05hbWUpIHtcbiAgICBkb20ucmVtb3ZlQ2xhc3MoZGl2LCByZW5kZXJlckNsYXNzTmFtZSk7XG4gICAgcmVuZGVyZXJDbGFzc05hbWUgPSAnJztcbiAgfVxuICBpZiAodGhlbWVDbGFzc05hbWUpIHtcbiAgICBkb20ucmVtb3ZlQ2xhc3MoZGl2LCB0aGVtZUNsYXNzTmFtZSk7XG4gICAgdGhlbWVDbGFzc05hbWUgPSAnJztcbiAgfVxuICAoY29tbW9uLmdldE1haW5Xb3Jrc3BhY2UoKSBhcyBXb3Jrc3BhY2VTdmcpLm1hcmtGb2N1c2VkKCk7XG59XG5cbi8qKlxuICogSXMgdGhlIGNvbnRhaW5lciB2aXNpYmxlP1xuICpcbiAqIEByZXR1cm5zIFRydWUgaWYgdmlzaWJsZS5cbiAqIEBhbGlhcyBCbG9ja2x5LldpZGdldERpdi5pc1Zpc2libGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVmlzaWJsZSgpOiBib29sZWFuIHtcbiAgcmV0dXJuICEhb3duZXI7XG59XG5cbi8qKlxuICogRGVzdHJveSB0aGUgd2lkZ2V0IGFuZCBoaWRlIHRoZSBkaXYgaWYgaXQgaXMgYmVpbmcgdXNlZCBieSB0aGUgc3BlY2lmaWVkXG4gKiBvYmplY3QuXG4gKlxuICogQHBhcmFtIG9sZE93bmVyIFRoZSBvYmplY3QgdGhhdCB3YXMgdXNpbmcgdGhpcyBjb250YWluZXIuXG4gKiBAYWxpYXMgQmxvY2tseS5XaWRnZXREaXYuaGlkZUlmT3duZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGVJZk93bmVyKG9sZE93bmVyOiB1bmtub3duKSB7XG4gIGlmIChvd25lciA9PT0gb2xkT3duZXIpIHtcbiAgICBoaWRlKCk7XG4gIH1cbn1cbi8qKlxuICogU2V0IHRoZSB3aWRnZXQgZGl2J3MgcG9zaXRpb24gYW5kIGhlaWdodC4gIFRoaXMgZnVuY3Rpb24gZG9lcyBub3RoaW5nIGNsZXZlcjpcbiAqIGl0IHdpbGwgbm90IGVuc3VyZSB0aGF0IHlvdXIgd2lkZ2V0IGRpdiBlbmRzIHVwIGluIHRoZSB2aXNpYmxlIHdpbmRvdy5cbiAqXG4gKiBAcGFyYW0geCBIb3Jpem9udGFsIGxvY2F0aW9uICh3aW5kb3cgY29vcmRpbmF0ZXMsIG5vdCBib2R5KS5cbiAqIEBwYXJhbSB5IFZlcnRpY2FsIGxvY2F0aW9uICh3aW5kb3cgY29vcmRpbmF0ZXMsIG5vdCBib2R5KS5cbiAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgd2lkZ2V0IGRpdiAocGl4ZWxzKS5cbiAqL1xuZnVuY3Rpb24gcG9zaXRpb25JbnRlcm5hbCh4OiBudW1iZXIsIHk6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgY29udGFpbmVyRGl2IS5zdHlsZS5sZWZ0ID0geCArICdweCc7XG4gIGNvbnRhaW5lckRpdiEuc3R5bGUudG9wID0geSArICdweCc7XG4gIGNvbnRhaW5lckRpdiEuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4Jztcbn1cblxuLyoqXG4gKiBQb3NpdGlvbiB0aGUgd2lkZ2V0IGRpdiBiYXNlZCBvbiBhbiBhbmNob3IgcmVjdGFuZ2xlLlxuICogVGhlIHdpZGdldCBzaG91bGQgYmUgcGxhY2VkIGFkamFjZW50IHRvIGJ1dCBub3Qgb3ZlcmxhcHBpbmcgdGhlIGFuY2hvclxuICogcmVjdGFuZ2xlLiAgVGhlIHByZWZlcnJlZCBwb3NpdGlvbiBpcyBkaXJlY3RseSBiZWxvdyBhbmQgYWxpZ25lZCB0byB0aGUgbGVmdFxuICogKExUUikgb3IgcmlnaHQgKFJUTCkgc2lkZSBvZiB0aGUgYW5jaG9yLlxuICpcbiAqIEBwYXJhbSB2aWV3cG9ydEJCb3ggVGhlIGJvdW5kaW5nIHJlY3RhbmdsZSBvZiB0aGUgY3VycmVudCB2aWV3cG9ydCwgaW4gd2luZG93XG4gKiAgICAgY29vcmRpbmF0ZXMuXG4gKiBAcGFyYW0gYW5jaG9yQkJveCBUaGUgYm91bmRpbmcgcmVjdGFuZ2xlIG9mIHRoZSBhbmNob3IsIGluIHdpbmRvd1xuICogICAgIGNvb3JkaW5hdGVzLlxuICogQHBhcmFtIHdpZGdldFNpemUgVGhlIHNpemUgb2YgdGhlIHdpZGdldCB0aGF0IGlzIGluc2lkZSB0aGUgd2lkZ2V0IGRpdiwgaW5cbiAqICAgICB3aW5kb3cgY29vcmRpbmF0ZXMuXG4gKiBAcGFyYW0gcnRsIFdoZXRoZXIgdGhlIHdvcmtzcGFjZSBpcyBpbiBSVEwgbW9kZS4gIFRoaXMgZGV0ZXJtaW5lcyBob3Jpem9udGFsXG4gKiAgICAgYWxpZ25tZW50LlxuICogQGFsaWFzIEJsb2NrbHkuV2lkZ2V0RGl2LnBvc2l0aW9uV2l0aEFuY2hvclxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwb3NpdGlvbldpdGhBbmNob3IoXG4gICAgdmlld3BvcnRCQm94OiBSZWN0LCBhbmNob3JCQm94OiBSZWN0LCB3aWRnZXRTaXplOiBTaXplLCBydGw6IGJvb2xlYW4pIHtcbiAgY29uc3QgeSA9IGNhbGN1bGF0ZVkodmlld3BvcnRCQm94LCBhbmNob3JCQm94LCB3aWRnZXRTaXplKTtcbiAgY29uc3QgeCA9IGNhbGN1bGF0ZVgodmlld3BvcnRCQm94LCBhbmNob3JCQm94LCB3aWRnZXRTaXplLCBydGwpO1xuXG4gIGlmICh5IDwgMCkge1xuICAgIHBvc2l0aW9uSW50ZXJuYWwoeCwgMCwgd2lkZ2V0U2l6ZS5oZWlnaHQgKyB5KTtcbiAgfSBlbHNlIHtcbiAgICBwb3NpdGlvbkludGVybmFsKHgsIHksIHdpZGdldFNpemUuaGVpZ2h0KTtcbiAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBhbiB4IHBvc2l0aW9uIChpbiB3aW5kb3cgY29vcmRpbmF0ZXMpIHN1Y2ggdGhhdCB0aGUgd2lkZ2V0IHdpbGwgbm90XG4gKiBiZSBvZmZzY3JlZW4gb24gdGhlIHJpZ2h0IG9yIGxlZnQuXG4gKlxuICogQHBhcmFtIHZpZXdwb3J0QkJveCBUaGUgYm91bmRpbmcgcmVjdGFuZ2xlIG9mIHRoZSBjdXJyZW50IHZpZXdwb3J0LCBpbiB3aW5kb3dcbiAqICAgICBjb29yZGluYXRlcy5cbiAqIEBwYXJhbSBhbmNob3JCQm94IFRoZSBib3VuZGluZyByZWN0YW5nbGUgb2YgdGhlIGFuY2hvciwgaW4gd2luZG93XG4gKiAgICAgY29vcmRpbmF0ZXMuXG4gKiBAcGFyYW0gd2lkZ2V0U2l6ZSBUaGUgZGltZW5zaW9ucyBvZiB0aGUgd2lkZ2V0IGluc2lkZSB0aGUgd2lkZ2V0IGRpdi5cbiAqIEBwYXJhbSBydGwgV2hldGhlciB0aGUgQmxvY2tseSB3b3Jrc3BhY2UgaXMgaW4gUlRMIG1vZGUuXG4gKiBAcmV0dXJucyBBIHZhbGlkIHgtY29vcmRpbmF0ZSBmb3IgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgd2lkZ2V0IGRpdiwgaW5cbiAqICAgICB3aW5kb3cgY29vcmRpbmF0ZXMuXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZVgoXG4gICAgdmlld3BvcnRCQm94OiBSZWN0LCBhbmNob3JCQm94OiBSZWN0LCB3aWRnZXRTaXplOiBTaXplLFxuICAgIHJ0bDogYm9vbGVhbik6IG51bWJlciB7XG4gIGlmIChydGwpIHtcbiAgICAvLyBUcnkgdG8gYWxpZ24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIGZpZWxkIGFuZCB0aGUgcmlnaHQgc2lkZSBvZiB3aWRnZXQuXG4gICAgY29uc3Qgd2lkZ2V0TGVmdCA9IGFuY2hvckJCb3gucmlnaHQgLSB3aWRnZXRTaXplLndpZHRoO1xuICAgIC8vIERvbid0IGdvIG9mZnNjcmVlbiBsZWZ0LlxuICAgIGNvbnN0IHggPSBNYXRoLm1heCh3aWRnZXRMZWZ0LCB2aWV3cG9ydEJCb3gubGVmdCk7XG4gICAgLy8gQnV0IHJlYWxseSBkb24ndCBnbyBvZmZzY3JlZW4gcmlnaHQ6XG4gICAgcmV0dXJuIE1hdGgubWluKHgsIHZpZXdwb3J0QkJveC5yaWdodCAtIHdpZGdldFNpemUud2lkdGgpO1xuICB9IGVsc2Uge1xuICAgIC8vIFRyeSB0byBhbGlnbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBmaWVsZCBhbmQgdGhlIGxlZnQgc2lkZSBvZiB3aWRnZXQuXG4gICAgLy8gRG9uJ3QgZ28gb2Zmc2NyZWVuIHJpZ2h0LlxuICAgIGNvbnN0IHggPSBNYXRoLm1pbihhbmNob3JCQm94LmxlZnQsIHZpZXdwb3J0QkJveC5yaWdodCAtIHdpZGdldFNpemUud2lkdGgpO1xuICAgIC8vIEJ1dCBsZWZ0IGlzIG1vcmUgaW1wb3J0YW50LCBiZWNhdXNlIHRoYXQncyB3aGVyZSB0aGUgdGV4dCBpcy5cbiAgICByZXR1cm4gTWF0aC5tYXgoeCwgdmlld3BvcnRCQm94LmxlZnQpO1xuICB9XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGEgeSBwb3NpdGlvbiAoaW4gd2luZG93IGNvb3JkaW5hdGVzKSBzdWNoIHRoYXQgdGhlIHdpZGdldCB3aWxsIG5vdFxuICogYmUgb2Zmc2NyZWVuIG9uIHRoZSB0b3Agb3IgYm90dG9tLlxuICpcbiAqIEBwYXJhbSB2aWV3cG9ydEJCb3ggVGhlIGJvdW5kaW5nIHJlY3RhbmdsZSBvZiB0aGUgY3VycmVudCB2aWV3cG9ydCwgaW4gd2luZG93XG4gKiAgICAgY29vcmRpbmF0ZXMuXG4gKiBAcGFyYW0gYW5jaG9yQkJveCBUaGUgYm91bmRpbmcgcmVjdGFuZ2xlIG9mIHRoZSBhbmNob3IsIGluIHdpbmRvd1xuICogICAgIGNvb3JkaW5hdGVzLlxuICogQHBhcmFtIHdpZGdldFNpemUgVGhlIGRpbWVuc2lvbnMgb2YgdGhlIHdpZGdldCBpbnNpZGUgdGhlIHdpZGdldCBkaXYuXG4gKiBAcmV0dXJucyBBIHZhbGlkIHktY29vcmRpbmF0ZSBmb3IgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgd2lkZ2V0IGRpdiwgaW5cbiAqICAgICB3aW5kb3cgY29vcmRpbmF0ZXMuXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZVkoXG4gICAgdmlld3BvcnRCQm94OiBSZWN0LCBhbmNob3JCQm94OiBSZWN0LCB3aWRnZXRTaXplOiBTaXplKTogbnVtYmVyIHtcbiAgLy8gRmxpcCB0aGUgd2lkZ2V0IHZlcnRpY2FsbHkgaWYgb2ZmIHRoZSBib3R0b20uXG4gIC8vIFRoZSB3aWRnZXQgY291bGQgZ28gb2ZmIHRoZSB0b3Agb2YgdGhlIHdpbmRvdywgYnV0IGl0IHdvdWxkIGFsc28gZ28gb2ZmXG4gIC8vIHRoZSBib3R0b20uICBUaGUgd2luZG93IGlzIGp1c3QgdG9vIHNtYWxsLlxuICBpZiAoYW5jaG9yQkJveC5ib3R0b20gKyB3aWRnZXRTaXplLmhlaWdodCA+PSB2aWV3cG9ydEJCb3guYm90dG9tKSB7XG4gICAgLy8gVGhlIGJvdHRvbSBvZiB0aGUgd2lkZ2V0IGlzIGF0IHRoZSB0b3Agb2YgdGhlIGZpZWxkLlxuICAgIHJldHVybiBhbmNob3JCQm94LnRvcCAtIHdpZGdldFNpemUuaGVpZ2h0O1xuICB9IGVsc2Uge1xuICAgIC8vIFRoZSB0b3Agb2YgdGhlIHdpZGdldCBpcyBhdCB0aGUgYm90dG9tIG9mIHRoZSBmaWVsZC5cbiAgICByZXR1cm4gYW5jaG9yQkJveC5ib3R0b207XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBGaWVsZHMgY2FuIGJlIGNyZWF0ZWQgYmFzZWQgb24gYSBKU09OIGRlZmluaXRpb24uIFRoaXMgZmlsZVxuICogICAgY29udGFpbnMgbWV0aG9kcyBmb3IgcmVnaXN0ZXJpbmcgdGhvc2UgSlNPTiBkZWZpbml0aW9ucywgYW5kIGJ1aWxkaW5nIHRoZVxuICogICAgZmllbGRzIGJhc2VkIG9uIEpTT04uXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LmZpZWxkUmVnaXN0cnlcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5maWVsZFJlZ2lzdHJ5Jyk7XG5cbmltcG9ydCB0eXBlIHtGaWVsZCwgRmllbGRQcm90b30gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcblxuaW50ZXJmYWNlIFJlZ2lzdHJ5T3B0aW9ucyB7XG4gIHR5cGU6IHN0cmluZztcbiAgW2tleTogc3RyaW5nXTogdW5rbm93bjtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYSBmaWVsZCB0eXBlLlxuICogZmllbGRSZWdpc3RyeS5mcm9tSnNvbiB1c2VzIHRoaXMgcmVnaXN0cnkgdG9cbiAqIGZpbmQgdGhlIGFwcHJvcHJpYXRlIGZpZWxkIHR5cGUuXG4gKlxuICogQHBhcmFtIHR5cGUgVGhlIGZpZWxkIHR5cGUgbmFtZSBhcyB1c2VkIGluIHRoZSBKU09OIGRlZmluaXRpb24uXG4gKiBAcGFyYW0gZmllbGRDbGFzcyBUaGUgZmllbGQgY2xhc3MgY29udGFpbmluZyBhIGZyb21Kc29uIGZ1bmN0aW9uIHRoYXQgY2FuXG4gKiAgICAgY29uc3RydWN0IGFuIGluc3RhbmNlIG9mIHRoZSBmaWVsZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgdHlwZSBuYW1lIGlzIGVtcHR5LCB0aGUgZmllbGQgaXMgYWxyZWFkeSByZWdpc3RlcmVkLFxuICogICAgIG9yIHRoZSBmaWVsZENsYXNzIGlzIG5vdCBhbiBvYmplY3QgY29udGFpbmluZyBhIGZyb21Kc29uIGZ1bmN0aW9uLlxuICogQGFsaWFzIEJsb2NrbHkuZmllbGRSZWdpc3RyeS5yZWdpc3RlclxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXIodHlwZTogc3RyaW5nLCBmaWVsZENsYXNzOiBGaWVsZFByb3RvKSB7XG4gIHJlZ2lzdHJ5LnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuRklFTEQsIHR5cGUsIGZpZWxkQ2xhc3MpO1xufVxuXG4vKipcbiAqIFVucmVnaXN0ZXJzIHRoZSBmaWVsZCByZWdpc3RlcmVkIHdpdGggdGhlIGdpdmVuIHR5cGUuXG4gKlxuICogQHBhcmFtIHR5cGUgVGhlIGZpZWxkIHR5cGUgbmFtZSBhcyB1c2VkIGluIHRoZSBKU09OIGRlZmluaXRpb24uXG4gKiBAYWxpYXMgQmxvY2tseS5maWVsZFJlZ2lzdHJ5LnVucmVnaXN0ZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVucmVnaXN0ZXIodHlwZTogc3RyaW5nKSB7XG4gIHJlZ2lzdHJ5LnVucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5GSUVMRCwgdHlwZSk7XG59XG5cbi8qKlxuICogQ29uc3RydWN0IGEgRmllbGQgZnJvbSBhIEpTT04gYXJnIG9iamVjdC5cbiAqIEZpbmRzIHRoZSBhcHByb3ByaWF0ZSByZWdpc3RlcmVkIGZpZWxkIGJ5IHRoZSB0eXBlIG5hbWUgYXMgcmVnaXN0ZXJlZCB1c2luZ1xuICogZmllbGRSZWdpc3RyeS5yZWdpc3Rlci5cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyBBIEpTT04gb2JqZWN0IHdpdGggYSB0eXBlIGFuZCBvcHRpb25zIHNwZWNpZmljIHRvIHRoZSBmaWVsZFxuICogICAgIHR5cGUuXG4gKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlIG9yIG51bGwgaWYgYSBmaWVsZCB3YXNuJ3QgZm91bmQgd2l0aCB0aGVcbiAqICAgICBnaXZlbiB0eXBlIG5hbWVcbiAqIEBhbGlhcyBCbG9ja2x5LmZpZWxkUmVnaXN0cnkuZnJvbUpzb25cbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbUpzb248VD4ob3B0aW9uczogUmVnaXN0cnlPcHRpb25zKTogRmllbGQ8VD58bnVsbCB7XG4gIHJldHVybiBURVNUX09OTFkuZnJvbUpzb25JbnRlcm5hbChvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBQcml2YXRlIHZlcnNpb24gb2YgZnJvbUpzb24gZm9yIHN0dWJiaW5nIGluIHRlc3RzLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGZyb21Kc29uSW50ZXJuYWw8VD4ob3B0aW9uczogUmVnaXN0cnlPcHRpb25zKTogRmllbGQ8VD58bnVsbCB7XG4gIGNvbnN0IGZpZWxkT2JqZWN0ID0gcmVnaXN0cnkuZ2V0T2JqZWN0KHJlZ2lzdHJ5LlR5cGUuRklFTEQsIG9wdGlvbnMudHlwZSk7XG4gIGlmICghZmllbGRPYmplY3QpIHtcbiAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdCbG9ja2x5IGNvdWxkIG5vdCBjcmVhdGUgYSBmaWVsZCBvZiB0eXBlICcgKyBvcHRpb25zWyd0eXBlJ10gK1xuICAgICAgICAnLiBUaGUgZmllbGQgaXMgcHJvYmFibHkgbm90IGJlaW5nIHJlZ2lzdGVyZWQuIFRoaXMgY291bGQgYmUgYmVjYXVzZScgK1xuICAgICAgICAnIHRoZSBmaWxlIGlzIG5vdCBsb2FkZWQsIHRoZSBmaWVsZCBkb2VzIG5vdCByZWdpc3RlciBpdHNlbGYgKElzc3VlJyArXG4gICAgICAgICcgIzE1ODQpLCBvciB0aGUgcmVnaXN0cmF0aW9uIGlzIG5vdCBiZWluZyByZWFjaGVkLicpO1xuICAgIHJldHVybiBudWxsO1xuICB9IGVsc2UgaWYgKHR5cGVvZiAoZmllbGRPYmplY3QgYXMgYW55KS5mcm9tSnNvbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3JldHVybmVkIEZpZWxkIHdhcyBub3QgYSBJUmVnaXN0cmFibGVGaWVsZCcpO1xuICB9IGVsc2Uge1xuICAgIHR5cGUgZnJvbUpzb24gPSAob3B0aW9uczoge30pID0+IEZpZWxkPFQ+O1xuICAgIHJldHVybiAoZmllbGRPYmplY3QgYXMgdW5rbm93biBhcyB7ZnJvbUpzb246IGZyb21Kc29ufSkuZnJvbUpzb24ob3B0aW9ucyk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IFRFU1RfT05MWSA9IHtcbiAgZnJvbUpzb25JbnRlcm5hbCxcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQVJJQS1yZWxhdGVkIGNvbnN0YW50cyBhbmQgdXRpbGl0aWVzLlxuICogVGhlc2UgbWV0aG9kcyBhcmUgbm90IHNwZWNpZmljIHRvIEJsb2NrbHksIGFuZCBjb3VsZCBiZSBmYWN0b3JlZCBvdXQgaW50b1xuICogYSBKYXZhU2NyaXB0IGZyYW1ld29yayBzdWNoIGFzIENsb3N1cmUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnV0aWxzLmFyaWFcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5hcmlhJyk7XG5cblxuLyoqIEFSSUEgc3RhdGVzL3Byb3BlcnRpZXMgcHJlZml4LiAqL1xuY29uc3QgQVJJQV9QUkVGSVggPSAnYXJpYS0nO1xuXG4vKiogQVJJQSByb2xlIGF0dHJpYnV0ZS4gKi9cbmNvbnN0IFJPTEVfQVRUUklCVVRFID0gJ3JvbGUnO1xuXG4vKipcbiAqIEFSSUEgcm9sZSB2YWx1ZXMuXG4gKiBDb3BpZWQgZnJvbSBDbG9zdXJlJ3MgZ29vZy5hMTF5LmFyaWEuUm9sZVxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmFyaWEuUm9sZVxuICovXG5leHBvcnQgZW51bSBSb2xlIHtcbiAgLy8gQVJJQSByb2xlIGZvciBhbiBpbnRlcmFjdGl2ZSBjb250cm9sIG9mIHRhYnVsYXIgZGF0YS5cbiAgR1JJRCA9ICdncmlkJyxcblxuICAvLyBBUklBIHJvbGUgZm9yIGEgY2VsbCBpbiBhIGdyaWQuXG4gIEdSSURDRUxMID0gJ2dyaWRjZWxsJyxcbiAgLy8gQVJJQSByb2xlIGZvciBhIGdyb3VwIG9mIHJlbGF0ZWQgZWxlbWVudHMgbGlrZSB0cmVlIGl0ZW0gc2libGluZ3MuXG4gIEdST1VQID0gJ2dyb3VwJyxcblxuICAvLyBBUklBIHJvbGUgZm9yIGEgbGlzdGJveC5cbiAgTElTVEJPWCA9ICdsaXN0Ym94JyxcblxuICAvLyBBUklBIHJvbGUgZm9yIGEgcG9wdXAgbWVudS5cbiAgTUVOVSA9ICdtZW51JyxcblxuICAvLyBBUklBIHJvbGUgZm9yIG1lbnUgaXRlbSBlbGVtZW50cy5cbiAgTUVOVUlURU0gPSAnbWVudWl0ZW0nLFxuICAvLyBBUklBIHJvbGUgZm9yIGEgY2hlY2tib3ggYm94IGVsZW1lbnQgaW5zaWRlIGEgbWVudS5cbiAgTUVOVUlURU1DSEVDS0JPWCA9ICdtZW51aXRlbWNoZWNrYm94JyxcbiAgLy8gQVJJQSByb2xlIGZvciBvcHRpb24gaXRlbXMgdGhhdCBhcmUgIGNoaWxkcmVuIG9mIGNvbWJvYm94LCBsaXN0Ym94LCBtZW51LFxuICAvLyByYWRpb2dyb3VwLCBvciB0cmVlIGVsZW1lbnRzLlxuICBPUFRJT04gPSAnb3B0aW9uJyxcbiAgLy8gQVJJQSByb2xlIGZvciBpZ25vcmFibGUgY29zbWV0aWMgZWxlbWVudHMgd2l0aCBubyBzZW1hbnRpYyBzaWduaWZpY2FuY2UuXG4gIFBSRVNFTlRBVElPTiA9ICdwcmVzZW50YXRpb24nLFxuXG4gIC8vIEFSSUEgcm9sZSBmb3IgYSByb3cgb2YgY2VsbHMgaW4gYSBncmlkLlxuICBST1cgPSAncm93JyxcbiAgLy8gQVJJQSByb2xlIGZvciBhIHRyZWUuXG4gIFRSRUUgPSAndHJlZScsXG5cbiAgLy8gQVJJQSByb2xlIGZvciBhIHRyZWUgaXRlbSB0aGF0IHNvbWV0aW1lcyBtYXkgYmUgZXhwYW5kZWQgb3IgY29sbGFwc2VkLlxuICBUUkVFSVRFTSA9ICd0cmVlaXRlbSdcbn1cblxuLyoqXG4gKiBBUklBIHN0YXRlcyBhbmQgcHJvcGVydGllcy5cbiAqIENvcGllZCBmcm9tIENsb3N1cmUncyBnb29nLmExMXkuYXJpYS5TdGF0ZVxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmFyaWEuU3RhdGVcbiAqL1xuZXhwb3J0IGVudW0gU3RhdGUge1xuICAvLyBBUklBIHByb3BlcnR5IGZvciBzZXR0aW5nIHRoZSBjdXJyZW50bHkgYWN0aXZlIGRlc2NlbmRhbnQgb2YgYW4gZWxlbWVudCxcbiAgLy8gZm9yIGV4YW1wbGUgdGhlIHNlbGVjdGVkIGl0ZW0gaW4gYSBsaXN0IGJveC4gVmFsdWU6IElEIG9mIGFuIGVsZW1lbnQuXG4gIEFDVElWRURFU0NFTkRBTlQgPSAnYWN0aXZlZGVzY2VuZGFudCcsXG4gIC8vIEFSSUEgcHJvcGVydHkgZGVmaW5lcyB0aGUgdG90YWwgbnVtYmVyIG9mIGNvbHVtbnMgaW4gYSB0YWJsZSwgZ3JpZCwgb3JcbiAgLy8gdHJlZWdyaWQuXG4gIC8vIFZhbHVlOiBpbnRlZ2VyLlxuICBDT0xDT1VOVCA9ICdjb2xjb3VudCcsXG4gIC8vIEFSSUEgc3RhdGUgZm9yIGEgZGlzYWJsZWQgaXRlbS4gVmFsdWU6IG9uZSBvZiB7dHJ1ZSwgZmFsc2V9LlxuICBESVNBQkxFRCA9ICdkaXNhYmxlZCcsXG5cbiAgLy8gQVJJQSBzdGF0ZSBmb3Igc2V0dGluZyB3aGV0aGVyIHRoZSBlbGVtZW50IGxpa2UgYSB0cmVlIG5vZGUgaXMgZXhwYW5kZWQuXG4gIC8vIFZhbHVlOiBvbmUgb2Yge3RydWUsIGZhbHNlLCB1bmRlZmluZWR9LlxuICBFWFBBTkRFRCA9ICdleHBhbmRlZCcsXG5cbiAgLy8gQVJJQSBzdGF0ZSBpbmRpY2F0aW5nIHRoYXQgdGhlIGVudGVyZWQgdmFsdWUgZG9lcyBub3QgY29uZm9ybS4gVmFsdWU6XG4gIC8vIG9uZSBvZiB7ZmFsc2UsIHRydWUsICdncmFtbWFyJywgJ3NwZWxsaW5nJ31cbiAgSU5WQUxJRCA9ICdpbnZhbGlkJyxcblxuICAvLyBBUklBIHByb3BlcnR5IHRoYXQgcHJvdmlkZXMgYSBsYWJlbCB0byBvdmVycmlkZSBhbnkgb3RoZXIgdGV4dCwgdmFsdWUsIG9yXG4gIC8vIGNvbnRlbnRzIHVzZWQgdG8gZGVzY3JpYmUgdGhpcyBlbGVtZW50LiBWYWx1ZTogc3RyaW5nLlxuICBMQUJFTCA9ICdsYWJlbCcsXG4gIC8vIEFSSUEgcHJvcGVydHkgZm9yIHNldHRpbmcgdGhlIGVsZW1lbnQgd2hpY2ggbGFiZWxzIGFub3RoZXIgZWxlbWVudC5cbiAgLy8gVmFsdWU6IHNwYWNlLXNlcGFyYXRlZCBJRHMgb2YgZWxlbWVudHMuXG4gIExBQkVMTEVEQlkgPSAnbGFiZWxsZWRieScsXG5cbiAgLy8gQVJJQSBwcm9wZXJ0eSBmb3Igc2V0dGluZyB0aGUgbGV2ZWwgb2YgYW4gZWxlbWVudCBpbiB0aGUgaGllcmFyY2h5LlxuICAvLyBWYWx1ZTogaW50ZWdlci5cbiAgTEVWRUwgPSAnbGV2ZWwnLFxuICAvLyBBUklBIHByb3BlcnR5IGluZGljYXRpbmcgaWYgdGhlIGVsZW1lbnQgaXMgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbC5cbiAgLy8gVmFsdWU6IG9uZSBvZiB7J3ZlcnRpY2FsJywgJ2hvcml6b250YWwnfS5cbiAgT1JJRU5UQVRJT04gPSAnb3JpZW50YXRpb24nLFxuXG4gIC8vIEFSSUEgcHJvcGVydHkgdGhhdCBkZWZpbmVzIGFuIGVsZW1lbnQncyBudW1iZXIgb2YgcG9zaXRpb24gaW4gYSBsaXN0LlxuICAvLyBWYWx1ZTogaW50ZWdlci5cbiAgUE9TSU5TRVQgPSAncG9zaW5zZXQnLFxuXG4gIC8vIEFSSUEgcHJvcGVydHkgZGVmaW5lcyB0aGUgdG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gYSB0YWJsZSwgZ3JpZCwgb3JcbiAgLy8gdHJlZWdyaWQuXG4gIC8vIFZhbHVlOiBpbnRlZ2VyLlxuICBST1dDT1VOVCA9ICdyb3djb3VudCcsXG5cbiAgLy8gQVJJQSBzdGF0ZSBmb3Igc2V0dGluZyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGl0ZW0gaW4gdGhlIGxpc3QuXG4gIC8vIFZhbHVlOiBvbmUgb2Yge3RydWUsIGZhbHNlLCB1bmRlZmluZWR9LlxuICBTRUxFQ1RFRCA9ICdzZWxlY3RlZCcsXG4gIC8vIEFSSUEgcHJvcGVydHkgZGVmaW5pbmcgdGhlIG51bWJlciBvZiBpdGVtcyBpbiBhIGxpc3QuIFZhbHVlOiBpbnRlZ2VyLlxuICBTRVRTSVpFID0gJ3NldHNpemUnLFxuXG4gIC8vIEFSSUEgcHJvcGVydHkgZm9yIHNsaWRlciBtYXhpbXVtIHZhbHVlLiBWYWx1ZTogbnVtYmVyLlxuICBWQUxVRU1BWCA9ICd2YWx1ZW1heCcsXG5cbiAgLy8gQVJJQSBwcm9wZXJ0eSBmb3Igc2xpZGVyIG1pbmltdW0gdmFsdWUuIFZhbHVlOiBudW1iZXIuXG4gIFZBTFVFTUlOID0gJ3ZhbHVlbWluJ1xufVxuXG4vKipcbiAqIFNldHMgdGhlIHJvbGUgb2YgYW4gZWxlbWVudC5cbiAqXG4gKiBTaW1pbGFyIHRvIENsb3N1cmUncyBnb29nLmExMXkuYXJpYVxuICpcbiAqIEBwYXJhbSBlbGVtZW50IERPTSBub2RlIHRvIHNldCByb2xlIG9mLlxuICogQHBhcmFtIHJvbGVOYW1lIFJvbGUgbmFtZS5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLmFyaWEuc2V0Um9sZVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Um9sZShlbGVtZW50OiBFbGVtZW50LCByb2xlTmFtZTogUm9sZSkge1xuICBlbGVtZW50LnNldEF0dHJpYnV0ZShST0xFX0FUVFJJQlVURSwgcm9sZU5hbWUpO1xufVxuXG4vKipcbiAqIFNldHMgdGhlIHN0YXRlIG9yIHByb3BlcnR5IG9mIGFuIGVsZW1lbnQuXG4gKiBDb3BpZWQgZnJvbSBDbG9zdXJlJ3MgZ29vZy5hMTF5LmFyaWFcbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBET00gbm9kZSB3aGVyZSB3ZSBzZXQgc3RhdGUuXG4gKiBAcGFyYW0gc3RhdGVOYW1lIFN0YXRlIGF0dHJpYnV0ZSBiZWluZyBzZXQuXG4gKiAgICAgQXV0b21hdGljYWxseSBhZGRzIHByZWZpeCAnYXJpYS0nIHRvIHRoZSBzdGF0ZSBuYW1lIGlmIHRoZSBhdHRyaWJ1dGUgaXNcbiAqIG5vdCBhbiBleHRyYSBhdHRyaWJ1dGUuXG4gKiBAcGFyYW0gdmFsdWUgVmFsdWUgZm9yIHRoZSBzdGF0ZSBhdHRyaWJ1dGUuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5hcmlhLnNldFN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRTdGF0ZShcbiAgICBlbGVtZW50OiBFbGVtZW50LCBzdGF0ZU5hbWU6IFN0YXRlLCB2YWx1ZTogc3RyaW5nfGJvb2xlYW58bnVtYmVyfHN0cmluZ1tdKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHZhbHVlID0gdmFsdWUuam9pbignICcpO1xuICB9XG4gIGNvbnN0IGF0dHJTdGF0ZU5hbWUgPSBBUklBX1BSRUZJWCArIHN0YXRlTmFtZTtcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoYXR0clN0YXRlTmFtZSwgYCR7dmFsdWV9YCk7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogRHJvcGRvd24gaW5wdXQgZmllbGQuICBVc2VkIGZvciBlZGl0YWJsZSB0aXRsZXMgYW5kIHZhcmlhYmxlcy5cbiAqIEluIHRoZSBpbnRlcmVzdHMgb2YgYSBjb25zaXN0ZW50IFVJLCB0aGUgdG9vbGJveCBzaGFyZXMgc29tZSBmdW5jdGlvbnMgYW5kXG4gKiBwcm9wZXJ0aWVzIHdpdGggdGhlIGNvbnRleHQgbWVudS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GaWVsZERyb3Bkb3duJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgZHJvcERvd25EaXYgZnJvbSAnLi9kcm9wZG93bmRpdi5qcyc7XG5pbXBvcnQge0ZpZWxkLCBGaWVsZENvbmZpZywgRmllbGRWYWxpZGF0b3IsIFVuYXR0YWNoZWRGaWVsZEVycm9yfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCAqIGFzIGZpZWxkUmVnaXN0cnkgZnJvbSAnLi9maWVsZF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge01lbnV9IGZyb20gJy4vbWVudS5qcyc7XG5pbXBvcnQge01lbnVJdGVtfSBmcm9tICcuL21lbnVpdGVtLmpzJztcbmltcG9ydCAqIGFzIGFyaWEgZnJvbSAnLi91dGlscy9hcmlhLmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4vdXRpbHMvcGFyc2luZy5qcyc7XG5pbXBvcnQgdHlwZSB7U2VudGluZWx9IGZyb20gJy4vdXRpbHMvc2VudGluZWwuanMnO1xuaW1wb3J0ICogYXMgdXRpbHNTdHJpbmcgZnJvbSAnLi91dGlscy9zdHJpbmcuanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcblxuZXhwb3J0IHR5cGUgRmllbGREcm9wZG93blZhbGlkYXRvciA9IEZpZWxkVmFsaWRhdG9yPHN0cmluZz47XG5cbi8qKlxuICogQ2xhc3MgZm9yIGFuIGVkaXRhYmxlIGRyb3Bkb3duIGZpZWxkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkZpZWxkRHJvcGRvd25cbiAqL1xuZXhwb3J0IGNsYXNzIEZpZWxkRHJvcGRvd24gZXh0ZW5kcyBGaWVsZDxzdHJpbmc+IHtcbiAgLyoqIEhvcml6b250YWwgZGlzdGFuY2UgdGhhdCBhIGNoZWNrbWFyayBvdmVyaGFuZ3MgdGhlIGRyb3Bkb3duLiAqL1xuICBzdGF0aWMgQ0hFQ0tNQVJLX09WRVJIQU5HID0gMjU7XG5cbiAgLyoqXG4gICAqIE1heGltdW0gaGVpZ2h0IG9mIHRoZSBkcm9wZG93biBtZW51LCBhcyBhIHBlcmNlbnRhZ2Ugb2YgdGhlIHZpZXdwb3J0XG4gICAqIGhlaWdodC5cbiAgICovXG4gIHN0YXRpYyBNQVhfTUVOVV9IRUlHSFRfVkggPSAwLjQ1O1xuXG4gIHN0YXRpYyBBUlJPV19DSEFSID0gJ+KWvic7XG5cbiAgLyoqIEEgcmVmZXJlbmNlIHRvIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgbWVudSBpdGVtLiAqL1xuICBwcml2YXRlIHNlbGVjdGVkTWVudUl0ZW1fOiBNZW51SXRlbXxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIGRyb3Bkb3duIG1lbnUuICovXG4gIHByb3RlY3RlZCBtZW51XzogTWVudXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogU1ZHIGltYWdlIGVsZW1lbnQgaWYgY3VycmVudGx5IHNlbGVjdGVkIG9wdGlvbiBpcyBhbiBpbWFnZSwgb3IgbnVsbC5cbiAgICovXG4gIHByaXZhdGUgaW1hZ2VFbGVtZW50XzogU1ZHSW1hZ2VFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUc3BhbiBiYXNlZCBhcnJvdyBlbGVtZW50LiAqL1xuICBwcml2YXRlIGFycm93XzogU1ZHVFNwYW5FbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBTVkcgYmFzZWQgYXJyb3cgZWxlbWVudC4gKi9cbiAgcHJpdmF0ZSBzdmdBcnJvd186IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6YWJsZSBmaWVsZHMgYXJlIHNhdmVkIGJ5IHRoZSBzZXJpYWxpemVyLCBub24tc2VyaWFsaXphYmxlIGZpZWxkc1xuICAgKiBhcmUgbm90LiBFZGl0YWJsZSBmaWVsZHMgc2hvdWxkIGFsc28gYmUgc2VyaWFsaXphYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgU0VSSUFMSVpBQkxFID0gdHJ1ZTtcblxuICAvKiogTW91c2UgY3Vyc29yIHN0eWxlIHdoZW4gb3ZlciB0aGUgaG90c3BvdCB0aGF0IGluaXRpYXRlcyB0aGUgZWRpdG9yLiAqL1xuICBvdmVycmlkZSBDVVJTT1IgPSAnZGVmYXVsdCc7XG5cbiAgcHJvdGVjdGVkIG1lbnVHZW5lcmF0b3JfPzogTWVudUdlbmVyYXRvcjtcblxuICAvKiogQSBjYWNoZSBvZiB0aGUgbW9zdCByZWNlbnRseSBnZW5lcmF0ZWQgb3B0aW9ucy4gKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZWRPcHRpb25zXzogTWVudU9wdGlvbltdfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgcHJlZml4IGZpZWxkIGxhYmVsLCBvZiBjb21tb24gd29yZHMgc2V0IGFmdGVyIG9wdGlvbnMgYXJlIHRyaW1tZWQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgcHJlZml4RmllbGQ6IHN0cmluZ3xudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHN1ZmZpeCBmaWVsZCBsYWJlbCwgb2YgY29tbW9uIHdvcmRzIHNldCBhZnRlciBvcHRpb25zIGFyZSB0cmltbWVkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIHN1ZmZpeEZpZWxkOiBzdHJpbmd8bnVsbCA9IG51bGw7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIHByaXZhdGUgc2VsZWN0ZWRPcHRpb25fITogQXJyYXk8c3RyaW5nfEltYWdlUHJvcGVydGllcz47XG4gIG92ZXJyaWRlIGNsaWNrVGFyZ2V0XzogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQHBhcmFtIG1lbnVHZW5lcmF0b3IgQSBub24tZW1wdHkgYXJyYXkgb2Ygb3B0aW9ucyBmb3IgYSBkcm9wZG93biBsaXN0LCBvciBhXG4gICAqICAgICBmdW5jdGlvbiB3aGljaCBnZW5lcmF0ZXMgdGhlc2Ugb3B0aW9ucy4gQWxzbyBhY2NlcHRzIEZpZWxkLlNLSVBfU0VUVVBcbiAgICogICAgIGlmIHlvdSB3aXNoIHRvIHNraXAgc2V0dXAgKG9ubHkgdXNlZCBieSBzdWJjbGFzc2VzIHRoYXQgd2FudCB0byBoYW5kbGVcbiAgICogICAgIGNvbmZpZ3VyYXRpb24gYW5kIHNldHRpbmcgdGhlIGZpZWxkIHZhbHVlIGFmdGVyIHRoZWlyIG93biBjb25zdHJ1Y3RvcnNcbiAgICogICAgIGhhdmUgcnVuKS5cbiAgICogQHBhcmFtIG9wdF92YWxpZGF0b3IgQSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB0byB2YWxpZGF0ZSBjaGFuZ2VzIHRvIHRoZVxuICAgKiAgICAgZmllbGQncyB2YWx1ZS4gVGFrZXMgaW4gYSBsYW5ndWFnZS1uZXV0cmFsIGRyb3Bkb3duIG9wdGlvbiAmIHJldHVybnMgYVxuICAgKiAgICAgdmFsaWRhdGVkIGxhbmd1YWdlLW5ldXRyYWwgZHJvcGRvd24gb3B0aW9uLCBvciBudWxsIHRvIGFib3J0IHRoZVxuICAgKiAgICAgY2hhbmdlLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvZHJvcGRvd24jY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICogQHRocm93cyB7VHlwZUVycm9yfSBJZiBgbWVudUdlbmVyYXRvcmAgb3B0aW9ucyBhcmUgaW5jb3JyZWN0bHkgc3RydWN0dXJlZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgbWVudUdlbmVyYXRvcjogTWVudUdlbmVyYXRvcixcbiAgICAgIG9wdF92YWxpZGF0b3I/OiBGaWVsZERyb3Bkb3duVmFsaWRhdG9yLFxuICAgICAgb3B0X2NvbmZpZz86IEZpZWxkQ29uZmlnLFxuICApO1xuICBjb25zdHJ1Y3RvcihtZW51R2VuZXJhdG9yOiBTZW50aW5lbCk7XG4gIGNvbnN0cnVjdG9yKFxuICAgICAgbWVudUdlbmVyYXRvcjogTWVudUdlbmVyYXRvcnxTZW50aW5lbCxcbiAgICAgIG9wdF92YWxpZGF0b3I/OiBGaWVsZERyb3Bkb3duVmFsaWRhdG9yLFxuICAgICAgb3B0X2NvbmZpZz86IEZpZWxkQ29uZmlnLFxuICApIHtcbiAgICBzdXBlcihGaWVsZC5TS0lQX1NFVFVQKTtcblxuICAgIC8vIElmIHdlIHBhc3MgU0tJUF9TRVRVUCwgZG9uJ3QgZG8gKmFueXRoaW5nKiB3aXRoIHRoZSBtZW51IGdlbmVyYXRvci5cbiAgICBpZiAoIWlzTWVudUdlbmVyYXRvcihtZW51R2VuZXJhdG9yKSkgcmV0dXJuO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobWVudUdlbmVyYXRvcikpIHtcbiAgICAgIHZhbGlkYXRlT3B0aW9ucyhtZW51R2VuZXJhdG9yKTtcbiAgICAgIGNvbnN0IHRyaW1tZWQgPSB0cmltT3B0aW9ucyhtZW51R2VuZXJhdG9yKTtcbiAgICAgIHRoaXMubWVudUdlbmVyYXRvcl8gPSB0cmltbWVkLm9wdGlvbnM7XG4gICAgICB0aGlzLnByZWZpeEZpZWxkID0gdHJpbW1lZC5wcmVmaXggfHwgbnVsbDtcbiAgICAgIHRoaXMuc3VmZml4RmllbGQgPSB0cmltbWVkLnN1ZmZpeCB8fCBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm1lbnVHZW5lcmF0b3JfID0gbWVudUdlbmVyYXRvcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIG9wdGlvbi4gVGhlIGZpZWxkIGlzIGluaXRpYWxpemVkIHdpdGggdGhlXG4gICAgICogZmlyc3Qgb3B0aW9uIHNlbGVjdGVkLlxuICAgICAqL1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25fID0gdGhpcy5nZXRPcHRpb25zKGZhbHNlKVswXTtcblxuICAgIGlmIChvcHRfY29uZmlnKSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyZV8ob3B0X2NvbmZpZyk7XG4gICAgfVxuICAgIHRoaXMuc2V0VmFsdWUodGhpcy5zZWxlY3RlZE9wdGlvbl9bMV0pO1xuICAgIGlmIChvcHRfdmFsaWRhdG9yKSB7XG4gICAgICB0aGlzLnNldFZhbGlkYXRvcihvcHRfdmFsaWRhdG9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgZmllbGQncyB2YWx1ZSBiYXNlZCBvbiB0aGUgZ2l2ZW4gWE1MIGVsZW1lbnQuIFNob3VsZCBvbmx5IGJlXG4gICAqIGNhbGxlZCBieSBCbG9ja2x5LlhtbC5cbiAgICpcbiAgICogQHBhcmFtIGZpZWxkRWxlbWVudCBUaGUgZWxlbWVudCBjb250YWluaW5nIGluZm8gYWJvdXQgdGhlIGZpZWxkJ3Mgc3RhdGUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbVhtbChmaWVsZEVsZW1lbnQ6IEVsZW1lbnQpIHtcbiAgICBpZiAodGhpcy5pc09wdGlvbkxpc3REeW5hbWljKCkpIHtcbiAgICAgIHRoaXMuZ2V0T3B0aW9ucyhmYWxzZSk7XG4gICAgfVxuICAgIHRoaXMuc2V0VmFsdWUoZmllbGRFbGVtZW50LnRleHRDb250ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBmaWVsZCdzIHZhbHVlIGJhc2VkIG9uIHRoZSBnaXZlbiBzdGF0ZS5cbiAgICpcbiAgICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSB0byBhcHBseSB0byB0aGUgZHJvcGRvd24gZmllbGQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgbG9hZFN0YXRlKHN0YXRlOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgICBpZiAodGhpcy5sb2FkTGVnYWN5U3RhdGUoRmllbGREcm9wZG93biwgc3RhdGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmlzT3B0aW9uTGlzdER5bmFtaWMoKSkge1xuICAgICAgdGhpcy5nZXRPcHRpb25zKGZhbHNlKTtcbiAgICB9XG4gICAgdGhpcy5zZXRWYWx1ZShzdGF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBibG9jayBVSSBmb3IgdGhpcyBkcm9wZG93bi5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBpbml0VmlldygpIHtcbiAgICBpZiAodGhpcy5zaG91bGRBZGRCb3JkZXJSZWN0XygpKSB7XG4gICAgICB0aGlzLmNyZWF0ZUJvcmRlclJlY3RfKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2xpY2tUYXJnZXRfID0gKHRoaXMuc291cmNlQmxvY2tfIGFzIEJsb2NrU3ZnKS5nZXRTdmdSb290KCk7XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlVGV4dEVsZW1lbnRfKCk7XG5cbiAgICB0aGlzLmltYWdlRWxlbWVudF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuSU1BR0UsIHt9LCB0aGlzLmZpZWxkR3JvdXBfKTtcblxuICAgIGlmICh0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9EUk9QRE9XTl9TVkdfQVJST1cpIHtcbiAgICAgIHRoaXMuY3JlYXRlU1ZHQXJyb3dfKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3JlYXRlVGV4dEFycm93XygpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmJvcmRlclJlY3RfKSB7XG4gICAgICBkb20uYWRkQ2xhc3ModGhpcy5ib3JkZXJSZWN0XywgJ2Jsb2NrbHlEcm9wZG93blJlY3QnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBvciBub3QgdGhlIGRyb3Bkb3duIHNob3VsZCBhZGQgYSBib3JkZXIgcmVjdC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgZHJvcGRvd24gZmllbGQgc2hvdWxkIGFkZCBhIGJvcmRlciByZWN0LlxuICAgKi9cbiAgcHJvdGVjdGVkIHNob3VsZEFkZEJvcmRlclJlY3RfKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fTk9fQk9SREVSX1JFQ1RfU0hBRE9XIHx8XG4gICAgICAgIHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0RST1BET1dOX05PX0JPUkRFUl9SRUNUX1NIQURPVyAmJlxuICAgICAgICAhdGhpcy5nZXRTb3VyY2VCbG9jaygpPy5pc1NoYWRvdygpO1xuICB9XG5cbiAgLyoqIENyZWF0ZSBhIHRzcGFuIGJhc2VkIGFycm93LiAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlVGV4dEFycm93XygpIHtcbiAgICB0aGlzLmFycm93XyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5UU1BBTiwge30sIHRoaXMudGV4dEVsZW1lbnRfKTtcbiAgICB0aGlzLmFycm93XyEuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXG4gICAgICAgIHRoaXMuZ2V0U291cmNlQmxvY2soKT8uUlRMID8gRmllbGREcm9wZG93bi5BUlJPV19DSEFSICsgJyAnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICcgKyBGaWVsZERyb3Bkb3duLkFSUk9XX0NIQVIpKTtcbiAgICBpZiAodGhpcy5nZXRTb3VyY2VCbG9jaygpPy5SVEwpIHtcbiAgICAgIHRoaXMuZ2V0VGV4dEVsZW1lbnQoKS5pbnNlcnRCZWZvcmUodGhpcy5hcnJvd18sIHRoaXMudGV4dENvbnRlbnRfKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nZXRUZXh0RWxlbWVudCgpLmFwcGVuZENoaWxkKHRoaXMuYXJyb3dfKTtcbiAgICB9XG4gIH1cblxuICAvKiogQ3JlYXRlIGFuIFNWRyBiYXNlZCBhcnJvdy4gKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZVNWR0Fycm93XygpIHtcbiAgICB0aGlzLnN2Z0Fycm93XyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuSU1BR0UsIHtcbiAgICAgICAgICAnaGVpZ2h0JzogdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fU1ZHX0FSUk9XX1NJWkUgKyAncHgnLFxuICAgICAgICAgICd3aWR0aCc6IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0RST1BET1dOX1NWR19BUlJPV19TSVpFICsgJ3B4JyxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5maWVsZEdyb3VwXyk7XG4gICAgdGhpcy5zdmdBcnJvd18hLnNldEF0dHJpYnV0ZU5TKFxuICAgICAgICBkb20uWExJTktfTlMsICd4bGluazpocmVmJyxcbiAgICAgICAgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fU1ZHX0FSUk9XX0RBVEFVUkkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGRyb3Bkb3duIG1lbnUgdW5kZXIgdGhlIHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfZSBPcHRpb25hbCBtb3VzZSBldmVudCB0aGF0IHRyaWdnZXJlZCB0aGUgZmllbGQgdG8gb3Blbiwgb3JcbiAgICogICAgIHVuZGVmaW5lZCBpZiB0cmlnZ2VyZWQgcHJvZ3JhbW1hdGljYWxseS5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBzaG93RWRpdG9yXyhvcHRfZT86IE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgdGhpcy5kcm9wZG93bkNyZWF0ZV8oKTtcbiAgICBpZiAob3B0X2UgJiYgdHlwZW9mIG9wdF9lLmNsaWVudFggPT09ICdudW1iZXInKSB7XG4gICAgICB0aGlzLm1lbnVfIS5vcGVuaW5nQ29vcmRzID0gbmV3IENvb3JkaW5hdGUob3B0X2UuY2xpZW50WCwgb3B0X2UuY2xpZW50WSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWVudV8hLm9wZW5pbmdDb29yZHMgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhbnkgcHJlLWV4aXN0aW5nIGVsZW1lbnRzIGluIHRoZSBkcm9wZG93bi5cbiAgICBkcm9wRG93bkRpdi5jbGVhckNvbnRlbnQoKTtcbiAgICAvLyBFbGVtZW50IGdldHMgY3JlYXRlZCBpbiByZW5kZXIuXG4gICAgY29uc3QgbWVudUVsZW1lbnQgPSB0aGlzLm1lbnVfIS5yZW5kZXIoZHJvcERvd25EaXYuZ2V0Q29udGVudERpdigpKTtcbiAgICBkb20uYWRkQ2xhc3MobWVudUVsZW1lbnQsICdibG9ja2x5RHJvcGRvd25NZW51Jyk7XG5cbiAgICBpZiAodGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fQ09MT1VSRURfRElWKSB7XG4gICAgICBjb25zdCBwcmltYXJ5Q29sb3VyID1cbiAgICAgICAgICBibG9jay5pc1NoYWRvdygpID8gYmxvY2suZ2V0UGFyZW50KCkhLmdldENvbG91cigpIDogYmxvY2suZ2V0Q29sb3VyKCk7XG4gICAgICBjb25zdCBib3JkZXJDb2xvdXIgPSBibG9jay5pc1NoYWRvdygpID9cbiAgICAgICAgICAoYmxvY2suZ2V0UGFyZW50KCkgYXMgQmxvY2tTdmcpLnN0eWxlLmNvbG91clRlcnRpYXJ5IDpcbiAgICAgICAgICAodGhpcy5zb3VyY2VCbG9ja18gYXMgQmxvY2tTdmcpLnN0eWxlLmNvbG91clRlcnRpYXJ5O1xuICAgICAgZHJvcERvd25EaXYuc2V0Q29sb3VyKHByaW1hcnlDb2xvdXIsIGJvcmRlckNvbG91cik7XG4gICAgfVxuXG4gICAgZHJvcERvd25EaXYuc2hvd1Bvc2l0aW9uZWRCeUZpZWxkKHRoaXMsIHRoaXMuZHJvcGRvd25EaXNwb3NlXy5iaW5kKHRoaXMpKTtcblxuICAgIC8vIEZvY3VzaW5nIG5lZWRzIHRvIGJlIGhhbmRsZWQgYWZ0ZXIgdGhlIG1lbnUgaXMgcmVuZGVyZWQgYW5kIHBvc2l0aW9uZWQuXG4gICAgLy8gT3RoZXJ3aXNlIGl0IHdpbGwgY2F1c2UgYSBwYWdlIHNjcm9sbCB0byBnZXQgdGhlIG1pc3BsYWNlZCBtZW51IGluXG4gICAgLy8gdmlldy4gU2VlIGlzc3VlICMxMzI5LlxuICAgIHRoaXMubWVudV8hLmZvY3VzKCk7XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZE1lbnVJdGVtXykge1xuICAgICAgdGhpcy5tZW51XyEuc2V0SGlnaGxpZ2h0ZWQodGhpcy5zZWxlY3RlZE1lbnVJdGVtXyk7XG4gICAgfVxuXG4gICAgdGhpcy5hcHBseUNvbG91cigpO1xuICB9XG5cbiAgLyoqIENyZWF0ZSB0aGUgZHJvcGRvd24gZWRpdG9yLiAqL1xuICBwcml2YXRlIGRyb3Bkb3duQ3JlYXRlXygpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3QgbWVudSA9IG5ldyBNZW51KCk7XG4gICAgbWVudS5zZXRSb2xlKGFyaWEuUm9sZS5MSVNUQk9YKTtcbiAgICB0aGlzLm1lbnVfID0gbWVudTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmdldE9wdGlvbnMoZmFsc2UpO1xuICAgIHRoaXMuc2VsZWN0ZWRNZW51SXRlbV8gPSBudWxsO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgW2xhYmVsLCB2YWx1ZV0gPSBvcHRpb25zW2ldO1xuICAgICAgY29uc3QgY29udGVudCA9ICgoKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgbGFiZWwgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgLy8gQ29udmVydCBJbWFnZVByb3BlcnRpZXMgdG8gYW4gSFRNTEltYWdlRWxlbWVudC5cbiAgICAgICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZShsYWJlbFsnd2lkdGgnXSwgbGFiZWxbJ2hlaWdodCddKTtcbiAgICAgICAgICBpbWFnZS5zcmMgPSBsYWJlbFsnc3JjJ107XG4gICAgICAgICAgaW1hZ2UuYWx0ID0gbGFiZWxbJ2FsdCddIHx8ICcnO1xuICAgICAgICAgIHJldHVybiBpbWFnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGFiZWw7XG4gICAgICB9KSgpO1xuICAgICAgY29uc3QgbWVudUl0ZW0gPSBuZXcgTWVudUl0ZW0oY29udGVudCwgdmFsdWUpO1xuICAgICAgbWVudUl0ZW0uc2V0Um9sZShhcmlhLlJvbGUuT1BUSU9OKTtcbiAgICAgIG1lbnVJdGVtLnNldFJpZ2h0VG9MZWZ0KGJsb2NrLlJUTCk7XG4gICAgICBtZW51SXRlbS5zZXRDaGVja2FibGUodHJ1ZSk7XG4gICAgICBtZW51LmFkZENoaWxkKG1lbnVJdGVtKTtcbiAgICAgIG1lbnVJdGVtLnNldENoZWNrZWQodmFsdWUgPT09IHRoaXMudmFsdWVfKTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gdGhpcy52YWx1ZV8pIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZE1lbnVJdGVtXyA9IG1lbnVJdGVtO1xuICAgICAgfVxuICAgICAgbWVudUl0ZW0ub25BY3Rpb24odGhpcy5oYW5kbGVNZW51QWN0aW9uRXZlbnRfLCB0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZXMgb2YgZXZlbnRzIGFuZCBET00tcmVmZXJlbmNlcyBiZWxvbmdpbmcgdG8gdGhlIGRyb3Bkb3duIGVkaXRvci5cbiAgICovXG4gIHByaXZhdGUgZHJvcGRvd25EaXNwb3NlXygpIHtcbiAgICBpZiAodGhpcy5tZW51Xykge1xuICAgICAgdGhpcy5tZW51Xy5kaXNwb3NlKCk7XG4gICAgfVxuICAgIHRoaXMubWVudV8gPSBudWxsO1xuICAgIHRoaXMuc2VsZWN0ZWRNZW51SXRlbV8gPSBudWxsO1xuICAgIHRoaXMuYXBwbHlDb2xvdXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYW4gYWN0aW9uIGluIHRoZSBkcm9wZG93biBtZW51LlxuICAgKlxuICAgKiBAcGFyYW0gbWVudUl0ZW0gVGhlIE1lbnVJdGVtIHNlbGVjdGVkIHdpdGhpbiBtZW51LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVNZW51QWN0aW9uRXZlbnRfKG1lbnVJdGVtOiBNZW51SXRlbSkge1xuICAgIGRyb3BEb3duRGl2LmhpZGVJZk93bmVyKHRoaXMsIHRydWUpO1xuICAgIHRoaXMub25JdGVtU2VsZWN0ZWRfKHRoaXMubWVudV8gYXMgTWVudSwgbWVudUl0ZW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgc2VsZWN0aW9uIG9mIGFuIGl0ZW0gaW4gdGhlIGRyb3Bkb3duIG1lbnUuXG4gICAqXG4gICAqIEBwYXJhbSBtZW51IFRoZSBNZW51IGNvbXBvbmVudCBjbGlja2VkLlxuICAgKiBAcGFyYW0gbWVudUl0ZW0gVGhlIE1lbnVJdGVtIHNlbGVjdGVkIHdpdGhpbiBtZW51LlxuICAgKi9cbiAgcHJvdGVjdGVkIG9uSXRlbVNlbGVjdGVkXyhtZW51OiBNZW51LCBtZW51SXRlbTogTWVudUl0ZW0pIHtcbiAgICB0aGlzLnNldFZhbHVlKG1lbnVJdGVtLmdldFZhbHVlKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG9wdGlvbiBsaXN0IGlzIGdlbmVyYXRlZCBieSBhIGZ1bmN0aW9uLlxuICAgKiAgICAgT3RoZXJ3aXNlIGZhbHNlLlxuICAgKi9cbiAgaXNPcHRpb25MaXN0RHluYW1pYygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHlwZW9mIHRoaXMubWVudUdlbmVyYXRvcl8gPT09ICdmdW5jdGlvbic7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGEgbGlzdCBvZiB0aGUgb3B0aW9ucyBmb3IgdGhpcyBkcm9wZG93bi5cbiAgICpcbiAgICogQHBhcmFtIG9wdF91c2VDYWNoZSBGb3IgZHluYW1pYyBvcHRpb25zLCB3aGV0aGVyIG9yIG5vdCB0byB1c2UgdGhlIGNhY2hlZFxuICAgKiAgICAgb3B0aW9ucyBvciB0byByZS1nZW5lcmF0ZSB0aGVtLlxuICAgKiBAcmV0dXJucyBBIG5vbi1lbXB0eSBhcnJheSBvZiBvcHRpb24gdHVwbGVzOlxuICAgKiAgICAgKGh1bWFuLXJlYWRhYmxlIHRleHQgb3IgaW1hZ2UsIGxhbmd1YWdlLW5ldXRyYWwgbmFtZSkuXG4gICAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gSWYgZ2VuZXJhdGVkIG9wdGlvbnMgYXJlIGluY29ycmVjdGx5IHN0cnVjdHVyZWQuXG4gICAqL1xuICBnZXRPcHRpb25zKG9wdF91c2VDYWNoZT86IGJvb2xlYW4pOiBNZW51T3B0aW9uW10ge1xuICAgIGlmICghdGhpcy5tZW51R2VuZXJhdG9yXykge1xuICAgICAgLy8gQSBzdWJjbGFzcyBpbXByb3Blcmx5IHNraXBwZWQgc2V0dXAgd2l0aG91dCBkZWZpbmluZyB0aGUgbWVudVxuICAgICAgLy8gZ2VuZXJhdG9yLlxuICAgICAgdGhyb3cgVHlwZUVycm9yKCdBIG1lbnUgZ2VuZXJhdG9yIHdhcyBuZXZlciBkZWZpbmVkLicpO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLm1lbnVHZW5lcmF0b3JfKSkgcmV0dXJuIHRoaXMubWVudUdlbmVyYXRvcl87XG4gICAgaWYgKG9wdF91c2VDYWNoZSAmJiB0aGlzLmdlbmVyYXRlZE9wdGlvbnNfKSByZXR1cm4gdGhpcy5nZW5lcmF0ZWRPcHRpb25zXztcblxuICAgIHRoaXMuZ2VuZXJhdGVkT3B0aW9uc18gPSB0aGlzLm1lbnVHZW5lcmF0b3JfKCk7XG4gICAgdmFsaWRhdGVPcHRpb25zKHRoaXMuZ2VuZXJhdGVkT3B0aW9uc18pO1xuICAgIHJldHVybiB0aGlzLmdlbmVyYXRlZE9wdGlvbnNfO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuc3VyZSB0aGF0IHRoZSBpbnB1dCB2YWx1ZSBpcyBhIHZhbGlkIGxhbmd1YWdlLW5ldXRyYWwgb3B0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIFRoZSBpbnB1dCB2YWx1ZS5cbiAgICogQHJldHVybnMgQSB2YWxpZCBsYW5ndWFnZS1uZXV0cmFsIG9wdGlvbiwgb3IgbnVsbCBpZiBpbnZhbGlkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvQ2xhc3NWYWxpZGF0aW9uXyhvcHRfbmV3VmFsdWU/OiBNZW51T3B0aW9uWzFdKTogc3RyaW5nXG4gICAgICB8bnVsbCB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucyh0cnVlKTtcbiAgICBjb25zdCBpc1ZhbHVlVmFsaWQgPSBvcHRpb25zLnNvbWUoKG9wdGlvbikgPT4gb3B0aW9uWzFdID09PSBvcHRfbmV3VmFsdWUpO1xuXG4gICAgaWYgKCFpc1ZhbHVlVmFsaWQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZUJsb2NrXykge1xuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAnQ2Fubm90IHNldCB0aGUgZHJvcGRvd25cXCdzIHZhbHVlIHRvIGFuIHVuYXZhaWxhYmxlIG9wdGlvbi4nICtcbiAgICAgICAgICAgICcgQmxvY2sgdHlwZTogJyArIHRoaXMuc291cmNlQmxvY2tfLnR5cGUgK1xuICAgICAgICAgICAgJywgRmllbGQgbmFtZTogJyArIHRoaXMubmFtZSArICcsIFZhbHVlOiAnICsgb3B0X25ld1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gb3B0X25ld1ZhbHVlIGFzIHN0cmluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoaXMgZHJvcGRvd24gZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdWYWx1ZSBUaGUgdmFsdWUgdG8gYmUgc2F2ZWQuIFRoZSBkZWZhdWx0IHZhbGlkYXRvciBndWFyYW50ZWVzXG4gICAqICAgICB0aGF0IHRoaXMgaXMgb25lIG9mIHRoZSB2YWxpZCBkcm9wZG93biBvcHRpb25zLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvVmFsdWVVcGRhdGVfKG5ld1ZhbHVlOiBNZW51T3B0aW9uWzFdKSB7XG4gICAgc3VwZXIuZG9WYWx1ZVVwZGF0ZV8obmV3VmFsdWUpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmdldE9wdGlvbnModHJ1ZSk7XG4gICAgZm9yIChsZXQgaSA9IDAsIG9wdGlvbjsgb3B0aW9uID0gb3B0aW9uc1tpXTsgaSsrKSB7XG4gICAgICBpZiAob3B0aW9uWzFdID09PSB0aGlzLnZhbHVlXykge1xuICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9uXyA9IG9wdGlvbjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgZHJvcGRvd24gYXJyb3cgdG8gbWF0Y2ggdGhlIGNvbG91ci9zdHlsZSBvZiB0aGUgYmxvY2suXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgYXBwbHlDb2xvdXIoKSB7XG4gICAgY29uc3Qgc3R5bGUgPSAodGhpcy5zb3VyY2VCbG9ja18gYXMgQmxvY2tTdmcpLnN0eWxlO1xuICAgIGlmICh0aGlzLmJvcmRlclJlY3RfKSB7XG4gICAgICB0aGlzLmJvcmRlclJlY3RfLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgc3R5bGUuY29sb3VyVGVydGlhcnkpO1xuICAgICAgaWYgKHRoaXMubWVudV8pIHtcbiAgICAgICAgdGhpcy5ib3JkZXJSZWN0Xy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCBzdHlsZS5jb2xvdXJUZXJ0aWFyeSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmJvcmRlclJlY3RfLnNldEF0dHJpYnV0ZSgnZmlsbCcsICd0cmFuc3BhcmVudCcpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBVcGRhdGUgYXJyb3cncyBjb2xvdXIuXG4gICAgaWYgKHRoaXMuc291cmNlQmxvY2tfICYmIHRoaXMuYXJyb3dfKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2VCbG9ja18uaXNTaGFkb3coKSkge1xuICAgICAgICB0aGlzLmFycm93Xy5zdHlsZS5maWxsID0gc3R5bGUuY29sb3VyU2Vjb25kYXJ5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hcnJvd18uc3R5bGUuZmlsbCA9IHN0eWxlLmNvbG91clByaW1hcnk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqIERyYXdzIHRoZSBib3JkZXIgd2l0aCB0aGUgY29ycmVjdCB3aWR0aC4gKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHJlbmRlcl8oKSB7XG4gICAgLy8gSGlkZSBib3RoIGVsZW1lbnRzLlxuICAgIHRoaXMuZ2V0VGV4dENvbnRlbnQoKS5ub2RlVmFsdWUgPSAnJztcbiAgICB0aGlzLmltYWdlRWxlbWVudF8hLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICAvLyBTaG93IGNvcnJlY3QgZWxlbWVudC5cbiAgICBjb25zdCBvcHRpb24gPSB0aGlzLnNlbGVjdGVkT3B0aW9uXyAmJiB0aGlzLnNlbGVjdGVkT3B0aW9uX1swXTtcbiAgICBpZiAob3B0aW9uICYmIHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnKSB7XG4gICAgICB0aGlzLnJlbmRlclNlbGVjdGVkSW1hZ2VfKChvcHRpb24pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJTZWxlY3RlZFRleHRfKCk7XG4gICAgfVxuXG4gICAgdGhpcy5wb3NpdGlvbkJvcmRlclJlY3RfKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyB0aGUgc2VsZWN0ZWQgb3B0aW9uLCB3aGljaCBtdXN0IGJlIGFuIGltYWdlLlxuICAgKlxuICAgKiBAcGFyYW0gaW1hZ2VKc29uIFNlbGVjdGVkIG9wdGlvbiB0aGF0IG11c3QgYmUgYW4gaW1hZ2UuXG4gICAqL1xuICBwcml2YXRlIHJlbmRlclNlbGVjdGVkSW1hZ2VfKGltYWdlSnNvbjogSW1hZ2VQcm9wZXJ0aWVzKSB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IFVuYXR0YWNoZWRGaWVsZEVycm9yKCk7XG4gICAgfVxuICAgIHRoaXMuaW1hZ2VFbGVtZW50XyEuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgIHRoaXMuaW1hZ2VFbGVtZW50XyEuc2V0QXR0cmlidXRlTlMoXG4gICAgICAgIGRvbS5YTElOS19OUywgJ3hsaW5rOmhyZWYnLCBpbWFnZUpzb24uc3JjKTtcbiAgICB0aGlzLmltYWdlRWxlbWVudF8hLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgYCR7aW1hZ2VKc29uLmhlaWdodH1gKTtcbiAgICB0aGlzLmltYWdlRWxlbWVudF8hLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBgJHtpbWFnZUpzb24ud2lkdGh9YCk7XG5cbiAgICBjb25zdCBpbWFnZUhlaWdodCA9IE51bWJlcihpbWFnZUpzb24uaGVpZ2h0KTtcbiAgICBjb25zdCBpbWFnZVdpZHRoID0gTnVtYmVyKGltYWdlSnNvbi53aWR0aCk7XG5cbiAgICAvLyBIZWlnaHQgYW5kIHdpZHRoIGluY2x1ZGUgdGhlIGJvcmRlciByZWN0LlxuICAgIGNvbnN0IGhhc0JvcmRlciA9ICEhdGhpcy5ib3JkZXJSZWN0XztcbiAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heChcbiAgICAgICAgaGFzQm9yZGVyID8gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fQk9SREVSX1JFQ1RfSEVJR0hUIDogMCxcbiAgICAgICAgaW1hZ2VIZWlnaHQgKyBJTUFHRV9ZX1BBRERJTkcpO1xuICAgIGNvbnN0IHhQYWRkaW5nID1cbiAgICAgICAgaGFzQm9yZGVyID8gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWF9QQURESU5HIDogMDtcbiAgICBsZXQgYXJyb3dXaWR0aCA9IDA7XG4gICAgaWYgKHRoaXMuc3ZnQXJyb3dfKSB7XG4gICAgICBhcnJvd1dpZHRoID0gdGhpcy5wb3NpdGlvblNWR0Fycm93XyhcbiAgICAgICAgICBpbWFnZVdpZHRoICsgeFBhZGRpbmcsXG4gICAgICAgICAgaGVpZ2h0IC8gMiAtIHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0RST1BET1dOX1NWR19BUlJPV19TSVpFIC8gMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFycm93V2lkdGggPSBkb20uZ2V0RmFzdFRleHRXaWR0aChcbiAgICAgICAgICB0aGlzLmFycm93XyBhcyBTVkdUU3BhbkVsZW1lbnQsXG4gICAgICAgICAgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9GT05UU0laRSxcbiAgICAgICAgICB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9URVhUX0ZPTlRXRUlHSFQsXG4gICAgICAgICAgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9GT05URkFNSUxZKTtcbiAgICB9XG4gICAgdGhpcy5zaXplXy53aWR0aCA9IGltYWdlV2lkdGggKyBhcnJvd1dpZHRoICsgeFBhZGRpbmcgKiAyO1xuICAgIHRoaXMuc2l6ZV8uaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgbGV0IGFycm93WCA9IDA7XG4gICAgaWYgKGJsb2NrLlJUTCkge1xuICAgICAgY29uc3QgaW1hZ2VYID0geFBhZGRpbmcgKyBhcnJvd1dpZHRoO1xuICAgICAgdGhpcy5pbWFnZUVsZW1lbnRfIS5zZXRBdHRyaWJ1dGUoJ3gnLCBpbWFnZVgudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFycm93WCA9IGltYWdlV2lkdGggKyBhcnJvd1dpZHRoO1xuICAgICAgdGhpcy5nZXRUZXh0RWxlbWVudCgpLnNldEF0dHJpYnV0ZSgndGV4dC1hbmNob3InLCAnZW5kJyk7XG4gICAgICB0aGlzLmltYWdlRWxlbWVudF8hLnNldEF0dHJpYnV0ZSgneCcsIHhQYWRkaW5nLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICB0aGlzLmltYWdlRWxlbWVudF8hLnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3knLCAoaGVpZ2h0IC8gMiAtIGltYWdlSGVpZ2h0IC8gMikudG9TdHJpbmcoKSk7XG5cbiAgICB0aGlzLnBvc2l0aW9uVGV4dEVsZW1lbnRfKGFycm93WCArIHhQYWRkaW5nLCBpbWFnZVdpZHRoICsgYXJyb3dXaWR0aCk7XG4gIH1cblxuICAvKiogUmVuZGVycyB0aGUgc2VsZWN0ZWQgb3B0aW9uLCB3aGljaCBtdXN0IGJlIHRleHQuICovXG4gIHByaXZhdGUgcmVuZGVyU2VsZWN0ZWRUZXh0XygpIHtcbiAgICAvLyBSZXRyaWV2ZXMgdGhlIHNlbGVjdGVkIG9wdGlvbiB0byBkaXNwbGF5IHRocm91Z2ggZ2V0VGV4dF8uXG4gICAgdGhpcy5nZXRUZXh0Q29udGVudCgpLm5vZGVWYWx1ZSA9IHRoaXMuZ2V0RGlzcGxheVRleHRfKCk7XG4gICAgY29uc3QgdGV4dEVsZW1lbnQgPSB0aGlzLmdldFRleHRFbGVtZW50KCk7XG4gICAgZG9tLmFkZENsYXNzKHRleHRFbGVtZW50LCAnYmxvY2tseURyb3Bkb3duVGV4dCcpO1xuICAgIHRleHRFbGVtZW50LnNldEF0dHJpYnV0ZSgndGV4dC1hbmNob3InLCAnc3RhcnQnKTtcblxuICAgIC8vIEhlaWdodCBhbmQgd2lkdGggaW5jbHVkZSB0aGUgYm9yZGVyIHJlY3QuXG4gICAgY29uc3QgaGFzQm9yZGVyID0gISF0aGlzLmJvcmRlclJlY3RfO1xuICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KFxuICAgICAgICBoYXNCb3JkZXIgPyB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9EUk9QRE9XTl9CT1JERVJfUkVDVF9IRUlHSFQgOiAwLFxuICAgICAgICB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9URVhUX0hFSUdIVCk7XG4gICAgY29uc3QgdGV4dFdpZHRoID0gZG9tLmdldEZhc3RUZXh0V2lkdGgoXG4gICAgICAgIHRoaXMuZ2V0VGV4dEVsZW1lbnQoKSwgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9GT05UU0laRSxcbiAgICAgICAgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9GT05UV0VJR0hULFxuICAgICAgICB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9URVhUX0ZPTlRGQU1JTFkpO1xuICAgIGNvbnN0IHhQYWRkaW5nID1cbiAgICAgICAgaGFzQm9yZGVyID8gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWF9QQURESU5HIDogMDtcbiAgICBsZXQgYXJyb3dXaWR0aCA9IDA7XG4gICAgaWYgKHRoaXMuc3ZnQXJyb3dfKSB7XG4gICAgICBhcnJvd1dpZHRoID0gdGhpcy5wb3NpdGlvblNWR0Fycm93XyhcbiAgICAgICAgICB0ZXh0V2lkdGggKyB4UGFkZGluZyxcbiAgICAgICAgICBoZWlnaHQgLyAyIC0gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fU1ZHX0FSUk9XX1NJWkUgLyAyKTtcbiAgICB9XG4gICAgdGhpcy5zaXplXy53aWR0aCA9IHRleHRXaWR0aCArIGFycm93V2lkdGggKyB4UGFkZGluZyAqIDI7XG4gICAgdGhpcy5zaXplXy5oZWlnaHQgPSBoZWlnaHQ7XG5cbiAgICB0aGlzLnBvc2l0aW9uVGV4dEVsZW1lbnRfKHhQYWRkaW5nLCB0ZXh0V2lkdGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9uIGEgZHJvcC1kb3duIGFycm93IGF0IHRoZSBhcHByb3ByaWF0ZSBsb2NhdGlvbiBhdCByZW5kZXItdGltZS5cbiAgICpcbiAgICogQHBhcmFtIHggWCBwb3NpdGlvbiB0aGUgYXJyb3cgaXMgYmVpbmcgcmVuZGVyZWQgYXQsIGluIHB4LlxuICAgKiBAcGFyYW0geSBZIHBvc2l0aW9uIHRoZSBhcnJvdyBpcyBiZWluZyByZW5kZXJlZCBhdCwgaW4gcHguXG4gICAqIEByZXR1cm5zIEFtb3VudCBvZiBzcGFjZSB0aGUgYXJyb3cgaXMgdGFraW5nIHVwLCBpbiBweC5cbiAgICovXG4gIHByaXZhdGUgcG9zaXRpb25TVkdBcnJvd18oeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5zdmdBcnJvd18pIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3QgaGFzQm9yZGVyID0gISF0aGlzLmJvcmRlclJlY3RfO1xuICAgIGNvbnN0IHhQYWRkaW5nID1cbiAgICAgICAgaGFzQm9yZGVyID8gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWF9QQURESU5HIDogMDtcbiAgICBjb25zdCB0ZXh0UGFkZGluZyA9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0RST1BET1dOX1NWR19BUlJPV19QQURESU5HO1xuICAgIGNvbnN0IHN2Z0Fycm93U2l6ZSA9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0RST1BET1dOX1NWR19BUlJPV19TSVpFO1xuICAgIGNvbnN0IGFycm93WCA9IGJsb2NrLlJUTCA/IHhQYWRkaW5nIDogeCArIHRleHRQYWRkaW5nO1xuICAgIHRoaXMuc3ZnQXJyb3dfLnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIGFycm93WCArICcsJyArIHkgKyAnKScpO1xuICAgIHJldHVybiBzdmdBcnJvd1NpemUgKyB0ZXh0UGFkZGluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2UgdGhlIGBnZXRUZXh0X2AgZGV2ZWxvcGVyIGhvb2sgdG8gb3ZlcnJpZGUgdGhlIGZpZWxkJ3MgdGV4dFxuICAgKiByZXByZXNlbnRhdGlvbi4gIEdldCB0aGUgc2VsZWN0ZWQgb3B0aW9uIHRleHQuIElmIHRoZSBzZWxlY3RlZCBvcHRpb24gaXMgYW5cbiAgICogaW1hZ2Ugd2UgcmV0dXJuIHRoZSBpbWFnZSBhbHQgdGV4dC5cbiAgICpcbiAgICogQHJldHVybnMgU2VsZWN0ZWQgb3B0aW9uIHRleHQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZ2V0VGV4dF8oKTogc3RyaW5nfG51bGwge1xuICAgIGlmICghdGhpcy5zZWxlY3RlZE9wdGlvbl8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBvcHRpb24gPSB0aGlzLnNlbGVjdGVkT3B0aW9uX1swXTtcbiAgICBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBvcHRpb25bJ2FsdCddO1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdCBhIEZpZWxkRHJvcGRvd24gZnJvbSBhIEpTT04gYXJnIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIG9wdGlvbnMgQSBKU09OIG9iamVjdCB3aXRoIG9wdGlvbnMgKG9wdGlvbnMpLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihvcHRpb25zOiBGaWVsZERyb3Bkb3duRnJvbUpzb25Db25maWcpOiBGaWVsZERyb3Bkb3duIHtcbiAgICBpZiAoIW9wdGlvbnMub3B0aW9ucykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdvcHRpb25zIGFyZSByZXF1aXJlZCBmb3IgdGhlIGRyb3Bkb3duIGZpZWxkLiBUaGUgJyArXG4gICAgICAgICAgJ29wdGlvbnMgcHJvcGVydHkgbXVzdCBiZSBhc3NpZ25lZCBhbiBhcnJheSBvZiAnICtcbiAgICAgICAgICAnW2h1bWFuUmVhZGFibGVWYWx1ZSwgbGFuZ3VhZ2VOZXV0cmFsVmFsdWVdIHR1cGxlcy4nKTtcbiAgICB9XG4gICAgLy8gYHRoaXNgIG1pZ2h0IGJlIGEgc3ViY2xhc3Mgb2YgRmllbGREcm9wZG93biBpZiB0aGF0IGNsYXNzIGRvZXNuJ3RcbiAgICAvLyBvdmVycmlkZSB0aGUgc3RhdGljIGZyb21Kc29uIG1ldGhvZC5cbiAgICByZXR1cm4gbmV3IHRoaXMob3B0aW9ucy5vcHRpb25zLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICB9XG59XG5cbi8qKlxuICogRGVmaW5pdGlvbiBvZiBhIGh1bWFuLXJlYWRhYmxlIGltYWdlIGRyb3Bkb3duIG9wdGlvbi5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJbWFnZVByb3BlcnRpZXMge1xuICBzcmM6IHN0cmluZztcbiAgYWx0OiBzdHJpbmc7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xufVxuXG4vKipcbiAqIEFuIGluZGl2aWR1YWwgb3B0aW9uIGluIHRoZSBkcm9wZG93biBtZW51LiBUaGUgZmlyc3QgZWxlbWVudCBpcyB0aGUgaHVtYW4tXG4gKiByZWFkYWJsZSB2YWx1ZSAodGV4dCBvciBpbWFnZSksIGFuZCB0aGUgc2Vjb25kIGVsZW1lbnQgaXMgdGhlIGxhbmd1YWdlLVxuICogbmV1dHJhbCB2YWx1ZS5cbiAqL1xuZXhwb3J0IHR5cGUgTWVudU9wdGlvbiA9IFtzdHJpbmcgfCBJbWFnZVByb3BlcnRpZXMsIHN0cmluZ107XG5cbi8qKlxuICogQSBmdW5jdGlvbiB0aGF0IGdlbmVyYXRlcyBhbiBhcnJheSBvZiBtZW51IG9wdGlvbnMgZm9yIEZpZWxkRHJvcGRvd25cbiAqIG9yIGl0cyBkZXNjZW5kYW50cy5cbiAqL1xuZXhwb3J0IHR5cGUgTWVudUdlbmVyYXRvckZ1bmN0aW9uID0gKHRoaXM6IEZpZWxkRHJvcGRvd24pID0+IE1lbnVPcHRpb25bXTtcblxuLyoqXG4gKiBFaXRoZXIgYW4gYXJyYXkgb2YgbWVudSBvcHRpb25zIG9yIGEgZnVuY3Rpb24gdGhhdCBnZW5lcmF0ZXMgYW4gYXJyYXkgb2ZcbiAqIG1lbnUgb3B0aW9ucyBmb3IgRmllbGREcm9wZG93biBvciBpdHMgZGVzY2VuZGFudHMuXG4gKi9cbmV4cG9ydCB0eXBlIE1lbnVHZW5lcmF0b3IgPSBNZW51T3B0aW9uW118TWVudUdlbmVyYXRvckZ1bmN0aW9uO1xuXG4vKipcbiAqIGZyb21Kc29uIGNvbmZpZyBmb3IgdGhlIGRyb3Bkb3duIGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkRHJvcGRvd25Gcm9tSnNvbkNvbmZpZyBleHRlbmRzIEZpZWxkQ29uZmlnIHtcbiAgb3B0aW9ucz86IE1lbnVPcHRpb25bXTtcbn1cblxuLyoqXG4gKiBUaGUgeSBvZmZzZXQgZnJvbSB0aGUgdG9wIG9mIHRoZSBmaWVsZCB0byB0aGUgdG9wIG9mIHRoZSBpbWFnZSwgaWYgYW4gaW1hZ2VcbiAqIGlzIHNlbGVjdGVkLlxuICovXG5jb25zdCBJTUFHRV9ZX09GRlNFVCA9IDU7XG5cbi8qKiBUaGUgdG90YWwgdmVydGljYWwgcGFkZGluZyBhYm92ZSBhbmQgYmVsb3cgYW4gaW1hZ2UuICovXG5jb25zdCBJTUFHRV9ZX1BBRERJTkc6IG51bWJlciA9IElNQUdFX1lfT0ZGU0VUICogMjtcblxuLyoqXG4gKiBOT1RFOiBCZWNhdXNlIFNlbnRpbmVsIGlzIGFuIGVtcHR5IGNsYXNzLCBwcm92aW5nIGEgdmFsdWUgaXMgU2VudGluZWwgZG9lc1xuICogbm90IHJlc29sdmUgaW4gVFMgdGhhdCBpdCBpc24ndCBhIE1lbnVHZW5lcmF0b3IuXG4gKi9cbmZ1bmN0aW9uIGlzTWVudUdlbmVyYXRvcihtZW51R2VuZXJhdG9yOiBNZW51R2VuZXJhdG9yfFxuICAgICAgICAgICAgICAgICAgICAgICAgIFNlbnRpbmVsKTogbWVudUdlbmVyYXRvciBpcyBNZW51R2VuZXJhdG9yIHtcbiAgcmV0dXJuIG1lbnVHZW5lcmF0b3IgIT09IEZpZWxkLlNLSVBfU0VUVVA7XG59XG5cbi8qKlxuICogRmFjdG9yIG91dCBjb21tb24gd29yZHMgaW4gc3RhdGljYWxseSBkZWZpbmVkIG9wdGlvbnMuXG4gKiBDcmVhdGUgcHJlZml4IGFuZC9vciBzdWZmaXggbGFiZWxzLlxuICovXG5mdW5jdGlvbiB0cmltT3B0aW9ucyhvcHRpb25zOiBNZW51T3B0aW9uW10pOlxuICAgIHtvcHRpb25zOiBNZW51T3B0aW9uW107IHByZWZpeD86IHN0cmluZzsgc3VmZml4Pzogc3RyaW5nO30ge1xuICBsZXQgaGFzSW1hZ2VzID0gZmFsc2U7XG4gIGNvbnN0IHRyaW1tZWRPcHRpb25zID0gb3B0aW9ucy5tYXAoKFtsYWJlbCwgdmFsdWVdKTogTWVudU9wdGlvbiA9PiB7XG4gICAgaWYgKHR5cGVvZiBsYWJlbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBbcGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMobGFiZWwpLCB2YWx1ZV07XG4gICAgfVxuXG4gICAgaGFzSW1hZ2VzID0gdHJ1ZTtcbiAgICAvLyBDb3B5IHRoZSBpbWFnZSBwcm9wZXJ0aWVzIHNvIHRoZXkncmUgbm90IGluZmx1ZW5jZWQgYnkgdGhlIG9yaWdpbmFsLlxuICAgIC8vIE5PVEU6IE5vIG5lZWQgdG8gZGVlcCBjb3B5IHNpbmNlIGltYWdlIHByb3BlcnRpZXMgYXJlIG9ubHkgMSBsZXZlbCBkZWVwLlxuICAgIGNvbnN0IGltYWdlTGFiZWwgPSBsYWJlbC5hbHQgIT09IG51bGwgP1xuICAgICAgICB7Li4ubGFiZWwsIGFsdDogcGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMobGFiZWwuYWx0KX0gOlxuICAgICAgICB7Li4ubGFiZWx9O1xuICAgIHJldHVybiBbaW1hZ2VMYWJlbCwgdmFsdWVdO1xuICB9KTtcblxuICBpZiAoaGFzSW1hZ2VzIHx8IG9wdGlvbnMubGVuZ3RoIDwgMikgcmV0dXJuIHtvcHRpb25zOiB0cmltbWVkT3B0aW9uc307XG5cbiAgY29uc3Qgc3RyaW5nT3B0aW9ucyA9IHRyaW1tZWRPcHRpb25zIGFzIFtzdHJpbmcsIHN0cmluZ11bXTtcbiAgY29uc3Qgc3RyaW5nTGFiZWxzID0gc3RyaW5nT3B0aW9ucy5tYXAoKFtsYWJlbF0pID0+IGxhYmVsKTtcblxuICBjb25zdCBzaG9ydGVzdCA9IHV0aWxzU3RyaW5nLnNob3J0ZXN0U3RyaW5nTGVuZ3RoKHN0cmluZ0xhYmVscyk7XG4gIGNvbnN0IHByZWZpeExlbmd0aCA9IHV0aWxzU3RyaW5nLmNvbW1vbldvcmRQcmVmaXgoc3RyaW5nTGFiZWxzLCBzaG9ydGVzdCk7XG4gIGNvbnN0IHN1ZmZpeExlbmd0aCA9IHV0aWxzU3RyaW5nLmNvbW1vbldvcmRTdWZmaXgoc3RyaW5nTGFiZWxzLCBzaG9ydGVzdCk7XG5cbiAgaWYgKCghcHJlZml4TGVuZ3RoICYmICFzdWZmaXhMZW5ndGgpIHx8XG4gICAgICAoc2hvcnRlc3QgPD0gcHJlZml4TGVuZ3RoICsgc3VmZml4TGVuZ3RoKSkge1xuICAgIC8vIE9uZSBvciBtb3JlIHN0cmluZ3Mgd2lsbCBlbnRpcmVseSB2YW5pc2ggaWYgd2UgcHJvY2VlZC4gIEFib3J0LlxuICAgIHJldHVybiB7b3B0aW9uczogc3RyaW5nT3B0aW9uc307XG4gIH1cblxuICBjb25zdCBwcmVmaXggPVxuICAgICAgcHJlZml4TGVuZ3RoID8gc3RyaW5nTGFiZWxzWzBdLnN1YnN0cmluZygwLCBwcmVmaXhMZW5ndGggLSAxKSA6IHVuZGVmaW5lZDtcbiAgY29uc3Qgc3VmZml4ID1cbiAgICAgIHN1ZmZpeExlbmd0aCA/IHN0cmluZ0xhYmVsc1swXS5zdWJzdHIoMSAtIHN1ZmZpeExlbmd0aCkgOiB1bmRlZmluZWQ7XG4gIHJldHVybiB7XG4gICAgb3B0aW9uczogYXBwbHlUcmltKHN0cmluZ09wdGlvbnMsIHByZWZpeExlbmd0aCwgc3VmZml4TGVuZ3RoKSxcbiAgICBwcmVmaXgsXG4gICAgc3VmZml4LFxuICB9O1xufVxuXG4vKipcbiAqIFVzZSB0aGUgY2FsY3VsYXRlZCBwcmVmaXggYW5kIHN1ZmZpeCBsZW5ndGhzIHRvIHRyaW0gYWxsIG9mIHRoZSBvcHRpb25zIGluXG4gKiB0aGUgZ2l2ZW4gYXJyYXkuXG4gKlxuICogQHBhcmFtIG9wdGlvbnMgQXJyYXkgb2Ygb3B0aW9uIHR1cGxlczpcbiAqICAgICAoaHVtYW4tcmVhZGFibGUgdGV4dCBvciBpbWFnZSwgbGFuZ3VhZ2UtbmV1dHJhbCBuYW1lKS5cbiAqIEBwYXJhbSBwcmVmaXhMZW5ndGggVGhlIGxlbmd0aCBvZiB0aGUgY29tbW9uIHByZWZpeC5cbiAqIEBwYXJhbSBzdWZmaXhMZW5ndGggVGhlIGxlbmd0aCBvZiB0aGUgY29tbW9uIHN1ZmZpeFxuICogQHJldHVybnMgQSBuZXcgYXJyYXkgd2l0aCBhbGwgb2YgdGhlIG9wdGlvbiB0ZXh0IHRyaW1tZWQuXG4gKi9cbmZ1bmN0aW9uIGFwcGx5VHJpbShcbiAgICBvcHRpb25zOiBbc3RyaW5nLCBzdHJpbmddW10sIHByZWZpeExlbmd0aDogbnVtYmVyLFxuICAgIHN1ZmZpeExlbmd0aDogbnVtYmVyKTogTWVudU9wdGlvbltdIHtcbiAgcmV0dXJuIG9wdGlvbnMubWFwKFxuICAgICAgKFt0ZXh0LCB2YWx1ZV0pID0+XG4gICAgICAgICAgW3RleHQuc3Vic3RyaW5nKHByZWZpeExlbmd0aCwgdGV4dC5sZW5ndGggLSBzdWZmaXhMZW5ndGgpLFxuICAgICAgICAgICB2YWx1ZSxcbiAgXSk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoZSBkYXRhIHN0cnVjdHVyZSB0byBiZSBwcm9jZXNzZWQgYXMgYW4gb3B0aW9ucyBsaXN0LlxuICpcbiAqIEBwYXJhbSBvcHRpb25zIFRoZSBwcm9wb3NlZCBkcm9wZG93biBvcHRpb25zLlxuICogQHRocm93cyB7VHlwZUVycm9yfSBJZiBwcm9wb3NlZCBvcHRpb25zIGFyZSBpbmNvcnJlY3RseSBzdHJ1Y3R1cmVkLlxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZU9wdGlvbnMob3B0aW9uczogTWVudU9wdGlvbltdKSB7XG4gIGlmICghQXJyYXkuaXNBcnJheShvcHRpb25zKSkge1xuICAgIHRocm93IFR5cGVFcnJvcignRmllbGREcm9wZG93biBvcHRpb25zIG11c3QgYmUgYW4gYXJyYXkuJyk7XG4gIH1cbiAgaWYgKCFvcHRpb25zLmxlbmd0aCkge1xuICAgIHRocm93IFR5cGVFcnJvcignRmllbGREcm9wZG93biBvcHRpb25zIG11c3Qgbm90IGJlIGFuIGVtcHR5IGFycmF5LicpO1xuICB9XG4gIGxldCBmb3VuZEVycm9yID0gZmFsc2U7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHR1cGxlID0gb3B0aW9uc1tpXTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodHVwbGUpKSB7XG4gICAgICBmb3VuZEVycm9yID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgJ0ludmFsaWQgb3B0aW9uWycgKyBpICsgJ106IEVhY2ggRmllbGREcm9wZG93biBvcHRpb24gbXVzdCBiZSBhbiAnICtcbiAgICAgICAgICAgICAgJ2FycmF5LiBGb3VuZDogJyxcbiAgICAgICAgICB0dXBsZSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdHVwbGVbMV0gIT09ICdzdHJpbmcnKSB7XG4gICAgICBmb3VuZEVycm9yID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgJ0ludmFsaWQgb3B0aW9uWycgKyBpICsgJ106IEVhY2ggRmllbGREcm9wZG93biBvcHRpb24gaWQgbXVzdCBiZSAnICtcbiAgICAgICAgICAgICAgJ2Egc3RyaW5nLiBGb3VuZCAnICsgdHVwbGVbMV0gKyAnIGluOiAnLFxuICAgICAgICAgIHR1cGxlKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICB0dXBsZVswXSAmJiB0eXBlb2YgdHVwbGVbMF0gIT09ICdzdHJpbmcnICYmXG4gICAgICAgIHR5cGVvZiB0dXBsZVswXS5zcmMgIT09ICdzdHJpbmcnKSB7XG4gICAgICBmb3VuZEVycm9yID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgJ0ludmFsaWQgb3B0aW9uWycgKyBpICsgJ106IEVhY2ggRmllbGREcm9wZG93biBvcHRpb24gbXVzdCBoYXZlIGEgJyArXG4gICAgICAgICAgICAgICdzdHJpbmcgbGFiZWwgb3IgaW1hZ2UgZGVzY3JpcHRpb24uIEZvdW5kJyArIHR1cGxlWzBdICsgJyBpbjogJyxcbiAgICAgICAgICB0dXBsZSk7XG4gICAgfVxuICB9XG4gIGlmIChmb3VuZEVycm9yKSB7XG4gICAgdGhyb3cgVHlwZUVycm9yKCdGb3VuZCBpbnZhbGlkIEZpZWxkRHJvcGRvd24gb3B0aW9ucy4nKTtcbiAgfVxufVxuXG5maWVsZFJlZ2lzdHJ5LnJlZ2lzdGVyKCdmaWVsZF9kcm9wZG93bicsIEZpZWxkRHJvcGRvd24pO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3Igb2JqZWN0cy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMub2JqZWN0XG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMub2JqZWN0Jyk7XG5cbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4vZGVwcmVjYXRpb24uanMnO1xuXG5cbi8qKlxuICogSW5oZXJpdCB0aGUgcHJvdG90eXBlIG1ldGhvZHMgZnJvbSBvbmUgY29uc3RydWN0b3IgaW50byBhbm90aGVyLlxuICpcbiAqIEBwYXJhbSBjaGlsZEN0b3IgQ2hpbGQgY2xhc3MuXG4gKiBAcGFyYW0gcGFyZW50Q3RvciBQYXJlbnQgY2xhc3MuXG4gKiBAc3VwcHJlc3Mge3N0cmljdE1pc3NpbmdQcm9wZXJ0aWVzfSBzdXBlckNsYXNzXyBpcyBub3QgZGVmaW5lZCBvbiBGdW5jdGlvbi5cbiAqIEBkZXByZWNhdGVkIE5vIGxvbmdlciBwcm92aWRlZCBieSBCbG9ja2x5LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMub2JqZWN0LmluaGVyaXRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmhlcml0cyhjaGlsZEN0b3I6IEZ1bmN0aW9uLCBwYXJlbnRDdG9yOiBGdW5jdGlvbikge1xuICBkZXByZWNhdGlvbi53YXJuKCdCbG9ja2x5LnV0aWxzLm9iamVjdC5pbmhlcml0cycsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcpO1xuICAvLyBTZXQgYSAuc3VwZXJDbGFzc18gcHJvcGVydHkgc28gdGhhdCBtZXRob2RzIGNhbiBjYWxsIHBhcmVudCBtZXRob2RzXG4gIC8vIHdpdGhvdXQgaGFyZC1jb2RpbmcgdGhlIHBhcmVudCBjbGFzcyBuYW1lLlxuICAvLyBDb3VsZCBiZSByZXBsYWNlZCBieSBFUzYncyBzdXBlcigpLlxuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdzdXBlckNsYXNzXycgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAvLyAnRnVuY3Rpb24nLlxuICAoY2hpbGRDdG9yIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc3VwZXJDbGFzc18gPSBwYXJlbnRDdG9yLnByb3RvdHlwZTtcblxuICAvLyBMaW5rIHRoZSBjaGlsZCBjbGFzcyB0byB0aGUgcGFyZW50IGNsYXNzIHNvIHRoYXQgc3RhdGljIG1ldGhvZHMgaW5oZXJpdC5cbiAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGNoaWxkQ3RvciwgcGFyZW50Q3Rvcik7XG5cbiAgLy8gUmVwbGFjZSB0aGUgY2hpbGQgY29uc3RydWN0b3IncyBwcm90b3R5cGUgb2JqZWN0IHdpdGggYW4gaW5zdGFuY2VcbiAgLy8gb2YgdGhlIHBhcmVudCBjbGFzcy5cbiAgY2hpbGRDdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocGFyZW50Q3Rvci5wcm90b3R5cGUpO1xuICBjaGlsZEN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gY2hpbGRDdG9yO1xufVxuLy8gQWx0ZXJuYXRpdmVseSwgb25lIGNvdWxkIHVzZSB0aGlzIGluc3RlYWQ6XG4vLyBPYmplY3Quc2V0UHJvdG90eXBlT2YoY2hpbGRDdG9yLnByb3RvdHlwZSwgcGFyZW50Q3Rvci5wcm90b3R5cGUpO1xuXG4vKipcbiAqIENvcGllcyBhbGwgdGhlIG1lbWJlcnMgb2YgYSBzb3VyY2Ugb2JqZWN0IHRvIGEgdGFyZ2V0IG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gdGFyZ2V0IFRhcmdldC5cbiAqIEBwYXJhbSBzb3VyY2UgU291cmNlLlxuICogQGRlcHJlY2F0ZWQgVXNlIHRoZSBidWlsdC1pbiAqKk9iamVjdC5hc3NpZ24qKiBpbnN0ZWFkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMub2JqZWN0Lm1peGluXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtaXhpbih0YXJnZXQ6IEFueUR1cmluZ01pZ3JhdGlvbiwgc291cmNlOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLm9iamVjdC5taXhpbicsICdNYXkgMjAyMicsICdNYXkgMjAyMycsICdPYmplY3QuYXNzaWduJyk7XG4gIGZvciAoY29uc3QgeCBpbiBzb3VyY2UpIHtcbiAgICB0YXJnZXRbeF0gPSBzb3VyY2VbeF07XG4gIH1cbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBhIGRlZXAgbWVyZ2Ugb2YgYWxsIG1lbWJlcnMgb2YgYSBzb3VyY2Ugb2JqZWN0IHdpdGggYSB0YXJnZXQgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0LlxuICogQHBhcmFtIHNvdXJjZSBTb3VyY2UuXG4gKiBAcmV0dXJucyBUaGUgcmVzdWx0aW5nIG9iamVjdC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLm9iamVjdC5kZWVwTWVyZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZXBNZXJnZShcbiAgICB0YXJnZXQ6IEFueUR1cmluZ01pZ3JhdGlvbixcbiAgICBzb3VyY2U6IEFueUR1cmluZ01pZ3JhdGlvbik6IEFueUR1cmluZ01pZ3JhdGlvbiB7XG4gIGZvciAoY29uc3QgeCBpbiBzb3VyY2UpIHtcbiAgICBpZiAoc291cmNlW3hdICE9PSBudWxsICYmIHR5cGVvZiBzb3VyY2VbeF0gPT09ICdvYmplY3QnKSB7XG4gICAgICB0YXJnZXRbeF0gPSBkZWVwTWVyZ2UodGFyZ2V0W3hdIHx8IE9iamVjdC5jcmVhdGUobnVsbCksIHNvdXJjZVt4XSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldFt4XSA9IHNvdXJjZVt4XTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhcmdldDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIGFycmF5IG9mIGEgZ2l2ZW4gb2JqZWN0J3Mgb3duIGVudW1lcmFibGUgcHJvcGVydHkgdmFsdWVzLlxuICpcbiAqIEBwYXJhbSBvYmogT2JqZWN0IGNvbnRhaW5pbmcgdmFsdWVzLlxuICogQHJldHVybnMgQXJyYXkgb2YgdmFsdWVzLlxuICogQGRlcHJlY2F0ZWQgVXNlIHRoZSBidWlsdC1pbiAqKk9iamVjdC52YWx1ZXMqKiBpbnN0ZWFkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMub2JqZWN0LnZhbHVlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsdWVzKG9iajogQW55RHVyaW5nTWlncmF0aW9uKTogQW55RHVyaW5nTWlncmF0aW9uW10ge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkudXRpbHMub2JqZWN0LnZhbHVlcycsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcsXG4gICAgICAnT2JqZWN0LnZhbHVlcycpO1xuICByZXR1cm4gT2JqZWN0LnZhbHVlcyhvYmopO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciB0aGUgdG9vbGJveCBhbmQgZmx5b3V0LlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS51dGlscy50b29sYm94XG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMudG9vbGJveCcpO1xuXG5pbXBvcnQgdHlwZSB7Q29ubmVjdGlvblN0YXRlfSBmcm9tICcuLi9zZXJpYWxpemF0aW9uL2Jsb2Nrcy5qcyc7XG5pbXBvcnQgdHlwZSB7Q3NzQ29uZmlnIGFzIENhdGVnb3J5Q3NzQ29uZmlnfSBmcm9tICcuLi90b29sYm94L2NhdGVnb3J5LmpzJztcbmltcG9ydCB0eXBlIHtDc3NDb25maWcgYXMgU2VwYXJhdG9yQ3NzQ29uZmlnfSBmcm9tICcuLi90b29sYm94L3NlcGFyYXRvci5qcyc7XG5pbXBvcnQgKiBhcyBYbWwgZnJvbSAnLi4veG1sLmpzJztcblxuXG4vKipcbiAqIFRoZSBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gY3JlYXRlIGEgYmxvY2sgaW4gdGhlIHRvb2xib3guXG4gKiBOb3RlIHRoYXQgZGlzYWJsZWQgaGFzIGEgZGlmZmVyZW50IHR5cGUgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnRvb2xib3guQmxvY2tJbmZvXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmxvY2tJbmZvIHtcbiAga2luZDogc3RyaW5nO1xuICBibG9ja3htbD86IHN0cmluZ3xOb2RlO1xuICB0eXBlPzogc3RyaW5nO1xuICBnYXA/OiBzdHJpbmd8bnVtYmVyO1xuICBkaXNhYmxlZD86IHN0cmluZ3xib29sZWFuO1xuICBlbmFibGVkPzogYm9vbGVhbjtcbiAgaWQ/OiBzdHJpbmc7XG4gIHg/OiBudW1iZXI7XG4gIHk/OiBudW1iZXI7XG4gIGNvbGxhcHNlZD86IGJvb2xlYW47XG4gIGlubGluZT86IGJvb2xlYW47XG4gIGRhdGE/OiBzdHJpbmc7XG4gIGV4dHJhU3RhdGU/OiBBbnlEdXJpbmdNaWdyYXRpb247XG4gIGljb25zPzoge1trZXk6IHN0cmluZ106IEFueUR1cmluZ01pZ3JhdGlvbn07XG4gIGZpZWxkcz86IHtba2V5OiBzdHJpbmddOiBBbnlEdXJpbmdNaWdyYXRpb259O1xuICBpbnB1dHM/OiB7W2tleTogc3RyaW5nXTogQ29ubmVjdGlvblN0YXRlfTtcbiAgbmV4dD86IENvbm5lY3Rpb25TdGF0ZTtcbn1cblxuLyoqXG4gKiBUaGUgaW5mb3JtYXRpb24gbmVlZGVkIHRvIGNyZWF0ZSBhIHNlcGFyYXRvciBpbiB0aGUgdG9vbGJveC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LlNlcGFyYXRvckluZm9cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXBhcmF0b3JJbmZvIHtcbiAga2luZDogc3RyaW5nO1xuICBpZDogc3RyaW5nfHVuZGVmaW5lZDtcbiAgZ2FwOiBudW1iZXJ8dW5kZWZpbmVkO1xuICBjc3Njb25maWc6IFNlcGFyYXRvckNzc0NvbmZpZ3x1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBidXR0b24gaW4gdGhlIHRvb2xib3guXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMudG9vbGJveC5CdXR0b25JbmZvXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQnV0dG9uSW5mbyB7XG4gIGtpbmQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xuICBjYWxsYmFja2tleTogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRoZSBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gY3JlYXRlIGEgbGFiZWwgaW4gdGhlIHRvb2xib3guXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMudG9vbGJveC5MYWJlbEluZm9cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBMYWJlbEluZm8ge1xuICBraW5kOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgaWQ6IHN0cmluZ3x1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgZWl0aGVyIGEgYnV0dG9uIG9yIGEgbGFiZWwgaW4gdGhlIGZseW91dC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LkJ1dHRvbk9yTGFiZWxJbmZvXG4gKi9cbmV4cG9ydCB0eXBlIEJ1dHRvbk9yTGFiZWxJbmZvID0gQnV0dG9uSW5mb3xMYWJlbEluZm87XG5cbi8qKlxuICogVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBjYXRlZ29yeSBpbiB0aGUgdG9vbGJveC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LlN0YXRpY0NhdGVnb3J5SW5mb1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRpY0NhdGVnb3J5SW5mbyB7XG4gIGtpbmQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBjb250ZW50czogVG9vbGJveEl0ZW1JbmZvW107XG4gIGlkOiBzdHJpbmd8dW5kZWZpbmVkO1xuICBjYXRlZ29yeXN0eWxlOiBzdHJpbmd8dW5kZWZpbmVkO1xuICBjb2xvdXI6IHN0cmluZ3x1bmRlZmluZWQ7XG4gIGNzc2NvbmZpZzogQ2F0ZWdvcnlDc3NDb25maWd8dW5kZWZpbmVkO1xuICBoaWRkZW46IHN0cmluZ3x1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBjdXN0b20gY2F0ZWdvcnkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMudG9vbGJveC5EeW5hbWljQ2F0ZWdvcnlJbmZvXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRHluYW1pY0NhdGVnb3J5SW5mbyB7XG4gIGtpbmQ6IHN0cmluZztcbiAgY3VzdG9tOiBzdHJpbmc7XG4gIGlkOiBzdHJpbmd8dW5kZWZpbmVkO1xuICBjYXRlZ29yeXN0eWxlOiBzdHJpbmd8dW5kZWZpbmVkO1xuICBjb2xvdXI6IHN0cmluZ3x1bmRlZmluZWQ7XG4gIGNzc2NvbmZpZzogQ2F0ZWdvcnlDc3NDb25maWd8dW5kZWZpbmVkO1xuICBoaWRkZW46IHN0cmluZ3x1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgZWl0aGVyIGEgZHluYW1pYyBvciBzdGF0aWMgY2F0ZWdvcnkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMudG9vbGJveC5DYXRlZ29yeUluZm9cbiAqL1xuZXhwb3J0IHR5cGUgQ2F0ZWdvcnlJbmZvID0gU3RhdGljQ2F0ZWdvcnlJbmZvfER5bmFtaWNDYXRlZ29yeUluZm87XG5cbi8qKlxuICogQW55IGluZm9ybWF0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gY3JlYXRlIGFuIGl0ZW0gaW4gdGhlIHRvb2xib3guXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMudG9vbGJveC5Ub29sYm94SXRlbUluZm9cbiAqL1xuZXhwb3J0IHR5cGUgVG9vbGJveEl0ZW1JbmZvID0gRmx5b3V0SXRlbUluZm98U3RhdGljQ2F0ZWdvcnlJbmZvO1xuXG4vKipcbiAqIEFsbCB0aGUgZGlmZmVyZW50IHR5cGVzIHRoYXQgY2FuIGJlIGRpc3BsYXllZCBpbiBhIGZseW91dC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LkZseW91dEl0ZW1JbmZvXG4gKi9cbmV4cG9ydCB0eXBlIEZseW91dEl0ZW1JbmZvID1cbiAgICBCbG9ja0luZm98U2VwYXJhdG9ySW5mb3xCdXR0b25JbmZvfExhYmVsSW5mb3xEeW5hbWljQ2F0ZWdvcnlJbmZvO1xuXG4vKipcbiAqIFRoZSBKU09OIGRlZmluaXRpb24gb2YgYSB0b29sYm94LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnRvb2xib3guVG9vbGJveEluZm9cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUb29sYm94SW5mbyB7XG4gIGtpbmQ/OiBzdHJpbmc7XG4gIGNvbnRlbnRzOiBUb29sYm94SXRlbUluZm9bXTtcbn1cblxuLyoqXG4gKiBBbiBhcnJheSBob2xkaW5nIGZseW91dCBpdGVtcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LkZseW91dEl0ZW1JbmZvQXJyYXlcbiAqL1xuZXhwb3J0IHR5cGUgRmx5b3V0SXRlbUluZm9BcnJheSA9IEZseW91dEl0ZW1JbmZvW107XG5cbi8qKlxuICogQWxsIG9mIHRoZSBkaWZmZXJlbnQgdHlwZXMgdGhhdCBjYW4gY3JlYXRlIGEgdG9vbGJveC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LlRvb2xib3hEZWZpbml0aW9uXG4gKi9cbmV4cG9ydCB0eXBlIFRvb2xib3hEZWZpbml0aW9uID0gTm9kZXxUb29sYm94SW5mb3xzdHJpbmc7XG5cbi8qKlxuICogQWxsIG9mIHRoZSBkaWZmZXJlbnQgdHlwZXMgdGhhdCBjYW4gYmUgdXNlZCB0byBzaG93IGl0ZW1zIGluIGEgZmx5b3V0LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnRvb2xib3guRmx5b3V0RGVmaW5pdGlvblxuICovXG5leHBvcnQgdHlwZSBGbHlvdXREZWZpbml0aW9uID0gRmx5b3V0SXRlbUluZm9BcnJheXxOb2RlTGlzdHxUb29sYm94SW5mb3xOb2RlW107XG5cbi8qKlxuICogVGhlIG5hbWUgdXNlZCB0byBpZGVudGlmeSBhIHRvb2xib3ggdGhhdCBoYXMgY2F0ZWdvcnkgbGlrZSBpdGVtcy5cbiAqIFRoaXMgb25seSBuZWVkcyB0byBiZSB1c2VkIGlmIGEgdG9vbGJveCB3YW50cyB0byBiZSB0cmVhdGVkIGxpa2UgYSBjYXRlZ29yeVxuICogdG9vbGJveCBidXQgZG9lcyBub3QgYWN0dWFsbHkgY29udGFpbiBhbnkgdG9vbGJveCBpdGVtcyB3aXRoIHRoZSBraW5kXG4gKiAnY2F0ZWdvcnknLlxuICovXG5jb25zdCBDQVRFR09SWV9UT09MQk9YX0tJTkQgPSAnY2F0ZWdvcnlUb29sYm94JztcblxuLyoqXG4gKiBUaGUgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IGEgdG9vbGJveCB0aGF0IGhhcyBubyBjYXRlZ29yaWVzIGFuZCBpcyBkaXNwbGF5ZWRcbiAqIGFzIGEgc2ltcGxlIGZseW91dCBkaXNwbGF5aW5nIGJsb2NrcywgYnV0dG9ucywgb3IgbGFiZWxzLlxuICovXG5jb25zdCBGTFlPVVRfVE9PTEJPWF9LSU5EID0gJ2ZseW91dFRvb2xib3gnO1xuXG4vKipcbiAqIFBvc2l0aW9uIG9mIHRoZSB0b29sYm94IGFuZC9vciBmbHlvdXQgcmVsYXRpdmUgdG8gdGhlIHdvcmtzcGFjZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LlBvc2l0aW9uXG4gKi9cbmV4cG9ydCBlbnVtIFBvc2l0aW9uIHtcbiAgVE9QLFxuICBCT1RUT00sXG4gIExFRlQsXG4gIFJJR0hUXG59XG5cbi8qKlxuICogQ29udmVydHMgdGhlIHRvb2xib3ggZGVmaW5pdGlvbiBpbnRvIHRvb2xib3ggSlNPTi5cbiAqXG4gKiBAcGFyYW0gdG9vbGJveERlZiBUaGUgZGVmaW5pdGlvbiBvZiB0aGUgdG9vbGJveCBpbiBvbmUgb2YgaXRzIG1hbnkgZm9ybXMuXG4gKiBAcmV0dXJucyBPYmplY3QgaG9sZGluZyBpbmZvcm1hdGlvbiBmb3IgY3JlYXRpbmcgYSB0b29sYm94LlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMudG9vbGJveC5jb252ZXJ0VG9vbGJveERlZlRvSnNvblxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0VG9vbGJveERlZlRvSnNvbih0b29sYm94RGVmOiBUb29sYm94RGVmaW5pdGlvbnxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsKTogVG9vbGJveEluZm98bnVsbCB7XG4gIGlmICghdG9vbGJveERlZikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKHRvb2xib3hEZWYgaW5zdGFuY2VvZiBFbGVtZW50IHx8IHR5cGVvZiB0b29sYm94RGVmID09PSAnc3RyaW5nJykge1xuICAgIHRvb2xib3hEZWYgPSBwYXJzZVRvb2xib3hUcmVlKHRvb2xib3hEZWYpO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnTm9kZSB8IG51bGwnIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ05vZGUnLlxuICAgIHRvb2xib3hEZWYgPSBjb252ZXJ0VG9Ub29sYm94SnNvbih0b29sYm94RGVmIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gIH1cblxuICBjb25zdCB0b29sYm94SnNvbiA9IHRvb2xib3hEZWYgYXMgVG9vbGJveEluZm87XG4gIHZhbGlkYXRlVG9vbGJveCh0b29sYm94SnNvbik7XG4gIHJldHVybiB0b29sYm94SnNvbjtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhlIHRvb2xib3ggSlNPTiBmaWVsZHMgaGF2ZSBiZWVuIHNldCBjb3JyZWN0bHkuXG4gKlxuICogQHBhcmFtIHRvb2xib3hKc29uIE9iamVjdCBob2xkaW5nIGluZm9ybWF0aW9uIGZvciBjcmVhdGluZyBhIHRvb2xib3guXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlIHRvb2xib3ggaXMgbm90IHRoZSBjb3JyZWN0IGZvcm1hdC5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVUb29sYm94KHRvb2xib3hKc29uOiBUb29sYm94SW5mbykge1xuICBjb25zdCB0b29sYm94S2luZCA9IHRvb2xib3hKc29uWydraW5kJ107XG4gIGNvbnN0IHRvb2xib3hDb250ZW50cyA9IHRvb2xib3hKc29uWydjb250ZW50cyddO1xuXG4gIGlmICh0b29sYm94S2luZCkge1xuICAgIGlmICh0b29sYm94S2luZCAhPT0gRkxZT1VUX1RPT0xCT1hfS0lORCAmJlxuICAgICAgICB0b29sYm94S2luZCAhPT0gQ0FURUdPUllfVE9PTEJPWF9LSU5EKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnSW52YWxpZCB0b29sYm94IGtpbmQgJyArIHRvb2xib3hLaW5kICsgJy4nICtcbiAgICAgICAgICAnIFBsZWFzZSBzdXBwbHkgZWl0aGVyICcgKyBGTFlPVVRfVE9PTEJPWF9LSU5EICsgJyBvciAnICtcbiAgICAgICAgICBDQVRFR09SWV9UT09MQk9YX0tJTkQpO1xuICAgIH1cbiAgfVxuICBpZiAoIXRvb2xib3hDb250ZW50cykge1xuICAgIHRocm93IEVycm9yKCdUb29sYm94IG11c3QgaGF2ZSBhIGNvbnRlbnRzIGF0dHJpYnV0ZS4nKTtcbiAgfVxufVxuXG4vKipcbiAqIENvbnZlcnRzIHRoZSBmbHlvdXQgZGVmaW5pdGlvbiBpbnRvIGEgbGlzdCBvZiBmbHlvdXQgaXRlbXMuXG4gKlxuICogQHBhcmFtIGZseW91dERlZiBUaGUgZGVmaW5pdGlvbiBvZiB0aGUgZmx5b3V0IGluIG9uZSBvZiBpdHMgbWFueSBmb3Jtcy5cbiAqIEByZXR1cm5zIEEgbGlzdCBvZiBmbHlvdXQgaXRlbXMuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LmNvbnZlcnRGbHlvdXREZWZUb0pzb25BcnJheVxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0Rmx5b3V0RGVmVG9Kc29uQXJyYXkoZmx5b3V0RGVmOiBGbHlvdXREZWZpbml0aW9ufFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsKTogRmx5b3V0SXRlbUluZm9BcnJheSB7XG4gIGlmICghZmx5b3V0RGVmKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgaWYgKChmbHlvdXREZWYgYXMgQW55RHVyaW5nTWlncmF0aW9uKVsnY29udGVudHMnXSkge1xuICAgIHJldHVybiAoZmx5b3V0RGVmIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbJ2NvbnRlbnRzJ107XG4gIH1cbiAgLy8gSWYgaXQgaXMgYWxyZWFkeSBpbiB0aGUgY29ycmVjdCBmb3JtYXQgcmV0dXJuIHRoZSBmbHlvdXREZWYuXG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ25vZGVUeXBlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gIC8vICdOb2RlIHwgRmx5b3V0SXRlbUluZm8nLlxuICBpZiAoQXJyYXkuaXNBcnJheShmbHlvdXREZWYpICYmIGZseW91dERlZi5sZW5ndGggPiAwICYmXG4gICAgICAhKChmbHlvdXREZWZbMF0pIGFzIEFueUR1cmluZ01pZ3JhdGlvbikubm9kZVR5cGUpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ0ZseW91dEl0ZW1JbmZvQXJyYXkgfCBOb2RlW10nIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gdHlwZSAnRmx5b3V0SXRlbUluZm9BcnJheScuXG4gICAgcmV0dXJuIGZseW91dERlZiBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gIH1cblxuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ1Rvb2xib3hJdGVtSW5mb1tdIHwgRmx5b3V0SXRlbUluZm9BcnJheSdcbiAgLy8gaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZSAnRmx5b3V0SXRlbUluZm9BcnJheScuXG4gIHJldHVybiB4bWxUb0pzb25BcnJheShmbHlvdXREZWYgYXMgTm9kZVtdIHwgTm9kZUxpc3QpIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbn1cblxuLyoqXG4gKiBXaGV0aGVyIG9yIG5vdCB0aGUgdG9vbGJveCBkZWZpbml0aW9uIGhhcyBjYXRlZ29yaWVzLlxuICpcbiAqIEBwYXJhbSB0b29sYm94SnNvbiBPYmplY3QgaG9sZGluZyBpbmZvcm1hdGlvbiBmb3IgY3JlYXRpbmcgYSB0b29sYm94LlxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdG9vbGJveCBoYXMgY2F0ZWdvcmllcy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnRvb2xib3guaGFzQ2F0ZWdvcmllc1xuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoYXNDYXRlZ29yaWVzKHRvb2xib3hKc29uOiBUb29sYm94SW5mb3xudWxsKTogYm9vbGVhbiB7XG4gIHJldHVybiBURVNUX09OTFkuaGFzQ2F0ZWdvcmllc0ludGVybmFsKHRvb2xib3hKc29uKTtcbn1cblxuLyoqXG4gKiBQcml2YXRlIHZlcnNpb24gb2YgaGFzQ2F0ZWdvcmllcyBmb3Igc3R1YmJpbmcgaW4gdGVzdHMuXG4gKi9cbmZ1bmN0aW9uIGhhc0NhdGVnb3JpZXNJbnRlcm5hbCh0b29sYm94SnNvbjogVG9vbGJveEluZm98bnVsbCk6IGJvb2xlYW4ge1xuICBpZiAoIXRvb2xib3hKc29uKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgdG9vbGJveEtpbmQgPSB0b29sYm94SnNvblsna2luZCddO1xuICBpZiAodG9vbGJveEtpbmQpIHtcbiAgICByZXR1cm4gdG9vbGJveEtpbmQgPT09IENBVEVHT1JZX1RPT0xCT1hfS0lORDtcbiAgfVxuXG4gIGNvbnN0IGNhdGVnb3JpZXMgPSB0b29sYm94SnNvblsnY29udGVudHMnXS5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgIHJldHVybiBpdGVtWydraW5kJ10udG9VcHBlckNhc2UoKSA9PT0gJ0NBVEVHT1JZJztcbiAgfSk7XG4gIHJldHVybiAhIWNhdGVnb3JpZXMubGVuZ3RoO1xufVxuXG4vKipcbiAqIFdoZXRoZXIgb3Igbm90IHRoZSBjYXRlZ29yeSBpcyBjb2xsYXBzaWJsZS5cbiAqXG4gKiBAcGFyYW0gY2F0ZWdvcnlJbmZvIE9iamVjdCBob2xpbmcgaW5mb3JtYXRpb24gZm9yIGNyZWF0aW5nIGEgY2F0ZWdvcnkuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBjYXRlZ29yeSBoYXMgc3ViY2F0ZWdvcmllcy5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnRvb2xib3guaXNDYXRlZ29yeUNvbGxhcHNpYmxlXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQ2F0ZWdvcnlDb2xsYXBzaWJsZShjYXRlZ29yeUluZm86IENhdGVnb3J5SW5mbyk6IGJvb2xlYW4ge1xuICBpZiAoIWNhdGVnb3J5SW5mbyB8fCAhKGNhdGVnb3J5SW5mbyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydjb250ZW50cyddKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgY2F0ZWdvcmllcyA9XG4gICAgICAoY2F0ZWdvcnlJbmZvIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbJ2NvbnRlbnRzJ10uZmlsdGVyKGZ1bmN0aW9uKFxuICAgICAgICAgIGl0ZW06IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgICAgICByZXR1cm4gaXRlbVsna2luZCddLnRvVXBwZXJDYXNlKCkgPT09ICdDQVRFR09SWSc7XG4gICAgICB9KTtcbiAgcmV0dXJuICEhY2F0ZWdvcmllcy5sZW5ndGg7XG59XG5cbi8qKlxuICogUGFyc2VzIHRoZSBwcm92aWRlZCB0b29sYm94IGRlZmluaXRpb24gaW50byBhIGNvbnNpc3RlbnQgZm9ybWF0LlxuICpcbiAqIEBwYXJhbSB0b29sYm94RGVmIFRoZSBkZWZpbml0aW9uIG9mIHRoZSB0b29sYm94IGluIG9uZSBvZiBpdHMgbWFueSBmb3Jtcy5cbiAqIEByZXR1cm5zIE9iamVjdCBob2xkaW5nIGluZm9ybWF0aW9uIGZvciBjcmVhdGluZyBhIHRvb2xib3guXG4gKi9cbmZ1bmN0aW9uIGNvbnZlcnRUb1Rvb2xib3hKc29uKHRvb2xib3hEZWY6IE5vZGUpOiBUb29sYm94SW5mbyB7XG4gIGNvbnN0IGNvbnRlbnRzID0geG1sVG9Kc29uQXJyYXkodG9vbGJveERlZiBhcyBOb2RlIHwgTm9kZVtdKTtcbiAgY29uc3QgdG9vbGJveEpzb24gPSB7J2NvbnRlbnRzJzogY29udGVudHN9O1xuICBpZiAodG9vbGJveERlZiBpbnN0YW5jZW9mIE5vZGUpIHtcbiAgICBhZGRBdHRyaWJ1dGVzKHRvb2xib3hEZWYsIHRvb2xib3hKc29uKTtcbiAgfVxuICByZXR1cm4gdG9vbGJveEpzb247XG59XG5cbi8qKlxuICogQ29udmVydHMgdGhlIHhtbCBmb3IgYSB0b29sYm94IHRvIEpTT04uXG4gKlxuICogQHBhcmFtIHRvb2xib3hEZWYgVGhlIGRlZmluaXRpb24gb2YgdGhlIHRvb2xib3ggaW4gb25lIG9mIGl0cyBtYW55IGZvcm1zLlxuICogQHJldHVybnMgQSBsaXN0IG9mIG9iamVjdHMgaW4gdGhlIHRvb2xib3guXG4gKi9cbmZ1bmN0aW9uIHhtbFRvSnNvbkFycmF5KHRvb2xib3hEZWY6IE5vZGV8Tm9kZVtdfE5vZGVMaXN0KTogRmx5b3V0SXRlbUluZm9BcnJheXxcbiAgICBUb29sYm94SXRlbUluZm9bXSB7XG4gIGNvbnN0IGFyciA9IFtdO1xuICAvLyBJZiBpdCBpcyBhIG5vZGUgaXQgd2lsbCBoYXZlIGNoaWxkcmVuLlxuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdjaGlsZE5vZGVzJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gIC8vICdOb2RlIHwgTm9kZUxpc3QgfCBOb2RlW10nLlxuICBsZXQgY2hpbGROb2RlcyA9ICh0b29sYm94RGVmIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuY2hpbGROb2RlcztcbiAgaWYgKCFjaGlsZE5vZGVzKSB7XG4gICAgLy8gT3RoZXJ3aXNlIHRoZSB0b29sYm94RGVmIGlzIGFuIGFycmF5IG9yIGNvbGxlY3Rpb24uXG4gICAgY2hpbGROb2RlcyA9IHRvb2xib3hEZWY7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDAsIGNoaWxkOyBjaGlsZCA9IGNoaWxkTm9kZXNbaV07IGkrKykge1xuICAgIGlmICghY2hpbGQudGFnTmFtZSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IG9iaiA9IHt9O1xuICAgIGNvbnN0IHRhZ05hbWUgPSBjaGlsZC50YWdOYW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgKG9iaiBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydraW5kJ10gPSB0YWdOYW1lO1xuXG4gICAgLy8gU3RvcmUgdGhlIFhNTCBmb3IgYSBibG9jay5cbiAgICBpZiAodGFnTmFtZSA9PT0gJ0JMT0NLJykge1xuICAgICAgKG9iaiBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydibG9ja3htbCddID0gY2hpbGQ7XG4gICAgfSBlbHNlIGlmIChjaGlsZC5jaGlsZE5vZGVzICYmIGNoaWxkLmNoaWxkTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gR2V0IHRoZSBjb250ZW50cyBvZiBhIGNhdGVnb3J5XG4gICAgICAob2JqIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbJ2NvbnRlbnRzJ10gPSB4bWxUb0pzb25BcnJheShjaGlsZCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIFhNTCBhdHRyaWJ1dGVzIHRvIG9iamVjdFxuICAgIGFkZEF0dHJpYnV0ZXMoY2hpbGQsIG9iaik7XG4gICAgYXJyLnB1c2gob2JqKTtcbiAgfVxuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ3t9W10nIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgLy8gJ1Rvb2xib3hJdGVtSW5mb1tdIHwgRmx5b3V0SXRlbUluZm9BcnJheScuXG4gIHJldHVybiBhcnIgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xufVxuXG4vKipcbiAqIEFkZHMgdGhlIGF0dHJpYnV0ZXMgb24gdGhlIG5vZGUgdG8gdGhlIGdpdmVuIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gbm9kZSBUaGUgbm9kZSB0byBjb3B5IHRoZSBhdHRyaWJ1dGVzIGZyb20uXG4gKiBAcGFyYW0gb2JqIFRoZSBvYmplY3QgdG8gY29weSB0aGUgYXR0cmlidXRlcyB0by5cbiAqL1xuZnVuY3Rpb24gYWRkQXR0cmlidXRlcyhub2RlOiBOb2RlLCBvYmo6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdhdHRyaWJ1dGVzJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gIC8vICdOb2RlJy5cbiAgZm9yIChsZXQgaiA9IDA7IGogPCAobm9kZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdhdHRyaWJ1dGVzJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJ05vZGUnLlxuICAgIGNvbnN0IGF0dHIgPSAobm9kZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmF0dHJpYnV0ZXNbal07XG4gICAgaWYgKGF0dHIubm9kZU5hbWUuaW5kZXhPZignY3NzLScpID4gLTEpIHtcbiAgICAgIG9ialsnY3NzY29uZmlnJ10gPSBvYmpbJ2Nzc2NvbmZpZyddIHx8IHt9O1xuICAgICAgb2JqWydjc3Njb25maWcnXVthdHRyLm5vZGVOYW1lLnJlcGxhY2UoJ2Nzcy0nLCAnJyldID0gYXR0ci52YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqW2F0dHIubm9kZU5hbWVdID0gYXR0ci52YWx1ZTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBQYXJzZSB0aGUgcHJvdmlkZWQgdG9vbGJveCB0cmVlIGludG8gYSBjb25zaXN0ZW50IERPTSBmb3JtYXQuXG4gKlxuICogQHBhcmFtIHRvb2xib3hEZWYgRE9NIHRyZWUgb2YgYmxvY2tzLCBvciB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHNhbWUuXG4gKiBAcmV0dXJucyBET00gdHJlZSBvZiBibG9ja3MsIG9yIG51bGwuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy50b29sYm94LnBhcnNlVG9vbGJveFRyZWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVG9vbGJveFRyZWUodG9vbGJveERlZjogRWxlbWVudHxudWxsfHN0cmluZyk6IEVsZW1lbnR8XG4gICAgbnVsbCB7XG4gIGxldCBwYXJzZWRUb29sYm94RGVmOiBFbGVtZW50fG51bGwgPSBudWxsO1xuICBpZiAodG9vbGJveERlZikge1xuICAgIGlmICh0eXBlb2YgdG9vbGJveERlZiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHBhcnNlZFRvb2xib3hEZWYgPSBYbWwudGV4dFRvRG9tKHRvb2xib3hEZWYpO1xuICAgICAgaWYgKHBhcnNlZFRvb2xib3hEZWYubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gJ3htbCcpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdUb29sYm94IHNob3VsZCBiZSBhbiA8eG1sPiBkb2N1bWVudC4nKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRvb2xib3hEZWYgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICBwYXJzZWRUb29sYm94RGVmID0gdG9vbGJveERlZjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHBhcnNlZFRvb2xib3hEZWY7XG59XG5cbmV4cG9ydCBjb25zdCBURVNUX09OTFkgPSB7XG4gIGhhc0NhdGVnb3JpZXNJbnRlcm5hbCxcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogRXh0ZW5zaW9ucyBhcmUgZnVuY3Rpb25zIHRoYXQgaGVscCBpbml0aWFsaXplIGJsb2NrcywgdXN1YWxseVxuICogICAgICBhZGRpbmcgZHluYW1pYyBiZWhhdmlvciBzdWNoIGFzIG9uY2hhbmdlIGhhbmRsZXJzIGFuZCBtdXRhdG9ycy4gVGhlc2VcbiAqICAgICAgYXJlIGFwcGxpZWQgdXNpbmcgQmxvY2suYXBwbHlFeHRlbnNpb24oKSwgb3IgdGhlIEpTT04gXCJleHRlbnNpb25zXCJcbiAqICAgICAgYXJyYXkgYXR0cmlidXRlLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5FeHRlbnNpb25zXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXh0ZW5zaW9ucycpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQge0ZpZWxkRHJvcGRvd259IGZyb20gJy4vZmllbGRfZHJvcGRvd24uanMnO1xuaW1wb3J0IHtNdXRhdG9yfSBmcm9tICcuL211dGF0b3IuanMnO1xuaW1wb3J0ICogYXMgcGFyc2luZyBmcm9tICcuL3V0aWxzL3BhcnNpbmcuanMnO1xuXG5cbi8qKiBUaGUgc2V0IG9mIGFsbCByZWdpc3RlcmVkIGV4dGVuc2lvbnMsIGtleWVkIGJ5IGV4dGVuc2lvbiBuYW1lL2lkLiAqL1xuY29uc3QgYWxsRXh0ZW5zaW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5leHBvcnQgY29uc3QgVEVTVF9PTkxZID0ge2FsbEV4dGVuc2lvbnN9O1xuXG4vKipcbiAqIFJlZ2lzdGVycyBhIG5ldyBleHRlbnNpb24gZnVuY3Rpb24uIEV4dGVuc2lvbnMgYXJlIGZ1bmN0aW9ucyB0aGF0IGhlbHBcbiAqIGluaXRpYWxpemUgYmxvY2tzLCB1c3VhbGx5IGFkZGluZyBkeW5hbWljIGJlaGF2aW9yIHN1Y2ggYXMgb25jaGFuZ2VcbiAqIGhhbmRsZXJzIGFuZCBtdXRhdG9ycy4gVGhlc2UgYXJlIGFwcGxpZWQgdXNpbmcgQmxvY2suYXBwbHlFeHRlbnNpb24oKSwgb3JcbiAqIHRoZSBKU09OIFwiZXh0ZW5zaW9uc1wiIGFycmF5IGF0dHJpYnV0ZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGlzIGV4dGVuc2lvbi5cbiAqIEBwYXJhbSBpbml0Rm4gVGhlIGZ1bmN0aW9uIHRvIGluaXRpYWxpemUgYW4gZXh0ZW5kZWQgYmxvY2suXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlIGV4dGVuc2lvbiBuYW1lIGlzIGVtcHR5LCB0aGUgZXh0ZW5zaW9uIGlzIGFscmVhZHlcbiAqICAgICByZWdpc3RlcmVkLCBvciBleHRlbnNpb25GbiBpcyBub3QgYSBmdW5jdGlvbi5cbiAqIEBhbGlhcyBCbG9ja2x5LkV4dGVuc2lvbnMucmVnaXN0ZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyKG5hbWU6IHN0cmluZywgaW5pdEZuOiBGdW5jdGlvbikge1xuICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnIHx8IG5hbWUudHJpbSgpID09PSAnJykge1xuICAgIHRocm93IEVycm9yKCdFcnJvcjogSW52YWxpZCBleHRlbnNpb24gbmFtZSBcIicgKyBuYW1lICsgJ1wiJyk7XG4gIH1cbiAgaWYgKGFsbEV4dGVuc2lvbnNbbmFtZV0pIHtcbiAgICB0aHJvdyBFcnJvcignRXJyb3I6IEV4dGVuc2lvbiBcIicgKyBuYW1lICsgJ1wiIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4nKTtcbiAgfVxuICBpZiAodHlwZW9mIGluaXRGbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IEVycm9yKCdFcnJvcjogRXh0ZW5zaW9uIFwiJyArIG5hbWUgKyAnXCIgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gIH1cbiAgYWxsRXh0ZW5zaW9uc1tuYW1lXSA9IGluaXRGbjtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYSBuZXcgZXh0ZW5zaW9uIGZ1bmN0aW9uIHRoYXQgYWRkcyBhbGwga2V5L3ZhbHVlIG9mIG1peGluT2JqLlxuICpcbiAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoaXMgZXh0ZW5zaW9uLlxuICogQHBhcmFtIG1peGluT2JqIFRoZSB2YWx1ZXMgdG8gbWl4IGluLlxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSBleHRlbnNpb24gbmFtZSBpcyBlbXB0eSBvciB0aGUgZXh0ZW5zaW9uIGlzIGFscmVhZHlcbiAqICAgICByZWdpc3RlcmVkLlxuICogQGFsaWFzIEJsb2NrbHkuRXh0ZW5zaW9ucy5yZWdpc3Rlck1peGluXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3Rlck1peGluKG5hbWU6IHN0cmluZywgbWl4aW5PYmo6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICBpZiAoIW1peGluT2JqIHx8IHR5cGVvZiBtaXhpbk9iaiAhPT0gJ29iamVjdCcpIHtcbiAgICB0aHJvdyBFcnJvcignRXJyb3I6IE1peGluIFwiJyArIG5hbWUgKyAnXCIgbXVzdCBiZSBhIG9iamVjdCcpO1xuICB9XG4gIHJlZ2lzdGVyKG5hbWUsIGZ1bmN0aW9uKHRoaXM6IEJsb2NrKSB7XG4gICAgdGhpcy5taXhpbihtaXhpbk9iaik7XG4gIH0pO1xufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIG5ldyBleHRlbnNpb24gZnVuY3Rpb24gdGhhdCBhZGRzIGEgbXV0YXRvciB0byB0aGUgYmxvY2suXG4gKiBBdCByZWdpc3RlciB0aW1lIHRoaXMgcGVyZm9ybXMgc29tZSBiYXNpYyBzYW5pdHkgY2hlY2tzIG9uIHRoZSBtdXRhdG9yLlxuICogVGhlIHdyYXBwZXIgbWF5IGFsc28gYWRkIGEgbXV0YXRvciBkaWFsb2cgdG8gdGhlIGJsb2NrLCBpZiBib3RoIGNvbXBvc2UgYW5kXG4gKiBkZWNvbXBvc2UgYXJlIGRlZmluZWQgb24gdGhlIG1peGluLlxuICpcbiAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoaXMgbXV0YXRvciBleHRlbnNpb24uXG4gKiBAcGFyYW0gbWl4aW5PYmogVGhlIHZhbHVlcyB0byBtaXggaW4uXG4gKiBAcGFyYW0gb3B0X2hlbHBlckZuIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIHRvIGFwcGx5IGFmdGVyIG1peGluZyBpbiB0aGUgb2JqZWN0LlxuICogQHBhcmFtIG9wdF9ibG9ja0xpc3QgQSBsaXN0IG9mIGJsb2NrcyB0byBhcHBlYXIgaW4gdGhlIGZseW91dCBvZiB0aGUgbXV0YXRvclxuICogICAgIGRpYWxvZy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgbXV0YXRpb24gaXMgaW52YWxpZCBvciBjYW4ndCBiZSBhcHBsaWVkIHRvIHRoZSBibG9jay5cbiAqIEBhbGlhcyBCbG9ja2x5LkV4dGVuc2lvbnMucmVnaXN0ZXJNdXRhdG9yXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3Rlck11dGF0b3IoXG4gICAgbmFtZTogc3RyaW5nLCBtaXhpbk9iajogQW55RHVyaW5nTWlncmF0aW9uLFxuICAgIG9wdF9oZWxwZXJGbj86ICgpID0+IEFueUR1cmluZ01pZ3JhdGlvbiwgb3B0X2Jsb2NrTGlzdD86IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGVycm9yUHJlZml4ID0gJ0Vycm9yIHdoZW4gcmVnaXN0ZXJpbmcgbXV0YXRvciBcIicgKyBuYW1lICsgJ1wiOiAnO1xuXG4gIGNoZWNrSGFzTXV0YXRvclByb3BlcnRpZXMoZXJyb3JQcmVmaXgsIG1peGluT2JqKTtcbiAgY29uc3QgaGFzTXV0YXRvckRpYWxvZyA9IGNoZWNrTXV0YXRvckRpYWxvZyhtaXhpbk9iaiwgZXJyb3JQcmVmaXgpO1xuXG4gIGlmIChvcHRfaGVscGVyRm4gJiYgdHlwZW9mIG9wdF9oZWxwZXJGbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IEVycm9yKGVycm9yUHJlZml4ICsgJ0V4dGVuc2lvbiBcIicgKyBuYW1lICsgJ1wiIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gIH1cblxuICAvLyBTYW5pdHkgY2hlY2tzIHBhc3NlZC5cbiAgcmVnaXN0ZXIobmFtZSwgZnVuY3Rpb24odGhpczogQmxvY2spIHtcbiAgICBpZiAoaGFzTXV0YXRvckRpYWxvZykge1xuICAgICAgdGhpcy5zZXRNdXRhdG9yKG5ldyBNdXRhdG9yKG9wdF9ibG9ja0xpc3QgfHwgW10sIHRoaXMgYXMgQmxvY2tTdmcpKTtcbiAgICB9XG4gICAgLy8gTWl4aW4gdGhlIG9iamVjdC5cbiAgICB0aGlzLm1peGluKG1peGluT2JqKTtcblxuICAgIGlmIChvcHRfaGVscGVyRm4pIHtcbiAgICAgIG9wdF9oZWxwZXJGbi5hcHBseSh0aGlzKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFVucmVnaXN0ZXJzIHRoZSBleHRlbnNpb24gcmVnaXN0ZXJlZCB3aXRoIHRoZSBnaXZlbiBuYW1lLlxuICpcbiAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBleHRlbnNpb24gdG8gdW5yZWdpc3Rlci5cbiAqIEBhbGlhcyBCbG9ja2x5LkV4dGVuc2lvbnMudW5yZWdpc3RlclxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5yZWdpc3RlcihuYW1lOiBzdHJpbmcpIHtcbiAgaWYgKGlzUmVnaXN0ZXJlZChuYW1lKSkge1xuICAgIGRlbGV0ZSBhbGxFeHRlbnNpb25zW25hbWVdO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ05vIGV4dGVuc2lvbiBtYXBwaW5nIGZvciBuYW1lIFwiJyArIG5hbWUgKyAnXCIgZm91bmQgdG8gdW5yZWdpc3RlcicpO1xuICB9XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIGFuIGV4dGVuc2lvbiBpcyByZWdpc3RlcmVkIHdpdGggdGhlIGdpdmVuIG5hbWUuXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGV4dGVuc2lvbiB0byBjaGVjayBmb3IuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBleHRlbnNpb24gaXMgcmVnaXN0ZXJlZC4gIEZhbHNlIGlmIGl0IGlzIG5vdCByZWdpc3RlcmVkLlxuICogQGFsaWFzIEJsb2NrbHkuRXh0ZW5zaW9ucy5pc1JlZ2lzdGVyZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUmVnaXN0ZXJlZChuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuICEhYWxsRXh0ZW5zaW9uc1tuYW1lXTtcbn1cblxuLyoqXG4gKiBBcHBsaWVzIGFuIGV4dGVuc2lvbiBtZXRob2QgdG8gYSBibG9jay4gVGhpcyBzaG91bGQgb25seSBiZSBjYWxsZWQgZHVyaW5nXG4gKiBibG9jayBjb25zdHJ1Y3Rpb24uXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGV4dGVuc2lvbi5cbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gYXBwbHkgdGhlIG5hbWVkIGV4dGVuc2lvbiB0by5cbiAqIEBwYXJhbSBpc011dGF0b3IgVHJ1ZSBpZiB0aGlzIGV4dGVuc2lvbiBkZWZpbmVzIGEgbXV0YXRvci5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgZXh0ZW5zaW9uIGlzIG5vdCBmb3VuZC5cbiAqIEBhbGlhcyBCbG9ja2x5LkV4dGVuc2lvbnMuYXBwbHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5KG5hbWU6IHN0cmluZywgYmxvY2s6IEJsb2NrLCBpc011dGF0b3I6IGJvb2xlYW4pIHtcbiAgY29uc3QgZXh0ZW5zaW9uRm4gPSBhbGxFeHRlbnNpb25zW25hbWVdO1xuICBpZiAodHlwZW9mIGV4dGVuc2lvbkZuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgRXJyb3IoJ0Vycm9yOiBFeHRlbnNpb24gXCInICsgbmFtZSArICdcIiBub3QgZm91bmQuJyk7XG4gIH1cbiAgbGV0IG11dGF0b3JQcm9wZXJ0aWVzO1xuICBpZiAoaXNNdXRhdG9yKSB7XG4gICAgLy8gRmFpbCBlYXJseSBpZiB0aGUgYmxvY2sgYWxyZWFkeSBoYXMgbXV0YXRpb24gcHJvcGVydGllcy5cbiAgICBjaGVja05vTXV0YXRvclByb3BlcnRpZXMobmFtZSwgYmxvY2spO1xuICB9IGVsc2Uge1xuICAgIC8vIFJlY29yZCB0aGUgb2xkIHByb3BlcnRpZXMgc28gd2UgY2FuIG1ha2Ugc3VyZSB0aGV5IGRvbid0IGNoYW5nZSBhZnRlclxuICAgIC8vIGFwcGx5aW5nIHRoZSBleHRlbnNpb24uXG4gICAgbXV0YXRvclByb3BlcnRpZXMgPSBnZXRNdXRhdG9yUHJvcGVydGllcyhibG9jayk7XG4gIH1cbiAgZXh0ZW5zaW9uRm4uYXBwbHkoYmxvY2spO1xuXG4gIGlmIChpc011dGF0b3IpIHtcbiAgICBjb25zdCBlcnJvclByZWZpeCA9ICdFcnJvciBhZnRlciBhcHBseWluZyBtdXRhdG9yIFwiJyArIG5hbWUgKyAnXCI6ICc7XG4gICAgY2hlY2tIYXNNdXRhdG9yUHJvcGVydGllcyhlcnJvclByZWZpeCwgYmxvY2spO1xuICB9IGVsc2Uge1xuICAgIGlmICghbXV0YXRvclByb3BlcnRpZXNNYXRjaChcbiAgICAgICAgICAgIG11dGF0b3JQcm9wZXJ0aWVzIGFzIEFueUR1cmluZ01pZ3JhdGlvbltdLCBibG9jaykpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdFcnJvciB3aGVuIGFwcGx5aW5nIGV4dGVuc2lvbiBcIicgKyBuYW1lICsgJ1wiOiAnICtcbiAgICAgICAgICAnbXV0YXRpb24gcHJvcGVydGllcyBjaGFuZ2VkIHdoZW4gYXBwbHlpbmcgYSBub24tbXV0YXRvciBleHRlbnNpb24uJyk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgdGhhdCB0aGUgZ2l2ZW4gYmxvY2sgZG9lcyBub3QgaGF2ZSBhbnkgb2YgdGhlIGZvdXIgbXV0YXRvciBwcm9wZXJ0aWVzXG4gKiBkZWZpbmVkIG9uIGl0LiAgVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBhcHBseWluZyBhIG11dGF0b3JcbiAqIGV4dGVuc2lvbiB0byBhIGJsb2NrLCB0byBtYWtlIHN1cmUgd2UgYXJlIG5vdCBvdmVyd3JpdGluZyBwcm9wZXJ0aWVzLlxuICpcbiAqIEBwYXJhbSBtdXRhdGlvbk5hbWUgVGhlIG5hbWUgb2YgdGhlIG11dGF0aW9uIHRvIHJlZmVyZW5jZSBpbiBlcnJvciBtZXNzYWdlcy5cbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gY2hlY2suXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgYW55IG9mIHRoZSBwcm9wZXJ0aWVzIGFscmVhZHkgZXhpc3Qgb24gdGhlIGJsb2NrLlxuICovXG5mdW5jdGlvbiBjaGVja05vTXV0YXRvclByb3BlcnRpZXMobXV0YXRpb25OYW1lOiBzdHJpbmcsIGJsb2NrOiBCbG9jaykge1xuICBjb25zdCBwcm9wZXJ0aWVzID0gZ2V0TXV0YXRvclByb3BlcnRpZXMoYmxvY2spO1xuICBpZiAocHJvcGVydGllcy5sZW5ndGgpIHtcbiAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgJ0Vycm9yOiB0cmllZCB0byBhcHBseSBtdXRhdGlvbiBcIicgKyBtdXRhdGlvbk5hbWUgK1xuICAgICAgICAnXCIgdG8gYSBibG9jayB0aGF0IGFscmVhZHkgaGFzIG11dGF0b3IgZnVuY3Rpb25zLicgK1xuICAgICAgICAnICBCbG9jayBpZDogJyArIGJsb2NrLmlkKTtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgZ2l2ZW4gb2JqZWN0IGhhcyBib3RoIHRoZSAnbXV0YXRpb25Ub0RvbScgYW5kICdkb21Ub011dGF0aW9uJ1xuICogZnVuY3Rpb25zLlxuICpcbiAqIEBwYXJhbSBvYmplY3QgVGhlIG9iamVjdCB0byBjaGVjay5cbiAqIEBwYXJhbSBlcnJvclByZWZpeCBUaGUgc3RyaW5nIHRvIHByZXBlbmQgdG8gYW55IGVycm9yIG1lc3NhZ2UuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBvYmplY3QgaGFzIGJvdGggZnVuY3Rpb25zLiAgRmFsc2UgaWYgaXQgaGFzIG5laXRoZXJcbiAqICAgICBmdW5jdGlvbi5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgb2JqZWN0IGhhcyBvbmx5IG9uZSBvZiB0aGUgZnVuY3Rpb25zLCBvciBlaXRoZXIgaXMgbm90XG4gKiAgICAgYWN0dWFsbHkgYSBmdW5jdGlvbi5cbiAqL1xuZnVuY3Rpb24gY2hlY2tYbWxIb29rcyhcbiAgICBvYmplY3Q6IEFueUR1cmluZ01pZ3JhdGlvbiwgZXJyb3JQcmVmaXg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gY2hlY2tIYXNGdW5jdGlvblBhaXIoXG4gICAgICBvYmplY3QubXV0YXRpb25Ub0RvbSwgb2JqZWN0LmRvbVRvTXV0YXRpb24sXG4gICAgICBlcnJvclByZWZpeCArICcgbXV0YXRpb25Ub0RvbS9kb21Ub011dGF0aW9uJyk7XG59XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgZ2l2ZW4gb2JqZWN0IGhhcyBib3RoIHRoZSAnc2F2ZUV4dHJhU3RhdGUnIGFuZCAnbG9hZEV4dHJhU3RhdGUnXG4gKiBmdW5jdGlvbnMuXG4gKlxuICogQHBhcmFtIG9iamVjdCBUaGUgb2JqZWN0IHRvIGNoZWNrLlxuICogQHBhcmFtIGVycm9yUHJlZml4IFRoZSBzdHJpbmcgdG8gcHJlcGVuZCB0byBhbnkgZXJyb3IgbWVzc2FnZS5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG9iamVjdCBoYXMgYm90aCBmdW5jdGlvbnMuICBGYWxzZSBpZiBpdCBoYXMgbmVpdGhlclxuICogICAgIGZ1bmN0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSBvYmplY3QgaGFzIG9ubHkgb25lIG9mIHRoZSBmdW5jdGlvbnMsIG9yIGVpdGhlciBpcyBub3RcbiAqICAgICBhY3R1YWxseSBhIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBjaGVja0pzb25Ib29rcyhcbiAgICBvYmplY3Q6IEFueUR1cmluZ01pZ3JhdGlvbiwgZXJyb3JQcmVmaXg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gY2hlY2tIYXNGdW5jdGlvblBhaXIoXG4gICAgICBvYmplY3Quc2F2ZUV4dHJhU3RhdGUsIG9iamVjdC5sb2FkRXh0cmFTdGF0ZSxcbiAgICAgIGVycm9yUHJlZml4ICsgJyBzYXZlRXh0cmFTdGF0ZS9sb2FkRXh0cmFTdGF0ZScpO1xufVxuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgZ2l2ZW4gb2JqZWN0IGhhcyBib3RoIHRoZSAnY29tcG9zZScgYW5kICdkZWNvbXBvc2UnIGZ1bmN0aW9ucy5cbiAqXG4gKiBAcGFyYW0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2hlY2suXG4gKiBAcGFyYW0gZXJyb3JQcmVmaXggVGhlIHN0cmluZyB0byBwcmVwZW5kIHRvIGFueSBlcnJvciBtZXNzYWdlLlxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgb2JqZWN0IGhhcyBib3RoIGZ1bmN0aW9ucy4gIEZhbHNlIGlmIGl0IGhhcyBuZWl0aGVyXG4gKiAgICAgZnVuY3Rpb24uXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlIG9iamVjdCBoYXMgb25seSBvbmUgb2YgdGhlIGZ1bmN0aW9ucywgb3IgZWl0aGVyIGlzIG5vdFxuICogICAgIGFjdHVhbGx5IGEgZnVuY3Rpb24uXG4gKi9cbmZ1bmN0aW9uIGNoZWNrTXV0YXRvckRpYWxvZyhcbiAgICBvYmplY3Q6IEFueUR1cmluZ01pZ3JhdGlvbiwgZXJyb3JQcmVmaXg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gY2hlY2tIYXNGdW5jdGlvblBhaXIoXG4gICAgICBvYmplY3QuY29tcG9zZSwgb2JqZWN0LmRlY29tcG9zZSwgZXJyb3JQcmVmaXggKyAnIGNvbXBvc2UvZGVjb21wb3NlJyk7XG59XG5cbi8qKlxuICogQ2hlY2tzIHRoYXQgYm90aCBvciBuZWl0aGVyIG9mIHRoZSBnaXZlbiBmdW5jdGlvbnMgZXhpc3QgYW5kIHRoYXQgdGhleSBhcmVcbiAqIGluZGVlZCBmdW5jdGlvbnMuXG4gKlxuICogQHBhcmFtIGZ1bmMxIFRoZSBmaXJzdCBmdW5jdGlvbiBpbiB0aGUgcGFpci5cbiAqIEBwYXJhbSBmdW5jMiBUaGUgc2Vjb25kIGZ1bmN0aW9uIGluIHRoZSBwYWlyLlxuICogQHBhcmFtIGVycm9yUHJlZml4IFRoZSBzdHJpbmcgdG8gcHJlcGVuZCB0byBhbnkgZXJyb3IgbWVzc2FnZS5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG9iamVjdCBoYXMgYm90aCBmdW5jdGlvbnMuICBGYWxzZSBpZiBpdCBoYXMgbmVpdGhlclxuICogICAgIGZ1bmN0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBvYmplY3QgaGFzIG9ubHkgb25lIG9mIHRoZSBmdW5jdGlvbnMsIG9yIGVpdGhlciBpcyBub3RcbiAqICAgICBhY3R1YWxseSBhIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBjaGVja0hhc0Z1bmN0aW9uUGFpcihcbiAgICBmdW5jMTogQW55RHVyaW5nTWlncmF0aW9uLCBmdW5jMjogQW55RHVyaW5nTWlncmF0aW9uLFxuICAgIGVycm9yUHJlZml4OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgaWYgKGZ1bmMxICYmIGZ1bmMyKSB7XG4gICAgaWYgKHR5cGVvZiBmdW5jMSAhPT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgZnVuYzIgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IEVycm9yKGVycm9yUHJlZml4ICsgJyBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSBpZiAoIWZ1bmMxICYmICFmdW5jMikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB0aHJvdyBFcnJvcihlcnJvclByZWZpeCArICdNdXN0IGhhdmUgYm90aCBvciBuZWl0aGVyIGZ1bmN0aW9ucycpO1xufVxuXG4vKipcbiAqIENoZWNrcyB0aGF0IHRoZSBnaXZlbiBvYmplY3QgcmVxdWlyZWQgbXV0YXRvciBwcm9wZXJ0aWVzLlxuICpcbiAqIEBwYXJhbSBlcnJvclByZWZpeCBUaGUgc3RyaW5nIHRvIHByZXBlbmQgdG8gYW55IGVycm9yIG1lc3NhZ2UuXG4gKiBAcGFyYW0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAqL1xuZnVuY3Rpb24gY2hlY2tIYXNNdXRhdG9yUHJvcGVydGllcyhcbiAgICBlcnJvclByZWZpeDogc3RyaW5nLCBvYmplY3Q6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICBjb25zdCBoYXNYbWxIb29rcyA9IGNoZWNrWG1sSG9va3Mob2JqZWN0LCBlcnJvclByZWZpeCk7XG4gIGNvbnN0IGhhc0pzb25Ib29rcyA9IGNoZWNrSnNvbkhvb2tzKG9iamVjdCwgZXJyb3JQcmVmaXgpO1xuICBpZiAoIWhhc1htbEhvb2tzICYmICFoYXNKc29uSG9va3MpIHtcbiAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgZXJyb3JQcmVmaXggK1xuICAgICAgICAnTXV0YXRpb25zIG11c3QgY29udGFpbiBlaXRoZXIgWE1MIGhvb2tzLCBvciBKU09OIGhvb2tzLCBvciBib3RoJyk7XG4gIH1cbiAgLy8gQSBibG9jayB3aXRoIGEgbXV0YXRvciBpc24ndCByZXF1aXJlZCB0byBoYXZlIGEgbXV0YXRpb24gZGlhbG9nLCBidXRcbiAgLy8gaXQgc2hvdWxkIHN0aWxsIGhhdmUgYm90aCBvciBuZWl0aGVyIG9mIGNvbXBvc2UgYW5kIGRlY29tcG9zZS5cbiAgY2hlY2tNdXRhdG9yRGlhbG9nKG9iamVjdCwgZXJyb3JQcmVmaXgpO1xufVxuXG4vKipcbiAqIEdldCBhIGxpc3Qgb2YgdmFsdWVzIG9mIG11dGF0b3IgcHJvcGVydGllcyBvbiB0aGUgZ2l2ZW4gYmxvY2suXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBpbnNwZWN0LlxuICogQHJldHVybnMgQSBsaXN0IHdpdGggYWxsIG9mIHRoZSBkZWZpbmVkIHByb3BlcnRpZXMsIHdoaWNoIHNob3VsZCBiZVxuICogICAgIGZ1bmN0aW9ucywgYnV0IG1heSBiZSBhbnl0aGluZyBvdGhlciB0aGFuIHVuZGVmaW5lZC5cbiAqL1xuZnVuY3Rpb24gZ2V0TXV0YXRvclByb3BlcnRpZXMoYmxvY2s6IEJsb2NrKTogQW55RHVyaW5nTWlncmF0aW9uW10ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgLy8gTGlzdCBlYWNoIGZ1bmN0aW9uIGV4cGxpY2l0bHkgYnkgcmVmZXJlbmNlIHRvIGFsbG93IGZvciByZW5hbWluZ1xuICAvLyBkdXJpbmcgY29tcGlsYXRpb24uXG4gIGlmIChibG9jay5kb21Ub011dGF0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXN1bHQucHVzaChibG9jay5kb21Ub011dGF0aW9uKTtcbiAgfVxuICBpZiAoYmxvY2subXV0YXRpb25Ub0RvbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmVzdWx0LnB1c2goYmxvY2subXV0YXRpb25Ub0RvbSk7XG4gIH1cbiAgaWYgKGJsb2NrLnNhdmVFeHRyYVN0YXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXN1bHQucHVzaChibG9jay5zYXZlRXh0cmFTdGF0ZSk7XG4gIH1cbiAgaWYgKGJsb2NrLmxvYWRFeHRyYVN0YXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXN1bHQucHVzaChibG9jay5sb2FkRXh0cmFTdGF0ZSk7XG4gIH1cbiAgaWYgKGJsb2NrLmNvbXBvc2UgIT09IHVuZGVmaW5lZCkge1xuICAgIHJlc3VsdC5wdXNoKGJsb2NrLmNvbXBvc2UpO1xuICB9XG4gIGlmIChibG9jay5kZWNvbXBvc2UgIT09IHVuZGVmaW5lZCkge1xuICAgIHJlc3VsdC5wdXNoKGJsb2NrLmRlY29tcG9zZSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDaGVjayB0aGF0IHRoZSBjdXJyZW50IG11dGF0b3IgcHJvcGVydGllcyBtYXRjaCBhIGxpc3Qgb2Ygb2xkIG11dGF0b3JcbiAqIHByb3BlcnRpZXMuICBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgYXBwbHlpbmcgYSBub24tbXV0YXRvciBleHRlbnNpb24sXG4gKiB0byB2ZXJpZnkgdGhhdCB0aGUgZXh0ZW5zaW9uIGRpZG4ndCBjaGFuZ2UgcHJvcGVydGllcyBpdCBzaG91bGRuJ3QuXG4gKlxuICogQHBhcmFtIG9sZFByb3BlcnRpZXMgVGhlIG9sZCB2YWx1ZXMgdG8gY29tcGFyZSB0by5cbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gaW5zcGVjdCBmb3IgbmV3IHZhbHVlcy5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHByb3BlcnR5IGxpc3RzIG1hdGNoLlxuICovXG5mdW5jdGlvbiBtdXRhdG9yUHJvcGVydGllc01hdGNoKFxuICAgIG9sZFByb3BlcnRpZXM6IEFueUR1cmluZ01pZ3JhdGlvbltdLCBibG9jazogQmxvY2spOiBib29sZWFuIHtcbiAgY29uc3QgbmV3UHJvcGVydGllcyA9IGdldE11dGF0b3JQcm9wZXJ0aWVzKGJsb2NrKTtcbiAgaWYgKG5ld1Byb3BlcnRpZXMubGVuZ3RoICE9PSBvbGRQcm9wZXJ0aWVzLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld1Byb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAob2xkUHJvcGVydGllc1tpXSAhPT0gbmV3UHJvcGVydGllc1tpXSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBDYWxscyBhIGZ1bmN0aW9uIGFmdGVyIHRoZSBwYWdlIGhhcyBsb2FkZWQsIHBvc3NpYmx5IGltbWVkaWF0ZWx5LlxuICpcbiAqIEBwYXJhbSBmbiBGdW5jdGlvbiB0byBydW4uXG4gKiBAdGhyb3dzIEVycm9yIFdpbGwgdGhyb3cgaWYgbm8gZ2xvYmFsIGRvY3VtZW50IGNhbiBiZSBmb3VuZCAoZS5nLiwgTm9kZS5qcykuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJ1bkFmdGVyUGFnZUxvYWQoZm46ICgpID0+IHZvaWQpIHtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ29iamVjdCcpIHtcbiAgICB0aHJvdyBFcnJvcigncnVuQWZ0ZXJQYWdlTG9hZCgpIHJlcXVpcmVzIGJyb3dzZXIgZG9jdW1lbnQuJyk7XG4gIH1cbiAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICBmbigpOyAgLy8gUGFnZSBoYXMgYWxyZWFkeSBsb2FkZWQuIENhbGwgaW1tZWRpYXRlbHkuXG4gIH0gZWxzZSB7XG4gICAgLy8gUG9sbCByZWFkeVN0YXRlLlxuICAgIGNvbnN0IHJlYWR5U3RhdGVDaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xuICAgICAgICBjbGVhckludGVydmFsKHJlYWR5U3RhdGVDaGVja0ludGVydmFsKTtcbiAgICAgICAgZm4oKTtcbiAgICAgIH1cbiAgICB9LCAxMCk7XG4gIH1cbn1cblxuLyoqXG4gKiBCdWlsZHMgYW4gZXh0ZW5zaW9uIGZ1bmN0aW9uIHRoYXQgd2lsbCBtYXAgYSBkcm9wZG93biB2YWx1ZSB0byBhIHRvb2x0aXBcbiAqIHN0cmluZy5cbiAqXG4gKiBUaGlzIG1ldGhvZCBpbmNsdWRlcyBtdWx0aXBsZSBjaGVja3MgdG8gZW5zdXJlIHRvb2x0aXBzLCBkcm9wZG93biBvcHRpb25zLFxuICogYW5kIG1lc3NhZ2UgcmVmZXJlbmNlcyBhcmUgYWxpZ25lZC4gVGhpcyBhaW1zIHRvIGNhdGNoIGVycm9ycyBhcyBlYXJseSBhc1xuICogcG9zc2libGUsIHdpdGhvdXQgcmVxdWlyaW5nIGRldmVsb3BlcnMgdG8gbWFudWFsbHkgdGVzdCB0b29sdGlwcyB1bmRlciBlYWNoXG4gKiBvcHRpb24uIEFmdGVyIHRoZSBwYWdlIGlzIGxvYWRlZCwgZWFjaCB0b29sdGlwIHRleHQgc3RyaW5nIHdpbGwgYmUgY2hlY2tlZFxuICogZm9yIG1hdGNoaW5nIG1lc3NhZ2Uga2V5cyBpbiB0aGUgaW50ZXJuYXRpb25hbGl6ZWQgc3RyaW5nIHRhYmxlLiBEZWZlcnJpbmdcbiAqIHRoaXMgdW50aWwgdGhlIHBhZ2UgaXMgbG9hZGVkIGRlY291cGxlcyBsb2FkaW5nIGRlcGVuZGVuY2llcy4gTGF0ZXIsIHVwb25cbiAqIGxvYWRpbmcgdGhlIGZpcnN0IGJsb2NrIG9mIGFueSBnaXZlbiB0eXBlLCB0aGUgZXh0ZW5zaW9uIHdpbGwgdmFsaWRhdGUgZXZlcnlcbiAqIGRyb3Bkb3duIG9wdGlvbiBoYXMgYSBtYXRjaGluZyB0b29sdGlwIGluIHRoZSBsb29rdXBUYWJsZS4gIEVycm9ycyBhcmVcbiAqIHJlcG9ydGVkIGFzIHdhcm5pbmdzIGluIHRoZSBjb25zb2xlLCBhbmQgYXJlIG5ldmVyIGZhdGFsLlxuICpcbiAqIEBwYXJhbSBkcm9wZG93bk5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpZWxkIHdob3NlIHZhbHVlIGlzIHRoZSBrZXkgdG8gdGhlXG4gKiAgICAgbG9va3VwIHRhYmxlLlxuICogQHBhcmFtIGxvb2t1cFRhYmxlIFRoZSB0YWJsZSBvZiBmaWVsZCB2YWx1ZXMgdG8gdG9vbHRpcCB0ZXh0LlxuICogQHJldHVybnMgVGhlIGV4dGVuc2lvbiBmdW5jdGlvbi5cbiAqIEBhbGlhcyBCbG9ja2x5LkV4dGVuc2lvbnMuYnVpbGRUb29sdGlwRm9yRHJvcGRvd25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkVG9vbHRpcEZvckRyb3Bkb3duKFxuICAgIGRyb3Bkb3duTmFtZTogc3RyaW5nLCBsb29rdXBUYWJsZToge1trZXk6IHN0cmluZ106IHN0cmluZ30pOiBGdW5jdGlvbiB7XG4gIC8vIExpc3Qgb2YgYmxvY2sgdHlwZXMgYWxyZWFkeSB2YWxpZGF0ZWQsIHRvIG1pbmltaXplIGR1cGxpY2F0ZSB3YXJuaW5ncy5cbiAgY29uc3QgYmxvY2tUeXBlc0NoZWNrZWQ6IEFueUR1cmluZ01pZ3JhdGlvbltdID0gW107XG5cbiAgLy8gQ2hlY2sgdGhlIHRvb2x0aXAgc3RyaW5nIG1lc3NhZ2VzIGZvciBpbnZhbGlkIHJlZmVyZW5jZXMuXG4gIC8vIFdhaXQgZm9yIGxvYWQsIGluIGNhc2UgQmxvY2tseS5Nc2cgaXMgbm90IHlldCBwb3B1bGF0ZWQuXG4gIC8vIHJ1bkFmdGVyUGFnZUxvYWQoKSBkb2VzIG5vdCBydW4gaW4gYSBOb2RlLmpzIGVudmlyb25tZW50IGR1ZSB0byBsYWNrXG4gIC8vIG9mIGRvY3VtZW50IG9iamVjdCwgaW4gd2hpY2ggY2FzZSBza2lwIHRoZSB2YWxpZGF0aW9uLlxuICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAnb2JqZWN0JykgeyAgLy8gUmVsaWVzIG9uIGRvY3VtZW50LnJlYWR5U3RhdGVcbiAgICBydW5BZnRlclBhZ2VMb2FkKGZ1bmN0aW9uKCkge1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gbG9va3VwVGFibGUpIHtcbiAgICAgICAgLy8gV2lsbCBwcmludCB3YXJuaW5ncyBpZiByZWZlcmVuY2UgaXMgbWlzc2luZy5cbiAgICAgICAgcGFyc2luZy5jaGVja01lc3NhZ2VSZWZlcmVuY2VzKGxvb2t1cFRhYmxlW2tleV0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqIFRoZSBhY3R1YWwgZXh0ZW5zaW9uLiAqL1xuICBmdW5jdGlvbiBleHRlbnNpb25Gbih0aGlzOiBCbG9jaykge1xuICAgIGlmICh0aGlzLnR5cGUgJiYgYmxvY2tUeXBlc0NoZWNrZWQuaW5kZXhPZih0aGlzLnR5cGUpID09PSAtMSkge1xuICAgICAgY2hlY2tEcm9wZG93bk9wdGlvbnNJblRhYmxlKHRoaXMsIGRyb3Bkb3duTmFtZSwgbG9va3VwVGFibGUpO1xuICAgICAgYmxvY2tUeXBlc0NoZWNrZWQucHVzaCh0aGlzLnR5cGUpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0VG9vbHRpcChmdW5jdGlvbih0aGlzOiBCbG9jaykge1xuICAgICAgY29uc3QgdmFsdWUgPSBTdHJpbmcodGhpcy5nZXRGaWVsZFZhbHVlKGRyb3Bkb3duTmFtZSkpO1xuICAgICAgbGV0IHRvb2x0aXAgPSBsb29rdXBUYWJsZVt2YWx1ZV07XG4gICAgICBpZiAodG9vbHRpcCA9PT0gbnVsbCkge1xuICAgICAgICBpZiAoYmxvY2tUeXBlc0NoZWNrZWQuaW5kZXhPZih0aGlzLnR5cGUpID09PSAtMSkge1xuICAgICAgICAgIC8vIFdhcm4gZm9yIG1pc3NpbmcgdmFsdWVzIG9uIGdlbmVyYXRlZCB0b29sdGlwcy5cbiAgICAgICAgICBsZXQgd2FybmluZyA9ICdObyB0b29sdGlwIG1hcHBpbmcgZm9yIHZhbHVlICcgKyB2YWx1ZSArICcgb2YgZmllbGQgJyArXG4gICAgICAgICAgICAgIGRyb3Bkb3duTmFtZTtcbiAgICAgICAgICBpZiAodGhpcy50eXBlICE9PSBudWxsKSB7XG4gICAgICAgICAgICB3YXJuaW5nICs9ICcgb2YgYmxvY2sgdHlwZSAnICsgdGhpcy50eXBlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLndhcm4od2FybmluZyArICcuJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvb2x0aXAgPSBwYXJzaW5nLnJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcyh0b29sdGlwKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b29sdGlwO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gIH1cbiAgcmV0dXJuIGV4dGVuc2lvbkZuO1xufVxuXG4vKipcbiAqIENoZWNrcyBhbGwgb3B0aW9ucyBrZXlzIGFyZSBwcmVzZW50IGluIHRoZSBwcm92aWRlZCBzdHJpbmcgbG9va3VwIHRhYmxlLlxuICogRW1pdHMgY29uc29sZSB3YXJuaW5ncyB3aGVuIHRoZXkgYXJlIG5vdC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIGNvbnRhaW5pbmcgdGhlIGRyb3Bkb3duXG4gKiBAcGFyYW0gZHJvcGRvd25OYW1lIFRoZSBuYW1lIG9mIHRoZSBkcm9wZG93blxuICogQHBhcmFtIGxvb2t1cFRhYmxlIFRoZSBzdHJpbmcgbG9va3VwIHRhYmxlXG4gKi9cbmZ1bmN0aW9uIGNoZWNrRHJvcGRvd25PcHRpb25zSW5UYWJsZShcbiAgICBibG9jazogQmxvY2ssIGRyb3Bkb3duTmFtZTogc3RyaW5nLCBsb29rdXBUYWJsZToge1trZXk6IHN0cmluZ106IHN0cmluZ30pIHtcbiAgLy8gVmFsaWRhdGUgYWxsIGRyb3Bkb3duIG9wdGlvbnMgaGF2ZSB2YWx1ZXMuXG4gIGNvbnN0IGRyb3Bkb3duID0gYmxvY2suZ2V0RmllbGQoZHJvcGRvd25OYW1lKTtcbiAgaWYgKGRyb3Bkb3duIGluc3RhbmNlb2YgRmllbGREcm9wZG93biAmJiAhZHJvcGRvd24uaXNPcHRpb25MaXN0RHluYW1pYygpKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IGRyb3Bkb3duLmdldE9wdGlvbnMoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG9wdGlvbktleSA9IG9wdGlvbnNbaV1bMV07ICAvLyBsYWJlbCwgdGhlbiB2YWx1ZVxuICAgICAgaWYgKGxvb2t1cFRhYmxlW29wdGlvbktleV0gPT09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgJ05vIHRvb2x0aXAgbWFwcGluZyBmb3IgdmFsdWUgJyArIG9wdGlvbktleSArICcgb2YgZmllbGQgJyArXG4gICAgICAgICAgICBkcm9wZG93bk5hbWUgKyAnIG9mIGJsb2NrIHR5cGUgJyArIGJsb2NrLnR5cGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEJ1aWxkcyBhbiBleHRlbnNpb24gZnVuY3Rpb24gdGhhdCB3aWxsIGluc3RhbGwgYSBkeW5hbWljIHRvb2x0aXAuIFRoZVxuICogdG9vbHRpcCBtZXNzYWdlIHNob3VsZCBpbmNsdWRlIHRoZSBzdHJpbmcgJyUxJyBhbmQgdGhhdCBzdHJpbmcgd2lsbCBiZVxuICogcmVwbGFjZWQgd2l0aCB0aGUgdGV4dCBvZiB0aGUgbmFtZWQgZmllbGQuXG4gKlxuICogQHBhcmFtIG1zZ1RlbXBsYXRlIFRoZSB0ZW1wbGF0ZSBmb3JtIHRvIG9mIHRoZSBtZXNzYWdlIHRleHQsIHdpdGggJTFcbiAqICAgICBwbGFjZWhvbGRlci5cbiAqIEBwYXJhbSBmaWVsZE5hbWUgVGhlIGZpZWxkIHdpdGggdGhlIHJlcGxhY2VtZW50IHRleHQuXG4gKiBAcmV0dXJucyBUaGUgZXh0ZW5zaW9uIGZ1bmN0aW9uLlxuICogQGFsaWFzIEJsb2NrbHkuRXh0ZW5zaW9ucy5idWlsZFRvb2x0aXBXaXRoRmllbGRUZXh0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWlsZFRvb2x0aXBXaXRoRmllbGRUZXh0KFxuICAgIG1zZ1RlbXBsYXRlOiBzdHJpbmcsIGZpZWxkTmFtZTogc3RyaW5nKTogRnVuY3Rpb24ge1xuICAvLyBDaGVjayB0aGUgdG9vbHRpcCBzdHJpbmcgbWVzc2FnZXMgZm9yIGludmFsaWQgcmVmZXJlbmNlcy5cbiAgLy8gV2FpdCBmb3IgbG9hZCwgaW4gY2FzZSBCbG9ja2x5Lk1zZyBpcyBub3QgeWV0IHBvcHVsYXRlZC5cbiAgLy8gcnVuQWZ0ZXJQYWdlTG9hZCgpIGRvZXMgbm90IHJ1biBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQgZHVlIHRvIGxhY2tcbiAgLy8gb2YgZG9jdW1lbnQgb2JqZWN0LCBpbiB3aGljaCBjYXNlIHNraXAgdGhlIHZhbGlkYXRpb24uXG4gIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICdvYmplY3QnKSB7ICAvLyBSZWxpZXMgb24gZG9jdW1lbnQucmVhZHlTdGF0ZVxuICAgIHJ1bkFmdGVyUGFnZUxvYWQoZnVuY3Rpb24oKSB7XG4gICAgICAvLyBXaWxsIHByaW50IHdhcm5pbmdzIGlmIHJlZmVyZW5jZSBpcyBtaXNzaW5nLlxuICAgICAgcGFyc2luZy5jaGVja01lc3NhZ2VSZWZlcmVuY2VzKG1zZ1RlbXBsYXRlKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBUaGUgYWN0dWFsIGV4dGVuc2lvbi4gKi9cbiAgZnVuY3Rpb24gZXh0ZW5zaW9uRm4odGhpczogQmxvY2spIHtcbiAgICB0aGlzLnNldFRvb2x0aXAoZnVuY3Rpb24odGhpczogQmxvY2spIHtcbiAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5nZXRGaWVsZChmaWVsZE5hbWUpO1xuICAgICAgcmV0dXJuIHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKG1zZ1RlbXBsYXRlKVxuICAgICAgICAgIC5yZXBsYWNlKCclMScsIGZpZWxkID8gZmllbGQuZ2V0VGV4dCgpIDogJycpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gIH1cbiAgcmV0dXJuIGV4dGVuc2lvbkZuO1xufVxuXG4vKipcbiAqIENvbmZpZ3VyZXMgdGhlIHRvb2x0aXAgdG8gbWltaWMgdGhlIHBhcmVudCBibG9jayB3aGVuIGNvbm5lY3RlZC4gT3RoZXJ3aXNlLFxuICogdXNlcyB0aGUgdG9vbHRpcCB0ZXh0IGF0IHRoZSB0aW1lIHRoaXMgZXh0ZW5zaW9uIGlzIGluaXRpYWxpemVkLiBUaGlzIHRha2VzXG4gKiBhZHZhbnRhZ2Ugb2YgdGhlIGZhY3QgdGhhdCBhbGwgb3RoZXIgdmFsdWVzIGZyb20gSlNPTiBhcmUgaW5pdGlhbGl6ZWQgYmVmb3JlXG4gKiBleHRlbnNpb25zLlxuICovXG5mdW5jdGlvbiBleHRlbnNpb25QYXJlbnRUb29sdGlwKHRoaXM6IEJsb2NrKSB7XG4gIGNvbnN0IHRvb2x0aXBXaGVuTm90Q29ubmVjdGVkID0gdGhpcy50b29sdGlwO1xuICB0aGlzLnNldFRvb2x0aXAoZnVuY3Rpb24odGhpczogQmxvY2spIHtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmdldFBhcmVudCgpO1xuICAgIHJldHVybiBwYXJlbnQgJiYgcGFyZW50LmdldElucHV0c0lubGluZSgpICYmIHBhcmVudC50b29sdGlwIHx8XG4gICAgICAgIHRvb2x0aXBXaGVuTm90Q29ubmVjdGVkO1xuICB9LmJpbmQodGhpcykpO1xufVxucmVnaXN0ZXIoJ3BhcmVudF90b29sdGlwX3doZW5faW5saW5lJywgZXh0ZW5zaW9uUGFyZW50VG9vbHRpcCk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMuYXJyYXkgKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMuYXJyYXknKTtcblxuXG4vKipcbiAqIFJlbW92ZXMgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYSBwYXJ0aWN1bGFyIHZhbHVlIGZyb20gYW4gYXJyYXkuXG4gKlxuICogQHBhcmFtIGFyciBBcnJheSBmcm9tIHdoaWNoIHRvIHJlbW92ZSB2YWx1ZS5cbiAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSB0byByZW1vdmUuXG4gKiBAcmV0dXJucyBUcnVlIGlmIGFuIGVsZW1lbnQgd2FzIHJlbW92ZWQuXG4gKiBAYWxpYXMgQmxvY2tseS5hcnJheS5yZW1vdmVFbGVtXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUVsZW08VD4oYXJyOiBBcnJheTxUPiwgdmFsdWU6IFQpOiBib29sZWFuIHtcbiAgY29uc3QgaSA9IGFyci5pbmRleE9mKHZhbHVlKTtcbiAgaWYgKGkgPT09IC0xKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGFyci5zcGxpY2UoaSwgMSk7XG4gIHJldHVybiB0cnVlO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1ldGhvZHMgZm9yIGNyZWF0aW5nIHBhcnRzIG9mIFNWRyBwYXRoIHN0cmluZ3MuICBTZWVcbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHMuc3ZnUGF0aHNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5zdmdQYXRocycpO1xuXG5cbi8qKlxuICogQ3JlYXRlIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgZ2l2ZW4geCwgeSBwYWlyLiAgSXQgZG9lcyBub3QgbWF0dGVyIHdoZXRoZXJcbiAqIHRoZSBjb29yZGluYXRlIGlzIHJlbGF0aXZlIG9yIGFic29sdXRlLiAgVGhlIHJlc3VsdCBoYXMgbGVhZGluZ1xuICogYW5kIHRyYWlsaW5nIHNwYWNlcywgYW5kIHNlcGFyYXRlcyB0aGUgeCBhbmQgeSBjb29yZGluYXRlcyB3aXRoIGEgY29tbWEgYnV0XG4gKiBubyBzcGFjZS5cbiAqXG4gKiBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlLlxuICogQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZS5cbiAqIEByZXR1cm5zIEEgc3RyaW5nIG9mIHRoZSBmb3JtYXQgJyB4LHkgJ1xuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuc3ZnUGF0aHMucG9pbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBvaW50KHg6IG51bWJlciwgeTogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuICcgJyArIHggKyAnLCcgKyB5ICsgJyAnO1xufVxuXG4vKipcbiAqIERyYXcgYSBjdWJpYyBvciBxdWFkcmF0aWMgY3VydmUuICBTZWVcbiAqIGRldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9TVkcvQXR0cmlidXRlL2QjQ3ViaWNfQiVDMyVBOXppZXJfQ3VydmVcbiAqIFRoZXNlIGNvb3JkaW5hdGVzIGFyZSB1bml0bGVzcyBhbmQgaGVuY2UgaW4gdGhlIHVzZXIgY29vcmRpbmF0ZSBzeXN0ZW0uXG4gKlxuICogQHBhcmFtIGNvbW1hbmQgVGhlIGNvbW1hbmQgdG8gdXNlLlxuICogICAgIFNob3VsZCBiZSBvbmUgb2Y6IGMsIEMsIHMsIFMsIHEsIFEuXG4gKiBAcGFyYW0gcG9pbnRzICBBbiBhcnJheSBjb250YWluaW5nIGFsbCBvZiB0aGUgcG9pbnRzIHRvIHBhc3MgdG8gdGhlIGN1cnZlXG4gKiAgICAgY29tbWFuZCwgaW4gb3JkZXIuICBUaGUgcG9pbnRzIGFyZSByZXByZXNlbnRlZCBhcyBzdHJpbmdzIG9mIHRoZSBmb3JtYXQgJ1xuICogICAgIHgsIHkgJy5cbiAqIEByZXR1cm5zIEEgc3RyaW5nIGRlZmluaW5nIG9uZSBvciBtb3JlIEJlemllciBjdXJ2ZXMuICBTZWUgdGhlIE1ETlxuICogICAgIGRvY3VtZW50YXRpb24gZm9yIGV4YWN0IGZvcm1hdC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN2Z1BhdGhzLmN1cnZlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjdXJ2ZShjb21tYW5kOiBzdHJpbmcsIHBvaW50czogc3RyaW5nW10pOiBzdHJpbmcge1xuICByZXR1cm4gJyAnICsgY29tbWFuZCArIHBvaW50cy5qb2luKCcnKTtcbn1cblxuLyoqXG4gKiBNb3ZlIHRoZSBjdXJzb3IgdG8gdGhlIGdpdmVuIHBvc2l0aW9uIHdpdGhvdXQgZHJhd2luZyBhIGxpbmUuXG4gKiBUaGUgY29vcmRpbmF0ZXMgYXJlIGFic29sdXRlLlxuICogVGhlc2UgY29vcmRpbmF0ZXMgYXJlIHVuaXRsZXNzIGFuZCBoZW5jZSBpbiB0aGUgdXNlciBjb29yZGluYXRlIHN5c3RlbS5cbiAqIFNlZSBkZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvU1ZHL1R1dG9yaWFsL1BhdGhzI0xpbmVfY29tbWFuZHNcbiAqXG4gKiBAcGFyYW0geCBUaGUgYWJzb2x1dGUgeCBjb29yZGluYXRlLlxuICogQHBhcmFtIHkgVGhlIGFic29sdXRlIHkgY29vcmRpbmF0ZS5cbiAqIEByZXR1cm5zIEEgc3RyaW5nIG9mIHRoZSBmb3JtYXQgJyBNIHgseSAnXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdQYXRocy5tb3ZlVG9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1vdmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiAnIE0gJyArIHggKyAnLCcgKyB5ICsgJyAnO1xufVxuXG4vKipcbiAqIE1vdmUgdGhlIGN1cnNvciB0byB0aGUgZ2l2ZW4gcG9zaXRpb24gd2l0aG91dCBkcmF3aW5nIGEgbGluZS5cbiAqIENvb3JkaW5hdGVzIGFyZSByZWxhdGl2ZS5cbiAqIFRoZXNlIGNvb3JkaW5hdGVzIGFyZSB1bml0bGVzcyBhbmQgaGVuY2UgaW4gdGhlIHVzZXIgY29vcmRpbmF0ZSBzeXN0ZW0uXG4gKiBTZWUgZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL1NWRy9UdXRvcmlhbC9QYXRocyNMaW5lX2NvbW1hbmRzXG4gKlxuICogQHBhcmFtIGR4IFRoZSByZWxhdGl2ZSB4IGNvb3JkaW5hdGUuXG4gKiBAcGFyYW0gZHkgVGhlIHJlbGF0aXZlIHkgY29vcmRpbmF0ZS5cbiAqIEByZXR1cm5zIEEgc3RyaW5nIG9mIHRoZSBmb3JtYXQgJyBtIGR4LGR5ICdcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN2Z1BhdGhzLm1vdmVCeVxuICovXG5leHBvcnQgZnVuY3Rpb24gbW92ZUJ5KGR4OiBudW1iZXIsIGR5OiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gJyBtICcgKyBkeCArICcsJyArIGR5ICsgJyAnO1xufVxuXG4vKipcbiAqIERyYXcgYSBsaW5lIGZyb20gdGhlIGN1cnJlbnQgcG9pbnQgdG8gdGhlIGVuZCBwb2ludCwgd2hpY2ggaXMgdGhlIGN1cnJlbnRcbiAqIHBvaW50IHNoaWZ0ZWQgYnkgZHggYWxvbmcgdGhlIHgtYXhpcyBhbmQgZHkgYWxvbmcgdGhlIHktYXhpcy5cbiAqIFRoZXNlIGNvb3JkaW5hdGVzIGFyZSB1bml0bGVzcyBhbmQgaGVuY2UgaW4gdGhlIHVzZXIgY29vcmRpbmF0ZSBzeXN0ZW0uXG4gKiBTZWUgZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL1NWRy9UdXRvcmlhbC9QYXRocyNMaW5lX2NvbW1hbmRzXG4gKlxuICogQHBhcmFtIGR4IFRoZSByZWxhdGl2ZSB4IGNvb3JkaW5hdGUuXG4gKiBAcGFyYW0gZHkgVGhlIHJlbGF0aXZlIHkgY29vcmRpbmF0ZS5cbiAqIEByZXR1cm5zIEEgc3RyaW5nIG9mIHRoZSBmb3JtYXQgJyBsIGR4LGR5ICdcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnN2Z1BhdGhzLmxpbmVUb1xuICovXG5leHBvcnQgZnVuY3Rpb24gbGluZVRvKGR4OiBudW1iZXIsIGR5OiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gJyBsICcgKyBkeCArICcsJyArIGR5ICsgJyAnO1xufVxuXG4vKipcbiAqIERyYXcgbXVsdGlwbGUgbGluZXMgY29ubmVjdGluZyBhbGwgb2YgdGhlIGdpdmVuIHBvaW50cyBpbiBvcmRlci4gIFRoaXMgaXNcbiAqIGVxdWl2YWxlbnQgdG8gYSBzZXJpZXMgb2YgJ2wnIGNvbW1hbmRzLlxuICogVGhlc2UgY29vcmRpbmF0ZXMgYXJlIHVuaXRsZXNzIGFuZCBoZW5jZSBpbiB0aGUgdXNlciBjb29yZGluYXRlIHN5c3RlbS5cbiAqIFNlZSBkZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvU1ZHL1R1dG9yaWFsL1BhdGhzI0xpbmVfY29tbWFuZHNcbiAqXG4gKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIG9mIHRoZSBwb2ludHMgdG8gZHJhdyBsaW5lcyB0bywgaW5cbiAqICAgICBvcmRlci4gIFRoZSBwb2ludHMgYXJlIHJlcHJlc2VudGVkIGFzIHN0cmluZ3Mgb2YgdGhlIGZvcm1hdCAnIGR4LGR5ICcuXG4gKiBAcmV0dXJucyBBIHN0cmluZyBvZiB0aGUgZm9ybWF0ICcgbCAoZHgsZHkpKyAnXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdQYXRocy5saW5lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsaW5lKHBvaW50czogc3RyaW5nW10pOiBzdHJpbmcge1xuICByZXR1cm4gJyBsJyArIHBvaW50cy5qb2luKCcnKTtcbn1cblxuLyoqXG4gKiBEcmF3IGEgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbCBsaW5lLlxuICogVGhlIGZpcnN0IGFyZ3VtZW50IHNwZWNpZmllcyB0aGUgZGlyZWN0aW9uIGFuZCB3aGV0aGVyIHRoZSBnaXZlbiBwb3NpdGlvbiBpc1xuICogcmVsYXRpdmUgb3IgYWJzb2x1dGUuXG4gKiBUaGVzZSBjb29yZGluYXRlcyBhcmUgdW5pdGxlc3MgYW5kIGhlbmNlIGluIHRoZSB1c2VyIGNvb3JkaW5hdGUgc3lzdGVtLlxuICogU2VlIGRldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9TVkcvQXR0cmlidXRlL2QjTGluZVRvX3BhdGhfY29tbWFuZHNcbiAqXG4gKiBAcGFyYW0gY29tbWFuZCBUaGUgY29tbWFuZCB0byBwcmVwZW5kIHRvIHRoZSBjb29yZGluYXRlLiAgVGhpcyBzaG91bGQgYmUgb25lXG4gKiAgICAgb2Y6IFYsIHYsIEgsIGguXG4gKiBAcGFyYW0gdmFsIFRoZSBjb29yZGluYXRlIHRvIHBhc3MgdG8gdGhlIGNvbW1hbmQuICBJdCBtYXkgYmUgYWJzb2x1dGUgb3JcbiAqICAgICByZWxhdGl2ZS5cbiAqIEByZXR1cm5zIEEgc3RyaW5nIG9mIHRoZSBmb3JtYXQgJyBjb21tYW5kIHZhbCAnXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdQYXRocy5saW5lT25BeGlzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsaW5lT25BeGlzKGNvbW1hbmQ6IHN0cmluZywgdmFsOiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gJyAnICsgY29tbWFuZCArICcgJyArIHZhbCArICcgJztcbn1cblxuLyoqXG4gKiBEcmF3IGFuIGVsbGlwdGljYWwgYXJjIGN1cnZlLlxuICogVGhlc2UgY29vcmRpbmF0ZXMgYXJlIHVuaXRsZXNzIGFuZCBoZW5jZSBpbiB0aGUgdXNlciBjb29yZGluYXRlIHN5c3RlbS5cbiAqIFNlZSBkZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvU1ZHL0F0dHJpYnV0ZS9kI0VsbGlwdGljYWxfQXJjX0N1cnZlXG4gKlxuICogQHBhcmFtIGNvbW1hbmQgVGhlIGNvbW1hbmQgc3RyaW5nLiAgRWl0aGVyICdhJyBvciAnQScuXG4gKiBAcGFyYW0gZmxhZ3MgVGhlIGZsYWcgc3RyaW5nLiAgU2VlIHRoZSBNRE4gZG9jdW1lbnRhdGlvbiBmb3IgYSBkZXNjcmlwdGlvblxuICogICAgIGFuZCBleGFtcGxlcy5cbiAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgYXJjIHRvIGRyYXcuXG4gKiBAcGFyYW0gcG9pbnQgVGhlIHBvaW50IHRvIG1vdmUgdGhlIGN1cnNvciB0byBhZnRlciBkcmF3aW5nIHRoZSBhcmMsIHNwZWNpZmllZFxuICogICAgIGVpdGhlciBpbiBhYnNvbHV0ZSBvciByZWxhdGl2ZSBjb29yZGluYXRlcyBkZXBlbmRpbmcgb24gdGhlIGNvbW1hbmQuXG4gKiBAcmV0dXJucyBBIHN0cmluZyBvZiB0aGUgZm9ybWF0ICdjb21tYW5kIHJhZGl1cyByYWRpdXMgZmxhZ3MgcG9pbnQnXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5zdmdQYXRocy5hcmNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFyYyhcbiAgICBjb21tYW5kOiBzdHJpbmcsIGZsYWdzOiBzdHJpbmcsIHJhZGl1czogbnVtYmVyLCBwb2ludDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGNvbW1hbmQgKyAnICcgKyByYWRpdXMgKyAnICcgKyByYWRpdXMgKyAnICcgKyBmbGFncyArIHBvaW50O1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudXRpbHNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscycpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQgKiBhcyBleHRlbnNpb25zIGZyb20gJy4vZXh0ZW5zaW9ucy5qcyc7XG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQgKiBhcyBhcnJheVV0aWxzIGZyb20gJy4vdXRpbHMvYXJyYXkuanMnO1xuaW1wb3J0ICogYXMgY29sb3VyIGZyb20gJy4vdXRpbHMvY29sb3VyLmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCAqIGFzIGlkR2VuZXJhdG9yIGZyb20gJy4vdXRpbHMvaWRnZW5lcmF0b3IuanMnO1xuaW1wb3J0IHtLZXlDb2Rlc30gZnJvbSAnLi91dGlscy9rZXljb2Rlcy5qcyc7XG5pbXBvcnQgKiBhcyBtYXRoIGZyb20gJy4vdXRpbHMvbWF0aC5qcyc7XG5pbXBvcnQgdHlwZSB7TWV0cmljc30gZnJvbSAnLi91dGlscy9tZXRyaWNzLmpzJztcbmltcG9ydCAqIGFzIG9iamVjdCBmcm9tICcuL3V0aWxzL29iamVjdC5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4vdXRpbHMvcGFyc2luZy5qcyc7XG5pbXBvcnQge1JlY3R9IGZyb20gJy4vdXRpbHMvcmVjdC5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vdXRpbHMvc2l6ZS5qcyc7XG5pbXBvcnQgKiBhcyBzdHJpbmdVdGlscyBmcm9tICcuL3V0aWxzL3N0cmluZy5qcyc7XG5pbXBvcnQgKiBhcyBzdHlsZSBmcm9tICcuL3V0aWxzL3N0eWxlLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuaW1wb3J0ICogYXMgc3ZnUGF0aHMgZnJvbSAnLi91dGlscy9zdmdfcGF0aHMuanMnO1xuaW1wb3J0ICogYXMgdG9vbGJveCBmcm9tICcuL3V0aWxzL3Rvb2xib3guanMnO1xuaW1wb3J0ICogYXMgdXNlckFnZW50IGZyb20gJy4vdXRpbHMvdXNlcmFnZW50LmpzJztcbmltcG9ydCAqIGFzIHhtbCBmcm9tICcuL3V0aWxzL3htbC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5cbmV4cG9ydCB7XG4gIGFyaWEsXG4gIGFycmF5VXRpbHMgYXMgYXJyYXksXG4gIGJyb3dzZXJFdmVudHMsXG4gIGNvbG91cixcbiAgQ29vcmRpbmF0ZSxcbiAgZGVwcmVjYXRpb24sXG4gIGRvbSxcbiAgZXh0ZW5zaW9ucyxcbiAgaWRHZW5lcmF0b3IsXG4gIEtleUNvZGVzLFxuICBtYXRoLFxuICBNZXRyaWNzLFxuICBvYmplY3QsXG4gIHBhcnNpbmcsXG4gIFJlY3QsXG4gIFNpemUsXG4gIHN0cmluZ1V0aWxzIGFzIHN0cmluZyxcbiAgc3R5bGUsXG4gIFN2ZyxcbiAgc3ZnTWF0aCxcbiAgc3ZnUGF0aHMsXG4gIHRvb2xib3gsXG4gIHVzZXJBZ2VudCxcbiAgeG1sLFxufTtcblxuLyoqXG4gKiBSZXR1cm4gdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhpcyBlbGVtZW50IHJlbGF0aXZlIHRvXG4gKiBpdHMgcGFyZW50LiAgT25seSBmb3IgU1ZHIGVsZW1lbnRzIGFuZCBjaGlsZHJlbiAoZS5nLiByZWN0LCBnLCBwYXRoKS5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBTVkcgZWxlbWVudCB0byBmaW5kIHRoZSBjb29yZGluYXRlcyBvZi5cbiAqIEByZXR1cm5zIE9iamVjdCB3aXRoIC54IGFuZCAueSBwcm9wZXJ0aWVzLlxuICogQGRlcHJlY2F0ZWQgVXNlICoqQmxvY2tseS51dGlscy5zdmdNYXRoLmdldFJlbGF0aXZlWFkqKiBpbnN0ZWFkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZ2V0UmVsYXRpdmVYWVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVsYXRpdmVYWShlbGVtZW50OiBFbGVtZW50KTogQ29vcmRpbmF0ZSB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS51dGlscy5nZXRSZWxhdGl2ZVhZJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAnQmxvY2tseS51dGlscy5zdmdNYXRoLmdldFJlbGF0aXZlWFknKTtcbiAgcmV0dXJuIHN2Z01hdGguZ2V0UmVsYXRpdmVYWShlbGVtZW50KTtcbn1cblxuLyoqXG4gKiBSZXR1cm4gdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhpcyBlbGVtZW50IHJlbGF0aXZlIHRvXG4gKiB0aGUgZGl2IEJsb2NrbHkgd2FzIGluamVjdGVkIGludG8uXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgU1ZHIGVsZW1lbnQgdG8gZmluZCB0aGUgY29vcmRpbmF0ZXMgb2YuIElmIHRoaXMgaXMgbm90IGEgY2hpbGRcbiAqICAgICBvZiB0aGUgZGl2IEJsb2NrbHkgd2FzIGluamVjdGVkIGludG8sIHRoZSBiZWhhdmlvdXIgaXMgdW5kZWZpbmVkLlxuICogQHJldHVybnMgT2JqZWN0IHdpdGggLnggYW5kIC55IHByb3BlcnRpZXMuXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LnV0aWxzLnN2Z01hdGguZ2V0SW5qZWN0aW9uRGl2WFkqKiBpbnN0ZWFkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZ2V0SW5qZWN0aW9uRGl2WFlfXG4gKi9cbmZ1bmN0aW9uIGdldEluamVjdGlvbkRpdlhZKGVsZW1lbnQ6IEVsZW1lbnQpOiBDb29yZGluYXRlIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLmdldEluamVjdGlvbkRpdlhZXycsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuc3ZnTWF0aC5nZXRJbmplY3Rpb25EaXZYWScpO1xuICByZXR1cm4gc3ZnTWF0aC5nZXRJbmplY3Rpb25EaXZYWShlbGVtZW50KTtcbn1cbmV4cG9ydCBjb25zdCBnZXRJbmplY3Rpb25EaXZYWV8gPSBnZXRJbmplY3Rpb25EaXZYWTtcblxuLyoqXG4gKiBQYXJzZSBhIHN0cmluZyB3aXRoIGFueSBudW1iZXIgb2YgaW50ZXJwb2xhdGlvbiB0b2tlbnMgKCUxLCAlMiwgLi4uKS5cbiAqIEl0IHdpbGwgYWxzbyByZXBsYWNlIHN0cmluZyB0YWJsZSByZWZlcmVuY2VzIChlLmcuLCAle2JreV9teV9tc2d9IGFuZFxuICogJXtCS1lfTVlfTVNHfSB3aWxsIGJvdGggYmUgcmVwbGFjZWQgd2l0aCB0aGUgdmFsdWUgaW5cbiAqIE1zZ1snTVlfTVNHJ10pLiBQZXJjZW50YWdlIHNpZ24gY2hhcmFjdGVycyAnJScgbWF5IGJlIHNlbGYtZXNjYXBlZFxuICogKGUuZy4sICclJScpLlxuICpcbiAqIEBwYXJhbSBtZXNzYWdlIFRleHQgd2hpY2ggbWlnaHQgY29udGFpbiBzdHJpbmcgdGFibGUgcmVmZXJlbmNlcyBhbmRcbiAqICAgICBpbnRlcnBvbGF0aW9uIHRva2Vucy5cbiAqIEByZXR1cm5zIEFycmF5IG9mIHN0cmluZ3MgYW5kIG51bWJlcnMuXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LnV0aWxzLnBhcnNpbmcudG9rZW5pemVJbnRlcnBvbGF0aW9uKiogaW5zdGVhZC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnRva2VuaXplSW50ZXJwb2xhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9rZW5pemVJbnRlcnBvbGF0aW9uKG1lc3NhZ2U6IHN0cmluZyk6IEFycmF5PHN0cmluZ3xudW1iZXI+IHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLnRva2VuaXplSW50ZXJwb2xhdGlvbicsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkudXRpbHMucGFyc2luZy50b2tlbml6ZUludGVycG9sYXRpb24nKTtcbiAgcmV0dXJuIHBhcnNpbmcudG9rZW5pemVJbnRlcnBvbGF0aW9uKG1lc3NhZ2UpO1xufVxuXG4vKipcbiAqIFJlcGxhY2VzIHN0cmluZyB0YWJsZSByZWZlcmVuY2VzIGluIGEgbWVzc2FnZSwgaWYgdGhlIG1lc3NhZ2UgaXMgYSBzdHJpbmcuXG4gKiBGb3IgZXhhbXBsZSwgXCIle2JreV9teV9tc2d9XCIgYW5kIFwiJXtCS1lfTVlfTVNHfVwiIHdpbGwgYm90aCBiZSByZXBsYWNlZCB3aXRoXG4gKiB0aGUgdmFsdWUgaW4gTXNnWydNWV9NU0cnXS5cbiAqXG4gKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlLCB3aGljaCBtYXkgYmUgYSBzdHJpbmcgdGhhdCBjb250YWlucyBzdHJpbmcgdGFibGVcbiAqICAgICByZWZlcmVuY2VzLlxuICogQHJldHVybnMgU3RyaW5nIHdpdGggbWVzc2FnZSByZWZlcmVuY2VzIHJlcGxhY2VkLlxuICogQGRlcHJlY2F0ZWQgVXNlICoqQmxvY2tseS51dGlscy5wYXJzaW5nLnJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcyoqIGluc3RlYWQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcyhtZXNzYWdlOiBzdHJpbmd8YW55KTogc3RyaW5nIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLnJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcycsICdEZWNlbWJlciAyMDIxJyxcbiAgICAgICdEZWNlbWJlciAyMDIyJywgJ0Jsb2NrbHkudXRpbHMucGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMnKTtcbiAgcmV0dXJuIHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKG1lc3NhZ2UpO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlcyB0aGF0IGFueSAle01TR19LRVl9IHJlZmVyZW5jZXMgaW4gdGhlIG1lc3NhZ2UgcmVmZXIgdG8ga2V5cyBvZlxuICogdGhlIE1zZyBzdHJpbmcgdGFibGUuXG4gKlxuICogQHBhcmFtIG1lc3NhZ2UgVGV4dCB3aGljaCBtaWdodCBjb250YWluIHN0cmluZyB0YWJsZSByZWZlcmVuY2VzLlxuICogQHJldHVybnMgVHJ1ZSBpZiBhbGwgbWVzc2FnZSByZWZlcmVuY2VzIGhhdmUgbWF0Y2hpbmcgdmFsdWVzLlxuICogICAgIE90aGVyd2lzZSwgZmFsc2UuXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LnV0aWxzLnBhcnNpbmcuY2hlY2tNZXNzYWdlUmVmZXJlbmNlcyoqIGluc3RlYWQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5jaGVja01lc3NhZ2VSZWZlcmVuY2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjaGVja01lc3NhZ2VSZWZlcmVuY2VzKG1lc3NhZ2U6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuY2hlY2tNZXNzYWdlUmVmZXJlbmNlcycsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkudXRpbHMucGFyc2luZy5jaGVja01lc3NhZ2VSZWZlcmVuY2VzJyk7XG4gIHJldHVybiBwYXJzaW5nLmNoZWNrTWVzc2FnZVJlZmVyZW5jZXMobWVzc2FnZSk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgM0QgdHJhbnNmb3JtcyBhcmUgc3VwcG9ydGVkIGJ5IGFkZGluZyBhbiBlbGVtZW50XG4gKiBhbmQgYXR0ZW1wdGluZyB0byBzZXQgdGhlIHByb3BlcnR5LlxuICpcbiAqIEByZXR1cm5zIFRydWUgaWYgM0QgdHJhbnNmb3JtcyBhcmUgc3VwcG9ydGVkLlxuICogQGRlcHJlY2F0ZWQgVXNlICoqQmxvY2tseS51dGlscy5zdmdNYXRoLmlzM2RTdXBwb3J0ZWQqKiBpbnN0ZWFkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuaXMzZFN1cHBvcnRlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXMzZFN1cHBvcnRlZCgpOiBib29sZWFuIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLmlzM2RTdXBwb3J0ZWQnLCAnRGVjZW1iZXIgMjAyMScsICdEZWNlbWJlciAyMDIyJyxcbiAgICAgICdCbG9ja2x5LnV0aWxzLnN2Z01hdGguaXMzZFN1cHBvcnRlZCcpO1xuICByZXR1cm4gc3ZnTWF0aC5pczNkU3VwcG9ydGVkKCk7XG59XG5cbi8qKlxuICogR2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgY3VycmVudCB2aWV3cG9ydCBpbiB3aW5kb3cgY29vcmRpbmF0ZXMuICBUaGlzIHRha2VzXG4gKiBzY3JvbGwgaW50byBhY2NvdW50LlxuICpcbiAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIHdpbmRvdyB3aWR0aCwgaGVpZ2h0LCBhbmQgc2Nyb2xsIHBvc2l0aW9uIGluXG4gKiAgICAgd2luZG93IGNvb3JkaW5hdGVzLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZ2V0Vmlld3BvcnRCQm94XG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LnV0aWxzLnN2Z01hdGguZ2V0Vmlld3BvcnRCQm94KiogaW5zdGVhZC5cbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Vmlld3BvcnRCQm94KCk6IFJlY3Qge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuZ2V0Vmlld3BvcnRCQm94JywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAnQmxvY2tseS51dGlscy5zdmdNYXRoLmdldFZpZXdwb3J0QkJveCcpO1xuICByZXR1cm4gc3ZnTWF0aC5nZXRWaWV3cG9ydEJCb3goKTtcbn1cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGEgcGFydGljdWxhciB2YWx1ZSBmcm9tIGFuIGFycmF5LlxuICpcbiAqIEBwYXJhbSBhcnIgQXJyYXkgZnJvbSB3aGljaCB0byByZW1vdmUgdmFsdWUuXG4gKiBAcGFyYW0gdmFsdWUgVmFsdWUgdG8gcmVtb3ZlLlxuICogQHJldHVybnMgVHJ1ZSBpZiBhbiBlbGVtZW50IHdhcyByZW1vdmVkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuYXJyYXlSZW1vdmVcbiAqIEBkZXByZWNhdGVkIFVzZSAqKkJsb2NrbHkuYXJyYXkucmVtb3ZlRWxlbSoqIGluc3RlYWQuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFycmF5UmVtb3ZlPFQ+KGFycjogQXJyYXk8VD4sIHZhbHVlOiBUKTogYm9vbGVhbiB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS51dGlscy5hcnJheVJlbW92ZScsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkuYXJyYXkucmVtb3ZlRWxlbScpO1xuICByZXR1cm4gYXJyYXlVdGlscy5yZW1vdmVFbGVtKGFyciwgdmFsdWUpO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIGRvY3VtZW50IHNjcm9sbCBkaXN0YW5jZSBhcyBhIGNvb3JkaW5hdGUgb2JqZWN0LlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuZG9tLmdldERvY3VtZW50U2Nyb2xsLlxuICpcbiAqIEByZXR1cm5zIE9iamVjdCB3aXRoIHZhbHVlcyAneCcgYW5kICd5Jy5cbiAqIEBkZXByZWNhdGVkIFVzZSAqKkJsb2NrbHkudXRpbHMuc3ZnTWF0aC5nZXREb2N1bWVudFNjcm9sbCoqIGluc3RlYWQuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5nZXREb2N1bWVudFNjcm9sbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9jdW1lbnRTY3JvbGwoKTogQ29vcmRpbmF0ZSB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS51dGlscy5nZXREb2N1bWVudFNjcm9sbCcsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuc3ZnTWF0aC5nZXREb2N1bWVudFNjcm9sbCcpO1xuICByZXR1cm4gc3ZnTWF0aC5nZXREb2N1bWVudFNjcm9sbCgpO1xufVxuXG4vKipcbiAqIEdldCBhIG1hcCBvZiBhbGwgdGhlIGJsb2NrJ3MgZGVzY2VuZGFudHMgbWFwcGluZyB0aGVpciB0eXBlIHRvIHRoZSBudW1iZXIgb2ZcbiAqICAgIGNoaWxkcmVuIHdpdGggdGhhdCB0eXBlLlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gbWFwLlxuICogQHBhcmFtIG9wdF9zdHJpcEZvbGxvd2luZyBPcHRpb25hbGx5IGlnbm9yZSBhbGwgZm9sbG93aW5nIHN0YXRlbWVudHMgKGJsb2Nrc1xuICogICAgIHRoYXQgYXJlIG5vdCBpbnNpZGUgYSB2YWx1ZSBvciBzdGF0ZW1lbnQgaW5wdXQgb2YgdGhlIGJsb2NrKS5cbiAqIEByZXR1cm5zIE1hcCBvZiB0eXBlcyB0byB0eXBlIGNvdW50cyBmb3IgZGVzY2VuZGFudHMgb2YgdGhlIGJvY2suXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LmNvbW1vbi5nZXRCbG9ja1R5cGVDb3VudHMqKiBpbnN0ZWFkLlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuZ2V0QmxvY2tUeXBlQ291bnRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRCbG9ja1R5cGVDb3VudHMoXG4gICAgYmxvY2s6IEJsb2NrLCBvcHRfc3RyaXBGb2xsb3dpbmc/OiBib29sZWFuKToge1trZXk6IHN0cmluZ106IG51bWJlcn0ge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuZ2V0QmxvY2tUeXBlQ291bnRzJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAnQmxvY2tseS5jb21tb24uZ2V0QmxvY2tUeXBlQ291bnRzJyk7XG4gIHJldHVybiBjb21tb24uZ2V0QmxvY2tUeXBlQ291bnRzKGJsb2NrLCBvcHRfc3RyaXBGb2xsb3dpbmcpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIHNjcmVlbiBjb29yZGluYXRlcyB0byB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gKlxuICogQHBhcmFtIHdzIFRoZSB3b3Jrc3BhY2UgdG8gZmluZCB0aGUgY29vcmRpbmF0ZXMgb24uXG4gKiBAcGFyYW0gc2NyZWVuQ29vcmRpbmF0ZXMgVGhlIHNjcmVlbiBjb29yZGluYXRlcyB0byBiZSBjb252ZXJ0ZWQgdG8gd29ya3NwYWNlXG4gKiAgICAgY29vcmRpbmF0ZXNcbiAqIEBkZXByZWNhdGVkIFVzZSAqKkJsb2NrbHkudXRpbHMuc3ZnTWF0aC5zY3JlZW5Ub1dzQ29vcmRpbmF0ZXMqKiBpbnN0ZWFkLlxuICogQHJldHVybnMgVGhlIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNjcmVlblRvV3NDb29yZGluYXRlcyhcbiAgICB3czogV29ya3NwYWNlU3ZnLCBzY3JlZW5Db29yZGluYXRlczogQ29vcmRpbmF0ZSk6IENvb3JkaW5hdGUge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkudXRpbHMuc2NyZWVuVG9Xc0Nvb3JkaW5hdGVzJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAnQmxvY2tseS51dGlscy5zdmdNYXRoLnNjcmVlblRvV3NDb29yZGluYXRlcycpO1xuICByZXR1cm4gc3ZnTWF0aC5zY3JlZW5Ub1dzQ29vcmRpbmF0ZXMod3MsIHNjcmVlbkNvb3JkaW5hdGVzKTtcbn1cblxuLyoqXG4gKiBQYXJzZSBhIGJsb2NrIGNvbG91ciBmcm9tIGEgbnVtYmVyIG9yIHN0cmluZywgYXMgcHJvdmlkZWQgaW4gYSBibG9ja1xuICogZGVmaW5pdGlvbi5cbiAqXG4gKiBAcGFyYW0gY29sb3VyIEhTViBodWUgdmFsdWUgKDAgdG8gMzYwKSwgI1JSR0dCQiBzdHJpbmcsIG9yIGEgbWVzc2FnZVxuICogICAgIHJlZmVyZW5jZSBzdHJpbmcgcG9pbnRpbmcgdG8gb25lIG9mIHRob3NlIHR3byB2YWx1ZXMuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgY29sb3VyIGFzIGEgI1JSR0dCQiBzdHJpbmcsIGFuZCB0aGUgaHVlIGlmXG4gKiAgICAgdGhlIGlucHV0IHdhcyBhbiBIU1YgaHVlIHZhbHVlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb2xvdXIgY2Fubm90IGJlIHBhcnNlZC5cbiAqIEBkZXByZWNhdGVkIFVzZSAqKkJsb2NrbHkudXRpbHMucGFyc2luZy5wYXJzZUJsb2NrQ29sb3VyKiogaW5zdGVhZC5cbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnBhcnNlQmxvY2tDb2xvdXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQmxvY2tDb2xvdXIoY29sb3VyOiBudW1iZXJ8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcpOiB7aHVlOiBudW1iZXJ8bnVsbCwgaGV4OiBzdHJpbmd9IHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnV0aWxzLnBhcnNlQmxvY2tDb2xvdXInLCAnRGVjZW1iZXIgMjAyMScsICdEZWNlbWJlciAyMDIyJyxcbiAgICAgICdCbG9ja2x5LnV0aWxzLnBhcnNpbmcucGFyc2VCbG9ja0NvbG91cicpO1xuICByZXR1cm4gcGFyc2luZy5wYXJzZUJsb2NrQ29sb3VyKGNvbG91cik7XG59XG5cbi8qKlxuICogQ2FsbHMgYSBmdW5jdGlvbiBhZnRlciB0aGUgcGFnZSBoYXMgbG9hZGVkLCBwb3NzaWJseSBpbW1lZGlhdGVseS5cbiAqXG4gKiBAcGFyYW0gZm4gRnVuY3Rpb24gdG8gcnVuLlxuICogQHRocm93cyBFcnJvciBXaWxsIHRocm93IGlmIG5vIGdsb2JhbCBkb2N1bWVudCBjYW4gYmUgZm91bmQgKGUuZy4sIE5vZGUuanMpLlxuICogQGRlcHJlY2F0ZWQgTm8gbG9uZ2VyIHByb3ZpZGVkIGJ5IEJsb2NrbHkuXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5ydW5BZnRlclBhZ2VMb2FkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBydW5BZnRlclBhZ2VMb2FkKGZuOiAoKSA9PiB2b2lkKSB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS51dGlscy5ydW5BZnRlclBhZ2VMb2FkJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicpO1xuICBleHRlbnNpb25zLnJ1bkFmdGVyUGFnZUxvYWQoZm4pO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENvbnRhaW5zIGZ1bmN0aW9ucyByZWdpc3RlcmluZyBzZXJpYWxpemVycyAoZWcgYmxvY2tzLCB2YXJpYWJsZXMsIHBsdWdpbnMsXG4gKiBldGMpLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5zZXJpYWxpemF0aW9uLnJlZ2lzdHJ5XG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuc2VyaWFsaXphdGlvbi5yZWdpc3RyeScpO1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbmltcG9ydCB0eXBlIHtJU2VyaWFsaXplcn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3NlcmlhbGl6ZXIuanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuXG5cbi8qKlxuICogUmVnaXN0ZXJzIHRoZSBnaXZlbiBzZXJpYWxpemVyIHNvIHRoYXQgaXQgY2FuIGJlIHVzZWQgZm9yIHNlcmlhbGl6YXRpb24gYW5kXG4gKiBkZXNlcmlhbGl6YXRpb24uXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIHNlcmlhbGl6ZXIgdG8gcmVnaXN0ZXIuXG4gKiBAcGFyYW0gc2VyaWFsaXplciBUaGUgc2VyaWFsaXplciB0byByZWdpc3Rlci5cbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24ucmVnaXN0cnkucmVnaXN0ZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyKG5hbWU6IHN0cmluZywgc2VyaWFsaXplcjogSVNlcmlhbGl6ZXIpIHtcbiAgcmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5TRVJJQUxJWkVSLCBuYW1lLCBzZXJpYWxpemVyKTtcbn1cblxuLyoqXG4gKiBVbnJlZ2lzdGVycyB0aGUgc2VyaWFsaXplciBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIG5hbWUuXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIHNlcmlhbGl6ZXIgdG8gdW5yZWdpc3Rlci5cbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24ucmVnaXN0cnkudW5yZWdpc3RlclxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5yZWdpc3RlcihuYW1lOiBzdHJpbmcpIHtcbiAgcmVnaXN0cnkudW5yZWdpc3RlcihyZWdpc3RyeS5UeXBlLlNFUklBTElaRVIsIG5hbWUpO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEhhbmRsZXMgc2VyaWFsaXppbmcgYmxvY2tzIHRvIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0cyBvbmx5IGNvbnRhaW5pbmcgc3RhdGUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnNlcmlhbGl6YXRpb24uYmxvY2tzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuc2VyaWFsaXphdGlvbi5ibG9ja3MnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuLi9ibG9jay5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7Q29ubmVjdGlvbn0gZnJvbSAnLi4vY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4uL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge2lucHV0VHlwZXN9IGZyb20gJy4uL2lucHV0X3R5cGVzLmpzJztcbmltcG9ydCB0eXBlIHtJU2VyaWFsaXplcn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3NlcmlhbGl6ZXIuanMnO1xuaW1wb3J0IHtTaXplfSBmcm9tICcuLi91dGlscy9zaXplLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5pbXBvcnQgKiBhcyBYbWwgZnJvbSAnLi4veG1sLmpzJztcblxuaW1wb3J0IHtCYWRDb25uZWN0aW9uQ2hlY2ssIE1pc3NpbmdCbG9ja1R5cGUsIE1pc3NpbmdDb25uZWN0aW9uLCBSZWFsQ2hpbGRPZlNoYWRvd30gZnJvbSAnLi9leGNlcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIHByaW9yaXRpZXMgZnJvbSAnLi9wcmlvcml0aWVzLmpzJztcbmltcG9ydCAqIGFzIHNlcmlhbGl6YXRpb25SZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcblxuXG4vLyBUT0RPKCM1MTYwKTogUmVtb3ZlIHRoaXMgb25jZSBsaW50IGlzIGZpeGVkLlxuLyogZXNsaW50LWRpc2FibGUgbm8tdXNlLWJlZm9yZS1kZWZpbmUgKi9cblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBzdGF0ZSBvZiBhIGNvbm5lY3Rpb24uXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi5ibG9ja3MuQ29ubmVjdGlvblN0YXRlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29ubmVjdGlvblN0YXRlIHtcbiAgc2hhZG93OiBTdGF0ZXx1bmRlZmluZWQ7XG4gIGJsb2NrOiBTdGF0ZXx1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgc3RhdGUgb2YgYSBnaXZlbiBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5zZXJpYWxpemF0aW9uLmJsb2Nrcy5TdGF0ZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlIHtcbiAgdHlwZTogc3RyaW5nO1xuICBpZD86IHN0cmluZztcbiAgeD86IG51bWJlcjtcbiAgeT86IG51bWJlcjtcbiAgY29sbGFwc2VkPzogYm9vbGVhbjtcbiAgZW5hYmxlZD86IGJvb2xlYW47XG4gIGlubGluZT86IGJvb2xlYW47XG4gIGRhdGE/OiBzdHJpbmc7XG4gIGV4dHJhU3RhdGU/OiBBbnlEdXJpbmdNaWdyYXRpb247XG4gIGljb25zPzoge1trZXk6IHN0cmluZ106IEFueUR1cmluZ01pZ3JhdGlvbn07XG4gIGZpZWxkcz86IHtba2V5OiBzdHJpbmddOiBBbnlEdXJpbmdNaWdyYXRpb259O1xuICBpbnB1dHM/OiB7W2tleTogc3RyaW5nXTogQ29ubmVjdGlvblN0YXRlfTtcbiAgbmV4dD86IENvbm5lY3Rpb25TdGF0ZTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzdGF0ZSBvZiB0aGUgZ2l2ZW4gYmxvY2sgYXMgYSBwbGFpbiBKYXZhU2NyaXB0IG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSBwYXJhbTEgYWRkQ29vcmRpbmF0ZXM6IElmIHRydWUsIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgYmxvY2sgYXJlIGFkZGVkXG4gKiAgICAgdG8gdGhlIHNlcmlhbGl6ZWQgc3RhdGUuIEZhbHNlIGJ5IGRlZmF1bHQuIGFkZGlucHV0QmxvY2tzOiBJZiB0cnVlLFxuICogICAgIGNoaWxkcmVuIG9mIHRoZSBibG9jayB3aGljaCBhcmUgY29ubmVjdGVkIHRvIGlucHV0cyB3aWxsIGJlIHNlcmlhbGl6ZWQuXG4gKiAgICAgVHJ1ZSBieSBkZWZhdWx0LiBhZGROZXh0QmxvY2tzOiBJZiB0cnVlLCBjaGlsZHJlbiBvZiB0aGUgYmxvY2sgd2hpY2ggYXJlXG4gKiAgICAgY29ubmVjdGVkIHRvIHRoZSBibG9jaydzIG5leHQgY29ubmVjdGlvbiAoaWYgaXQgZXhpc3RzKSB3aWxsIGJlXG4gKiAgICAgc2VyaWFsaXplZC4gVHJ1ZSBieSBkZWZhdWx0LiBkb0Z1bGxTZXJpYWxpemF0aW9uOiBJZiB0cnVlLCBmaWVsZHMgdGhhdFxuICogICAgIG5vcm1hbGx5IGp1c3Qgc2F2ZSBhIHJlZmVyZW5jZSB0byBzb21lIGV4dGVybmFsIHN0YXRlIChlZyB2YXJpYWJsZXMpIHdpbGxcbiAqICAgICBpbnN0ZWFkIHNlcmlhbGl6ZSBhbGwgb2YgdGhlIGluZm8gYWJvdXQgdGhhdCBzdGF0ZS4gVGhpcyBzdXBwb3J0c1xuICogICAgIGRlc2VyaWFsaXppbmcgdGhlIGJsb2NrIGludG8gYSB3b3Jrc3BhY2Ugd2hlcmUgdGhhdCBzdGF0ZSBkb2Vzbid0IHlldFxuICogICAgIGV4aXN0LiBUcnVlIGJ5IGRlZmF1bHQuXG4gKiBAcmV0dXJucyBUaGUgc2VyaWFsaXplZCBzdGF0ZSBvZiB0aGUgYmxvY2ssIG9yIG51bGwgaWYgdGhlIGJsb2NrIGNvdWxkIG5vdCBiZVxuICogICAgIHNlcmlhbGllZCAoZWcgaXQgd2FzIGFuIGluc2VydGlvbiBtYXJrZXIpLlxuICogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi5ibG9ja3Muc2F2ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2F2ZShibG9jazogQmxvY2ssIHtcbiAgYWRkQ29vcmRpbmF0ZXMgPSBmYWxzZSxcbiAgYWRkSW5wdXRCbG9ja3MgPSB0cnVlLFxuICBhZGROZXh0QmxvY2tzID0gdHJ1ZSxcbiAgZG9GdWxsU2VyaWFsaXphdGlvbiA9IHRydWUsXG59OiB7XG4gIGFkZENvb3JkaW5hdGVzPzogYm9vbGVhbixcbiAgYWRkSW5wdXRCbG9ja3M/OiBib29sZWFuLFxuICBhZGROZXh0QmxvY2tzPzogYm9vbGVhbixcbiAgZG9GdWxsU2VyaWFsaXphdGlvbj86IGJvb2xlYW5cbn0gPSB7fSk6IFN0YXRlfG51bGwge1xuICBpZiAoYmxvY2suaXNJbnNlcnRpb25NYXJrZXIoKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3Qgc3RhdGUgPSB7XG4gICAgJ3R5cGUnOiBibG9jay50eXBlLFxuICAgICdpZCc6IGJsb2NrLmlkLFxuICB9O1xuXG4gIGlmIChhZGRDb29yZGluYXRlcykge1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAneyB0eXBlOiBzdHJpbmc7IGlkOlxuICAgIC8vIHN0cmluZzsgfScgaXMgbm90IGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ1N0YXRlJy5cbiAgICBzYXZlQ29vcmRzKGJsb2NrLCBzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICB9XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAneyB0eXBlOiBzdHJpbmc7IGlkOiBzdHJpbmc7XG4gIC8vIH0nIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdTdGF0ZScuXG4gIHNhdmVBdHRyaWJ1dGVzKGJsb2NrLCBzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ3sgdHlwZTogc3RyaW5nOyBpZDogc3RyaW5nO1xuICAvLyB9JyBpcyBub3QgYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnU3RhdGUnLlxuICBzYXZlRXh0cmFTdGF0ZShibG9jaywgc3RhdGUgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICd7IHR5cGU6IHN0cmluZzsgaWQ6IHN0cmluZztcbiAgLy8gfScgaXMgbm90IGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ1N0YXRlJy5cbiAgc2F2ZUljb25zKGJsb2NrLCBzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ3sgdHlwZTogc3RyaW5nOyBpZDogc3RyaW5nO1xuICAvLyB9JyBpcyBub3QgYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnU3RhdGUnLlxuICBzYXZlRmllbGRzKGJsb2NrLCBzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24sIGRvRnVsbFNlcmlhbGl6YXRpb24pO1xuICBpZiAoYWRkSW5wdXRCbG9ja3MpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ3sgdHlwZTogc3RyaW5nOyBpZDpcbiAgICAvLyBzdHJpbmc7IH0nIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdTdGF0ZScuXG4gICAgc2F2ZUlucHV0QmxvY2tzKGJsb2NrLCBzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24sIGRvRnVsbFNlcmlhbGl6YXRpb24pO1xuICB9XG4gIGlmIChhZGROZXh0QmxvY2tzKSB7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICd7IHR5cGU6IHN0cmluZzsgaWQ6XG4gICAgLy8gc3RyaW5nOyB9JyBpcyBub3QgYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnU3RhdGUnLlxuICAgIHNhdmVOZXh0QmxvY2tzKGJsb2NrLCBzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24sIGRvRnVsbFNlcmlhbGl6YXRpb24pO1xuICB9XG5cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICd7IHR5cGU6IHN0cmluZzsgaWQ6IHN0cmluZzsgfScgaXMgbm90XG4gIC8vIGFzc2lnbmFibGUgdG8gdHlwZSAnU3RhdGUnLlxuICByZXR1cm4gc3RhdGUgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xufVxuXG4vKipcbiAqIEFkZHMgYXR0cmlidXRlcyB0byB0aGUgZ2l2ZW4gc3RhdGUgb2JqZWN0IGJhc2VkIG9uIHRoZSBzdGF0ZSBvZiB0aGUgYmxvY2suXG4gKiBFZyBjb2xsYXBzZWQsIGRpc2FibGVkLCBpbmxpbmUsIGV0Yy5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGJhc2UgdGhlIGF0dHJpYnV0ZXMgb24uXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9iamVjdCB0byBhcHBlbmQgdG8uXG4gKi9cbmZ1bmN0aW9uIHNhdmVBdHRyaWJ1dGVzKGJsb2NrOiBCbG9jaywgc3RhdGU6IFN0YXRlKSB7XG4gIGlmIChibG9jay5pc0NvbGxhcHNlZCgpKSB7XG4gICAgc3RhdGVbJ2NvbGxhcHNlZCddID0gdHJ1ZTtcbiAgfVxuICBpZiAoIWJsb2NrLmlzRW5hYmxlZCgpKSB7XG4gICAgc3RhdGVbJ2VuYWJsZWQnXSA9IGZhbHNlO1xuICB9XG4gIGlmIChibG9jay5pbnB1dHNJbmxpbmUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgYmxvY2suaW5wdXRzSW5saW5lICE9PSBibG9jay5pbnB1dHNJbmxpbmVEZWZhdWx0KSB7XG4gICAgc3RhdGVbJ2lubGluZSddID0gYmxvY2suaW5wdXRzSW5saW5lO1xuICB9XG4gIC8vIERhdGEgaXMgYSBudWxsYWJsZSBzdHJpbmcsIHNvIHdlIGRvbid0IG5lZWQgdG8gd29ycnkgYWJvdXQgZmFsc3kgdmFsdWVzLlxuICBpZiAoYmxvY2suZGF0YSkge1xuICAgIHN0YXRlWydkYXRhJ10gPSBibG9jay5kYXRhO1xuICB9XG59XG5cbi8qKlxuICogQWRkcyB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIGdpdmVuIGJsb2NrIHRvIHRoZSBnaXZlbiBzdGF0ZSBvYmplY3QuXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBiYXNlIHRoZSBjb29yZGluYXRlcyBvbi5cbiAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IHRvIGFwcGVuZCB0by5cbiAqL1xuZnVuY3Rpb24gc2F2ZUNvb3JkcyhibG9jazogQmxvY2ssIHN0YXRlOiBTdGF0ZSkge1xuICBjb25zdCB3b3Jrc3BhY2UgPSBibG9jay53b3Jrc3BhY2U7XG4gIGNvbnN0IHh5ID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICBzdGF0ZVsneCddID0gTWF0aC5yb3VuZCh3b3Jrc3BhY2UuUlRMID8gd29ya3NwYWNlLmdldFdpZHRoKCkgLSB4eS54IDogeHkueCk7XG4gIHN0YXRlWyd5J10gPSBNYXRoLnJvdW5kKHh5LnkpO1xufVxuLyoqXG4gKiBBZGRzIGFueSBleHRyYSBzdGF0ZSB0aGUgYmxvY2sgbWF5IHByb3ZpZGUgdG8gdGhlIGdpdmVuIHN0YXRlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNlcmlhbGl6ZSB0aGUgZXh0cmEgc3RhdGUgb2YuXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9iamVjdCB0byBhcHBlbmQgdG8uXG4gKi9cbmZ1bmN0aW9uIHNhdmVFeHRyYVN0YXRlKGJsb2NrOiBCbG9jaywgc3RhdGU6IFN0YXRlKSB7XG4gIGlmIChibG9jay5zYXZlRXh0cmFTdGF0ZSkge1xuICAgIGNvbnN0IGV4dHJhU3RhdGUgPSBibG9jay5zYXZlRXh0cmFTdGF0ZSgpO1xuICAgIGlmIChleHRyYVN0YXRlICE9PSBudWxsKSB7XG4gICAgICBzdGF0ZVsnZXh0cmFTdGF0ZSddID0gZXh0cmFTdGF0ZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoYmxvY2subXV0YXRpb25Ub0RvbSkge1xuICAgIGNvbnN0IGV4dHJhU3RhdGUgPSBibG9jay5tdXRhdGlvblRvRG9tKCk7XG4gICAgaWYgKGV4dHJhU3RhdGUgIT09IG51bGwpIHtcbiAgICAgIHN0YXRlWydleHRyYVN0YXRlJ10gPVxuICAgICAgICAgIFhtbC5kb21Ub1RleHQoZXh0cmFTdGF0ZSlcbiAgICAgICAgICAgICAgLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICAnIHhtbG5zPVwiaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYmxvY2tseS94bWxcIicsICcnKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBBZGRzIHRoZSBzdGF0ZSBvZiBhbGwgb2YgdGhlIGljb25zIG9uIHRoZSBibG9jayB0byB0aGUgZ2l2ZW4gc3RhdGUgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gc2VyaWFsaXplIHRoZSBpY29uIHN0YXRlIG9mLlxuICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvYmplY3QgdG8gYXBwZW5kIHRvLlxuICovXG5mdW5jdGlvbiBzYXZlSWNvbnMoYmxvY2s6IEJsb2NrLCBzdGF0ZTogU3RhdGUpIHtcbiAgLy8gVE9ETygjMjEwNSk6IFJlbW92ZSB0aGlzIGxvZ2ljIGFuZCBwdXQgaXQgaW4gdGhlIGljb24uXG4gIGlmIChibG9jay5nZXRDb21tZW50VGV4dCgpKSB7XG4gICAgc3RhdGVbJ2ljb25zJ10gPSB7XG4gICAgICAnY29tbWVudCc6IHtcbiAgICAgICAgJ3RleHQnOiBibG9jay5nZXRDb21tZW50VGV4dCgpLFxuICAgICAgICAncGlubmVkJzogYmxvY2suY29tbWVudE1vZGVsLnBpbm5lZCxcbiAgICAgICAgJ2hlaWdodCc6IE1hdGgucm91bmQoYmxvY2suY29tbWVudE1vZGVsLnNpemUuaGVpZ2h0KSxcbiAgICAgICAgJ3dpZHRoJzogTWF0aC5yb3VuZChibG9jay5jb21tZW50TW9kZWwuc2l6ZS53aWR0aCksXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBBZGRzIHRoZSBzdGF0ZSBvZiBhbGwgb2YgdGhlIGZpZWxkcyBvbiB0aGUgYmxvY2sgdG8gdGhlIGdpdmVuIHN0YXRlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNlcmlhbGl6ZSB0aGUgZmllbGQgc3RhdGUgb2YuXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9iamVjdCB0byBhcHBlbmQgdG8uXG4gKiBAcGFyYW0gZG9GdWxsU2VyaWFsaXphdGlvbiBXaGV0aGVyIG9yIG5vdCB0byBzZXJpYWxpemUgdGhlIGZ1bGwgc3RhdGUgb2YgdGhlXG4gKiAgICAgZmllbGQgKHJhdGhlciB0aGFuIHBvc3NpYmx5IHNhdmluZyBhIHJlZmVyZW5jZSB0byBzb21lIHN0YXRlKS5cbiAqL1xuZnVuY3Rpb24gc2F2ZUZpZWxkcyhibG9jazogQmxvY2ssIHN0YXRlOiBTdGF0ZSwgZG9GdWxsU2VyaWFsaXphdGlvbjogYm9vbGVhbikge1xuICBjb25zdCBmaWVsZHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrLmlucHV0TGlzdC5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGlucHV0ID0gYmxvY2suaW5wdXRMaXN0W2ldO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgaW5wdXQuZmllbGRSb3cubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IGZpZWxkID0gaW5wdXQuZmllbGRSb3dbal07XG4gICAgICBpZiAoZmllbGQuaXNTZXJpYWxpemFibGUoKSkge1xuICAgICAgICBmaWVsZHNbZmllbGQubmFtZSFdID0gZmllbGQuc2F2ZVN0YXRlKGRvRnVsbFNlcmlhbGl6YXRpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoT2JqZWN0LmtleXMoZmllbGRzKS5sZW5ndGgpIHtcbiAgICBzdGF0ZVsnZmllbGRzJ10gPSBmaWVsZHM7XG4gIH1cbn1cblxuLyoqXG4gKiBBZGRzIHRoZSBzdGF0ZSBvZiBhbGwgb2YgdGhlIGNoaWxkIGJsb2NrcyBvZiB0aGUgZ2l2ZW4gYmxvY2sgKHdoaWNoIGFyZVxuICogY29ubmVjdGVkIHRvIGlucHV0cykgdG8gdGhlIGdpdmVuIHN0YXRlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNlcmlhbGl6ZSB0aGUgaW5wdXQgYmxvY2tzIG9mLlxuICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvYmplY3QgdG8gYXBwZW5kIHRvLlxuICogQHBhcmFtIGRvRnVsbFNlcmlhbGl6YXRpb24gV2hldGhlciBvciBub3QgdG8gZG8gZnVsbCBzZXJpYWxpemF0aW9uLlxuICovXG5mdW5jdGlvbiBzYXZlSW5wdXRCbG9ja3MoXG4gICAgYmxvY2s6IEJsb2NrLCBzdGF0ZTogU3RhdGUsIGRvRnVsbFNlcmlhbGl6YXRpb246IGJvb2xlYW4pIHtcbiAgY29uc3QgaW5wdXRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9jay5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBpbnB1dCA9IGJsb2NrLmlucHV0TGlzdFtpXTtcbiAgICBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5EVU1NWSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0ZSA9XG4gICAgICAgIHNhdmVDb25uZWN0aW9uKGlucHV0LmNvbm5lY3Rpb24gYXMgQ29ubmVjdGlvbiwgZG9GdWxsU2VyaWFsaXphdGlvbik7XG4gICAgaWYgKGNvbm5lY3Rpb25TdGF0ZSkge1xuICAgICAgaW5wdXRzW2lucHV0Lm5hbWVdID0gY29ubmVjdGlvblN0YXRlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChPYmplY3Qua2V5cyhpbnB1dHMpLmxlbmd0aCkge1xuICAgIHN0YXRlWydpbnB1dHMnXSA9IGlucHV0cztcbiAgfVxufVxuXG4vKipcbiAqIEFkZHMgdGhlIHN0YXRlIG9mIGFsbCBvZiB0aGUgbmV4dCBibG9ja3Mgb2YgdGhlIGdpdmVuIGJsb2NrIHRvIHRoZSBnaXZlblxuICogc3RhdGUgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gc2VyaWFsaXplIHRoZSBuZXh0IGJsb2NrcyBvZi5cbiAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IHRvIGFwcGVuZCB0by5cbiAqIEBwYXJhbSBkb0Z1bGxTZXJpYWxpemF0aW9uIFdoZXRoZXIgb3Igbm90IHRvIGRvIGZ1bGwgc2VyaWFsaXphdGlvbi5cbiAqL1xuZnVuY3Rpb24gc2F2ZU5leHRCbG9ja3MoXG4gICAgYmxvY2s6IEJsb2NrLCBzdGF0ZTogU3RhdGUsIGRvRnVsbFNlcmlhbGl6YXRpb246IGJvb2xlYW4pIHtcbiAgaWYgKCFibG9jay5uZXh0Q29ubmVjdGlvbikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBjb25uZWN0aW9uU3RhdGUgPVxuICAgICAgc2F2ZUNvbm5lY3Rpb24oYmxvY2submV4dENvbm5lY3Rpb24sIGRvRnVsbFNlcmlhbGl6YXRpb24pO1xuICBpZiAoY29ubmVjdGlvblN0YXRlKSB7XG4gICAgc3RhdGVbJ25leHQnXSA9IGNvbm5lY3Rpb25TdGF0ZTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHN0YXRlIG9mIHRoZSBnaXZlbiBjb25uZWN0aW9uIChpZSB0aGUgc3RhdGUgb2YgYW55IGNvbm5lY3RlZFxuICogc2hhZG93IG9yIHJlYWwgYmxvY2tzKS5cbiAqXG4gKiBAcGFyYW0gY29ubmVjdGlvbiBUaGUgY29ubmVjdGlvbiB0byBzZXJpYWxpemUgdGhlIGNvbm5lY3RlZCBibG9ja3Mgb2YuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgc3RhdGUgb2YgYW55IGNvbm5lY3RlZCBzaGFkb3cgYmxvY2ssIG9yIGFueVxuICogICAgIGNvbm5lY3RlZCByZWFsIGJsb2NrLlxuICogQHBhcmFtIGRvRnVsbFNlcmlhbGl6YXRpb24gV2hldGhlciBvciBub3QgdG8gZG8gZnVsbCBzZXJpYWxpemF0aW9uLlxuICovXG5mdW5jdGlvbiBzYXZlQ29ubmVjdGlvbihjb25uZWN0aW9uOiBDb25uZWN0aW9uLCBkb0Z1bGxTZXJpYWxpemF0aW9uOiBib29sZWFuKTpcbiAgICBDb25uZWN0aW9uU3RhdGV8bnVsbCB7XG4gIGNvbnN0IHNoYWRvdyA9IGNvbm5lY3Rpb24uZ2V0U2hhZG93U3RhdGUodHJ1ZSk7XG4gIGNvbnN0IGNoaWxkID0gY29ubmVjdGlvbi50YXJnZXRCbG9jaygpO1xuICBpZiAoIXNoYWRvdyAmJiAhY2hpbGQpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBzdGF0ZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIGlmIChzaGFkb3cpIHtcbiAgICBzdGF0ZVsnc2hhZG93J10gPSBzaGFkb3c7XG4gIH1cbiAgaWYgKGNoaWxkICYmICFjaGlsZC5pc1NoYWRvdygpKSB7XG4gICAgc3RhdGVbJ2Jsb2NrJ10gPSBzYXZlKGNoaWxkLCB7ZG9GdWxsU2VyaWFsaXphdGlvbn0pO1xuICB9XG4gIHJldHVybiBzdGF0ZTtcbn1cblxuLyoqXG4gKiBMb2FkcyB0aGUgYmxvY2sgcmVwcmVzZW50ZWQgYnkgdGhlIGdpdmVuIHN0YXRlIGludG8gdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAqXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9mIGEgYmxvY2sgdG8gZGVzZXJpYWxpemUgaW50byB0aGUgd29ya3NwYWNlLlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIGFkZCB0aGUgYmxvY2sgdG8uXG4gKiBAcGFyYW0gcGFyYW0xIHJlY29yZFVuZG86IElmIHRydWUsIGV2ZW50cyB0cmlnZ2VyZWQgYnkgdGhpcyBmdW5jdGlvbiB3aWxsIGJlXG4gKiAgICAgdW5kby1hYmxlIGJ5IHRoZSB1c2VyLiBGYWxzZSBieSBkZWZhdWx0LlxuICogQHJldHVybnMgVGhlIGJsb2NrIHRoYXQgd2FzIGp1c3QgbG9hZGVkLlxuICogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi5ibG9ja3MuYXBwZW5kXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBlbmQoXG4gICAgc3RhdGU6IFN0YXRlLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSxcbiAgICB7cmVjb3JkVW5kbyA9IGZhbHNlfToge3JlY29yZFVuZG8/OiBib29sZWFufSA9IHt9KTogQmxvY2sge1xuICByZXR1cm4gYXBwZW5kSW50ZXJuYWwoc3RhdGUsIHdvcmtzcGFjZSwge3JlY29yZFVuZG99KTtcbn1cblxuLyoqXG4gKiBMb2FkcyB0aGUgYmxvY2sgcmVwcmVzZW50ZWQgYnkgdGhlIGdpdmVuIHN0YXRlIGludG8gdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAqIFRoaXMgaXMgZGVmaW5lZCBpbnRlcm5hbGx5IHNvIHRoYXQgdGhlIGV4dHJhIHBhcmFtZXRlcnMgZG9uJ3QgY2x1dHRlciBvdXJcbiAqIGV4dGVybmFsIEFQSS5cbiAqIEJ1dCBpdCBpcyBleHBvcnRlZCBzbyB0aGF0IG90aGVyIHBsYWNlcyB3aXRoaW4gQmxvY2tseSBjYW4gY2FsbCBpdCBkaXJlY3RseVxuICogd2l0aCB0aGUgZXh0cmEgcGFyYW1ldGVycy5cbiAqXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9mIGEgYmxvY2sgdG8gZGVzZXJpYWxpemUgaW50byB0aGUgd29ya3NwYWNlLlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIGFkZCB0aGUgYmxvY2sgdG8uXG4gKiBAcGFyYW0gcGFyYW0xIHBhcmVudENvbm5lY3Rpb246IElmIHByb3ZpZGVkLCB0aGUgc3lzdGVtIHdpbGwgYXR0ZW1wdCB0b1xuICogICAgIGNvbm5lY3QgdGhlIGJsb2NrIHRvIHRoaXMgY29ubmVjdGlvbiBhZnRlciBpdCBpcyBjcmVhdGVkLiBVbmRlZmluZWQgYnlcbiAqICAgICBkZWZhdWx0LiBpc1NoYWRvdzogSWYgdHJ1ZSwgdGhlIGJsb2NrIHdpbGwgYmUgc2V0IHRvIGEgc2hhZG93IGJsb2NrIGFmdGVyXG4gKiAgICAgaXQgaXMgY3JlYXRlZC4gRmFsc2UgYnkgZGVmYXVsdC4gcmVjb3JkVW5kbzogSWYgdHJ1ZSwgZXZlbnRzIHRyaWdnZXJlZCBieVxuICogICAgIHRoaXMgZnVuY3Rpb24gd2lsbCBiZSB1bmRvLWFibGUgYnkgdGhlIHVzZXIuIEZhbHNlIGJ5IGRlZmF1bHQuXG4gKiBAcmV0dXJucyBUaGUgYmxvY2sgdGhhdCB3YXMganVzdCBhcHBlbmRlZC5cbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24uYmxvY2tzLmFwcGVuZEludGVybmFsXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGVuZEludGVybmFsKFxuICAgIHN0YXRlOiBTdGF0ZSwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsXG4gICAge3BhcmVudENvbm5lY3Rpb24gPSB1bmRlZmluZWQsIGlzU2hhZG93ID0gZmFsc2UsIHJlY29yZFVuZG8gPSBmYWxzZX06IHtcbiAgICAgIHBhcmVudENvbm5lY3Rpb24/OiBDb25uZWN0aW9uLFxuICAgICAgaXNTaGFkb3c/OiBib29sZWFuLFxuICAgICAgcmVjb3JkVW5kbz86IGJvb2xlYW5cbiAgICB9ID0ge30pOiBCbG9jayB7XG4gIGNvbnN0IHByZXZSZWNvcmRVbmRvID0gZXZlbnRVdGlscy5nZXRSZWNvcmRVbmRvKCk7XG4gIGV2ZW50VXRpbHMuc2V0UmVjb3JkVW5kbyhyZWNvcmRVbmRvKTtcbiAgY29uc3QgZXhpc3RpbmdHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgfVxuICBldmVudFV0aWxzLmRpc2FibGUoKTtcblxuICBjb25zdCBibG9jayA9IGFwcGVuZFByaXZhdGUoc3RhdGUsIHdvcmtzcGFjZSwge3BhcmVudENvbm5lY3Rpb24sIGlzU2hhZG93fSk7XG5cbiAgZXZlbnRVdGlscy5lbmFibGUoKTtcbiAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19DUkVBVEUpKShibG9jaykpO1xuICBldmVudFV0aWxzLnNldEdyb3VwKGV4aXN0aW5nR3JvdXApO1xuICBldmVudFV0aWxzLnNldFJlY29yZFVuZG8ocHJldlJlY29yZFVuZG8pO1xuXG4gIC8vIEFkZGluZyBjb25uZWN0aW9ucyB0byB0aGUgY29ubmVjdGlvbiBkYiBpcyBleHBlbnNpdmUuIFRoaXMgZGVmZXJzIHRoYXRcbiAgLy8gb3BlcmF0aW9uIHRvIGRlY3JlYXNlIGxvYWQgdGltZS5cbiAgaWYgKHdvcmtzcGFjZS5yZW5kZXJlZCkge1xuICAgIGNvbnN0IGJsb2NrU3ZnID0gYmxvY2sgYXMgQmxvY2tTdmc7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoIWJsb2NrU3ZnLmRpc3Bvc2VkKSB7XG4gICAgICAgIGJsb2NrU3ZnLnNldENvbm5lY3Rpb25UcmFja2luZyh0cnVlKTtcbiAgICAgIH1cbiAgICB9LCAxKTtcbiAgfVxuXG4gIHJldHVybiBibG9jaztcbn1cblxuLyoqXG4gKiBMb2FkcyB0aGUgYmxvY2sgcmVwcmVzZW50ZWQgYnkgdGhlIGdpdmVuIHN0YXRlIGludG8gdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAqIFRoaXMgaXMgZGVmaW5lZCBwcml2YXRlbHkgc28gdGhhdCBpdCBjYW4gYmUgY2FsbGVkIHJlY3Vyc2l2ZWx5IHdpdGhvdXQgZmlyaW5nXG4gKiBlcm9uZW91cyBldmVudHMuIEV2ZW50cyAoYW5kIG90aGVyIHRoaW5ncyB3ZSBvbmx5IHdhbnQgdG8gb2NjdXIgb24gdGhlIHRvcFxuICogYmxvY2spIGFyZSBoYW5kbGVkIGJ5IGFwcGVuZEludGVybmFsLlxuICpcbiAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2YgYSBibG9jayB0byBkZXNlcmlhbGl6ZSBpbnRvIHRoZSB3b3Jrc3BhY2UuXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gYWRkIHRoZSBibG9jayB0by5cbiAqIEBwYXJhbSBwYXJhbTEgcGFyZW50Q29ubmVjdGlvbjogSWYgcHJvdmlkZWQsIHRoZSBzeXN0ZW0gd2lsbCBhdHRlbXB0IHRvXG4gKiAgICAgY29ubmVjdCB0aGUgYmxvY2sgdG8gdGhpcyBjb25uZWN0aW9uIGFmdGVyIGl0IGlzIGNyZWF0ZWQuIFVuZGVmaW5lZCBieVxuICogICAgIGRlZmF1bHQuIGlzU2hhZG93OiBUaGUgYmxvY2sgd2lsbCBiZSBzZXQgdG8gYSBzaGFkb3cgYmxvY2sgYWZ0ZXIgaXQgaXNcbiAqICAgICBjcmVhdGVkLiBGYWxzZSBieSBkZWZhdWx0LlxuICogQHJldHVybnMgVGhlIGJsb2NrIHRoYXQgd2FzIGp1c3QgYXBwZW5kZWQuXG4gKi9cbmZ1bmN0aW9uIGFwcGVuZFByaXZhdGUoXG4gICAgc3RhdGU6IFN0YXRlLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSxcbiAgICB7cGFyZW50Q29ubmVjdGlvbiA9IHVuZGVmaW5lZCwgaXNTaGFkb3cgPSBmYWxzZX06XG4gICAgICAgIHtwYXJlbnRDb25uZWN0aW9uPzogQ29ubmVjdGlvbiwgaXNTaGFkb3c/OiBib29sZWFufSA9IHt9KTogQmxvY2sge1xuICBpZiAoIXN0YXRlWyd0eXBlJ10pIHtcbiAgICB0aHJvdyBuZXcgTWlzc2luZ0Jsb2NrVHlwZShzdGF0ZSk7XG4gIH1cblxuICBjb25zdCBibG9jayA9IHdvcmtzcGFjZS5uZXdCbG9jayhzdGF0ZVsndHlwZSddLCBzdGF0ZVsnaWQnXSk7XG4gIGJsb2NrLnNldFNoYWRvdyhpc1NoYWRvdyk7XG4gIGxvYWRDb29yZHMoYmxvY2ssIHN0YXRlKTtcbiAgbG9hZEF0dHJpYnV0ZXMoYmxvY2ssIHN0YXRlKTtcbiAgbG9hZEV4dHJhU3RhdGUoYmxvY2ssIHN0YXRlKTtcbiAgdHJ5VG9Db25uZWN0UGFyZW50KHBhcmVudENvbm5lY3Rpb24sIGJsb2NrLCBzdGF0ZSk7XG4gIGxvYWRJY29ucyhibG9jaywgc3RhdGUpO1xuICBsb2FkRmllbGRzKGJsb2NrLCBzdGF0ZSk7XG4gIGxvYWRJbnB1dEJsb2NrcyhibG9jaywgc3RhdGUpO1xuICBsb2FkTmV4dEJsb2NrcyhibG9jaywgc3RhdGUpO1xuICBpbml0QmxvY2soYmxvY2ssIHdvcmtzcGFjZS5yZW5kZXJlZCk7XG5cbiAgcmV0dXJuIGJsb2NrO1xufVxuXG4vKipcbiAqIEFwcGxpZXMgYW55IGNvb3JkaW5hdGUgaW5mb3JtYXRpb24gYXZhaWxhYmxlIG9uIHRoZSBzdGF0ZSBvYmplY3QgdG8gdGhlXG4gKiBibG9jay5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNldCB0aGUgcG9zaXRpb24gb2YuXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9iamVjdCB0byByZWZlcmVuY2UuXG4gKi9cbmZ1bmN0aW9uIGxvYWRDb29yZHMoYmxvY2s6IEJsb2NrLCBzdGF0ZTogU3RhdGUpIHtcbiAgbGV0IHggPSBzdGF0ZVsneCddID09PSB1bmRlZmluZWQgPyAwIDogc3RhdGVbJ3gnXTtcbiAgY29uc3QgeSA9IHN0YXRlWyd5J10gPT09IHVuZGVmaW5lZCA/IDAgOiBzdGF0ZVsneSddO1xuXG4gIGNvbnN0IHdvcmtzcGFjZSA9IGJsb2NrLndvcmtzcGFjZTtcbiAgeCA9IHdvcmtzcGFjZS5SVEwgPyB3b3Jrc3BhY2UuZ2V0V2lkdGgoKSAtIHggOiB4O1xuXG4gIGJsb2NrLm1vdmVCeSh4LCB5KTtcbn1cblxuLyoqXG4gKiBBcHBsaWVzIGFueSBhdHRyaWJ1dGUgaW5mb3JtYXRpb24gYXZhaWxhYmxlIG9uIHRoZSBzdGF0ZSBvYmplY3QgdG8gdGhlIGJsb2NrLlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gc2V0IHRoZSBhdHRyaWJ1dGVzIG9mLlxuICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvYmplY3QgdG8gcmVmZXJlbmNlLlxuICovXG5mdW5jdGlvbiBsb2FkQXR0cmlidXRlcyhibG9jazogQmxvY2ssIHN0YXRlOiBTdGF0ZSkge1xuICBpZiAoc3RhdGVbJ2NvbGxhcHNlZCddKSB7XG4gICAgYmxvY2suc2V0Q29sbGFwc2VkKHRydWUpO1xuICB9XG4gIGlmIChzdGF0ZVsnZW5hYmxlZCddID09PSBmYWxzZSkge1xuICAgIGJsb2NrLnNldEVuYWJsZWQoZmFsc2UpO1xuICB9XG4gIGlmIChzdGF0ZVsnaW5saW5lJ10gIT09IHVuZGVmaW5lZCkge1xuICAgIGJsb2NrLnNldElucHV0c0lubGluZShzdGF0ZVsnaW5saW5lJ10pO1xuICB9XG4gIGlmIChzdGF0ZVsnZGF0YSddICE9PSB1bmRlZmluZWQpIHtcbiAgICBibG9jay5kYXRhID0gc3RhdGVbJ2RhdGEnXTtcbiAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgYW55IGV4dHJhIHN0YXRlIGluZm9ybWF0aW9uIGF2YWlsYWJsZSBvbiB0aGUgc3RhdGUgb2JqZWN0IHRvIHRoZVxuICogYmxvY2suXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBzZXQgdGhlIGV4dHJhIHN0YXRlIG9mLlxuICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvYmplY3QgdG8gcmVmZXJlbmNlLlxuICovXG5mdW5jdGlvbiBsb2FkRXh0cmFTdGF0ZShibG9jazogQmxvY2ssIHN0YXRlOiBTdGF0ZSkge1xuICBpZiAoIXN0YXRlWydleHRyYVN0YXRlJ10pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGJsb2NrLmxvYWRFeHRyYVN0YXRlKSB7XG4gICAgYmxvY2subG9hZEV4dHJhU3RhdGUoc3RhdGVbJ2V4dHJhU3RhdGUnXSk7XG4gIH0gZWxzZSBpZiAoYmxvY2suZG9tVG9NdXRhdGlvbikge1xuICAgIGJsb2NrLmRvbVRvTXV0YXRpb24oWG1sLnRleHRUb0RvbShzdGF0ZVsnZXh0cmFTdGF0ZSddKSk7XG4gIH1cbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBjb25uZWN0IHRoZSBibG9jayB0byB0aGUgcGFyZW50IGNvbm5lY3Rpb24sIGlmIGl0IGV4aXN0cy5cbiAqXG4gKiBAcGFyYW0gcGFyZW50Q29ubmVjdGlvbiBUaGUgcGFyZW50IGNvbm5lY3Rpb24gdG8gdHJ5IHRvIGNvbm5lY3QgdGhlIGJsb2NrIHRvLlxuICogQHBhcmFtIGNoaWxkIFRoZSBibG9jayB0byB0cnkgdG8gY29ubmVjdCB0byB0aGUgcGFyZW50LlxuICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSB3aGljaCBkZWZpbmVzIHRoZSBnaXZlbiBibG9ja1xuICovXG5mdW5jdGlvbiB0cnlUb0Nvbm5lY3RQYXJlbnQoXG4gICAgcGFyZW50Q29ubmVjdGlvbjogQ29ubmVjdGlvbnx1bmRlZmluZWQsIGNoaWxkOiBCbG9jaywgc3RhdGU6IFN0YXRlKSB7XG4gIGlmICghcGFyZW50Q29ubmVjdGlvbikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChwYXJlbnRDb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCkuaXNTaGFkb3coKSAmJiAhY2hpbGQuaXNTaGFkb3coKSkge1xuICAgIHRocm93IG5ldyBSZWFsQ2hpbGRPZlNoYWRvdyhzdGF0ZSk7XG4gIH1cblxuICBsZXQgY29ubmVjdGVkID0gZmFsc2U7XG4gIGxldCBjaGlsZENvbm5lY3Rpb247XG4gIGlmIChwYXJlbnRDb25uZWN0aW9uLnR5cGUgPT09IGlucHV0VHlwZXMuVkFMVUUpIHtcbiAgICBjaGlsZENvbm5lY3Rpb24gPSBjaGlsZC5vdXRwdXRDb25uZWN0aW9uO1xuICAgIGlmICghY2hpbGRDb25uZWN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgTWlzc2luZ0Nvbm5lY3Rpb24oJ291dHB1dCcsIGNoaWxkLCBzdGF0ZSk7XG4gICAgfVxuICAgIGNvbm5lY3RlZCA9IHBhcmVudENvbm5lY3Rpb24uY29ubmVjdChjaGlsZENvbm5lY3Rpb24pO1xuICB9IGVsc2UgeyAgLy8gU3RhdGVtZW50IHR5cGUuXG4gICAgY2hpbGRDb25uZWN0aW9uID0gY2hpbGQucHJldmlvdXNDb25uZWN0aW9uO1xuICAgIGlmICghY2hpbGRDb25uZWN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgTWlzc2luZ0Nvbm5lY3Rpb24oJ3ByZXZpb3VzJywgY2hpbGQsIHN0YXRlKTtcbiAgICB9XG4gICAgY29ubmVjdGVkID0gcGFyZW50Q29ubmVjdGlvbi5jb25uZWN0KGNoaWxkQ29ubmVjdGlvbik7XG4gIH1cblxuICBpZiAoIWNvbm5lY3RlZCkge1xuICAgIGNvbnN0IGNoZWNrZXIgPSBjaGlsZC53b3Jrc3BhY2UuY29ubmVjdGlvbkNoZWNrZXI7XG4gICAgdGhyb3cgbmV3IEJhZENvbm5lY3Rpb25DaGVjayhcbiAgICAgICAgY2hlY2tlci5nZXRFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICBjaGVja2VyLmNhbkNvbm5lY3RXaXRoUmVhc29uKFxuICAgICAgICAgICAgICAgIGNoaWxkQ29ubmVjdGlvbiwgcGFyZW50Q29ubmVjdGlvbiwgZmFsc2UpLFxuICAgICAgICAgICAgY2hpbGRDb25uZWN0aW9uLCBwYXJlbnRDb25uZWN0aW9uKSxcbiAgICAgICAgcGFyZW50Q29ubmVjdGlvbi50eXBlID09PSBpbnB1dFR5cGVzLlZBTFVFID8gJ291dHB1dCBjb25uZWN0aW9uJyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcmV2aW91cyBjb25uZWN0aW9uJyxcbiAgICAgICAgY2hpbGQsIHN0YXRlKTtcbiAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgaWNvbiBzdGF0ZSB0byB0aGUgaWNvbnMgb24gdGhlIGJsb2NrLCBiYXNlZCBvbiB0aGUgZ2l2ZW4gc3RhdGVcbiAqIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNldCB0aGUgaWNvbiBzdGF0ZSBvZi5cbiAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IHRvIHJlZmVyZW5jZS5cbiAqL1xuZnVuY3Rpb24gbG9hZEljb25zKGJsb2NrOiBCbG9jaywgc3RhdGU6IFN0YXRlKSB7XG4gIGlmICghc3RhdGVbJ2ljb25zJ10pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gVE9ETygjMjEwNSk6IFJlbW92ZSB0aGlzIGxvZ2ljIGFuZCBwdXQgaXQgaW4gdGhlIGljb24uXG4gIGNvbnN0IGNvbW1lbnQgPSBzdGF0ZVsnaWNvbnMnXVsnY29tbWVudCddO1xuICBpZiAoY29tbWVudCkge1xuICAgIGJsb2NrLnNldENvbW1lbnRUZXh0KGNvbW1lbnRbJ3RleHQnXSk7XG4gICAgLy8gTG9hZCBpZiBzYXZlZC4gKENsZWFuZWQgdW5uZWNlc3NhcnkgYXR0cmlidXRlcyB3aGVuIGluIHRoZSB0cmFzaGNhbi4pXG4gICAgaWYgKCdwaW5uZWQnIGluIGNvbW1lbnQpIHtcbiAgICAgIGJsb2NrLmNvbW1lbnRNb2RlbC5waW5uZWQgPSBjb21tZW50WydwaW5uZWQnXTtcbiAgICB9XG4gICAgaWYgKCd3aWR0aCcgaW4gY29tbWVudCAmJiAnaGVpZ2h0JyBpbiBjb21tZW50KSB7XG4gICAgICBibG9jay5jb21tZW50TW9kZWwuc2l6ZSA9IG5ldyBTaXplKGNvbW1lbnRbJ3dpZHRoJ10sIGNvbW1lbnRbJ2hlaWdodCddKTtcbiAgICB9XG4gICAgaWYgKGNvbW1lbnRbJ3Bpbm5lZCddICYmIGJsb2NrLnJlbmRlcmVkICYmICFibG9jay5pc0luRmx5b3V0KSB7XG4gICAgICAvLyBHaXZlIHRoZSBibG9jayBhIGNoYW5jZSB0byBiZSBwb3NpdGlvbmVkIGFuZCByZW5kZXJlZCBiZWZvcmUgc2hvd2luZy5cbiAgICAgIGNvbnN0IGJsb2NrU3ZnID0gYmxvY2sgYXMgQmxvY2tTdmc7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IGJsb2NrU3ZnLmdldENvbW1lbnRJY29uKCkhLnNldFZpc2libGUodHJ1ZSksIDEpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgYW55IGZpZWxkIGluZm9ybWF0aW9uIGF2YWlsYWJsZSBvbiB0aGUgc3RhdGUgb2JqZWN0IHRvIHRoZSBibG9jay5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNldCB0aGUgZmllbGQgc3RhdGUgb2YuXG4gKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9iamVjdCB0byByZWZlcmVuY2UuXG4gKi9cbmZ1bmN0aW9uIGxvYWRGaWVsZHMoYmxvY2s6IEJsb2NrLCBzdGF0ZTogU3RhdGUpIHtcbiAgaWYgKCFzdGF0ZVsnZmllbGRzJ10pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHN0YXRlWydmaWVsZHMnXSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGZpZWxkTmFtZSA9IGtleXNbaV07XG4gICAgY29uc3QgZmllbGRTdGF0ZSA9IHN0YXRlWydmaWVsZHMnXVtmaWVsZE5hbWVdO1xuICAgIGNvbnN0IGZpZWxkID0gYmxvY2suZ2V0RmllbGQoZmllbGROYW1lKTtcbiAgICBpZiAoIWZpZWxkKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgYElnbm9yaW5nIG5vbi1leGlzdGFudCBmaWVsZCAke2ZpZWxkTmFtZX0gaW4gYmxvY2sgJHtibG9jay50eXBlfWApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGZpZWxkLmxvYWRTdGF0ZShmaWVsZFN0YXRlKTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW55IGNoaWxkIGJsb2NrcyAoYXR0YWNoZWQgdG8gaW5wdXRzKSBkZWZpbmVkIGJ5IHRoZSBnaXZlbiBzdGF0ZVxuICogYW5kIGF0dGFjaGVzIHRoZW0gdG8gdGhlIGdpdmVuIGJsb2NrLlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gYXR0YWNoIGlucHV0IGJsb2NrcyB0by5cbiAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IHRvIHJlZmVyZW5jZS5cbiAqL1xuZnVuY3Rpb24gbG9hZElucHV0QmxvY2tzKGJsb2NrOiBCbG9jaywgc3RhdGU6IFN0YXRlKSB7XG4gIGlmICghc3RhdGVbJ2lucHV0cyddKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhzdGF0ZVsnaW5wdXRzJ10pO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBpbnB1dE5hbWUgPSBrZXlzW2ldO1xuICAgIGNvbnN0IGlucHV0ID0gYmxvY2suZ2V0SW5wdXQoaW5wdXROYW1lKTtcbiAgICBpZiAoIWlucHV0IHx8ICFpbnB1dC5jb25uZWN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgTWlzc2luZ0Nvbm5lY3Rpb24oaW5wdXROYW1lLCBibG9jaywgc3RhdGUpO1xuICAgIH1cbiAgICBsb2FkQ29ubmVjdGlvbihpbnB1dC5jb25uZWN0aW9uLCBzdGF0ZVsnaW5wdXRzJ11baW5wdXROYW1lXSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFueSBuZXh0IGJsb2NrcyBkZWZpbmVkIGJ5IHRoZSBnaXZlbiBzdGF0ZSBhbmQgYXR0YWNoZXMgdGhlbSB0byB0aGVcbiAqIGdpdmVuIGJsb2NrLlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gYXR0YWNoIG5leHQgYmxvY2tzIHRvLlxuICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvYmplY3QgdG8gcmVmZXJlbmNlLlxuICovXG5mdW5jdGlvbiBsb2FkTmV4dEJsb2NrcyhibG9jazogQmxvY2ssIHN0YXRlOiBTdGF0ZSkge1xuICBpZiAoIXN0YXRlWyduZXh0J10pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCFibG9jay5uZXh0Q29ubmVjdGlvbikge1xuICAgIHRocm93IG5ldyBNaXNzaW5nQ29ubmVjdGlvbignbmV4dCcsIGJsb2NrLCBzdGF0ZSk7XG4gIH1cbiAgbG9hZENvbm5lY3Rpb24oYmxvY2submV4dENvbm5lY3Rpb24sIHN0YXRlWyduZXh0J10pO1xufVxuLyoqXG4gKiBBcHBsaWVzIHRoZSBzdGF0ZSBkZWZpbmVkIGJ5IGNvbm5lY3Rpb25TdGF0ZSB0byB0aGUgZ2l2ZW4gY29ubmVjdGlvbiwgaWVcbiAqIGFzc2lnbnMgc2hhZG93cyBhbmQgYXR0YWNoZXMgY2hpbGQgYmxvY2tzLlxuICpcbiAqIEBwYXJhbSBjb25uZWN0aW9uIFRoZSBjb25uZWN0aW9uIHRvIGRlc2VyaWFsaXplIHRoZSBjb25uZWN0ZWQgYmxvY2tzIG9mLlxuICogQHBhcmFtIGNvbm5lY3Rpb25TdGF0ZSBUaGUgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHN0YXRlIG9mIGFueSBjb25uZWN0ZWRcbiAqICAgICBzaGFkb3cgYmxvY2ssIG9yIGFueSBjb25uZWN0ZWQgcmVhbCBibG9jay5cbiAqL1xuZnVuY3Rpb24gbG9hZENvbm5lY3Rpb24oXG4gICAgY29ubmVjdGlvbjogQ29ubmVjdGlvbiwgY29ubmVjdGlvblN0YXRlOiBDb25uZWN0aW9uU3RhdGUpIHtcbiAgaWYgKGNvbm5lY3Rpb25TdGF0ZVsnc2hhZG93J10pIHtcbiAgICBjb25uZWN0aW9uLnNldFNoYWRvd1N0YXRlKGNvbm5lY3Rpb25TdGF0ZVsnc2hhZG93J10pO1xuICB9XG4gIGlmIChjb25uZWN0aW9uU3RhdGVbJ2Jsb2NrJ10pIHtcbiAgICBhcHBlbmRQcml2YXRlKFxuICAgICAgICBjb25uZWN0aW9uU3RhdGVbJ2Jsb2NrJ10sIGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKS53b3Jrc3BhY2UsXG4gICAgICAgIHtwYXJlbnRDb25uZWN0aW9uOiBjb25uZWN0aW9ufSk7XG4gIH1cbn1cblxuLy8gVE9ETygjNTE0Nik6IFJlbW92ZSB0aGlzIGZyb20gdGhlIHNlcmlhbGl6YXRpb24gc3lzdGVtLlxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgZ2l2ZSBibG9jaywgZWcgaW5pdCB0aGUgbW9kZWwsIGluaXRzIHRoZSBzdmcsIHJlbmRlcnMsIGV0Yy5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGluaXRpYWxpemUuXG4gKiBAcGFyYW0gcmVuZGVyZWQgV2hldGhlciB0aGUgYmxvY2sgaXMgYSByZW5kZXJlZCBvciBoZWFkbGVzcyBibG9jay5cbiAqL1xuZnVuY3Rpb24gaW5pdEJsb2NrKGJsb2NrOiBCbG9jaywgcmVuZGVyZWQ6IGJvb2xlYW4pIHtcbiAgaWYgKHJlbmRlcmVkKSB7XG4gICAgY29uc3QgYmxvY2tTdmcgPSBibG9jayBhcyBCbG9ja1N2ZztcbiAgICAvLyBBZGRpbmcgY29ubmVjdGlvbnMgdG8gdGhlIGNvbm5lY3Rpb24gZGIgaXMgZXhwZW5zaXZlLiBUaGlzIGRlZmVycyB0aGF0XG4gICAgLy8gb3BlcmF0aW9uIHRvIGRlY3JlYXNlIGxvYWQgdGltZS5cbiAgICBibG9ja1N2Zy5zZXRDb25uZWN0aW9uVHJhY2tpbmcoZmFsc2UpO1xuXG4gICAgYmxvY2tTdmcuaW5pdFN2ZygpO1xuICAgIGJsb2NrU3ZnLnJlbmRlcihmYWxzZSk7XG4gICAgLy8gZml4ZXMgIzYwNzYgSlNPIGRlc2VyaWFsaXphdGlvbiBkb2Vzbid0XG4gICAgLy8gc2V0IC5pY29uWFlfIHByb3BlcnR5IHNvIGhlcmUgaXQgd2lsbCBiZSBzZXRcbiAgICBjb25zdCBpY29ucyA9IGJsb2NrU3ZnLmdldEljb25zKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpY29ucy5sZW5ndGg7IGkrKykge1xuICAgICAgaWNvbnNbaV0uY29tcHV0ZUljb25Mb2NhdGlvbigpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBibG9jay5pbml0TW9kZWwoKTtcbiAgfVxufVxuXG4vLyBBbGlhcyB0byBkaXNhbWJpZ3VhdGUgc2F2aW5nIHdpdGhpbiB0aGUgc2VyaWFsaXplci5cbmNvbnN0IHNhdmVCbG9jayA9IHNhdmU7XG5cbi8qKlxuICogU2VyaWFsaXplciBmb3Igc2F2aW5nIGFuZCBsb2FkaW5nIGJsb2NrIHN0YXRlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24uYmxvY2tzLkJsb2NrU2VyaWFsaXplclxuICovXG5leHBvcnQgY2xhc3MgQmxvY2tTZXJpYWxpemVyIGltcGxlbWVudHMgSVNlcmlhbGl6ZXIge1xuICBwcmlvcml0eTogbnVtYmVyO1xuXG4gIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZXF1aXJlLWpzZG9jICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8qKiBUaGUgcHJpb3JpdHkgZm9yIGRlc2VyaWFsaXppbmcgYmxvY2tzLiAqL1xuICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0aWVzLkJMT0NLUztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXJpYWxpemVzIHRoZSBibG9ja3Mgb2YgdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNhdmUgdGhlIGJsb2NrcyBvZi5cbiAgICogQHJldHVybnMgVGhlIHN0YXRlIG9mIHRoZSB3b3Jrc3BhY2UncyBibG9ja3MsIG9yIG51bGwgaWYgdGhlcmUgYXJlIG5vXG4gICAqICAgICBibG9ja3MuXG4gICAqL1xuICBzYXZlKHdvcmtzcGFjZTogV29ya3NwYWNlKToge2xhbmd1YWdlVmVyc2lvbjogbnVtYmVyLCBibG9ja3M6IFN0YXRlW119fG51bGwge1xuICAgIGNvbnN0IGJsb2NrU3RhdGVzID0gW107XG4gICAgZm9yIChjb25zdCBibG9jayBvZiB3b3Jrc3BhY2UuZ2V0VG9wQmxvY2tzKGZhbHNlKSkge1xuICAgICAgY29uc3Qgc3RhdGUgPVxuICAgICAgICAgIHNhdmVCbG9jayhibG9jaywge2FkZENvb3JkaW5hdGVzOiB0cnVlLCBkb0Z1bGxTZXJpYWxpemF0aW9uOiBmYWxzZX0pO1xuICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgIGJsb2NrU3RhdGVzLnB1c2goc3RhdGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYmxvY2tTdGF0ZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAnbGFuZ3VhZ2VWZXJzaW9uJzogMCwgIC8vIEN1cnJlbnRseSB1bnVzZWQuXG4gICAgICAgICdibG9ja3MnOiBibG9ja1N0YXRlcyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgYmxvY2tzIGRlZmluZWQgYnkgdGhlIGdpdmVuIHN0YXRlIGludG8gdGhlIGdpdmVuXG4gICAqIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvZiB0aGUgYmxvY2tzIHRvIGRlc2VyaWFsaXplLlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gZGVzZXJpYWxpemUgaW50by5cbiAgICovXG4gIGxvYWQoXG4gICAgICBzdGF0ZToge2xhbmd1YWdlVmVyc2lvbjogbnVtYmVyLCBibG9ja3M6IFN0YXRlW119LCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgIGNvbnN0IGJsb2NrU3RhdGVzID0gc3RhdGVbJ2Jsb2NrcyddO1xuICAgIGZvciAoY29uc3Qgc3RhdGUgb2YgYmxvY2tTdGF0ZXMpIHtcbiAgICAgIGFwcGVuZChzdGF0ZSwgd29ya3NwYWNlLCB7cmVjb3JkVW5kbzogZXZlbnRVdGlscy5nZXRSZWNvcmRVbmRvKCl9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZXMgb2YgYW55IGJsb2NrcyB0aGF0IGV4aXN0IG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBjbGVhciB0aGUgYmxvY2tzIG9mLlxuICAgKi9cbiAgY2xlYXIod29ya3NwYWNlOiBXb3Jrc3BhY2UpIHtcbiAgICAvLyBDYW5ub3QgdXNlIHdvcmtzcGFjZS5jbGVhcigpIGJlY2F1c2UgdGhhdCBhbHNvIHJlbW92ZXMgdmFyaWFibGVzLlxuICAgIGZvciAoY29uc3QgYmxvY2sgb2Ygd29ya3NwYWNlLmdldFRvcEJsb2NrcyhmYWxzZSkpIHtcbiAgICAgIGJsb2NrLmRpc3Bvc2UoZmFsc2UpO1xuICAgIH1cbiAgfVxufVxuXG5zZXJpYWxpemF0aW9uUmVnaXN0cnkucmVnaXN0ZXIoJ2Jsb2NrcycsIG5ldyBCbG9ja1NlcmlhbGl6ZXIoKSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ29tcG9uZW50cyBmb3IgY3JlYXRpbmcgY29ubmVjdGlvbnMgYmV0d2VlbiBibG9ja3MuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuQ29ubmVjdGlvbicpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrTW92ZX0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Jsb2NrX21vdmUuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7SW5wdXR9IGZyb20gJy4vaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0lBU1ROb2RlTG9jYXRpb25XaXRoQmxvY2t9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2FzdF9ub2RlX2xvY2F0aW9uX3dpdGhfYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0lDb25uZWN0aW9uQ2hlY2tlcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29ubmVjdGlvbl9jaGVja2VyLmpzJztcbmltcG9ydCAqIGFzIGJsb2NrcyBmcm9tICcuL3NlcmlhbGl6YXRpb24vYmxvY2tzLmpzJztcbmltcG9ydCAqIGFzIFhtbCBmcm9tICcuL3htbC5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBjb25uZWN0aW9uIGJldHdlZW4gYmxvY2tzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbm5lY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIENvbm5lY3Rpb24gaW1wbGVtZW50cyBJQVNUTm9kZUxvY2F0aW9uV2l0aEJsb2NrIHtcbiAgLyoqIENvbnN0YW50cyBmb3IgY2hlY2tpbmcgd2hldGhlciB0d28gY29ubmVjdGlvbnMgYXJlIGNvbXBhdGlibGUuICovXG4gIHN0YXRpYyBDQU5fQ09OTkVDVCA9IDA7XG4gIHN0YXRpYyBSRUFTT05fU0VMRl9DT05ORUNUSU9OID0gMTtcbiAgc3RhdGljIFJFQVNPTl9XUk9OR19UWVBFID0gMjtcbiAgc3RhdGljIFJFQVNPTl9UQVJHRVRfTlVMTCA9IDM7XG4gIHN0YXRpYyBSRUFTT05fQ0hFQ0tTX0ZBSUxFRCA9IDQ7XG4gIHN0YXRpYyBSRUFTT05fRElGRkVSRU5UX1dPUktTUEFDRVMgPSA1O1xuICBzdGF0aWMgUkVBU09OX1NIQURPV19QQVJFTlQgPSA2O1xuICBzdGF0aWMgUkVBU09OX0RSQUdfQ0hFQ0tTX0ZBSUxFRCA9IDc7XG4gIHN0YXRpYyBSRUFTT05fUFJFVklPVVNfQU5EX09VVFBVVCA9IDg7XG5cbiAgcHJvdGVjdGVkIHNvdXJjZUJsb2NrXzogQmxvY2s7XG5cbiAgLyoqIENvbm5lY3Rpb24gdGhpcyBjb25uZWN0aW9uIGNvbm5lY3RzIHRvLiAgTnVsbCBpZiBub3QgY29ubmVjdGVkLiAqL1xuICB0YXJnZXRDb25uZWN0aW9uOiBDb25uZWN0aW9ufG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBIYXMgdGhpcyBjb25uZWN0aW9uIGJlZW4gZGlzcG9zZWQgb2Y/XG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZWQgPSBmYWxzZTtcblxuICAvKiogTGlzdCBvZiBjb21wYXRpYmxlIHZhbHVlIHR5cGVzLiAgTnVsbCBpZiBhbGwgdHlwZXMgYXJlIGNvbXBhdGlibGUuICovXG4gIHByaXZhdGUgY2hlY2tfOiBzdHJpbmdbXXxudWxsID0gbnVsbDtcblxuICAvKiogRE9NIHJlcHJlc2VudGF0aW9uIG9mIGEgc2hhZG93IGJsb2NrLCBvciBudWxsIGlmIG5vbmUuICovXG4gIHByaXZhdGUgc2hhZG93RG9tXzogRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogSG9yaXpvbnRhbCBsb2NhdGlvbiBvZiB0aGlzIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgeCA9IDA7XG5cbiAgLyoqXG4gICAqIFZlcnRpY2FsIGxvY2F0aW9uIG9mIHRoaXMgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICB5ID0gMDtcblxuICBwcml2YXRlIHNoYWRvd1N0YXRlXzogYmxvY2tzLlN0YXRlfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gc291cmNlIFRoZSBibG9jayBlc3RhYmxpc2hpbmcgdGhpcyBjb25uZWN0aW9uLlxuICAgKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgY29ubmVjdGlvbi5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHNvdXJjZTogQmxvY2ssIHB1YmxpYyB0eXBlOiBudW1iZXIpIHtcbiAgICB0aGlzLnNvdXJjZUJsb2NrXyA9IHNvdXJjZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25uZWN0IHR3byBjb25uZWN0aW9ucyB0b2dldGhlci4gIFRoaXMgaXMgdGhlIGNvbm5lY3Rpb24gb24gdGhlIHN1cGVyaW9yXG4gICAqIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gY2hpbGRDb25uZWN0aW9uIENvbm5lY3Rpb24gb24gaW5mZXJpb3IgYmxvY2suXG4gICAqL1xuICBwcm90ZWN0ZWQgY29ubmVjdF8oY2hpbGRDb25uZWN0aW9uOiBDb25uZWN0aW9uKSB7XG4gICAgY29uc3QgSU5QVVQgPSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRTtcbiAgICBjb25zdCBwYXJlbnRCbG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBjb25zdCBjaGlsZEJsb2NrID0gY2hpbGRDb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCk7XG5cbiAgICAvLyBNYWtlIHN1cmUgdGhlIGNoaWxkQ29ubmVjdGlvbiBpcyBhdmFpbGFibGUuXG4gICAgaWYgKGNoaWxkQ29ubmVjdGlvbi5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICBjaGlsZENvbm5lY3Rpb24uZGlzY29ubmVjdCgpO1xuICAgIH1cblxuICAgIC8vIE1ha2Ugc3VyZSB0aGUgcGFyZW50Q29ubmVjdGlvbiBpcyBhdmFpbGFibGUuXG4gICAgbGV0IG9ycGhhbjtcbiAgICBpZiAodGhpcy5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICBjb25zdCBzaGFkb3dTdGF0ZSA9IHRoaXMuc3Rhc2hTaGFkb3dTdGF0ZV8oKTtcbiAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMudGFyZ2V0QmxvY2soKTtcbiAgICAgIGlmICh0YXJnZXQhLmlzU2hhZG93KCkpIHtcbiAgICAgICAgdGFyZ2V0IS5kaXNwb3NlKGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGlzY29ubmVjdCgpO1xuICAgICAgICBvcnBoYW4gPSB0YXJnZXQ7XG4gICAgICB9XG4gICAgICB0aGlzLmFwcGx5U2hhZG93U3RhdGVfKHNoYWRvd1N0YXRlKTtcbiAgICB9XG5cbiAgICAvLyBDb25uZWN0IHRoZSBuZXcgY29ubmVjdGlvbiB0byB0aGUgcGFyZW50LlxuICAgIGxldCBldmVudDtcbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgZXZlbnQgPVxuICAgICAgICAgIG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19NT1ZFKSkoY2hpbGRCbG9jaykgYXMgQmxvY2tNb3ZlO1xuICAgIH1cbiAgICBjb25uZWN0UmVjaXByb2NhbGx5KHRoaXMsIGNoaWxkQ29ubmVjdGlvbik7XG4gICAgY2hpbGRCbG9jay5zZXRQYXJlbnQocGFyZW50QmxvY2spO1xuICAgIGlmIChldmVudCkge1xuICAgICAgZXZlbnQucmVjb3JkTmV3KCk7XG4gICAgICBldmVudFV0aWxzLmZpcmUoZXZlbnQpO1xuICAgIH1cblxuICAgIC8vIERlYWwgd2l0aCB0aGUgb3JwaGFuIGlmIGl0IGV4aXN0cy5cbiAgICBpZiAob3JwaGFuKSB7XG4gICAgICBjb25zdCBvcnBoYW5Db25uZWN0aW9uID0gdGhpcy50eXBlID09PSBJTlBVVCA/IG9ycGhhbi5vdXRwdXRDb25uZWN0aW9uIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JwaGFuLnByZXZpb3VzQ29ubmVjdGlvbjtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBDb25uZWN0aW9uLmdldENvbm5lY3Rpb25Gb3JPcnBoYW5lZENvbm5lY3Rpb24oXG4gICAgICAgICAgY2hpbGRCbG9jaywgKG9ycGhhbkNvbm5lY3Rpb24pKTtcbiAgICAgIGlmIChjb25uZWN0aW9uKSB7XG4gICAgICAgIG9ycGhhbkNvbm5lY3Rpb24uY29ubmVjdChjb25uZWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9ycGhhbkNvbm5lY3Rpb24ub25GYWlsZWRDb25uZWN0KHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIHRoaXMgY29ubmVjdGlvbiBhbmQgZGVhbCB3aXRoIGNvbm5lY3RlZCBibG9ja3MuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICAvLyBpc0Nvbm5lY3RlZCByZXR1cm5zIHRydWUgZm9yIHNoYWRvd3MgYW5kIG5vbi1zaGFkb3dzLlxuICAgIGlmICh0aGlzLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgIC8vIERlc3Ryb3kgdGhlIGF0dGFjaGVkIHNoYWRvdyBibG9jayAmIGl0cyBjaGlsZHJlbiAoaWYgaXQgZXhpc3RzKS5cbiAgICAgIHRoaXMuc2V0U2hhZG93U3RhdGVJbnRlcm5hbF8oKTtcblxuICAgICAgY29uc3QgdGFyZ2V0QmxvY2sgPSB0aGlzLnRhcmdldEJsb2NrKCk7XG4gICAgICBpZiAodGFyZ2V0QmxvY2spIHtcbiAgICAgICAgLy8gRGlzY29ubmVjdCB0aGUgYXR0YWNoZWQgbm9ybWFsIGJsb2NrLlxuICAgICAgICB0YXJnZXRCbG9jay51bnBsdWcoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmRpc3Bvc2VkID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHNvdXJjZSBibG9jayBmb3IgdGhpcyBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgc291cmNlIGJsb2NrLlxuICAgKi9cbiAgZ2V0U291cmNlQmxvY2soKTogQmxvY2sge1xuICAgIHJldHVybiB0aGlzLnNvdXJjZUJsb2NrXztcbiAgfVxuXG4gIC8qKlxuICAgKiBEb2VzIHRoZSBjb25uZWN0aW9uIGJlbG9uZyB0byBhIHN1cGVyaW9yIGJsb2NrIChoaWdoZXIgaW4gdGhlIHNvdXJjZVxuICAgKiBzdGFjayk/XG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgY29ubmVjdGlvbiBmYWNlcyBkb3duIG9yIHJpZ2h0LlxuICAgKi9cbiAgaXNTdXBlcmlvcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRSB8fFxuICAgICAgICB0aGlzLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLk5FWFRfU1RBVEVNRU5UO1xuICB9XG5cbiAgLyoqXG4gICAqIElzIHRoZSBjb25uZWN0aW9uIGNvbm5lY3RlZD9cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBjb25uZWN0aW9uIGlzIGNvbm5lY3RlZCB0byBhbm90aGVyIGNvbm5lY3Rpb24uXG4gICAqL1xuICBpc0Nvbm5lY3RlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLnRhcmdldENvbm5lY3Rpb247XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB3b3Jrc3BhY2UncyBjb25uZWN0aW9uIHR5cGUgY2hlY2tlciBvYmplY3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb25uZWN0aW9uIHR5cGUgY2hlY2tlciBmb3IgdGhlIHNvdXJjZSBibG9jaydzIHdvcmtzcGFjZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRDb25uZWN0aW9uQ2hlY2tlcigpOiBJQ29ubmVjdGlvbkNoZWNrZXIge1xuICAgIHJldHVybiB0aGlzLnNvdXJjZUJsb2NrXy53b3Jrc3BhY2UuY29ubmVjdGlvbkNoZWNrZXI7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gYW4gYXR0ZW1wdGVkIGNvbm5lY3Rpb24gZmFpbHMuIE5PUCBieSBkZWZhdWx0IChpLmUuIGZvclxuICAgKiBoZWFkbGVzcyB3b3Jrc3BhY2VzKS5cbiAgICpcbiAgICogQHBhcmFtIF9vdGhlckNvbm5lY3Rpb24gQ29ubmVjdGlvbiB0aGF0IHRoaXMgY29ubmVjdGlvbiBmYWlsZWQgdG8gY29ubmVjdFxuICAgKiAgICAgdG8uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb25GYWlsZWRDb25uZWN0KF9vdGhlckNvbm5lY3Rpb246IENvbm5lY3Rpb24pIHt9XG4gIC8vIE5PUFxuXG4gIC8qKlxuICAgKiBDb25uZWN0IHRoaXMgY29ubmVjdGlvbiB0byBhbm90aGVyIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBvdGhlckNvbm5lY3Rpb24gQ29ubmVjdGlvbiB0byBjb25uZWN0IHRvLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSB0aGUgYmxvY2tzIGFyZSBub3cgY29ubmVjdGVkIG9yIG5vdC5cbiAgICovXG4gIGNvbm5lY3Qob3RoZXJDb25uZWN0aW9uOiBDb25uZWN0aW9uKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMudGFyZ2V0Q29ubmVjdGlvbiA9PT0gb3RoZXJDb25uZWN0aW9uKSB7XG4gICAgICAvLyBBbHJlYWR5IGNvbm5lY3RlZCB0b2dldGhlci4gIE5PUC5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IGNoZWNrZXIgPSB0aGlzLmdldENvbm5lY3Rpb25DaGVja2VyKCk7XG4gICAgaWYgKGNoZWNrZXIuY2FuQ29ubmVjdCh0aGlzLCBvdGhlckNvbm5lY3Rpb24sIGZhbHNlKSkge1xuICAgICAgY29uc3QgZXZlbnRHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgIGlmICghZXZlbnRHcm91cCkge1xuICAgICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgICAgfVxuICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGJsb2NrIGlzIHN1cGVyaW9yIChoaWdoZXIgaW4gdGhlIHNvdXJjZSBzdGFjaykuXG4gICAgICBpZiAodGhpcy5pc1N1cGVyaW9yKCkpIHtcbiAgICAgICAgLy8gU3VwZXJpb3IgYmxvY2suXG4gICAgICAgIHRoaXMuY29ubmVjdF8ob3RoZXJDb25uZWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEluZmVyaW9yIGJsb2NrLlxuICAgICAgICBvdGhlckNvbm5lY3Rpb24uY29ubmVjdF8odGhpcyk7XG4gICAgICB9XG4gICAgICBpZiAoIWV2ZW50R3JvdXApIHtcbiAgICAgICAgZXZlbnRVdGlscy5zZXRHcm91cChmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXNDb25uZWN0ZWQoKTtcbiAgfVxuXG4gIC8qKiBEaXNjb25uZWN0IHRoaXMgY29ubmVjdGlvbi4gKi9cbiAgZGlzY29ubmVjdCgpIHtcbiAgICBjb25zdCBvdGhlckNvbm5lY3Rpb24gPSB0aGlzLnRhcmdldENvbm5lY3Rpb247XG4gICAgaWYgKCFvdGhlckNvbm5lY3Rpb24pIHtcbiAgICAgIHRocm93IEVycm9yKCdTb3VyY2UgY29ubmVjdGlvbiBub3QgY29ubmVjdGVkLicpO1xuICAgIH1cbiAgICBpZiAob3RoZXJDb25uZWN0aW9uLnRhcmdldENvbm5lY3Rpb24gIT09IHRoaXMpIHtcbiAgICAgIHRocm93IEVycm9yKCdUYXJnZXQgY29ubmVjdGlvbiBub3QgY29ubmVjdGVkIHRvIHNvdXJjZSBjb25uZWN0aW9uLicpO1xuICAgIH1cbiAgICBsZXQgcGFyZW50QmxvY2s7XG4gICAgbGV0IGNoaWxkQmxvY2s7XG4gICAgbGV0IHBhcmVudENvbm5lY3Rpb247XG4gICAgaWYgKHRoaXMuaXNTdXBlcmlvcigpKSB7XG4gICAgICAvLyBTdXBlcmlvciBibG9jay5cbiAgICAgIHBhcmVudEJsb2NrID0gdGhpcy5zb3VyY2VCbG9ja187XG4gICAgICBjaGlsZEJsb2NrID0gb3RoZXJDb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXMgKi9cbiAgICAgIHBhcmVudENvbm5lY3Rpb24gPSB0aGlzO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJbmZlcmlvciBibG9jay5cbiAgICAgIHBhcmVudEJsb2NrID0gb3RoZXJDb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgICBjaGlsZEJsb2NrID0gdGhpcy5zb3VyY2VCbG9ja187XG4gICAgICBwYXJlbnRDb25uZWN0aW9uID0gb3RoZXJDb25uZWN0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0IGV2ZW50R3JvdXAgPSBldmVudFV0aWxzLmdldEdyb3VwKCk7XG4gICAgaWYgKCFldmVudEdyb3VwKSB7XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgIH1cbiAgICB0aGlzLmRpc2Nvbm5lY3RJbnRlcm5hbF8ocGFyZW50QmxvY2ssIGNoaWxkQmxvY2spO1xuICAgIGlmICghY2hpbGRCbG9jay5pc1NoYWRvdygpKSB7XG4gICAgICAvLyBJZiB3ZSB3ZXJlIGRpc2Nvbm5lY3RpbmcgYSBzaGFkb3csIG5vIG5lZWQgdG8gc3Bhd24gYSBuZXcgb25lLlxuICAgICAgcGFyZW50Q29ubmVjdGlvbi5yZXNwYXduU2hhZG93XygpO1xuICAgIH1cbiAgICBpZiAoIWV2ZW50R3JvdXApIHtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNjb25uZWN0IHR3byBibG9ja3MgdGhhdCBhcmUgY29ubmVjdGVkIGJ5IHRoaXMgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHBhcmVudEJsb2NrIFRoZSBzdXBlcmlvciBibG9jay5cbiAgICogQHBhcmFtIGNoaWxkQmxvY2sgVGhlIGluZmVyaW9yIGJsb2NrLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRpc2Nvbm5lY3RJbnRlcm5hbF8ocGFyZW50QmxvY2s6IEJsb2NrLCBjaGlsZEJsb2NrOiBCbG9jaykge1xuICAgIGxldCBldmVudDtcbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgZXZlbnQgPVxuICAgICAgICAgIG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19NT1ZFKSkoY2hpbGRCbG9jaykgYXMgQmxvY2tNb3ZlO1xuICAgIH1cbiAgICBjb25zdCBvdGhlckNvbm5lY3Rpb24gPSB0aGlzLnRhcmdldENvbm5lY3Rpb247XG4gICAgaWYgKG90aGVyQ29ubmVjdGlvbikge1xuICAgICAgb3RoZXJDb25uZWN0aW9uLnRhcmdldENvbm5lY3Rpb24gPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnRhcmdldENvbm5lY3Rpb24gPSBudWxsO1xuICAgIGNoaWxkQmxvY2suc2V0UGFyZW50KG51bGwpO1xuICAgIGlmIChldmVudCkge1xuICAgICAgZXZlbnQucmVjb3JkTmV3KCk7XG4gICAgICBldmVudFV0aWxzLmZpcmUoZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNwYXduIHRoZSBzaGFkb3cgYmxvY2sgaWYgdGhlcmUgd2FzIG9uZSBjb25uZWN0ZWQgdG8gdGhlIHRoaXMgY29ubmVjdGlvbi5cbiAgICovXG4gIHByb3RlY3RlZCByZXNwYXduU2hhZG93XygpIHtcbiAgICAvLyBIYXZlIHRvIGtlZXAgcmVzcGF3blNoYWRvd18gZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LlxuICAgIHRoaXMuY3JlYXRlU2hhZG93QmxvY2tfKHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGJsb2NrIHRoYXQgdGhpcyBjb25uZWN0aW9uIGNvbm5lY3RzIHRvLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY29ubmVjdGVkIGJsb2NrIG9yIG51bGwgaWYgbm9uZSBpcyBjb25uZWN0ZWQuXG4gICAqL1xuICB0YXJnZXRCbG9jaygpOiBCbG9ja3xudWxsIHtcbiAgICBpZiAodGhpcy5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICByZXR1cm4gdGhpcy50YXJnZXRDb25uZWN0aW9uPy5nZXRTb3VyY2VCbG9jaygpID8/IG51bGw7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoaXMgY29ubmVjdGlvbidzIGNvbXBhdGlibGUgdHlwZXMgaGF2ZSBjaGFuZ2VkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG9uQ2hlY2tDaGFuZ2VkXygpIHtcbiAgICAvLyBUaGUgbmV3IHZhbHVlIHR5cGUgbWF5IG5vdCBiZSBjb21wYXRpYmxlIHdpdGggdGhlIGV4aXN0aW5nIGNvbm5lY3Rpb24uXG4gICAgaWYgKHRoaXMuaXNDb25uZWN0ZWQoKSAmJlxuICAgICAgICAoIXRoaXMudGFyZ2V0Q29ubmVjdGlvbiB8fFxuICAgICAgICAgIXRoaXMuZ2V0Q29ubmVjdGlvbkNoZWNrZXIoKS5jYW5Db25uZWN0KFxuICAgICAgICAgICAgIHRoaXMsIHRoaXMudGFyZ2V0Q29ubmVjdGlvbiwgZmFsc2UpKSkge1xuICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmlzU3VwZXJpb3IoKSA/IHRoaXMudGFyZ2V0QmxvY2soKSA6IHRoaXMuc291cmNlQmxvY2tfO1xuICAgICAgY2hpbGQhLnVucGx1ZygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgYSBjb25uZWN0aW9uJ3MgY29tcGF0aWJpbGl0eS5cbiAgICpcbiAgICogQHBhcmFtIGNoZWNrIENvbXBhdGlibGUgdmFsdWUgdHlwZSBvciBsaXN0IG9mIHZhbHVlIHR5cGVzLiBOdWxsIGlmIGFsbFxuICAgKiAgICAgdHlwZXMgYXJlIGNvbXBhdGlibGUuXG4gICAqIEByZXR1cm5zIFRoZSBjb25uZWN0aW9uIGJlaW5nIG1vZGlmaWVkICh0byBhbGxvdyBjaGFpbmluZykuXG4gICAqL1xuICBzZXRDaGVjayhjaGVjazogc3RyaW5nfHN0cmluZ1tdfG51bGwpOiBDb25uZWN0aW9uIHtcbiAgICBpZiAoY2hlY2spIHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShjaGVjaykpIHtcbiAgICAgICAgY2hlY2sgPSBbY2hlY2tdO1xuICAgICAgfVxuICAgICAgdGhpcy5jaGVja18gPSBjaGVjaztcbiAgICAgIHRoaXMub25DaGVja0NoYW5nZWRfKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hlY2tfID0gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgY29ubmVjdGlvbidzIGNvbXBhdGliaWxpdHkuXG4gICAqXG4gICAqIEByZXR1cm5zIExpc3Qgb2YgY29tcGF0aWJsZSB2YWx1ZSB0eXBlcy5cbiAgICogICAgIE51bGwgaWYgYWxsIHR5cGVzIGFyZSBjb21wYXRpYmxlLlxuICAgKi9cbiAgZ2V0Q2hlY2soKTogc3RyaW5nW118bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY2hlY2tfO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZXMgdGhlIGNvbm5lY3Rpb24ncyBzaGFkb3cgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBzaGFkb3dEb20gRE9NIHJlcHJlc2VudGF0aW9uIG9mIGEgYmxvY2sgb3IgbnVsbC5cbiAgICovXG4gIHNldFNoYWRvd0RvbShzaGFkb3dEb206IEVsZW1lbnR8bnVsbCkge1xuICAgIHRoaXMuc2V0U2hhZG93U3RhdGVJbnRlcm5hbF8oe3NoYWRvd0RvbX0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHhtbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY29ubmVjdGlvbidzIHNoYWRvdyBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIHJldHVybkN1cnJlbnQgSWYgdHJ1ZSwgYW5kIHRoZSBzaGFkb3cgYmxvY2sgaXMgY3VycmVudGx5IGF0dGFjaGVkIHRvXG4gICAqICAgICB0aGlzIGNvbm5lY3Rpb24sIHRoaXMgc2VyaWFsaXplcyB0aGUgc3RhdGUgb2YgdGhhdCBibG9jayBhbmQgcmV0dXJucyBpdFxuICAgKiAgICAgKHNvIHRoYXQgZmllbGQgdmFsdWVzIGFyZSBjb3JyZWN0KS4gT3RoZXJ3aXNlIHRoZSBzYXZlZCBzaGFkb3dEb20gaXNcbiAgICogICAgIGp1c3QgcmV0dXJuZWQuXG4gICAqIEByZXR1cm5zIFNoYWRvdyBET00gcmVwcmVzZW50YXRpb24gb2YgYSBibG9jayBvciBudWxsLlxuICAgKi9cbiAgZ2V0U2hhZG93RG9tKHJldHVybkN1cnJlbnQ/OiBib29sZWFuKTogRWxlbWVudHxudWxsIHtcbiAgICByZXR1cm4gcmV0dXJuQ3VycmVudCAmJiB0aGlzLnRhcmdldEJsb2NrKCkhLmlzU2hhZG93KCkgP1xuICAgICAgICBYbWwuYmxvY2tUb0RvbSgodGhpcy50YXJnZXRCbG9jaygpIGFzIEJsb2NrKSkgYXMgRWxlbWVudCA6XG4gICAgICAgIHRoaXMuc2hhZG93RG9tXztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2VzIHRoZSBjb25uZWN0aW9uJ3Mgc2hhZG93IGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gc2hhZG93U3RhdGUgQW4gc3RhdGUgcmVwcmVzZXRhdGlvbiBvZiB0aGUgYmxvY2sgb3IgbnVsbC5cbiAgICovXG4gIHNldFNoYWRvd1N0YXRlKHNoYWRvd1N0YXRlOiBibG9ja3MuU3RhdGV8bnVsbCkge1xuICAgIHRoaXMuc2V0U2hhZG93U3RhdGVJbnRlcm5hbF8oe3NoYWRvd1N0YXRlfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgc2VyaWFsaXplZCBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbm5lY3Rpb24ncyBzaGFkb3dcbiAgICogYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSByZXR1cm5DdXJyZW50IElmIHRydWUsIGFuZCB0aGUgc2hhZG93IGJsb2NrIGlzIGN1cnJlbnRseSBhdHRhY2hlZCB0b1xuICAgKiAgICAgdGhpcyBjb25uZWN0aW9uLCB0aGlzIHNlcmlhbGl6ZXMgdGhlIHN0YXRlIG9mIHRoYXQgYmxvY2sgYW5kIHJldHVybnMgaXRcbiAgICogICAgIChzbyB0aGF0IGZpZWxkIHZhbHVlcyBhcmUgY29ycmVjdCkuIE90aGVyd2lzZSB0aGUgc2F2ZWQgc3RhdGUgaXMganVzdFxuICAgKiAgICAgcmV0dXJuZWQuXG4gICAqIEByZXR1cm5zIFNlcmlhbGl6ZWQgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBibG9jaywgb3IgbnVsbC5cbiAgICovXG4gIGdldFNoYWRvd1N0YXRlKHJldHVybkN1cnJlbnQ/OiBib29sZWFuKTogYmxvY2tzLlN0YXRlfG51bGwge1xuICAgIGlmIChyZXR1cm5DdXJyZW50ICYmIHRoaXMudGFyZ2V0QmxvY2soKSAmJiB0aGlzLnRhcmdldEJsb2NrKCkhLmlzU2hhZG93KCkpIHtcbiAgICAgIHJldHVybiBibG9ja3Muc2F2ZSh0aGlzLnRhcmdldEJsb2NrKCkgYXMgQmxvY2spO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zaGFkb3dTdGF0ZV87XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbGwgbmVhcmJ5IGNvbXBhdGlibGUgY29ubmVjdGlvbnMgdG8gdGhpcyBjb25uZWN0aW9uLlxuICAgKiBUeXBlIGNoZWNraW5nIGRvZXMgbm90IGFwcGx5LCBzaW5jZSB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgZm9yIGJ1bXBpbmcuXG4gICAqXG4gICAqIEhlYWRsZXNzIGNvbmZpZ3VyYXRpb25zICh0aGUgZGVmYXVsdCkgZG8gbm90IGhhdmUgbmVpZ2hib3JpbmcgY29ubmVjdGlvbixcbiAgICogYW5kIGFsd2F5cyByZXR1cm4gYW4gZW1wdHkgbGlzdCAodGhlIGRlZmF1bHQpLlxuICAgKiB7QGxpbmsgUmVuZGVyZWRDb25uZWN0aW9uI25laWdoYm91cnN9IG92ZXJyaWRlcyB0aGlzIGJlaGF2aW9yIHdpdGggYSBsaXN0XG4gICAqIGNvbXB1dGVkIGZyb20gdGhlIHJlbmRlcmVkIHBvc2l0aW9uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0gX21heExpbWl0IFRoZSBtYXhpbXVtIHJhZGl1cyB0byBhbm90aGVyIGNvbm5lY3Rpb24uXG4gICAqIEByZXR1cm5zIExpc3Qgb2YgY29ubmVjdGlvbnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbmVpZ2hib3VycyhfbWF4TGltaXQ6IG51bWJlcik6IENvbm5lY3Rpb25bXSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcGFyZW50IGlucHV0IG9mIGEgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGlucHV0IHRoYXQgdGhlIGNvbm5lY3Rpb24gYmVsb25ncyB0byBvciBudWxsIGlmIG5vIHBhcmVudFxuICAgKiAgICAgZXhpc3RzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFBhcmVudElucHV0KCk6IElucHV0fG51bGwge1xuICAgIGxldCBwYXJlbnRJbnB1dCA9IG51bGw7XG4gICAgY29uc3QgaW5wdXRzID0gdGhpcy5zb3VyY2VCbG9ja18uaW5wdXRMaXN0O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoaW5wdXRzW2ldLmNvbm5lY3Rpb24gPT09IHRoaXMpIHtcbiAgICAgICAgcGFyZW50SW5wdXQgPSBpbnB1dHNbaV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGFyZW50SW5wdXQ7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyBkZXNjcmliaW5nIHRoaXMgQ29ubmVjdGlvbiBpbiBkZXZlbG9wZXIgdGVybXNcbiAgICogKEVuZ2xpc2ggb25seSkuIEludGVuZGVkIHRvIG9uIGJlIHVzZWQgaW4gY29uc29sZSBsb2dzIGFuZCBlcnJvcnMuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBkZXNjcmlwdGlvbi5cbiAgICovXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLnNvdXJjZUJsb2NrXztcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICByZXR1cm4gJ09ycGhhbiBDb25uZWN0aW9uJztcbiAgICB9XG4gICAgbGV0IG1zZztcbiAgICBpZiAoYmxvY2sub3V0cHV0Q29ubmVjdGlvbiA9PT0gdGhpcykge1xuICAgICAgbXNnID0gJ091dHB1dCBDb25uZWN0aW9uIG9mICc7XG4gICAgfSBlbHNlIGlmIChibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24gPT09IHRoaXMpIHtcbiAgICAgIG1zZyA9ICdQcmV2aW91cyBDb25uZWN0aW9uIG9mICc7XG4gICAgfSBlbHNlIGlmIChibG9jay5uZXh0Q29ubmVjdGlvbiA9PT0gdGhpcykge1xuICAgICAgbXNnID0gJ05leHQgQ29ubmVjdGlvbiBvZiAnO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgcGFyZW50SW5wdXQgPSBudWxsO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGlucHV0OyBpbnB1dCA9IGJsb2NrLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICAgIGlmIChpbnB1dC5jb25uZWN0aW9uID09PSB0aGlzKSB7XG4gICAgICAgICAgcGFyZW50SW5wdXQgPSBpbnB1dDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBhcmVudElucHV0KSB7XG4gICAgICAgIG1zZyA9ICdJbnB1dCBcIicgKyBwYXJlbnRJbnB1dC5uYW1lICsgJ1wiIGNvbm5lY3Rpb24gb24gJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUud2FybignQ29ubmVjdGlvbiBub3QgYWN0dWFsbHkgY29ubmVjdGVkIHRvIHNvdXJjZUJsb2NrXycpO1xuICAgICAgICByZXR1cm4gJ09ycGhhbiBDb25uZWN0aW9uJztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1zZyArIGJsb2NrLnRvRGV2U3RyaW5nKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgc3RhdGUgb2YgdGhlIHNoYWRvd0RvbV8gYW5kIHNoYWRvd1N0YXRlXyBwcm9wZXJ0aWVzLCB0aGVuXG4gICAqIHRlbXBvcmFyaWx5IHNldHMgdGhvc2UgcHJvcGVydGllcyB0byBudWxsIHNvIG5vIHNoYWRvdyByZXNwYXducy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHN0YXRlIG9mIGJvdGggdGhlIHNoYWRvd0RvbV8gYW5kIHNoYWRvd1N0YXRlXyBwcm9wZXJ0aWVzLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGFzaFNoYWRvd1N0YXRlXygpOlxuICAgICAge3NoYWRvd0RvbTogRWxlbWVudHxudWxsLCBzaGFkb3dTdGF0ZTogYmxvY2tzLlN0YXRlfG51bGx9IHtcbiAgICBjb25zdCBzaGFkb3dEb20gPSB0aGlzLmdldFNoYWRvd0RvbSh0cnVlKTtcbiAgICBjb25zdCBzaGFkb3dTdGF0ZSA9IHRoaXMuZ2V0U2hhZG93U3RhdGUodHJ1ZSk7XG4gICAgLy8gU2V0IHRvIG51bGwgc28gaXQgZG9lc24ndCByZXNwYXduLlxuICAgIHRoaXMuc2hhZG93RG9tXyA9IG51bGw7XG4gICAgdGhpcy5zaGFkb3dTdGF0ZV8gPSBudWxsO1xuICAgIHJldHVybiB7c2hhZG93RG9tLCBzaGFkb3dTdGF0ZX07XG4gIH1cblxuICAvKipcbiAgICogUmVhcHBsaWVzIHRoZSBzdGFzaGVkIHN0YXRlIG9mIHRoZSBzaGFkb3dEb21fIGFuZCBzaGFkb3dTdGF0ZV8gcHJvcGVydGllcy5cbiAgICpcbiAgICogQHBhcmFtIHBhcmFtMCBUaGUgc3RhdGUgdG8gcmVhcHBseSB0byB0aGUgc2hhZG93RG9tXyBhbmQgc2hhZG93U3RhdGVfXG4gICAqICAgICBwcm9wZXJ0aWVzLlxuICAgKi9cbiAgcHJpdmF0ZSBhcHBseVNoYWRvd1N0YXRlXyh7c2hhZG93RG9tLCBzaGFkb3dTdGF0ZX06IHtcbiAgICBzaGFkb3dEb206IEVsZW1lbnR8bnVsbCxcbiAgICBzaGFkb3dTdGF0ZTogYmxvY2tzLlN0YXRlfG51bGxcbiAgfSkge1xuICAgIHRoaXMuc2hhZG93RG9tXyA9IHNoYWRvd0RvbTtcbiAgICB0aGlzLnNoYWRvd1N0YXRlXyA9IHNoYWRvd1N0YXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHN0YXRlIG9mIHRoZSBzaGFkb3cgb2YgdGhpcyBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gcGFyYW0wIFRoZSBzdGF0ZSB0byBzZXQgdGhlIHNoYWRvdyBvZiB0aGlzIGNvbm5lY3Rpb24gdG8uXG4gICAqL1xuICBwcml2YXRlIHNldFNoYWRvd1N0YXRlSW50ZXJuYWxfKHtzaGFkb3dEb20gPSBudWxsLCBzaGFkb3dTdGF0ZSA9IG51bGx9OiB7XG4gICAgc2hhZG93RG9tPzogRWxlbWVudHxudWxsLFxuICAgIHNoYWRvd1N0YXRlPzogYmxvY2tzLlN0YXRlfG51bGxcbiAgfSA9IHt9KSB7XG4gICAgLy8gT25lIG9yIGJvdGggb2YgdGhlc2Ugc2hvdWxkIGFsd2F5cyBiZSBudWxsLlxuICAgIC8vIElmIG5laXRoZXIgaXMgbnVsbCwgdGhlIHNoYWRvd1N0YXRlIHdpbGwgZ2V0IHByaW9yaXR5LlxuICAgIHRoaXMuc2hhZG93RG9tXyA9IHNoYWRvd0RvbTtcbiAgICB0aGlzLnNoYWRvd1N0YXRlXyA9IHNoYWRvd1N0YXRlO1xuXG4gICAgY29uc3QgdGFyZ2V0ID0gdGhpcy50YXJnZXRCbG9jaygpO1xuICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICB0aGlzLnJlc3Bhd25TaGFkb3dfKCk7XG4gICAgICBpZiAodGhpcy50YXJnZXRCbG9jaygpICYmIHRoaXMudGFyZ2V0QmxvY2soKSEuaXNTaGFkb3coKSkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZVNoYWRvd18odGhpcy50YXJnZXRCbG9jaygpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRhcmdldC5pc1NoYWRvdygpKSB7XG4gICAgICB0YXJnZXQuZGlzcG9zZShmYWxzZSk7XG4gICAgICB0aGlzLnJlc3Bhd25TaGFkb3dfKCk7XG4gICAgICBpZiAodGhpcy50YXJnZXRCbG9jaygpICYmIHRoaXMudGFyZ2V0QmxvY2soKSEuaXNTaGFkb3coKSkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZVNoYWRvd18odGhpcy50YXJnZXRCbG9jaygpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc2hhZG93ID0gdGhpcy5jcmVhdGVTaGFkb3dCbG9ja18oZmFsc2UpO1xuICAgICAgdGhpcy5zZXJpYWxpemVTaGFkb3dfKHNoYWRvdyk7XG4gICAgICBpZiAoc2hhZG93KSB7XG4gICAgICAgIHNoYWRvdy5kaXNwb3NlKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIHNoYWRvdyBibG9jayBiYXNlZCBvbiB0aGUgY3VycmVudCBzaGFkb3dTdGF0ZV8gb3Igc2hhZG93RG9tXy5cbiAgICogc2hhZG93U3RhdGVfIGdldHMgcHJpb3JpdHkuXG4gICAqXG4gICAqIEBwYXJhbSBhdHRlbXB0VG9Db25uZWN0IFdoZXRoZXIgdG8gdHJ5IHRvIGNvbm5lY3QgdGhlIHNoYWRvdyBibG9jayB0byB0aGlzXG4gICAqICAgICBjb25uZWN0aW9uIG9yIG5vdC5cbiAgICogQHJldHVybnMgVGhlIHNoYWRvdyBibG9jayB0aGF0IHdhcyBjcmVhdGVkLCBvciBudWxsIGlmIGJvdGggdGhlXG4gICAqICAgICBzaGFkb3dTdGF0ZV8gYW5kIHNoYWRvd0RvbV8gYXJlIG51bGwuXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZVNoYWRvd0Jsb2NrXyhhdHRlbXB0VG9Db25uZWN0OiBib29sZWFuKTogQmxvY2t8bnVsbCB7XG4gICAgY29uc3QgcGFyZW50QmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgY29uc3Qgc2hhZG93U3RhdGUgPSB0aGlzLmdldFNoYWRvd1N0YXRlKCk7XG4gICAgY29uc3Qgc2hhZG93RG9tID0gdGhpcy5nZXRTaGFkb3dEb20oKTtcbiAgICBpZiAocGFyZW50QmxvY2suaXNEZWFkT3JEeWluZygpIHx8ICFzaGFkb3dTdGF0ZSAmJiAhc2hhZG93RG9tKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBsZXQgYmxvY2tTaGFkb3c7XG4gICAgaWYgKHNoYWRvd1N0YXRlKSB7XG4gICAgICBibG9ja1NoYWRvdyA9IGJsb2Nrcy5hcHBlbmRJbnRlcm5hbChzaGFkb3dTdGF0ZSwgcGFyZW50QmxvY2sud29ya3NwYWNlLCB7XG4gICAgICAgIHBhcmVudENvbm5lY3Rpb246IGF0dGVtcHRUb0Nvbm5lY3QgPyB0aGlzIDogdW5kZWZpbmVkLFxuICAgICAgICBpc1NoYWRvdzogdHJ1ZSxcbiAgICAgICAgcmVjb3JkVW5kbzogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBibG9ja1NoYWRvdztcbiAgICB9XG5cbiAgICBpZiAoc2hhZG93RG9tKSB7XG4gICAgICBibG9ja1NoYWRvdyA9IFhtbC5kb21Ub0Jsb2NrKHNoYWRvd0RvbSwgcGFyZW50QmxvY2sud29ya3NwYWNlKTtcbiAgICAgIGlmIChhdHRlbXB0VG9Db25uZWN0KSB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFKSB7XG4gICAgICAgICAgaWYgKCFibG9ja1NoYWRvdy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NoYWRvdyBibG9jayBpcyBtaXNzaW5nIGFuIG91dHB1dCBjb25uZWN0aW9uJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghdGhpcy5jb25uZWN0KGJsb2NrU2hhZG93Lm91dHB1dENvbm5lY3Rpb24pKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjb25uZWN0IHNoYWRvdyBibG9jayB0byBjb25uZWN0aW9uJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQpIHtcbiAgICAgICAgICBpZiAoIWJsb2NrU2hhZG93LnByZXZpb3VzQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaGFkb3cgYmxvY2sgaXMgbWlzc2luZyBwcmV2aW91cyBjb25uZWN0aW9uJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghdGhpcy5jb25uZWN0KGJsb2NrU2hhZG93LnByZXZpb3VzQ29ubmVjdGlvbikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGNvbm5lY3Qgc2hhZG93IGJsb2NrIHRvIGNvbm5lY3Rpb24nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAnQ2Fubm90IGNvbm5lY3QgYSBzaGFkb3cgYmxvY2sgdG8gYSBwcmV2aW91cy9vdXRwdXQgY29ubmVjdGlvbicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYmxvY2tTaGFkb3c7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFNhdmVzIHRoZSBnaXZlbiBzaGFkb3cgYmxvY2sgdG8gYm90aCB0aGUgc2hhZG93RG9tXyBhbmQgc2hhZG93U3RhdGVfXG4gICAqIHByb3BlcnRpZXMsIGluIHRoZWlyIHJlc3BlY3RpdmUgc2VyaWFsaXplZCBmb3Jtcy5cbiAgICpcbiAgICogQHBhcmFtIHNoYWRvdyBUaGUgc2hhZG93IHRvIHNlcmlhbGl6ZSwgb3IgbnVsbC5cbiAgICovXG4gIHByaXZhdGUgc2VyaWFsaXplU2hhZG93XyhzaGFkb3c6IEJsb2NrfG51bGwpIHtcbiAgICBpZiAoIXNoYWRvdykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNoYWRvd0RvbV8gPSBYbWwuYmxvY2tUb0RvbShzaGFkb3cpIGFzIEVsZW1lbnQ7XG4gICAgdGhpcy5zaGFkb3dTdGF0ZV8gPSBibG9ja3Muc2F2ZShzaGFkb3cpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNvbm5lY3Rpb24gKHN0YXJ0aW5nIGF0IHRoZSBzdGFydEJsb2NrKSB3aGljaCB3aWxsIGFjY2VwdFxuICAgKiB0aGUgZ2l2ZW4gY29ubmVjdGlvbi4gVGhpcyBpbmNsdWRlcyBjb21wYXRpYmxlIGNvbm5lY3Rpb24gdHlwZXMgYW5kXG4gICAqIGNvbm5lY3Rpb24gY2hlY2tzLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhcnRCbG9jayBUaGUgYmxvY2sgb24gd2hpY2ggdG8gc3RhcnQgdGhlIHNlYXJjaC5cbiAgICogQHBhcmFtIG9ycGhhbkNvbm5lY3Rpb24gVGhlIGNvbm5lY3Rpb24gdGhhdCBpcyBsb29raW5nIGZvciBhIGhvbWUuXG4gICAqIEByZXR1cm5zIFRoZSBzdWl0YWJsZSBjb25uZWN0aW9uIHBvaW50IG9uIHRoZSBjaGFpbiBvZiBibG9ja3MsIG9yIG51bGwuXG4gICAqL1xuICBzdGF0aWMgZ2V0Q29ubmVjdGlvbkZvck9ycGhhbmVkQ29ubmVjdGlvbihcbiAgICAgIHN0YXJ0QmxvY2s6IEJsb2NrLCBvcnBoYW5Db25uZWN0aW9uOiBDb25uZWN0aW9uKTogQ29ubmVjdGlvbnxudWxsIHtcbiAgICBpZiAob3JwaGFuQ29ubmVjdGlvbi50eXBlID09PSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUUpIHtcbiAgICAgIHJldHVybiBnZXRDb25uZWN0aW9uRm9yT3JwaGFuZWRPdXRwdXQoXG4gICAgICAgICAgc3RhcnRCbG9jaywgb3JwaGFuQ29ubmVjdGlvbi5nZXRTb3VyY2VCbG9jaygpKTtcbiAgICB9XG4gICAgLy8gT3RoZXJ3aXNlIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIHN0YWNrLlxuICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBzdGFydEJsb2NrLmxhc3RDb25uZWN0aW9uSW5TdGFjayh0cnVlKTtcbiAgICBjb25zdCBjaGVja2VyID0gb3JwaGFuQ29ubmVjdGlvbi5nZXRDb25uZWN0aW9uQ2hlY2tlcigpO1xuICAgIGlmIChjb25uZWN0aW9uICYmIGNoZWNrZXIuY2FuQ29ubmVjdChvcnBoYW5Db25uZWN0aW9uLCBjb25uZWN0aW9uLCBmYWxzZSkpIHtcbiAgICAgIHJldHVybiBjb25uZWN0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIFVwZGF0ZSB0d28gY29ubmVjdGlvbnMgdG8gdGFyZ2V0IGVhY2ggb3RoZXIuXG4gKlxuICogQHBhcmFtIGZpcnN0IFRoZSBmaXJzdCBjb25uZWN0aW9uIHRvIHVwZGF0ZS5cbiAqIEBwYXJhbSBzZWNvbmQgVGhlIHNlY29uZCBjb25uZWN0aW9uIHRvIHVwZGF0ZS5cbiAqL1xuZnVuY3Rpb24gY29ubmVjdFJlY2lwcm9jYWxseShmaXJzdDogQ29ubmVjdGlvbiwgc2Vjb25kOiBDb25uZWN0aW9uKSB7XG4gIGlmICghZmlyc3QgfHwgIXNlY29uZCkge1xuICAgIHRocm93IEVycm9yKCdDYW5ub3QgY29ubmVjdCBudWxsIGNvbm5lY3Rpb25zLicpO1xuICB9XG4gIGZpcnN0LnRhcmdldENvbm5lY3Rpb24gPSBzZWNvbmQ7XG4gIHNlY29uZC50YXJnZXRDb25uZWN0aW9uID0gZmlyc3Q7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIHNpbmdsZSBjb25uZWN0aW9uIG9uIHRoZSBibG9jayB0aGF0IHdpbGwgYWNjZXB0IHRoZSBvcnBoYW5lZFxuICogYmxvY2ssIGlmIG9uZSBjYW4gYmUgZm91bmQuIElmIHRoZSBibG9jayBoYXMgbXVsdGlwbGUgY29tcGF0aWJsZSBjb25uZWN0aW9uc1xuICogKGV2ZW4gaWYgdGhleSBhcmUgZmlsbGVkKSB0aGlzIHJldHVybnMgbnVsbC4gSWYgdGhlIGJsb2NrIGhhcyBubyBjb21wYXRpYmxlXG4gKiBjb25uZWN0aW9ucywgdGhpcyByZXR1cm5zIG51bGwuXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBzdXBlcmlvciBibG9jay5cbiAqIEBwYXJhbSBvcnBoYW5CbG9jayBUaGUgaW5mZXJpb3IgYmxvY2suXG4gKiBAcmV0dXJucyBUaGUgc3VpdGFibGUgY29ubmVjdGlvbiBwb2ludCBvbiAnYmxvY2snLCBvciBudWxsLlxuICovXG5mdW5jdGlvbiBnZXRTaW5nbGVDb25uZWN0aW9uKGJsb2NrOiBCbG9jaywgb3JwaGFuQmxvY2s6IEJsb2NrKTogQ29ubmVjdGlvbnxcbiAgICBudWxsIHtcbiAgbGV0IGZvdW5kQ29ubmVjdGlvbiA9IG51bGw7XG4gIGNvbnN0IG91dHB1dCA9IG9ycGhhbkJsb2NrLm91dHB1dENvbm5lY3Rpb247XG4gIGNvbnN0IHR5cGVDaGVja2VyID0gb3V0cHV0LmdldENvbm5lY3Rpb25DaGVja2VyKCk7XG5cbiAgZm9yIChsZXQgaSA9IDAsIGlucHV0OyBpbnB1dCA9IGJsb2NrLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgY29uc3QgY29ubmVjdGlvbiA9IGlucHV0LmNvbm5lY3Rpb247XG4gICAgaWYgKGNvbm5lY3Rpb24gJiYgdHlwZUNoZWNrZXIuY2FuQ29ubmVjdChvdXRwdXQsIGNvbm5lY3Rpb24sIGZhbHNlKSkge1xuICAgICAgaWYgKGZvdW5kQ29ubmVjdGlvbikge1xuICAgICAgICByZXR1cm4gbnVsbDsgIC8vIE1vcmUgdGhhbiBvbmUgY29ubmVjdGlvbi5cbiAgICAgIH1cbiAgICAgIGZvdW5kQ29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4gICAgfVxuICB9XG4gIHJldHVybiBmb3VuZENvbm5lY3Rpb247XG59XG5cbi8qKlxuICogV2Fsa3MgZG93biBhIHJvdyBhIGJsb2NrcywgYXQgZWFjaCBzdGFnZSBjaGVja2luZyBpZiB0aGVyZSBhcmUgYW55XG4gKiBjb25uZWN0aW9ucyB0aGF0IHdpbGwgYWNjZXB0IHRoZSBvcnBoYW5lZCBibG9jay4gIElmIGF0IGFueSBwb2ludCB0aGVyZVxuICogYXJlIHplcm8gb3IgbXVsdGlwbGUgZWxpZ2libGUgY29ubmVjdGlvbnMsIHJldHVybnMgbnVsbC4gIE90aGVyd2lzZVxuICogcmV0dXJucyB0aGUgb25seSBpbnB1dCBvbiB0aGUgbGFzdCBibG9jayBpbiB0aGUgY2hhaW4uXG4gKiBUZXJtaW5hdGVzIGVhcmx5IGZvciBzaGFkb3cgYmxvY2tzLlxuICpcbiAqIEBwYXJhbSBzdGFydEJsb2NrIFRoZSBibG9jayBvbiB3aGljaCB0byBzdGFydCB0aGUgc2VhcmNoLlxuICogQHBhcmFtIG9ycGhhbkJsb2NrIFRoZSBibG9jayB0aGF0IGlzIGxvb2tpbmcgZm9yIGEgaG9tZS5cbiAqIEByZXR1cm5zIFRoZSBzdWl0YWJsZSBjb25uZWN0aW9uIHBvaW50IG9uIHRoZSBjaGFpbiBvZiBibG9ja3MsIG9yIG51bGwuXG4gKi9cbmZ1bmN0aW9uIGdldENvbm5lY3Rpb25Gb3JPcnBoYW5lZE91dHB1dChcbiAgICBzdGFydEJsb2NrOiBCbG9jaywgb3JwaGFuQmxvY2s6IEJsb2NrKTogQ29ubmVjdGlvbnxudWxsIHtcbiAgbGV0IG5ld0Jsb2NrOiBCbG9ja3xudWxsID0gc3RhcnRCbG9jaztcbiAgbGV0IGNvbm5lY3Rpb247XG4gIHdoaWxlIChjb25uZWN0aW9uID0gZ2V0U2luZ2xlQ29ubmVjdGlvbihuZXdCbG9jaywgb3JwaGFuQmxvY2spKSB7XG4gICAgbmV3QmxvY2sgPSBjb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7XG4gICAgaWYgKCFuZXdCbG9jayB8fCBuZXdCbG9jay5pc1NoYWRvdygpKSB7XG4gICAgICByZXR1cm4gY29ubmVjdGlvbjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBhbiBBU1Qgbm9kZS5cbiAqIFVzZWQgdG8gdHJhdmVyc2UgdGhlIEJsb2NrbHkgQVNULlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkFTVE5vZGUnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuLi9ibG9jay5qcyc7XG5pbXBvcnQgdHlwZSB7Q29ubmVjdGlvbn0gZnJvbSAnLi4vY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQge0Nvbm5lY3Rpb25UeXBlfSBmcm9tICcuLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuLi9maWVsZC5qcyc7XG5pbXBvcnQgdHlwZSB7SW5wdXR9IGZyb20gJy4uL2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtJQVNUTm9kZUxvY2F0aW9ufSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfYXN0X25vZGVfbG9jYXRpb24uanMnO1xuaW1wb3J0IHR5cGUge0lBU1ROb2RlTG9jYXRpb25XaXRoQmxvY2t9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9hc3Rfbm9kZV9sb2NhdGlvbl93aXRoX2Jsb2NrLmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGFuIEFTVCBub2RlLlxuICogSXQgaXMgcmVjb21tZW5kZWQgdGhhdCB5b3UgdXNlIG9uZSBvZiB0aGUgY3JlYXRlTm9kZSBtZXRob2RzIGluc3RlYWQgb2ZcbiAqIGNyZWF0aW5nIGEgbm9kZSBkaXJlY3RseS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5BU1ROb2RlXG4gKi9cbmV4cG9ydCBjbGFzcyBBU1ROb2RlIHtcbiAgLyoqXG4gICAqIFRydWUgdG8gbmF2aWdhdGUgdG8gYWxsIGZpZWxkcy4gRmFsc2UgdG8gb25seSBuYXZpZ2F0ZSB0byBjbGlja2FibGUgZmllbGRzLlxuICAgKi9cbiAgc3RhdGljIE5BVklHQVRFX0FMTF9GSUVMRFMgPSBmYWxzZTtcblxuICAvKipcbiAgICogVGhlIGRlZmF1bHQgeSBvZmZzZXQgdG8gdXNlIHdoZW4gbW92aW5nIHRoZSBjdXJzb3IgZnJvbSBhIHN0YWNrIHRvIHRoZVxuICAgKiB3b3Jrc3BhY2UuXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBERUZBVUxUX09GRlNFVF9ZOiBudW1iZXIgPSAtMjA7XG4gIHByaXZhdGUgcmVhZG9ubHkgdHlwZV86IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBpc0Nvbm5lY3Rpb25fOiBib29sZWFuO1xuICBwcml2YXRlIHJlYWRvbmx5IGxvY2F0aW9uXzogSUFTVE5vZGVMb2NhdGlvbjtcblxuICAvKiogVGhlIGNvb3JkaW5hdGUgb24gdGhlIHdvcmtzcGFjZS4gKi9cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gIC8vICdDb29yZGluYXRlJy5cbiAgcHJpdmF0ZSB3c0Nvb3JkaW5hdGVfOiBDb29yZGluYXRlID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBsb2NhdGlvbi5cbiAgICogICAgIE11c3QgYmUgaW4gQVNUTm9kZS50eXBlcy5cbiAgICogQHBhcmFtIGxvY2F0aW9uIFRoZSBwb3NpdGlvbiBpbiB0aGUgQVNULlxuICAgKiBAcGFyYW0gb3B0X3BhcmFtcyBPcHRpb25hbCBkaWN0aW9uYXJ5IG9mIG9wdGlvbnMuXG4gICAqIEBhbGlhcyBCbG9ja2x5LkFTVE5vZGVcbiAgICovXG4gIGNvbnN0cnVjdG9yKHR5cGU6IHN0cmluZywgbG9jYXRpb246IElBU1ROb2RlTG9jYXRpb24sIG9wdF9wYXJhbXM/OiBQYXJhbXMpIHtcbiAgICBpZiAoIWxvY2F0aW9uKSB7XG4gICAgICB0aHJvdyBFcnJvcignQ2Fubm90IGNyZWF0ZSBhIG5vZGUgd2l0aG91dCBhIGxvY2F0aW9uLicpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSB0eXBlIG9mIHRoZSBsb2NhdGlvbi5cbiAgICAgKiBPbmUgb2YgQVNUTm9kZS50eXBlc1xuICAgICAqL1xuICAgIHRoaXMudHlwZV8gPSB0eXBlO1xuXG4gICAgLyoqIFdoZXRoZXIgdGhlIGxvY2F0aW9uIHBvaW50cyB0byBhIGNvbm5lY3Rpb24uICovXG4gICAgdGhpcy5pc0Nvbm5lY3Rpb25fID0gQVNUTm9kZS5pc0Nvbm5lY3Rpb25UeXBlXyh0eXBlKTtcblxuICAgIC8qKiBUaGUgbG9jYXRpb24gb2YgdGhlIEFTVCBub2RlLiAqL1xuICAgIHRoaXMubG9jYXRpb25fID0gbG9jYXRpb247XG5cbiAgICB0aGlzLnByb2Nlc3NQYXJhbXNfKG9wdF9wYXJhbXMgfHwgbnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2UgdGhlIG9wdGlvbmFsIHBhcmFtZXRlcnMuXG4gICAqXG4gICAqIEBwYXJhbSBwYXJhbXMgVGhlIHVzZXIgc3BlY2lmaWVkIHBhcmFtZXRlcnMuXG4gICAqL1xuICBwcml2YXRlIHByb2Nlc3NQYXJhbXNfKHBhcmFtczogUGFyYW1zfG51bGwpIHtcbiAgICBpZiAoIXBhcmFtcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLndzQ29vcmRpbmF0ZSkge1xuICAgICAgdGhpcy53c0Nvb3JkaW5hdGVfID0gcGFyYW1zLndzQ29vcmRpbmF0ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmFsdWUgcG9pbnRlZCB0byBieSB0aGlzIG5vZGUuXG4gICAqIEl0IGlzIHRoZSBjYWxsZXJzIHJlc3BvbnNpYmlsaXR5IHRvIGNoZWNrIHRoZSBub2RlIHR5cGUgdG8gZmlndXJlIG91dCB3aGF0XG4gICAqIHR5cGUgb2Ygb2JqZWN0IHRoZXkgZ2V0IGJhY2sgZnJvbSB0aGlzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY3VycmVudCBmaWVsZCwgY29ubmVjdGlvbiwgd29ya3NwYWNlLCBvciBibG9jayB0aGUgY3Vyc29yIGlzXG4gICAqICAgICBvbi5cbiAgICovXG4gIGdldExvY2F0aW9uKCk6IElBU1ROb2RlTG9jYXRpb24ge1xuICAgIHJldHVybiB0aGlzLmxvY2F0aW9uXztcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUgY3VycmVudCBsb2NhdGlvbi5cbiAgICogT25lIG9mIEFTVE5vZGUudHlwZXNcbiAgICpcbiAgICogQHJldHVybnMgVGhlIHR5cGUgb2YgdGhlIGxvY2F0aW9uLlxuICAgKi9cbiAgZ2V0VHlwZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnR5cGVfO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBjb29yZGluYXRlIG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB3b3Jrc3BhY2UgY29vcmRpbmF0ZSBvciBudWxsIGlmIHRoZSBsb2NhdGlvbiBpcyBub3QgYVxuICAgKiAgICAgd29ya3NwYWNlLlxuICAgKi9cbiAgZ2V0V3NDb29yZGluYXRlKCk6IENvb3JkaW5hdGUge1xuICAgIHJldHVybiB0aGlzLndzQ29vcmRpbmF0ZV87XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGUgbm9kZSBwb2ludHMgdG8gYSBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBbZGVzY3JpcHRpb25dXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNDb25uZWN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzQ29ubmVjdGlvbl87XG4gIH1cblxuICAvKipcbiAgICogR2l2ZW4gYW4gaW5wdXQgZmluZCB0aGUgbmV4dCBlZGl0YWJsZSBmaWVsZCBvciBhbiBpbnB1dCB3aXRoIGEgbm9uIG51bGxcbiAgICogY29ubmVjdGlvbiBpbiB0aGUgc2FtZSBibG9jay4gVGhlIGN1cnJlbnQgbG9jYXRpb24gbXVzdCBiZSBhbiBpbnB1dFxuICAgKiBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgQVNUIG5vZGUgaG9sZGluZyB0aGUgbmV4dCBmaWVsZCBvciBjb25uZWN0aW9uIG9yIG51bGwgaWYgdGhlcmVcbiAgICogICAgIGlzIG5vIGVkaXRhYmxlIGZpZWxkIG9yIGlucHV0IGNvbm5lY3Rpb24gYWZ0ZXIgdGhlIGdpdmVuIGlucHV0LlxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kTmV4dEZvcklucHV0XygpOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICBjb25zdCBwYXJlbnRJbnB1dCA9IGxvY2F0aW9uLmdldFBhcmVudElucHV0KCk7XG4gICAgY29uc3QgYmxvY2sgPSBwYXJlbnRJbnB1dCEuZ2V0U291cmNlQmxvY2soKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0lucHV0IHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnSW5wdXQnLlxuICAgIGNvbnN0IGN1cklkeCA9IGJsb2NrIS5pbnB1dExpc3QuaW5kZXhPZihwYXJlbnRJbnB1dCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIGZvciAobGV0IGkgPSBjdXJJZHggKyAxOyBpIDwgYmxvY2shLmlucHV0TGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaW5wdXQgPSBibG9jayEuaW5wdXRMaXN0W2ldO1xuICAgICAgY29uc3QgZmllbGRSb3cgPSBpbnB1dC5maWVsZFJvdztcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZmllbGRSb3cubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgZmllbGQgPSBmaWVsZFJvd1tqXTtcbiAgICAgICAgaWYgKGZpZWxkLmlzQ2xpY2thYmxlKCkgfHwgQVNUTm9kZS5OQVZJR0FURV9BTExfRklFTERTKSB7XG4gICAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlRmllbGROb2RlKGZpZWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGlucHV0LmNvbm5lY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlSW5wdXROb2RlKGlucHV0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2l2ZW4gYSBmaWVsZCBmaW5kIHRoZSBuZXh0IGVkaXRhYmxlIGZpZWxkIG9yIGFuIGlucHV0IHdpdGggYSBub24gbnVsbFxuICAgKiBjb25uZWN0aW9uIGluIHRoZSBzYW1lIGJsb2NrLiBUaGUgY3VycmVudCBsb2NhdGlvbiBtdXN0IGJlIGEgZmllbGQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBBU1Qgbm9kZSBwb2ludGluZyB0byB0aGUgbmV4dCBmaWVsZCBvciBjb25uZWN0aW9uIG9yIG51bGwgaWZcbiAgICogICAgIHRoZXJlIGlzIG5vIGVkaXRhYmxlIGZpZWxkIG9yIGlucHV0IGNvbm5lY3Rpb24gYWZ0ZXIgdGhlIGdpdmVuIGlucHV0LlxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kTmV4dEZvckZpZWxkXygpOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgRmllbGQ7XG4gICAgY29uc3QgaW5wdXQgPSBsb2NhdGlvbi5nZXRQYXJlbnRJbnB1dCgpO1xuICAgIGNvbnN0IGJsb2NrID0gbG9jYXRpb24uZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBjdXJyZW50IEFTVCBsb2NhdGlvbiBpcyBub3QgYXNzb2NpYXRlZCB3aXRoIGEgYmxvY2snKTtcbiAgICB9XG4gICAgY29uc3QgY3VySWR4ID0gYmxvY2suaW5wdXRMaXN0LmluZGV4T2YoKGlucHV0KSk7XG4gICAgbGV0IGZpZWxkSWR4ID0gaW5wdXQuZmllbGRSb3cuaW5kZXhPZihsb2NhdGlvbikgKyAxO1xuICAgIGZvciAobGV0IGkgPSBjdXJJZHg7IGkgPCBibG9jay5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG5ld0lucHV0ID0gYmxvY2suaW5wdXRMaXN0W2ldO1xuICAgICAgY29uc3QgZmllbGRSb3cgPSBuZXdJbnB1dC5maWVsZFJvdztcbiAgICAgIHdoaWxlIChmaWVsZElkeCA8IGZpZWxkUm93Lmxlbmd0aCkge1xuICAgICAgICBpZiAoZmllbGRSb3dbZmllbGRJZHhdLmlzQ2xpY2thYmxlKCkgfHwgQVNUTm9kZS5OQVZJR0FURV9BTExfRklFTERTKSB7XG4gICAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlRmllbGROb2RlKGZpZWxkUm93W2ZpZWxkSWR4XSk7XG4gICAgICAgIH1cbiAgICAgICAgZmllbGRJZHgrKztcbiAgICAgIH1cbiAgICAgIGZpZWxkSWR4ID0gMDtcbiAgICAgIGlmIChuZXdJbnB1dC5jb25uZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZUlucHV0Tm9kZShuZXdJbnB1dCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmVuIGFuIGlucHV0IGZpbmQgdGhlIHByZXZpb3VzIGVkaXRhYmxlIGZpZWxkIG9yIGFuIGlucHV0IHdpdGggYSBub24gbnVsbFxuICAgKiBjb25uZWN0aW9uIGluIHRoZSBzYW1lIGJsb2NrLiBUaGUgY3VycmVudCBsb2NhdGlvbiBtdXN0IGJlIGFuIGlucHV0XG4gICAqIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBBU1Qgbm9kZSBob2xkaW5nIHRoZSBwcmV2aW91cyBmaWVsZCBvciBjb25uZWN0aW9uLlxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kUHJldkZvcklucHV0XygpOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICBjb25zdCBwYXJlbnRJbnB1dCA9IGxvY2F0aW9uLmdldFBhcmVudElucHV0KCk7XG4gICAgY29uc3QgYmxvY2sgPSBwYXJlbnRJbnB1dCEuZ2V0U291cmNlQmxvY2soKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0lucHV0IHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnSW5wdXQnLlxuICAgIGNvbnN0IGN1cklkeCA9IGJsb2NrIS5pbnB1dExpc3QuaW5kZXhPZihwYXJlbnRJbnB1dCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIGZvciAobGV0IGkgPSBjdXJJZHg7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBpbnB1dCA9IGJsb2NrIS5pbnB1dExpc3RbaV07XG4gICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbiAmJiBpbnB1dCAhPT0gcGFyZW50SW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlSW5wdXROb2RlKGlucHV0KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpZWxkUm93ID0gaW5wdXQuZmllbGRSb3c7XG4gICAgICBmb3IgKGxldCBqID0gZmllbGRSb3cubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcbiAgICAgICAgY29uc3QgZmllbGQgPSBmaWVsZFJvd1tqXTtcbiAgICAgICAgaWYgKGZpZWxkLmlzQ2xpY2thYmxlKCkgfHwgQVNUTm9kZS5OQVZJR0FURV9BTExfRklFTERTKSB7XG4gICAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlRmllbGROb2RlKGZpZWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaXZlbiBhIGZpZWxkIGZpbmQgdGhlIHByZXZpb3VzIGVkaXRhYmxlIGZpZWxkIG9yIGFuIGlucHV0IHdpdGggYSBub24gbnVsbFxuICAgKiBjb25uZWN0aW9uIGluIHRoZSBzYW1lIGJsb2NrLiBUaGUgY3VycmVudCBsb2NhdGlvbiBtdXN0IGJlIGEgZmllbGQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBBU1Qgbm9kZSBob2xkaW5nIHRoZSBwcmV2aW91cyBpbnB1dCBvciBmaWVsZC5cbiAgICovXG4gIHByaXZhdGUgZmluZFByZXZGb3JGaWVsZF8oKTogQVNUTm9kZXxudWxsIHtcbiAgICBjb25zdCBsb2NhdGlvbiA9IHRoaXMubG9jYXRpb25fIGFzIEZpZWxkO1xuICAgIGNvbnN0IHBhcmVudElucHV0ID0gbG9jYXRpb24uZ2V0UGFyZW50SW5wdXQoKTtcbiAgICBjb25zdCBibG9jayA9IGxvY2F0aW9uLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgY3VycmVudCBBU1QgbG9jYXRpb24gaXMgbm90IGFzc29jaWF0ZWQgd2l0aCBhIGJsb2NrJyk7XG4gICAgfVxuICAgIGNvbnN0IGN1cklkeCA9IGJsb2NrLmlucHV0TGlzdC5pbmRleE9mKChwYXJlbnRJbnB1dCkpO1xuICAgIGxldCBmaWVsZElkeCA9IHBhcmVudElucHV0LmZpZWxkUm93LmluZGV4T2YobG9jYXRpb24pIC0gMTtcbiAgICBmb3IgKGxldCBpID0gY3VySWR4OyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgaW5wdXQgPSBibG9jay5pbnB1dExpc3RbaV07XG4gICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbiAmJiBpbnB1dCAhPT0gcGFyZW50SW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlSW5wdXROb2RlKGlucHV0KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpZWxkUm93ID0gaW5wdXQuZmllbGRSb3c7XG4gICAgICB3aGlsZSAoZmllbGRJZHggPiAtMSkge1xuICAgICAgICBpZiAoZmllbGRSb3dbZmllbGRJZHhdLmlzQ2xpY2thYmxlKCkgfHwgQVNUTm9kZS5OQVZJR0FURV9BTExfRklFTERTKSB7XG4gICAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlRmllbGROb2RlKGZpZWxkUm93W2ZpZWxkSWR4XSk7XG4gICAgICAgIH1cbiAgICAgICAgZmllbGRJZHgtLTtcbiAgICAgIH1cbiAgICAgIC8vIFJlc2V0IHRoZSBmaWVsZElkeCB0byB0aGUgbGVuZ3RoIG9mIHRoZSBmaWVsZCByb3cgb2YgdGhlIHByZXZpb3VzXG4gICAgICAvLyBpbnB1dC5cbiAgICAgIGlmIChpIC0gMSA+PSAwKSB7XG4gICAgICAgIGZpZWxkSWR4ID0gYmxvY2suaW5wdXRMaXN0W2kgLSAxXS5maWVsZFJvdy5sZW5ndGggLSAxO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBOYXZpZ2F0ZSBiZXR3ZWVuIHN0YWNrcyBvZiBibG9ja3Mgb24gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGZvcndhcmQgVHJ1ZSB0byBnbyBmb3J3YXJkLiBGYWxzZSB0byBnbyBiYWNrd2FyZHMuXG4gICAqIEByZXR1cm5zIFRoZSBmaXJzdCBibG9jayBvZiB0aGUgbmV4dCBzdGFjayBvciBudWxsIGlmIHRoZXJlIGFyZSBubyBibG9ja3NcbiAgICogICAgIG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqL1xuICBwcml2YXRlIG5hdmlnYXRlQmV0d2VlblN0YWNrc18oZm9yd2FyZDogYm9vbGVhbik6IEFTVE5vZGV8bnVsbCB7XG4gICAgbGV0IGN1ckxvY2F0aW9uID0gdGhpcy5nZXRMb2NhdGlvbigpO1xuICAgIC8vIFRPRE8oIzYwOTcpOiBVc2UgaW5zdGFuY2VvZiBjaGVja3MgdG8gZXhpdCBlYXJseSBmb3IgdmFsdWVzIG9mXG4gICAgLy8gY3VyTG9jYXRpb24gdGhhdCBkb24ndCBtYWtlIHNlbnNlLlxuICAgIGlmICgoY3VyTG9jYXRpb24gYXMgSUFTVE5vZGVMb2NhdGlvbldpdGhCbG9jaykuZ2V0U291cmNlQmxvY2spIHtcbiAgICAgIGNvbnN0IGJsb2NrID0gKGN1ckxvY2F0aW9uIGFzIElBU1ROb2RlTG9jYXRpb25XaXRoQmxvY2spLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgICBpZiAoYmxvY2spIHtcbiAgICAgICAgY3VyTG9jYXRpb24gPSBibG9jaztcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gVE9ETygjNjA5Nyk6IFVzZSBpbnN0YW5jZW9mIGNoZWNrcyB0byBleGl0IGVhcmx5IGZvciB2YWx1ZXMgb2ZcbiAgICAvLyBjdXJMb2NhdGlvbiB0aGF0IGRvbid0IG1ha2Ugc2Vuc2UuXG4gICAgY29uc3QgY3VyTG9jYXRpb25Bc0Jsb2NrID0gY3VyTG9jYXRpb24gYXMgQmxvY2s7XG4gICAgaWYgKCFjdXJMb2NhdGlvbkFzQmxvY2sgfHwgY3VyTG9jYXRpb25Bc0Jsb2NrLmlzRGVhZE9yRHlpbmcoKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGN1clJvb3QgPSBjdXJMb2NhdGlvbkFzQmxvY2suZ2V0Um9vdEJsb2NrKCk7XG4gICAgY29uc3QgdG9wQmxvY2tzID0gY3VyUm9vdC53b3Jrc3BhY2UuZ2V0VG9wQmxvY2tzKHRydWUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0b3BCbG9jayA9IHRvcEJsb2Nrc1tpXTtcbiAgICAgIGlmIChjdXJSb290LmlkID09PSB0b3BCbG9jay5pZCkge1xuICAgICAgICBjb25zdCBvZmZzZXQgPSBmb3J3YXJkID8gMSA6IC0xO1xuICAgICAgICBjb25zdCByZXN1bHRJbmRleCA9IGkgKyBvZmZzZXQ7XG4gICAgICAgIGlmIChyZXN1bHRJbmRleCA9PT0gLTEgfHwgcmVzdWx0SW5kZXggPT09IHRvcEJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVTdGFja05vZGUodG9wQmxvY2tzW3Jlc3VsdEluZGV4XSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IEVycm9yKFxuICAgICAgICAnQ291bGRuXFwndCBmaW5kICcgKyAoZm9yd2FyZCA/ICduZXh0JyA6ICdwcmV2aW91cycpICsgJyBzdGFjaz8hJyk7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIHRvcCBtb3N0IEFTVCBub2RlIGZvciBhIGdpdmVuIGJsb2NrLlxuICAgKiBUaGlzIGlzIGVpdGhlciB0aGUgcHJldmlvdXMgY29ubmVjdGlvbiwgb3V0cHV0IGNvbm5lY3Rpb24gb3IgYmxvY2tcbiAgICogZGVwZW5kaW5nIG9uIHdoYXQga2luZCBvZiBjb25uZWN0aW9ucyB0aGUgYmxvY2sgaGFzLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRoYXQgd2Ugd2FudCB0byBmaW5kIHRoZSB0b3AgY29ubmVjdGlvbiBvbi5cbiAgICogQHJldHVybnMgVGhlIEFTVCBub2RlIGNvbnRhaW5pbmcgdGhlIHRvcCBjb25uZWN0aW9uLlxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kVG9wQVNUTm9kZUZvckJsb2NrXyhibG9jazogQmxvY2spOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IHRvcENvbm5lY3Rpb24gPSBnZXRQYXJlbnRDb25uZWN0aW9uKGJsb2NrKTtcbiAgICBpZiAodG9wQ29ubmVjdGlvbikge1xuICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlQ29ubmVjdGlvbk5vZGUodG9wQ29ubmVjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZUJsb2NrTm9kZShibG9jayk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgQVNUIG5vZGUgcG9pbnRpbmcgdG8gdGhlIGlucHV0IHRoYXQgdGhlIGJsb2NrIGlzIG5lc3RlZCB1bmRlciBvciBpZlxuICAgKiB0aGUgYmxvY2sgaXMgbm90IG5lc3RlZCB0aGVuIGdldCB0aGUgc3RhY2sgQVNUIG5vZGUuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgc291cmNlIGJsb2NrIG9mIHRoZSBjdXJyZW50IGxvY2F0aW9uLlxuICAgKiBAcmV0dXJucyBUaGUgQVNUIG5vZGUgcG9pbnRpbmcgdG8gdGhlIGlucHV0IGNvbm5lY3Rpb24gb3IgdGhlIHRvcCBibG9jayBvZlxuICAgKiAgICAgdGhlIHN0YWNrIHRoaXMgYmxvY2sgaXMgaW4uXG4gICAqL1xuICBwcml2YXRlIGdldE91dEFzdE5vZGVGb3JCbG9ja18oYmxvY2s6IEJsb2NrKTogQVNUTm9kZXxudWxsIHtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gSWYgdGhlIGJsb2NrIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIGNvbm5lY3Rpb24gdGhlbiBpdCBpcyB0aGUgdG9wIG9mIHRoZVxuICAgIC8vIHN1YnN0YWNrLlxuICAgIGNvbnN0IHRvcEJsb2NrID0gYmxvY2suZ2V0VG9wU3RhY2tCbG9jaygpO1xuICAgIGNvbnN0IHRvcENvbm5lY3Rpb24gPSBnZXRQYXJlbnRDb25uZWN0aW9uKHRvcEJsb2NrKTtcbiAgICAvLyBJZiB0aGUgdG9wIGNvbm5lY3Rpb24gaGFzIGEgcGFyZW50SW5wdXQsIGNyZWF0ZSBhbiBBU1Qgbm9kZSBwb2ludGluZyB0b1xuICAgIC8vIHRoYXQgaW5wdXQuXG4gICAgaWYgKHRvcENvbm5lY3Rpb24gJiYgdG9wQ29ubmVjdGlvbi50YXJnZXRDb25uZWN0aW9uICYmXG4gICAgICAgIHRvcENvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbi5nZXRQYXJlbnRJbnB1dCgpKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0lucHV0IHwgbnVsbCcgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdJbnB1dCcuXG4gICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVJbnB1dE5vZGUoXG4gICAgICAgICAgdG9wQ29ubmVjdGlvbi50YXJnZXRDb25uZWN0aW9uLmdldFBhcmVudElucHV0KCkgYXNcbiAgICAgICAgICBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBHbyB0byBzdGFjayBsZXZlbCBpZiB5b3UgYXJlIG5vdCB1bmRlcm5lYXRoIGFuIGlucHV0LlxuICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlU3RhY2tOb2RlKHRvcEJsb2NrKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgZmlyc3QgZWRpdGFibGUgZmllbGQgb3IgaW5wdXQgd2l0aCBhIGNvbm5lY3Rpb24gb24gYSBnaXZlbiBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBzb3VyY2UgYmxvY2sgb2YgdGhlIGN1cnJlbnQgbG9jYXRpb24uXG4gICAqIEByZXR1cm5zIEFuIEFTVCBub2RlIHBvaW50aW5nIHRvIHRoZSBmaXJzdCBmaWVsZCBvciBpbnB1dC5cbiAgICogTnVsbCBpZiB0aGVyZSBhcmUgbm8gZWRpdGFibGUgZmllbGRzIG9yIGlucHV0cyB3aXRoIGNvbm5lY3Rpb25zIG9uIHRoZVxuICAgKiBibG9jay5cbiAgICovXG4gIHByaXZhdGUgZmluZEZpcnN0RmllbGRPcklucHV0XyhibG9jazogQmxvY2spOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGlucHV0cyA9IGJsb2NrLmlucHV0TGlzdDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaW5wdXQgPSBpbnB1dHNbaV07XG4gICAgICBjb25zdCBmaWVsZFJvdyA9IGlucHV0LmZpZWxkUm93O1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBmaWVsZFJvdy5sZW5ndGg7IGorKykge1xuICAgICAgICBjb25zdCBmaWVsZCA9IGZpZWxkUm93W2pdO1xuICAgICAgICBpZiAoZmllbGQuaXNDbGlja2FibGUoKSB8fCBBU1ROb2RlLk5BVklHQVRFX0FMTF9GSUVMRFMpIHtcbiAgICAgICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVGaWVsZE5vZGUoZmllbGQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbikge1xuICAgICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVJbnB1dE5vZGUoaW5wdXQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kcyB0aGUgc291cmNlIGJsb2NrIG9mIHRoZSBsb2NhdGlvbiBvZiB0aGlzIG5vZGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBzb3VyY2UgYmxvY2sgb2YgdGhlIGxvY2F0aW9uLCBvciBudWxsIGlmIHRoZSBub2RlIGlzIG9mIHR5cGVcbiAgICogICAgIHdvcmtzcGFjZS5cbiAgICovXG4gIGdldFNvdXJjZUJsb2NrKCk6IEJsb2NrfG51bGwge1xuICAgIGlmICh0aGlzLmdldFR5cGUoKSA9PT0gQVNUTm9kZS50eXBlcy5CTE9DSykge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TG9jYXRpb24oKSBhcyBCbG9jaztcbiAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLlNUQUNLKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRMb2NhdGlvbigpIGFzIEJsb2NrO1xuICAgIH0gZWxzZSBpZiAodGhpcy5nZXRUeXBlKCkgPT09IEFTVE5vZGUudHlwZXMuV09SS1NQQUNFKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICh0aGlzLmdldExvY2F0aW9uKCkgYXMgSUFTVE5vZGVMb2NhdGlvbldpdGhCbG9jaykuZ2V0U291cmNlQmxvY2soKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgZWxlbWVudCB0byB0aGUgcmlnaHQgb2YgdGhlIGN1cnJlbnQgZWxlbWVudCBpbiB0aGUgQVNULlxuICAgKlxuICAgKiBAcmV0dXJucyBBbiBBU1Qgbm9kZSB0aGF0IHdyYXBzIHRoZSBuZXh0IGZpZWxkLCBjb25uZWN0aW9uLCBibG9jaywgb3JcbiAgICogICAgIHdvcmtzcGFjZS4gT3IgbnVsbCBpZiB0aGVyZSBpcyBubyBub2RlIHRvIHRoZSByaWdodC5cbiAgICovXG4gIG5leHQoKTogQVNUTm9kZXxudWxsIHtcbiAgICBzd2l0Y2ggKHRoaXMudHlwZV8pIHtcbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5TVEFDSzpcbiAgICAgICAgcmV0dXJuIHRoaXMubmF2aWdhdGVCZXR3ZWVuU3RhY2tzXyh0cnVlKTtcblxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLk9VVFBVVDoge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlQmxvY2tOb2RlKGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKSk7XG4gICAgICB9XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuRklFTEQ6XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmROZXh0Rm9yRmllbGRfKCk7XG5cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5JTlBVVDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluZE5leHRGb3JJbnB1dF8oKTtcblxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLkJMT0NLOiB7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gdGhpcy5sb2NhdGlvbl8gYXMgQmxvY2s7XG4gICAgICAgIGNvbnN0IG5leHRDb25uZWN0aW9uID0gYmxvY2submV4dENvbm5lY3Rpb247XG4gICAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZUNvbm5lY3Rpb25Ob2RlKG5leHRDb25uZWN0aW9uKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5QUkVWSU9VUzoge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlQmxvY2tOb2RlKGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKSk7XG4gICAgICB9XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuTkVYVDoge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q29ubmVjdGlvbiA9IGNvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlQ29ubmVjdGlvbk5vZGUodGFyZ2V0Q29ubmVjdGlvbiEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIGVsZW1lbnQgb25lIGxldmVsIGJlbG93IGFuZCBhbGwgdGhlIHdheSB0byB0aGUgbGVmdCBvZiB0aGUgY3VycmVudFxuICAgKiBsb2NhdGlvbi5cbiAgICpcbiAgICogQHJldHVybnMgQW4gQVNUIG5vZGUgdGhhdCB3cmFwcyB0aGUgbmV4dCBmaWVsZCwgY29ubmVjdGlvbiwgd29ya3NwYWNlLCBvclxuICAgKiAgICAgYmxvY2suIE9yIG51bGwgaWYgdGhlcmUgaXMgbm90aGluZyBiZWxvdyB0aGlzIG5vZGUuXG4gICAqL1xuICBpbigpOiBBU1ROb2RlfG51bGwge1xuICAgIHN3aXRjaCAodGhpcy50eXBlXykge1xuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLldPUktTUEFDRToge1xuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmxvY2F0aW9uXyBhcyBXb3Jrc3BhY2U7XG4gICAgICAgIGNvbnN0IHRvcEJsb2NrcyA9IHdvcmtzcGFjZS5nZXRUb3BCbG9ja3ModHJ1ZSk7XG4gICAgICAgIGlmICh0b3BCbG9ja3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZVN0YWNrTm9kZSh0b3BCbG9ja3NbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLlNUQUNLOiB7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gdGhpcy5sb2NhdGlvbl8gYXMgQmxvY2s7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmRUb3BBU1ROb2RlRm9yQmxvY2tfKGJsb2NrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5CTE9DSzoge1xuICAgICAgICBjb25zdCBibG9jayA9IHRoaXMubG9jYXRpb25fIGFzIEJsb2NrO1xuICAgICAgICByZXR1cm4gdGhpcy5maW5kRmlyc3RGaWVsZE9ySW5wdXRfKGJsb2NrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5JTlBVVDoge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q29ubmVjdGlvbiA9IGNvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlQ29ubmVjdGlvbk5vZGUodGFyZ2V0Q29ubmVjdGlvbiEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIGVsZW1lbnQgdG8gdGhlIGxlZnQgb2YgdGhlIGN1cnJlbnQgZWxlbWVudCBpbiB0aGUgQVNULlxuICAgKlxuICAgKiBAcmV0dXJucyBBbiBBU1Qgbm9kZSB0aGF0IHdyYXBzIHRoZSBwcmV2aW91cyBmaWVsZCwgY29ubmVjdGlvbiwgd29ya3NwYWNlXG4gICAqICAgICBvciBibG9jay4gT3IgbnVsbCBpZiBubyBub2RlIGV4aXN0cyB0byB0aGUgbGVmdC4gbnVsbC5cbiAgICovXG4gIHByZXYoKTogQVNUTm9kZXxudWxsIHtcbiAgICBzd2l0Y2ggKHRoaXMudHlwZV8pIHtcbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5TVEFDSzpcbiAgICAgICAgcmV0dXJuIHRoaXMubmF2aWdhdGVCZXR3ZWVuU3RhY2tzXyhmYWxzZSk7XG5cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5PVVRQVVQ6XG4gICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuRklFTEQ6XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmRQcmV2Rm9yRmllbGRfKCk7XG5cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5JTlBVVDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFByZXZGb3JJbnB1dF8oKTtcblxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLkJMT0NLOiB7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gdGhpcy5sb2NhdGlvbl8gYXMgQmxvY2s7XG4gICAgICAgIGNvbnN0IHRvcENvbm5lY3Rpb24gPSBnZXRQYXJlbnRDb25uZWN0aW9uKGJsb2NrKTtcbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlQ29ubmVjdGlvbk5vZGUodG9wQ29ubmVjdGlvbik7XG4gICAgICB9XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuUFJFVklPVVM6IHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IHRoaXMubG9jYXRpb25fIGFzIENvbm5lY3Rpb247XG4gICAgICAgIGNvbnN0IHRhcmdldENvbm5lY3Rpb24gPSBjb25uZWN0aW9uLnRhcmdldENvbm5lY3Rpb247XG4gICAgICAgIGlmICh0YXJnZXRDb25uZWN0aW9uICYmICF0YXJnZXRDb25uZWN0aW9uLmdldFBhcmVudElucHV0KCkpIHtcbiAgICAgICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVDb25uZWN0aW9uTm9kZSh0YXJnZXRDb25uZWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5ORVhUOiB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSB0aGlzLmxvY2F0aW9uXyBhcyBDb25uZWN0aW9uO1xuICAgICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVCbG9ja05vZGUoY29ubmVjdGlvbi5nZXRTb3VyY2VCbG9jaygpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHRoZSBuZXh0IGVsZW1lbnQgdGhhdCBpcyBvbmUgcG9zaXRpb24gYWJvdmUgYW5kIGFsbCB0aGUgd2F5IHRvIHRoZVxuICAgKiBsZWZ0IG9mIHRoZSBjdXJyZW50IGxvY2F0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBBbiBBU1Qgbm9kZSB0aGF0IHdyYXBzIHRoZSBuZXh0IGZpZWxkLCBjb25uZWN0aW9uLCB3b3Jrc3BhY2Ugb3JcbiAgICogICAgIGJsb2NrLiBPciBudWxsIGlmIHdlIGFyZSBhdCB0aGUgd29ya3NwYWNlIGxldmVsLlxuICAgKi9cbiAgb3V0KCk6IEFTVE5vZGV8bnVsbCB7XG4gICAgc3dpdGNoICh0aGlzLnR5cGVfKSB7XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuU1RBQ0s6IHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSB0aGlzLmxvY2F0aW9uXyBhcyBCbG9jaztcbiAgICAgICAgY29uc3QgYmxvY2tQb3MgPSBibG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgICAgIC8vIFRPRE86IE1ha2Ugc3VyZSB0aGlzIGlzIGluIHRoZSBib3VuZHMgb2YgdGhlIHdvcmtzcGFjZS5cbiAgICAgICAgY29uc3Qgd3NDb29yZGluYXRlID1cbiAgICAgICAgICAgIG5ldyBDb29yZGluYXRlKGJsb2NrUG9zLngsIGJsb2NrUG9zLnkgKyBBU1ROb2RlLkRFRkFVTFRfT0ZGU0VUX1kpO1xuICAgICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVXb3Jrc3BhY2VOb2RlKGJsb2NrLndvcmtzcGFjZSwgd3NDb29yZGluYXRlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgQVNUTm9kZS50eXBlcy5PVVRQVVQ6IHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IHRoaXMubG9jYXRpb25fIGFzIENvbm5lY3Rpb247XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGNvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbjtcbiAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZUNvbm5lY3Rpb25Ob2RlKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEFTVE5vZGUuY3JlYXRlU3RhY2tOb2RlKGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKSk7XG4gICAgICB9XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuRklFTEQ6IHtcbiAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmxvY2F0aW9uXyBhcyBGaWVsZDtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBmaWVsZC5nZXRTb3VyY2VCbG9jaygpO1xuICAgICAgICBpZiAoIWJsb2NrKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAnVGhlIGN1cnJlbnQgQVNUIGxvY2F0aW9uIGlzIG5vdCBhc3NvY2lhdGVkIHdpdGggYSBibG9jaycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZUJsb2NrTm9kZShibG9jayk7XG4gICAgICB9XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuSU5QVVQ6IHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbiA9IHRoaXMubG9jYXRpb25fIGFzIENvbm5lY3Rpb247XG4gICAgICAgIHJldHVybiBBU1ROb2RlLmNyZWF0ZUJsb2NrTm9kZShjb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCkpO1xuICAgICAgfVxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLkJMT0NLOiB7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gdGhpcy5sb2NhdGlvbl8gYXMgQmxvY2s7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE91dEFzdE5vZGVGb3JCbG9ja18oYmxvY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLlBSRVZJT1VTOiB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSB0aGlzLmxvY2F0aW9uXyBhcyBDb25uZWN0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRPdXRBc3ROb2RlRm9yQmxvY2tfKGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKSk7XG4gICAgICB9XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuTkVYVDoge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy5sb2NhdGlvbl8gYXMgQ29ubmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T3V0QXN0Tm9kZUZvckJsb2NrXyhjb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYW4gQVNUIG5vZGUgb2YgdGhlIGdpdmVuIHR5cGUgcG9pbnRzIHRvIGEgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgdG8gY2hlY2suICBPbmUgb2YgQVNUTm9kZS50eXBlcy5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiBhIG5vZGUgb2YgdGhlIGdpdmVuIHR5cGUgcG9pbnRzIHRvIGEgY29ubmVjdGlvbi5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGlzQ29ubmVjdGlvblR5cGVfKHR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLlBSRVZJT1VTOlxuICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLk5FWFQ6XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuSU5QVVQ6XG4gICAgICBjYXNlIEFTVE5vZGUudHlwZXMuT1VUUFVUOlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbiBBU1Qgbm9kZSBwb2ludGluZyB0byBhIGZpZWxkLlxuICAgKlxuICAgKiBAcGFyYW0gZmllbGQgVGhlIGxvY2F0aW9uIG9mIHRoZSBBU1Qgbm9kZS5cbiAgICogQHJldHVybnMgQW4gQVNUIG5vZGUgcG9pbnRpbmcgdG8gYSBmaWVsZC5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVGaWVsZE5vZGUoZmllbGQ6IEZpZWxkKTogQVNUTm9kZXxudWxsIHtcbiAgICBpZiAoIWZpZWxkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBBU1ROb2RlKEFTVE5vZGUudHlwZXMuRklFTEQsIGZpZWxkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIEFTVCBub2RlIHBvaW50aW5nIHRvIGEgY29ubmVjdGlvbi4gSWYgdGhlIGNvbm5lY3Rpb24gaGFzIGFcbiAgICogcGFyZW50IGlucHV0IHRoZW4gY3JlYXRlIGFuIEFTVCBub2RlIG9mIHR5cGUgaW5wdXQgdGhhdCB3aWxsIGhvbGQgdGhlXG4gICAqIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uIFRoaXMgaXMgdGhlIGNvbm5lY3Rpb24gdGhlIG5vZGUgd2lsbCBwb2ludCB0by5cbiAgICogQHJldHVybnMgQW4gQVNUIG5vZGUgcG9pbnRpbmcgdG8gYSBjb25uZWN0aW9uLlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZUNvbm5lY3Rpb25Ob2RlKGNvbm5lY3Rpb246IENvbm5lY3Rpb24pOiBBU1ROb2RlfG51bGwge1xuICAgIGlmICghY29ubmVjdGlvbikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHR5cGUgPSBjb25uZWN0aW9uLnR5cGU7XG4gICAgaWYgKHR5cGUgPT09IENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0lucHV0IHwgbnVsbCcgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdJbnB1dCcuXG4gICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVJbnB1dE5vZGUoXG4gICAgICAgICAgY29ubmVjdGlvbi5nZXRQYXJlbnRJbnB1dCgpIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgICAgdHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQgJiYgY29ubmVjdGlvbi5nZXRQYXJlbnRJbnB1dCgpKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0lucHV0IHwgbnVsbCcgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdJbnB1dCcuXG4gICAgICByZXR1cm4gQVNUTm9kZS5jcmVhdGVJbnB1dE5vZGUoXG4gICAgICAgICAgY29ubmVjdGlvbi5nZXRQYXJlbnRJbnB1dCgpIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBDb25uZWN0aW9uVHlwZS5ORVhUX1NUQVRFTUVOVCkge1xuICAgICAgcmV0dXJuIG5ldyBBU1ROb2RlKEFTVE5vZGUudHlwZXMuTkVYVCwgY29ubmVjdGlvbik7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUUpIHtcbiAgICAgIHJldHVybiBuZXcgQVNUTm9kZShBU1ROb2RlLnR5cGVzLk9VVFBVVCwgY29ubmVjdGlvbik7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlQpIHtcbiAgICAgIHJldHVybiBuZXcgQVNUTm9kZShBU1ROb2RlLnR5cGVzLlBSRVZJT1VTLCBjb25uZWN0aW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBBU1Qgbm9kZSBwb2ludGluZyB0byBhbiBpbnB1dC4gU3RvcmVzIHRoZSBpbnB1dCBjb25uZWN0aW9uIGFzXG4gICAqIHRoZSBsb2NhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGlucHV0IFRoZSBpbnB1dCB1c2VkIHRvIGNyZWF0ZSBhbiBBU1Qgbm9kZS5cbiAgICogQHJldHVybnMgQW4gQVNUIG5vZGUgcG9pbnRpbmcgdG8gYSBpbnB1dC5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVJbnB1dE5vZGUoaW5wdXQ6IElucHV0KTogQVNUTm9kZXxudWxsIHtcbiAgICBpZiAoIWlucHV0IHx8ICFpbnB1dC5jb25uZWN0aW9uKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBBU1ROb2RlKEFTVE5vZGUudHlwZXMuSU5QVVQsIGlucHV0LmNvbm5lY3Rpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gQVNUIG5vZGUgcG9pbnRpbmcgdG8gYSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB1c2VkIHRvIGNyZWF0ZSBhbiBBU1Qgbm9kZS5cbiAgICogQHJldHVybnMgQW4gQVNUIG5vZGUgcG9pbnRpbmcgdG8gYSBibG9jay5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVCbG9ja05vZGUoYmxvY2s6IEJsb2NrKTogQVNUTm9kZXxudWxsIHtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBBU1ROb2RlKEFTVE5vZGUudHlwZXMuQkxPQ0ssIGJsb2NrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gQVNUIG5vZGUgb2YgdHlwZSBzdGFjay4gQSBzdGFjaywgcmVwcmVzZW50ZWQgYnkgaXRzIHRvcCBibG9jaywgaXNcbiAgICogICAgIHRoZSBzZXQgb2YgYWxsIGJsb2NrcyBjb25uZWN0ZWQgdG8gYSB0b3AgYmxvY2ssIGluY2x1ZGluZyB0aGUgdG9wXG4gICAqIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gdG9wQmxvY2sgQSB0b3AgYmxvY2sgaGFzIG5vIHBhcmVudCBhbmQgY2FuIGJlIGZvdW5kIGluIHRoZSBsaXN0XG4gICAqICAgICByZXR1cm5lZCBieSB3b3Jrc3BhY2UuZ2V0VG9wQmxvY2tzKCkuXG4gICAqIEByZXR1cm5zIEFuIEFTVCBub2RlIG9mIHR5cGUgc3RhY2sgdGhhdCBwb2ludHMgdG8gdGhlIHRvcCBibG9jayBvbiB0aGVcbiAgICogICAgIHN0YWNrLlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVN0YWNrTm9kZSh0b3BCbG9jazogQmxvY2spOiBBU1ROb2RlfG51bGwge1xuICAgIGlmICghdG9wQmxvY2spIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEFTVE5vZGUoQVNUTm9kZS50eXBlcy5TVEFDSywgdG9wQmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gQVNUIG5vZGUgcG9pbnRpbmcgdG8gYSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0aGF0IHdlIGFyZSBvbi5cbiAgICogQHBhcmFtIHdzQ29vcmRpbmF0ZSBUaGUgcG9zaXRpb24gb24gdGhlIHdvcmtzcGFjZSBmb3IgdGhpcyBub2RlLlxuICAgKiBAcmV0dXJucyBBbiBBU1Qgbm9kZSBwb2ludGluZyB0byBhIHdvcmtzcGFjZSBhbmQgYSBwb3NpdGlvbiBvbiB0aGVcbiAgICogICAgIHdvcmtzcGFjZS5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVXb3Jrc3BhY2VOb2RlKFxuICAgICAgd29ya3NwYWNlOiBXb3Jrc3BhY2V8bnVsbCwgd3NDb29yZGluYXRlOiBDb29yZGluYXRlfG51bGwpOiBBU1ROb2RlfG51bGwge1xuICAgIGlmICghd3NDb29yZGluYXRlIHx8ICF3b3Jrc3BhY2UpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBwYXJhbXMgPSB7d3NDb29yZGluYXRlfTtcbiAgICByZXR1cm4gbmV3IEFTVE5vZGUoQVNUTm9kZS50eXBlcy5XT1JLU1BBQ0UsIHdvcmtzcGFjZSwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIEFTVCBub2RlIGZvciB0aGUgdG9wIHBvc2l0aW9uIG9uIGEgYmxvY2suXG4gICAqIFRoaXMgaXMgZWl0aGVyIGFuIG91dHB1dCBjb25uZWN0aW9uLCBwcmV2aW91cyBjb25uZWN0aW9uLCBvciBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBmaW5kIHRoZSB0b3AgbW9zdCBBU1Qgbm9kZSBvbi5cbiAgICogQHJldHVybnMgVGhlIEFTVCBub2RlIGhvbGRpbmcgdGhlIHRvcCBtb3N0IHBvc2l0aW9uIG9uIHRoZSBibG9jay5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVUb3BOb2RlKGJsb2NrOiBCbG9jayk6IEFTVE5vZGV8bnVsbCB7XG4gICAgbGV0IGFzdE5vZGU7XG4gICAgY29uc3QgdG9wQ29ubmVjdGlvbiA9IGdldFBhcmVudENvbm5lY3Rpb24oYmxvY2spO1xuICAgIGlmICh0b3BDb25uZWN0aW9uKSB7XG4gICAgICBhc3ROb2RlID0gQVNUTm9kZS5jcmVhdGVDb25uZWN0aW9uTm9kZSh0b3BDb25uZWN0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXN0Tm9kZSA9IEFTVE5vZGUuY3JlYXRlQmxvY2tOb2RlKGJsb2NrKTtcbiAgICB9XG4gICAgcmV0dXJuIGFzdE5vZGU7XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBBU1ROb2RlIHtcbiAgZXhwb3J0IGludGVyZmFjZSBQYXJhbXMge1xuICAgIHdzQ29vcmRpbmF0ZTogQ29vcmRpbmF0ZTtcbiAgfVxuXG4gIGV4cG9ydCBlbnVtIHR5cGVzIHtcbiAgICBGSUVMRCA9ICdmaWVsZCcsXG4gICAgQkxPQ0sgPSAnYmxvY2snLFxuICAgIElOUFVUID0gJ2lucHV0JyxcbiAgICBPVVRQVVQgPSAnb3V0cHV0JyxcbiAgICBORVhUID0gJ25leHQnLFxuICAgIFBSRVZJT1VTID0gJ3ByZXZpb3VzJyxcbiAgICBTVEFDSyA9ICdzdGFjaycsXG4gICAgV09SS1NQQUNFID0gJ3dvcmtzcGFjZScsXG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgUGFyYW1zID0gQVNUTm9kZS5QYXJhbXM7XG4vLyBObyBuZWVkIHRvIGV4cG9ydCBBU1ROb2RlLnR5cGVzIGZyb20gdGhlIG1vZHVsZSBhdCB0aGlzIHRpbWUgYmVjYXVzZSAoMSkgaXRcbi8vIHdhc24ndCBhdXRvbWF0aWNhbGx5IGNvbnZlcnRlZCBieSB0aGUgYXV0b21hdGljIG1pZ3JhdGlvbiBzY3JpcHQsICgyKSB0aGVcbi8vIG5hbWUgZG9lc24ndCBmb2xsb3cgdGhlIHN0eWxlZ3VpZGUuXG5cblxuLyoqXG4gKiBHZXRzIHRoZSBwYXJlbnQgY29ubmVjdGlvbiBvbiBhIGJsb2NrLlxuICogVGhpcyBpcyBlaXRoZXIgYW4gb3V0cHV0IGNvbm5lY3Rpb24sIHByZXZpb3VzIGNvbm5lY3Rpb24gb3IgdW5kZWZpbmVkLlxuICogSWYgYm90aCBjb25uZWN0aW9ucyBleGlzdCByZXR1cm4gdGhlIG9uZSB0aGF0IGlzIGFjdHVhbGx5IGNvbm5lY3RlZFxuICogdG8gYW5vdGhlciBibG9jay5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGZpbmQgdGhlIHBhcmVudCBjb25uZWN0aW9uIG9uLlxuICogQHJldHVybnMgVGhlIGNvbm5lY3Rpb24gY29ubmVjdGluZyB0byB0aGUgcGFyZW50IG9mIHRoZSBibG9jay5cbiAqL1xuZnVuY3Rpb24gZ2V0UGFyZW50Q29ubmVjdGlvbihibG9jazogQmxvY2spOiBDb25uZWN0aW9uIHtcbiAgbGV0IHRvcENvbm5lY3Rpb24gPSBibG9jay5vdXRwdXRDb25uZWN0aW9uO1xuICBpZiAoIXRvcENvbm5lY3Rpb24gfHxcbiAgICAgIGJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbiAmJiBibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkge1xuICAgIHRvcENvbm5lY3Rpb24gPSBibG9jay5wcmV2aW91c0Nvbm5lY3Rpb247XG4gIH1cbiAgcmV0dXJuIHRvcENvbm5lY3Rpb247XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWV0aG9kcyBhbmltYXRpbmcgYSBibG9jayBvbiBjb25uZWN0aW9uIGFuZCBkaXNjb25uZWN0aW9uLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5ibG9ja0FuaW1hdGlvbnNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja0FuaW1hdGlvbnMnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcblxuXG4vKiogQSBib3VuZGluZyBib3ggZm9yIGEgY2xvbmVkIGJsb2NrLiAqL1xuaW50ZXJmYWNlIENsb25lUmVjdCB7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbn1cblxuLyoqIFBJRCBvZiBkaXNjb25uZWN0IFVJIGFuaW1hdGlvbi4gIFRoZXJlIGNhbiBvbmx5IGJlIG9uZSBhdCBhIHRpbWUuICovXG5sZXQgZGlzY29ubmVjdFBpZDogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD58bnVsbCA9IG51bGw7XG5cbi8qKiBTVkcgZ3JvdXAgb2Ygd29iYmxpbmcgYmxvY2suICBUaGVyZSBjYW4gb25seSBiZSBvbmUgYXQgYSB0aW1lLiAqL1xubGV0IGRpc2Nvbm5lY3RHcm91cDogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuXG4vKipcbiAqIFBsYXkgc29tZSBVSSBlZmZlY3RzIChzb3VuZCwgYW5pbWF0aW9uKSB3aGVuIGRpc3Bvc2luZyBvZiBhIGJsb2NrLlxuICpcbiAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgYmVpbmcgZGlzcG9zZWQgb2YuXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja0FuaW1hdGlvbnMuZGlzcG9zZVVpRWZmZWN0XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRpc3Bvc2VVaUVmZmVjdChibG9jazogQmxvY2tTdmcpIHtcbiAgY29uc3Qgd29ya3NwYWNlID0gYmxvY2sud29ya3NwYWNlO1xuICBjb25zdCBzdmdHcm91cCA9IGJsb2NrLmdldFN2Z1Jvb3QoKTtcbiAgd29ya3NwYWNlLmdldEF1ZGlvTWFuYWdlcigpLnBsYXkoJ2RlbGV0ZScpO1xuXG4gIGNvbnN0IHh5ID0gd29ya3NwYWNlLmdldFN2Z1hZKHN2Z0dyb3VwKTtcbiAgLy8gRGVlcGx5IGNsb25lIHRoZSBjdXJyZW50IGJsb2NrLlxuICBjb25zdCBjbG9uZTogU1ZHR0VsZW1lbnQgPSBzdmdHcm91cC5jbG9uZU5vZGUodHJ1ZSkgYXMgU1ZHR0VsZW1lbnQ7XG4gIGNsb25lLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgeHkueCArICcsJyArIHh5LnkgKyAnKScpO1xuICB3b3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCkuYXBwZW5kQ2hpbGQoY2xvbmUpO1xuICBjb25zdCBjbG9uZVJlY3QgPVxuICAgICAgeyd4JzogeHkueCwgJ3knOiB4eS55LCAnd2lkdGgnOiBibG9jay53aWR0aCwgJ2hlaWdodCc6IGJsb2NrLmhlaWdodH07XG4gIGRpc3Bvc2VVaVN0ZXAoY2xvbmUsIGNsb25lUmVjdCwgd29ya3NwYWNlLlJUTCwgbmV3IERhdGUoKSwgd29ya3NwYWNlLnNjYWxlKTtcbn1cbi8qKlxuICogQW5pbWF0ZSBhIGNsb25lZCBibG9jayBhbmQgZXZlbnR1YWxseSBkaXNwb3NlIG9mIGl0LlxuICogVGhpcyBpcyBhIGNsYXNzIG1ldGhvZCwgbm90IGFuIGluc3RhbmNlIG1ldGhvZCBzaW5jZSB0aGUgb3JpZ2luYWwgYmxvY2sgaGFzXG4gKiBiZWVuIGRlc3Ryb3llZCBhbmQgaXMgbm8gbG9uZ2VyIGFjY2Vzc2libGUuXG4gKlxuICogQHBhcmFtIGNsb25lIFNWRyBlbGVtZW50IHRvIGFuaW1hdGUgYW5kIGRpc3Bvc2Ugb2YuXG4gKiBAcGFyYW0gcmVjdCBTdGFydGluZyByZWN0IG9mIHRoZSBjbG9uZS5cbiAqIEBwYXJhbSBydGwgVHJ1ZSBpZiBSVEwsIGZhbHNlIGlmIExUUi5cbiAqIEBwYXJhbSBzdGFydCBEYXRlIG9mIGFuaW1hdGlvbidzIHN0YXJ0LlxuICogQHBhcmFtIHdvcmtzcGFjZVNjYWxlIFNjYWxlIG9mIHdvcmtzcGFjZS5cbiAqL1xuZnVuY3Rpb24gZGlzcG9zZVVpU3RlcChcbiAgICBjbG9uZTogRWxlbWVudCwgcmVjdDogQ2xvbmVSZWN0LCBydGw6IGJvb2xlYW4sIHN0YXJ0OiBEYXRlLFxuICAgIHdvcmtzcGFjZVNjYWxlOiBudW1iZXIpIHtcbiAgY29uc3QgbXMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKTtcbiAgY29uc3QgcGVyY2VudCA9IG1zIC8gMTUwO1xuICBpZiAocGVyY2VudCA+IDEpIHtcbiAgICBkb20ucmVtb3ZlTm9kZShjbG9uZSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgeCA9XG4gICAgICAgIHJlY3QueCArIChydGwgPyAtMSA6IDEpICogcmVjdC53aWR0aCAqIHdvcmtzcGFjZVNjYWxlIC8gMiAqIHBlcmNlbnQ7XG4gICAgY29uc3QgeSA9IHJlY3QueSArIHJlY3QuaGVpZ2h0ICogd29ya3NwYWNlU2NhbGUgKiBwZXJjZW50O1xuICAgIGNvbnN0IHNjYWxlID0gKDEgLSBwZXJjZW50KSAqIHdvcmtzcGFjZVNjYWxlO1xuICAgIGNsb25lLnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICd0cmFuc2xhdGUoJyArIHggKyAnLCcgKyB5ICsgJyknICtcbiAgICAgICAgICAgICcgc2NhbGUoJyArIHNjYWxlICsgJyknKTtcbiAgICBzZXRUaW1lb3V0KGRpc3Bvc2VVaVN0ZXAsIDEwLCBjbG9uZSwgcmVjdCwgcnRsLCBzdGFydCwgd29ya3NwYWNlU2NhbGUpO1xuICB9XG59XG5cbi8qKlxuICogUGxheSBzb21lIFVJIGVmZmVjdHMgKHNvdW5kLCByaXBwbGUpIGFmdGVyIGEgY29ubmVjdGlvbiBoYXMgYmVlbiBlc3RhYmxpc2hlZC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIGJlaW5nIGNvbm5lY3RlZC5cbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrQW5pbWF0aW9ucy5jb25uZWN0aW9uVWlFZmZlY3RcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gY29ubmVjdGlvblVpRWZmZWN0KGJsb2NrOiBCbG9ja1N2Zykge1xuICBjb25zdCB3b3Jrc3BhY2UgPSBibG9jay53b3Jrc3BhY2U7XG4gIGNvbnN0IHNjYWxlID0gd29ya3NwYWNlLnNjYWxlO1xuICB3b3Jrc3BhY2UuZ2V0QXVkaW9NYW5hZ2VyKCkucGxheSgnY2xpY2snKTtcbiAgaWYgKHNjYWxlIDwgMSkge1xuICAgIHJldHVybjsgIC8vIFRvbyBzbWFsbCB0byBjYXJlIGFib3V0IHZpc3VhbCBlZmZlY3RzLlxuICB9XG4gIC8vIERldGVybWluZSB0aGUgYWJzb2x1dGUgY29vcmRpbmF0ZXMgb2YgdGhlIGluZmVyaW9yIGJsb2NrLlxuICBjb25zdCB4eSA9IHdvcmtzcGFjZS5nZXRTdmdYWShibG9jay5nZXRTdmdSb290KCkpO1xuICAvLyBPZmZzZXQgdGhlIGNvb3JkaW5hdGVzIGJhc2VkIG9uIHRoZSB0d28gY29ubmVjdGlvbiB0eXBlcywgZml4IHNjYWxlLlxuICBpZiAoYmxvY2sub3V0cHV0Q29ubmVjdGlvbikge1xuICAgIHh5LnggKz0gKGJsb2NrLlJUTCA/IDMgOiAtMykgKiBzY2FsZTtcbiAgICB4eS55ICs9IDEzICogc2NhbGU7XG4gIH0gZWxzZSBpZiAoYmxvY2sucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgeHkueCArPSAoYmxvY2suUlRMID8gLTIzIDogMjMpICogc2NhbGU7XG4gICAgeHkueSArPSAzICogc2NhbGU7XG4gIH1cbiAgY29uc3QgcmlwcGxlID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICBTdmcuQ0lSQ0xFLCB7XG4gICAgICAgICdjeCc6IHh5LngsXG4gICAgICAgICdjeSc6IHh5LnksXG4gICAgICAgICdyJzogMCxcbiAgICAgICAgJ2ZpbGwnOiAnbm9uZScsXG4gICAgICAgICdzdHJva2UnOiAnIzg4OCcsXG4gICAgICAgICdzdHJva2Utd2lkdGgnOiAxMCxcbiAgICAgIH0sXG4gICAgICB3b3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCkpO1xuICAvLyBTdGFydCB0aGUgYW5pbWF0aW9uLlxuICBjb25uZWN0aW9uVWlTdGVwKHJpcHBsZSwgbmV3IERhdGUoKSwgc2NhbGUpO1xufVxuXG4vKipcbiAqIEV4cGFuZCBhIHJpcHBsZSBhcm91bmQgYSBjb25uZWN0aW9uLlxuICpcbiAqIEBwYXJhbSByaXBwbGUgRWxlbWVudCB0byBhbmltYXRlLlxuICogQHBhcmFtIHN0YXJ0IERhdGUgb2YgYW5pbWF0aW9uJ3Mgc3RhcnQuXG4gKiBAcGFyYW0gc2NhbGUgU2NhbGUgb2Ygd29ya3NwYWNlLlxuICovXG5mdW5jdGlvbiBjb25uZWN0aW9uVWlTdGVwKHJpcHBsZTogU1ZHRWxlbWVudCwgc3RhcnQ6IERhdGUsIHNjYWxlOiBudW1iZXIpIHtcbiAgY29uc3QgbXMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKTtcbiAgY29uc3QgcGVyY2VudCA9IG1zIC8gMTUwO1xuICBpZiAocGVyY2VudCA+IDEpIHtcbiAgICBkb20ucmVtb3ZlTm9kZShyaXBwbGUpO1xuICB9IGVsc2Uge1xuICAgIHJpcHBsZS5zZXRBdHRyaWJ1dGUoJ3InLCAocGVyY2VudCAqIDI1ICogc2NhbGUpLnRvU3RyaW5nKCkpO1xuICAgIHJpcHBsZS5zdHlsZS5vcGFjaXR5ID0gKDEgLSBwZXJjZW50KS50b1N0cmluZygpO1xuICAgIGRpc2Nvbm5lY3RQaWQgPSBzZXRUaW1lb3V0KGNvbm5lY3Rpb25VaVN0ZXAsIDEwLCByaXBwbGUsIHN0YXJ0LCBzY2FsZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBQbGF5IHNvbWUgVUkgZWZmZWN0cyAoc291bmQsIGFuaW1hdGlvbikgd2hlbiBkaXNjb25uZWN0aW5nIGEgYmxvY2suXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBiZWluZyBkaXNjb25uZWN0ZWQuXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja0FuaW1hdGlvbnMuZGlzY29ubmVjdFVpRWZmZWN0XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRpc2Nvbm5lY3RVaUVmZmVjdChibG9jazogQmxvY2tTdmcpIHtcbiAgZGlzY29ubmVjdFVpU3RvcCgpO1xuICBibG9jay53b3Jrc3BhY2UuZ2V0QXVkaW9NYW5hZ2VyKCkucGxheSgnZGlzY29ubmVjdCcpO1xuICBpZiAoYmxvY2sud29ya3NwYWNlLnNjYWxlIDwgMSkge1xuICAgIHJldHVybjsgIC8vIFRvbyBzbWFsbCB0byBjYXJlIGFib3V0IHZpc3VhbCBlZmZlY3RzLlxuICB9XG4gIC8vIEhvcml6b250YWwgZGlzdGFuY2UgZm9yIGJvdHRvbSBvZiBibG9jayB0byB3aWdnbGUuXG4gIGNvbnN0IERJU1BMQUNFTUVOVCA9IDEwO1xuICAvLyBTY2FsZSBtYWduaXR1ZGUgb2Ygc2tldyB0byBoZWlnaHQgb2YgYmxvY2suXG4gIGNvbnN0IGhlaWdodCA9IGJsb2NrLmdldEhlaWdodFdpZHRoKCkuaGVpZ2h0O1xuICBsZXQgbWFnbml0dWRlID0gTWF0aC5hdGFuKERJU1BMQUNFTUVOVCAvIGhlaWdodCkgLyBNYXRoLlBJICogMTgwO1xuICBpZiAoIWJsb2NrLlJUTCkge1xuICAgIG1hZ25pdHVkZSAqPSAtMTtcbiAgfVxuICAvLyBTdGFydCB0aGUgYW5pbWF0aW9uLlxuICBkaXNjb25uZWN0R3JvdXAgPSBibG9jay5nZXRTdmdSb290KCk7XG4gIGRpc2Nvbm5lY3RVaVN0ZXAoZGlzY29ubmVjdEdyb3VwLCBtYWduaXR1ZGUsIG5ldyBEYXRlKCkpO1xufVxuXG4vKipcbiAqIEFuaW1hdGUgYSBicmllZiB3aWdnbGUgb2YgYSBkaXNjb25uZWN0ZWQgYmxvY2suXG4gKlxuICogQHBhcmFtIGdyb3VwIFNWRyBlbGVtZW50IHRvIGFuaW1hdGUuXG4gKiBAcGFyYW0gbWFnbml0dWRlIE1heGltdW0gZGVncmVlcyBza2V3IChyZXZlcnNlZCBmb3IgUlRMKS5cbiAqIEBwYXJhbSBzdGFydCBEYXRlIG9mIGFuaW1hdGlvbidzIHN0YXJ0LlxuICovXG5mdW5jdGlvbiBkaXNjb25uZWN0VWlTdGVwKGdyb3VwOiBTVkdFbGVtZW50LCBtYWduaXR1ZGU6IG51bWJlciwgc3RhcnQ6IERhdGUpIHtcbiAgY29uc3QgRFVSQVRJT04gPSAyMDA7ICAvLyBNaWxsaXNlY29uZHMuXG4gIGNvbnN0IFdJR0dMRVMgPSAzOyAgICAgLy8gSGFsZiBvc2NpbGxhdGlvbnMuXG5cbiAgY29uc3QgbXMgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKTtcbiAgY29uc3QgcGVyY2VudCA9IG1zIC8gRFVSQVRJT047XG5cbiAgbGV0IHNrZXcgPSAnJztcbiAgaWYgKHBlcmNlbnQgPD0gMSkge1xuICAgIGNvbnN0IHZhbCA9IE1hdGgucm91bmQoXG4gICAgICAgIE1hdGguc2luKHBlcmNlbnQgKiBNYXRoLlBJICogV0lHR0xFUykgKiAoMSAtIHBlcmNlbnQpICogbWFnbml0dWRlKTtcbiAgICBza2V3ID0gYHNrZXdYKCR7dmFsfSlgO1xuICAgIGRpc2Nvbm5lY3RQaWQgPSBzZXRUaW1lb3V0KGRpc2Nvbm5lY3RVaVN0ZXAsIDEwLCBncm91cCwgbWFnbml0dWRlLCBzdGFydCk7XG4gIH1cbiAgKGdyb3VwIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc2tld18gPSBza2V3O1xuICBncm91cC5zZXRBdHRyaWJ1dGUoXG4gICAgICAndHJhbnNmb3JtJyxcbiAgICAgIChncm91cCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRyYW5zbGF0ZV8gK1xuICAgICAgICAgIChncm91cCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnNrZXdfKTtcbn1cblxuLyoqXG4gKiBTdG9wIHRoZSBkaXNjb25uZWN0IFVJIGFuaW1hdGlvbiBpbW1lZGlhdGVseS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja0FuaW1hdGlvbnMuZGlzY29ubmVjdFVpU3RvcFxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkaXNjb25uZWN0VWlTdG9wKCkge1xuICBpZiAoZGlzY29ubmVjdEdyb3VwKSB7XG4gICAgaWYgKGRpc2Nvbm5lY3RQaWQpIHtcbiAgICAgIGNsZWFyVGltZW91dChkaXNjb25uZWN0UGlkKTtcbiAgICB9XG4gICAgY29uc3QgZ3JvdXAgPSBkaXNjb25uZWN0R3JvdXA7XG4gICAgKGdyb3VwIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc2tld18gPSAnJztcbiAgICBncm91cC5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsIChncm91cCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRyYW5zbGF0ZV8pO1xuICAgIGRpc2Nvbm5lY3RHcm91cCA9IG51bGw7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBCbG9ja2x5J3MgaW50ZXJuYWwgY2xpcGJvYXJkIGZvciBtYW5hZ2luZyBjb3B5LXBhc3RlLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5jbGlwYm9hcmRcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5jbGlwYm9hcmQnKTtcblxuaW1wb3J0IHR5cGUge0NvcHlEYXRhLCBJQ29weWFibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2NvcHlhYmxlLmpzJztcblxuXG4vKiogTWV0YWRhdGEgYWJvdXQgdGhlIG9iamVjdCB0aGF0IGlzIGN1cnJlbnRseSBvbiB0aGUgY2xpcGJvYXJkLiAqL1xubGV0IGNvcHlEYXRhOiBDb3B5RGF0YXxudWxsID0gbnVsbDtcblxuLyoqXG4gKiBDb3B5IGEgYmxvY2sgb3Igd29ya3NwYWNlIGNvbW1lbnQgb250byB0aGUgbG9jYWwgY2xpcGJvYXJkLlxuICpcbiAqIEBwYXJhbSB0b0NvcHkgQmxvY2sgb3IgV29ya3NwYWNlIENvbW1lbnQgdG8gYmUgY29waWVkLlxuICogQGFsaWFzIEJsb2NrbHkuY2xpcGJvYXJkLmNvcHlcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gY29weSh0b0NvcHk6IElDb3B5YWJsZSkge1xuICBURVNUX09OTFkuY29weUludGVybmFsKHRvQ29weSk7XG59XG5cbi8qKlxuICogUHJpdmF0ZSB2ZXJzaW9uIG9mIGNvcHkgZm9yIHN0dWJiaW5nIGluIHRlc3RzLlxuICovXG5mdW5jdGlvbiBjb3B5SW50ZXJuYWwodG9Db3B5OiBJQ29weWFibGUpIHtcbiAgY29weURhdGEgPSB0b0NvcHkudG9Db3B5RGF0YSgpO1xufVxuXG4vKipcbiAqIFBhc3RlIGEgYmxvY2sgb3Igd29ya3NwYWNlIGNvbW1lbnQgb24gdG8gdGhlIG1haW4gd29ya3NwYWNlLlxuICpcbiAqIEByZXR1cm5zIFRoZSBwYXN0ZWQgdGhpbmcgaWYgdGhlIHBhc3RlIHdhcyBzdWNjZXNzZnVsLCBudWxsIG90aGVyd2lzZS5cbiAqIEBhbGlhcyBCbG9ja2x5LmNsaXBib2FyZC5wYXN0ZVxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXN0ZSgpOiBJQ29weWFibGV8bnVsbCB7XG4gIGlmICghY29weURhdGEpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICAvLyBQYXN0aW5nIGFsd2F5cyBwYXN0ZXMgdG8gdGhlIG1haW4gd29ya3NwYWNlLCBldmVuIGlmIHRoZSBjb3B5XG4gIC8vIHN0YXJ0ZWQgaW4gYSBmbHlvdXQgd29ya3NwYWNlLlxuICBsZXQgd29ya3NwYWNlID0gY29weURhdGEuc291cmNlO1xuICBpZiAod29ya3NwYWNlLmlzRmx5b3V0KSB7XG4gICAgd29ya3NwYWNlID0gd29ya3NwYWNlLnRhcmdldFdvcmtzcGFjZSE7XG4gIH1cbiAgaWYgKGNvcHlEYXRhLnR5cGVDb3VudHMgJiZcbiAgICAgIHdvcmtzcGFjZS5pc0NhcGFjaXR5QXZhaWxhYmxlKGNvcHlEYXRhLnR5cGVDb3VudHMpKSB7XG4gICAgcmV0dXJuIHdvcmtzcGFjZS5wYXN0ZShjb3B5RGF0YS5zYXZlSW5mbyk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogRHVwbGljYXRlIHRoaXMgYmxvY2sgYW5kIGl0cyBjaGlsZHJlbiwgb3IgYSB3b3Jrc3BhY2UgY29tbWVudC5cbiAqXG4gKiBAcGFyYW0gdG9EdXBsaWNhdGUgQmxvY2sgb3IgV29ya3NwYWNlIENvbW1lbnQgdG8gYmUgZHVwbGljYXRlZC5cbiAqIEByZXR1cm5zIFRoZSBibG9jayBvciB3b3Jrc3BhY2UgY29tbWVudCB0aGF0IHdhcyBkdXBsaWNhdGVkLCBvciBudWxsIGlmIHRoZVxuICogICAgIGR1cGxpY2F0aW9uIGZhaWxlZC5cbiAqIEBhbGlhcyBCbG9ja2x5LmNsaXBib2FyZC5kdXBsaWNhdGVcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZHVwbGljYXRlKHRvRHVwbGljYXRlOiBJQ29weWFibGUpOiBJQ29weWFibGV8bnVsbCB7XG4gIHJldHVybiBURVNUX09OTFkuZHVwbGljYXRlSW50ZXJuYWwodG9EdXBsaWNhdGUpO1xufVxuXG4vKipcbiAqIFByaXZhdGUgdmVyc2lvbiBvZiBkdXBsaWNhdGUgZm9yIHN0dWJiaW5nIGluIHRlc3RzLlxuICovXG5mdW5jdGlvbiBkdXBsaWNhdGVJbnRlcm5hbCh0b0R1cGxpY2F0ZTogSUNvcHlhYmxlKTogSUNvcHlhYmxlfG51bGwge1xuICBjb25zdCBvbGRDb3B5RGF0YSA9IGNvcHlEYXRhO1xuICBjb3B5KHRvRHVwbGljYXRlKTtcbiAgY29uc3QgcGFzdGVkVGhpbmcgPVxuICAgICAgdG9EdXBsaWNhdGUudG9Db3B5RGF0YSgpPy5zb3VyY2U/LnBhc3RlKGNvcHlEYXRhIS5zYXZlSW5mbykgPz8gbnVsbDtcbiAgY29weURhdGEgPSBvbGRDb3B5RGF0YTtcbiAgcmV0dXJuIHBhc3RlZFRoaW5nO1xufVxuXG5leHBvcnQgY29uc3QgVEVTVF9PTkxZID0ge1xuICBkdXBsaWNhdGVJbnRlcm5hbCxcbiAgY29weUludGVybmFsLFxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDExIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBGdW5jdGlvbmFsaXR5IGZvciB0aGUgcmlnaHQtY2xpY2sgY29udGV4dCBtZW51cy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuQ29udGV4dE1lbnVcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db250ZXh0TWVudScpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBicm93c2VyRXZlbnRzIGZyb20gJy4vYnJvd3Nlcl9ldmVudHMuanMnO1xuaW1wb3J0ICogYXMgY2xpcGJvYXJkIGZyb20gJy4vY2xpcGJvYXJkLmpzJztcbmltcG9ydCB7Y29uZmlnfSBmcm9tICcuL2NvbmZpZy5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHR5cGUge0NvbnRleHRNZW51T3B0aW9uLCBMZWdhY3lDb250ZXh0TWVudU9wdGlvbn0gZnJvbSAnLi9jb250ZXh0bWVudV9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB7TWVudX0gZnJvbSAnLi9tZW51LmpzJztcbmltcG9ydCB7TWVudUl0ZW19IGZyb20gJy4vbWVudWl0ZW0uanMnO1xuaW1wb3J0IHtNc2d9IGZyb20gJy4vbXNnLmpzJztcbmltcG9ydCAqIGFzIGFyaWEgZnJvbSAnLi91dGlscy9hcmlhLmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCB7UmVjdH0gZnJvbSAnLi91dGlscy9yZWN0LmpzJztcbmltcG9ydCAqIGFzIHN2Z01hdGggZnJvbSAnLi91dGlscy9zdmdfbWF0aC5qcyc7XG5pbXBvcnQgKiBhcyBXaWRnZXREaXYgZnJvbSAnLi93aWRnZXRkaXYuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VDb21tZW50U3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9jb21tZW50X3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4veG1sLmpzJztcblxuXG4vKipcbiAqIFdoaWNoIGJsb2NrIGlzIHRoZSBjb250ZXh0IG1lbnUgYXR0YWNoZWQgdG8/XG4gKi9cbmxldCBjdXJyZW50QmxvY2s6IEJsb2NrfG51bGwgPSBudWxsO1xuXG5jb25zdCBkdW1teU93bmVyID0ge307XG5cbi8qKlxuICogR2V0cyB0aGUgYmxvY2sgdGhlIGNvbnRleHQgbWVudSBpcyBjdXJyZW50bHkgYXR0YWNoZWQgdG8uXG4gKlxuICogQHJldHVybnMgVGhlIGJsb2NrIHRoZSBjb250ZXh0IG1lbnUgaXMgYXR0YWNoZWQgdG8uXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudS5nZXRDdXJyZW50QmxvY2tcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRCbG9jaygpOiBCbG9ja3xudWxsIHtcbiAgcmV0dXJuIGN1cnJlbnRCbG9jaztcbn1cblxuLyoqXG4gKiBTZXRzIHRoZSBibG9jayB0aGUgY29udGV4dCBtZW51IGlzIGN1cnJlbnRseSBhdHRhY2hlZCB0by5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRoZSBjb250ZXh0IG1lbnUgaXMgYXR0YWNoZWQgdG8uXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudS5zZXRDdXJyZW50QmxvY2tcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEN1cnJlbnRCbG9jayhibG9jazogQmxvY2t8bnVsbCkge1xuICBjdXJyZW50QmxvY2sgPSBibG9jaztcbn1cblxuLyoqXG4gKiBNZW51IG9iamVjdC5cbiAqL1xubGV0IG1lbnVfOiBNZW51fG51bGwgPSBudWxsO1xuXG4vKipcbiAqIENvbnN0cnVjdCB0aGUgbWVudSBiYXNlZCBvbiB0aGUgbGlzdCBvZiBvcHRpb25zIGFuZCBzaG93IHRoZSBtZW51LlxuICpcbiAqIEBwYXJhbSBlIE1vdXNlIGV2ZW50LlxuICogQHBhcmFtIG9wdGlvbnMgQXJyYXkgb2YgbWVudSBvcHRpb25zLlxuICogQHBhcmFtIHJ0bCBUcnVlIGlmIFJUTCwgZmFsc2UgaWYgTFRSLlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnUuc2hvd1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvdyhcbiAgICBlOiBFdmVudCwgb3B0aW9uczogKENvbnRleHRNZW51T3B0aW9ufExlZ2FjeUNvbnRleHRNZW51T3B0aW9uKVtdLFxuICAgIHJ0bDogYm9vbGVhbikge1xuICBXaWRnZXREaXYuc2hvdyhkdW1teU93bmVyLCBydGwsIGRpc3Bvc2UpO1xuICBpZiAoIW9wdGlvbnMubGVuZ3RoKSB7XG4gICAgaGlkZSgpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBtZW51ID0gcG9wdWxhdGVfKG9wdGlvbnMsIHJ0bCk7XG4gIG1lbnVfID0gbWVudTtcblxuICBwb3NpdGlvbl8obWVudSwgZSwgcnRsKTtcbiAgLy8gMW1zIGRlbGF5IGlzIHJlcXVpcmVkIGZvciBmb2N1c2luZyBvbiBjb250ZXh0IG1lbnVzIGJlY2F1c2Ugc29tZSBvdGhlclxuICAvLyBtb3VzZSBldmVudCBpcyBzdGlsbCB3YWl0aW5nIGluIHRoZSBxdWV1ZSBhbmQgY2xlYXJzIGZvY3VzLlxuICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgIG1lbnUuZm9jdXMoKTtcbiAgfSwgMSk7XG4gIGN1cnJlbnRCbG9jayA9IG51bGw7ICAvLyBNYXkgYmUgc2V0IGJ5IEJsb2NrbHkuQmxvY2suXG59XG5cbi8qKlxuICogQ3JlYXRlIHRoZSBjb250ZXh0IG1lbnUgb2JqZWN0IGFuZCBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBnaXZlbiBvcHRpb25zLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zIEFycmF5IG9mIG1lbnUgb3B0aW9ucy5cbiAqIEBwYXJhbSBydGwgVHJ1ZSBpZiBSVEwsIGZhbHNlIGlmIExUUi5cbiAqIEByZXR1cm5zIFRoZSBtZW51IHRoYXQgd2lsbCBiZSBzaG93biBvbiByaWdodCBjbGljay5cbiAqL1xuZnVuY3Rpb24gcG9wdWxhdGVfKFxuICAgIG9wdGlvbnM6IChDb250ZXh0TWVudU9wdGlvbnxMZWdhY3lDb250ZXh0TWVudU9wdGlvbilbXSxcbiAgICBydGw6IGJvb2xlYW4pOiBNZW51IHtcbiAgLyogSGVyZSdzIHdoYXQgb25lIG9wdGlvbiBvYmplY3QgbG9va3MgbGlrZTpcbiAgICAgIHt0ZXh0OiAnTWFrZSBJdCBTbycsXG4gICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICBjYWxsYmFjazogQmxvY2tseS5NYWtlSXRTb31cbiAgICAqL1xuICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcbiAgbWVudS5zZXRSb2xlKGFyaWEuUm9sZS5NRU5VKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3Qgb3B0aW9uID0gb3B0aW9uc1tpXTtcbiAgICBjb25zdCBtZW51SXRlbSA9IG5ldyBNZW51SXRlbShvcHRpb24udGV4dCk7XG4gICAgbWVudUl0ZW0uc2V0UmlnaHRUb0xlZnQocnRsKTtcbiAgICBtZW51SXRlbS5zZXRSb2xlKGFyaWEuUm9sZS5NRU5VSVRFTSk7XG4gICAgbWVudS5hZGRDaGlsZChtZW51SXRlbSk7XG4gICAgbWVudUl0ZW0uc2V0RW5hYmxlZChvcHRpb24uZW5hYmxlZCk7XG4gICAgaWYgKG9wdGlvbi5lbmFibGVkKSB7XG4gICAgICBjb25zdCBhY3Rpb25IYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgLy8gSWYgLnNjb3BlIGRvZXMgbm90IGV4aXN0IG9uIHRoZSBvcHRpb24sIHRoZW4gdGhlIGNhbGxiYWNrIHdpbGwgbm90XG4gICAgICAgIC8vIGJlIGV4cGVjdGluZyBhIHNjb3BlIHBhcmFtZXRlciwgc28gdGhlcmUgc2hvdWxkIGJlIG5vIHByb2JsZW1zLiBKdXN0XG4gICAgICAgIC8vIGFzc3VtZSBpdCBpcyBhIENvbnRleHRNZW51T3B0aW9uIGFuZCB3ZSdsbCBwYXNzIHVuZGVmaW5lZCBpZiBpdCdzXG4gICAgICAgIC8vIG5vdC5cbiAgICAgICAgb3B0aW9uLmNhbGxiYWNrKChvcHRpb24gYXMgQ29udGV4dE1lbnVPcHRpb24pLnNjb3BlKTtcbiAgICAgIH07XG4gICAgICBtZW51SXRlbS5vbkFjdGlvbihhY3Rpb25IYW5kbGVyLCB7fSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBtZW51O1xufVxuXG4vKipcbiAqIEFkZCB0aGUgbWVudSB0byB0aGUgcGFnZSBhbmQgcG9zaXRpb24gaXQgY29ycmVjdGx5LlxuICpcbiAqIEBwYXJhbSBtZW51IFRoZSBtZW51IHRvIGFkZCBhbmQgcG9zaXRpb24uXG4gKiBAcGFyYW0gZSBNb3VzZSBldmVudCBmb3IgdGhlIHJpZ2h0IGNsaWNrIHRoYXQgaXMgbWFraW5nIHRoZSBjb250ZXh0XG4gKiAgICAgbWVudSBhcHBlYXIuXG4gKiBAcGFyYW0gcnRsIFRydWUgaWYgUlRMLCBmYWxzZSBpZiBMVFIuXG4gKi9cbmZ1bmN0aW9uIHBvc2l0aW9uXyhtZW51OiBNZW51LCBlOiBFdmVudCwgcnRsOiBib29sZWFuKSB7XG4gIC8vIFJlY29yZCB3aW5kb3dTaXplIGFuZCBzY3JvbGxPZmZzZXQgYmVmb3JlIGFkZGluZyBtZW51LlxuICBjb25zdCB2aWV3cG9ydEJCb3ggPSBzdmdNYXRoLmdldFZpZXdwb3J0QkJveCgpO1xuICBjb25zdCBtb3VzZUV2ZW50ID0gZSBhcyBNb3VzZUV2ZW50O1xuICAvLyBUaGlzIG9uZSBpcyBqdXN0IGEgcG9pbnQsIGJ1dCB3ZSdsbCBwcmV0ZW5kIHRoYXQgaXQncyBhIHJlY3Qgc28gd2UgY2FuIHVzZVxuICAvLyBzb21lIGhlbHBlciBmdW5jdGlvbnMuXG4gIGNvbnN0IGFuY2hvckJCb3ggPSBuZXcgUmVjdChcbiAgICAgIG1vdXNlRXZlbnQuY2xpZW50WSArIHZpZXdwb3J0QkJveC50b3AsXG4gICAgICBtb3VzZUV2ZW50LmNsaWVudFkgKyB2aWV3cG9ydEJCb3gudG9wLFxuICAgICAgbW91c2VFdmVudC5jbGllbnRYICsgdmlld3BvcnRCQm94LmxlZnQsXG4gICAgICBtb3VzZUV2ZW50LmNsaWVudFggKyB2aWV3cG9ydEJCb3gubGVmdCk7XG5cbiAgY3JlYXRlV2lkZ2V0XyhtZW51KTtcbiAgY29uc3QgbWVudVNpemUgPSBtZW51LmdldFNpemUoKTtcblxuICBpZiAocnRsKSB7XG4gICAgYW5jaG9yQkJveC5sZWZ0ICs9IG1lbnVTaXplLndpZHRoO1xuICAgIGFuY2hvckJCb3gucmlnaHQgKz0gbWVudVNpemUud2lkdGg7XG4gICAgdmlld3BvcnRCQm94LmxlZnQgKz0gbWVudVNpemUud2lkdGg7XG4gICAgdmlld3BvcnRCQm94LnJpZ2h0ICs9IG1lbnVTaXplLndpZHRoO1xuICB9XG5cbiAgV2lkZ2V0RGl2LnBvc2l0aW9uV2l0aEFuY2hvcih2aWV3cG9ydEJCb3gsIGFuY2hvckJCb3gsIG1lbnVTaXplLCBydGwpO1xuICAvLyBDYWxsaW5nIG1lbnVEb20uZm9jdXMoKSBoYXMgdG8gd2FpdCB1bnRpbCBhZnRlciB0aGUgbWVudSBoYXMgYmVlbiBwbGFjZWRcbiAgLy8gY29ycmVjdGx5LiAgT3RoZXJ3aXNlIGl0IHdpbGwgY2F1c2UgYSBwYWdlIHNjcm9sbCB0byBnZXQgdGhlIG1pc3BsYWNlZCBtZW51XG4gIC8vIGluIHZpZXcuICBTZWUgaXNzdWUgIzEzMjkuXG4gIG1lbnUuZm9jdXMoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYW5kIHJlbmRlciB0aGUgbWVudSB3aWRnZXQgaW5zaWRlIEJsb2NrbHkncyB3aWRnZXQgZGl2LlxuICpcbiAqIEBwYXJhbSBtZW51IFRoZSBtZW51IHRvIGFkZCB0byB0aGUgd2lkZ2V0IGRpdi5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlV2lkZ2V0XyhtZW51OiBNZW51KSB7XG4gIGNvbnN0IGRpdiA9IFdpZGdldERpdi5nZXREaXYoKTtcbiAgaWYgKCFkaXYpIHtcbiAgICB0aHJvdyBFcnJvcignQXR0ZW1wdGluZyB0byBjcmVhdGUgYSBjb250ZXh0IG1lbnUgd2hlbiB3aWRnZXQgZGl2IGlzIG51bGwnKTtcbiAgfVxuICBjb25zdCBtZW51RG9tID0gbWVudS5yZW5kZXIoZGl2KTtcbiAgZG9tLmFkZENsYXNzKG1lbnVEb20sICdibG9ja2x5Q29udGV4dE1lbnUnKTtcbiAgLy8gUHJldmVudCBzeXN0ZW0gY29udGV4dCBtZW51IHdoZW4gcmlnaHQtY2xpY2tpbmcgYSBCbG9ja2x5IGNvbnRleHQgbWVudS5cbiAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAobWVudURvbSBhcyBFdmVudFRhcmdldCksICdjb250ZXh0bWVudScsIG51bGwsIGhhbHRQcm9wYWdhdGlvbik7XG4gIC8vIEZvY3VzIG9ubHkgYWZ0ZXIgdGhlIGluaXRpYWwgcmVuZGVyIHRvIGF2b2lkIGlzc3VlICMxMzI5LlxuICBtZW51LmZvY3VzKCk7XG59XG4vKipcbiAqIEhhbHRzIHRoZSBwcm9wYWdhdGlvbiBvZiB0aGUgZXZlbnQgd2l0aG91dCBkb2luZyBhbnl0aGluZyBlbHNlLlxuICpcbiAqIEBwYXJhbSBlIEFuIGV2ZW50LlxuICovXG5mdW5jdGlvbiBoYWx0UHJvcGFnYXRpb24oZTogRXZlbnQpIHtcbiAgLy8gVGhpcyBldmVudCBoYXMgYmVlbiBoYW5kbGVkLiAgTm8gbmVlZCB0byBidWJibGUgdXAgdG8gdGhlIGRvY3VtZW50LlxuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG59XG5cbi8qKlxuICogSGlkZSB0aGUgY29udGV4dCBtZW51LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51LmhpZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGUoKSB7XG4gIFdpZGdldERpdi5oaWRlSWZPd25lcihkdW1teU93bmVyKTtcbiAgY3VycmVudEJsb2NrID0gbnVsbDtcbn1cblxuLyoqXG4gKiBEaXNwb3NlIG9mIHRoZSBtZW51LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51LmRpc3Bvc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gIGlmIChtZW51Xykge1xuICAgIG1lbnVfLmRpc3Bvc2UoKTtcbiAgICBtZW51XyA9IG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYW5kIGNvbmZpZ3VyZXMgYSBibG9jayxcbiAqICAgdGhlbiBwbGFjZXMgdGhlIG5ldyBibG9jayBuZXh0IHRvIHRoZSBvcmlnaW5hbC5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgT3JpZ2luYWwgYmxvY2suXG4gKiBAcGFyYW0geG1sIFhNTCByZXByZXNlbnRhdGlvbiBvZiBuZXcgYmxvY2suXG4gKiBAcmV0dXJucyBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBibG9jay5cbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51LmNhbGxiYWNrRmFjdG9yeVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsbGJhY2tGYWN0b3J5KGJsb2NrOiBCbG9jaywgeG1sOiBFbGVtZW50KTogRnVuY3Rpb24ge1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuICAgIGxldCBuZXdCbG9jaztcbiAgICB0cnkge1xuICAgICAgbmV3QmxvY2sgPSBYbWwuZG9tVG9CbG9jayh4bWwsIGJsb2NrLndvcmtzcGFjZSEpIGFzIEJsb2NrU3ZnO1xuICAgICAgLy8gTW92ZSB0aGUgbmV3IGJsb2NrIG5leHQgdG8gdGhlIG9sZCBibG9jay5cbiAgICAgIGNvbnN0IHh5ID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgICAgaWYgKGJsb2NrLlJUTCkge1xuICAgICAgICB4eS54IC09IGNvbmZpZy5zbmFwUmFkaXVzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgeHkueCArPSBjb25maWcuc25hcFJhZGl1cztcbiAgICAgIH1cbiAgICAgIHh5LnkgKz0gY29uZmlnLnNuYXBSYWRpdXMgKiAyO1xuICAgICAgbmV3QmxvY2subW92ZUJ5KHh5LngsIHh5LnkpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBldmVudFV0aWxzLmVuYWJsZSgpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSAmJiAhbmV3QmxvY2suaXNTaGFkb3coKSkge1xuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19DUkVBVEUpKShuZXdCbG9jaykpO1xuICAgIH1cbiAgICBuZXdCbG9jay5zZWxlY3QoKTtcbiAgfTtcbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgY3JlYXRpbmcgY29udGV4dCBtZW51IG9wdGlvbnMuXG5cbi8qKlxuICogTWFrZSBhIGNvbnRleHQgbWVudSBvcHRpb24gZm9yIGRlbGV0aW5nIHRoZSBjdXJyZW50IHdvcmtzcGFjZSBjb21tZW50LlxuICpcbiAqIEBwYXJhbSBjb21tZW50IFRoZSB3b3Jrc3BhY2UgY29tbWVudCB3aGVyZSB0aGVcbiAqICAgICByaWdodC1jbGljayBvcmlnaW5hdGVkLlxuICogQHJldHVybnMgQSBtZW51IG9wdGlvbixcbiAqICAgICBjb250YWluaW5nIHRleHQsIGVuYWJsZWQsIGFuZCBhIGNhbGxiYWNrLlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnUuY29tbWVudERlbGV0ZU9wdGlvblxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21tZW50RGVsZXRlT3B0aW9uKGNvbW1lbnQ6IFdvcmtzcGFjZUNvbW1lbnRTdmcpOlxuICAgIExlZ2FjeUNvbnRleHRNZW51T3B0aW9uIHtcbiAgY29uc3QgZGVsZXRlT3B0aW9uID0ge1xuICAgIHRleHQ6IE1zZ1snUkVNT1ZFX0NPTU1FTlQnXSxcbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAodHJ1ZSk7XG4gICAgICBjb21tZW50LmRpc3Bvc2UoKTtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgIH0sXG4gIH07XG4gIHJldHVybiBkZWxldGVPcHRpb247XG59XG5cbi8qKlxuICogTWFrZSBhIGNvbnRleHQgbWVudSBvcHRpb24gZm9yIGR1cGxpY2F0aW5nIHRoZSBjdXJyZW50IHdvcmtzcGFjZSBjb21tZW50LlxuICpcbiAqIEBwYXJhbSBjb21tZW50IFRoZSB3b3Jrc3BhY2UgY29tbWVudCB3aGVyZSB0aGVcbiAqICAgICByaWdodC1jbGljayBvcmlnaW5hdGVkLlxuICogQHJldHVybnMgQSBtZW51IG9wdGlvbixcbiAqICAgICBjb250YWluaW5nIHRleHQsIGVuYWJsZWQsIGFuZCBhIGNhbGxiYWNrLlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnUuY29tbWVudER1cGxpY2F0ZU9wdGlvblxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21tZW50RHVwbGljYXRlT3B0aW9uKGNvbW1lbnQ6IFdvcmtzcGFjZUNvbW1lbnRTdmcpOlxuICAgIExlZ2FjeUNvbnRleHRNZW51T3B0aW9uIHtcbiAgY29uc3QgZHVwbGljYXRlT3B0aW9uID0ge1xuICAgIHRleHQ6IE1zZ1snRFVQTElDQVRFX0NPTU1FTlQnXSxcbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICAgIGNsaXBib2FyZC5kdXBsaWNhdGUoY29tbWVudCk7XG4gICAgfSxcbiAgfTtcbiAgcmV0dXJuIGR1cGxpY2F0ZU9wdGlvbjtcbn1cblxuLyoqXG4gKiBNYWtlIGEgY29udGV4dCBtZW51IG9wdGlvbiBmb3IgYWRkaW5nIGEgY29tbWVudCBvbiB0aGUgd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSB3cyBUaGUgd29ya3NwYWNlIHdoZXJlIHRoZSByaWdodC1jbGlja1xuICogICAgIG9yaWdpbmF0ZWQuXG4gKiBAcGFyYW0gZSBUaGUgcmlnaHQtY2xpY2sgbW91c2UgZXZlbnQuXG4gKiBAcmV0dXJucyBBIG1lbnUgb3B0aW9uLCBjb250YWluaW5nIHRleHQsIGVuYWJsZWQsIGFuZCBhIGNhbGxiYWNrLlxuICogQHN1cHByZXNzIHtzdHJpY3RNb2R1bGVEZXBDaGVjayxjaGVja1R5cGVzfSBTdXBwcmVzcyBjaGVja3Mgd2hpbGUgd29ya3NwYWNlXG4gKiAgICAgY29tbWVudHMgYXJlIG5vdCBidW5kbGVkIGluLlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnUud29ya3NwYWNlQ29tbWVudE9wdGlvblxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3b3Jrc3BhY2VDb21tZW50T3B0aW9uKFxuICAgIHdzOiBXb3Jrc3BhY2VTdmcsIGU6IEV2ZW50KTogQ29udGV4dE1lbnVPcHRpb24ge1xuICAvKipcbiAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhbmQgcG9zaXRpb24gYSBjb21tZW50IGNvcnJlY3RseSBiYXNlZCBvbiB0aGVcbiAgICogbG9jYXRpb24gb2YgdGhlIG1vdXNlIGV2ZW50LlxuICAgKi9cbiAgZnVuY3Rpb24gYWRkV3NDb21tZW50KCkge1xuICAgIGNvbnN0IGNvbW1lbnQgPSBuZXcgV29ya3NwYWNlQ29tbWVudFN2ZyhcbiAgICAgICAgd3MsIE1zZ1snV09SS1NQQUNFX0NPTU1FTlRfREVGQVVMVF9URVhUJ10sXG4gICAgICAgIFdvcmtzcGFjZUNvbW1lbnRTdmcuREVGQVVMVF9TSVpFLCBXb3Jrc3BhY2VDb21tZW50U3ZnLkRFRkFVTFRfU0laRSk7XG5cbiAgICBjb25zdCBpbmplY3Rpb25EaXYgPSB3cy5nZXRJbmplY3Rpb25EaXYoKTtcbiAgICAvLyBCb3VuZGluZyByZWN0IGNvb3JkaW5hdGVzIGFyZSBpbiBjbGllbnQgY29vcmRpbmF0ZXMsIG1lYW5pbmcgdGhhdCB0aGV5XG4gICAgLy8gYXJlIGluIHBpeGVscyByZWxhdGl2ZSB0byB0aGUgdXBwZXIgbGVmdCBjb3JuZXIgb2YgdGhlIHZpc2libGUgYnJvd3NlclxuICAgIC8vIHdpbmRvdy4gIFRoZXNlIGNvb3JkaW5hdGVzIGNoYW5nZSB3aGVuIHlvdSBzY3JvbGwgdGhlIGJyb3dzZXIgd2luZG93LlxuICAgIGNvbnN0IGJvdW5kaW5nUmVjdCA9IGluamVjdGlvbkRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIC8vIFRoZSBjbGllbnQgY29vcmRpbmF0ZXMgb2Zmc2V0IGJ5IHRoZSBpbmplY3Rpb24gZGl2J3MgdXBwZXIgbGVmdCBjb3JuZXIuXG4gICAgY29uc3QgbW91c2VFdmVudCA9IGUgYXMgTW91c2VFdmVudDtcbiAgICBjb25zdCBjbGllbnRPZmZzZXRQaXhlbHMgPSBuZXcgQ29vcmRpbmF0ZShcbiAgICAgICAgbW91c2VFdmVudC5jbGllbnRYIC0gYm91bmRpbmdSZWN0LmxlZnQsXG4gICAgICAgIG1vdXNlRXZlbnQuY2xpZW50WSAtIGJvdW5kaW5nUmVjdC50b3ApO1xuXG4gICAgLy8gVGhlIG9mZnNldCBpbiBwaXhlbHMgYmV0d2VlbiB0aGUgbWFpbiB3b3Jrc3BhY2UncyBvcmlnaW4gYW5kIHRoZSB1cHBlclxuICAgIC8vIGxlZnQgY29ybmVyIG9mIHRoZSBpbmplY3Rpb24gZGl2LlxuICAgIGNvbnN0IG1haW5PZmZzZXRQaXhlbHMgPSB3cy5nZXRPcmlnaW5PZmZzZXRJblBpeGVscygpO1xuXG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSBuZXcgY29tbWVudCBpbiBwaXhlbHMgcmVsYXRpdmUgdG8gdGhlIG9yaWdpbiBvZiB0aGVcbiAgICAvLyBtYWluIHdvcmtzcGFjZS5cbiAgICBjb25zdCBmaW5hbE9mZnNldCA9XG4gICAgICAgIENvb3JkaW5hdGUuZGlmZmVyZW5jZShjbGllbnRPZmZzZXRQaXhlbHMsIG1haW5PZmZzZXRQaXhlbHMpO1xuICAgIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgbmV3IGNvbW1lbnQgaW4gbWFpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAgZmluYWxPZmZzZXQuc2NhbGUoMSAvIHdzLnNjYWxlKTtcblxuICAgIGNvbnN0IGNvbW1lbnRYID0gZmluYWxPZmZzZXQueDtcbiAgICBjb25zdCBjb21tZW50WSA9IGZpbmFsT2Zmc2V0Lnk7XG4gICAgY29tbWVudC5tb3ZlQnkoY29tbWVudFgsIGNvbW1lbnRZKTtcbiAgICBpZiAod3MucmVuZGVyZWQpIHtcbiAgICAgIGNvbW1lbnQuaW5pdFN2ZygpO1xuICAgICAgY29tbWVudC5yZW5kZXIoKTtcbiAgICAgIGNvbW1lbnQuc2VsZWN0KCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgd3NDb21tZW50T3B0aW9uID0ge1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gIH0gYXMgQ29udGV4dE1lbnVPcHRpb247XG4gIHdzQ29tbWVudE9wdGlvbi50ZXh0ID0gTXNnWydBRERfQ09NTUVOVCddO1xuICB3c0NvbW1lbnRPcHRpb24uY2FsbGJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICBhZGRXc0NvbW1lbnQoKTtcbiAgfTtcbiAgcmV0dXJuIHdzQ29tbWVudE9wdGlvbjtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgcG9zaXRpb25pbmcgVUkgZWxlbWVudHMuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnVpUG9zaXRpb25cbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51aVBvc2l0aW9uJyk7XG5cbmltcG9ydCB0eXBlIHtVaU1ldHJpY3N9IGZyb20gJy4vbWV0cmljc19tYW5hZ2VyLmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyfSBmcm9tICcuL3Njcm9sbGJhci5qcyc7XG5pbXBvcnQge1JlY3R9IGZyb20gJy4vdXRpbHMvcmVjdC5qcyc7XG5pbXBvcnQgdHlwZSB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCAqIGFzIHRvb2xib3ggZnJvbSAnLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBFbnVtIGZvciB2ZXJ0aWNhbCBwb3NpdGlvbmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51aVBvc2l0aW9uLnZlcnRpY2FsUG9zaXRpb25cbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZW51bSB2ZXJ0aWNhbFBvc2l0aW9uIHtcbiAgVE9QLFxuICBCT1RUT01cbn1cblxuLyoqXG4gKiBFbnVtIGZvciBob3Jpem9udGFsIHBvc2l0aW9uaW5nLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnVpUG9zaXRpb24uaG9yaXpvbnRhbFBvc2l0aW9uXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGVudW0gaG9yaXpvbnRhbFBvc2l0aW9uIHtcbiAgTEVGVCxcbiAgUklHSFRcbn1cblxuLyoqXG4gKiBBbiBvYmplY3QgZGVmaW5pbmcgYSBob3Jpem9udGFsIGFuZCB2ZXJ0aWNhbCBwb3NpdGlvbmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51aVBvc2l0aW9uLlBvc2l0aW9uXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQb3NpdGlvbiB7XG4gIGhvcml6b250YWw6IGhvcml6b250YWxQb3NpdGlvbjtcbiAgdmVydGljYWw6IHZlcnRpY2FsUG9zaXRpb247XG59XG5cbi8qKlxuICogRW51bSBmb3IgYnVtcCBydWxlcyB0byB1c2UgZm9yIGRlYWxpbmcgd2l0aCBjb2xsaXNpb25zLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnVpUG9zaXRpb24uYnVtcERpcmVjdGlvblxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBlbnVtIGJ1bXBEaXJlY3Rpb24ge1xuICBVUCxcbiAgRE9XTlxufVxuXG4vKipcbiAqIFJldHVybnMgYSByZWN0YW5nbGUgcmVwcmVzZW50aW5nIHJlYXNvbmFibGUgcG9zaXRpb24gZm9yIHdoZXJlIHRvIHBsYWNlIGEgVUlcbiAqIGVsZW1lbnQgb2YgdGhlIHNwZWNpZmllZCBzaXplIGdpdmVuIHRoZSByZXN0cmFpbnRzIGFuZCBsb2NhdGlvbnMgb2YgdGhlXG4gKiBzY3JvbGxiYXJzLiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB0YWtlIGludG8gYWNjb3VudCBhbnkgYWxyZWFkeSBwbGFjZWQgVUlcbiAqIGVsZW1lbnRzLlxuICpcbiAqIEBwYXJhbSBwb3NpdGlvbiBUaGUgc3RhcnRpbmcgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgcG9zaXRpb24uXG4gKiBAcGFyYW0gc2l6ZSB0aGUgc2l6ZSBvZiB0aGUgVUkgZWxlbWVudCB0byBnZXQgYSBzdGFydCBwb3NpdGlvbiBmb3IuXG4gKiBAcGFyYW0gaG9yaXpvbnRhbFBhZGRpbmcgVGhlIGhvcml6b250YWwgcGFkZGluZyB0byB1c2UuXG4gKiBAcGFyYW0gdmVydGljYWxQYWRkaW5nIFRoZSB2ZXJ0aWNhbCBwYWRkaW5nIHRvIHVzZS5cbiAqIEBwYXJhbSBtZXRyaWNzIFRoZSB3b3Jrc3BhY2UgVUkgbWV0cmljcy5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZS5cbiAqIEByZXR1cm5zIFRoZSBzdWdnZXN0ZWQgc3RhcnQgcG9zaXRpb24uXG4gKiBAYWxpYXMgQmxvY2tseS51aVBvc2l0aW9uLmdldFN0YXJ0UG9zaXRpb25SZWN0XG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFN0YXJ0UG9zaXRpb25SZWN0KFxuICAgIHBvc2l0aW9uOiBQb3NpdGlvbiwgc2l6ZTogU2l6ZSwgaG9yaXpvbnRhbFBhZGRpbmc6IG51bWJlcixcbiAgICB2ZXJ0aWNhbFBhZGRpbmc6IG51bWJlciwgbWV0cmljczogVWlNZXRyaWNzLFxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKTogUmVjdCB7XG4gIC8vIEhvcml6b250YWwgcG9zaXRpb25pbmcuXG4gIGxldCBsZWZ0ID0gMDtcbiAgY29uc3QgaGFzVmVydGljYWxTY3JvbGxiYXIgPVxuICAgICAgd29ya3NwYWNlLnNjcm9sbGJhciAmJiB3b3Jrc3BhY2Uuc2Nyb2xsYmFyLmNhblNjcm9sbFZlcnRpY2FsbHkoKTtcbiAgaWYgKHBvc2l0aW9uLmhvcml6b250YWwgPT09IGhvcml6b250YWxQb3NpdGlvbi5MRUZUKSB7XG4gICAgbGVmdCA9IG1ldHJpY3MuYWJzb2x1dGVNZXRyaWNzLmxlZnQgKyBob3Jpem9udGFsUGFkZGluZztcbiAgICBpZiAoaGFzVmVydGljYWxTY3JvbGxiYXIgJiYgd29ya3NwYWNlLlJUTCkge1xuICAgICAgbGVmdCArPSBTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzO1xuICAgIH1cbiAgfSBlbHNlIHsgIC8vIHBvc2l0aW9uLmhvcml6b250YWwgPT09IGhvcml6b250YWxQb3NpdGlvbi5SSUdIVFxuICAgIGxlZnQgPSBtZXRyaWNzLmFic29sdXRlTWV0cmljcy5sZWZ0ICsgbWV0cmljcy52aWV3TWV0cmljcy53aWR0aCAtXG4gICAgICAgIHNpemUud2lkdGggLSBob3Jpem9udGFsUGFkZGluZztcbiAgICBpZiAoaGFzVmVydGljYWxTY3JvbGxiYXIgJiYgIXdvcmtzcGFjZS5SVEwpIHtcbiAgICAgIGxlZnQgLT0gU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcztcbiAgICB9XG4gIH1cbiAgLy8gVmVydGljYWwgcG9zaXRpb25pbmcuXG4gIGxldCB0b3AgPSAwO1xuICBpZiAocG9zaXRpb24udmVydGljYWwgPT09IHZlcnRpY2FsUG9zaXRpb24uVE9QKSB7XG4gICAgdG9wID0gbWV0cmljcy5hYnNvbHV0ZU1ldHJpY3MudG9wICsgdmVydGljYWxQYWRkaW5nO1xuICB9IGVsc2UgeyAgLy8gcG9zaXRpb24udmVydGljYWwgPT09IHZlcnRpY2FsUG9zaXRpb24uQk9UVE9NXG4gICAgdG9wID0gbWV0cmljcy5hYnNvbHV0ZU1ldHJpY3MudG9wICsgbWV0cmljcy52aWV3TWV0cmljcy5oZWlnaHQgLVxuICAgICAgICBzaXplLmhlaWdodCAtIHZlcnRpY2FsUGFkZGluZztcbiAgICBpZiAod29ya3NwYWNlLnNjcm9sbGJhciAmJiB3b3Jrc3BhY2Uuc2Nyb2xsYmFyLmNhblNjcm9sbEhvcml6b250YWxseSgpKSB7XG4gICAgICAvLyBUaGUgc2Nyb2xsYmFycyBhcmUgYWx3YXlzIHBvc2l0aW9uZWQgb24gdGhlIGJvdHRvbSBpZiB0aGV5IGV4aXN0LlxuICAgICAgdG9wIC09IFNjcm9sbGJhci5zY3JvbGxiYXJUaGlja25lc3M7XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXcgUmVjdCh0b3AsIHRvcCArIHNpemUuaGVpZ2h0LCBsZWZ0LCBsZWZ0ICsgc2l6ZS53aWR0aCk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGNvcm5lciBwb3NpdGlvbiB0aGF0IGlzIG9uIHRoZSBvcHBvc2l0ZSBzaWRlIG9mIHRoZSB3b3Jrc3BhY2UgZnJvbVxuICogdGhlIHRvb2xib3guXG4gKiBJZiBpbiBob3Jpem9udGFsIG9yaWVudGF0aW9uLCBkZWZhdWx0cyB0byB0aGUgYm90dG9tIGNvcm5lci4gSWYgaW4gdmVydGljYWxcbiAqIG9yaWVudGF0aW9uLCBkZWZhdWx0cyB0byB0aGUgcmlnaHQgY29ybmVyLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZS5cbiAqIEBwYXJhbSBtZXRyaWNzIFRoZSB3b3Jrc3BhY2UgbWV0cmljcy5cbiAqIEByZXR1cm5zIFRoZSBzdWdnZXN0ZWQgY29ybmVyIHBvc2l0aW9uLlxuICogQGFsaWFzIEJsb2NrbHkudWlQb3NpdGlvbi5nZXRDb3JuZXJPcHBvc2l0ZVRvb2xib3hcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29ybmVyT3Bwb3NpdGVUb29sYm94KFxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnLCBtZXRyaWNzOiBVaU1ldHJpY3MpOiBQb3NpdGlvbiB7XG4gIGNvbnN0IGxlZnRDb3JuZXIgPVxuICAgICAgbWV0cmljcy50b29sYm94TWV0cmljcy5wb3NpdGlvbiAhPT0gdG9vbGJveC5Qb3NpdGlvbi5MRUZUICYmXG4gICAgICAoIXdvcmtzcGFjZS5ob3Jpem9udGFsTGF5b3V0IHx8IHdvcmtzcGFjZS5SVEwpO1xuICBjb25zdCB0b3BDb3JuZXIgPSBtZXRyaWNzLnRvb2xib3hNZXRyaWNzLnBvc2l0aW9uID09PSB0b29sYm94LlBvc2l0aW9uLkJPVFRPTTtcbiAgY29uc3QgaFBvc2l0aW9uID1cbiAgICAgIGxlZnRDb3JuZXIgPyBob3Jpem9udGFsUG9zaXRpb24uTEVGVCA6IGhvcml6b250YWxQb3NpdGlvbi5SSUdIVDtcbiAgY29uc3QgdlBvc2l0aW9uID0gdG9wQ29ybmVyID8gdmVydGljYWxQb3NpdGlvbi5UT1AgOiB2ZXJ0aWNhbFBvc2l0aW9uLkJPVFRPTTtcbiAgcmV0dXJuIHtob3Jpem9udGFsOiBoUG9zaXRpb24sIHZlcnRpY2FsOiB2UG9zaXRpb259O1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBwb3NpdGlvbiBSZWN0IGJhc2VkIG9uIGEgc3RhcnRpbmcgcG9zaXRpb24gdGhhdCBpcyBidW1wZWRcbiAqIHNvIHRoYXQgaXQgZG9lc24ndCBpbnRlcnNlY3Qgd2l0aCBhbnkgb2YgdGhlIHByb3ZpZGVkIHNhdmVkUG9zaXRpb25zLiBUaGlzXG4gKiBtZXRob2QgZG9lcyBub3QgY2hlY2sgdGhhdCB0aGUgYnVtcGVkIHBvc2l0aW9uIGlzIHN0aWxsIHdpdGhpbiBib3VuZHMuXG4gKlxuICogQHBhcmFtIHN0YXJ0UmVjdCBUaGUgc3RhcnRpbmcgcG9zaXRpb24gdG8gdXNlLlxuICogQHBhcmFtIG1hcmdpbiBUaGUgbWFyZ2luIHRvIHVzZSBiZXR3ZWVuIGVsZW1lbnRzIHdoZW4gYnVtcGluZy5cbiAqIEBwYXJhbSBidW1wRGlyIFRoZSBkaXJlY3Rpb24gdG8gYnVtcCBpZiB0aGVyZSBpcyBhIGNvbGxpc2lvbiB3aXRoIGFuIGV4aXN0aW5nXG4gKiAgICAgVUkgZWxlbWVudC5cbiAqIEBwYXJhbSBzYXZlZFBvc2l0aW9ucyBMaXN0IG9mIHJlY3RhbmdsZXMgdGhhdCByZXByZXNlbnQgdGhlIHBvc2l0aW9ucyBvZiBVSVxuICogICAgIGVsZW1lbnRzIGFscmVhZHkgcGxhY2VkLlxuICogQHJldHVybnMgVGhlIHN1Z2dlc3RlZCBwb3NpdGlvbiByZWN0YW5nbGUuXG4gKiBAYWxpYXMgQmxvY2tseS51aVBvc2l0aW9uLmJ1bXBQb3NpdGlvblJlY3RcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gYnVtcFBvc2l0aW9uUmVjdChcbiAgICBzdGFydFJlY3Q6IFJlY3QsIG1hcmdpbjogbnVtYmVyLCBidW1wRGlyOiBidW1wRGlyZWN0aW9uLFxuICAgIHNhdmVkUG9zaXRpb25zOiBSZWN0W10pOiBSZWN0IHtcbiAgbGV0IHRvcCA9IHN0YXJ0UmVjdC50b3A7XG4gIGNvbnN0IGxlZnQgPSBzdGFydFJlY3QubGVmdDtcbiAgY29uc3Qgd2lkdGggPSBzdGFydFJlY3QucmlnaHQgLSBzdGFydFJlY3QubGVmdDtcbiAgY29uc3QgaGVpZ2h0ID0gc3RhcnRSZWN0LmJvdHRvbSAtIHN0YXJ0UmVjdC50b3A7XG5cbiAgLy8gQ2hlY2sgZm9yIGNvbGxpc2lvbiBhbmQgYnVtcCBpZiBuZWVkZWQuXG4gIGxldCBib3VuZGluZ1JlY3QgPSBzdGFydFJlY3Q7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2F2ZWRQb3NpdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBvdGhlckVsID0gc2F2ZWRQb3NpdGlvbnNbaV07XG4gICAgaWYgKGJvdW5kaW5nUmVjdC5pbnRlcnNlY3RzKG90aGVyRWwpKSB7XG4gICAgICBpZiAoYnVtcERpciA9PT0gYnVtcERpcmVjdGlvbi5VUCkge1xuICAgICAgICB0b3AgPSBvdGhlckVsLnRvcCAtIGhlaWdodCAtIG1hcmdpbjtcbiAgICAgIH0gZWxzZSB7ICAvLyBidW1wRGlyID09PSBidW1wRGlyZWN0aW9uLkRPV05cbiAgICAgICAgdG9wID0gb3RoZXJFbC5ib3R0b20gKyBtYXJnaW47XG4gICAgICB9XG4gICAgICAvLyBSZWNoZWNrIG90aGVyIHNhdmVkUG9zaXRpb25zXG4gICAgICBib3VuZGluZ1JlY3QgPSBuZXcgUmVjdCh0b3AsIHRvcCArIGhlaWdodCwgbGVmdCwgbGVmdCArIHdpZHRoKTtcbiAgICAgIGkgPSAtMTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJvdW5kaW5nUmVjdDtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBSZWdpc3RlcnMgZGVmYXVsdCBrZXlib2FyZCBzaG9ydGN1dHMuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LlNob3J0Y3V0SXRlbXNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5TaG9ydGN1dEl0ZW1zJyk7XG5cbmltcG9ydCB7QmxvY2tTdmd9IGZyb20gJy4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGNsaXBib2FyZCBmcm9tICcuL2NsaXBib2FyZC5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0IHtHZXN0dXJlfSBmcm9tICcuL2dlc3R1cmUuanMnO1xuaW1wb3J0IHR5cGUge0lDb3B5YWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29weWFibGUuanMnO1xuaW1wb3J0IHtLZXlib2FyZFNob3J0Y3V0LCBTaG9ydGN1dFJlZ2lzdHJ5fSBmcm9tICcuL3Nob3J0Y3V0X3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7S2V5Q29kZXN9IGZyb20gJy4vdXRpbHMva2V5Y29kZXMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIE9iamVjdCBob2xkaW5nIHRoZSBuYW1lcyBvZiB0aGUgZGVmYXVsdCBzaG9ydGN1dCBpdGVtcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5TaG9ydGN1dEl0ZW1zLm5hbWVzXG4gKi9cbmV4cG9ydCBlbnVtIG5hbWVzIHtcbiAgRVNDQVBFID0gJ2VzY2FwZScsXG4gIERFTEVURSA9ICdkZWxldGUnLFxuICBDT1BZID0gJ2NvcHknLFxuICBDVVQgPSAnY3V0JyxcbiAgUEFTVEUgPSAncGFzdGUnLFxuICBVTkRPID0gJ3VuZG8nLFxuICBSRURPID0gJ3JlZG8nLFxufVxuXG4vKipcbiAqIEtleWJvYXJkIHNob3J0Y3V0IHRvIGhpZGUgY2hhZmYgb24gZXNjYXBlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlNob3J0Y3V0SXRlbXMucmVnaXN0ZXJFc2NhcGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyRXNjYXBlKCkge1xuICBjb25zdCBlc2NhcGVBY3Rpb246IEtleWJvYXJkU2hvcnRjdXQgPSB7XG4gICAgbmFtZTogbmFtZXMuRVNDQVBFLFxuICAgIHByZWNvbmRpdGlvbkZuKHdvcmtzcGFjZSkge1xuICAgICAgcmV0dXJuICF3b3Jrc3BhY2Uub3B0aW9ucy5yZWFkT25seTtcbiAgICB9LFxuICAgIGNhbGxiYWNrKHdvcmtzcGFjZSkge1xuICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnaGlkZUNoYWZmJyBkb2VzIG5vdCBleGlzdCBvblxuICAgICAgLy8gdHlwZSAnV29ya3NwYWNlJy5cbiAgICAgICh3b3Jrc3BhY2UgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5oaWRlQ2hhZmYoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAga2V5Q29kZXM6IFtLZXlDb2Rlcy5FU0NdLFxuICB9O1xuICBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGVzY2FwZUFjdGlvbik7XG59XG5cbi8qKlxuICogS2V5Ym9hcmQgc2hvcnRjdXQgdG8gZGVsZXRlIGEgYmxvY2sgb24gZGVsZXRlIG9yIGJhY2tzcGFjZVxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlNob3J0Y3V0SXRlbXMucmVnaXN0ZXJEZWxldGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyRGVsZXRlKCkge1xuICBjb25zdCBkZWxldGVTaG9ydGN1dDogS2V5Ym9hcmRTaG9ydGN1dCA9IHtcbiAgICBuYW1lOiBuYW1lcy5ERUxFVEUsXG4gICAgcHJlY29uZGl0aW9uRm4od29ya3NwYWNlKSB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IGNvbW1vbi5nZXRTZWxlY3RlZCgpO1xuICAgICAgcmV0dXJuICF3b3Jrc3BhY2Uub3B0aW9ucy5yZWFkT25seSAmJiBzZWxlY3RlZCAhPSBudWxsICYmXG4gICAgICAgICAgc2VsZWN0ZWQuaXNEZWxldGFibGUoKTtcbiAgICB9LFxuICAgIGNhbGxiYWNrKHdvcmtzcGFjZSwgZSkge1xuICAgICAgLy8gRGVsZXRlIG9yIGJhY2tzcGFjZS5cbiAgICAgIC8vIFN0b3AgdGhlIGJyb3dzZXIgZnJvbSBnb2luZyBiYWNrIHRvIHRoZSBwcmV2aW91cyBwYWdlLlxuICAgICAgLy8gRG8gdGhpcyBmaXJzdCB0byBwcmV2ZW50IGFuIGVycm9yIGluIHRoZSBkZWxldGUgY29kZSBmcm9tIHJlc3VsdGluZyBpblxuICAgICAgLy8gZGF0YSBsb3NzLlxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgLy8gRG9uJ3QgZGVsZXRlIHdoaWxlIGRyYWdnaW5nLiAgSmVlei5cbiAgICAgIGlmIChHZXN0dXJlLmluUHJvZ3Jlc3MoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICAoY29tbW9uLmdldFNlbGVjdGVkKCkgYXMgQmxvY2tTdmcpLmNoZWNrQW5kRGVsZXRlKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIGtleUNvZGVzOiBbS2V5Q29kZXMuREVMRVRFLCBLZXlDb2Rlcy5CQUNLU1BBQ0VdLFxuICB9O1xuICBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGRlbGV0ZVNob3J0Y3V0KTtcbn1cblxuLyoqXG4gKiBLZXlib2FyZCBzaG9ydGN1dCB0byBjb3B5IGEgYmxvY2sgb24gY3RybCtjLCBjbWQrYywgb3IgYWx0K2MuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuU2hvcnRjdXRJdGVtcy5yZWdpc3RlckNvcHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQ29weSgpIHtcbiAgY29uc3QgY3RybEMgPSBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LmNyZWF0ZVNlcmlhbGl6ZWRLZXkoXG4gICAgICBLZXlDb2Rlcy5DLCBbS2V5Q29kZXMuQ1RSTF0pO1xuICBjb25zdCBhbHRDID1cbiAgICAgIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkuY3JlYXRlU2VyaWFsaXplZEtleShLZXlDb2Rlcy5DLCBbS2V5Q29kZXMuQUxUXSk7XG4gIGNvbnN0IG1ldGFDID0gU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5KFxuICAgICAgS2V5Q29kZXMuQywgW0tleUNvZGVzLk1FVEFdKTtcblxuICBjb25zdCBjb3B5U2hvcnRjdXQ6IEtleWJvYXJkU2hvcnRjdXQgPSB7XG4gICAgbmFtZTogbmFtZXMuQ09QWSxcbiAgICBwcmVjb25kaXRpb25Gbih3b3Jrc3BhY2UpIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkID0gY29tbW9uLmdldFNlbGVjdGVkKCk7XG4gICAgICByZXR1cm4gIXdvcmtzcGFjZS5vcHRpb25zLnJlYWRPbmx5ICYmICFHZXN0dXJlLmluUHJvZ3Jlc3MoKSAmJlxuICAgICAgICAgIHNlbGVjdGVkICE9IG51bGwgJiYgc2VsZWN0ZWQuaXNEZWxldGFibGUoKSAmJiBzZWxlY3RlZC5pc01vdmFibGUoKTtcbiAgICB9LFxuICAgIGNhbGxiYWNrKHdvcmtzcGFjZSwgZSkge1xuICAgICAgLy8gUHJldmVudCB0aGUgZGVmYXVsdCBjb3B5IGJlaGF2aW9yLCB3aGljaCBtYXkgYmVlcCBvciBvdGhlcndpc2UgaW5kaWNhdGVcbiAgICAgIC8vIGFuIGVycm9yIGR1ZSB0byB0aGUgbGFjayBvZiBhIHNlbGVjdGlvbi5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2hpZGVDaGFmZicgZG9lcyBub3QgZXhpc3Qgb25cbiAgICAgIC8vIHR5cGUgJ1dvcmtzcGFjZScuXG4gICAgICAod29ya3NwYWNlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuaGlkZUNoYWZmKCk7XG4gICAgICBjbGlwYm9hcmQuY29weShjb21tb24uZ2V0U2VsZWN0ZWQoKSBhcyBJQ29weWFibGUpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBrZXlDb2RlczogW2N0cmxDLCBhbHRDLCBtZXRhQ10sXG4gIH07XG4gIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIoY29weVNob3J0Y3V0KTtcbn1cblxuLyoqXG4gKiBLZXlib2FyZCBzaG9ydGN1dCB0byBjb3B5IGFuZCBkZWxldGUgYSBibG9jayBvbiBjdHJsK3gsIGNtZCt4LCBvciBhbHQreC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5TaG9ydGN1dEl0ZW1zLnJlZ2lzdGVyQ3V0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckN1dCgpIHtcbiAgY29uc3QgY3RybFggPSBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LmNyZWF0ZVNlcmlhbGl6ZWRLZXkoXG4gICAgICBLZXlDb2Rlcy5YLCBbS2V5Q29kZXMuQ1RSTF0pO1xuICBjb25zdCBhbHRYID1cbiAgICAgIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkuY3JlYXRlU2VyaWFsaXplZEtleShLZXlDb2Rlcy5YLCBbS2V5Q29kZXMuQUxUXSk7XG4gIGNvbnN0IG1ldGFYID0gU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5KFxuICAgICAgS2V5Q29kZXMuWCwgW0tleUNvZGVzLk1FVEFdKTtcblxuICBjb25zdCBjdXRTaG9ydGN1dDogS2V5Ym9hcmRTaG9ydGN1dCA9IHtcbiAgICBuYW1lOiBuYW1lcy5DVVQsXG4gICAgcHJlY29uZGl0aW9uRm4od29ya3NwYWNlKSB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IGNvbW1vbi5nZXRTZWxlY3RlZCgpO1xuICAgICAgcmV0dXJuICF3b3Jrc3BhY2Uub3B0aW9ucy5yZWFkT25seSAmJiAhR2VzdHVyZS5pblByb2dyZXNzKCkgJiZcbiAgICAgICAgICBzZWxlY3RlZCAhPSBudWxsICYmIHNlbGVjdGVkIGluc3RhbmNlb2YgQmxvY2tTdmcgJiZcbiAgICAgICAgICBzZWxlY3RlZC5pc0RlbGV0YWJsZSgpICYmIHNlbGVjdGVkLmlzTW92YWJsZSgpICYmXG4gICAgICAgICAgIXNlbGVjdGVkLndvcmtzcGFjZSEuaXNGbHlvdXQ7XG4gICAgfSxcbiAgICBjYWxsYmFjaygpIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkID0gY29tbW9uLmdldFNlbGVjdGVkKCk7XG4gICAgICBpZiAoIXNlbGVjdGVkKSB7XG4gICAgICAgIC8vIFNob3VsZG4ndCBoYXBwZW4gYnV0IGFwcGVhc2VzIHRoZSB0eXBlIHN5c3RlbVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjbGlwYm9hcmQuY29weShzZWxlY3RlZCk7XG4gICAgICAoc2VsZWN0ZWQgYXMgQmxvY2tTdmcpLmNoZWNrQW5kRGVsZXRlKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIGtleUNvZGVzOiBbY3RybFgsIGFsdFgsIG1ldGFYXSxcbiAgfTtcblxuICBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGN1dFNob3J0Y3V0KTtcbn1cblxuLyoqXG4gKiBLZXlib2FyZCBzaG9ydGN1dCB0byBwYXN0ZSBhIGJsb2NrIG9uIGN0cmwrdiwgY21kK3YsIG9yIGFsdCt2LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlNob3J0Y3V0SXRlbXMucmVnaXN0ZXJQYXN0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJQYXN0ZSgpIHtcbiAgY29uc3QgY3RybFYgPSBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LmNyZWF0ZVNlcmlhbGl6ZWRLZXkoXG4gICAgICBLZXlDb2Rlcy5WLCBbS2V5Q29kZXMuQ1RSTF0pO1xuICBjb25zdCBhbHRWID1cbiAgICAgIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkuY3JlYXRlU2VyaWFsaXplZEtleShLZXlDb2Rlcy5WLCBbS2V5Q29kZXMuQUxUXSk7XG4gIGNvbnN0IG1ldGFWID0gU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5KFxuICAgICAgS2V5Q29kZXMuViwgW0tleUNvZGVzLk1FVEFdKTtcblxuICBjb25zdCBwYXN0ZVNob3J0Y3V0OiBLZXlib2FyZFNob3J0Y3V0ID0ge1xuICAgIG5hbWU6IG5hbWVzLlBBU1RFLFxuICAgIHByZWNvbmRpdGlvbkZuKHdvcmtzcGFjZSkge1xuICAgICAgcmV0dXJuICF3b3Jrc3BhY2Uub3B0aW9ucy5yZWFkT25seSAmJiAhR2VzdHVyZS5pblByb2dyZXNzKCk7XG4gICAgfSxcbiAgICBjYWxsYmFjaygpIHtcbiAgICAgIHJldHVybiAhIShjbGlwYm9hcmQucGFzdGUoKSk7XG4gICAgfSxcbiAgICBrZXlDb2RlczogW2N0cmxWLCBhbHRWLCBtZXRhVl0sXG4gIH07XG5cbiAgU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5yZWdpc3RlcihwYXN0ZVNob3J0Y3V0KTtcbn1cblxuLyoqXG4gKiBLZXlib2FyZCBzaG9ydGN1dCB0byB1bmRvIHRoZSBwcmV2aW91cyBhY3Rpb24gb24gY3RybCt6LCBjbWQreiwgb3IgYWx0K3ouXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuU2hvcnRjdXRJdGVtcy5yZWdpc3RlclVuZG9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyVW5kbygpIHtcbiAgY29uc3QgY3RybFogPSBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LmNyZWF0ZVNlcmlhbGl6ZWRLZXkoXG4gICAgICBLZXlDb2Rlcy5aLCBbS2V5Q29kZXMuQ1RSTF0pO1xuICBjb25zdCBhbHRaID1cbiAgICAgIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkuY3JlYXRlU2VyaWFsaXplZEtleShLZXlDb2Rlcy5aLCBbS2V5Q29kZXMuQUxUXSk7XG4gIGNvbnN0IG1ldGFaID0gU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5KFxuICAgICAgS2V5Q29kZXMuWiwgW0tleUNvZGVzLk1FVEFdKTtcblxuICBjb25zdCB1bmRvU2hvcnRjdXQ6IEtleWJvYXJkU2hvcnRjdXQgPSB7XG4gICAgbmFtZTogbmFtZXMuVU5ETyxcbiAgICBwcmVjb25kaXRpb25Gbih3b3Jrc3BhY2UpIHtcbiAgICAgIHJldHVybiAhd29ya3NwYWNlLm9wdGlvbnMucmVhZE9ubHkgJiYgIUdlc3R1cmUuaW5Qcm9ncmVzcygpO1xuICAgIH0sXG4gICAgY2FsbGJhY2sod29ya3NwYWNlKSB7XG4gICAgICAvLyAneicgZm9yIHVuZG8gJ1onIGlzIGZvciByZWRvLlxuICAgICAgKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLmhpZGVDaGFmZigpO1xuICAgICAgd29ya3NwYWNlLnVuZG8oZmFsc2UpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBrZXlDb2RlczogW2N0cmxaLCBhbHRaLCBtZXRhWl0sXG4gIH07XG4gIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIodW5kb1Nob3J0Y3V0KTtcbn1cblxuLyoqXG4gKiBLZXlib2FyZCBzaG9ydGN1dCB0byByZWRvIHRoZSBwcmV2aW91cyBhY3Rpb24gb24gY3RybCtzaGlmdCt6LCBjbWQrc2hpZnQreixcbiAqIG9yIGFsdCtzaGlmdCt6LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlNob3J0Y3V0SXRlbXMucmVnaXN0ZXJSZWRvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclJlZG8oKSB7XG4gIGNvbnN0IGN0cmxTaGlmdFogPSBTaG9ydGN1dFJlZ2lzdHJ5LnJlZ2lzdHJ5LmNyZWF0ZVNlcmlhbGl6ZWRLZXkoXG4gICAgICBLZXlDb2Rlcy5aLCBbS2V5Q29kZXMuU0hJRlQsIEtleUNvZGVzLkNUUkxdKTtcbiAgY29uc3QgYWx0U2hpZnRaID0gU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5KFxuICAgICAgS2V5Q29kZXMuWiwgW0tleUNvZGVzLlNISUZULCBLZXlDb2Rlcy5BTFRdKTtcbiAgY29uc3QgbWV0YVNoaWZ0WiA9IFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkuY3JlYXRlU2VyaWFsaXplZEtleShcbiAgICAgIEtleUNvZGVzLlosIFtLZXlDb2Rlcy5TSElGVCwgS2V5Q29kZXMuTUVUQV0pO1xuICAvLyBDdHJsLXkgaXMgcmVkbyBpbiBXaW5kb3dzLiAgQ29tbWFuZC15IGlzIG5ldmVyIHZhbGlkIG9uIE1hY3MuXG4gIGNvbnN0IGN0cmxZID0gU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5KFxuICAgICAgS2V5Q29kZXMuWSwgW0tleUNvZGVzLkNUUkxdKTtcblxuICBjb25zdCByZWRvU2hvcnRjdXQ6IEtleWJvYXJkU2hvcnRjdXQgPSB7XG4gICAgbmFtZTogbmFtZXMuUkVETyxcbiAgICBwcmVjb25kaXRpb25Gbih3b3Jrc3BhY2UpIHtcbiAgICAgIHJldHVybiAhR2VzdHVyZS5pblByb2dyZXNzKCkgJiYgIXdvcmtzcGFjZS5vcHRpb25zLnJlYWRPbmx5O1xuICAgIH0sXG4gICAgY2FsbGJhY2sod29ya3NwYWNlKSB7XG4gICAgICAvLyAneicgZm9yIHVuZG8gJ1onIGlzIGZvciByZWRvLlxuICAgICAgKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLmhpZGVDaGFmZigpO1xuICAgICAgd29ya3NwYWNlLnVuZG8odHJ1ZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIGtleUNvZGVzOiBbY3RybFNoaWZ0WiwgYWx0U2hpZnRaLCBtZXRhU2hpZnRaLCBjdHJsWV0sXG4gIH07XG4gIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIocmVkb1Nob3J0Y3V0KTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYWxsIGRlZmF1bHQga2V5Ym9hcmQgc2hvcnRjdXQgaXRlbS4gVGhpcyBzaG91bGQgYmUgY2FsbGVkIG9uY2UgcGVyXG4gKiBpbnN0YW5jZSBvZiBLZXlib2FyZFNob3J0Y3V0UmVnaXN0cnkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuU2hvcnRjdXRJdGVtcy5yZWdpc3RlckRlZmF1bHRTaG9ydGN1dHNcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEZWZhdWx0U2hvcnRjdXRzKCkge1xuICByZWdpc3RlckVzY2FwZSgpO1xuICByZWdpc3RlckRlbGV0ZSgpO1xuICByZWdpc3RlckNvcHkoKTtcbiAgcmVnaXN0ZXJDdXQoKTtcbiAgcmVnaXN0ZXJQYXN0ZSgpO1xuICByZWdpc3RlclVuZG8oKTtcbiAgcmVnaXN0ZXJSZWRvKCk7XG59XG5cbnJlZ2lzdGVyRGVmYXVsdFNob3J0Y3V0cygpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgZmlyZXMgZXZlbnRzIG9wdGlvbmFsbHkuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSU9ic2VydmFibGUge1xuICBzdGFydFB1Ymxpc2hpbmcoKTogdm9pZDtcbiAgc3RvcFB1Ymxpc2hpbmcoKTogdm9pZDtcbn1cblxuLyoqXG4gKiBUeXBlIGd1YXJkIGZvciBjaGVja2luZyBpZiBhbiBvYmplY3QgZnVsZmlsbHMgSU9ic2VydmFibGUuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc09ic2VydmFibGUob2JqOiBhbnkpOiBvYmogaXMgSU9ic2VydmFibGUge1xuICByZXR1cm4gb2JqLnN0YXJ0UHVibGlzaGluZyAhPT0gdW5kZWZpbmVkICYmIG9iai5zdG9wUHVibGlzaGluZyAhPT0gdW5kZWZpbmVkO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4uL2Jsb2NrLmpzJztcblxuXG4vKiogVGhlIGludGVyZmFjZSBmb3IgYSBibG9jayB3aGljaCBtb2RlbHMgYSBwcm9jZWR1cmUuICovXG5leHBvcnQgaW50ZXJmYWNlIElQcm9jZWR1cmVCbG9jayB7XG4gIGRvUHJvY2VkdXJlVXBkYXRlKCk6IHZvaWQ7XG59XG5cbi8qKiBBIHR5cGUgZ3VhcmQgd2hpY2ggY2hlY2tzIGlmIHRoZSBnaXZlbiBibG9jayBpcyBhIHByb2NlZHVyZSBibG9jay4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1Byb2NlZHVyZUJsb2NrKGJsb2NrOiBCbG9ja3xcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQcm9jZWR1cmVCbG9jayk6IGJsb2NrIGlzIElQcm9jZWR1cmVCbG9jayB7XG4gIHJldHVybiAoYmxvY2sgYXMgSVByb2NlZHVyZUJsb2NrKS5kb1Byb2NlZHVyZVVwZGF0ZSAhPT0gdW5kZWZpbmVkO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQge2lzUHJvY2VkdXJlQmxvY2t9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9wcm9jZWR1cmVfYmxvY2suanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDYWxscyB0aGUgYGRvUHJvY2VkdXJlVXBkYXRlYCBtZXRob2Qgb24gYWxsIGJsb2NrcyB3aGljaCBpbXBsZW1lbnQgaXQuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0cmlnZ2VyUHJvY2VkdXJlc1VwZGF0ZSh3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICBmb3IgKGNvbnN0IGJsb2NrIG9mIHdvcmtzcGFjZS5nZXRBbGxCbG9ja3MoZmFsc2UpKSB7XG4gICAgaWYgKGlzUHJvY2VkdXJlQmxvY2soYmxvY2spKSB7XG4gICAgICBibG9jay5kb1Byb2NlZHVyZVVwZGF0ZSgpO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBwcm9jZWR1cmVzLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5Qcm9jZWR1cmVzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuUHJvY2VkdXJlcycpO1xuXG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19jaGFuZ2UuanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQge0Jsb2Nrc30gZnJvbSAnLi9ibG9ja3MuanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4vY29tbW9uLmpzJztcbmltcG9ydCB0eXBlIHtBYnN0cmFjdH0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB0eXBlIHtCdWJibGVPcGVufSBmcm9tICcuL2V2ZW50cy9ldmVudHNfYnViYmxlX29wZW4uanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge0ZpZWxkLCBVbmF0dGFjaGVkRmllbGRFcnJvcn0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQge01zZ30gZnJvbSAnLi9tc2cuanMnO1xuaW1wb3J0IHtOYW1lc30gZnJvbSAnLi9uYW1lcy5qcyc7XG5pbXBvcnQge09ic2VydmFibGVQcm9jZWR1cmVNYXB9IGZyb20gJy4vcHJvY2VkdXJlcy9vYnNlcnZhYmxlX3Byb2NlZHVyZV9tYXAuanMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlUHJvY2VkdXJlTW9kZWx9IGZyb20gJy4vcHJvY2VkdXJlcy9vYnNlcnZhYmxlX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQge09ic2VydmFibGVQYXJhbWV0ZXJNb2RlbH0gZnJvbSAnLi9wcm9jZWR1cmVzL29ic2VydmFibGVfcGFyYW1ldGVyX21vZGVsLmpzJztcbmltcG9ydCAqIGFzIHV0aWxzWG1sIGZyb20gJy4vdXRpbHMveG1sLmpzJztcbmltcG9ydCAqIGFzIFZhcmlhYmxlcyBmcm9tICcuL3ZhcmlhYmxlcy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuL3dvcmtzcGFjZS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4veG1sLmpzJztcblxuXG4vKipcbiAqIFN0cmluZyBmb3IgdXNlIGluIHRoZSBcImN1c3RvbVwiIGF0dHJpYnV0ZSBvZiBhIGNhdGVnb3J5IGluIHRvb2xib3ggWE1MLlxuICogVGhpcyBzdHJpbmcgaW5kaWNhdGVzIHRoYXQgdGhlIGNhdGVnb3J5IHNob3VsZCBiZSBkeW5hbWljYWxseSBwb3B1bGF0ZWQgd2l0aFxuICogcHJvY2VkdXJlIGJsb2Nrcy5cbiAqIFNlZSBhbHNvIEJsb2NrbHkuVmFyaWFibGVzLkNBVEVHT1JZX05BTUUgYW5kXG4gKiBCbG9ja2x5LlZhcmlhYmxlc0R5bmFtaWMuQ0FURUdPUllfTkFNRS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Qcm9jZWR1cmVzLkNBVEVHT1JZX05BTUVcbiAqL1xuZXhwb3J0IGNvbnN0IENBVEVHT1JZX05BTUUgPSAnUFJPQ0VEVVJFJztcblxuLyoqXG4gKiBUaGUgZGVmYXVsdCBhcmd1bWVudCBmb3IgYSBwcm9jZWR1cmVzX211dGF0b3JhcmcgYmxvY2suXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuUHJvY2VkdXJlcy5ERUZBVUxUX0FSR1xuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9BUkcgPSAneCc7XG5cbmV4cG9ydCB0eXBlIFByb2NlZHVyZVR1cGxlID0gW3N0cmluZywgc3RyaW5nW10sIGJvb2xlYW5dO1xuXG4vKipcbiAqIFByb2NlZHVyZSBibG9jayB0eXBlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlByb2NlZHVyZXMuUHJvY2VkdXJlQmxvY2tcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQcm9jZWR1cmVCbG9jayB7XG4gIGdldFByb2NlZHVyZUNhbGw6ICgpID0+IHN0cmluZztcbiAgcmVuYW1lUHJvY2VkdXJlOiAocDE6IHN0cmluZywgcDI6IHN0cmluZykgPT4gdm9pZDtcbiAgZ2V0UHJvY2VkdXJlRGVmOiAoKSA9PiBQcm9jZWR1cmVUdXBsZTtcbn1cblxuLyoqXG4gKiBGaW5kIGFsbCB1c2VyLWNyZWF0ZWQgcHJvY2VkdXJlIGRlZmluaXRpb25zIGluIGEgd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSByb290IFJvb3Qgd29ya3NwYWNlLlxuICogQHJldHVybnMgUGFpciBvZiBhcnJheXMsIHRoZSBmaXJzdCBjb250YWlucyBwcm9jZWR1cmVzIHdpdGhvdXQgcmV0dXJuXG4gKiAgICAgdmFyaWFibGVzLCB0aGUgc2Vjb25kIHdpdGguIEVhY2ggcHJvY2VkdXJlIGlzIGRlZmluZWQgYnkgYSB0aHJlZS1lbGVtZW50XG4gKiAgICAgbGlzdCBvZiBuYW1lLCBwYXJhbWV0ZXIgbGlzdCwgYW5kIHJldHVybiB2YWx1ZSBib29sZWFuLlxuICogQGFsaWFzIEJsb2NrbHkuUHJvY2VkdXJlcy5hbGxQcm9jZWR1cmVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhbGxQcm9jZWR1cmVzKHJvb3Q6IFdvcmtzcGFjZSk6XG4gICAgW1Byb2NlZHVyZVR1cGxlW10sIFByb2NlZHVyZVR1cGxlW11dIHtcbiAgY29uc3QgcHJvY2VkdXJlc05vUmV0dXJuID1cbiAgICAgIHJvb3QuZ2V0QmxvY2tzQnlUeXBlKCdwcm9jZWR1cmVzX2RlZm5vcmV0dXJuJywgZmFsc2UpXG4gICAgICAgICAgLm1hcChmdW5jdGlvbihibG9jaykge1xuICAgICAgICAgICAgcmV0dXJuIChibG9jayBhcyB1bmtub3duIGFzIFByb2NlZHVyZUJsb2NrKS5nZXRQcm9jZWR1cmVEZWYoKTtcbiAgICAgICAgICB9KTtcbiAgY29uc3QgcHJvY2VkdXJlc1JldHVybiA9XG4gICAgICByb290LmdldEJsb2Nrc0J5VHlwZSgncHJvY2VkdXJlc19kZWZyZXR1cm4nLCBmYWxzZSkubWFwKGZ1bmN0aW9uKGJsb2NrKSB7XG4gICAgICAgIHJldHVybiAoYmxvY2sgYXMgdW5rbm93biBhcyBQcm9jZWR1cmVCbG9jaykuZ2V0UHJvY2VkdXJlRGVmKCk7XG4gICAgICB9KTtcbiAgcHJvY2VkdXJlc05vUmV0dXJuLnNvcnQocHJvY1R1cGxlQ29tcGFyYXRvcik7XG4gIHByb2NlZHVyZXNSZXR1cm4uc29ydChwcm9jVHVwbGVDb21wYXJhdG9yKTtcbiAgcmV0dXJuIFtwcm9jZWR1cmVzTm9SZXR1cm4sIHByb2NlZHVyZXNSZXR1cm5dO1xufVxuXG4vKipcbiAqIENvbXBhcmlzb24gZnVuY3Rpb24gZm9yIGNhc2UtaW5zZW5zaXRpdmUgc29ydGluZyBvZiB0aGUgZmlyc3QgZWxlbWVudCBvZlxuICogYSB0dXBsZS5cbiAqXG4gKiBAcGFyYW0gdGEgRmlyc3QgdHVwbGUuXG4gKiBAcGFyYW0gdGIgU2Vjb25kIHR1cGxlLlxuICogQHJldHVybnMgLTEsIDAsIG9yIDEgdG8gc2lnbmlmeSBncmVhdGVyIHRoYW4sIGVxdWFsaXR5LCBvciBsZXNzIHRoYW4uXG4gKi9cbmZ1bmN0aW9uIHByb2NUdXBsZUNvbXBhcmF0b3IodGE6IFByb2NlZHVyZVR1cGxlLCB0YjogUHJvY2VkdXJlVHVwbGUpOiBudW1iZXIge1xuICByZXR1cm4gdGFbMF0ubG9jYWxlQ29tcGFyZSh0YlswXSwgdW5kZWZpbmVkLCB7c2Vuc2l0aXZpdHk6ICdiYXNlJ30pO1xufVxuXG4vKipcbiAqIEVuc3VyZSB0d28gaWRlbnRpY2FsbHktbmFtZWQgcHJvY2VkdXJlcyBkb24ndCBleGlzdC5cbiAqIFRha2UgdGhlIHByb3Bvc2VkIHByb2NlZHVyZSBuYW1lLCBhbmQgcmV0dXJuIGEgbGVnYWwgbmFtZSBpLmUuIG9uZSB0aGF0XG4gKiBpcyBub3QgZW1wdHkgYW5kIGRvZXNuJ3QgY29sbGlkZSB3aXRoIG90aGVyIHByb2NlZHVyZXMuXG4gKlxuICogQHBhcmFtIG5hbWUgUHJvcG9zZWQgcHJvY2VkdXJlIG5hbWUuXG4gKiBAcGFyYW0gYmxvY2sgQmxvY2sgdG8gZGlzYW1iaWd1YXRlLlxuICogQHJldHVybnMgTm9uLWNvbGxpZGluZyBuYW1lLlxuICogQGFsaWFzIEJsb2NrbHkuUHJvY2VkdXJlcy5maW5kTGVnYWxOYW1lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaW5kTGVnYWxOYW1lKG5hbWU6IHN0cmluZywgYmxvY2s6IEJsb2NrKTogc3RyaW5nIHtcbiAgaWYgKGJsb2NrLmlzSW5GbHlvdXQpIHtcbiAgICAvLyBGbHlvdXRzIGNhbiBoYXZlIG11bHRpcGxlIHByb2NlZHVyZXMgY2FsbGVkICdkbyBzb21ldGhpbmcnLlxuICAgIHJldHVybiBuYW1lO1xuICB9XG4gIG5hbWUgPSBuYW1lIHx8IE1zZ1snVU5OQU1FRF9LRVknXSB8fCAndW5uYW1lZCc7XG4gIHdoaWxlICghaXNMZWdhbE5hbWUobmFtZSwgYmxvY2sud29ya3NwYWNlLCBibG9jaykpIHtcbiAgICAvLyBDb2xsaXNpb24gd2l0aCBhbm90aGVyIHByb2NlZHVyZS5cbiAgICBjb25zdCByID0gbmFtZS5tYXRjaCgvXiguKj8pKFxcZCspJC8pO1xuICAgIGlmICghcikge1xuICAgICAgbmFtZSArPSAnMic7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hbWUgPSByWzFdICsgKHBhcnNlSW50KHJbMl0pICsgMSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuYW1lO1xufVxuLyoqXG4gKiBEb2VzIHRoaXMgcHJvY2VkdXJlIGhhdmUgYSBsZWdhbCBuYW1lPyAgSWxsZWdhbCBuYW1lcyBpbmNsdWRlIG5hbWVzIG9mXG4gKiBwcm9jZWR1cmVzIGFscmVhZHkgZGVmaW5lZC5cbiAqXG4gKiBAcGFyYW0gbmFtZSBUaGUgcXVlc3Rpb25hYmxlIG5hbWUuXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gc2NhbiBmb3IgY29sbGlzaW9ucy5cbiAqIEBwYXJhbSBvcHRfZXhjbHVkZSBPcHRpb25hbCBibG9jayB0byBleGNsdWRlIGZyb20gY29tcGFyaXNvbnMgKG9uZSBkb2Vzbid0XG4gKiAgICAgd2FudCB0byBjb2xsaWRlIHdpdGggb25lc2VsZikuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBuYW1lIGlzIGxlZ2FsLlxuICovXG5mdW5jdGlvbiBpc0xlZ2FsTmFtZShcbiAgICBuYW1lOiBzdHJpbmcsIHdvcmtzcGFjZTogV29ya3NwYWNlLCBvcHRfZXhjbHVkZT86IEJsb2NrKTogYm9vbGVhbiB7XG4gIHJldHVybiAhaXNOYW1lVXNlZChuYW1lLCB3b3Jrc3BhY2UsIG9wdF9leGNsdWRlKTtcbn1cblxuLyoqXG4gKiBSZXR1cm4gaWYgdGhlIGdpdmVuIG5hbWUgaXMgYWxyZWFkeSBhIHByb2NlZHVyZSBuYW1lLlxuICpcbiAqIEBwYXJhbSBuYW1lIFRoZSBxdWVzdGlvbmFibGUgbmFtZS5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBzY2FuIGZvciBjb2xsaXNpb25zLlxuICogQHBhcmFtIG9wdF9leGNsdWRlIE9wdGlvbmFsIGJsb2NrIHRvIGV4Y2x1ZGUgZnJvbSBjb21wYXJpc29ucyAob25lIGRvZXNuJ3RcbiAqICAgICB3YW50IHRvIGNvbGxpZGUgd2l0aCBvbmVzZWxmKS5cbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG5hbWUgaXMgdXNlZCwgb3RoZXJ3aXNlIHJldHVybiBmYWxzZS5cbiAqIEBhbGlhcyBCbG9ja2x5LlByb2NlZHVyZXMuaXNOYW1lVXNlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNOYW1lVXNlZChcbiAgICBuYW1lOiBzdHJpbmcsIHdvcmtzcGFjZTogV29ya3NwYWNlLCBvcHRfZXhjbHVkZT86IEJsb2NrKTogYm9vbGVhbiB7XG4gIGNvbnN0IGJsb2NrcyA9IHdvcmtzcGFjZS5nZXRBbGxCbG9ja3MoZmFsc2UpO1xuICAvLyBJdGVyYXRlIHRocm91Z2ggZXZlcnkgYmxvY2sgYW5kIGNoZWNrIHRoZSBuYW1lLlxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgIGlmIChibG9ja3NbaV0gPT09IG9wdF9leGNsdWRlKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgLy8gQXNzdW1lIGl0IGlzIGEgcHJvY2VkdXJlIGJsb2NrIHNvIHdlIGNhbiBjaGVjay5cbiAgICBjb25zdCBwcm9jZWR1cmVCbG9jayA9IGJsb2Nrc1tpXSBhcyB1bmtub3duIGFzIFByb2NlZHVyZUJsb2NrO1xuICAgIGlmIChwcm9jZWR1cmVCbG9jay5nZXRQcm9jZWR1cmVEZWYpIHtcbiAgICAgIGNvbnN0IHByb2NOYW1lID0gcHJvY2VkdXJlQmxvY2suZ2V0UHJvY2VkdXJlRGVmKCk7XG4gICAgICBpZiAoTmFtZXMuZXF1YWxzKHByb2NOYW1lWzBdLCBuYW1lKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqIFJlbmFtZSBhIHByb2NlZHVyZS4gIENhbGxlZCBieSB0aGUgZWRpdGFibGUgZmllbGQuXG4gKlxuICogQHBhcmFtIG5hbWUgVGhlIHByb3Bvc2VkIG5ldyBuYW1lLlxuICogQHJldHVybnMgVGhlIGFjY2VwdGVkIG5hbWUuXG4gKiBAYWxpYXMgQmxvY2tseS5Qcm9jZWR1cmVzLnJlbmFtZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVuYW1lKHRoaXM6IEZpZWxkLCBuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgaWYgKCFibG9jaykge1xuICAgIHRocm93IG5ldyBVbmF0dGFjaGVkRmllbGRFcnJvcigpO1xuICB9XG5cbiAgLy8gU3RyaXAgbGVhZGluZyBhbmQgdHJhaWxpbmcgd2hpdGVzcGFjZS4gIEJleW9uZCB0aGlzLCBhbGwgbmFtZXMgYXJlIGxlZ2FsLlxuICBuYW1lID0gbmFtZS50cmltKCk7XG5cbiAgY29uc3QgbGVnYWxOYW1lID0gZmluZExlZ2FsTmFtZShuYW1lLCBibG9jayk7XG4gIGNvbnN0IG9sZE5hbWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gIGlmIChvbGROYW1lICE9PSBuYW1lICYmIG9sZE5hbWUgIT09IGxlZ2FsTmFtZSkge1xuICAgIC8vIFJlbmFtZSBhbnkgY2FsbGVycy5cbiAgICBjb25zdCBibG9ja3MgPSBibG9jay53b3Jrc3BhY2UuZ2V0QWxsQmxvY2tzKGZhbHNlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgICAgLy8gQXNzdW1lIGl0IGlzIGEgcHJvY2VkdXJlIHNvIHdlIGNhbiBjaGVjay5cbiAgICAgIGNvbnN0IHByb2NlZHVyZUJsb2NrID0gYmxvY2tzW2ldIGFzIHVua25vd24gYXMgUHJvY2VkdXJlQmxvY2s7XG4gICAgICBpZiAocHJvY2VkdXJlQmxvY2sucmVuYW1lUHJvY2VkdXJlKSB7XG4gICAgICAgIHByb2NlZHVyZUJsb2NrLnJlbmFtZVByb2NlZHVyZShvbGROYW1lIGFzIHN0cmluZywgbGVnYWxOYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxlZ2FsTmFtZTtcbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3QgdGhlIGJsb2NrcyByZXF1aXJlZCBieSB0aGUgZmx5b3V0IGZvciB0aGUgcHJvY2VkdXJlIGNhdGVnb3J5LlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBjb250YWluaW5nIHByb2NlZHVyZXMuXG4gKiBAcmV0dXJucyBBcnJheSBvZiBYTUwgYmxvY2sgZWxlbWVudHMuXG4gKiBAYWxpYXMgQmxvY2tseS5Qcm9jZWR1cmVzLmZseW91dENhdGVnb3J5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmbHlvdXRDYXRlZ29yeSh3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zyk6IEVsZW1lbnRbXSB7XG4gIGNvbnN0IHhtbExpc3QgPSBbXTtcbiAgaWYgKEJsb2Nrc1sncHJvY2VkdXJlc19kZWZub3JldHVybiddKSB7XG4gICAgLy8gPGJsb2NrIHR5cGU9XCJwcm9jZWR1cmVzX2RlZm5vcmV0dXJuXCIgZ2FwPVwiMTZcIj5cbiAgICAvLyAgICAgPGZpZWxkIG5hbWU9XCJOQU1FXCI+ZG8gc29tZXRoaW5nPC9maWVsZD5cbiAgICAvLyA8L2Jsb2NrPlxuICAgIGNvbnN0IGJsb2NrID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgnYmxvY2snKTtcbiAgICBibG9jay5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncHJvY2VkdXJlc19kZWZub3JldHVybicpO1xuICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgnZ2FwJywgJzE2Jyk7XG4gICAgY29uc3QgbmFtZUZpZWxkID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgnZmllbGQnKTtcbiAgICBuYW1lRmllbGQuc2V0QXR0cmlidXRlKCduYW1lJywgJ05BTUUnKTtcbiAgICBuYW1lRmllbGQuYXBwZW5kQ2hpbGQoXG4gICAgICAgIHV0aWxzWG1sLmNyZWF0ZVRleHROb2RlKE1zZ1snUFJPQ0VEVVJFU19ERUZOT1JFVFVSTl9QUk9DRURVUkUnXSkpO1xuICAgIGJsb2NrLmFwcGVuZENoaWxkKG5hbWVGaWVsZCk7XG4gICAgeG1sTGlzdC5wdXNoKGJsb2NrKTtcbiAgfVxuICBpZiAoQmxvY2tzWydwcm9jZWR1cmVzX2RlZnJldHVybiddKSB7XG4gICAgLy8gPGJsb2NrIHR5cGU9XCJwcm9jZWR1cmVzX2RlZnJldHVyblwiIGdhcD1cIjE2XCI+XG4gICAgLy8gICAgIDxmaWVsZCBuYW1lPVwiTkFNRVwiPmRvIHNvbWV0aGluZzwvZmllbGQ+XG4gICAgLy8gPC9ibG9jaz5cbiAgICBjb25zdCBibG9jayA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2Jsb2NrJyk7XG4gICAgYmxvY2suc2V0QXR0cmlidXRlKCd0eXBlJywgJ3Byb2NlZHVyZXNfZGVmcmV0dXJuJyk7XG4gICAgYmxvY2suc2V0QXR0cmlidXRlKCdnYXAnLCAnMTYnKTtcbiAgICBjb25zdCBuYW1lRmllbGQgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdmaWVsZCcpO1xuICAgIG5hbWVGaWVsZC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnTkFNRScpO1xuICAgIG5hbWVGaWVsZC5hcHBlbmRDaGlsZChcbiAgICAgICAgdXRpbHNYbWwuY3JlYXRlVGV4dE5vZGUoTXNnWydQUk9DRURVUkVTX0RFRlJFVFVSTl9QUk9DRURVUkUnXSkpO1xuICAgIGJsb2NrLmFwcGVuZENoaWxkKG5hbWVGaWVsZCk7XG4gICAgeG1sTGlzdC5wdXNoKGJsb2NrKTtcbiAgfVxuICBpZiAoQmxvY2tzWydwcm9jZWR1cmVzX2lmcmV0dXJuJ10pIHtcbiAgICAvLyA8YmxvY2sgdHlwZT1cInByb2NlZHVyZXNfaWZyZXR1cm5cIiBnYXA9XCIxNlwiPjwvYmxvY2s+XG4gICAgY29uc3QgYmxvY2sgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdibG9jaycpO1xuICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgndHlwZScsICdwcm9jZWR1cmVzX2lmcmV0dXJuJyk7XG4gICAgYmxvY2suc2V0QXR0cmlidXRlKCdnYXAnLCAnMTYnKTtcbiAgICB4bWxMaXN0LnB1c2goYmxvY2spO1xuICB9XG4gIGlmICh4bWxMaXN0Lmxlbmd0aCkge1xuICAgIC8vIEFkZCBzbGlnaHRseSBsYXJnZXIgZ2FwIGJldHdlZW4gc3lzdGVtIGJsb2NrcyBhbmQgdXNlciBjYWxscy5cbiAgICB4bWxMaXN0W3htbExpc3QubGVuZ3RoIC0gMV0uc2V0QXR0cmlidXRlKCdnYXAnLCAnMjQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgaXRlbXMgdG8geG1sTGlzdCBmb3IgZWFjaCBsaXN0ZWQgcHJvY2VkdXJlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvY2VkdXJlTGlzdCBBIGxpc3Qgb2YgcHJvY2VkdXJlcywgZWFjaCBvZiB3aGljaCBpcyBkZWZpbmVkIGJ5IGFcbiAgICogICAgIHRocmVlLWVsZW1lbnQgbGlzdCBvZiBuYW1lLCBwYXJhbWV0ZXIgbGlzdCwgYW5kIHJldHVybiB2YWx1ZSBib29sZWFuLlxuICAgKiBAcGFyYW0gdGVtcGxhdGVOYW1lIFRoZSB0eXBlIG9mIHRoZSBibG9jayB0byBnZW5lcmF0ZS5cbiAgICovXG4gIGZ1bmN0aW9uIHBvcHVsYXRlUHJvY2VkdXJlcyhcbiAgICAgIHByb2NlZHVyZUxpc3Q6IFByb2NlZHVyZVR1cGxlW10sIHRlbXBsYXRlTmFtZTogc3RyaW5nKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9jZWR1cmVMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBuYW1lID0gcHJvY2VkdXJlTGlzdFtpXVswXTtcbiAgICAgIGNvbnN0IGFyZ3MgPSBwcm9jZWR1cmVMaXN0W2ldWzFdO1xuICAgICAgLy8gPGJsb2NrIHR5cGU9XCJwcm9jZWR1cmVzX2NhbGxub3JldHVyblwiIGdhcD1cIjE2XCI+XG4gICAgICAvLyAgIDxtdXRhdGlvbiBuYW1lPVwiZG8gc29tZXRoaW5nXCI+XG4gICAgICAvLyAgICAgPGFyZyBuYW1lPVwieFwiPjwvYXJnPlxuICAgICAgLy8gICA8L211dGF0aW9uPlxuICAgICAgLy8gPC9ibG9jaz5cbiAgICAgIGNvbnN0IGJsb2NrID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgnYmxvY2snKTtcbiAgICAgIGJsb2NrLnNldEF0dHJpYnV0ZSgndHlwZScsIHRlbXBsYXRlTmFtZSk7XG4gICAgICBibG9jay5zZXRBdHRyaWJ1dGUoJ2dhcCcsICcxNicpO1xuICAgICAgY29uc3QgbXV0YXRpb24gPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdtdXRhdGlvbicpO1xuICAgICAgbXV0YXRpb24uc2V0QXR0cmlidXRlKCduYW1lJywgbmFtZSk7XG4gICAgICBibG9jay5hcHBlbmRDaGlsZChtdXRhdGlvbik7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGFyZ3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgYXJnID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgnYXJnJyk7XG4gICAgICAgIGFyZy5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBhcmdzW2pdKTtcbiAgICAgICAgbXV0YXRpb24uYXBwZW5kQ2hpbGQoYXJnKTtcbiAgICAgIH1cbiAgICAgIHhtbExpc3QucHVzaChibG9jayk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgdHVwbGUgPSBhbGxQcm9jZWR1cmVzKHdvcmtzcGFjZSk7XG4gIHBvcHVsYXRlUHJvY2VkdXJlcyh0dXBsZVswXSwgJ3Byb2NlZHVyZXNfY2FsbG5vcmV0dXJuJyk7XG4gIHBvcHVsYXRlUHJvY2VkdXJlcyh0dXBsZVsxXSwgJ3Byb2NlZHVyZXNfY2FsbHJldHVybicpO1xuICByZXR1cm4geG1sTGlzdDtcbn1cblxuLyoqXG4gKiBVcGRhdGVzIHRoZSBwcm9jZWR1cmUgbXV0YXRvcidzIGZseW91dCBzbyB0aGF0IHRoZSBhcmcgYmxvY2sgaXMgbm90IGFcbiAqIGR1cGxpY2F0ZSBvZiBhbm90aGVyIGFyZy5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSBwcm9jZWR1cmUgbXV0YXRvcidzIHdvcmtzcGFjZS4gVGhpcyB3b3Jrc3BhY2UncyBmbHlvdXRcbiAqICAgICBpcyB3aGF0IGlzIGJlaW5nIHVwZGF0ZWQuXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZU11dGF0b3JGbHlvdXQod29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpIHtcbiAgY29uc3QgdXNlZE5hbWVzID0gW107XG4gIGNvbnN0IGJsb2NrcyA9IHdvcmtzcGFjZS5nZXRCbG9ja3NCeVR5cGUoJ3Byb2NlZHVyZXNfbXV0YXRvcmFyZycsIGZhbHNlKTtcbiAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IGJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgdXNlZE5hbWVzLnB1c2goYmxvY2suZ2V0RmllbGRWYWx1ZSgnTkFNRScpKTtcbiAgfVxuXG4gIGNvbnN0IHhtbEVsZW1lbnQgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCd4bWwnKTtcbiAgY29uc3QgYXJnQmxvY2sgPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdibG9jaycpO1xuICBhcmdCbG9jay5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncHJvY2VkdXJlc19tdXRhdG9yYXJnJyk7XG4gIGNvbnN0IG5hbWVGaWVsZCA9IHV0aWxzWG1sLmNyZWF0ZUVsZW1lbnQoJ2ZpZWxkJyk7XG4gIG5hbWVGaWVsZC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnTkFNRScpO1xuICBjb25zdCBhcmdWYWx1ZSA9XG4gICAgICBWYXJpYWJsZXMuZ2VuZXJhdGVVbmlxdWVOYW1lRnJvbU9wdGlvbnMoREVGQVVMVF9BUkcsIHVzZWROYW1lcyk7XG4gIGNvbnN0IGZpZWxkQ29udGVudCA9IHV0aWxzWG1sLmNyZWF0ZVRleHROb2RlKGFyZ1ZhbHVlKTtcblxuICBuYW1lRmllbGQuYXBwZW5kQ2hpbGQoZmllbGRDb250ZW50KTtcbiAgYXJnQmxvY2suYXBwZW5kQ2hpbGQobmFtZUZpZWxkKTtcbiAgeG1sRWxlbWVudC5hcHBlbmRDaGlsZChhcmdCbG9jayk7XG5cbiAgd29ya3NwYWNlLnVwZGF0ZVRvb2xib3goeG1sRWxlbWVudCk7XG59XG5cbi8qKlxuICogTGlzdGVucyBmb3Igd2hlbiBhIHByb2NlZHVyZSBtdXRhdG9yIGlzIG9wZW5lZC4gVGhlbiBpdCB0cmlnZ2VycyBhIGZseW91dFxuICogdXBkYXRlIGFuZCBhZGRzIGEgbXV0YXRvciBjaGFuZ2UgbGlzdGVuZXIgdG8gdGhlIG11dGF0b3Igd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSBlIFRoZSBldmVudCB0aGF0IHRyaWdnZXJlZCB0aGlzIGxpc3RlbmVyLlxuICogQGFsaWFzIEJsb2NrbHkuUHJvY2VkdXJlcy5tdXRhdG9yT3Blbkxpc3RlbmVyXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG11dGF0b3JPcGVuTGlzdGVuZXIoZTogQWJzdHJhY3QpIHtcbiAgaWYgKGUudHlwZSAhPT0gZXZlbnRVdGlscy5CVUJCTEVfT1BFTikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBidWJibGVFdmVudCA9IGUgYXMgQnViYmxlT3BlbjtcbiAgaWYgKCEoYnViYmxlRXZlbnQuYnViYmxlVHlwZSA9PT0gJ211dGF0b3InICYmIGJ1YmJsZUV2ZW50LmlzT3BlbikgfHxcbiAgICAgICFidWJibGVFdmVudC5ibG9ja0lkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHdvcmtzcGFjZUlkID0gKGJ1YmJsZUV2ZW50LndvcmtzcGFjZUlkKTtcbiAgY29uc3QgYmxvY2sgPSBjb21tb24uZ2V0V29ya3NwYWNlQnlJZCh3b3Jrc3BhY2VJZCkhLmdldEJsb2NrQnlJZChcbiAgICAgICAgICAgICAgICAgICAgYnViYmxlRXZlbnQuYmxvY2tJZCkgYXMgQmxvY2tTdmc7XG4gIGNvbnN0IHR5cGUgPSBibG9jay50eXBlO1xuICBpZiAodHlwZSAhPT0gJ3Byb2NlZHVyZXNfZGVmbm9yZXR1cm4nICYmIHR5cGUgIT09ICdwcm9jZWR1cmVzX2RlZnJldHVybicpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qgd29ya3NwYWNlID0gYmxvY2subXV0YXRvciEuZ2V0V29ya3NwYWNlKCkgYXMgV29ya3NwYWNlU3ZnO1xuICB1cGRhdGVNdXRhdG9yRmx5b3V0KHdvcmtzcGFjZSk7XG4gIHdvcmtzcGFjZS5hZGRDaGFuZ2VMaXN0ZW5lcihtdXRhdG9yQ2hhbmdlTGlzdGVuZXIpO1xufVxuLyoqXG4gKiBMaXN0ZW5zIGZvciBjaGFuZ2VzIGluIGEgcHJvY2VkdXJlIG11dGF0b3IgYW5kIHRyaWdnZXJzIGZseW91dCB1cGRhdGVzIHdoZW5cbiAqIG5lY2Vzc2FyeS5cbiAqXG4gKiBAcGFyYW0gZSBUaGUgZXZlbnQgdGhhdCB0cmlnZ2VyZWQgdGhpcyBsaXN0ZW5lci5cbiAqL1xuZnVuY3Rpb24gbXV0YXRvckNoYW5nZUxpc3RlbmVyKGU6IEFic3RyYWN0KSB7XG4gIGlmIChlLnR5cGUgIT09IGV2ZW50VXRpbHMuQkxPQ0tfQ1JFQVRFICYmXG4gICAgICBlLnR5cGUgIT09IGV2ZW50VXRpbHMuQkxPQ0tfREVMRVRFICYmXG4gICAgICBlLnR5cGUgIT09IGV2ZW50VXRpbHMuQkxPQ0tfQ0hBTkdFKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHdvcmtzcGFjZUlkID0gZS53b3Jrc3BhY2VJZCBhcyBzdHJpbmc7XG4gIGNvbnN0IHdvcmtzcGFjZSA9IGNvbW1vbi5nZXRXb3Jrc3BhY2VCeUlkKHdvcmtzcGFjZUlkKSBhcyBXb3Jrc3BhY2VTdmc7XG4gIHVwZGF0ZU11dGF0b3JGbHlvdXQod29ya3NwYWNlKTtcbn1cblxuLyoqXG4gKiBGaW5kIGFsbCB0aGUgY2FsbGVycyBvZiBhIG5hbWVkIHByb2NlZHVyZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHByb2NlZHVyZS5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBmaW5kIGNhbGxlcnMgaW4uXG4gKiBAcmV0dXJucyBBcnJheSBvZiBjYWxsZXIgYmxvY2tzLlxuICogQGFsaWFzIEJsb2NrbHkuUHJvY2VkdXJlcy5nZXRDYWxsZXJzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDYWxsZXJzKG5hbWU6IHN0cmluZywgd29ya3NwYWNlOiBXb3Jrc3BhY2UpOiBCbG9ja1tdIHtcbiAgY29uc3QgY2FsbGVycyA9IFtdO1xuICBjb25zdCBibG9ja3MgPSB3b3Jrc3BhY2UuZ2V0QWxsQmxvY2tzKGZhbHNlKTtcbiAgLy8gSXRlcmF0ZSB0aHJvdWdoIGV2ZXJ5IGJsb2NrIGFuZCBjaGVjayB0aGUgbmFtZS5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAvLyBBc3N1bWUgaXQgaXMgYSBwcm9jZWR1cmUgYmxvY2sgc28gd2UgY2FuIGNoZWNrLlxuICAgIGNvbnN0IHByb2NlZHVyZUJsb2NrID0gYmxvY2tzW2ldIGFzIHVua25vd24gYXMgUHJvY2VkdXJlQmxvY2s7XG4gICAgaWYgKHByb2NlZHVyZUJsb2NrLmdldFByb2NlZHVyZUNhbGwpIHtcbiAgICAgIGNvbnN0IHByb2NOYW1lID0gcHJvY2VkdXJlQmxvY2suZ2V0UHJvY2VkdXJlQ2FsbCgpO1xuICAgICAgLy8gUHJvY2VkdXJlIG5hbWUgbWF5IGJlIG51bGwgaWYgdGhlIGJsb2NrIGlzIG9ubHkgaGFsZi1idWlsdC5cbiAgICAgIGlmIChwcm9jTmFtZSAmJiBOYW1lcy5lcXVhbHMocHJvY05hbWUsIG5hbWUpKSB7XG4gICAgICAgIGNhbGxlcnMucHVzaChibG9ja3NbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gY2FsbGVycztcbn1cblxuLyoqXG4gKiBXaGVuIGEgcHJvY2VkdXJlIGRlZmluaXRpb24gY2hhbmdlcyBpdHMgcGFyYW1ldGVycywgZmluZCBhbmQgZWRpdCBhbGwgaXRzXG4gKiBjYWxsZXJzLlxuICpcbiAqIEBwYXJhbSBkZWZCbG9jayBQcm9jZWR1cmUgZGVmaW5pdGlvbiBibG9jay5cbiAqIEBhbGlhcyBCbG9ja2x5LlByb2NlZHVyZXMubXV0YXRlQ2FsbGVyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gbXV0YXRlQ2FsbGVycyhkZWZCbG9jazogQmxvY2spIHtcbiAgY29uc3Qgb2xkUmVjb3JkVW5kbyA9IGV2ZW50VXRpbHMuZ2V0UmVjb3JkVW5kbygpO1xuICBjb25zdCBwcm9jZWR1cmVCbG9jayA9IGRlZkJsb2NrIGFzIHVua25vd24gYXMgUHJvY2VkdXJlQmxvY2s7XG4gIGNvbnN0IG5hbWUgPSBwcm9jZWR1cmVCbG9jay5nZXRQcm9jZWR1cmVEZWYoKVswXTtcbiAgY29uc3QgeG1sRWxlbWVudCA9IGRlZkJsb2NrLm11dGF0aW9uVG9Eb20hKHRydWUpO1xuICBjb25zdCBjYWxsZXJzID0gZ2V0Q2FsbGVycyhuYW1lLCBkZWZCbG9jay53b3Jrc3BhY2UpO1xuICBmb3IgKGxldCBpID0gMCwgY2FsbGVyOyBjYWxsZXIgPSBjYWxsZXJzW2ldOyBpKyspIHtcbiAgICBjb25zdCBvbGRNdXRhdGlvbkRvbSA9IGNhbGxlci5tdXRhdGlvblRvRG9tISgpO1xuICAgIGNvbnN0IG9sZE11dGF0aW9uID0gb2xkTXV0YXRpb25Eb20gJiYgWG1sLmRvbVRvVGV4dChvbGRNdXRhdGlvbkRvbSk7XG4gICAgaWYgKGNhbGxlci5kb21Ub011dGF0aW9uKSB7XG4gICAgICBjYWxsZXIuZG9tVG9NdXRhdGlvbih4bWxFbGVtZW50KTtcbiAgICB9XG4gICAgY29uc3QgbmV3TXV0YXRpb25Eb20gPSBjYWxsZXIubXV0YXRpb25Ub0RvbSEoKTtcbiAgICBjb25zdCBuZXdNdXRhdGlvbiA9IG5ld011dGF0aW9uRG9tICYmIFhtbC5kb21Ub1RleHQobmV3TXV0YXRpb25Eb20pO1xuICAgIGlmIChvbGRNdXRhdGlvbiAhPT0gbmV3TXV0YXRpb24pIHtcbiAgICAgIC8vIEZpcmUgYSBtdXRhdGlvbiBvbiBldmVyeSBjYWxsZXIgYmxvY2suICBCdXQgZG9uJ3QgcmVjb3JkIHRoaXMgYXMgYW5cbiAgICAgIC8vIHVuZG8gYWN0aW9uIHNpbmNlIGl0IGlzIGRldGVybWluaXN0aWNhbGx5IHRpZWQgdG8gdGhlIHByb2NlZHVyZSdzXG4gICAgICAvLyBkZWZpbml0aW9uIG11dGF0aW9uLlxuICAgICAgZXZlbnRVdGlscy5zZXRSZWNvcmRVbmRvKGZhbHNlKTtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuQkxPQ0tfQ0hBTkdFKSkoXG4gICAgICAgICAgY2FsbGVyLCAnbXV0YXRpb24nLCBudWxsLCBvbGRNdXRhdGlvbiwgbmV3TXV0YXRpb24pKTtcbiAgICAgIGV2ZW50VXRpbHMuc2V0UmVjb3JkVW5kbyhvbGRSZWNvcmRVbmRvKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBGaW5kIHRoZSBkZWZpbml0aW9uIGJsb2NrIGZvciB0aGUgbmFtZWQgcHJvY2VkdXJlLlxuICpcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgcHJvY2VkdXJlLlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNlYXJjaC5cbiAqIEByZXR1cm5zIFRoZSBwcm9jZWR1cmUgZGVmaW5pdGlvbiBibG9jaywgb3IgbnVsbCBub3QgZm91bmQuXG4gKiBAYWxpYXMgQmxvY2tseS5Qcm9jZWR1cmVzLmdldERlZmluaXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmluaXRpb24obmFtZTogc3RyaW5nLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IEJsb2NrfG51bGwge1xuICAvLyBEbyBub3QgYXNzdW1lIHByb2NlZHVyZSBpcyBhIHRvcCBibG9jay4gU29tZSBsYW5ndWFnZXMgYWxsb3cgbmVzdGVkXG4gIC8vIHByb2NlZHVyZXMuIEFsc28gZG8gbm90IGFzc3VtZSBpdCBpcyBvbmUgb2YgdGhlIGJ1aWx0LWluIGJsb2Nrcy4gT25seVxuICAvLyByZWx5IG9uIGdldFByb2NlZHVyZURlZi5cbiAgY29uc3QgYmxvY2tzID0gd29ya3NwYWNlLmdldEFsbEJsb2NrcyhmYWxzZSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgLy8gQXNzdW1lIGl0IGlzIGEgcHJvY2VkdXJlIGJsb2NrIHNvIHdlIGNhbiBjaGVjay5cbiAgICBjb25zdCBwcm9jZWR1cmVCbG9jayA9IGJsb2Nrc1tpXSBhcyB1bmtub3duIGFzIFByb2NlZHVyZUJsb2NrO1xuICAgIGlmIChwcm9jZWR1cmVCbG9jay5nZXRQcm9jZWR1cmVEZWYpIHtcbiAgICAgIGNvbnN0IHR1cGxlID0gcHJvY2VkdXJlQmxvY2suZ2V0UHJvY2VkdXJlRGVmKCk7XG4gICAgICBpZiAodHVwbGUgJiYgTmFtZXMuZXF1YWxzKHR1cGxlWzBdLCBuYW1lKSkge1xuICAgICAgICByZXR1cm4gYmxvY2tzW2ldOyAgLy8gQ2FuJ3QgdXNlIHByb2NlZHVyZUJsb2NrIHZhciBkdWUgdG8gdHlwZSBjaGVjay5cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCB7XG4gIE9ic2VydmFibGVQcm9jZWR1cmVNYXAsXG4gIE9ic2VydmFibGVQcm9jZWR1cmVNb2RlbCxcbiAgT2JzZXJ2YWJsZVBhcmFtZXRlck1vZGVsLFxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBwcm92aWRlcyBjb25zdGFudHMgZm9yIHJlbmRlcmluZyBibG9ja3MuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tSZW5kZXJpbmcuQ29uc3RhbnRQcm92aWRlcicpO1xuXG5pbXBvcnQge0Nvbm5lY3Rpb25UeXBlfSBmcm9tICcuLi8uLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlcmVkQ29ubmVjdGlvbn0gZnJvbSAnLi4vLi4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdHlsZSwgVGhlbWV9IGZyb20gJy4uLy4uL3RoZW1lLmpzJztcbmltcG9ydCAqIGFzIGNvbG91ciBmcm9tICcuLi8uLi91dGlscy9jb2xvdXIuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4uLy4uL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4uLy4uL3V0aWxzL3BhcnNpbmcuanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4uLy4uL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdQYXRocyBmcm9tICcuLi8uLi91dGlscy9zdmdfcGF0aHMuanMnO1xuXG5cbi8qKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgb3V0c2lkZSBjb3JuZXJzLiAqL1xuZXhwb3J0IGludGVyZmFjZSBPdXRzaWRlQ29ybmVycyB7XG4gIHRvcExlZnQ6IHN0cmluZztcbiAgdG9wUmlnaHQ6IHN0cmluZztcbiAgYm90dG9tUmlnaHQ6IHN0cmluZztcbiAgYm90dG9tTGVmdDogc3RyaW5nO1xuICByaWdodEhlaWdodDogbnVtYmVyO1xufVxuXG4vKiogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGluc2lkZSBjb3JuZXJzLiAqL1xuZXhwb3J0IGludGVyZmFjZSBJbnNpZGVDb3JuZXJzIHtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHBhdGhUb3A6IHN0cmluZztcbiAgcGF0aEJvdHRvbTogc3RyaW5nO1xufVxuXG4vKiogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGEgc3RhcnQgaGF0LiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdGFydEhhdCB7XG4gIGhlaWdodDogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICBwYXRoOiBzdHJpbmc7XG59XG5cbi8qKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgYSBub3RjaC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTm90Y2gge1xuICB0eXBlOiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBwYXRoTGVmdDogc3RyaW5nO1xuICBwYXRoUmlnaHQ6IHN0cmluZztcbn1cblxuLyoqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBhIHB1enpsZSB0YWIuICovXG5leHBvcnQgaW50ZXJmYWNlIFB1enpsZVRhYiB7XG4gIHR5cGU6IG51bWJlcjtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHBhdGhEb3duOiBzdHJpbmd8KChwMTogbnVtYmVyKSA9PiBzdHJpbmcpO1xuICBwYXRoVXA6IHN0cmluZ3woKHAxOiBudW1iZXIpID0+IHN0cmluZyk7XG59XG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGNvbGxhcHNlZCBibG9ja1xuICogaW5kaWNhdG9ycy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBKYWdnZWRUZWV0aCB7XG4gIGhlaWdodDogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICBwYXRoOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEJhc2VTaGFwZSA9IHtcbiAgdHlwZTogbnVtYmVyOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlcjtcbn07XG5cbi8qKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHR5cGUgaW5mb3JtYXRpb24gYWJvdXQgYSBkeW5hbWljIHNoYXBlLiAqL1xuZXhwb3J0IHR5cGUgRHluYW1pY1NoYXBlID0ge1xuICB0eXBlOiBudW1iZXI7IHdpZHRoOiAocDE6IG51bWJlcikgPT4gbnVtYmVyOyBoZWlnaHQ6IChwMTogbnVtYmVyKSA9PiBudW1iZXI7XG4gIGlzRHluYW1pYzogdHJ1ZTtcbiAgY29ubmVjdGlvbk9mZnNldFk6IChwMTogbnVtYmVyKSA9PiBudW1iZXI7XG4gIGNvbm5lY3Rpb25PZmZzZXRYOiAocDE6IG51bWJlcikgPT4gbnVtYmVyO1xuICBwYXRoRG93bjogKHAxOiBudW1iZXIpID0+IHN0cmluZztcbiAgcGF0aFVwOiAocDE6IG51bWJlcikgPT4gc3RyaW5nO1xuICBwYXRoUmlnaHREb3duOiAocDE6IG51bWJlcikgPT4gc3RyaW5nO1xuICBwYXRoUmlnaHRVcDogKHAxOiBudW1iZXIpID0+IHN0cmluZztcbn07XG5cbi8qKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHR5cGUgaW5mb3JtYXRpb24gYWJvdXQgYSBzaGFwZS4gKi9cbmV4cG9ydCB0eXBlIFNoYXBlID0gQmFzZVNoYXBlfER5bmFtaWNTaGFwZTtcblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHNoYXBlIGlzIGR5bmFtaWMgb3Igbm90LlxuICpcbiAqIEBwYXJhbSBzaGFwZSBUaGUgc2hhcGUgdG8gY2hlY2sgZm9yIGR5bmFtaWMtbmVzcy5cbiAqIEByZXR1cm5zIFdoZXRoZXIgdGhlIHNoYXBlIGlzIGEgZHluYW1pYyBzaGFwZSBvciBub3QuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0R5bmFtaWNTaGFwZShzaGFwZTogU2hhcGUpOiBzaGFwZSBpcyBEeW5hbWljU2hhcGUge1xuICByZXR1cm4gKHNoYXBlIGFzIER5bmFtaWNTaGFwZSkuaXNEeW5hbWljO1xufVxuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IHByb3ZpZGVzIGNvbnN0YW50cyBmb3IgcmVuZGVyaW5nIGJsb2Nrcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5Db25zdGFudFByb3ZpZGVyXG4gKi9cbmV4cG9ydCBjbGFzcyBDb25zdGFudFByb3ZpZGVyIHtcbiAgLyoqIFRoZSBzaXplIG9mIGFuIGVtcHR5IHNwYWNlci4gKi9cbiAgTk9fUEFERElORyA9IDA7XG5cbiAgLyoqIFRoZSBzaXplIG9mIHNtYWxsIHBhZGRpbmcuICovXG4gIFNNQUxMX1BBRERJTkcgPSAzO1xuXG4gIC8qKiBUaGUgc2l6ZSBvZiBtZWRpdW0gcGFkZGluZy4gKi9cbiAgTUVESVVNX1BBRERJTkcgPSA1O1xuXG4gIC8qKiBUaGUgc2l6ZSBvZiBtZWRpdW0tbGFyZ2UgcGFkZGluZy4gKi9cbiAgTUVESVVNX0xBUkdFX1BBRERJTkcgPSA4O1xuXG4gIC8qKiBUaGUgc2l6ZSBvZiBsYXJnZSBwYWRkaW5nLiAqL1xuICBMQVJHRV9QQURESU5HID0gMTA7XG4gIFRBTExfSU5QVVRfRklFTERfT0ZGU0VUX1k6IG51bWJlcjtcblxuICAvKiogVGhlIGhlaWdodCBvZiB0aGUgcHV6emxlIHRhYiB1c2VkIGZvciBpbnB1dCBhbmQgb3V0cHV0IGNvbm5lY3Rpb25zLiAqL1xuICBUQUJfSEVJR0hUID0gMTU7XG5cbiAgLyoqXG4gICAqIFRoZSBvZmZzZXQgZnJvbSB0aGUgdG9wIG9mIHRoZSBibG9jayBhdCB3aGljaCBhIHB1enpsZSB0YWIgaXMgcG9zaXRpb25lZC5cbiAgICovXG4gIFRBQl9PRkZTRVRfRlJPTV9UT1AgPSA1O1xuXG4gIC8qKlxuICAgKiBWZXJ0aWNhbCBvdmVybGFwIG9mIHRoZSBwdXp6bGUgdGFiLCB1c2VkIHRvIG1ha2UgaXQgbG9vayBtb3JlIGxpa2UgYVxuICAgKiBwdXp6bGUgcGllY2UuXG4gICAqL1xuICBUQUJfVkVSVElDQUxfT1ZFUkxBUCA9IDIuNTtcblxuICAvKiogVGhlIHdpZHRoIG9mIHRoZSBwdXp6bGUgdGFiIHVzZWQgZm9yIGlucHV0IGFuZCBvdXRwdXQgY29ubmVjdGlvbnMuICovXG4gIFRBQl9XSURUSCA9IDg7XG5cbiAgLyoqIFRoZSB3aWR0aCBvZiB0aGUgbm90Y2ggdXNlZCBmb3IgcHJldmlvdXMgYW5kIG5leHQgY29ubmVjdGlvbnMuICovXG4gIE5PVENIX1dJRFRIID0gMTU7XG5cbiAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIG5vdGNoIHVzZWQgZm9yIHByZXZpb3VzIGFuZCBuZXh0IGNvbm5lY3Rpb25zLiAqL1xuICBOT1RDSF9IRUlHSFQgPSA0O1xuXG4gIC8qKiBUaGUgbWluaW11bSB3aWR0aCBvZiB0aGUgYmxvY2suICovXG4gIE1JTl9CTE9DS19XSURUSCA9IDEyO1xuICBFTVBUWV9CTE9DS19TUEFDRVJfSEVJR0hUID0gMTY7XG4gIERVTU1ZX0lOUFVUX01JTl9IRUlHSFQ6IG51bWJlcjtcbiAgRFVNTVlfSU5QVVRfU0hBRE9XX01JTl9IRUlHSFQ6IG51bWJlcjtcblxuICAvKiogUm91bmRlZCBjb3JuZXIgcmFkaXVzLiAqL1xuICBDT1JORVJfUkFESVVTID0gODtcblxuICAvKipcbiAgICogT2Zmc2V0IGZyb20gdGhlIGxlZnQgc2lkZSBvZiBhIGJsb2NrIG9yIHRoZSBpbnNpZGUgb2YgYSBzdGF0ZW1lbnQgaW5wdXRcbiAgICogdG8gdGhlIGxlZnQgc2lkZSBvZiB0aGUgbm90Y2guXG4gICAqL1xuICBOT1RDSF9PRkZTRVRfTEVGVCA9IDE1O1xuICBTVEFURU1FTlRfSU5QVVRfTk9UQ0hfT0ZGU0VUOiBudW1iZXI7XG5cbiAgU1RBVEVNRU5UX0JPVFRPTV9TUEFDRVIgPSAwO1xuICBTVEFURU1FTlRfSU5QVVRfUEFERElOR19MRUZUID0gMjA7XG5cbiAgLyoqIFZlcnRpY2FsIHBhZGRpbmcgYmV0d2VlbiBjb25zZWN1dGl2ZSBzdGF0ZW1lbnQgaW5wdXRzLiAqL1xuICBCRVRXRUVOX1NUQVRFTUVOVF9QQURESU5HX1kgPSA0O1xuICBUT1BfUk9XX01JTl9IRUlHSFQ6IG51bWJlcjtcbiAgVE9QX1JPV19QUkVDRURFU19TVEFURU1FTlRfTUlOX0hFSUdIVDogbnVtYmVyO1xuICBCT1RUT01fUk9XX01JTl9IRUlHSFQ6IG51bWJlcjtcbiAgQk9UVE9NX1JPV19BRlRFUl9TVEFURU1FTlRfTUlOX0hFSUdIVDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGFkZCBhICdoYXQnIG9uIHRvcCBvZiBhbGwgYmxvY2tzIHdpdGggbm8gcHJldmlvdXMgb3Igb3V0cHV0XG4gICAqIGNvbm5lY3Rpb25zLiBDYW4gYmUgb3ZlcnJpZGRlbiBieSAnaGF0JyBwcm9wZXJ0eSBvbiBUaGVtZS5CbG9ja1N0eWxlLlxuICAgKi9cbiAgQUREX1NUQVJUX0hBVFMgPSBmYWxzZTtcblxuICAvKiogSGVpZ2h0IG9mIHRoZSB0b3AgaGF0LiAqL1xuICBTVEFSVF9IQVRfSEVJR0hUID0gMTU7XG5cbiAgLyoqIFdpZHRoIG9mIHRoZSB0b3AgaGF0LiAqL1xuICBTVEFSVF9IQVRfV0lEVEggPSAxMDA7XG5cbiAgU1BBQ0VSX0RFRkFVTFRfSEVJR0hUID0gMTU7XG5cbiAgTUlOX0JMT0NLX0hFSUdIVCA9IDI0O1xuXG4gIEVNUFRZX0lOTElORV9JTlBVVF9QQURESU5HID0gMTQuNTtcbiAgRU1QVFlfSU5MSU5FX0lOUFVUX0hFSUdIVDogbnVtYmVyO1xuXG4gIEVYVEVSTkFMX1ZBTFVFX0lOUFVUX1BBRERJTkcgPSAyO1xuICBFTVBUWV9TVEFURU1FTlRfSU5QVVRfSEVJR0hUOiBudW1iZXI7XG4gIFNUQVJUX1BPSU5UOiBzdHJpbmc7XG5cbiAgLyoqIEhlaWdodCBvZiBTVkcgcGF0aCBmb3IgamFnZ2VkIHRlZXRoIGF0IHRoZSBlbmQgb2YgY29sbGFwc2VkIGJsb2Nrcy4gKi9cbiAgSkFHR0VEX1RFRVRIX0hFSUdIVCA9IDEyO1xuXG4gIC8qKiBXaWR0aCBvZiBTVkcgcGF0aCBmb3IgamFnZ2VkIHRlZXRoIGF0IHRoZSBlbmQgb2YgY29sbGFwc2VkIGJsb2Nrcy4gKi9cbiAgSkFHR0VEX1RFRVRIX1dJRFRIID0gNjtcblxuICAvKiogUG9pbnQgc2l6ZSBvZiB0ZXh0LiAqL1xuICBGSUVMRF9URVhUX0ZPTlRTSVpFID0gMTE7XG5cbiAgLyoqIFRleHQgZm9udCB3ZWlnaHQuICovXG4gIEZJRUxEX1RFWFRfRk9OVFdFSUdIVCA9ICdub3JtYWwnO1xuXG4gIC8qKiBUZXh0IGZvbnQgZmFtaWx5LiAqL1xuICBGSUVMRF9URVhUX0ZPTlRGQU1JTFkgPSAnc2Fucy1zZXJpZic7XG5cbiAgLyoqXG4gICAqIEhlaWdodCBvZiB0ZXh0LiAgVGhpcyBjb25zdGFudCBpcyBkeW5hbWljYWxseSBzZXQgaW5cbiAgICogYHNldEZvbnRDb25zdGFudHNfYCB0byBiZSB0aGUgaGVpZ2h0IG9mIHRoZSB0ZXh0IGJhc2VkIG9uIHRoZSBmb250XG4gICAqIHVzZWQuXG4gICAqL1xuICBGSUVMRF9URVhUX0hFSUdIVCA9IC0xOyAgLy8gRHluYW1pY2FsbHkgc2V0LlxuXG4gIC8qKlxuICAgKiBUZXh0IGJhc2VsaW5lLiAgVGhpcyBjb25zdGFudCBpcyBkeW5hbWljYWxseSBzZXQgaW4gYHNldEZvbnRDb25zdGFudHNfYFxuICAgKiB0byBiZSB0aGUgYmFzZWxpbmUgb2YgdGhlIHRleHQgYmFzZWQgb24gdGhlIGZvbnQgdXNlZC5cbiAgICovXG4gIEZJRUxEX1RFWFRfQkFTRUxJTkUgPSAtMTsgIC8vIER5bmFtaWNhbGx5IHNldC5cblxuICAvKiogQSBmaWVsZCdzIGJvcmRlciByZWN0IGNvcm5lciByYWRpdXMuICovXG4gIEZJRUxEX0JPUkRFUl9SRUNUX1JBRElVUyA9IDQ7XG5cbiAgLyoqIEEgZmllbGQncyBib3JkZXIgcmVjdCBkZWZhdWx0IGhlaWdodC4gKi9cbiAgRklFTERfQk9SREVSX1JFQ1RfSEVJR0hUID0gMTY7XG5cbiAgLyoqIEEgZmllbGQncyBib3JkZXIgcmVjdCBYIHBhZGRpbmcuICovXG4gIEZJRUxEX0JPUkRFUl9SRUNUX1hfUEFERElORyA9IDU7XG5cbiAgLyoqIEEgZmllbGQncyBib3JkZXIgcmVjdCBZIHBhZGRpbmcuICovXG4gIEZJRUxEX0JPUkRFUl9SRUNUX1lfUEFERElORyA9IDM7XG5cbiAgLyoqXG4gICAqIFRoZSBiYWNraW5nIGNvbG91ciBvZiBhIGZpZWxkJ3MgYm9yZGVyIHJlY3QuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgRklFTERfQk9SREVSX1JFQ1RfQ09MT1VSID0gJyNmZmYnO1xuICBGSUVMRF9URVhUX0JBU0VMSU5FX0NFTlRFUjogYm9vbGVhbjtcbiAgRklFTERfRFJPUERPV05fQk9SREVSX1JFQ1RfSEVJR0hUOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IGEgZHJvcGRvd24gZmllbGQgc2hvdWxkIGFkZCBhIGJvcmRlciByZWN0IHdoZW4gaW4gYSBzaGFkb3dcbiAgICogYmxvY2suXG4gICAqL1xuICBGSUVMRF9EUk9QRE9XTl9OT19CT1JERVJfUkVDVF9TSEFET1cgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciBvciBub3QgYSBkcm9wZG93biBmaWVsZCdzIGRpdiBzaG91bGQgYmUgY29sb3VyZWQgdG8gbWF0Y2ggdGhlXG4gICAqIGJsb2NrIGNvbG91cnMuXG4gICAqL1xuICBGSUVMRF9EUk9QRE9XTl9DT0xPVVJFRF9ESVYgPSBmYWxzZTtcblxuICAvKiogV2hldGhlciBvciBub3QgYSBkcm9wZG93biBmaWVsZCB1c2VzIGEgdGV4dCBvciBTVkcgYXJyb3cuICovXG4gIEZJRUxEX0RST1BET1dOX1NWR19BUlJPVyA9IGZhbHNlO1xuICBGSUVMRF9EUk9QRE9XTl9TVkdfQVJST1dfUEFERElORzogbnVtYmVyO1xuXG4gIC8qKiBBIGRyb3Bkb3duIGZpZWxkJ3MgU1ZHIGFycm93IHNpemUuICovXG4gIEZJRUxEX0RST1BET1dOX1NWR19BUlJPV19TSVpFID0gMTI7XG4gIEZJRUxEX0RST1BET1dOX1NWR19BUlJPV19EQVRBVVJJOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRvIHNob3cgYSBib3ggc2hhZG93IGFyb3VuZCB0aGUgd2lkZ2V0IGRpdi4gVGhpcyBpcyBvbmx5IGFcbiAgICogZmVhdHVyZSBvZiBmdWxsIGJsb2NrIGZpZWxkcy5cbiAgICovXG4gIEZJRUxEX1RFWFRJTlBVVF9CT1hfU0hBRE9XID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRoZSBjb2xvdXIgZmllbGQgc2hvdWxkIGRpc3BsYXkgaXRzIGNvbG91ciB2YWx1ZSBvbiB0aGVcbiAgICogZW50aXJlIGJsb2NrLlxuICAgKi9cbiAgRklFTERfQ09MT1VSX0ZVTExfQkxPQ0sgPSBmYWxzZTtcblxuICAvKiogQSBjb2xvdXIgZmllbGQncyBkZWZhdWx0IHdpZHRoLiAqL1xuICBGSUVMRF9DT0xPVVJfREVGQVVMVF9XSURUSCA9IDI2O1xuICBGSUVMRF9DT0xPVVJfREVGQVVMVF9IRUlHSFQ6IG51bWJlcjtcbiAgRklFTERfQ0hFQ0tCT1hfWF9PRkZTRVQ6IG51bWJlcjtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICByYW5kb21JZGVudGlmaWVyOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBkZWZzIHRhZyB0aGF0IGNvbnRhaW5zIGFsbCBmaWx0ZXJzIGFuZCBwYXR0ZXJucyBmb3IgdGhpcyBCbG9ja2x5XG4gICAqIGluc3RhbmNlLlxuICAgKi9cbiAgcHJpdmF0ZSBkZWZzXzogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBlbWJvc3MgZmlsdGVyLCBvciB0aGUgZW1wdHkgc3RyaW5nIGlmIG5vIGZpbHRlciBpcyBzZXQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZW1ib3NzRmlsdGVySWQgPSAnJztcblxuICAvKiogVGhlIDxmaWx0ZXI+IGVsZW1lbnQgdG8gdXNlIGZvciBoaWdobGlnaHRpbmcsIG9yIG51bGwgaWYgbm90IHNldC4gKi9cbiAgcHJpdmF0ZSBlbWJvc3NGaWx0ZXJfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGRpc2FibGVkIHBhdHRlcm4sIG9yIHRoZSBlbXB0eSBzdHJpbmcgaWYgbm8gcGF0dGVybiBpcyBzZXQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzYWJsZWRQYXR0ZXJuSWQgPSAnJztcblxuICAvKipcbiAgICogVGhlIDxwYXR0ZXJuPiBlbGVtZW50IHRvIHVzZSBmb3IgZGlzYWJsZWQgYmxvY2tzLCBvciBudWxsIGlmIG5vdCBzZXQuXG4gICAqL1xuICBwcml2YXRlIGRpc2FibGVkUGF0dGVybl86IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgZGVidWcgZmlsdGVyLCBvciB0aGUgZW1wdHkgc3RyaW5nIGlmIG5vIHBhdHRlcm4gaXMgc2V0LlxuICAgKi9cbiAgZGVidWdGaWx0ZXJJZCA9ICcnO1xuXG4gIC8qKlxuICAgKiBUaGUgPGZpbHRlcj4gZWxlbWVudCB0byB1c2UgZm9yIGEgZGVidWcgaGlnaGxpZ2h0LCBvciBudWxsIGlmIG5vdCBzZXQuXG4gICAqL1xuICBwcml2YXRlIGRlYnVnRmlsdGVyXzogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIDxzdHlsZT4gZWxlbWVudCB0byB1c2UgZm9yIGluamVjdGluZyByZW5kZXJlciBzcGVjaWZpYyBDU1MuICovXG4gIHByaXZhdGUgY3NzTm9kZV86IEhUTUxTdHlsZUVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEN1cnNvciBjb2xvdXIuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgQ1VSU09SX0NPTE9VUiA9ICcjY2MwYTBhJztcblxuICAvKipcbiAgICogSW1tb3ZhYmxlIG1hcmtlciBjb2xvdXIuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgTUFSS0VSX0NPTE9VUiA9ICcjNDI4NmY0JztcblxuICAvKipcbiAgICogV2lkdGggb2YgdGhlIGhvcml6b250YWwgY3Vyc29yLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIENVUlNPUl9XU19XSURUSCA9IDEwMDtcblxuICAvKipcbiAgICogSGVpZ2h0IG9mIHRoZSBob3Jpem9udGFsIGN1cnNvci5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBXU19DVVJTT1JfSEVJR0hUID0gNTtcblxuICAvKipcbiAgICogUGFkZGluZyBhcm91bmQgYSBzdGFjay5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBDVVJTT1JfU1RBQ0tfUEFERElORyA9IDEwO1xuXG4gIC8qKlxuICAgKiBQYWRkaW5nIGFyb3VuZCBhIGJsb2NrLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIENVUlNPUl9CTE9DS19QQURESU5HID0gMjtcblxuICAvKipcbiAgICogU3Ryb2tlIG9mIHRoZSBjdXJzb3IuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgQ1VSU09SX1NUUk9LRV9XSURUSCA9IDQ7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGV4dCBpbnB1dCBhbmQgY29sb3VyIGZpZWxkcyBmaWxsIHVwIHRoZSBlbnRpcmUgc291cmNlIGJsb2NrLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIEZVTExfQkxPQ0tfRklFTERTID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBtYWluIGNvbG91ciBvZiBpbnNlcnRpb24gbWFya2VycywgaW4gaGV4LiAgVGhlIGJsb2NrIGlzIHJlbmRlcmVkIGFcbiAgICogdHJhbnNwYXJlbnQgZ3JleSBieSBjaGFuZ2luZyB0aGUgZmlsbCBvcGFjaXR5IGluIENTUy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBJTlNFUlRJT05fTUFSS0VSX0NPTE9VUiA9ICcjMDAwMDAwJztcblxuICAvKipcbiAgICogVGhlIGluc2VydGlvbiBtYXJrZXIgb3BhY2l0eS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBJTlNFUlRJT05fTUFSS0VSX09QQUNJVFkgPSAwLjI7XG5cbiAgU0hBUEVTOiB7W2tleTogc3RyaW5nXTogbnVtYmVyfSA9IHtQVVpaTEU6IDEsIE5PVENIOiAyfTtcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgSkFHR0VEX1RFRVRIITogSmFnZ2VkVGVldGg7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIE5PVENIITogTm90Y2g7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIFNUQVJUX0hBVCE6IFN0YXJ0SGF0O1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBQVVpaTEVfVEFCITogUHV6emxlVGFiO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBJTlNJREVfQ09STkVSUyE6IEluc2lkZUNvcm5lcnM7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIE9VVFNJREVfQ09STkVSUyE6IE91dHNpZGVDb3JuZXJzO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICAvKiogQGludGVybmFsICovXG4gIGJsb2NrU3R5bGVzIToge1trZXk6IHN0cmluZ106IEJsb2NrU3R5bGV9O1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLyoqXG4gICAgICogT2Zmc2V0IGZyb20gdGhlIHRvcCBvZiB0aGUgcm93IGZvciBwbGFjaW5nIGZpZWxkcyBvbiBpbmxpbmUgaW5wdXQgcm93c1xuICAgICAqIGFuZCBzdGF0ZW1lbnQgaW5wdXQgcm93cy5cbiAgICAgKiBNYXRjaGVzIGV4aXN0aW5nIHJlbmRlcmluZyAoaW4gMjAxOSkuXG4gICAgICovXG4gICAgdGhpcy5UQUxMX0lOUFVUX0ZJRUxEX09GRlNFVF9ZID0gdGhpcy5NRURJVU1fUEFERElORztcblxuICAgIC8qKiBUaGUgbWluaW11bSBoZWlnaHQgb2YgYSBkdW1teSBpbnB1dCByb3cuICovXG4gICAgdGhpcy5EVU1NWV9JTlBVVF9NSU5fSEVJR0hUID0gdGhpcy5UQUJfSEVJR0hUO1xuXG4gICAgLyoqIFRoZSBtaW5pbXVtIGhlaWdodCBvZiBhIGR1bW15IGlucHV0IHJvdyBpbiBhIHNoYWRvdyBibG9jay4gKi9cbiAgICB0aGlzLkRVTU1ZX0lOUFVUX1NIQURPV19NSU5fSEVJR0hUID0gdGhpcy5UQUJfSEVJR0hUO1xuXG4gICAgLyoqXG4gICAgICogQWRkaXRpb25hbCBvZmZzZXQgYWRkZWQgdG8gdGhlIHN0YXRlbWVudCBpbnB1dCdzIHdpZHRoIHRvIGFjY291bnQgZm9yIHRoZVxuICAgICAqIG5vdGNoLlxuICAgICAqL1xuICAgIHRoaXMuU1RBVEVNRU5UX0lOUFVUX05PVENIX09GRlNFVCA9IHRoaXMuTk9UQ0hfT0ZGU0VUX0xFRlQ7XG5cbiAgICAvKiogVGhlIHRvcCByb3cncyBtaW5pbXVtIGhlaWdodC4gKi9cbiAgICB0aGlzLlRPUF9ST1dfTUlOX0hFSUdIVCA9IHRoaXMuTUVESVVNX1BBRERJTkc7XG5cbiAgICAvKiogVGhlIHRvcCByb3cncyBtaW5pbXVtIGhlaWdodCBpZiBpdCBwcmVjZWRlcyBhIHN0YXRlbWVudC4gKi9cbiAgICB0aGlzLlRPUF9ST1dfUFJFQ0VERVNfU1RBVEVNRU5UX01JTl9IRUlHSFQgPSB0aGlzLkxBUkdFX1BBRERJTkc7XG5cbiAgICAvKiogVGhlIGJvdHRvbSByb3cncyBtaW5pbXVtIGhlaWdodC4gKi9cbiAgICB0aGlzLkJPVFRPTV9ST1dfTUlOX0hFSUdIVCA9IHRoaXMuTUVESVVNX1BBRERJTkc7XG5cbiAgICAvKiogVGhlIGJvdHRvbSByb3cncyBtaW5pbXVtIGhlaWdodCBpZiBpdCBmb2xsb3dzIGEgc3RhdGVtZW50IGlucHV0LiAqL1xuICAgIHRoaXMuQk9UVE9NX1JPV19BRlRFUl9TVEFURU1FTlRfTUlOX0hFSUdIVCA9IHRoaXMuTEFSR0VfUEFERElORztcblxuICAgIC8qKiBUaGUgaGVpZ2h0IG9mIGFuIGVtcHR5IGlubGluZSBpbnB1dC4gKi9cbiAgICB0aGlzLkVNUFRZX0lOTElORV9JTlBVVF9IRUlHSFQgPSB0aGlzLlRBQl9IRUlHSFQgKyAxMTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBoZWlnaHQgb2YgYW4gZW1wdHkgc3RhdGVtZW50IGlucHV0LiAgTm90ZSB0aGF0IGluIHRoZSBvbGQgcmVuZGVyaW5nXG4gICAgICogdGhpcyB2YXJpZXMgc2xpZ2h0bHkgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIGJsb2NrIGhhcyBleHRlcm5hbCBvclxuICAgICAqIGlubGluZSBpbnB1dHMuIEluIHRoZSBuZXcgcmVuZGVyaW5nIHRoaXMgaXMgY29uc2lzdGVudC4gIEl0IHNlZW1zXG4gICAgICogdW5saWtlbHkgdGhhdCB0aGUgb2xkIGJlaGF2aW91ciB3YXMgaW50ZW50aW9uYWwuXG4gICAgICovXG4gICAgdGhpcy5FTVBUWV9TVEFURU1FTlRfSU5QVVRfSEVJR0hUID0gdGhpcy5NSU5fQkxPQ0tfSEVJR0hUO1xuXG4gICAgdGhpcy5TVEFSVF9QT0lOVCA9IHN2Z1BhdGhzLm1vdmVCeSgwLCAwKTtcblxuICAgIC8qKlxuICAgICAqIEEgZmllbGQncyB0ZXh0IGVsZW1lbnQncyBkb21pbmFudCBiYXNlbGluZS4gUHJlLTIwMjIgdGhpcyBjb3VsZCBiZSBmYWxzZVxuICAgICAqIGZvciBjZXJ0YWluIGJyb3dzZXJzLlxuICAgICAqL1xuICAgIHRoaXMuRklFTERfVEVYVF9CQVNFTElORV9DRU5URVIgPSB0cnVlO1xuXG4gICAgLyoqIEEgZHJvcGRvd24gZmllbGQncyBib3JkZXIgcmVjdCBoZWlnaHQuICovXG4gICAgdGhpcy5GSUVMRF9EUk9QRE9XTl9CT1JERVJfUkVDVF9IRUlHSFQgPSB0aGlzLkZJRUxEX0JPUkRFUl9SRUNUX0hFSUdIVDtcblxuICAgIC8qKiBBIGRyb3Bkb3duIGZpZWxkJ3MgU1ZHIGFycm93IHBhZGRpbmcuICovXG4gICAgdGhpcy5GSUVMRF9EUk9QRE9XTl9TVkdfQVJST1dfUEFERElORyA9IHRoaXMuRklFTERfQk9SREVSX1JFQ1RfWF9QQURESU5HO1xuXG4gICAgLyoqIEEgZHJvcGRvd24gZmllbGQncyBTVkcgYXJyb3cgZGF0YXVyaS4gKi9cbiAgICB0aGlzLkZJRUxEX0RST1BET1dOX1NWR19BUlJPV19EQVRBVVJJID1cbiAgICAgICAgJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QnBaRDBpVEdGNVpYSmZNU0lnWkdGMFlTMXVZVzFsUFNKTVlYbGxjaScgK1xuICAgICAgICAnQXhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhNaTQzTVNJZ2FHJyArXG4gICAgICAgICdWcFoyaDBQU0k0TGpjNUlpQjJhV1YzUW05NFBTSXdJREFnTVRJdU56RWdPQzQzT1NJK1BIUnBkR3hsUG1SeWIzQmtiM2R1TFcnICtcbiAgICAgICAgJ0Z5Y205M1BDOTBhWFJzWlQ0OFp5QnZjR0ZqYVhSNVBTSXdMakVpUGp4d1lYUm9JR1E5SWsweE1pNDNNU3d5TGpRMFFUSXVORCcgK1xuICAgICAgICAnRXNNaTQwTVN3d0xEQXNNU3d4TWl3MExqRTJURGd1TURnc09DNHdPR0V5TGpRMUxESXVORFVzTUN3d0xERXRNeTQwTlN3d1REJyArXG4gICAgICAgICdBdU56SXNOQzR4TmtFeUxqUXlMREl1TkRJc01Dd3dMREVzTUN3eUxqUTBMREl1TkRnc01pNDBPQ3d3TERBc01Td3VOekV1TnonICtcbiAgICAgICAgJ0ZETVN3d0xqUTNMREV1TkRNc01DdzJMak0yTERCVE1URXVOelVzTUM0ME5pd3hNaXd1TnpGQk1pNDBOQ3d5TGpRMExEQXNNQycgK1xuICAgICAgICAnd3hMREV5TGpjeExESXVORFJhSWlCbWFXeHNQU0lqTWpNeFpqSXdJaTgrUEM5blBqeHdZWFJvSUdROUlrMDJMak0yTERjdU56JyArXG4gICAgICAgICdsaE1TNDBNeXd4TGpRekxEQXNNQ3d4TFRFdExqUXlUREV1TkRJc015NDBOV0V4TGpRMExERXVORFFzTUN3d0xERXNNQzB5WXonICtcbiAgICAgICAgJ0F1TlRZdExqVTJMRGt1TXpFdE1DNDFOaXc1TGpnM0xEQmhNUzQwTkN3eExqUTBMREFzTUN3eExEQXNNa3czTGpNM0xEY3VNeicgK1xuICAgICAgICAnZEJNUzQwTXl3eExqUXpMREFzTUN3eExEWXVNellzTnk0M09Wb2lJR1pwYkd3OUlpTm1abVlpTHo0OEwzTjJaejQ9JztcblxuICAgIC8qKiBBIGNvbG91ciBmaWVsZCdzIGRlZmF1bHQgaGVpZ2h0LiAqL1xuICAgIHRoaXMuRklFTERfQ09MT1VSX0RFRkFVTFRfSEVJR0hUID0gdGhpcy5GSUVMRF9CT1JERVJfUkVDVF9IRUlHSFQ7XG5cbiAgICAvKiogQSBjaGVja2JveCBmaWVsZCdzIFggb2Zmc2V0LiAqL1xuICAgIHRoaXMuRklFTERfQ0hFQ0tCT1hfWF9PRkZTRVQgPSB0aGlzLkZJRUxEX0JPUkRFUl9SRUNUX1hfUEFERElORyAtIDM7XG5cbiAgICAvKipcbiAgICAgKiBBIHJhbmRvbSBpZGVudGlmaWVyIHVzZWQgdG8gZW5zdXJlIGEgdW5pcXVlIElEIGlzIHVzZWQgZm9yIGVhY2hcbiAgICAgKiBmaWx0ZXIvcGF0dGVybiBmb3IgdGhlIGNhc2Ugb2YgbXVsdGlwbGUgQmxvY2tseSBpbnN0YW5jZXMgb24gYSBwYWdlLlxuICAgICAqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgdGhpcy5yYW5kb21JZGVudGlmaWVyID0gU3RyaW5nKE1hdGgucmFuZG9tKCkpLnN1YnN0cmluZygyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHNoYXBlIG9iamVjdHMgYmFzZWQgb24gdGhlIGNvbnN0YW50cyBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGluaXQoKSB7XG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGNvbGxhcHNlZCBibG9ja1xuICAgICAqIGluZGljYXRvcnMuXG4gICAgICovXG4gICAgdGhpcy5KQUdHRURfVEVFVEggPSB0aGlzLm1ha2VKYWdnZWRUZWV0aCgpO1xuXG4gICAgLyoqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBub3RjaGVzLiAqL1xuICAgIHRoaXMuTk9UQ0ggPSB0aGlzLm1ha2VOb3RjaCgpO1xuXG4gICAgLyoqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBzdGFydCBoYXRzICovXG4gICAgdGhpcy5TVEFSVF9IQVQgPSB0aGlzLm1ha2VTdGFydEhhdCgpO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IHB1enpsZSB0YWJzLlxuICAgICAqL1xuICAgIHRoaXMuUFVaWkxFX1RBQiA9IHRoaXMubWFrZVB1enpsZVRhYigpO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGluc2lkZSBjb3JuZXJzXG4gICAgICovXG4gICAgdGhpcy5JTlNJREVfQ09STkVSUyA9IHRoaXMubWFrZUluc2lkZUNvcm5lcnMoKTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBvdXRzaWRlIGNvcm5lcnMuXG4gICAgICovXG4gICAgdGhpcy5PVVRTSURFX0NPUk5FUlMgPSB0aGlzLm1ha2VPdXRzaWRlQ29ybmVycygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZnJlc2ggY29uc3RhbnRzIHByb3BlcnRpZXMgdGhhdCBkZXBlbmQgb24gdGhlIHRoZW1lLlxuICAgKlxuICAgKiBAcGFyYW0gdGhlbWUgVGhlIGN1cnJlbnQgd29ya3NwYWNlIHRoZW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldFRoZW1lKHRoZW1lOiBUaGVtZSkge1xuICAgIC8qKiBUaGUgYmxvY2sgc3R5bGVzIG1hcC4gKi9cbiAgICB0aGlzLmJsb2NrU3R5bGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIGNvbnN0IGJsb2NrU3R5bGVzID0gdGhlbWUuYmxvY2tTdHlsZXM7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gYmxvY2tTdHlsZXMpIHtcbiAgICAgIHRoaXMuYmxvY2tTdHlsZXNba2V5XSA9IHRoaXMudmFsaWRhdGVkQmxvY2tTdHlsZV8oYmxvY2tTdHlsZXNba2V5XSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXREeW5hbWljUHJvcGVydGllc18odGhlbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgZHluYW1pYyBwcm9wZXJ0aWVzIHRoYXQgZGVwZW5kIG9uIG90aGVyIHZhbHVlcyBvciB0aGVtZSBwcm9wZXJ0aWVzLlxuICAgKlxuICAgKiBAcGFyYW0gdGhlbWUgVGhlIGN1cnJlbnQgd29ya3NwYWNlIHRoZW1lLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNldER5bmFtaWNQcm9wZXJ0aWVzXyh0aGVtZTogVGhlbWUpIHtcbiAgICB0aGlzLnNldEZvbnRDb25zdGFudHNfKHRoZW1lKTtcbiAgICB0aGlzLnNldENvbXBvbmVudENvbnN0YW50c18odGhlbWUpO1xuXG4gICAgdGhpcy5BRERfU1RBUlRfSEFUUyA9XG4gICAgICAgIHRoZW1lLnN0YXJ0SGF0cyAhPT0gdW5kZWZpbmVkID8gdGhlbWUuc3RhcnRIYXRzIDogdGhpcy5BRERfU1RBUlRfSEFUUztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgY29uc3RhbnRzIHJlbGF0ZWQgdG8gZm9udHMuXG4gICAqXG4gICAqIEBwYXJhbSB0aGVtZSBUaGUgY3VycmVudCB3b3Jrc3BhY2UgdGhlbWUuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2V0Rm9udENvbnN0YW50c18odGhlbWU6IFRoZW1lKSB7XG4gICAgaWYgKHRoZW1lLmZvbnRTdHlsZSAmJiB0aGVtZS5mb250U3R5bGVbJ2ZhbWlseSddKSB7XG4gICAgICB0aGlzLkZJRUxEX1RFWFRfRk9OVEZBTUlMWSA9IHRoZW1lLmZvbnRTdHlsZVsnZmFtaWx5J107XG4gICAgfVxuXG4gICAgaWYgKHRoZW1lLmZvbnRTdHlsZSAmJiB0aGVtZS5mb250U3R5bGVbJ3dlaWdodCddKSB7XG4gICAgICB0aGlzLkZJRUxEX1RFWFRfRk9OVFdFSUdIVCA9IHRoZW1lLmZvbnRTdHlsZVsnd2VpZ2h0J107XG4gICAgfVxuXG4gICAgaWYgKHRoZW1lLmZvbnRTdHlsZSAmJiB0aGVtZS5mb250U3R5bGVbJ3NpemUnXSkge1xuICAgICAgdGhpcy5GSUVMRF9URVhUX0ZPTlRTSVpFID0gdGhlbWUuZm9udFN0eWxlWydzaXplJ107XG4gICAgfVxuXG4gICAgY29uc3QgZm9udE1ldHJpY3MgPSBkb20ubWVhc3VyZUZvbnRNZXRyaWNzKFxuICAgICAgICAnSGcnLCB0aGlzLkZJRUxEX1RFWFRfRk9OVFNJWkUgKyAncHQnLCB0aGlzLkZJRUxEX1RFWFRfRk9OVFdFSUdIVCxcbiAgICAgICAgdGhpcy5GSUVMRF9URVhUX0ZPTlRGQU1JTFkpO1xuXG4gICAgdGhpcy5GSUVMRF9URVhUX0hFSUdIVCA9IGZvbnRNZXRyaWNzLmhlaWdodDtcbiAgICB0aGlzLkZJRUxEX1RFWFRfQkFTRUxJTkUgPSBmb250TWV0cmljcy5iYXNlbGluZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgY29uc3RhbnRzIGZyb20gYSB0aGVtZSdzIGNvbXBvbmVudCBzdHlsZXMuXG4gICAqXG4gICAqIEBwYXJhbSB0aGVtZSBUaGUgY3VycmVudCB3b3Jrc3BhY2UgdGhlbWUuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2V0Q29tcG9uZW50Q29uc3RhbnRzXyh0aGVtZTogVGhlbWUpIHtcbiAgICB0aGlzLkNVUlNPUl9DT0xPVVIgPVxuICAgICAgICB0aGVtZS5nZXRDb21wb25lbnRTdHlsZSgnY3Vyc29yQ29sb3VyJykgfHwgdGhpcy5DVVJTT1JfQ09MT1VSO1xuICAgIHRoaXMuTUFSS0VSX0NPTE9VUiA9XG4gICAgICAgIHRoZW1lLmdldENvbXBvbmVudFN0eWxlKCdtYXJrZXJDb2xvdXInKSB8fCB0aGlzLk1BUktFUl9DT0xPVVI7XG4gICAgdGhpcy5JTlNFUlRJT05fTUFSS0VSX0NPTE9VUiA9XG4gICAgICAgIHRoZW1lLmdldENvbXBvbmVudFN0eWxlKCdpbnNlcnRpb25NYXJrZXJDb2xvdXInKSB8fFxuICAgICAgICB0aGlzLklOU0VSVElPTl9NQVJLRVJfQ09MT1VSO1xuICAgIHRoaXMuSU5TRVJUSU9OX01BUktFUl9PUEFDSVRZID1cbiAgICAgICAgTnVtYmVyKHRoZW1lLmdldENvbXBvbmVudFN0eWxlKCdpbnNlcnRpb25NYXJrZXJPcGFjaXR5JykpIHx8XG4gICAgICAgIHRoaXMuSU5TRVJUSU9OX01BUktFUl9PUEFDSVRZO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBvciBjcmVhdGUgYSBibG9jayBzdHlsZSBiYXNlZCBvbiBhIHNpbmdsZSBjb2xvdXIgdmFsdWUuICBHZW5lcmF0ZSBhXG4gICAqIG5hbWUgZm9yIHRoZSBzdHlsZSBiYXNlZCBvbiB0aGUgY29sb3VyLlxuICAgKlxuICAgKiBAcGFyYW0gY29sb3VyICNSUkdHQkIgY29sb3VyIHN0cmluZy5cbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHN0eWxlIGFuZCBhbiBhdXRvZ2VuZXJhdGVkIG5hbWUgZm9yIHRoYXRcbiAgICogICAgIHN0eWxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldEJsb2NrU3R5bGVGb3JDb2xvdXIoY29sb3VyOiBzdHJpbmcpOiB7c3R5bGU6IEJsb2NrU3R5bGUsIG5hbWU6IHN0cmluZ30ge1xuICAgIGNvbnN0IG5hbWUgPSAnYXV0b18nICsgY29sb3VyO1xuICAgIGlmICghdGhpcy5ibG9ja1N0eWxlc1tuYW1lXSkge1xuICAgICAgdGhpcy5ibG9ja1N0eWxlc1tuYW1lXSA9IHRoaXMuY3JlYXRlQmxvY2tTdHlsZV8oY29sb3VyKTtcbiAgICB9XG4gICAgcmV0dXJuIHtzdHlsZTogdGhpcy5ibG9ja1N0eWxlc1tuYW1lXSwgbmFtZX07XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgQmxvY2tTdHlsZSBmb3IgdGhlIGdpdmVuIGJsb2NrIHN0eWxlIG5hbWUuXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja1N0eWxlTmFtZSBUaGUgbmFtZSBvZiB0aGUgYmxvY2sgc3R5bGUuXG4gICAqIEByZXR1cm5zIFRoZSBuYW1lZCBibG9jayBzdHlsZSwgb3IgYSBkZWZhdWx0IHN0eWxlIGlmIG5vIHN0eWxlIHdpdGggdGhlXG4gICAqICAgICBnaXZlbiBuYW1lIHdhcyBmb3VuZC5cbiAgICovXG4gIGdldEJsb2NrU3R5bGUoYmxvY2tTdHlsZU5hbWU6IHN0cmluZ3xudWxsKTogQmxvY2tTdHlsZSB7XG4gICAgcmV0dXJuIHRoaXMuYmxvY2tTdHlsZXNbYmxvY2tTdHlsZU5hbWUgfHwgJyddIHx8XG4gICAgICAgIChibG9ja1N0eWxlTmFtZSAmJiBibG9ja1N0eWxlTmFtZS5pbmRleE9mKCdhdXRvXycpID09PSAwID9cbiAgICAgICAgICAgICB0aGlzLmdldEJsb2NrU3R5bGVGb3JDb2xvdXIoYmxvY2tTdHlsZU5hbWUuc3Vic3RyaW5nKDUpKS5zdHlsZSA6XG4gICAgICAgICAgICAgdGhpcy5jcmVhdGVCbG9ja1N0eWxlXygnIzAwMDAwMCcpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBibG9jayBzdHlsZSBvYmplY3QgYmFzZWQgb24gdGhlIGdpdmVuIGNvbG91ci5cbiAgICpcbiAgICogQHBhcmFtIGNvbG91ciAjUlJHR0JCIGNvbG91ciBzdHJpbmcuXG4gICAqIEByZXR1cm5zIEEgcG9wdWxhdGVkIGJsb2NrIHN0eWxlIGJhc2VkIG9uIHRoZSBnaXZlbiBjb2xvdXIuXG4gICAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlQmxvY2tTdHlsZV8oY29sb3VyOiBzdHJpbmcpOiBCbG9ja1N0eWxlIHtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0ZWRCbG9ja1N0eWxlXyh7J2NvbG91clByaW1hcnknOiBjb2xvdXJ9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBmdWxsIGJsb2NrIHN0eWxlIG9iamVjdCBiYXNlZCBvbiB0aGUgaW5wdXQgc3R5bGUgb2JqZWN0LiAgUG9wdWxhdGVcbiAgICogYW55IG1pc3NpbmcgdmFsdWVzLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2tTdHlsZSBBIGZ1bGwgb3IgcGFydGlhbCBibG9jayBzdHlsZSBvYmplY3QuXG4gICAqIEByZXR1cm5zIEEgZnVsbCBibG9jayBzdHlsZSBvYmplY3QsIHdpdGggYWxsIHJlcXVpcmVkIHByb3BlcnRpZXMgcG9wdWxhdGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIHZhbGlkYXRlZEJsb2NrU3R5bGVfKGJsb2NrU3R5bGU6IFBhcnRpYWw8QmxvY2tTdHlsZT4pOiBCbG9ja1N0eWxlIHtcbiAgICAvLyBNYWtlIGEgbmV3IG9iamVjdCB3aXRoIGFsbCBvZiB0aGUgc2FtZSBwcm9wZXJ0aWVzLlxuICAgIGNvbnN0IHZhbGlkID0ge30gYXMgQmxvY2tTdHlsZTtcbiAgICBpZiAoYmxvY2tTdHlsZSkge1xuICAgICAgT2JqZWN0LmFzc2lnbih2YWxpZCwgYmxvY2tTdHlsZSk7XG4gICAgfVxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIHByb3BlcnRpZXMuXG4gICAgY29uc3QgcGFyc2VkQ29sb3VyID1cbiAgICAgICAgcGFyc2luZy5wYXJzZUJsb2NrQ29sb3VyKHZhbGlkWydjb2xvdXJQcmltYXJ5J10gfHwgJyMwMDAnKTtcbiAgICB2YWxpZC5jb2xvdXJQcmltYXJ5ID0gcGFyc2VkQ29sb3VyLmhleDtcbiAgICB2YWxpZC5jb2xvdXJTZWNvbmRhcnkgPSB2YWxpZFsnY29sb3VyU2Vjb25kYXJ5J10gP1xuICAgICAgICBwYXJzaW5nLnBhcnNlQmxvY2tDb2xvdXIodmFsaWRbJ2NvbG91clNlY29uZGFyeSddKS5oZXggOlxuICAgICAgICB0aGlzLmdlbmVyYXRlU2Vjb25kYXJ5Q29sb3VyXyh2YWxpZC5jb2xvdXJQcmltYXJ5KTtcbiAgICB2YWxpZC5jb2xvdXJUZXJ0aWFyeSA9IHZhbGlkWydjb2xvdXJUZXJ0aWFyeSddID9cbiAgICAgICAgcGFyc2luZy5wYXJzZUJsb2NrQ29sb3VyKHZhbGlkWydjb2xvdXJUZXJ0aWFyeSddKS5oZXggOlxuICAgICAgICB0aGlzLmdlbmVyYXRlVGVydGlhcnlDb2xvdXJfKHZhbGlkLmNvbG91clByaW1hcnkpO1xuXG4gICAgdmFsaWQuaGF0ID0gdmFsaWRbJ2hhdCddIHx8ICcnO1xuICAgIHJldHVybiB2YWxpZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIHNlY29uZGFyeSBjb2xvdXIgZnJvbSB0aGUgcGFzc2VkIGluIHByaW1hcnkgY29sb3VyLlxuICAgKlxuICAgKiBAcGFyYW0gaW5wdXRDb2xvdXIgUHJpbWFyeSBjb2xvdXIuXG4gICAqIEByZXR1cm5zIFRoZSBnZW5lcmF0ZWQgc2Vjb25kYXJ5IGNvbG91ci5cbiAgICovXG4gIHByb3RlY3RlZCBnZW5lcmF0ZVNlY29uZGFyeUNvbG91cl8oaW5wdXRDb2xvdXI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGNvbG91ci5ibGVuZCgnI2ZmZicsIGlucHV0Q29sb3VyLCAwLjYpIHx8IGlucHV0Q29sb3VyO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgdGVydGlhcnkgY29sb3VyIGZyb20gdGhlIHBhc3NlZCBpbiBwcmltYXJ5IGNvbG91ci5cbiAgICpcbiAgICogQHBhcmFtIGlucHV0Q29sb3VyIFByaW1hcnkgY29sb3VyLlxuICAgKiBAcmV0dXJucyBUaGUgZ2VuZXJhdGVkIHRlcnRpYXJ5IGNvbG91ci5cbiAgICovXG4gIHByb3RlY3RlZCBnZW5lcmF0ZVRlcnRpYXJ5Q29sb3VyXyhpbnB1dENvbG91cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gY29sb3VyLmJsZW5kKCcjZmZmJywgaW5wdXRDb2xvdXIsIDAuMykgfHwgaW5wdXRDb2xvdXI7XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogRGVsZXRlIGFsbCBET00gZWxlbWVudHMgdGhhdCB0aGlzIHByb3ZpZGVyIGNyZWF0ZWQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5lbWJvc3NGaWx0ZXJfKSB7XG4gICAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLmVtYm9zc0ZpbHRlcl8pO1xuICAgIH1cbiAgICBpZiAodGhpcy5kaXNhYmxlZFBhdHRlcm5fKSB7XG4gICAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLmRpc2FibGVkUGF0dGVybl8pO1xuICAgIH1cbiAgICBpZiAodGhpcy5kZWJ1Z0ZpbHRlcl8pIHtcbiAgICAgIGRvbS5yZW1vdmVOb2RlKHRoaXMuZGVidWdGaWx0ZXJfKTtcbiAgICB9XG4gICAgdGhpcy5jc3NOb2RlXyA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGNvbGxhcHNlZFxuICAgKiAgICAgYmxvY2sgaW5kaWNhdG9ycy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYWtlSmFnZ2VkVGVldGgoKTogSmFnZ2VkVGVldGgge1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuSkFHR0VEX1RFRVRIX0hFSUdIVDtcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMuSkFHR0VEX1RFRVRIX1dJRFRIO1xuXG4gICAgY29uc3QgbWFpblBhdGggPSBzdmdQYXRocy5saW5lKFtcbiAgICAgIHN2Z1BhdGhzLnBvaW50KHdpZHRoLCBoZWlnaHQgLyA0KSxcbiAgICAgIHN2Z1BhdGhzLnBvaW50KC13aWR0aCAqIDIsIGhlaWdodCAvIDIpLFxuICAgICAgc3ZnUGF0aHMucG9pbnQod2lkdGgsIGhlaWdodCAvIDQpLFxuICAgIF0pO1xuICAgIHJldHVybiB7aGVpZ2h0LCB3aWR0aCwgcGF0aDogbWFpblBhdGh9O1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBzdGFydCBoYXRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VTdGFydEhhdCgpOiBTdGFydEhhdCB7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5TVEFSVF9IQVRfSEVJR0hUO1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5TVEFSVF9IQVRfV0lEVEg7XG5cbiAgICBjb25zdCBtYWluUGF0aCA9IHN2Z1BhdGhzLmN1cnZlKCdjJywgW1xuICAgICAgc3ZnUGF0aHMucG9pbnQoMzAsIC1oZWlnaHQpLFxuICAgICAgc3ZnUGF0aHMucG9pbnQoNzAsIC1oZWlnaHQpLFxuICAgICAgc3ZnUGF0aHMucG9pbnQod2lkdGgsIDApLFxuICAgIF0pO1xuICAgIHJldHVybiB7aGVpZ2h0LCB3aWR0aCwgcGF0aDogbWFpblBhdGh9O1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBwdXp6bGVcbiAgICogICAgIHRhYnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFrZVB1enpsZVRhYigpOiBQdXp6bGVUYWIge1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5UQUJfV0lEVEg7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5UQUJfSEVJR0hUO1xuXG4gICAgLyoqXG4gICAgICogTWFrZSB0aGUgbWFpbiBwYXRoIGZvciB0aGUgcHV6emxlIHRhYiBtYWRlIG91dCBvZiBhIGZldyBjdXJ2ZXMgKGMgYW5kIHMpLlxuICAgICAqIFRob3NlIGN1cnZlcyBhcmUgZGVmaW5lZCB3aXRoIHJlbGF0aXZlIHBvc2l0aW9ucy4gIFRoZSAndXAnIGFuZCAnZG93bidcbiAgICAgKiB2ZXJzaW9ucyBvZiB0aGUgcGF0aHMgYXJlIHRoZSBzYW1lLCBidXQgdGhlIFkgc2lnbiBmbGlwcy4gIEZvcndhcmQgYW5kXG4gICAgICogYmFjayBhcmUgdGhlIHNpZ25zIHRvIHVzZSB0byBtb3ZlIHRoZSBjdXJzb3IgaW4gdGhlIGRpcmVjdGlvbiB0aGF0IHRoZVxuICAgICAqIHBhdGggaXMgYmVpbmcgZHJhd24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXAgVHJ1ZSBpZiB0aGUgcGF0aCBzaG91bGQgYmUgZHJhd24gZnJvbSBib3R0b20gdG8gdG9wLCBmYWxzZVxuICAgICAqICAgICBvdGhlcndpc2UuXG4gICAgICogQHJldHVybnMgQSBwYXRoIGZyYWdtZW50IGRlc2NyaWJpbmcgYSBwdXp6bGUgdGFiLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1ha2VNYWluUGF0aCh1cDogYm9vbGVhbik6IHN0cmluZyB7XG4gICAgICBjb25zdCBmb3J3YXJkID0gdXAgPyAtMSA6IDE7XG4gICAgICBjb25zdCBiYWNrID0gLWZvcndhcmQ7XG5cbiAgICAgIGNvbnN0IG92ZXJsYXAgPSAyLjU7XG4gICAgICBjb25zdCBoYWxmSGVpZ2h0ID0gaGVpZ2h0IC8gMjtcbiAgICAgIGNvbnN0IGNvbnRyb2wxWSA9IGhhbGZIZWlnaHQgKyBvdmVybGFwO1xuICAgICAgY29uc3QgY29udHJvbDJZID0gaGFsZkhlaWdodCArIDAuNTtcbiAgICAgIGNvbnN0IGNvbnRyb2wzWSA9IG92ZXJsYXA7ICAvLyAyLjVcblxuICAgICAgY29uc3QgZW5kUG9pbnQxID0gc3ZnUGF0aHMucG9pbnQoLXdpZHRoLCBmb3J3YXJkICogaGFsZkhlaWdodCk7XG4gICAgICBjb25zdCBlbmRQb2ludDIgPSBzdmdQYXRocy5wb2ludCh3aWR0aCwgZm9yd2FyZCAqIGhhbGZIZWlnaHQpO1xuXG4gICAgICByZXR1cm4gc3ZnUGF0aHMuY3VydmUoXG4gICAgICAgICAgICAgICAgICdjJyxcbiAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KDAsIGZvcndhcmQgKiBjb250cm9sMVkpLFxuICAgICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KC13aWR0aCwgYmFjayAqIGNvbnRyb2wyWSksXG4gICAgICAgICAgICAgICAgICAgZW5kUG9pbnQxLFxuICAgICAgICAgICAgICAgICBdKSArXG4gICAgICAgICAgc3ZnUGF0aHMuY3VydmUoXG4gICAgICAgICAgICAgICdzJywgW3N2Z1BhdGhzLnBvaW50KHdpZHRoLCBiYWNrICogY29udHJvbDNZKSwgZW5kUG9pbnQyXSk7XG4gICAgfVxuXG4gICAgLy8gYyAwLC0xMCAgLTgsOCAgLTgsLTcuNSAgcyA4LDIuNSAgOCwtNy41XG4gICAgY29uc3QgcGF0aFVwID0gbWFrZU1haW5QYXRoKHRydWUpO1xuICAgIC8vIGMgMCwxMCAgLTgsLTggIC04LDcuNSAgcyA4LC0yLjUgIDgsNy41XG4gICAgY29uc3QgcGF0aERvd24gPSBtYWtlTWFpblBhdGgoZmFsc2UpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IHRoaXMuU0hBUEVTLlBVWlpMRSxcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgICAgcGF0aERvd24sXG4gICAgICBwYXRoVXAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgbm90Y2hlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYWtlTm90Y2goKTogTm90Y2gge1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5OT1RDSF9XSURUSDtcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLk5PVENIX0hFSUdIVDtcbiAgICBjb25zdCBpbm5lcldpZHRoID0gMztcbiAgICBjb25zdCBvdXRlcldpZHRoID0gKHdpZHRoIC0gaW5uZXJXaWR0aCkgLyAyO1xuXG4gICAgLyoqXG4gICAgICogTWFrZSB0aGUgbWFpbiBwYXRoIGZvciB0aGUgbm90Y2guXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGlyIERpcmVjdGlvbiBtdWx0aXBsaWVyIHRvIGFwcGx5IHRvIGhvcml6b250YWwgb2Zmc2V0cyBhbG9uZyB0aGVcbiAgICAgKiAgICAgcGF0aC4gRWl0aGVyIDEgb3IgLTEuXG4gICAgICogQHJldHVybnMgQSBwYXRoIGZyYWdtZW50IGRlc2NyaWJpbmcgYSBub3RjaC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYWtlTWFpblBhdGgoZGlyOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgcmV0dXJuIHN2Z1BhdGhzLmxpbmUoW1xuICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBvdXRlcldpZHRoLCBoZWlnaHQpLFxuICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBpbm5lcldpZHRoLCAwKSxcbiAgICAgICAgc3ZnUGF0aHMucG9pbnQoZGlyICogb3V0ZXJXaWR0aCwgLWhlaWdodCksXG4gICAgICBdKTtcbiAgICB9XG4gICAgY29uc3QgcGF0aExlZnQgPSBtYWtlTWFpblBhdGgoMSk7XG4gICAgY29uc3QgcGF0aFJpZ2h0ID0gbWFrZU1haW5QYXRoKC0xKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiB0aGlzLlNIQVBFUy5OT1RDSCxcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgICAgcGF0aExlZnQsXG4gICAgICBwYXRoUmlnaHQsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgaW5zaWRlXG4gICAqICAgICBjb3JuZXJzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VJbnNpZGVDb3JuZXJzKCk6IEluc2lkZUNvcm5lcnMge1xuICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMuQ09STkVSX1JBRElVUztcblxuICAgIGNvbnN0IGlubmVyVG9wTGVmdENvcm5lciA9XG4gICAgICAgIHN2Z1BhdGhzLmFyYygnYScsICcwIDAsMCcsIHJhZGl1cywgc3ZnUGF0aHMucG9pbnQoLXJhZGl1cywgcmFkaXVzKSk7XG5cbiAgICBjb25zdCBpbm5lckJvdHRvbUxlZnRDb3JuZXIgPVxuICAgICAgICBzdmdQYXRocy5hcmMoJ2EnLCAnMCAwLDAnLCByYWRpdXMsIHN2Z1BhdGhzLnBvaW50KHJhZGl1cywgcmFkaXVzKSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgd2lkdGg6IHJhZGl1cyxcbiAgICAgIGhlaWdodDogcmFkaXVzLFxuICAgICAgcGF0aFRvcDogaW5uZXJUb3BMZWZ0Q29ybmVyLFxuICAgICAgcGF0aEJvdHRvbTogaW5uZXJCb3R0b21MZWZ0Q29ybmVyLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IG91dHNpZGVcbiAgICogICAgIGNvcm5lcnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFrZU91dHNpZGVDb3JuZXJzKCk6IE91dHNpZGVDb3JuZXJzIHtcbiAgICBjb25zdCByYWRpdXMgPSB0aGlzLkNPUk5FUl9SQURJVVM7XG4gICAgLyoqIFNWRyBwYXRoIGZvciBkcmF3aW5nIHRoZSByb3VuZGVkIHRvcC1sZWZ0IGNvcm5lci4gKi9cbiAgICBjb25zdCB0b3BMZWZ0ID0gc3ZnUGF0aHMubW92ZUJ5KDAsIHJhZGl1cykgK1xuICAgICAgICBzdmdQYXRocy5hcmMoJ2EnLCAnMCAwLDEnLCByYWRpdXMsIHN2Z1BhdGhzLnBvaW50KHJhZGl1cywgLXJhZGl1cykpO1xuXG4gICAgLyoqIFNWRyBwYXRoIGZvciBkcmF3aW5nIHRoZSByb3VuZGVkIHRvcC1yaWdodCBjb3JuZXIuICovXG4gICAgY29uc3QgdG9wUmlnaHQgPVxuICAgICAgICBzdmdQYXRocy5hcmMoJ2EnLCAnMCAwLDEnLCByYWRpdXMsIHN2Z1BhdGhzLnBvaW50KHJhZGl1cywgcmFkaXVzKSk7XG5cbiAgICAvKiogU1ZHIHBhdGggZm9yIGRyYXdpbmcgdGhlIHJvdW5kZWQgYm90dG9tLWxlZnQgY29ybmVyLiAqL1xuICAgIGNvbnN0IGJvdHRvbUxlZnQgPVxuICAgICAgICBzdmdQYXRocy5hcmMoJ2EnLCAnMCAwLDEnLCByYWRpdXMsIHN2Z1BhdGhzLnBvaW50KC1yYWRpdXMsIC1yYWRpdXMpKTtcblxuICAgIC8qKiBTVkcgcGF0aCBmb3IgZHJhd2luZyB0aGUgcm91bmRlZCBib3R0b20tcmlnaHQgY29ybmVyLiAqL1xuICAgIGNvbnN0IGJvdHRvbVJpZ2h0ID1cbiAgICAgICAgc3ZnUGF0aHMuYXJjKCdhJywgJzAgMCwxJywgcmFkaXVzLCBzdmdQYXRocy5wb2ludCgtcmFkaXVzLCByYWRpdXMpKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3BMZWZ0LFxuICAgICAgdG9wUmlnaHQsXG4gICAgICBib3R0b21SaWdodCxcbiAgICAgIGJvdHRvbUxlZnQsXG4gICAgICByaWdodEhlaWdodDogcmFkaXVzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFuIG9iamVjdCB3aXRoIGNvbm5lY3Rpb24gc2hhcGUgYW5kIHNpemluZyBpbmZvcm1hdGlvbiBiYXNlZCBvbiB0aGVcbiAgICogdHlwZSBvZiB0aGUgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGNvbm5lY3Rpb24gVGhlIGNvbm5lY3Rpb24gdG8gZmluZCBhIHNoYXBlIG9iamVjdCBmb3JcbiAgICogQHJldHVybnMgVGhlIHNoYXBlIG9iamVjdCBmb3IgdGhlIGNvbm5lY3Rpb24uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2hhcGVGb3IoY29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9uKTogU2hhcGUge1xuICAgIHN3aXRjaCAoY29ubmVjdGlvbi50eXBlKSB7XG4gICAgICBjYXNlIENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFOlxuICAgICAgY2FzZSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUU6XG4gICAgICAgIHJldHVybiB0aGlzLlBVWlpMRV9UQUI7XG4gICAgICBjYXNlIENvbm5lY3Rpb25UeXBlLlBSRVZJT1VTX1NUQVRFTUVOVDpcbiAgICAgIGNhc2UgQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQ6XG4gICAgICAgIHJldHVybiB0aGlzLk5PVENIO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgRXJyb3IoJ1Vua25vd24gY29ubmVjdGlvbiB0eXBlJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbnkgRE9NIGVsZW1lbnRzIHRoYXQgdGhpcyByZW5kZXJlciBuZWVkcyAoZmlsdGVycywgcGF0dGVybnMsIGV0YykuXG4gICAqXG4gICAqIEBwYXJhbSBzdmcgVGhlIHJvb3Qgb2YgdGhlIHdvcmtzcGFjZSdzIFNWRy5cbiAgICogQHBhcmFtIHRhZ05hbWUgVGhlIG5hbWUgdG8gdXNlIGZvciB0aGUgQ1NTIHN0eWxlIHRhZy5cbiAgICogQHBhcmFtIHNlbGVjdG9yIFRoZSBDU1Mgc2VsZWN0b3IgdG8gdXNlLlxuICAgKiBAc3VwcHJlc3Mge3N0cmljdE1vZHVsZURlcENoZWNrfSBEZWJ1ZyByZW5kZXJlciBvbmx5IGluY2x1ZGVkIGluXG4gICAqIHBsYXlncm91bmQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY3JlYXRlRG9tKHN2ZzogU1ZHRWxlbWVudCwgdGFnTmFtZTogc3RyaW5nLCBzZWxlY3Rvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5pbmplY3RDU1NfKHRhZ05hbWUsIHNlbGVjdG9yKTtcblxuICAgIC8qXG4gICAgICAgIDxkZWZzPlxuICAgICAgICAgIC4uLiBmaWx0ZXJzIGdvIGhlcmUgLi4uXG4gICAgICAgIDwvZGVmcz5cbiAgICAgICAgKi9cbiAgICB0aGlzLmRlZnNfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkRFRlMsIHt9LCBzdmcpO1xuICAgIC8qXG4gICAgICAgICAgPGZpbHRlciBpZD1cImJsb2NrbHlFbWJvc3NGaWx0ZXI4Mzc0OTNcIj5cbiAgICAgICAgICAgIDxmZUdhdXNzaWFuQmx1ciBpbj1cIlNvdXJjZUFscGhhXCIgc3RkRGV2aWF0aW9uPVwiMVwiIHJlc3VsdD1cImJsdXJcIiAvPlxuICAgICAgICAgICAgPGZlU3BlY3VsYXJMaWdodGluZyBpbj1cImJsdXJcIiBzdXJmYWNlU2NhbGU9XCIxXCJcbiAgICAgICBzcGVjdWxhckNvbnN0YW50PVwiMC41XCIgc3BlY3VsYXJFeHBvbmVudD1cIjEwXCIgbGlnaHRpbmctY29sb3I9XCJ3aGl0ZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdD1cInNwZWNPdXRcIj5cbiAgICAgICAgICAgICAgPGZlUG9pbnRMaWdodCB4PVwiLTUwMDBcIiB5PVwiLTEwMDAwXCIgej1cIjIwMDAwXCIgLz5cbiAgICAgICAgICAgIDwvZmVTcGVjdWxhckxpZ2h0aW5nPlxuICAgICAgICAgICAgPGZlQ29tcG9zaXRlIGluPVwic3BlY091dFwiIGluMj1cIlNvdXJjZUFscGhhXCIgb3BlcmF0b3I9XCJpblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0PVwic3BlY091dFwiIC8+XG4gICAgICAgICAgICA8ZmVDb21wb3NpdGUgaW49XCJTb3VyY2VHcmFwaGljXCIgaW4yPVwic3BlY091dFwiIG9wZXJhdG9yPVwiYXJpdGhtZXRpY1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgazE9XCIwXCIgazI9XCIxXCIgazM9XCIxXCIgazQ9XCIwXCIgLz5cbiAgICAgICAgICA8L2ZpbHRlcj5cbiAgICAgICAgKi9cbiAgICBjb25zdCBlbWJvc3NGaWx0ZXIgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkZJTFRFUiwgeydpZCc6ICdibG9ja2x5RW1ib3NzRmlsdGVyJyArIHRoaXMucmFuZG9tSWRlbnRpZmllcn0sXG4gICAgICAgIHRoaXMuZGVmc18pO1xuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRkVHQVVTU0lBTkJMVVIsXG4gICAgICAgIHsnaW4nOiAnU291cmNlQWxwaGEnLCAnc3RkRGV2aWF0aW9uJzogMSwgJ3Jlc3VsdCc6ICdibHVyJ30sXG4gICAgICAgIGVtYm9zc0ZpbHRlcik7XG4gICAgY29uc3QgZmVTcGVjdWxhckxpZ2h0aW5nID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRVNQRUNVTEFSTElHSFRJTkcsIHtcbiAgICAgICAgICAnaW4nOiAnYmx1cicsXG4gICAgICAgICAgJ3N1cmZhY2VTY2FsZSc6IDEsXG4gICAgICAgICAgJ3NwZWN1bGFyQ29uc3RhbnQnOiAwLjUsXG4gICAgICAgICAgJ3NwZWN1bGFyRXhwb25lbnQnOiAxMCxcbiAgICAgICAgICAnbGlnaHRpbmctY29sb3InOiAnd2hpdGUnLFxuICAgICAgICAgICdyZXN1bHQnOiAnc3BlY091dCcsXG4gICAgICAgIH0sXG4gICAgICAgIGVtYm9zc0ZpbHRlcik7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRVBPSU5UTElHSFQsIHsneCc6IC01MDAwLCAneSc6IC0xMDAwMCwgJ3onOiAyMDAwMH0sXG4gICAgICAgIGZlU3BlY3VsYXJMaWdodGluZyk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUNPTVBPU0lURSwge1xuICAgICAgICAgICdpbic6ICdzcGVjT3V0JyxcbiAgICAgICAgICAnaW4yJzogJ1NvdXJjZUFscGhhJyxcbiAgICAgICAgICAnb3BlcmF0b3InOiAnaW4nLFxuICAgICAgICAgICdyZXN1bHQnOiAnc3BlY091dCcsXG4gICAgICAgIH0sXG4gICAgICAgIGVtYm9zc0ZpbHRlcik7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUNPTVBPU0lURSwge1xuICAgICAgICAgICdpbic6ICdTb3VyY2VHcmFwaGljJyxcbiAgICAgICAgICAnaW4yJzogJ3NwZWNPdXQnLFxuICAgICAgICAgICdvcGVyYXRvcic6ICdhcml0aG1ldGljJyxcbiAgICAgICAgICAnazEnOiAwLFxuICAgICAgICAgICdrMic6IDEsXG4gICAgICAgICAgJ2szJzogMSxcbiAgICAgICAgICAnazQnOiAwLFxuICAgICAgICB9LFxuICAgICAgICBlbWJvc3NGaWx0ZXIpO1xuICAgIHRoaXMuZW1ib3NzRmlsdGVySWQgPSBlbWJvc3NGaWx0ZXIuaWQ7XG4gICAgdGhpcy5lbWJvc3NGaWx0ZXJfID0gZW1ib3NzRmlsdGVyO1xuXG4gICAgLypcbiAgICAgICAgICA8cGF0dGVybiBpZD1cImJsb2NrbHlEaXNhYmxlZFBhdHRlcm44Mzc0OTNcIlxuICAgICAgIHBhdHRlcm5Vbml0cz1cInVzZXJTcGFjZU9uVXNlXCIgd2lkdGg9XCIxMFwiIGhlaWdodD1cIjEwXCI+IDxyZWN0IHdpZHRoPVwiMTBcIlxuICAgICAgIGhlaWdodD1cIjEwXCIgZmlsbD1cIiNhYWFcIiAvPiA8cGF0aCBkPVwiTSAwIDAgTCAxMCAxMCBNIDEwIDAgTCAwIDEwXCJcbiAgICAgICBzdHJva2U9XCIjY2MwXCIgLz5cbiAgICAgICAgICA8L3BhdHRlcm4+XG4gICAgICAgICovXG4gICAgY29uc3QgZGlzYWJsZWRQYXR0ZXJuID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5QQVRURVJOLCB7XG4gICAgICAgICAgJ2lkJzogJ2Jsb2NrbHlEaXNhYmxlZFBhdHRlcm4nICsgdGhpcy5yYW5kb21JZGVudGlmaWVyLFxuICAgICAgICAgICdwYXR0ZXJuVW5pdHMnOiAndXNlclNwYWNlT25Vc2UnLFxuICAgICAgICAgICd3aWR0aCc6IDEwLFxuICAgICAgICAgICdoZWlnaHQnOiAxMCxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5kZWZzXyk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7J3dpZHRoJzogMTAsICdoZWlnaHQnOiAxMCwgJ2ZpbGwnOiAnI2FhYSd9LCBkaXNhYmxlZFBhdHRlcm4pO1xuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUEFUSCwgeydkJzogJ00gMCAwIEwgMTAgMTAgTSAxMCAwIEwgMCAxMCcsICdzdHJva2UnOiAnI2NjMCd9LFxuICAgICAgICBkaXNhYmxlZFBhdHRlcm4pO1xuICAgIHRoaXMuZGlzYWJsZWRQYXR0ZXJuSWQgPSBkaXNhYmxlZFBhdHRlcm4uaWQ7XG4gICAgdGhpcy5kaXNhYmxlZFBhdHRlcm5fID0gZGlzYWJsZWRQYXR0ZXJuO1xuXG4gICAgdGhpcy5jcmVhdGVEZWJ1Z0ZpbHRlcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGZpbHRlciBmb3IgaGlnaGxpZ2h0aW5nIHRoZSBjdXJyZW50bHkgcmVuZGVyaW5nIGJsb2NrIGR1cmluZ1xuICAgKiByZW5kZXIgZGVidWdnaW5nLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVEZWJ1Z0ZpbHRlcigpIHtcbiAgICAvLyBPbmx5IGNyZWF0ZSB0aGUgZGVidWcgZmlsdGVyIG9uY2UuXG4gICAgaWYgKCF0aGlzLmRlYnVnRmlsdGVyXykge1xuICAgICAgY29uc3QgZGVidWdGaWx0ZXIgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuRklMVEVSLCB7XG4gICAgICAgICAgICAnaWQnOiAnYmxvY2tseURlYnVnRmlsdGVyJyArIHRoaXMucmFuZG9tSWRlbnRpZmllcixcbiAgICAgICAgICAgICdoZWlnaHQnOiAnMTYwJScsXG4gICAgICAgICAgICAnd2lkdGgnOiAnMTgwJScsXG4gICAgICAgICAgICAneSc6ICctMzAlJyxcbiAgICAgICAgICAgICd4JzogJy00MCUnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5kZWZzXyk7XG4gICAgICAvLyBTZXQgYWxsIGdhdXNzaWFuIGJsdXIgcGl4ZWxzIHRvIDEgb3BhY2l0eSBiZWZvcmUgYXBwbHlpbmcgZmxvb2RcbiAgICAgIGNvbnN0IGRlYnVnQ29tcG9uZW50VHJhbnNmZXIgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuRkVDT01QT05FTlRUUkFOU0ZFUiwgeydyZXN1bHQnOiAnb3V0Qmx1cid9LCBkZWJ1Z0ZpbHRlcik7XG4gICAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuRkVGVU5DQSxcbiAgICAgICAgICB7J3R5cGUnOiAndGFibGUnLCAndGFibGVWYWx1ZXMnOiAnMCAxIDEgMSAxIDEgMSAxIDEgMSAxIDEgMSAxIDEgMSAxJ30sXG4gICAgICAgICAgZGVidWdDb21wb25lbnRUcmFuc2Zlcik7XG4gICAgICAvLyBDb2xvciB0aGUgaGlnaGxpZ2h0XG4gICAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuRkVGTE9PRCwge1xuICAgICAgICAgICAgJ2Zsb29kLWNvbG9yJzogJyNmZjAwMDAnLFxuICAgICAgICAgICAgJ2Zsb29kLW9wYWNpdHknOiAwLjUsXG4gICAgICAgICAgICAncmVzdWx0JzogJ291dENvbG9yJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlYnVnRmlsdGVyKTtcbiAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5GRUNPTVBPU0lURSwge1xuICAgICAgICAgICAgJ2luJzogJ291dENvbG9yJyxcbiAgICAgICAgICAgICdpbjInOiAnb3V0Qmx1cicsXG4gICAgICAgICAgICAnb3BlcmF0b3InOiAnaW4nLFxuICAgICAgICAgICAgJ3Jlc3VsdCc6ICdvdXRHbG93JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlYnVnRmlsdGVyKTtcbiAgICAgIHRoaXMuZGVidWdGaWx0ZXJJZCA9IGRlYnVnRmlsdGVyLmlkO1xuICAgICAgdGhpcy5kZWJ1Z0ZpbHRlcl8gPSBkZWJ1Z0ZpbHRlcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5qZWN0IHJlbmRlcmVyIHNwZWNpZmljIENTUyBpbnRvIHRoZSBwYWdlLlxuICAgKlxuICAgKiBAcGFyYW0gdGFnTmFtZSBUaGUgbmFtZSBvZiB0aGUgc3R5bGUgdGFnIHRvIHVzZS5cbiAgICogQHBhcmFtIHNlbGVjdG9yIFRoZSBDU1Mgc2VsZWN0b3IgdG8gdXNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIGluamVjdENTU18odGFnTmFtZTogc3RyaW5nLCBzZWxlY3Rvcjogc3RyaW5nKSB7XG4gICAgY29uc3QgY3NzQXJyYXkgPSB0aGlzLmdldENTU18oc2VsZWN0b3IpO1xuICAgIGNvbnN0IGNzc05vZGVJZCA9ICdibG9ja2x5LXJlbmRlcmVyLXN0eWxlLScgKyB0YWdOYW1lO1xuICAgIHRoaXMuY3NzTm9kZV8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjc3NOb2RlSWQpIGFzIEhUTUxTdHlsZUVsZW1lbnQ7XG4gICAgY29uc3QgdGV4dCA9IGNzc0FycmF5LmpvaW4oJ1xcbicpO1xuICAgIGlmICh0aGlzLmNzc05vZGVfKSB7XG4gICAgICAvLyBBbHJlYWR5IGluamVjdGVkLCB1cGRhdGUgaWYgdGhlIHRoZW1lIGNoYW5nZWQuXG4gICAgICB0aGlzLmNzc05vZGVfLmZpcnN0Q2hpbGQhLnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gSW5qZWN0IENTUyB0YWcgYXQgc3RhcnQgb2YgaGVhZC5cbiAgICBjb25zdCBjc3NOb2RlID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJykpO1xuICAgIGNzc05vZGUuaWQgPSBjc3NOb2RlSWQ7XG4gICAgY29uc3QgY3NzVGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcbiAgICBjc3NOb2RlLmFwcGVuZENoaWxkKGNzc1RleHROb2RlKTtcbiAgICBkb2N1bWVudC5oZWFkLmluc2VydEJlZm9yZShjc3NOb2RlLCBkb2N1bWVudC5oZWFkLmZpcnN0Q2hpbGQpO1xuICAgIHRoaXMuY3NzTm9kZV8gPSBjc3NOb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbnkgcmVuZGVyZXIgc3BlY2lmaWMgQ1NTIHRvIGluamVjdCB3aGVuIHRoZSByZW5kZXJlciBpcyBpbml0aWFsaXplZC5cbiAgICpcbiAgICogQHBhcmFtIHNlbGVjdG9yIENTUyBzZWxlY3RvciB0byB1c2UuXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIENTUyBzdHJpbmdzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldENTU18oc2VsZWN0b3I6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gW1xuICAgICAgLyogZXNsaW50LWRpc2FibGUgaW5kZW50ICovXG4gICAgICAvKiBjbGFuZy1mb3JtYXQgb2ZmICovXG4gICAgICAvLyBUZXh0LlxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5VGV4dCwgYCxcbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseUZseW91dExhYmVsVGV4dCB7YCxcbiAgICAgICAgYGZvbnQ6ICR7dGhpcy5GSUVMRF9URVhUX0ZPTlRXRUlHSFR9IGAgK1xuICAgICAgICAgICAgYCR7dGhpcy5GSUVMRF9URVhUX0ZPTlRTSVpFfXB0ICR7dGhpcy5GSUVMRF9URVhUX0ZPTlRGQU1JTFl9O2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIEZpZWxkcy5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseVRleHQge2AsXG4gICAgICAgIGBmaWxsOiAjZmZmO2AsXG4gICAgICBgfWAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlOb25FZGl0YWJsZVRleHQ+cmVjdCxgLFxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5RWRpdGFibGVUZXh0PnJlY3Qge2AsXG4gICAgICAgIGBmaWxsOiAke3RoaXMuRklFTERfQk9SREVSX1JFQ1RfQ09MT1VSfTtgLFxuICAgICAgICBgZmlsbC1vcGFjaXR5OiAuNjtgLFxuICAgICAgICBgc3Ryb2tlOiBub25lO2AsXG4gICAgICBgfWAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlOb25FZGl0YWJsZVRleHQ+dGV4dCxgLFxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5RWRpdGFibGVUZXh0PnRleHQge2AsXG4gICAgICAgIGBmaWxsOiAjMDAwO2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIEZseW91dCBsYWJlbHMuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlGbHlvdXRMYWJlbFRleHQge2AsXG4gICAgICAgIGBmaWxsOiAjMDAwO2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIEJ1YmJsZXMuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlUZXh0LmJsb2NrbHlCdWJibGVUZXh0IHtgLFxuICAgICAgICBgZmlsbDogIzAwMDtgLFxuICAgICAgYH1gLFxuXG4gICAgICAvLyBFZGl0YWJsZSBmaWVsZCBob3Zlci5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseUVkaXRhYmxlVGV4dDpub3QoLmVkaXRpbmcpOmhvdmVyPnJlY3Qge2AsXG4gICAgICAgIGBzdHJva2U6ICNmZmY7YCxcbiAgICAgICAgYHN0cm9rZS13aWR0aDogMjtgLFxuICAgICAgYH1gLFxuXG4gICAgICAvLyBUZXh0IGZpZWxkIGlucHV0LlxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5SHRtbElucHV0IHtgLFxuICAgICAgICBgZm9udC1mYW1pbHk6ICR7dGhpcy5GSUVMRF9URVhUX0ZPTlRGQU1JTFl9O2AsXG4gICAgICAgIGBmb250LXdlaWdodDogJHt0aGlzLkZJRUxEX1RFWFRfRk9OVFdFSUdIVH07YCxcbiAgICAgIGB9YCxcblxuICAgICAgLy8gU2VsZWN0aW9uIGhpZ2hsaWdodC5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseVNlbGVjdGVkPi5ibG9ja2x5UGF0aCB7YCxcbiAgICAgICAgYHN0cm9rZTogI2ZjMztgLFxuICAgICAgICBgc3Ryb2tlLXdpZHRoOiAzcHg7YCxcbiAgICAgIGB9YCxcblxuICAgICAgLy8gQ29ubmVjdGlvbiBoaWdobGlnaHQuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlIaWdobGlnaHRlZENvbm5lY3Rpb25QYXRoIHtgLFxuICAgICAgICBgc3Ryb2tlOiAjZmMzO2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIFJlcGxhY2VhYmxlIGhpZ2hsaWdodC5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseVJlcGxhY2VhYmxlIC5ibG9ja2x5UGF0aCB7YCxcbiAgICAgICAgYGZpbGwtb3BhY2l0eTogLjU7YCxcbiAgICAgIGB9YCxcbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseVJlcGxhY2VhYmxlIC5ibG9ja2x5UGF0aExpZ2h0LGAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlSZXBsYWNlYWJsZSAuYmxvY2tseVBhdGhEYXJrIHtgLFxuICAgICAgICBgZGlzcGxheTogbm9uZTtgLFxuICAgICAgYH1gLFxuXG4gICAgICAvLyBJbnNlcnRpb24gbWFya2VyLlxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5SW5zZXJ0aW9uTWFya2VyPi5ibG9ja2x5UGF0aCB7YCxcbiAgICAgICAgYGZpbGwtb3BhY2l0eTogJHt0aGlzLklOU0VSVElPTl9NQVJLRVJfT1BBQ0lUWX07YCxcbiAgICAgICAgYHN0cm9rZTogbm9uZTtgLFxuICAgICAgYH1gLFxuICAgICAgLyogY2xhbmctZm9ybWF0IG9uICovXG4gICAgICAvKiBlc2xpbnQtZW5hYmxlIGluZGVudCAqL1xuICAgIF07XG4gIH1cbn1cbi8qIGNsYW5nLWZvcm1hdCBvbiAqL1xuLyogZXNsaW50LWVuYWJsZSBpbmRlbnQgKi9cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBCbG9jayByZW5kZXJpbmcgZGVidWdnaW5nIGZ1bmN0aW9uYWxpdHkuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLmRlYnVnXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tSZW5kZXJpbmcuZGVidWcnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuXG5cbi8qKiBXaGV0aGVyIG9yIG5vdCB0aGUgZGVidWdnZXIgaXMgdHVybmVkIG9uLiAqL1xubGV0IHVzZURlYnVnZ2VyID0gZmFsc2U7XG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgZGVidWdnZXIgaXMgdHVybmVkIG9uLlxuICpcbiAqIEByZXR1cm5zIFdoZXRoZXIgdGhlIGRlYnVnZ2VyIGlzIHR1cm5lZCBvbi5cbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLmRlYnVnLmlzRGVidWdnZXJFbmFibGVkXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzRGVidWdnZXJFbmFibGVkKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gdXNlRGVidWdnZXI7XG59XG5cbi8qKlxuICogVHVybiBvbiB0aGUgYmxvY2tzIGRlYnVnZ2VyLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLmRlYnVnLnN0YXJ0RGVidWdnZXJcbiAqIEBkZXByZWNhdGVkIE1hcmNoIDIwMjIuIFVzZSB0aGUgcmVuZGVyaW5nIGRlYnVnZ2VyIGluIEBibG9ja2x5L2Rldi10b29scy5cbiAqIFNlZSBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9AYmxvY2tseS9kZXYtdG9vbHMgZm9yIG1vcmUgaW5mb3JtYXRpb24uXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0RGVidWdnZXIoKSB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5kZWJ1Zy5zdGFydERlYnVnZ2VyKCknLCAndmVyc2lvbiA4JywgJ3ZlcnNpb24gMTAnLFxuICAgICAgJ3RoZSBkZWJ1ZyByZW5kZXJlciBpbiBAYmxvY2tseS9kZXYtdG9vbHMgKFNlZSBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9AYmxvY2tseS9kZXYtdG9vbHMuKScpO1xuICB1c2VEZWJ1Z2dlciA9IHRydWU7XG59XG5cbi8qKlxuICogVHVybiBvZmYgdGhlIGJsb2NrcyBkZWJ1Z2dlci5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5kZWJ1Zy5zdG9wRGVidWdnZXJcbiAqIEBkZXByZWNhdGVkIE1hcmNoIDIwMjIuIFVzZSB0aGUgcmVuZGVyaW5nIGRlYnVnZ2VyIGluIEBibG9ja2x5L2Rldi10b29scy5cbiAqIFNlZSBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9AYmxvY2tseS9kZXYtdG9vbHMgZm9yIG1vcmUgaW5mb3JtYXRpb24uXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0b3BEZWJ1Z2dlcigpIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLmRlYnVnLnN0b3BEZWJ1Z2dlcigpJywgJ3ZlcnNpb24gOCcsICd2ZXJzaW9uIDEwJyxcbiAgICAgICd0aGUgZGVidWcgcmVuZGVyZXIgaW4gQGJsb2NrbHkvZGV2LXRvb2xzIChTZWUgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvQGJsb2NrbHkvZGV2LXRvb2xzLiknKTtcbiAgdXNlRGVidWdnZXIgPSBmYWxzZTtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBOYW1lc3BhY2UgZm9yIGJsb2NrIHJlbmRlcmluZyBmdW5jdGlvbmFsaXR5LlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5ibG9ja1JlbmRlcmluZ1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nJyk7XG5cbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uLy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtUaGVtZX0gZnJvbSAnLi4vLi4vdGhlbWUuanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0IHtNZWFzdXJhYmxlfSBmcm9tICcuLi9tZWFzdXJhYmxlcy9iYXNlLmpzJztcbmltcG9ydCB7Qm90dG9tUm93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9ib3R0b21fcm93LmpzJztcbmltcG9ydCB7Q29ubmVjdGlvbn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQge0V4dGVybmFsVmFsdWVJbnB1dH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvZXh0ZXJuYWxfdmFsdWVfaW5wdXQuanMnO1xuaW1wb3J0IHtGaWVsZH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvZmllbGQuanMnO1xuaW1wb3J0IHtIYXR9IGZyb20gJy4uL21lYXN1cmFibGVzL2hhdC5qcyc7XG5pbXBvcnQge0ljb259IGZyb20gJy4uL21lYXN1cmFibGVzL2ljb24uanMnO1xuaW1wb3J0IHtJblJvd1NwYWNlcn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvaW5fcm93X3NwYWNlci5qcyc7XG5pbXBvcnQge0lubGluZUlucHV0fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9pbmxpbmVfaW5wdXQuanMnO1xuaW1wb3J0IHtJbnB1dENvbm5lY3Rpb259IGZyb20gJy4uL21lYXN1cmFibGVzL2lucHV0X2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtJbnB1dFJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvaW5wdXRfcm93LmpzJztcbmltcG9ydCB7SmFnZ2VkRWRnZX0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvamFnZ2VkX2VkZ2UuanMnO1xuaW1wb3J0IHtOZXh0Q29ubmVjdGlvbn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvbmV4dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7T3V0cHV0Q29ubmVjdGlvbn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvb3V0cHV0X2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtQcmV2aW91c0Nvbm5lY3Rpb259IGZyb20gJy4uL21lYXN1cmFibGVzL3ByZXZpb3VzX2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtSb3VuZENvcm5lcn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvcm91bmRfY29ybmVyLmpzJztcbmltcG9ydCB7Um93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9yb3cuanMnO1xuaW1wb3J0IHtTcGFjZXJSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3NwYWNlcl9yb3cuanMnO1xuaW1wb3J0IHtTcXVhcmVDb3JuZXJ9IGZyb20gJy4uL21lYXN1cmFibGVzL3NxdWFyZV9jb3JuZXIuanMnO1xuaW1wb3J0IHtTdGF0ZW1lbnRJbnB1dH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvc3RhdGVtZW50X2lucHV0LmpzJztcbmltcG9ydCB7VG9wUm93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy90b3Bfcm93LmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4uL21lYXN1cmFibGVzL3R5cGVzLmpzJztcblxuaW1wb3J0IHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICcuL2RlYnVnLmpzJztcbmltcG9ydCB7RGVidWd9IGZyb20gJy4vZGVidWdnZXIuanMnO1xuaW1wb3J0IHtEcmF3ZXJ9IGZyb20gJy4vZHJhd2VyLmpzJztcbmltcG9ydCB0eXBlIHtJUGF0aE9iamVjdH0gZnJvbSAnLi9pX3BhdGhfb2JqZWN0LmpzJztcbmltcG9ydCB7UmVuZGVySW5mb30gZnJvbSAnLi9pbmZvLmpzJztcbmltcG9ydCB7TWFya2VyU3ZnfSBmcm9tICcuL21hcmtlcl9zdmcuanMnO1xuaW1wb3J0IHtQYXRoT2JqZWN0fSBmcm9tICcuL3BhdGhfb2JqZWN0LmpzJztcbmltcG9ydCB7UmVuZGVyZXJ9IGZyb20gJy4vcmVuZGVyZXIuanMnO1xuXG4vKipcbiAqIFJlZ2lzdGVycyBhIG5ldyByZW5kZXJlci5cbiAqXG4gKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVuZGVyZXIuXG4gKiBAcGFyYW0gcmVuZGVyZXJDbGFzcyBUaGUgbmV3IHJlbmRlcmVyIGNsYXNzIHRvIHJlZ2lzdGVyLlxuICogQHRocm93cyB7RXJyb3J9IGlmIGEgcmVuZGVyZXIgd2l0aCB0aGUgc2FtZSBuYW1lIGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyKG5hbWU6IHN0cmluZywgcmVuZGVyZXJDbGFzczogRnVuY3Rpb24pIHtcbiAgcmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5SRU5ERVJFUiwgbmFtZSwgcmVuZGVyZXJDbGFzcyk7XG59XG5cbi8qKlxuICogVW5yZWdpc3RlcnMgdGhlIHJlbmRlcmVyIHJlZ2lzdGVyZWQgd2l0aCB0aGUgZ2l2ZW4gbmFtZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVuZGVyZXIuXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy51bnJlZ2lzdGVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bnJlZ2lzdGVyKG5hbWU6IHN0cmluZykge1xuICByZWdpc3RyeS51bnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuUkVOREVSRVIsIG5hbWUpO1xufVxuXG4vKipcbiAqIFR1cm4gb2ZmIHRoZSBibG9ja3MgZGVidWdnZXIuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuc3RvcERlYnVnZ2VyXG4gKiBAZGVwcmVjYXRlZCBVc2UgdGhlIGRlYnVnIHJlbmRlcmVyIGluICoqXFxAYmxvY2tseS9kZXYtdG9vbHMqKiAoU2VlIHtAbGlua1xuICogICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL0BibG9ja2x5L2Rldi10b29sc30uKVxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdG9wRGVidWdnZXIoKSB7XG4gIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5zdG9wRGVidWdnZXIoKScsICdTZXB0ZW1iZXIgMjAyMScsXG4gICAgICAnU2VwdGVtYmVyIDIwMjInLFxuICAgICAgJ3RoZSBkZWJ1ZyByZW5kZXJlciBpbiBAYmxvY2tseS9kZXYtdG9vbHMgKFNlZSBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9AYmxvY2tseS9kZXYtdG9vbHMuKScpO1xuICBkZWJ1Zy5zdG9wRGVidWdnZXIoKTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIGFueXRoaW5nIG5lZWRlZCBmb3IgcmVuZGVyaW5nIChjb25zdGFudHMsIGV0YykuXG4gKlxuICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgcmVuZGVyZXIgdG8gaW5pdGlhbGl6ZS5cbiAqIEBwYXJhbSB0aGVtZSBUaGUgd29ya3NwYWNlIHRoZW1lIG9iamVjdC5cbiAqIEBwYXJhbSBvcHRfcmVuZGVyZXJPdmVycmlkZXMgUmVuZGVyaW5nIGNvbnN0YW50IG92ZXJyaWRlcy5cbiAqIEByZXR1cm5zIFRoZSBuZXcgaW5zdGFuY2Ugb2YgYSByZW5kZXJlci5cbiAqICAgICBBbHJlYWR5IGluaXRpYWxpemVkLlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuaW5pdFxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0KFxuICAgIG5hbWU6IHN0cmluZywgdGhlbWU6IFRoZW1lLFxuICAgIG9wdF9yZW5kZXJlck92ZXJyaWRlcz86IHtbcmVuZGVyZXJDb25zdGFudDogc3RyaW5nXTogYW55fSk6IFJlbmRlcmVyIHtcbiAgY29uc3QgcmVuZGVyZXJDbGFzcyA9IHJlZ2lzdHJ5LmdldENsYXNzKHJlZ2lzdHJ5LlR5cGUuUkVOREVSRVIsIG5hbWUpO1xuICBjb25zdCByZW5kZXJlciA9IG5ldyByZW5kZXJlckNsYXNzIShuYW1lKTtcbiAgcmVuZGVyZXIuaW5pdCh0aGVtZSwgb3B0X3JlbmRlcmVyT3ZlcnJpZGVzKTtcbiAgcmV0dXJuIHJlbmRlcmVyO1xufVxuZXhwb3J0IHtCb3R0b21Sb3d9O1xuZXhwb3J0IHtDb25uZWN0aW9ufTtcbmV4cG9ydCB7Q29uc3RhbnRQcm92aWRlcn07XG5leHBvcnQge0RlYnVnfTtcbmV4cG9ydCB7RHJhd2VyfTtcbmV4cG9ydCB7RXh0ZXJuYWxWYWx1ZUlucHV0fTtcbmV4cG9ydCB7RmllbGR9O1xuZXhwb3J0IHtIYXR9O1xuZXhwb3J0IHtJY29ufTtcbmV4cG9ydCB7SW5Sb3dTcGFjZXJ9O1xuZXhwb3J0IHtJbmxpbmVJbnB1dH07XG5leHBvcnQge0lucHV0Q29ubmVjdGlvbn07XG5leHBvcnQge0lucHV0Um93fTtcbmV4cG9ydCB7SVBhdGhPYmplY3R9O1xuZXhwb3J0IHtKYWdnZWRFZGdlfTtcbmV4cG9ydCB7TWFya2VyU3ZnfTtcbmV4cG9ydCB7TWVhc3VyYWJsZX07XG5leHBvcnQge05leHRDb25uZWN0aW9ufTtcbmV4cG9ydCB7T3V0cHV0Q29ubmVjdGlvbn07XG5leHBvcnQge1BhdGhPYmplY3R9O1xuZXhwb3J0IHtQcmV2aW91c0Nvbm5lY3Rpb259O1xuZXhwb3J0IHtSZW5kZXJlcn07XG5leHBvcnQge1JlbmRlckluZm99O1xuZXhwb3J0IHtSb3VuZENvcm5lcn07XG5leHBvcnQge1Jvd307XG5leHBvcnQge1NwYWNlclJvd307XG5leHBvcnQge1NxdWFyZUNvcm5lcn07XG5leHBvcnQge1N0YXRlbWVudElucHV0fTtcbmV4cG9ydCB7VG9wUm93fTtcbmV4cG9ydCB7VHlwZXN9O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBoYW5kbGluZyB0eXBlZCB2YXJpYWJsZXMuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LlZhcmlhYmxlc0R5bmFtaWNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5WYXJpYWJsZXNEeW5hbWljJyk7XG5cbmltcG9ydCB7QmxvY2tzfSBmcm9tICcuL2Jsb2Nrcy5qcyc7XG5pbXBvcnQge01zZ30gZnJvbSAnLi9tc2cuanMnO1xuaW1wb3J0ICogYXMgeG1sIGZyb20gJy4vdXRpbHMveG1sLmpzJztcbmltcG9ydCB7VmFyaWFibGVNb2RlbH0gZnJvbSAnLi92YXJpYWJsZV9tb2RlbC5qcyc7XG5pbXBvcnQgKiBhcyBWYXJpYWJsZXMgZnJvbSAnLi92YXJpYWJsZXMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi93b3Jrc3BhY2UuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtGbHlvdXRCdXR0b259IGZyb20gJy4vZmx5b3V0X2J1dHRvbi5qcyc7XG5cblxuLyoqXG4gKiBTdHJpbmcgZm9yIHVzZSBpbiB0aGUgXCJjdXN0b21cIiBhdHRyaWJ1dGUgb2YgYSBjYXRlZ29yeSBpbiB0b29sYm94IFhNTC5cbiAqIFRoaXMgc3RyaW5nIGluZGljYXRlcyB0aGF0IHRoZSBjYXRlZ29yeSBzaG91bGQgYmUgZHluYW1pY2FsbHkgcG9wdWxhdGVkIHdpdGhcbiAqIHZhcmlhYmxlIGJsb2Nrcy5cbiAqIFNlZSBhbHNvIEJsb2NrbHkuVmFyaWFibGVzLkNBVEVHT1JZX05BTUUgYW5kXG4gKiBCbG9ja2x5LlByb2NlZHVyZXMuQ0FURUdPUllfTkFNRS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5WYXJpYWJsZXNEeW5hbWljLkNBVEVHT1JZX05BTUVcbiAqL1xuZXhwb3J0IGNvbnN0IENBVEVHT1JZX05BTUUgPSAnVkFSSUFCTEVfRFlOQU1JQyc7XG5cbi8qKlxuICogQ2xpY2sgaGFuZGxlciBmb3IgYSBidXR0b24gdGhhdCBjcmVhdGVzIFN0cmluZyB2YXJpYWJsZXMuXG4gKlxuICogQHBhcmFtIGJ1dHRvblxuICovXG5mdW5jdGlvbiBzdHJpbmdCdXR0b25DbGlja0hhbmRsZXIoYnV0dG9uOiBGbHlvdXRCdXR0b24pIHtcbiAgVmFyaWFibGVzLmNyZWF0ZVZhcmlhYmxlQnV0dG9uSGFuZGxlcihcbiAgICAgIGJ1dHRvbi5nZXRUYXJnZXRXb3Jrc3BhY2UoKSwgdW5kZWZpbmVkLCAnU3RyaW5nJyk7XG59XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlXG5leHBvcnQgY29uc3Qgb25DcmVhdGVWYXJpYWJsZUJ1dHRvbkNsaWNrX1N0cmluZyA9IHN0cmluZ0J1dHRvbkNsaWNrSGFuZGxlcjtcblxuLyoqXG4gKiBDbGljayBoYW5kbGVyIGZvciBhIGJ1dHRvbiB0aGF0IGNyZWF0ZXMgTnVtYmVyIHZhcmlhYmxlcy5cbiAqXG4gKiBAcGFyYW0gYnV0dG9uXG4gKi9cbmZ1bmN0aW9uIG51bWJlckJ1dHRvbkNsaWNrSGFuZGxlcihidXR0b246IEZseW91dEJ1dHRvbikge1xuICBWYXJpYWJsZXMuY3JlYXRlVmFyaWFibGVCdXR0b25IYW5kbGVyKFxuICAgICAgYnV0dG9uLmdldFRhcmdldFdvcmtzcGFjZSgpLCB1bmRlZmluZWQsICdOdW1iZXInKTtcbn1cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2VcbmV4cG9ydCBjb25zdCBvbkNyZWF0ZVZhcmlhYmxlQnV0dG9uQ2xpY2tfTnVtYmVyID0gbnVtYmVyQnV0dG9uQ2xpY2tIYW5kbGVyO1xuXG4vKipcbiAqIENsaWNrIGhhbmRsZXIgZm9yIGEgYnV0dG9uIHRoYXQgY3JlYXRlcyBDb2xvdXIgdmFyaWFibGVzLlxuICpcbiAqIEBwYXJhbSBidXR0b25cbiAqL1xuZnVuY3Rpb24gY29sb3VyQnV0dG9uQ2xpY2tIYW5kbGVyKGJ1dHRvbjogRmx5b3V0QnV0dG9uKSB7XG4gIFZhcmlhYmxlcy5jcmVhdGVWYXJpYWJsZUJ1dHRvbkhhbmRsZXIoXG4gICAgICBidXR0b24uZ2V0VGFyZ2V0V29ya3NwYWNlKCksIHVuZGVmaW5lZCwgJ0NvbG91cicpO1xufVxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuZXhwb3J0IGNvbnN0IG9uQ3JlYXRlVmFyaWFibGVCdXR0b25DbGlja19Db2xvdXIgPSBjb2xvdXJCdXR0b25DbGlja0hhbmRsZXI7XG5cbi8qKlxuICogQ29uc3RydWN0IHRoZSBlbGVtZW50cyAoYmxvY2tzIGFuZCBidXR0b24pIHJlcXVpcmVkIGJ5IHRoZSBmbHlvdXQgZm9yIHRoZVxuICogdmFyaWFibGUgY2F0ZWdvcnkuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIGNvbnRhaW5pbmcgdmFyaWFibGVzLlxuICogQHJldHVybnMgQXJyYXkgb2YgWE1MIGVsZW1lbnRzLlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzRHluYW1pYy5mbHlvdXRDYXRlZ29yeVxuICovXG5leHBvcnQgZnVuY3Rpb24gZmx5b3V0Q2F0ZWdvcnkod29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpOiBFbGVtZW50W10ge1xuICBsZXQgeG1sTGlzdCA9IG5ldyBBcnJheTxFbGVtZW50PigpO1xuICBsZXQgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3RleHQnLCBNc2dbJ05FV19TVFJJTkdfVkFSSUFCTEUnXSk7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NhbGxiYWNrS2V5JywgJ0NSRUFURV9WQVJJQUJMRV9TVFJJTkcnKTtcbiAgeG1sTGlzdC5wdXNoKGJ1dHRvbik7XG4gIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCd0ZXh0JywgTXNnWydORVdfTlVNQkVSX1ZBUklBQkxFJ10pO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdjYWxsYmFja0tleScsICdDUkVBVEVfVkFSSUFCTEVfTlVNQkVSJyk7XG4gIHhtbExpc3QucHVzaChidXR0b24pO1xuICBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgndGV4dCcsIE1zZ1snTkVXX0NPTE9VUl9WQVJJQUJMRSddKTtcbiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnY2FsbGJhY2tLZXknLCAnQ1JFQVRFX1ZBUklBQkxFX0NPTE9VUicpO1xuICB4bWxMaXN0LnB1c2goYnV0dG9uKTtcblxuICB3b3Jrc3BhY2UucmVnaXN0ZXJCdXR0b25DYWxsYmFjayhcbiAgICAgICdDUkVBVEVfVkFSSUFCTEVfU1RSSU5HJywgc3RyaW5nQnV0dG9uQ2xpY2tIYW5kbGVyKTtcbiAgd29ya3NwYWNlLnJlZ2lzdGVyQnV0dG9uQ2FsbGJhY2soXG4gICAgICAnQ1JFQVRFX1ZBUklBQkxFX05VTUJFUicsIG51bWJlckJ1dHRvbkNsaWNrSGFuZGxlcik7XG4gIHdvcmtzcGFjZS5yZWdpc3RlckJ1dHRvbkNhbGxiYWNrKFxuICAgICAgJ0NSRUFURV9WQVJJQUJMRV9DT0xPVVInLCBjb2xvdXJCdXR0b25DbGlja0hhbmRsZXIpO1xuXG4gIGNvbnN0IGJsb2NrTGlzdCA9IGZseW91dENhdGVnb3J5QmxvY2tzKHdvcmtzcGFjZSk7XG4gIHhtbExpc3QgPSB4bWxMaXN0LmNvbmNhdChibG9ja0xpc3QpO1xuICByZXR1cm4geG1sTGlzdDtcbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3QgdGhlIGJsb2NrcyByZXF1aXJlZCBieSB0aGUgZmx5b3V0IGZvciB0aGUgdmFyaWFibGUgY2F0ZWdvcnkuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIGNvbnRhaW5pbmcgdmFyaWFibGVzLlxuICogQHJldHVybnMgQXJyYXkgb2YgWE1MIGJsb2NrIGVsZW1lbnRzLlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVzRHluYW1pYy5mbHlvdXRDYXRlZ29yeUJsb2Nrc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZmx5b3V0Q2F0ZWdvcnlCbG9ja3Mod29ya3NwYWNlOiBXb3Jrc3BhY2UpOiBFbGVtZW50W10ge1xuICBjb25zdCB2YXJpYWJsZU1vZGVsTGlzdCA9IHdvcmtzcGFjZS5nZXRBbGxWYXJpYWJsZXMoKTtcblxuICBjb25zdCB4bWxMaXN0ID0gW107XG4gIGlmICh2YXJpYWJsZU1vZGVsTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgaWYgKEJsb2Nrc1sndmFyaWFibGVzX3NldF9keW5hbWljJ10pIHtcbiAgICAgIGNvbnN0IGZpcnN0VmFyaWFibGUgPSB2YXJpYWJsZU1vZGVsTGlzdFt2YXJpYWJsZU1vZGVsTGlzdC5sZW5ndGggLSAxXTtcbiAgICAgIGNvbnN0IGJsb2NrID0geG1sLmNyZWF0ZUVsZW1lbnQoJ2Jsb2NrJyk7XG4gICAgICBibG9jay5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndmFyaWFibGVzX3NldF9keW5hbWljJyk7XG4gICAgICBibG9jay5zZXRBdHRyaWJ1dGUoJ2dhcCcsICcyNCcpO1xuICAgICAgYmxvY2suYXBwZW5kQ2hpbGQoVmFyaWFibGVzLmdlbmVyYXRlVmFyaWFibGVGaWVsZERvbShmaXJzdFZhcmlhYmxlKSk7XG4gICAgICB4bWxMaXN0LnB1c2goYmxvY2spO1xuICAgIH1cbiAgICBpZiAoQmxvY2tzWyd2YXJpYWJsZXNfZ2V0X2R5bmFtaWMnXSkge1xuICAgICAgdmFyaWFibGVNb2RlbExpc3Quc29ydChWYXJpYWJsZU1vZGVsLmNvbXBhcmVCeU5hbWUpO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIHZhcmlhYmxlOyB2YXJpYWJsZSA9IHZhcmlhYmxlTW9kZWxMaXN0W2ldOyBpKyspIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSB4bWwuY3JlYXRlRWxlbWVudCgnYmxvY2snKTtcbiAgICAgICAgYmxvY2suc2V0QXR0cmlidXRlKCd0eXBlJywgJ3ZhcmlhYmxlc19nZXRfZHluYW1pYycpO1xuICAgICAgICBibG9jay5zZXRBdHRyaWJ1dGUoJ2dhcCcsICc4Jyk7XG4gICAgICAgIGJsb2NrLmFwcGVuZENoaWxkKFZhcmlhYmxlcy5nZW5lcmF0ZVZhcmlhYmxlRmllbGREb20odmFyaWFibGUpKTtcbiAgICAgICAgeG1sTGlzdC5wdXNoKGJsb2NrKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHhtbExpc3Q7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0IHJlcHJlc2VudGluZyBhIHdvcmtzcGFjZSByZW5kZXJlZCBhcyBTVkcuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuV29ya3NwYWNlU3ZnJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX2Jsb2NrX2NyZWF0ZS5qcyc7XG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c190aGVtZV9jaGFuZ2UuanMnO1xuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfdmlld3BvcnQuanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrRHJhZ1N1cmZhY2VTdmd9IGZyb20gJy4vYmxvY2tfZHJhZ19zdXJmYWNlLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrbHlPcHRpb25zfSBmcm9tICcuL2Jsb2NrbHlfb3B0aW9ucy5qcyc7XG5pbXBvcnQgKiBhcyBicm93c2VyRXZlbnRzIGZyb20gJy4vYnJvd3Nlcl9ldmVudHMuanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4vY29tbW9uLmpzJztcbmltcG9ydCB7Q29tcG9uZW50TWFuYWdlcn0gZnJvbSAnLi9jb21wb25lbnRfbWFuYWdlci5qcyc7XG5pbXBvcnQge2NvbmZpZ30gZnJvbSAnLi9jb25maWcuanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uREJ9IGZyb20gJy4vY29ubmVjdGlvbl9kYi5qcyc7XG5pbXBvcnQgKiBhcyBDb250ZXh0TWVudSBmcm9tICcuL2NvbnRleHRtZW51LmpzJztcbmltcG9ydCB7Q29udGV4dE1lbnVSZWdpc3RyeX0gZnJvbSAnLi9jb250ZXh0bWVudV9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBkcm9wRG93bkRpdiBmcm9tICcuL2Ryb3Bkb3duZGl2LmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0ZseW91dEJ1dHRvbn0gZnJvbSAnLi9mbHlvdXRfYnV0dG9uLmpzJztcbmltcG9ydCB7R2VzdHVyZX0gZnJvbSAnLi9nZXN0dXJlLmpzJztcbmltcG9ydCB7R3JpZH0gZnJvbSAnLi9ncmlkLmpzJztcbmltcG9ydCB0eXBlIHtJQVNUTm9kZUxvY2F0aW9uU3ZnfSBmcm9tICcuL2ludGVyZmFjZXMvaV9hc3Rfbm9kZV9sb2NhdGlvbl9zdmcuanMnO1xuaW1wb3J0IHR5cGUge0lCb3VuZGVkRWxlbWVudH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYm91bmRlZF9lbGVtZW50LmpzJztcbmltcG9ydCB0eXBlIHtJQ29weWFibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2NvcHlhYmxlLmpzJztcbmltcG9ydCB0eXBlIHtJRHJhZ1RhcmdldH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ190YXJnZXQuanMnO1xuaW1wb3J0IHR5cGUge0lGbHlvdXR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2ZseW91dC5qcyc7XG5pbXBvcnQgdHlwZSB7SU1ldHJpY3NNYW5hZ2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge0lUb29sYm94fSBmcm9tICcuL2ludGVyZmFjZXMvaV90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtDdXJzb3J9IGZyb20gJy4va2V5Ym9hcmRfbmF2L2N1cnNvci5qcyc7XG5pbXBvcnQgdHlwZSB7TWFya2VyfSBmcm9tICcuL2tleWJvYXJkX25hdi9tYXJrZXIuanMnO1xuaW1wb3J0IHtNYXJrZXJNYW5hZ2VyfSBmcm9tICcuL21hcmtlcl9tYW5hZ2VyLmpzJztcbmltcG9ydCB7T3B0aW9uc30gZnJvbSAnLi9vcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIFByb2NlZHVyZXMgZnJvbSAnLi9wcm9jZWR1cmVzLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4vcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgYmxvY2tSZW5kZXJpbmcgZnJvbSAnLi9yZW5kZXJlcnMvY29tbW9uL2Jsb2NrX3JlbmRlcmluZy5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVyZXJ9IGZyb20gJy4vcmVuZGVyZXJzL2NvbW1vbi9yZW5kZXJlci5qcyc7XG5pbXBvcnQgdHlwZSB7U2Nyb2xsYmFyUGFpcn0gZnJvbSAnLi9zY3JvbGxiYXJfcGFpci5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja3MgZnJvbSAnLi9zZXJpYWxpemF0aW9uL2Jsb2Nrcy5qcyc7XG5pbXBvcnQgdHlwZSB7VGhlbWV9IGZyb20gJy4vdGhlbWUuanMnO1xuaW1wb3J0IHtDbGFzc2ljfSBmcm9tICcuL3RoZW1lL2NsYXNzaWMuanMnO1xuaW1wb3J0IHtUaGVtZU1hbmFnZXJ9IGZyb20gJy4vdGhlbWVfbWFuYWdlci5qcyc7XG5pbXBvcnQgKiBhcyBUb29sdGlwIGZyb20gJy4vdG9vbHRpcC5qcyc7XG5pbXBvcnQgdHlwZSB7VHJhc2hjYW59IGZyb20gJy4vdHJhc2hjYW4uanMnO1xuaW1wb3J0ICogYXMgYXJyYXlVdGlscyBmcm9tICcuL3V0aWxzL2FycmF5LmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgdHlwZSB7TWV0cmljc30gZnJvbSAnLi91dGlscy9tZXRyaWNzLmpzJztcbmltcG9ydCB7UmVjdH0gZnJvbSAnLi91dGlscy9yZWN0LmpzJztcbmltcG9ydCB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuaW1wb3J0ICogYXMgdG9vbGJveCBmcm9tICcuL3V0aWxzL3Rvb2xib3guanMnO1xuaW1wb3J0ICogYXMgdXNlckFnZW50IGZyb20gJy4vdXRpbHMvdXNlcmFnZW50LmpzJztcbmltcG9ydCB0eXBlIHtWYXJpYWJsZU1vZGVsfSBmcm9tICcuL3ZhcmlhYmxlX21vZGVsLmpzJztcbmltcG9ydCAqIGFzIFZhcmlhYmxlcyBmcm9tICcuL3ZhcmlhYmxlcy5qcyc7XG5pbXBvcnQgKiBhcyBWYXJpYWJsZXNEeW5hbWljIGZyb20gJy4vdmFyaWFibGVzX2R5bmFtaWMuanMnO1xuaW1wb3J0ICogYXMgV2lkZ2V0RGl2IGZyb20gJy4vd2lkZ2V0ZGl2LmpzJztcbmltcG9ydCB7V29ya3NwYWNlfSBmcm9tICcuL3dvcmtzcGFjZS5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZUF1ZGlvfSBmcm9tICcuL3dvcmtzcGFjZV9hdWRpby5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZUNvbW1lbnR9IGZyb20gJy4vd29ya3NwYWNlX2NvbW1lbnQuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VDb21tZW50U3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9jb21tZW50X3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlRHJhZ1N1cmZhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX2RyYWdfc3VyZmFjZV9zdmcuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4veG1sLmpzJztcbmltcG9ydCB7Wm9vbUNvbnRyb2xzfSBmcm9tICcuL3pvb21fY29udHJvbHMuanMnO1xuaW1wb3J0IHtDb250ZXh0TWVudU9wdGlvbn0gZnJvbSAnLi9jb250ZXh0bWVudV9yZWdpc3RyeS5qcyc7XG5cblxuLyoqIE1hcmdpbiBhcm91bmQgdGhlIHRvcC9ib3R0b20vbGVmdC9yaWdodCBhZnRlciBhIHpvb21Ub0ZpdCBjYWxsLiAqL1xuY29uc3QgWk9PTV9UT19GSVRfTUFSR0lOID0gMjA7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgd29ya3NwYWNlLiAgVGhpcyBpcyBhbiBvbnNjcmVlbiBhcmVhIHdpdGggb3B0aW9uYWwgdHJhc2hjYW4sXG4gKiBzY3JvbGxiYXJzLCBidWJibGVzLCBhbmQgZHJhZ2dpbmcuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuV29ya3NwYWNlU3ZnXG4gKi9cbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VTdmcgZXh0ZW5kcyBXb3Jrc3BhY2UgaW1wbGVtZW50cyBJQVNUTm9kZUxvY2F0aW9uU3ZnIHtcbiAgLyoqXG4gICAqIEEgd3JhcHBlciBmdW5jdGlvbiBjYWxsZWQgd2hlbiBhIHJlc2l6ZSBldmVudCBvY2N1cnMuXG4gICAqIFlvdSBjYW4gcGFzcyB0aGUgcmVzdWx0IHRvIGBldmVudEhhbmRsaW5nLnVuYmluZGAuXG4gICAqL1xuICBwcml2YXRlIHJlc2l6ZUhhbmRsZXJXcmFwcGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSByZW5kZXIgc3RhdHVzIG9mIGFuIFNWRyB3b3Jrc3BhY2UuXG4gICAqIFJldHVybnMgYGZhbHNlYCBmb3IgaGVhZGxlc3Mgd29ya3NwYWNlcyBhbmQgdHJ1ZSBmb3IgaW5zdGFuY2VzIG9mXG4gICAqIGBXb3Jrc3BhY2VTdmdgLlxuICAgKi9cbiAgb3ZlcnJpZGUgcmVuZGVyZWQgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSB3b3Jrc3BhY2UgaXMgdmlzaWJsZS4gIEZhbHNlIGlmIHRoZSB3b3Jrc3BhY2UgaGFzIGJlZW4gaGlkZGVuXG4gICAqIGJ5IGNhbGxpbmcgYHNldFZpc2libGUoZmFsc2UpYC5cbiAgICovXG4gIHByaXZhdGUgaXNWaXNpYmxlXyA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhpcyB3b3Jrc3BhY2UgaGFzIHJlc2l6ZXMgZW5hYmxlZC5cbiAgICogRGlzYWJsZSBkdXJpbmcgYmF0Y2ggb3BlcmF0aW9ucyBmb3IgYSBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudC5cbiAgICovXG4gIHByaXZhdGUgcmVzaXplc0VuYWJsZWQgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBDdXJyZW50IGhvcml6b250YWwgc2Nyb2xsaW5nIG9mZnNldCBpbiBwaXhlbCB1bml0cywgcmVsYXRpdmUgdG8gdGhlXG4gICAqIHdvcmtzcGFjZSBvcmlnaW4uXG4gICAqXG4gICAqIEl0IGlzIHVzZWZ1bCB0byB0aGluayBhYm91dCBhIHZpZXcsIGFuZCBhIGNhbnZhcyBtb3ZpbmcgYmVuZWF0aCB0aGF0XG4gICAqIHZpZXcuIEFzIHRoZSBjYW52YXMgbW92ZXMgcmlnaHQsIHRoaXMgdmFsdWUgYmVjb21lcyBtb3JlIHBvc2l0aXZlLCBhbmRcbiAgICogdGhlIHZpZXcgaXMgbm93IFwic2VlaW5nXCIgdGhlIGxlZnQgc2lkZSBvZiB0aGUgY2FudmFzLiBBcyB0aGUgY2FudmFzIG1vdmVzXG4gICAqIGxlZnQsIHRoaXMgdmFsdWUgYmVjb21lcyBtb3JlIG5lZ2F0aXZlLCBhbmQgdGhlIHZpZXcgaXMgbm93IFwic2VlaW5nXCIgdGhlXG4gICAqIHJpZ2h0IHNpZGUgb2YgdGhlIGNhbnZhcy5cbiAgICpcbiAgICogVGhlIGNvbmZ1c2luZyB0aGluZyBhYm91dCB0aGlzIHZhbHVlIGlzIHRoYXQgaXQgZG9lcyBub3QsIGFuZCBtdXN0IG5vdFxuICAgKiBpbmNsdWRlIHRoZSBhYnNvbHV0ZUxlZnQgb2Zmc2V0LiBUaGlzIGlzIGJlY2F1c2UgaXQgaXMgdXNlZCB0byBjYWxjdWxhdGVcbiAgICogdGhlIHZpZXdMZWZ0IHZhbHVlLlxuICAgKlxuICAgKiBUaGUgdmlld0xlZnQgaXMgcmVsYXRpdmUgdG8gdGhlIHdvcmtzcGFjZSBvcmlnaW4gKGFsdGhvdWdoIGluIHBpeGVsXG4gICAqIHVuaXRzKS4gVGhlIHdvcmtzcGFjZSBvcmlnaW4gaXMgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGUgd29ya3NwYWNlIChhdFxuICAgKiBsZWFzdCB3aGVuIGl0IGlzIGVuYWJsZWQpLiBJdCBpcyBzaGlmdGVkIGZyb20gdGhlIHRvcC1sZWZ0IG9mIHRoZVxuICAgKiBibG9ja2x5RGl2IHNvIGFzIG5vdCB0byBiZSBiZW5lYXRoIHRoZSB0b29sYm94LlxuICAgKlxuICAgKiBXaGVuIHRoZSB3b3Jrc3BhY2UgaXMgZW5hYmxlZCB0aGUgdmlld0xlZnQgYW5kIHdvcmtzcGFjZSBvcmlnaW4gYXJlIGF0XG4gICAqIHRoZSBzYW1lIFggbG9jYXRpb24uIEFzIHRoZSBjYW52YXMgc2xpZGVzIHRvd2FyZHMgdGhlIHJpZ2h0IGJlbmVhdGggdGhlXG4gICAqIHZpZXcgdGhpcyB2YWx1ZSAoc2Nyb2xsWCkgYmVjb21lcyBtb3JlIHBvc2l0aXZlLCBhbmQgdGhlIHZpZXdMZWZ0IGJlY29tZXNcbiAgICogbW9yZSBuZWdhdGl2ZSByZWxhdGl2ZSB0byB0aGUgd29ya3NwYWNlIG9yaWdpbiAoaW1hZ2luZSB0aGUgd29ya3NwYWNlXG4gICAqIG9yaWdpbiBhcyBhIGRvdCBvbiB0aGUgY2FudmFzIHNsaWRpbmcgdG8gdGhlIHJpZ2h0IGFzIHRoZSBjYW52YXMgbW92ZXMpLlxuICAgKlxuICAgKiBTbyBpZiB0aGUgc2Nyb2xsWCB3ZXJlIHRvIGluY2x1ZGUgdGhlIGFic29sdXRlTGVmdCB0aGlzIHdvdWxkIGluIGEgd2F5XG4gICAqIFwidW5zaGlmdFwiIHRoZSB3b3Jrc3BhY2Ugb3JpZ2luLiBUaGlzIG1lYW5zIHRoYXQgdGhlIHZpZXdMZWZ0IHdvdWxkIGJlXG4gICAqIHJlcHJlc2VudGluZyB0aGUgbGVmdCBlZGdlIG9mIHRoZSBibG9ja2x5RGl2LCByYXRoZXIgdGhhbiB0aGUgbGVmdCBlZGdlXG4gICAqIG9mIHRoZSB3b3Jrc3BhY2UuXG4gICAqL1xuICBzY3JvbGxYID0gMDtcblxuICAvKipcbiAgICogQ3VycmVudCB2ZXJ0aWNhbCBzY3JvbGxpbmcgb2Zmc2V0IGluIHBpeGVsIHVuaXRzLCByZWxhdGl2ZSB0byB0aGVcbiAgICogd29ya3NwYWNlIG9yaWdpbi5cbiAgICpcbiAgICogSXQgaXMgdXNlZnVsIHRvIHRoaW5rIGFib3V0IGEgdmlldywgYW5kIGEgY2FudmFzIG1vdmluZyBiZW5lYXRoIHRoYXRcbiAgICogdmlldy4gQXMgdGhlIGNhbnZhcyBtb3ZlcyBkb3duLCB0aGlzIHZhbHVlIGJlY29tZXMgbW9yZSBwb3NpdGl2ZSwgYW5kIHRoZVxuICAgKiB2aWV3IGlzIG5vdyBcInNlZWluZ1wiIHRoZSB1cHBlciBwYXJ0IG9mIHRoZSBjYW52YXMuIEFzIHRoZSBjYW52YXMgbW92ZXNcbiAgICogdXAsIHRoaXMgdmFsdWUgYmVjb21lcyBtb3JlIG5lZ2F0aXZlLCBhbmQgdGhlIHZpZXcgaXMgXCJzZWVpbmdcIiB0aGUgbG93ZXJcbiAgICogcGFydCBvZiB0aGUgY2FudmFzLlxuICAgKlxuICAgKiBUaGlzIGNvbmZ1c2luZyB0aGluZyBhYm91dCB0aGlzIHZhbHVlIGlzIHRoYXQgaXQgZG9lcyBub3QsIGFuZCBtdXN0IG5vdFxuICAgKiBpbmNsdWRlIHRoZSBhYnNvbHV0ZVRvcCBvZmZzZXQuIFRoaXMgaXMgYmVjYXVzZSBpdCBpcyB1c2VkIHRvIGNhbGN1bGF0ZVxuICAgKiB0aGUgdmlld1RvcCB2YWx1ZS5cbiAgICpcbiAgICogVGhlIHZpZXdUb3AgaXMgcmVsYXRpdmUgdG8gdGhlIHdvcmtzcGFjZSBvcmlnaW4gKGFsdGhvdWdoIGluIHBpeGVsXG4gICAqIHVuaXRzKS4gVGhlIHdvcmtzcGFjZSBvcmlnaW4gaXMgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGUgd29ya3NwYWNlIChhdFxuICAgKiBsZWFzdCB3aGVuIGl0IGlzIGVuYWJsZWQpLiBJdCBpcyBzaGlmdGVkIGZyb20gdGhlIHRvcC1sZWZ0IG9mIHRoZVxuICAgKiBibG9ja2x5RGl2IHNvIGFzIG5vdCB0byBiZSBiZW5lYXRoIHRoZSB0b29sYm94LlxuICAgKlxuICAgKiBXaGVuIHRoZSB3b3Jrc3BhY2UgaXMgZW5hYmxlZCB0aGUgdmlld1RvcCBhbmQgd29ya3NwYWNlIG9yaWdpbiBhcmUgYXQgdGhlXG4gICAqIHNhbWUgWSBsb2NhdGlvbi4gQXMgdGhlIGNhbnZhcyBzbGlkZXMgdG93YXJkcyB0aGUgYm90dG9tIHRoaXMgdmFsdWVcbiAgICogKHNjcm9sbFkpIGJlY29tZXMgbW9yZSBwb3NpdGl2ZSwgYW5kIHRoZSB2aWV3VG9wIGJlY29tZXMgbW9yZSBuZWdhdGl2ZVxuICAgKiByZWxhdGl2ZSB0byB0aGUgd29ya3NwYWNlIG9yaWdpbiAoaW1hZ2UgaW4gdGhlIHdvcmtzcGFjZSBvcmlnaW4gYXMgYSBkb3RcbiAgICogb24gdGhlIGNhbnZhcyBzbGlkaW5nIGRvd253YXJkcyBhcyB0aGUgY2FudmFzIG1vdmVzKS5cbiAgICpcbiAgICogU28gaWYgdGhlIHNjcm9sbFkgd2VyZSB0byBpbmNsdWRlIHRoZSBhYnNvbHV0ZVRvcCB0aGlzIHdvdWxkIGluIGEgd2F5XG4gICAqIFwidW5zaGlmdFwiIHRoZSB3b3Jrc3BhY2Ugb3JpZ2luLiBUaGlzIG1lYW5zIHRoYXQgdGhlIHZpZXdUb3Agd291bGQgYmVcbiAgICogcmVwcmVzZW50aW5nIHRoZSB0b3AgZWRnZSBvZiB0aGUgYmxvY2tseURpdiwgcmF0aGVyIHRoYW4gdGhlIHRvcCBlZGdlIG9mXG4gICAqIHRoZSB3b3Jrc3BhY2UuXG4gICAqL1xuICBzY3JvbGxZID0gMDtcblxuICAvKiogSG9yaXpvbnRhbCBzY3JvbGwgdmFsdWUgd2hlbiBzY3JvbGxpbmcgc3RhcnRlZCBpbiBwaXhlbCB1bml0cy4gKi9cbiAgc3RhcnRTY3JvbGxYID0gMDtcblxuICAvKiogVmVydGljYWwgc2Nyb2xsIHZhbHVlIHdoZW4gc2Nyb2xsaW5nIHN0YXJ0ZWQgaW4gcGl4ZWwgdW5pdHMuICovXG4gIHN0YXJ0U2Nyb2xsWSA9IDA7XG5cbiAgLyoqIERpc3RhbmNlIGZyb20gbW91c2UgdG8gb2JqZWN0IGJlaW5nIGRyYWdnZWQuICovXG4gIHByaXZhdGUgZHJhZ0RlbHRhWFk6IENvb3JkaW5hdGV8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEN1cnJlbnQgc2NhbGUuICovXG4gIHNjYWxlID0gMTtcblxuICAvKiogQ2FjaGVkIHNjYWxlIHZhbHVlLiBVc2VkIHRvIGRldGVjdCBjaGFuZ2VzIGluIHZpZXdwb3J0LiAqL1xuICBwcml2YXRlIG9sZFNjYWxlID0gMTtcblxuICAvKiogQ2FjaGVkIHZpZXdwb3J0IHRvcCB2YWx1ZS4gVXNlZCB0byBkZXRlY3QgY2hhbmdlcyBpbiB2aWV3cG9ydC4gKi9cbiAgcHJpdmF0ZSBvbGRUb3AgPSAwO1xuXG4gIC8qKiBDYWNoZWQgdmlld3BvcnQgbGVmdCB2YWx1ZS4gVXNlZCB0byBkZXRlY3QgY2hhbmdlcyBpbiB2aWV3cG9ydC4gKi9cbiAgcHJpdmF0ZSBvbGRMZWZ0ID0gMDtcblxuICAvKiogVGhlIHdvcmtzcGFjZSdzIHRyYXNoY2FuIChpZiBhbnkpLiAqL1xuICB0cmFzaGNhbjogVHJhc2hjYW58bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoaXMgd29ya3NwYWNlJ3Mgc2Nyb2xsYmFycywgaWYgdGhleSBleGlzdC4gKi9cbiAgc2Nyb2xsYmFyOiBTY3JvbGxiYXJQYWlyfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBGaXhlZCBmbHlvdXQgcHJvdmlkaW5nIGJsb2NrcyB3aGljaCBtYXkgYmUgZHJhZ2dlZCBpbnRvIHRoaXMgd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSBmbHlvdXQ6IElGbHlvdXR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIENhdGVnb3J5LWJhc2VkIHRvb2xib3ggcHJvdmlkaW5nIGJsb2NrcyB3aGljaCBtYXkgYmUgZHJhZ2dlZCBpbnRvIHRoaXNcbiAgICogd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSB0b29sYm94XzogSVRvb2xib3h8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IGdlc3R1cmUgaW4gcHJvZ3Jlc3Mgb24gdGhpcyB3b3Jrc3BhY2UsIGlmIGFueS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjdXJyZW50R2VzdHVyZV86IEdlc3R1cmV8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoaXMgd29ya3NwYWNlJ3Mgc3VyZmFjZSBmb3IgZHJhZ2dpbmcgYmxvY2tzLCBpZiBpdCBleGlzdHMuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgYmxvY2tEcmFnU3VyZmFjZTogQmxvY2tEcmFnU3VyZmFjZVN2Z3xudWxsID0gbnVsbDtcblxuICAvKiogVGhpcyB3b3Jrc3BhY2UncyBkcmFnIHN1cmZhY2UsIGlmIGl0IGV4aXN0cy4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSB3b3Jrc3BhY2VEcmFnU3VyZmFjZTogV29ya3NwYWNlRHJhZ1N1cmZhY2VTdmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gbW92ZSB3b3Jrc3BhY2UgdG8gdGhlIGRyYWcgc3VyZmFjZSB3aGVuIGl0IGlzIGRyYWdnZWQuXG4gICAqIFRydWUgaWYgaXQgc2hvdWxkIG1vdmUsIGZhbHNlIGlmIGl0IHNob3VsZCBiZSB0cmFuc2xhdGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSB1c2VXb3Jrc3BhY2VEcmFnU3VyZmFjZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgZHJhZyBzdXJmYWNlIGlzIGFjdGl2ZWx5IGluIHVzZS4gV2hlbiB0cnVlLCBjYWxscyB0b1xuICAgKiB0cmFuc2xhdGUgd2lsbCB0cmFuc2xhdGUgdGhlIGRyYWcgc3VyZmFjZSBpbnN0ZWFkIG9mIHRoZSB0cmFuc2xhdGluZyB0aGVcbiAgICogd29ya3NwYWNlIGRpcmVjdGx5LlxuICAgKiBUaGlzIGlzIHNldCB0byB0cnVlIGluIHNldHVwRHJhZ1N1cmZhY2UgYW5kIHRvIGZhbHNlIGluIHJlc2V0RHJhZ1N1cmZhY2UuXG4gICAqL1xuICBwcml2YXRlIGlzRHJhZ1N1cmZhY2VBY3RpdmUgPSBmYWxzZTtcblxuICAvKipcbiAgICogVGhlIGZpcnN0IHBhcmVudCBkaXYgd2l0aCAnaW5qZWN0aW9uRGl2JyBpbiB0aGUgbmFtZSwgb3IgbnVsbCBpZiBub3Qgc2V0LlxuICAgKiBBY2Nlc3MgdGhpcyB3aXRoIGdldEluamVjdGlvbkRpdi5cbiAgICovXG4gIHByaXZhdGUgaW5qZWN0aW9uRGl2OiBFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBMYXN0IGtub3duIHBvc2l0aW9uIG9mIHRoZSBwYWdlIHNjcm9sbC5cbiAgICogVGhpcyBpcyB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIHdlIGhhdmUgcmVjYWxjdWxhdGVkIHNjcmVlbiBjb29yZGluYXRlXG4gICAqIHN0dWZmIHNpbmNlIHRoZSBwYWdlIHNjcm9sbGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBsYXN0UmVjb3JkZWRQYWdlU2Nyb2xsOiBDb29yZGluYXRlfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBEZXZlbG9wZXJzIG1heSBkZWZpbmUgdGhpcyBmdW5jdGlvbiB0byBhZGQgY3VzdG9tIG1lbnUgb3B0aW9ucyB0byB0aGVcbiAgICogd29ya3NwYWNlJ3MgY29udGV4dCBtZW51IG9yIGVkaXQgdGhlIHdvcmtzcGFjZS1jcmVhdGVkIHNldCBvZiBtZW51XG4gICAqIG9wdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIExpc3Qgb2YgbWVudSBvcHRpb25zIHRvIGFkZCB0by5cbiAgICogQHBhcmFtIGUgVGhlIHJpZ2h0LWNsaWNrIGV2ZW50IHRoYXQgdHJpZ2dlcmVkIHRoZSBjb250ZXh0IG1lbnUuXG4gICAqL1xuICBjb25maWd1cmVDb250ZXh0TWVudTpcbiAgICAgICgobWVudU9wdGlvbnM6IENvbnRleHRNZW51T3B0aW9uW10sIGU6IEV2ZW50KSA9PiB2b2lkKXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogSW4gYSBmbHlvdXQsIHRoZSB0YXJnZXQgd29ya3NwYWNlIHdoZXJlIGJsb2NrcyBzaG91bGQgYmUgcGxhY2VkIGFmdGVyIGFcbiAgICogZHJhZy4gT3RoZXJ3aXNlIG51bGwuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdGFyZ2V0V29ya3NwYWNlOiBXb3Jrc3BhY2VTdmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEludmVydGVkIHNjcmVlbiBDVE0sIGZvciB1c2UgaW4gbW91c2VUb1N2Zy4gKi9cbiAgcHJpdmF0ZSBpbnZlcnNlU2NyZWVuQ1RNOiBTVkdNYXRyaXh8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEludmVydGVkIHNjcmVlbiBDVE0gaXMgZGlydHksIHJlY2FsY3VsYXRlIGl0LiAqL1xuICBwcml2YXRlIGludmVyc2VTY3JlZW5DVE1EaXJ0eSA9IHRydWU7XG4gIHByaXZhdGUgbWV0cmljc01hbmFnZXI6IElNZXRyaWNzTWFuYWdlcjtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBnZXRNZXRyaWNzOiAoKSA9PiBNZXRyaWNzO1xuICAvKiogQGludGVybmFsICovXG4gIHNldE1ldHJpY3M6IChwMToge3g/OiBudW1iZXIsIHk/OiBudW1iZXJ9KSA9PiB2b2lkO1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbXBvbmVudE1hbmFnZXI6IENvbXBvbmVudE1hbmFnZXI7XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgY3VycmVudGx5IGhpZ2hsaWdodGVkIGJsb2Nrcy4gIEJsb2NrIGhpZ2hsaWdodGluZyBpcyBvZnRlbiB1c2VkXG4gICAqIHRvIHZpc3VhbGx5IG1hcmsgYmxvY2tzIGN1cnJlbnRseSBiZWluZyBleGVjdXRlZC5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgaGlnaGxpZ2h0ZWRCbG9ja3M6IEJsb2NrU3ZnW10gPSBbXTtcbiAgcHJpdmF0ZSBhdWRpb01hbmFnZXI6IFdvcmtzcGFjZUF1ZGlvO1xuICBwcml2YXRlIGdyaWQ6IEdyaWR8bnVsbDtcbiAgcHJpdmF0ZSBtYXJrZXJNYW5hZ2VyOiBNYXJrZXJNYW5hZ2VyO1xuXG4gIC8qKlxuICAgKiBNYXAgZnJvbSBmdW5jdGlvbiBuYW1lcyB0byBjYWxsYmFja3MsIGZvciBkZWNpZGluZyB3aGF0IHRvIGRvIHdoZW4gYVxuICAgKiBjdXN0b20gdG9vbGJveCBjYXRlZ29yeSBpcyBvcGVuZWQuXG4gICAqL1xuICBwcml2YXRlIHRvb2xib3hDYXRlZ29yeUNhbGxiYWNrcyA9XG4gICAgICBuZXcgTWFwPHN0cmluZywgKHAxOiBXb3Jrc3BhY2VTdmcpID0+IHRvb2xib3guRmx5b3V0RGVmaW5pdGlvbj4oKTtcblxuICAvKipcbiAgICogTWFwIGZyb20gZnVuY3Rpb24gbmFtZXMgdG8gY2FsbGJhY2tzLCBmb3IgZGVjaWRpbmcgd2hhdCB0byBkbyB3aGVuIGFcbiAgICogYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqL1xuICBwcml2YXRlIGZseW91dEJ1dHRvbkNhbGxiYWNrcyA9IG5ldyBNYXA8c3RyaW5nLCAocDE6IEZseW91dEJ1dHRvbikgPT4gdm9pZD4oKTtcbiAgcHJvdGVjdGVkIHRoZW1lTWFuYWdlcl86IFRoZW1lTWFuYWdlcjtcbiAgcHJpdmF0ZSByZWFkb25seSByZW5kZXJlcjogUmVuZGVyZXI7XG5cbiAgLyoqIENhY2hlZCBwYXJlbnQgU1ZHLiAqL1xuICBwcml2YXRlIGNhY2hlZFBhcmVudFN2ZzogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVHJ1ZSBpZiBrZXlib2FyZCBhY2Nlc3NpYmlsaXR5IG1vZGUgaXMgb24sIGZhbHNlIG90aGVyd2lzZS4gKi9cbiAga2V5Ym9hcmRBY2Nlc3NpYmlsaXR5TW9kZSA9IGZhbHNlO1xuXG4gIC8qKiBUaGUgbGlzdCBvZiB0b3AtbGV2ZWwgYm91bmRlZCBlbGVtZW50cyBvbiB0aGUgd29ya3NwYWNlLiAqL1xuICBwcml2YXRlIHRvcEJvdW5kZWRFbGVtZW50czogSUJvdW5kZWRFbGVtZW50W10gPSBbXTtcblxuICAvKiogVGhlIHJlY29yZGVkIGRyYWcgdGFyZ2V0cy4gKi9cbiAgcHJpdmF0ZSBkcmFnVGFyZ2V0QXJlYXM6IEFycmF5PHtjb21wb25lbnQ6IElEcmFnVGFyZ2V0LCBjbGllbnRSZWN0OiBSZWN0fT4gPVxuICAgICAgW107XG4gIHByaXZhdGUgcmVhZG9ubHkgY2FjaGVkUGFyZW50U3ZnU2l6ZTogU2l6ZTtcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgc3ZnR3JvdXBfITogU1ZHRWxlbWVudDtcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgc3ZnQmFja2dyb3VuZF8hOiBTVkdFbGVtZW50O1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBzdmdCbG9ja0NhbnZhc18hOiBTVkdFbGVtZW50O1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBzdmdCdWJibGVDYW52YXNfITogU1ZHRWxlbWVudDtcbiAgem9vbUNvbnRyb2xzXzogWm9vbUNvbnRyb2xzfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBEaWN0aW9uYXJ5IG9mIG9wdGlvbnMuXG4gICAqIEBwYXJhbSBvcHRfYmxvY2tEcmFnU3VyZmFjZSBEcmFnIHN1cmZhY2UgZm9yIGJsb2Nrcy5cbiAgICogQHBhcmFtIG9wdF93c0RyYWdTdXJmYWNlIERyYWcgc3VyZmFjZSBmb3IgdGhlIHdvcmtzcGFjZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0aW9uczogT3B0aW9ucywgb3B0X2Jsb2NrRHJhZ1N1cmZhY2U/OiBCbG9ja0RyYWdTdXJmYWNlU3ZnLFxuICAgICAgb3B0X3dzRHJhZ1N1cmZhY2U/OiBXb3Jrc3BhY2VEcmFnU3VyZmFjZVN2Zykge1xuICAgIHN1cGVyKG9wdGlvbnMpO1xuXG4gICAgY29uc3QgTWV0cmljc01hbmFnZXJDbGFzcyA9IHJlZ2lzdHJ5LmdldENsYXNzRnJvbU9wdGlvbnMoXG4gICAgICAgIHJlZ2lzdHJ5LlR5cGUuTUVUUklDU19NQU5BR0VSLCBvcHRpb25zLCB0cnVlKTtcbiAgICAvKiogT2JqZWN0IGluIGNoYXJnZSBvZiBjYWxjdWxhdGluZyBtZXRyaWNzIGZvciB0aGUgd29ya3NwYWNlLiAqL1xuICAgIHRoaXMubWV0cmljc01hbmFnZXIgPSBuZXcgTWV0cmljc01hbmFnZXJDbGFzcyEodGhpcyk7XG5cbiAgICAvKiogTWV0aG9kIHRvIGdldCBhbGwgdGhlIG1ldHJpY3MgdGhhdCBoYXZlIHRvIGRvIHdpdGggYSB3b3Jrc3BhY2UuICovXG4gICAgdGhpcy5nZXRNZXRyaWNzID0gb3B0aW9ucy5nZXRNZXRyaWNzIHx8XG4gICAgICAgIHRoaXMubWV0cmljc01hbmFnZXIuZ2V0TWV0cmljcy5iaW5kKHRoaXMubWV0cmljc01hbmFnZXIpO1xuXG4gICAgLyoqIFRyYW5zbGF0ZXMgdGhlIHdvcmtzcGFjZS4gKi9cbiAgICB0aGlzLnNldE1ldHJpY3MgPVxuICAgICAgICBvcHRpb25zLnNldE1ldHJpY3MgfHwgV29ya3NwYWNlU3ZnLnNldFRvcExldmVsV29ya3NwYWNlTWV0cmljc187XG5cbiAgICB0aGlzLmNvbXBvbmVudE1hbmFnZXIgPSBuZXcgQ29tcG9uZW50TWFuYWdlcigpO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uREJMaXN0ID0gQ29ubmVjdGlvbkRCLmluaXQodGhpcy5jb25uZWN0aW9uQ2hlY2tlcik7XG5cbiAgICBpZiAob3B0X2Jsb2NrRHJhZ1N1cmZhY2UpIHtcbiAgICAgIHRoaXMuYmxvY2tEcmFnU3VyZmFjZSA9IG9wdF9ibG9ja0RyYWdTdXJmYWNlO1xuICAgIH1cblxuICAgIGlmIChvcHRfd3NEcmFnU3VyZmFjZSkge1xuICAgICAgdGhpcy53b3Jrc3BhY2VEcmFnU3VyZmFjZSA9IG9wdF93c0RyYWdTdXJmYWNlO1xuICAgIH1cblxuICAgIHRoaXMudXNlV29ya3NwYWNlRHJhZ1N1cmZhY2UgPSAhIXRoaXMud29ya3NwYWNlRHJhZ1N1cmZhY2U7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3QgaW4gY2hhcmdlIG9mIGxvYWRpbmcsIHN0b3JpbmcsIGFuZCBwbGF5aW5nIGF1ZGlvIGZvciBhIHdvcmtzcGFjZS5cbiAgICAgKi9cbiAgICB0aGlzLmF1ZGlvTWFuYWdlciA9XG4gICAgICAgIG5ldyBXb3Jrc3BhY2VBdWRpbygob3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2UgYXMgV29ya3NwYWNlU3ZnKSk7XG5cbiAgICAvKiogVGhpcyB3b3Jrc3BhY2UncyBncmlkIG9iamVjdCBvciBudWxsLiAqL1xuICAgIHRoaXMuZ3JpZCA9IHRoaXMub3B0aW9ucy5ncmlkUGF0dGVybiA/XG4gICAgICAgIG5ldyBHcmlkKHRoaXMub3B0aW9ucy5ncmlkUGF0dGVybiwgb3B0aW9ucy5ncmlkT3B0aW9ucykgOlxuICAgICAgICBudWxsO1xuXG4gICAgLyoqIE1hbmFnZXIgaW4gY2hhcmdlIG9mIG1hcmtlcnMgYW5kIGN1cnNvcnMuICovXG4gICAgdGhpcy5tYXJrZXJNYW5hZ2VyID0gbmV3IE1hcmtlck1hbmFnZXIodGhpcyk7XG5cbiAgICBpZiAoVmFyaWFibGVzICYmIFZhcmlhYmxlcy5mbHlvdXRDYXRlZ29yeSkge1xuICAgICAgdGhpcy5yZWdpc3RlclRvb2xib3hDYXRlZ29yeUNhbGxiYWNrKFxuICAgICAgICAgIFZhcmlhYmxlcy5DQVRFR09SWV9OQU1FLCBWYXJpYWJsZXMuZmx5b3V0Q2F0ZWdvcnkpO1xuICAgIH1cblxuICAgIGlmIChWYXJpYWJsZXNEeW5hbWljICYmIFZhcmlhYmxlc0R5bmFtaWMuZmx5b3V0Q2F0ZWdvcnkpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJUb29sYm94Q2F0ZWdvcnlDYWxsYmFjayhcbiAgICAgICAgICBWYXJpYWJsZXNEeW5hbWljLkNBVEVHT1JZX05BTUUsIFZhcmlhYmxlc0R5bmFtaWMuZmx5b3V0Q2F0ZWdvcnkpO1xuICAgIH1cblxuICAgIGlmIChQcm9jZWR1cmVzICYmIFByb2NlZHVyZXMuZmx5b3V0Q2F0ZWdvcnkpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJUb29sYm94Q2F0ZWdvcnlDYWxsYmFjayhcbiAgICAgICAgICBQcm9jZWR1cmVzLkNBVEVHT1JZX05BTUUsIFByb2NlZHVyZXMuZmx5b3V0Q2F0ZWdvcnkpO1xuICAgICAgdGhpcy5hZGRDaGFuZ2VMaXN0ZW5lcihQcm9jZWR1cmVzLm11dGF0b3JPcGVuTGlzdGVuZXIpO1xuICAgIH1cblxuICAgIC8qKiBPYmplY3QgaW4gY2hhcmdlIG9mIHN0b3JpbmcgYW5kIHVwZGF0aW5nIHRoZSB3b3Jrc3BhY2UgdGhlbWUuICovXG4gICAgdGhpcy50aGVtZU1hbmFnZXJfID0gdGhpcy5vcHRpb25zLnBhcmVudFdvcmtzcGFjZSA/XG4gICAgICAgIHRoaXMub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2UuZ2V0VGhlbWVNYW5hZ2VyKCkgOlxuICAgICAgICBuZXcgVGhlbWVNYW5hZ2VyKHRoaXMsIHRoaXMub3B0aW9ucy50aGVtZSB8fCBDbGFzc2ljKTtcbiAgICB0aGlzLnRoZW1lTWFuYWdlcl8uc3Vic2NyaWJlV29ya3NwYWNlKHRoaXMpO1xuXG4gICAgLyoqIFRoZSBibG9jayByZW5kZXJlciB1c2VkIGZvciByZW5kZXJpbmcgYmxvY2tzIG9uIHRoaXMgd29ya3NwYWNlLiAqL1xuICAgIHRoaXMucmVuZGVyZXIgPSBibG9ja1JlbmRlcmluZy5pbml0KFxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyZXIgfHwgJ2dlcmFzJywgdGhpcy5nZXRUaGVtZSgpLFxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyZXJPdmVycmlkZXMgPz8gdW5kZWZpbmVkKTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBjYWNoZWQgc2l6ZSBvZiB0aGUgcGFyZW50IHN2ZyBlbGVtZW50LlxuICAgICAqIFVzZWQgdG8gY29tcHV0ZSBzdmcgbWV0cmljcy5cbiAgICAgKi9cbiAgICB0aGlzLmNhY2hlZFBhcmVudFN2Z1NpemUgPSBuZXcgU2l6ZSgwLCAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG1hcmtlciBtYW5hZ2VyIGZvciB0aGlzIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIG1hcmtlciBtYW5hZ2VyLlxuICAgKi9cbiAgZ2V0TWFya2VyTWFuYWdlcigpOiBNYXJrZXJNYW5hZ2VyIHtcbiAgICByZXR1cm4gdGhpcy5tYXJrZXJNYW5hZ2VyO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG1ldHJpY3MgbWFuYWdlciBmb3IgdGhpcyB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBtZXRyaWNzIG1hbmFnZXIuXG4gICAqL1xuICBnZXRNZXRyaWNzTWFuYWdlcigpOiBJTWV0cmljc01hbmFnZXIge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY3NNYW5hZ2VyO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIG1ldHJpY3MgbWFuYWdlciBmb3IgdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIG1ldHJpY3NNYW5hZ2VyIFRoZSBtZXRyaWNzIG1hbmFnZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0TWV0cmljc01hbmFnZXIobWV0cmljc01hbmFnZXI6IElNZXRyaWNzTWFuYWdlcikge1xuICAgIHRoaXMubWV0cmljc01hbmFnZXIgPSBtZXRyaWNzTWFuYWdlcjtcbiAgICB0aGlzLmdldE1ldHJpY3MgPSB0aGlzLm1ldHJpY3NNYW5hZ2VyLmdldE1ldHJpY3MuYmluZCh0aGlzLm1ldHJpY3NNYW5hZ2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjb21wb25lbnQgbWFuYWdlciBmb3IgdGhpcyB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb21wb25lbnQgbWFuYWdlci5cbiAgICovXG4gIGdldENvbXBvbmVudE1hbmFnZXIoKTogQ29tcG9uZW50TWFuYWdlciB7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9uZW50TWFuYWdlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgdGhlIGN1cnNvciBTVkcgdG8gdGhpcyB3b3Jrc3BhY2VzIFNWRyBncm91cC5cbiAgICpcbiAgICogQHBhcmFtIGN1cnNvclN2ZyBUaGUgU1ZHIHJvb3Qgb2YgdGhlIGN1cnNvciB0byBiZSBhZGRlZCB0byB0aGUgd29ya3NwYWNlXG4gICAqICAgICBTVkcgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Q3Vyc29yU3ZnKGN1cnNvclN2ZzogU1ZHRWxlbWVudCkge1xuICAgIHRoaXMubWFya2VyTWFuYWdlci5zZXRDdXJzb3JTdmcoY3Vyc29yU3ZnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgdGhlIG1hcmtlciBTVkcgdG8gdGhpcyB3b3Jrc3BhY2VzIFNWRyBncm91cC5cbiAgICpcbiAgICogQHBhcmFtIG1hcmtlclN2ZyBUaGUgU1ZHIHJvb3Qgb2YgdGhlIG1hcmtlciB0byBiZSBhZGRlZCB0byB0aGUgd29ya3NwYWNlXG4gICAqICAgICBTVkcgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0TWFya2VyU3ZnKG1hcmtlclN2ZzogU1ZHRWxlbWVudCkge1xuICAgIHRoaXMubWFya2VyTWFuYWdlci5zZXRNYXJrZXJTdmcobWFya2VyU3ZnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG1hcmtlciB3aXRoIHRoZSBnaXZlbiBJRC5cbiAgICpcbiAgICogQHBhcmFtIGlkIFRoZSBJRCBvZiB0aGUgbWFya2VyLlxuICAgKiBAcmV0dXJucyBUaGUgbWFya2VyIHdpdGggdGhlIGdpdmVuIElEIG9yIG51bGwgaWYgbm8gbWFya2VyIHdpdGggdGhlIGdpdmVuXG4gICAqICAgICBJRCBleGlzdHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0TWFya2VyKGlkOiBzdHJpbmcpOiBNYXJrZXJ8bnVsbCB7XG4gICAgaWYgKHRoaXMubWFya2VyTWFuYWdlcikge1xuICAgICAgcmV0dXJuIHRoaXMubWFya2VyTWFuYWdlci5nZXRNYXJrZXIoaWQpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgY3Vyc29yIGZvciB0aGlzIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGN1cnNvciBmb3IgdGhlIHdvcmtzcGFjZS5cbiAgICovXG4gIGdldEN1cnNvcigpOiBDdXJzb3J8bnVsbCB7XG4gICAgaWYgKHRoaXMubWFya2VyTWFuYWdlcikge1xuICAgICAgcmV0dXJuIHRoaXMubWFya2VyTWFuYWdlci5nZXRDdXJzb3IoKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBibG9jayByZW5kZXJlciBhdHRhY2hlZCB0byB0aGlzIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHJlbmRlcmVyIGF0dGFjaGVkIHRvIHRoaXMgd29ya3NwYWNlLlxuICAgKi9cbiAgZ2V0UmVuZGVyZXIoKTogUmVuZGVyZXIge1xuICAgIHJldHVybiB0aGlzLnJlbmRlcmVyO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgdGhlbWUgbWFuYWdlciBmb3IgdGhpcyB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0aGVtZSBtYW5hZ2VyIGZvciB0aGlzIHdvcmtzcGFjZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRUaGVtZU1hbmFnZXIoKTogVGhlbWVNYW5hZ2VyIHtcbiAgICByZXR1cm4gdGhpcy50aGVtZU1hbmFnZXJfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgd29ya3NwYWNlIHRoZW1lIG9iamVjdC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHdvcmtzcGFjZSB0aGVtZSBvYmplY3QuXG4gICAqL1xuICBnZXRUaGVtZSgpOiBUaGVtZSB7XG4gICAgcmV0dXJuIHRoaXMudGhlbWVNYW5hZ2VyXy5nZXRUaGVtZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgd29ya3NwYWNlIHRoZW1lIG9iamVjdC5cbiAgICogSWYgbm8gdGhlbWUgaXMgcGFzc2VkLCBkZWZhdWx0IHRvIHRoZSBgQ2xhc3NpY2AgdGhlbWUuXG4gICAqXG4gICAqIEBwYXJhbSB0aGVtZSBUaGUgd29ya3NwYWNlIHRoZW1lIG9iamVjdC5cbiAgICovXG4gIHNldFRoZW1lKHRoZW1lOiBUaGVtZSkge1xuICAgIGlmICghdGhlbWUpIHtcbiAgICAgIHRoZW1lID0gQ2xhc3NpYyBhcyBUaGVtZTtcbiAgICB9XG4gICAgdGhpcy50aGVtZU1hbmFnZXJfLnNldFRoZW1lKHRoZW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWZyZXNoIGFsbCBibG9ja3Mgb24gdGhlIHdvcmtzcGFjZSBhZnRlciBhIHRoZW1lIHVwZGF0ZS5cbiAgICovXG4gIHJlZnJlc2hUaGVtZSgpIHtcbiAgICBpZiAodGhpcy5zdmdHcm91cF8pIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVmcmVzaERvbSh0aGlzLnN2Z0dyb3VwXywgdGhpcy5nZXRUaGVtZSgpKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgYWxsIGJsb2NrcyBpbiB3b3Jrc3BhY2UgdGhhdCBoYXZlIGEgc3R5bGUgbmFtZS5cbiAgICB0aGlzLnVwZGF0ZUJsb2NrU3R5bGVzXyh0aGlzLmdldEFsbEJsb2NrcyhmYWxzZSkuZmlsdGVyKGZ1bmN0aW9uKGJsb2NrKSB7XG4gICAgICByZXR1cm4gISFibG9jay5nZXRTdHlsZU5hbWUoKTtcbiAgICB9KSk7XG5cbiAgICAvLyBVcGRhdGUgY3VycmVudCB0b29sYm94IHNlbGVjdGlvbi5cbiAgICB0aGlzLnJlZnJlc2hUb29sYm94U2VsZWN0aW9uKCk7XG4gICAgaWYgKHRoaXMudG9vbGJveF8pIHtcbiAgICAgIHRoaXMudG9vbGJveF8ucmVmcmVzaFRoZW1lKCk7XG4gICAgfVxuXG4gICAgLy8gUmUtcmVuZGVyIGlmIHdvcmtzcGFjZSBpcyB2aXNpYmxlXG4gICAgaWYgKHRoaXMuaXNWaXNpYmxlKCkpIHtcbiAgICAgIHRoaXMuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICB9XG5cbiAgICBjb25zdCBldmVudCA9IG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5USEVNRV9DSEFOR0UpKShcbiAgICAgICAgdGhpcy5nZXRUaGVtZSgpLm5hbWUsIHRoaXMuaWQpO1xuICAgIGV2ZW50VXRpbHMuZmlyZShldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBhbGwgdGhlIGJsb2NrcyB3aXRoIG5ldyBzdHlsZS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrcyBMaXN0IG9mIGJsb2NrcyB0byB1cGRhdGUgdGhlIHN0eWxlIG9uLlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVCbG9ja1N0eWxlc18oYmxvY2tzOiBCbG9ja1tdKSB7XG4gICAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IGJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgICBjb25zdCBibG9ja1N0eWxlTmFtZSA9IGJsb2NrLmdldFN0eWxlTmFtZSgpO1xuICAgICAgaWYgKGJsb2NrU3R5bGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrU3ZnID0gYmxvY2sgYXMgQmxvY2tTdmc7XG4gICAgICAgIGJsb2NrU3ZnLnNldFN0eWxlKGJsb2NrU3R5bGVOYW1lKTtcbiAgICAgICAgaWYgKGJsb2NrU3ZnLm11dGF0b3IpIHtcbiAgICAgICAgICBibG9ja1N2Zy5tdXRhdG9yLnVwZGF0ZUJsb2NrU3R5bGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXR0ZXIgZm9yIHRoZSBpbnZlcnRlZCBzY3JlZW4gQ1RNLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgbWF0cml4IHRvIHVzZSBpbiBtb3VzZVRvU3ZnXG4gICAqL1xuICBnZXRJbnZlcnNlU2NyZWVuQ1RNKCk6IFNWR01hdHJpeHxudWxsIHtcbiAgICAvLyBEZWZlciBnZXR0aW5nIHRoZSBzY3JlZW4gQ1RNIHVudGlsIHdlIGFjdHVhbGx5IG5lZWQgaXQsIHRoaXMgc2hvdWxkXG4gICAgLy8gYXZvaWQgZm9yY2VkIHJlZmxvd3MgZnJvbSBhbnkgY2FsbHMgdG8gdXBkYXRlSW52ZXJzZVNjcmVlbkNUTS5cbiAgICBpZiAodGhpcy5pbnZlcnNlU2NyZWVuQ1RNRGlydHkpIHtcbiAgICAgIGNvbnN0IGN0bSA9IHRoaXMuZ2V0UGFyZW50U3ZnKCkuZ2V0U2NyZWVuQ1RNKCk7XG4gICAgICBpZiAoY3RtKSB7XG4gICAgICAgIHRoaXMuaW52ZXJzZVNjcmVlbkNUTSA9IChjdG0pLmludmVyc2UoKTtcbiAgICAgICAgdGhpcy5pbnZlcnNlU2NyZWVuQ1RNRGlydHkgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pbnZlcnNlU2NyZWVuQ1RNO1xuICB9XG5cbiAgLyoqIE1hcmsgdGhlIGludmVyc2Ugc2NyZWVuIENUTSBhcyBkaXJ0eS4gKi9cbiAgdXBkYXRlSW52ZXJzZVNjcmVlbkNUTSgpIHtcbiAgICB0aGlzLmludmVyc2VTY3JlZW5DVE1EaXJ0eSA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogR2V0dGVyIGZvciBpc1Zpc2libGVcbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgd29ya3NwYWNlIGlzIHZpc2libGUuXG4gICAqICAgICBGYWxzZSBpZiB0aGUgd29ya3NwYWNlIGhhcyBiZWVuIGhpZGRlbiBieSBjYWxsaW5nIGBzZXRWaXNpYmxlKGZhbHNlKWAuXG4gICAqL1xuICBpc1Zpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlXztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGFic29sdXRlIGNvb3JkaW5hdGVzIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhpcyBlbGVtZW50LFxuICAgKiBzY2FsZXMgdGhhdCBhZnRlciBjYW52YXMgU1ZHIGVsZW1lbnQsIGlmIGl0J3MgYSBkZXNjZW5kYW50LlxuICAgKiBUaGUgb3JpZ2luICgwLDApIGlzIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIEJsb2NrbHkgU1ZHLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCBTVkcgZWxlbWVudCB0byBmaW5kIHRoZSBjb29yZGluYXRlcyBvZi5cbiAgICogQHJldHVybnMgT2JqZWN0IHdpdGggLnggYW5kIC55IHByb3BlcnRpZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0U3ZnWFkoZWxlbWVudDogU1ZHRWxlbWVudCk6IENvb3JkaW5hdGUge1xuICAgIGxldCB4ID0gMDtcbiAgICBsZXQgeSA9IDA7XG4gICAgbGV0IHNjYWxlID0gMTtcbiAgICBpZiAoZG9tLmNvbnRhaW5zTm9kZSh0aGlzLmdldENhbnZhcygpLCBlbGVtZW50KSB8fFxuICAgICAgICBkb20uY29udGFpbnNOb2RlKHRoaXMuZ2V0QnViYmxlQ2FudmFzKCksIGVsZW1lbnQpKSB7XG4gICAgICAvLyBCZWZvcmUgdGhlIFNWRyBjYW52YXMsIHNjYWxlIHRoZSBjb29yZGluYXRlcy5cbiAgICAgIHNjYWxlID0gdGhpcy5zY2FsZTtcbiAgICB9XG4gICAgZG8ge1xuICAgICAgLy8gTG9vcCB0aHJvdWdoIHRoaXMgYmxvY2sgYW5kIGV2ZXJ5IHBhcmVudC5cbiAgICAgIGNvbnN0IHh5ID0gc3ZnTWF0aC5nZXRSZWxhdGl2ZVhZKGVsZW1lbnQpO1xuICAgICAgaWYgKGVsZW1lbnQgPT09IHRoaXMuZ2V0Q2FudmFzKCkgfHwgZWxlbWVudCA9PT0gdGhpcy5nZXRCdWJibGVDYW52YXMoKSkge1xuICAgICAgICAvLyBBZnRlciB0aGUgU1ZHIGNhbnZhcywgZG9uJ3Qgc2NhbGUgdGhlIGNvb3JkaW5hdGVzLlxuICAgICAgICBzY2FsZSA9IDE7XG4gICAgICB9XG4gICAgICB4ICs9IHh5LnggKiBzY2FsZTtcbiAgICAgIHkgKz0geHkueSAqIHNjYWxlO1xuICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSBhcyBTVkdFbGVtZW50O1xuICAgIH0gd2hpbGUgKGVsZW1lbnQgJiYgZWxlbWVudCAhPT0gdGhpcy5nZXRQYXJlbnRTdmcoKSk7XG4gICAgcmV0dXJuIG5ldyBDb29yZGluYXRlKHgsIHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNpemUgb2YgdGhlIHdvcmtzcGFjZSdzIHBhcmVudCBTVkcgZWxlbWVudC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGNhY2hlZCB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSB3b3Jrc3BhY2UncyBwYXJlbnQgU1ZHIGVsZW1lbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0Q2FjaGVkUGFyZW50U3ZnU2l6ZSgpOiBTaXplIHtcbiAgICBjb25zdCBzaXplID0gdGhpcy5jYWNoZWRQYXJlbnRTdmdTaXplO1xuICAgIHJldHVybiBuZXcgU2l6ZShzaXplLndpZHRoLCBzaXplLmhlaWdodCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgd29ya3NwYWNlIG9yaWdpbiByZWxhdGl2ZSB0byB0aGUgaW5qZWN0aW9uIGRpdlxuICAgKiBvcmlnaW4gaW4gcGl4ZWxzLlxuICAgKiBUaGUgd29ya3NwYWNlIG9yaWdpbiBpcyB3aGVyZSBhIGJsb2NrIHdvdWxkIHJlbmRlciBhdCBwb3NpdGlvbiAoMCwgMCkuXG4gICAqIEl0IGlzIG5vdCB0aGUgdXBwZXIgbGVmdCBjb3JuZXIgb2YgdGhlIHdvcmtzcGFjZSBTVkcuXG4gICAqXG4gICAqIEByZXR1cm5zIE9mZnNldCBpbiBwaXhlbHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0T3JpZ2luT2Zmc2V0SW5QaXhlbHMoKTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIHN2Z01hdGguZ2V0SW5qZWN0aW9uRGl2WFkodGhpcy5nZXRDYW52YXMoKSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbmplY3Rpb24gZGl2IHRoYXQgaXMgYSBwYXJlbnQgb2YgdGhpcyB3b3Jrc3BhY2UuXG4gICAqIFdhbGtzIHRoZSBET00gdGhlIGZpcnN0IHRpbWUgaXQncyBjYWxsZWQsIHRoZW4gcmV0dXJucyBhIGNhY2hlZCB2YWx1ZS5cbiAgICogTm90ZTogV2UgYXNzdW1lIHRoaXMgaXMgb25seSBjYWxsZWQgYWZ0ZXIgdGhlIHdvcmtzcGFjZSBoYXMgYmVlbiBpbmplY3RlZFxuICAgKiBpbnRvIHRoZSBET00uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBmaXJzdCBwYXJlbnQgZGl2IHdpdGggJ2luamVjdGlvbkRpdicgaW4gdGhlIG5hbWUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0SW5qZWN0aW9uRGl2KCk6IEVsZW1lbnQge1xuICAgIC8vIE5COiBpdCB3b3VsZCBiZSBiZXR0ZXIgdG8gcGFzcyB0aGlzIGluIGF0IGNyZWF0ZURvbSwgYnV0IGlzIG1vcmUgbGlrZWx5XG4gICAgLy8gdG8gYnJlYWsgZXhpc3RpbmcgdXNlcyBvZiBCbG9ja2x5LlxuICAgIGlmICghdGhpcy5pbmplY3Rpb25EaXYpIHtcbiAgICAgIGxldCBlbGVtZW50OiBFbGVtZW50ID0gdGhpcy5zdmdHcm91cF87XG4gICAgICB3aGlsZSAoZWxlbWVudCkge1xuICAgICAgICBjb25zdCBjbGFzc2VzID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgfHwgJyc7XG4gICAgICAgIGlmICgoJyAnICsgY2xhc3NlcyArICcgJykuaW5kZXhPZignIGluamVjdGlvbkRpdiAnKSAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLmluamVjdGlvbkRpdiA9IGVsZW1lbnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSBhcyBFbGVtZW50O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5pbmplY3Rpb25EaXYhO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgU1ZHIGJsb2NrIGNhbnZhcyBmb3IgdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIFNWRyBncm91cCBmb3IgdGhlIHdvcmtzcGFjZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRCbG9ja0NhbnZhcygpOiBTVkdFbGVtZW50fG51bGwge1xuICAgIHJldHVybiB0aGlzLnN2Z0Jsb2NrQ2FudmFzXztcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlIHJlc2l6ZSBoYW5kbGVyIGRhdGEgc28gd2UgY2FuIGRlbGV0ZSBpdCBsYXRlciBpbiBkaXNwb3NlLlxuICAgKlxuICAgKiBAcGFyYW0gaGFuZGxlciBEYXRhIHRoYXQgY2FuIGJlIHBhc3NlZCB0byBldmVudEhhbmRsaW5nLnVuYmluZC5cbiAgICovXG4gIHNldFJlc2l6ZUhhbmRsZXJXcmFwcGVyKGhhbmRsZXI6IGJyb3dzZXJFdmVudHMuRGF0YSkge1xuICAgIHRoaXMucmVzaXplSGFuZGxlcldyYXBwZXIgPSBoYW5kbGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgd29ya3NwYWNlIERPTSBlbGVtZW50cy5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9iYWNrZ3JvdW5kQ2xhc3MgRWl0aGVyICdibG9ja2x5TWFpbkJhY2tncm91bmQnIG9yXG4gICAqICAgICAnYmxvY2tseU11dGF0b3JCYWNrZ3JvdW5kJy5cbiAgICogQHJldHVybnMgVGhlIHdvcmtzcGFjZSdzIFNWRyBncm91cC5cbiAgICovXG4gIGNyZWF0ZURvbShvcHRfYmFja2dyb3VuZENsYXNzPzogc3RyaW5nKTogRWxlbWVudCB7XG4gICAgLyoqXG4gICAgICogPGcgY2xhc3M9XCJibG9ja2x5V29ya3NwYWNlXCI+XG4gICAgICogICA8cmVjdCBjbGFzcz1cImJsb2NrbHlNYWluQmFja2dyb3VuZFwiIGhlaWdodD1cIjEwMCVcIiB3aWR0aD1cIjEwMCVcIj48L3JlY3Q+XG4gICAgICogICBbVHJhc2hjYW4gYW5kL29yIGZseW91dCBtYXkgZ28gaGVyZV1cbiAgICAgKiAgIDxnIGNsYXNzPVwiYmxvY2tseUJsb2NrQ2FudmFzXCI+PC9nPlxuICAgICAqICAgPGcgY2xhc3M9XCJibG9ja2x5QnViYmxlQ2FudmFzXCI+PC9nPlxuICAgICAqIDwvZz5cbiAgICAgKi9cbiAgICB0aGlzLnN2Z0dyb3VwXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5HLCB7J2NsYXNzJzogJ2Jsb2NrbHlXb3Jrc3BhY2UnfSk7XG5cbiAgICAvLyBOb3RlIHRoYXQgYSA8Zz4gYWxvbmUgZG9lcyBub3QgcmVjZWl2ZSBtb3VzZSBldmVudHMtLWl0IG11c3QgaGF2ZSBhXG4gICAgLy8gdmFsaWQgdGFyZ2V0IGluc2lkZSBpdC4gIElmIG5vIGJhY2tncm91bmQgY2xhc3MgaXMgc3BlY2lmaWVkLCBhcyBpbiB0aGVcbiAgICAvLyBmbHlvdXQsIHRoZSB3b3Jrc3BhY2Ugd2lsbCBub3QgcmVjZWl2ZSBtb3VzZSBldmVudHMuXG4gICAgaWYgKG9wdF9iYWNrZ3JvdW5kQ2xhc3MpIHtcbiAgICAgIHRoaXMuc3ZnQmFja2dyb3VuZF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuUkVDVCxcbiAgICAgICAgICB7J2hlaWdodCc6ICcxMDAlJywgJ3dpZHRoJzogJzEwMCUnLCAnY2xhc3MnOiBvcHRfYmFja2dyb3VuZENsYXNzfSxcbiAgICAgICAgICB0aGlzLnN2Z0dyb3VwXyk7XG5cbiAgICAgIGlmIChvcHRfYmFja2dyb3VuZENsYXNzID09PSAnYmxvY2tseU1haW5CYWNrZ3JvdW5kJyAmJiB0aGlzLmdyaWQpIHtcbiAgICAgICAgdGhpcy5zdmdCYWNrZ3JvdW5kXy5zdHlsZS5maWxsID1cbiAgICAgICAgICAgICd1cmwoIycgKyB0aGlzLmdyaWQuZ2V0UGF0dGVybklkKCkgKyAnKSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnRoZW1lTWFuYWdlcl8uc3Vic2NyaWJlKFxuICAgICAgICAgICAgdGhpcy5zdmdCYWNrZ3JvdW5kXywgJ3dvcmtzcGFjZUJhY2tncm91bmRDb2xvdXInLCAnZmlsbCcpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnN2Z0Jsb2NrQ2FudmFzXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRywgeydjbGFzcyc6ICdibG9ja2x5QmxvY2tDYW52YXMnfSwgdGhpcy5zdmdHcm91cF8pO1xuICAgIHRoaXMuc3ZnQnViYmxlQ2FudmFzXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRywgeydjbGFzcyc6ICdibG9ja2x5QnViYmxlQ2FudmFzJ30sIHRoaXMuc3ZnR3JvdXBfKTtcblxuICAgIGlmICghdGhpcy5pc0ZseW91dCkge1xuICAgICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgICAgdGhpcy5zdmdHcm91cF8sICdwb2ludGVyZG93bicsIHRoaXMsIHRoaXMub25Nb3VzZURvd25fLCBmYWxzZSk7XG4gICAgICAvLyBUaGlzIG5vLW9wIHdvcmtzIGFyb3VuZCBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MjI2NjgzLFxuICAgICAgLy8gd2hpY2ggb3RoZXJ3aXNlIHByZXZlbnRzIHpvb20vc2Nyb2xsIGV2ZW50cyBmcm9tIGJlaW5nIG9ic2VydmVkIGluXG4gICAgICAvLyBTYWZhcmkuIE9uY2UgdGhhdCBidWcgaXMgZml4ZWQgaXQgc2hvdWxkIGJlIHJlbW92ZWQuXG4gICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgZnVuY3Rpb24oKSB7fSk7XG4gICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICB0aGlzLnN2Z0dyb3VwXywgJ3doZWVsJywgdGhpcywgdGhpcy5vbk1vdXNlV2hlZWxfKTtcbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgaWYgdGhlcmUgbmVlZHMgdG8gYmUgYSBjYXRlZ29yeSB0cmVlLCBvciBhIHNpbXBsZSBsaXN0IG9mXG4gICAgLy8gYmxvY2tzLiAgVGhpcyBjYW5ub3QgYmUgY2hhbmdlZCBsYXRlciwgc2luY2UgdGhlIFVJIGlzIHZlcnkgZGlmZmVyZW50LlxuICAgIGlmICh0aGlzLm9wdGlvbnMuaGFzQ2F0ZWdvcmllcykge1xuICAgICAgY29uc3QgVG9vbGJveENsYXNzID0gcmVnaXN0cnkuZ2V0Q2xhc3NGcm9tT3B0aW9ucyhcbiAgICAgICAgICByZWdpc3RyeS5UeXBlLlRPT0xCT1gsIHRoaXMub3B0aW9ucywgdHJ1ZSk7XG4gICAgICB0aGlzLnRvb2xib3hfID0gbmV3IFRvb2xib3hDbGFzcyEodGhpcyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmdyaWQpIHtcbiAgICAgIHRoaXMuZ3JpZC51cGRhdGUodGhpcy5zY2FsZSk7XG4gICAgfVxuICAgIHRoaXMucmVjb3JkRHJhZ1RhcmdldHMoKTtcbiAgICBjb25zdCBDdXJzb3JDbGFzcyA9XG4gICAgICAgIHJlZ2lzdHJ5LmdldENsYXNzRnJvbU9wdGlvbnMocmVnaXN0cnkuVHlwZS5DVVJTT1IsIHRoaXMub3B0aW9ucyk7XG5cbiAgICBDdXJzb3JDbGFzcyAmJiB0aGlzLm1hcmtlck1hbmFnZXIuc2V0Q3Vyc29yKG5ldyBDdXJzb3JDbGFzcygpKTtcblxuICAgIHRoaXMucmVuZGVyZXIuY3JlYXRlRG9tKHRoaXMuc3ZnR3JvdXBfLCB0aGlzLmdldFRoZW1lKCkpO1xuICAgIHJldHVybiB0aGlzLnN2Z0dyb3VwXztcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIHRoaXMgd29ya3NwYWNlLlxuICAgKiBVbmxpbmsgZnJvbSBhbGwgRE9NIGVsZW1lbnRzIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzLlxuICAgKlxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICBvdmVycmlkZSBkaXNwb3NlKCkge1xuICAgIC8vIFN0b3AgcmVyZW5kZXJpbmcuXG4gICAgdGhpcy5yZW5kZXJlZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmN1cnJlbnRHZXN0dXJlXykge1xuICAgICAgdGhpcy5jdXJyZW50R2VzdHVyZV8uY2FuY2VsKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnN2Z0dyb3VwXykge1xuICAgICAgZG9tLnJlbW92ZU5vZGUodGhpcy5zdmdHcm91cF8pO1xuICAgIH1cbiAgICBpZiAodGhpcy50b29sYm94Xykge1xuICAgICAgdGhpcy50b29sYm94Xy5kaXNwb3NlKCk7XG4gICAgICB0aGlzLnRvb2xib3hfID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMuZmx5b3V0KSB7XG4gICAgICB0aGlzLmZseW91dC5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmZseW91dCA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYXNoY2FuKSB7XG4gICAgICB0aGlzLnRyYXNoY2FuLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMudHJhc2hjYW4gPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5zY3JvbGxiYXIpIHtcbiAgICAgIHRoaXMuc2Nyb2xsYmFyLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuc2Nyb2xsYmFyID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMuem9vbUNvbnRyb2xzXykge1xuICAgICAgdGhpcy56b29tQ29udHJvbHNfLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hdWRpb01hbmFnZXIpIHtcbiAgICAgIHRoaXMuYXVkaW9NYW5hZ2VyLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5ncmlkKSB7XG4gICAgICB0aGlzLmdyaWQgPSBudWxsO1xuICAgIH1cblxuICAgIHRoaXMucmVuZGVyZXIuZGlzcG9zZSgpO1xuXG4gICAgaWYgKHRoaXMubWFya2VyTWFuYWdlcikge1xuICAgICAgdGhpcy5tYXJrZXJNYW5hZ2VyLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICBzdXBlci5kaXNwb3NlKCk7XG5cbiAgICAvLyBEaXNwb3NlIG9mIHRoZW1lIG1hbmFnZXIgYWZ0ZXIgYWxsIGJsb2NrcyBhbmQgbXV0YXRvcnMgYXJlIGRpc3Bvc2VkIG9mLlxuICAgIGlmICh0aGlzLnRoZW1lTWFuYWdlcl8pIHtcbiAgICAgIHRoaXMudGhlbWVNYW5hZ2VyXy51bnN1YnNjcmliZVdvcmtzcGFjZSh0aGlzKTtcbiAgICAgIHRoaXMudGhlbWVNYW5hZ2VyXy51bnN1YnNjcmliZSh0aGlzLnN2Z0JhY2tncm91bmRfKTtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnBhcmVudFdvcmtzcGFjZSkge1xuICAgICAgICB0aGlzLnRoZW1lTWFuYWdlcl8uZGlzcG9zZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY29ubmVjdGlvbkRCTGlzdC5sZW5ndGggPSAwO1xuXG4gICAgdGhpcy50b29sYm94Q2F0ZWdvcnlDYWxsYmFja3MuY2xlYXIoKTtcbiAgICB0aGlzLmZseW91dEJ1dHRvbkNhbGxiYWNrcy5jbGVhcigpO1xuXG4gICAgaWYgKCF0aGlzLm9wdGlvbnMucGFyZW50V29ya3NwYWNlKSB7XG4gICAgICAvLyBUb3AtbW9zdCB3b3Jrc3BhY2UuICBEaXNwb3NlIG9mIHRoZSBkaXYgdGhhdCB0aGVcbiAgICAgIC8vIFNWRyBpcyBpbmplY3RlZCBpbnRvIChpLmUuIGluamVjdGlvbkRpdikuXG4gICAgICBjb25zdCBwYXJlbnRTdmcgPSB0aGlzLmdldFBhcmVudFN2ZygpO1xuICAgICAgaWYgKHBhcmVudFN2ZyAmJiBwYXJlbnRTdmcucGFyZW50Tm9kZSkge1xuICAgICAgICBkb20ucmVtb3ZlTm9kZShwYXJlbnRTdmcucGFyZW50Tm9kZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLnJlc2l6ZUhhbmRsZXJXcmFwcGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLnJlc2l6ZUhhbmRsZXJXcmFwcGVyKTtcbiAgICAgIHRoaXMucmVzaXplSGFuZGxlcldyYXBwZXIgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSB0cmFzaGNhbi5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGRUcmFzaGNhbigpIHtcbiAgICB0aGlzLnRyYXNoY2FuID0gV29ya3NwYWNlU3ZnLm5ld1RyYXNoY2FuKHRoaXMpO1xuICAgIGNvbnN0IHN2Z1RyYXNoY2FuID0gdGhpcy50cmFzaGNhbi5jcmVhdGVEb20oKTtcbiAgICB0aGlzLnN2Z0dyb3VwXy5pbnNlcnRCZWZvcmUoc3ZnVHJhc2hjYW4sIHRoaXMuc3ZnQmxvY2tDYW52YXNfKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gX3dvcmtzcGFjZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBuZXdUcmFzaGNhbihfd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpOiBUcmFzaGNhbiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnVGhlIGltcGxlbWVudGF0aW9uIG9mIG5ld1RyYXNoY2FuIHNob3VsZCBiZSAnICtcbiAgICAgICAgJ21vbmtleS1wYXRjaGVkIGluIGJ5IGJsb2NrbHkudHMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgem9vbSBjb250cm9scy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGRab29tQ29udHJvbHMoKSB7XG4gICAgdGhpcy56b29tQ29udHJvbHNfID0gbmV3IFpvb21Db250cm9scyh0aGlzKTtcbiAgICBjb25zdCBzdmdab29tQ29udHJvbHMgPSB0aGlzLnpvb21Db250cm9sc18uY3JlYXRlRG9tKCk7XG4gICAgdGhpcy5zdmdHcm91cF8uYXBwZW5kQ2hpbGQoc3ZnWm9vbUNvbnRyb2xzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBmbHlvdXQgZWxlbWVudCBpbiBhbiBlbGVtZW50IHdpdGggdGhlIGdpdmVuIHRhZyBuYW1lLlxuICAgKlxuICAgKiBAcGFyYW0gdGFnTmFtZSBXaGF0IHR5cGUgb2YgdGFnIHRoZSBmbHlvdXQgYmVsb25ncyBpbi5cbiAgICogQHJldHVybnMgVGhlIGVsZW1lbnQgY29udGFpbmluZyB0aGUgZmx5b3V0IERPTS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGRGbHlvdXQodGFnTmFtZTogc3RyaW5nfFN2ZzxTVkdTVkdFbGVtZW50PnxTdmc8U1ZHR0VsZW1lbnQ+KTogRWxlbWVudCB7XG4gICAgY29uc3Qgd29ya3NwYWNlT3B0aW9ucyA9IG5ldyBPcHRpb25zKCh7XG4gICAgICAncGFyZW50V29ya3NwYWNlJzogdGhpcyxcbiAgICAgICdydGwnOiB0aGlzLlJUTCxcbiAgICAgICdvbmVCYXNlZEluZGV4JzogdGhpcy5vcHRpb25zLm9uZUJhc2VkSW5kZXgsXG4gICAgICAnaG9yaXpvbnRhbExheW91dCc6IHRoaXMuaG9yaXpvbnRhbExheW91dCxcbiAgICAgICdyZW5kZXJlcic6IHRoaXMub3B0aW9ucy5yZW5kZXJlcixcbiAgICAgICdyZW5kZXJlck92ZXJyaWRlcyc6IHRoaXMub3B0aW9ucy5yZW5kZXJlck92ZXJyaWRlcyxcbiAgICAgICdtb3ZlJzoge1xuICAgICAgICAnc2Nyb2xsYmFycyc6IHRydWUsXG4gICAgICB9LFxuICAgIH0gYXMgQmxvY2tseU9wdGlvbnMpKTtcbiAgICB3b3Jrc3BhY2VPcHRpb25zLnRvb2xib3hQb3NpdGlvbiA9IHRoaXMub3B0aW9ucy50b29sYm94UG9zaXRpb247XG4gICAgaWYgKHRoaXMuaG9yaXpvbnRhbExheW91dCkge1xuICAgICAgY29uc3QgSG9yaXpvbnRhbEZseW91dCA9IHJlZ2lzdHJ5LmdldENsYXNzRnJvbU9wdGlvbnMoXG4gICAgICAgICAgcmVnaXN0cnkuVHlwZS5GTFlPVVRTX0hPUklaT05UQUxfVE9PTEJPWCwgdGhpcy5vcHRpb25zLCB0cnVlKTtcbiAgICAgIHRoaXMuZmx5b3V0ID0gbmV3IEhvcml6b250YWxGbHlvdXQhKHdvcmtzcGFjZU9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBWZXJ0aWNhbEZseW91dCA9IHJlZ2lzdHJ5LmdldENsYXNzRnJvbU9wdGlvbnMoXG4gICAgICAgICAgcmVnaXN0cnkuVHlwZS5GTFlPVVRTX1ZFUlRJQ0FMX1RPT0xCT1gsIHRoaXMub3B0aW9ucywgdHJ1ZSk7XG4gICAgICB0aGlzLmZseW91dCA9IG5ldyBWZXJ0aWNhbEZseW91dCEod29ya3NwYWNlT3B0aW9ucyk7XG4gICAgfVxuICAgIHRoaXMuZmx5b3V0LmF1dG9DbG9zZSA9IGZhbHNlO1xuICAgIHRoaXMuZmx5b3V0LmdldFdvcmtzcGFjZSgpLnNldFZpc2libGUodHJ1ZSk7XG5cbiAgICAvLyBSZXR1cm4gdGhlIGVsZW1lbnQgc28gdGhhdCBjYWxsZXJzIGNhbiBwbGFjZSBpdCBpbiB0aGVpciBkZXNpcmVkXG4gICAgLy8gc3BvdCBpbiB0aGUgRE9NLiAgRm9yIGV4YW1wbGUsIG11dGF0b3IgZmx5b3V0cyBkbyBub3QgZ28gaW4gdGhlIHNhbWVcbiAgICAvLyBwbGFjZSBhcyBtYWluIHdvcmtzcGFjZSBmbHlvdXRzLlxuICAgIHJldHVybiB0aGlzLmZseW91dC5jcmVhdGVEb20odGFnTmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0dGVyIGZvciB0aGUgZmx5b3V0IGFzc29jaWF0ZWQgd2l0aCB0aGlzIHdvcmtzcGFjZS4gIFRoaXMgZmx5b3V0IG1heSBiZVxuICAgKiBvd25lZCBieSBlaXRoZXIgdGhlIHRvb2xib3ggb3IgdGhlIHdvcmtzcGFjZSwgZGVwZW5kaW5nIG9uIHRvb2xib3hcbiAgICogY29uZmlndXJhdGlvbi4gIEl0IHdpbGwgYmUgbnVsbCBpZiB0aGVyZSBpcyBubyBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfb3duIFdoZXRoZXIgdG8gb25seSByZXR1cm4gdGhlIHdvcmtzcGFjZSdzIG93biBmbHlvdXQuXG4gICAqIEByZXR1cm5zIFRoZSBmbHlvdXQgb24gdGhpcyB3b3Jrc3BhY2UuXG4gICAqL1xuICBnZXRGbHlvdXQob3B0X293bj86IGJvb2xlYW4pOiBJRmx5b3V0fG51bGwge1xuICAgIGlmICh0aGlzLmZseW91dCB8fCBvcHRfb3duKSB7XG4gICAgICByZXR1cm4gdGhpcy5mbHlvdXQ7XG4gICAgfVxuICAgIGlmICh0aGlzLnRvb2xib3hfKSB7XG4gICAgICByZXR1cm4gdGhpcy50b29sYm94Xy5nZXRGbHlvdXQoKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0dGVyIGZvciB0aGUgdG9vbGJveCBhc3NvY2lhdGVkIHdpdGggdGhpcyB3b3Jrc3BhY2UsIGlmIG9uZSBleGlzdHMuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0b29sYm94IG9uIHRoaXMgd29ya3NwYWNlLlxuICAgKi9cbiAgZ2V0VG9vbGJveCgpOiBJVG9vbGJveHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy50b29sYm94XztcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgaXRlbXMgdGhhdCB1c2Ugc2NyZWVuIGNvb3JkaW5hdGUgY2FsY3VsYXRpb25zXG4gICAqIGJlY2F1c2Ugc29tZXRoaW5nIGhhcyBjaGFuZ2VkIChlLmcuIHNjcm9sbCBwb3NpdGlvbiwgd2luZG93IHNpemUpLlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVTY3JlZW5DYWxjdWxhdGlvbnNfKCkge1xuICAgIHRoaXMudXBkYXRlSW52ZXJzZVNjcmVlbkNUTSgpO1xuICAgIHRoaXMucmVjb3JkRHJhZ1RhcmdldHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiBlbmFibGVkLCByZXNpemUgdGhlIHBhcnRzIG9mIHRoZSB3b3Jrc3BhY2UgdGhhdCBjaGFuZ2Ugd2hlbiB0aGVcbiAgICogd29ya3NwYWNlIGNvbnRlbnRzIChlLmcuIGJsb2NrIHBvc2l0aW9ucykgY2hhbmdlLiAgVGhpcyB3aWxsIGFsc28gc2Nyb2xsXG4gICAqIHRoZSB3b3Jrc3BhY2UgY29udGVudHMgaWYgbmVlZGVkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlc2l6ZUNvbnRlbnRzKCkge1xuICAgIGlmICghdGhpcy5yZXNpemVzRW5hYmxlZCB8fCAhdGhpcy5yZW5kZXJlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5zY3JvbGxiYXIpIHtcbiAgICAgIHRoaXMuc2Nyb2xsYmFyLnJlc2l6ZSgpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUludmVyc2VTY3JlZW5DVE0oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemUgYW5kIHJlcG9zaXRpb24gYWxsIG9mIHRoZSB3b3Jrc3BhY2UgY2hyb21lICh0b29sYm94LFxuICAgKiB0cmFzaCwgc2Nyb2xsYmFycyBldGMuKVxuICAgKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBzb21ldGhpbmcgY2hhbmdlcyB0aGF0XG4gICAqIHJlcXVpcmVzIHJlY2FsY3VsYXRpbmcgZGltZW5zaW9ucyBhbmQgcG9zaXRpb25zIG9mIHRoZVxuICAgKiB0cmFzaCwgem9vbSwgdG9vbGJveCwgZXRjLiAoZS5nLiB3aW5kb3cgcmVzaXplKS5cbiAgICovXG4gIHJlc2l6ZSgpIHtcbiAgICBpZiAodGhpcy50b29sYm94Xykge1xuICAgICAgdGhpcy50b29sYm94Xy5wb3NpdGlvbigpO1xuICAgIH1cbiAgICBpZiAodGhpcy5mbHlvdXQpIHtcbiAgICAgIHRoaXMuZmx5b3V0LnBvc2l0aW9uKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcG9zaXRpb25hYmxlcyA9IHRoaXMuY29tcG9uZW50TWFuYWdlci5nZXRDb21wb25lbnRzKFxuICAgICAgICBDb21wb25lbnRNYW5hZ2VyLkNhcGFiaWxpdHkuUE9TSVRJT05BQkxFLCB0cnVlKTtcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRNZXRyaWNzTWFuYWdlcigpLmdldFVpTWV0cmljcygpO1xuICAgIGNvbnN0IHNhdmVkUG9zaXRpb25zID0gW107XG4gICAgZm9yIChsZXQgaSA9IDAsIHBvc2l0aW9uYWJsZTsgcG9zaXRpb25hYmxlID0gcG9zaXRpb25hYmxlc1tpXTsgaSsrKSB7XG4gICAgICBwb3NpdGlvbmFibGUucG9zaXRpb24obWV0cmljcywgc2F2ZWRQb3NpdGlvbnMpO1xuICAgICAgY29uc3QgYm91bmRpbmdSZWN0ID0gcG9zaXRpb25hYmxlLmdldEJvdW5kaW5nUmVjdGFuZ2xlKCk7XG4gICAgICBpZiAoYm91bmRpbmdSZWN0KSB7XG4gICAgICAgIHNhdmVkUG9zaXRpb25zLnB1c2goYm91bmRpbmdSZWN0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5zY3JvbGxiYXIpIHtcbiAgICAgIHRoaXMuc2Nyb2xsYmFyLnJlc2l6ZSgpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZVNjcmVlbkNhbGN1bGF0aW9uc18oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemVzIGFuZCByZXBvc2l0aW9ucyB3b3Jrc3BhY2UgY2hyb21lIGlmIHRoZSBwYWdlIGhhcyBhIG5ld1xuICAgKiBzY3JvbGwgcG9zaXRpb24uXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdXBkYXRlU2NyZWVuQ2FsY3VsYXRpb25zSWZTY3JvbGxlZCgpIHtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBpbmRlbnQgKi9cbiAgICBjb25zdCBjdXJyU2Nyb2xsID0gc3ZnTWF0aC5nZXREb2N1bWVudFNjcm9sbCgpO1xuICAgIGlmICghQ29vcmRpbmF0ZS5lcXVhbHModGhpcy5sYXN0UmVjb3JkZWRQYWdlU2Nyb2xsLCBjdXJyU2Nyb2xsKSkge1xuICAgICAgdGhpcy5sYXN0UmVjb3JkZWRQYWdlU2Nyb2xsID0gY3VyclNjcm9sbDtcbiAgICAgIHRoaXMudXBkYXRlU2NyZWVuQ2FsY3VsYXRpb25zXygpO1xuICAgIH1cbiAgfVxuICAvKiBlc2xpbnQtZW5hYmxlIGluZGVudCAqL1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIFNWRyBlbGVtZW50IHRoYXQgZm9ybXMgdGhlIGRyYXdpbmcgc3VyZmFjZS5cbiAgICpcbiAgICogQHJldHVybnMgU1ZHIGdyb3VwIGVsZW1lbnQuXG4gICAqL1xuICBnZXRDYW52YXMoKTogU1ZHR0VsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLnN2Z0Jsb2NrQ2FudmFzXyBhcyBTVkdHRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWNoZXMgdGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIHdvcmtzcGFjZSdzIHBhcmVudCBTVkcgZWxlbWVudCBmb3IgdXNlXG4gICAqIHdpdGggZ2V0U3ZnTWV0cmljcy5cbiAgICpcbiAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcGFyZW50IFNWRyBlbGVtZW50LlxuICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHBhcmVudCBTVkcgZWxlbWVudFxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldENhY2hlZFBhcmVudFN2Z1NpemUod2lkdGg6IG51bWJlcnxudWxsLCBoZWlnaHQ6IG51bWJlcnxudWxsKSB7XG4gICAgY29uc3Qgc3ZnID0gdGhpcy5nZXRQYXJlbnRTdmcoKTtcbiAgICBpZiAod2lkdGggIT0gbnVsbCkge1xuICAgICAgdGhpcy5jYWNoZWRQYXJlbnRTdmdTaXplLndpZHRoID0gd2lkdGg7XG4gICAgICAvLyBUaGlzIGlzIHNldCB0byBzdXBwb3J0IHRoZSBwdWJsaWMgKGJ1dCBkZXByZWNhdGVkKSBCbG9ja2x5LnN2Z1NpemVcbiAgICAgIC8vIG1ldGhvZC5cbiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ2RhdGEtY2FjaGVkLXdpZHRoJywgd2lkdGgudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGlmIChoZWlnaHQgIT0gbnVsbCkge1xuICAgICAgdGhpcy5jYWNoZWRQYXJlbnRTdmdTaXplLmhlaWdodCA9IGhlaWdodDtcbiAgICAgIC8vIFRoaXMgaXMgc2V0IHRvIHN1cHBvcnQgdGhlIHB1YmxpYyAoYnV0IGRlcHJlY2F0ZWQpIEJsb2NrbHkuc3ZnU2l6ZVxuICAgICAgLy8gbWV0aG9kLlxuICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnZGF0YS1jYWNoZWQtaGVpZ2h0JywgaGVpZ2h0LnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIFNWRyBlbGVtZW50IHRoYXQgZm9ybXMgdGhlIGJ1YmJsZSBzdXJmYWNlLlxuICAgKlxuICAgKiBAcmV0dXJucyBTVkcgZ3JvdXAgZWxlbWVudC5cbiAgICovXG4gIGdldEJ1YmJsZUNhbnZhcygpOiBTVkdHRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuc3ZnQnViYmxlQ2FudmFzXyBhcyBTVkdHRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIFNWRyBlbGVtZW50IHRoYXQgY29udGFpbnMgdGhpcyB3b3Jrc3BhY2UuXG4gICAqIE5vdGU6IFdlIGFzc3VtZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGFmdGVyIHRoZSB3b3Jrc3BhY2UgaGFzIGJlZW4gaW5qZWN0ZWRcbiAgICogaW50byB0aGUgRE9NLlxuICAgKlxuICAgKiBAcmV0dXJucyBTVkcgZWxlbWVudC5cbiAgICovXG4gIGdldFBhcmVudFN2ZygpOiBTVkdTVkdFbGVtZW50IHtcbiAgICBpZiAoIXRoaXMuY2FjaGVkUGFyZW50U3ZnKSB7XG4gICAgICBsZXQgZWxlbWVudCA9IHRoaXMuc3ZnR3JvdXBfO1xuICAgICAgd2hpbGUgKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQudGFnTmFtZSA9PT0gJ3N2ZycpIHtcbiAgICAgICAgICB0aGlzLmNhY2hlZFBhcmVudFN2ZyA9IGVsZW1lbnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSBhcyBTVkdTVkdFbGVtZW50O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jYWNoZWRQYXJlbnRTdmcgYXMgU1ZHU1ZHRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaXJlcyBhIHZpZXdwb3J0IGV2ZW50IGlmIGV2ZW50cyBhcmUgZW5hYmxlZCBhbmQgdGhlcmUgaXMgYSBjaGFuZ2UgaW5cbiAgICogdmlld3BvcnQgdmFsdWVzLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1heWJlRmlyZVZpZXdwb3J0Q2hhbmdlRXZlbnQoKSB7XG4gICAgaWYgKCFldmVudFV0aWxzLmlzRW5hYmxlZCgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTtcbiAgICBjb25zdCB0b3AgPSAtdGhpcy5zY3JvbGxZO1xuICAgIGNvbnN0IGxlZnQgPSAtdGhpcy5zY3JvbGxYO1xuICAgIGlmIChzY2FsZSA9PT0gdGhpcy5vbGRTY2FsZSAmJiBNYXRoLmFicyh0b3AgLSB0aGlzLm9sZFRvcCkgPCAxICYmXG4gICAgICAgIE1hdGguYWJzKGxlZnQgLSB0aGlzLm9sZExlZnQpIDwgMSkge1xuICAgICAgLy8gSWdub3JlIHN1Yi1waXhlbCBjaGFuZ2VzIGluIHRvcCBhbmQgbGVmdC4gRHVlIHRvICM0MTkyIHRoZXJlIGFyZSBhIGxvdFxuICAgICAgLy8gb2YgbmVnbGlnaWJsZSBjaGFuZ2VzIGluIHZpZXdwb3J0IHRvcC9sZWZ0LlxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBldmVudCA9IG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5WSUVXUE9SVF9DSEFOR0UpKShcbiAgICAgICAgdG9wLCBsZWZ0LCBzY2FsZSwgdGhpcy5pZCwgdGhpcy5vbGRTY2FsZSk7XG4gICAgdGhpcy5vbGRTY2FsZSA9IHNjYWxlO1xuICAgIHRoaXMub2xkVG9wID0gdG9wO1xuICAgIHRoaXMub2xkTGVmdCA9IGxlZnQ7XG4gICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2xhdGUgdGhpcyB3b3Jrc3BhY2UgdG8gbmV3IGNvb3JkaW5hdGVzLlxuICAgKlxuICAgKiBAcGFyYW0geCBIb3Jpem9udGFsIHRyYW5zbGF0aW9uLCBpbiBwaXhlbCB1bml0cyByZWxhdGl2ZSB0byB0aGUgdG9wIGxlZnQgb2ZcbiAgICogICAgIHRoZSBCbG9ja2x5IGRpdi5cbiAgICogQHBhcmFtIHkgVmVydGljYWwgdHJhbnNsYXRpb24sIGluIHBpeGVsIHVuaXRzIHJlbGF0aXZlIHRvIHRoZSB0b3AgbGVmdCBvZlxuICAgKiAgICAgdGhlIEJsb2NrbHkgZGl2LlxuICAgKi9cbiAgdHJhbnNsYXRlKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMudXNlV29ya3NwYWNlRHJhZ1N1cmZhY2UgJiYgdGhpcy5pc0RyYWdTdXJmYWNlQWN0aXZlKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZURyYWdTdXJmYWNlPy50cmFuc2xhdGVTdXJmYWNlKHgsIHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0cmFuc2xhdGlvbiA9ICd0cmFuc2xhdGUoJyArIHggKyAnLCcgKyB5ICsgJykgJyArXG4gICAgICAgICAgJ3NjYWxlKCcgKyB0aGlzLnNjYWxlICsgJyknO1xuICAgICAgdGhpcy5zdmdCbG9ja0NhbnZhc18uc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCB0cmFuc2xhdGlvbik7XG4gICAgICB0aGlzLnN2Z0J1YmJsZUNhbnZhc18uc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCB0cmFuc2xhdGlvbik7XG4gICAgfVxuICAgIC8vIE5vdyB1cGRhdGUgdGhlIGJsb2NrIGRyYWcgc3VyZmFjZSBpZiB3ZSdyZSB1c2luZyBvbmUuXG4gICAgaWYgKHRoaXMuYmxvY2tEcmFnU3VyZmFjZSkge1xuICAgICAgdGhpcy5ibG9ja0RyYWdTdXJmYWNlLnRyYW5zbGF0ZUFuZFNjYWxlR3JvdXAoeCwgeSwgdGhpcy5zY2FsZSk7XG4gICAgfVxuICAgIC8vIEFuZCB1cGRhdGUgdGhlIGdyaWQgaWYgd2UncmUgdXNpbmcgb25lLlxuICAgIGlmICh0aGlzLmdyaWQpIHtcbiAgICAgIHRoaXMuZ3JpZC5tb3ZlVG8oeCwgeSk7XG4gICAgfVxuXG4gICAgdGhpcy5tYXliZUZpcmVWaWV3cG9ydENoYW5nZUV2ZW50KCk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIGF0IHRoZSBlbmQgb2YgYSB3b3Jrc3BhY2UgZHJhZyB0byB0YWtlIHRoZSBjb250ZW50c1xuICAgKiBvdXQgb2YgdGhlIGRyYWcgc3VyZmFjZSBhbmQgcHV0IHRoZW0gYmFjayBpbnRvIHRoZSB3b3Jrc3BhY2UgU1ZHLlxuICAgKiBEb2VzIG5vdGhpbmcgaWYgdGhlIHdvcmtzcGFjZSBkcmFnIHN1cmZhY2UgaXMgbm90IGVuYWJsZWQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVzZXREcmFnU3VyZmFjZSgpIHtcbiAgICAvLyBEb24ndCBkbyBhbnl0aGluZyBpZiB3ZSBhcmVuJ3QgdXNpbmcgYSBkcmFnIHN1cmZhY2UuXG4gICAgaWYgKCF0aGlzLnVzZVdvcmtzcGFjZURyYWdTdXJmYWNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0RyYWdTdXJmYWNlQWN0aXZlID0gZmFsc2U7XG5cbiAgICBjb25zdCB0cmFucyA9IHRoaXMud29ya3NwYWNlRHJhZ1N1cmZhY2UhLmdldFN1cmZhY2VUcmFuc2xhdGlvbigpO1xuICAgIHRoaXMud29ya3NwYWNlRHJhZ1N1cmZhY2UhLmNsZWFyQW5kSGlkZSh0aGlzLnN2Z0dyb3VwXyk7XG4gICAgY29uc3QgdHJhbnNsYXRpb24gPSAndHJhbnNsYXRlKCcgKyB0cmFucy54ICsgJywnICsgdHJhbnMueSArICcpICcgK1xuICAgICAgICAnc2NhbGUoJyArIHRoaXMuc2NhbGUgKyAnKSc7XG4gICAgdGhpcy5zdmdCbG9ja0NhbnZhc18uc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCB0cmFuc2xhdGlvbik7XG4gICAgdGhpcy5zdmdCdWJibGVDYW52YXNfLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgdHJhbnNsYXRpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgd29ya3NwYWNlIGRyYWcgdG8gbW92ZSBjb250ZW50cyBvZlxuICAgKiB0aGUgd29ya3NwYWNlIHRvIHRoZSBkcmFnIHN1cmZhY2UuXG4gICAqIERvZXMgbm90aGluZyBpZiB0aGUgZHJhZyBzdXJmYWNlIGlzIG5vdCBlbmFibGVkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldHVwRHJhZ1N1cmZhY2UoKSB7XG4gICAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgaWYgd2UgYXJlbid0IHVzaW5nIGEgZHJhZyBzdXJmYWNlLlxuICAgIGlmICghdGhpcy51c2VXb3Jrc3BhY2VEcmFnU3VyZmFjZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRoaXMgY2FuIGhhcHBlbiBpZiB0aGUgdXNlciBzdGFydHMgYSBkcmFnLCBtb3VzZXMgdXAgb3V0c2lkZSBvZiB0aGVcbiAgICAvLyBkb2N1bWVudCB3aGVyZSB0aGUgbW91c2V1cCBsaXN0ZW5lciBpcyByZWdpc3RlcmVkIChlLmcuIG91dHNpZGUgb2YgYW5cbiAgICAvLyBpZnJhbWUpIGFuZCB0aGVuIG1vdmVzIHRoZSBtb3VzZSBiYWNrIGluIHRoZSB3b3Jrc3BhY2UuICBPbiBtb2JpbGUgYW5kXG4gICAgLy8gZmYsIHdlIGdldCB0aGUgbW91c2V1cCBvdXRzaWRlIHRoZSBmcmFtZS4gT24gY2hyb21lIGFuZCBzYWZhcmkgZGVza3RvcCB3ZVxuICAgIC8vIGRvIG5vdC5cbiAgICBpZiAodGhpcy5pc0RyYWdTdXJmYWNlQWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0RyYWdTdXJmYWNlQWN0aXZlID0gdHJ1ZTtcblxuICAgIC8vIEZpZ3VyZSBvdXQgd2hlcmUgd2Ugd2FudCB0byBwdXQgdGhlIGNhbnZhcyBiYWNrLiAgVGhlIG9yZGVyXG4gICAgLy8gaW4gdGhlIGlzIGltcG9ydGFudCBiZWNhdXNlIHRoaW5ncyBhcmUgbGF5ZXJlZC5cbiAgICBjb25zdCBwcmV2aW91c0VsZW1lbnQgPSB0aGlzLnN2Z0Jsb2NrQ2FudmFzXy5wcmV2aW91c1NpYmxpbmcgYXMgRWxlbWVudDtcbiAgICBjb25zdCB3aWR0aCA9IHBhcnNlSW50KHRoaXMuZ2V0UGFyZW50U3ZnKCkuZ2V0QXR0cmlidXRlKCd3aWR0aCcpID8/ICcwJyk7XG4gICAgY29uc3QgaGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5nZXRQYXJlbnRTdmcoKS5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpID8/ICcwJyk7XG4gICAgY29uc3QgY29vcmQgPSBzdmdNYXRoLmdldFJlbGF0aXZlWFkodGhpcy5nZXRDYW52YXMoKSk7XG4gICAgdGhpcy53b3Jrc3BhY2VEcmFnU3VyZmFjZSEuc2V0Q29udGVudHNBbmRTaG93KFxuICAgICAgICB0aGlzLmdldENhbnZhcygpLCB0aGlzLmdldEJ1YmJsZUNhbnZhcygpLCBwcmV2aW91c0VsZW1lbnQsIHdpZHRoLFxuICAgICAgICBoZWlnaHQsIHRoaXMuc2NhbGUpO1xuICAgIHRoaXMud29ya3NwYWNlRHJhZ1N1cmZhY2UhLnRyYW5zbGF0ZVN1cmZhY2UoY29vcmQueCwgY29vcmQueSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZHJhZyBzdXJmYWNlIGJsb2NrcyBhcmUgbW92ZWQgdG8gd2hlbiBhIGRyYWcgaXMgc3RhcnRlZC5cbiAgICpcbiAgICogQHJldHVybnMgVGhpcyB3b3Jrc3BhY2UncyBibG9jayBkcmFnIHN1cmZhY2UsIGlmIG9uZSBpcyBpbiB1c2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0QmxvY2tEcmFnU3VyZmFjZSgpOiBCbG9ja0RyYWdTdXJmYWNlU3ZnfG51bGwge1xuICAgIHJldHVybiB0aGlzLmJsb2NrRHJhZ1N1cmZhY2U7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaG9yaXpvbnRhbCBvZmZzZXQgb2YgdGhlIHdvcmtzcGFjZS5cbiAgICogSW50ZW5kZWQgZm9yIExUUi9SVEwgY29tcGF0aWJpbGl0eSBpbiBYTUwuXG4gICAqXG4gICAqIEByZXR1cm5zIFdpZHRoLlxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0V2lkdGgoKTogbnVtYmVyIHtcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRNZXRyaWNzKCk7XG4gICAgcmV0dXJuIG1ldHJpY3MgPyBtZXRyaWNzLnZpZXdXaWR0aCAvIHRoaXMuc2NhbGUgOiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZXMgdGhlIHZpc2liaWxpdHkgb2YgdGhlIHdvcmtzcGFjZS5cbiAgICogQ3VycmVudGx5IG9ubHkgaW50ZW5kZWQgZm9yIG1haW4gd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gaXNWaXNpYmxlIFRydWUgaWYgd29ya3NwYWNlIHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKi9cbiAgc2V0VmlzaWJsZShpc1Zpc2libGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzVmlzaWJsZV8gPSBpc1Zpc2libGU7XG4gICAgaWYgKCF0aGlzLnN2Z0dyb3VwXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRlbGwgdGhlIHNjcm9sbGJhciB3aGV0aGVyIGl0cyBjb250YWluZXIgaXMgdmlzaWJsZSBzbyBpdCBjYW5cbiAgICAvLyB0ZWxsIHdoZW4gdG8gaGlkZSBpdHNlbGYuXG4gICAgaWYgKHRoaXMuc2Nyb2xsYmFyKSB7XG4gICAgICB0aGlzLnNjcm9sbGJhci5zZXRDb250YWluZXJWaXNpYmxlKGlzVmlzaWJsZSk7XG4gICAgfVxuXG4gICAgLy8gVGVsbCB0aGUgZmx5b3V0IHdoZXRoZXIgaXRzIGNvbnRhaW5lciBpcyB2aXNpYmxlIHNvIGl0IGNhblxuICAgIC8vIHRlbGwgd2hlbiB0byBoaWRlIGl0c2VsZi5cbiAgICBpZiAodGhpcy5nZXRGbHlvdXQoKSkge1xuICAgICAgdGhpcy5nZXRGbHlvdXQoKSEuc2V0Q29udGFpbmVyVmlzaWJsZShpc1Zpc2libGUpO1xuICAgIH1cblxuICAgIHRoaXMuZ2V0UGFyZW50U3ZnKCkuc3R5bGUuZGlzcGxheSA9IGlzVmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgaWYgKHRoaXMudG9vbGJveF8pIHtcbiAgICAgIC8vIEN1cnJlbnRseSBkb2VzIG5vdCBzdXBwb3J0IHRvb2xib3hlcyBpbiBtdXRhdG9ycy5cbiAgICAgIHRoaXMudG9vbGJveF8uc2V0VmlzaWJsZShpc1Zpc2libGUpO1xuICAgIH1cbiAgICBpZiAoaXNWaXNpYmxlKSB7XG4gICAgICBjb25zdCBibG9ja3MgPSB0aGlzLmdldEFsbEJsb2NrcyhmYWxzZSk7XG4gICAgICAvLyBUZWxsIGVhY2ggYmxvY2sgb24gdGhlIHdvcmtzcGFjZSB0byBtYXJrIGl0cyBmaWVsZHMgYXMgZGlydHkuXG4gICAgICBmb3IgKGxldCBpID0gYmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGJsb2Nrc1tpXS5tYXJrRGlydHkoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIGlmICh0aGlzLnRvb2xib3hfKSB7XG4gICAgICAgIHRoaXMudG9vbGJveF8ucG9zaXRpb24oKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oaWRlQ2hhZmYodHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqIFJlbmRlciBhbGwgYmxvY2tzIGluIHdvcmtzcGFjZS4gKi9cbiAgcmVuZGVyKCkge1xuICAgIC8vIEdlbmVyYXRlIGxpc3Qgb2YgYWxsIGJsb2Nrcy5cbiAgICBjb25zdCBibG9ja3MgPSB0aGlzLmdldEFsbEJsb2NrcyhmYWxzZSk7XG4gICAgLy8gUmVuZGVyIGVhY2ggYmxvY2suXG4gICAgZm9yIChsZXQgaSA9IGJsb2Nrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgYmxvY2tzW2ldLnJlbmRlcihmYWxzZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVudEdlc3R1cmVfKSB7XG4gICAgICBjb25zdCBpbUxpc3QgPSB0aGlzLmN1cnJlbnRHZXN0dXJlXy5nZXRJbnNlcnRpb25NYXJrZXJzKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpbUxpc3RbaV0ucmVuZGVyKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm1hcmtlck1hbmFnZXIudXBkYXRlTWFya2VycygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZ2hsaWdodCBvciB1bmhpZ2hsaWdodCBhIGJsb2NrIGluIHRoZSB3b3Jrc3BhY2UuICBCbG9jayBoaWdobGlnaHRpbmcgaXNcbiAgICogb2Z0ZW4gdXNlZCB0byB2aXN1YWxseSBtYXJrIGJsb2NrcyBjdXJyZW50bHkgYmVpbmcgZXhlY3V0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBvZiBibG9jayB0byBoaWdobGlnaHQvdW5oaWdobGlnaHQsIG9yIG51bGwgZm9yIG5vIGJsb2NrICh1c2VkXG4gICAqICAgICB0byB1bmhpZ2hsaWdodCBhbGwgYmxvY2tzKS5cbiAgICogQHBhcmFtIG9wdF9zdGF0ZSBJZiB1bmRlZmluZWQsIGhpZ2hsaWdodCBzcGVjaWZpZWQgYmxvY2sgYW5kIGF1dG9tYXRpY2FsbHlcbiAgICogICAgIHVuaGlnaGxpZ2h0IGFsbCBvdGhlcnMuICBJZiB0cnVlIG9yIGZhbHNlLCBtYW51YWxseVxuICAgKiAgICAgaGlnaGxpZ2h0L3VuaGlnaGxpZ2h0IHRoZSBzcGVjaWZpZWQgYmxvY2suXG4gICAqL1xuICBoaWdobGlnaHRCbG9jayhpZDogc3RyaW5nfG51bGwsIG9wdF9zdGF0ZT86IGJvb2xlYW4pIHtcbiAgICBpZiAob3B0X3N0YXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIFVuaGlnaGxpZ2h0IGFsbCBibG9ja3MuXG4gICAgICBmb3IgKGxldCBpID0gMCwgYmxvY2s7IGJsb2NrID0gdGhpcy5oaWdobGlnaHRlZEJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgICAgIGJsb2NrLnNldEhpZ2hsaWdodGVkKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRCbG9ja3MubGVuZ3RoID0gMDtcbiAgICB9XG4gICAgLy8gSGlnaGxpZ2h0L3VuaGlnaGxpZ2h0IHRoZSBzcGVjaWZpZWQgYmxvY2suXG4gICAgY29uc3QgYmxvY2sgPSBpZCA/IHRoaXMuZ2V0QmxvY2tCeUlkKGlkKSA6IG51bGw7XG4gICAgaWYgKGJsb2NrKSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IG9wdF9zdGF0ZSA9PT0gdW5kZWZpbmVkIHx8IG9wdF9zdGF0ZTtcbiAgICAgIC8vIFVzaW5nIFNldCBoZXJlIHdvdWxkIGJlIGdyZWF0LCBidXQgYXQgdGhlIGNvc3Qgb2YgSUUxMCBzdXBwb3J0LlxuICAgICAgaWYgKCFzdGF0ZSkge1xuICAgICAgICBhcnJheVV0aWxzLnJlbW92ZUVsZW0odGhpcy5oaWdobGlnaHRlZEJsb2NrcywgYmxvY2spO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmhpZ2hsaWdodGVkQmxvY2tzLmluZGV4T2YoYmxvY2spID09PSAtMSkge1xuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkQmxvY2tzLnB1c2goYmxvY2spO1xuICAgICAgfVxuICAgICAgYmxvY2suc2V0SGlnaGxpZ2h0ZWQoc3RhdGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQYXN0ZXMgdGhlIHByb3ZpZGVkIGJsb2NrIG9yIHdvcmtzcGFjZSBjb21tZW50IG9udG8gdGhlIHdvcmtzcGFjZS5cbiAgICogRG9lcyBub3QgY2hlY2sgd2hldGhlciB0aGVyZSBpcyByZW1haW5pbmcgY2FwYWNpdHkgZm9yIHRoZSBvYmplY3QsIHRoYXRcbiAgICogc2hvdWxkIGJlIGRvbmUgYmVmb3JlIGNhbGxpbmcgdGhpcyBtZXRob2QuXG4gICAqXG4gICAqIEBwYXJhbSBzdGF0ZSBUaGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIHRoaW5nIHRvIHBhc3RlLlxuICAgKiBAcmV0dXJucyBUaGUgcGFzdGVkIHRoaW5nLCBvciBudWxsIGlmIHRoZSBwYXN0ZSB3YXMgbm90IHN1Y2Nlc3NmdWwuXG4gICAqL1xuICBwYXN0ZShzdGF0ZTogQW55RHVyaW5nTWlncmF0aW9ufEVsZW1lbnR8RG9jdW1lbnRGcmFnbWVudCk6IElDb3B5YWJsZXxudWxsIHtcbiAgICBpZiAoIXRoaXMucmVuZGVyZWQgfHwgIXN0YXRlWyd0eXBlJ10gJiYgIXN0YXRlWyd0YWdOYW1lJ10pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5jdXJyZW50R2VzdHVyZV8pIHsgIC8vIERyYWdnaW5nIHdoaWxlIHBhc3Rpbmc/ICBOby5cbiAgICAgIHRoaXMuY3VycmVudEdlc3R1cmVfLmNhbmNlbCgpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4aXN0aW5nR3JvdXAgPSBldmVudFV0aWxzLmdldEdyb3VwKCk7XG4gICAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgIH1cblxuICAgIGxldCBwYXN0ZWRUaGluZztcbiAgICAvLyBDaGVja3MgaWYgdGhpcyBpcyBKU09OLiBKU09OIGhhcyBhIHR5cGUgcHJvcGVydHksIHdoaWxlIGVsZW1lbnRzIGRvbid0LlxuICAgIGlmIChzdGF0ZVsndHlwZSddKSB7XG4gICAgICBwYXN0ZWRUaGluZyA9IHRoaXMucGFzdGVCbG9ja18obnVsbCwgc3RhdGUgYXMgYmxvY2tzLlN0YXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgeG1sQmxvY2sgPSBzdGF0ZSBhcyBFbGVtZW50O1xuICAgICAgaWYgKHhtbEJsb2NrLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2NvbW1lbnQnKSB7XG4gICAgICAgIHBhc3RlZFRoaW5nID0gdGhpcy5wYXN0ZVdvcmtzcGFjZUNvbW1lbnRfKHhtbEJsb2NrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhc3RlZFRoaW5nID0gdGhpcy5wYXN0ZUJsb2NrXyh4bWxCbG9jaywgbnVsbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZXZlbnRVdGlscy5zZXRHcm91cChleGlzdGluZ0dyb3VwKTtcbiAgICByZXR1cm4gcGFzdGVkVGhpbmc7XG4gIH1cblxuICAvKipcbiAgICogUGFzdGUgdGhlIHByb3ZpZGVkIGJsb2NrIG9udG8gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHhtbEJsb2NrIFhNTCBibG9jayBlbGVtZW50LlxuICAgKiBAcGFyYW0ganNvbkJsb2NrIEpTT04gYmxvY2sgcmVwcmVzZW50YXRpb24uXG4gICAqIEByZXR1cm5zIFRoZSBwYXN0ZWQgYmxvY2suXG4gICAqL1xuICBwcml2YXRlIHBhc3RlQmxvY2tfKHhtbEJsb2NrOiBFbGVtZW50fG51bGwsIGpzb25CbG9jazogYmxvY2tzLlN0YXRlfG51bGwpOlxuICAgICAgQmxvY2tTdmcge1xuICAgIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuICAgIGxldCBibG9jazogQmxvY2tTdmc7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBibG9ja1ggPSAwO1xuICAgICAgbGV0IGJsb2NrWSA9IDA7XG4gICAgICBpZiAoeG1sQmxvY2spIHtcbiAgICAgICAgYmxvY2sgPSBYbWwuZG9tVG9CbG9jayh4bWxCbG9jaywgdGhpcykgYXMgQmxvY2tTdmc7XG4gICAgICAgIGJsb2NrWCA9IHBhcnNlSW50KHhtbEJsb2NrLmdldEF0dHJpYnV0ZSgneCcpID8/ICcwJyk7XG4gICAgICAgIGlmICh0aGlzLlJUTCkge1xuICAgICAgICAgIGJsb2NrWCA9IC1ibG9ja1g7XG4gICAgICAgIH1cbiAgICAgICAgYmxvY2tZID0gcGFyc2VJbnQoeG1sQmxvY2suZ2V0QXR0cmlidXRlKCd5JykgPz8gJzAnKTtcbiAgICAgIH0gZWxzZSBpZiAoanNvbkJsb2NrKSB7XG4gICAgICAgIGJsb2NrID0gYmxvY2tzLmFwcGVuZChqc29uQmxvY2ssIHRoaXMpIGFzIEJsb2NrU3ZnO1xuICAgICAgICBibG9ja1ggPSBqc29uQmxvY2tbJ3gnXSB8fCAxMDtcbiAgICAgICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICAgICAgYmxvY2tYID0gdGhpcy5nZXRXaWR0aCgpIC0gYmxvY2tYO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrWSA9IGpzb25CbG9ja1sneSddIHx8IDEwO1xuICAgICAgfVxuXG4gICAgICAvLyBNb3ZlIHRoZSBkdXBsaWNhdGUgdG8gb3JpZ2luYWwgcG9zaXRpb24uXG4gICAgICBpZiAoIWlzTmFOKGJsb2NrWCkgJiYgIWlzTmFOKGJsb2NrWSkpIHtcbiAgICAgICAgLy8gT2Zmc2V0IGJsb2NrIHVudGlsIG5vdCBjbG9iYmVyaW5nIGFub3RoZXIgYmxvY2sgYW5kIG5vdCBpbiBjb25uZWN0aW9uXG4gICAgICAgIC8vIGRpc3RhbmNlIHdpdGggbmVpZ2hib3VyaW5nIGJsb2Nrcy5cbiAgICAgICAgbGV0IGNvbGxpZGU7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICBjb2xsaWRlID0gZmFsc2U7XG4gICAgICAgICAgY29uc3QgYWxsQmxvY2tzID0gdGhpcy5nZXRBbGxCbG9ja3MoZmFsc2UpO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBvdGhlckJsb2NrOyBvdGhlckJsb2NrID0gYWxsQmxvY2tzW2ldOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG90aGVyWFkgPSBvdGhlckJsb2NrLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyhibG9ja1ggLSBvdGhlclhZLngpIDw9IDEgJiZcbiAgICAgICAgICAgICAgICBNYXRoLmFicyhibG9ja1kgLSBvdGhlclhZLnkpIDw9IDEpIHtcbiAgICAgICAgICAgICAgY29sbGlkZSA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbGxpZGUpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBibG9ja3MgaW4gc25hcCByYW5nZSB0byBhbnkgb2YgaXRzIGNvbm5lY3Rpb25zLlxuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbnMgPSBibG9jayEuZ2V0Q29ubmVjdGlvbnNfKGZhbHNlKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBjb25uZWN0aW9uOyBjb25uZWN0aW9uID0gY29ubmVjdGlvbnNbaV07IGkrKykge1xuICAgICAgICAgICAgICBjb25zdCBuZWlnaGJvdXIgPVxuICAgICAgICAgICAgICAgICAgKGNvbm5lY3Rpb24pXG4gICAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5zbmFwUmFkaXVzLCBuZXcgQ29vcmRpbmF0ZShibG9ja1gsIGJsb2NrWSkpO1xuICAgICAgICAgICAgICBpZiAobmVpZ2hib3VyLmNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBjb2xsaWRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY29sbGlkZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICAgICAgICAgIGJsb2NrWCAtPSBjb25maWcuc25hcFJhZGl1cztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGJsb2NrWCArPSBjb25maWcuc25hcFJhZGl1cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrWSArPSBjb25maWcuc25hcFJhZGl1cyAqIDI7XG4gICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlIChjb2xsaWRlKTtcbiAgICAgICAgYmxvY2shLm1vdmVUbyhuZXcgQ29vcmRpbmF0ZShibG9ja1gsIGJsb2NrWSkpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBldmVudFV0aWxzLmVuYWJsZSgpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSAmJiAhYmxvY2shLmlzU2hhZG93KCkpIHtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuQkxPQ0tfQ1JFQVRFKSkoYmxvY2shKSk7XG4gICAgfVxuICAgIGJsb2NrIS5zZWxlY3QoKTtcbiAgICByZXR1cm4gYmxvY2shO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhc3RlIHRoZSBwcm92aWRlZCBjb21tZW50IG9udG8gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHhtbENvbW1lbnQgWE1MIHdvcmtzcGFjZSBjb21tZW50IGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIFRoZSBwYXN0ZWQgd29ya3NwYWNlIGNvbW1lbnQuXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc30gU3VwcHJlc3MgY2hlY2tzIHdoaWxlIHdvcmtzcGFjZSBjb21tZW50cyBhcmUgbm90XG4gICAqIGJ1bmRsZWQgaW4uXG4gICAqL1xuICBwcml2YXRlIHBhc3RlV29ya3NwYWNlQ29tbWVudF8oeG1sQ29tbWVudDogRWxlbWVudCk6IFdvcmtzcGFjZUNvbW1lbnRTdmcge1xuICAgIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuICAgIGxldCBjb21tZW50OiBXb3Jrc3BhY2VDb21tZW50U3ZnO1xuICAgIHRyeSB7XG4gICAgICBjb21tZW50ID0gV29ya3NwYWNlQ29tbWVudFN2Zy5mcm9tWG1sUmVuZGVyZWQoeG1sQ29tbWVudCwgdGhpcyk7XG4gICAgICAvLyBNb3ZlIHRoZSBkdXBsaWNhdGUgdG8gb3JpZ2luYWwgcG9zaXRpb24uXG4gICAgICBsZXQgY29tbWVudFggPSBwYXJzZUludCh4bWxDb21tZW50LmdldEF0dHJpYnV0ZSgneCcpID8/ICcwJyk7XG4gICAgICBsZXQgY29tbWVudFkgPSBwYXJzZUludCh4bWxDb21tZW50LmdldEF0dHJpYnV0ZSgneScpID8/ICcwJyk7XG4gICAgICBpZiAoIWlzTmFOKGNvbW1lbnRYKSAmJiAhaXNOYU4oY29tbWVudFkpKSB7XG4gICAgICAgIGlmICh0aGlzLlJUTCkge1xuICAgICAgICAgIGNvbW1lbnRYID0gLWNvbW1lbnRYO1xuICAgICAgICB9XG4gICAgICAgIC8vIE9mZnNldCB3b3Jrc3BhY2UgY29tbWVudC5cbiAgICAgICAgLy8gVE9ETyAoIzE3MTkpOiBQcm9wZXJseSBvZmZzZXQgY29tbWVudCBzdWNoIHRoYXQgaXQncyBub3QgaW50ZXJmZXJpbmdcbiAgICAgICAgLy8gd2l0aCBhbnkgYmxvY2tzLlxuICAgICAgICBjb21tZW50WCArPSA1MDtcbiAgICAgICAgY29tbWVudFkgKz0gNTA7XG4gICAgICAgIGNvbW1lbnQubW92ZUJ5KGNvbW1lbnRYLCBjb21tZW50WSk7XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgfVxuICAgIGlmIChldmVudFV0aWxzLmlzRW5hYmxlZCgpKSB7XG4gICAgICBXb3Jrc3BhY2VDb21tZW50LmZpcmVDcmVhdGVFdmVudChjb21tZW50KTtcbiAgICB9XG4gICAgY29tbWVudC5zZWxlY3QoKTtcbiAgICByZXR1cm4gY29tbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWZyZXNoIHRoZSB0b29sYm94IHVubGVzcyB0aGVyZSdzIGEgZHJhZyBpbiBwcm9ncmVzcy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICByZWZyZXNoVG9vbGJveFNlbGVjdGlvbigpIHtcbiAgICBjb25zdCB3cyA9IHRoaXMuaXNGbHlvdXQgPyB0aGlzLnRhcmdldFdvcmtzcGFjZSA6IHRoaXM7XG4gICAgaWYgKHdzICYmICF3cy5jdXJyZW50R2VzdHVyZV8gJiYgd3MudG9vbGJveF8gJiYgd3MudG9vbGJveF8uZ2V0Rmx5b3V0KCkpIHtcbiAgICAgIHdzLnRvb2xib3hfLnJlZnJlc2hTZWxlY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVuYW1lIGEgdmFyaWFibGUgYnkgdXBkYXRpbmcgaXRzIG5hbWUgaW4gdGhlIHZhcmlhYmxlIG1hcC4gIFVwZGF0ZSB0aGVcbiAgICogICAgIGZseW91dCB0byBzaG93IHRoZSByZW5hbWVkIHZhcmlhYmxlIGltbWVkaWF0ZWx5LlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdGhlIHZhcmlhYmxlIHRvIHJlbmFtZS5cbiAgICogQHBhcmFtIG5ld05hbWUgTmV3IHZhcmlhYmxlIG5hbWUuXG4gICAqL1xuICBvdmVycmlkZSByZW5hbWVWYXJpYWJsZUJ5SWQoaWQ6IHN0cmluZywgbmV3TmFtZTogc3RyaW5nKSB7XG4gICAgc3VwZXIucmVuYW1lVmFyaWFibGVCeUlkKGlkLCBuZXdOYW1lKTtcbiAgICB0aGlzLnJlZnJlc2hUb29sYm94U2VsZWN0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIGEgdmFyaWFibGUgYnkgdGhlIHBhc3NlZCBpbiBJRC4gICBVcGRhdGUgdGhlIGZseW91dCB0byBzaG93XG4gICAqICAgICBpbW1lZGlhdGVseSB0aGF0IHRoZSB2YXJpYWJsZSBpcyBkZWxldGVkLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdmFyaWFibGUgdG8gZGVsZXRlLlxuICAgKi9cbiAgb3ZlcnJpZGUgZGVsZXRlVmFyaWFibGVCeUlkKGlkOiBzdHJpbmcpIHtcbiAgICBzdXBlci5kZWxldGVWYXJpYWJsZUJ5SWQoaWQpO1xuICAgIHRoaXMucmVmcmVzaFRvb2xib3hTZWxlY3Rpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgdmFyaWFibGUgd2l0aCB0aGUgZ2l2ZW4gbmFtZS4gIFVwZGF0ZSB0aGUgZmx5b3V0IHRvIHNob3cgdGhlXG4gICAqICAgICBuZXcgdmFyaWFibGUgaW1tZWRpYXRlbHkuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBuZXcgdmFyaWFibGUncyBuYW1lLlxuICAgKiBAcGFyYW0gb3B0X3R5cGUgVGhlIHR5cGUgb2YgdGhlIHZhcmlhYmxlIGxpa2UgJ2ludCcgb3IgJ3N0cmluZycuXG4gICAqICAgICBEb2VzIG5vdCBuZWVkIHRvIGJlIHVuaXF1ZS4gRmllbGRfdmFyaWFibGUgY2FuIGZpbHRlciB2YXJpYWJsZXMgYmFzZWRcbiAgICogb24gdGhlaXIgdHlwZS4gVGhpcyB3aWxsIGRlZmF1bHQgdG8gJycgd2hpY2ggaXMgYSBzcGVjaWZpYyB0eXBlLlxuICAgKiBAcGFyYW0gb3B0X2lkIFRoZSB1bmlxdWUgSUQgb2YgdGhlIHZhcmlhYmxlLiBUaGlzIHdpbGwgZGVmYXVsdCB0byBhIFVVSUQuXG4gICAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHZhcmlhYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgY3JlYXRlVmFyaWFibGUoXG4gICAgICBuYW1lOiBzdHJpbmcsIG9wdF90eXBlPzogc3RyaW5nfG51bGwsXG4gICAgICBvcHRfaWQ/OiBzdHJpbmd8bnVsbCk6IFZhcmlhYmxlTW9kZWwge1xuICAgIGNvbnN0IG5ld1ZhciA9IHN1cGVyLmNyZWF0ZVZhcmlhYmxlKG5hbWUsIG9wdF90eXBlLCBvcHRfaWQpO1xuICAgIHRoaXMucmVmcmVzaFRvb2xib3hTZWxlY3Rpb24oKTtcbiAgICByZXR1cm4gbmV3VmFyO1xuICB9XG5cbiAgLyoqIE1ha2UgYSBsaXN0IG9mIGFsbCB0aGUgZGVsZXRlIGFyZWFzIGZvciB0aGlzIHdvcmtzcGFjZS4gKi9cbiAgcmVjb3JkRHJhZ1RhcmdldHMoKSB7XG4gICAgY29uc3QgZHJhZ1RhcmdldHMgPSB0aGlzLmNvbXBvbmVudE1hbmFnZXIuZ2V0Q29tcG9uZW50cyhcbiAgICAgICAgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkRSQUdfVEFSR0VULCB0cnVlKTtcblxuICAgIHRoaXMuZHJhZ1RhcmdldEFyZWFzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDAsIHRhcmdldEFyZWE7IHRhcmdldEFyZWEgPSBkcmFnVGFyZ2V0c1tpXTsgaSsrKSB7XG4gICAgICBjb25zdCByZWN0ID0gdGFyZ2V0QXJlYS5nZXRDbGllbnRSZWN0KCk7XG4gICAgICBpZiAocmVjdCkge1xuICAgICAgICB0aGlzLmRyYWdUYXJnZXRBcmVhcy5wdXNoKHtcbiAgICAgICAgICBjb21wb25lbnQ6IHRhcmdldEFyZWEsXG4gICAgICAgICAgY2xpZW50UmVjdDogcmVjdCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qIGVzbGludC1kaXNhYmxlIGpzZG9jL3JlcXVpcmUtcmV0dXJucy1jaGVjayAqL1xuICAvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi9cbiAgLyoqXG4gICAqIE9idGFpbiBhIG5ld2x5IGNyZWF0ZWQgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBwcm90b3R5cGVOYW1lIE5hbWUgb2YgdGhlIGxhbmd1YWdlIG9iamVjdCBjb250YWluaW5nIHR5cGUtc3BlY2lmaWNcbiAgICogICAgIGZ1bmN0aW9ucyBmb3IgdGhpcyBibG9jay5cbiAgICogQHBhcmFtIG9wdF9pZCBPcHRpb25hbCBJRC4gIFVzZSB0aGlzIElEIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3XG4gICAqICAgICBJRC5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgYmxvY2suXG4gICAqL1xuICBvdmVycmlkZSBuZXdCbG9jayhwcm90b3R5cGVOYW1lOiBzdHJpbmcsIG9wdF9pZD86IHN0cmluZyk6IEJsb2NrU3ZnIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUaGUgaW1wbGVtZW50YXRpb24gb2YgbmV3QmxvY2sgc2hvdWxkIGJlICcgK1xuICAgICAgICAnbW9ua2V5LXBhdGNoZWQgaW4gYnkgYmxvY2tseS50cycpO1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgKi9cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZHJhZyB0YXJnZXQgdGhlIHBvaW50ZXIgZXZlbnQgaXMgb3Zlci5cbiAgICpcbiAgICogQHBhcmFtIGUgUG9pbnRlciBtb3ZlIGV2ZW50LlxuICAgKiBAcmV0dXJucyBOdWxsIGlmIG5vdCBvdmVyIGEgZHJhZyB0YXJnZXQsIG9yIHRoZSBkcmFnIHRhcmdldCB0aGUgZXZlbnQgaXNcbiAgICogICAgIG92ZXIuXG4gICAqL1xuICBnZXREcmFnVGFyZ2V0KGU6IFBvaW50ZXJFdmVudCk6IElEcmFnVGFyZ2V0fG51bGwge1xuICAgIGZvciAobGV0IGkgPSAwLCB0YXJnZXRBcmVhOyB0YXJnZXRBcmVhID0gdGhpcy5kcmFnVGFyZ2V0QXJlYXNbaV07IGkrKykge1xuICAgICAgaWYgKHRhcmdldEFyZWEuY2xpZW50UmVjdC5jb250YWlucyhlLmNsaWVudFgsIGUuY2xpZW50WSkpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldEFyZWEuY29tcG9uZW50O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVyZG93biBvbiBTVkcgZHJhd2luZyBzdXJmYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBQb2ludGVyIGRvd24gZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIG9uTW91c2VEb3duXyhlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBjb25zdCBnZXN0dXJlID0gdGhpcy5nZXRHZXN0dXJlKGUpO1xuICAgIGlmIChnZXN0dXJlKSB7XG4gICAgICBnZXN0dXJlLmhhbmRsZVdzU3RhcnQoZSwgdGhpcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRyYWNraW5nIGEgZHJhZyBvZiBhbiBvYmplY3Qgb24gdGhpcyB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgZG93biBldmVudC5cbiAgICogQHBhcmFtIHh5IFN0YXJ0aW5nIGxvY2F0aW9uIG9mIG9iamVjdC5cbiAgICovXG4gIHN0YXJ0RHJhZyhlOiBQb2ludGVyRXZlbnQsIHh5OiBDb29yZGluYXRlKSB7XG4gICAgLy8gUmVjb3JkIHRoZSBzdGFydGluZyBvZmZzZXQgYmV0d2VlbiB0aGUgYnViYmxlJ3MgbG9jYXRpb24gYW5kIHRoZSBtb3VzZS5cbiAgICBjb25zdCBwb2ludCA9IGJyb3dzZXJFdmVudHMubW91c2VUb1N2ZyhcbiAgICAgICAgZSwgdGhpcy5nZXRQYXJlbnRTdmcoKSwgdGhpcy5nZXRJbnZlcnNlU2NyZWVuQ1RNKCkpO1xuICAgIC8vIEZpeCBzY2FsZSBvZiBtb3VzZSBldmVudC5cbiAgICBwb2ludC54IC89IHRoaXMuc2NhbGU7XG4gICAgcG9pbnQueSAvPSB0aGlzLnNjYWxlO1xuICAgIHRoaXMuZHJhZ0RlbHRhWFkgPSBDb29yZGluYXRlLmRpZmZlcmVuY2UoeHksIHBvaW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFjayBhIGRyYWcgb2YgYW4gb2JqZWN0IG9uIHRoaXMgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBQb2ludGVyIG1vdmUgZXZlbnQuXG4gICAqIEByZXR1cm5zIE5ldyBsb2NhdGlvbiBvZiBvYmplY3QuXG4gICAqL1xuICBtb3ZlRHJhZyhlOiBQb2ludGVyRXZlbnQpOiBDb29yZGluYXRlIHtcbiAgICBjb25zdCBwb2ludCA9IGJyb3dzZXJFdmVudHMubW91c2VUb1N2ZyhcbiAgICAgICAgZSwgdGhpcy5nZXRQYXJlbnRTdmcoKSwgdGhpcy5nZXRJbnZlcnNlU2NyZWVuQ1RNKCkpO1xuICAgIC8vIEZpeCBzY2FsZSBvZiBtb3VzZSBldmVudC5cbiAgICBwb2ludC54IC89IHRoaXMuc2NhbGU7XG4gICAgcG9pbnQueSAvPSB0aGlzLnNjYWxlO1xuICAgIHJldHVybiBDb29yZGluYXRlLnN1bSgodGhpcy5kcmFnRGVsdGFYWSEpLCBwb2ludCk7XG4gIH1cblxuICAvKipcbiAgICogSXMgdGhlIHVzZXIgY3VycmVudGx5IGRyYWdnaW5nIGEgYmxvY2sgb3Igc2Nyb2xsaW5nIHRoZSBmbHlvdXQvd29ya3NwYWNlP1xuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGN1cnJlbnRseSBkcmFnZ2luZyBvciBzY3JvbGxpbmcuXG4gICAqL1xuICBpc0RyYWdnaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRHZXN0dXJlXyAhPT0gbnVsbCAmJiB0aGlzLmN1cnJlbnRHZXN0dXJlXy5pc0RyYWdnaW5nKCk7XG4gIH1cblxuICAvKipcbiAgICogSXMgdGhpcyB3b3Jrc3BhY2UgZHJhZ2dhYmxlP1xuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgd29ya3NwYWNlIG1heSBiZSBkcmFnZ2VkLlxuICAgKi9cbiAgaXNEcmFnZ2FibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tb3ZlT3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMubW92ZU9wdGlvbnMuZHJhZztcbiAgfVxuXG4gIC8qKlxuICAgKiBJcyB0aGlzIHdvcmtzcGFjZSBtb3ZhYmxlP1xuICAgKlxuICAgKiBUaGlzIG1lYW5zIHRoZSB1c2VyIGNhbiByZXBvc2l0aW9uIHRoZSBYIFkgY29vcmRpbmF0ZXMgb2YgdGhlIHdvcmtzcGFjZVxuICAgKiB0aHJvdWdoIGlucHV0LiBUaGlzIGNhbiBiZSB0aHJvdWdoIHNjcm9sbGJhcnMsIHNjcm9sbCB3aGVlbCwgZHJhZ2dpbmcsIG9yXG4gICAqIHRocm91Z2ggem9vbWluZyB3aXRoIHRoZSBzY3JvbGwgd2hlZWwgb3IgcGluY2ggKHNpbmNlIHRoZSB6b29tIGlzIGNlbnRlcmVkXG4gICAqIG9uIHRoZSBtb3VzZSBwb3NpdGlvbikuIFRoaXMgZG9lcyBub3QgaW5jbHVkZSB6b29taW5nIHdpdGggdGhlIHpvb21cbiAgICogY29udHJvbHMgc2luY2UgdGhlIFggWSBjb29yZGluYXRlcyBhcmUgZGVjaWRlZCBwcm9ncmFtbWF0aWNhbGx5LlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB3b3Jrc3BhY2UgaXMgbW92YWJsZSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgaXNNb3ZhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMubW92ZU9wdGlvbnMgJiYgISF0aGlzLm9wdGlvbnMubW92ZU9wdGlvbnMuc2Nyb2xsYmFycyB8fFxuICAgICAgICB0aGlzLm9wdGlvbnMubW92ZU9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLm1vdmVPcHRpb25zLndoZWVsIHx8XG4gICAgICAgIHRoaXMub3B0aW9ucy5tb3ZlT3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMubW92ZU9wdGlvbnMuZHJhZyB8fFxuICAgICAgICB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLnpvb21PcHRpb25zLndoZWVsIHx8XG4gICAgICAgIHRoaXMub3B0aW9ucy56b29tT3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMucGluY2g7XG4gIH1cblxuICAvKipcbiAgICogSXMgdGhpcyB3b3Jrc3BhY2UgbW92YWJsZSBob3Jpem9udGFsbHk/XG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHdvcmtzcGFjZSBpcyBtb3ZhYmxlIGhvcml6b250YWxseSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgaXNNb3ZhYmxlSG9yaXpvbnRhbGx5KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGhhc1Njcm9sbGJhcnMgPSAhIXRoaXMuc2Nyb2xsYmFyO1xuICAgIHJldHVybiB0aGlzLmlzTW92YWJsZSgpICYmXG4gICAgICAgICghaGFzU2Nyb2xsYmFycyB8fFxuICAgICAgICAgaGFzU2Nyb2xsYmFycyAmJiB0aGlzLnNjcm9sbGJhciEuY2FuU2Nyb2xsSG9yaXpvbnRhbGx5KCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIElzIHRoaXMgd29ya3NwYWNlIG1vdmFibGUgdmVydGljYWxseT9cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgd29ya3NwYWNlIGlzIG1vdmFibGUgdmVydGljYWxseSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgaXNNb3ZhYmxlVmVydGljYWxseSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBoYXNTY3JvbGxiYXJzID0gISF0aGlzLnNjcm9sbGJhcjtcbiAgICByZXR1cm4gdGhpcy5pc01vdmFibGUoKSAmJlxuICAgICAgICAoIWhhc1Njcm9sbGJhcnMgfHxcbiAgICAgICAgIGhhc1Njcm9sbGJhcnMgJiYgdGhpcy5zY3JvbGxiYXIhLmNhblNjcm9sbFZlcnRpY2FsbHkoKSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgbW91c2Utd2hlZWwgb24gU1ZHIGRyYXdpbmcgc3VyZmFjZS5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2Ugd2hlZWwgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIG9uTW91c2VXaGVlbF8oZTogV2hlZWxFdmVudCkge1xuICAgIC8vIERvbid0IHNjcm9sbCBvciB6b29tIGFueXRoaW5nIGlmIGRyYWcgaXMgaW4gcHJvZ3Jlc3MuXG4gICAgaWYgKEdlc3R1cmUuaW5Qcm9ncmVzcygpKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjYW5XaGVlbFpvb20gPVxuICAgICAgICB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLnpvb21PcHRpb25zLndoZWVsO1xuICAgIGNvbnN0IGNhbldoZWVsTW92ZSA9XG4gICAgICAgIHRoaXMub3B0aW9ucy5tb3ZlT3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMubW92ZU9wdGlvbnMud2hlZWw7XG4gICAgaWYgKCFjYW5XaGVlbFpvb20gJiYgIWNhbldoZWVsTW92ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHNjcm9sbERlbHRhID0gYnJvd3NlckV2ZW50cy5nZXRTY3JvbGxEZWx0YVBpeGVscyhlKTtcblxuICAgIC8vIFpvb20gc2hvdWxkIGFsc28gYmUgZW5hYmxlZCBieSB0aGUgY29tbWFuZCBrZXkgb24gTWFjIGRldmljZXMsXG4gICAgLy8gYnV0IG5vdCBzdXBlciBvbiBVbml4LlxuICAgIGxldCBjb21tYW5kS2V5O1xuICAgIGlmICh1c2VyQWdlbnQuTUFDKSB7XG4gICAgICBjb21tYW5kS2V5ID0gZS5tZXRhS2V5O1xuICAgIH1cblxuICAgIGlmIChjYW5XaGVlbFpvb20gJiYgKGUuY3RybEtleSB8fCBjb21tYW5kS2V5IHx8ICFjYW5XaGVlbE1vdmUpKSB7XG4gICAgICAvLyBab29tLlxuICAgICAgLy8gVGhlIHZlcnRpY2FsIHNjcm9sbCBkaXN0YW5jZSB0aGF0IGNvcnJlc3BvbmRzIHRvIGEgY2xpY2sgb2YgYSB6b29tXG4gICAgICAvLyBidXR0b24uXG4gICAgICBjb25zdCBQSVhFTFNfUEVSX1pPT01fU1RFUCA9IDUwO1xuICAgICAgY29uc3QgZGVsdGEgPSAtc2Nyb2xsRGVsdGEueSAvIFBJWEVMU19QRVJfWk9PTV9TVEVQO1xuICAgICAgY29uc3QgcG9zaXRpb24gPSBicm93c2VyRXZlbnRzLm1vdXNlVG9TdmcoXG4gICAgICAgICAgZSwgdGhpcy5nZXRQYXJlbnRTdmcoKSwgdGhpcy5nZXRJbnZlcnNlU2NyZWVuQ1RNKCkpO1xuICAgICAgdGhpcy56b29tKHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIGRlbHRhKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU2Nyb2xsLlxuICAgICAgbGV0IHggPSB0aGlzLnNjcm9sbFggLSBzY3JvbGxEZWx0YS54O1xuICAgICAgbGV0IHkgPSB0aGlzLnNjcm9sbFkgLSBzY3JvbGxEZWx0YS55O1xuXG4gICAgICBpZiAoZS5zaGlmdEtleSAmJiAhc2Nyb2xsRGVsdGEueCkge1xuICAgICAgICAvLyBTY3JvbGwgaG9yaXpvbnRhbGx5IChiYXNlZCBvbiB2ZXJ0aWNhbCBzY3JvbGwgZGVsdGEpLlxuICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBhcyBmb3Igc29tZSBicm93c2VyL3N5c3RlbSBjb21iaW5hdGlvbnMgd2hpY2ggZG8gbm90XG4gICAgICAgIC8vIHNldCBkZWx0YVguXG4gICAgICAgIHggPSB0aGlzLnNjcm9sbFggLSBzY3JvbGxEZWx0YS55O1xuICAgICAgICB5ID0gdGhpcy5zY3JvbGxZOyAgLy8gRG9uJ3Qgc2Nyb2xsIHZlcnRpY2FsbHkuXG4gICAgICB9XG4gICAgICB0aGlzLnNjcm9sbCh4LCB5KTtcbiAgICB9XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0aGUgYm91bmRpbmcgYm94IGZvciB0aGUgYmxvY2tzIG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqIENvb3JkaW5hdGUgc3lzdGVtOiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqXG4gICAqIEByZXR1cm5zIENvbnRhaW5zIHRoZSBwb3NpdGlvbiBhbmQgc2l6ZSBvZiB0aGUgYm91bmRpbmcgYm94IGNvbnRhaW5pbmcgdGhlXG4gICAqICAgICBibG9ja3Mgb24gdGhlIHdvcmtzcGFjZS5cbiAgICovXG4gIGdldEJsb2Nrc0JvdW5kaW5nQm94KCk6IFJlY3Qge1xuICAgIGNvbnN0IHRvcEVsZW1lbnRzID0gdGhpcy5nZXRUb3BCb3VuZGVkRWxlbWVudHMoKTtcbiAgICAvLyBUaGVyZSBhcmUgbm8gYmxvY2tzLCByZXR1cm4gZW1wdHkgcmVjdGFuZ2xlLlxuICAgIGlmICghdG9wRWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gbmV3IFJlY3QoMCwgMCwgMCwgMCk7XG4gICAgfVxuXG4gICAgLy8gSW5pdGlhbGl6ZSBib3VuZGFyeSB1c2luZyB0aGUgZmlyc3QgYmxvY2suXG4gICAgY29uc3QgYm91bmRhcnkgPSB0b3BFbGVtZW50c1swXS5nZXRCb3VuZGluZ1JlY3RhbmdsZSgpO1xuXG4gICAgLy8gU3RhcnQgYXQgMSBzaW5jZSB0aGUgMHRoIGJsb2NrIHdhcyB1c2VkIGZvciBpbml0aWFsaXphdGlvbi5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRvcEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0b3BFbGVtZW50ID0gdG9wRWxlbWVudHNbaV07XG4gICAgICBpZiAoKHRvcEVsZW1lbnQgYXMgYW55KS5pc0luc2VydGlvbk1hcmtlciAmJlxuICAgICAgICAgICh0b3BFbGVtZW50IGFzIGFueSkuaXNJbnNlcnRpb25NYXJrZXIoKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGJsb2NrQm91bmRhcnkgPSB0b3BFbGVtZW50LmdldEJvdW5kaW5nUmVjdGFuZ2xlKCk7XG4gICAgICBpZiAoYmxvY2tCb3VuZGFyeS50b3AgPCBib3VuZGFyeS50b3ApIHtcbiAgICAgICAgYm91bmRhcnkudG9wID0gYmxvY2tCb3VuZGFyeS50b3A7XG4gICAgICB9XG4gICAgICBpZiAoYmxvY2tCb3VuZGFyeS5ib3R0b20gPiBib3VuZGFyeS5ib3R0b20pIHtcbiAgICAgICAgYm91bmRhcnkuYm90dG9tID0gYmxvY2tCb3VuZGFyeS5ib3R0b207XG4gICAgICB9XG4gICAgICBpZiAoYmxvY2tCb3VuZGFyeS5sZWZ0IDwgYm91bmRhcnkubGVmdCkge1xuICAgICAgICBib3VuZGFyeS5sZWZ0ID0gYmxvY2tCb3VuZGFyeS5sZWZ0O1xuICAgICAgfVxuICAgICAgaWYgKGJsb2NrQm91bmRhcnkucmlnaHQgPiBib3VuZGFyeS5yaWdodCkge1xuICAgICAgICBib3VuZGFyeS5yaWdodCA9IGJsb2NrQm91bmRhcnkucmlnaHQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBib3VuZGFyeTtcbiAgfVxuXG4gIC8qKiBDbGVhbiB1cCB0aGUgd29ya3NwYWNlIGJ5IG9yZGVyaW5nIGFsbCB0aGUgYmxvY2tzIGluIGEgY29sdW1uLiAqL1xuICBjbGVhblVwKCkge1xuICAgIHRoaXMuc2V0UmVzaXplc0VuYWJsZWQoZmFsc2UpO1xuICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAodHJ1ZSk7XG4gICAgY29uc3QgdG9wQmxvY2tzID0gdGhpcy5nZXRUb3BCbG9ja3ModHJ1ZSk7XG4gICAgbGV0IGN1cnNvclkgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSB0b3BCbG9ja3NbaV07IGkrKykge1xuICAgICAgaWYgKCFibG9jay5pc01vdmFibGUoKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHh5ID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgICAgYmxvY2subW92ZUJ5KC14eS54LCBjdXJzb3JZIC0geHkueSk7XG4gICAgICBibG9jay5zbmFwVG9HcmlkKCk7XG4gICAgICBjdXJzb3JZID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpLnkgK1xuICAgICAgICAgIGJsb2NrLmdldEhlaWdodFdpZHRoKCkuaGVpZ2h0ICtcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyLmdldENvbnN0YW50cygpLk1JTl9CTE9DS19IRUlHSFQ7XG4gICAgfVxuICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgIHRoaXMuc2V0UmVzaXplc0VuYWJsZWQodHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyB0aGUgY29udGV4dCBtZW51IGZvciB0aGUgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBNb3VzZSBldmVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzaG93Q29udGV4dE1lbnUoZTogRXZlbnQpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLnJlYWRPbmx5IHx8IHRoaXMuaXNGbHlvdXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbWVudU9wdGlvbnMgPSBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LmdldENvbnRleHRNZW51T3B0aW9ucyhcbiAgICAgICAgQ29udGV4dE1lbnVSZWdpc3RyeS5TY29wZVR5cGUuV09SS1NQQUNFLCB7d29ya3NwYWNlOiB0aGlzfSk7XG5cbiAgICAvLyBBbGxvdyB0aGUgZGV2ZWxvcGVyIHRvIGFkZCBvciBtb2RpZnkgbWVudU9wdGlvbnMuXG4gICAgaWYgKHRoaXMuY29uZmlndXJlQ29udGV4dE1lbnUpIHtcbiAgICAgIHRoaXMuY29uZmlndXJlQ29udGV4dE1lbnUobWVudU9wdGlvbnMsIGUpO1xuICAgIH1cblxuICAgIENvbnRleHRNZW51LnNob3coZSwgbWVudU9wdGlvbnMsIHRoaXMuUlRMKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb2RpZnkgdGhlIGJsb2NrIHRyZWUgb24gdGhlIGV4aXN0aW5nIHRvb2xib3guXG4gICAqXG4gICAqIEBwYXJhbSB0b29sYm94RGVmIERPTSB0cmVlIG9mIHRvb2xib3ggY29udGVudHMsIHN0cmluZyBvZiB0b29sYm94IGNvbnRlbnRzLFxuICAgKiAgICAgb3IgSlNPTiByZXByZXNlbnRpbmcgdG9vbGJveCBkZWZpbml0aW9uLlxuICAgKi9cbiAgdXBkYXRlVG9vbGJveCh0b29sYm94RGVmOiB0b29sYm94LlRvb2xib3hEZWZpbml0aW9ufG51bGwpIHtcbiAgICBjb25zdCBwYXJzZWRUb29sYm94RGVmID0gdG9vbGJveC5jb252ZXJ0VG9vbGJveERlZlRvSnNvbih0b29sYm94RGVmKTtcblxuICAgIGlmICghcGFyc2VkVG9vbGJveERlZikge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5sYW5ndWFnZVRyZWUpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ0NhblxcJ3QgbnVsbGlmeSBhbiBleGlzdGluZyB0b29sYm94LicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuOyAgLy8gTm8gY2hhbmdlIChudWxsIHRvIG51bGwpLlxuICAgIH1cbiAgICBpZiAoIXRoaXMub3B0aW9ucy5sYW5ndWFnZVRyZWUpIHtcbiAgICAgIHRocm93IEVycm9yKCdFeGlzdGluZyB0b29sYm94IGlzIG51bGwuICBDYW5cXCd0IGNyZWF0ZSBuZXcgdG9vbGJveC4nKTtcbiAgICB9XG5cbiAgICBpZiAodG9vbGJveC5oYXNDYXRlZ29yaWVzKHBhcnNlZFRvb2xib3hEZWYpKSB7XG4gICAgICBpZiAoIXRoaXMudG9vbGJveF8pIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ0V4aXN0aW5nIHRvb2xib3ggaGFzIG5vIGNhdGVnb3JpZXMuICBDYW5cXCd0IGNoYW5nZSBtb2RlLicpO1xuICAgICAgfVxuICAgICAgdGhpcy5vcHRpb25zLmxhbmd1YWdlVHJlZSA9IHBhcnNlZFRvb2xib3hEZWY7XG4gICAgICB0aGlzLnRvb2xib3hfLnJlbmRlcihwYXJzZWRUb29sYm94RGVmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCF0aGlzLmZseW91dCkge1xuICAgICAgICB0aHJvdyBFcnJvcignRXhpc3RpbmcgdG9vbGJveCBoYXMgY2F0ZWdvcmllcy4gIENhblxcJ3QgY2hhbmdlIG1vZGUuJyk7XG4gICAgICB9XG4gICAgICB0aGlzLm9wdGlvbnMubGFuZ3VhZ2VUcmVlID0gcGFyc2VkVG9vbGJveERlZjtcbiAgICAgIHRoaXMuZmx5b3V0LnNob3cocGFyc2VkVG9vbGJveERlZik7XG4gICAgfVxuICB9XG5cbiAgLyoqIE1hcmsgdGhpcyB3b3Jrc3BhY2UgYXMgdGhlIGN1cnJlbnRseSBmb2N1c2VkIG1haW4gd29ya3NwYWNlLiAqL1xuICBtYXJrRm9jdXNlZCgpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLnBhcmVudFdvcmtzcGFjZSkge1xuICAgICAgdGhpcy5vcHRpb25zLnBhcmVudFdvcmtzcGFjZS5tYXJrRm9jdXNlZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb21tb24uc2V0TWFpbldvcmtzcGFjZSh0aGlzKTtcbiAgICAgIC8vIFdlIGNhbGwgZS5wcmV2ZW50RGVmYXVsdCBpbiBtYW55IGV2ZW50IGhhbmRsZXJzIHdoaWNoIG1lYW5zIHdlXG4gICAgICAvLyBuZWVkIHRvIGV4cGxpY2l0bHkgZ3JhYiBmb2N1cyAoZS5nIGZyb20gYSB0ZXh0YXJlYSkgYmVjYXVzZVxuICAgICAgLy8gdGhlIGJyb3dzZXIgd2lsbCBub3QgZG8gaXQgZm9yIHVzLiAgSG93IHRvIGRvIHRoaXMgaXMgYnJvd3NlclxuICAgICAgLy8gZGVwZW5kZW50LlxuICAgICAgdGhpcy5zZXRCcm93c2VyRm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICAvKiogU2V0IHRoZSB3b3Jrc3BhY2UgdG8gaGF2ZSBmb2N1cyBpbiB0aGUgYnJvd3Nlci4gKi9cbiAgcHJpdmF0ZSBzZXRCcm93c2VyRm9jdXMoKSB7XG4gICAgLy8gQmx1ciB3aGF0ZXZlciB3YXMgZm9jdXNlZCBzaW5jZSBleHBsaWNpdGx5IGdyYWJiaW5nIGZvY3VzIGJlbG93IGRvZXMgbm90XG4gICAgLy8gd29yayBpbiBFZGdlLlxuICAgIC8vIEluIElFLCBTVkdzIGNhbid0IGJlIGJsdXJyZWQgb3IgZm9jdXNlZC4gQ2hlY2sgdG8gbWFrZSBzdXJlIHRoZSBjdXJyZW50XG4gICAgLy8gZm9jdXMgY2FuIGJlIGJsdXJyZWQgYmVmb3JlIGRvaW5nIHNvLlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Jsb2NrbHkvaXNzdWVzLzQ0NDBcbiAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJlxuICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcbiAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgLy8gRm9jdXMgdGhlIHdvcmtzcGFjZSBTVkcgLSB0aGlzIGlzIGZvciBDaHJvbWUgYW5kIEZpcmVmb3guXG4gICAgICB0aGlzLmdldFBhcmVudFN2ZygpLmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gSUUgYW5kIEVkZ2UgZG8gbm90IHN1cHBvcnQgZm9jdXMgb24gU1ZHIGVsZW1lbnRzLiBXaGVuIHRoYXQgZmFpbHNcbiAgICAgIC8vIGFib3ZlLCBnZXQgdGhlIGluamVjdGlvbkRpdiAodGhlIHdvcmtzcGFjZSdzIHBhcmVudCkgYW5kIGZvY3VzIHRoYXRcbiAgICAgIC8vIGluc3RlYWQuICBUaGlzIGRvZXNuJ3Qgd29yayBpbiBDaHJvbWUuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBJbiBJRTExLCB1c2Ugc2V0QWN0aXZlICh3aGljaCBpcyBJRSBvbmx5KSBzbyB0aGUgcGFnZSBkb2Vzbid0IHNjcm9sbFxuICAgICAgICAvLyB0byB0aGUgd29ya3NwYWNlIGdhaW5pbmcgZm9jdXMuXG4gICAgICAgICh0aGlzLmdldFBhcmVudFN2ZygpLnBhcmVudEVsZW1lbnQgYXMgYW55KS5zZXRBY3RpdmUoKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gc2V0QWN0aXZlIHN1cHBvcnQgd2FzIGRpc2NvbnRpbnVlZCBpbiBFZGdlIHNvIHdoZW4gdGhhdCBmYWlscywgY2FsbFxuICAgICAgICAvLyBmb2N1cyBpbnN0ZWFkLlxuICAgICAgICB0aGlzLmdldFBhcmVudFN2ZygpLnBhcmVudEVsZW1lbnQhLmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFpvb21zIHRoZSB3b3Jrc3BhY2UgaW4gb3Igb3V0IHJlbGF0aXZlIHRvL2NlbnRlcmVkIG9uIHRoZSBnaXZlbiAoeCwgeSlcbiAgICogY29vcmRpbmF0ZS5cbiAgICpcbiAgICogQHBhcmFtIHggWCBjb29yZGluYXRlIG9mIGNlbnRlciwgaW4gcGl4ZWwgdW5pdHMgcmVsYXRpdmUgdG8gdGhlIHRvcC1sZWZ0XG4gICAqICAgICBjb3JuZXIgb2YgdGhlIHBhcmVudFNWRy5cbiAgICogQHBhcmFtIHkgWSBjb29yZGluYXRlIG9mIGNlbnRlciwgaW4gcGl4ZWwgdW5pdHMgcmVsYXRpdmUgdG8gdGhlIHRvcC1sZWZ0XG4gICAqICAgICBjb3JuZXIgb2YgdGhlIHBhcmVudFNWRy5cbiAgICogQHBhcmFtIGFtb3VudCBBbW91bnQgb2Ygem9vbWluZy4gVGhlIGZvcm11bGEgZm9yIHRoZSBuZXcgc2NhbGUgaXMgbmV3U2NhbGVcbiAgICogICAgID0gY3VycmVudFNjYWxlICogKHNjYWxlU3BlZWReYW1vdW50KS4gc2NhbGVTcGVlZCBpcyBzZXQgaW4gdGhlXG4gICAqICAgICB3b3Jrc3BhY2Ugb3B0aW9ucy4gTmVnYXRpdmUgYW1vdW50IHZhbHVlcyB6b29tIG91dCwgYW5kIHBvc2l0aXZlIGFtb3VudFxuICAgKiAgICAgdmFsdWVzIHpvb20gaW4uXG4gICAqL1xuICB6b29tKHg6IG51bWJlciwgeTogbnVtYmVyLCBhbW91bnQ6IG51bWJlcikge1xuICAgIC8vIFNjYWxlIGZhY3Rvci5cbiAgICBjb25zdCBzcGVlZCA9IHRoaXMub3B0aW9ucy56b29tT3B0aW9ucy5zY2FsZVNwZWVkO1xuICAgIGxldCBzY2FsZUNoYW5nZSA9IE1hdGgucG93KHNwZWVkLCBhbW91bnQpO1xuICAgIGNvbnN0IG5ld1NjYWxlID0gdGhpcy5zY2FsZSAqIHNjYWxlQ2hhbmdlO1xuICAgIGlmICh0aGlzLnNjYWxlID09PSBuZXdTY2FsZSkge1xuICAgICAgcmV0dXJuOyAgLy8gTm8gY2hhbmdlIGluIHpvb20uXG4gICAgfVxuXG4gICAgLy8gQ2xhbXAgc2NhbGUgd2l0aGluIHZhbGlkIHJhbmdlLlxuICAgIGlmIChuZXdTY2FsZSA+IHRoaXMub3B0aW9ucy56b29tT3B0aW9ucy5tYXhTY2FsZSkge1xuICAgICAgc2NhbGVDaGFuZ2UgPSB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMubWF4U2NhbGUgLyB0aGlzLnNjYWxlO1xuICAgIH0gZWxzZSBpZiAobmV3U2NhbGUgPCB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMubWluU2NhbGUpIHtcbiAgICAgIHNjYWxlQ2hhbmdlID0gdGhpcy5vcHRpb25zLnpvb21PcHRpb25zLm1pblNjYWxlIC8gdGhpcy5zY2FsZTtcbiAgICB9XG5cbiAgICAvLyBUcmFuc2Zvcm0gdGhlIHgveSBjb29yZGluYXRlcyBmcm9tIHRoZSBwYXJlbnRTVkcncyBzcGFjZSBpbnRvIHRoZVxuICAgIC8vIGNhbnZhcycgc3BhY2UsIHNvIHRoYXQgdGhleSBhcmUgaW4gd29ya3NwYWNlIHVuaXRzIHJlbGF0aXZlIHRvIHRoZSB0b3BcbiAgICAvLyBsZWZ0IG9mIHRoZSB2aXNpYmxlIHBvcnRpb24gb2YgdGhlIHdvcmtzcGFjZS5cbiAgICBsZXQgbWF0cml4ID0gdGhpcy5nZXRDYW52YXMoKS5nZXRDVE0oKTtcbiAgICBsZXQgY2VudGVyID0gKHRoaXMuZ2V0UGFyZW50U3ZnKCkpLmNyZWF0ZVNWR1BvaW50KCk7XG4gICAgY2VudGVyLnggPSB4O1xuICAgIGNlbnRlci55ID0geTtcbiAgICBjZW50ZXIgPSBjZW50ZXIubWF0cml4VHJhbnNmb3JtKG1hdHJpeCEuaW52ZXJzZSgpKTtcbiAgICB4ID0gY2VudGVyLng7XG4gICAgeSA9IGNlbnRlci55O1xuXG4gICAgLy8gRmluZCB0aGUgbmV3IHNjcm9sbFgvc2Nyb2xsWSBzbyB0aGF0IHRoZSBjZW50ZXIgcmVtYWlucyBpbiB0aGUgc2FtZVxuICAgIC8vIHBvc2l0aW9uIChyZWxhdGl2ZSB0byB0aGUgY2VudGVyKSBhZnRlciB3ZSB6b29tLlxuICAgIC8vIG5ld1NjYWxlIGFuZCBtYXRyaXguYSBzaG91bGQgYmUgaWRlbnRpY2FsICh3aXRoaW4gYSByb3VuZGluZyBlcnJvcikuXG4gICAgbWF0cml4ID0gbWF0cml4IS50cmFuc2xhdGUoeCAqICgxIC0gc2NhbGVDaGFuZ2UpLCB5ICogKDEgLSBzY2FsZUNoYW5nZSkpXG4gICAgICAgICAgICAgICAgIC5zY2FsZShzY2FsZUNoYW5nZSk7XG4gICAgLy8gc2Nyb2xsWCBhbmQgc2Nyb2xsWSBhcmUgaW4gcGl4ZWxzLlxuICAgIC8vIFRoZSBzY3JvbGxYIGFuZCBzY3JvbGxZIHN0aWxsIG5lZWQgdG8gaGF2ZSBhYnNvbHV0ZUxlZnQgYW5kIGFic29sdXRlVG9wXG4gICAgLy8gc3VidHJhY3RlZCBmcm9tIHRoZW0sIGJ1dCB3ZSdsbCBsZWF2ZSB0aGF0IGZvciBzZXRTY2FsZSBzbyB0aGF0IHRoZXkncmVcbiAgICAvLyBjb3JyZWN0bHkgdXBkYXRlZCBmb3IgdGhlIG5ldyBmbHlvdXQgc2l6ZSBpZiB3ZSBoYXZlIGEgc2ltcGxlIHRvb2xib3guXG4gICAgdGhpcy5zY3JvbGxYID0gbWF0cml4LmU7XG4gICAgdGhpcy5zY3JvbGxZID0gbWF0cml4LmY7XG4gICAgdGhpcy5zZXRTY2FsZShuZXdTY2FsZSk7XG4gIH1cblxuICAvKipcbiAgICogWm9vbWluZyB0aGUgYmxvY2tzIGNlbnRlcmVkIGluIHRoZSBjZW50ZXIgb2YgdmlldyB3aXRoIHpvb21pbmcgaW4gb3Igb3V0LlxuICAgKlxuICAgKiBAcGFyYW0gdHlwZSBUeXBlIG9mIHpvb21pbmcgKC0xIHpvb21pbmcgb3V0IGFuZCAxIHpvb21pbmcgaW4pLlxuICAgKi9cbiAgem9vbUNlbnRlcih0eXBlOiBudW1iZXIpIHtcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRNZXRyaWNzKCk7XG4gICAgbGV0IHg7XG4gICAgbGV0IHk7XG4gICAgaWYgKHRoaXMuZmx5b3V0KSB7XG4gICAgICAvLyBJZiB5b3Ugd2FudCBibG9ja3MgaW4gdGhlIGNlbnRlciBvZiB0aGUgdmlldyAodmlzaWJsZSBwb3J0aW9uIG9mIHRoZVxuICAgICAgLy8gd29ya3NwYWNlKSB0byBzdGF5IGNlbnRlcmVkIHdoZW4gdGhlIHNpemUgb2YgdGhlIHZpZXcgZGVjcmVhc2VzIChpLmUuXG4gICAgICAvLyB3aGVuIHRoZSBzaXplIG9mIHRoZSBmbHlvdXQgaW5jcmVhc2VzKSB5b3UgbmVlZCB0aGUgY2VudGVyIG9mIHRoZVxuICAgICAgLy8gKmJsb2NrbHkgZGl2KiB0byBzdGF5IGluIHRoZSBzYW1lIHBpeGVsLXBvc2l0aW9uLlxuICAgICAgLy8gTm90ZTogVGhpcyBvbmx5IHdvcmtzIGJlY2F1c2Ugb2YgaG93IHNjcm9sbENlbnRlciBwb3NpdGlvbnMgYmxvY2tzLlxuICAgICAgeCA9IG1ldHJpY3Muc3ZnV2lkdGggPyBtZXRyaWNzLnN2Z1dpZHRoIC8gMiA6IDA7XG4gICAgICB5ID0gbWV0cmljcy5zdmdIZWlnaHQgPyBtZXRyaWNzLnN2Z0hlaWdodCAvIDIgOiAwO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0gbWV0cmljcy52aWV3V2lkdGggLyAyICsgbWV0cmljcy5hYnNvbHV0ZUxlZnQ7XG4gICAgICB5ID0gbWV0cmljcy52aWV3SGVpZ2h0IC8gMiArIG1ldHJpY3MuYWJzb2x1dGVUb3A7XG4gICAgfVxuICAgIHRoaXMuem9vbSh4LCB5LCB0eXBlKTtcbiAgfVxuXG4gIC8qKiBab29tIHRoZSBibG9ja3MgdG8gZml0IGluIHRoZSB3b3Jrc3BhY2UgaWYgcG9zc2libGUuICovXG4gIHpvb21Ub0ZpdCgpIHtcbiAgICBpZiAoIXRoaXMuaXNNb3ZhYmxlKCkpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnVHJpZWQgdG8gbW92ZSBhIG5vbi1tb3ZhYmxlIHdvcmtzcGFjZS4gVGhpcyBjb3VsZCByZXN1bHQnICtcbiAgICAgICAgICAnIGluIGJsb2NrcyBiZWNvbWluZyBpbmFjY2Vzc2libGUuJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0TWV0cmljcygpO1xuICAgIGxldCB3b3Jrc3BhY2VXaWR0aCA9IG1ldHJpY3Mudmlld1dpZHRoO1xuICAgIGxldCB3b3Jrc3BhY2VIZWlnaHQgPSBtZXRyaWNzLnZpZXdIZWlnaHQ7XG4gICAgY29uc3QgYmxvY2tzQm94ID0gdGhpcy5nZXRCbG9ja3NCb3VuZGluZ0JveCgpO1xuICAgIGNvbnN0IGRvdWJsZU1hcmdpbiA9IFpPT01fVE9fRklUX01BUkdJTiAqIDI7XG4gICAgbGV0IGJsb2Nrc1dpZHRoID0gYmxvY2tzQm94LnJpZ2h0IC0gYmxvY2tzQm94LmxlZnQgKyBkb3VibGVNYXJnaW47XG4gICAgbGV0IGJsb2Nrc0hlaWdodCA9IGJsb2Nrc0JveC5ib3R0b20gLSBibG9ja3NCb3gudG9wICsgZG91YmxlTWFyZ2luO1xuICAgIGlmICghYmxvY2tzV2lkdGgpIHtcbiAgICAgIHJldHVybjsgIC8vIFByZXZlbnRzIHpvb21pbmcgdG8gaW5maW5pdHkuXG4gICAgfVxuICAgIGlmICh0aGlzLmZseW91dCkge1xuICAgICAgLy8gV2UgaGF2ZSB0byBhZGQgdGhlIGZseW91dCBzaXplIHRvIGJvdGggdGhlIHdvcmtzcGFjZSBzaXplIGFuZCB0aGVcbiAgICAgIC8vIGJsb2NrIHNpemUgYmVjYXVzZSB0aGUgYmxvY2tzIHdlIHdhbnQgdG8gcmVzaXplIGluY2x1ZGUgdGhlIGJsb2NrcyBpblxuICAgICAgLy8gdGhlIGZseW91dCwgYW5kIHRoZSBhcmVhIHdlIHdhbnQgdG8gZml0IHRoZW0gaW5jbHVkZXMgdGhlIHBvcnRpb24gb2ZcbiAgICAgIC8vIHRoZSB3b3Jrc3BhY2UgdGhhdCBpcyBiZWhpbmQgdGhlIGZseW91dC5cbiAgICAgIGlmICh0aGlzLmhvcml6b250YWxMYXlvdXQpIHtcbiAgICAgICAgd29ya3NwYWNlSGVpZ2h0ICs9IHRoaXMuZmx5b3V0LmdldEhlaWdodCgpO1xuICAgICAgICAvLyBDb252ZXJ0IGZyb20gcGl4ZWxzIHRvIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICAgICAgYmxvY2tzSGVpZ2h0ICs9IHRoaXMuZmx5b3V0LmdldEhlaWdodCgpIC8gdGhpcy5zY2FsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdvcmtzcGFjZVdpZHRoICs9IHRoaXMuZmx5b3V0LmdldFdpZHRoKCk7XG4gICAgICAgIC8vIENvbnZlcnQgZnJvbSBwaXhlbHMgdG8gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgICAgICBibG9ja3NXaWR0aCArPSB0aGlzLmZseW91dC5nZXRXaWR0aCgpIC8gdGhpcy5zY2FsZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTY2FsZSBVbml0czogKHBpeGVscyAvIHdvcmtzcGFjZVVuaXQpXG4gICAgY29uc3QgcmF0aW9YID0gd29ya3NwYWNlV2lkdGggLyBibG9ja3NXaWR0aDtcbiAgICBjb25zdCByYXRpb1kgPSB3b3Jrc3BhY2VIZWlnaHQgLyBibG9ja3NIZWlnaHQ7XG4gICAgZXZlbnRVdGlscy5kaXNhYmxlKCk7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuc2V0U2NhbGUoTWF0aC5taW4ocmF0aW9YLCByYXRpb1kpKTtcbiAgICAgIHRoaXMuc2Nyb2xsQ2VudGVyKCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgfVxuICAgIHRoaXMubWF5YmVGaXJlVmlld3BvcnRDaGFuZ2VFdmVudCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIHRyYW5zaXRpb24gY2xhc3MgdG8gdGhlIGJsb2NrIGFuZCBidWJibGUgY2FudmFzLCB0byBhbmltYXRlIGFueVxuICAgKiB0cmFuc2Zvcm0gY2hhbmdlcy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBiZWdpbkNhbnZhc1RyYW5zaXRpb24oKSB7XG4gICAgZG9tLmFkZENsYXNzKHRoaXMuc3ZnQmxvY2tDYW52YXNfLCAnYmxvY2tseUNhbnZhc1RyYW5zaXRpb25pbmcnKTtcbiAgICBkb20uYWRkQ2xhc3ModGhpcy5zdmdCdWJibGVDYW52YXNfLCAnYmxvY2tseUNhbnZhc1RyYW5zaXRpb25pbmcnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdHJhbnNpdGlvbiBjbGFzcyBmcm9tIHRoZSBibG9jayBhbmQgYnViYmxlIGNhbnZhcy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBlbmRDYW52YXNUcmFuc2l0aW9uKCkge1xuICAgIGRvbS5yZW1vdmVDbGFzcyh0aGlzLnN2Z0Jsb2NrQ2FudmFzXywgJ2Jsb2NrbHlDYW52YXNUcmFuc2l0aW9uaW5nJyk7XG4gICAgZG9tLnJlbW92ZUNsYXNzKHRoaXMuc3ZnQnViYmxlQ2FudmFzXywgJ2Jsb2NrbHlDYW52YXNUcmFuc2l0aW9uaW5nJyk7XG4gIH1cblxuICAvKiogQ2VudGVyIHRoZSB3b3Jrc3BhY2UuICovXG4gIHNjcm9sbENlbnRlcigpIHtcbiAgICBpZiAoIXRoaXMuaXNNb3ZhYmxlKCkpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnVHJpZWQgdG8gbW92ZSBhIG5vbi1tb3ZhYmxlIHdvcmtzcGFjZS4gVGhpcyBjb3VsZCByZXN1bHQnICtcbiAgICAgICAgICAnIGluIGJsb2NrcyBiZWNvbWluZyBpbmFjY2Vzc2libGUuJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0TWV0cmljcygpO1xuICAgIGxldCB4ID0gKG1ldHJpY3Muc2Nyb2xsV2lkdGggLSBtZXRyaWNzLnZpZXdXaWR0aCkgLyAyO1xuICAgIGxldCB5ID0gKG1ldHJpY3Muc2Nyb2xsSGVpZ2h0IC0gbWV0cmljcy52aWV3SGVpZ2h0KSAvIDI7XG5cbiAgICAvLyBDb252ZXJ0IGZyb20gd29ya3NwYWNlIGRpcmVjdGlvbnMgdG8gY2FudmFzIGRpcmVjdGlvbnMuXG4gICAgeCA9IC14IC0gbWV0cmljcy5zY3JvbGxMZWZ0O1xuICAgIHkgPSAteSAtIG1ldHJpY3Muc2Nyb2xsVG9wO1xuICAgIHRoaXMuc2Nyb2xsKHgsIHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCB0aGUgd29ya3NwYWNlIHRvIGNlbnRlciBvbiB0aGUgZ2l2ZW4gYmxvY2suIElmIHRoZSBibG9jayBoYXMgb3RoZXJcbiAgICogYmxvY2tzIHN0YWNrZWQgYmVsb3cgaXQsIHRoZSB3b3Jrc3BhY2Ugd2lsbCBiZSBjZW50ZXJlZCBvbiB0aGUgc3RhY2suXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBvZiBibG9jayBjZW50ZXIgb24uXG4gICAqL1xuICBjZW50ZXJPbkJsb2NrKGlkOiBzdHJpbmd8bnVsbCkge1xuICAgIGlmICghdGhpcy5pc01vdmFibGUoKSkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICdUcmllZCB0byBtb3ZlIGEgbm9uLW1vdmFibGUgd29ya3NwYWNlLiBUaGlzIGNvdWxkIHJlc3VsdCcgK1xuICAgICAgICAgICcgaW4gYmxvY2tzIGJlY29taW5nIGluYWNjZXNzaWJsZS4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBibG9jayA9IGlkID8gdGhpcy5nZXRCbG9ja0J5SWQoaWQpIDogbnVsbDtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gWFkgaXMgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgIGNvbnN0IHh5ID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgIC8vIEhlaWdodC93aWR0aCBpcyBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAgY29uc3QgaGVpZ2h0V2lkdGggPSBibG9jay5nZXRIZWlnaHRXaWR0aCgpO1xuXG4gICAgLy8gRmluZCB0aGUgZW50ZXIgb2YgdGhlIGJsb2NrIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICBjb25zdCBibG9ja0NlbnRlclkgPSB4eS55ICsgaGVpZ2h0V2lkdGguaGVpZ2h0IC8gMjtcblxuICAgIC8vIEluIFJUTCB0aGUgYmxvY2sncyBwb3NpdGlvbiBpcyB0aGUgdG9wIHJpZ2h0IG9mIHRoZSBibG9jaywgbm90IHRvcCBsZWZ0LlxuICAgIGNvbnN0IG11bHRpcGxpZXIgPSB0aGlzLlJUTCA/IC0xIDogMTtcbiAgICBjb25zdCBibG9ja0NlbnRlclggPSB4eS54ICsgbXVsdGlwbGllciAqIGhlaWdodFdpZHRoLndpZHRoIC8gMjtcblxuICAgIC8vIFdvcmtzcGFjZSBzY2FsZSwgdXNlZCB0byBjb252ZXJ0IGZyb20gd29ya3NwYWNlIGNvb3JkaW5hdGVzIHRvIHBpeGVscy5cbiAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7XG5cbiAgICAvLyBDZW50ZXIgb2YgYmxvY2sgaW4gcGl4ZWxzLCByZWxhdGl2ZSB0byB3b3Jrc3BhY2Ugb3JpZ2luIChjZW50ZXIgMCwwKS5cbiAgICAvLyBTY3JvbGxpbmcgdG8gaGVyZSB3b3VsZCBwdXQgdGhlIGJsb2NrIGluIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlXG4gICAgLy8gdmlzaWJsZSB3b3Jrc3BhY2UuXG4gICAgY29uc3QgcGl4ZWxYID0gYmxvY2tDZW50ZXJYICogc2NhbGU7XG4gICAgY29uc3QgcGl4ZWxZID0gYmxvY2tDZW50ZXJZICogc2NhbGU7XG5cbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRNZXRyaWNzKCk7XG5cbiAgICAvLyB2aWV3SGVpZ2h0IGFuZCB2aWV3V2lkdGggYXJlIGluIHBpeGVscy5cbiAgICBjb25zdCBoYWxmVmlld1dpZHRoID0gbWV0cmljcy52aWV3V2lkdGggLyAyO1xuICAgIGNvbnN0IGhhbGZWaWV3SGVpZ2h0ID0gbWV0cmljcy52aWV3SGVpZ2h0IC8gMjtcblxuICAgIC8vIFB1dCB0aGUgYmxvY2sgaW4gdGhlIGNlbnRlciBvZiB0aGUgdmlzaWJsZSB3b3Jrc3BhY2UgaW5zdGVhZC5cbiAgICBjb25zdCBzY3JvbGxUb0NlbnRlclggPSBwaXhlbFggLSBoYWxmVmlld1dpZHRoO1xuICAgIGNvbnN0IHNjcm9sbFRvQ2VudGVyWSA9IHBpeGVsWSAtIGhhbGZWaWV3SGVpZ2h0O1xuXG4gICAgLy8gQ29udmVydCBmcm9tIHdvcmtzcGFjZSBkaXJlY3Rpb25zIHRvIGNhbnZhcyBkaXJlY3Rpb25zLlxuICAgIGNvbnN0IHggPSAtc2Nyb2xsVG9DZW50ZXJYO1xuICAgIGNvbnN0IHkgPSAtc2Nyb2xsVG9DZW50ZXJZO1xuXG4gICAgdGhpcy5zY3JvbGwoeCwgeSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSB3b3Jrc3BhY2UncyB6b29tIGZhY3Rvci5cbiAgICpcbiAgICogQHBhcmFtIG5ld1NjYWxlIFpvb20gZmFjdG9yLiBVbml0czogKHBpeGVscyAvIHdvcmtzcGFjZVVuaXQpLlxuICAgKi9cbiAgc2V0U2NhbGUobmV3U2NhbGU6IG51bWJlcikge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMubWF4U2NhbGUgJiZcbiAgICAgICAgbmV3U2NhbGUgPiB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMubWF4U2NhbGUpIHtcbiAgICAgIG5ld1NjYWxlID0gdGhpcy5vcHRpb25zLnpvb21PcHRpb25zLm1heFNjYWxlO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy56b29tT3B0aW9ucy5taW5TY2FsZSAmJlxuICAgICAgICBuZXdTY2FsZSA8IHRoaXMub3B0aW9ucy56b29tT3B0aW9ucy5taW5TY2FsZSkge1xuICAgICAgbmV3U2NhbGUgPSB0aGlzLm9wdGlvbnMuem9vbU9wdGlvbnMubWluU2NhbGU7XG4gICAgfVxuICAgIHRoaXMuc2NhbGUgPSBuZXdTY2FsZTtcblxuICAgIHRoaXMuaGlkZUNoYWZmKGZhbHNlKTtcbiAgICAvLyBHZXQgdGhlIGZseW91dCwgaWYgYW55LCB3aGV0aGVyIG91ciBvd24gb3Igb3duZWQgYnkgdGhlIHRvb2xib3guXG4gICAgY29uc3QgZmx5b3V0ID0gdGhpcy5nZXRGbHlvdXQoZmFsc2UpO1xuICAgIGlmIChmbHlvdXQgJiYgZmx5b3V0LmlzVmlzaWJsZSgpKSB7XG4gICAgICBmbHlvdXQucmVmbG93KCk7XG4gICAgICB0aGlzLnJlY29yZERyYWdUYXJnZXRzKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmdyaWQpIHtcbiAgICAgIHRoaXMuZ3JpZC51cGRhdGUodGhpcy5zY2FsZSk7XG4gICAgfVxuXG4gICAgLy8gV2UgY2FsbCBzY3JvbGwgaW5zdGVhZCBvZiBzY3JvbGxiYXIucmVzaXplKCkgc28gdGhhdCB3ZSBjYW4gY2VudGVyIHRoZVxuICAgIC8vIHpvb20gY29ycmVjdGx5IHdpdGhvdXQgc2Nyb2xsYmFycywgYnV0IHNjcm9sbCBkb2VzIG5vdCByZXNpemUgdGhlXG4gICAgLy8gc2Nyb2xsYmFycyBzbyB3ZSBoYXZlIHRvIGNhbGwgcmVzaXplVmlldy9yZXNpemVDb250ZW50IGFzIHdlbGwuXG4gICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0TWV0cmljcygpO1xuXG4gICAgdGhpcy5zY3JvbGxYIC09IG1ldHJpY3MuYWJzb2x1dGVMZWZ0O1xuICAgIHRoaXMuc2Nyb2xsWSAtPSBtZXRyaWNzLmFic29sdXRlVG9wO1xuICAgIC8vIFRoZSBzY3JvbGwgdmFsdWVzIGFuZCB0aGUgdmlldyB2YWx1ZXMgYXJlIGFkZGl0aXZlIGludmVyc2VzIG9mXG4gICAgLy8gZWFjaCBvdGhlciwgc28gd2hlbiB3ZSBzdWJ0cmFjdCBmcm9tIG9uZSB3ZSBoYXZlIHRvIGFkZCB0byB0aGUgb3RoZXIuXG4gICAgbWV0cmljcy52aWV3TGVmdCArPSBtZXRyaWNzLmFic29sdXRlTGVmdDtcbiAgICBtZXRyaWNzLnZpZXdUb3AgKz0gbWV0cmljcy5hYnNvbHV0ZVRvcDtcblxuICAgIHRoaXMuc2Nyb2xsKHRoaXMuc2Nyb2xsWCwgdGhpcy5zY3JvbGxZKTtcbiAgICBpZiAodGhpcy5zY3JvbGxiYXIpIHtcbiAgICAgIGlmICh0aGlzLmZseW91dCkge1xuICAgICAgICB0aGlzLnNjcm9sbGJhci5yZXNpemVWaWV3KG1ldHJpY3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zY3JvbGxiYXIucmVzaXplQ29udGVudChtZXRyaWNzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB3b3Jrc3BhY2UncyB6b29tIGZhY3Rvci4gIElmIHRoZSB3b3Jrc3BhY2UgaGFzIGEgcGFyZW50LCB3ZSBjYWxsXG4gICAqIGludG8gdGhlIHBhcmVudCB0byBnZXQgdGhlIHdvcmtzcGFjZSBzY2FsZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHdvcmtzcGFjZSB6b29tIGZhY3Rvci4gVW5pdHM6IChwaXhlbHMgLyB3b3Jrc3BhY2VVbml0KS5cbiAgICovXG4gIGdldFNjYWxlKCk6IG51bWJlciB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucGFyZW50V29ya3NwYWNlLmdldFNjYWxlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNjYWxlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCB0aGUgd29ya3NwYWNlIHRvIGEgc3BlY2lmaWVkIG9mZnNldCAoaW4gcGl4ZWxzKSwga2VlcGluZyBpbiB0aGVcbiAgICogd29ya3NwYWNlIGJvdW5kcy4gU2VlIGNvbW1lbnQgb24gd29ya3NwYWNlU3ZnLnNjcm9sbFggZm9yIG1vcmUgZGV0YWlsIG9uXG4gICAqIHRoZSBtZWFuaW5nIG9mIHRoZXNlIHZhbHVlcy5cbiAgICpcbiAgICogQHBhcmFtIHggVGFyZ2V0IFggdG8gc2Nyb2xsIHRvLlxuICAgKiBAcGFyYW0geSBUYXJnZXQgWSB0byBzY3JvbGwgdG8uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2Nyb2xsKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5oaWRlQ2hhZmYoLyogb3B0X29ubHlDbG9zZVBvcHVwcz0gKi9cbiAgICAgICAgICAgICAgICAgICB0cnVlKTtcblxuICAgIC8vIEtlZXAgc2Nyb2xsaW5nIHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoZSBjb250ZW50LlxuICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLmdldE1ldHJpY3MoKTtcbiAgICAvLyBDYW52YXMgY29vcmRpbmF0ZXMgKGFrYSBzY3JvbGwgY29vcmRpbmF0ZXMpIGhhdmUgaW52ZXJzZSBkaXJlY3Rpb25hbGl0eVxuICAgIC8vIHRvIHdvcmtzcGFjZSBjb29yZGluYXRlcyBzbyB3ZSBoYXZlIHRvIGludmVyc2UgdGhlbS5cbiAgICB4ID0gTWF0aC5taW4oeCwgLW1ldHJpY3Muc2Nyb2xsTGVmdCk7XG4gICAgeSA9IE1hdGgubWluKHksIC1tZXRyaWNzLnNjcm9sbFRvcCk7XG4gICAgY29uc3QgbWF4WERpc3BsYWNlbWVudCA9XG4gICAgICAgIE1hdGgubWF4KDAsIG1ldHJpY3Muc2Nyb2xsV2lkdGggLSBtZXRyaWNzLnZpZXdXaWR0aCk7XG4gICAgY29uc3QgbWF4WFNjcm9sbCA9IG1ldHJpY3Muc2Nyb2xsTGVmdCArIG1heFhEaXNwbGFjZW1lbnQ7XG4gICAgY29uc3QgbWF4WURpc3BsYWNlbWVudCA9XG4gICAgICAgIE1hdGgubWF4KDAsIG1ldHJpY3Muc2Nyb2xsSGVpZ2h0IC0gbWV0cmljcy52aWV3SGVpZ2h0KTtcbiAgICBjb25zdCBtYXhZU2Nyb2xsID0gbWV0cmljcy5zY3JvbGxUb3AgKyBtYXhZRGlzcGxhY2VtZW50O1xuICAgIHggPSBNYXRoLm1heCh4LCAtbWF4WFNjcm9sbCk7XG4gICAgeSA9IE1hdGgubWF4KHksIC1tYXhZU2Nyb2xsKTtcbiAgICB0aGlzLnNjcm9sbFggPSB4O1xuICAgIHRoaXMuc2Nyb2xsWSA9IHk7XG5cbiAgICBpZiAodGhpcy5zY3JvbGxiYXIpIHtcbiAgICAgIC8vIFRoZSBjb250ZW50IHBvc2l0aW9uIChkaXNwbGFjZW1lbnQgZnJvbSB0aGUgY29udGVudCdzIHRvcC1sZWZ0IHRvIHRoZVxuICAgICAgLy8gb3JpZ2luKSBwbHVzIHRoZSBzY3JvbGwgcG9zaXRpb24gKGRpc3BsYWNlbWVudCBmcm9tIHRoZSB2aWV3J3MgdG9wLWxlZnRcbiAgICAgIC8vIHRvIHRoZSBvcmlnaW4pIGdpdmVzIHVzIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSB2aWV3J3MgdG9wLWxlZnQgdG8gdGhlXG4gICAgICAvLyBjb250ZW50J3MgdG9wLWxlZnQuIFRoZW4gd2UgbmVnYXRlIHRoaXMgc28gd2UgZ2V0IHRoZSBkaXNwbGFjZW1lbnQgZnJvbVxuICAgICAgLy8gdGhlIGNvbnRlbnQncyB0b3AtbGVmdCB0byB0aGUgdmlldydzIHRvcC1sZWZ0LCBtYXRjaGluZyB0aGVcbiAgICAgIC8vIGRpcmVjdGlvbmFsaXR5IG9mIHRoZSBzY3JvbGxiYXJzLlxuICAgICAgdGhpcy5zY3JvbGxiYXIuc2V0KFxuICAgICAgICAgIC0oeCArIG1ldHJpY3Muc2Nyb2xsTGVmdCksIC0oeSArIG1ldHJpY3Muc2Nyb2xsVG9wKSwgZmFsc2UpO1xuICAgIH1cbiAgICAvLyBXZSBoYXZlIHRvIHNoaWZ0IHRoZSB0cmFuc2xhdGlvbiBzbyB0aGF0IHdoZW4gdGhlIGNhbnZhcyBpcyBhdCAwLCAwIHRoZVxuICAgIC8vIHdvcmtzcGFjZSBvcmlnaW4gaXMgbm90IHVuZGVybmVhdGggdGhlIHRvb2xib3guXG4gICAgeCArPSBtZXRyaWNzLmFic29sdXRlTGVmdDtcbiAgICB5ICs9IG1ldHJpY3MuYWJzb2x1dGVUb3A7XG4gICAgdGhpcy50cmFuc2xhdGUoeCwgeSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgYmxvY2sgb24gdGhpcyB3b3Jrc3BhY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgYmxvY2sgdG8gZmluZC5cbiAgICogQHJldHVybnMgVGhlIHNvdWdodCBhZnRlciBibG9jaywgb3IgbnVsbCBpZiBub3QgZm91bmQuXG4gICAqL1xuICBvdmVycmlkZSBnZXRCbG9ja0J5SWQoaWQ6IHN0cmluZyk6IEJsb2NrU3ZnfG51bGwge1xuICAgIHJldHVybiBzdXBlci5nZXRCbG9ja0J5SWQoaWQpIGFzIEJsb2NrU3ZnO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYWxsIGJsb2NrcyBpbiB3b3Jrc3BhY2UuICBCbG9ja3MgYXJlIG9wdGlvbmFsbHkgc29ydGVkXG4gICAqIGJ5IHBvc2l0aW9uOyB0b3AgdG8gYm90dG9tICh3aXRoIHNsaWdodCBMVFIgb3IgUlRMIGJpYXMpLlxuICAgKlxuICAgKiBAcGFyYW0gb3JkZXJlZCBTb3J0IHRoZSBsaXN0IGlmIHRydWUuXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGJsb2Nrcy5cbiAgICovXG4gIG92ZXJyaWRlIGdldEFsbEJsb2NrcyhvcmRlcmVkOiBib29sZWFuKTogQmxvY2tTdmdbXSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldEFsbEJsb2NrcyhvcmRlcmVkKSBhcyBCbG9ja1N2Z1tdO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSB0b3AtbGV2ZWwgYmxvY2tzIGFuZCByZXR1cm5zIHRoZW0uICBCbG9ja3MgYXJlIG9wdGlvbmFsbHkgc29ydGVkXG4gICAqIGJ5IHBvc2l0aW9uOyB0b3AgdG8gYm90dG9tICh3aXRoIHNsaWdodCBMVFIgb3IgUlRMIGJpYXMpLlxuICAgKlxuICAgKiBAcGFyYW0gb3JkZXJlZCBTb3J0IHRoZSBsaXN0IGlmIHRydWUuXG4gICAqIEByZXR1cm5zIFRoZSB0b3AtbGV2ZWwgYmxvY2sgb2JqZWN0cy5cbiAgICovXG4gIG92ZXJyaWRlIGdldFRvcEJsb2NrcyhvcmRlcmVkOiBib29sZWFuKTogQmxvY2tTdmdbXSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldFRvcEJsb2NrcyhvcmRlcmVkKSBhcyBCbG9ja1N2Z1tdO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBibG9jayB0byB0aGUgbGlzdCBvZiB0b3AgYmxvY2tzLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgQmxvY2sgdG8gYWRkLlxuICAgKi9cbiAgb3ZlcnJpZGUgYWRkVG9wQmxvY2soYmxvY2s6IEJsb2NrKSB7XG4gICAgdGhpcy5hZGRUb3BCb3VuZGVkRWxlbWVudChibG9jayBhcyBCbG9ja1N2Zyk7XG4gICAgc3VwZXIuYWRkVG9wQmxvY2soYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBibG9jayBmcm9tIHRoZSBsaXN0IG9mIHRvcCBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBCbG9jayB0byByZW1vdmUuXG4gICAqL1xuICBvdmVycmlkZSByZW1vdmVUb3BCbG9jayhibG9jazogQmxvY2spIHtcbiAgICB0aGlzLnJlbW92ZVRvcEJvdW5kZWRFbGVtZW50KGJsb2NrIGFzIEJsb2NrU3ZnKTtcbiAgICBzdXBlci5yZW1vdmVUb3BCbG9jayhibG9jayk7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIGNvbW1lbnQgdG8gdGhlIGxpc3Qgb2YgdG9wIGNvbW1lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gY29tbWVudCBjb21tZW50IHRvIGFkZC5cbiAgICovXG4gIG92ZXJyaWRlIGFkZFRvcENvbW1lbnQoY29tbWVudDogV29ya3NwYWNlQ29tbWVudCkge1xuICAgIHRoaXMuYWRkVG9wQm91bmRlZEVsZW1lbnQoY29tbWVudCBhcyBXb3Jrc3BhY2VDb21tZW50U3ZnKTtcbiAgICBzdXBlci5hZGRUb3BDb21tZW50KGNvbW1lbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBjb21tZW50IGZyb20gdGhlIGxpc3Qgb2YgdG9wIGNvbW1lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gY29tbWVudCBjb21tZW50IHRvIHJlbW92ZS5cbiAgICovXG4gIG92ZXJyaWRlIHJlbW92ZVRvcENvbW1lbnQoY29tbWVudDogV29ya3NwYWNlQ29tbWVudCkge1xuICAgIHRoaXMucmVtb3ZlVG9wQm91bmRlZEVsZW1lbnQoY29tbWVudCBhcyBXb3Jrc3BhY2VDb21tZW50U3ZnKTtcbiAgICBzdXBlci5yZW1vdmVUb3BDb21tZW50KGNvbW1lbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBib3VuZGVkIGVsZW1lbnQgdG8gdGhlIGxpc3Qgb2YgdG9wIGJvdW5kZWQgZWxlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50IEJvdW5kZWQgZWxlbWVudCB0byBhZGQuXG4gICAqL1xuICBhZGRUb3BCb3VuZGVkRWxlbWVudChlbGVtZW50OiBJQm91bmRlZEVsZW1lbnQpIHtcbiAgICB0aGlzLnRvcEJvdW5kZWRFbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBib3VuZGVkIGVsZW1lbnQgZnJvbSB0aGUgbGlzdCBvZiB0b3AgYm91bmRlZCBlbGVtZW50cy5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnQgQm91bmRlZCBlbGVtZW50IHRvIHJlbW92ZS5cbiAgICovXG4gIHJlbW92ZVRvcEJvdW5kZWRFbGVtZW50KGVsZW1lbnQ6IElCb3VuZGVkRWxlbWVudCkge1xuICAgIGFycmF5VXRpbHMucmVtb3ZlRWxlbSh0aGlzLnRvcEJvdW5kZWRFbGVtZW50cywgZWxlbWVudCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIHRvcC1sZXZlbCBib3VuZGVkIGVsZW1lbnRzIGFuZCByZXR1cm5zIHRoZW0uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0b3AtbGV2ZWwgYm91bmRlZCBlbGVtZW50cy5cbiAgICovXG4gIGdldFRvcEJvdW5kZWRFbGVtZW50cygpOiBJQm91bmRlZEVsZW1lbnRbXSB7XG4gICAgcmV0dXJuIChuZXcgQXJyYXk8SUJvdW5kZWRFbGVtZW50PigpKS5jb25jYXQodGhpcy50b3BCb3VuZGVkRWxlbWVudHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB3aGV0aGVyIHRoaXMgd29ya3NwYWNlIGhhcyByZXNpemVzIGVuYWJsZWQuXG4gICAqIElmIGVuYWJsZWQsIHdvcmtzcGFjZSB3aWxsIHJlc2l6ZSB3aGVuIGFwcHJvcHJpYXRlLlxuICAgKiBJZiBkaXNhYmxlZCwgd29ya3NwYWNlIHdpbGwgbm90IHJlc2l6ZSB1bnRpbCByZS1lbmFibGVkLlxuICAgKiBVc2UgdG8gYXZvaWQgcmVzaXppbmcgZHVyaW5nIGEgYmF0Y2ggb3BlcmF0aW9uLCBmb3IgcGVyZm9ybWFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBlbmFibGVkIFdoZXRoZXIgcmVzaXplcyBzaG91bGQgYmUgZW5hYmxlZC5cbiAgICovXG4gIHNldFJlc2l6ZXNFbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCByZWVuYWJsZWQgPSAhdGhpcy5yZXNpemVzRW5hYmxlZCAmJiBlbmFibGVkO1xuICAgIHRoaXMucmVzaXplc0VuYWJsZWQgPSBlbmFibGVkO1xuICAgIGlmIChyZWVuYWJsZWQpIHtcbiAgICAgIC8vIE5ld2x5IGVuYWJsZWQuICBUcmlnZ2VyIGEgcmVzaXplLlxuICAgICAgdGhpcy5yZXNpemVDb250ZW50cygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIGFsbCBibG9ja3MgaW4gd29ya3NwYWNlLCB3aXRoIGFuIG9wdGltaXphdGlvbiB0byBwcmV2ZW50XG4gICAqIHJlc2l6ZXMuXG4gICAqL1xuICBvdmVycmlkZSBjbGVhcigpIHtcbiAgICB0aGlzLnNldFJlc2l6ZXNFbmFibGVkKGZhbHNlKTtcbiAgICBzdXBlci5jbGVhcigpO1xuICAgIHRoaXMudG9wQm91bmRlZEVsZW1lbnRzID0gW107XG4gICAgdGhpcy5zZXRSZXNpemVzRW5hYmxlZCh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGNhbGxiYWNrIGZ1bmN0aW9uIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIGtleSwgZm9yIGNsaWNrcyBvblxuICAgKiBidXR0b25zIGFuZCBsYWJlbHMgaW4gdGhlIGZseW91dC5cbiAgICogRm9yIGluc3RhbmNlLCBhIGJ1dHRvbiBzcGVjaWZpZWQgYnkgdGhlIFhNTFxuICAgKiA8YnV0dG9uIHRleHQ9XCJjcmVhdGUgdmFyaWFibGVcIiBjYWxsYmFja0tleT1cIkNSRUFURV9WQVJJQUJMRVwiPjwvYnV0dG9uPlxuICAgKiBzaG91bGQgYmUgbWF0Y2hlZCBieSBhIGNhbGwgdG9cbiAgICogcmVnaXN0ZXJCdXR0b25DYWxsYmFjayhcIkNSRUFURV9WQVJJQUJMRVwiLCB5b3VyQ2FsbGJhY2tGdW5jdGlvbikuXG4gICAqXG4gICAqIEBwYXJhbSBrZXkgVGhlIG5hbWUgdG8gdXNlIHRvIGxvb2sgdXAgdGhpcyBmdW5jdGlvbi5cbiAgICogQHBhcmFtIGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgZ2l2ZW4gYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqL1xuICByZWdpc3RlckJ1dHRvbkNhbGxiYWNrKGtleTogc3RyaW5nLCBmdW5jOiAocDE6IEZseW91dEJ1dHRvbikgPT4gdm9pZCkge1xuICAgIGlmICh0eXBlb2YgZnVuYyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgVHlwZUVycm9yKCdCdXR0b24gY2FsbGJhY2tzIG11c3QgYmUgZnVuY3Rpb25zLicpO1xuICAgIH1cbiAgICB0aGlzLmZseW91dEJ1dHRvbkNhbGxiYWNrcy5zZXQoa2V5LCBmdW5jKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIGtleSwgZm9yIGNsaWNrcyBvblxuICAgKiBidXR0b25zIGFuZCBsYWJlbHMgaW4gdGhlIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIGtleSBUaGUgbmFtZSB0byB1c2UgdG8gbG9vayB1cCB0aGUgZnVuY3Rpb24uXG4gICAqIEByZXR1cm5zIFRoZSBmdW5jdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBrZXkgZm9yIHRoaXMgd29ya3NwYWNlO1xuICAgKiAgICAgbnVsbCBpZiBubyBjYWxsYmFjayBpcyByZWdpc3RlcmVkLlxuICAgKi9cbiAgZ2V0QnV0dG9uQ2FsbGJhY2soa2V5OiBzdHJpbmcpOiAoKHAxOiBGbHlvdXRCdXR0b24pID0+IHZvaWQpfG51bGwge1xuICAgIHJldHVybiB0aGlzLmZseW91dEJ1dHRvbkNhbGxiYWNrcy5nZXQoa2V5KSA/PyBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIGNhbGxiYWNrIGZvciBhIGNsaWNrIG9uIGEgYnV0dG9uIGluIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSBrZXkgVGhlIG5hbWUgYXNzb2NpYXRlZCB3aXRoIHRoZSBjYWxsYmFjayBmdW5jdGlvbi5cbiAgICovXG4gIHJlbW92ZUJ1dHRvbkNhbGxiYWNrKGtleTogc3RyaW5nKSB7XG4gICAgdGhpcy5mbHlvdXRCdXR0b25DYWxsYmFja3MuZGVsZXRlKGtleSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBjYWxsYmFjayBmdW5jdGlvbiBhc3NvY2lhdGVkIHdpdGggYSBnaXZlbiBrZXksIGZvciBwb3B1bGF0aW5nXG4gICAqIGN1c3RvbSB0b29sYm94IGNhdGVnb3JpZXMgaW4gdGhpcyB3b3Jrc3BhY2UuICBTZWUgdGhlIHZhcmlhYmxlIGFuZFxuICAgKiBwcm9jZWR1cmUgY2F0ZWdvcmllcyBhcyBhbiBleGFtcGxlLlxuICAgKlxuICAgKiBAcGFyYW0ga2V5IFRoZSBuYW1lIHRvIHVzZSB0byBsb29rIHVwIHRoaXMgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGdpdmVuIHRvb2xib3ggY2F0ZWdvcnkgaXMgb3BlbmVkLlxuICAgKi9cbiAgcmVnaXN0ZXJUb29sYm94Q2F0ZWdvcnlDYWxsYmFjayhcbiAgICAgIGtleTogc3RyaW5nLCBmdW5jOiAocDE6IFdvcmtzcGFjZVN2ZykgPT4gdG9vbGJveC5GbHlvdXREZWZpbml0aW9uKSB7XG4gICAgaWYgKHR5cGVvZiBmdW5jICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ1Rvb2xib3ggY2F0ZWdvcnkgY2FsbGJhY2tzIG11c3QgYmUgZnVuY3Rpb25zLicpO1xuICAgIH1cbiAgICB0aGlzLnRvb2xib3hDYXRlZ29yeUNhbGxiYWNrcy5zZXQoa2V5LCBmdW5jKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIGtleSwgZm9yIHBvcHVsYXRpbmdcbiAgICogY3VzdG9tIHRvb2xib3ggY2F0ZWdvcmllcyBpbiB0aGlzIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGtleSBUaGUgbmFtZSB0byB1c2UgdG8gbG9vayB1cCB0aGUgZnVuY3Rpb24uXG4gICAqIEByZXR1cm5zIFRoZSBmdW5jdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBrZXkgZm9yIHRoaXMgd29ya3NwYWNlLCBvclxuICAgKiAgICAgbnVsbCBpZiBubyBmdW5jdGlvbiBpcyByZWdpc3RlcmVkLlxuICAgKi9cbiAgZ2V0VG9vbGJveENhdGVnb3J5Q2FsbGJhY2soa2V5OiBzdHJpbmcpOlxuICAgICAgKChwMTogV29ya3NwYWNlU3ZnKSA9PiB0b29sYm94LkZseW91dERlZmluaXRpb24pfG51bGwge1xuICAgIHJldHVybiB0aGlzLnRvb2xib3hDYXRlZ29yeUNhbGxiYWNrcy5nZXQoa2V5KSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIGNhbGxiYWNrIGZvciBhIGNsaWNrIG9uIGEgY3VzdG9tIGNhdGVnb3J5J3MgbmFtZSBpbiB0aGUgdG9vbGJveC5cbiAgICpcbiAgICogQHBhcmFtIGtleSBUaGUgbmFtZSBhc3NvY2lhdGVkIHdpdGggdGhlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKi9cbiAgcmVtb3ZlVG9vbGJveENhdGVnb3J5Q2FsbGJhY2soa2V5OiBzdHJpbmcpIHtcbiAgICB0aGlzLnRvb2xib3hDYXRlZ29yeUNhbGxiYWNrcy5kZWxldGUoa2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb29rIHVwIHRoZSBnZXN0dXJlIHRoYXQgaXMgdHJhY2tpbmcgdGhpcyB0b3VjaCBzdHJlYW0gb24gdGhpcyB3b3Jrc3BhY2UuXG4gICAqIE1heSBjcmVhdGUgYSBuZXcgZ2VzdHVyZS5cbiAgICpcbiAgICogQHBhcmFtIGUgUG9pbnRlciBldmVudC5cbiAgICogQHJldHVybnMgVGhlIGdlc3R1cmUgdGhhdCBpcyB0cmFja2luZyB0aGlzIHRvdWNoIHN0cmVhbSwgb3IgbnVsbCBpZiBub1xuICAgKiAgICAgdmFsaWQgZ2VzdHVyZSBleGlzdHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0R2VzdHVyZShlOiBQb2ludGVyRXZlbnQpOiBHZXN0dXJlfG51bGwge1xuICAgIGNvbnN0IGlzU3RhcnQgPSBlLnR5cGUgPT09ICdwb2ludGVyZG93bic7XG5cbiAgICBjb25zdCBnZXN0dXJlID0gdGhpcy5jdXJyZW50R2VzdHVyZV87XG4gICAgaWYgKGdlc3R1cmUpIHtcbiAgICAgIGlmIChpc1N0YXJ0ICYmIGdlc3R1cmUuaGFzU3RhcnRlZCgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignVHJpZWQgdG8gc3RhcnQgdGhlIHNhbWUgZ2VzdHVyZSB0d2ljZS4nKTtcbiAgICAgICAgLy8gVGhhdCdzIGZ1bm55LiAgV2UgbXVzdCBoYXZlIG1pc3NlZCBhIG1vdXNlIHVwLlxuICAgICAgICAvLyBDYW5jZWwgaXQsIHJhdGhlciB0aGFuIHRyeSB0byByZXRyaWV2ZSBhbGwgb2YgdGhlIHN0YXRlIHdlIG5lZWQuXG4gICAgICAgIGdlc3R1cmUuY2FuY2VsKCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdlc3R1cmU7XG4gICAgfVxuXG4gICAgLy8gTm8gZ2VzdHVyZSBleGlzdGVkIG9uIHRoaXMgd29ya3NwYWNlLCBidXQgdGhpcyBsb29rcyBsaWtlIHRoZSBzdGFydCBvZiBhXG4gICAgLy8gbmV3IGdlc3R1cmUuXG4gICAgaWYgKGlzU3RhcnQpIHtcbiAgICAgIHRoaXMuY3VycmVudEdlc3R1cmVfID0gbmV3IEdlc3R1cmUoZSwgdGhpcyk7XG4gICAgICByZXR1cm4gdGhpcy5jdXJyZW50R2VzdHVyZV87XG4gICAgfVxuICAgIC8vIE5vIGdlc3R1cmUgZXhpc3RlZCBhbmQgdGhpcyBldmVudCBjb3VsZG4ndCBiZSB0aGUgc3RhcnQgb2YgYSBuZXcgZ2VzdHVyZS5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgcmVmZXJlbmNlIHRvIHRoZSBjdXJyZW50IGdlc3R1cmUuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY2xlYXJHZXN0dXJlKCkge1xuICAgIHRoaXMuY3VycmVudEdlc3R1cmVfID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgdGhlIGN1cnJlbnQgZ2VzdHVyZSwgaWYgb25lIGV4aXN0cy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjYW5jZWxDdXJyZW50R2VzdHVyZSgpIHtcbiAgICBpZiAodGhpcy5jdXJyZW50R2VzdHVyZV8pIHtcbiAgICAgIHRoaXMuY3VycmVudEdlc3R1cmVfLmNhbmNlbCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGF1ZGlvIG1hbmFnZXIgZm9yIHRoaXMgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYXVkaW8gbWFuYWdlciBmb3IgdGhpcyB3b3Jrc3BhY2UuXG4gICAqL1xuICBnZXRBdWRpb01hbmFnZXIoKTogV29ya3NwYWNlQXVkaW8ge1xuICAgIHJldHVybiB0aGlzLmF1ZGlvTWFuYWdlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGdyaWQgb2JqZWN0IGZvciB0aGlzIHdvcmtzcGFjZSwgb3IgbnVsbCBpZiB0aGVyZSBpcyBub25lLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgZ3JpZCBvYmplY3QgZm9yIHRoaXMgd29ya3NwYWNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldEdyaWQoKTogR3JpZHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5ncmlkO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb3NlIHRvb2x0aXBzLCBjb250ZXh0IG1lbnVzLCBkcm9wZG93biBzZWxlY3Rpb25zLCBldGMuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfb25seUNsb3NlUG9wdXBzIFdoZXRoZXIgb25seSBwb3B1cHMgc2hvdWxkIGJlIGNsb3NlZC5cbiAgICovXG4gIGhpZGVDaGFmZihvcHRfb25seUNsb3NlUG9wdXBzPzogYm9vbGVhbikge1xuICAgIFRvb2x0aXAuaGlkZSgpO1xuICAgIFdpZGdldERpdi5oaWRlKCk7XG4gICAgZHJvcERvd25EaXYuaGlkZVdpdGhvdXRBbmltYXRpb24oKTtcblxuICAgIGNvbnN0IG9ubHlDbG9zZVBvcHVwcyA9ICEhb3B0X29ubHlDbG9zZVBvcHVwcztcbiAgICBjb25zdCBhdXRvSGlkZWFibGVzID0gdGhpcy5nZXRDb21wb25lbnRNYW5hZ2VyKCkuZ2V0Q29tcG9uZW50cyhcbiAgICAgICAgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkFVVE9ISURFQUJMRSwgdHJ1ZSk7XG4gICAgYXV0b0hpZGVhYmxlcy5mb3JFYWNoKFxuICAgICAgICAoYXV0b0hpZGVhYmxlKSA9PiBhdXRvSGlkZWFibGUuYXV0b0hpZGUob25seUNsb3NlUG9wdXBzKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgWC9ZIHRyYW5zbGF0aW9ucyBvZiBhIHRvcCBsZXZlbCB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSB4eVJhdGlvIENvbnRhaW5zIGFuIHggYW5kL29yIHkgcHJvcGVydHkgd2hpY2ggaXMgYSBmbG9hdCBiZXR3ZWVuIDBcbiAgICogICAgIGFuZCAxIHNwZWNpZnlpbmcgdGhlIGRlZ3JlZSBvZiBzY3JvbGxpbmcuXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBzZXRUb3BMZXZlbFdvcmtzcGFjZU1ldHJpY3NfKFxuICAgICAgdGhpczogV29ya3NwYWNlU3ZnLCB4eVJhdGlvOiB7eD86IG51bWJlciwgeT86IG51bWJlcn0pIHtcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRNZXRyaWNzKCk7XG5cbiAgICBpZiAodHlwZW9mIHh5UmF0aW8ueCA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMuc2Nyb2xsWCA9XG4gICAgICAgICAgLShtZXRyaWNzLnNjcm9sbExlZnQgK1xuICAgICAgICAgICAgKG1ldHJpY3Muc2Nyb2xsV2lkdGggLSBtZXRyaWNzLnZpZXdXaWR0aCkgKiB4eVJhdGlvLngpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHh5UmF0aW8ueSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMuc2Nyb2xsWSA9XG4gICAgICAgICAgLShtZXRyaWNzLnNjcm9sbFRvcCArXG4gICAgICAgICAgICAobWV0cmljcy5zY3JvbGxIZWlnaHQgLSBtZXRyaWNzLnZpZXdIZWlnaHQpICogeHlSYXRpby55KTtcbiAgICB9XG4gICAgLy8gV2UgaGF2ZSB0byBzaGlmdCB0aGUgdHJhbnNsYXRpb24gc28gdGhhdCB3aGVuIHRoZSBjYW52YXMgaXMgYXQgMCwgMCB0aGVcbiAgICAvLyB3b3Jrc3BhY2Ugb3JpZ2luIGlzIG5vdCB1bmRlcm5lYXRoIHRoZSB0b29sYm94LlxuICAgIGNvbnN0IHggPSB0aGlzLnNjcm9sbFggKyBtZXRyaWNzLmFic29sdXRlTGVmdDtcbiAgICBjb25zdCB5ID0gdGhpcy5zY3JvbGxZICsgbWV0cmljcy5hYnNvbHV0ZVRvcDtcbiAgICAvLyBXZSBjb3VsZCBjYWxsIHNjcm9sbCBoZXJlLCBidXQgdGhhdCBoYXMgZXh0cmEgY2hlY2tzIHdlIGRvbid0IG5lZWQgdG8gZG8uXG4gICAgdGhpcy50cmFuc2xhdGUoeCwgeSk7XG4gIH1cbn1cblxuLyoqXG4gKiBTaXplIHRoZSB3b3Jrc3BhY2Ugd2hlbiB0aGUgY29udGVudHMgY2hhbmdlLiAgVGhpcyBhbHNvIHVwZGF0ZXNcbiAqIHNjcm9sbGJhcnMgYWNjb3JkaW5nbHkuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHJlc2l6ZS5cbiAqIEBhbGlhcyBCbG9ja2x5LldvcmtzcGFjZVN2Zy5yZXNpemVTdmdDb250ZW50c1xuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNpemVTdmdDb250ZW50cyh3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge1xuICB3b3Jrc3BhY2UucmVzaXplQ29udGVudHMoKTtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDb250YWlucyB0b3AtbGV2ZWwgZnVuY3Rpb25zIGZvciBzZXJpYWxpemluZyB3b3Jrc3BhY2VzIHRvIHBsYWluIEphdmFTY3JpcHRcbiAqIG9iamVjdHMuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnNlcmlhbGl6YXRpb24ud29ya3NwYWNlc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnNlcmlhbGl6YXRpb24ud29ya3NwYWNlcycpO1xuXG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4uL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7SVNlcmlhbGl6ZXJ9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9zZXJpYWxpemVyLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi91dGlscy9kb20uanMnO1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4uL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgc3RhdGUgb2YgdGhlIHdvcmtzcGFjZSBhcyBhIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBzZXJpYWxpemUuXG4gKiBAcmV0dXJucyBUaGUgc2VyaWFsaXplZCBzdGF0ZSBvZiB0aGUgd29ya3NwYWNlLlxuICogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi53b3Jrc3BhY2VzLnNhdmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhdmUod29ya3NwYWNlOiBXb3Jrc3BhY2UpOlxuICAgIHtba2V5OiBzdHJpbmddOiBBbnlEdXJpbmdNaWdyYXRpb259IHtcbiAgY29uc3Qgc3RhdGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBjb25zdCBzZXJpYWxpemVyTWFwID0gcmVnaXN0cnkuZ2V0QWxsSXRlbXMocmVnaXN0cnkuVHlwZS5TRVJJQUxJWkVSLCB0cnVlKTtcbiAgZm9yIChjb25zdCBrZXkgaW4gc2VyaWFsaXplck1hcCkge1xuICAgIGNvbnN0IHNhdmUgPSAoc2VyaWFsaXplck1hcFtrZXldIGFzIElTZXJpYWxpemVyKT8uc2F2ZSh3b3Jrc3BhY2UpO1xuICAgIGlmIChzYXZlKSB7XG4gICAgICBzdGF0ZVtrZXldID0gc2F2ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHN0YXRlO1xufVxuXG4vKipcbiAqIExvYWRzIHRoZSB2YXJpYWJsZSByZXByZXNlbnRlZCBieSB0aGUgZ2l2ZW4gc3RhdGUgaW50byB0aGUgZ2l2ZW4gd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2YgdGhlIHdvcmtzcGFjZSB0byBkZXNlcmlhbGl6ZSBpbnRvIHRoZSB3b3Jrc3BhY2UuXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gYWRkIHRoZSBuZXcgc3RhdGUgdG8uXG4gKiBAcGFyYW0gcGFyYW0xIHJlY29yZFVuZG86IElmIHRydWUsIGV2ZW50cyB0cmlnZ2VyZWQgYnkgdGhpcyBmdW5jdGlvbiB3aWxsIGJlXG4gKiAgICAgdW5kby1hYmxlIGJ5IHRoZSB1c2VyLiBGYWxzZSBieSBkZWZhdWx0LlxuICogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi53b3Jrc3BhY2VzLmxvYWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWQoXG4gICAgc3RhdGU6IHtba2V5OiBzdHJpbmddOiBBbnlEdXJpbmdNaWdyYXRpb259LCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSxcbiAgICB7cmVjb3JkVW5kbyA9IGZhbHNlfToge3JlY29yZFVuZG8/OiBib29sZWFufSA9IHt9KSB7XG4gIGNvbnN0IHNlcmlhbGl6ZXJNYXAgPSByZWdpc3RyeS5nZXRBbGxJdGVtcyhyZWdpc3RyeS5UeXBlLlNFUklBTElaRVIsIHRydWUpO1xuICBpZiAoIXNlcmlhbGl6ZXJNYXApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBkZXNlcmlhbGl6ZXJzID0gT2JqZWN0LmVudHJpZXMoc2VyaWFsaXplck1hcClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc29ydChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEsIGIpID0+IChiWzFdIGFzIElTZXJpYWxpemVyKSEucHJpb3JpdHkgLVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFbMV0gYXMgSVNlcmlhbGl6ZXIpIS5wcmlvcml0eSk7XG5cbiAgY29uc3QgcHJldlJlY29yZFVuZG8gPSBldmVudFV0aWxzLmdldFJlY29yZFVuZG8oKTtcbiAgZXZlbnRVdGlscy5zZXRSZWNvcmRVbmRvKHJlY29yZFVuZG8pO1xuICBjb25zdCBleGlzdGluZ0dyb3VwID0gZXZlbnRVdGlscy5nZXRHcm91cCgpO1xuICBpZiAoIWV4aXN0aW5nR3JvdXApIHtcbiAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICB9XG5cbiAgZG9tLnN0YXJ0VGV4dFdpZHRoQ2FjaGUoKTtcbiAgaWYgKHdvcmtzcGFjZSBpbnN0YW5jZW9mIFdvcmtzcGFjZVN2Zykge1xuICAgIHdvcmtzcGFjZS5zZXRSZXNpemVzRW5hYmxlZChmYWxzZSk7XG4gIH1cblxuICAvLyBXZSB3YW50IHRvIHRyaWdnZXIgY2xlYXJpbmcgaW4gcmV2ZXJzZSBwcmlvcml0eSBvcmRlciBzbyBwbHVnaW5zIGRvbid0IGVuZFxuICAvLyB1cCBtaXNzaW5nIGRlcGVuZGVuY2llcy5cbiAgZm9yIChjb25zdCBbLCBkZXNlcmlhbGl6ZXJdIG9mIGRlc2VyaWFsaXplcnMucmV2ZXJzZSgpKSB7XG4gICAgKGRlc2VyaWFsaXplciBhcyBJU2VyaWFsaXplcik/LmNsZWFyKHdvcmtzcGFjZSk7XG4gIH1cblxuICAvLyByZXZlcnNlKCkgaXMgZGVzdHJ1Y3RpdmUsIHNvIHdlIGhhdmUgdG8gcmUtcmV2ZXJzZSB0byBjb3JyZWN0IHRoZSBvcmRlci5cbiAgZm9yIChsZXQgW25hbWUsIGRlc2VyaWFsaXplcl0gb2YgZGVzZXJpYWxpemVycy5yZXZlcnNlKCkpIHtcbiAgICBuYW1lID0gbmFtZTtcbiAgICBjb25zdCBwbHVnaW5TdGF0ZSA9IHN0YXRlW25hbWVdO1xuICAgIGlmIChwbHVnaW5TdGF0ZSkge1xuICAgICAgKGRlc2VyaWFsaXplciBhcyBJU2VyaWFsaXplcik/LmxvYWQoc3RhdGVbbmFtZV0sIHdvcmtzcGFjZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHdvcmtzcGFjZSBpbnN0YW5jZW9mIFdvcmtzcGFjZVN2Zykge1xuICAgIHdvcmtzcGFjZS5zZXRSZXNpemVzRW5hYmxlZCh0cnVlKTtcbiAgfVxuICBkb20uc3RvcFRleHRXaWR0aENhY2hlKCk7XG5cbiAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5GSU5JU0hFRF9MT0FESU5HKSkod29ya3NwYWNlKSk7XG5cbiAgZXZlbnRVdGlscy5zZXRHcm91cChleGlzdGluZ0dyb3VwKTtcbiAgZXZlbnRVdGlscy5zZXRSZWNvcmRVbmRvKHByZXZSZWNvcmRVbmRvKTtcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHtJUGFyYW1ldGVyTW9kZWx9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9wYXJhbWV0ZXJfbW9kZWwuanMnO1xuaW1wb3J0IHtJUHJvY2VkdXJlTW9kZWx9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9wcm9jZWR1cmVfbW9kZWwuanMnO1xuaW1wb3J0IHR5cGUge0lTZXJpYWxpemVyfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfc2VyaWFsaXplci5qcyc7XG5pbXBvcnQge09ic2VydmFibGVQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vcHJvY2VkdXJlcy9vYnNlcnZhYmxlX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQge09ic2VydmFibGVQYXJhbWV0ZXJNb2RlbH0gZnJvbSAnLi4vcHJvY2VkdXJlcy9vYnNlcnZhYmxlX3BhcmFtZXRlcl9tb2RlbC5qcyc7XG5pbXBvcnQgKiBhcyBwcmlvcml0aWVzIGZyb20gJy4vcHJpb3JpdGllcy5qcyc7XG4vLyBpbXBvcnQgKiBhcyBzZXJpYWxpemF0aW9uUmVnaXN0cnkgZnJvbSAnLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYSBwcm9jZWR1cmUgZGF0YSBtb2RlbC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdGF0ZSB7XG4gIC8vIFRPRE86IFRoaXMgc2hvdWxkIGFsc28gaGFuZGxlIGVuYWJsZWQuXG4gIGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgcmV0dXJuVHlwZXM6IHN0cmluZ1tdfG51bGwsXG4gICAgICBwYXJhbWV0ZXJzPzogUGFyYW1ldGVyU3RhdGVbXSxcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRhdGlvbiBvZiBhIHBhcmFtZXRlciBkYXRhIG1vZGVsLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhcmFtZXRlclN0YXRlIHtcbiAgaWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCB0eXBlcz86IHN0cmluZ1tdLFxufVxuXG4vKipcbiAqIEEgbmV3YWJsZSBzaWduYXR1cmUgZm9yIGFuIElQcm9jZWR1cmVNb2RlbC5cbiAqXG4gKiBSZWZlciB0b1xuICogaHR0cHM6Ly93d3cudHlwZXNjcmlwdGxhbmcub3JnL2RvY3MvaGFuZGJvb2svMi9nZW5lcmljcy5odG1sI3VzaW5nLWNsYXNzLXR5cGVzLWluLWdlbmVyaWNzXG4gKiBmb3Igd2hhdCBpcyBnb2luZyBvbiB3aXRoIHRoaXMuXG4gKi9cbnR5cGUgUHJvY2VkdXJlTW9kZWxDb25zdHJ1Y3RvcjxQcm9jZWR1cmVNb2RlbCBleHRlbmRzIElQcm9jZWR1cmVNb2RlbD4gPVxuICAgIG5ldyAod29ya3NwYWNlOiBXb3Jrc3BhY2UsIG5hbWU6IHN0cmluZywgaWQ6IHN0cmluZykgPT4gUHJvY2VkdXJlTW9kZWw7XG5cbi8qKlxuICogQSBuZXdhYmxlIHNpZ25hdHVyZSBmb3IgYW4gSVBhcmFtZXRlck1vZGVsLlxuICpcbiAqIFJlZmVyIHRvXG4gKiBodHRwczovL3d3dy50eXBlc2NyaXB0bGFuZy5vcmcvZG9jcy9oYW5kYm9vay8yL2dlbmVyaWNzLmh0bWwjdXNpbmctY2xhc3MtdHlwZXMtaW4tZ2VuZXJpY3NcbiAqIGZvciB3aGF0IGlzIGdvaW5nIG9uIHdpdGggdGhpcy5cbiAqL1xudHlwZSBQYXJhbWV0ZXJNb2RlbENvbnN0cnVjdG9yPFBhcmFtZXRlck1vZGVsIGV4dGVuZHMgSVBhcmFtZXRlck1vZGVsPiA9XG4gICAgbmV3ICh3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgbmFtZTogc3RyaW5nLCBpZDogc3RyaW5nKSA9PiBQYXJhbWV0ZXJNb2RlbDtcblxuXG4vKipcbiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIElQcm9jZWR1cmVNb2RlbCB0byBKU09OLlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2F2ZVByb2NlZHVyZShwcm9jOiBJUHJvY2VkdXJlTW9kZWwpOiBTdGF0ZSB7XG4gIGNvbnN0IHN0YXRlOiBTdGF0ZSA9IHtcbiAgICBpZDogcHJvYy5nZXRJZCgpLFxuICAgIG5hbWU6IHByb2MuZ2V0TmFtZSgpLFxuICAgIHJldHVyblR5cGVzOiBwcm9jLmdldFJldHVyblR5cGVzKCksXG4gIH07XG4gIGlmICghcHJvYy5nZXRQYXJhbWV0ZXJzKCkubGVuZ3RoKSByZXR1cm4gc3RhdGU7XG4gIHN0YXRlLnBhcmFtZXRlcnMgPSBwcm9jLmdldFBhcmFtZXRlcnMoKS5tYXAoKHBhcmFtKSA9PiBzYXZlUGFyYW1ldGVyKHBhcmFtKSk7XG4gIHJldHVybiBzdGF0ZTtcbn1cblxuLyoqXG4gKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBJUGFyYW1ldGVyTW9kZWwgdG8gSlNPTi5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhdmVQYXJhbWV0ZXIocGFyYW06IElQYXJhbWV0ZXJNb2RlbCk6IFBhcmFtZXRlclN0YXRlIHtcbiAgY29uc3Qgc3RhdGU6IFBhcmFtZXRlclN0YXRlID0ge1xuICAgIGlkOiBwYXJhbS5nZXRJZCgpLFxuICAgIG5hbWU6IHBhcmFtLmdldE5hbWUoKSxcbiAgfTtcbiAgaWYgKCFwYXJhbS5nZXRUeXBlcygpLmxlbmd0aCkgcmV0dXJuIHN0YXRlO1xuICBzdGF0ZS50eXBlcyA9IHBhcmFtLmdldFR5cGVzKCk7XG4gIHJldHVybiBzdGF0ZTtcbn1cblxuLyoqXG4gKiBEZXNlcmlhbGl6ZXMgdGhlIGdpdmVuIHByb2NlZHVyZSBtb2RlbCBTdGF0ZSBmcm9tIEpTT04uXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvblxubG9hZFByb2NlZHVyZTxQcm9jZWR1cmVNb2RlbCBleHRlbmRzIElQcm9jZWR1cmVNb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJhbWV0ZXJNb2RlbCBleHRlbmRzIElQYXJhbWV0ZXJNb2RlbD4oXG4gICAgcHJvY2VkdXJlTW9kZWxDbGFzczogUHJvY2VkdXJlTW9kZWxDb25zdHJ1Y3RvcjxQcm9jZWR1cmVNb2RlbD4sXG4gICAgcGFyYW1ldGVyTW9kZWxDbGFzczogUGFyYW1ldGVyTW9kZWxDb25zdHJ1Y3RvcjxQYXJhbWV0ZXJNb2RlbD4sXG4gICAgc3RhdGU6IFN0YXRlLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IFByb2NlZHVyZU1vZGVsIHtcbiAgY29uc3QgcHJvYyA9IG5ldyBwcm9jZWR1cmVNb2RlbENsYXNzKHdvcmtzcGFjZSwgc3RhdGUubmFtZSwgc3RhdGUuaWQpXG4gICAgICAgICAgICAgICAgICAgLnNldFJldHVyblR5cGVzKHN0YXRlLnJldHVyblR5cGVzKTtcbiAgaWYgKCFzdGF0ZS5wYXJhbWV0ZXJzKSByZXR1cm4gcHJvYztcbiAgZm9yIChjb25zdCBbaW5kZXgsIHBhcmFtXSBvZiBzdGF0ZS5wYXJhbWV0ZXJzLmVudHJpZXMoKSkge1xuICAgIHByb2MuaW5zZXJ0UGFyYW1ldGVyKFxuICAgICAgICBsb2FkUGFyYW1ldGVyKHBhcmFtZXRlck1vZGVsQ2xhc3MsIHBhcmFtLCB3b3Jrc3BhY2UpLCBpbmRleCk7XG4gIH1cbiAgcmV0dXJuIHByb2M7XG59XG5cbi8qKlxuICogRGVzZXJpYWxpemVzIHRoZSBnaXZlbiBQYXJhbWV0ZXJTdGF0ZSBmcm9tIEpTT04uXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2FkUGFyYW1ldGVyPFBhcmFtZXRlck1vZGVsIGV4dGVuZHMgSVBhcmFtZXRlck1vZGVsPihcbiAgICBwYXJhbWV0ZXJNb2RlbENsYXNzOiBQYXJhbWV0ZXJNb2RlbENvbnN0cnVjdG9yPFBhcmFtZXRlck1vZGVsPixcbiAgICBzdGF0ZTogUGFyYW1ldGVyU3RhdGUsIHdvcmtzcGFjZTogV29ya3NwYWNlKTogUGFyYW1ldGVyTW9kZWwge1xuICBjb25zdCBtb2RlbCA9IG5ldyBwYXJhbWV0ZXJNb2RlbENsYXNzKHdvcmtzcGFjZSwgc3RhdGUubmFtZSwgc3RhdGUuaWQpO1xuICBpZiAoc3RhdGUudHlwZXMpIG1vZGVsLnNldFR5cGVzKHN0YXRlLnR5cGVzKTtcbiAgcmV0dXJuIG1vZGVsO1xufVxuXG4vKiogU2VyaWFsaXplciBmb3Igc2F2aW5nIGFuZCBsb2FkaW5nIHByb2NlZHVyZSBzdGF0ZS4gKi9cbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmVTZXJpYWxpemVyPFByb2NlZHVyZU1vZGVsIGV4dGVuZHMgSVByb2NlZHVyZU1vZGVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJhbWV0ZXJNb2RlbCBleHRlbmRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSVBhcmFtZXRlck1vZGVsPiBpbXBsZW1lbnRzIElTZXJpYWxpemVyIHtcbiAgcHVibGljIHByaW9yaXR5ID0gcHJpb3JpdGllcy5QUk9DRURVUkVTO1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIHRoZSBwcm9jZWR1cmUgc2VyaWFsaXplci5cbiAgICpcbiAgICogRXhhbXBsZSB1c2FnZTpcbiAgICogICBuZXcgUHJvY2VkdXJlU2VyaWFsaXplcihNeVByb2NlZHVyZU1vZGVsQ2xhc3MsIE15UGFyYW1ldGVyTW9kZWxDbGFzcylcbiAgICpcbiAgICogQHBhcmFtIHByb2NlZHVyZU1vZGVsQ2xhc3MgVGhlIGNsYXNzIChpbXBsZW1lbnRpbmcgSVByb2NlZHVyZU1vZGVsKSB0aGF0XG4gICAqICAgICB5b3Ugd2FudCB0aGlzIHNlcmlhbGl6ZXIgdG8gZGVzZXJpYWxpemUuXG4gICAqIEBwYXJhbSBwYXJhbWV0ZXJNb2RlbENsYXNzIFRoZSBjbGFzcyAoaW1wbGVtZW50aW5nIElQYXJhbWV0ZXJNb2RlbCkgdGhhdFxuICAgKiAgICAgeW91IHdhbnQgdGhpcyBzZXJpYWxpemVyIHRvIGRlc2VyaWFsaXplLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBwcml2YXRlIHJlYWRvbmx5IHByb2NlZHVyZU1vZGVsQ2xhc3M6XG4gICAgICAgICAgUHJvY2VkdXJlTW9kZWxDb25zdHJ1Y3RvcjxQcm9jZWR1cmVNb2RlbD4sXG4gICAgICBwcml2YXRlIHJlYWRvbmx5IHBhcmFtZXRlck1vZGVsQ2xhc3M6XG4gICAgICAgICAgUGFyYW1ldGVyTW9kZWxDb25zdHJ1Y3RvcjxQYXJhbWV0ZXJNb2RlbD4pIHt9XG5cbiAgLyoqIFNlcmlhbGl6ZXMgdGhlIHByb2NlZHVyZSBtb2RlbHMgb2YgdGhlIGdpdmVuIHdvcmtzcGFjZS4gKi9cbiAgc2F2ZSh3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IFN0YXRlW118bnVsbCB7XG4gICAgcmV0dXJuIHdvcmtzcGFjZS5nZXRQcm9jZWR1cmVNYXAoKS5nZXRQcm9jZWR1cmVzKCkubWFwKFxuICAgICAgICAocHJvYykgPT4gc2F2ZVByb2NlZHVyZShwcm9jKSk7XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBwcm9jZWR1cmVzIG1vZGVscyBkZWZpbmVkIGJ5IHRoZSBnaXZlbiBzdGF0ZSBpbnRvIHRoZVxuICAgKiB3b3Jrc3BhY2UuXG4gICAqL1xuICBsb2FkKHN0YXRlOiBTdGF0ZVtdLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgIGNvbnN0IG1hcCA9IHdvcmtzcGFjZS5nZXRQcm9jZWR1cmVNYXAoKTtcbiAgICBmb3IgKGNvbnN0IHByb2NTdGF0ZSBvZiBzdGF0ZSkge1xuICAgICAgbWFwLmFkZChsb2FkUHJvY2VkdXJlKFxuICAgICAgICAgIHRoaXMucHJvY2VkdXJlTW9kZWxDbGFzcywgdGhpcy5wYXJhbWV0ZXJNb2RlbENsYXNzLCBwcm9jU3RhdGUsXG4gICAgICAgICAgd29ya3NwYWNlKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqIERpc3Bvc2VzIG9mIGFueSBwcm9jZWR1cmUgbW9kZWxzIHRoYXQgZXhpc3Qgb24gdGhlIHdvcmtzcGFjZS4gKi9cbiAgY2xlYXIod29ya3NwYWNlOiBXb3Jrc3BhY2UpIHtcbiAgICB3b3Jrc3BhY2UuZ2V0UHJvY2VkdXJlTWFwKCkuY2xlYXIoKTtcbiAgfVxufVxuXG4vKipcbiAqIEEgUHJvY2VkdXJlU2VyaWFsaXplciB0aGF0IGRlc2VyaWFsaXplcyB0byBjcmVhdGUgdGhlIGJ1aWx0LWluXG4gKiBPYnNlcnZhYmxlUHJvY2VkdXJlTW9kZWxzIGFuZCBPYnNlcnZhYmxlUGFyYW1ldGVyTW9kZWxzLlxuICovXG5leHBvcnQgY29uc3Qgb2JzZXJ2YWJsZVByb2NlZHVyZVNlcmlhbGl6ZXIgPVxuICAgIG5ldyBQcm9jZWR1cmVTZXJpYWxpemVyKE9ic2VydmFibGVQcm9jZWR1cmVNb2RlbCwgT2JzZXJ2YWJsZVBhcmFtZXRlck1vZGVsKTtcblxuLy8gc2VyaWFsaXphdGlvblJlZ2lzdHJ5LnJlZ2lzdGVyKCdwcm9jZWR1cmVzJywgb2JzZXJ2YWJsZVByb2NlZHVyZVNlcmlhbGl6ZXIpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdGllcyBmb3IgYnVtcGluZyBvYmplY3RzIGJhY2sgaW50byB3b3Jrc2FwY2UgYm91bmRzLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5idW1wT2JqZWN0c1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJ1bXBPYmplY3RzJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Fic3RyYWN0fSBmcm9tICcuL2V2ZW50cy9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrQ3JlYXRlfSBmcm9tICcuL2V2ZW50cy9ldmVudHNfYmxvY2tfY3JlYXRlLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja01vdmV9IGZyb20gJy4vZXZlbnRzL2V2ZW50c19ibG9ja19tb3ZlLmpzJztcbmltcG9ydCB0eXBlIHtDb21tZW50Q3JlYXRlfSBmcm9tICcuL2V2ZW50cy9ldmVudHNfY29tbWVudF9jcmVhdGUuanMnO1xuaW1wb3J0IHR5cGUge0NvbW1lbnRNb3ZlfSBmcm9tICcuL2V2ZW50cy9ldmVudHNfY29tbWVudF9tb3ZlLmpzJztcbmltcG9ydCB0eXBlIHtWaWV3cG9ydENoYW5nZX0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX3ZpZXdwb3J0LmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0lCb3VuZGVkRWxlbWVudH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYm91bmRlZF9lbGVtZW50LmpzJztcbmltcG9ydCB0eXBlIHtDb250YWluZXJSZWdpb259IGZyb20gJy4vbWV0cmljc19tYW5hZ2VyLmpzJztcbmltcG9ydCAqIGFzIG1hdGhVdGlscyBmcm9tICcuL3V0aWxzL21hdGguanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZUNvbW1lbnRTdmd9IGZyb20gJy4vd29ya3NwYWNlX2NvbW1lbnRfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBCdW1wcyB0aGUgZ2l2ZW4gb2JqZWN0IHRoYXQgaGFzIHBhc3NlZCBvdXQgb2YgYm91bmRzLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBjb250YWluaW5nIHRoZSBvYmplY3QuXG4gKiBAcGFyYW0gc2Nyb2xsTWV0cmljcyBTY3JvbGwgbWV0cmljc1xuICogICAgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICogQHBhcmFtIG9iamVjdCBUaGUgb2JqZWN0IHRvIGJ1bXAuXG4gKiBAcmV0dXJucyBUcnVlIGlmIGJsb2NrIHdhcyBidW1wZWQuXG4gKiBAYWxpYXMgQmxvY2tseS5idW1wT2JqZWN0cy5idW1wSW50b0JvdW5kc1xuICovXG5mdW5jdGlvbiBidW1wT2JqZWN0SW50b0JvdW5kcyhcbiAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zywgc2Nyb2xsTWV0cmljczogQ29udGFpbmVyUmVnaW9uLFxuICAgIG9iamVjdDogSUJvdW5kZWRFbGVtZW50KTogYm9vbGVhbiB7XG4gIC8vIENvbXB1dGUgbmV3IHRvcC9sZWZ0IHBvc2l0aW9uIGZvciBvYmplY3QuXG4gIGNvbnN0IG9iamVjdE1ldHJpY3MgPSBvYmplY3QuZ2V0Qm91bmRpbmdSZWN0YW5nbGUoKTtcbiAgY29uc3QgaGVpZ2h0ID0gb2JqZWN0TWV0cmljcy5ib3R0b20gLSBvYmplY3RNZXRyaWNzLnRvcDtcbiAgY29uc3Qgd2lkdGggPSBvYmplY3RNZXRyaWNzLnJpZ2h0IC0gb2JqZWN0TWV0cmljcy5sZWZ0O1xuXG4gIGNvbnN0IHRvcENsYW1wID0gc2Nyb2xsTWV0cmljcy50b3A7XG4gIGNvbnN0IHNjcm9sbE1ldHJpY3NCb3R0b20gPSBzY3JvbGxNZXRyaWNzLnRvcCArIHNjcm9sbE1ldHJpY3MuaGVpZ2h0O1xuICBjb25zdCBib3R0b21DbGFtcCA9IHNjcm9sbE1ldHJpY3NCb3R0b20gLSBoZWlnaHQ7XG4gIC8vIElmIHRoZSBvYmplY3QgaXMgdGFsbGVyIHRoYW4gdGhlIHdvcmtzcGFjZSB3ZSB3YW50IHRvXG4gIC8vIHRvcC1hbGlnbiB0aGUgYmxvY2tcbiAgY29uc3QgbmV3WVBvc2l0aW9uID1cbiAgICAgIG1hdGhVdGlscy5jbGFtcCh0b3BDbGFtcCwgb2JqZWN0TWV0cmljcy50b3AsIGJvdHRvbUNsYW1wKTtcbiAgY29uc3QgZGVsdGFZID0gbmV3WVBvc2l0aW9uIC0gb2JqZWN0TWV0cmljcy50b3A7XG5cbiAgLy8gTm90ZTogRXZlbiBpbiBSVEwgbW9kZSB0aGUgXCJhbmNob3JcIiBvZiB0aGUgb2JqZWN0IGlzIHRoZVxuICAvLyB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIG9iamVjdC5cbiAgbGV0IGxlZnRDbGFtcCA9IHNjcm9sbE1ldHJpY3MubGVmdDtcbiAgY29uc3Qgc2Nyb2xsTWV0cmljc1JpZ2h0ID0gc2Nyb2xsTWV0cmljcy5sZWZ0ICsgc2Nyb2xsTWV0cmljcy53aWR0aDtcbiAgbGV0IHJpZ2h0Q2xhbXAgPSBzY3JvbGxNZXRyaWNzUmlnaHQgLSB3aWR0aDtcbiAgaWYgKHdvcmtzcGFjZS5SVEwpIHtcbiAgICAvLyBJZiB0aGUgb2JqZWN0IGlzIHdpZGVyIHRoYW4gdGhlIHdvcmtzcGFjZSBhbmQgd2UncmUgaW4gUlRMXG4gICAgLy8gbW9kZSB3ZSB3YW50IHRvIHJpZ2h0LWFsaWduIHRoZSBibG9jaywgd2hpY2ggbWVhbnMgc2V0dGluZ1xuICAgIC8vIHRoZSBsZWZ0IGNsYW1wIHRvIG1hdGNoLlxuICAgIGxlZnRDbGFtcCA9IE1hdGgubWluKHJpZ2h0Q2xhbXAsIGxlZnRDbGFtcCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gSWYgdGhlIG9iamVjdCBpcyB3aWRlciB0aGFuIHRoZSB3b3Jrc3BhY2UgYW5kIHdlJ3JlIGluIExUUlxuICAgIC8vIG1vZGUgd2Ugd2FudCB0byBsZWZ0LWFsaWduIHRoZSBibG9jaywgd2hpY2ggbWVhbnMgc2V0dGluZ1xuICAgIC8vIHRoZSByaWdodCBjbGFtcCB0byBtYXRjaC5cbiAgICByaWdodENsYW1wID0gTWF0aC5tYXgobGVmdENsYW1wLCByaWdodENsYW1wKTtcbiAgfVxuICBjb25zdCBuZXdYUG9zaXRpb24gPVxuICAgICAgbWF0aFV0aWxzLmNsYW1wKGxlZnRDbGFtcCwgb2JqZWN0TWV0cmljcy5sZWZ0LCByaWdodENsYW1wKTtcbiAgY29uc3QgZGVsdGFYID0gbmV3WFBvc2l0aW9uIC0gb2JqZWN0TWV0cmljcy5sZWZ0O1xuXG4gIGlmIChkZWx0YVggfHwgZGVsdGFZKSB7XG4gICAgb2JqZWN0Lm1vdmVCeShkZWx0YVgsIGRlbHRhWSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0IGNvbnN0IGJ1bXBJbnRvQm91bmRzID0gYnVtcE9iamVjdEludG9Cb3VuZHM7XG5cbi8qKlxuICogQ3JlYXRlcyBhIGhhbmRsZXIgZm9yIGJ1bXBpbmcgb2JqZWN0cyB3aGVuIHRoZXkgY3Jvc3MgZml4ZWQgYm91bmRzLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBoYW5kbGUuXG4gKiBAcmV0dXJucyBUaGUgZXZlbnQgaGFuZGxlci5cbiAqIEBhbGlhcyBCbG9ja2x5LmJ1bXBPYmplY3RzLmJ1bXBJbnRvQm91bmRzSGFuZGxlclxuICovXG5leHBvcnQgZnVuY3Rpb24gYnVtcEludG9Cb3VuZHNIYW5kbGVyKHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKTpcbiAgICAocDE6IEFic3RyYWN0KSA9PiB2b2lkIHtcbiAgcmV0dXJuIChlKSA9PiB7XG4gICAgY29uc3QgbWV0cmljc01hbmFnZXIgPSB3b3Jrc3BhY2UuZ2V0TWV0cmljc01hbmFnZXIoKTtcbiAgICBpZiAoIW1ldHJpY3NNYW5hZ2VyLmhhc0ZpeGVkRWRnZXMoKSB8fCB3b3Jrc3BhY2UuaXNEcmFnZ2luZygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50VXRpbHMuQlVNUF9FVkVOVFMuaW5kZXhPZihlLnR5cGUgPz8gJycpICE9PSAtMSkge1xuICAgICAgY29uc3Qgc2Nyb2xsTWV0cmljc0luV3NDb29yZHMgPSBtZXRyaWNzTWFuYWdlci5nZXRTY3JvbGxNZXRyaWNzKHRydWUpO1xuXG4gICAgICAvLyBUcmlnZ2VyZWQgYnkgbW92ZS9jcmVhdGUgZXZlbnRcbiAgICAgIGNvbnN0IG9iamVjdCA9XG4gICAgICAgICAgZXh0cmFjdE9iamVjdEZyb21FdmVudCh3b3Jrc3BhY2UsIGUgYXMgZXZlbnRVdGlscy5CdW1wRXZlbnQpO1xuICAgICAgaWYgKCFvYmplY3QpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gSGFuZGxlIHVuZG8uXG4gICAgICBjb25zdCBvbGRHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZS5ncm91cCk7XG5cbiAgICAgIGNvbnN0IHdhc0J1bXBlZCA9IGJ1bXBPYmplY3RJbnRvQm91bmRzKFxuICAgICAgICAgIHdvcmtzcGFjZSwgc2Nyb2xsTWV0cmljc0luV3NDb29yZHMsIChvYmplY3QgYXMgSUJvdW5kZWRFbGVtZW50KSk7XG5cbiAgICAgIGlmICh3YXNCdW1wZWQgJiYgIWUuZ3JvdXApIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgJ01vdmVkIG9iamVjdCBpbiBib3VuZHMgYnV0IHRoZXJlIHdhcyBubycgK1xuICAgICAgICAgICAgJyBldmVudCBncm91cC4gVGhpcyBtYXkgYnJlYWsgdW5kby4nKTtcbiAgICAgIH1cbiAgICAgIGlmIChvbGRHcm91cCAhPT0gbnVsbCkge1xuICAgICAgICBldmVudFV0aWxzLnNldEdyb3VwKG9sZEdyb3VwKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGUudHlwZSA9PT0gZXZlbnRVdGlscy5WSUVXUE9SVF9DSEFOR0UpIHtcbiAgICAgIGNvbnN0IHZpZXdwb3J0RXZlbnQgPSAoZSBhcyBWaWV3cG9ydENoYW5nZSk7XG4gICAgICBpZiAodmlld3BvcnRFdmVudC5zY2FsZSAmJiB2aWV3cG9ydEV2ZW50Lm9sZFNjYWxlICYmXG4gICAgICAgICAgdmlld3BvcnRFdmVudC5zY2FsZSA+IHZpZXdwb3J0RXZlbnQub2xkU2NhbGUpIHtcbiAgICAgICAgYnVtcFRvcE9iamVjdHNJbnRvQm91bmRzKHdvcmtzcGFjZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuXG4vKipcbiAqIEV4dHJhY3RzIHRoZSBvYmplY3QgZnJvbSB0aGUgZ2l2ZW4gZXZlbnQuXG4gKlxuICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRoZSBldmVudCBvcmlnaW5hdGVkXG4gKiAgICBmcm9tLlxuICogQHBhcmFtIGUgQW4gZXZlbnQgY29udGFpbmluZyBhbiBvYmplY3QuXG4gKiBAcmV0dXJucyBUaGUgZXh0cmFjdGVkXG4gKiAgICBvYmplY3QuXG4gKi9cbmZ1bmN0aW9uIGV4dHJhY3RPYmplY3RGcm9tRXZlbnQoXG4gICAgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcsIGU6IGV2ZW50VXRpbHMuQnVtcEV2ZW50KTogQmxvY2tTdmd8bnVsbHxcbiAgICBXb3Jrc3BhY2VDb21tZW50U3ZnIHtcbiAgbGV0IG9iamVjdCA9IG51bGw7XG4gIHN3aXRjaCAoZS50eXBlKSB7XG4gICAgY2FzZSBldmVudFV0aWxzLkJMT0NLX0NSRUFURTpcbiAgICBjYXNlIGV2ZW50VXRpbHMuQkxPQ0tfTU9WRTpcbiAgICAgIG9iamVjdCA9IHdvcmtzcGFjZS5nZXRCbG9ja0J5SWQoKGUgYXMgQmxvY2tDcmVhdGUgfCBCbG9ja01vdmUpLmJsb2NrSWQhKTtcbiAgICAgIGlmIChvYmplY3QpIHtcbiAgICAgICAgb2JqZWN0ID0gb2JqZWN0LmdldFJvb3RCbG9jaygpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSBldmVudFV0aWxzLkNPTU1FTlRfQ1JFQVRFOlxuICAgIGNhc2UgZXZlbnRVdGlscy5DT01NRU5UX01PVkU6XG4gICAgICBvYmplY3QgPVxuICAgICAgICAgIHdvcmtzcGFjZS5nZXRDb21tZW50QnlJZCgoZSBhcyBDb21tZW50Q3JlYXRlIHwgQ29tbWVudE1vdmUpLmNvbW1lbnRJZCFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSBhcyBXb3Jrc3BhY2VDb21tZW50U3ZnIHxcbiAgICAgICAgICBudWxsO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIG9iamVjdDtcbn1cblxuLyoqXG4gKiBCdW1wcyB0aGUgdG9wIG9iamVjdHMgaW4gdGhlIGdpdmVuIHdvcmtzcGFjZSBpbnRvIGJvdW5kcy5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UuXG4gKiBAYWxpYXMgQmxvY2tseS5idW1wT2JqZWN0cy5idW1wVG9wT2JqZWN0c0ludG9Cb3VuZHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1bXBUb3BPYmplY3RzSW50b0JvdW5kcyh3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge1xuICBjb25zdCBtZXRyaWNzTWFuYWdlciA9IHdvcmtzcGFjZS5nZXRNZXRyaWNzTWFuYWdlcigpO1xuICBpZiAoIW1ldHJpY3NNYW5hZ2VyLmhhc0ZpeGVkRWRnZXMoKSB8fCB3b3Jrc3BhY2UuaXNEcmFnZ2luZygpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2Nyb2xsTWV0cmljc0luV3NDb29yZHMgPSBtZXRyaWNzTWFuYWdlci5nZXRTY3JvbGxNZXRyaWNzKHRydWUpO1xuICBjb25zdCB0b3BCbG9ja3MgPSB3b3Jrc3BhY2UuZ2V0VG9wQm91bmRlZEVsZW1lbnRzKCk7XG4gIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSB0b3BCbG9ja3NbaV07IGkrKykge1xuICAgIGJ1bXBPYmplY3RJbnRvQm91bmRzKHdvcmtzcGFjZSwgc2Nyb2xsTWV0cmljc0luV3NDb29yZHMsIGJsb2NrKTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEZ1bmN0aW9ucyBmb3IgaW5qZWN0aW5nIEJsb2NrbHkgaW50byBhIHdlYiBwYWdlLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5pbmplY3RcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5pbmplY3QnKTtcblxuaW1wb3J0IHtCbG9ja0RyYWdTdXJmYWNlU3ZnfSBmcm9tICcuL2Jsb2NrX2RyYWdfc3VyZmFjZS5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tseU9wdGlvbnN9IGZyb20gJy4vYmxvY2tseV9vcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBidW1wT2JqZWN0cyBmcm9tICcuL2J1bXBfb2JqZWN0cy5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0ICogYXMgQ3NzIGZyb20gJy4vY3NzLmpzJztcbmltcG9ydCAqIGFzIGRyb3BEb3duRGl2IGZyb20gJy4vZHJvcGRvd25kaXYuanMnO1xuaW1wb3J0IHtHcmlkfSBmcm9tICcuL2dyaWQuanMnO1xuaW1wb3J0IHtNc2d9IGZyb20gJy4vbXNnLmpzJztcbmltcG9ydCB7T3B0aW9uc30gZnJvbSAnLi9vcHRpb25zLmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyUGFpcn0gZnJvbSAnLi9zY3JvbGxiYXJfcGFpci5qcyc7XG5pbXBvcnQge1Nob3J0Y3V0UmVnaXN0cnl9IGZyb20gJy4vc2hvcnRjdXRfcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgVG9vbHRpcCBmcm9tICcuL3Rvb2x0aXAuanMnO1xuaW1wb3J0ICogYXMgVG91Y2ggZnJvbSAnLi90b3VjaC5qcyc7XG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcbmltcG9ydCAqIGFzIHVzZXJBZ2VudCBmcm9tICcuL3V0aWxzL3VzZXJhZ2VudC5qcyc7XG5pbXBvcnQgKiBhcyBXaWRnZXREaXYgZnJvbSAnLi93aWRnZXRkaXYuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VEcmFnU3VyZmFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2VfZHJhZ19zdXJmYWNlX3N2Zy5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIEluamVjdCBhIEJsb2NrbHkgZWRpdG9yIGludG8gdGhlIHNwZWNpZmllZCBjb250YWluZXIgZWxlbWVudCAodXN1YWxseSBhIGRpdikuXG4gKlxuICogQHBhcmFtIGNvbnRhaW5lciBDb250YWluaW5nIGVsZW1lbnQsIG9yIGl0cyBJRCwgb3IgYSBDU1Mgc2VsZWN0b3IuXG4gKiBAcGFyYW0gb3B0X29wdGlvbnMgT3B0aW9uYWwgZGljdGlvbmFyeSBvZiBvcHRpb25zLlxuICogQHJldHVybnMgTmV3bHkgY3JlYXRlZCBtYWluIHdvcmtzcGFjZS5cbiAqIEBhbGlhcyBCbG9ja2x5LmluamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5qZWN0KFxuICAgIGNvbnRhaW5lcjogRWxlbWVudHxzdHJpbmcsIG9wdF9vcHRpb25zPzogQmxvY2tseU9wdGlvbnMpOiBXb3Jrc3BhY2VTdmcge1xuICBpZiAodHlwZW9mIGNvbnRhaW5lciA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ0VsZW1lbnQgfCBudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0b1xuICAgIC8vIHR5cGUgJ3N0cmluZyB8IEVsZW1lbnQnLlxuICAgIGNvbnRhaW5lciA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXIpIHx8XG4gICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKSkgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuICB9XG4gIC8vIFZlcmlmeSB0aGF0IHRoZSBjb250YWluZXIgaXMgaW4gZG9jdW1lbnQuXG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnc3RyaW5nIHwgRWxlbWVudCcgaXMgbm90XG4gIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ05vZGUnLlxuICBpZiAoIWNvbnRhaW5lciB8fFxuICAgICAgIWRvbS5jb250YWluc05vZGUoZG9jdW1lbnQsIGNvbnRhaW5lciBhcyBBbnlEdXJpbmdNaWdyYXRpb24pKSB7XG4gICAgdGhyb3cgRXJyb3IoJ0Vycm9yOiBjb250YWluZXIgaXMgbm90IGluIGN1cnJlbnQgZG9jdW1lbnQuJyk7XG4gIH1cbiAgY29uc3Qgb3B0aW9ucyA9IG5ldyBPcHRpb25zKG9wdF9vcHRpb25zIHx8IHt9IGFzIEJsb2NrbHlPcHRpb25zKTtcbiAgY29uc3Qgc3ViQ29udGFpbmVyID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTtcbiAgc3ViQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdpbmplY3Rpb25EaXYnO1xuICBzdWJDb250YWluZXIudGFiSW5kZXggPSAwO1xuICBhcmlhLnNldFN0YXRlKHN1YkNvbnRhaW5lciwgYXJpYS5TdGF0ZS5MQUJFTCwgTXNnWydXT1JLU1BBQ0VfQVJJQV9MQUJFTCddKTtcblxuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdhcHBlbmRDaGlsZCcgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAvLyAnc3RyaW5nIHwgRWxlbWVudCcuXG4gIChjb250YWluZXIgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5hcHBlbmRDaGlsZChzdWJDb250YWluZXIpO1xuICBjb25zdCBzdmcgPSBjcmVhdGVEb20oc3ViQ29udGFpbmVyLCBvcHRpb25zKTtcblxuICAvLyBDcmVhdGUgc3VyZmFjZXMgZm9yIGRyYWdnaW5nIHRoaW5ncy4gVGhlc2UgYXJlIG9wdGltaXphdGlvbnNcbiAgLy8gc28gdGhhdCB0aGUgYnJvd3NlciBkb2VzIG5vdCByZXBhaW50IGR1cmluZyB0aGUgZHJhZy5cbiAgY29uc3QgYmxvY2tEcmFnU3VyZmFjZSA9IG5ldyBCbG9ja0RyYWdTdXJmYWNlU3ZnKHN1YkNvbnRhaW5lcik7XG5cbiAgY29uc3Qgd29ya3NwYWNlRHJhZ1N1cmZhY2UgPSBuZXcgV29ya3NwYWNlRHJhZ1N1cmZhY2VTdmcoc3ViQ29udGFpbmVyKTtcblxuICBjb25zdCB3b3Jrc3BhY2UgPVxuICAgICAgY3JlYXRlTWFpbldvcmtzcGFjZShzdmcsIG9wdGlvbnMsIGJsb2NrRHJhZ1N1cmZhY2UsIHdvcmtzcGFjZURyYWdTdXJmYWNlKTtcblxuICBpbml0KHdvcmtzcGFjZSk7XG5cbiAgLy8gS2VlcCBmb2N1cyBvbiB0aGUgZmlyc3Qgd29ya3NwYWNlIHNvIGVudGVyaW5nIGtleWJvYXJkIG5hdmlnYXRpb24gbG9va3NcbiAgLy8gY29ycmVjdC5cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdXb3Jrc3BhY2VTdmcnIGlzIG5vdFxuICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdXb3Jrc3BhY2UnLlxuICBjb21tb24uc2V0TWFpbldvcmtzcGFjZSh3b3Jrc3BhY2UgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcblxuICBjb21tb24uc3ZnUmVzaXplKHdvcmtzcGFjZSk7XG5cbiAgc3ViQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCBmdW5jdGlvbigpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ1dvcmtzcGFjZVN2ZycgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnV29ya3NwYWNlJy5cbiAgICBjb21tb24uc2V0TWFpbldvcmtzcGFjZSh3b3Jrc3BhY2UgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHdvcmtzcGFjZTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgdGhlIFNWRyBpbWFnZS5cbiAqXG4gKiBAcGFyYW0gY29udGFpbmVyIENvbnRhaW5pbmcgZWxlbWVudC5cbiAqIEBwYXJhbSBvcHRpb25zIERpY3Rpb25hcnkgb2Ygb3B0aW9ucy5cbiAqIEByZXR1cm5zIE5ld2x5IGNyZWF0ZWQgU1ZHIGltYWdlLlxuICovXG5mdW5jdGlvbiBjcmVhdGVEb20oY29udGFpbmVyOiBFbGVtZW50LCBvcHRpb25zOiBPcHRpb25zKTogRWxlbWVudCB7XG4gIC8vIFNhZGx5IGJyb3dzZXJzIChDaHJvbWUgdnMgRmlyZWZveCkgYXJlIGN1cnJlbnRseSBpbmNvbnNpc3RlbnQgaW4gbGF5aW5nXG4gIC8vIG91dCBjb250ZW50IGluIFJUTCBtb2RlLiAgVGhlcmVmb3JlIEJsb2NrbHkgZm9yY2VzIHRoZSB1c2Ugb2YgTFRSLFxuICAvLyB0aGVuIG1hbnVhbGx5IHBvc2l0aW9ucyBjb250ZW50IGluIFJUTCBhcyBuZWVkZWQuXG4gIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RpcicsICdMVFInKTtcblxuICAvLyBMb2FkIENTUy5cbiAgQ3NzLmluamVjdChvcHRpb25zLmhhc0Nzcywgb3B0aW9ucy5wYXRoVG9NZWRpYSk7XG5cbiAgLy8gQnVpbGQgdGhlIFNWRyBET00uXG4gIC8qXG4gICAgPHN2Z1xuICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiXG4gICAgICB4bWxuczpodG1sPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiXG4gICAgICB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgdmVyc2lvbj1cIjEuMVwiXG4gICAgICBjbGFzcz1cImJsb2NrbHlTdmdcIj5cbiAgICAgIC4uLlxuICAgIDwvc3ZnPlxuICAgICovXG4gIGNvbnN0IHN2ZyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgU3ZnLlNWRywge1xuICAgICAgICAneG1sbnMnOiBkb20uU1ZHX05TLFxuICAgICAgICAneG1sbnM6aHRtbCc6IGRvbS5IVE1MX05TLFxuICAgICAgICAneG1sbnM6eGxpbmsnOiBkb20uWExJTktfTlMsXG4gICAgICAgICd2ZXJzaW9uJzogJzEuMScsXG4gICAgICAgICdjbGFzcyc6ICdibG9ja2x5U3ZnJyxcbiAgICAgICAgJ3RhYmluZGV4JzogJzAnLFxuICAgICAgfSxcbiAgICAgIGNvbnRhaW5lcik7XG4gIC8qXG4gICAgPGRlZnM+XG4gICAgICAuLi4gZmlsdGVycyBnbyBoZXJlIC4uLlxuICAgIDwvZGVmcz5cbiAgICAqL1xuICBjb25zdCBkZWZzID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkRFRlMsIHt9LCBzdmcpO1xuICAvLyBFYWNoIGZpbHRlci9wYXR0ZXJuIG5lZWRzIGEgdW5pcXVlIElEIGZvciB0aGUgY2FzZSBvZiBtdWx0aXBsZSBCbG9ja2x5XG4gIC8vIGluc3RhbmNlcyBvbiBhIHBhZ2UuICBCcm93c2VyIGJlaGF2aW91ciBiZWNvbWVzIHVuZGVmaW5lZCBvdGhlcndpc2UuXG4gIC8vIGh0dHBzOi8vbmVpbC5mcmFzZXIubmFtZS9uZXdzLzIwMTUvMTEvMDEvXG4gIGNvbnN0IHJuZCA9IFN0cmluZyhNYXRoLnJhbmRvbSgpKS5zdWJzdHJpbmcoMik7XG5cbiAgb3B0aW9ucy5ncmlkUGF0dGVybiA9IEdyaWQuY3JlYXRlRG9tKHJuZCwgb3B0aW9ucy5ncmlkT3B0aW9ucywgZGVmcyk7XG4gIHJldHVybiBzdmc7XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgbWFpbiB3b3Jrc3BhY2UgYW5kIGFkZCBpdCB0byB0aGUgU1ZHLlxuICpcbiAqIEBwYXJhbSBzdmcgU1ZHIGVsZW1lbnQgd2l0aCBwYXR0ZXJuIGRlZmluZWQuXG4gKiBAcGFyYW0gb3B0aW9ucyBEaWN0aW9uYXJ5IG9mIG9wdGlvbnMuXG4gKiBAcGFyYW0gYmxvY2tEcmFnU3VyZmFjZSBEcmFnIHN1cmZhY2UgU1ZHIGZvciB0aGUgYmxvY2tzLlxuICogQHBhcmFtIHdvcmtzcGFjZURyYWdTdXJmYWNlIERyYWcgc3VyZmFjZSBTVkcgZm9yIHRoZSB3b3Jrc3BhY2UuXG4gKiBAcmV0dXJucyBOZXdseSBjcmVhdGVkIG1haW4gd29ya3NwYWNlLlxuICovXG5mdW5jdGlvbiBjcmVhdGVNYWluV29ya3NwYWNlKFxuICAgIHN2ZzogRWxlbWVudCwgb3B0aW9uczogT3B0aW9ucywgYmxvY2tEcmFnU3VyZmFjZTogQmxvY2tEcmFnU3VyZmFjZVN2ZyxcbiAgICB3b3Jrc3BhY2VEcmFnU3VyZmFjZTogV29ya3NwYWNlRHJhZ1N1cmZhY2VTdmcpOiBXb3Jrc3BhY2VTdmcge1xuICBvcHRpb25zLnBhcmVudFdvcmtzcGFjZSA9IG51bGw7XG4gIGNvbnN0IG1haW5Xb3Jrc3BhY2UgPVxuICAgICAgbmV3IFdvcmtzcGFjZVN2ZyhvcHRpb25zLCBibG9ja0RyYWdTdXJmYWNlLCB3b3Jrc3BhY2VEcmFnU3VyZmFjZSk7XG4gIGNvbnN0IHdzT3B0aW9ucyA9IG1haW5Xb3Jrc3BhY2Uub3B0aW9ucztcbiAgbWFpbldvcmtzcGFjZS5zY2FsZSA9IHdzT3B0aW9ucy56b29tT3B0aW9ucy5zdGFydFNjYWxlO1xuICBzdmcuYXBwZW5kQ2hpbGQobWFpbldvcmtzcGFjZS5jcmVhdGVEb20oJ2Jsb2NrbHlNYWluQmFja2dyb3VuZCcpKTtcblxuICAvLyBTZXQgdGhlIHRoZW1lIG5hbWUgYW5kIHJlbmRlcmVyIG5hbWUgb250byB0aGUgaW5qZWN0aW9uIGRpdi5cbiAgY29uc3QgaW5qZWN0aW9uRGl2ID0gbWFpbldvcmtzcGFjZS5nZXRJbmplY3Rpb25EaXYoKTtcbiAgY29uc3QgcmVuZGVyZXJDbGFzc05hbWUgPSBtYWluV29ya3NwYWNlLmdldFJlbmRlcmVyKCkuZ2V0Q2xhc3NOYW1lKCk7XG4gIGlmIChyZW5kZXJlckNsYXNzTmFtZSkge1xuICAgIGRvbS5hZGRDbGFzcyhpbmplY3Rpb25EaXYsIHJlbmRlcmVyQ2xhc3NOYW1lKTtcbiAgfVxuICBjb25zdCB0aGVtZUNsYXNzTmFtZSA9IG1haW5Xb3Jrc3BhY2UuZ2V0VGhlbWUoKS5nZXRDbGFzc05hbWUoKTtcbiAgaWYgKHRoZW1lQ2xhc3NOYW1lKSB7XG4gICAgZG9tLmFkZENsYXNzKGluamVjdGlvbkRpdiwgdGhlbWVDbGFzc05hbWUpO1xuICB9XG5cbiAgaWYgKCF3c09wdGlvbnMuaGFzQ2F0ZWdvcmllcyAmJiB3c09wdGlvbnMubGFuZ3VhZ2VUcmVlKSB7XG4gICAgLy8gQWRkIGZseW91dCBhcyBhbiA8c3ZnPiB0aGF0IGlzIGEgc2libGluZyBvZiB0aGUgd29ya3NwYWNlIFNWRy5cbiAgICBjb25zdCBmbHlvdXQgPSBtYWluV29ya3NwYWNlLmFkZEZseW91dChTdmcuU1ZHKTtcbiAgICBkb20uaW5zZXJ0QWZ0ZXIoZmx5b3V0LCBzdmcpO1xuICB9XG4gIGlmICh3c09wdGlvbnMuaGFzVHJhc2hjYW4pIHtcbiAgICBtYWluV29ya3NwYWNlLmFkZFRyYXNoY2FuKCk7XG4gIH1cbiAgaWYgKHdzT3B0aW9ucy56b29tT3B0aW9ucyAmJiB3c09wdGlvbnMuem9vbU9wdGlvbnMuY29udHJvbHMpIHtcbiAgICBtYWluV29ya3NwYWNlLmFkZFpvb21Db250cm9scygpO1xuICB9XG4gIC8vIFJlZ2lzdGVyIHRoZSB3b3Jrc3BhY2Ugc3ZnIGFzIGEgVUkgY29tcG9uZW50LlxuICBtYWluV29ya3NwYWNlLmdldFRoZW1lTWFuYWdlcigpLnN1YnNjcmliZShcbiAgICAgIHN2ZywgJ3dvcmtzcGFjZUJhY2tncm91bmRDb2xvdXInLCAnYmFja2dyb3VuZC1jb2xvcicpO1xuXG4gIC8vIEEgbnVsbCB0cmFuc2xhdGlvbiB3aWxsIGFsc28gYXBwbHkgdGhlIGNvcnJlY3QgaW5pdGlhbCBzY2FsZS5cbiAgbWFpbldvcmtzcGFjZS50cmFuc2xhdGUoMCwgMCk7XG5cbiAgbWFpbldvcmtzcGFjZS5hZGRDaGFuZ2VMaXN0ZW5lcihcbiAgICAgIGJ1bXBPYmplY3RzLmJ1bXBJbnRvQm91bmRzSGFuZGxlcihtYWluV29ya3NwYWNlKSk7XG5cbiAgLy8gVGhlIFNWRyBpcyBub3cgZnVsbHkgYXNzZW1ibGVkLlxuICBjb21tb24uc3ZnUmVzaXplKG1haW5Xb3Jrc3BhY2UpO1xuICBXaWRnZXREaXYuY3JlYXRlRG9tKCk7XG4gIGRyb3BEb3duRGl2LmNyZWF0ZURvbSgpO1xuICBUb29sdGlwLmNyZWF0ZURvbSgpO1xuICByZXR1cm4gbWFpbldvcmtzcGFjZTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIEJsb2NrbHkgd2l0aCB2YXJpb3VzIGhhbmRsZXJzLlxuICpcbiAqIEBwYXJhbSBtYWluV29ya3NwYWNlIE5ld2x5IGNyZWF0ZWQgbWFpbiB3b3Jrc3BhY2UuXG4gKi9cbmZ1bmN0aW9uIGluaXQobWFpbldvcmtzcGFjZTogV29ya3NwYWNlU3ZnKSB7XG4gIGNvbnN0IG9wdGlvbnMgPSBtYWluV29ya3NwYWNlLm9wdGlvbnM7XG4gIGNvbnN0IHN2ZyA9IG1haW5Xb3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCk7XG5cbiAgLy8gU3VwcHJlc3MgdGhlIGJyb3dzZXIncyBjb250ZXh0IG1lbnUuXG4gIGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgc3ZnLnBhcmVudE5vZGUgYXMgRWxlbWVudCwgJ2NvbnRleHRtZW51JywgbnVsbCxcbiAgICAgIGZ1bmN0aW9uKGU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgICAgICBpZiAoIWJyb3dzZXJFdmVudHMuaXNUYXJnZXRJbnB1dChlKSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgY29uc3Qgd29ya3NwYWNlUmVzaXplSGFuZGxlciA9XG4gICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZCh3aW5kb3csICdyZXNpemUnLCBudWxsLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbWFpbldvcmtzcGFjZS5oaWRlQ2hhZmYodHJ1ZSk7XG4gICAgICAgIGNvbW1vbi5zdmdSZXNpemUobWFpbldvcmtzcGFjZSk7XG4gICAgICAgIGJ1bXBPYmplY3RzLmJ1bXBUb3BPYmplY3RzSW50b0JvdW5kcyhtYWluV29ya3NwYWNlKTtcbiAgICAgIH0pO1xuICBtYWluV29ya3NwYWNlLnNldFJlc2l6ZUhhbmRsZXJXcmFwcGVyKHdvcmtzcGFjZVJlc2l6ZUhhbmRsZXIpO1xuXG4gIGJpbmREb2N1bWVudEV2ZW50cygpO1xuXG4gIGlmIChvcHRpb25zLmxhbmd1YWdlVHJlZSkge1xuICAgIGNvbnN0IHRvb2xib3ggPSBtYWluV29ya3NwYWNlLmdldFRvb2xib3goKTtcbiAgICBjb25zdCBmbHlvdXQgPSBtYWluV29ya3NwYWNlLmdldEZseW91dCh0cnVlKTtcbiAgICBpZiAodG9vbGJveCkge1xuICAgICAgdG9vbGJveC5pbml0KCk7XG4gICAgfSBlbHNlIGlmIChmbHlvdXQpIHtcbiAgICAgIC8vIEJ1aWxkIGEgZml4ZWQgZmx5b3V0IHdpdGggdGhlIHJvb3QgYmxvY2tzLlxuICAgICAgZmx5b3V0LmluaXQobWFpbldvcmtzcGFjZSk7XG4gICAgICBmbHlvdXQuc2hvdyhvcHRpb25zLmxhbmd1YWdlVHJlZSk7XG4gICAgICBpZiAodHlwZW9mIGZseW91dC5zY3JvbGxUb1N0YXJ0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGZseW91dC5zY3JvbGxUb1N0YXJ0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKG9wdGlvbnMuaGFzVHJhc2hjYW4pIHtcbiAgICBtYWluV29ya3NwYWNlLnRyYXNoY2FuIS5pbml0KCk7XG4gIH1cbiAgaWYgKG9wdGlvbnMuem9vbU9wdGlvbnMgJiYgb3B0aW9ucy56b29tT3B0aW9ucy5jb250cm9scykge1xuICAgIG1haW5Xb3Jrc3BhY2Uuem9vbUNvbnRyb2xzXyEuaW5pdCgpO1xuICB9XG5cbiAgaWYgKG9wdGlvbnMubW92ZU9wdGlvbnMgJiYgb3B0aW9ucy5tb3ZlT3B0aW9ucy5zY3JvbGxiYXJzKSB7XG4gICAgY29uc3QgaG9yaXpvbnRhbFNjcm9sbCA9IG9wdGlvbnMubW92ZU9wdGlvbnMuc2Nyb2xsYmFycyA9PT0gdHJ1ZSB8fFxuICAgICAgICAhIW9wdGlvbnMubW92ZU9wdGlvbnMuc2Nyb2xsYmFycy5ob3Jpem9udGFsO1xuICAgIGNvbnN0IHZlcnRpY2FsU2Nyb2xsID0gb3B0aW9ucy5tb3ZlT3B0aW9ucy5zY3JvbGxiYXJzID09PSB0cnVlIHx8XG4gICAgICAgICEhb3B0aW9ucy5tb3ZlT3B0aW9ucy5zY3JvbGxiYXJzLnZlcnRpY2FsO1xuICAgIG1haW5Xb3Jrc3BhY2Uuc2Nyb2xsYmFyID0gbmV3IFNjcm9sbGJhclBhaXIoXG4gICAgICAgIG1haW5Xb3Jrc3BhY2UsIGhvcml6b250YWxTY3JvbGwsIHZlcnRpY2FsU2Nyb2xsLFxuICAgICAgICAnYmxvY2tseU1haW5Xb3Jrc3BhY2VTY3JvbGxiYXInKTtcbiAgICBtYWluV29ya3NwYWNlLnNjcm9sbGJhci5yZXNpemUoKTtcbiAgfSBlbHNlIHtcbiAgICBtYWluV29ya3NwYWNlLnNldE1ldHJpY3Moe3g6IDAuNSwgeTogMC41fSk7XG4gIH1cblxuICAvLyBMb2FkIHRoZSBzb3VuZHMuXG4gIGlmIChvcHRpb25zLmhhc1NvdW5kcykge1xuICAgIGxvYWRTb3VuZHMob3B0aW9ucy5wYXRoVG9NZWRpYSwgbWFpbldvcmtzcGFjZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBIYW5kbGUgYSBrZXktZG93biBvbiBTVkcgZHJhd2luZyBzdXJmYWNlLiBEb2VzIG5vdGhpbmcgaWYgdGhlIG1haW4gd29ya3NwYWNlXG4gKiBpcyBub3QgdmlzaWJsZS5cbiAqXG4gKiBAcGFyYW0gZSBLZXkgZG93biBldmVudC5cbiAqL1xuLy8gVE9ETyAoaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9ibG9ja2x5L2lzc3Vlcy8xOTk4KSBoYW5kbGUgY2FzZXMgd2hlcmUgdGhlcmVcbi8vIGFyZSBtdWx0aXBsZSB3b3Jrc3BhY2VzIGFuZCBub24tbWFpbiB3b3Jrc3BhY2VzIGFyZSBhYmxlIHRvIGFjY2VwdCBpbnB1dC5cbmZ1bmN0aW9uIG9uS2V5RG93bihlOiBLZXlib2FyZEV2ZW50KSB7XG4gIGNvbnN0IG1haW5Xb3Jrc3BhY2UgPSBjb21tb24uZ2V0TWFpbldvcmtzcGFjZSgpIGFzIFdvcmtzcGFjZVN2ZztcbiAgaWYgKCFtYWluV29ya3NwYWNlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGJyb3dzZXJFdmVudHMuaXNUYXJnZXRJbnB1dChlKSB8fFxuICAgICAgbWFpbldvcmtzcGFjZS5yZW5kZXJlZCAmJiAhbWFpbldvcmtzcGFjZS5pc1Zpc2libGUoKSkge1xuICAgIC8vIFdoZW4gZm9jdXNlZCBvbiBhbiBIVE1MIHRleHQgaW5wdXQgd2lkZ2V0LCBkb24ndCB0cmFwIGFueSBrZXlzLlxuICAgIC8vIElnbm9yZSBrZXlwcmVzc2VzIG9uIHJlbmRlcmVkIHdvcmtzcGFjZXMgdGhhdCBoYXZlIGJlZW4gZXhwbGljaXRseVxuICAgIC8vIGhpZGRlbi5cbiAgICByZXR1cm47XG4gIH1cbiAgU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5vbktleURvd24obWFpbldvcmtzcGFjZSwgZSk7XG59XG5cbi8qKlxuICogV2hldGhlciBldmVudCBoYW5kbGVycyBoYXZlIGJlZW4gYm91bmQuIERvY3VtZW50IGV2ZW50IGhhbmRsZXJzIHdpbGwgb25seVxuICogYmUgYm91bmQgb25jZSwgZXZlbiBpZiBCbG9ja2x5IGlzIGRlc3Ryb3llZCBhbmQgcmVpbmplY3RlZC5cbiAqL1xubGV0IGRvY3VtZW50RXZlbnRzQm91bmQgPSBmYWxzZTtcblxuLyoqXG4gKiBCaW5kIGRvY3VtZW50IGV2ZW50cywgYnV0IG9ubHkgb25jZS4gIERlc3Ryb3lpbmcgYW5kIHJlaW5qZWN0aW5nIEJsb2NrbHlcbiAqIHNob3VsZCBub3QgYmluZCBhZ2Fpbi5cbiAqIEJpbmQgZXZlbnRzIGZvciBzY3JvbGxpbmcgdGhlIHdvcmtzcGFjZS5cbiAqIE1vc3Qgb2YgdGhlc2UgZXZlbnRzIHNob3VsZCBiZSBib3VuZCB0byB0aGUgU1ZHJ3Mgc3VyZmFjZS5cbiAqIEhvd2V2ZXIsICdtb3VzZXVwJyBoYXMgdG8gYmUgb24gdGhlIHdob2xlIGRvY3VtZW50IHNvIHRoYXQgYSBibG9jayBkcmFnZ2VkXG4gKiBvdXQgb2YgYm91bmRzIGFuZCByZWxlYXNlZCB3aWxsIGtub3cgdGhhdCBpdCBoYXMgYmVlbiByZWxlYXNlZC5cbiAqIEFsc28sICdrZXlkb3duJyBoYXMgdG8gYmUgb24gdGhlIHdob2xlIGRvY3VtZW50IHNpbmNlIHRoZSBicm93c2VyIGRvZXNuJ3RcbiAqIHVuZGVyc3RhbmQgYSBjb25jZXB0IG9mIGZvY3VzIG9uIHRoZSBTVkcgaW1hZ2UuXG4gKi9cbmZ1bmN0aW9uIGJpbmREb2N1bWVudEV2ZW50cygpIHtcbiAgaWYgKCFkb2N1bWVudEV2ZW50c0JvdW5kKSB7XG4gICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoZG9jdW1lbnQsICdzY3JvbGwnLCBudWxsLCBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHdvcmtzcGFjZXMgPSBjb21tb24uZ2V0QWxsV29ya3NwYWNlcygpO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIHdvcmtzcGFjZTsgd29ya3NwYWNlID0gd29ya3NwYWNlc1tpXTsgaSsrKSB7XG4gICAgICAgIGlmICh3b3Jrc3BhY2UgaW5zdGFuY2VvZiBXb3Jrc3BhY2VTdmcpIHtcbiAgICAgICAgICB3b3Jrc3BhY2UudXBkYXRlSW52ZXJzZVNjcmVlbkNUTSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoZG9jdW1lbnQsICdrZXlkb3duJywgbnVsbCwgb25LZXlEb3duKTtcbiAgICAvLyBsb25nU3RvcCBuZWVkcyB0byBydW4gdG8gc3RvcCB0aGUgY29udGV4dCBtZW51IGZyb20gc2hvd2luZyB1cC4gIEl0XG4gICAgLy8gc2hvdWxkIHJ1biByZWdhcmRsZXNzIG9mIHdoYXQgb3RoZXIgdG91Y2ggZXZlbnQgaGFuZGxlcnMgaGF2ZSBydW4uXG4gICAgYnJvd3NlckV2ZW50cy5iaW5kKGRvY3VtZW50LCAndG91Y2hlbmQnLCBudWxsLCBUb3VjaC5sb25nU3RvcCk7XG4gICAgYnJvd3NlckV2ZW50cy5iaW5kKGRvY3VtZW50LCAndG91Y2hjYW5jZWwnLCBudWxsLCBUb3VjaC5sb25nU3RvcCk7XG4gICAgLy8gU29tZSBpUGFkIHZlcnNpb25zIGRvbid0IGZpcmUgcmVzaXplIGFmdGVyIHBvcnRyYWl0IHRvIGxhbmRzY2FwZSBjaGFuZ2UuXG4gICAgaWYgKHVzZXJBZ2VudC5JUEFEKSB7XG4gICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICB3aW5kb3csICdvcmllbnRhdGlvbmNoYW5nZScsIGRvY3VtZW50LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIFRPRE8gKCMzOTcpOiBGaXggZm9yIG11bHRpcGxlIEJsb2NrbHkgd29ya3NwYWNlcy5cbiAgICAgICAgICAgIGNvbW1vbi5zdmdSZXNpemUoY29tbW9uLmdldE1haW5Xb3Jrc3BhY2UoKSBhcyBXb3Jrc3BhY2VTdmcpO1xuICAgICAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBkb2N1bWVudEV2ZW50c0JvdW5kID0gdHJ1ZTtcbn1cblxuLyoqXG4gKiBMb2FkIHNvdW5kcyBmb3IgdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAqXG4gKiBAcGFyYW0gcGF0aFRvTWVkaWEgVGhlIHBhdGggdG8gdGhlIG1lZGlhIGRpcmVjdG9yeS5cbiAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBsb2FkIHNvdW5kcyBmb3IuXG4gKi9cbmZ1bmN0aW9uIGxvYWRTb3VuZHMocGF0aFRvTWVkaWE6IHN0cmluZywgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpIHtcbiAgY29uc3QgYXVkaW9NZ3IgPSB3b3Jrc3BhY2UuZ2V0QXVkaW9NYW5hZ2VyKCk7XG4gIGF1ZGlvTWdyLmxvYWQoXG4gICAgICBbXG4gICAgICAgIHBhdGhUb01lZGlhICsgJ2NsaWNrLm1wMycsXG4gICAgICAgIHBhdGhUb01lZGlhICsgJ2NsaWNrLndhdicsXG4gICAgICAgIHBhdGhUb01lZGlhICsgJ2NsaWNrLm9nZycsXG4gICAgICBdLFxuICAgICAgJ2NsaWNrJyk7XG4gIGF1ZGlvTWdyLmxvYWQoXG4gICAgICBbXG4gICAgICAgIHBhdGhUb01lZGlhICsgJ2Rpc2Nvbm5lY3Qud2F2JyxcbiAgICAgICAgcGF0aFRvTWVkaWEgKyAnZGlzY29ubmVjdC5tcDMnLFxuICAgICAgICBwYXRoVG9NZWRpYSArICdkaXNjb25uZWN0Lm9nZycsXG4gICAgICBdLFxuICAgICAgJ2Rpc2Nvbm5lY3QnKTtcbiAgYXVkaW9NZ3IubG9hZChcbiAgICAgIFtcbiAgICAgICAgcGF0aFRvTWVkaWEgKyAnZGVsZXRlLm1wMycsXG4gICAgICAgIHBhdGhUb01lZGlhICsgJ2RlbGV0ZS5vZ2cnLFxuICAgICAgICBwYXRoVG9NZWRpYSArICdkZWxldGUud2F2JyxcbiAgICAgIF0sXG4gICAgICAnZGVsZXRlJyk7XG5cbiAgLy8gQmluZCB0ZW1wb3JhcnkgaG9va3MgdGhhdCBwcmVsb2FkIHRoZSBzb3VuZHMuXG4gIGNvbnN0IHNvdW5kQmluZHM6IEFueUR1cmluZ01pZ3JhdGlvbltdID0gW107XG4gIC8qKlxuICAgKlxuICAgKi9cbiAgZnVuY3Rpb24gdW5iaW5kU291bmRzKCkge1xuICAgIHdoaWxlIChzb3VuZEJpbmRzLmxlbmd0aCkge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQoc291bmRCaW5kcy5wb3AoKSk7XG4gICAgfVxuICAgIGF1ZGlvTWdyLnByZWxvYWQoKTtcbiAgfVxuXG4gIC8vIFRoZXNlIGFyZSBib3VuZCBvbiBtb3VzZS90b3VjaCBldmVudHMgd2l0aFxuICAvLyBCbG9ja2x5LmJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kLCBzbyB0aGV5IHJlc3RyaWN0IHRoZSB0b3VjaFxuICAvLyBpZGVudGlmaWVyIHRoYXQgd2lsbCBiZSByZWNvZ25pemVkLiAgQnV0IHRoaXMgaXMgcmVhbGx5IHNvbWV0aGluZyB0aGF0XG4gIC8vIGhhcHBlbnMgb24gYSBjbGljaywgbm90IGEgZHJhZywgc28gdGhhdCdzIG5vdCBuZWNlc3NhcnkuXG5cbiAgLy8gQW5kcm9pZCBpZ25vcmVzIGFueSBzb3VuZCBub3QgbG9hZGVkIGFzIGEgcmVzdWx0IG9mIGEgdXNlciBhY3Rpb24uXG4gIHNvdW5kQmluZHMucHVzaChicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgIGRvY3VtZW50LCAncG9pbnRlcm1vdmUnLCBudWxsLCB1bmJpbmRTb3VuZHMsIHRydWUpKTtcbiAgc291bmRCaW5kcy5wdXNoKGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgZG9jdW1lbnQsICd0b3VjaHN0YXJ0JywgbnVsbCwgdW5iaW5kU291bmRzLCB0cnVlKSk7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB0eXBlIHtJUGFyYW1ldGVyTW9kZWx9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9wYXJhbWV0ZXJfbW9kZWwuanMnO1xuaW1wb3J0IHR5cGUge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5pbXBvcnQge1Byb2NlZHVyZVBhcmFtZXRlckJhc2UsIFByb2NlZHVyZVBhcmFtZXRlckJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfcGFyYW1ldGVyX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgcGFyYW1ldGVyIG9mIGEgcHJvY2VkdXJlIGJlaW5nIHJlbmFtZWQuXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmVQYXJhbWV0ZXJSZW5hbWUgZXh0ZW5kcyBQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlIHtcbiAgLyoqIEEgc3RyaW5nIHVzZWQgdG8gY2hlY2sgdGhlIHR5cGUgb2YgdGhlIGV2ZW50LiAqL1xuICB0eXBlID0gZXZlbnRVdGlscy5QUk9DRURVUkVfUEFSQU1FVEVSX1JFTkFNRTtcbiAgcHJpdmF0ZSByZWFkb25seSBuZXdOYW1lOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgcHJvY2VkdXJlOiBJUHJvY2VkdXJlTW9kZWwsXG4gICAgICBwYXJhbWV0ZXI6IElQYXJhbWV0ZXJNb2RlbCwgcHVibGljIHJlYWRvbmx5IG9sZE5hbWU6IHN0cmluZykge1xuICAgIHN1cGVyKHdvcmtzcGFjZSwgcHJvY2VkdXJlLCBwYXJhbWV0ZXIpO1xuXG4gICAgdGhpcy5uZXdOYW1lID0gcGFyYW1ldGVyLmdldE5hbWUoKTtcbiAgfVxuXG4gIHJ1bihmb3J3YXJkOiBib29sZWFuKSB7XG4gICAgY29uc3QgcGFyYW1ldGVyTW9kZWwgPSBmaW5kTWF0Y2hpbmdQYXJhbWV0ZXIoXG4gICAgICAgIHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCksIHRoaXMubW9kZWwuZ2V0SWQoKSwgdGhpcy5wYXJhbWV0ZXIuZ2V0SWQoKSk7XG4gICAgaWYgKCFwYXJhbWV0ZXJNb2RlbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgcmVuYW1lIGEgcGFyYW1ldGVyIHRoYXQgZG9lcyBub3QgZXhpc3QgJyArXG4gICAgICAgICAgJ2luIHRoZSBwcm9jZWR1cmUgbWFwJyk7XG4gICAgfVxuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICBwYXJhbWV0ZXJNb2RlbC5zZXROYW1lKHRoaXMubmV3TmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmFtZXRlck1vZGVsLnNldE5hbWUodGhpcy5vbGROYW1lKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIHRoZSBldmVudCBhcyBKU09OLlxuICAgKlxuICAgKiBAcmV0dXJucyBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgdG9Kc29uKCk6IFByb2NlZHVyZVBhcmFtZXRlclJlbmFtZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBQcm9jZWR1cmVQYXJhbWV0ZXJSZW5hbWVKc29uO1xuICAgIGpzb25bJ29sZE5hbWUnXSA9IHRoaXMub2xkTmFtZTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IFByb2NlZHVyZVBhcmFtZXRlclJlbmFtZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlKTpcbiAgICAgIFByb2NlZHVyZVBhcmFtZXRlclJlbmFtZSB7XG4gICAgY29uc3QgbW9kZWwgPSB3b3Jrc3BhY2UuZ2V0UHJvY2VkdXJlTWFwKCkuZ2V0KGpzb25bJ3Byb2NlZHVyZUlkJ10pO1xuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IGRlc2VyaWFsaXplIHByb2NlZHVyZSBkZWxldGUgZXZlbnQgYmVjYXVzZSB0aGUgJyArXG4gICAgICAgICAgJ3RhcmdldCBwcm9jZWR1cmUgZG9lcyBub3QgZXhpc3QnKTtcbiAgICB9XG4gICAgY29uc3QgcGFyYW0gPSBmaW5kTWF0Y2hpbmdQYXJhbWV0ZXIoXG4gICAgICAgIHdvcmtzcGFjZSwganNvblsncHJvY2VkdXJlSWQnXSwganNvblsncGFyYW1ldGVySWQnXSk7XG4gICAgaWYgKCFwYXJhbSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgZGVzZXJpYWxpemUgcGFyYW1ldGVyIHJlbmFtZSBldmVudCBiZWNhdXNlIHRoZSAnICtcbiAgICAgICAgICAndGFyZ2V0IHBhcmFtZXRlciBkb2VzIG5vdCBleGlzdCcpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFByb2NlZHVyZVBhcmFtZXRlclJlbmFtZShcbiAgICAgICAgd29ya3NwYWNlLCBtb2RlbCwgcGFyYW0sIGpzb25bJ29sZE5hbWUnXSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZmluZE1hdGNoaW5nUGFyYW1ldGVyKFxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlLCBtb2RlbElkOiBzdHJpbmcsIHBhcmFtSWQ6IHN0cmluZyk6IElQYXJhbWV0ZXJNb2RlbHxcbiAgICB1bmRlZmluZWQge1xuICBjb25zdCBwcm9jZWR1cmVNb2RlbCA9IHdvcmtzcGFjZS5nZXRQcm9jZWR1cmVNYXAoKS5nZXQobW9kZWxJZCk7XG4gIGlmICghcHJvY2VkdXJlTW9kZWwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdDYW5ub3QgcmVuYW1lIHRoZSBwYXJhbWV0ZXIgb2YgYSBwcm9jZWR1cmUgdGhhdCBkb2VzIG5vdCBleGlzdCAnICtcbiAgICAgICAgJ2luIHRoZSBwcm9jZWR1cmUgbWFwJyk7XG4gIH1cbiAgcmV0dXJuIHByb2NlZHVyZU1vZGVsLmdldFBhcmFtZXRlcnMoKS5maW5kKChwKSA9PiBwLmdldElkKCkgPT09IHBhcmFtSWQpO1xufVxuXG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvY2VkdXJlUGFyYW1ldGVyUmVuYW1lSnNvbiBleHRlbmRzXG4gICAgUHJvY2VkdXJlUGFyYW1ldGVyQmFzZUpzb24ge1xuICBvbGROYW1lOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1BBUkFNRVRFUl9SRU5BTUUsXG4gICAgUHJvY2VkdXJlUGFyYW1ldGVyUmVuYW1lKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBSZWdpc3RlcnMgZGVmYXVsdCBjb250ZXh0IG1lbnUgaXRlbXMuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LkNvbnRleHRNZW51SXRlbXNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db250ZXh0TWVudUl0ZW1zJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgY2xpcGJvYXJkIGZyb20gJy4vY2xpcGJvYXJkLmpzJztcbmltcG9ydCB7Q29udGV4dE1lbnVSZWdpc3RyeSwgUmVnaXN0cnlJdGVtLCBTY29wZX0gZnJvbSAnLi9jb250ZXh0bWVudV9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBkaWFsb2cgZnJvbSAnLi9kaWFsb2cuanMnO1xuaW1wb3J0ICogYXMgRXZlbnRzIGZyb20gJy4vZXZlbnRzL2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB7aW5wdXRUeXBlc30gZnJvbSAnLi9pbnB1dF90eXBlcy5qcyc7XG5pbXBvcnQge01zZ30gZnJvbSAnLi9tc2cuanMnO1xuaW1wb3J0ICogYXMgaWRHZW5lcmF0b3IgZnJvbSAnLi91dGlscy9pZGdlbmVyYXRvci5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5cbi8qKlxuICogT3B0aW9uIHRvIHVuZG8gcHJldmlvdXMgYWN0aW9uLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51SXRlbXMucmVnaXN0ZXJVbmRvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclVuZG8oKSB7XG4gIGNvbnN0IHVuZG9PcHRpb246IFJlZ2lzdHJ5SXRlbSA9IHtcbiAgICBkaXNwbGF5VGV4dCgpIHtcbiAgICAgIHJldHVybiBNc2dbJ1VORE8nXTtcbiAgICB9LFxuICAgIHByZWNvbmRpdGlvbkZuKHNjb3BlOiBTY29wZSkge1xuICAgICAgaWYgKHNjb3BlLndvcmtzcGFjZSEuZ2V0VW5kb1N0YWNrKCkubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gJ2VuYWJsZWQnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICdkaXNhYmxlZCc7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIHNjb3BlLndvcmtzcGFjZSEudW5kbyhmYWxzZSk7XG4gICAgfSxcbiAgICBzY29wZVR5cGU6IENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGVUeXBlLldPUktTUEFDRSxcbiAgICBpZDogJ3VuZG9Xb3Jrc3BhY2UnLFxuICAgIHdlaWdodDogMSxcbiAgfTtcbiAgQ29udGV4dE1lbnVSZWdpc3RyeS5yZWdpc3RyeS5yZWdpc3Rlcih1bmRvT3B0aW9uKTtcbn1cblxuLyoqXG4gKiBPcHRpb24gdG8gcmVkbyBwcmV2aW91cyBhY3Rpb24uXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnVJdGVtcy5yZWdpc3RlclJlZG9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyUmVkbygpIHtcbiAgY29uc3QgcmVkb09wdGlvbjogUmVnaXN0cnlJdGVtID0ge1xuICAgIGRpc3BsYXlUZXh0KCkge1xuICAgICAgcmV0dXJuIE1zZ1snUkVETyddO1xuICAgIH0sXG4gICAgcHJlY29uZGl0aW9uRm4oc2NvcGU6IFNjb3BlKSB7XG4gICAgICBpZiAoc2NvcGUud29ya3NwYWNlIS5nZXRSZWRvU3RhY2soKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiAnZW5hYmxlZCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2Rpc2FibGVkJztcbiAgICB9LFxuICAgIGNhbGxiYWNrKHNjb3BlOiBTY29wZSkge1xuICAgICAgc2NvcGUud29ya3NwYWNlIS51bmRvKHRydWUpO1xuICAgIH0sXG4gICAgc2NvcGVUeXBlOiBDb250ZXh0TWVudVJlZ2lzdHJ5LlNjb3BlVHlwZS5XT1JLU1BBQ0UsXG4gICAgaWQ6ICdyZWRvV29ya3NwYWNlJyxcbiAgICB3ZWlnaHQ6IDIsXG4gIH07XG4gIENvbnRleHRNZW51UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIocmVkb09wdGlvbik7XG59XG5cbi8qKlxuICogT3B0aW9uIHRvIGNsZWFuIHVwIGJsb2Nrcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudUl0ZW1zLnJlZ2lzdGVyQ2xlYW51cFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJDbGVhbnVwKCkge1xuICBjb25zdCBjbGVhbk9wdGlvbjogUmVnaXN0cnlJdGVtID0ge1xuICAgIGRpc3BsYXlUZXh0KCkge1xuICAgICAgcmV0dXJuIE1zZ1snQ0xFQU5fVVAnXTtcbiAgICB9LFxuICAgIHByZWNvbmRpdGlvbkZuKHNjb3BlOiBTY29wZSkge1xuICAgICAgaWYgKHNjb3BlLndvcmtzcGFjZSEuaXNNb3ZhYmxlKCkpIHtcbiAgICAgICAgaWYgKHNjb3BlLndvcmtzcGFjZSEuZ2V0VG9wQmxvY2tzKGZhbHNlKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgcmV0dXJuICdlbmFibGVkJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ2Rpc2FibGVkJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnaGlkZGVuJztcbiAgICB9LFxuICAgIGNhbGxiYWNrKHNjb3BlOiBTY29wZSkge1xuICAgICAgc2NvcGUud29ya3NwYWNlIS5jbGVhblVwKCk7XG4gICAgfSxcbiAgICBzY29wZVR5cGU6IENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGVUeXBlLldPUktTUEFDRSxcbiAgICBpZDogJ2NsZWFuV29ya3NwYWNlJyxcbiAgICB3ZWlnaHQ6IDMsXG4gIH07XG4gIENvbnRleHRNZW51UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIoY2xlYW5PcHRpb24pO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEgY2FsbGJhY2sgdG8gY29sbGFwc2Ugb3IgZXhwYW5kIHRvcCBibG9ja3MuXG4gKlxuICogQHBhcmFtIHNob3VsZENvbGxhcHNlIFdoZXRoZXIgYSBibG9jayBzaG91bGQgY29sbGFwc2UuXG4gKiBAcGFyYW0gdG9wQmxvY2tzIFRvcCBibG9ja3MgaW4gdGhlIHdvcmtzcGFjZS5cbiAqL1xuZnVuY3Rpb24gdG9nZ2xlT3B0aW9uXyhzaG91bGRDb2xsYXBzZTogYm9vbGVhbiwgdG9wQmxvY2tzOiBCbG9ja1N2Z1tdKSB7XG4gIGNvbnN0IERFTEFZID0gMTA7XG4gIGxldCBtcyA9IDA7XG4gIGxldCB0aW1lb3V0Q291bnRlciA9IDA7XG4gIGZ1bmN0aW9uIHRpbWVvdXRGbihibG9jazogQmxvY2tTdmcpIHtcbiAgICB0aW1lb3V0Q291bnRlci0tO1xuICAgIGJsb2NrLnNldENvbGxhcHNlZChzaG91bGRDb2xsYXBzZSk7XG4gICAgaWYgKHRpbWVvdXRDb3VudGVyID09PSAwKSB7XG4gICAgICBFdmVudHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgIH1cbiAgfVxuICBFdmVudHMuc2V0R3JvdXAodHJ1ZSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IGJsb2NrOiBCbG9ja1N2Z3xudWxsID0gdG9wQmxvY2tzW2ldO1xuICAgIHdoaWxlIChibG9jaykge1xuICAgICAgdGltZW91dENvdW50ZXIrKztcbiAgICAgIHNldFRpbWVvdXQodGltZW91dEZuLmJpbmQobnVsbCwgYmxvY2spLCBtcyk7XG4gICAgICBibG9jayA9IGJsb2NrLmdldE5leHRCbG9jaygpO1xuICAgICAgbXMgKz0gREVMQVk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogT3B0aW9uIHRvIGNvbGxhcHNlIGFsbCBibG9ja3MuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnVJdGVtcy5yZWdpc3RlckNvbGxhcHNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckNvbGxhcHNlKCkge1xuICBjb25zdCBjb2xsYXBzZU9wdGlvbjogUmVnaXN0cnlJdGVtID0ge1xuICAgIGRpc3BsYXlUZXh0KCkge1xuICAgICAgcmV0dXJuIE1zZ1snQ09MTEFQU0VfQUxMJ107XG4gICAgfSxcbiAgICBwcmVjb25kaXRpb25GbihzY29wZTogU2NvcGUpIHtcbiAgICAgIGlmIChzY29wZS53b3Jrc3BhY2UhLm9wdGlvbnMuY29sbGFwc2UpIHtcbiAgICAgICAgY29uc3QgdG9wQmxvY2tzID0gc2NvcGUud29ya3NwYWNlIS5nZXRUb3BCbG9ja3MoZmFsc2UpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvcEJsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGxldCBibG9jazogQmxvY2tTdmd8bnVsbCA9IHRvcEJsb2Nrc1tpXTtcbiAgICAgICAgICB3aGlsZSAoYmxvY2spIHtcbiAgICAgICAgICAgIGlmICghYmxvY2suaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gJ2VuYWJsZWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2sgPSBibG9jay5nZXROZXh0QmxvY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdkaXNhYmxlZCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2hpZGRlbic7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIHRvZ2dsZU9wdGlvbl8odHJ1ZSwgc2NvcGUud29ya3NwYWNlIS5nZXRUb3BCbG9ja3ModHJ1ZSkpO1xuICAgIH0sXG4gICAgc2NvcGVUeXBlOiBDb250ZXh0TWVudVJlZ2lzdHJ5LlNjb3BlVHlwZS5XT1JLU1BBQ0UsXG4gICAgaWQ6ICdjb2xsYXBzZVdvcmtzcGFjZScsXG4gICAgd2VpZ2h0OiA0LFxuICB9O1xuICBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGNvbGxhcHNlT3B0aW9uKTtcbn1cblxuLyoqXG4gKiBPcHRpb24gdG8gZXhwYW5kIGFsbCBibG9ja3MuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnVJdGVtcy5yZWdpc3RlckV4cGFuZFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJFeHBhbmQoKSB7XG4gIGNvbnN0IGV4cGFuZE9wdGlvbjogUmVnaXN0cnlJdGVtID0ge1xuICAgIGRpc3BsYXlUZXh0KCkge1xuICAgICAgcmV0dXJuIE1zZ1snRVhQQU5EX0FMTCddO1xuICAgIH0sXG4gICAgcHJlY29uZGl0aW9uRm4oc2NvcGU6IFNjb3BlKSB7XG4gICAgICBpZiAoc2NvcGUud29ya3NwYWNlIS5vcHRpb25zLmNvbGxhcHNlKSB7XG4gICAgICAgIGNvbnN0IHRvcEJsb2NrcyA9IHNjb3BlLndvcmtzcGFjZSEuZ2V0VG9wQmxvY2tzKGZhbHNlKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BCbG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBsZXQgYmxvY2s6IEJsb2NrU3ZnfG51bGwgPSB0b3BCbG9ja3NbaV07XG4gICAgICAgICAgd2hpbGUgKGJsb2NrKSB7XG4gICAgICAgICAgICBpZiAoYmxvY2suaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gJ2VuYWJsZWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2sgPSBibG9jay5nZXROZXh0QmxvY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdkaXNhYmxlZCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2hpZGRlbic7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIHRvZ2dsZU9wdGlvbl8oZmFsc2UsIHNjb3BlLndvcmtzcGFjZSEuZ2V0VG9wQmxvY2tzKHRydWUpKTtcbiAgICB9LFxuICAgIHNjb3BlVHlwZTogQ29udGV4dE1lbnVSZWdpc3RyeS5TY29wZVR5cGUuV09SS1NQQUNFLFxuICAgIGlkOiAnZXhwYW5kV29ya3NwYWNlJyxcbiAgICB3ZWlnaHQ6IDUsXG4gIH07XG4gIENvbnRleHRNZW51UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIoZXhwYW5kT3B0aW9uKTtcbn1cbi8qKlxuICogQWRkcyBhIGJsb2NrIGFuZCBpdHMgY2hpbGRyZW4gdG8gYSBsaXN0IG9mIGRlbGV0YWJsZSBibG9ja3MuXG4gKlxuICogQHBhcmFtIGJsb2NrIHRvIGRlbGV0ZS5cbiAqIEBwYXJhbSBkZWxldGVMaXN0IGxpc3Qgb2YgYmxvY2tzIHRoYXQgY2FuIGJlIGRlbGV0ZWQuXG4gKiAgICAgVGhpcyB3aWxsIGJlIG1vZGlmaWVkIGluIHBsYWNlIHdpdGggdGhlIGdpdmVuIGJsb2NrIGFuZCBpdHMgZGVzY2VuZGFudHMuXG4gKi9cbmZ1bmN0aW9uIGFkZERlbGV0YWJsZUJsb2Nrc18oYmxvY2s6IEJsb2NrU3ZnLCBkZWxldGVMaXN0OiBCbG9ja1N2Z1tdKSB7XG4gIGlmIChibG9jay5pc0RlbGV0YWJsZSgpKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoZGVsZXRlTGlzdCwgYmxvY2suZ2V0RGVzY2VuZGFudHMoZmFsc2UpKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBjaGlsZHJlbiA9IGJsb2NrLmdldENoaWxkcmVuKGZhbHNlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICBhZGREZWxldGFibGVCbG9ja3NfKGNoaWxkcmVuW2ldLCBkZWxldGVMaXN0KTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3RzIGEgbGlzdCBvZiBibG9ja3MgdGhhdCBjYW4gYmUgZGVsZXRlZCBpbiB0aGUgZ2l2ZW4gd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgdG8gZGVsZXRlIGFsbCBibG9ja3MgZnJvbS5cbiAqIEByZXR1cm5zIGxpc3Qgb2YgYmxvY2tzIHRvIGRlbGV0ZS5cbiAqL1xuZnVuY3Rpb24gZ2V0RGVsZXRhYmxlQmxvY2tzXyh3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zyk6IEJsb2NrU3ZnW10ge1xuICBjb25zdCBkZWxldGVMaXN0OiBCbG9ja1N2Z1tdID0gW107XG4gIGNvbnN0IHRvcEJsb2NrcyA9IHdvcmtzcGFjZS5nZXRUb3BCbG9ja3ModHJ1ZSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgYWRkRGVsZXRhYmxlQmxvY2tzXyh0b3BCbG9ja3NbaV0sIGRlbGV0ZUxpc3QpO1xuICB9XG4gIHJldHVybiBkZWxldGVMaXN0O1xufVxuXG4vKipcbiAqIERlbGV0ZXMgdGhlIGdpdmVuIGJsb2Nrcy4gVXNlZCB0byBkZWxldGUgYWxsIGJsb2NrcyBpbiB0aGUgd29ya3NwYWNlLlxuICpcbiAqIEBwYXJhbSBkZWxldGVMaXN0IGxpc3Qgb2YgYmxvY2tzIHRvIGRlbGV0ZS5cbiAqIEBwYXJhbSBldmVudEdyb3VwIGV2ZW50IGdyb3VwIElEIHdpdGggd2hpY2ggYWxsIGRlbGV0ZSBldmVudHMgc2hvdWxkIGJlXG4gKiAgICAgYXNzb2NpYXRlZC5cbiAqL1xuZnVuY3Rpb24gZGVsZXRlTmV4dF8oZGVsZXRlTGlzdDogQmxvY2tTdmdbXSwgZXZlbnRHcm91cDogc3RyaW5nKSB7XG4gIGNvbnN0IERFTEFZID0gMTA7XG4gIGV2ZW50VXRpbHMuc2V0R3JvdXAoZXZlbnRHcm91cCk7XG4gIGNvbnN0IGJsb2NrID0gZGVsZXRlTGlzdC5zaGlmdCgpO1xuICBpZiAoYmxvY2spIHtcbiAgICBpZiAoIWJsb2NrLmlzRGVhZE9yRHlpbmcoKSkge1xuICAgICAgYmxvY2suZGlzcG9zZShmYWxzZSwgdHJ1ZSk7XG4gICAgICBzZXRUaW1lb3V0KGRlbGV0ZU5leHRfLCBERUxBWSwgZGVsZXRlTGlzdCwgZXZlbnRHcm91cCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZU5leHRfKGRlbGV0ZUxpc3QsIGV2ZW50R3JvdXApO1xuICAgIH1cbiAgfVxuICBldmVudFV0aWxzLnNldEdyb3VwKGZhbHNlKTtcbn1cblxuLyoqXG4gKiBPcHRpb24gdG8gZGVsZXRlIGFsbCBibG9ja3MuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnVJdGVtcy5yZWdpc3RlckRlbGV0ZUFsbFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEZWxldGVBbGwoKSB7XG4gIGNvbnN0IGRlbGV0ZU9wdGlvbjogUmVnaXN0cnlJdGVtID0ge1xuICAgIGRpc3BsYXlUZXh0KHNjb3BlOiBTY29wZSkge1xuICAgICAgaWYgKCFzY29wZS53b3Jrc3BhY2UpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuICAgICAgY29uc3QgZGVsZXRhYmxlQmxvY2tzTGVuZ3RoID0gZ2V0RGVsZXRhYmxlQmxvY2tzXyhzY29wZS53b3Jrc3BhY2UpLmxlbmd0aDtcbiAgICAgIGlmIChkZWxldGFibGVCbG9ja3NMZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIE1zZ1snREVMRVRFX0JMT0NLJ107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTXNnWydERUxFVEVfWF9CTE9DS1MnXS5yZXBsYWNlKFxuICAgICAgICAgICAgJyUxJywgU3RyaW5nKGRlbGV0YWJsZUJsb2Nrc0xlbmd0aCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcHJlY29uZGl0aW9uRm4oc2NvcGU6IFNjb3BlKSB7XG4gICAgICBpZiAoIXNjb3BlLndvcmtzcGFjZSkge1xuICAgICAgICByZXR1cm4gJ2Rpc2FibGVkJztcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRlbGV0YWJsZUJsb2Nrc0xlbmd0aCA9IGdldERlbGV0YWJsZUJsb2Nrc18oc2NvcGUud29ya3NwYWNlKS5sZW5ndGg7XG4gICAgICByZXR1cm4gZGVsZXRhYmxlQmxvY2tzTGVuZ3RoID4gMCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCc7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIGlmICghc2NvcGUud29ya3NwYWNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNjb3BlLndvcmtzcGFjZS5jYW5jZWxDdXJyZW50R2VzdHVyZSgpO1xuICAgICAgY29uc3QgZGVsZXRhYmxlQmxvY2tzID0gZ2V0RGVsZXRhYmxlQmxvY2tzXyhzY29wZS53b3Jrc3BhY2UpO1xuICAgICAgY29uc3QgZXZlbnRHcm91cCA9IGlkR2VuZXJhdG9yLmdlblVpZCgpO1xuICAgICAgaWYgKGRlbGV0YWJsZUJsb2Nrcy5sZW5ndGggPCAyKSB7XG4gICAgICAgIGRlbGV0ZU5leHRfKGRlbGV0YWJsZUJsb2NrcywgZXZlbnRHcm91cCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaWFsb2cuY29uZmlybShcbiAgICAgICAgICAgIE1zZ1snREVMRVRFX0FMTF9CTE9DS1MnXS5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICclMScsIFN0cmluZyhkZWxldGFibGVCbG9ja3MubGVuZ3RoKSksXG4gICAgICAgICAgICBmdW5jdGlvbihvaykge1xuICAgICAgICAgICAgICBpZiAob2spIHtcbiAgICAgICAgICAgICAgICBkZWxldGVOZXh0XyhkZWxldGFibGVCbG9ja3MsIGV2ZW50R3JvdXApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNjb3BlVHlwZTogQ29udGV4dE1lbnVSZWdpc3RyeS5TY29wZVR5cGUuV09SS1NQQUNFLFxuICAgIGlkOiAnd29ya3NwYWNlRGVsZXRlJyxcbiAgICB3ZWlnaHQ6IDYsXG4gIH07XG4gIENvbnRleHRNZW51UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIoZGVsZXRlT3B0aW9uKTtcbn1cbi8qKiBSZWdpc3RlcnMgYWxsIHdvcmtzcGFjZS1zY29wZWQgY29udGV4dCBtZW51IGl0ZW1zLiAqL1xuZnVuY3Rpb24gcmVnaXN0ZXJXb3Jrc3BhY2VPcHRpb25zXygpIHtcbiAgcmVnaXN0ZXJVbmRvKCk7XG4gIHJlZ2lzdGVyUmVkbygpO1xuICByZWdpc3RlckNsZWFudXAoKTtcbiAgcmVnaXN0ZXJDb2xsYXBzZSgpO1xuICByZWdpc3RlckV4cGFuZCgpO1xuICByZWdpc3RlckRlbGV0ZUFsbCgpO1xufVxuXG4vKipcbiAqIE9wdGlvbiB0byBkdXBsaWNhdGUgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudUl0ZW1zLnJlZ2lzdGVyRHVwbGljYXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckR1cGxpY2F0ZSgpIHtcbiAgY29uc3QgZHVwbGljYXRlT3B0aW9uOiBSZWdpc3RyeUl0ZW0gPSB7XG4gICAgZGlzcGxheVRleHQoKSB7XG4gICAgICByZXR1cm4gTXNnWydEVVBMSUNBVEVfQkxPQ0snXTtcbiAgICB9LFxuICAgIHByZWNvbmRpdGlvbkZuKHNjb3BlOiBTY29wZSkge1xuICAgICAgY29uc3QgYmxvY2sgPSBzY29wZS5ibG9jaztcbiAgICAgIGlmICghYmxvY2shLmlzSW5GbHlvdXQgJiYgYmxvY2shLmlzRGVsZXRhYmxlKCkgJiYgYmxvY2shLmlzTW92YWJsZSgpKSB7XG4gICAgICAgIGlmIChibG9jayEuaXNEdXBsaWNhdGFibGUoKSkge1xuICAgICAgICAgIHJldHVybiAnZW5hYmxlZCc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdkaXNhYmxlZCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2hpZGRlbic7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIGlmIChzY29wZS5ibG9jaykge1xuICAgICAgICBjbGlwYm9hcmQuZHVwbGljYXRlKHNjb3BlLmJsb2NrKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNjb3BlVHlwZTogQ29udGV4dE1lbnVSZWdpc3RyeS5TY29wZVR5cGUuQkxPQ0ssXG4gICAgaWQ6ICdibG9ja0R1cGxpY2F0ZScsXG4gICAgd2VpZ2h0OiAxLFxuICB9O1xuICBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGR1cGxpY2F0ZU9wdGlvbik7XG59XG5cbi8qKlxuICogT3B0aW9uIHRvIGFkZCBvciByZW1vdmUgYmxvY2stbGV2ZWwgY29tbWVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudUl0ZW1zLnJlZ2lzdGVyQ29tbWVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJDb21tZW50KCkge1xuICBjb25zdCBjb21tZW50T3B0aW9uOiBSZWdpc3RyeUl0ZW0gPSB7XG4gICAgZGlzcGxheVRleHQoc2NvcGU6IFNjb3BlKSB7XG4gICAgICBpZiAoc2NvcGUuYmxvY2shLmdldENvbW1lbnRJY29uKCkpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUncyBhbHJlYWR5IGEgY29tbWVudCwgIG9wdGlvbiBpcyB0byByZW1vdmUuXG4gICAgICAgIHJldHVybiBNc2dbJ1JFTU9WRV9DT01NRU5UJ107XG4gICAgICB9XG4gICAgICAvLyBJZiB0aGVyZSdzIG5vIGNvbW1lbnQgeWV0LCBvcHRpb24gaXMgdG8gYWRkLlxuICAgICAgcmV0dXJuIE1zZ1snQUREX0NPTU1FTlQnXTtcbiAgICB9LFxuICAgIHByZWNvbmRpdGlvbkZuKHNjb3BlOiBTY29wZSkge1xuICAgICAgY29uc3QgYmxvY2sgPSBzY29wZS5ibG9jaztcbiAgICAgIGlmICghYmxvY2shLmlzSW5GbHlvdXQgJiYgYmxvY2shLndvcmtzcGFjZS5vcHRpb25zLmNvbW1lbnRzICYmXG4gICAgICAgICAgIWJsb2NrIS5pc0NvbGxhcHNlZCgpICYmIGJsb2NrIS5pc0VkaXRhYmxlKCkpIHtcbiAgICAgICAgcmV0dXJuICdlbmFibGVkJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnaGlkZGVuJztcbiAgICB9LFxuICAgIGNhbGxiYWNrKHNjb3BlOiBTY29wZSkge1xuICAgICAgY29uc3QgYmxvY2sgPSBzY29wZS5ibG9jaztcbiAgICAgIGlmIChibG9jayEuZ2V0Q29tbWVudEljb24oKSkge1xuICAgICAgICBibG9jayEuc2V0Q29tbWVudFRleHQobnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBibG9jayEuc2V0Q29tbWVudFRleHQoJycpO1xuICAgICAgfVxuICAgIH0sXG4gICAgc2NvcGVUeXBlOiBDb250ZXh0TWVudVJlZ2lzdHJ5LlNjb3BlVHlwZS5CTE9DSyxcbiAgICBpZDogJ2Jsb2NrQ29tbWVudCcsXG4gICAgd2VpZ2h0OiAyLFxuICB9O1xuICBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGNvbW1lbnRPcHRpb24pO1xufVxuXG4vKipcbiAqIE9wdGlvbiB0byBpbmxpbmUgdmFyaWFibGVzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51SXRlbXMucmVnaXN0ZXJJbmxpbmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVySW5saW5lKCkge1xuICBjb25zdCBpbmxpbmVPcHRpb246IFJlZ2lzdHJ5SXRlbSA9IHtcbiAgICBkaXNwbGF5VGV4dChzY29wZTogU2NvcGUpIHtcbiAgICAgIHJldHVybiBzY29wZS5ibG9jayEuZ2V0SW5wdXRzSW5saW5lKCkgPyBNc2dbJ0VYVEVSTkFMX0lOUFVUUyddIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNc2dbJ0lOTElORV9JTlBVVFMnXTtcbiAgICB9LFxuICAgIHByZWNvbmRpdGlvbkZuKHNjb3BlOiBTY29wZSkge1xuICAgICAgY29uc3QgYmxvY2sgPSBzY29wZS5ibG9jaztcbiAgICAgIGlmICghYmxvY2shLmlzSW5GbHlvdXQgJiYgYmxvY2shLmlzTW92YWJsZSgpICYmICFibG9jayEuaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGJsb2NrIS5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAvLyBPbmx5IGRpc3BsYXkgdGhpcyBvcHRpb24gaWYgdGhlcmUgYXJlIHR3byB2YWx1ZSBvciBkdW1teSBpbnB1dHNcbiAgICAgICAgICAvLyBuZXh0IHRvIGVhY2ggb3RoZXIuXG4gICAgICAgICAgaWYgKGJsb2NrIS5pbnB1dExpc3RbaSAtIDFdLnR5cGUgIT09IGlucHV0VHlwZXMuU1RBVEVNRU5UICYmXG4gICAgICAgICAgICAgIGJsb2NrIS5pbnB1dExpc3RbaV0udHlwZSAhPT0gaW5wdXRUeXBlcy5TVEFURU1FTlQpIHtcbiAgICAgICAgICAgIHJldHVybiAnZW5hYmxlZCc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2hpZGRlbic7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIHNjb3BlLmJsb2NrIS5zZXRJbnB1dHNJbmxpbmUoIXNjb3BlLmJsb2NrIS5nZXRJbnB1dHNJbmxpbmUoKSk7XG4gICAgfSxcbiAgICBzY29wZVR5cGU6IENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGVUeXBlLkJMT0NLLFxuICAgIGlkOiAnYmxvY2tJbmxpbmUnLFxuICAgIHdlaWdodDogMyxcbiAgfTtcbiAgQ29udGV4dE1lbnVSZWdpc3RyeS5yZWdpc3RyeS5yZWdpc3RlcihpbmxpbmVPcHRpb24pO1xufVxuXG4vKipcbiAqIE9wdGlvbiB0byBjb2xsYXBzZSBvciBleHBhbmQgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudUl0ZW1zLnJlZ2lzdGVyQ29sbGFwc2VFeHBhbmRCbG9ja1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJDb2xsYXBzZUV4cGFuZEJsb2NrKCkge1xuICBjb25zdCBjb2xsYXBzZUV4cGFuZE9wdGlvbjogUmVnaXN0cnlJdGVtID0ge1xuICAgIGRpc3BsYXlUZXh0KHNjb3BlOiBTY29wZSkge1xuICAgICAgcmV0dXJuIHNjb3BlLmJsb2NrIS5pc0NvbGxhcHNlZCgpID8gTXNnWydFWFBBTkRfQkxPQ0snXSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNc2dbJ0NPTExBUFNFX0JMT0NLJ107XG4gICAgfSxcbiAgICBwcmVjb25kaXRpb25GbihzY29wZTogU2NvcGUpIHtcbiAgICAgIGNvbnN0IGJsb2NrID0gc2NvcGUuYmxvY2s7XG4gICAgICBpZiAoIWJsb2NrIS5pc0luRmx5b3V0ICYmIGJsb2NrIS5pc01vdmFibGUoKSAmJlxuICAgICAgICAgIGJsb2NrIS53b3Jrc3BhY2Uub3B0aW9ucy5jb2xsYXBzZSkge1xuICAgICAgICByZXR1cm4gJ2VuYWJsZWQnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICdoaWRkZW4nO1xuICAgIH0sXG4gICAgY2FsbGJhY2soc2NvcGU6IFNjb3BlKSB7XG4gICAgICBzY29wZS5ibG9jayEuc2V0Q29sbGFwc2VkKCFzY29wZS5ibG9jayEuaXNDb2xsYXBzZWQoKSk7XG4gICAgfSxcbiAgICBzY29wZVR5cGU6IENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGVUeXBlLkJMT0NLLFxuICAgIGlkOiAnYmxvY2tDb2xsYXBzZUV4cGFuZCcsXG4gICAgd2VpZ2h0OiA0LFxuICB9O1xuICBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGNvbGxhcHNlRXhwYW5kT3B0aW9uKTtcbn1cblxuLyoqXG4gKiBPcHRpb24gdG8gZGlzYWJsZSBvciBlbmFibGUgYSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Db250ZXh0TWVudUl0ZW1zLnJlZ2lzdGVyRGlzYWJsZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEaXNhYmxlKCkge1xuICBjb25zdCBkaXNhYmxlT3B0aW9uOiBSZWdpc3RyeUl0ZW0gPSB7XG4gICAgZGlzcGxheVRleHQoc2NvcGU6IFNjb3BlKSB7XG4gICAgICByZXR1cm4gc2NvcGUuYmxvY2shLmlzRW5hYmxlZCgpID8gTXNnWydESVNBQkxFX0JMT0NLJ10gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1zZ1snRU5BQkxFX0JMT0NLJ107XG4gICAgfSxcbiAgICBwcmVjb25kaXRpb25GbihzY29wZTogU2NvcGUpIHtcbiAgICAgIGNvbnN0IGJsb2NrID0gc2NvcGUuYmxvY2s7XG4gICAgICBpZiAoIWJsb2NrIS5pc0luRmx5b3V0ICYmIGJsb2NrIS53b3Jrc3BhY2Uub3B0aW9ucy5kaXNhYmxlICYmXG4gICAgICAgICAgYmxvY2shLmlzRWRpdGFibGUoKSkge1xuICAgICAgICBpZiAoYmxvY2shLmdldEluaGVyaXRlZERpc2FibGVkKCkpIHtcbiAgICAgICAgICByZXR1cm4gJ2Rpc2FibGVkJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ2VuYWJsZWQnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICdoaWRkZW4nO1xuICAgIH0sXG4gICAgY2FsbGJhY2soc2NvcGU6IFNjb3BlKSB7XG4gICAgICBjb25zdCBibG9jayA9IHNjb3BlLmJsb2NrO1xuICAgICAgY29uc3QgZ3JvdXAgPSBldmVudFV0aWxzLmdldEdyb3VwKCk7XG4gICAgICBpZiAoIWdyb3VwKSB7XG4gICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAodHJ1ZSk7XG4gICAgICB9XG4gICAgICBibG9jayEuc2V0RW5hYmxlZCghYmxvY2shLmlzRW5hYmxlZCgpKTtcbiAgICAgIGlmICghZ3JvdXApIHtcbiAgICAgICAgZXZlbnRVdGlscy5zZXRHcm91cChmYWxzZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzY29wZVR5cGU6IENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGVUeXBlLkJMT0NLLFxuICAgIGlkOiAnYmxvY2tEaXNhYmxlJyxcbiAgICB3ZWlnaHQ6IDUsXG4gIH07XG4gIENvbnRleHRNZW51UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIoZGlzYWJsZU9wdGlvbik7XG59XG5cbi8qKlxuICogT3B0aW9uIHRvIGRlbGV0ZSBhIGJsb2NrLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51SXRlbXMucmVnaXN0ZXJEZWxldGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyRGVsZXRlKCkge1xuICBjb25zdCBkZWxldGVPcHRpb246IFJlZ2lzdHJ5SXRlbSA9IHtcbiAgICBkaXNwbGF5VGV4dChzY29wZTogU2NvcGUpIHtcbiAgICAgIGNvbnN0IGJsb2NrID0gc2NvcGUuYmxvY2s7XG4gICAgICAvLyBDb3VudCB0aGUgbnVtYmVyIG9mIGJsb2NrcyB0aGF0IGFyZSBuZXN0ZWQgaW4gdGhpcyBibG9jay5cbiAgICAgIGxldCBkZXNjZW5kYW50Q291bnQgPSBibG9jayEuZ2V0RGVzY2VuZGFudHMoZmFsc2UpLmxlbmd0aDtcbiAgICAgIGNvbnN0IG5leHRCbG9jayA9IGJsb2NrIS5nZXROZXh0QmxvY2soKTtcbiAgICAgIGlmIChuZXh0QmxvY2spIHtcbiAgICAgICAgLy8gQmxvY2tzIGluIHRoZSBjdXJyZW50IHN0YWNrIHdvdWxkIHN1cnZpdmUgdGhpcyBibG9jaydzIGRlbGV0aW9uLlxuICAgICAgICBkZXNjZW5kYW50Q291bnQgLT0gbmV4dEJsb2NrLmdldERlc2NlbmRhbnRzKGZhbHNlKS5sZW5ndGg7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGVzY2VuZGFudENvdW50ID09PSAxID9cbiAgICAgICAgICBNc2dbJ0RFTEVURV9CTE9DSyddIDpcbiAgICAgICAgICBNc2dbJ0RFTEVURV9YX0JMT0NLUyddLnJlcGxhY2UoJyUxJywgU3RyaW5nKGRlc2NlbmRhbnRDb3VudCkpO1xuICAgIH0sXG4gICAgcHJlY29uZGl0aW9uRm4oc2NvcGU6IFNjb3BlKSB7XG4gICAgICBpZiAoIXNjb3BlLmJsb2NrIS5pc0luRmx5b3V0ICYmIHNjb3BlLmJsb2NrIS5pc0RlbGV0YWJsZSgpKSB7XG4gICAgICAgIHJldHVybiAnZW5hYmxlZCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2hpZGRlbic7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIGlmIChzY29wZS5ibG9jaykge1xuICAgICAgICBzY29wZS5ibG9jay5jaGVja0FuZERlbGV0ZSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgc2NvcGVUeXBlOiBDb250ZXh0TWVudVJlZ2lzdHJ5LlNjb3BlVHlwZS5CTE9DSyxcbiAgICBpZDogJ2Jsb2NrRGVsZXRlJyxcbiAgICB3ZWlnaHQ6IDYsXG4gIH07XG4gIENvbnRleHRNZW51UmVnaXN0cnkucmVnaXN0cnkucmVnaXN0ZXIoZGVsZXRlT3B0aW9uKTtcbn1cblxuLyoqXG4gKiBPcHRpb24gdG8gb3BlbiBoZWxwIGZvciBhIGJsb2NrLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51SXRlbXMucmVnaXN0ZXJIZWxwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckhlbHAoKSB7XG4gIGNvbnN0IGhlbHBPcHRpb246IFJlZ2lzdHJ5SXRlbSA9IHtcbiAgICBkaXNwbGF5VGV4dCgpIHtcbiAgICAgIHJldHVybiBNc2dbJ0hFTFAnXTtcbiAgICB9LFxuICAgIHByZWNvbmRpdGlvbkZuKHNjb3BlOiBTY29wZSkge1xuICAgICAgY29uc3QgYmxvY2sgPSBzY29wZS5ibG9jaztcbiAgICAgIGNvbnN0IHVybCA9IHR5cGVvZiBibG9jayEuaGVscFVybCA9PT0gJ2Z1bmN0aW9uJyA/IGJsb2NrIS5oZWxwVXJsKCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2shLmhlbHBVcmw7XG4gICAgICBpZiAodXJsKSB7XG4gICAgICAgIHJldHVybiAnZW5hYmxlZCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ2hpZGRlbic7XG4gICAgfSxcbiAgICBjYWxsYmFjayhzY29wZTogU2NvcGUpIHtcbiAgICAgIHNjb3BlLmJsb2NrIS5zaG93SGVscCgpO1xuICAgIH0sXG4gICAgc2NvcGVUeXBlOiBDb250ZXh0TWVudVJlZ2lzdHJ5LlNjb3BlVHlwZS5CTE9DSyxcbiAgICBpZDogJ2Jsb2NrSGVscCcsXG4gICAgd2VpZ2h0OiA3LFxuICB9O1xuICBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LnJlZ2lzdGVyKGhlbHBPcHRpb24pO1xufVxuXG4vKiogUmVnaXN0ZXJzIGFsbCBibG9jay1zY29wZWQgY29udGV4dCBtZW51IGl0ZW1zLiAqL1xuZnVuY3Rpb24gcmVnaXN0ZXJCbG9ja09wdGlvbnNfKCkge1xuICByZWdpc3RlckR1cGxpY2F0ZSgpO1xuICByZWdpc3RlckNvbW1lbnQoKTtcbiAgcmVnaXN0ZXJJbmxpbmUoKTtcbiAgcmVnaXN0ZXJDb2xsYXBzZUV4cGFuZEJsb2NrKCk7XG4gIHJlZ2lzdGVyRGlzYWJsZSgpO1xuICByZWdpc3RlckRlbGV0ZSgpO1xuICByZWdpc3RlckhlbHAoKTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYWxsIGRlZmF1bHQgY29udGV4dCBtZW51IGl0ZW1zLiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgb25jZSBwZXJcbiAqIGluc3RhbmNlIG9mIENvbnRleHRNZW51UmVnaXN0cnkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29udGV4dE1lbnVJdGVtcy5yZWdpc3RlckRlZmF1bHRPcHRpb25zXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyRGVmYXVsdE9wdGlvbnMoKSB7XG4gIHJlZ2lzdGVyV29ya3NwYWNlT3B0aW9uc18oKTtcbiAgcmVnaXN0ZXJCbG9ja09wdGlvbnNfKCk7XG59XG5cbnJlZ2lzdGVyRGVmYXVsdE9wdGlvbnMoKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBNZXRob2RzIGZvciBkcmFnZ2luZyBhIGJsb2NrIHZpc3VhbGx5LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkJsb2NrRHJhZ2dlcicpO1xuXG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19kcmFnLmpzJztcblxuaW1wb3J0ICogYXMgYmxvY2tBbmltYXRpb24gZnJvbSAnLi9ibG9ja19hbmltYXRpb25zLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgYnVtcE9iamVjdHMgZnJvbSAnLi9idW1wX29iamVjdHMuanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4vY29tbW9uLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja01vdmV9IGZyb20gJy4vZXZlbnRzL2V2ZW50c19ibG9ja19tb3ZlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0ljb259IGZyb20gJy4vaWNvbi5qcyc7XG5pbXBvcnQge0luc2VydGlvbk1hcmtlck1hbmFnZXJ9IGZyb20gJy4vaW5zZXJ0aW9uX21hcmtlcl9tYW5hZ2VyLmpzJztcbmltcG9ydCB0eXBlIHtJQmxvY2tEcmFnZ2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9ibG9ja19kcmFnZ2VyLmpzJztcbmltcG9ydCB0eXBlIHtJRHJhZ1RhcmdldH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ190YXJnZXQuanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrIGRyYWdnZXIuICBJdCBtb3ZlcyBibG9ja3MgYXJvdW5kIHRoZSB3b3Jrc3BhY2Ugd2hlbiB0aGV5XG4gKiBhcmUgYmVpbmcgZHJhZ2dlZCBieSBhIG1vdXNlIG9yIHRvdWNoLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkJsb2NrRHJhZ2dlclxuICovXG5leHBvcnQgY2xhc3MgQmxvY2tEcmFnZ2VyIGltcGxlbWVudHMgSUJsb2NrRHJhZ2dlciB7XG4gIC8qKiBUaGUgdG9wIGJsb2NrIGluIHRoZSBzdGFjayB0aGF0IGlzIGJlaW5nIGRyYWdnZWQuICovXG4gIHByb3RlY3RlZCBkcmFnZ2luZ0Jsb2NrXzogQmxvY2tTdmc7XG4gIHByb3RlY3RlZCBkcmFnZ2VkQ29ubmVjdGlvbk1hbmFnZXJfOiBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyO1xuXG4gIC8qKiBUaGUgd29ya3NwYWNlIG9uIHdoaWNoIHRoZSBibG9jayBpcyBiZWluZyBkcmFnZ2VkLiAqL1xuICBwcm90ZWN0ZWQgd29ya3NwYWNlXzogV29ya3NwYWNlU3ZnO1xuXG4gIC8qKiBXaGljaCBkcmFnIGFyZWEgdGhlIG1vdXNlIHBvaW50ZXIgaXMgb3ZlciwgaWYgYW55LiAqL1xuICBwcml2YXRlIGRyYWdUYXJnZXRfOiBJRHJhZ1RhcmdldHxudWxsID0gbnVsbDtcblxuICAvKiogV2hldGhlciB0aGUgYmxvY2sgd291bGQgYmUgZGVsZXRlZCBpZiBkcm9wcGVkIGltbWVkaWF0ZWx5LiAqL1xuICBwcm90ZWN0ZWQgd291bGREZWxldGVCbG9ja18gPSBmYWxzZTtcbiAgcHJvdGVjdGVkIHN0YXJ0WFlfOiBDb29yZGluYXRlO1xuICBwcm90ZWN0ZWQgZHJhZ0ljb25EYXRhXzogSWNvblBvc2l0aW9uRGF0YVtdO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGRyYWcuXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBkcmFnIG9uLlxuICAgKi9cbiAgY29uc3RydWN0b3IoYmxvY2s6IEJsb2NrU3ZnLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge1xuICAgIHRoaXMuZHJhZ2dpbmdCbG9ja18gPSBibG9jaztcblxuICAgIC8qKiBPYmplY3QgdGhhdCBrZWVwcyB0cmFjayBvZiBjb25uZWN0aW9ucyBvbiBkcmFnZ2VkIGJsb2Nrcy4gKi9cbiAgICB0aGlzLmRyYWdnZWRDb25uZWN0aW9uTWFuYWdlcl8gPVxuICAgICAgICBuZXcgSW5zZXJ0aW9uTWFya2VyTWFuYWdlcih0aGlzLmRyYWdnaW5nQmxvY2tfKTtcblxuICAgIHRoaXMud29ya3NwYWNlXyA9IHdvcmtzcGFjZTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBsb2NhdGlvbiBvZiB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBkcmFnZ2luZyBibG9jayBhdCB0aGVcbiAgICAgKiBiZWdpbm5pbmcgb2YgdGhlIGRyYWcgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgICAqL1xuICAgIHRoaXMuc3RhcnRYWV8gPSB0aGlzLmRyYWdnaW5nQmxvY2tfLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcblxuICAgIC8qKlxuICAgICAqIEEgbGlzdCBvZiBhbGwgb2YgdGhlIGljb25zIChjb21tZW50LCB3YXJuaW5nLCBhbmQgbXV0YXRvcikgdGhhdCBhcmVcbiAgICAgKiBvbiB0aGlzIGJsb2NrIGFuZCBpdHMgZGVzY2VuZGFudHMuICBNb3ZpbmcgYW4gaWNvbiBtb3ZlcyB0aGUgYnViYmxlIHRoYXRcbiAgICAgKiBleHRlbmRzIGZyb20gaXQgaWYgdGhhdCBidWJibGUgaXMgb3Blbi5cbiAgICAgKi9cbiAgICB0aGlzLmRyYWdJY29uRGF0YV8gPSBpbml0SWNvbkRhdGEoYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldmVyIGFsbCBsaW5rcyBmcm9tIHRoaXMgb2JqZWN0LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy5kcmFnSWNvbkRhdGFfLmxlbmd0aCA9IDA7XG5cbiAgICBpZiAodGhpcy5kcmFnZ2VkQ29ubmVjdGlvbk1hbmFnZXJfKSB7XG4gICAgICB0aGlzLmRyYWdnZWRDb25uZWN0aW9uTWFuYWdlcl8uZGlzcG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBkcmFnZ2luZyBhIGJsb2NrLiAgVGhpcyBpbmNsdWRlcyBtb3ZpbmcgaXQgdG8gdGhlIGRyYWcgc3VyZmFjZS5cbiAgICpcbiAgICogQHBhcmFtIGN1cnJlbnREcmFnRGVsdGFYWSBIb3cgZmFyIHRoZSBwb2ludGVyIGhhcyBtb3ZlZCBmcm9tIHRoZSBwb3NpdGlvblxuICAgKiAgICAgYXQgbW91c2UgZG93biwgaW4gcGl4ZWwgdW5pdHMuXG4gICAqIEBwYXJhbSBoZWFsU3RhY2sgV2hldGhlciBvciBub3QgdG8gaGVhbCB0aGUgc3RhY2sgYWZ0ZXIgZGlzY29ubmVjdGluZy5cbiAgICovXG4gIHN0YXJ0RHJhZyhjdXJyZW50RHJhZ0RlbHRhWFk6IENvb3JkaW5hdGUsIGhlYWxTdGFjazogYm9vbGVhbikge1xuICAgIGlmICghZXZlbnRVdGlscy5nZXRHcm91cCgpKSB7XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgIH1cbiAgICB0aGlzLmZpcmVEcmFnU3RhcnRFdmVudF8oKTtcblxuICAgIC8vIE11dGF0b3JzIGRvbid0IGhhdmUgdGhlIHNhbWUgdHlwZSBvZiB6LW9yZGVyaW5nIGFzIHRoZSBub3JtYWwgd29ya3NwYWNlXG4gICAgLy8gZHVyaW5nIGEgZHJhZy4gIFRoZXkgaGF2ZSB0byByZWx5IG9uIHRoZSBvcmRlciBvZiB0aGUgYmxvY2tzIGluIHRoZSBTVkcuXG4gICAgLy8gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMgdGhhdCB1c3VhbGx5IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBhIGRyYWcsXG4gICAgLy8gYnV0IGRvIGl0IGF0IHRoZSBiZWdpbm5pbmcgZm9yIG11dGF0b3JzLlxuICAgIGlmICh0aGlzLndvcmtzcGFjZV8uaXNNdXRhdG9yKSB7XG4gICAgICB0aGlzLmRyYWdnaW5nQmxvY2tfLmJyaW5nVG9Gcm9udCgpO1xuICAgIH1cblxuICAgIC8vIER1cmluZyBhIGRyYWcgdGhlcmUgbWF5IGJlIGEgbG90IG9mIHJlcmVuZGVycywgYnV0IG5vdCBmaWVsZCBjaGFuZ2VzLlxuICAgIC8vIFR1cm4gdGhlIGNhY2hlIG9uIHNvIHdlIGRvbid0IGRvIHNwdXJpb3VzIHJlbWVhc3VyZXMgZHVyaW5nIHRoZSBkcmFnLlxuICAgIGRvbS5zdGFydFRleHRXaWR0aENhY2hlKCk7XG4gICAgdGhpcy53b3Jrc3BhY2VfLnNldFJlc2l6ZXNFbmFibGVkKGZhbHNlKTtcbiAgICBibG9ja0FuaW1hdGlvbi5kaXNjb25uZWN0VWlTdG9wKCk7XG5cbiAgICBpZiAodGhpcy5zaG91bGREaXNjb25uZWN0XyhoZWFsU3RhY2spKSB7XG4gICAgICB0aGlzLmRpc2Nvbm5lY3RCbG9ja18oaGVhbFN0YWNrLCBjdXJyZW50RHJhZ0RlbHRhWFkpO1xuICAgIH1cbiAgICB0aGlzLmRyYWdnaW5nQmxvY2tfLnNldERyYWdnaW5nKHRydWUpO1xuICAgIC8vIEZvciBmdXR1cmUgY29uc2lkZXJhdGlvbjogd2UgbWF5IGJlIGFibGUgdG8gcHV0IG1vdmVUb0RyYWdTdXJmYWNlIGluc2lkZVxuICAgIC8vIHRoZSBibG9jayBkcmFnZ2VyLCB3aGljaCB3b3VsZCBhbHNvIGxldCB0aGUgYmxvY2sgbm90IHRyYWNrIHRoZSBibG9ja1xuICAgIC8vIGRyYWcgc3VyZmFjZS5cbiAgICB0aGlzLmRyYWdnaW5nQmxvY2tfLm1vdmVUb0RyYWdTdXJmYWNlKCk7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBvciBub3Qgd2Ugc2hvdWxkIGRpc2Nvbm5lY3QgdGhlIGJsb2NrIHdoZW4gYSBkcmFnIGlzIHN0YXJ0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSBoZWFsU3RhY2sgV2hldGhlciBvciBub3QgdG8gaGVhbCB0aGUgc3RhY2sgYWZ0ZXIgZGlzY29ubmVjdGluZy5cbiAgICogQHJldHVybnMgVHJ1ZSB0byBkaXNjb25uZWN0IHRoZSBibG9jaywgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNob3VsZERpc2Nvbm5lY3RfKGhlYWxTdGFjazogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIShcbiAgICAgICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5nZXRQYXJlbnQoKSB8fFxuICAgICAgICBoZWFsU3RhY2sgJiYgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5uZXh0Q29ubmVjdGlvbiAmJlxuICAgICAgICAgICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5uZXh0Q29ubmVjdGlvbi50YXJnZXRCbG9jaygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNjb25uZWN0cyB0aGUgYmxvY2sgYW5kIG1vdmVzIGl0IHRvIGEgbmV3IGxvY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gaGVhbFN0YWNrIFdoZXRoZXIgb3Igbm90IHRvIGhlYWwgdGhlIHN0YWNrIGFmdGVyIGRpc2Nvbm5lY3RpbmcuXG4gICAqIEBwYXJhbSBjdXJyZW50RHJhZ0RlbHRhWFkgSG93IGZhciB0aGUgcG9pbnRlciBoYXMgbW92ZWQgZnJvbSB0aGUgcG9zaXRpb25cbiAgICogICAgIGF0IG1vdXNlIGRvd24sIGluIHBpeGVsIHVuaXRzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRpc2Nvbm5lY3RCbG9ja18oXG4gICAgICBoZWFsU3RhY2s6IGJvb2xlYW4sIGN1cnJlbnREcmFnRGVsdGFYWTogQ29vcmRpbmF0ZSkge1xuICAgIHRoaXMuZHJhZ2dpbmdCbG9ja18udW5wbHVnKGhlYWxTdGFjayk7XG4gICAgY29uc3QgZGVsdGEgPSB0aGlzLnBpeGVsc1RvV29ya3NwYWNlVW5pdHNfKGN1cnJlbnREcmFnRGVsdGFYWSk7XG4gICAgY29uc3QgbmV3TG9jID0gQ29vcmRpbmF0ZS5zdW0odGhpcy5zdGFydFhZXywgZGVsdGEpO1xuXG4gICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy50cmFuc2xhdGUobmV3TG9jLngsIG5ld0xvYy55KTtcbiAgICBibG9ja0FuaW1hdGlvbi5kaXNjb25uZWN0VWlFZmZlY3QodGhpcy5kcmFnZ2luZ0Jsb2NrXyk7XG4gICAgdGhpcy5kcmFnZ2VkQ29ubmVjdGlvbk1hbmFnZXJfLnVwZGF0ZUF2YWlsYWJsZUNvbm5lY3Rpb25zKCk7XG4gIH1cblxuICAvKiogRmlyZSBhIFVJIGV2ZW50IGF0IHRoZSBzdGFydCBvZiBhIGJsb2NrIGRyYWcuICovXG4gIHByb3RlY3RlZCBmaXJlRHJhZ1N0YXJ0RXZlbnRfKCkge1xuICAgIGNvbnN0IGV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX0RSQUcpKShcbiAgICAgICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXywgdHJ1ZSwgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5nZXREZXNjZW5kYW50cyhmYWxzZSkpO1xuICAgIGV2ZW50VXRpbHMuZmlyZShldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIHN0ZXAgb2YgYmxvY2sgZHJhZ2dpbmcsIGJhc2VkIG9uIHRoZSBnaXZlbiBldmVudC4gIFVwZGF0ZSB0aGVcbiAgICogZGlzcGxheSBhY2NvcmRpbmdseS5cbiAgICpcbiAgICogQHBhcmFtIGUgVGhlIG1vc3QgcmVjZW50IG1vdmUgZXZlbnQuXG4gICAqIEBwYXJhbSBjdXJyZW50RHJhZ0RlbHRhWFkgSG93IGZhciB0aGUgcG9pbnRlciBoYXMgbW92ZWQgZnJvbSB0aGUgcG9zaXRpb25cbiAgICogICAgIGF0IHRoZSBzdGFydCBvZiB0aGUgZHJhZywgaW4gcGl4ZWwgdW5pdHMuXG4gICAqL1xuICBkcmFnKGU6IFBvaW50ZXJFdmVudCwgY3VycmVudERyYWdEZWx0YVhZOiBDb29yZGluYXRlKSB7XG4gICAgY29uc3QgZGVsdGEgPSB0aGlzLnBpeGVsc1RvV29ya3NwYWNlVW5pdHNfKGN1cnJlbnREcmFnRGVsdGFYWSk7XG4gICAgY29uc3QgbmV3TG9jID0gQ29vcmRpbmF0ZS5zdW0odGhpcy5zdGFydFhZXywgZGVsdGEpO1xuICAgIHRoaXMuZHJhZ2dpbmdCbG9ja18ubW92ZUR1cmluZ0RyYWcobmV3TG9jKTtcbiAgICB0aGlzLmRyYWdJY29uc18oZGVsdGEpO1xuXG4gICAgY29uc3Qgb2xkRHJhZ1RhcmdldCA9IHRoaXMuZHJhZ1RhcmdldF87XG4gICAgdGhpcy5kcmFnVGFyZ2V0XyA9IHRoaXMud29ya3NwYWNlXy5nZXREcmFnVGFyZ2V0KGUpO1xuXG4gICAgdGhpcy5kcmFnZ2VkQ29ubmVjdGlvbk1hbmFnZXJfLnVwZGF0ZShkZWx0YSwgdGhpcy5kcmFnVGFyZ2V0Xyk7XG4gICAgY29uc3Qgb2xkV291bGREZWxldGVCbG9jayA9IHRoaXMud291bGREZWxldGVCbG9ja187XG4gICAgdGhpcy53b3VsZERlbGV0ZUJsb2NrXyA9IHRoaXMuZHJhZ2dlZENvbm5lY3Rpb25NYW5hZ2VyXy53b3VsZERlbGV0ZUJsb2NrO1xuICAgIGlmIChvbGRXb3VsZERlbGV0ZUJsb2NrICE9PSB0aGlzLndvdWxkRGVsZXRlQmxvY2tfKSB7XG4gICAgICAvLyBQcmV2ZW50IHVubmVjZXNzYXJ5IGFkZC9yZW1vdmUgY2xhc3MgY2FsbHMuXG4gICAgICB0aGlzLnVwZGF0ZUN1cnNvckR1cmluZ0Jsb2NrRHJhZ18oKTtcbiAgICB9XG5cbiAgICAvLyBDYWxsIGRyYWcgZW50ZXIvZXhpdC9vdmVyIGFmdGVyIHdvdWxkRGVsZXRlQmxvY2sgaXMgY2FsbGVkIGluXG4gICAgLy8gSW5zZXJ0aW9uTWFya2VyTWFuYWdlci51cGRhdGUuXG4gICAgaWYgKHRoaXMuZHJhZ1RhcmdldF8gIT09IG9sZERyYWdUYXJnZXQpIHtcbiAgICAgIG9sZERyYWdUYXJnZXQgJiYgb2xkRHJhZ1RhcmdldC5vbkRyYWdFeGl0KHRoaXMuZHJhZ2dpbmdCbG9ja18pO1xuICAgICAgdGhpcy5kcmFnVGFyZ2V0XyAmJiB0aGlzLmRyYWdUYXJnZXRfLm9uRHJhZ0VudGVyKHRoaXMuZHJhZ2dpbmdCbG9ja18pO1xuICAgIH1cbiAgICB0aGlzLmRyYWdUYXJnZXRfICYmIHRoaXMuZHJhZ1RhcmdldF8ub25EcmFnT3Zlcih0aGlzLmRyYWdnaW5nQmxvY2tfKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5pc2ggYSBibG9jayBkcmFnIGFuZCBwdXQgdGhlIGJsb2NrIGJhY2sgb24gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGUgVGhlIHBvaW50ZXJ1cCBldmVudC5cbiAgICogQHBhcmFtIGN1cnJlbnREcmFnRGVsdGFYWSBIb3cgZmFyIHRoZSBwb2ludGVyIGhhcyBtb3ZlZCBmcm9tIHRoZSBwb3NpdGlvblxuICAgKiAgICAgYXQgdGhlIHN0YXJ0IG9mIHRoZSBkcmFnLCBpbiBwaXhlbCB1bml0cy5cbiAgICovXG4gIGVuZERyYWcoZTogUG9pbnRlckV2ZW50LCBjdXJyZW50RHJhZ0RlbHRhWFk6IENvb3JkaW5hdGUpIHtcbiAgICAvLyBNYWtlIHN1cmUgaW50ZXJuYWwgc3RhdGUgaXMgZnJlc2guXG4gICAgdGhpcy5kcmFnKGUsIGN1cnJlbnREcmFnRGVsdGFYWSk7XG4gICAgdGhpcy5kcmFnSWNvbkRhdGFfID0gW107XG4gICAgdGhpcy5maXJlRHJhZ0VuZEV2ZW50XygpO1xuXG4gICAgZG9tLnN0b3BUZXh0V2lkdGhDYWNoZSgpO1xuXG4gICAgYmxvY2tBbmltYXRpb24uZGlzY29ubmVjdFVpU3RvcCgpO1xuXG4gICAgY29uc3QgcHJldmVudE1vdmUgPSAhIXRoaXMuZHJhZ1RhcmdldF8gJiZcbiAgICAgICAgdGhpcy5kcmFnVGFyZ2V0Xy5zaG91bGRQcmV2ZW50TW92ZSh0aGlzLmRyYWdnaW5nQmxvY2tfKTtcbiAgICBsZXQgbmV3TG9jOiBDb29yZGluYXRlO1xuICAgIGxldCBkZWx0YTogQ29vcmRpbmF0ZXxudWxsID0gbnVsbDtcbiAgICBpZiAocHJldmVudE1vdmUpIHtcbiAgICAgIG5ld0xvYyA9IHRoaXMuc3RhcnRYWV87XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5ld1ZhbHVlcyA9IHRoaXMuZ2V0TmV3TG9jYXRpb25BZnRlckRyYWdfKGN1cnJlbnREcmFnRGVsdGFYWSk7XG4gICAgICBkZWx0YSA9IG5ld1ZhbHVlcy5kZWx0YTtcbiAgICAgIG5ld0xvYyA9IG5ld1ZhbHVlcy5uZXdMb2NhdGlvbjtcbiAgICB9XG4gICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5tb3ZlT2ZmRHJhZ1N1cmZhY2UobmV3TG9jKTtcblxuICAgIGlmICh0aGlzLmRyYWdUYXJnZXRfKSB7XG4gICAgICB0aGlzLmRyYWdUYXJnZXRfLm9uRHJvcCh0aGlzLmRyYWdnaW5nQmxvY2tfKTtcbiAgICB9XG5cbiAgICBjb25zdCBkZWxldGVkID0gdGhpcy5tYXliZURlbGV0ZUJsb2NrXygpO1xuICAgIGlmICghZGVsZXRlZCkge1xuICAgICAgLy8gVGhlc2UgYXJlIGV4cGVuc2l2ZSBhbmQgZG9uJ3QgbmVlZCB0byBiZSBkb25lIGlmIHdlJ3JlIGRlbGV0aW5nLlxuICAgICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5zZXREcmFnZ2luZyhmYWxzZSk7XG4gICAgICBpZiAoZGVsdGEpIHsgIC8vICFwcmV2ZW50TW92ZVxuICAgICAgICB0aGlzLnVwZGF0ZUJsb2NrQWZ0ZXJNb3ZlXyhkZWx0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCbG9ja3MgZHJhZ2dlZCBkaXJlY3RseSBmcm9tIGEgZmx5b3V0IG1heSBuZWVkIHRvIGJlIGJ1bXBlZCBpbnRvXG4gICAgICAgIC8vIGJvdW5kcy5cbiAgICAgICAgYnVtcE9iamVjdHMuYnVtcEludG9Cb3VuZHMoXG4gICAgICAgICAgICB0aGlzLmRyYWdnaW5nQmxvY2tfLndvcmtzcGFjZSxcbiAgICAgICAgICAgIHRoaXMud29ya3NwYWNlXy5nZXRNZXRyaWNzTWFuYWdlcigpLmdldFNjcm9sbE1ldHJpY3ModHJ1ZSksXG4gICAgICAgICAgICB0aGlzLmRyYWdnaW5nQmxvY2tfKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy53b3Jrc3BhY2VfLnNldFJlc2l6ZXNFbmFibGVkKHRydWUpO1xuXG4gICAgZXZlbnRVdGlscy5zZXRHcm91cChmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyB0aGUgZHJhZyBkZWx0YSBhbmQgbmV3IGxvY2F0aW9uIHZhbHVlcyBhZnRlciBhIGJsb2NrIGlzIGRyYWdnZWQuXG4gICAqXG4gICAqIEBwYXJhbSBjdXJyZW50RHJhZ0RlbHRhWFkgSG93IGZhciB0aGUgcG9pbnRlciBoYXMgbW92ZWQgZnJvbSB0aGUgc3RhcnQgb2ZcbiAgICogICAgIHRoZSBkcmFnLCBpbiBwaXhlbCB1bml0cy5cbiAgICogQHJldHVybnMgTmV3IGxvY2F0aW9uIGFmdGVyIGRyYWcuIGRlbHRhIGlzIGluIHdvcmtzcGFjZSB1bml0cy4gbmV3TG9jYXRpb25cbiAgICogICAgIGlzIHRoZSBuZXcgY29vcmRpbmF0ZSB3aGVyZSB0aGUgYmxvY2sgc2hvdWxkIGVuZCB1cC5cbiAgICovXG4gIHByb3RlY3RlZCBnZXROZXdMb2NhdGlvbkFmdGVyRHJhZ18oY3VycmVudERyYWdEZWx0YVhZOiBDb29yZGluYXRlKTpcbiAgICAgIHtkZWx0YTogQ29vcmRpbmF0ZSwgbmV3TG9jYXRpb246IENvb3JkaW5hdGV9IHtcbiAgICBjb25zdCBkZWx0YSA9IHRoaXMucGl4ZWxzVG9Xb3Jrc3BhY2VVbml0c18oY3VycmVudERyYWdEZWx0YVhZKTtcbiAgICBjb25zdCBuZXdMb2NhdGlvbiA9IENvb3JkaW5hdGUuc3VtKHRoaXMuc3RhcnRYWV8sIGRlbHRhKTtcbiAgICByZXR1cm4ge1xuICAgICAgZGVsdGEsXG4gICAgICBuZXdMb2NhdGlvbixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE1heSBkZWxldGUgdGhlIGRyYWdnaW5nIGJsb2NrLCBpZiBhbGxvd2VkLiBJZiBgdGhpcy53b3VsZERlbGV0ZUJsb2NrX2AgaXNcbiAgICogbm90IHRydWUsIHRoZSBibG9jayB3aWxsIG5vdCBiZSBkZWxldGVkLiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYXQgdGhlIGVuZFxuICAgKiBvZiBhIGJsb2NrIGRyYWcuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGJsb2NrIHdhcyBkZWxldGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG1heWJlRGVsZXRlQmxvY2tfKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLndvdWxkRGVsZXRlQmxvY2tfKSB7XG4gICAgICAvLyBGaXJlIGEgbW92ZSBldmVudCwgc28gd2Uga25vdyB3aGVyZSB0byBnbyBiYWNrIHRvIGZvciBhbiB1bmRvLlxuICAgICAgdGhpcy5maXJlTW92ZUV2ZW50XygpO1xuICAgICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5kaXNwb3NlKGZhbHNlLCB0cnVlKTtcbiAgICAgIGNvbW1vbi5kcmFnZ2luZ0Nvbm5lY3Rpb25zLmxlbmd0aCA9IDA7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIG5lY2Vzc2FyeSBpbmZvcm1hdGlvbiB0byBwbGFjZSBhIGJsb2NrIGF0IGEgY2VydGFpbiBsb2NhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGRlbHRhIFRoZSBjaGFuZ2UgaW4gbG9jYXRpb24gZnJvbSB3aGVyZSB0aGUgYmxvY2sgc3RhcnRlZCB0aGUgZHJhZ1xuICAgKiAgICAgdG8gd2hlcmUgaXQgZW5kZWQgdGhlIGRyYWcuXG4gICAqL1xuICBwcm90ZWN0ZWQgdXBkYXRlQmxvY2tBZnRlck1vdmVfKGRlbHRhOiBDb29yZGluYXRlKSB7XG4gICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXy5tb3ZlQ29ubmVjdGlvbnMoZGVsdGEueCwgZGVsdGEueSk7XG4gICAgdGhpcy5maXJlTW92ZUV2ZW50XygpO1xuICAgIGlmICh0aGlzLmRyYWdnZWRDb25uZWN0aW9uTWFuYWdlcl8ud291bGRDb25uZWN0QmxvY2soKSkge1xuICAgICAgLy8gQXBwbHlpbmcgY29ubmVjdGlvbnMgYWxzbyByZXJlbmRlcnMgdGhlIHJlbGV2YW50IGJsb2Nrcy5cbiAgICAgIHRoaXMuZHJhZ2dlZENvbm5lY3Rpb25NYW5hZ2VyXy5hcHBseUNvbm5lY3Rpb25zKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZHJhZ2dpbmdCbG9ja18ucmVuZGVyKCk7XG4gICAgfVxuICAgIHRoaXMuZHJhZ2dpbmdCbG9ja18uc2NoZWR1bGVTbmFwQW5kQnVtcCgpO1xuICB9XG5cbiAgLyoqIEZpcmUgYSBVSSBldmVudCBhdCB0aGUgZW5kIG9mIGEgYmxvY2sgZHJhZy4gKi9cbiAgcHJvdGVjdGVkIGZpcmVEcmFnRW5kRXZlbnRfKCkge1xuICAgIGNvbnN0IGV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX0RSQUcpKShcbiAgICAgICAgdGhpcy5kcmFnZ2luZ0Jsb2NrXywgZmFsc2UsIHRoaXMuZHJhZ2dpbmdCbG9ja18uZ2V0RGVzY2VuZGFudHMoZmFsc2UpKTtcbiAgICBldmVudFV0aWxzLmZpcmUoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgb3IgcmVtb3ZlcyB0aGUgc3R5bGUgb2YgdGhlIGN1cnNvciBmb3IgdGhlIHRvb2xib3guXG4gICAqIFRoaXMgaXMgd2hhdCBjaGFuZ2VzIHRoZSBjdXJzb3IgdG8gZGlzcGxheSBhbiB4IHdoZW4gYSBkZWxldGFibGUgYmxvY2sgaXNcbiAgICogaGVsZCBvdmVyIHRoZSB0b29sYm94LlxuICAgKlxuICAgKiBAcGFyYW0gaXNFbmQgVHJ1ZSBpZiB3ZSBhcmUgYXQgdGhlIGVuZCBvZiBhIGRyYWcsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHByb3RlY3RlZCB1cGRhdGVUb29sYm94U3R5bGVfKGlzRW5kOiBib29sZWFuKSB7XG4gICAgY29uc3QgdG9vbGJveCA9IHRoaXMud29ya3NwYWNlXy5nZXRUb29sYm94KCk7XG5cbiAgICBpZiAodG9vbGJveCkge1xuICAgICAgY29uc3Qgc3R5bGUgPSB0aGlzLmRyYWdnaW5nQmxvY2tfLmlzRGVsZXRhYmxlKCkgPyAnYmxvY2tseVRvb2xib3hEZWxldGUnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Jsb2NrbHlUb29sYm94R3JhYic7XG5cbiAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ3JlbW92ZVN0eWxlJyBkb2VzIG5vdCBleGlzdCBvblxuICAgICAgLy8gdHlwZSAnSVRvb2xib3gnLlxuICAgICAgaWYgKGlzRW5kICYmXG4gICAgICAgICAgdHlwZW9mICh0b29sYm94IGFzIEFueUR1cmluZ01pZ3JhdGlvbikucmVtb3ZlU3R5bGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAncmVtb3ZlU3R5bGUnIGRvZXMgbm90IGV4aXN0IG9uXG4gICAgICAgIC8vIHR5cGUgJ0lUb29sYm94Jy5cbiAgICAgICAgKHRvb2xib3ggYXMgQW55RHVyaW5nTWlncmF0aW9uKS5yZW1vdmVTdHlsZShzdHlsZSk7XG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2FkZFN0eWxlJyBkb2VzIG5vdCBleGlzdCBvblxuICAgICAgICAvLyB0eXBlICdJVG9vbGJveCcuXG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICFpc0VuZCAmJlxuICAgICAgICAgIHR5cGVvZiAodG9vbGJveCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmFkZFN0eWxlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2FkZFN0eWxlJyBkb2VzIG5vdCBleGlzdCBvblxuICAgICAgICAvLyB0eXBlICdJVG9vbGJveCcuXG4gICAgICAgICh0b29sYm94IGFzIEFueUR1cmluZ01pZ3JhdGlvbikuYWRkU3R5bGUoc3R5bGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBGaXJlIGEgbW92ZSBldmVudCBhdCB0aGUgZW5kIG9mIGEgYmxvY2sgZHJhZy4gKi9cbiAgcHJvdGVjdGVkIGZpcmVNb3ZlRXZlbnRfKCkge1xuICAgIGNvbnN0IGV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX01PVkUpKShcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdnaW5nQmxvY2tfKSBhcyBCbG9ja01vdmU7XG4gICAgZXZlbnQub2xkQ29vcmRpbmF0ZSA9IHRoaXMuc3RhcnRYWV87XG4gICAgZXZlbnQucmVjb3JkTmV3KCk7XG4gICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGN1cnNvciAoYW5kIHBvc3NpYmx5IHRoZSB0cmFzaCBjYW4gbGlkKSB0byByZWZsZWN0IHdoZXRoZXIgdGhlXG4gICAqIGRyYWdnaW5nIGJsb2NrIHdvdWxkIGJlIGRlbGV0ZWQgaWYgcmVsZWFzZWQgaW1tZWRpYXRlbHkuXG4gICAqL1xuICBwcm90ZWN0ZWQgdXBkYXRlQ3Vyc29yRHVyaW5nQmxvY2tEcmFnXygpIHtcbiAgICB0aGlzLmRyYWdnaW5nQmxvY2tfLnNldERlbGV0ZVN0eWxlKHRoaXMud291bGREZWxldGVCbG9ja18pO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYSBjb29yZGluYXRlIG9iamVjdCBmcm9tIHBpeGVscyB0byB3b3Jrc3BhY2UgdW5pdHMsIGluY2x1ZGluZyBhXG4gICAqIGNvcnJlY3Rpb24gZm9yIG11dGF0b3Igd29ya3NwYWNlcy5cbiAgICogVGhpcyBmdW5jdGlvbiBkb2VzIG5vdCBjb25zaWRlciBkaWZmZXJpbmcgb3JpZ2lucy4gIEl0IHNpbXBseSBzY2FsZXMgdGhlXG4gICAqIGlucHV0J3MgeCBhbmQgeSB2YWx1ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBwaXhlbENvb3JkIEEgY29vcmRpbmF0ZSB3aXRoIHggYW5kIHkgdmFsdWVzIGluIENTUyBwaXhlbCB1bml0cy5cbiAgICogQHJldHVybnMgVGhlIGlucHV0IGNvb3JkaW5hdGUgZGl2aWRlZCBieSB0aGUgd29ya3NwYWNlIHNjYWxlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHBpeGVsc1RvV29ya3NwYWNlVW5pdHNfKHBpeGVsQ29vcmQ6IENvb3JkaW5hdGUpOiBDb29yZGluYXRlIHtcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgQ29vcmRpbmF0ZShcbiAgICAgICAgcGl4ZWxDb29yZC54IC8gdGhpcy53b3Jrc3BhY2VfLnNjYWxlLFxuICAgICAgICBwaXhlbENvb3JkLnkgLyB0aGlzLndvcmtzcGFjZV8uc2NhbGUpO1xuICAgIGlmICh0aGlzLndvcmtzcGFjZV8uaXNNdXRhdG9yKSB7XG4gICAgICAvLyBJZiB3ZSdyZSBpbiBhIG11dGF0b3IsIGl0cyBzY2FsZSBpcyBhbHdheXMgMSwgcHVyZWx5IGJlY2F1c2Ugb2Ygc29tZVxuICAgICAgLy8gb2RkaXRpZXMgaW4gb3VyIHJlbmRlcmluZyBvcHRpbWl6YXRpb25zLiAgVGhlIGFjdHVhbCBzY2FsZSBpcyB0aGUgc2FtZVxuICAgICAgLy8gYXMgdGhlIHNjYWxlIG9uIHRoZSBwYXJlbnQgd29ya3NwYWNlLiBGaXggdGhhdCBmb3IgZHJhZ2dpbmcuXG4gICAgICBjb25zdCBtYWluU2NhbGUgPSB0aGlzLndvcmtzcGFjZV8ub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2UhLnNjYWxlO1xuICAgICAgcmVzdWx0LnNjYWxlKDEgLyBtYWluU2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgYWxsIG9mIHRoZSBpY29ucyBjb25uZWN0ZWQgdG8gdGhpcyBkcmFnLlxuICAgKlxuICAgKiBAcGFyYW0gZHh5IEhvdyBmYXIgdG8gbW92ZSB0aGUgaWNvbnMgZnJvbSB0aGVpciBvcmlnaW5hbCBwb3NpdGlvbnMsIGluXG4gICAqICAgICB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBwcm90ZWN0ZWQgZHJhZ0ljb25zXyhkeHk6IENvb3JkaW5hdGUpIHtcbiAgICAvLyBNb3ZpbmcgaWNvbnMgbW92ZXMgdGhlaXIgYXNzb2NpYXRlZCBidWJibGVzLlxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kcmFnSWNvbkRhdGFfLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5kcmFnSWNvbkRhdGFfW2ldO1xuICAgICAgZGF0YS5pY29uLnNldEljb25Mb2NhdGlvbihDb29yZGluYXRlLnN1bShkYXRhLmxvY2F0aW9uLCBkeHkpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgbGlzdCBvZiB0aGUgaW5zZXJ0aW9uIG1hcmtlcnMgdGhhdCBjdXJyZW50bHkgZXhpc3QuICBEcmFncyBoYXZlIDAsIDEsXG4gICAqIG9yIDIgaW5zZXJ0aW9uIG1hcmtlcnMuXG4gICAqXG4gICAqIEByZXR1cm5zIEEgcG9zc2libHkgZW1wdHkgbGlzdCBvZiBpbnNlcnRpb24gbWFya2VyIGJsb2Nrcy5cbiAgICovXG4gIGdldEluc2VydGlvbk1hcmtlcnMoKTogQmxvY2tTdmdbXSB7XG4gICAgLy8gTm8gaW5zZXJ0aW9uIG1hcmtlcnMgd2l0aCB0aGUgb2xkIHN0eWxlIG9mIGRyYWdnZWQgY29ubmVjdGlvbiBtYW5hZ2Vycy5cbiAgICBpZiAodGhpcy5kcmFnZ2VkQ29ubmVjdGlvbk1hbmFnZXJfICYmXG4gICAgICAgIHRoaXMuZHJhZ2dlZENvbm5lY3Rpb25NYW5hZ2VyXy5nZXRJbnNlcnRpb25NYXJrZXJzKSB7XG4gICAgICByZXR1cm4gdGhpcy5kcmFnZ2VkQ29ubmVjdGlvbk1hbmFnZXJfLmdldEluc2VydGlvbk1hcmtlcnMoKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKiBEYXRhIGFib3V0IHRoZSBwb3NpdGlvbiBvZiBhIGdpdmVuIGljb24uICovXG5leHBvcnQgaW50ZXJmYWNlIEljb25Qb3NpdGlvbkRhdGEge1xuICBsb2NhdGlvbjogQ29vcmRpbmF0ZTtcbiAgaWNvbjogSWNvbjtcbn1cblxuLyoqXG4gKiBNYWtlIGEgbGlzdCBvZiBhbGwgb2YgdGhlIGljb25zIChjb21tZW50LCB3YXJuaW5nLCBhbmQgbXV0YXRvcikgdGhhdCBhcmVcbiAqIG9uIHRoaXMgYmxvY2sgYW5kIGl0cyBkZXNjZW5kYW50cy4gIE1vdmluZyBhbiBpY29uIG1vdmVzIHRoZSBidWJibGUgdGhhdFxuICogZXh0ZW5kcyBmcm9tIGl0IGlmIHRoYXQgYnViYmxlIGlzIG9wZW4uXG4gKlxuICogQHBhcmFtIGJsb2NrIFRoZSByb290IGJsb2NrIHRoYXQgaXMgYmVpbmcgZHJhZ2dlZC5cbiAqIEByZXR1cm5zIFRoZSBsaXN0IG9mIGFsbCBpY29ucyBhbmQgdGhlaXIgbG9jYXRpb25zLlxuICovXG5mdW5jdGlvbiBpbml0SWNvbkRhdGEoYmxvY2s6IEJsb2NrU3ZnKTogSWNvblBvc2l0aW9uRGF0YVtdIHtcbiAgLy8gQnVpbGQgYSBsaXN0IG9mIGljb25zIHRoYXQgbmVlZCB0byBiZSBtb3ZlZCBhbmQgd2hlcmUgdGhleSBzdGFydGVkLlxuICBjb25zdCBkcmFnSWNvbkRhdGEgPSBbXTtcbiAgY29uc3QgZGVzY2VuZGFudHMgPSAoYmxvY2suZ2V0RGVzY2VuZGFudHMoZmFsc2UpKTtcblxuICBmb3IgKGxldCBpID0gMCwgZGVzY2VuZGFudDsgZGVzY2VuZGFudCA9IGRlc2NlbmRhbnRzW2ldOyBpKyspIHtcbiAgICBjb25zdCBpY29ucyA9IGRlc2NlbmRhbnQuZ2V0SWNvbnMoKTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGljb25zLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAvLyBDb29yZGluYXRlIHdpdGggeCBhbmQgeSBwcm9wZXJ0aWVzICh3b3Jrc3BhY2VcbiAgICAgICAgLy8gY29vcmRpbmF0ZXMpLlxuICAgICAgICBsb2NhdGlvbjogaWNvbnNbal0uZ2V0SWNvbkxvY2F0aW9uKCksICAvLyBCbG9ja2x5Lkljb25cbiAgICAgICAgaWNvbjogaWNvbnNbal0sXG4gICAgICB9O1xuICAgICAgZHJhZ0ljb25EYXRhLnB1c2goZGF0YSk7XG4gICAgfVxuICB9XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAneyBsb2NhdGlvbjogQ29vcmRpbmF0ZSB8IG51bGw7IGljb246XG4gIC8vIEljb247IH1bXScgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZSAnSWNvblBvc2l0aW9uRGF0YVtdJy5cbiAgcmV0dXJuIGRyYWdJY29uRGF0YSBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuQkxPQ0tfRFJBR0dFUiwgcmVnaXN0cnkuREVGQVVMVCwgQmxvY2tEcmFnZ2VyKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDExIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBUaGUgdG9wIGxldmVsIG5hbWVzcGFjZSB1c2VkIHRvIGFjY2VzcyB0aGUgQmxvY2tseSBsaWJyYXJ5LlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseVxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5Jyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX2Jsb2NrX2NyZWF0ZS5qcyc7XG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL3dvcmtzcGFjZV9ldmVudHMuanMnO1xuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfdWkuanMnO1xuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfdWlfYmFzZS5qcyc7XG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c192YXJfY3JlYXRlLmpzJztcblxuaW1wb3J0IHtCbG9ja30gZnJvbSAnLi9ibG9jay5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja0FuaW1hdGlvbnMgZnJvbSAnLi9ibG9ja19hbmltYXRpb25zLmpzJztcbmltcG9ydCB7QmxvY2tEcmFnU3VyZmFjZVN2Z30gZnJvbSAnLi9ibG9ja19kcmFnX3N1cmZhY2UuanMnO1xuaW1wb3J0IHtCbG9ja0RyYWdnZXJ9IGZyb20gJy4vYmxvY2tfZHJhZ2dlci5qcyc7XG5pbXBvcnQge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQge0Jsb2NrbHlPcHRpb25zfSBmcm9tICcuL2Jsb2NrbHlfb3B0aW9ucy5qcyc7XG5pbXBvcnQge0Jsb2Nrc30gZnJvbSAnLi9ibG9ja3MuanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCB7QnViYmxlfSBmcm9tICcuL2J1YmJsZS5qcyc7XG5pbXBvcnQge0J1YmJsZURyYWdnZXJ9IGZyb20gJy4vYnViYmxlX2RyYWdnZXIuanMnO1xuaW1wb3J0ICogYXMgYnVtcE9iamVjdHMgZnJvbSAnLi9idW1wX29iamVjdHMuanMnO1xuaW1wb3J0ICogYXMgY2xpcGJvYXJkIGZyb20gJy4vY2xpcGJvYXJkLmpzJztcbmltcG9ydCB7Q29tbWVudH0gZnJvbSAnLi9jb21tZW50LmpzJztcbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQge0NvbXBvbmVudE1hbmFnZXJ9IGZyb20gJy4vY29tcG9uZW50X21hbmFnZXIuanMnO1xuaW1wb3J0IHtjb25maWd9IGZyb20gJy4vY29uZmlnLmpzJztcbmltcG9ydCB7Q29ubmVjdGlvbn0gZnJvbSAnLi9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7Q29ubmVjdGlvbkNoZWNrZXJ9IGZyb20gJy4vY29ubmVjdGlvbl9jaGVja2VyLmpzJztcbmltcG9ydCB7Q29ubmVjdGlvbkRCfSBmcm9tICcuL2Nvbm5lY3Rpb25fZGIuanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0ICogYXMgQ29udGV4dE1lbnUgZnJvbSAnLi9jb250ZXh0bWVudS5qcyc7XG5pbXBvcnQgKiBhcyBDb250ZXh0TWVudUl0ZW1zIGZyb20gJy4vY29udGV4dG1lbnVfaXRlbXMuanMnO1xuaW1wb3J0IHtDb250ZXh0TWVudVJlZ2lzdHJ5fSBmcm9tICcuL2NvbnRleHRtZW51X3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIENzcyBmcm9tICcuL2Nzcy5qcyc7XG5pbXBvcnQge0RlbGV0ZUFyZWF9IGZyb20gJy4vZGVsZXRlX2FyZWEuanMnO1xuaW1wb3J0ICogYXMgZGlhbG9nIGZyb20gJy4vZGlhbG9nLmpzJztcbmltcG9ydCB7RHJhZ1RhcmdldH0gZnJvbSAnLi9kcmFnX3RhcmdldC5qcyc7XG5pbXBvcnQgKiBhcyBkcm9wRG93bkRpdiBmcm9tICcuL2Ryb3Bkb3duZGl2LmpzJztcbmltcG9ydCAqIGFzIEV2ZW50cyBmcm9tICcuL2V2ZW50cy9ldmVudHMuanMnO1xuaW1wb3J0ICogYXMgRXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMuanMnO1xuaW1wb3J0IHtGaWVsZCwgRmllbGRWYWxpZGF0b3J9IGZyb20gJy4vZmllbGQuanMnO1xuaW1wb3J0IHtGaWVsZEFuZ2xlLCBGaWVsZEFuZ2xlVmFsaWRhdG9yfSBmcm9tICcuL2ZpZWxkX2FuZ2xlLmpzJztcbmltcG9ydCB7RmllbGRDaGVja2JveCwgRmllbGRDaGVja2JveFZhbGlkYXRvcn0gZnJvbSAnLi9maWVsZF9jaGVja2JveC5qcyc7XG5pbXBvcnQge0ZpZWxkQ29sb3VyLCBGaWVsZENvbG91clZhbGlkYXRvcn0gZnJvbSAnLi9maWVsZF9jb2xvdXIuanMnO1xuaW1wb3J0IHtGaWVsZERyb3Bkb3duLCBGaWVsZERyb3Bkb3duVmFsaWRhdG9yLCBNZW51R2VuZXJhdG9yLCBNZW51R2VuZXJhdG9yRnVuY3Rpb24sIE1lbnVPcHRpb259IGZyb20gJy4vZmllbGRfZHJvcGRvd24uanMnO1xuaW1wb3J0IHtGaWVsZEltYWdlfSBmcm9tICcuL2ZpZWxkX2ltYWdlLmpzJztcbmltcG9ydCB7RmllbGRMYWJlbH0gZnJvbSAnLi9maWVsZF9sYWJlbC5qcyc7XG5pbXBvcnQge0ZpZWxkTGFiZWxTZXJpYWxpemFibGV9IGZyb20gJy4vZmllbGRfbGFiZWxfc2VyaWFsaXphYmxlLmpzJztcbmltcG9ydCB7RmllbGRNdWx0aWxpbmVJbnB1dCwgRmllbGRNdWx0aWxpbmVJbnB1dFZhbGlkYXRvcn0gZnJvbSAnLi9maWVsZF9tdWx0aWxpbmVpbnB1dC5qcyc7XG5pbXBvcnQge0ZpZWxkTnVtYmVyLCBGaWVsZE51bWJlclZhbGlkYXRvcn0gZnJvbSAnLi9maWVsZF9udW1iZXIuanMnO1xuaW1wb3J0ICogYXMgZmllbGRSZWdpc3RyeSBmcm9tICcuL2ZpZWxkX3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7RmllbGRUZXh0SW5wdXQsIEZpZWxkVGV4dElucHV0VmFsaWRhdG9yfSBmcm9tICcuL2ZpZWxkX3RleHRpbnB1dC5qcyc7XG5pbXBvcnQge0ZpZWxkVmFyaWFibGUsIEZpZWxkVmFyaWFibGVWYWxpZGF0b3J9IGZyb20gJy4vZmllbGRfdmFyaWFibGUuanMnO1xuaW1wb3J0IHtGbHlvdXR9IGZyb20gJy4vZmx5b3V0X2Jhc2UuanMnO1xuaW1wb3J0IHtGbHlvdXRCdXR0b259IGZyb20gJy4vZmx5b3V0X2J1dHRvbi5qcyc7XG5pbXBvcnQge0hvcml6b250YWxGbHlvdXR9IGZyb20gJy4vZmx5b3V0X2hvcml6b250YWwuanMnO1xuaW1wb3J0IHtGbHlvdXRNZXRyaWNzTWFuYWdlcn0gZnJvbSAnLi9mbHlvdXRfbWV0cmljc19tYW5hZ2VyLmpzJztcbmltcG9ydCB7VmVydGljYWxGbHlvdXR9IGZyb20gJy4vZmx5b3V0X3ZlcnRpY2FsLmpzJztcbmltcG9ydCB7Q29kZUdlbmVyYXRvcn0gZnJvbSAnLi9nZW5lcmF0b3IuanMnO1xuaW1wb3J0IHtHZXN0dXJlfSBmcm9tICcuL2dlc3R1cmUuanMnO1xuaW1wb3J0IHtHcmlkfSBmcm9tICcuL2dyaWQuanMnO1xuaW1wb3J0IHtJY29ufSBmcm9tICcuL2ljb24uanMnO1xuaW1wb3J0IHtpbmplY3R9IGZyb20gJy4vaW5qZWN0LmpzJztcbmltcG9ydCB7QWxpZ24sIElucHV0fSBmcm9tICcuL2lucHV0LmpzJztcbmltcG9ydCB7aW5wdXRUeXBlc30gZnJvbSAnLi9pbnB1dF90eXBlcy5qcyc7XG5pbXBvcnQge0luc2VydGlvbk1hcmtlck1hbmFnZXJ9IGZyb20gJy4vaW5zZXJ0aW9uX21hcmtlcl9tYW5hZ2VyLmpzJztcbmltcG9ydCB7SUFTVE5vZGVMb2NhdGlvbn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYXN0X25vZGVfbG9jYXRpb24uanMnO1xuaW1wb3J0IHtJQVNUTm9kZUxvY2F0aW9uU3ZnfSBmcm9tICcuL2ludGVyZmFjZXMvaV9hc3Rfbm9kZV9sb2NhdGlvbl9zdmcuanMnO1xuaW1wb3J0IHtJQVNUTm9kZUxvY2F0aW9uV2l0aEJsb2NrfSBmcm9tICcuL2ludGVyZmFjZXMvaV9hc3Rfbm9kZV9sb2NhdGlvbl93aXRoX2Jsb2NrLmpzJztcbmltcG9ydCB7SUF1dG9IaWRlYWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYXV0b2hpZGVhYmxlLmpzJztcbmltcG9ydCB7SUJsb2NrRHJhZ2dlcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYmxvY2tfZHJhZ2dlci5qcyc7XG5pbXBvcnQge0lCb3VuZGVkRWxlbWVudH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYm91bmRlZF9lbGVtZW50LmpzJztcbmltcG9ydCB7SUJ1YmJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYnViYmxlLmpzJztcbmltcG9ydCB7SUNvbGxhcHNpYmxlVG9vbGJveEl0ZW19IGZyb20gJy4vaW50ZXJmYWNlcy9pX2NvbGxhcHNpYmxlX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQge0lDb21wb25lbnR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2NvbXBvbmVudC5qcyc7XG5pbXBvcnQge0lDb25uZWN0aW9uQ2hlY2tlcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29ubmVjdGlvbl9jaGVja2VyLmpzJztcbmltcG9ydCB7SUNvbnRleHRNZW51fSBmcm9tICcuL2ludGVyZmFjZXMvaV9jb250ZXh0bWVudS5qcyc7XG5pbXBvcnQge0lDb3B5YWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29weWFibGUuanMnO1xuaW1wb3J0IHtJRGVsZXRhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9kZWxldGFibGUuanMnO1xuaW1wb3J0IHtJRGVsZXRlQXJlYX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZGVsZXRlX2FyZWEuanMnO1xuaW1wb3J0IHtJRHJhZ1RhcmdldH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ190YXJnZXQuanMnO1xuaW1wb3J0IHtJRHJhZ2dhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9kcmFnZ2FibGUuanMnO1xuaW1wb3J0IHtJRmx5b3V0fSBmcm9tICcuL2ludGVyZmFjZXMvaV9mbHlvdXQuanMnO1xuaW1wb3J0IHtJS2V5Ym9hcmRBY2Nlc3NpYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9rZXlib2FyZF9hY2Nlc3NpYmxlLmpzJztcbmltcG9ydCB7SU1ldHJpY3NNYW5hZ2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHtJTW92YWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfbW92YWJsZS5qcyc7XG5pbXBvcnQge0lQb3NpdGlvbmFibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX3Bvc2l0aW9uYWJsZS5qcyc7XG5pbXBvcnQge0lSZWdpc3RyYWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfcmVnaXN0cmFibGUuanMnO1xuaW1wb3J0IHtJU2VsZWN0YWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfc2VsZWN0YWJsZS5qcyc7XG5pbXBvcnQge0lTZWxlY3RhYmxlVG9vbGJveEl0ZW19IGZyb20gJy4vaW50ZXJmYWNlcy9pX3NlbGVjdGFibGVfdG9vbGJveF9pdGVtLmpzJztcbmltcG9ydCB7SVN0eWxlYWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfc3R5bGVhYmxlLmpzJztcbmltcG9ydCB7SVRvb2xib3h9IGZyb20gJy4vaW50ZXJmYWNlcy9pX3Rvb2xib3guanMnO1xuaW1wb3J0IHtJVG9vbGJveEl0ZW19IGZyb20gJy4vaW50ZXJmYWNlcy9pX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgKiBhcyBpbnRlcm5hbENvbnN0YW50cyBmcm9tICcuL2ludGVybmFsX2NvbnN0YW50cy5qcyc7XG5pbXBvcnQge0FTVE5vZGV9IGZyb20gJy4va2V5Ym9hcmRfbmF2L2FzdF9ub2RlLmpzJztcbmltcG9ydCB7QmFzaWNDdXJzb3J9IGZyb20gJy4va2V5Ym9hcmRfbmF2L2Jhc2ljX2N1cnNvci5qcyc7XG5pbXBvcnQge0N1cnNvcn0gZnJvbSAnLi9rZXlib2FyZF9uYXYvY3Vyc29yLmpzJztcbmltcG9ydCB7TWFya2VyfSBmcm9tICcuL2tleWJvYXJkX25hdi9tYXJrZXIuanMnO1xuaW1wb3J0IHtUYWJOYXZpZ2F0ZUN1cnNvcn0gZnJvbSAnLi9rZXlib2FyZF9uYXYvdGFiX25hdmlnYXRlX2N1cnNvci5qcyc7XG5pbXBvcnQge01hcmtlck1hbmFnZXJ9IGZyb20gJy4vbWFya2VyX21hbmFnZXIuanMnO1xuaW1wb3J0IHtNZW51fSBmcm9tICcuL21lbnUuanMnO1xuaW1wb3J0IHtNZW51SXRlbX0gZnJvbSAnLi9tZW51aXRlbS5qcyc7XG5pbXBvcnQge01ldHJpY3NNYW5hZ2VyfSBmcm9tICcuL21ldHJpY3NfbWFuYWdlci5qcyc7XG5pbXBvcnQge01zZywgc2V0TG9jYWxlfSBmcm9tICcuL21zZy5qcyc7XG5pbXBvcnQge011dGF0b3J9IGZyb20gJy4vbXV0YXRvci5qcyc7XG5pbXBvcnQge05hbWVzfSBmcm9tICcuL25hbWVzLmpzJztcbmltcG9ydCB7T3B0aW9uc30gZnJvbSAnLi9vcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIHVpUG9zaXRpb24gZnJvbSAnLi9wb3NpdGlvbmFibGVfaGVscGVycy5qcyc7XG5pbXBvcnQgKiBhcyBQcm9jZWR1cmVzIGZyb20gJy4vcHJvY2VkdXJlcy5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuL3JlbmRlcmVkX2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0ICogYXMgYmxvY2tSZW5kZXJpbmcgZnJvbSAnLi9yZW5kZXJlcnMvY29tbW9uL2Jsb2NrX3JlbmRlcmluZy5qcyc7XG5pbXBvcnQgKiBhcyBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0ICogYXMgZ2VyYXMgZnJvbSAnLi9yZW5kZXJlcnMvZ2VyYXMvZ2VyYXMuanMnO1xuaW1wb3J0ICogYXMgbWluaW1hbGlzdCBmcm9tICcuL3JlbmRlcmVycy9taW5pbWFsaXN0L21pbmltYWxpc3QuanMnO1xuaW1wb3J0ICogYXMgdGhyYXNvcyBmcm9tICcuL3JlbmRlcmVycy90aHJhc29zL3RocmFzb3MuanMnO1xuaW1wb3J0ICogYXMgemVsb3MgZnJvbSAnLi9yZW5kZXJlcnMvemVsb3MvemVsb3MuanMnO1xuaW1wb3J0IHtTY3JvbGxiYXJ9IGZyb20gJy4vc2Nyb2xsYmFyLmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyUGFpcn0gZnJvbSAnLi9zY3JvbGxiYXJfcGFpci5qcyc7XG5pbXBvcnQgKiBhcyBzZXJpYWxpemF0aW9uIGZyb20gJy4vc2VyaWFsaXphdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyBTaG9ydGN1dEl0ZW1zIGZyb20gJy4vc2hvcnRjdXRfaXRlbXMuanMnO1xuaW1wb3J0IHtTaG9ydGN1dFJlZ2lzdHJ5fSBmcm9tICcuL3Nob3J0Y3V0X3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7VGhlbWV9IGZyb20gJy4vdGhlbWUuanMnO1xuaW1wb3J0ICogYXMgVGhlbWVzIGZyb20gJy4vdGhlbWUvdGhlbWVzLmpzJztcbmltcG9ydCB7VGhlbWVNYW5hZ2VyfSBmcm9tICcuL3RoZW1lX21hbmFnZXIuanMnO1xuaW1wb3J0IHtUb29sYm94Q2F0ZWdvcnl9IGZyb20gJy4vdG9vbGJveC9jYXRlZ29yeS5qcyc7XG5pbXBvcnQge0NvbGxhcHNpYmxlVG9vbGJveENhdGVnb3J5fSBmcm9tICcuL3Rvb2xib3gvY29sbGFwc2libGVfY2F0ZWdvcnkuanMnO1xuaW1wb3J0IHtUb29sYm94U2VwYXJhdG9yfSBmcm9tICcuL3Rvb2xib3gvc2VwYXJhdG9yLmpzJztcbmltcG9ydCB7VG9vbGJveH0gZnJvbSAnLi90b29sYm94L3Rvb2xib3guanMnO1xuaW1wb3J0IHtUb29sYm94SXRlbX0gZnJvbSAnLi90b29sYm94L3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgKiBhcyBUb29sdGlwIGZyb20gJy4vdG9vbHRpcC5qcyc7XG5pbXBvcnQgKiBhcyBUb3VjaCBmcm9tICcuL3RvdWNoLmpzJztcbmltcG9ydCB7VHJhc2hjYW59IGZyb20gJy4vdHJhc2hjYW4uanMnO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgKiBhcyBjb2xvdXIgZnJvbSAnLi91dGlscy9jb2xvdXIuanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyB0b29sYm94IGZyb20gJy4vdXRpbHMvdG9vbGJveC5qcyc7XG5pbXBvcnQge1ZhcmlhYmxlTWFwfSBmcm9tICcuL3ZhcmlhYmxlX21hcC5qcyc7XG5pbXBvcnQge1ZhcmlhYmxlTW9kZWx9IGZyb20gJy4vdmFyaWFibGVfbW9kZWwuanMnO1xuaW1wb3J0ICogYXMgVmFyaWFibGVzIGZyb20gJy4vdmFyaWFibGVzLmpzJztcbmltcG9ydCAqIGFzIFZhcmlhYmxlc0R5bmFtaWMgZnJvbSAnLi92YXJpYWJsZXNfZHluYW1pYy5qcyc7XG5pbXBvcnQge1dhcm5pbmd9IGZyb20gJy4vd2FybmluZy5qcyc7XG5pbXBvcnQgKiBhcyBXaWRnZXREaXYgZnJvbSAnLi93aWRnZXRkaXYuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2V9IGZyb20gJy4vd29ya3NwYWNlLmpzJztcbmltcG9ydCB7V29ya3NwYWNlQXVkaW99IGZyb20gJy4vd29ya3NwYWNlX2F1ZGlvLmpzJztcbmltcG9ydCB7V29ya3NwYWNlQ29tbWVudH0gZnJvbSAnLi93b3Jrc3BhY2VfY29tbWVudC5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZUNvbW1lbnRTdmd9IGZyb20gJy4vd29ya3NwYWNlX2NvbW1lbnRfc3ZnLmpzJztcbmltcG9ydCB7V29ya3NwYWNlRHJhZ1N1cmZhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX2RyYWdfc3VyZmFjZV9zdmcuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VEcmFnZ2VyfSBmcm9tICcuL3dvcmtzcGFjZV9kcmFnZ2VyLmpzJztcbmltcG9ydCB7cmVzaXplU3ZnQ29udGVudHMgYXMgcmVhbFJlc2l6ZVN2Z0NvbnRlbnRzLCBXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBYbWwgZnJvbSAnLi94bWwuanMnO1xuaW1wb3J0IHtab29tQ29udHJvbHN9IGZyb20gJy4vem9vbV9jb250cm9scy5qcyc7XG5cblxuLyoqXG4gKiBCbG9ja2x5IGNvcmUgdmVyc2lvbi5cbiAqIFRoaXMgY29uc3RhbnQgaXMgb3ZlcnJpZGRlbiBieSB0aGUgYnVpbGQgc2NyaXB0IChucG0gcnVuIGJ1aWxkKSB0byB0aGUgdmFsdWVcbiAqIG9mIHRoZSB2ZXJzaW9uIGluIHBhY2thZ2UuanNvbi4gVGhpcyBpcyBkb25lIGJ5IHRoZSBDbG9zdXJlIENvbXBpbGVyIGluIHRoZVxuICogYnVpbGRDb21wcmVzc2VkIGd1bHAgdGFzay5cbiAqIEZvciBsb2NhbCBidWlsZHMsIHlvdSBjYW4gcGFzcyAtLWRlZmluZT0nQmxvY2tseS5WRVJTSU9OPVguWS5aJyB0byB0aGVcbiAqIGNvbXBpbGVyIHRvIG92ZXJyaWRlIHRoaXMgY29uc3RhbnQuXG4gKlxuICogQGRlZmluZSB7c3RyaW5nfVxuICogQGFsaWFzIEJsb2NrbHkuVkVSU0lPTlxuICovXG5leHBvcnQgY29uc3QgVkVSU0lPTiA9ICd1bmNvbXBpbGVkJztcblxuLypcbiAqIFRvcC1sZXZlbCBmdW5jdGlvbnMgYW5kIHByb3BlcnRpZXMgb24gdGhlIEJsb2NrbHkgbmFtZXNwYWNlLlxuICogVGhlc2UgYXJlIHVzZWQgb25seSBpbiBleHRlcm5hbCBjb2RlLiBEbyBub3QgcmVmZXJlbmNlIHRoZXNlXG4gKiBmcm9tIGludGVybmFsIGNvZGUgYXMgaW1wb3J0aW5nIGZyb20gdGhpcyBmaWxlIGNhbiBjYXVzZSBjaXJjdWxhclxuICogZGVwZW5kZW5jaWVzLiBEbyBub3QgYWRkIG5ldyBmdW5jdGlvbnMgaGVyZS4gVGhlcmUgaXMgcHJvYmFibHkgYSBiZXR0ZXJcbiAqIG5hbWVzcGFjZSB0byBwdXQgbmV3IGZ1bmN0aW9ucyBvbi5cbiAqL1xuXG4vKlxuICogQWxpYXNlcyBmb3IgaW5wdXQgYWxpZ25tZW50cyB1c2VkIGluIGJsb2NrIGRlZmludGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAc2VlIEJsb2NrbHkuSW5wdXQuQWxpZ24uTEVGVFxuICogQGFsaWFzIEJsb2NrbHkuQUxJR05fTEVGVFxuICovXG5leHBvcnQgY29uc3QgQUxJR05fTEVGVCA9IEFsaWduLkxFRlQ7XG5cbi8qKlxuICogQHNlZSBCbG9ja2x5LklucHV0LkFsaWduLkNFTlRSRVxuICogQGFsaWFzIEJsb2NrbHkuQUxJR05fQ0VOVFJFXG4gKi9cbmV4cG9ydCBjb25zdCBBTElHTl9DRU5UUkUgPSBBbGlnbi5DRU5UUkU7XG5cbi8qKlxuICogQHNlZSBCbG9ja2x5LklucHV0LkFsaWduLlJJR0hUXG4gKiBAYWxpYXMgQmxvY2tseS5BTElHTl9SSUdIVFxuICovXG5leHBvcnQgY29uc3QgQUxJR05fUklHSFQgPSBBbGlnbi5SSUdIVDtcbi8qXG4gKiBBbGlhc2VzIGZvciBjb25zdGFudHMgdXNlZCBmb3IgY29ubmVjdGlvbiBhbmQgaW5wdXQgdHlwZXMuXG4gKi9cblxuLyoqXG4gKiBAc2VlIENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFXG4gKiBAYWxpYXMgQmxvY2tseS5JTlBVVF9WQUxVRVxuICovXG5leHBvcnQgY29uc3QgSU5QVVRfVkFMVUUgPSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRTtcblxuLyoqXG4gKiBAc2VlIENvbm5lY3Rpb25UeXBlLk9VVFBVVF9WQUxVRVxuICogQGFsaWFzIEJsb2NrbHkuT1VUUFVUX1ZBTFVFXG4gKi9cbmV4cG9ydCBjb25zdCBPVVRQVVRfVkFMVUUgPSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUU7XG5cbi8qKlxuICogQHNlZSBDb25uZWN0aW9uVHlwZS5ORVhUX1NUQVRFTUVOVFxuICogQGFsaWFzIEJsb2NrbHkuTkVYVF9TVEFURU1FTlRcbiAqL1xuZXhwb3J0IGNvbnN0IE5FWFRfU1RBVEVNRU5UID0gQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQ7XG5cbi8qKlxuICogQHNlZSBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlRcbiAqIEBhbGlhcyBCbG9ja2x5LlBSRVZJT1VTX1NUQVRFTUVOVFxuICovXG5leHBvcnQgY29uc3QgUFJFVklPVVNfU1RBVEVNRU5UID0gQ29ubmVjdGlvblR5cGUuUFJFVklPVVNfU1RBVEVNRU5UO1xuXG4vKipcbiAqIEBzZWUgaW5wdXRUeXBlcy5EVU1NWV9JTlBVVFxuICogQGFsaWFzIEJsb2NrbHkuRFVNTVlfSU5QVVRcbiAqL1xuZXhwb3J0IGNvbnN0IERVTU1ZX0lOUFVUID0gaW5wdXRUeXBlcy5EVU1NWTtcblxuLyoqIEFsaWFzZXMgZm9yIHRvb2xib3ggcG9zaXRpb25zLiAqL1xuXG4vKipcbiAqIEBzZWUgdG9vbGJveC5Qb3NpdGlvbi5UT1BcbiAqIEBhbGlhcyBCbG9ja2x5LlRPT0xCT1hfQVRfVE9QXG4gKi9cbmV4cG9ydCBjb25zdCBUT09MQk9YX0FUX1RPUCA9IHRvb2xib3guUG9zaXRpb24uVE9QO1xuXG4vKipcbiAqIEBzZWUgdG9vbGJveC5Qb3NpdGlvbi5CT1RUT01cbiAqIEBhbGlhcyBCbG9ja2x5LlRPT0xCT1hfQVRfQk9UVE9NXG4gKi9cbmV4cG9ydCBjb25zdCBUT09MQk9YX0FUX0JPVFRPTSA9IHRvb2xib3guUG9zaXRpb24uQk9UVE9NO1xuXG4vKipcbiAqIEBzZWUgdG9vbGJveC5Qb3NpdGlvbi5MRUZUXG4gKiBAYWxpYXMgQmxvY2tseS5UT09MQk9YX0FUX0xFRlRcbiAqL1xuZXhwb3J0IGNvbnN0IFRPT0xCT1hfQVRfTEVGVCA9IHRvb2xib3guUG9zaXRpb24uTEVGVDtcblxuLyoqXG4gKiBAc2VlIHRvb2xib3guUG9zaXRpb24uUklHSFRcbiAqIEBhbGlhcyBCbG9ja2x5LlRPT0xCT1hfQVRfUklHSFRcbiAqL1xuZXhwb3J0IGNvbnN0IFRPT0xCT1hfQVRfUklHSFQgPSB0b29sYm94LlBvc2l0aW9uLlJJR0hUO1xuXG4vKlxuICogT3RoZXIgYWxpYXNlZCBmdW5jdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBTaXplIHRoZSBTVkcgaW1hZ2UgdG8gY29tcGxldGVseSBmaWxsIGl0cyBjb250YWluZXIuIENhbGwgdGhpcyB3aGVuIHRoZSB2aWV3XG4gKiBhY3R1YWxseSBjaGFuZ2VzIHNpemVzIChlLmcuIG9uIGEgd2luZG93IHJlc2l6ZS9kZXZpY2Ugb3JpZW50YXRpb24gY2hhbmdlKS5cbiAqIFNlZSB3b3Jrc3BhY2UucmVzaXplQ29udGVudHMgdG8gcmVzaXplIHRoZSB3b3Jrc3BhY2Ugd2hlbiB0aGUgY29udGVudHNcbiAqIGNoYW5nZSAoZS5nLiB3aGVuIGEgYmxvY2sgaXMgYWRkZWQgb3IgcmVtb3ZlZCkuXG4gKiBSZWNvcmQgdGhlIGhlaWdodC93aWR0aCBvZiB0aGUgU1ZHIGltYWdlLlxuICpcbiAqIEBwYXJhbSB3b3Jrc3BhY2UgQW55IHdvcmtzcGFjZSBpbiB0aGUgU1ZHLlxuICogQHNlZSBCbG9ja2x5LmNvbW1vbi5zdmdSZXNpemVcbiAqIEBhbGlhcyBCbG9ja2x5LnN2Z1Jlc2l6ZVxuICovXG5leHBvcnQgY29uc3Qgc3ZnUmVzaXplID0gY29tbW9uLnN2Z1Jlc2l6ZTtcblxuLyoqXG4gKiBDbG9zZSB0b29sdGlwcywgY29udGV4dCBtZW51cywgZHJvcGRvd24gc2VsZWN0aW9ucywgZXRjLlxuICpcbiAqIEBwYXJhbSBvcHRfb25seUNsb3NlUG9wdXBzIFdoZXRoZXIgb25seSBwb3B1cHMgc2hvdWxkIGJlIGNsb3NlZC5cbiAqIEBzZWUgQmxvY2tseS5Xb3Jrc3BhY2VTdmcuaGlkZUNoYWZmXG4gKiBAYWxpYXMgQmxvY2tseS5oaWRlQ2hhZmZcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGVDaGFmZihvcHRfb25seUNsb3NlUG9wdXBzPzogYm9vbGVhbikge1xuICAoY29tbW9uLmdldE1haW5Xb3Jrc3BhY2UoKSBhcyBXb3Jrc3BhY2VTdmcpLmhpZGVDaGFmZihvcHRfb25seUNsb3NlUG9wdXBzKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBtYWluIHdvcmtzcGFjZS4gIFJldHVybnMgdGhlIGxhc3QgdXNlZCBtYWluIHdvcmtzcGFjZSAoYmFzZWQgb25cbiAqIGZvY3VzKS4gIFRyeSBub3QgdG8gdXNlIHRoaXMgZnVuY3Rpb24sIHBhcnRpY3VsYXJseSBpZiB0aGVyZSBhcmUgbXVsdGlwbGVcbiAqIEJsb2NrbHkgaW5zdGFuY2VzIG9uIGEgcGFnZS5cbiAqXG4gKiBAc2VlIEJsb2NrbHkuY29tbW9uLmdldE1haW5Xb3Jrc3BhY2VcbiAqIEBhbGlhcyBCbG9ja2x5LmdldE1haW5Xb3Jrc3BhY2VcbiAqL1xuZXhwb3J0IGNvbnN0IGdldE1haW5Xb3Jrc3BhY2UgPSBjb21tb24uZ2V0TWFpbldvcmtzcGFjZTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgY29weWFibGUgb2JqZWN0LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmNvbW1vbi5nZXRTZWxlY3RlZFxuICovXG5leHBvcnQgY29uc3QgZ2V0U2VsZWN0ZWQgPSBjb21tb24uZ2V0U2VsZWN0ZWQ7XG5cbi8qKlxuICogRGVmaW5lIGJsb2NrcyBmcm9tIGFuIGFycmF5IG9mIEpTT04gYmxvY2sgZGVmaW5pdGlvbnMsIGFzIG1pZ2h0IGJlIGdlbmVyYXRlZFxuICogYnkgdGhlIEJsb2NrbHkgRGV2ZWxvcGVyIFRvb2xzLlxuICpcbiAqIEBwYXJhbSBqc29uQXJyYXkgQW4gYXJyYXkgb2YgSlNPTiBibG9jayBkZWZpbml0aW9ucy5cbiAqIEBzZWUgQmxvY2tseS5jb21tb24uZGVmaW5lQmxvY2tzV2l0aEpzb25BcnJheVxuICogQGFsaWFzIEJsb2NrbHkuZGVmaW5lQmxvY2tzV2l0aEpzb25BcnJheVxuICovXG5leHBvcnQgY29uc3QgZGVmaW5lQmxvY2tzV2l0aEpzb25BcnJheSA9IGNvbW1vbi5kZWZpbmVCbG9ja3NXaXRoSnNvbkFycmF5O1xuXG4vKipcbiAqIFNldCB0aGUgcGFyZW50IGNvbnRhaW5lci4gIFRoaXMgaXMgdGhlIGNvbnRhaW5lciBlbGVtZW50IHRoYXQgdGhlIFdpZGdldERpdixcbiAqIGRyb3BEb3duRGl2LCBhbmQgVG9vbHRpcCBhcmUgcmVuZGVyZWQgaW50byB0aGUgZmlyc3QgdGltZSBgQmxvY2tseS5pbmplY3RgXG4gKiBpcyBjYWxsZWQuXG4gKiBUaGlzIG1ldGhvZCBpcyBhIE5PUCBpZiBjYWxsZWQgYWZ0ZXIgdGhlIGZpcnN0IGBCbG9ja2x5LmluamVjdGAuXG4gKlxuICogQHBhcmFtIGNvbnRhaW5lciBUaGUgY29udGFpbmVyIGVsZW1lbnQuXG4gKiBAc2VlIEJsb2NrbHkuY29tbW9uLnNldFBhcmVudENvbnRhaW5lclxuICogQGFsaWFzIEJsb2NrbHkuc2V0UGFyZW50Q29udGFpbmVyXG4gKi9cbmV4cG9ydCBjb25zdCBzZXRQYXJlbnRDb250YWluZXIgPSBjb21tb24uc2V0UGFyZW50Q29udGFpbmVyO1xuXG4vKipcbiAqIFNpemUgdGhlIHdvcmtzcGFjZSB3aGVuIHRoZSBjb250ZW50cyBjaGFuZ2UuICBUaGlzIGFsc28gdXBkYXRlc1xuICogc2Nyb2xsYmFycyBhY2NvcmRpbmdseS5cbiAqXG4gKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gcmVzaXplLlxuICogQGRlcHJlY2F0ZWQgVXNlICoqd29ya3NwYWNlLnJlc2l6ZUNvbnRlbnRzKiogaW5zdGVhZC5cbiAqIEBzZWUgQmxvY2tseS5Xb3Jrc3BhY2VTdmcucmVzaXplQ29udGVudHNcbiAqIEBhbGlhcyBCbG9ja2x5LnJlc2l6ZVN2Z0NvbnRlbnRzXG4gKi9cbmZ1bmN0aW9uIHJlc2l6ZVN2Z0NvbnRlbnRzTG9jYWwod29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnJlc2l6ZVN2Z0NvbnRlbnRzJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAnQmxvY2tseS5Xb3Jrc3BhY2VTdmcucmVzaXplU3ZnQ29udGVudHMnKTtcbiAgcmVhbFJlc2l6ZVN2Z0NvbnRlbnRzKHdvcmtzcGFjZSk7XG59XG5leHBvcnQgY29uc3QgcmVzaXplU3ZnQ29udGVudHMgPSByZXNpemVTdmdDb250ZW50c0xvY2FsO1xuXG4vKipcbiAqIENvcHkgYSBibG9jayBvciB3b3Jrc3BhY2UgY29tbWVudCBvbnRvIHRoZSBsb2NhbCBjbGlwYm9hcmQuXG4gKlxuICogQHBhcmFtIHRvQ29weSBCbG9jayBvciBXb3Jrc3BhY2UgQ29tbWVudCB0byBiZSBjb3BpZWQuXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LmNsaXBib2FyZC5jb3B5KiogaW5zdGVhZC5cbiAqIEBzZWUgQmxvY2tseS5jbGlwYm9hcmQuY29weVxuICogQGFsaWFzIEJsb2NrbHkuY29weVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29weSh0b0NvcHk6IElDb3B5YWJsZSkge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkuY29weScsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkuY2xpcGJvYXJkLmNvcHknKTtcbiAgY2xpcGJvYXJkLmNvcHkodG9Db3B5KTtcbn1cblxuLyoqXG4gKiBQYXN0ZSBhIGJsb2NrIG9yIHdvcmtzcGFjZSBjb21tZW50IG9uIHRvIHRoZSBtYWluIHdvcmtzcGFjZS5cbiAqXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBwYXN0ZSB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICogQGRlcHJlY2F0ZWQgVXNlICoqQmxvY2tseS5jbGlwYm9hcmQucGFzdGUqKiBpbnN0ZWFkLlxuICogQHNlZSBCbG9ja2x5LmNsaXBib2FyZC5wYXN0ZVxuICogQGFsaWFzIEJsb2NrbHkucGFzdGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhc3RlKCk6IGJvb2xlYW4ge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkucGFzdGUnLCAnRGVjZW1iZXIgMjAyMScsICdEZWNlbWJlciAyMDIyJyxcbiAgICAgICdCbG9ja2x5LmNsaXBib2FyZC5wYXN0ZScpO1xuICByZXR1cm4gISFjbGlwYm9hcmQucGFzdGUoKTtcbn1cblxuLyoqXG4gKiBEdXBsaWNhdGUgdGhpcyBibG9jayBhbmQgaXRzIGNoaWxkcmVuLCBvciBhIHdvcmtzcGFjZSBjb21tZW50LlxuICpcbiAqIEBwYXJhbSB0b0R1cGxpY2F0ZSBCbG9jayBvciBXb3Jrc3BhY2UgQ29tbWVudCB0byBiZSBjb3BpZWQuXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LmNsaXBib2FyZC5kdXBsaWNhdGUqKiBpbnN0ZWFkLlxuICogQHNlZSBCbG9ja2x5LmNsaXBib2FyZC5kdXBsaWNhdGVcbiAqIEBhbGlhcyBCbG9ja2x5LmR1cGxpY2F0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZHVwbGljYXRlKHRvRHVwbGljYXRlOiBJQ29weWFibGUpIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LmR1cGxpY2F0ZScsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkuY2xpcGJvYXJkLmR1cGxpY2F0ZScpO1xuICBjbGlwYm9hcmQuZHVwbGljYXRlKHRvRHVwbGljYXRlKTtcbn1cblxuLyoqXG4gKiBJcyB0aGUgZ2l2ZW4gc3RyaW5nIGEgbnVtYmVyIChpbmNsdWRlcyBuZWdhdGl2ZSBhbmQgZGVjaW1hbHMpLlxuICpcbiAqIEBwYXJhbSBzdHIgSW5wdXQgc3RyaW5nLlxuICogQHJldHVybnMgVHJ1ZSBpZiBudW1iZXIsIGZhbHNlIG90aGVyd2lzZS5cbiAqIEBkZXByZWNhdGVkIFVzZSAqKkJsb2NrbHkudXRpbHMuc3RyaW5nLmlzTnVtYmVyKiogaW5zdGVhZC5cbiAqIEBzZWUgQmxvY2tseS51dGlscy5zdHJpbmcuaXNOdW1iZXJcbiAqIEBhbGlhcyBCbG9ja2x5LmlzTnVtYmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcihzdHI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkuaXNOdW1iZXInLCAnRGVjZW1iZXIgMjAyMScsICdEZWNlbWJlciAyMDIyJyxcbiAgICAgICdCbG9ja2x5LnV0aWxzLnN0cmluZy5pc051bWJlcicpO1xuICByZXR1cm4gdXRpbHMuc3RyaW5nLmlzTnVtYmVyKHN0cik7XG59XG5cbi8qKlxuICogQ29udmVydCBhIGh1ZSAoSFNWIG1vZGVsKSBpbnRvIGFuIFJHQiBoZXggdHJpcGxldC5cbiAqXG4gKiBAcGFyYW0gaHVlIEh1ZSBvbiBhIGNvbG91ciB3aGVlbCAoMC0zNjApLlxuICogQHJldHVybnMgUkdCIGNvZGUsIGUuZy4gJyM1YmE2NWInLlxuICogQGRlcHJlY2F0ZWQgVXNlICoqQmxvY2tseS51dGlscy5jb2xvdXIuaHVlVG9IZXgqKiBpbnN0ZWFkLlxuICogQHNlZSBCbG9ja2x5LnV0aWxzLmNvbG91ci5odWVUb0hleFxuICogQGFsaWFzIEJsb2NrbHkuaHVlVG9IZXhcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGh1ZVRvSGV4KGh1ZTogbnVtYmVyKTogc3RyaW5nIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5Lmh1ZVRvSGV4JywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAnQmxvY2tseS51dGlscy5jb2xvdXIuaHVlVG9IZXgnKTtcbiAgcmV0dXJuIGNvbG91ci5odWVUb0hleChodWUpO1xufVxuXG4vKipcbiAqIEJpbmQgYW4gZXZlbnQgaGFuZGxlciB0aGF0IHNob3VsZCBiZSBjYWxsZWQgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIGl0IGlzIHBhcnRcbiAqIG9mIHRoZSBhY3RpdmUgdG91Y2ggc3RyZWFtLlxuICogVXNlIHRoaXMgZm9yIGV2ZW50cyB0aGF0IGFyZSBub3QgcGFydCBvZiBhIG11bHRpLXBhcnQgZ2VzdHVyZSAoZS5nLlxuICogbW91c2VvdmVyIGZvciB0b29sdGlwcykuXG4gKlxuICogQHBhcmFtIG5vZGUgTm9kZSB1cG9uIHdoaWNoIHRvIGxpc3Rlbi5cbiAqIEBwYXJhbSBuYW1lIEV2ZW50IG5hbWUgdG8gbGlzdGVuIHRvIChlLmcuICdtb3VzZWRvd24nKS5cbiAqIEBwYXJhbSB0aGlzT2JqZWN0IFRoZSB2YWx1ZSBvZiAndGhpcycgaW4gdGhlIGZ1bmN0aW9uLlxuICogQHBhcmFtIGZ1bmMgRnVuY3Rpb24gdG8gY2FsbCB3aGVuIGV2ZW50IGlzIHRyaWdnZXJlZC5cbiAqIEByZXR1cm5zIE9wYXF1ZSBkYXRhIHRoYXQgY2FuIGJlIHBhc3NlZCB0byB1bmJpbmRFdmVudF8uXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LmJyb3dzZXJFdmVudHMuYmluZCoqIGluc3RlYWQuXG4gKiBAc2VlIEJsb2NrbHkuYnJvd3NlckV2ZW50cy5iaW5kXG4gKiBAYWxpYXMgQmxvY2tseS5iaW5kRXZlbnRfXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBiaW5kRXZlbnRfKFxuICAgIG5vZGU6IEV2ZW50VGFyZ2V0LCBuYW1lOiBzdHJpbmcsIHRoaXNPYmplY3Q6IE9iamVjdHxudWxsLFxuICAgIGZ1bmM6IEZ1bmN0aW9uKTogYnJvd3NlckV2ZW50cy5EYXRhIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LmJpbmRFdmVudF8nLCAnRGVjZW1iZXIgMjAyMScsICdEZWNlbWJlciAyMDIyJyxcbiAgICAgICdCbG9ja2x5LmJyb3dzZXJFdmVudHMuYmluZCcpO1xuICByZXR1cm4gYnJvd3NlckV2ZW50cy5iaW5kKG5vZGUsIG5hbWUsIHRoaXNPYmplY3QsIGZ1bmMpO1xufVxuXG4vKipcbiAqIFVuYmluZCBvbmUgb3IgbW9yZSBldmVudHMgZXZlbnQgZnJvbSBhIGZ1bmN0aW9uIGNhbGwuXG4gKlxuICogQHBhcmFtIGJpbmREYXRhIE9wYXF1ZSBkYXRhIGZyb20gYmluZEV2ZW50Xy5cbiAqICAgICBUaGlzIGxpc3QgaXMgZW1wdGllZCBkdXJpbmcgdGhlIGNvdXJzZSBvZiBjYWxsaW5nIHRoaXMgZnVuY3Rpb24uXG4gKiBAcmV0dXJucyBUaGUgZnVuY3Rpb24gY2FsbC5cbiAqIEBkZXByZWNhdGVkIFVzZSAqKkJsb2NrbHkuYnJvd3NlckV2ZW50cy51bmJpbmQqKiBpbnN0ZWFkLlxuICogQHNlZSBicm93c2VyRXZlbnRzLnVuYmluZFxuICogQGFsaWFzIEJsb2NrbHkudW5iaW5kRXZlbnRfXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bmJpbmRFdmVudF8oYmluZERhdGE6IGJyb3dzZXJFdmVudHMuRGF0YSk6IEZ1bmN0aW9uIHtcbiAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICdCbG9ja2x5LnVuYmluZEV2ZW50XycsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgJ0Jsb2NrbHkuYnJvd3NlckV2ZW50cy51bmJpbmQnKTtcbiAgcmV0dXJuIGJyb3dzZXJFdmVudHMudW5iaW5kKGJpbmREYXRhKTtcbn1cblxuLyoqXG4gKiBCaW5kIGFuIGV2ZW50IGhhbmRsZXIgdGhhdCBjYW4gYmUgaWdub3JlZCBpZiBpdCBpcyBub3QgcGFydCBvZiB0aGUgYWN0aXZlXG4gKiB0b3VjaCBzdHJlYW0uXG4gKiBVc2UgdGhpcyBmb3IgZXZlbnRzIHRoYXQgZWl0aGVyIHN0YXJ0IG9yIGNvbnRpbnVlIGEgbXVsdGktcGFydCBnZXN0dXJlIChlLmcuXG4gKiBtb3VzZWRvd24gb3IgbW91c2Vtb3ZlLCB3aGljaCBtYXkgYmUgcGFydCBvZiBhIGRyYWcgb3IgY2xpY2spLlxuICpcbiAqIEBwYXJhbSBub2RlIE5vZGUgdXBvbiB3aGljaCB0byBsaXN0ZW4uXG4gKiBAcGFyYW0gbmFtZSBFdmVudCBuYW1lIHRvIGxpc3RlbiB0byAoZS5nLiAnbW91c2Vkb3duJykuXG4gKiBAcGFyYW0gdGhpc09iamVjdCBUaGUgdmFsdWUgb2YgJ3RoaXMnIGluIHRoZSBmdW5jdGlvbi5cbiAqIEBwYXJhbSBmdW5jIEZ1bmN0aW9uIHRvIGNhbGwgd2hlbiBldmVudCBpcyB0cmlnZ2VyZWQuXG4gKiBAcGFyYW0gb3B0X25vQ2FwdHVyZUlkZW50aWZpZXIgVHJ1ZSBpZiB0cmlnZ2VyaW5nIG9uIHRoaXMgZXZlbnQgc2hvdWxkIG5vdFxuICogICAgIGJsb2NrIGV4ZWN1dGlvbiBvZiBvdGhlciBldmVudCBoYW5kbGVycyBvbiB0aGlzIHRvdWNoIG9yIG90aGVyXG4gKiAgICAgc2ltdWx0YW5lb3VzIHRvdWNoZXMuICBGYWxzZSBieSBkZWZhdWx0LlxuICogQHBhcmFtIF9vcHRfbm9QcmV2ZW50RGVmYXVsdCBOby1vcCwgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHYxMC5cbiAqIEByZXR1cm5zIE9wYXF1ZSBkYXRhIHRoYXQgY2FuIGJlIHBhc3NlZCB0byB1bmJpbmRFdmVudF8uXG4gKiBAZGVwcmVjYXRlZCBVc2UgKipCbG9ja2x5LmJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKiogaW5zdGVhZC5cbiAqIEBzZWUgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmRcbiAqIEBhbGlhcyBCbG9ja2x5LmJpbmRFdmVudFdpdGhDaGVja3NfXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBiaW5kRXZlbnRXaXRoQ2hlY2tzXyhcbiAgICBub2RlOiBFdmVudFRhcmdldCwgbmFtZTogc3RyaW5nLCB0aGlzT2JqZWN0OiBPYmplY3R8bnVsbCwgZnVuYzogRnVuY3Rpb24sXG4gICAgb3B0X25vQ2FwdHVyZUlkZW50aWZpZXI/OiBib29sZWFuLFxuICAgIF9vcHRfbm9QcmV2ZW50RGVmYXVsdD86IGJvb2xlYW4pOiBicm93c2VyRXZlbnRzLkRhdGEge1xuICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgJ0Jsb2NrbHkuYmluZEV2ZW50V2l0aENoZWNrc18nLCAnRGVjZW1iZXIgMjAyMScsICdEZWNlbWJlciAyMDIyJyxcbiAgICAgICdCbG9ja2x5LmJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kJyk7XG4gIHJldHVybiBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgIG5vZGUsIG5hbWUsIHRoaXNPYmplY3QsIGZ1bmMsIG9wdF9ub0NhcHR1cmVJZGVudGlmaWVyKTtcbn1cblxuLy8gQWxpYXNlcyB0byBhbGxvdyBleHRlcm5hbCBjb2RlIHRvIGFjY2VzcyB0aGVzZSB2YWx1ZXMgZm9yIGxlZ2FjeSByZWFzb25zLlxuZXhwb3J0IGNvbnN0IENPTExBUFNFX0NIQVJTID0gaW50ZXJuYWxDb25zdGFudHMuQ09MTEFQU0VfQ0hBUlM7XG5leHBvcnQgY29uc3QgRFJBR19TVEFDSyA9IGludGVybmFsQ29uc3RhbnRzLkRSQUdfU1RBQ0s7XG5leHBvcnQgY29uc3QgT1BQT1NJVEVfVFlQRSA9IGludGVybmFsQ29uc3RhbnRzLk9QUE9TSVRFX1RZUEU7XG5leHBvcnQgY29uc3QgUkVOQU1FX1ZBUklBQkxFX0lEID0gaW50ZXJuYWxDb25zdGFudHMuUkVOQU1FX1ZBUklBQkxFX0lEO1xuZXhwb3J0IGNvbnN0IERFTEVURV9WQVJJQUJMRV9JRCA9IGludGVybmFsQ29uc3RhbnRzLkRFTEVURV9WQVJJQUJMRV9JRDtcbmV4cG9ydCBjb25zdCBDT0xMQVBTRURfSU5QVVRfTkFNRSA9IGNvbnN0YW50cy5DT0xMQVBTRURfSU5QVVRfTkFNRTtcbmV4cG9ydCBjb25zdCBDT0xMQVBTRURfRklFTERfTkFNRSA9IGNvbnN0YW50cy5DT0xMQVBTRURfRklFTERfTkFNRTtcblxuLyoqXG4gKiBTdHJpbmcgZm9yIHVzZSBpbiB0aGUgXCJjdXN0b21cIiBhdHRyaWJ1dGUgb2YgYSBjYXRlZ29yeSBpbiB0b29sYm94IFhNTC5cbiAqIFRoaXMgc3RyaW5nIGluZGljYXRlcyB0aGF0IHRoZSBjYXRlZ29yeSBzaG91bGQgYmUgZHluYW1pY2FsbHkgcG9wdWxhdGVkIHdpdGhcbiAqIHZhcmlhYmxlIGJsb2Nrcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5WQVJJQUJMRV9DQVRFR09SWV9OQU1FXG4gKi9cbmV4cG9ydCBjb25zdCBWQVJJQUJMRV9DQVRFR09SWV9OQU1FOiBzdHJpbmcgPSBWYXJpYWJsZXMuQ0FURUdPUllfTkFNRTtcblxuLyoqXG4gKiBTdHJpbmcgZm9yIHVzZSBpbiB0aGUgXCJjdXN0b21cIiBhdHRyaWJ1dGUgb2YgYSBjYXRlZ29yeSBpbiB0b29sYm94IFhNTC5cbiAqIFRoaXMgc3RyaW5nIGluZGljYXRlcyB0aGF0IHRoZSBjYXRlZ29yeSBzaG91bGQgYmUgZHluYW1pY2FsbHkgcG9wdWxhdGVkIHdpdGhcbiAqIHZhcmlhYmxlIGJsb2Nrcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5WQVJJQUJMRV9EWU5BTUlDX0NBVEVHT1JZX05BTUVcbiAqL1xuZXhwb3J0IGNvbnN0IFZBUklBQkxFX0RZTkFNSUNfQ0FURUdPUllfTkFNRTogc3RyaW5nID1cbiAgICBWYXJpYWJsZXNEeW5hbWljLkNBVEVHT1JZX05BTUU7XG4vKipcbiAqIFN0cmluZyBmb3IgdXNlIGluIHRoZSBcImN1c3RvbVwiIGF0dHJpYnV0ZSBvZiBhIGNhdGVnb3J5IGluIHRvb2xib3ggWE1MLlxuICogVGhpcyBzdHJpbmcgaW5kaWNhdGVzIHRoYXQgdGhlIGNhdGVnb3J5IHNob3VsZCBiZSBkeW5hbWljYWxseSBwb3B1bGF0ZWQgd2l0aFxuICogcHJvY2VkdXJlIGJsb2Nrcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5QUk9DRURVUkVfQ0FURUdPUllfTkFNRVxuICovXG5leHBvcnQgY29uc3QgUFJPQ0VEVVJFX0NBVEVHT1JZX05BTUU6IHN0cmluZyA9IFByb2NlZHVyZXMuQ0FURUdPUllfTkFNRTtcblxuXG4vLyBDb250ZXh0IGZvciB3aHkgd2UgbmVlZCB0byBtb25rZXktcGF0Y2ggaW4gdGhlc2UgZnVuY3Rpb25zIChpbnRlcm5hbCk6XG4vLyAgIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMU1iTzBMRUEtcEF5eDFFckdMSm55VXFUTHJjWVRvLTV6Z2E5cXBsbnhlWG8vZWRpdD91c3A9c2hhcmluZyZyZXNvdXJjZWtleT0wLTVoXzMyLWktZEh3SGpmXzlLWUVWS2dcblxuLy8gY2xhbmctZm9ybWF0IG9mZlxuV29ya3NwYWNlLnByb3RvdHlwZS5uZXdCbG9jayA9XG4gICAgZnVuY3Rpb24ocHJvdG90eXBlTmFtZTogc3RyaW5nLCBvcHRfaWQ/OiBzdHJpbmcpOiBCbG9jayB7XG4gICAgICByZXR1cm4gbmV3IEJsb2NrKHRoaXMsIHByb3RvdHlwZU5hbWUsIG9wdF9pZCk7XG4gICAgfTtcblxuV29ya3NwYWNlU3ZnLnByb3RvdHlwZS5uZXdCbG9jayA9XG4gICAgZnVuY3Rpb24ocHJvdG90eXBlTmFtZTogc3RyaW5nLCBvcHRfaWQ/OiBzdHJpbmcpOiBCbG9ja1N2ZyB7XG4gICAgICByZXR1cm4gbmV3IEJsb2NrU3ZnKHRoaXMsIHByb3RvdHlwZU5hbWUsIG9wdF9pZCk7XG4gICAgfTtcblxuV29ya3NwYWNlU3ZnLm5ld1RyYXNoY2FuID0gZnVuY3Rpb24od29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpOiBUcmFzaGNhbiB7XG4gIHJldHVybiBuZXcgVHJhc2hjYW4od29ya3NwYWNlKTtcbn07XG5cbldvcmtzcGFjZUNvbW1lbnRTdmcucHJvdG90eXBlLnNob3dDb250ZXh0TWVudSA9XG4gICAgZnVuY3Rpb24odGhpczogV29ya3NwYWNlQ29tbWVudFN2ZywgZTogRXZlbnQpIHtcbiAgICAgIGlmICh0aGlzLndvcmtzcGFjZS5vcHRpb25zLnJlYWRPbmx5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG1lbnVPcHRpb25zID0gW107XG5cbiAgICAgIGlmICh0aGlzLmlzRGVsZXRhYmxlKCkgJiYgdGhpcy5pc01vdmFibGUoKSkge1xuICAgICAgICBtZW51T3B0aW9ucy5wdXNoKENvbnRleHRNZW51LmNvbW1lbnREdXBsaWNhdGVPcHRpb24odGhpcykpO1xuICAgICAgICBtZW51T3B0aW9ucy5wdXNoKENvbnRleHRNZW51LmNvbW1lbnREZWxldGVPcHRpb24odGhpcykpO1xuICAgICAgfVxuXG4gICAgICBDb250ZXh0TWVudS5zaG93KGUsIG1lbnVPcHRpb25zLCB0aGlzLlJUTCk7XG4gICAgfTtcblxuTXV0YXRvci5wcm90b3R5cGUubmV3V29ya3NwYWNlU3ZnID1cbiAgICBmdW5jdGlvbihvcHRpb25zOiBPcHRpb25zKTogV29ya3NwYWNlU3ZnIHtcbiAgICAgIHJldHVybiBuZXcgV29ya3NwYWNlU3ZnKG9wdGlvbnMpO1xuICAgIH07XG5cbk5hbWVzLnByb3RvdHlwZS5wb3B1bGF0ZVByb2NlZHVyZXMgPVxuICAgIGZ1bmN0aW9uKHRoaXM6IE5hbWVzLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgICAgY29uc3QgcHJvY2VkdXJlcyA9IFByb2NlZHVyZXMuYWxsUHJvY2VkdXJlcyh3b3Jrc3BhY2UpO1xuICAgICAgLy8gRmxhdHRlbiB0aGUgcmV0dXJuIHZzIG5vLXJldHVybiBwcm9jZWR1cmUgbGlzdHMuXG4gICAgICBjb25zdCBmbGF0dGVuZWRQcm9jZWR1cmVzOiBBbnlEdXJpbmdNaWdyYXRpb25bXVtdID1cbiAgICAgICAgICBwcm9jZWR1cmVzWzBdLmNvbmNhdChwcm9jZWR1cmVzWzFdKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmxhdHRlbmVkUHJvY2VkdXJlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLmdldE5hbWUoZmxhdHRlbmVkUHJvY2VkdXJlc1tpXVswXSwgTmFtZXMuTmFtZVR5cGUuUFJPQ0VEVVJFKTtcbiAgICAgIH1cbiAgICB9O1xuLy8gY2xhbmctZm9ybWF0IG9uXG5cblxuLy8gUmUtZXhwb3J0IHN1Ym1vZHVsZXMgdGhhdCBubyBsb25nZXIgZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZS5cbmV4cG9ydCB7YnJvd3NlckV2ZW50c307XG5leHBvcnQge0NvbnRleHRNZW51fTtcbmV4cG9ydCB7Q29udGV4dE1lbnVJdGVtc307XG5leHBvcnQge0Nzc307XG5leHBvcnQge0V2ZW50c307XG5leHBvcnQge0V4dGVuc2lvbnN9O1xuZXhwb3J0IHtQcm9jZWR1cmVzfTtcbmV4cG9ydCB7UHJvY2VkdXJlcyBhcyBwcm9jZWR1cmVzfTtcbmV4cG9ydCB7U2hvcnRjdXRJdGVtc307XG5leHBvcnQge1RoZW1lc307XG5leHBvcnQge1Rvb2x0aXB9O1xuZXhwb3J0IHtUb3VjaH07XG5leHBvcnQge1ZhcmlhYmxlc307XG5leHBvcnQge1ZhcmlhYmxlc0R5bmFtaWN9O1xuZXhwb3J0IHtXaWRnZXREaXZ9O1xuZXhwb3J0IHtYbWx9O1xuZXhwb3J0IHtibG9ja0FuaW1hdGlvbnN9O1xuZXhwb3J0IHtibG9ja1JlbmRlcmluZ307XG5leHBvcnQge2J1bXBPYmplY3RzfTtcbmV4cG9ydCB7Y2xpcGJvYXJkfTtcbmV4cG9ydCB7Y29tbW9ufTtcbmV4cG9ydCB7Y29uc3RhbnRzfTtcbmV4cG9ydCB7ZGlhbG9nfTtcbmV4cG9ydCB7ZmllbGRSZWdpc3RyeX07XG5leHBvcnQge2dlcmFzfTtcbmV4cG9ydCB7bWluaW1hbGlzdH07XG5leHBvcnQge3JlZ2lzdHJ5fTtcbmV4cG9ydCB7dGhyYXNvc307XG5leHBvcnQge3VpUG9zaXRpb259O1xuZXhwb3J0IHt1dGlsc307XG5leHBvcnQge3plbG9zfTtcbmV4cG9ydCB7QVNUTm9kZX07XG5leHBvcnQge0Jhc2ljQ3Vyc29yfTtcbmV4cG9ydCB7QmxvY2t9O1xuZXhwb3J0IHtCbG9ja2x5T3B0aW9uc307XG5leHBvcnQge0Jsb2NrRHJhZ2dlcn07XG5leHBvcnQge0Jsb2NrRHJhZ1N1cmZhY2VTdmd9O1xuZXhwb3J0IHtCbG9ja1N2Z307XG5leHBvcnQge0Jsb2Nrc307XG5leHBvcnQge0J1YmJsZX07XG5leHBvcnQge0J1YmJsZURyYWdnZXJ9O1xuZXhwb3J0IHtDb2xsYXBzaWJsZVRvb2xib3hDYXRlZ29yeX07XG5leHBvcnQge0NvbW1lbnR9O1xuZXhwb3J0IHtDb21wb25lbnRNYW5hZ2VyfTtcbmV4cG9ydCB7Q29ubmVjdGlvbn07XG5leHBvcnQge0Nvbm5lY3Rpb25UeXBlfTtcbmV4cG9ydCB7Q29ubmVjdGlvbkNoZWNrZXJ9O1xuZXhwb3J0IHtDb25uZWN0aW9uREJ9O1xuZXhwb3J0IHtDb250ZXh0TWVudVJlZ2lzdHJ5fTtcbmV4cG9ydCB7Q3Vyc29yfTtcbmV4cG9ydCB7RGVsZXRlQXJlYX07XG5leHBvcnQge0RyYWdUYXJnZXR9O1xuZXhwb3J0IGNvbnN0IERyb3BEb3duRGl2ID0gZHJvcERvd25EaXY7XG5leHBvcnQge0ZpZWxkLCBGaWVsZFZhbGlkYXRvcn07XG5leHBvcnQge0ZpZWxkQW5nbGUsIEZpZWxkQW5nbGVWYWxpZGF0b3J9O1xuZXhwb3J0IHtGaWVsZENoZWNrYm94LCBGaWVsZENoZWNrYm94VmFsaWRhdG9yfTtcbmV4cG9ydCB7RmllbGRDb2xvdXIsIEZpZWxkQ29sb3VyVmFsaWRhdG9yfTtcbmV4cG9ydCB7XG4gIEZpZWxkRHJvcGRvd24sXG4gIEZpZWxkRHJvcGRvd25WYWxpZGF0b3IsXG4gIE1lbnVHZW5lcmF0b3IsXG4gIE1lbnVHZW5lcmF0b3JGdW5jdGlvbixcbiAgTWVudU9wdGlvbixcbn07XG5leHBvcnQge0ZpZWxkSW1hZ2V9O1xuZXhwb3J0IHtGaWVsZExhYmVsfTtcbmV4cG9ydCB7RmllbGRMYWJlbFNlcmlhbGl6YWJsZX07XG5leHBvcnQge0ZpZWxkTXVsdGlsaW5lSW5wdXQsIEZpZWxkTXVsdGlsaW5lSW5wdXRWYWxpZGF0b3J9O1xuZXhwb3J0IHtGaWVsZE51bWJlciwgRmllbGROdW1iZXJWYWxpZGF0b3J9O1xuZXhwb3J0IHtGaWVsZFRleHRJbnB1dCwgRmllbGRUZXh0SW5wdXRWYWxpZGF0b3J9O1xuZXhwb3J0IHtGaWVsZFZhcmlhYmxlLCBGaWVsZFZhcmlhYmxlVmFsaWRhdG9yfTtcbmV4cG9ydCB7Rmx5b3V0fTtcbmV4cG9ydCB7Rmx5b3V0QnV0dG9ufTtcbmV4cG9ydCB7Rmx5b3V0TWV0cmljc01hbmFnZXJ9O1xuZXhwb3J0IHtDb2RlR2VuZXJhdG9yfTtcbmV4cG9ydCB7Q29kZUdlbmVyYXRvciBhcyBHZW5lcmF0b3J9OyAgLy8gRGVwcmVjYXRlZCBuYW1lLCBPY3RvYmVyIDIwMjIuXG5leHBvcnQge0dlc3R1cmV9O1xuZXhwb3J0IHtHZXN0dXJlIGFzIFRvdWNoR2VzdHVyZX07ICAvLyBSZW1vdmUgaW4gdjEwLlxuZXhwb3J0IHtHcmlkfTtcbmV4cG9ydCB7SG9yaXpvbnRhbEZseW91dH07XG5leHBvcnQge0lBU1ROb2RlTG9jYXRpb259O1xuZXhwb3J0IHtJQVNUTm9kZUxvY2F0aW9uU3ZnfTtcbmV4cG9ydCB7SUFTVE5vZGVMb2NhdGlvbldpdGhCbG9ja307XG5leHBvcnQge0lBdXRvSGlkZWFibGV9O1xuZXhwb3J0IHtJQmxvY2tEcmFnZ2VyfTtcbmV4cG9ydCB7SUJvdW5kZWRFbGVtZW50fTtcbmV4cG9ydCB7SUJ1YmJsZX07XG5leHBvcnQge0lDb2xsYXBzaWJsZVRvb2xib3hJdGVtfTtcbmV4cG9ydCB7SUNvbXBvbmVudH07XG5leHBvcnQge0lDb25uZWN0aW9uQ2hlY2tlcn07XG5leHBvcnQge0lDb250ZXh0TWVudX07XG5leHBvcnQge0ljb259O1xuZXhwb3J0IHtJQ29weWFibGV9O1xuZXhwb3J0IHtJRGVsZXRhYmxlfTtcbmV4cG9ydCB7SURlbGV0ZUFyZWF9O1xuZXhwb3J0IHtJRHJhZ1RhcmdldH07XG5leHBvcnQge0lEcmFnZ2FibGV9O1xuZXhwb3J0IHtJRmx5b3V0fTtcbmV4cG9ydCB7SUtleWJvYXJkQWNjZXNzaWJsZX07XG5leHBvcnQge0lNZXRyaWNzTWFuYWdlcn07XG5leHBvcnQge0lNb3ZhYmxlfTtcbmV4cG9ydCB7SW5wdXR9O1xuZXhwb3J0IHtJbnNlcnRpb25NYXJrZXJNYW5hZ2VyfTtcbmV4cG9ydCB7SVBvc2l0aW9uYWJsZX07XG5leHBvcnQge0lSZWdpc3RyYWJsZX07XG5leHBvcnQge0lTZWxlY3RhYmxlfTtcbmV4cG9ydCB7SVNlbGVjdGFibGVUb29sYm94SXRlbX07XG5leHBvcnQge0lTdHlsZWFibGV9O1xuZXhwb3J0IHtJVG9vbGJveH07XG5leHBvcnQge0lUb29sYm94SXRlbX07XG5leHBvcnQge01hcmtlcn07XG5leHBvcnQge01hcmtlck1hbmFnZXJ9O1xuZXhwb3J0IHtNZW51fTtcbmV4cG9ydCB7TWVudUl0ZW19O1xuZXhwb3J0IHtNZXRyaWNzTWFuYWdlcn07XG5leHBvcnQge011dGF0b3J9O1xuZXhwb3J0IHtNc2csIHNldExvY2FsZX07XG5leHBvcnQge05hbWVzfTtcbmV4cG9ydCB7T3B0aW9uc307XG5leHBvcnQge1JlbmRlcmVkQ29ubmVjdGlvbn07XG5leHBvcnQge1Njcm9sbGJhcn07XG5leHBvcnQge1Njcm9sbGJhclBhaXJ9O1xuZXhwb3J0IHtTaG9ydGN1dFJlZ2lzdHJ5fTtcbmV4cG9ydCB7VGFiTmF2aWdhdGVDdXJzb3J9O1xuZXhwb3J0IHtUaGVtZX07XG5leHBvcnQge1RoZW1lTWFuYWdlcn07XG5leHBvcnQge1Rvb2xib3h9O1xuZXhwb3J0IHtUb29sYm94Q2F0ZWdvcnl9O1xuZXhwb3J0IHtUb29sYm94SXRlbX07XG5leHBvcnQge1Rvb2xib3hTZXBhcmF0b3J9O1xuZXhwb3J0IHtUcmFzaGNhbn07XG5leHBvcnQge1ZhcmlhYmxlTWFwfTtcbmV4cG9ydCB7VmFyaWFibGVNb2RlbH07XG5leHBvcnQge1ZlcnRpY2FsRmx5b3V0fTtcbmV4cG9ydCB7V2FybmluZ307XG5leHBvcnQge1dvcmtzcGFjZX07XG5leHBvcnQge1dvcmtzcGFjZUF1ZGlvfTtcbmV4cG9ydCB7V29ya3NwYWNlQ29tbWVudH07XG5leHBvcnQge1dvcmtzcGFjZUNvbW1lbnRTdmd9O1xuZXhwb3J0IHtXb3Jrc3BhY2VEcmFnU3VyZmFjZVN2Z307XG5leHBvcnQge1dvcmtzcGFjZURyYWdnZXJ9O1xuZXhwb3J0IHtXb3Jrc3BhY2VTdmd9O1xuZXhwb3J0IHtab29tQ29udHJvbHN9O1xuZXhwb3J0IHtjb25maWd9O1xuLyoqIEBkZXByZWNhdGVkIFVzZSBCbG9ja2x5LkNvbm5lY3Rpb25UeXBlIGluc3RlYWQuICovXG5leHBvcnQgY29uc3QgY29ubmVjdGlvblR5cGVzID0gQ29ubmVjdGlvblR5cGU7XG5leHBvcnQge2luamVjdH07XG5leHBvcnQge2lucHV0VHlwZXN9O1xuZXhwb3J0IHtzZXJpYWxpemF0aW9ufTtcbiIsbnVsbCxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCwiLy8gQ29weXJpZ2h0IDIwMTggVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMtSVNcIiBCQVNJUyxcbi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBFUzYgbW9kdWxlIHRoYXQgZXhwb3J0cyBzeW1ib2xzIGZyb20gYmFzZS5qcyBzbyB0aGF0IEVTNlxuICogbW9kdWxlcyBkbyBub3QgbmVlZCB0byB1c2UgZ2xvYmFscyBhbmQgc28gdGhhdCBpcyBjbGVhciBpZiBhIHByb2plY3QgaXMgdXNpbmdcbiAqIENsb3N1cmUncyBiYXNlLmpzIGZpbGUuIEl0IGlzIGFsc28gYSBzdWJzZXQgb2YgcHJvcGVydGllcyBpbiBiYXNlLmpzLCBtZWFuaW5nXG4gKiBpdCBzaG91bGQgYmUgY2xlYXJlciB3aGF0IHNob3VsZCBub3QgYmUgdXNlZCBpbiBFUzYgbW9kdWxlc1xuICogKGdvb2cubW9kdWxlL3Byb3ZpZGUgYXJlIG5vdCBleHBvcnRlZCBoZXJlLCBmb3IgZXhhbXBsZSkuIFRob3VnaCB0aGF0IGlzIG5vdFxuICogdG8gc2F5IHRoYXQgZXZlcnl0aGluZyBpbiB0aGlzIGZpbGUgc2hvdWxkIGJlIHVzZWQgaW4gYW4gRVM2IG1vZHVsZTsgc29tZVxuICogZGVwcmVjaWF0ZWQgZnVuY3Rpb25zIGFyZSBleHBvcnRlZCB0byBtYWtlIG1pZ3JhdGlvbiBlYXNpZXIgKGUuZy5cbiAqIGdvb2cuc2NvcGUpLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIGRvZXMgbm90IGxvYWQgQ2xvc3VyZSdzIGJhc2UuanMgZmlsZSwgaXQgaXMgc3RpbGwgdXAgdG8gdGhlXG4gKiBwcm9ncmFtbWVyIHRvIGluY2x1ZGUgaXQuIE5vciBkb2VzIHRoZSBmYWN0IHRoYXQgdGhpcyBpcyBhbiBFUzYgbW9kdWxlIG1lYW5cbiAqIHRoYXQgcHJvamVjdHMgbm8gbG9uZ2VyIHJlcXVpcmUgZGVwcy5qcyBmaWxlcyBmb3IgZGVidWcgbG9hZGluZyAtIHRoZXkgZG8uXG4gKiBDbG9zdXJlIHdpbGwgbmVlZCB0byBsb2FkIHlvdXIgRVM2IG1vZHVsZXMgZm9yIHlvdSBpZiB5b3UgaGF2ZSBhbnkgQ2xvc3VyZVxuICogZmlsZSAoZ29vZy5wcm92aWRlL2dvb2cubW9kdWxlKSBkZXBlbmRlbmNpZXMsIGFzIHRoZXkgbmVlZCB0byBiZSBhdmFpbGFibGVcbiAqIGJlZm9yZSB0aGUgRVM2IG1vZHVsZSBldmFsdWF0ZXMuXG4gKlxuICogQWxzbyBub3RlIHRoYXQgdGhpcyBmaWxlIGhhcyBzcGVjaWFsIGNvbXBpbGVyIGhhbmRsaW5nISBJdCBpcyBva2F5IHRvIGV4cG9ydFxuICogYW55dGhpbmcgZnJvbSB0aGlzIGZpbGUsIGJ1dCB0aGUgbmFtZSBhbHNvIG5lZWRzIHRvIGV4aXN0IG9uIHRoZSBnbG9iYWwgZ29vZy5cbiAqIFRoaXMgc3BlY2lhbCBjb21waWxlciBwYXNzIGVuZm9yY2VzIHRoYXQgeW91IGFsd2F5cyBpbXBvcnQgdGhpcyBmaWxlIGFzXG4gKiBgaW1wb3J0ICogYXMgZ29vZ2AsIGFzIG1hbnkgdG9vbHMgdXNlIHJlZ2V4IGJhc2VkIHBhcnNpbmcgdG8gZmluZFxuICogZ29vZy5yZXF1aXJlIGNhbGxzLlxuICovXG5cbmV4cG9ydCBjb25zdCBnbG9iYWwgPSBnbG9iYWxUaGlzO1xuLy8gZXhwb3J0IGNvbnN0IHJlcXVpcmUgPSBnb29nLnJlcXVpcmU7XG4vLyBleHBvcnQgY29uc3QgZGVmaW5lID0gZ29vZy5kZWZpbmU7XG4vLyBleHBvcnQgY29uc3QgREVCVUcgPSBnb29nLkRFQlVHO1xuLy8gZXhwb3J0IGNvbnN0IExPQ0FMRSA9IGdvb2cuTE9DQUxFO1xuLy8gZXhwb3J0IGNvbnN0IFRSVVNURURfU0lURSA9IGdvb2cuVFJVU1RFRF9TSVRFO1xuLy8gZXhwb3J0IGNvbnN0IERJU0FMTE9XX1RFU1RfT05MWV9DT0RFID0gZ29vZy5ESVNBTExPV19URVNUX09OTFlfQ09ERTtcbi8vIGV4cG9ydCBjb25zdCBnZXRHb29nTW9kdWxlID0gZ29vZy5tb2R1bGUuZ2V0O1xuLy8gZXhwb3J0IGNvbnN0IHNldFRlc3RPbmx5ID0gZ29vZy5zZXRUZXN0T25seTtcbi8vIGV4cG9ydCBjb25zdCBmb3J3YXJkRGVjbGFyZSA9IGdvb2cuZm9yd2FyZERlY2xhcmU7XG4vLyBleHBvcnQgY29uc3QgZ2V0T2JqZWN0QnlOYW1lID0gZ29vZy5nZXRPYmplY3RCeU5hbWU7XG4vLyBleHBvcnQgY29uc3QgYmFzZVBhdGggPSBnb29nLmJhc2VQYXRoO1xuLy8gZXhwb3J0IGNvbnN0IGFkZFNpbmdsZXRvbkdldHRlciA9IGdvb2cuYWRkU2luZ2xldG9uR2V0dGVyO1xuLy8gZXhwb3J0IGNvbnN0IHR5cGVPZiA9IGdvb2cudHlwZU9mO1xuLy8gZXhwb3J0IGNvbnN0IGlzQXJyYXlMaWtlID0gZ29vZy5pc0FycmF5TGlrZTtcbi8vIGV4cG9ydCBjb25zdCBpc0RhdGVMaWtlID0gZ29vZy5pc0RhdGVMaWtlO1xuLy8gZXhwb3J0IGNvbnN0IGlzT2JqZWN0ID0gZ29vZy5pc09iamVjdDtcbi8vIGV4cG9ydCBjb25zdCBnZXRVaWQgPSBnb29nLmdldFVpZDtcbi8vIGV4cG9ydCBjb25zdCBoYXNVaWQgPSBnb29nLmhhc1VpZDtcbi8vIGV4cG9ydCBjb25zdCByZW1vdmVVaWQgPSBnb29nLnJlbW92ZVVpZDtcbi8vIGV4cG9ydCBjb25zdCBub3cgPSBEYXRlLm5vdztcbi8vIGV4cG9ydCBjb25zdCBnbG9iYWxFdmFsID0gZ29vZy5nbG9iYWxFdmFsO1xuLy8gZXhwb3J0IGNvbnN0IGdldENzc05hbWUgPSBnb29nLmdldENzc05hbWU7XG4vLyBleHBvcnQgY29uc3Qgc2V0Q3NzTmFtZU1hcHBpbmcgPSBnb29nLnNldENzc05hbWVNYXBwaW5nO1xuLy8gZXhwb3J0IGNvbnN0IGdldE1zZyA9IGdvb2cuZ2V0TXNnO1xuLy8gZXhwb3J0IGNvbnN0IGdldE1zZ1dpdGhGYWxsYmFjayA9IGdvb2cuZ2V0TXNnV2l0aEZhbGxiYWNrO1xuLy8gZXhwb3J0IGNvbnN0IGV4cG9ydFN5bWJvbCA9IGdvb2cuZXhwb3J0U3ltYm9sO1xuLy8gZXhwb3J0IGNvbnN0IGV4cG9ydFByb3BlcnR5ID0gZ29vZy5leHBvcnRQcm9wZXJ0eTtcbi8vIGV4cG9ydCBjb25zdCBhYnN0cmFjdE1ldGhvZCA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG4vLyBleHBvcnQgY29uc3QgY2xvbmVPYmplY3QgPSBnb29nLmNsb25lT2JqZWN0O1xuLy8gZXhwb3J0IGNvbnN0IGJpbmQgPSBnb29nLmJpbmQ7XG4vLyBleHBvcnQgY29uc3QgcGFydGlhbCA9IGdvb2cucGFydGlhbDtcbi8vIGV4cG9ydCBjb25zdCBpbmhlcml0cyA9IGdvb2cuaW5oZXJpdHM7XG4vLyBleHBvcnQgY29uc3Qgc2NvcGUgPSBnb29nLnNjb3BlO1xuLy8gZXhwb3J0IGNvbnN0IGRlZmluZUNsYXNzID0gZ29vZy5kZWZpbmVDbGFzcztcbmV4cG9ydCBjb25zdCBkZWNsYXJlTW9kdWxlSWQgPSBmdW5jdGlvbihuYW1lc3BhY2UpIHtcbiAgaWYgKHdpbmRvdy5nb29nICYmIHdpbmRvdy5nb29nLmRlY2xhcmVNb2R1bGVJZCkge1xuICAgIHdpbmRvdy5nb29nLmRlY2xhcmVNb2R1bGVJZC5jYWxsKHRoaXMsIG5hbWVzcGFjZSk7XG4gIH1cbn07XG5cblxuLy8gRXhwb3J0IHNlbGVjdCBwcm9wZXJ0aWVzIG9mIG1vZHVsZS4gRG8gbm90IGV4cG9ydCB0aGUgZnVuY3Rpb24gaXRzZWxmIG9yXG4vLyBnb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlLlxuLy8gZXhwb3J0IGNvbnN0IG1vZHVsZSA9IHtcbi8vICAgZ2V0OiBnb29nLm1vZHVsZS5nZXQsXG4vLyB9O1xuXG4vLyBPbWlzc2lvbnMgaW5jbHVkZTpcbi8vIGdvb2cuRU5BQkxFX0RFQlVHX0xPQURFUiAtIGRlZmluZSBvbmx5IHVzZWQgaW4gYmFzZS5cbi8vIGdvb2cuRU5BQkxFX0NIUk9NRV9BUFBfU0FGRV9TQ1JJUFRfTE9BRElORyAtIGRlZmluZSBvbmx5IHVzZWQgaW4gYmFzZS5cbi8vIGdvb2cucHJvdmlkZSAtIEVTNiBtb2R1bGVzIGRvIG5vdCBwcm92aWRlIGFueXRoaW5nLlxuLy8gZ29vZy5tb2R1bGUgLSBFUzYgbW9kdWxlcyBjYW5ub3QgYmUgZ29vZy5tb2R1bGVzLlxuLy8gZ29vZy5tb2R1bGUuZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZSAtIEVTNiBtb2R1bGVzIGNhbm5vdCBkZWNsYXJlIG5hbWVzcGFjZXMuXG4vLyBnb29nLmFkZERlcGVuZGVuY3kgLSBtZWFudCB0byBvbmx5IGJlIHVzZWQgYnkgZGVwZW5kZW5jeSBmaWxlcy5cbi8vIGdvb2cuREVQRU5ERU5DSUVTX0VOQUJMRUQgLSBjb25zdGFudCBvbmx5IHVzZWQgaW4gYmFzZS5cbi8vIGdvb2cuVFJBTlNQSUxFIC0gZGVmaW5lIG9ubHkgdXNlZCBpbiBiYXNlLlxuLy8gZ29vZy5UUkFOU1BJTEVSIC0gZGVmaW5lIG9ubHkgdXNlZCBpbiBiYXNlLlxuLy8gZ29vZy5sb2FkTW9kdWxlIC0gc2hvdWxkIG5vdCBiZSBjYWxsZWQgYnkgYW55IEVTNiBtb2R1bGU7IGV4aXN0cyBmb3Jcbi8vICAgZ2VuZXJhdGVkIGJ1bmRsZXMuXG4vLyBnb29nLkxPQURfTU9EVUxFX1VTSU5HX0VWQUwgLSBkZWZpbmUgb25seSB1c2VkIGluIGJhc2UuXG4vLyBnb29nLlNFQUxfTU9EVUxFX0VYUE9SVFMgLSBkZWZpbmUgb25seSB1c2VkIGluIGJhc2UuXG4vLyBnb29nLkRlYnVnTG9hZGVyIC0gdXNlZCByYXJlbHksIG9ubHkgb3V0c2lkZSBvZiBjb21waWxlZCBjb2RlLlxuLy8gZ29vZy5UcmFuc3BpbGVyIC0gdXNlZCByYXJlbHksIG9ubHkgb3V0c2lkZSBvZiBjb21waWxlZCBjb2RlLlxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEEgbWluaW1hbCBpbXBsZW1lbnRhdGlvbiBvZiBiYXNlLmpzLlxuICpcbiAqIFRoaXMgZmlsZSBpcyB1c2VkIGluIHBsYWNlIG9mIGJhc2UuanMgKENsb3N1cmUgbGlicmFyeSBib290c3RyYXBcbiAqIGNvZGUpIHdoZW4gYnVpbGRpbmcgQmxvY2tseSB1c2luZyB0aGUgQ2xvc3VyZSBDb21waWxlci4gIFJlZmVyIHRvXG4gKiBiYXNlLmpzIGZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IGl0ZW1zIGRlZmluZWQgaGVyZS5cbiAqXG4gKiBAcHJvdmlkZUdvb2dcbiAqL1xuXG4vKiogQGRlZmluZSB7Ym9vbGVhbn0gT3ZlcnJpZGRlbiB0byB0cnVlIGJ5IHRoZSBjb21waWxlci4gKi9cbnZhciBDT01QSUxFRCA9IGZhbHNlO1xuXG4vKiogQGNvbnN0ICovXG52YXIgZ29vZyA9IGdvb2cgfHwge307XG5cbi8qKlxuICogUmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAgVGhpcyBpcyBwcm92aWRlZCBhcyAncm9vdCcgYnkgdGhlXG4gKiBVTUQgd3JhcHBlciwgYnV0IHByZWZlciBnbG9iYWxUaGlzIGlmIGl0IGlzIGRlZmluZWQuXG4gKlxuICogaHR0cHM6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi85LjAvaW5kZXguaHRtbCNzZWMtZ2xvYmFsLW9iamVjdFxuICpcbiAqIEBjb25zdFxuICogQHR5cGUgeyFHbG9iYWx9XG4gKiBAc3VwcHJlc3Mge3VuZGVmaW5lZFZhcnN9XG4gKi9cbmdvb2cuZ2xvYmFsID0gZ2xvYmFsVGhpcyB8fCByb290O1xuXG4vKiogQHR5cGUge09iamVjdDxzdHJpbmcsIChzdHJpbmd8bnVtYmVyfGJvb2xlYW4pPnx1bmRlZmluZWR9ICovXG5nb29nLmdsb2JhbC5DTE9TVVJFX0RFRklORVM7XG5cbi8qKlxuICogRGVmaW5lcyBhIG5hbWVkIHZhbHVlLlxuICogV2hlbiBjb21waWxlZCB0aGUgZGVmYXVsdCBjYW4gYmUgb3ZlcnJpZGRlbiB1c2luZyB0aGUgY29tcGlsZXIgb3B0aW9ucyBvciB0aGVcbiAqIHZhbHVlIHNldCBpbiB0aGUgQ0xPU1VSRV9ERUZJTkVTIG9iamVjdC4gUmV0dXJucyB0aGUgZGVmaW5lZCB2YWx1ZSBzbyB0aGF0IGl0XG4gKiBjYW4gYmUgdXNlZCBzYWZlbHkgaW4gbW9kdWxlcy4gTm90ZSB0aGF0IHRoZSB2YWx1ZSB0eXBlIE1VU1QgYmUgZWl0aGVyXG4gKiBib29sZWFuLCBudW1iZXIsIG9yIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHtUfSBkZWZhdWx0VmFsdWVcbiAqIEByZXR1cm4ge1R9XG4gKiBAdGVtcGxhdGUgVFxuICovXG5nb29nLmRlZmluZSA9IGZ1bmN0aW9uKG5hbWUsIGRlZmF1bHRWYWx1ZSkge1xuICByZXR1cm4gZGVmYXVsdFZhbHVlO1xufTtcblxuLyoqIEBkZWZpbmUge2Jvb2xlYW59ICovXG5nb29nLkRFQlVHID0gZ29vZy5kZWZpbmUoJ2dvb2cuREVCVUcnLCBmYWxzZSk7XG5cbi8qKiBAZGVmaW5lIHtib29sZWFufSAqL1xuZ29vZy5ESVNBTExPV19URVNUX09OTFlfQ09ERSA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuRElTQUxMT1dfVEVTVF9PTkxZX0NPREUnLCBDT01QSUxFRCAmJiAhZ29vZy5ERUJVRyk7XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqL1xuZ29vZy5wcm92aWRlID0gZnVuY3Rpb24obmFtZSkge307XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmdvb2cubW9kdWxlID0gZnVuY3Rpb24obmFtZSkge307XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEByZXR1cm4gez99XG4gKiBAc3VwcHJlc3Mge21pc3NpbmdQcm92aWRlfVxuICovXG5nb29nLm1vZHVsZS5nZXQgPSBmdW5jdGlvbihuYW1lKSB7fTtcblxuLyoqIEBzdXBwcmVzcyB7bWlzc2luZ1Byb3ZpZGV9ICovXG5nb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlID0gZnVuY3Rpb24oKSB7fTtcblxuLyoqXG4gKiBNYXJrcyB0aGF0IHRoZSBjdXJyZW50IGZpbGUgc2hvdWxkIG9ubHkgYmUgdXNlZCBmb3IgdGVzdGluZywgYW5kIG5ldmVyIGZvclxuICogbGl2ZSBjb2RlIGluIHByb2R1Y3Rpb24uXG4gKlxuICogSW4gdGhlIGNhc2Ugb2YgdW5pdCB0ZXN0cywgdGhlIG1lc3NhZ2UgbWF5IG9wdGlvbmFsbHkgYmUgYW4gZXhhY3QgbmFtZXNwYWNlXG4gKiBmb3IgdGhlIHRlc3QgKGUuZy4gJ2dvb2cuc3RyaW5nVGVzdCcpLiBUaGUgbGludGVyIHdpbGwgdGhlbiBpZ25vcmUgdGhlIGV4dHJhXG4gKiBwcm92aWRlIChpZiBub3QgZXhwbGljaXRseSBkZWZpbmVkIGluIHRoZSBjb2RlKS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZz19IG9wdF9tZXNzYWdlIE9wdGlvbmFsIG1lc3NhZ2UgdG8gYWRkIHRvIHRoZSBlcnJvciB0aGF0J3NcbiAqICAgICByYWlzZWQgd2hlbiB1c2VkIGluIHByb2R1Y3Rpb24gY29kZS5cbiAqL1xuZ29vZy5zZXRUZXN0T25seSA9IGZ1bmN0aW9uKG9wdF9tZXNzYWdlKSB7XG4gIGlmIChnb29nLkRJU0FMTE9XX1RFU1RfT05MWV9DT0RFKSB7XG4gICAgb3B0X21lc3NhZ2UgPSBvcHRfbWVzc2FnZSB8fCAnJztcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdJbXBvcnRpbmcgdGVzdC1vbmx5IGNvZGUgaW50byBub24tZGVidWcgZW52aXJvbm1lbnQnICtcbiAgICAgICAgKG9wdF9tZXNzYWdlID8gJzogJyArIG9wdF9tZXNzYWdlIDogJy4nKSk7XG4gIH1cbn07XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVzcGFjZVxuICogQHJldHVybiB7P31cbiAqL1xuZ29vZy5yZXF1aXJlID0gZnVuY3Rpb24obmFtZXNwYWNlKSB7fTtcblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZXNwYWNlXG4gKiBAcmV0dXJuIHs/fVxuICovXG5nb29nLnJlcXVpcmVUeXBlID0gZnVuY3Rpb24obmFtZXNwYWNlKSB7fTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVc2VyYWdlbnQgZGV0ZWN0aW9uLlxuICogVGhlc2UgbWV0aG9kcyBhcmUgbm90IHNwZWNpZmljIHRvIEJsb2NrbHksIGFuZCBjb3VsZCBiZSBmYWN0b3JlZCBvdXQgaW50b1xuICogYSBKYXZhU2NyaXB0IGZyYW1ld29yayBzdWNoIGFzIENsb3N1cmUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudFxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudCcpO1xuXG5cbi8qKiBUaGUgcmF3IHVzZXJhZ2VudCBzdHJpbmcuICovXG5sZXQgcmF3VXNlckFnZW50OiBzdHJpbmc7XG5cbmxldCBpc0phdmFGeDogYm9vbGVhbjtcblxubGV0IGlzV2ViS2l0OiBib29sZWFuO1xuXG5sZXQgaXNHZWNrbzogYm9vbGVhbjtcblxubGV0IGlzQW5kcm9pZDogYm9vbGVhbjtcblxubGV0IGlzSVBhZDogYm9vbGVhbjtcblxubGV0IGlzSVBob25lOiBib29sZWFuO1xuXG5sZXQgaXNNYWM6IGJvb2xlYW47XG5cbmxldCBpc1RhYmxldDogYm9vbGVhbjtcblxubGV0IGlzTW9iaWxlOiBib29sZWFuO1xuXG4oZnVuY3Rpb24ocmF3KSB7XG5yYXdVc2VyQWdlbnQgPSByYXc7XG5jb25zdCByYXdVcHBlciA9IHJhd1VzZXJBZ2VudC50b1VwcGVyQ2FzZSgpO1xuLyoqXG4gKiBDYXNlLWluc2Vuc2l0aXZlIHRlc3Qgb2Ygd2hldGhlciBuYW1lIGlzIGluIHRoZSB1c2VyYWdlbnQgc3RyaW5nLlxuICpcbiAqIEBwYXJhbSBuYW1lIE5hbWUgdG8gdGVzdC5cbiAqIEByZXR1cm5zIFRydWUgaWYgbmFtZSBpcyBwcmVzZW50LlxuICovXG5mdW5jdGlvbiBoYXMobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiByYXdVcHBlci5pbmRleE9mKG5hbWUudG9VcHBlckNhc2UoKSkgIT09IC0xO1xufVxuXG4vLyBCcm93c2Vycy4gIExvZ2ljIGZyb206XG4vLyBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Nsb3N1cmUtbGlicmFyeS9ibG9iL21hc3Rlci9jbG9zdXJlL2dvb2cvbGFicy91c2VyYWdlbnQvYnJvd3Nlci5qc1xuLy8gVXNlcmFnZW50IGZvciBKYXZhRlg6XG4vLyBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuNDRcbi8vICAgICAoS0hUTUwsIGxpa2UgR2Vja28pIEphdmFGWC84LjAgU2FmYXJpLzUzNy40NFxuaXNKYXZhRnggPSBoYXMoJ0phdmFGWCcpO1xuXG4vLyBFbmdpbmVzLiAgTG9naWMgZnJvbTpcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Jsb2IvbWFzdGVyL2Nsb3N1cmUvZ29vZy9sYWJzL3VzZXJhZ2VudC9lbmdpbmUuanNcbmlzV2ViS2l0ID0gaGFzKCdXZWJLaXQnKTtcbmlzR2Vja28gPSBoYXMoJ0dlY2tvJykgJiYgIWlzV2ViS2l0O1xuXG4vLyBQbGF0Zm9ybXMuICBMb2dpYyBmcm9tOlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9jbG9zdXJlLWxpYnJhcnkvYmxvYi9tYXN0ZXIvY2xvc3VyZS9nb29nL2xhYnMvdXNlcmFnZW50L3BsYXRmb3JtLmpzXG4vLyBhbmRcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Jsb2IvbWFzdGVyL2Nsb3N1cmUvZ29vZy9sYWJzL3VzZXJhZ2VudC9leHRyYS5qc1xuaXNBbmRyb2lkID0gaGFzKCdBbmRyb2lkJyk7XG5jb25zdCBtYXhUb3VjaFBvaW50cyA9XG4gICAgZ2xvYmFsVGhpc1snbmF2aWdhdG9yJ10gJiYgZ2xvYmFsVGhpc1snbmF2aWdhdG9yJ11bJ21heFRvdWNoUG9pbnRzJ107XG5pc0lQYWQgPSBoYXMoJ2lQYWQnKSB8fCBoYXMoJ01hY2ludG9zaCcpICYmIG1heFRvdWNoUG9pbnRzID4gMDtcbmlzSVBob25lID0gaGFzKCdpUGhvbmUnKSAmJiAhaXNJUGFkO1xuaXNNYWMgPSBoYXMoJ01hY2ludG9zaCcpO1xuXG4vLyBEZXZpY2VzLiAgTG9naWMgZnJvbTpcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Jsb2IvbWFzdGVyL2Nsb3N1cmUvZ29vZy9sYWJzL3VzZXJhZ2VudC9kZXZpY2UuanNcbmlzVGFibGV0ID0gaXNJUGFkIHx8IGlzQW5kcm9pZCAmJiAhaGFzKCdNb2JpbGUnKSB8fCBoYXMoJ1NpbGsnKTtcbmlzTW9iaWxlID0gIWlzVGFibGV0ICYmIChpc0lQaG9uZSB8fCBpc0FuZHJvaWQpO1xufSkoZ2xvYmFsVGhpc1snbmF2aWdhdG9yJ10gJiYgZ2xvYmFsVGhpc1snbmF2aWdhdG9yJ11bJ3VzZXJBZ2VudCddIHx8ICcnKTtcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5yYXcgKi9cbmV4cG9ydCBjb25zdCByYXc6IHN0cmluZyA9IHJhd1VzZXJBZ2VudDtcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5KYXZhRnggKi9cbmV4cG9ydCBjb25zdCBKYXZhRng6IGJvb2xlYW4gPSBpc0phdmFGeDtcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5HRUNLTyAqL1xuZXhwb3J0IGNvbnN0IEdFQ0tPOiBib29sZWFuID0gaXNHZWNrbztcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5BTkRST0lEICovXG5leHBvcnQgY29uc3QgQU5EUk9JRDogYm9vbGVhbiA9IGlzQW5kcm9pZDtcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5JUEFEICovXG5leHBvcnQgY29uc3QgSVBBRDogYm9vbGVhbiA9IGlzSVBhZDtcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5JUEhPTkUgKi9cbmV4cG9ydCBjb25zdCBJUEhPTkU6IGJvb2xlYW4gPSBpc0lQaG9uZTtcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5NQUMgKi9cbmV4cG9ydCBjb25zdCBNQUM6IGJvb2xlYW4gPSBpc01hYztcblxuLyoqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLnVzZXJBZ2VudC5NT0JJTEUgKi9cbmV4cG9ydCBjb25zdCBNT0JJTEU6IGJvb2xlYW4gPSBpc01vYmlsZTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEzIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBIG1hcHBpbmcgb2YgYmxvY2sgdHlwZSBuYW1lcyB0byBibG9jayBwcm90b3R5cGUgb2JqZWN0cy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuYmxvY2tzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tzJyk7XG5cblxuLyoqXG4gKiBBIGJsb2NrIGRlZmluaXRpb24uICBGb3Igbm93IHRoaXMgdmVyeSBsb29zZSwgYnV0IGl0IGNhbiBwb3RlbnRpYWxseVxuICogYmUgcmVmaW5lZCBlLmcuIGJ5IHJlcGxhY2luZyB0aGlzIHR5cGVkZWYgd2l0aCBhIGNsYXNzIGRlZmluaXRpb24uXG4gKi9cbmV4cG9ydCB0eXBlIEJsb2NrRGVmaW5pdGlvbiA9IEFueUR1cmluZ01pZ3JhdGlvbjtcblxuLyoqXG4gKiBBIG1hcHBpbmcgb2YgYmxvY2sgdHlwZSBuYW1lcyB0byBibG9jayBwcm90b3R5cGUgb2JqZWN0cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja3MuQmxvY2tzXG4gKi9cbmV4cG9ydCBjb25zdCBCbG9ja3M6IHtba2V5OiBzdHJpbmddOiBCbG9ja0RlZmluaXRpb259ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IG1ldGhvZHMgZm9yIHJlY3RhbmdsZSBtYW5pcHVsYXRpb24uXG4gKiBUaGVzZSBtZXRob2RzIGFyZSBub3Qgc3BlY2lmaWMgdG8gQmxvY2tseSwgYW5kIGNvdWxkIGJlIGZhY3RvcmVkIG91dCBpbnRvXG4gKiBhIEphdmFTY3JpcHQgZnJhbWV3b3JrIHN1Y2ggYXMgQ2xvc3VyZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5SZWN0Jyk7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIHJlY3Rhbmd1bGFyIHJlZ2lvbnMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuUmVjdFxuICovXG5leHBvcnQgY2xhc3MgUmVjdCB7XG4gIC8qKlxuICAgKiBAcGFyYW0gdG9wIFRvcC5cbiAgICogQHBhcmFtIGJvdHRvbSBCb3R0b20uXG4gICAqIEBwYXJhbSBsZWZ0IExlZnQuXG4gICAqIEBwYXJhbSByaWdodCBSaWdodC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHVibGljIHRvcDogbnVtYmVyLCBwdWJsaWMgYm90dG9tOiBudW1iZXIsIHB1YmxpYyBsZWZ0OiBudW1iZXIsXG4gICAgICBwdWJsaWMgcmlnaHQ6IG51bWJlcikge31cblxuICAvKipcbiAgICogVGVzdHMgd2hldGhlciB0aGlzIHJlY3RhbmdsZSBjb250YWlucyBhIHgveSBjb29yZGluYXRlLlxuICAgKlxuICAgKiBAcGFyYW0geCBUaGUgeCBjb29yZGluYXRlIHRvIHRlc3QgZm9yIGNvbnRhaW5tZW50LlxuICAgKiBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIHRvIHRlc3QgZm9yIGNvbnRhaW5tZW50LlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoaXMgcmVjdGFuZ2xlIGNvbnRhaW5zIGdpdmVuIGNvb3JkaW5hdGUuXG4gICAqL1xuICBjb250YWlucyh4OiBudW1iZXIsIHk6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB4ID49IHRoaXMubGVmdCAmJiB4IDw9IHRoaXMucmlnaHQgJiYgeSA+PSB0aGlzLnRvcCAmJlxuICAgICAgICB5IDw9IHRoaXMuYm90dG9tO1xuICB9XG5cbiAgLyoqXG4gICAqIFRlc3RzIHdoZXRoZXIgdGhpcyByZWN0YW5nbGUgaW50ZXJzZWN0cyB0aGUgcHJvdmlkZWQgcmVjdGFuZ2xlLlxuICAgKiBBc3N1bWVzIHRoYXQgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGluY3JlYXNlcyBnb2luZyBkb3duIGFuZCBsZWZ0LlxuICAgKlxuICAgKiBAcGFyYW0gb3RoZXIgVGhlIG90aGVyIHJlY3RhbmdsZSB0byBjaGVjayBmb3IgaW50ZXJzZWN0aW9uIHdpdGguXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyByZWN0YW5nbGUgaW50ZXJzZWN0cyB0aGUgcHJvdmlkZWQgcmVjdGFuZ2xlLlxuICAgKi9cbiAgaW50ZXJzZWN0cyhvdGhlcjogUmVjdCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhKFxuICAgICAgICB0aGlzLmxlZnQgPiBvdGhlci5yaWdodCB8fCB0aGlzLnJpZ2h0IDwgb3RoZXIubGVmdCB8fFxuICAgICAgICB0aGlzLnRvcCA+IG90aGVyLmJvdHRvbSB8fCB0aGlzLmJvdHRvbSA8IG90aGVyLnRvcCk7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IG1ldGhvZHMgZm9yIGNvb3JkaW5hdGUgbWFuaXB1bGF0aW9uLlxuICogVGhlc2UgbWV0aG9kcyBhcmUgbm90IHNwZWNpZmljIHRvIEJsb2NrbHksIGFuZCBjb3VsZCBiZSBmYWN0b3JlZCBvdXQgaW50b1xuICogYSBKYXZhU2NyaXB0IGZyYW1ld29yayBzdWNoIGFzIENsb3N1cmUuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMuQ29vcmRpbmF0ZScpO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIHJlcHJlc2VudGluZyBjb29yZGluYXRlcyBhbmQgcG9zaXRpb25zLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnV0aWxzLkNvb3JkaW5hdGVcbiAqL1xuZXhwb3J0IGNsYXNzIENvb3JkaW5hdGUge1xuICAvKipcbiAgICogQHBhcmFtIHggTGVmdC5cbiAgICogQHBhcmFtIHkgVG9wLlxuICAgKi9cbiAgY29uc3RydWN0b3IocHVibGljIHg6IG51bWJlciwgcHVibGljIHk6IG51bWJlcikge31cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBjb3B5IG9mIHRoaXMgY29vcmRpbmF0ZS5cbiAgICpcbiAgICogQHJldHVybnMgQSBjb3B5IG9mIHRoaXMgY29vcmRpbmF0ZS5cbiAgICovXG4gIGNsb25lKCk6IENvb3JkaW5hdGUge1xuICAgIHJldHVybiBuZXcgQ29vcmRpbmF0ZSh0aGlzLngsIHRoaXMueSk7XG4gIH1cblxuICAvKipcbiAgICogU2NhbGVzIHRoaXMgY29vcmRpbmF0ZSBieSB0aGUgZ2l2ZW4gc2NhbGUgZmFjdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gcyBUaGUgc2NhbGUgZmFjdG9yIHRvIHVzZSBmb3IgYm90aCB4IGFuZCB5IGRpbWVuc2lvbnMuXG4gICAqIEByZXR1cm5zIFRoaXMgY29vcmRpbmF0ZSBhZnRlciBzY2FsaW5nLlxuICAgKi9cbiAgc2NhbGUoczogbnVtYmVyKTogQ29vcmRpbmF0ZSB7XG4gICAgdGhpcy54ICo9IHM7XG4gICAgdGhpcy55ICo9IHM7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNsYXRlcyB0aGlzIGNvb3JkaW5hdGUgYnkgdGhlIGdpdmVuIG9mZnNldHMuXG4gICAqIHJlc3BlY3RpdmVseS5cbiAgICpcbiAgICogQHBhcmFtIHR4IFRoZSB2YWx1ZSB0byB0cmFuc2xhdGUgeCBieS5cbiAgICogQHBhcmFtIHR5IFRoZSB2YWx1ZSB0byB0cmFuc2xhdGUgeSBieS5cbiAgICogQHJldHVybnMgVGhpcyBjb29yZGluYXRlIGFmdGVyIHRyYW5zbGF0aW5nLlxuICAgKi9cbiAgdHJhbnNsYXRlKHR4OiBudW1iZXIsIHR5OiBudW1iZXIpOiBDb29yZGluYXRlIHtcbiAgICB0aGlzLnggKz0gdHg7XG4gICAgdGhpcy55ICs9IHR5O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBhcmVzIGNvb3JkaW5hdGVzIGZvciBlcXVhbGl0eS5cbiAgICpcbiAgICogQHBhcmFtIGEgQSBDb29yZGluYXRlLlxuICAgKiBAcGFyYW0gYiBBIENvb3JkaW5hdGUuXG4gICAqIEByZXR1cm5zIFRydWUgaWZmIHRoZSBjb29yZGluYXRlcyBhcmUgZXF1YWwsIG9yIGlmIGJvdGggYXJlIG51bGwuXG4gICAqL1xuICBzdGF0aWMgZXF1YWxzKGE/OiBDb29yZGluYXRlfG51bGwsIGI/OiBDb29yZGluYXRlfG51bGwpOiBib29sZWFuIHtcbiAgICBpZiAoYSA9PT0gYikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICghYSB8fCAhYikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gYS54ID09PSBiLnggJiYgYS55ID09PSBiLnk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZGlzdGFuY2UgYmV0d2VlbiB0d28gY29vcmRpbmF0ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBhIEEgQ29vcmRpbmF0ZS5cbiAgICogQHBhcmFtIGIgQSBDb29yZGluYXRlLlxuICAgKiBAcmV0dXJucyBUaGUgZGlzdGFuY2UgYmV0d2VlbiBgYWAgYW5kIGBiYC5cbiAgICovXG4gIHN0YXRpYyBkaXN0YW5jZShhOiBDb29yZGluYXRlLCBiOiBDb29yZGluYXRlKTogbnVtYmVyIHtcbiAgICBjb25zdCBkeCA9IGEueCAtIGIueDtcbiAgICBjb25zdCBkeSA9IGEueSAtIGIueTtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBtYWduaXR1ZGUgb2YgYSBjb29yZGluYXRlLlxuICAgKlxuICAgKiBAcGFyYW0gYSBBIENvb3JkaW5hdGUuXG4gICAqIEByZXR1cm5zIFRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBvcmlnaW4gYW5kIGBhYC5cbiAgICovXG4gIHN0YXRpYyBtYWduaXR1ZGUoYTogQ29vcmRpbmF0ZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIE1hdGguc3FydChhLnggKiBhLnggKyBhLnkgKiBhLnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0d28gY29vcmRpbmF0ZXMgYXMgYSBuZXdcbiAgICogQ29vcmRpbmF0ZS5cbiAgICpcbiAgICogQHBhcmFtIGEgQW4geC95IGNvb3JkaW5hdGUuXG4gICAqIEBwYXJhbSBiIEFuIHgveSBjb29yZGluYXRlLlxuICAgKiBAcmV0dXJucyBBIENvb3JkaW5hdGUgcmVwcmVzZW50aW5nIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gYGFgIGFuZCBgYmAuXG4gICAqL1xuICBzdGF0aWMgZGlmZmVyZW5jZShhOiBDb29yZGluYXRlfFNWR1BvaW50LCBiOiBDb29yZGluYXRlfFNWR1BvaW50KTpcbiAgICAgIENvb3JkaW5hdGUge1xuICAgIHJldHVybiBuZXcgQ29vcmRpbmF0ZShhLnggLSBiLngsIGEueSAtIGIueSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgc3VtIG9mIHR3byBjb29yZGluYXRlcyBhcyBhIG5ldyBDb29yZGluYXRlLlxuICAgKlxuICAgKiBAcGFyYW0gYSBBbiB4L3kgY29vcmRpbmF0ZS5cbiAgICogQHBhcmFtIGIgQW4geC95IGNvb3JkaW5hdGUuXG4gICAqIEByZXR1cm5zIEEgQ29vcmRpbmF0ZSByZXByZXNlbnRpbmcgdGhlIHN1bSBvZiB0aGUgdHdvIGNvb3JkaW5hdGVzLlxuICAgKi9cbiAgc3RhdGljIHN1bShhOiBDb29yZGluYXRlfFNWR1BvaW50LCBiOiBDb29yZGluYXRlfFNWR1BvaW50KTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIG5ldyBDb29yZGluYXRlKGEueCArIGIueCwgYS55ICsgYi55KTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgbWV0aG9kcyBmb3Igc2l6ZSBjYWxjdWxhdGlvbi5cbiAqIFRoZXNlIG1ldGhvZHMgYXJlIG5vdCBzcGVjaWZpYyB0byBCbG9ja2x5LCBhbmQgY291bGQgYmUgZmFjdG9yZWQgb3V0IGludG9cbiAqIGEgSmF2YVNjcmlwdCBmcmFtZXdvcmsgc3VjaCBhcyBDbG9zdXJlLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnV0aWxzLlNpemUnKTtcblxuXG4vKipcbiAqIENsYXNzIGZvciByZXByZXNlbnRpbmcgc2l6ZXMgY29uc2lzdGluZyBvZiBhIHdpZHRoIGFuZCBoZWlnaHQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuU2l6ZVxuICovXG5leHBvcnQgY2xhc3MgU2l6ZSB7XG4gIC8qKlxuICAgKiBAcGFyYW0gd2lkdGggV2lkdGguXG4gICAqIEBwYXJhbSBoZWlnaHQgSGVpZ2h0LlxuICAgKi9cbiAgY29uc3RydWN0b3IocHVibGljIHdpZHRoOiBudW1iZXIsIHB1YmxpYyBoZWlnaHQ6IG51bWJlcikge31cblxuICAvKipcbiAgICogQ29tcGFyZXMgc2l6ZXMgZm9yIGVxdWFsaXR5LlxuICAgKlxuICAgKiBAcGFyYW0gYSBBIFNpemUuXG4gICAqIEBwYXJhbSBiIEEgU2l6ZS5cbiAgICogQHJldHVybnMgVHJ1ZSBpZmYgdGhlIHNpemVzIGhhdmUgZXF1YWwgd2lkdGhzIGFuZCBlcXVhbCBoZWlnaHRzLCBvciBpZiBib3RoXG4gICAqICAgICBhcmUgbnVsbC5cbiAgICovXG4gIHN0YXRpYyBlcXVhbHMoYTogU2l6ZXxudWxsLCBiOiBTaXplfG51bGwpOiBib29sZWFuIHtcbiAgICBpZiAoYSA9PT0gYikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICghYSB8fCAhYikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gYS53aWR0aCA9PT0gYi53aWR0aCAmJiBhLmhlaWdodCA9PT0gYi5oZWlnaHQ7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbiBlbnVtIGZvciB0aGUgcG9zc2libGUgdHlwZXMgb2YgaW5wdXRzLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5pbnB1dFR5cGVzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuaW5wdXRUeXBlcycpO1xuXG5pbXBvcnQge0Nvbm5lY3Rpb25UeXBlfSBmcm9tICcuL2Nvbm5lY3Rpb25fdHlwZS5qcyc7XG5cblxuLyoqXG4gKiBFbnVtIGZvciB0aGUgdHlwZSBvZiBhIGNvbm5lY3Rpb24gb3IgaW5wdXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuaW5wdXRUeXBlc1xuICovXG5leHBvcnQgZW51bSBpbnB1dFR5cGVzIHtcbiAgLy8gQSByaWdodC1mYWNpbmcgdmFsdWUgaW5wdXQuICBFLmcuICdzZXQgaXRlbSB0bycgb3IgJ3JldHVybicuXG4gIFZBTFVFID0gQ29ubmVjdGlvblR5cGUuSU5QVVRfVkFMVUUsXG4gIC8vIEEgZG93bi1mYWNpbmcgYmxvY2sgc3RhY2suICBFLmcuICdpZi1kbycgb3IgJ2Vsc2UnLlxuICBTVEFURU1FTlQgPSBDb25uZWN0aW9uVHlwZS5ORVhUX1NUQVRFTUVOVCxcbiAgLy8gQSBkdW1teSBpbnB1dC4gIFVzZWQgdG8gYWRkIGZpZWxkKHMpIHdpdGggbm8gaW5wdXQuXG4gIERVTU1ZID0gNVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTMgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEVtcHR5IG5hbWUgc3BhY2UgZm9yIHRoZSBNZXNzYWdlIHNpbmdsZXRvbi5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuTXNnXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuTXNnJyk7XG5cblxuLyoqIEEgZGljdGlvbmFyeSBvZiBsb2NhbGlzZWQgbWVzc2FnZXMuICovXG5leHBvcnQgY29uc3QgTXNnOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbi8qKlxuICogU2V0cyB0aGUgbG9jYWxlIChpLmUuIHRoZSBsb2NhbGl6ZWQgbWVzc2FnZXMvYmxvY2stdGV4dC9ldGMpIHRvIHRoZSBnaXZlblxuICogbG9jYWxlLlxuICpcbiAqIFRoaXMgaXMgbm90IHVzZWZ1bC9uZWNlc3Nhcnkgd2hlbiBsb2FkaW5nIGZyb20gYSBzY3JpcHQgdGFnLCBiZWNhdXNlIHRoZVxuICogbWVzc2FnZXMgYXJlIGF1dG9tYXRpY2FsbHkgY2x1Z2VkIGludG8gdGhlIEJsb2NrbHkuTXNnIG9iamVjdC4gQnV0IHdlIHByb3ZpZGVcbiAqIGl0IGluIGJvdGggdGhlIHNjcmlwdC10YWcgYW5kIG5vbi1zY3JpcHQtdGFnIGNvbnRleHRzIHNvIHRoYXQgdGhlIHRzY29tcGlsZXJcbiAqIGNhbiBwcm9wZXJseSBjcmVhdGUgb3VyIHR5cGUgZGVmaW5pdGlvbiBmaWxlcy5cbiAqXG4gKiBAcGFyYW0gbG9jYWxlIEFuIG9iamVjdCBkZWZpbmluZyB0aGUgbWVzc2FnZXMgZm9yIGEgZ2l2ZW4gbGFuZ3VhZ2UuXG4gKi9cbmV4cG9ydCBjb25zdCBzZXRMb2NhbGUgPSBmdW5jdGlvbihsb2NhbGU6IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9KSB7XG4gIE9iamVjdC5rZXlzKGxvY2FsZSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG4gICAgTXNnW2tdID0gbG9jYWxlW2tdO1xuICB9KTtcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQWJzdHJhY3QgY2xhc3MgZm9yIGV2ZW50cyBmaXJlZCBhcyBhIHJlc3VsdCBvZiBhY3Rpb25zIGluXG4gKiBCbG9ja2x5J3MgZWRpdG9yLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5BYnN0cmFjdCcpO1xuXG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi4vY29tbW9uLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5cblxuLyoqXG4gKiBBYnN0cmFjdCBjbGFzcyBmb3IgYW4gZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLkFic3RyYWN0XG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdCB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCB0aGUgZXZlbnQgd2FzIGNvbnN0cnVjdGVkIHdpdGhvdXQgbmVjZXNzYXJ5IHBhcmFtZXRlcnNcbiAgICogKHRvIGJlIHBvcHVsYXRlZCBieSBmcm9tSnNvbikuXG4gICAqL1xuICBhYnN0cmFjdCBpc0JsYW5rOiBib29sZWFuO1xuXG4gIC8qKiBUaGUgd29ya3NwYWNlIGlkZW50aWZpZXIgZm9yIHRoaXMgZXZlbnQuICovXG4gIHdvcmtzcGFjZUlkPzogc3RyaW5nID0gdW5kZWZpbmVkO1xuICBncm91cDogc3RyaW5nO1xuICByZWNvcmRVbmRvOiBib29sZWFuO1xuXG4gIC8qKiBXaGV0aGVyIG9yIG5vdCB0aGUgZXZlbnQgaXMgYSBVSSBldmVudC4gKi9cbiAgaXNVaUV2ZW50ID0gZmFsc2U7XG5cbiAgLyoqIFR5cGUgb2YgdGhpcyBldmVudC4gKi9cbiAgdHlwZSA9ICcnO1xuXG4gIC8qKiBAYWxpYXMgQmxvY2tseS5FdmVudHMuQWJzdHJhY3QgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLyoqXG4gICAgICogVGhlIGV2ZW50IGdyb3VwIElEIGZvciB0aGUgZ3JvdXAgdGhpcyBldmVudCBiZWxvbmdzIHRvLiBHcm91cHMgZGVmaW5lXG4gICAgICogZXZlbnRzIHRoYXQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYW4gc2luZ2xlIGFjdGlvbiBmcm9tIHRoZSB1c2VyJ3NcbiAgICAgKiBwZXJzcGVjdGl2ZSwgYW5kIHNob3VsZCBiZSB1bmRvbmUgdG9nZXRoZXIuXG4gICAgICovXG4gICAgdGhpcy5ncm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcblxuICAgIC8qKiBTZXRzIHdoZXRoZXIgdGhlIGV2ZW50IHNob3VsZCBiZSBhZGRlZCB0byB0aGUgdW5kbyBzdGFjay4gKi9cbiAgICB0aGlzLnJlY29yZFVuZG8gPSBldmVudFV0aWxzLmdldFJlY29yZFVuZG8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICB0b0pzb24oKTogQWJzdHJhY3RFdmVudEpzb24ge1xuICAgIHJldHVybiB7XG4gICAgICAndHlwZSc6IHRoaXMudHlwZSxcbiAgICAgICdncm91cCc6IHRoaXMuZ3JvdXAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBmcm9tSnNvbihqc29uOiBBYnN0cmFjdEV2ZW50SnNvbikge1xuICAgIHRoaXMuaXNCbGFuayA9IGZhbHNlO1xuICAgIHRoaXMuZ3JvdXAgPSBqc29uWydncm91cCddIHx8ICcnO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBBYnN0cmFjdCAobGlrZSBhbGwgZXZlbnRzKSwgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlXG4gICAqICAgICBmYWN0IHRoYXQgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmVcbiAgICogICAgIHN1cGVydHlwZXMgb2YgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IEFic3RyYWN0RXZlbnRKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ6IGFueSk6XG4gICAgICBBYnN0cmFjdCB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLkFic3RyYWN0LnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcsXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIGV2ZW50LmlzQmxhbmsgPSBmYWxzZTtcbiAgICBldmVudC5ncm91cCA9IGpzb25bJ2dyb3VwJ10gfHwgJyc7XG4gICAgZXZlbnQud29ya3NwYWNlSWQgPSB3b3Jrc3BhY2UuaWQ7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIERvZXMgdGhpcyBldmVudCByZWNvcmQgYW55IGNoYW5nZSBvZiBzdGF0ZT9cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBudWxsLCBmYWxzZSBpZiBzb21ldGhpbmcgY2hhbmdlZC5cbiAgICovXG4gIGlzTnVsbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGFuIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gX2ZvcndhcmQgVHJ1ZSBpZiBydW4gZm9yd2FyZCwgZmFsc2UgaWYgcnVuIGJhY2t3YXJkICh1bmRvKS5cbiAgICovXG4gIHJ1bihfZm9yd2FyZDogYm9vbGVhbikge1xuICAgIC8vIERlZmluZWQgYnkgc3ViY2xhc3Nlcy4gQ2Fubm90IGJlIGFic3RyYWN0IGIvYyBVSSBldmVudHMgZG8gL25vdC8gZGVmaW5lXG4gICAgLy8gdGhpcy5cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgd29ya3NwYWNlIHRoZSBldmVudCBiZWxvbmdzIHRvLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgd29ya3NwYWNlIHRoZSBldmVudCBiZWxvbmdzIHRvLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gaWYgd29ya3NwYWNlIGlzIG51bGwuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0RXZlbnRXb3Jrc3BhY2VfKCk6IFdvcmtzcGFjZSB7XG4gICAgbGV0IHdvcmtzcGFjZTtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2VJZCkge1xuICAgICAgd29ya3NwYWNlID0gY29tbW9uLmdldFdvcmtzcGFjZUJ5SWQodGhpcy53b3Jrc3BhY2VJZCk7XG4gICAgfVxuICAgIGlmICghd29ya3NwYWNlKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnV29ya3NwYWNlIGlzIG51bGwuIEV2ZW50IG11c3QgaGF2ZSBiZWVuIGdlbmVyYXRlZCBmcm9tIHJlYWwnICtcbiAgICAgICAgICAnIEJsb2NrbHkgZXZlbnRzLicpO1xuICAgIH1cbiAgICByZXR1cm4gd29ya3NwYWNlO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWJzdHJhY3RFdmVudEpzb24ge1xuICB0eXBlOiBzdHJpbmc7XG4gIGdyb3VwOiBzdHJpbmc7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQWJzdHJhY3QgY2xhc3MgZm9yIGEgdmFyaWFibGUgZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLlZhckJhc2UnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0IHR5cGUge1ZhcmlhYmxlTW9kZWx9IGZyb20gJy4uL3ZhcmlhYmxlX21vZGVsLmpzJztcblxuaW1wb3J0IHtBYnN0cmFjdCBhcyBBYnN0cmFjdEV2ZW50LCBBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIEFic3RyYWN0IGNsYXNzIGZvciBhIHZhcmlhYmxlIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5WYXJCYXNlXG4gKi9cbmV4cG9ydCBjbGFzcyBWYXJCYXNlIGV4dGVuZHMgQWJzdHJhY3RFdmVudCB7XG4gIG92ZXJyaWRlIGlzQmxhbmsgPSB0cnVlO1xuICB2YXJJZD86IHN0cmluZztcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF92YXJpYWJsZSBUaGUgdmFyaWFibGUgdGhpcyBldmVudCBjb3JyZXNwb25kcyB0by4gIFVuZGVmaW5lZCBmb3JcbiAgICogICAgIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfdmFyaWFibGU/OiBWYXJpYWJsZU1vZGVsKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmlzQmxhbmsgPSB0eXBlb2Ygb3B0X3ZhcmlhYmxlID09PSAndW5kZWZpbmVkJztcbiAgICBpZiAoIW9wdF92YXJpYWJsZSkgcmV0dXJuO1xuXG4gICAgLyoqIFRoZSB2YXJpYWJsZSBpZCBmb3IgdGhlIHZhcmlhYmxlIHRoaXMgZXZlbnQgcGVydGFpbnMgdG8uICovXG4gICAgdGhpcy52YXJJZCA9IG9wdF92YXJpYWJsZS5nZXRJZCgpO1xuXG4gICAgLyoqIFRoZSB3b3Jrc3BhY2UgaWRlbnRpZmllciBmb3IgdGhpcyBldmVudC4gKi9cbiAgICB0aGlzLndvcmtzcGFjZUlkID0gb3B0X3ZhcmlhYmxlLndvcmtzcGFjZS5pZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSB0b0pzb24oKTogVmFyQmFzZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBWYXJCYXNlSnNvbjtcbiAgICBpZiAoIXRoaXMudmFySWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHZhciBJRCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgdmFyaWFibGUgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBqc29uWyd2YXJJZCddID0gdGhpcy52YXJJZDtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBWYXJCYXNlSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5WYXJCYXNlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcsXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMudmFySWQgPSBqc29uWyd2YXJJZCddO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBWYXJCYXNlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0IHBhcmFtZXRlcnNcbiAgICogICAgIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mIHBhcmFtZXRlcnMgdG9cbiAgICogICAgIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogVmFyQmFzZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlLCBldmVudD86IGFueSk6XG4gICAgICBWYXJCYXNlIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IFZhckJhc2UoKSkgYXMgVmFyQmFzZTtcbiAgICBuZXdFdmVudC52YXJJZCA9IGpzb25bJ3ZhcklkJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFyQmFzZUpzb24gZXh0ZW5kcyBBYnN0cmFjdEV2ZW50SnNvbiB7XG4gIHZhcklkOiBzdHJpbmc7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgdmFyaWFibGUgY3JlYXRpb24gZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLlZhckNyZWF0ZScpO1xuXG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7VmFyaWFibGVNb2RlbH0gZnJvbSAnLi4vdmFyaWFibGVfbW9kZWwuanMnO1xuXG5pbXBvcnQge1ZhckJhc2UsIFZhckJhc2VKc29ufSBmcm9tICcuL2V2ZW50c192YXJfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIHZhcmlhYmxlIGNyZWF0aW9uIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5WYXJDcmVhdGVcbiAqL1xuZXhwb3J0IGNsYXNzIFZhckNyZWF0ZSBleHRlbmRzIFZhckJhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5WQVJfQ1JFQVRFO1xuICB2YXJUeXBlPzogc3RyaW5nO1xuICB2YXJOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X3ZhcmlhYmxlIFRoZSBjcmVhdGVkIHZhcmlhYmxlLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfdmFyaWFibGU/OiBWYXJpYWJsZU1vZGVsKSB7XG4gICAgc3VwZXIob3B0X3ZhcmlhYmxlKTtcblxuICAgIGlmICghb3B0X3ZhcmlhYmxlKSB7XG4gICAgICByZXR1cm47ICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgfVxuICAgIHRoaXMudmFyVHlwZSA9IG9wdF92YXJpYWJsZS50eXBlO1xuICAgIHRoaXMudmFyTmFtZSA9IG9wdF92YXJpYWJsZS5uYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBWYXJDcmVhdGVKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgVmFyQ3JlYXRlSnNvbjtcbiAgICBpZiAoIXRoaXMudmFyVHlwZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgdmFyIHR5cGUgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhcmlhYmxlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnZhck5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHZhciBuYW1lIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YXJpYWJsZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ3ZhclR5cGUnXSA9IHRoaXMudmFyVHlwZTtcbiAgICBqc29uWyd2YXJOYW1lJ10gPSB0aGlzLnZhck5hbWU7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogVmFyQ3JlYXRlSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5WYXJDcmVhdGUucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy52YXJUeXBlID0ganNvblsndmFyVHlwZSddO1xuICAgIHRoaXMudmFyTmFtZSA9IGpzb25bJ3Zhck5hbWUnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgVmFyQ3JlYXRlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0IHBhcmFtZXRlcnNcbiAgICogICAgIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mIHBhcmFtZXRlcnMgdG9cbiAgICogICAgIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogVmFyQ3JlYXRlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIFZhckNyZWF0ZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBWYXJDcmVhdGUoKSkgYXMgVmFyQ3JlYXRlO1xuICAgIG5ld0V2ZW50LnZhclR5cGUgPSBqc29uWyd2YXJUeXBlJ107XG4gICAgbmV3RXZlbnQudmFyTmFtZSA9IGpzb25bJ3Zhck5hbWUnXTtcbiAgICByZXR1cm4gbmV3RXZlbnQ7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgdmFyaWFibGUgY3JlYXRpb24gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBmb3J3YXJkIFRydWUgaWYgcnVuIGZvcndhcmQsIGZhbHNlIGlmIHJ1biBiYWNrd2FyZCAodW5kbykuXG4gICAqL1xuICBvdmVycmlkZSBydW4oZm9yd2FyZDogYm9vbGVhbikge1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCk7XG4gICAgaWYgKCF0aGlzLnZhcklkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSB2YXIgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhcmlhYmxlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnZhck5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHZhciBuYW1lIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YXJpYWJsZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICB3b3Jrc3BhY2UuY3JlYXRlVmFyaWFibGUodGhpcy52YXJOYW1lLCB0aGlzLnZhclR5cGUsIHRoaXMudmFySWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3b3Jrc3BhY2UuZGVsZXRlVmFyaWFibGVCeUlkKHRoaXMudmFySWQpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhckNyZWF0ZUpzb24gZXh0ZW5kcyBWYXJCYXNlSnNvbiB7XG4gIHZhclR5cGU6IHN0cmluZztcbiAgdmFyTmFtZTogc3RyaW5nO1xufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihyZWdpc3RyeS5UeXBlLkVWRU5ULCBldmVudFV0aWxzLlZBUl9DUkVBVEUsIFZhckNyZWF0ZSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ29tcG9uZW50cyBmb3IgdGhlIHZhcmlhYmxlIG1vZGVsLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlZhcmlhYmxlTW9kZWwnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfdmFyX2NyZWF0ZS5qcyc7XG5cbmltcG9ydCAqIGFzIGlkR2VuZXJhdG9yIGZyb20gJy4vdXRpbHMvaWRnZW5lcmF0b3IuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgdmFyaWFibGUgbW9kZWwuXG4gKiBIb2xkcyBpbmZvcm1hdGlvbiBmb3IgdGhlIHZhcmlhYmxlIGluY2x1ZGluZyBuYW1lLCBJRCwgYW5kIHR5cGUuXG4gKlxuICogQHNlZSB7QmxvY2tseS5GaWVsZFZhcmlhYmxlfVxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVNb2RlbFxuICovXG5leHBvcnQgY2xhc3MgVmFyaWFibGVNb2RlbCB7XG4gIHR5cGU6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBpZF86IHN0cmluZztcblxuICAvKipcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgdmFyaWFibGUncyB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZS4gIFRoaXMgaXMgdGhlIHVzZXItdmlzaWJsZSBuYW1lIChlLmcuXG4gICAqICAgICAnbXkgdmFyJyBvciAn56eB44Gu5aSJ5pWwJyksIG5vdCB0aGUgZ2VuZXJhdGVkIG5hbWUuXG4gICAqIEBwYXJhbSBvcHRfdHlwZSBUaGUgdHlwZSBvZiB0aGUgdmFyaWFibGUgbGlrZSAnaW50JyBvciAnc3RyaW5nJy5cbiAgICogICAgIERvZXMgbm90IG5lZWQgdG8gYmUgdW5pcXVlLiBGaWVsZF92YXJpYWJsZSBjYW4gZmlsdGVyIHZhcmlhYmxlcyBiYXNlZFxuICAgKiBvbiB0aGVpciB0eXBlLiBUaGlzIHdpbGwgZGVmYXVsdCB0byAnJyB3aGljaCBpcyBhIHNwZWNpZmljIHR5cGUuXG4gICAqIEBwYXJhbSBvcHRfaWQgVGhlIHVuaXF1ZSBJRCBvZiB0aGUgdmFyaWFibGUuIFRoaXMgd2lsbCBkZWZhdWx0IHRvIGEgVVVJRC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHVibGljIHdvcmtzcGFjZTogV29ya3NwYWNlLCBwdWJsaWMgbmFtZTogc3RyaW5nLCBvcHRfdHlwZT86IHN0cmluZyxcbiAgICAgIG9wdF9pZD86IHN0cmluZykge1xuICAgIC8qKlxuICAgICAqIFRoZSB0eXBlIG9mIHRoZSB2YXJpYWJsZSwgc3VjaCBhcyAnaW50JyBvciAnc291bmRfZWZmZWN0Jy4gVGhpcyBtYXkgYmVcbiAgICAgKiB1c2VkIHRvIGJ1aWxkIGEgbGlzdCBvZiB2YXJpYWJsZXMgb2YgYSBzcGVjaWZpYyB0eXBlLiBCeSBkZWZhdWx0IHRoaXMgaXNcbiAgICAgKiB0aGUgZW1wdHkgc3RyaW5nICcnLCB3aGljaCBpcyBhIHNwZWNpZmljIHR5cGUuXG4gICAgICpcbiAgICAgKiBAc2VlIHtCbG9ja2x5LkZpZWxkVmFyaWFibGV9XG4gICAgICovXG4gICAgdGhpcy50eXBlID0gb3B0X3R5cGUgfHwgJyc7XG5cbiAgICAvKipcbiAgICAgKiBBIHVuaXF1ZSBJRCBmb3IgdGhlIHZhcmlhYmxlLiBUaGlzIHNob3VsZCBiZSBkZWZpbmVkIGF0IGNyZWF0aW9uIGFuZFxuICAgICAqIG5vdCBjaGFuZ2UsIGV2ZW4gaWYgdGhlIG5hbWUgY2hhbmdlcy4gSW4gbW9zdCBjYXNlcyB0aGlzIHNob3VsZCBiZSBhXG4gICAgICogVVVJRC5cbiAgICAgKi9cbiAgICB0aGlzLmlkXyA9IG9wdF9pZCB8fCBpZEdlbmVyYXRvci5nZW5VaWQoKTtcbiAgfVxuXG4gIC8qKiBAcmV0dXJucyBUaGUgSUQgZm9yIHRoZSB2YXJpYWJsZS4gKi9cbiAgZ2V0SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pZF87XG4gIH1cblxuICAvKipcbiAgICogQSBjdXN0b20gY29tcGFyZSBmdW5jdGlvbiBmb3IgdGhlIFZhcmlhYmxlTW9kZWwgb2JqZWN0cy5cbiAgICpcbiAgICogQHBhcmFtIHZhcjEgRmlyc3QgdmFyaWFibGUgdG8gY29tcGFyZS5cbiAgICogQHBhcmFtIHZhcjIgU2Vjb25kIHZhcmlhYmxlIHRvIGNvbXBhcmUuXG4gICAqIEByZXR1cm5zIC0xIGlmIG5hbWUgb2YgdmFyMSBpcyBsZXNzIHRoYW4gbmFtZSBvZiB2YXIyLCAwIGlmIGVxdWFsLCBhbmQgMSBpZlxuICAgKiAgICAgZ3JlYXRlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgY29tcGFyZUJ5TmFtZSh2YXIxOiBWYXJpYWJsZU1vZGVsLCB2YXIyOiBWYXJpYWJsZU1vZGVsKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdmFyMS5uYW1lLmxvY2FsZUNvbXBhcmUodmFyMi5uYW1lLCB1bmRlZmluZWQsIHtzZW5zaXRpdml0eTogJ2Jhc2UnfSk7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGEgY29kZSBjb21tZW50IG9uIHRoZSB3b3Jrc3BhY2UuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuV29ya3NwYWNlQ29tbWVudCcpO1xuXG5pbXBvcnQgdHlwZSB7Q29tbWVudE1vdmV9IGZyb20gJy4vZXZlbnRzL2V2ZW50c19jb21tZW50X21vdmUuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBpZEdlbmVyYXRvciBmcm9tICcuL3V0aWxzL2lkZ2VuZXJhdG9yLmpzJztcbmltcG9ydCAqIGFzIHhtbCBmcm9tICcuL3V0aWxzL3htbC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB3b3Jrc3BhY2UgY29tbWVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Xb3Jrc3BhY2VDb21tZW50XG4gKi9cbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VDb21tZW50IHtcbiAgaWQ6IHN0cmluZztcbiAgcHJvdGVjdGVkIHh5XzogQ29vcmRpbmF0ZTtcbiAgcHJvdGVjdGVkIGhlaWdodF86IG51bWJlcjtcbiAgcHJvdGVjdGVkIHdpZHRoXzogbnVtYmVyO1xuICBwcm90ZWN0ZWQgUlRMOiBib29sZWFuO1xuXG4gIHByaXZhdGUgZGVsZXRhYmxlXyA9IHRydWU7XG5cbiAgcHJpdmF0ZSBtb3ZhYmxlXyA9IHRydWU7XG5cbiAgcHJpdmF0ZSBlZGl0YWJsZV8gPSB0cnVlO1xuICBwcm90ZWN0ZWQgY29udGVudF86IHN0cmluZztcblxuICAvKiogV2hldGhlciB0aGlzIGNvbW1lbnQgaGFzIGJlZW4gZGlzcG9zZWQuICovXG4gIHByb3RlY3RlZCBkaXNwb3NlZF8gPSBmYWxzZTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBpc0NvbW1lbnQgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSBibG9jaydzIHdvcmtzcGFjZS5cbiAgICogQHBhcmFtIGNvbnRlbnQgVGhlIGNvbnRlbnQgb2YgdGhpcyB3b3Jrc3BhY2UgY29tbWVudC5cbiAgICogQHBhcmFtIGhlaWdodCBIZWlnaHQgb2YgdGhlIGNvbW1lbnQuXG4gICAqIEBwYXJhbSB3aWR0aCBXaWR0aCBvZiB0aGUgY29tbWVudC5cbiAgICogQHBhcmFtIG9wdF9pZCBPcHRpb25hbCBJRC4gIFVzZSB0aGlzIElEIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3XG4gICAqICAgICBJRC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHVibGljIHdvcmtzcGFjZTogV29ya3NwYWNlLCBjb250ZW50OiBzdHJpbmcsIGhlaWdodDogbnVtYmVyLFxuICAgICAgd2lkdGg6IG51bWJlciwgb3B0X2lkPzogc3RyaW5nKSB7XG4gICAgdGhpcy5pZCA9IG9wdF9pZCAmJiAhd29ya3NwYWNlLmdldENvbW1lbnRCeUlkKG9wdF9pZCkgP1xuICAgICAgICBvcHRfaWQgOlxuICAgICAgICBpZEdlbmVyYXRvci5nZW5VaWQoKTtcblxuICAgIHdvcmtzcGFjZS5hZGRUb3BDb21tZW50KHRoaXMpO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbW1lbnQncyBwb3NpdGlvbiBpbiB3b3Jrc3BhY2UgdW5pdHMuICAoMCwgMCkgaXMgYXQgdGhlIHdvcmtzcGFjZSdzXG4gICAgICogb3JpZ2luOyBzY2FsZSBkb2VzIG5vdCBjaGFuZ2UgdGhpcyB2YWx1ZS5cbiAgICAgKi9cbiAgICB0aGlzLnh5XyA9IG5ldyBDb29yZGluYXRlKDAsIDApO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbW1lbnQncyBoZWlnaHQgaW4gd29ya3NwYWNlIHVuaXRzLiAgU2NhbGUgZG9lcyBub3QgY2hhbmdlIHRoaXNcbiAgICAgKiB2YWx1ZS5cbiAgICAgKi9cbiAgICB0aGlzLmhlaWdodF8gPSBoZWlnaHQ7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgY29tbWVudCdzIHdpZHRoIGluIHdvcmtzcGFjZSB1bml0cy4gIFNjYWxlIGRvZXMgbm90IGNoYW5nZSB0aGlzXG4gICAgICogdmFsdWUuXG4gICAgICovXG4gICAgdGhpcy53aWR0aF8gPSB3aWR0aDtcblxuICAgIHRoaXMuUlRMID0gd29ya3NwYWNlLlJUTDtcblxuICAgIHRoaXMuY29udGVudF8gPSBjb250ZW50O1xuXG4gICAgV29ya3NwYWNlQ29tbWVudC5maXJlQ3JlYXRlRXZlbnQodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIGNvbW1lbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5kaXNwb3NlZF8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5DT01NRU5UX0RFTEVURSkpKHRoaXMpKTtcbiAgICB9XG4gICAgLy8gUmVtb3ZlIGZyb20gdGhlIGxpc3Qgb2YgdG9wIGNvbW1lbnRzIGFuZCB0aGUgY29tbWVudCBkYXRhYmFzZS5cbiAgICB0aGlzLndvcmtzcGFjZS5yZW1vdmVUb3BDb21tZW50KHRoaXMpO1xuICAgIHRoaXMuZGlzcG9zZWRfID0gdHJ1ZTtcbiAgfVxuXG4gIC8vIEhlaWdodCwgd2lkdGgsIHgsIGFuZCB5IGFyZSBhbGwgc3RvcmVkIG9uIGV2ZW4gbm9uLXJlbmRlcmVkIGNvbW1lbnRzLCB0b1xuICAvLyBwcmVzZXJ2ZSBzdGF0ZSBpZiB5b3UgcGFzcyB0aGUgY29udGVudHMgdGhyb3VnaCBhIGhlYWRsZXNzIHdvcmtzcGFjZS5cblxuICAvKipcbiAgICogR2V0IGNvbW1lbnQgaGVpZ2h0LlxuICAgKlxuICAgKiBAcmV0dXJucyBDb21tZW50IGhlaWdodC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRIZWlnaHQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5oZWlnaHRfO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBjb21tZW50IGhlaWdodC5cbiAgICpcbiAgICogQHBhcmFtIGhlaWdodCBDb21tZW50IGhlaWdodC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICB0aGlzLmhlaWdodF8gPSBoZWlnaHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNvbW1lbnQgd2lkdGguXG4gICAqXG4gICAqIEByZXR1cm5zIENvbW1lbnQgd2lkdGguXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0V2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy53aWR0aF87XG4gIH1cblxuICAvKipcbiAgICogU2V0IGNvbW1lbnQgd2lkdGguXG4gICAqXG4gICAqIEBwYXJhbSB3aWR0aCBjb21tZW50IHdpZHRoLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldFdpZHRoKHdpZHRoOiBudW1iZXIpIHtcbiAgICB0aGlzLndpZHRoXyA9IHdpZHRoO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzdG9yZWQgbG9jYXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb21tZW50J3Mgc3RvcmVkIGxvY2F0aW9uLlxuICAgKiAgIFRoaXMgaXMgbm90IHZhbGlkIGlmIHRoZSBjb21tZW50IGlzIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFhZKCk6IENvb3JkaW5hdGUge1xuICAgIHJldHVybiBuZXcgQ29vcmRpbmF0ZSh0aGlzLnh5Xy54LCB0aGlzLnh5Xy55KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgY29tbWVudCBieSBhIHJlbGF0aXZlIG9mZnNldC5cbiAgICpcbiAgICogQHBhcmFtIGR4IEhvcml6b250YWwgb2Zmc2V0LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBwYXJhbSBkeSBWZXJ0aWNhbCBvZmZzZXQsIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBtb3ZlQnkoZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xuICAgIGNvbnN0IGV2ZW50ID1cbiAgICAgICAgbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkNPTU1FTlRfTU9WRSkpKHRoaXMpIGFzIENvbW1lbnRNb3ZlO1xuICAgIHRoaXMueHlfLnRyYW5zbGF0ZShkeCwgZHkpO1xuICAgIGV2ZW50LnJlY29yZE5ldygpO1xuICAgIGV2ZW50VXRpbHMuZmlyZShldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgdGhpcyBjb21tZW50IGlzIGRlbGV0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgZGVsZXRhYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzRGVsZXRhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRlbGV0YWJsZV8gJiZcbiAgICAgICAgISh0aGlzLndvcmtzcGFjZSAmJiB0aGlzLndvcmtzcGFjZS5vcHRpb25zLnJlYWRPbmx5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGlzIGNvbW1lbnQgaXMgZGVsZXRhYmxlIG9yIG5vdC5cbiAgICpcbiAgICogQHBhcmFtIGRlbGV0YWJsZSBUcnVlIGlmIGRlbGV0YWJsZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXREZWxldGFibGUoZGVsZXRhYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5kZWxldGFibGVfID0gZGVsZXRhYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB3aGV0aGVyIHRoaXMgY29tbWVudCBpcyBtb3ZhYmxlIG9yIG5vdC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBtb3ZhYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzTW92YWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5tb3ZhYmxlXyAmJlxuICAgICAgICAhKHRoaXMud29ya3NwYWNlICYmIHRoaXMud29ya3NwYWNlLm9wdGlvbnMucmVhZE9ubHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgY29tbWVudCBpcyBtb3ZhYmxlIG9yIG5vdC5cbiAgICpcbiAgICogQHBhcmFtIG1vdmFibGUgVHJ1ZSBpZiBtb3ZhYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldE1vdmFibGUobW92YWJsZTogYm9vbGVhbikge1xuICAgIHRoaXMubW92YWJsZV8gPSBtb3ZhYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB3aGV0aGVyIHRoaXMgY29tbWVudCBpcyBlZGl0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgZWRpdGFibGUuXG4gICAqL1xuICBpc0VkaXRhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmVkaXRhYmxlXyAmJlxuICAgICAgICAhKHRoaXMud29ya3NwYWNlICYmIHRoaXMud29ya3NwYWNlLm9wdGlvbnMucmVhZE9ubHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgY29tbWVudCBpcyBlZGl0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBlZGl0YWJsZSBUcnVlIGlmIGVkaXRhYmxlLlxuICAgKi9cbiAgc2V0RWRpdGFibGUoZWRpdGFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmVkaXRhYmxlXyA9IGVkaXRhYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhpcyBjb21tZW50J3MgdGV4dC5cbiAgICpcbiAgICogQHJldHVybnMgQ29tbWVudCB0ZXh0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldENvbnRlbnQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jb250ZW50XztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhpcyBjb21tZW50J3MgY29udGVudC5cbiAgICpcbiAgICogQHBhcmFtIGNvbnRlbnQgQ29tbWVudCBjb250ZW50LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldENvbnRlbnQoY29udGVudDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuY29udGVudF8gIT09IGNvbnRlbnQpIHtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuQ09NTUVOVF9DSEFOR0UpKShcbiAgICAgICAgICB0aGlzLCB0aGlzLmNvbnRlbnRfLCBjb250ZW50KSk7XG4gICAgICB0aGlzLmNvbnRlbnRfID0gY29udGVudDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIGEgY29tbWVudCBzdWJ0cmVlIGFzIFhNTCB3aXRoIFhZIGNvb3JkaW5hdGVzLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25vSWQgVHJ1ZSBpZiB0aGUgZW5jb2RlciBzaG91bGQgc2tpcCB0aGUgY29tbWVudCBJRC5cbiAgICogQHJldHVybnMgVHJlZSBvZiBYTUwgZWxlbWVudHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdG9YbWxXaXRoWFkob3B0X25vSWQ/OiBib29sZWFuKTogRWxlbWVudCB7XG4gICAgY29uc3QgZWxlbWVudCA9IHRoaXMudG9YbWwob3B0X25vSWQpO1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCd4JywgYCR7TWF0aC5yb3VuZCh0aGlzLnh5Xy54KX1gKTtcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgneScsIGAke01hdGgucm91bmQodGhpcy54eV8ueSl9YCk7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2gnLCBgJHt0aGlzLmhlaWdodF99YCk7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3cnLCBgJHt0aGlzLndpZHRoX31gKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgYSBjb21tZW50IHN1YnRyZWUgYXMgWE1MLCBidXQgZG9uJ3Qgc2VyaWFsaXplIHRoZSBYWSBjb29yZGluYXRlcy5cbiAgICogVGhpcyBtZXRob2QgYXZvaWRzIHNvbWUgZXhwZW5zaXZlIG1ldHJpY3MtcmVsYXRlZCBjYWxscyB0aGF0IGFyZSBtYWRlIGluXG4gICAqIHRvWG1sV2l0aFhZKCkuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfbm9JZCBUcnVlIGlmIHRoZSBlbmNvZGVyIHNob3VsZCBza2lwIHRoZSBjb21tZW50IElELlxuICAgKiBAcmV0dXJucyBUcmVlIG9mIFhNTCBlbGVtZW50cy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICB0b1htbChvcHRfbm9JZD86IGJvb2xlYW4pOiBFbGVtZW50IHtcbiAgICBjb25zdCBjb21tZW50RWxlbWVudCA9IHhtbC5jcmVhdGVFbGVtZW50KCdjb21tZW50Jyk7XG4gICAgaWYgKCFvcHRfbm9JZCkge1xuICAgICAgY29tbWVudEVsZW1lbnQuaWQgPSB0aGlzLmlkO1xuICAgIH1cbiAgICBjb21tZW50RWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0Q29udGVudCgpO1xuICAgIHJldHVybiBjb21tZW50RWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaXJlIGEgY3JlYXRlIGV2ZW50IGZvciB0aGUgZ2l2ZW4gd29ya3NwYWNlIGNvbW1lbnQsIGlmIGNvbW1lbnRzIGFyZVxuICAgKiBlbmFibGVkLlxuICAgKlxuICAgKiBAcGFyYW0gY29tbWVudCBUaGUgY29tbWVudCB0aGF0IHdhcyBqdXN0IGNyZWF0ZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZpcmVDcmVhdGVFdmVudChjb21tZW50OiBXb3Jrc3BhY2VDb21tZW50KSB7XG4gICAgaWYgKGV2ZW50VXRpbHMuaXNFbmFibGVkKCkpIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nR3JvdXAgPSBldmVudFV0aWxzLmdldEdyb3VwKCk7XG4gICAgICBpZiAoIWV4aXN0aW5nR3JvdXApIHtcbiAgICAgICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGV2ZW50VXRpbHMuZmlyZShcbiAgICAgICAgICAgIG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5DT01NRU5UX0NSRUFURSkpKGNvbW1lbnQpKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGlmICghZXhpc3RpbmdHcm91cCkge1xuICAgICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSBhbiBYTUwgY29tbWVudCB0YWcgYW5kIGNyZWF0ZSBhIGNvbW1lbnQgb24gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHhtbENvbW1lbnQgWE1MIGNvbW1lbnQgZWxlbWVudC5cbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlLlxuICAgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB3b3Jrc3BhY2UgY29tbWVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbVhtbCh4bWxDb21tZW50OiBFbGVtZW50LCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IFdvcmtzcGFjZUNvbW1lbnQge1xuICAgIGNvbnN0IGluZm8gPSBXb3Jrc3BhY2VDb21tZW50LnBhcnNlQXR0cmlidXRlcyh4bWxDb21tZW50KTtcblxuICAgIGNvbnN0IGNvbW1lbnQgPVxuICAgICAgICBuZXcgV29ya3NwYWNlQ29tbWVudCh3b3Jrc3BhY2UsIGluZm8uY29udGVudCwgaW5mby5oLCBpbmZvLncsIGluZm8uaWQpO1xuXG4gICAgY29uc3QgeG1sWCA9IHhtbENvbW1lbnQuZ2V0QXR0cmlidXRlKCd4Jyk7XG4gICAgY29uc3QgeG1sWSA9IHhtbENvbW1lbnQuZ2V0QXR0cmlidXRlKCd5Jyk7XG4gICAgY29uc3QgY29tbWVudFggPSB4bWxYID8gcGFyc2VJbnQoeG1sWCwgMTApIDogTmFOO1xuICAgIGNvbnN0IGNvbW1lbnRZID0geG1sWSA/IHBhcnNlSW50KHhtbFksIDEwKSA6IE5hTjtcbiAgICBpZiAoIWlzTmFOKGNvbW1lbnRYKSAmJiAhaXNOYU4oY29tbWVudFkpKSB7XG4gICAgICBjb21tZW50Lm1vdmVCeShjb21tZW50WCwgY29tbWVudFkpO1xuICAgIH1cblxuICAgIFdvcmtzcGFjZUNvbW1lbnQuZmlyZUNyZWF0ZUV2ZW50KGNvbW1lbnQpO1xuICAgIHJldHVybiBjb21tZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSBhbiBYTUwgY29tbWVudCB0YWcgYW5kIHJldHVybiB0aGUgcmVzdWx0cyBpbiBhbiBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSB4bWwgWE1MIGNvbW1lbnQgZWxlbWVudC5cbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGlkLCBzaXplLCBwb3NpdGlvbiwgYW5kIGNvbW1lbnQgc3RyaW5nLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBwYXJzZUF0dHJpYnV0ZXMoeG1sOiBFbGVtZW50KToge1xuICAgIGlkOiBzdHJpbmcsXG4gICAgdzogbnVtYmVyLFxuICAgIGg6IG51bWJlcixcbiAgICB4OiBudW1iZXIsXG4gICAgeTogbnVtYmVyLFxuICAgIGNvbnRlbnQ6IHN0cmluZ1xuICB9IHtcbiAgICBjb25zdCB4bWxIID0geG1sLmdldEF0dHJpYnV0ZSgnaCcpO1xuICAgIGNvbnN0IHhtbFcgPSB4bWwuZ2V0QXR0cmlidXRlKCd3Jyk7XG4gICAgY29uc3QgeG1sWCA9IHhtbC5nZXRBdHRyaWJ1dGUoJ3gnKTtcbiAgICBjb25zdCB4bWxZID0geG1sLmdldEF0dHJpYnV0ZSgneScpO1xuICAgIGNvbnN0IHhtbElkID0geG1sLmdldEF0dHJpYnV0ZSgnaWQnKTtcblxuICAgIGlmICgheG1sSWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gSUQgcHJlc2VudCBpbiBYTUwgY29tbWVudCBkZWZpbml0aW9uLicpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBpZDogeG1sSWQsXG4gICAgICAvLyBUaGUgaGVpZ2h0IG9mIHRoZSBjb21tZW50IGluIHdvcmtzcGFjZSB1bml0cywgb3IgMTAwIGlmIG5vdCBzcGVjaWZpZWQuXG4gICAgICBoOiB4bWxIID8gcGFyc2VJbnQoeG1sSCkgOiAxMDAsXG4gICAgICAvLyBUaGUgd2lkdGggb2YgdGhlIGNvbW1lbnQgaW4gd29ya3NwYWNlIHVuaXRzLCBvciAxMDAgaWYgbm90IHNwZWNpZmllZC5cbiAgICAgIHc6IHhtbFcgPyBwYXJzZUludCh4bWxXKSA6IDEwMCxcbiAgICAgIC8vIFRoZSB4IHBvc2l0aW9uIG9mIHRoZSBjb21tZW50IGluIHdvcmtzcGFjZSBjb29yZGluYXRlcywgb3IgTmFOIGlmIG5vdFxuICAgICAgLy8gc3BlY2lmaWVkIGluIHRoZSBYTUwuXG4gICAgICB4OiB4bWxYID8gcGFyc2VJbnQoeG1sWCkgOiBOYU4sXG4gICAgICAvLyBUaGUgeSBwb3NpdGlvbiBvZiB0aGUgY29tbWVudCBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMsIG9yIE5hTiBpZiBub3RcbiAgICAgIC8vIHNwZWNpZmllZCBpbiB0aGUgWE1MLlxuICAgICAgeTogeG1sWSA/IHBhcnNlSW50KHhtbFkpIDogTmFOLFxuICAgICAgY29udGVudDogeG1sLnRleHRDb250ZW50ID8/ICcnLFxuICAgIH07XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBldmVudHMgZmlyZWQgYXMgYSByZXN1bHQgb2YgVUkgYWN0aW9ucyBpblxuICogQmxvY2tseSdzIGVkaXRvci5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuVWlCYXNlJyk7XG5cbmltcG9ydCB7QWJzdHJhY3QgYXMgQWJzdHJhY3RFdmVudH0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuXG5cbi8qKlxuICogQmFzZSBjbGFzcyBmb3IgYSBVSSBldmVudC5cbiAqIFVJIGV2ZW50cyBhcmUgZXZlbnRzIHRoYXQgZG9uJ3QgbmVlZCB0byBiZSBzZW50IG92ZXIgdGhlIHdpcmUgZm9yIG11bHRpLXVzZXJcbiAqIGVkaXRpbmcgdG8gd29yayAoZS5nLiBzY3JvbGxpbmcgdGhlIHdvcmtzcGFjZSwgem9vbWluZywgb3BlbmluZyB0b29sYm94XG4gKiBjYXRlZ29yaWVzKS5cbiAqIFVJIGV2ZW50cyBkbyBub3QgdW5kbyBvciByZWRvLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5VaUJhc2VcbiAqL1xuZXhwb3J0IGNsYXNzIFVpQmFzZSBleHRlbmRzIEFic3RyYWN0RXZlbnQge1xuICBvdmVycmlkZSBpc0JsYW5rID0gdHJ1ZTtcbiAgb3ZlcnJpZGUgd29ya3NwYWNlSWQ6IHN0cmluZztcblxuICAvLyBVSSBldmVudHMgZG8gbm90IHVuZG8gb3IgcmVkby5cbiAgb3ZlcnJpZGUgcmVjb3JkVW5kbyA9IGZhbHNlO1xuXG4gIC8qKiBXaGV0aGVyIG9yIG5vdCB0aGUgZXZlbnQgaXMgYSBVSSBldmVudC4gKi9cbiAgb3ZlcnJpZGUgaXNVaUV2ZW50ID0gdHJ1ZTtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF93b3Jrc3BhY2VJZCBUaGUgd29ya3NwYWNlIGlkZW50aWZpZXIgZm9yIHRoaXMgZXZlbnQuXG4gICAqICAgIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKG9wdF93b3Jrc3BhY2VJZD86IHN0cmluZykge1xuICAgIHN1cGVyKCk7XG5cbiAgICAvKiogV2hldGhlciBvciBub3QgdGhlIGV2ZW50IGlzIGJsYW5rICh0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24pLiAqL1xuICAgIHRoaXMuaXNCbGFuayA9IHR5cGVvZiBvcHRfd29ya3NwYWNlSWQgPT09ICd1bmRlZmluZWQnO1xuXG4gICAgLyoqIFRoZSB3b3Jrc3BhY2UgaWRlbnRpZmllciBmb3IgdGhpcyBldmVudC4gKi9cbiAgICB0aGlzLndvcmtzcGFjZUlkID0gb3B0X3dvcmtzcGFjZUlkID8gb3B0X3dvcmtzcGFjZUlkIDogJyc7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBFdmVudHMgZmlyZWQgYXMgYSByZXN1bHQgb2YgZWxlbWVudCBzZWxlY3QgYWN0aW9uLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5TZWxlY3RlZCcpO1xuXG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge0Fic3RyYWN0RXZlbnRKc29ufSBmcm9tICcuL2V2ZW50c19hYnN0cmFjdC5qcyc7XG5cbmltcG9ydCB7VWlCYXNlfSBmcm9tICcuL2V2ZW50c191aV9iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgc2VsZWN0ZWQgZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLlNlbGVjdGVkXG4gKi9cbmV4cG9ydCBjbGFzcyBTZWxlY3RlZCBleHRlbmRzIFVpQmFzZSB7XG4gIG9sZEVsZW1lbnRJZD86IHN0cmluZztcbiAgbmV3RWxlbWVudElkPzogc3RyaW5nO1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5TRUxFQ1RFRDtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF9vbGRFbGVtZW50SWQgVGhlIElEIG9mIHRoZSBwcmV2aW91c2x5IHNlbGVjdGVkIGVsZW1lbnQuIE51bGwgaWZcbiAgICogICAgIG5vIGVsZW1lbnQgbGFzdCBzZWxlY3RlZC4gVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X25ld0VsZW1lbnRJZCBUaGUgSUQgb2YgdGhlIHNlbGVjdGVkIGVsZW1lbnQuIE51bGwgaWYgbm8gZWxlbWVudFxuICAgKiAgICAgY3VycmVudGx5IHNlbGVjdGVkIChkZXNlbGVjdCkuIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG9wdF93b3Jrc3BhY2VJZCBUaGUgd29ya3NwYWNlIGlkZW50aWZpZXIgZm9yIHRoaXMgZXZlbnQuXG4gICAqICAgIE51bGwgaWYgbm8gZWxlbWVudCBwcmV2aW91c2x5IHNlbGVjdGVkLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIG9wdF9vbGRFbGVtZW50SWQ/OiBzdHJpbmd8bnVsbCwgb3B0X25ld0VsZW1lbnRJZD86IHN0cmluZ3xudWxsLFxuICAgICAgb3B0X3dvcmtzcGFjZUlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIob3B0X3dvcmtzcGFjZUlkKTtcblxuICAgIC8qKiBUaGUgaWQgb2YgdGhlIGxhc3Qgc2VsZWN0ZWQgZWxlbWVudC4gKi9cbiAgICB0aGlzLm9sZEVsZW1lbnRJZCA9IG9wdF9vbGRFbGVtZW50SWQgPz8gdW5kZWZpbmVkO1xuXG4gICAgLyoqIFRoZSBpZCBvZiB0aGUgc2VsZWN0ZWQgZWxlbWVudC4gKi9cbiAgICB0aGlzLm5ld0VsZW1lbnRJZCA9IG9wdF9uZXdFbGVtZW50SWQgPz8gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBTZWxlY3RlZEpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBTZWxlY3RlZEpzb247XG4gICAganNvblsnb2xkRWxlbWVudElkJ10gPSB0aGlzLm9sZEVsZW1lbnRJZDtcbiAgICBqc29uWyduZXdFbGVtZW50SWQnXSA9IHRoaXMubmV3RWxlbWVudElkO1xuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIGZyb21Kc29uKGpzb246IFNlbGVjdGVkSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5TZWxlY3RlZC5wcm90b3R5cGUuZnJvbUpzb24nLCAndmVyc2lvbiA5JywgJ3ZlcnNpb24gMTAnLFxuICAgICAgICAnQmxvY2tseS5FdmVudHMuZnJvbUpzb24nKTtcbiAgICBzdXBlci5mcm9tSnNvbihqc29uKTtcbiAgICB0aGlzLm9sZEVsZW1lbnRJZCA9IGpzb25bJ29sZEVsZW1lbnRJZCddO1xuICAgIHRoaXMubmV3RWxlbWVudElkID0ganNvblsnbmV3RWxlbWVudElkJ107XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIFNlbGVjdGVkLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0IHBhcmFtZXRlcnNcbiAgICogICAgIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mIHBhcmFtZXRlcnMgdG9cbiAgICogICAgIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogU2VsZWN0ZWRKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgU2VsZWN0ZWQge1xuICAgIGNvbnN0IG5ld0V2ZW50ID1cbiAgICAgICAgc3VwZXIuZnJvbUpzb24oanNvbiwgd29ya3NwYWNlLCBldmVudCA/PyBuZXcgU2VsZWN0ZWQoKSkgYXMgU2VsZWN0ZWQ7XG4gICAgbmV3RXZlbnQub2xkRWxlbWVudElkID0ganNvblsnb2xkRWxlbWVudElkJ107XG4gICAgbmV3RXZlbnQubmV3RWxlbWVudElkID0ganNvblsnbmV3RWxlbWVudElkJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VsZWN0ZWRKc29uIGV4dGVuZHMgQWJzdHJhY3RFdmVudEpzb24ge1xuICBvbGRFbGVtZW50SWQ/OiBzdHJpbmc7XG4gIG5ld0VsZW1lbnRJZD86IHN0cmluZztcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5TRUxFQ1RFRCwgU2VsZWN0ZWQpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIERlZmluZXMgdGhlIFN2ZyBjbGFzcy4gSXRzIGNvbnN0YW50cyBlbnVtZXJhdGVcbiAqIGFsbCBTVkcgdGFnIG5hbWVzIHVzZWQgYnkgQmxvY2tseS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS51dGlscy5TdmcnKTtcblxuXG4vKipcbiAqIEEgbmFtZSB3aXRoIHRoZSB0eXBlIG9mIHRoZSBTVkcgZWxlbWVudCBzdG9yZWQgaW4gdGhlIGdlbmVyaWMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuU3ZnXG4gKi9cbmV4cG9ydCBjbGFzcyBTdmc8X1Q+IHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgQU5JTUFURSA9IG5ldyBTdmc8U1ZHQW5pbWF0ZUVsZW1lbnQ+KCdhbmltYXRlJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIENJUkNMRSA9IG5ldyBTdmc8U1ZHQ2lyY2xlRWxlbWVudD4oJ2NpcmNsZScpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBDTElQUEFUSCA9IG5ldyBTdmc8U1ZHQ2xpcFBhdGhFbGVtZW50PignY2xpcFBhdGgnKTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgREVGUyA9IG5ldyBTdmc8U1ZHRGVmc0VsZW1lbnQ+KCdkZWZzJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIEZFQ09NUE9TSVRFID0gbmV3IFN2ZzxTVkdGRUNvbXBvc2l0ZUVsZW1lbnQ+KCdmZUNvbXBvc2l0ZScpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBGRUNPTVBPTkVOVFRSQU5TRkVSID1cbiAgICAgIG5ldyBTdmc8U1ZHRkVDb21wb25lbnRUcmFuc2ZlckVsZW1lbnQ+KCdmZUNvbXBvbmVudFRyYW5zZmVyJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIEZFRkxPT0QgPSBuZXcgU3ZnPFNWR0ZFRmxvb2RFbGVtZW50PignZmVGbG9vZCcpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBGRUZVTkNBID0gbmV3IFN2ZzxTVkdGRUZ1bmNBRWxlbWVudD4oJ2ZlRnVuY0EnKTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgRkVHQVVTU0lBTkJMVVIgPSBuZXcgU3ZnPFNWR0ZFR2F1c3NpYW5CbHVyRWxlbWVudD4oJ2ZlR2F1c3NpYW5CbHVyJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIEZFUE9JTlRMSUdIVCA9IG5ldyBTdmc8U1ZHRkVQb2ludExpZ2h0RWxlbWVudD4oJ2ZlUG9pbnRMaWdodCcpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBGRVNQRUNVTEFSTElHSFRJTkcgPVxuICAgICAgbmV3IFN2ZzxTVkdGRVNwZWN1bGFyTGlnaHRpbmdFbGVtZW50PignZmVTcGVjdWxhckxpZ2h0aW5nJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIEZJTFRFUiA9IG5ldyBTdmc8U1ZHRmlsdGVyRWxlbWVudD4oJ2ZpbHRlcicpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBGT1JFSUdOT0JKRUNUID0gbmV3IFN2ZzxTVkdGb3JlaWduT2JqZWN0RWxlbWVudD4oJ2ZvcmVpZ25PYmplY3QnKTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgRyA9IG5ldyBTdmc8U1ZHR0VsZW1lbnQ+KCdnJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIElNQUdFID0gbmV3IFN2ZzxTVkdJbWFnZUVsZW1lbnQ+KCdpbWFnZScpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBMSU5FID0gbmV3IFN2ZzxTVkdMaW5lRWxlbWVudD4oJ2xpbmUnKTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgUEFUSCA9IG5ldyBTdmc8U1ZHUGF0aEVsZW1lbnQ+KCdwYXRoJyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIFBBVFRFUk4gPSBuZXcgU3ZnPFNWR1BhdHRlcm5FbGVtZW50PigncGF0dGVybicpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBQT0xZR09OID0gbmV3IFN2ZzxTVkdQb2x5Z29uRWxlbWVudD4oJ3BvbHlnb24nKTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgUkVDVCA9IG5ldyBTdmc8U1ZHUmVjdEVsZW1lbnQ+KCdyZWN0Jyk7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIFNWRyA9IG5ldyBTdmc8U1ZHU1ZHRWxlbWVudD4oJ3N2ZycpO1xuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBURVhUID0gbmV3IFN2ZzxTVkdUZXh0RWxlbWVudD4oJ3RleHQnKTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgVFNQQU4gPSBuZXcgU3ZnPFNWR1RTcGFuRWxlbWVudD4oJ3RzcGFuJyk7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB0YWdOYW1lIFRoZSBTVkcgZWxlbWVudCB0YWcgbmFtZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHRhZ05hbWU6IHN0cmluZykge31cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgU1ZHIGVsZW1lbnQgdGFnIG5hbWUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuYW1lLlxuICAgKi9cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy50YWdOYW1lO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0IHJlcHJlc2VudGluZyBhIGNvZGUgY29tbWVudCBvbiBhIHJlbmRlcmVkIHdvcmtzcGFjZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Xb3Jrc3BhY2VDb21tZW50U3ZnJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX3NlbGVjdGVkLmpzJztcblxuaW1wb3J0IHR5cGUge0Jsb2NrRHJhZ1N1cmZhY2VTdmd9IGZyb20gJy4vYmxvY2tfZHJhZ19zdXJmYWNlLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuLy8gaW1wb3J0ICogYXMgQ29udGV4dE1lbnUgZnJvbSAnLi9jb250ZXh0bWVudS5qcyc7XG5pbXBvcnQgKiBhcyBDc3MgZnJvbSAnLi9jc3MuanMnO1xuaW1wb3J0IHR5cGUge0NvbW1lbnRNb3ZlfSBmcm9tICcuL2V2ZW50cy9ldmVudHNfY29tbWVudF9tb3ZlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0lCb3VuZGVkRWxlbWVudH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYm91bmRlZF9lbGVtZW50LmpzJztcbmltcG9ydCB0eXBlIHtJQnViYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9idWJibGUuanMnO1xuaW1wb3J0IHR5cGUge0NvcHlEYXRhLCBJQ29weWFibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2NvcHlhYmxlLmpzJztcbmltcG9ydCAqIGFzIFRvdWNoIGZyb20gJy4vdG91Y2guanMnO1xuaW1wb3J0IHtDb29yZGluYXRlfSBmcm9tICcuL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7UmVjdH0gZnJvbSAnLi91dGlscy9yZWN0LmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VDb21tZW50fSBmcm9tICcuL3dvcmtzcGFjZV9jb21tZW50LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqIFNpemUgb2YgdGhlIHJlc2l6ZSBpY29uLiAqL1xuY29uc3QgUkVTSVpFX1NJWkUgPSA4O1xuXG4vKiogUmFkaXVzIG9mIHRoZSBib3JkZXIgYXJvdW5kIHRoZSBjb21tZW50LiAqL1xuY29uc3QgQk9SREVSX1JBRElVUyA9IDM7XG5cbi8qKiBPZmZzZXQgZnJvbSB0aGUgZm9yZWlnbm9iamVjdCBlZGdlIHRvIHRoZSB0ZXh0YXJlYSBlZGdlLiAqL1xuY29uc3QgVEVYVEFSRUFfT0ZGU0VUID0gMjtcblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB3b3Jrc3BhY2UgY29tbWVudCdzIFNWRyByZXByZXNlbnRhdGlvbi5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Xb3Jrc3BhY2VDb21tZW50U3ZnXG4gKi9cbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VDb21tZW50U3ZnIGV4dGVuZHMgV29ya3NwYWNlQ29tbWVudCBpbXBsZW1lbnRzXG4gICAgSUJvdW5kZWRFbGVtZW50LCBJQnViYmxlLCBJQ29weWFibGUge1xuICAvKipcbiAgICogVGhlIHdpZHRoIGFuZCBoZWlnaHQgdG8gdXNlIHRvIHNpemUgYSB3b3Jrc3BhY2UgY29tbWVudCB3aGVuIGl0IGlzIGZpcnN0XG4gICAqIGFkZGVkLCBiZWZvcmUgaXQgaGFzIGJlZW4gZWRpdGVkIGJ5IHRoZSB1c2VyLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBERUZBVUxUX1NJWkUgPSAxMDA7XG5cbiAgLyoqIE9mZnNldCBmcm9tIHRoZSB0b3AgdG8gbWFrZSByb29tIGZvciBhIHRvcCBiYXIuICovXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFRPUF9PRkZTRVQgPSAxMDtcbiAgb3ZlcnJpZGUgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmc7XG5cbiAgLyoqIE1vdXNlIHVwIGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgb25Nb3VzZVVwV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogTW91c2UgbW92ZSBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIG9uTW91c2VNb3ZlV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogV2hldGhlciBldmVudCBoYW5kbGVycyBoYXZlIGJlZW4gaW5pdGlhbGl6ZWQuICovXG4gIHByaXZhdGUgZXZlbnRzSW5pdF8gPSBmYWxzZTtcbiAgcHJpdmF0ZSB0ZXh0YXJlYV86IEhUTUxUZXh0QXJlYUVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBzdmdSZWN0VGFyZ2V0XzogU1ZHUmVjdEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBzdmdIYW5kbGVUYXJnZXRfOiBTVkdSZWN0RWxlbWVudHxudWxsID0gbnVsbDtcblxuICBwcml2YXRlIGZvcmVpZ25PYmplY3RfOiBTVkdGb3JlaWduT2JqZWN0RWxlbWVudHxudWxsID0gbnVsbDtcblxuICBwcml2YXRlIHJlc2l6ZUdyb3VwXzogU1ZHR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBkZWxldGVHcm91cF86IFNWR0dFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgZGVsZXRlSWNvbkJvcmRlcl86IFNWR0NpcmNsZUVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBmb2N1c2VkXyA9IGZhbHNlO1xuICBwcml2YXRlIGF1dG9MYXlvdXRfID0gZmFsc2U7XG4gIC8vIENyZWF0ZSBjb3JlIGVsZW1lbnRzIGZvciB0aGUgYmxvY2suXG4gIHByaXZhdGUgcmVhZG9ubHkgc3ZnR3JvdXBfOiBTVkdFbGVtZW50O1xuICBzdmdSZWN0XzogQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gIC8qKiBXaGV0aGVyIHRoZSBjb21tZW50IGlzIHJlbmRlcmVkIG9uc2NyZWVuIGFuZCBpcyBhIHBhcnQgb2YgdGhlIERPTS4gKi9cbiAgcHJpdmF0ZSByZW5kZXJlZF8gPSBmYWxzZTtcbiAgcHJpdmF0ZSByZWFkb25seSB1c2VEcmFnU3VyZmFjZV86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIGJsb2NrJ3Mgd29ya3NwYWNlLlxuICAgKiBAcGFyYW0gY29udGVudCBUaGUgY29udGVudCBvZiB0aGlzIHdvcmtzcGFjZSBjb21tZW50LlxuICAgKiBAcGFyYW0gaGVpZ2h0IEhlaWdodCBvZiB0aGUgY29tbWVudC5cbiAgICogQHBhcmFtIHdpZHRoIFdpZHRoIG9mIHRoZSBjb21tZW50LlxuICAgKiBAcGFyYW0gb3B0X2lkIE9wdGlvbmFsIElELiAgVXNlIHRoaXMgSUQgaWYgcHJvdmlkZWQsIG90aGVyd2lzZSBjcmVhdGUgYSBuZXdcbiAgICogICAgIElELlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZywgY29udGVudDogc3RyaW5nLCBoZWlnaHQ6IG51bWJlciwgd2lkdGg6IG51bWJlcixcbiAgICAgIG9wdF9pZD86IHN0cmluZykge1xuICAgIHN1cGVyKHdvcmtzcGFjZSwgY29udGVudCwgaGVpZ2h0LCB3aWR0aCwgb3B0X2lkKTtcbiAgICB0aGlzLnN2Z0dyb3VwXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5HLCB7J2NsYXNzJzogJ2Jsb2NrbHlDb21tZW50J30pO1xuICAgICh0aGlzLnN2Z0dyb3VwXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRyYW5zbGF0ZV8gPSAnJztcbiAgICB0aGlzLndvcmtzcGFjZSA9IHdvcmtzcGFjZTtcblxuICAgIHRoaXMuc3ZnUmVjdF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuUkVDVCwge1xuICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlDb21tZW50UmVjdCcsXG4gICAgICAneCc6IDAsXG4gICAgICAneSc6IDAsXG4gICAgICAncngnOiBCT1JERVJfUkFESVVTLFxuICAgICAgJ3J5JzogQk9SREVSX1JBRElVUyxcbiAgICB9KTtcbiAgICB0aGlzLnN2Z0dyb3VwXy5hcHBlbmRDaGlsZCh0aGlzLnN2Z1JlY3RfKTtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdG8gbW92ZSB0aGUgY29tbWVudCB0byB0aGUgZHJhZyBzdXJmYWNlIHdoZW4gaXQgaXMgZHJhZ2dlZC5cbiAgICAgKiBUcnVlIGlmIGl0IHNob3VsZCBtb3ZlLCBmYWxzZSBpZiBpdCBzaG91bGQgYmUgdHJhbnNsYXRlZCBkaXJlY3RseS5cbiAgICAgKi9cbiAgICB0aGlzLnVzZURyYWdTdXJmYWNlXyA9ICEhd29ya3NwYWNlLmdldEJsb2NrRHJhZ1N1cmZhY2UoKTtcblxuICAgIHRoaXMucmVuZGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIGNvbW1lbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5kaXNwb3NlZF8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gSWYgdGhpcyBjb21tZW50IGlzIGJlaW5nIGRyYWdnZWQsIHVubGluayB0aGUgbW91c2UgZXZlbnRzLlxuICAgIGlmIChjb21tb24uZ2V0U2VsZWN0ZWQoKSA9PT0gdGhpcykge1xuICAgICAgdGhpcy51bnNlbGVjdCgpO1xuICAgICAgdGhpcy53b3Jrc3BhY2UuY2FuY2VsQ3VycmVudEdlc3R1cmUoKTtcbiAgICB9XG5cbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5DT01NRU5UX0RFTEVURSkpKHRoaXMpKTtcbiAgICB9XG5cbiAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLnN2Z0dyb3VwXyk7XG4gICAgLy8gRGlzcG9zZSBvZiBhbnkgcmVuZGVyZWQgY29tcG9uZW50c1xuICAgIHRoaXMuZGlzcG9zZUludGVybmFsXygpO1xuXG4gICAgZXZlbnRVdGlscy5kaXNhYmxlKCk7XG4gICAgc3VwZXIuZGlzcG9zZSgpO1xuICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTVkcgcmVwcmVzZW50YXRpb24gb2YgYSB3b3Jrc3BhY2UgY29tbWVudC5cbiAgICogTWF5IGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZS5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9ub1NlbGVjdCBUZXh0IGluc2lkZSB0ZXh0IGFyZWEgd2lsbCBiZSBzZWxlY3RlZCBpZiBmYWxzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGluaXRTdmcob3B0X25vU2VsZWN0PzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy53b3Jrc3BhY2UucmVuZGVyZWQpIHtcbiAgICAgIHRocm93IFR5cGVFcnJvcignV29ya3NwYWNlIGlzIGhlYWRsZXNzLicpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMud29ya3NwYWNlLm9wdGlvbnMucmVhZE9ubHkgJiYgIXRoaXMuZXZlbnRzSW5pdF8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICAgIHRoaXMuc3ZnUmVjdFRhcmdldF8gYXMgU1ZHUmVjdEVsZW1lbnQsICdwb2ludGVyZG93bicsIHRoaXMsXG4gICAgICAgICAgdGhpcy5wYXRoTW91c2VEb3duXyk7XG4gICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICB0aGlzLnN2Z0hhbmRsZVRhcmdldF8gYXMgU1ZHUmVjdEVsZW1lbnQsICdwb2ludGVyZG93bicsIHRoaXMsXG4gICAgICAgICAgdGhpcy5wYXRoTW91c2VEb3duXyk7XG4gICAgfVxuICAgIHRoaXMuZXZlbnRzSW5pdF8gPSB0cnVlO1xuXG4gICAgdGhpcy51cGRhdGVNb3ZhYmxlKCk7XG4gICAgaWYgKCF0aGlzLmdldFN2Z1Jvb3QoKS5wYXJlbnROb2RlKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZS5nZXRCdWJibGVDYW52YXMoKS5hcHBlbmRDaGlsZCh0aGlzLmdldFN2Z1Jvb3QoKSk7XG4gICAgfVxuXG4gICAgaWYgKCFvcHRfbm9TZWxlY3QgJiYgdGhpcy50ZXh0YXJlYV8pIHtcbiAgICAgIHRoaXMudGV4dGFyZWFfLnNlbGVjdCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVyZG93biBvbiBhbiBTVkcgY29tbWVudC5cbiAgICpcbiAgICogQHBhcmFtIGUgUG9pbnRlciBkb3duIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBwYXRoTW91c2VEb3duXyhlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBjb25zdCBnZXN0dXJlID0gdGhpcy53b3Jrc3BhY2UuZ2V0R2VzdHVyZShlKTtcbiAgICBpZiAoZ2VzdHVyZSkge1xuICAgICAgZ2VzdHVyZS5oYW5kbGVCdWJibGVTdGFydChlLCB0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2hvdyB0aGUgY29udGV4dCBtZW51IGZvciB0aGlzIHdvcmtzcGFjZSBjb21tZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZSBQb2ludGVyIGV2ZW50LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgc2hvd0NvbnRleHRNZW51KGU6IFBvaW50ZXJFdmVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1RoZSBpbXBsZW1lbnRhdGlvbiBvZiBzaG93Q29udGV4dE1lbnUgc2hvdWxkIGJlICcgK1xuICAgICAgICAnbW9ua2V5LXBhdGNoZWQgaW4gYnkgYmxvY2tseS50cycpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCB0aGlzIGNvbW1lbnQuICBIaWdobGlnaHQgaXQgdmlzdWFsbHkuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2VsZWN0KCkge1xuICAgIGlmIChjb21tb24uZ2V0U2VsZWN0ZWQoKSA9PT0gdGhpcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgb2xkSWQgPSBudWxsO1xuICAgIGlmIChjb21tb24uZ2V0U2VsZWN0ZWQoKSkge1xuICAgICAgb2xkSWQgPSBjb21tb24uZ2V0U2VsZWN0ZWQoKSEuaWQ7XG4gICAgICAvLyBVbnNlbGVjdCBhbnkgcHJldmlvdXNseSBzZWxlY3RlZCBibG9jay5cbiAgICAgIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29tbW9uLmdldFNlbGVjdGVkKCkhLnVuc2VsZWN0KCk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBldmVudFV0aWxzLmVuYWJsZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBldmVudCA9IG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5TRUxFQ1RFRCkpKFxuICAgICAgICBvbGRJZCwgdGhpcy5pZCwgdGhpcy53b3Jrc3BhY2UuaWQpO1xuICAgIGV2ZW50VXRpbHMuZmlyZShldmVudCk7XG4gICAgY29tbW9uLnNldFNlbGVjdGVkKHRoaXMpO1xuICAgIHRoaXMuYWRkU2VsZWN0KCk7XG4gIH1cblxuICAvKipcbiAgICogVW5zZWxlY3QgdGhpcyBjb21tZW50LiAgUmVtb3ZlIGl0cyBoaWdobGlnaHRpbmcuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdW5zZWxlY3QoKSB7XG4gICAgaWYgKGNvbW1vbi5nZXRTZWxlY3RlZCgpICE9PSB0aGlzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlNFTEVDVEVEKSkoXG4gICAgICAgIHRoaXMuaWQsIG51bGwsIHRoaXMud29ya3NwYWNlLmlkKTtcbiAgICBldmVudFV0aWxzLmZpcmUoZXZlbnQpO1xuICAgIGNvbW1vbi5zZXRTZWxlY3RlZChudWxsKTtcbiAgICB0aGlzLnJlbW92ZVNlbGVjdCgpO1xuICAgIHRoaXMuYmx1ckZvY3VzKCk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoaXMgY29tbWVudC4gIEhpZ2hsaWdodCBpdCB2aXN1YWxseS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGRTZWxlY3QoKSB7XG4gICAgZG9tLmFkZENsYXNzKHRoaXMuc3ZnR3JvdXBfLCAnYmxvY2tseVNlbGVjdGVkJyk7XG4gICAgdGhpcy5zZXRGb2N1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuc2VsZWN0IHRoaXMgY29tbWVudC4gIFJlbW92ZSBpdHMgaGlnaGxpZ2h0aW5nLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlbW92ZVNlbGVjdCgpIHtcbiAgICBkb20uYWRkQ2xhc3ModGhpcy5zdmdHcm91cF8sICdibG9ja2x5U2VsZWN0ZWQnKTtcbiAgICB0aGlzLmJsdXJGb2N1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvY3VzIHRoaXMgY29tbWVudC4gIEhpZ2hsaWdodCBpdCB2aXN1YWxseS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGRGb2N1cygpIHtcbiAgICBkb20uYWRkQ2xhc3ModGhpcy5zdmdHcm91cF8sICdibG9ja2x5Rm9jdXNlZCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuZm9jdXMgdGhpcyBjb21tZW50LiAgUmVtb3ZlIGl0cyBoaWdobGlnaHRpbmcuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVtb3ZlRm9jdXMoKSB7XG4gICAgZG9tLnJlbW92ZUNsYXNzKHRoaXMuc3ZnR3JvdXBfLCAnYmxvY2tseUZvY3VzZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhpcyBjb21tZW50IHJlbGF0aXZlIHRvXG4gICAqIHRoZSBkcmF3aW5nIHN1cmZhY2UncyBvcmlnaW4gKDAsMCksIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICogSWYgdGhlIGNvbW1lbnQgaXMgb24gdGhlIHdvcmtzcGFjZSwgKDAsIDApIGlzIHRoZSBvcmlnaW4gb2YgdGhlIHdvcmtzcGFjZVxuICAgKiBjb29yZGluYXRlIHN5c3RlbS5cbiAgICogVGhpcyBkb2VzIG5vdCBjaGFuZ2Ugd2l0aCB3b3Jrc3BhY2Ugc2NhbGUuXG4gICAqXG4gICAqIEByZXR1cm5zIE9iamVjdCB3aXRoIC54IGFuZCAueSBwcm9wZXJ0aWVzIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk6IENvb3JkaW5hdGUge1xuICAgIGxldCB4ID0gMDtcbiAgICBsZXQgeSA9IDA7XG5cbiAgICBjb25zdCBkcmFnU3VyZmFjZUdyb3VwID0gdGhpcy51c2VEcmFnU3VyZmFjZV8gP1xuICAgICAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0RyYWdTdXJmYWNlKCkhLmdldEdyb3VwKCkgOlxuICAgICAgICBudWxsO1xuXG4gICAgbGV0IGVsZW1lbnQgPSB0aGlzLmdldFN2Z1Jvb3QoKTtcbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgZG8ge1xuICAgICAgICAvLyBMb29wIHRocm91Z2ggdGhpcyBjb21tZW50IGFuZCBldmVyeSBwYXJlbnQuXG4gICAgICAgIGNvbnN0IHh5ID0gc3ZnTWF0aC5nZXRSZWxhdGl2ZVhZKGVsZW1lbnQgYXMgRWxlbWVudCk7XG4gICAgICAgIHggKz0geHkueDtcbiAgICAgICAgeSArPSB4eS55O1xuICAgICAgICAvLyBJZiB0aGlzIGVsZW1lbnQgaXMgdGhlIGN1cnJlbnQgZWxlbWVudCBvbiB0aGUgZHJhZyBzdXJmYWNlLCBpbmNsdWRlXG4gICAgICAgIC8vIHRoZSB0cmFuc2xhdGlvbiBvZiB0aGUgZHJhZyBzdXJmYWNlIGl0c2VsZi5cbiAgICAgICAgaWYgKHRoaXMudXNlRHJhZ1N1cmZhY2VfICYmXG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0RyYWdTdXJmYWNlKCkhLmdldEN1cnJlbnRCbG9jaygpID09PVxuICAgICAgICAgICAgICAgIGVsZW1lbnQpIHtcbiAgICAgICAgICBjb25zdCBzdXJmYWNlVHJhbnNsYXRpb24gPVxuICAgICAgICAgICAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0RyYWdTdXJmYWNlKCkhLmdldFN1cmZhY2VUcmFuc2xhdGlvbigpO1xuICAgICAgICAgIHggKz0gc3VyZmFjZVRyYW5zbGF0aW9uLng7XG4gICAgICAgICAgeSArPSBzdXJmYWNlVHJhbnNsYXRpb24ueTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ1BhcmVudE5vZGUgfCBudWxsJyBpcyBub3RcbiAgICAgICAgLy8gYXNzaWduYWJsZSB0byB0eXBlICdTVkdFbGVtZW50Jy5cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gICAgICB9IHdoaWxlIChlbGVtZW50ICYmIGVsZW1lbnQgIT09IHRoaXMud29ya3NwYWNlLmdldEJ1YmJsZUNhbnZhcygpICYmXG4gICAgICAgICAgICAgICBlbGVtZW50ICE9PSBkcmFnU3VyZmFjZUdyb3VwKTtcbiAgICB9XG4gICAgdGhpcy54eV8gPSBuZXcgQ29vcmRpbmF0ZSh4LCB5KTtcbiAgICByZXR1cm4gdGhpcy54eV87XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhIGNvbW1lbnQgYnkgYSByZWxhdGl2ZSBvZmZzZXQuXG4gICAqXG4gICAqIEBwYXJhbSBkeCBIb3Jpem9udGFsIG9mZnNldCwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0gZHkgVmVydGljYWwgb2Zmc2V0LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgbW92ZUJ5KGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcbiAgICBjb25zdCBldmVudCA9XG4gICAgICAgIG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5DT01NRU5UX01PVkUpKSh0aGlzKSBhcyBDb21tZW50TW92ZTtcbiAgICAvLyBUT0RPOiBEbyBJIG5lZWQgdG8gbG9vayB1cCB0aGUgcmVsYXRpdmUgdG8gc3VyZmFjZSBYWSBwb3NpdGlvbiBoZXJlP1xuICAgIGNvbnN0IHh5ID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgdGhpcy50cmFuc2xhdGUoeHkueCArIGR4LCB4eS55ICsgZHkpO1xuICAgIHRoaXMueHlfID0gbmV3IENvb3JkaW5hdGUoeHkueCArIGR4LCB4eS55ICsgZHkpO1xuICAgIGV2ZW50LnJlY29yZE5ldygpO1xuICAgIGV2ZW50VXRpbHMuZmlyZShldmVudCk7XG4gICAgdGhpcy53b3Jrc3BhY2UucmVzaXplQ29udGVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2Zvcm1zIGEgY29tbWVudCBieSBzZXR0aW5nIHRoZSB0cmFuc2xhdGlvbiBvbiB0aGUgdHJhbnNmb3JtIGF0dHJpYnV0ZVxuICAgKiBvZiB0aGUgYmxvY2sncyBTVkcuXG4gICAqXG4gICAqIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHRyYW5zbGF0aW9uIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICogQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgdHJhbnNsYXRpb24gaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHRyYW5zbGF0ZSh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMueHlfID0gbmV3IENvb3JkaW5hdGUoeCwgeSk7XG4gICAgdGhpcy5nZXRTdmdSb290KCkuc2V0QXR0cmlidXRlKFxuICAgICAgICAndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgeCArICcsJyArIHkgKyAnKScpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgdGhpcyBjb21tZW50IHRvIGl0cyB3b3Jrc3BhY2UncyBkcmFnIHN1cmZhY2UsIGFjY291bnRpbmcgZm9yXG4gICAqIHBvc2l0aW9uaW5nLiAgR2VuZXJhbGx5IHNob3VsZCBiZSBjYWxsZWQgYXQgdGhlIHNhbWUgdGltZSBhc1xuICAgKiBzZXREcmFnZ2luZyh0cnVlKS4gIERvZXMgbm90aGluZyBpZiB1c2VEcmFnU3VyZmFjZV8gaXMgZmFsc2UuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbW92ZVRvRHJhZ1N1cmZhY2UoKSB7XG4gICAgaWYgKCF0aGlzLnVzZURyYWdTdXJmYWNlXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBUaGUgdHJhbnNsYXRpb24gZm9yIGRyYWcgc3VyZmFjZSBibG9ja3MsXG4gICAgLy8gaXMgZXF1YWwgdG8gdGhlIGN1cnJlbnQgcmVsYXRpdmUtdG8tc3VyZmFjZSBwb3NpdGlvbixcbiAgICAvLyB0byBrZWVwIHRoZSBwb3NpdGlvbiBpbiBzeW5jIGFzIGl0IG1vdmUgb24vb2ZmIHRoZSBzdXJmYWNlLlxuICAgIC8vIFRoaXMgaXMgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgIGNvbnN0IHh5ID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgdGhpcy5jbGVhclRyYW5zZm9ybUF0dHJpYnV0ZXNfKCk7XG4gICAgdGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpIS50cmFuc2xhdGVTdXJmYWNlKHh5LngsIHh5LnkpO1xuICAgIC8vIEV4ZWN1dGUgdGhlIG1vdmUgb24gdGhlIHRvcC1sZXZlbCBTVkcgY29tcG9uZW50XG4gICAgdGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpIS5zZXRCbG9ja3NBbmRTaG93KHRoaXMuZ2V0U3ZnUm9vdCgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoaXMgY29tbWVudCBkdXJpbmcgYSBkcmFnLCB0YWtpbmcgaW50byBhY2NvdW50IHdoZXRoZXIgd2UgYXJlIHVzaW5nIGFcbiAgICogZHJhZyBzdXJmYWNlIHRvIHRyYW5zbGF0ZSBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBkcmFnU3VyZmFjZSBUaGUgc3VyZmFjZSB0aGF0IGNhcnJpZXMgcmVuZGVyZWQgaXRlbXMgZHVyaW5nIGEgZHJhZyxcbiAgICogICAgIG9yIG51bGwgaWYgbm8gZHJhZyBzdXJmYWNlIGlzIGluIHVzZS5cbiAgICogQHBhcmFtIG5ld0xvYyBUaGUgbG9jYXRpb24gdG8gdHJhbnNsYXRlIHRvLCBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbW92ZUR1cmluZ0RyYWcoZHJhZ1N1cmZhY2U6IEJsb2NrRHJhZ1N1cmZhY2VTdmcsIG5ld0xvYzogQ29vcmRpbmF0ZSkge1xuICAgIGlmIChkcmFnU3VyZmFjZSkge1xuICAgICAgZHJhZ1N1cmZhY2UudHJhbnNsYXRlU3VyZmFjZShuZXdMb2MueCwgbmV3TG9jLnkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAodGhpcy5zdmdHcm91cF8gYXMgQW55RHVyaW5nTWlncmF0aW9uKS50cmFuc2xhdGVfID1cbiAgICAgICAgICAndHJhbnNsYXRlKCcgKyBuZXdMb2MueCArICcsJyArIG5ld0xvYy55ICsgJyknO1xuICAgICAgKHRoaXMuc3ZnR3JvdXBfIGFzIEFueUR1cmluZ01pZ3JhdGlvbilcbiAgICAgICAgICAuc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgICAndHJhbnNmb3JtJyxcbiAgICAgICAgICAgICAgKHRoaXMuc3ZnR3JvdXBfIGFzIEFueUR1cmluZ01pZ3JhdGlvbikudHJhbnNsYXRlXyArXG4gICAgICAgICAgICAgICAgICAodGhpcy5zdmdHcm91cF8gYXMgQW55RHVyaW5nTWlncmF0aW9uKS5za2V3Xyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgdGhlIGJ1YmJsZSBncm91cCB0byB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICpcbiAgICogQHBhcmFtIHggVGhlIHggcG9zaXRpb24gdG8gbW92ZSB0by5cbiAgICogQHBhcmFtIHkgVGhlIHkgcG9zaXRpb24gdG8gbW92ZSB0by5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBtb3ZlVG8oeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICB0aGlzLnRyYW5zbGF0ZSh4LCB5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgY29tbWVudCBvZiB0cmFuc2Zvcm09XCIuLi5cIiBhdHRyaWJ1dGVzLlxuICAgKiBVc2VkIHdoZW4gdGhlIGNvbW1lbnQgaXMgc3dpdGNoaW5nIGZyb20gM2QgdG8gMmQgdHJhbnNmb3JtIG9yIHZpY2UgdmVyc2EuXG4gICAqL1xuICBwcml2YXRlIGNsZWFyVHJhbnNmb3JtQXR0cmlidXRlc18oKSB7XG4gICAgdGhpcy5nZXRTdmdSb290KCkucmVtb3ZlQXR0cmlidXRlKCd0cmFuc2Zvcm0nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBjb29yZGluYXRlcyBvZiBhIGJvdW5kaW5nIGJveCBkZXNjcmliaW5nIHRoZSBkaW1lbnNpb25zIG9mIHRoaXNcbiAgICogY29tbWVudC5cbiAgICogQ29vcmRpbmF0ZSBzeXN0ZW06IHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IHdpdGggY29vcmRpbmF0ZXMgb2YgdGhlIGJvdW5kaW5nIGJveC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRCb3VuZGluZ1JlY3RhbmdsZSgpOiBSZWN0IHtcbiAgICBjb25zdCBibG9ja1hZID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgY29uc3QgY29tbWVudEJvdW5kcyA9IHRoaXMuZ2V0SGVpZ2h0V2lkdGgoKTtcbiAgICBjb25zdCB0b3AgPSBibG9ja1hZLnk7XG4gICAgY29uc3QgYm90dG9tID0gYmxvY2tYWS55ICsgY29tbWVudEJvdW5kcy5oZWlnaHQ7XG4gICAgbGV0IGxlZnQ7XG4gICAgbGV0IHJpZ2h0O1xuICAgIGlmICh0aGlzLlJUTCkge1xuICAgICAgbGVmdCA9IGJsb2NrWFkueCAtIGNvbW1lbnRCb3VuZHMud2lkdGg7XG4gICAgICAvLyBBZGQgdGhlIHdpZHRoIG9mIHRoZSB0YWIvcHV6emxlIHBpZWNlIGtub2IgdG8gdGhlIHggY29vcmRpbmF0ZVxuICAgICAgLy8gc2luY2UgWCBpcyB0aGUgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUsIG5vdCB0aGUgd2hvbGUgcHV6emxlIHBpZWNlLlxuICAgICAgcmlnaHQgPSBibG9ja1hZLng7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFN1YnRyYWN0IHRoZSB3aWR0aCBvZiB0aGUgdGFiL3B1enpsZSBwaWVjZSBrbm9iIHRvIHRoZSB4IGNvb3JkaW5hdGVcbiAgICAgIC8vIHNpbmNlIFggaXMgdGhlIGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlLCBub3QgdGhlIHdob2xlIHB1enpsZSBwaWVjZS5cbiAgICAgIGxlZnQgPSBibG9ja1hZLng7XG4gICAgICByaWdodCA9IGJsb2NrWFkueCArIGNvbW1lbnRCb3VuZHMud2lkdGg7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVjdCh0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBvciByZW1vdmUgdGhlIFVJIGluZGljYXRpbmcgaWYgdGhpcyBjb21tZW50IGlzIG1vdmFibGUgb3Igbm90LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZU1vdmFibGUoKSB7XG4gICAgaWYgKHRoaXMuaXNNb3ZhYmxlKCkpIHtcbiAgICAgIGRvbS5hZGRDbGFzcyh0aGlzLnN2Z0dyb3VwXywgJ2Jsb2NrbHlEcmFnZ2FibGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tLnJlbW92ZUNsYXNzKHRoaXMuc3ZnR3JvdXBfLCAnYmxvY2tseURyYWdnYWJsZScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGlzIGNvbW1lbnQgaXMgbW92YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBtb3ZhYmxlIFRydWUgaWYgbW92YWJsZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBzZXRNb3ZhYmxlKG1vdmFibGU6IGJvb2xlYW4pIHtcbiAgICBzdXBlci5zZXRNb3ZhYmxlKG1vdmFibGUpO1xuICAgIHRoaXMudXBkYXRlTW92YWJsZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgY29tbWVudCBpcyBlZGl0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBlZGl0YWJsZSBUcnVlIGlmIGVkaXRhYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgc2V0RWRpdGFibGUoZWRpdGFibGU6IGJvb2xlYW4pIHtcbiAgICBzdXBlci5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XG4gICAgaWYgKHRoaXMudGV4dGFyZWFfKSB7XG4gICAgICB0aGlzLnRleHRhcmVhXy5yZWFkT25seSA9ICFlZGl0YWJsZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjdXJzaXZlbHkgYWRkcyBvciByZW1vdmVzIHRoZSBkcmFnZ2luZyBjbGFzcyB0byB0aGlzIG5vZGUgYW5kIGl0c1xuICAgKiBjaGlsZHJlbi5cbiAgICpcbiAgICogQHBhcmFtIGFkZGluZyBUcnVlIGlmIGFkZGluZywgZmFsc2UgaWYgcmVtb3ZpbmcuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0RHJhZ2dpbmcoYWRkaW5nOiBib29sZWFuKSB7XG4gICAgaWYgKGFkZGluZykge1xuICAgICAgY29uc3QgZ3JvdXAgPSB0aGlzLmdldFN2Z1Jvb3QoKTtcbiAgICAgIChncm91cCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRyYW5zbGF0ZV8gPSAnJztcbiAgICAgIChncm91cCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnNrZXdfID0gJyc7XG4gICAgICBkb20uYWRkQ2xhc3ModGhpcy5zdmdHcm91cF8sICdibG9ja2x5RHJhZ2dpbmcnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tLnJlbW92ZUNsYXNzKHRoaXMuc3ZnR3JvdXBfLCAnYmxvY2tseURyYWdnaW5nJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgcm9vdCBub2RlIG9mIHRoZSBTVkcgb3IgbnVsbCBpZiBub25lIGV4aXN0cy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHJvb3QgU1ZHIG5vZGUgKHByb2JhYmx5IGEgZ3JvdXApLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFN2Z1Jvb3QoKTogU1ZHRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuc3ZnR3JvdXBfO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhpcyBjb21tZW50J3MgdGV4dC5cbiAgICpcbiAgICogQHJldHVybnMgQ29tbWVudCB0ZXh0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGdldENvbnRlbnQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy50ZXh0YXJlYV8gPyB0aGlzLnRleHRhcmVhXy52YWx1ZSA6IHRoaXMuY29udGVudF87XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoaXMgY29tbWVudCdzIGNvbnRlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBjb250ZW50IENvbW1lbnQgY29udGVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBzZXRDb250ZW50KGNvbnRlbnQ6IHN0cmluZykge1xuICAgIHN1cGVyLnNldENvbnRlbnQoY29udGVudCk7XG4gICAgaWYgKHRoaXMudGV4dGFyZWFfKSB7XG4gICAgICB0aGlzLnRleHRhcmVhXy52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY3Vyc29yIG92ZXIgdGhpcyBjb21tZW50IGJ5IGFkZGluZyBvciByZW1vdmluZyBhIGNsYXNzLlxuICAgKlxuICAgKiBAcGFyYW0gZW5hYmxlIFRydWUgaWYgdGhlIGRlbGV0ZSBjdXJzb3Igc2hvdWxkIGJlIHNob3duLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0RGVsZXRlU3R5bGUoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgaWYgKGVuYWJsZSkge1xuICAgICAgZG9tLmFkZENsYXNzKHRoaXMuc3ZnR3JvdXBfLCAnYmxvY2tseURyYWdnaW5nRGVsZXRlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvbS5yZW1vdmVDbGFzcyh0aGlzLnN2Z0dyb3VwXywgJ2Jsb2NrbHlEcmFnZ2luZ0RlbGV0ZScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciBhdXRvLWxheW91dCBvZiB0aGlzIGJ1YmJsZSBpcyBlbmFibGVkLiAgVGhlIGZpcnN0IHRpbWUgYSBidWJibGVcbiAgICogaXMgc2hvd24gaXQgcG9zaXRpb25zIGl0c2VsZiB0byBub3QgY292ZXIgYW55IGJsb2Nrcy4gIE9uY2UgYSB1c2VyIGhhc1xuICAgKiBkcmFnZ2VkIGl0IHRvIHJlcG9zaXRpb24sIGl0IHJlbmRlcnMgd2hlcmUgdGhlIHVzZXIgcHV0IGl0LlxuICAgKlxuICAgKiBAcGFyYW0gX2VuYWJsZSBUcnVlIGlmIGF1dG8tbGF5b3V0IHNob3VsZCBiZSBlbmFibGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0QXV0b0xheW91dChfZW5hYmxlOiBib29sZWFuKSB7fVxuICAvLyBOT1AgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCB0aGUgYnViYmxlIGRyYWdnZXIuXG5cbiAgLyoqXG4gICAqIEVuY29kZSBhIGNvbW1lbnQgc3VidHJlZSBhcyBYTUwgd2l0aCBYWSBjb29yZGluYXRlcy5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9ub0lkIFRydWUgaWYgdGhlIGVuY29kZXIgc2hvdWxkIHNraXAgdGhlIGNvbW1lbnQgSUQuXG4gICAqIEByZXR1cm5zIFRyZWUgb2YgWE1MIGVsZW1lbnRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIHRvWG1sV2l0aFhZKG9wdF9ub0lkPzogYm9vbGVhbik6IEVsZW1lbnQge1xuICAgIGxldCB3aWR0aCA9IDA7ICAvLyBOb3QgdXNlZCBpbiBMVFIuXG4gICAgaWYgKHRoaXMud29ya3NwYWNlLlJUTCkge1xuICAgICAgLy8gSGVyZSBiZSBwZXJmb3JtYW5jZSBkcmFnb25zOiBUaGlzIGNhbGxzIGdldE1ldHJpY3MoKS5cbiAgICAgIHdpZHRoID0gdGhpcy53b3Jrc3BhY2UuZ2V0V2lkdGgoKTtcbiAgICB9XG4gICAgY29uc3QgZWxlbWVudCA9IHRoaXMudG9YbWwob3B0X25vSWQpO1xuICAgIGNvbnN0IHh5ID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdudW1iZXInIGlzIG5vdCBhc3NpZ25hYmxlXG4gICAgLy8gdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZycuXG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd4JyxcbiAgICAgICAgTWF0aC5yb3VuZCh0aGlzLndvcmtzcGFjZS5SVEwgPyB3aWR0aCAtIHh5LnggOiB4eS54KSBhc1xuICAgICAgICAgICAgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgneScsIE1hdGgucm91bmQoeHkueSkgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaCcsIHRoaXMuZ2V0SGVpZ2h0KCkgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgndycsIHRoaXMuZ2V0V2lkdGgoKSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSBhIGNvbW1lbnQgZm9yIGNvcHlpbmcuXG4gICAqXG4gICAqIEByZXR1cm5zIENvcHkgbWV0YWRhdGEuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdG9Db3B5RGF0YSgpOiBDb3B5RGF0YSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNhdmVJbmZvOiB0aGlzLnRvWG1sV2l0aFhZKCksXG4gICAgICBzb3VyY2U6IHRoaXMud29ya3NwYWNlLFxuICAgICAgdHlwZUNvdW50czogbnVsbCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBib3VuZGluZyBib3ggZGVzY3JpYmluZyB0aGUgZGltZW5zaW9ucyBvZiB0aGlzIGNvbW1lbnQuXG4gICAqXG4gICAqIEByZXR1cm5zIE9iamVjdCB3aXRoIGhlaWdodCBhbmQgd2lkdGggcHJvcGVydGllcyBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0SGVpZ2h0V2lkdGgoKToge2hlaWdodDogbnVtYmVyLCB3aWR0aDogbnVtYmVyfSB7XG4gICAgcmV0dXJuIHt3aWR0aDogdGhpcy5nZXRXaWR0aCgpLCBoZWlnaHQ6IHRoaXMuZ2V0SGVpZ2h0KCl9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgdGhlIHdvcmtzcGFjZSBjb21tZW50LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5yZW5kZXJlZF8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRIZWlnaHRXaWR0aCgpO1xuXG4gICAgLy8gQWRkIHRleHQgYXJlYVxuICAgIHRoaXMuY3JlYXRlRWRpdG9yXygpO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnU1ZHRm9yZWlnbk9iamVjdEVsZW1lbnQgfFxuICAgIC8vIG51bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdOb2RlJy5cbiAgICB0aGlzLnN2Z0dyb3VwXy5hcHBlbmRDaGlsZCh0aGlzLmZvcmVpZ25PYmplY3RfIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG5cbiAgICB0aGlzLnN2Z0hhbmRsZVRhcmdldF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlJFQ1QsIHsnY2xhc3MnOiAnYmxvY2tseUNvbW1lbnRIYW5kbGVUYXJnZXQnLCAneCc6IDAsICd5JzogMH0pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnU1ZHUmVjdEVsZW1lbnQgfCBudWxsJyBpc1xuICAgIC8vIG5vdCBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdOb2RlJy5cbiAgICB0aGlzLnN2Z0dyb3VwXy5hcHBlbmRDaGlsZCh0aGlzLnN2Z0hhbmRsZVRhcmdldF8gYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICB0aGlzLnN2Z1JlY3RUYXJnZXRfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLlJFQ1QsIHtcbiAgICAgICdjbGFzcyc6ICdibG9ja2x5Q29tbWVudFRhcmdldCcsXG4gICAgICAneCc6IDAsXG4gICAgICAneSc6IDAsXG4gICAgICAncngnOiBCT1JERVJfUkFESVVTLFxuICAgICAgJ3J5JzogQk9SREVSX1JBRElVUyxcbiAgICB9KTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ1NWR1JlY3RFbGVtZW50IHwgbnVsbCcgaXNcbiAgICAvLyBub3QgYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnTm9kZScuXG4gICAgdGhpcy5zdmdHcm91cF8uYXBwZW5kQ2hpbGQodGhpcy5zdmdSZWN0VGFyZ2V0XyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuXG4gICAgLy8gQWRkIHRoZSByZXNpemUgaWNvblxuICAgIHRoaXMuYWRkUmVzaXplRG9tXygpO1xuICAgIGlmICh0aGlzLmlzRGVsZXRhYmxlKCkpIHtcbiAgICAgIC8vIEFkZCB0aGUgZGVsZXRlIGljb25cbiAgICAgIHRoaXMuYWRkRGVsZXRlRG9tXygpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0U2l6ZV8oc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQpO1xuXG4gICAgLy8gU2V0IHRoZSBjb250ZW50XG4gICAgdGhpcy50ZXh0YXJlYV8hLnZhbHVlID0gdGhpcy5jb250ZW50XztcblxuICAgIHRoaXMucmVuZGVyZWRfID0gdHJ1ZTtcblxuICAgIGlmICh0aGlzLnJlc2l6ZUdyb3VwXykge1xuICAgICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgICAgKHRoaXMucmVzaXplR3JvdXBfKSwgJ3BvaW50ZXJkb3duJywgdGhpcywgdGhpcy5yZXNpemVNb3VzZURvd25fKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0RlbGV0YWJsZSgpKSB7XG4gICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICB0aGlzLmRlbGV0ZUdyb3VwXyBhcyBTVkdHRWxlbWVudCwgJ3BvaW50ZXJkb3duJywgdGhpcyxcbiAgICAgICAgICB0aGlzLmRlbGV0ZU1vdXNlRG93bl8pO1xuICAgICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgICAgdGhpcy5kZWxldGVHcm91cF8gYXMgU1ZHR0VsZW1lbnQsICdwb2ludGVyb3V0JywgdGhpcyxcbiAgICAgICAgICB0aGlzLmRlbGV0ZU1vdXNlT3V0Xyk7XG4gICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICB0aGlzLmRlbGV0ZUdyb3VwXyBhcyBTVkdHRWxlbWVudCwgJ3BvaW50ZXJ1cCcsIHRoaXMsXG4gICAgICAgICAgdGhpcy5kZWxldGVNb3VzZVVwXyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgdGV4dCBhcmVhIGZvciB0aGUgY29tbWVudC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHRvcC1sZXZlbCBub2RlIG9mIHRoZSBlZGl0b3IuXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZUVkaXRvcl8oKTogRWxlbWVudCB7XG4gICAgLyogQ3JlYXRlIHRoZSBlZGl0b3IuICBIZXJlJ3MgdGhlIG1hcmt1cCB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkOlxuICAgICAgICAgIDxmb3JlaWduT2JqZWN0IGNsYXNzPVwiYmxvY2tseUNvbW1lbnRGb3JlaWduT2JqZWN0XCIgeD1cIjBcIiB5PVwiMTBcIlxuICAgICAgICAgIHdpZHRoPVwiMTY0XCIgaGVpZ2h0PVwiMTY0XCI+IDxib2R5IHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiXG4gICAgICAgICAgY2xhc3M9XCJibG9ja2x5TWluaW1hbEJvZHlcIj4gPHRleHRhcmVhXG4gICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCIgY2xhc3M9XCJibG9ja2x5Q29tbWVudFRleHRhcmVhXCJcbiAgICAgICAgICAgICAgICAgIHN0eWxlPVwiaGVpZ2h0OiAxNjRweDsgd2lkdGg6IDE2NHB4O1wiPjwvdGV4dGFyZWE+XG4gICAgICAgICAgICA8L2JvZHk+XG4gICAgICAgICAgPC9mb3JlaWduT2JqZWN0PlxuICAgICAgICAqL1xuICAgIHRoaXMuZm9yZWlnbk9iamVjdF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuRk9SRUlHTk9CSkVDVCwge1xuICAgICAgJ3gnOiAwLFxuICAgICAgJ3knOiBXb3Jrc3BhY2VDb21tZW50U3ZnLlRPUF9PRkZTRVQsXG4gICAgICAnY2xhc3MnOiAnYmxvY2tseUNvbW1lbnRGb3JlaWduT2JqZWN0JyxcbiAgICB9KTtcbiAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGRvbS5IVE1MX05TLCAnYm9keScpO1xuICAgIGJvZHkuc2V0QXR0cmlidXRlKCd4bWxucycsIGRvbS5IVE1MX05TKTtcbiAgICBib2R5LmNsYXNzTmFtZSA9ICdibG9ja2x5TWluaW1hbEJvZHknO1xuICAgIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGRvbS5IVE1MX05TLCAndGV4dGFyZWEnKSBhc1xuICAgICAgICBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICAgIHRleHRhcmVhLmNsYXNzTmFtZSA9ICdibG9ja2x5Q29tbWVudFRleHRhcmVhJztcbiAgICB0ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoJ2RpcicsIHRoaXMuUlRMID8gJ1JUTCcgOiAnTFRSJyk7XG4gICAgdGV4dGFyZWEucmVhZE9ubHkgPSAhdGhpcy5pc0VkaXRhYmxlKCk7XG4gICAgYm9keS5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7XG4gICAgdGhpcy50ZXh0YXJlYV8gPSB0ZXh0YXJlYTtcbiAgICB0aGlzLmZvcmVpZ25PYmplY3RfIS5hcHBlbmRDaGlsZChib2R5KTtcbiAgICAvLyBEb24ndCB6b29tIHdpdGggbW91c2V3aGVlbC5cbiAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGV4dGFyZWEsICd3aGVlbCcsIHRoaXMsIGZ1bmN0aW9uKGU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0pO1xuICAgIGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICB0ZXh0YXJlYSwgJ2NoYW5nZScsIHRoaXMsXG4gICAgICAgIGZ1bmN0aW9uKHRoaXM6IFdvcmtzcGFjZUNvbW1lbnRTdmcsIF9lOiBFdmVudCkge1xuICAgICAgICAgIHRoaXMuc2V0Q29udGVudCh0ZXh0YXJlYS52YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnU1ZHRm9yZWlnbk9iamVjdEVsZW1lbnQgfCBudWxsJyBpcyBub3RcbiAgICAvLyBhc3NpZ25hYmxlIHRvIHR5cGUgJ0VsZW1lbnQnLlxuICAgIHJldHVybiB0aGlzLmZvcmVpZ25PYmplY3RfIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgfVxuXG4gIC8qKiBBZGQgdGhlIHJlc2l6ZSBpY29uIHRvIHRoZSBET00gKi9cbiAgcHJpdmF0ZSBhZGRSZXNpemVEb21fKCkge1xuICAgIHRoaXMucmVzaXplR3JvdXBfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5HLCB7J2NsYXNzJzogdGhpcy5SVEwgPyAnYmxvY2tseVJlc2l6ZVNXJyA6ICdibG9ja2x5UmVzaXplU0UnfSxcbiAgICAgICAgdGhpcy5zdmdHcm91cF8pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnU1ZHR0VsZW1lbnQgfCBudWxsJyBpcyBub3RcbiAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdFbGVtZW50IHwgdW5kZWZpbmVkJy5cbiAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlBPTFlHT04sXG4gICAgICAgIHsncG9pbnRzJzogJzAseCB4LHggeCwwJy5yZXBsYWNlKC94L2csIFJFU0laRV9TSVpFLnRvU3RyaW5nKCkpfSxcbiAgICAgICAgdGhpcy5yZXNpemVHcm91cF8gYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ1NWR0dFbGVtZW50IHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnRWxlbWVudCB8IHVuZGVmaW5lZCcuXG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5MSU5FLCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlSZXNpemVMaW5lJyxcbiAgICAgICAgICAneDEnOiBSRVNJWkVfU0laRSAvIDMsXG4gICAgICAgICAgJ3kxJzogUkVTSVpFX1NJWkUgLSAxLFxuICAgICAgICAgICd4Mic6IFJFU0laRV9TSVpFIC0gMSxcbiAgICAgICAgICAneTInOiBSRVNJWkVfU0laRSAvIDMsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMucmVzaXplR3JvdXBfIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdTVkdHRWxlbWVudCB8IG51bGwnIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0VsZW1lbnQgfCB1bmRlZmluZWQnLlxuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuTElORSwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5UmVzaXplTGluZScsXG4gICAgICAgICAgJ3gxJzogUkVTSVpFX1NJWkUgKiAyIC8gMyxcbiAgICAgICAgICAneTEnOiBSRVNJWkVfU0laRSAtIDEsXG4gICAgICAgICAgJ3gyJzogUkVTSVpFX1NJWkUgLSAxLFxuICAgICAgICAgICd5Mic6IFJFU0laRV9TSVpFICogMiAvIDMsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMucmVzaXplR3JvdXBfIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gIH1cblxuICAvKiogQWRkIHRoZSBkZWxldGUgaWNvbiB0byB0aGUgRE9NICovXG4gIHByaXZhdGUgYWRkRGVsZXRlRG9tXygpIHtcbiAgICB0aGlzLmRlbGV0ZUdyb3VwXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRywgeydjbGFzcyc6ICdibG9ja2x5Q29tbWVudERlbGV0ZUljb24nfSwgdGhpcy5zdmdHcm91cF8pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnU1ZHR0VsZW1lbnQgfCBudWxsJyBpcyBub3RcbiAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdFbGVtZW50IHwgdW5kZWZpbmVkJy5cbiAgICB0aGlzLmRlbGV0ZUljb25Cb3JkZXJfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5DSVJDTEUsXG4gICAgICAgIHsnY2xhc3MnOiAnYmxvY2tseURlbGV0ZUljb25TaGFwZScsICdyJzogJzcnLCAnY3gnOiAnNy41JywgJ2N5JzogJzcuNSd9LFxuICAgICAgICB0aGlzLmRlbGV0ZUdyb3VwXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIC8vIHggaWNvbi5cbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ1NWR0dFbGVtZW50IHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnRWxlbWVudCB8IHVuZGVmaW5lZCcuXG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5MSU5FLCB7XG4gICAgICAgICAgJ3gxJzogJzUnLFxuICAgICAgICAgICd5MSc6ICcxMCcsXG4gICAgICAgICAgJ3gyJzogJzEwJyxcbiAgICAgICAgICAneTInOiAnNScsXG4gICAgICAgICAgJ3N0cm9rZSc6ICcjZmZmJyxcbiAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogJzInLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmRlbGV0ZUdyb3VwXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnU1ZHR0VsZW1lbnQgfCBudWxsJyBpcyBub3RcbiAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdFbGVtZW50IHwgdW5kZWZpbmVkJy5cbiAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkxJTkUsIHtcbiAgICAgICAgICAneDEnOiAnNScsXG4gICAgICAgICAgJ3kxJzogJzUnLFxuICAgICAgICAgICd4Mic6ICcxMCcsXG4gICAgICAgICAgJ3kyJzogJzEwJyxcbiAgICAgICAgICAnc3Ryb2tlJzogJyNmZmYnLFxuICAgICAgICAgICdzdHJva2Utd2lkdGgnOiAnMicsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuZGVsZXRlR3JvdXBfIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcmRvd24gb24gY29tbWVudCdzIHJlc2l6ZSBjb3JuZXIuXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgcmVzaXplTW91c2VEb3duXyhlOiBQb2ludGVyRXZlbnQpIHtcbiAgICB0aGlzLnVuYmluZERyYWdFdmVudHNfKCk7XG4gICAgaWYgKGJyb3dzZXJFdmVudHMuaXNSaWdodEJ1dHRvbihlKSkge1xuICAgICAgLy8gTm8gcmlnaHQtY2xpY2suXG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBMZWZ0LWNsaWNrIChvciBtaWRkbGUgY2xpY2spXG4gICAgdGhpcy53b3Jrc3BhY2Uuc3RhcnREcmFnKFxuICAgICAgICBlLFxuICAgICAgICBuZXcgQ29vcmRpbmF0ZShcbiAgICAgICAgICAgIHRoaXMud29ya3NwYWNlLlJUTCA/IC10aGlzLndpZHRoXyA6IHRoaXMud2lkdGhfLCB0aGlzLmhlaWdodF8pKTtcblxuICAgIHRoaXMub25Nb3VzZVVwV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgZG9jdW1lbnQsICdwb2ludGVydXAnLCB0aGlzLCB0aGlzLnJlc2l6ZU1vdXNlVXBfKTtcbiAgICB0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgZG9jdW1lbnQsICdwb2ludGVybW92ZScsIHRoaXMsIHRoaXMucmVzaXplTW91c2VNb3ZlXyk7XG4gICAgdGhpcy53b3Jrc3BhY2UuaGlkZUNoYWZmKCk7XG4gICAgLy8gVGhpcyBldmVudCBoYXMgYmVlbiBoYW5kbGVkLiAgTm8gbmVlZCB0byBidWJibGUgdXAgdG8gdGhlIGRvY3VtZW50LlxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcmRvd24gb24gY29tbWVudCdzIGRlbGV0ZSBpY29uLlxuICAgKlxuICAgKiBAcGFyYW0gZSBQb2ludGVyIGRvd24gZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIGRlbGV0ZU1vdXNlRG93bl8oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgLy8gSGlnaGxpZ2h0IHRoZSBkZWxldGUgaWNvbi5cbiAgICBpZiAodGhpcy5kZWxldGVJY29uQm9yZGVyXykge1xuICAgICAgZG9tLmFkZENsYXNzKHRoaXMuZGVsZXRlSWNvbkJvcmRlcl8sICdibG9ja2x5RGVsZXRlSWNvbkhpZ2hsaWdodGVkJyk7XG4gICAgfVxuICAgIC8vIFRoaXMgZXZlbnQgaGFzIGJlZW4gaGFuZGxlZC4gIE5vIG5lZWQgdG8gYnViYmxlIHVwIHRvIHRoZSBkb2N1bWVudC5cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJvdXQgb24gY29tbWVudCdzIGRlbGV0ZSBpY29uLlxuICAgKlxuICAgKiBAcGFyYW0gX2UgUG9pbnRlciBvdXQgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIGRlbGV0ZU1vdXNlT3V0XyhfZTogUG9pbnRlckV2ZW50KSB7XG4gICAgLy8gUmVzdG9yZSBoaWdobGlnaHQgb24gdGhlIGRlbGV0ZSBpY29uLlxuICAgIGlmICh0aGlzLmRlbGV0ZUljb25Cb3JkZXJfKSB7XG4gICAgICBkb20ucmVtb3ZlQ2xhc3ModGhpcy5kZWxldGVJY29uQm9yZGVyXywgJ2Jsb2NrbHlEZWxldGVJY29uSGlnaGxpZ2h0ZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcnVwIG9uIGNvbW1lbnQncyBkZWxldGUgaWNvbi5cbiAgICpcbiAgICogQHBhcmFtIGUgUG9pbnRlciB1cCBldmVudC5cbiAgICovXG4gIHByaXZhdGUgZGVsZXRlTW91c2VVcF8oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgLy8gRGVsZXRlIHRoaXMgY29tbWVudC5cbiAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgICAvLyBUaGlzIGV2ZW50IGhhcyBiZWVuIGhhbmRsZWQuICBObyBuZWVkIHRvIGJ1YmJsZSB1cCB0byB0aGUgZG9jdW1lbnQuXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIC8qKiBTdG9wIGJpbmRpbmcgdG8gdGhlIGdsb2JhbCBwb2ludGVydXAgYW5kIHBvaW50ZXJtb3ZlIGV2ZW50cy4gKi9cbiAgcHJpdmF0ZSB1bmJpbmREcmFnRXZlbnRzXygpIHtcbiAgICBpZiAodGhpcy5vbk1vdXNlVXBXcmFwcGVyXykge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbk1vdXNlVXBXcmFwcGVyXyk7XG4gICAgICB0aGlzLm9uTW91c2VVcFdyYXBwZXJfID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMub25Nb3VzZU1vdmVXcmFwcGVyXykge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbk1vdXNlTW92ZVdyYXBwZXJfKTtcbiAgICAgIHRoaXMub25Nb3VzZU1vdmVXcmFwcGVyXyA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJ1cCBldmVudCB3aGlsZSBkcmFnZ2luZyBhIGNvbW1lbnQncyBib3JkZXIgb3IgcmVzaXplXG4gICAqIGhhbmRsZS5cbiAgICpcbiAgICogQHBhcmFtIF9lIFBvaW50ZXIgdXAgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIHJlc2l6ZU1vdXNlVXBfKF9lOiBQb2ludGVyRXZlbnQpIHtcbiAgICBUb3VjaC5jbGVhclRvdWNoSWRlbnRpZmllcigpO1xuICAgIHRoaXMudW5iaW5kRHJhZ0V2ZW50c18oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemUgdGhpcyBjb21tZW50IHRvIGZvbGxvdyB0aGUgcG9pbnRlci5cbiAgICpcbiAgICogQHBhcmFtIGUgUG9pbnRlciBtb3ZlIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSByZXNpemVNb3VzZU1vdmVfKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIHRoaXMuYXV0b0xheW91dF8gPSBmYWxzZTtcbiAgICBjb25zdCBuZXdYWSA9IHRoaXMud29ya3NwYWNlLm1vdmVEcmFnKGUpO1xuICAgIHRoaXMuc2V0U2l6ZV8odGhpcy5SVEwgPyAtbmV3WFkueCA6IG5ld1hZLngsIG5ld1hZLnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRyaWdnZXJlZCB3aGVuIHRoZSBjb21tZW50IGhhcyByZXNpemVkLlxuICAgKiBSZXNpemUgdGhlIHRleHQgYXJlYSBhY2NvcmRpbmdseS5cbiAgICovXG4gIHByaXZhdGUgcmVzaXplQ29tbWVudF8oKSB7XG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuZ2V0SGVpZ2h0V2lkdGgoKTtcbiAgICBjb25zdCB0b3BPZmZzZXQgPSBXb3Jrc3BhY2VDb21tZW50U3ZnLlRPUF9PRkZTRVQ7XG4gICAgY29uc3QgdGV4dE9mZnNldCA9IFRFWFRBUkVBX09GRlNFVCAqIDI7XG5cbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICB0aGlzLmZvcmVpZ25PYmplY3RfIS5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd3aWR0aCcsIHNpemUud2lkdGggYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICB0aGlzLmZvcmVpZ25PYmplY3RfIS5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICdoZWlnaHQnLCAoc2l6ZS5oZWlnaHQgLSB0b3BPZmZzZXQpLnRvU3RyaW5nKCkpO1xuICAgIGlmICh0aGlzLlJUTCkge1xuICAgICAgdGhpcy5mb3JlaWduT2JqZWN0XyEuc2V0QXR0cmlidXRlKCd4JywgKC1zaXplLndpZHRoKS50b1N0cmluZygpKTtcbiAgICB9XG4gICAgdGhpcy50ZXh0YXJlYV8hLnN0eWxlLndpZHRoID0gc2l6ZS53aWR0aCAtIHRleHRPZmZzZXQgKyAncHgnO1xuICAgIHRoaXMudGV4dGFyZWFfIS5zdHlsZS5oZWlnaHQgPSBzaXplLmhlaWdodCAtIHRleHRPZmZzZXQgLSB0b3BPZmZzZXQgKyAncHgnO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBzaXplXG4gICAqXG4gICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiB0aGUgY29udGFpbmVyXG4gICAqIEBwYXJhbSBoZWlnaHQgaGVpZ2h0IG9mIHRoZSBjb250YWluZXJcbiAgICovXG4gIHByaXZhdGUgc2V0U2l6ZV8od2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAvLyBNaW5pbXVtIHNpemUgb2YgYSBjb21tZW50LlxuICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIDQ1KTtcbiAgICBoZWlnaHQgPSBNYXRoLm1heChoZWlnaHQsIDIwICsgV29ya3NwYWNlQ29tbWVudFN2Zy5UT1BfT0ZGU0VUKTtcbiAgICB0aGlzLndpZHRoXyA9IHdpZHRoO1xuICAgIHRoaXMuaGVpZ2h0XyA9IGhlaWdodDtcbiAgICB0aGlzLnN2Z1JlY3RfLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCk7XG4gICAgdGhpcy5zdmdSZWN0Xy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGhlaWdodCk7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdudW1iZXInIGlzIG5vdCBhc3NpZ25hYmxlXG4gICAgLy8gdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZycuXG4gICAgdGhpcy5zdmdSZWN0VGFyZ2V0XyEuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdudW1iZXInIGlzIG5vdCBhc3NpZ25hYmxlXG4gICAgLy8gdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZycuXG4gICAgdGhpcy5zdmdSZWN0VGFyZ2V0XyEuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICB0aGlzLnN2Z0hhbmRsZVRhcmdldF8hLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnbnVtYmVyJyBpcyBub3QgYXNzaWduYWJsZVxuICAgIC8vIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgIHRoaXMuc3ZnSGFuZGxlVGFyZ2V0XyEuc2V0QXR0cmlidXRlKFxuICAgICAgICAnaGVpZ2h0JywgV29ya3NwYWNlQ29tbWVudFN2Zy5UT1BfT0ZGU0VUIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICB0aGlzLnN2Z1JlY3RfLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgJ3NjYWxlKC0xIDEpJyk7XG4gICAgICB0aGlzLnN2Z1JlY3RUYXJnZXRfIS5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsICdzY2FsZSgtMSAxKScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlc2l6ZUdyb3VwXykge1xuICAgICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICAgIC8vIE1pcnJvciB0aGUgcmVzaXplIGdyb3VwLlxuICAgICAgICB0aGlzLnJlc2l6ZUdyb3VwXy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgICAndHJhbnNmb3JtJyxcbiAgICAgICAgICAgICd0cmFuc2xhdGUoJyArICgtd2lkdGggKyBSRVNJWkVfU0laRSkgKyAnLCcgK1xuICAgICAgICAgICAgICAgIChoZWlnaHQgLSBSRVNJWkVfU0laRSkgKyAnKSBzY2FsZSgtMSAxKScpO1xuICAgICAgICB0aGlzLmRlbGV0ZUdyb3VwXyEuc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICAndHJhbnNsYXRlKCcgKyAoLXdpZHRoICsgUkVTSVpFX1NJWkUpICsgJywnICsgLVJFU0laRV9TSVpFICtcbiAgICAgICAgICAgICAgICAnKSBzY2FsZSgtMSAxKScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZXNpemVHcm91cF8uc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICAndHJhbnNsYXRlKCcgKyAod2lkdGggLSBSRVNJWkVfU0laRSkgKyAnLCcgK1xuICAgICAgICAgICAgICAgIChoZWlnaHQgLSBSRVNJWkVfU0laRSkgKyAnKScpO1xuICAgICAgICB0aGlzLmRlbGV0ZUdyb3VwXyEuc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICAndHJhbnNsYXRlKCcgKyAod2lkdGggLSBSRVNJWkVfU0laRSkgKyAnLCcgKyAtUkVTSVpFX1NJWkUgKyAnKScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFsbG93IHRoZSBjb250ZW50cyB0byByZXNpemUuXG4gICAgdGhpcy5yZXNpemVDb21tZW50XygpO1xuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgYW55IHJlbmRlcmVkIGNvbW1lbnQgY29tcG9uZW50cy4gKi9cbiAgcHJpdmF0ZSBkaXNwb3NlSW50ZXJuYWxfKCkge1xuICAgIHRoaXMudGV4dGFyZWFfID0gbnVsbDtcbiAgICB0aGlzLmZvcmVpZ25PYmplY3RfID0gbnVsbDtcbiAgICB0aGlzLnN2Z1JlY3RUYXJnZXRfID0gbnVsbDtcbiAgICB0aGlzLnN2Z0hhbmRsZVRhcmdldF8gPSBudWxsO1xuICAgIHRoaXMuZGlzcG9zZWRfID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGZvY3VzIG9uIHRoZSB0ZXh0IGFyZWEuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Rm9jdXMoKSB7XG4gICAgdGhpcy5mb2N1c2VkXyA9IHRydWU7XG4gICAgLy8gRGVmZXIgQ1NTIGNoYW5nZXMuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5kaXNwb3NlZF8pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy50ZXh0YXJlYV8hLmZvY3VzKCk7XG4gICAgICB0aGlzLmFkZEZvY3VzKCk7XG4gICAgICBpZiAodGhpcy5zdmdSZWN0VGFyZ2V0Xykge1xuICAgICAgICBkb20uYWRkQ2xhc3ModGhpcy5zdmdSZWN0VGFyZ2V0XywgJ2Jsb2NrbHlDb21tZW50VGFyZ2V0Rm9jdXNlZCcpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuc3ZnSGFuZGxlVGFyZ2V0Xykge1xuICAgICAgICBkb20uYWRkQ2xhc3MoXG4gICAgICAgICAgICB0aGlzLnN2Z0hhbmRsZVRhcmdldF8sICdibG9ja2x5Q29tbWVudEhhbmRsZVRhcmdldEZvY3VzZWQnKTtcbiAgICAgIH1cbiAgICB9LCAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgZm9jdXMgZnJvbSB0aGUgdGV4dCBhcmVhLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGJsdXJGb2N1cygpIHtcbiAgICB0aGlzLmZvY3VzZWRfID0gZmFsc2U7XG4gICAgLy8gRGVmZXIgQ1NTIGNoYW5nZXMuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5kaXNwb3NlZF8pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnRleHRhcmVhXyEuYmx1cigpO1xuICAgICAgdGhpcy5yZW1vdmVGb2N1cygpO1xuICAgICAgaWYgKHRoaXMuc3ZnUmVjdFRhcmdldF8pIHtcbiAgICAgICAgZG9tLnJlbW92ZUNsYXNzKHRoaXMuc3ZnUmVjdFRhcmdldF8sICdibG9ja2x5Q29tbWVudFRhcmdldEZvY3VzZWQnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnN2Z0hhbmRsZVRhcmdldF8pIHtcbiAgICAgICAgZG9tLnJlbW92ZUNsYXNzKFxuICAgICAgICAgICAgdGhpcy5zdmdIYW5kbGVUYXJnZXRfLCAnYmxvY2tseUNvbW1lbnRIYW5kbGVUYXJnZXRGb2N1c2VkJyk7XG4gICAgICB9XG4gICAgfSwgMCk7XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIGFuIFhNTCBjb21tZW50IHRhZyBhbmQgY3JlYXRlIGEgcmVuZGVyZWQgY29tbWVudCBvbiB0aGUgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0geG1sQ29tbWVudCBYTUwgY29tbWVudCBlbGVtZW50LlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSBvcHRfd3NXaWR0aCBUaGUgd2lkdGggb2YgdGhlIHdvcmtzcGFjZSwgd2hpY2ggaXMgdXNlZCB0byBwb3NpdGlvblxuICAgKiAgICAgY29tbWVudHMgY29ycmVjdGx5IGluIFJUTC5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgd29ya3NwYWNlIGNvbW1lbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21YbWxSZW5kZXJlZChcbiAgICAgIHhtbENvbW1lbnQ6IEVsZW1lbnQsIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnLFxuICAgICAgb3B0X3dzV2lkdGg/OiBudW1iZXIpOiBXb3Jrc3BhY2VDb21tZW50U3ZnIHtcbiAgICBldmVudFV0aWxzLmRpc2FibGUoKTtcbiAgICBsZXQgY29tbWVudDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaW5mbyA9IFdvcmtzcGFjZUNvbW1lbnQucGFyc2VBdHRyaWJ1dGVzKHhtbENvbW1lbnQpO1xuXG4gICAgICBjb21tZW50ID0gbmV3IFdvcmtzcGFjZUNvbW1lbnRTdmcoXG4gICAgICAgICAgd29ya3NwYWNlLCBpbmZvLmNvbnRlbnQsIGluZm8uaCwgaW5mby53LCBpbmZvLmlkKTtcbiAgICAgIGlmICh3b3Jrc3BhY2UucmVuZGVyZWQpIHtcbiAgICAgICAgY29tbWVudC5pbml0U3ZnKHRydWUpO1xuICAgICAgICBjb21tZW50LnJlbmRlcigpO1xuICAgICAgfVxuICAgICAgLy8gUG9zaXRpb24gdGhlIGNvbW1lbnQgY29ycmVjdGx5LCB0YWtpbmcgaW50byBhY2NvdW50IHRoZSB3aWR0aCBvZiBhXG4gICAgICAvLyByZW5kZXJlZCBSVEwgd29ya3NwYWNlLlxuICAgICAgaWYgKCFpc05hTihpbmZvLngpICYmICFpc05hTihpbmZvLnkpKSB7XG4gICAgICAgIGlmICh3b3Jrc3BhY2UuUlRMKSB7XG4gICAgICAgICAgY29uc3Qgd3NXaWR0aCA9IG9wdF93c1dpZHRoIHx8IHdvcmtzcGFjZS5nZXRXaWR0aCgpO1xuICAgICAgICAgIGNvbW1lbnQubW92ZUJ5KHdzV2lkdGggLSBpbmZvLngsIGluZm8ueSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29tbWVudC5tb3ZlQnkoaW5mby54LCBpbmZvLnkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgfVxuXG4gICAgV29ya3NwYWNlQ29tbWVudC5maXJlQ3JlYXRlRXZlbnQoKGNvbW1lbnQpKTtcbiAgICByZXR1cm4gY29tbWVudDtcbiAgfVxufVxuXG4vKiogQ1NTIGZvciB3b3Jrc3BhY2UgY29tbWVudC4gIFNlZSBjc3MuanMgZm9yIHVzZS4gKi9cbkNzcy5yZWdpc3RlcihgXG4uYmxvY2tseUNvbW1lbnRGb3JlaWduT2JqZWN0IHtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICB6LWluZGV4OiAwO1xufVxuXG4uYmxvY2tseUNvbW1lbnRSZWN0IHtcbiAgZmlsbDogI0U3REU4RTtcbiAgc3Ryb2tlOiAjYmNBOTAzO1xuICBzdHJva2Utd2lkdGg6IDFweDtcbn1cblxuLmJsb2NrbHlDb21tZW50VGFyZ2V0IHtcbiAgZmlsbDogdHJhbnNwYXJlbnQ7XG4gIHN0cm9rZTogI2JjQTkwMztcbn1cblxuLmJsb2NrbHlDb21tZW50VGFyZ2V0Rm9jdXNlZCB7XG4gIGZpbGw6IG5vbmU7XG59XG5cbi5ibG9ja2x5Q29tbWVudEhhbmRsZVRhcmdldCB7XG4gIGZpbGw6IG5vbmU7XG59XG5cbi5ibG9ja2x5Q29tbWVudEhhbmRsZVRhcmdldEZvY3VzZWQge1xuICBmaWxsOiB0cmFuc3BhcmVudDtcbn1cblxuLmJsb2NrbHlGb2N1c2VkPi5ibG9ja2x5Q29tbWVudFJlY3Qge1xuICBmaWxsOiAjQjlCMjcyO1xuICBzdHJva2U6ICNCOUIyNzI7XG59XG5cbi5ibG9ja2x5U2VsZWN0ZWQ+LmJsb2NrbHlDb21tZW50VGFyZ2V0IHtcbiAgc3Ryb2tlOiAjZmMzO1xuICBzdHJva2Utd2lkdGg6IDNweDtcbn1cblxuLmJsb2NrbHlDb21tZW50RGVsZXRlSWNvbiB7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgZmlsbDogIzAwMDtcbiAgZGlzcGxheTogbm9uZTtcbn1cblxuLmJsb2NrbHlTZWxlY3RlZCA+IC5ibG9ja2x5Q29tbWVudERlbGV0ZUljb24ge1xuICBkaXNwbGF5OiBibG9jaztcbn1cblxuLmJsb2NrbHlEZWxldGVJY29uU2hhcGUge1xuICBmaWxsOiAjMDAwO1xuICBzdHJva2U6ICMwMDA7XG4gIHN0cm9rZS13aWR0aDogMXB4O1xufVxuXG4uYmxvY2tseURlbGV0ZUljb25TaGFwZS5ibG9ja2x5RGVsZXRlSWNvbkhpZ2hsaWdodGVkIHtcbiAgc3Ryb2tlOiAjZmMzO1xufVxuYCk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQmFzZSBjbGFzcyBmb3IgYWxsIHR5cGVzIG9mIGJsb2NrIGV2ZW50cy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuQmxvY2tCYXNlJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja30gZnJvbSAnLi4vYmxvY2suanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuaW1wb3J0IHtBYnN0cmFjdCBhcyBBYnN0cmFjdEV2ZW50LCBBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuXG5cbi8qKlxuICogQWJzdHJhY3QgY2xhc3MgZm9yIGEgYmxvY2sgZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLkJsb2NrQmFzZVxuICovXG5leHBvcnQgY2xhc3MgQmxvY2tCYXNlIGV4dGVuZHMgQWJzdHJhY3RFdmVudCB7XG4gIG92ZXJyaWRlIGlzQmxhbmsgPSB0cnVlO1xuICBibG9ja0lkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X2Jsb2NrIFRoZSBibG9jayB0aGlzIGV2ZW50IGNvcnJlc3BvbmRzIHRvLlxuICAgKiAgICAgVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0X2Jsb2NrPzogQmxvY2spIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuaXNCbGFuayA9ICFvcHRfYmxvY2s7XG5cbiAgICBpZiAoIW9wdF9ibG9jaykgcmV0dXJuO1xuXG4gICAgLyoqIFRoZSBibG9jayBJRCBmb3IgdGhlIGJsb2NrIHRoaXMgZXZlbnQgcGVydGFpbnMgdG8gKi9cbiAgICB0aGlzLmJsb2NrSWQgPSBvcHRfYmxvY2suaWQ7XG5cbiAgICAvKiogVGhlIHdvcmtzcGFjZSBpZGVudGlmaWVyIGZvciB0aGlzIGV2ZW50LiAqL1xuICAgIHRoaXMud29ya3NwYWNlSWQgPSBvcHRfYmxvY2sud29ya3NwYWNlLmlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBCbG9ja0Jhc2VKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgQmxvY2tCYXNlSnNvbjtcbiAgICBpZiAoIXRoaXMuYmxvY2tJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAganNvblsnYmxvY2tJZCddID0gdGhpcy5ibG9ja0lkO1xuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIGZyb21Kc29uKGpzb246IEJsb2NrQmFzZUpzb24pIHtcbiAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAnQmxvY2tseS5FdmVudHMuQmxvY2tCYXNlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMuYmxvY2tJZCA9IGpzb25bJ2Jsb2NrSWQnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgQmxvY2tCYXNlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0IHBhcmFtZXRlcnNcbiAgICogICAgIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mIHBhcmFtZXRlcnMgdG9cbiAgICogICAgIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogQmxvY2tCYXNlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIEJsb2NrQmFzZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBCbG9ja0Jhc2UoKSkgYXMgQmxvY2tCYXNlO1xuICAgIG5ld0V2ZW50LmJsb2NrSWQgPSBqc29uWydibG9ja0lkJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmxvY2tCYXNlSnNvbiBleHRlbmRzIEFic3RyYWN0RXZlbnRKc29uIHtcbiAgYmxvY2tJZDogc3RyaW5nO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrIGNoYW5nZSBldmVudC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuQmxvY2tDaGFuZ2UnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuLi9ibG9jay5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcbmltcG9ydCAqIGFzIFhtbCBmcm9tICcuLi94bWwuanMnO1xuXG5pbXBvcnQge0Jsb2NrQmFzZSwgQmxvY2tCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfYmxvY2tfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgYmxvY2sgY2hhbmdlIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5CbG9ja0NoYW5nZVxuICovXG5leHBvcnQgY2xhc3MgQmxvY2tDaGFuZ2UgZXh0ZW5kcyBCbG9ja0Jhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5CTE9DS19DSEFOR0U7XG4gIGVsZW1lbnQ/OiBzdHJpbmc7XG4gIG5hbWU/OiBzdHJpbmc7XG4gIG9sZFZhbHVlOiB1bmtub3duO1xuICBuZXdWYWx1ZTogdW5rbm93bjtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF9ibG9jayBUaGUgY2hhbmdlZCBibG9jay4gIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG9wdF9lbGVtZW50IE9uZSBvZiAnZmllbGQnLCAnY29tbWVudCcsICdkaXNhYmxlZCcsIGV0Yy5cbiAgICogQHBhcmFtIG9wdF9uYW1lIE5hbWUgb2YgaW5wdXQgb3IgZmllbGQgYWZmZWN0ZWQsIG9yIG51bGwuXG4gICAqIEBwYXJhbSBvcHRfb2xkVmFsdWUgUHJldmlvdXMgdmFsdWUgb2YgZWxlbWVudC5cbiAgICogQHBhcmFtIG9wdF9uZXdWYWx1ZSBOZXcgdmFsdWUgb2YgZWxlbWVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X2Jsb2NrPzogQmxvY2ssIG9wdF9lbGVtZW50Pzogc3RyaW5nLCBvcHRfbmFtZT86IHN0cmluZ3xudWxsLFxuICAgICAgb3B0X29sZFZhbHVlPzogdW5rbm93biwgb3B0X25ld1ZhbHVlPzogdW5rbm93bikge1xuICAgIHN1cGVyKG9wdF9ibG9jayk7XG5cbiAgICBpZiAoIW9wdF9ibG9jaykge1xuICAgICAgcmV0dXJuOyAgLy8gQmxhbmsgZXZlbnQgdG8gYmUgcG9wdWxhdGVkIGJ5IGZyb21Kc29uLlxuICAgIH1cbiAgICB0aGlzLmVsZW1lbnQgPSBvcHRfZWxlbWVudDtcbiAgICB0aGlzLm5hbWUgPSBvcHRfbmFtZSB8fCB1bmRlZmluZWQ7XG4gICAgdGhpcy5vbGRWYWx1ZSA9IG9wdF9vbGRWYWx1ZTtcbiAgICB0aGlzLm5ld1ZhbHVlID0gb3B0X25ld1ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBCbG9ja0NoYW5nZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBCbG9ja0NoYW5nZUpzb247XG4gICAgaWYgKCF0aGlzLmVsZW1lbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGNoYW5nZWQgZWxlbWVudCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGFuICcgK1xuICAgICAgICAgICdlbGVtZW50IHRvIHRoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBqc29uWydlbGVtZW50J10gPSB0aGlzLmVsZW1lbnQ7XG4gICAganNvblsnbmFtZSddID0gdGhpcy5uYW1lO1xuICAgIGpzb25bJ29sZFZhbHVlJ10gPSB0aGlzLm9sZFZhbHVlO1xuICAgIGpzb25bJ25ld1ZhbHVlJ10gPSB0aGlzLm5ld1ZhbHVlO1xuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIGZyb21Kc29uKGpzb246IEJsb2NrQ2hhbmdlSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5CbG9ja0NoYW5nZS5wcm90b3R5cGUuZnJvbUpzb24nLCAndmVyc2lvbiA5JyxcbiAgICAgICAgJ3ZlcnNpb24gMTAnLCAnQmxvY2tseS5FdmVudHMuZnJvbUpzb24nKTtcbiAgICBzdXBlci5mcm9tSnNvbihqc29uKTtcbiAgICB0aGlzLmVsZW1lbnQgPSBqc29uWydlbGVtZW50J107XG4gICAgdGhpcy5uYW1lID0ganNvblsnbmFtZSddO1xuICAgIHRoaXMub2xkVmFsdWUgPSBqc29uWydvbGRWYWx1ZSddO1xuICAgIHRoaXMubmV3VmFsdWUgPSBqc29uWyduZXdWYWx1ZSddO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBCbG9ja0NoYW5nZSwgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdFxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZlxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IEJsb2NrQ2hhbmdlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIEJsb2NrQ2hhbmdlIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IEJsb2NrQ2hhbmdlKCkpIGFzXG4gICAgICAgIEJsb2NrQ2hhbmdlO1xuICAgIG5ld0V2ZW50LmVsZW1lbnQgPSBqc29uWydlbGVtZW50J107XG4gICAgbmV3RXZlbnQubmFtZSA9IGpzb25bJ25hbWUnXTtcbiAgICBuZXdFdmVudC5vbGRWYWx1ZSA9IGpzb25bJ29sZFZhbHVlJ107XG4gICAgbmV3RXZlbnQubmV3VmFsdWUgPSBqc29uWyduZXdWYWx1ZSddO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEb2VzIHRoaXMgZXZlbnQgcmVjb3JkIGFueSBjaGFuZ2Ugb2Ygc3RhdGU/XG4gICAqXG4gICAqIEByZXR1cm5zIEZhbHNlIGlmIHNvbWV0aGluZyBjaGFuZ2VkLlxuICAgKi9cbiAgb3ZlcnJpZGUgaXNOdWxsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9sZFZhbHVlID09PSB0aGlzLm5ld1ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1biBhIGNoYW5nZSBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGZvcndhcmQgVHJ1ZSBpZiBydW4gZm9yd2FyZCwgZmFsc2UgaWYgcnVuIGJhY2t3YXJkICh1bmRvKS5cbiAgICovXG4gIG92ZXJyaWRlIHJ1bihmb3J3YXJkOiBib29sZWFuKSB7XG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5nZXRFdmVudFdvcmtzcGFjZV8oKTtcbiAgICBpZiAoIXRoaXMuYmxvY2tJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgY29uc3QgYmxvY2sgPSB3b3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKHRoaXMuYmxvY2tJZCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYXNzb2NpYXRlZCBibG9jayBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgJyArXG4gICAgICAgICAgJ2Jsb2NrIHRvIHRoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICAvLyBBc3N1bWUgdGhlIGJsb2NrIGlzIHJlbmRlcmVkIHNvIHRoYXQgdGhlbiB3ZSBjYW4gY2hlY2suXG4gICAgY29uc3QgYmxvY2tTdmcgPSBibG9jayBhcyBCbG9ja1N2ZztcbiAgICBpZiAoYmxvY2tTdmcubXV0YXRvcikge1xuICAgICAgLy8gQ2xvc2UgdGhlIG11dGF0b3IgKGlmIG9wZW4pIHNpbmNlIHdlIGRvbid0IHdhbnQgdG8gdXBkYXRlIGl0LlxuICAgICAgYmxvY2tTdmcubXV0YXRvci5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBmb3J3YXJkID8gdGhpcy5uZXdWYWx1ZSA6IHRoaXMub2xkVmFsdWU7XG4gICAgc3dpdGNoICh0aGlzLmVsZW1lbnQpIHtcbiAgICAgIGNhc2UgJ2ZpZWxkJzoge1xuICAgICAgICBjb25zdCBmaWVsZCA9IGJsb2NrLmdldEZpZWxkKHRoaXMubmFtZSEpO1xuICAgICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgICBmaWVsZC5zZXRWYWx1ZSh2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdDYW5cXCd0IHNldCBub24tZXhpc3RlbnQgZmllbGQ6ICcgKyB0aGlzLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnY29tbWVudCc6XG4gICAgICAgIGJsb2NrLnNldENvbW1lbnRUZXh0KHZhbHVlIGFzIHN0cmluZyB8fCBudWxsKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjb2xsYXBzZWQnOlxuICAgICAgICBibG9jay5zZXRDb2xsYXBzZWQoISF2YWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZGlzYWJsZWQnOlxuICAgICAgICBibG9jay5zZXRFbmFibGVkKCF2YWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnaW5saW5lJzpcbiAgICAgICAgYmxvY2suc2V0SW5wdXRzSW5saW5lKCEhdmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ211dGF0aW9uJzoge1xuICAgICAgICBjb25zdCBvbGRTdGF0ZSA9IEJsb2NrQ2hhbmdlLmdldEV4dHJhQmxvY2tTdGF0ZV8oYmxvY2sgYXMgQmxvY2tTdmcpO1xuICAgICAgICBpZiAoYmxvY2subG9hZEV4dHJhU3RhdGUpIHtcbiAgICAgICAgICBibG9jay5sb2FkRXh0cmFTdGF0ZShKU09OLnBhcnNlKHZhbHVlIGFzIHN0cmluZyB8fCAne30nKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoYmxvY2suZG9tVG9NdXRhdGlvbikge1xuICAgICAgICAgIGJsb2NrLmRvbVRvTXV0YXRpb24oWG1sLnRleHRUb0RvbSh2YWx1ZSBhcyBzdHJpbmcgfHwgJzxtdXRhdGlvbi8+JykpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50VXRpbHMuZmlyZShcbiAgICAgICAgICAgIG5ldyBCbG9ja0NoYW5nZShibG9jaywgJ211dGF0aW9uJywgbnVsbCwgb2xkU3RhdGUsIHZhbHVlKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS53YXJuKCdVbmtub3duIGNoYW5nZSB0eXBlOiAnICsgdGhpcy5lbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICAvLyBUT0RPICgjNTM5Nyk6IEVuY2Fwc3VsYXRlIHRoaXMgaW4gdGhlIEJsb2NrbHlNdXRhdGlvbkNoYW5nZSBldmVudCB3aGVuXG4gIC8vICAgIHJlZmFjdG9yaW5nIGNoYW5nZSBldmVudHMuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBleHRyYSBzdGF0ZSBvZiB0aGUgZ2l2ZW4gYmxvY2sgKGVpdGhlciBhcyBYTUwgb3IgYSBKU08sXG4gICAqIGRlcGVuZGluZyBvbiB0aGUgYmxvY2sncyBkZWZpbml0aW9uKS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBnZXQgdGhlIGV4dHJhIHN0YXRlIG9mLlxuICAgKiBAcmV0dXJucyBBIHN0cmluZ2lmaWVkIHZlcnNpb24gb2YgdGhlIGV4dHJhIHN0YXRlIG9mIHRoZSBnaXZlbiBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZ2V0RXh0cmFCbG9ja1N0YXRlXyhibG9jazogQmxvY2tTdmcpOiBzdHJpbmcge1xuICAgIGlmIChibG9jay5zYXZlRXh0cmFTdGF0ZSkge1xuICAgICAgY29uc3Qgc3RhdGUgPSBibG9jay5zYXZlRXh0cmFTdGF0ZSgpO1xuICAgICAgcmV0dXJuIHN0YXRlID8gSlNPTi5zdHJpbmdpZnkoc3RhdGUpIDogJyc7XG4gICAgfSBlbHNlIGlmIChibG9jay5tdXRhdGlvblRvRG9tKSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IGJsb2NrLm11dGF0aW9uVG9Eb20oKTtcbiAgICAgIHJldHVybiBzdGF0ZSA/IFhtbC5kb21Ub1RleHQoc3RhdGUpIDogJyc7XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJsb2NrQ2hhbmdlSnNvbiBleHRlbmRzIEJsb2NrQmFzZUpzb24ge1xuICBlbGVtZW50OiBzdHJpbmc7XG4gIG5hbWU/OiBzdHJpbmc7XG4gIG5ld1ZhbHVlOiB1bmtub3duO1xuICBvbGRWYWx1ZTogdW5rbm93bjtcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5DSEFOR0UsIEJsb2NrQ2hhbmdlKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgaW4gY2hhcmdlIG9mIG1hbmFnaW5nIG1hcmtlcnMgYW5kIHRoZSBjdXJzb3IuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuTWFya2VyTWFuYWdlcicpO1xuXG5pbXBvcnQgdHlwZSB7Q3Vyc29yfSBmcm9tICcuL2tleWJvYXJkX25hdi9jdXJzb3IuanMnO1xuaW1wb3J0IHR5cGUge01hcmtlcn0gZnJvbSAnLi9rZXlib2FyZF9uYXYvbWFya2VyLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyB0byBtYW5hZ2UgdGhlIG11bHRpcGxlIG1hcmtlcnMgYW5kIHRoZSBjdXJzb3Igb24gYSB3b3Jrc3BhY2UuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuTWFya2VyTWFuYWdlclxuICovXG5leHBvcnQgY2xhc3MgTWFya2VyTWFuYWdlciB7XG4gIC8qKiBUaGUgbmFtZSBvZiB0aGUgbG9jYWwgbWFya2VyLiAqL1xuICBzdGF0aWMgcmVhZG9ubHkgTE9DQUxfTUFSS0VSID0gJ2xvY2FsX21hcmtlcl8xJztcblxuICAvKiogVGhlIGN1cnNvci4gKi9cbiAgcHJpdmF0ZSBjdXJzb3JfOiBDdXJzb3J8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBjdXJzb3IncyBTVkcgZWxlbWVudC4gKi9cbiAgcHJpdmF0ZSBjdXJzb3JTdmdfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgbWFwIG9mIG1hcmtlcnMgZm9yIHRoZSB3b3Jrc3BhY2UuICovXG4gIHByaXZhdGUgbWFya2VycyA9IG5ldyBNYXA8c3RyaW5nLCBNYXJrZXI+KCk7XG5cbiAgLyoqIFRoZSBtYXJrZXIncyBTVkcgZWxlbWVudC4gKi9cbiAgcHJpdmF0ZSBtYXJrZXJTdmdfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgZm9yIHRoZSBtYXJrZXIgbWFuYWdlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKSB7fVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciB0aGUgbWFya2VyIGJ5IGFkZGluZyBpdCB0byB0aGUgbWFwIG9mIG1hcmtlcnMuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBBIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgbWFya2VyLlxuICAgKiBAcGFyYW0gbWFya2VyIFRoZSBtYXJrZXIgdG8gcmVnaXN0ZXIuXG4gICAqL1xuICByZWdpc3Rlck1hcmtlcihpZDogc3RyaW5nLCBtYXJrZXI6IE1hcmtlcikge1xuICAgIGlmICh0aGlzLm1hcmtlcnMuaGFzKGlkKSkge1xuICAgICAgdGhpcy51bnJlZ2lzdGVyTWFya2VyKGlkKTtcbiAgICB9XG4gICAgbWFya2VyLnNldERyYXdlcihcbiAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0UmVuZGVyZXIoKS5tYWtlTWFya2VyRHJhd2VyKHRoaXMud29ya3NwYWNlLCBtYXJrZXIpKTtcbiAgICB0aGlzLnNldE1hcmtlclN2ZyhtYXJrZXIuZ2V0RHJhd2VyKCkuY3JlYXRlRG9tKCkpO1xuICAgIHRoaXMubWFya2Vycy5zZXQoaWQsIG1hcmtlcik7XG4gIH1cblxuICAvKipcbiAgICogVW5yZWdpc3RlciB0aGUgbWFya2VyIGJ5IHJlbW92aW5nIGl0IGZyb20gdGhlIG1hcCBvZiBtYXJrZXJzLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgVGhlIElEIG9mIHRoZSBtYXJrZXIgdG8gdW5yZWdpc3Rlci5cbiAgICovXG4gIHVucmVnaXN0ZXJNYXJrZXIoaWQ6IHN0cmluZykge1xuICAgIGNvbnN0IG1hcmtlciA9IHRoaXMubWFya2Vycy5nZXQoaWQpO1xuICAgIGlmIChtYXJrZXIpIHtcbiAgICAgIG1hcmtlci5kaXNwb3NlKCk7XG4gICAgICB0aGlzLm1hcmtlcnMuZGVsZXRlKGlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgJ01hcmtlciB3aXRoIElEICcgKyBpZCArICcgZG9lcyBub3QgZXhpc3QuICcgK1xuICAgICAgICAgICdDYW4gb25seSB1bnJlZ2lzdGVyIG1hcmtlcnMgdGhhdCBleGlzdC4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJzb3IgZm9yIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjdXJzb3IgZm9yIHRoaXMgd29ya3NwYWNlLlxuICAgKi9cbiAgZ2V0Q3Vyc29yKCk6IEN1cnNvcnxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jdXJzb3JfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHNpbmdsZSBtYXJrZXIgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgZ2l2ZW4gSUQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBBIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgbWFya2VyLlxuICAgKiBAcmV0dXJucyBUaGUgbWFya2VyIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIGdpdmVuIElELCBvciBudWxsIGlmIG5vbmVcbiAgICogICAgIGV4aXN0cy5cbiAgICovXG4gIGdldE1hcmtlcihpZDogc3RyaW5nKTogTWFya2VyfG51bGwge1xuICAgIHJldHVybiB0aGlzLm1hcmtlcnMuZ2V0KGlkKSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGN1cnNvciBhbmQgaW5pdGlhbGl6ZXMgdGhlIGRyYXdlciBmb3IgdXNlIHdpdGgga2V5Ym9hcmRcbiAgICogbmF2aWdhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGN1cnNvciBUaGUgY3Vyc29yIHVzZWQgdG8gbW92ZSBhcm91bmQgdGhpcyB3b3Jrc3BhY2UuXG4gICAqL1xuICBzZXRDdXJzb3IoY3Vyc29yOiBDdXJzb3IpIHtcbiAgICBpZiAodGhpcy5jdXJzb3JfICYmIHRoaXMuY3Vyc29yXy5nZXREcmF3ZXIoKSkge1xuICAgICAgdGhpcy5jdXJzb3JfLmdldERyYXdlcigpLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgdGhpcy5jdXJzb3JfID0gY3Vyc29yO1xuICAgIGlmICh0aGlzLmN1cnNvcl8pIHtcbiAgICAgIGNvbnN0IGRyYXdlciA9IHRoaXMud29ya3NwYWNlLmdldFJlbmRlcmVyKCkubWFrZU1hcmtlckRyYXdlcihcbiAgICAgICAgICB0aGlzLndvcmtzcGFjZSwgdGhpcy5jdXJzb3JfKTtcbiAgICAgIHRoaXMuY3Vyc29yXy5zZXREcmF3ZXIoZHJhd2VyKTtcbiAgICAgIHRoaXMuc2V0Q3Vyc29yU3ZnKHRoaXMuY3Vyc29yXy5nZXREcmF3ZXIoKS5jcmVhdGVEb20oKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCB0aGUgY3Vyc29yIFNWRyB0byB0aGlzIHdvcmtzcGFjZSBTVkcgZ3JvdXAuXG4gICAqXG4gICAqIEBwYXJhbSBjdXJzb3JTdmcgVGhlIFNWRyByb290IG9mIHRoZSBjdXJzb3IgdG8gYmUgYWRkZWQgdG8gdGhlIHdvcmtzcGFjZVxuICAgKiAgICAgU1ZHIGdyb3VwLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldEN1cnNvclN2ZyhjdXJzb3JTdmc6IFNWR0VsZW1lbnR8bnVsbCkge1xuICAgIGlmICghY3Vyc29yU3ZnKSB7XG4gICAgICB0aGlzLmN1cnNvclN2Z18gPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMud29ya3NwYWNlLmdldEJsb2NrQ2FudmFzKCkhLmFwcGVuZENoaWxkKGN1cnNvclN2Zyk7XG4gICAgdGhpcy5jdXJzb3JTdmdfID0gY3Vyc29yU3ZnO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCB0aGUgbWFya2VyIFNWRyB0byB0aGlzIHdvcmtzcGFjZXMgU1ZHIGdyb3VwLlxuICAgKlxuICAgKiBAcGFyYW0gbWFya2VyU3ZnIFRoZSBTVkcgcm9vdCBvZiB0aGUgbWFya2VyIHRvIGJlIGFkZGVkIHRvIHRoZSB3b3Jrc3BhY2VcbiAgICogICAgIFNWRyBncm91cC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRNYXJrZXJTdmcobWFya2VyU3ZnOiBTVkdFbGVtZW50fG51bGwpIHtcbiAgICBpZiAoIW1hcmtlclN2Zykge1xuICAgICAgdGhpcy5tYXJrZXJTdmdfID0gbnVsbDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tDYW52YXMoKSkge1xuICAgICAgaWYgKHRoaXMuY3Vyc29yU3ZnXykge1xuICAgICAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0NhbnZhcygpIS5pbnNlcnRCZWZvcmUoXG4gICAgICAgICAgICBtYXJrZXJTdmcsIHRoaXMuY3Vyc29yU3ZnXyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0NhbnZhcygpIS5hcHBlbmRDaGlsZChtYXJrZXJTdmcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWRyYXcgdGhlIGF0dGFjaGVkIGN1cnNvciBTVkcgaWYgbmVlZGVkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZU1hcmtlcnMoKSB7XG4gICAgaWYgKHRoaXMud29ya3NwYWNlLmtleWJvYXJkQWNjZXNzaWJpbGl0eU1vZGUgJiYgdGhpcy5jdXJzb3JTdmdfKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZS5nZXRDdXJzb3IoKSEuZHJhdygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIHRoZSBtYXJrZXIgbWFuYWdlci5cbiAgICogR28gdGhyb3VnaCBhbmQgZGVsZXRlIGFsbCBtYXJrZXJzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIG1hcmtlciBtYW5hZ2VyLlxuICAgKlxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBjb25zdCBtYXJrZXJJZHMgPSBPYmplY3Qua2V5cyh0aGlzLm1hcmtlcnMpO1xuICAgIGZvciAobGV0IGkgPSAwLCBtYXJrZXJJZDsgbWFya2VySWQgPSBtYXJrZXJJZHNbaV07IGkrKykge1xuICAgICAgdGhpcy51bnJlZ2lzdGVyTWFya2VyKG1hcmtlcklkKTtcbiAgICB9XG4gICAgdGhpcy5tYXJrZXJzLmNsZWFyKCk7XG4gICAgaWYgKHRoaXMuY3Vyc29yXykge1xuICAgICAgdGhpcy5jdXJzb3JfLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuY3Vyc29yXyA9IG51bGw7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQSB0eXBlIHVzZWQgdG8gY3JlYXRlIGZsYWcgdmFsdWVzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnV0aWxzLlNlbnRpbmVsJyk7XG5cblxuLyoqXG4gKiBBIHR5cGUgdXNlZCB0byBjcmVhdGUgZmxhZyB2YWx1ZXMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudXRpbHMuU2VudGluZWxcbiAqL1xuZXhwb3J0IGNsYXNzIFNlbnRpbmVsIHt9XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogRmllbGQuICBVc2VkIGZvciBlZGl0YWJsZSB0aXRsZXMsIHZhcmlhYmxlcywgZXRjLlxuICogVGhpcyBpcyBhbiBhYnN0cmFjdCBjbGFzcyB0aGF0IGRlZmluZXMgdGhlIFVJIG9uIHRoZSBibG9jay4gIEFjdHVhbFxuICogaW5zdGFuY2VzIHdvdWxkIGJlIEZpZWxkVGV4dElucHV0LCBGaWVsZERyb3Bkb3duLCBldGMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRmllbGQnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfYmxvY2tfY2hhbmdlLmpzJztcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCAqIGFzIGRyb3BEb3duRGl2IGZyb20gJy4vZHJvcGRvd25kaXYuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7SW5wdXR9IGZyb20gJy4vaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0lBU1ROb2RlTG9jYXRpb25Tdmd9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2FzdF9ub2RlX2xvY2F0aW9uX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7SUFTVE5vZGVMb2NhdGlvbldpdGhCbG9ja30gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYXN0X25vZGVfbG9jYXRpb25fd2l0aF9ibG9jay5qcyc7XG5pbXBvcnQgdHlwZSB7SUtleWJvYXJkQWNjZXNzaWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfa2V5Ym9hcmRfYWNjZXNzaWJsZS5qcyc7XG5pbXBvcnQgdHlwZSB7SVJlZ2lzdHJhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9yZWdpc3RyYWJsZS5qcyc7XG5pbXBvcnQge01hcmtlck1hbmFnZXJ9IGZyb20gJy4vbWFya2VyX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vcmVuZGVyZXJzL2NvbW1vbi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHR5cGUge0tleWJvYXJkU2hvcnRjdXR9IGZyb20gJy4vc2hvcnRjdXRfcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgVG9vbHRpcCBmcm9tICcuL3Rvb2x0aXAuanMnO1xuaW1wb3J0IHR5cGUge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0ICogYXMgcGFyc2luZyBmcm9tICcuL3V0aWxzL3BhcnNpbmcuanMnO1xuaW1wb3J0IHtSZWN0fSBmcm9tICcuL3V0aWxzL3JlY3QuanMnO1xuaW1wb3J0IHtTZW50aW5lbH0gZnJvbSAnLi91dGlscy9zZW50aW5lbC5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vdXRpbHMvc2l6ZS5qcyc7XG5pbXBvcnQgKiBhcyBzdHlsZSBmcm9tICcuL3V0aWxzL3N0eWxlLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyB1c2VyQWdlbnQgZnJvbSAnLi91dGlscy91c2VyYWdlbnQuanMnO1xuaW1wb3J0ICogYXMgdXRpbHNYbWwgZnJvbSAnLi91dGlscy94bWwuanMnO1xuaW1wb3J0ICogYXMgV2lkZ2V0RGl2IGZyb20gJy4vd2lkZ2V0ZGl2LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBYbWwgZnJvbSAnLi94bWwuanMnO1xuXG5leHBvcnQgdHlwZSBGaWVsZFZhbGlkYXRvcjxUID0gYW55PiA9ICh2YWx1ZT86IFQpID0+IFR8bnVsbHx1bmRlZmluZWQ7XG5cbi8qKlxuICogQWJzdHJhY3QgY2xhc3MgZm9yIGFuIGVkaXRhYmxlIGZpZWxkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkZpZWxkXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBGaWVsZDxUID0gYW55PiBpbXBsZW1lbnRzIElBU1ROb2RlTG9jYXRpb25TdmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJQVNUTm9kZUxvY2F0aW9uV2l0aEJsb2NrLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSUtleWJvYXJkQWNjZXNzaWJsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElSZWdpc3RyYWJsZSB7XG4gIC8qKlxuICAgKiBUbyBvdmVyd3JpdGUgdGhlIGRlZmF1bHQgdmFsdWUgd2hpY2ggaXMgc2V0IGluICoqRmllbGQqKiwgZGlyZWN0bHkgdXBkYXRlXG4gICAqIHRoZSBwcm90b3R5cGUuXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogRmllbGRJbWFnZS5wcm90b3R5cGUuREVGQVVMVF9WQUxVRSA9IG51bGw7XG4gICAqIGBgYFxuICAgKi9cbiAgREVGQVVMVF9WQUxVRTogVHxudWxsID0gbnVsbDtcblxuICAvKiogTm9uLWJyZWFraW5nIHNwYWNlLiAqL1xuICBzdGF0aWMgcmVhZG9ubHkgTkJTUCA9ICdcXHUwMEEwJztcblxuICAvKipcbiAgICogQSB2YWx1ZSB1c2VkIHRvIHNpZ25hbCB3aGVuIGEgZmllbGQncyBjb25zdHJ1Y3RvciBzaG91bGQgKm5vdCogc2V0IHRoZVxuICAgKiBmaWVsZCdzIHZhbHVlIG9yIHJ1biBjb25maWd1cmVfLCBhbmQgc2hvdWxkIGFsbG93IGEgc3ViY2xhc3MgdG8gZG8gdGhhdFxuICAgKiBpbnN0ZWFkLlxuICAgKi9cbiAgc3RhdGljIHJlYWRvbmx5IFNLSVBfU0VUVVAgPSBuZXcgU2VudGluZWwoKTtcblxuICAvKipcbiAgICogTmFtZSBvZiBmaWVsZC4gIFVuaXF1ZSB3aXRoaW4gZWFjaCBibG9jay5cbiAgICogU3RhdGljIGxhYmVscyBhcmUgdXN1YWxseSB1bm5hbWVkLlxuICAgKi9cbiAgbmFtZT86IHN0cmluZyA9IHVuZGVmaW5lZDtcbiAgcHJvdGVjdGVkIHZhbHVlXzogVHxudWxsO1xuXG4gIC8qKiBWYWxpZGF0aW9uIGZ1bmN0aW9uIGNhbGxlZCB3aGVuIHVzZXIgZWRpdHMgYW4gZWRpdGFibGUgZmllbGQuICovXG4gIHByb3RlY3RlZCB2YWxpZGF0b3JfOiBGaWVsZFZhbGlkYXRvcjxUPnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogVXNlZCB0byBjYWNoZSB0aGUgZmllbGQncyB0b29sdGlwIHZhbHVlIGlmIHNldFRvb2x0aXAgaXMgY2FsbGVkIHdoZW4gdGhlXG4gICAqIGZpZWxkIGlzIG5vdCB5ZXQgaW5pdGlhbGl6ZWQuIElzICpub3QqIGd1YXJhbnRlZWQgdG8gYmUgYWNjdXJhdGUuXG4gICAqL1xuICBwcml2YXRlIHRvb2x0aXBfOiBUb29sdGlwLlRpcEluZm98bnVsbCA9IG51bGw7XG4gIHByb3RlY3RlZCBzaXplXzogU2l6ZTtcblxuICAvKipcbiAgICogSG9sZHMgdGhlIGN1cnNvcnMgc3ZnIGVsZW1lbnQgd2hlbiB0aGUgY3Vyc29yIGlzIGF0dGFjaGVkIHRvIHRoZSBmaWVsZC5cbiAgICogVGhpcyBpcyBudWxsIGlmIHRoZXJlIGlzIG5vIGN1cnNvciBvbiB0aGUgZmllbGQuXG4gICAqL1xuICBwcml2YXRlIGN1cnNvclN2Z186IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEhvbGRzIHRoZSBtYXJrZXJzIHN2ZyBlbGVtZW50IHdoZW4gdGhlIG1hcmtlciBpcyBhdHRhY2hlZCB0byB0aGUgZmllbGQuXG4gICAqIFRoaXMgaXMgbnVsbCBpZiB0aGVyZSBpcyBubyBtYXJrZXIgb24gdGhlIGZpZWxkLlxuICAgKi9cbiAgcHJpdmF0ZSBtYXJrZXJTdmdfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgcmVuZGVyZWQgZmllbGQncyBTVkcgZ3JvdXAgZWxlbWVudC4gKi9cbiAgcHJvdGVjdGVkIGZpZWxkR3JvdXBfOiBTVkdHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIHJlbmRlcmVkIGZpZWxkJ3MgU1ZHIGJvcmRlciBlbGVtZW50LiAqL1xuICBwcm90ZWN0ZWQgYm9yZGVyUmVjdF86IFNWR1JlY3RFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgcmVuZGVyZWQgZmllbGQncyBTVkcgdGV4dCBlbGVtZW50LiAqL1xuICBwcm90ZWN0ZWQgdGV4dEVsZW1lbnRfOiBTVkdUZXh0RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIHJlbmRlcmVkIGZpZWxkJ3MgdGV4dCBjb250ZW50IGVsZW1lbnQuICovXG4gIHByb3RlY3RlZCB0ZXh0Q29udGVudF86IFRleHR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIE1vdXNlIGRvd24gZXZlbnQgbGlzdGVuZXIgZGF0YS4gKi9cbiAgcHJpdmF0ZSBtb3VzZURvd25XcmFwcGVyXzogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKiBDb25zdGFudHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzb3VyY2UgYmxvY2sncyByZW5kZXJlci4gKi9cbiAgcHJvdGVjdGVkIGNvbnN0YW50c186IENvbnN0YW50UHJvdmlkZXJ8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEhhcyB0aGlzIGZpZWxkIGJlZW4gZGlzcG9zZWQgb2Y/XG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZWQgPSBmYWxzZTtcblxuICAvKiogTWF4aW11bSBjaGFyYWN0ZXJzIG9mIHRleHQgdG8gZGlzcGxheSBiZWZvcmUgYWRkaW5nIGFuIGVsbGlwc2lzLiAqL1xuICBtYXhEaXNwbGF5TGVuZ3RoID0gNTA7XG5cbiAgLyoqIEJsb2NrIHRoaXMgZmllbGQgaXMgYXR0YWNoZWQgdG8uICBTdGFydHMgYXMgbnVsbCwgdGhlbiBzZXQgaW4gaW5pdC4gKi9cbiAgcHJvdGVjdGVkIHNvdXJjZUJsb2NrXzogQmxvY2t8bnVsbCA9IG51bGw7XG5cbiAgLyoqIERvZXMgdGhpcyBibG9jayBuZWVkIHRvIGJlIHJlLXJlbmRlcmVkPyAqL1xuICBwcm90ZWN0ZWQgaXNEaXJ0eV8gPSB0cnVlO1xuXG4gIC8qKiBJcyB0aGUgZmllbGQgdmlzaWJsZSwgb3IgaGlkZGVuIGR1ZSB0byB0aGUgYmxvY2sgYmVpbmcgY29sbGFwc2VkPyAqL1xuICBwcm90ZWN0ZWQgdmlzaWJsZV8gPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBDYW4gdGhlIGZpZWxkIHZhbHVlIGJlIGNoYW5nZWQgdXNpbmcgdGhlIGVkaXRvciBvbiBhbiBlZGl0YWJsZSBibG9jaz9cbiAgICovXG4gIHByb3RlY3RlZCBlbmFibGVkXyA9IHRydWU7XG5cbiAgLyoqIFRoZSBlbGVtZW50IHRoZSBjbGljayBoYW5kbGVyIGlzIGJvdW5kIHRvLiAqL1xuICBwcm90ZWN0ZWQgY2xpY2tUYXJnZXRfOiBFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgcHJlZml4IGZpZWxkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHByZWZpeEZpZWxkOiBzdHJpbmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBzdWZmaXggZmllbGQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3VmZml4RmllbGQ6IHN0cmluZ3xudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogRWRpdGFibGUgZmllbGRzIHVzdWFsbHkgc2hvdyBzb21lIHNvcnQgb2YgVUkgaW5kaWNhdGluZyB0aGV5IGFyZVxuICAgKiBlZGl0YWJsZS4gVGhleSB3aWxsIGFsc28gYmUgc2F2ZWQgYnkgdGhlIHNlcmlhbGl6ZXIuXG4gICAqL1xuICBFRElUQUJMRSA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6YWJsZSBmaWVsZHMgYXJlIHNhdmVkIGJ5IHRoZSBzZXJpYWxpemVyLCBub24tc2VyaWFsaXphYmxlIGZpZWxkc1xuICAgKiBhcmUgbm90LiBFZGl0YWJsZSBmaWVsZHMgc2hvdWxkIGFsc28gYmUgc2VyaWFsaXphYmxlLiBUaGlzIGlzIG5vdCB0aGVcbiAgICogY2FzZSBieSBkZWZhdWx0IHNvIHRoYXQgU0VSSUFMSVpBQkxFIGlzIGJhY2t3YXJkcyBjb21wYXRpYmxlLlxuICAgKi9cbiAgU0VSSUFMSVpBQkxFID0gZmFsc2U7XG5cbiAgLyoqIE1vdXNlIGN1cnNvciBzdHlsZSB3aGVuIG92ZXIgdGhlIGhvdHNwb3QgdGhhdCBpbml0aWF0ZXMgdGhlIGVkaXRvci4gKi9cbiAgQ1VSU09SID0gJyc7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgZmllbGQuXG4gICAqICAgICBBbHNvIGFjY2VwdHMgRmllbGQuU0tJUF9TRVRVUCBpZiB5b3Ugd2lzaCB0byBza2lwIHNldHVwIChvbmx5IHVzZWQgYnlcbiAgICogc3ViY2xhc3NlcyB0aGF0IHdhbnQgdG8gaGFuZGxlIGNvbmZpZ3VyYXRpb24gYW5kIHNldHRpbmcgdGhlIGZpZWxkIHZhbHVlXG4gICAqIGFmdGVyIHRoZWlyIG93biBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4pLlxuICAgKiBAcGFyYW0gb3B0X3ZhbGlkYXRvciAgQSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB0byB2YWxpZGF0ZSBjaGFuZ2VzIHRvIHRoZVxuICAgKiAgICAgZmllbGQncyB2YWx1ZS4gVGFrZXMgaW4gYSB2YWx1ZSAmIHJldHVybnMgYSB2YWxpZGF0ZWQgdmFsdWUsIG9yIG51bGwgdG9cbiAgICogICAgIGFib3J0IHRoZSBjaGFuZ2UuXG4gICAqIEBwYXJhbSBvcHRfY29uZmlnIEEgbWFwIG9mIG9wdGlvbnMgdXNlZCB0byBjb25maWd1cmUgdGhlIGZpZWxkLlxuICAgKiAgICBSZWZlciB0byB0aGUgaW5kaXZpZHVhbCBmaWVsZCdzIGRvY3VtZW50YXRpb24gZm9yIGEgbGlzdCBvZiBwcm9wZXJ0aWVzXG4gICAqIHRoaXMgcGFyYW1ldGVyIHN1cHBvcnRzLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICB2YWx1ZTogVHxTZW50aW5lbCwgb3B0X3ZhbGlkYXRvcj86IEZpZWxkVmFsaWRhdG9yPFQ+fG51bGwsXG4gICAgICBvcHRfY29uZmlnPzogRmllbGRDb25maWcpIHtcbiAgICAvKipcbiAgICAgKiBBIGdlbmVyaWMgdmFsdWUgcG9zc2Vzc2VkIGJ5IHRoZSBmaWVsZC5cbiAgICAgKiBTaG91bGQgZ2VuZXJhbGx5IGJlIG5vbi1udWxsLCBvbmx5IG51bGwgd2hlbiB0aGUgZmllbGQgaXMgY3JlYXRlZC5cbiAgICAgKi9cbiAgICB0aGlzLnZhbHVlXyA9ICdERUZBVUxUX1ZBTFVFJyBpbiBuZXcudGFyZ2V0LnByb3RvdHlwZSA/XG4gICAgICAgIG5ldy50YXJnZXQucHJvdG90eXBlLkRFRkFVTFRfVkFMVUUgOlxuICAgICAgICB0aGlzLkRFRkFVTFRfVkFMVUU7XG5cbiAgICAvKiogVGhlIHNpemUgb2YgdGhlIGFyZWEgcmVuZGVyZWQgYnkgdGhlIGZpZWxkLiAqL1xuICAgIHRoaXMuc2l6ZV8gPSBuZXcgU2l6ZSgwLCAwKTtcblxuICAgIGlmICh2YWx1ZSA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKHZhbHVlKTtcbiAgICBpZiAob3B0X3ZhbGlkYXRvcikge1xuICAgICAgdGhpcy5zZXRWYWxpZGF0b3Iob3B0X3ZhbGlkYXRvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgdGhlIGNvbmZpZ3VyYXRpb24gbWFwIHBhc3NlZCB0byB0aGUgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBjb25maWcgQSBtYXAgb2Ygb3B0aW9ucyB1c2VkIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQuIFNlZSB0aGVcbiAgICogICAgIGluZGl2aWR1YWwgZmllbGQncyBkb2N1bWVudGF0aW9uIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzXG4gICAqICAgICBwYXJhbWV0ZXIgc3VwcG9ydHMuXG4gICAqL1xuICBwcm90ZWN0ZWQgY29uZmlndXJlXyhjb25maWc6IEZpZWxkQ29uZmlnKSB7XG4gICAgLy8gVE9ETyAoIzI4ODQpOiBQb3NzaWJseSBhZGQgQ1NTIGNsYXNzIGNvbmZpZyBvcHRpb24uXG4gICAgLy8gVE9ETyAoIzI4ODUpOiBQb3NzaWJseSBhZGQgY3Vyc29yIGNvbmZpZyBvcHRpb24uXG4gICAgaWYgKGNvbmZpZy50b29sdGlwKSB7XG4gICAgICB0aGlzLnNldFRvb2x0aXAocGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMoY29uZmlnLnRvb2x0aXApKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXR0YWNoIHRoaXMgZmllbGQgdG8gYSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBjb250YWluaW5nIHRoaXMgZmllbGQuXG4gICAqL1xuICBzZXRTb3VyY2VCbG9jayhibG9jazogQmxvY2spIHtcbiAgICBpZiAodGhpcy5zb3VyY2VCbG9ja18pIHtcbiAgICAgIHRocm93IEVycm9yKCdGaWVsZCBhbHJlYWR5IGJvdW5kIHRvIGEgYmxvY2snKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2VCbG9ja18gPSBibG9jaztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJlbmRlcmVyIGNvbnN0YW50IHByb3ZpZGVyLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcmVuZGVyZXIgY29uc3RhbnQgcHJvdmlkZXIuXG4gICAqL1xuICBnZXRDb25zdGFudHMoKTogQ29uc3RhbnRQcm92aWRlcnxudWxsIHtcbiAgICBpZiAoIXRoaXMuY29uc3RhbnRzXyAmJiB0aGlzLnNvdXJjZUJsb2NrXyAmJlxuICAgICAgICAhdGhpcy5zb3VyY2VCbG9ja18uaXNEZWFkT3JEeWluZygpICYmXG4gICAgICAgIHRoaXMuc291cmNlQmxvY2tfLndvcmtzcGFjZS5yZW5kZXJlZCkge1xuICAgICAgdGhpcy5jb25zdGFudHNfID0gKHRoaXMuc291cmNlQmxvY2tfLndvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldFJlbmRlcmVyKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29uc3RhbnRzKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbnN0YW50c187XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBibG9jayB0aGlzIGZpZWxkIGlzIGF0dGFjaGVkIHRvLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYmxvY2sgY29udGFpbmluZyB0aGlzIGZpZWxkLlxuICAgKiBAdGhyb3dzIEFuIGVycm9yIGlmIHRoZSBzb3VyY2UgYmxvY2sgaXMgbm90IGRlZmluZWQuXG4gICAqL1xuICBnZXRTb3VyY2VCbG9jaygpOiBCbG9ja3xudWxsIHtcbiAgICByZXR1cm4gdGhpcy5zb3VyY2VCbG9ja187XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBldmVyeXRoaW5nIHRvIHJlbmRlciB0aGlzIGZpZWxkLiBPdmVycmlkZVxuICAgKiBtZXRob2RzIGluaXRNb2RlbCBhbmQgaW5pdFZpZXcgcmF0aGVyIHRoYW4gdGhpcyBtZXRob2QuXG4gICAqXG4gICAqIEBzZWFsZWRcbiAgICogQGludGVybmFsXG4gICAqL1xuICBpbml0KCkge1xuICAgIGlmICh0aGlzLmZpZWxkR3JvdXBfKSB7XG4gICAgICAvLyBGaWVsZCBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpemVkIG9uY2UuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZmllbGRHcm91cF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuRywge30pO1xuICAgIGlmICghdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgdGhpcy5maWVsZEdyb3VwXy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cbiAgICBjb25zdCBzb3VyY2VCbG9ja1N2ZyA9IHRoaXMuc291cmNlQmxvY2tfIGFzIEJsb2NrU3ZnO1xuICAgIHNvdXJjZUJsb2NrU3ZnLmdldFN2Z1Jvb3QoKS5hcHBlbmRDaGlsZCh0aGlzLmZpZWxkR3JvdXBfKTtcbiAgICB0aGlzLmluaXRWaWV3KCk7XG4gICAgdGhpcy51cGRhdGVFZGl0YWJsZSgpO1xuICAgIHRoaXMuc2V0VG9vbHRpcCh0aGlzLnRvb2x0aXBfKTtcbiAgICB0aGlzLmJpbmRFdmVudHNfKCk7XG4gICAgdGhpcy5pbml0TW9kZWwoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIGJsb2NrIFVJIGZvciB0aGlzIGZpZWxkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGluaXRWaWV3KCkge1xuICAgIHRoaXMuY3JlYXRlQm9yZGVyUmVjdF8oKTtcbiAgICB0aGlzLmNyZWF0ZVRleHRFbGVtZW50XygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemVzIHRoZSBtb2RlbCBvZiB0aGUgZmllbGQgYWZ0ZXIgaXQgaGFzIGJlZW4gaW5zdGFsbGVkIG9uIGEgYmxvY2suXG4gICAqIE5vLW9wIGJ5IGRlZmF1bHQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaW5pdE1vZGVsKCkge31cblxuICAvKipcbiAgICogQ3JlYXRlIGEgZmllbGQgYm9yZGVyIHJlY3QgZWxlbWVudC4gTm90IHRvIGJlIG92ZXJyaWRkZW4gYnkgc3ViY2xhc3Nlcy5cbiAgICogSW5zdGVhZCBtb2RpZnkgdGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24gaW5zaWRlIGluaXRWaWV3LCBvciBjcmVhdGUgYVxuICAgKiBzZXBhcmF0ZSBmdW5jdGlvbiB0byBjYWxsLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZUJvcmRlclJlY3RfKCkge1xuICAgIHRoaXMuYm9yZGVyUmVjdF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlJFQ1QsIHtcbiAgICAgICAgICAncngnOiB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9CT1JERVJfUkVDVF9SQURJVVMsXG4gICAgICAgICAgJ3J5JzogdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfUkFESVVTLFxuICAgICAgICAgICd4JzogMCxcbiAgICAgICAgICAneSc6IDAsXG4gICAgICAgICAgJ2hlaWdodCc6IHRoaXMuc2l6ZV8uaGVpZ2h0LFxuICAgICAgICAgICd3aWR0aCc6IHRoaXMuc2l6ZV8ud2lkdGgsXG4gICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlGaWVsZFJlY3QnLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmZpZWxkR3JvdXBfKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBmaWVsZCB0ZXh0IGVsZW1lbnQuIE5vdCB0byBiZSBvdmVycmlkZGVuIGJ5IHN1YmNsYXNzZXMuIEluc3RlYWRcbiAgICogbW9kaWZ5IHRoZSByZXN1bHQgb2YgdGhlIGZ1bmN0aW9uIGluc2lkZSBpbml0Vmlldywgb3IgY3JlYXRlIGEgc2VwYXJhdGVcbiAgICogZnVuY3Rpb24gdG8gY2FsbC5cbiAgICovXG4gIHByb3RlY3RlZCBjcmVhdGVUZXh0RWxlbWVudF8oKSB7XG4gICAgdGhpcy50ZXh0RWxlbWVudF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlRFWFQsIHtcbiAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseVRleHQnLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmZpZWxkR3JvdXBfKTtcbiAgICBpZiAodGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9CQVNFTElORV9DRU5URVIpIHtcbiAgICAgIHRoaXMudGV4dEVsZW1lbnRfLnNldEF0dHJpYnV0ZSgnZG9taW5hbnQtYmFzZWxpbmUnLCAnY2VudHJhbCcpO1xuICAgIH1cbiAgICB0aGlzLnRleHRDb250ZW50XyA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTtcbiAgICB0aGlzLnRleHRFbGVtZW50Xy5hcHBlbmRDaGlsZCh0aGlzLnRleHRDb250ZW50Xyk7XG4gIH1cblxuICAvKipcbiAgICogQmluZCBldmVudHMgdG8gdGhlIGZpZWxkLiBDYW4gYmUgb3ZlcnJpZGRlbiBieSBzdWJjbGFzc2VzIGlmIHRoZXkgbmVlZCB0b1xuICAgKiBkbyBjdXN0b20gaW5wdXQgaGFuZGxpbmcuXG4gICAqL1xuICBwcm90ZWN0ZWQgYmluZEV2ZW50c18oKSB7XG4gICAgY29uc3QgY2xpY2tUYXJnZXQgPSB0aGlzLmdldENsaWNrVGFyZ2V0XygpO1xuICAgIGlmICghY2xpY2tUYXJnZXQpIHRocm93IG5ldyBFcnJvcignQSBjbGljayB0YXJnZXQgaGFzIG5vdCBiZWVuIHNldC4nKTtcbiAgICBUb29sdGlwLmJpbmRNb3VzZUV2ZW50cyhjbGlja1RhcmdldCk7XG4gICAgdGhpcy5tb3VzZURvd25XcmFwcGVyXyA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBjbGlja1RhcmdldCwgJ3BvaW50ZXJkb3duJywgdGhpcywgdGhpcy5vbk1vdXNlRG93bl8pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZpZWxkJ3MgdmFsdWUgYmFzZWQgb24gdGhlIGdpdmVuIFhNTCBlbGVtZW50LiBTaG91bGQgb25seSBiZVxuICAgKiBjYWxsZWQgYnkgQmxvY2tseS5YbWwuXG4gICAqXG4gICAqIEBwYXJhbSBmaWVsZEVsZW1lbnQgVGhlIGVsZW1lbnQgY29udGFpbmluZyBpbmZvIGFib3V0IHRoZSBmaWVsZCdzIHN0YXRlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGZyb21YbWwoZmllbGRFbGVtZW50OiBFbGVtZW50KSB7XG4gICAgdGhpcy5zZXRWYWx1ZShmaWVsZEVsZW1lbnQudGV4dENvbnRlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6ZXMgdGhpcyBmaWVsZCdzIHZhbHVlIHRvIFhNTC4gU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGJ5IEJsb2NrbHkuWG1sLlxuICAgKlxuICAgKiBAcGFyYW0gZmllbGRFbGVtZW50IFRoZSBlbGVtZW50IHRvIHBvcHVsYXRlIHdpdGggaW5mbyBhYm91dCB0aGUgZmllbGQnc1xuICAgKiAgICAgc3RhdGUuXG4gICAqIEByZXR1cm5zIFRoZSBlbGVtZW50IGNvbnRhaW5pbmcgaW5mbyBhYm91dCB0aGUgZmllbGQncyBzdGF0ZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICB0b1htbChmaWVsZEVsZW1lbnQ6IEVsZW1lbnQpOiBFbGVtZW50IHtcbiAgICBmaWVsZEVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgcmV0dXJuIGZpZWxkRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlcyB0aGlzIGZpZWxkcyB2YWx1ZSBhcyBzb21ldGhpbmcgd2hpY2ggY2FuIGJlIHNlcmlhbGl6ZWQgdG8gSlNPTi5cbiAgICogU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBzZXJpYWxpemF0aW9uIHN5c3RlbS5cbiAgICpcbiAgICogQHBhcmFtIF9kb0Z1bGxTZXJpYWxpemF0aW9uIElmIHRydWUsIHRoaXMgc2lnbmFscyB0byB0aGUgZmllbGQgdGhhdCBpZiBpdFxuICAgKiAgICAgbm9ybWFsbHkganVzdCBzYXZlcyBhIHJlZmVyZW5jZSB0byBzb21lIHN0YXRlIChlZyB2YXJpYWJsZSBmaWVsZHMpIGl0XG4gICAqICAgICBzaG91bGQgaW5zdGVhZCBzZXJpYWxpemUgdGhlIGZ1bGwgc3RhdGUgb2YgdGhlIHRoaW5nIGJlaW5nIHJlZmVyZW5jZWQuXG4gICAqIEByZXR1cm5zIEpTT04gc2VyaWFsaXphYmxlIHN0YXRlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNhdmVTdGF0ZShfZG9GdWxsU2VyaWFsaXphdGlvbj86IGJvb2xlYW4pOiBBbnlEdXJpbmdNaWdyYXRpb24ge1xuICAgIGNvbnN0IGxlZ2FjeVN0YXRlID0gdGhpcy5zYXZlTGVnYWN5U3RhdGUoRmllbGQpO1xuICAgIGlmIChsZWdhY3lTdGF0ZSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGxlZ2FjeVN0YXRlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZpZWxkJ3Mgc3RhdGUgYmFzZWQgb24gdGhlIGdpdmVuIHN0YXRlIHZhbHVlLiBTaG91bGQgb25seSBiZVxuICAgKiBjYWxsZWQgYnkgdGhlIHNlcmlhbGl6YXRpb24gc3lzdGVtLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIHdlIHdhbnQgdG8gYXBwbHkgdG8gdGhlIGZpZWxkLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGxvYWRTdGF0ZShzdGF0ZTogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgaWYgKHRoaXMubG9hZExlZ2FjeVN0YXRlKEZpZWxkLCBzdGF0ZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXRWYWx1ZShzdGF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIHN0cmluZ2lmaWVkIHZlcnNpb24gb2YgdGhlIFhNTCBzdGF0ZSwgaWYgaXQgc2hvdWxkIGJlIHVzZWQuXG4gICAqIE90aGVyd2lzZSB0aGlzIHJldHVybnMgbnVsbCwgdG8gc2lnbmFsIHRoZSBmaWVsZCBzaG91bGQgdXNlIGl0cyBvd25cbiAgICogc2VyaWFsaXphdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGNhbGxpbmdDbGFzcyBUaGUgY2xhc3MgY2FsbGluZyB0aGlzIG1ldGhvZC5cbiAgICogICAgIFVzZWQgdG8gc2VlIGlmIGB0aGlzYCBoYXMgb3ZlcnJpZGRlbiBhbnkgcmVsZXZhbnQgaG9va3MuXG4gICAqIEByZXR1cm5zIFRoZSBzdHJpbmdpZmllZCB2ZXJzaW9uIG9mIHRoZSBYTUwgc3RhdGUsIG9yIG51bGwuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2F2ZUxlZ2FjeVN0YXRlKGNhbGxpbmdDbGFzczogRmllbGRQcm90byk6IHN0cmluZ3xudWxsIHtcbiAgICBpZiAoY2FsbGluZ0NsYXNzLnByb3RvdHlwZS5zYXZlU3RhdGUgPT09IHRoaXMuc2F2ZVN0YXRlICYmXG4gICAgICAgIGNhbGxpbmdDbGFzcy5wcm90b3R5cGUudG9YbWwgIT09IHRoaXMudG9YbWwpIHtcbiAgICAgIGNvbnN0IGVsZW0gPSB1dGlsc1htbC5jcmVhdGVFbGVtZW50KCdmaWVsZCcpO1xuICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ25hbWUnLCB0aGlzLm5hbWUgfHwgJycpO1xuICAgICAgY29uc3QgdGV4dCA9IFhtbC5kb21Ub1RleHQodGhpcy50b1htbChlbGVtKSk7XG4gICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKFxuICAgICAgICAgICcgeG1sbnM9XCJodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L3htbFwiJywgJycpO1xuICAgIH1cbiAgICAvLyBFaXRoZXIgdGhleSBjYWxsZWQgdGhpcyBvbiBwdXJwb3NlIGZyb20gdGhlaXIgc2F2ZVN0YXRlLCBvciB0aGV5IGhhdmVcbiAgICAvLyBubyBpbXBsZW1lbnRhdGlvbnMgb2YgZWl0aGVyIGhvb2suIEp1c3QgZG8gb3VyIHRoaW5nLlxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWRzIHRoZSBnaXZlbiBzdGF0ZSB1c2luZyBlaXRoZXIgdGhlIG9sZCBYTUwgaG9va3MsIGlmIHRoZXkgc2hvdWxkIGJlXG4gICAqIHVzZWQuIFJldHVybnMgdHJ1ZSB0byBpbmRpY2F0ZSBsb2FkaW5nIGhhcyBiZWVuIGhhbmRsZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICpcbiAgICogQHBhcmFtIGNhbGxpbmdDbGFzcyBUaGUgY2xhc3MgY2FsbGluZyB0aGlzIG1ldGhvZC5cbiAgICogICAgIFVzZWQgdG8gc2VlIGlmIGB0aGlzYCBoYXMgb3ZlcnJpZGRlbiBhbnkgcmVsZXZhbnQgaG9va3MuXG4gICAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgdG8gYXBwbHkgdG8gdGhlIGZpZWxkLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBzdGF0ZSB3YXMgYXBwbGllZCBvciBub3QuXG4gICAqL1xuICBsb2FkTGVnYWN5U3RhdGUoY2FsbGluZ0NsYXNzOiBGaWVsZFByb3RvLCBzdGF0ZTogQW55RHVyaW5nTWlncmF0aW9uKTpcbiAgICAgIGJvb2xlYW4ge1xuICAgIGlmIChjYWxsaW5nQ2xhc3MucHJvdG90eXBlLmxvYWRTdGF0ZSA9PT0gdGhpcy5sb2FkU3RhdGUgJiZcbiAgICAgICAgY2FsbGluZ0NsYXNzLnByb3RvdHlwZS5mcm9tWG1sICE9PSB0aGlzLmZyb21YbWwpIHtcbiAgICAgIHRoaXMuZnJvbVhtbChYbWwudGV4dFRvRG9tKHN0YXRlIGFzIHN0cmluZykpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIEVpdGhlciB0aGV5IGNhbGxlZCB0aGlzIG9uIHB1cnBvc2UgZnJvbSB0aGVpciBsb2FkU3RhdGUsIG9yIHRoZXkgaGF2ZVxuICAgIC8vIG5vIGltcGxlbWVudGF0aW9ucyBvZiBlaXRoZXIgaG9vay4gSnVzdCBkbyBvdXIgdGhpbmcuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2YgYWxsIERPTSBvYmplY3RzIGFuZCBldmVudHMgYmVsb25naW5nIHRvIHRoaXMgZWRpdGFibGUgZmllbGQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBkcm9wRG93bkRpdi5oaWRlSWZPd25lcih0aGlzKTtcbiAgICBXaWRnZXREaXYuaGlkZUlmT3duZXIodGhpcyk7XG4gICAgVG9vbHRpcC51bmJpbmRNb3VzZUV2ZW50cyh0aGlzLmdldENsaWNrVGFyZ2V0XygpKTtcblxuICAgIGlmICh0aGlzLm1vdXNlRG93bldyYXBwZXJfKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm1vdXNlRG93bldyYXBwZXJfKTtcbiAgICB9XG5cbiAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLmZpZWxkR3JvdXBfKTtcblxuICAgIHRoaXMuZGlzcG9zZWQgPSB0cnVlO1xuICB9XG5cbiAgLyoqIEFkZCBvciByZW1vdmUgdGhlIFVJIGluZGljYXRpbmcgaWYgdGhpcyBmaWVsZCBpcyBlZGl0YWJsZSBvciBub3QuICovXG4gIHVwZGF0ZUVkaXRhYmxlKCkge1xuICAgIGNvbnN0IGdyb3VwID0gdGhpcy5maWVsZEdyb3VwXztcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIXRoaXMuRURJVEFCTEUgfHwgIWdyb3VwIHx8ICFibG9jaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5lbmFibGVkXyAmJiBibG9jay5pc0VkaXRhYmxlKCkpIHtcbiAgICAgIGRvbS5hZGRDbGFzcyhncm91cCwgJ2Jsb2NrbHlFZGl0YWJsZVRleHQnKTtcbiAgICAgIGRvbS5yZW1vdmVDbGFzcyhncm91cCwgJ2Jsb2NrbHlOb25FZGl0YWJsZVRleHQnKTtcbiAgICAgIGdyb3VwLnN0eWxlLmN1cnNvciA9IHRoaXMuQ1VSU09SO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb20uYWRkQ2xhc3MoZ3JvdXAsICdibG9ja2x5Tm9uRWRpdGFibGVUZXh0Jyk7XG4gICAgICBkb20ucmVtb3ZlQ2xhc3MoZ3JvdXAsICdibG9ja2x5RWRpdGFibGVUZXh0Jyk7XG4gICAgICBncm91cC5zdHlsZS5jdXJzb3IgPSAnJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBmaWVsZCdzIHZhbHVlIGNhbiBiZSBjaGFuZ2VkIHVzaW5nIHRoZSBlZGl0b3Igd2hlbiB0aGVcbiAgICogICAgIHNvdXJjZSBibG9jayBpcyBlZGl0YWJsZS5cbiAgICpcbiAgICogQHBhcmFtIGVuYWJsZWQgVHJ1ZSBpZiBlbmFibGVkLlxuICAgKi9cbiAgc2V0RW5hYmxlZChlbmFibGVkOiBib29sZWFuKSB7XG4gICAgdGhpcy5lbmFibGVkXyA9IGVuYWJsZWQ7XG4gICAgdGhpcy51cGRhdGVFZGl0YWJsZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhpcyBmaWVsZCdzIHZhbHVlIGNhbiBiZSBjaGFuZ2VkIHVzaW5nIHRoZSBlZGl0b3Igd2hlbiB0aGVcbiAgICogICAgIHNvdXJjZSBibG9jayBpcyBlZGl0YWJsZS5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGlzIGZpZWxkIGlzIGVuYWJsZWQuXG4gICAqL1xuICBpc0VuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZW5hYmxlZF87XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgd2hldGhlciB0aGlzIGZpZWxkIGRlZmluZXMgdGhlIHNob3dFZGl0b3JfIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoaXMgZmllbGQgaXMgY2xpY2thYmxlLlxuICAgKi9cbiAgaXNDbGlja2FibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZW5hYmxlZF8gJiYgISF0aGlzLnNvdXJjZUJsb2NrXyAmJlxuICAgICAgICB0aGlzLnNvdXJjZUJsb2NrXy5pc0VkaXRhYmxlKCkgJiZcbiAgICAgICAgdGhpcy5zaG93RWRpdG9yXyAhPT0gRmllbGQucHJvdG90eXBlLnNob3dFZGl0b3JfO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhpcyBmaWVsZCBpcyBjdXJyZW50bHkgZWRpdGFibGUuICBTb21lIGZpZWxkcyBhcmUgbmV2ZXJcbiAgICogRURJVEFCTEUgKGUuZy4gdGV4dCBsYWJlbHMpLiBPdGhlciBmaWVsZHMgbWF5IGJlIEVESVRBQkxFIGJ1dCBtYXkgZXhpc3Qgb25cbiAgICogbm9uLWVkaXRhYmxlIGJsb2NrcyBvciBiZSBjdXJyZW50bHkgZGlzYWJsZWQuXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBmaWVsZCBpcyBjdXJyZW50bHkgZW5hYmxlZCwgZWRpdGFibGUgYW5kIG9uIGFuXG4gICAqICAgICBlZGl0YWJsZSBibG9jay5cbiAgICovXG4gIGlzQ3VycmVudGx5RWRpdGFibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZW5hYmxlZF8gJiYgdGhpcy5FRElUQUJMRSAmJiAhIXRoaXMuc291cmNlQmxvY2tfICYmXG4gICAgICAgIHRoaXMuc291cmNlQmxvY2tfLmlzRWRpdGFibGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRoaXMgZmllbGQgc2hvdWxkIGJlIHNlcmlhbGl6ZWQgYnkgdGhlIFhNTCByZW5kZXJlci5cbiAgICogSGFuZGxlcyB0aGUgbG9naWMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGFuZCBpbmNvbmdydW91cyBzdGF0ZXMuXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBmaWVsZCBzaG91bGQgYmUgc2VyaWFsaXplZCBvciBub3QuXG4gICAqL1xuICBpc1NlcmlhbGl6YWJsZSgpOiBib29sZWFuIHtcbiAgICBsZXQgaXNTZXJpYWxpemFibGUgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5uYW1lKSB7XG4gICAgICBpZiAodGhpcy5TRVJJQUxJWkFCTEUpIHtcbiAgICAgICAgaXNTZXJpYWxpemFibGUgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLkVESVRBQkxFKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICdEZXRlY3RlZCBhbiBlZGl0YWJsZSBmaWVsZCB0aGF0IHdhcyBub3Qgc2VyaWFsaXphYmxlLicgK1xuICAgICAgICAgICAgJyBQbGVhc2UgZGVmaW5lIFNFUklBTElaQUJMRSBwcm9wZXJ0eSBhcyB0cnVlIG9uIGFsbCBlZGl0YWJsZSBjdXN0b20nICtcbiAgICAgICAgICAgICcgZmllbGRzLiBQcm9jZWVkaW5nIHdpdGggc2VyaWFsaXphdGlvbi4nKTtcbiAgICAgICAgaXNTZXJpYWxpemFibGUgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXNTZXJpYWxpemFibGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB3aGV0aGVyIHRoaXMgZWRpdGFibGUgZmllbGQgaXMgdmlzaWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdmlzaWJsZS5cbiAgICovXG4gIGlzVmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy52aXNpYmxlXztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHdoZXRoZXIgdGhpcyBlZGl0YWJsZSBmaWVsZCBpcyB2aXNpYmxlIG9yIG5vdC4gU2hvdWxkIG9ubHkgYmUgY2FsbGVkXG4gICAqIGJ5IGlucHV0LnNldFZpc2libGUuXG4gICAqXG4gICAqIEBwYXJhbSB2aXNpYmxlIFRydWUgaWYgdmlzaWJsZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy52aXNpYmxlXyA9PT0gdmlzaWJsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnZpc2libGVfID0gdmlzaWJsZTtcbiAgICBjb25zdCByb290ID0gdGhpcy5maWVsZEdyb3VwXztcbiAgICBpZiAocm9vdCkge1xuICAgICAgcm9vdC5zdHlsZS5kaXNwbGF5ID0gdmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYSBuZXcgdmFsaWRhdGlvbiBmdW5jdGlvbiBmb3IgZWRpdGFibGUgZmllbGRzLCBvciBjbGVhcnMgYSBwcmV2aW91c2x5XG4gICAqIHNldCB2YWxpZGF0b3IuXG4gICAqXG4gICAqIFRoZSB2YWxpZGF0b3IgZnVuY3Rpb24gdGFrZXMgaW4gdGhlIG5ldyBmaWVsZCB2YWx1ZSwgYW5kIHJldHVybnNcbiAgICogdmFsaWRhdGVkIHZhbHVlLiBUaGUgdmFsaWRhdGVkIHZhbHVlIGNvdWxkIGJlIHRoZSBpbnB1dCB2YWx1ZSwgYSBtb2RpZmllZFxuICAgKiB2ZXJzaW9uIG9mIHRoZSBpbnB1dCB2YWx1ZSwgb3IgbnVsbCB0byBhYm9ydCB0aGUgY2hhbmdlLlxuICAgKlxuICAgKiBJZiB0aGUgZnVuY3Rpb24gZG9lcyBub3QgcmV0dXJuIGFueXRoaW5nIChvciByZXR1cm5zIHVuZGVmaW5lZCkgdGhlIG5ld1xuICAgKiB2YWx1ZSBpcyBhY2NlcHRlZCBhcyB2YWxpZC4gVGhpcyBpcyB0byBhbGxvdyBmb3IgZmllbGRzIHVzaW5nIHRoZVxuICAgKiB2YWxpZGF0ZWQgZnVuY3Rpb24gYXMgYSBmaWVsZC1sZXZlbCBjaGFuZ2UgZXZlbnQgbm90aWZpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gaGFuZGxlciBUaGUgdmFsaWRhdG9yIGZ1bmN0aW9uIG9yIG51bGwgdG8gY2xlYXIgYSBwcmV2aW91c1xuICAgKiAgICAgdmFsaWRhdG9yLlxuICAgKi9cbiAgc2V0VmFsaWRhdG9yKGhhbmRsZXI6IEZpZWxkVmFsaWRhdG9yPFQ+KSB7XG4gICAgdGhpcy52YWxpZGF0b3JfID0gaGFuZGxlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB2YWxpZGF0aW9uIGZ1bmN0aW9uIGZvciBlZGl0YWJsZSBmaWVsZHMsIG9yIG51bGwgaWYgbm90IHNldC5cbiAgICpcbiAgICogQHJldHVybnMgVmFsaWRhdGlvbiBmdW5jdGlvbiwgb3IgbnVsbC5cbiAgICovXG4gIGdldFZhbGlkYXRvcigpOiBGdW5jdGlvbnxudWxsIHtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0b3JfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGdyb3VwIGVsZW1lbnQgZm9yIHRoaXMgZWRpdGFibGUgZmllbGQuXG4gICAqIFVzZWQgZm9yIG1lYXN1cmluZyB0aGUgc2l6ZSBhbmQgZm9yIHBvc2l0aW9uaW5nLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgZ3JvdXAgZWxlbWVudC5cbiAgICovXG4gIGdldFN2Z1Jvb3QoKTogU1ZHR0VsZW1lbnR8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuZmllbGRHcm91cF87XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgYm9yZGVyIHJlY3RhbmdsZSBlbGVtZW50LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYm9yZGVyIHJlY3RhbmdsZSBlbGVtZW50LlxuICAgKiBAdGhyb3dzIEFuIGVycm9yIGlmIHRoZSBib3JkZXIgcmVjdGFuZ2xlIGVsZW1lbnQgaXMgbm90IGRlZmluZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0Qm9yZGVyUmVjdCgpOiBTVkdSZWN0RWxlbWVudCB7XG4gICAgaWYgKCF0aGlzLmJvcmRlclJlY3RfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBib3JkZXIgcmVjdGFuZ2xlIGlzICR7dGhpcy5ib3JkZXJSZWN0X30uYCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmJvcmRlclJlY3RfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHRleHQgZWxlbWVudC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHRleHQgZWxlbWVudC5cbiAgICogQHRocm93cyBBbiBlcnJvciBpZiB0aGUgdGV4dCBlbGVtZW50IGlzIG5vdCBkZWZpbmVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldFRleHRFbGVtZW50KCk6IFNWR1RleHRFbGVtZW50IHtcbiAgICBpZiAoIXRoaXMudGV4dEVsZW1lbnRfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSB0ZXh0IGVsZW1lbnQgaXMgJHt0aGlzLnRleHRFbGVtZW50X30uYCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnRleHRFbGVtZW50XztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB0ZXh0IGNvbnRlbnQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0ZXh0IGNvbnRlbnQuXG4gICAqIEB0aHJvd3MgQW4gZXJyb3IgaWYgdGhlIHRleHQgY29udGVudCBpcyBub3QgZGVmaW5lZC5cbiAgICovXG4gIHByb3RlY3RlZCBnZXRUZXh0Q29udGVudCgpOiBUZXh0IHtcbiAgICBpZiAoIXRoaXMudGV4dENvbnRlbnRfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSB0ZXh0IGNvbnRlbnQgaXMgJHt0aGlzLnRleHRDb250ZW50X30uYCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnRleHRDb250ZW50XztcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBmaWVsZCB0byBtYXRjaCB0aGUgY29sb3VyL3N0eWxlIG9mIHRoZSBibG9jay4gU2hvdWxkIG9ubHkgYmVcbiAgICogY2FsbGVkIGJ5IEJsb2NrU3ZnLmFwcGx5Q29sb3VyKCkuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYXBwbHlDb2xvdXIoKSB7fVxuICAvLyBOb24tYWJzdHJhY3Qgc3ViLWNsYXNzZXMgbWF5IHdpc2ggdG8gaW1wbGVtZW50IHRoaXMuIFNlZSBGaWVsZERyb3Bkb3duLlxuXG4gIC8qKlxuICAgKiBVc2VkIGJ5IGdldFNpemUoKSB0byBtb3ZlL3Jlc2l6ZSBhbnkgRE9NIGVsZW1lbnRzLCBhbmQgZ2V0IHRoZSBuZXcgc2l6ZS5cbiAgICpcbiAgICogQWxsIHJlbmRlcmluZyB0aGF0IGhhcyBhbiBlZmZlY3Qgb24gdGhlIHNpemUvc2hhcGUgb2YgdGhlIGJsb2NrIHNob3VsZCBiZVxuICAgKiBkb25lIGhlcmUsIGFuZCBzaG91bGQgYmUgdHJpZ2dlcmVkIGJ5IGdldFNpemUoKS5cbiAgICovXG4gIHByb3RlY3RlZCByZW5kZXJfKCkge1xuICAgIGlmICh0aGlzLnRleHRDb250ZW50Xykge1xuICAgICAgdGhpcy50ZXh0Q29udGVudF8ubm9kZVZhbHVlID0gdGhpcy5nZXREaXNwbGF5VGV4dF8oKTtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVTaXplXygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxzIHNob3dFZGl0b3JfIHdoZW4gdGhlIGZpZWxkIGlzIGNsaWNrZWQgaWYgdGhlIGZpZWxkIGlzIGNsaWNrYWJsZS5cbiAgICogRG8gbm90IG92ZXJyaWRlLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X2UgT3B0aW9uYWwgbW91c2UgZXZlbnQgdGhhdCB0cmlnZ2VyZWQgdGhlIGZpZWxkIHRvIG9wZW4sIG9yXG4gICAqICAgICB1bmRlZmluZWQgaWYgdHJpZ2dlcmVkIHByb2dyYW1tYXRpY2FsbHkuXG4gICAqIEBzZWFsZWRcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzaG93RWRpdG9yKG9wdF9lPzogRXZlbnQpIHtcbiAgICBpZiAodGhpcy5pc0NsaWNrYWJsZSgpKSB7XG4gICAgICB0aGlzLnNob3dFZGl0b3JfKG9wdF9lKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQSBkZXZlbG9wZXIgaG9vayB0byBjcmVhdGUgYW4gZWRpdG9yIGZvciB0aGUgZmllbGQuIFRoaXMgaXMgbm8tb3AgYnlcbiAgICogZGVmYXVsdCwgYW5kIG11c3QgYmUgb3ZlcnJpZGVuIHRvIGNyZWF0ZSBhbiBlZGl0b3IuXG4gICAqXG4gICAqIEBwYXJhbSBfZSBPcHRpb25hbCBtb3VzZSBldmVudCB0aGF0IHRyaWdnZXJlZCB0aGUgZmllbGQgdG8gb3Blbiwgb3JcbiAgICogICAgIHVuZGVmaW5lZCBpZiB0cmlnZ2VyZWQgcHJvZ3JhbW1hdGljYWxseS5cbiAgICovXG4gIHByb3RlY3RlZCBzaG93RWRpdG9yXyhfZT86IEV2ZW50KTogdm9pZCB7fVxuICAvLyBOT1BcblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgc2l6ZSBvZiB0aGUgZmllbGQgYmFzZWQgb24gdGhlIHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfbWFyZ2luIG1hcmdpbiB0byB1c2Ugd2hlbiBwb3NpdGlvbmluZyB0aGUgdGV4dCBlbGVtZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIHVwZGF0ZVNpemVfKG9wdF9tYXJnaW4/OiBudW1iZXIpIHtcbiAgICBjb25zdCBjb25zdGFudHMgPSB0aGlzLmdldENvbnN0YW50cygpO1xuICAgIGNvbnN0IHhPZmZzZXQgPSBvcHRfbWFyZ2luICE9PSB1bmRlZmluZWQgPyBvcHRfbWFyZ2luIDpcbiAgICAgICAgdGhpcy5ib3JkZXJSZWN0XyA/IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0JPUkRFUl9SRUNUX1hfUEFERElORyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAwO1xuICAgIGxldCB0b3RhbFdpZHRoID0geE9mZnNldCAqIDI7XG4gICAgbGV0IHRvdGFsSGVpZ2h0ID0gY29uc3RhbnRzIS5GSUVMRF9URVhUX0hFSUdIVDtcblxuICAgIGxldCBjb250ZW50V2lkdGggPSAwO1xuICAgIGlmICh0aGlzLnRleHRFbGVtZW50Xykge1xuICAgICAgY29udGVudFdpZHRoID0gZG9tLmdldEZhc3RUZXh0V2lkdGgoXG4gICAgICAgICAgdGhpcy50ZXh0RWxlbWVudF8sIGNvbnN0YW50cyEuRklFTERfVEVYVF9GT05UU0laRSxcbiAgICAgICAgICBjb25zdGFudHMhLkZJRUxEX1RFWFRfRk9OVFdFSUdIVCwgY29uc3RhbnRzIS5GSUVMRF9URVhUX0ZPTlRGQU1JTFkpO1xuICAgICAgdG90YWxXaWR0aCArPSBjb250ZW50V2lkdGg7XG4gICAgfVxuICAgIGlmICh0aGlzLmJvcmRlclJlY3RfKSB7XG4gICAgICB0b3RhbEhlaWdodCA9IE1hdGgubWF4KHRvdGFsSGVpZ2h0LCBjb25zdGFudHMhLkZJRUxEX0JPUkRFUl9SRUNUX0hFSUdIVCk7XG4gICAgfVxuXG4gICAgdGhpcy5zaXplXy5oZWlnaHQgPSB0b3RhbEhlaWdodDtcbiAgICB0aGlzLnNpemVfLndpZHRoID0gdG90YWxXaWR0aDtcblxuICAgIHRoaXMucG9zaXRpb25UZXh0RWxlbWVudF8oeE9mZnNldCwgY29udGVudFdpZHRoKTtcbiAgICB0aGlzLnBvc2l0aW9uQm9yZGVyUmVjdF8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiBhIGZpZWxkJ3MgdGV4dCBlbGVtZW50IGFmdGVyIGEgc2l6ZSBjaGFuZ2UuICBUaGlzIGhhbmRsZXMgYm90aCBMVFJcbiAgICogYW5kIFJUTCBwb3NpdGlvbmluZy5cbiAgICpcbiAgICogQHBhcmFtIHhPZmZzZXQgeCBvZmZzZXQgdG8gdXNlIHdoZW4gcG9zaXRpb25pbmcgdGhlIHRleHQgZWxlbWVudC5cbiAgICogQHBhcmFtIGNvbnRlbnRXaWR0aCBUaGUgY29udGVudCB3aWR0aC5cbiAgICovXG4gIHByb3RlY3RlZCBwb3NpdGlvblRleHRFbGVtZW50Xyh4T2Zmc2V0OiBudW1iZXIsIGNvbnRlbnRXaWR0aDogbnVtYmVyKSB7XG4gICAgaWYgKCF0aGlzLnRleHRFbGVtZW50Xykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjb25zdGFudHMgPSB0aGlzLmdldENvbnN0YW50cygpO1xuICAgIGNvbnN0IGhhbGZIZWlnaHQgPSB0aGlzLnNpemVfLmhlaWdodCAvIDI7XG5cbiAgICB0aGlzLnRleHRFbGVtZW50Xy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd4JyxcbiAgICAgICAgYCR7XG4gICAgICAgICAgICB0aGlzLmdldFNvdXJjZUJsb2NrKCk/LlJUTCA/XG4gICAgICAgICAgICAgICAgdGhpcy5zaXplXy53aWR0aCAtIGNvbnRlbnRXaWR0aCAtIHhPZmZzZXQgOlxuICAgICAgICAgICAgICAgIHhPZmZzZXR9YCk7XG4gICAgdGhpcy50ZXh0RWxlbWVudF8uc2V0QXR0cmlidXRlKFxuICAgICAgICAneScsXG4gICAgICAgIGAke1xuICAgICAgICAgICAgY29uc3RhbnRzIS5GSUVMRF9URVhUX0JBU0VMSU5FX0NFTlRFUiA/XG4gICAgICAgICAgICAgICAgaGFsZkhlaWdodCA6XG4gICAgICAgICAgICAgICAgaGFsZkhlaWdodCAtIGNvbnN0YW50cyEuRklFTERfVEVYVF9IRUlHSFQgLyAyICtcbiAgICAgICAgICAgICAgICAgICAgY29uc3RhbnRzIS5GSUVMRF9URVhUX0JBU0VMSU5FfWApO1xuICB9XG5cbiAgLyoqIFBvc2l0aW9uIGEgZmllbGQncyBib3JkZXIgcmVjdCBhZnRlciBhIHNpemUgY2hhbmdlLiAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25Cb3JkZXJSZWN0XygpIHtcbiAgICBpZiAoIXRoaXMuYm9yZGVyUmVjdF8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5ib3JkZXJSZWN0Xy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7dGhpcy5zaXplXy53aWR0aH1gKTtcbiAgICB0aGlzLmJvcmRlclJlY3RfLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgYCR7dGhpcy5zaXplXy5oZWlnaHR9YCk7XG4gICAgdGhpcy5ib3JkZXJSZWN0Xy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICdyeCcsIGAke3RoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0JPUkRFUl9SRUNUX1JBRElVU31gKTtcbiAgICB0aGlzLmJvcmRlclJlY3RfLnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3J5JywgYCR7dGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfUkFESVVTfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGhlaWdodCBhbmQgd2lkdGggb2YgdGhlIGZpZWxkLlxuICAgKlxuICAgKiBUaGlzIHNob3VsZCAqaW4gZ2VuZXJhbCogYmUgdGhlIG9ubHkgcGxhY2UgcmVuZGVyXyBnZXRzIGNhbGxlZCBmcm9tLlxuICAgKlxuICAgKiBAcmV0dXJucyBIZWlnaHQgYW5kIHdpZHRoLlxuICAgKi9cbiAgZ2V0U2l6ZSgpOiBTaXplIHtcbiAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKCkpIHtcbiAgICAgIHJldHVybiBuZXcgU2l6ZSgwLCAwKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0RpcnR5Xykge1xuICAgICAgdGhpcy5yZW5kZXJfKCk7XG4gICAgICB0aGlzLmlzRGlydHlfID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmICh0aGlzLnZpc2libGVfICYmIHRoaXMuc2l6ZV8ud2lkdGggPT09IDApIHtcbiAgICAgIC8vIElmIHRoZSBmaWVsZCBpcyBub3QgdmlzaWJsZSB0aGUgd2lkdGggd2lsbCBiZSAwIGFzIHdlbGwsIG9uZSBvZiB0aGVcbiAgICAgIC8vIHByb2JsZW1zIHdpdGggdGhlIG9sZCBzeXN0ZW0uXG4gICAgICB0aGlzLnJlbmRlcl8oKTtcbiAgICAgIC8vIERvbid0IGlzc3VlIGEgd2FybmluZyBpZiB0aGUgZmllbGQgaXMgYWN0dWFsbHkgemVybyB3aWR0aC5cbiAgICAgIGlmICh0aGlzLnNpemVfLndpZHRoICE9PSAwKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICdEZXByZWNhdGVkIHVzZSBvZiBzZXR0aW5nIHNpemVfLndpZHRoIHRvIDAgdG8gcmVyZW5kZXIgYScgK1xuICAgICAgICAgICAgJyBmaWVsZC4gU2V0IGZpZWxkLmlzRGlydHlfIHRvIHRydWUgaW5zdGVhZC4nKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2l6ZV87XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSByZW5kZXJlZCBmaWVsZCwgYWNjb3VudGluZyBmb3Igd29ya3NwYWNlXG4gICAqIHNjYWxpbmcuXG4gICAqXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCB3aXRoIHRvcCwgYm90dG9tLCBsZWZ0LCBhbmQgcmlnaHQgaW4gcGl4ZWxzIHJlbGF0aXZlIHRvXG4gICAqICAgICB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBwYWdlICh3aW5kb3cgY29vcmRpbmF0ZXMpLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFNjYWxlZEJCb3goKTogUmVjdCB7XG4gICAgbGV0IHNjYWxlZFdpZHRoO1xuICAgIGxldCBzY2FsZWRIZWlnaHQ7XG4gICAgbGV0IHh5O1xuICAgIGNvbnN0IGJsb2NrID0gdGhpcy5nZXRTb3VyY2VCbG9jaygpO1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIHRocm93IG5ldyBVbmF0dGFjaGVkRmllbGRFcnJvcigpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5ib3JkZXJSZWN0Xykge1xuICAgICAgLy8gQnJvd3NlcnMgYXJlIGluY29uc2lzdGVudCBpbiB3aGF0IHRoZXkgcmV0dXJuIGZvciBhIGJvdW5kaW5nIGJveC5cbiAgICAgIC8vIC0gV2Via2l0IC8gQmxpbms6IGZpbGwtYm94IC8gb2JqZWN0IGJvdW5kaW5nIGJveFxuICAgICAgLy8gLSBHZWNrbzogc3Ryb2tlLWJveFxuICAgICAgY29uc3QgYkJveCA9ICh0aGlzLnNvdXJjZUJsb2NrXyBhcyBCbG9ja1N2ZykuZ2V0SGVpZ2h0V2lkdGgoKTtcbiAgICAgIGNvbnN0IHNjYWxlID0gKGJsb2NrLndvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLnNjYWxlO1xuICAgICAgeHkgPSB0aGlzLmdldEFic29sdXRlWFlfKCk7XG4gICAgICBzY2FsZWRXaWR0aCA9IChiQm94LndpZHRoICsgMSkgKiBzY2FsZTtcbiAgICAgIHNjYWxlZEhlaWdodCA9IChiQm94LmhlaWdodCArIDEpICogc2NhbGU7XG5cbiAgICAgIGlmICh1c2VyQWdlbnQuR0VDS08pIHtcbiAgICAgICAgeHkueCArPSAxLjUgKiBzY2FsZTtcbiAgICAgICAgeHkueSArPSAxLjUgKiBzY2FsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHh5LnggLT0gMC41ICogc2NhbGU7XG4gICAgICAgIHh5LnkgLT0gMC41ICogc2NhbGU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGJCb3ggPSB0aGlzLmJvcmRlclJlY3RfLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgeHkgPSBzdHlsZS5nZXRQYWdlT2Zmc2V0KHRoaXMuYm9yZGVyUmVjdF8pO1xuICAgICAgc2NhbGVkV2lkdGggPSBiQm94LndpZHRoO1xuICAgICAgc2NhbGVkSGVpZ2h0ID0gYkJveC5oZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVjdCh4eS55LCB4eS55ICsgc2NhbGVkSGVpZ2h0LCB4eS54LCB4eS54ICsgc2NhbGVkV2lkdGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgdGV4dCBmcm9tIHRoaXMgZmllbGQgdG8gZGlzcGxheSBvbiB0aGUgYmxvY2suIE1heSBkaWZmZXIgZnJvbVxuICAgKiBgZ2V0VGV4dGAgZHVlIHRvIGVsbGlwc2lzLCBhbmQgb3RoZXIgZm9ybWF0dGluZy5cbiAgICpcbiAgICogQHJldHVybnMgVGV4dCB0byBkaXNwbGF5LlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldERpc3BsYXlUZXh0XygpOiBzdHJpbmcge1xuICAgIGxldCB0ZXh0ID0gdGhpcy5nZXRUZXh0KCk7XG4gICAgaWYgKCF0ZXh0KSB7XG4gICAgICAvLyBQcmV2ZW50IHRoZSBmaWVsZCBmcm9tIGRpc2FwcGVhcmluZyBpZiBlbXB0eS5cbiAgICAgIHJldHVybiBGaWVsZC5OQlNQO1xuICAgIH1cbiAgICBpZiAodGV4dC5sZW5ndGggPiB0aGlzLm1heERpc3BsYXlMZW5ndGgpIHtcbiAgICAgIC8vIFRydW5jYXRlIGRpc3BsYXllZCBzdHJpbmcgYW5kIGFkZCBhbiBlbGxpcHNpcyAoJy4uLicpLlxuICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIHRoaXMubWF4RGlzcGxheUxlbmd0aCAtIDIpICsgJ+KApic7XG4gICAgfVxuICAgIC8vIFJlcGxhY2Ugd2hpdGVzcGFjZSB3aXRoIG5vbi1icmVha2luZyBzcGFjZXMgc28gdGhlIHRleHQgZG9lc24ndCBjb2xsYXBzZS5cbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMvZywgRmllbGQuTkJTUCk7XG4gICAgaWYgKHRoaXMuc291cmNlQmxvY2tfICYmIHRoaXMuc291cmNlQmxvY2tfLlJUTCkge1xuICAgICAgLy8gVGhlIFNWRyBpcyBMVFIsIGZvcmNlIHRleHQgdG8gYmUgUlRMIGJ5IGFkZGluZyBhbiBSTE0uXG4gICAgICB0ZXh0ICs9ICdcXHUyMDBGJztcbiAgICB9XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB0ZXh0IGZyb20gdGhpcyBmaWVsZC5cbiAgICogT3ZlcnJpZGUgZ2V0VGV4dF8gdG8gcHJvdmlkZSBhIGRpZmZlcmVudCBiZWhhdmlvciB0aGFuIHNpbXBseSBjYXN0aW5nIHRoZVxuICAgKiB2YWx1ZSB0byBhIHN0cmluZy5cbiAgICpcbiAgICogQHJldHVybnMgQ3VycmVudCB0ZXh0LlxuICAgKiBAc2VhbGVkXG4gICAqL1xuICBnZXRUZXh0KCk6IHN0cmluZyB7XG4gICAgLy8gdGhpcy5nZXRUZXh0XyB3YXMgaW50ZW5kZWQgc28gdGhhdCBkZXZzIGRvbid0IGhhdmUgdG8gcmVtZW1iZXIgdG8gY2FsbFxuICAgIC8vIHN1cGVyIHdoZW4gb3ZlcnJpZGluZyBob3cgdGhlIHRleHQgb2YgdGhlIGZpZWxkIGlzIGdlbmVyYXRlZC4gKCMyOTEwKVxuICAgIGNvbnN0IHRleHQgPSB0aGlzLmdldFRleHRfKCk7XG4gICAgaWYgKHRleHQgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBTdHJpbmcodGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcodGhpcy5nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIGRldmVsb3BlciBob29rIHRvIG92ZXJyaWRlIHRoZSByZXR1cm5lZCB0ZXh0IG9mIHRoaXMgZmllbGQuXG4gICAqIE92ZXJyaWRlIGlmIHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkXG4gICAqIGlzIG5vdCBqdXN0IGEgc3RyaW5nIGNhc3Qgb2YgaXRzIHZhbHVlLlxuICAgKiBSZXR1cm4gbnVsbCB0byByZXNvcnQgdG8gYSBzdHJpbmcgY2FzdC5cbiAgICpcbiAgICogQHJldHVybnMgQ3VycmVudCB0ZXh0IG9yIG51bGwuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0VGV4dF8oKTogc3RyaW5nfG51bGwge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcmNlIGEgcmVyZW5kZXIgb2YgdGhlIGJsb2NrIHRoYXQgdGhpcyBmaWVsZCBpcyBpbnN0YWxsZWQgb24sIHdoaWNoIHdpbGxcbiAgICogcmVyZW5kZXIgdGhpcyBmaWVsZCBhbmQgYWRqdXN0IGZvciBhbnkgc2l6aW5nIGNoYW5nZXMuXG4gICAqIE90aGVyIGZpZWxkcyBvbiB0aGUgc2FtZSBibG9jayB3aWxsIG5vdCByZXJlbmRlciwgYmVjYXVzZSB0aGVpciBzaXplcyBoYXZlXG4gICAqIGFscmVhZHkgYmVlbiByZWNvcmRlZC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYXJrRGlydHkoKSB7XG4gICAgdGhpcy5pc0RpcnR5XyA9IHRydWU7XG4gICAgdGhpcy5jb25zdGFudHNfID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JjZSBhIHJlcmVuZGVyIG9mIHRoZSBibG9jayB0aGF0IHRoaXMgZmllbGQgaXMgaW5zdGFsbGVkIG9uLCB3aGljaCB3aWxsXG4gICAqIHJlcmVuZGVyIHRoaXMgZmllbGQgYW5kIGFkanVzdCBmb3IgYW55IHNpemluZyBjaGFuZ2VzLlxuICAgKiBPdGhlciBmaWVsZHMgb24gdGhlIHNhbWUgYmxvY2sgd2lsbCBub3QgcmVyZW5kZXIsIGJlY2F1c2UgdGhlaXIgc2l6ZXMgaGF2ZVxuICAgKiBhbHJlYWR5IGJlZW4gcmVjb3JkZWQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZm9yY2VSZXJlbmRlcigpIHtcbiAgICB0aGlzLmlzRGlydHlfID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5zb3VyY2VCbG9ja18gJiYgdGhpcy5zb3VyY2VCbG9ja18ucmVuZGVyZWQpIHtcbiAgICAgICh0aGlzLnNvdXJjZUJsb2NrXyBhcyBCbG9ja1N2ZykucmVuZGVyKCk7XG4gICAgICAodGhpcy5zb3VyY2VCbG9ja18gYXMgQmxvY2tTdmcpLmJ1bXBOZWlnaGJvdXJzKCk7XG4gICAgICB0aGlzLnVwZGF0ZU1hcmtlcnNfKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gY2hhbmdlIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuIEhhbmRsZXMgdmFsaWRhdGlvbiBhbmQgZXZlbnRzLlxuICAgKiBTdWJjbGFzc2VzIHNob3VsZCBvdmVycmlkZSBkb0NsYXNzVmFsaWRhdGlvbl8gYW5kIGRvVmFsdWVVcGRhdGVfIHJhdGhlclxuICAgKiB0aGFuIHRoaXMgbWV0aG9kLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3VmFsdWUgTmV3IHZhbHVlLlxuICAgKiBAc2VhbGVkXG4gICAqL1xuICBzZXRWYWx1ZShuZXdWYWx1ZTogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgY29uc3QgZG9Mb2dnaW5nID0gZmFsc2U7XG4gICAgaWYgKG5ld1ZhbHVlID09PSBudWxsKSB7XG4gICAgICBkb0xvZ2dpbmcgJiYgY29uc29sZS5sb2coJ251bGwsIHJldHVybicpO1xuICAgICAgLy8gTm90IGEgdmFsaWQgdmFsdWUgdG8gY2hlY2suXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHZhbGlkYXRlZFZhbHVlID0gdGhpcy5kb0NsYXNzVmFsaWRhdGlvbl8obmV3VmFsdWUpO1xuICAgIC8vIENsYXNzIHZhbGlkYXRvcnMgbWlnaHQgYWNjaWRlbnRhbGx5IGZvcmdldCB0byByZXR1cm4sIHdlJ2xsIGlnbm9yZSB0aGF0LlxuICAgIG5ld1ZhbHVlID0gdGhpcy5wcm9jZXNzVmFsaWRhdGlvbl8obmV3VmFsdWUsIHZhbGlkYXRlZFZhbHVlKTtcbiAgICBpZiAobmV3VmFsdWUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgZG9Mb2dnaW5nICYmIGNvbnNvbGUubG9nKCdpbnZhbGlkIGNsYXNzIHZhbGlkYXRpb24sIHJldHVybicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGxvY2FsVmFsaWRhdG9yID0gdGhpcy5nZXRWYWxpZGF0b3IoKTtcbiAgICBpZiAobG9jYWxWYWxpZGF0b3IpIHtcbiAgICAgIHZhbGlkYXRlZFZhbHVlID0gbG9jYWxWYWxpZGF0b3IuY2FsbCh0aGlzLCBuZXdWYWx1ZSk7XG4gICAgICAvLyBMb2NhbCB2YWxpZGF0b3JzIG1pZ2h0IGFjY2lkZW50YWxseSBmb3JnZXQgdG8gcmV0dXJuLCB3ZSdsbCBpZ25vcmVcbiAgICAgIC8vIHRoYXQuXG4gICAgICBuZXdWYWx1ZSA9IHRoaXMucHJvY2Vzc1ZhbGlkYXRpb25fKG5ld1ZhbHVlLCB2YWxpZGF0ZWRWYWx1ZSk7XG4gICAgICBpZiAobmV3VmFsdWUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBkb0xvZ2dpbmcgJiYgY29uc29sZS5sb2coJ2ludmFsaWQgbG9jYWwgdmFsaWRhdGlvbiwgcmV0dXJuJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5zb3VyY2VCbG9ja187XG4gICAgaWYgKHNvdXJjZSAmJiBzb3VyY2UuZGlzcG9zZWQpIHtcbiAgICAgIGRvTG9nZ2luZyAmJiBjb25zb2xlLmxvZygnc291cmNlIGRpc3Bvc2VkLCByZXR1cm4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgaWYgKG9sZFZhbHVlID09PSBuZXdWYWx1ZSkge1xuICAgICAgZG9Mb2dnaW5nICYmIGNvbnNvbGUubG9nKCdzYW1lLCBkb1ZhbHVlVXBkYXRlXywgcmV0dXJuJyk7XG4gICAgICB0aGlzLmRvVmFsdWVVcGRhdGVfKG5ld1ZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmRvVmFsdWVVcGRhdGVfKG5ld1ZhbHVlKTtcbiAgICBpZiAoc291cmNlICYmIGV2ZW50VXRpbHMuaXNFbmFibGVkKCkpIHtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuQkxPQ0tfQ0hBTkdFKSkoXG4gICAgICAgICAgc291cmNlLCAnZmllbGQnLCB0aGlzLm5hbWUgfHwgbnVsbCwgb2xkVmFsdWUsIG5ld1ZhbHVlKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzRGlydHlfKSB7XG4gICAgICB0aGlzLmZvcmNlUmVyZW5kZXIoKTtcbiAgICB9XG4gICAgZG9Mb2dnaW5nICYmIGNvbnNvbGUubG9nKHRoaXMudmFsdWVfKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIHRoZSByZXN1bHQgb2YgdmFsaWRhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIG5ld1ZhbHVlIE5ldyB2YWx1ZS5cbiAgICogQHBhcmFtIHZhbGlkYXRlZFZhbHVlIFZhbGlkYXRlZCB2YWx1ZS5cbiAgICogQHJldHVybnMgTmV3IHZhbHVlLCBvciBhbiBFcnJvciBvYmplY3QuXG4gICAqL1xuICBwcml2YXRlIHByb2Nlc3NWYWxpZGF0aW9uXyhcbiAgICAgIG5ld1ZhbHVlOiBBbnlEdXJpbmdNaWdyYXRpb24sXG4gICAgICB2YWxpZGF0ZWRWYWx1ZTogQW55RHVyaW5nTWlncmF0aW9uKTogQW55RHVyaW5nTWlncmF0aW9uIHtcbiAgICBpZiAodmFsaWRhdGVkVmFsdWUgPT09IG51bGwpIHtcbiAgICAgIHRoaXMuZG9WYWx1ZUludmFsaWRfKG5ld1ZhbHVlKTtcbiAgICAgIGlmICh0aGlzLmlzRGlydHlfKSB7XG4gICAgICAgIHRoaXMuZm9yY2VSZXJlbmRlcigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEVycm9yKCk7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0ZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBuZXdWYWx1ZSA9IHZhbGlkYXRlZFZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gbmV3VmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBmaWVsZC5cbiAgICpcbiAgICogQHJldHVybnMgQ3VycmVudCB2YWx1ZS5cbiAgICovXG4gIGdldFZhbHVlKCk6IEFueUR1cmluZ01pZ3JhdGlvbiB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVfO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gdmFsaWRhdGUgYSB2YWx1ZS4gUmV0dXJucyBpbnB1dCBieSBkZWZhdWx0LiBDYW4gYmUgb3ZlcnJpZGRlbiBieVxuICAgKiBzdWJjbGFzc2VzLCBzZWUgRmllbGREcm9wZG93bi5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9uZXdWYWx1ZSBUaGUgdmFsdWUgdG8gYmUgdmFsaWRhdGVkLlxuICAgKiBAcmV0dXJucyBUaGUgdmFsaWRhdGVkIHZhbHVlLCBzYW1lIGFzIGlucHV0IGJ5IGRlZmF1bHQuXG4gICAqL1xuICBwcm90ZWN0ZWQgZG9DbGFzc1ZhbGlkYXRpb25fKG9wdF9uZXdWYWx1ZT86IEFueUR1cmluZ01pZ3JhdGlvbik6XG4gICAgICBBbnlEdXJpbmdNaWdyYXRpb24ge1xuICAgIGlmIChvcHRfbmV3VmFsdWUgPT09IG51bGwgfHwgb3B0X25ld1ZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gb3B0X25ld1ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gdXBkYXRlIHRoZSB2YWx1ZSBvZiBhIGZpZWxkLiBDYW4gYmUgb3ZlcnJpZGRlbiBieSBzdWJjbGFzc2VzIHRvIGRvXG4gICAqIGN1c3RvbSBzdG9yYWdlIG9mIHZhbHVlcy91cGRhdGluZyBvZiBleHRlcm5hbCB0aGluZ3MuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdWYWx1ZSBUaGUgdmFsdWUgdG8gYmUgc2F2ZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgZG9WYWx1ZVVwZGF0ZV8obmV3VmFsdWU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgIHRoaXMudmFsdWVfID0gbmV3VmFsdWU7XG4gICAgdGhpcy5pc0RpcnR5XyA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVXNlZCB0byBub3RpZnkgdGhlIGZpZWxkIGFuIGludmFsaWQgdmFsdWUgd2FzIGlucHV0LiBDYW4gYmUgb3ZlcnJpZGRlbiBieVxuICAgKiBzdWJjbGFzc2VzLCBzZWUgRmllbGRUZXh0SW5wdXQuXG4gICAqIE5vLW9wIGJ5IGRlZmF1bHQuXG4gICAqXG4gICAqIEBwYXJhbSBfaW52YWxpZFZhbHVlIFRoZSBpbnB1dCB2YWx1ZSB0aGF0IHdhcyBkZXRlcm1pbmVkIHRvIGJlIGludmFsaWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgZG9WYWx1ZUludmFsaWRfKF9pbnZhbGlkVmFsdWU6IEFueUR1cmluZ01pZ3JhdGlvbikge31cbiAgLy8gTk9QXG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJkb3duIGV2ZW50IG9uIGEgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgZG93biBldmVudC5cbiAgICovXG4gIHByb3RlY3RlZCBvbk1vdXNlRG93bl8oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLnNvdXJjZUJsb2NrXyB8fCB0aGlzLnNvdXJjZUJsb2NrXy5pc0RlYWRPckR5aW5nKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZ2VzdHVyZSA9ICh0aGlzLnNvdXJjZUJsb2NrXy53b3Jrc3BhY2UgYXMgV29ya3NwYWNlU3ZnKS5nZXRHZXN0dXJlKGUpO1xuICAgIGlmIChnZXN0dXJlKSB7XG4gICAgICBnZXN0dXJlLnNldFN0YXJ0RmllbGQodGhpcyBhcyBGaWVsZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHRvb2x0aXAgZm9yIHRoaXMgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdUaXAgVGhlIHRleHQgZm9yIHRoZSB0b29sdGlwLCBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgdGV4dFxuICAgKiAgICAgZm9yIHRoZSB0b29sdGlwLCBhIHBhcmVudCBvYmplY3Qgd2hvc2UgdG9vbHRpcCB3aWxsIGJlIHVzZWQsIG9yIG51bGwgdG9cbiAgICogICAgIGRpc3BsYXkgdGhlIHRvb2x0aXAgb2YgdGhlIHBhcmVudCBibG9jay4gVG8gbm90IGRpc3BsYXkgYSB0b29sdGlwIHBhc3NcbiAgICogICAgIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAqL1xuICBzZXRUb29sdGlwKG5ld1RpcDogVG9vbHRpcC5UaXBJbmZvfG51bGwpIHtcbiAgICBpZiAoIW5ld1RpcCAmJiBuZXdUaXAgIT09ICcnKSB7ICAvLyBJZiBudWxsIG9yIHVuZGVmaW5lZC5cbiAgICAgIG5ld1RpcCA9IHRoaXMuc291cmNlQmxvY2tfO1xuICAgIH1cbiAgICBjb25zdCBjbGlja1RhcmdldCA9IHRoaXMuZ2V0Q2xpY2tUYXJnZXRfKCk7XG4gICAgaWYgKGNsaWNrVGFyZ2V0KSB7XG4gICAgICAoY2xpY2tUYXJnZXQgYXMgQW55RHVyaW5nTWlncmF0aW9uKS50b29sdGlwID0gbmV3VGlwO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGaWVsZCBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LlxuICAgICAgdGhpcy50b29sdGlwXyA9IG5ld1RpcDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG9vbHRpcCB0ZXh0IGZvciB0aGlzIGZpZWxkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgdG9vbHRpcCB0ZXh0IGZvciB0aGlzIGZpZWxkLlxuICAgKi9cbiAgZ2V0VG9vbHRpcCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNsaWNrVGFyZ2V0ID0gdGhpcy5nZXRDbGlja1RhcmdldF8oKTtcbiAgICBpZiAoY2xpY2tUYXJnZXQpIHtcbiAgICAgIHJldHVybiBUb29sdGlwLmdldFRvb2x0aXBPZk9iamVjdChjbGlja1RhcmdldCk7XG4gICAgfVxuICAgIC8vIEZpZWxkIGhhcyBub3QgYmVlbiBpbml0aWFsaXplZCB5ZXQuIFJldHVybiBzdGFzaGVkIHRoaXMudG9vbHRpcF8gdmFsdWUuXG4gICAgcmV0dXJuIFRvb2x0aXAuZ2V0VG9vbHRpcE9mT2JqZWN0KHt0b29sdGlwOiB0aGlzLnRvb2x0aXBffSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGVsZW1lbnQgdG8gYmluZCB0aGUgY2xpY2sgaGFuZGxlciB0by4gSWYgbm90IHNldCBleHBsaWNpdGx5LCBkZWZhdWx0c1xuICAgKiB0byB0aGUgU1ZHIHJvb3Qgb2YgdGhlIGZpZWxkLiBXaGVuIHRoaXMgZWxlbWVudCBpc1xuICAgKiBjbGlja2VkIG9uIGFuIGVkaXRhYmxlIGZpZWxkLCB0aGUgZWRpdG9yIHdpbGwgb3Blbi5cbiAgICpcbiAgICogQHJldHVybnMgRWxlbWVudCB0byBiaW5kIGNsaWNrIGhhbmRsZXIgdG8uXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0Q2xpY2tUYXJnZXRfKCk6IEVsZW1lbnR8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY2xpY2tUYXJnZXRfIHx8IHRoaXMuZ2V0U3ZnUm9vdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgYWJzb2x1dGUgY29vcmRpbmF0ZXMgb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGlzIGZpZWxkLlxuICAgKiBUaGUgb3JpZ2luICgwLDApIGlzIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIHBhZ2UgYm9keS5cbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IHdpdGggLnggYW5kIC55IHByb3BlcnRpZXMuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0QWJzb2x1dGVYWV8oKTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIHN0eWxlLmdldFBhZ2VPZmZzZXQodGhpcy5nZXRDbGlja1RhcmdldF8oKSBhcyBTVkdSZWN0RWxlbWVudCk7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGlzIGZpZWxkIHJlZmVyZW5jZXMgYW55IEJsb2NrbHkgdmFyaWFibGVzLiAgSWYgdHJ1ZSBpdCBtYXkgbmVlZFxuICAgKiB0byBiZSBoYW5kbGVkIGRpZmZlcmVudGx5IGR1cmluZyBzZXJpYWxpemF0aW9uIGFuZCBkZXNlcmlhbGl6YXRpb24uXG4gICAqIFN1YmNsYXNzZXMgbWF5IG92ZXJyaWRlIHRoaXMuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhpcyBmaWVsZCBoYXMgYW55IHZhcmlhYmxlIHJlZmVyZW5jZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVmZXJlbmNlc1ZhcmlhYmxlcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogUmVmcmVzaCB0aGUgdmFyaWFibGUgbmFtZSByZWZlcmVuY2VkIGJ5IHRoaXMgZmllbGQgaWYgdGhpcyBmaWVsZCByZWZlcmVuY2VzXG4gICAqIHZhcmlhYmxlcy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICByZWZyZXNoVmFyaWFibGVOYW1lKCkge31cbiAgLy8gTk9QXG5cbiAgLyoqXG4gICAqIFNlYXJjaCB0aHJvdWdoIHRoZSBsaXN0IG9mIGlucHV0cyBhbmQgdGhlaXIgZmllbGRzIGluIG9yZGVyIHRvIGZpbmQgdGhlXG4gICAqIHBhcmVudCBpbnB1dCBvZiBhIGZpZWxkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgdGhhdCB0aGUgZmllbGQgYmVsb25ncyB0by5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRQYXJlbnRJbnB1dCgpOiBJbnB1dCB7XG4gICAgbGV0IHBhcmVudElucHV0ID0gbnVsbDtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3QgaW5wdXRzID0gYmxvY2suaW5wdXRMaXN0O1xuXG4gICAgZm9yIChsZXQgaWR4ID0gMDsgaWR4IDwgYmxvY2suaW5wdXRMaXN0Lmxlbmd0aDsgaWR4KyspIHtcbiAgICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzW2lkeF07XG4gICAgICBjb25zdCBmaWVsZFJvd3MgPSBpbnB1dC5maWVsZFJvdztcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZmllbGRSb3dzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmIChmaWVsZFJvd3Nbal0gPT09IHRoaXMpIHtcbiAgICAgICAgICBwYXJlbnRJbnB1dCA9IGlucHV0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwYXJlbnRJbnB1dCE7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB3ZSBzaG91bGQgZmxpcCB0aGUgZmllbGQgaW4gUlRMLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHdlIHNob3VsZCBmbGlwIGluIFJUTC5cbiAgICovXG4gIGdldEZsaXBSdGwoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGZpZWxkIGlzIHRhYiBuYXZpZ2FibGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGZpZWxkIGlzIHRhYiBuYXZpZ2FibGUuXG4gICAqL1xuICBpc1RhYk5hdmlnYWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB0aGUgZ2l2ZW4ga2V5Ym9hcmQgc2hvcnRjdXQuXG4gICAqXG4gICAqIEBwYXJhbSBfc2hvcnRjdXQgVGhlIHNob3J0Y3V0IHRvIGJlIGhhbmRsZWQuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHNob3J0Y3V0IGhhcyBiZWVuIGhhbmRsZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIG9uU2hvcnRjdXQoX3Nob3J0Y3V0OiBLZXlib2FyZFNob3J0Y3V0KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCB0aGUgY3Vyc29yIFNWRyB0byB0aGlzIGZpZWxkcyBTVkcgZ3JvdXAuXG4gICAqXG4gICAqIEBwYXJhbSBjdXJzb3JTdmcgVGhlIFNWRyByb290IG9mIHRoZSBjdXJzb3IgdG8gYmUgYWRkZWQgdG8gdGhlIGZpZWxkIGdyb3VwLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldEN1cnNvclN2ZyhjdXJzb3JTdmc6IFNWR0VsZW1lbnQpIHtcbiAgICBpZiAoIWN1cnNvclN2Zykge1xuICAgICAgdGhpcy5jdXJzb3JTdmdfID0gbnVsbDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuZmllbGRHcm91cF8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpZWxkIGdyb3VwIGlzICR7dGhpcy5maWVsZEdyb3VwX30uYCk7XG4gICAgfVxuICAgIHRoaXMuZmllbGRHcm91cF8uYXBwZW5kQ2hpbGQoY3Vyc29yU3ZnKTtcbiAgICB0aGlzLmN1cnNvclN2Z18gPSBjdXJzb3JTdmc7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHRoZSBtYXJrZXIgU1ZHIHRvIHRoaXMgZmllbGRzIFNWRyBncm91cC5cbiAgICpcbiAgICogQHBhcmFtIG1hcmtlclN2ZyBUaGUgU1ZHIHJvb3Qgb2YgdGhlIG1hcmtlciB0byBiZSBhZGRlZCB0byB0aGUgZmllbGQgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0TWFya2VyU3ZnKG1hcmtlclN2ZzogU1ZHRWxlbWVudCkge1xuICAgIGlmICghbWFya2VyU3ZnKSB7XG4gICAgICB0aGlzLm1hcmtlclN2Z18gPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5maWVsZEdyb3VwXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZmllbGQgZ3JvdXAgaXMgJHt0aGlzLmZpZWxkR3JvdXBffS5gKTtcbiAgICB9XG4gICAgdGhpcy5maWVsZEdyb3VwXy5hcHBlbmRDaGlsZChtYXJrZXJTdmcpO1xuICAgIHRoaXMubWFya2VyU3ZnXyA9IG1hcmtlclN2ZztcbiAgfVxuXG4gIC8qKiBSZWRyYXcgYW55IGF0dGFjaGVkIG1hcmtlciBvciBjdXJzb3Igc3ZncyBpZiBuZWVkZWQuICovXG4gIHByb3RlY3RlZCB1cGRhdGVNYXJrZXJzXygpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3Qgd29ya3NwYWNlID0gYmxvY2sud29ya3NwYWNlIGFzIFdvcmtzcGFjZVN2ZztcbiAgICBpZiAod29ya3NwYWNlLmtleWJvYXJkQWNjZXNzaWJpbGl0eU1vZGUgJiYgdGhpcy5jdXJzb3JTdmdfKSB7XG4gICAgICB3b3Jrc3BhY2UuZ2V0Q3Vyc29yKCkhLmRyYXcoKTtcbiAgICB9XG4gICAgaWYgKHdvcmtzcGFjZS5rZXlib2FyZEFjY2Vzc2liaWxpdHlNb2RlICYmIHRoaXMubWFya2VyU3ZnXykge1xuICAgICAgLy8gVE9ETygjNDU5Mik6IFVwZGF0ZSBhbGwgbWFya2VycyBvbiB0aGUgZmllbGQuXG4gICAgICB3b3Jrc3BhY2UuZ2V0TWFya2VyKE1hcmtlck1hbmFnZXIuTE9DQUxfTUFSS0VSKSEuZHJhdygpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEV4dHJhIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgdGhlIGJhc2UgZmllbGQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGRDb25maWcge1xuICB0b29sdGlwPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEZvciB1c2UgYnkgRmllbGQgYW5kIGRlc2NlbmRhbnRzIG9mIEZpZWxkLiBDb25zdHJ1Y3RvcnMgY2FuIGNoYW5nZVxuICogaW4gZGVzY2VuZGFudHMsIHRob3VnaCB0aGV5IHNob3VsZCBjb250YWluIGFsbCBvZiBGaWVsZCdzIHByb3RvdHlwZSBtZXRob2RzLlxuICovXG5leHBvcnQgdHlwZSBGaWVsZFByb3RvID0gUGljazx0eXBlb2YgRmllbGQsICdwcm90b3R5cGUnPjtcblxuLyoqXG4gKiBSZXByZXNlbnRzIGFuIGVycm9yIHdoZXJlIHRoZSBmaWVsZCBpcyB0cnlpbmcgdG8gYWNjZXNzIGl0cyBibG9jayBvclxuICogaW5mb3JtYXRpb24gYWJvdXQgaXRzIGJsb2NrIGJlZm9yZSBpdCBoYXMgYWN0dWFsbHkgYmVlbiBhdHRhY2hlZCB0byBzYWlkXG4gKiBibG9jay5cbiAqL1xuZXhwb3J0IGNsYXNzIFVuYXR0YWNoZWRGaWVsZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAvKiogQGludGVybmFsICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKFxuICAgICAgICAnVGhlIGZpZWxkIGhhcyBub3QgeWV0IGJlZW4gYXR0YWNoZWQgdG8gaXRzIGlucHV0LiAnICtcbiAgICAgICAgJ0NhbGwgYXBwZW5kRmllbGQgdG8gYXR0YWNoIGl0LicpO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ29uc3RhbnQgZGVjbGFyYXRpb25zIGZvciBjb21tb24ga2V5IGNvZGVzLlxuICogVGhlc2UgbWV0aG9kcyBhcmUgbm90IHNwZWNpZmljIHRvIEJsb2NrbHksIGFuZCBjb3VsZCBiZSBmYWN0b3JlZCBvdXQgaW50b1xuICogYSBKYXZhU2NyaXB0IGZyYW1ld29yayBzdWNoIGFzIENsb3N1cmUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnV0aWxzLktleUNvZGVzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkudXRpbHMuS2V5Q29kZXMnKTtcblxuXG4vKipcbiAqIEtleSBjb2RlcyBmb3IgY29tbW9uIGNoYXJhY3RlcnMuXG4gKlxuICogQ29waWVkIGZyb20gQ2xvc3VyZSdzIGdvb2cuZXZlbnRzLktleUNvZGVzXG4gKlxuICogVGhpcyBsaXN0IGlzIG5vdCBsb2NhbGl6ZWQgYW5kIHRoZXJlZm9yZSBzb21lIG9mIHRoZSBrZXkgY29kZXMgYXJlIG5vdFxuICogY29ycmVjdCBmb3Igbm9uIFVTIGtleWJvYXJkIGxheW91dHMuIFNlZSBjb21tZW50cyBiZWxvdy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS51dGlscy5LZXlDb2Rlc1xuICovXG5leHBvcnQgZW51bSBLZXlDb2RlcyB7XG4gIFdJTl9LRVlfRkZfTElOVVggPSAwLFxuICBNQUNfRU5URVIgPSAzLFxuICBCQUNLU1BBQ0UgPSA4LFxuICBUQUIgPSA5LFxuICBOVU1fQ0VOVEVSID0gMTIsICAvLyBOVU1MT0NLIG9uIEZGL1NhZmFyaSBNYWNcbiAgRU5URVIgPSAxMyxcbiAgU0hJRlQgPSAxNixcbiAgQ1RSTCA9IDE3LFxuICBBTFQgPSAxOCxcbiAgUEFVU0UgPSAxOSxcbiAgQ0FQU19MT0NLID0gMjAsXG4gIEVTQyA9IDI3LFxuICBTUEFDRSA9IDMyLFxuICBQQUdFX1VQID0gMzMsICAgIC8vIGFsc28gTlVNX05PUlRIX0VBU1RcbiAgUEFHRV9ET1dOID0gMzQsICAvLyBhbHNvIE5VTV9TT1VUSF9FQVNUXG4gIEVORCA9IDM1LCAgICAgICAgLy8gYWxzbyBOVU1fU09VVEhfV0VTVFxuICBIT01FID0gMzYsICAgICAgIC8vIGFsc28gTlVNX05PUlRIX1dFU1RcbiAgTEVGVCA9IDM3LCAgICAgICAvLyBhbHNvIE5VTV9XRVNUXG4gIFVQID0gMzgsICAgICAgICAgLy8gYWxzbyBOVU1fTk9SVEhcbiAgUklHSFQgPSAzOSwgICAgICAvLyBhbHNvIE5VTV9FQVNUXG4gIERPV04gPSA0MCwgICAgICAgLy8gYWxzbyBOVU1fU09VVEhcbiAgUExVU19TSUdOID0gNDMsICAvLyBOT1QgbnVtcGFkIHBsdXNcbiAgUFJJTlRfU0NSRUVOID0gNDQsXG4gIElOU0VSVCA9IDQ1LCAgLy8gYWxzbyBOVU1fSU5TRVJUXG4gIERFTEVURSA9IDQ2LCAgLy8gYWxzbyBOVU1fREVMRVRFXG4gIFpFUk8gPSA0OCxcbiAgT05FID0gNDksXG4gIFRXTyA9IDUwLFxuICBUSFJFRSA9IDUxLFxuICBGT1VSID0gNTIsXG4gIEZJVkUgPSA1MyxcbiAgU0lYID0gNTQsXG4gIFNFVkVOID0gNTUsXG4gIEVJR0hUID0gNTYsXG4gIE5JTkUgPSA1NyxcbiAgRkZfU0VNSUNPTE9OID0gNTksICAvLyBGaXJlZm94IChHZWNrbykgZmlyZXMgdGhpcyBmb3Igc2VtaWNvbG9uIGluc3RlYWQgb2YgMTg2XG4gIEZGX0VRVUFMUyA9IDYxLCAgICAgLy8gRmlyZWZveCAoR2Vja28pIGZpcmVzIHRoaXMgZm9yIGVxdWFscyBpbnN0ZWFkIG9mIDE4N1xuICBGRl9EQVNIID0gMTczLCAgICAgIC8vIEZpcmVmb3ggKEdlY2tvKSBmaXJlcyB0aGlzIGZvciBkYXNoIGluc3RlYWQgb2YgMTg5XG4gIC8vIEZpcmVmb3ggKEdlY2tvKSBmaXJlcyB0aGlzIGZvciAjIG9uIFVLIGtleWJvYXJkcywgcmF0aGVyIHRoYW5cbiAgLy8gU2hpZnQrU0lOR0xFX1FVT1RFLlxuICBGRl9IQVNIID0gMTYzLFxuICBRVUVTVElPTl9NQVJLID0gNjMsICAvLyBuZWVkcyBsb2NhbGl6YXRpb25cbiAgQVRfU0lHTiA9IDY0LFxuICBBID0gNjUsXG4gIEIgPSA2NixcbiAgQyA9IDY3LFxuICBEID0gNjgsXG4gIEUgPSA2OSxcbiAgRiA9IDcwLFxuICBHID0gNzEsXG4gIEggPSA3MixcbiAgSSA9IDczLFxuICBKID0gNzQsXG4gIEsgPSA3NSxcbiAgTCA9IDc2LFxuICBNID0gNzcsXG4gIE4gPSA3OCxcbiAgTyA9IDc5LFxuICBQID0gODAsXG4gIFEgPSA4MSxcbiAgUiA9IDgyLFxuICBTID0gODMsXG4gIFQgPSA4NCxcbiAgVSA9IDg1LFxuICBWID0gODYsXG4gIFcgPSA4NyxcbiAgWCA9IDg4LFxuICBZID0gODksXG4gIFogPSA5MCxcbiAgTUVUQSA9IDkxLCAgLy8gV0lOX0tFWV9MRUZUXG4gIFdJTl9LRVlfUklHSFQgPSA5MixcbiAgQ09OVEVYVF9NRU5VID0gOTMsXG4gIE5VTV9aRVJPID0gOTYsXG4gIE5VTV9PTkUgPSA5NyxcbiAgTlVNX1RXTyA9IDk4LFxuICBOVU1fVEhSRUUgPSA5OSxcbiAgTlVNX0ZPVVIgPSAxMDAsXG4gIE5VTV9GSVZFID0gMTAxLFxuICBOVU1fU0lYID0gMTAyLFxuICBOVU1fU0VWRU4gPSAxMDMsXG4gIE5VTV9FSUdIVCA9IDEwNCxcbiAgTlVNX05JTkUgPSAxMDUsXG4gIE5VTV9NVUxUSVBMWSA9IDEwNixcbiAgTlVNX1BMVVMgPSAxMDcsXG4gIE5VTV9NSU5VUyA9IDEwOSxcbiAgTlVNX1BFUklPRCA9IDExMCxcbiAgTlVNX0RJVklTSU9OID0gMTExLFxuICBGMSA9IDExMixcbiAgRjIgPSAxMTMsXG4gIEYzID0gMTE0LFxuICBGNCA9IDExNSxcbiAgRjUgPSAxMTYsXG4gIEY2ID0gMTE3LFxuICBGNyA9IDExOCxcbiAgRjggPSAxMTksXG4gIEY5ID0gMTIwLFxuICBGMTAgPSAxMjEsXG4gIEYxMSA9IDEyMixcbiAgRjEyID0gMTIzLFxuICBOVU1MT0NLID0gMTQ0LFxuICBTQ1JPTExfTE9DSyA9IDE0NSxcblxuICAvLyBPUy1zcGVjaWZpYyBtZWRpYSBrZXlzIGxpa2Ugdm9sdW1lIGNvbnRyb2xzIGFuZCBicm93c2VyIGNvbnRyb2xzLlxuICBGSVJTVF9NRURJQV9LRVkgPSAxNjYsXG4gIExBU1RfTUVESUFfS0VZID0gMTgzLFxuXG4gIFNFTUlDT0xPTiA9IDE4NiwgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIERBU0ggPSAxODksICAgICAgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIEVRVUFMUyA9IDE4NywgICAgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIENPTU1BID0gMTg4LCAgICAgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIFBFUklPRCA9IDE5MCwgICAgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIFNMQVNIID0gMTkxLCAgICAgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIEFQT1NUUk9QSEUgPSAxOTIsICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIFRJTERFID0gMTkyLCAgICAgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIFNJTkdMRV9RVU9URSA9IDIyMiwgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIE9QRU5fU1FVQVJFX0JSQUNLRVQgPSAyMTksICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIEJBQ0tTTEFTSCA9IDIyMCwgICAgICAgICAgICAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIENMT1NFX1NRVUFSRV9CUkFDS0VUID0gMjIxLCAgLy8gbmVlZHMgbG9jYWxpemF0aW9uXG4gIFdJTl9LRVkgPSAyMjQsXG4gIE1BQ19GRl9NRVRBID1cbiAgICAgIDIyNCwgIC8vIEZpcmVmb3ggKEdlY2tvKSBmaXJlcyB0aGlzIGZvciB0aGUgbWV0YSBrZXkgaW5zdGVhZCBvZiA5MVxuICBNQUNfV0tfQ01EX0xFRlQgPSA5MSwgICAvLyBXZWJLaXQgTGVmdCBDb21tYW5kIGtleSBmaXJlZCwgc2FtZSBhcyBNRVRBXG4gIE1BQ19XS19DTURfUklHSFQgPSA5MywgIC8vIFdlYktpdCBSaWdodCBDb21tYW5kIGtleSBmaXJlZCwgZGlmZmVyZW50IGZyb20gTUVUQVxuICBXSU5fSU1FID0gMjI5LFxuXG4gIC8vIFwiUmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2VcIi4gU29tZSBwcm9ncmFtcyAoZS5nLiB0aGUgU2xpbmdQbGF5ZXIgMi40IEFjdGl2ZVhcbiAgLy8gY29udHJvbCkgZmlyZSB0aGlzIGFzIGEgaGFja3kgd2F5IHRvIGRpc2FibGUgc2NyZWVuc2F2ZXJzLlxuICBWS19OT05BTUUgPSAyNTIsXG5cbiAgLy8gV2UndmUgc2VlbiB1c2VycyB3aG9zZSBtYWNoaW5lcyBmaXJlIHRoaXMga2V5Y29kZSBhdCByZWd1bGFyIG9uZVxuICAvLyBzZWNvbmQgaW50ZXJ2YWxzLiBUaGUgY29tbW9uIHRocmVhZCBhbW9uZyB0aGVzZSB1c2VycyBpcyB0aGF0XG4gIC8vIHRoZXkncmUgYWxsIHVzaW5nIERlbGwgSW5zcGlyb24gbGFwdG9wcywgc28gd2Ugc3VzcGVjdCB0aGF0IHRoaXNcbiAgLy8gaW5kaWNhdGVzIGEgaGFyZHdhcmUvYmlvcyBwcm9ibGVtLlxuICAvLyBodHRwOi8vZW4uY29tbXVuaXR5LmRlbGwuY29tL3N1cHBvcnQtZm9ydW1zL2xhcHRvcC9mLzM1MTgvcC8xOTI4NTk1Ny8xOTUyMzEyOC5hc3B4XG4gIFBIQU5UT00gPSAyNTUsXG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQmxvY2tseSBtZW51IHNpbWlsYXIgdG8gQ2xvc3VyZSdzIGdvb2cudWkuTWVudVxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5Lk1lbnUnKTtcblxuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCB0eXBlIHtNZW51SXRlbX0gZnJvbSAnLi9tZW51aXRlbS5qcyc7XG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtLZXlDb2Rlc30gZnJvbSAnLi91dGlscy9rZXljb2Rlcy5qcyc7XG5pbXBvcnQgdHlwZSB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCAqIGFzIHN0eWxlIGZyb20gJy4vdXRpbHMvc3R5bGUuanMnO1xuXG5cbi8qKlxuICogQSBiYXNpYyBtZW51IGNsYXNzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5Lk1lbnVcbiAqL1xuZXhwb3J0IGNsYXNzIE1lbnUge1xuICAvKipcbiAgICogQXJyYXkgb2YgbWVudSBpdGVtcy5cbiAgICogKE51bGxzIGFyZSBuZXZlciBpbiB0aGUgYXJyYXksIGJ1dCB0eXBpbmcgdGhlIGFycmF5IGFzIG51bGxhYmxlIHByZXZlbnRzXG4gICAqIHRoZSBjb21waWxlciBmcm9tIG9iamVjdGluZyB0byAuaW5kZXhPZihudWxsKSlcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgbWVudUl0ZW1zOiBNZW51SXRlbVtdID0gW107XG5cbiAgLyoqXG4gICAqIENvb3JkaW5hdGVzIG9mIHRoZSBtb3VzZWRvd24gZXZlbnQgdGhhdCBjYXVzZWQgdGhpcyBtZW51IHRvIG9wZW4uIFVzZWQgdG9cbiAgICogcHJldmVudCB0aGUgY29uc2VxdWVudCBtb3VzZXVwIGV2ZW50IGR1ZSB0byBhIHNpbXBsZSBjbGljayBmcm9tXG4gICAqIGFjdGl2YXRpbmcgYSBtZW51IGl0ZW0gaW1tZWRpYXRlbHkuXG4gICAqL1xuICBvcGVuaW5nQ29vcmRzOiBDb29yZGluYXRlfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHRoZSBlbGVtZW50IHRoYXQgd2Ugd2lsbCBsaXN0ZW4gdG8gdGhlIHJlYWwgZm9jdXMgZXZlbnRzIG9uLlxuICAgKiBBIHZhbHVlIG9mIG51bGwgbWVhbnMgbm8gbWVudSBpdGVtIGlzIGhpZ2hsaWdodGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBoaWdobGlnaHRlZEl0ZW06IE1lbnVJdGVtfG51bGwgPSBudWxsO1xuXG4gIC8qKiBNb3VzZSBvdmVyIGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgbW91c2VPdmVySGFuZGxlcjogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKiBDbGljayBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIGNsaWNrSGFuZGxlcjogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKiBNb3VzZSBlbnRlciBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIG1vdXNlRW50ZXJIYW5kbGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIE1vdXNlIGxlYXZlIGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgbW91c2VMZWF2ZUhhbmRsZXI6IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogS2V5IGRvd24gZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbktleURvd25IYW5kbGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBtZW51J3Mgcm9vdCBET00gZWxlbWVudC4gKi9cbiAgcHJpdmF0ZSBlbGVtZW50OiBIVE1MRGl2RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogQVJJQSBuYW1lIGZvciB0aGlzIG1lbnUuICovXG4gIHByaXZhdGUgcm9sZU5hbWU6IGFyaWEuUm9sZXxudWxsID0gbnVsbDtcblxuICAvKiogQ29uc3RydWN0cyBhIG5ldyBNZW51IGluc3RhbmNlLiAqL1xuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyBtZW51IGl0ZW0gdG8gdGhlIGJvdHRvbSBvZiB0aGlzIG1lbnUuXG4gICAqXG4gICAqIEBwYXJhbSBtZW51SXRlbSBNZW51IGl0ZW0gdG8gYXBwZW5kLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGFkZENoaWxkKG1lbnVJdGVtOiBNZW51SXRlbSkge1xuICAgIHRoaXMubWVudUl0ZW1zLnB1c2gobWVudUl0ZW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIG1lbnUgRE9NLlxuICAgKlxuICAgKiBAcGFyYW0gY29udGFpbmVyIEVsZW1lbnQgdXBvbiB3aGljaCB0byBhcHBlbmQgdGhpcyBtZW51LlxuICAgKiBAcmV0dXJucyBUaGUgbWVudSdzIHJvb3QgRE9NIGVsZW1lbnQuXG4gICAqL1xuICByZW5kZXIoY29udGFpbmVyOiBFbGVtZW50KTogSFRNTERpdkVsZW1lbnQge1xuICAgIGNvbnN0IGVsZW1lbnQgPSAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICAgIC8vIGdvb2ctbWVudSBpcyBkZXByZWNhdGVkLCB1c2UgYmxvY2tseU1lbnUuICBNYXkgMjAyMC5cbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICdibG9ja2x5TWVudSBnb29nLW1lbnUgYmxvY2tseU5vblNlbGVjdGFibGUnO1xuICAgIGVsZW1lbnQudGFiSW5kZXggPSAwO1xuICAgIGlmICh0aGlzLnJvbGVOYW1lKSB7XG4gICAgICBhcmlhLnNldFJvbGUoZWxlbWVudCwgdGhpcy5yb2xlTmFtZSk7XG4gICAgfVxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG5cbiAgICAvLyBBZGQgbWVudSBpdGVtcy5cbiAgICBmb3IgKGxldCBpID0gMCwgbWVudUl0ZW07IG1lbnVJdGVtID0gdGhpcy5tZW51SXRlbXNbaV07IGkrKykge1xuICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChtZW51SXRlbS5jcmVhdGVEb20oKSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzLlxuICAgIHRoaXMubW91c2VPdmVySGFuZGxlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBlbGVtZW50LCAncG9pbnRlcm92ZXInLCB0aGlzLCB0aGlzLmhhbmRsZU1vdXNlT3ZlciwgdHJ1ZSk7XG4gICAgdGhpcy5jbGlja0hhbmRsZXIgPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgZWxlbWVudCwgJ3BvaW50ZXJkb3duJywgdGhpcywgdGhpcy5oYW5kbGVDbGljaywgdHJ1ZSk7XG4gICAgdGhpcy5tb3VzZUVudGVySGFuZGxlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBlbGVtZW50LCAncG9pbnRlcmVudGVyJywgdGhpcywgdGhpcy5oYW5kbGVNb3VzZUVudGVyLCB0cnVlKTtcbiAgICB0aGlzLm1vdXNlTGVhdmVIYW5kbGVyID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIGVsZW1lbnQsICdwb2ludGVybGVhdmUnLCB0aGlzLCB0aGlzLmhhbmRsZU1vdXNlTGVhdmUsIHRydWUpO1xuICAgIHRoaXMub25LZXlEb3duSGFuZGxlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBlbGVtZW50LCAna2V5ZG93bicsIHRoaXMsIHRoaXMuaGFuZGxlS2V5RXZlbnQpO1xuXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG1lbnUncyBlbGVtZW50LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgRE9NIGVsZW1lbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0RWxlbWVudCgpOiBIVE1MRGl2RWxlbWVudHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEZvY3VzIHRoZSBtZW51IGVsZW1lbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZm9jdXMoKSB7XG4gICAgY29uc3QgZWwgPSB0aGlzLmdldEVsZW1lbnQoKTtcbiAgICBpZiAoZWwpIHtcbiAgICAgIGVsLmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG4gICAgICBkb20uYWRkQ2xhc3MoZWwsICdibG9ja2x5Rm9jdXNlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBCbHVyIHRoZSBtZW51IGVsZW1lbnQuICovXG4gIHByaXZhdGUgYmx1cigpIHtcbiAgICBjb25zdCBlbCA9IHRoaXMuZ2V0RWxlbWVudCgpO1xuICAgIGlmIChlbCkge1xuICAgICAgZWwuYmx1cigpO1xuICAgICAgZG9tLnJlbW92ZUNsYXNzKGVsLCAnYmxvY2tseUZvY3VzZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBtZW51IGFjY2Vzc2liaWxpdHkgcm9sZS5cbiAgICpcbiAgICogQHBhcmFtIHJvbGVOYW1lIHJvbGUgbmFtZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRSb2xlKHJvbGVOYW1lOiBhcmlhLlJvbGUpIHtcbiAgICB0aGlzLnJvbGVOYW1lID0gcm9sZU5hbWU7XG4gIH1cblxuICAvKiogRGlzcG9zZSBvZiB0aGlzIG1lbnUuICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgLy8gUmVtb3ZlIGV2ZW50IGhhbmRsZXJzLlxuICAgIGlmICh0aGlzLm1vdXNlT3ZlckhhbmRsZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMubW91c2VPdmVySGFuZGxlcik7XG4gICAgICB0aGlzLm1vdXNlT3ZlckhhbmRsZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMuY2xpY2tIYW5kbGVyKTtcbiAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMubW91c2VFbnRlckhhbmRsZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMubW91c2VFbnRlckhhbmRsZXIpO1xuICAgICAgdGhpcy5tb3VzZUVudGVySGFuZGxlciA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLm1vdXNlTGVhdmVIYW5kbGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm1vdXNlTGVhdmVIYW5kbGVyKTtcbiAgICAgIHRoaXMubW91c2VMZWF2ZUhhbmRsZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5vbktleURvd25IYW5kbGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uS2V5RG93bkhhbmRsZXIpO1xuICAgICAgdGhpcy5vbktleURvd25IYW5kbGVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgbWVudSBpdGVtcy5cbiAgICBmb3IgKGxldCBpID0gMCwgbWVudUl0ZW07IG1lbnVJdGVtID0gdGhpcy5tZW51SXRlbXNbaV07IGkrKykge1xuICAgICAgbWVudUl0ZW0uZGlzcG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgLy8gQ2hpbGQgY29tcG9uZW50IG1hbmFnZW1lbnQuXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNoaWxkIG1lbnUgaXRlbSB0aGF0IG93bnMgdGhlIGdpdmVuIERPTSBlbGVtZW50LFxuICAgKiBvciBudWxsIGlmIG5vIHN1Y2ggbWVudSBpdGVtIGlzIGZvdW5kLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBET00gZWxlbWVudCB3aG9zZSBvd25lciBpcyB0byBiZSByZXR1cm5lZC5cbiAgICogQHJldHVybnMgTWVudSBpdGVtIGZvciB3aGljaCB0aGUgRE9NIGVsZW1lbnQgYmVsb25ncyB0by5cbiAgICovXG4gIHByaXZhdGUgZ2V0TWVudUl0ZW0oZWxlbTogRWxlbWVudCk6IE1lbnVJdGVtfG51bGwge1xuICAgIGNvbnN0IG1lbnVFbGVtID0gdGhpcy5nZXRFbGVtZW50KCk7XG4gICAgLy8gTm9kZSBtaWdodCBiZSB0aGUgbWVudSBib3JkZXIgKHJlc3VsdGluZyBpbiBubyBhc3NvY2lhdGVkIG1lbnUgaXRlbSksIG9yXG4gICAgLy8gYSBtZW51IGl0ZW0ncyBkaXYsIG9yIHNvbWUgZWxlbWVudCB3aXRoaW4gdGhlIG1lbnUgaXRlbS5cbiAgICAvLyBXYWxrIHVwIHBhcmVudHMgdW50aWwgb25lIG1lZXRzIGVpdGhlciB0aGUgbWVudSdzIHJvb3QgZWxlbWVudCwgb3JcbiAgICAvLyBhIG1lbnUgaXRlbSdzIGRpdi5cbiAgICBsZXQgY3VycmVudEVsZW1lbnQ6IEVsZW1lbnR8bnVsbCA9IGVsZW07XG4gICAgd2hpbGUgKGN1cnJlbnRFbGVtZW50ICYmIGN1cnJlbnRFbGVtZW50ICE9PSBtZW51RWxlbSkge1xuICAgICAgaWYgKGN1cnJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYmxvY2tseU1lbnVJdGVtJykpIHtcbiAgICAgICAgLy8gSGF2aW5nIGZvdW5kIGEgbWVudSBpdGVtJ3MgZGl2LCBsb2NhdGUgdGhhdCBtZW51IGl0ZW0gaW4gdGhpcyBtZW51LlxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbWVudUl0ZW07IG1lbnVJdGVtID0gdGhpcy5tZW51SXRlbXNbaV07IGkrKykge1xuICAgICAgICAgIGlmIChtZW51SXRlbS5nZXRFbGVtZW50KCkgPT09IGN1cnJlbnRFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gbWVudUl0ZW07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjdXJyZW50RWxlbWVudCA9IGN1cnJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gSGlnaGxpZ2h0IG1hbmFnZW1lbnQuXG5cbiAgLyoqXG4gICAqIEhpZ2hsaWdodHMgdGhlIGdpdmVuIG1lbnUgaXRlbSwgb3IgY2xlYXJzIGhpZ2hsaWdodGluZyBpZiBudWxsLlxuICAgKlxuICAgKiBAcGFyYW0gaXRlbSBJdGVtIHRvIGhpZ2hsaWdodCwgb3IgbnVsbC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRIaWdobGlnaHRlZChpdGVtOiBNZW51SXRlbXxudWxsKSB7XG4gICAgY29uc3QgY3VycmVudEhpZ2hsaWdodGVkID0gdGhpcy5oaWdobGlnaHRlZEl0ZW07XG4gICAgaWYgKGN1cnJlbnRIaWdobGlnaHRlZCkge1xuICAgICAgY3VycmVudEhpZ2hsaWdodGVkLnNldEhpZ2hsaWdodGVkKGZhbHNlKTtcbiAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRJdGVtID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKGl0ZW0pIHtcbiAgICAgIGl0ZW0uc2V0SGlnaGxpZ2h0ZWQodHJ1ZSk7XG4gICAgICB0aGlzLmhpZ2hsaWdodGVkSXRlbSA9IGl0ZW07XG4gICAgICAvLyBCcmluZyB0aGUgaGlnaGxpZ2h0ZWQgaXRlbSBpbnRvIHZpZXcuIFRoaXMgaGFzIG5vIGVmZmVjdCBpZiB0aGUgbWVudSBpc1xuICAgICAgLy8gbm90IHNjcm9sbGFibGUuXG4gICAgICBjb25zdCBlbCA9IHRoaXMuZ2V0RWxlbWVudCgpIGFzIEVsZW1lbnQ7XG4gICAgICBzdHlsZS5zY3JvbGxJbnRvQ29udGFpbmVyVmlldyhpdGVtLmdldEVsZW1lbnQoKSBhcyBFbGVtZW50LCBlbCk7XG5cbiAgICAgIGFyaWEuc2V0U3RhdGUoZWwsIGFyaWEuU3RhdGUuQUNUSVZFREVTQ0VOREFOVCwgaXRlbS5nZXRJZCgpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGlnaGxpZ2h0cyB0aGUgbmV4dCBoaWdobGlnaHRhYmxlIGl0ZW0gKG9yIHRoZSBmaXJzdCBpZiBub3RoaW5nIGlzXG4gICAqIGN1cnJlbnRseSBoaWdobGlnaHRlZCkuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGlnaGxpZ2h0TmV4dCgpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuaGlnaGxpZ2h0ZWRJdGVtID9cbiAgICAgICAgdGhpcy5tZW51SXRlbXMuaW5kZXhPZih0aGlzLmhpZ2hsaWdodGVkSXRlbSkgOlxuICAgICAgICAtMTtcbiAgICB0aGlzLmhpZ2hsaWdodEhlbHBlcihpbmRleCwgMSk7XG4gIH1cblxuICAvKipcbiAgICogSGlnaGxpZ2h0cyB0aGUgcHJldmlvdXMgaGlnaGxpZ2h0YWJsZSBpdGVtIChvciB0aGUgbGFzdCBpZiBub3RoaW5nIGlzXG4gICAqIGN1cnJlbnRseSBoaWdobGlnaHRlZCkuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGlnaGxpZ2h0UHJldmlvdXMoKSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmhpZ2hsaWdodGVkSXRlbSA/XG4gICAgICAgIHRoaXMubWVudUl0ZW1zLmluZGV4T2YodGhpcy5oaWdobGlnaHRlZEl0ZW0pIDpcbiAgICAgICAgLTE7XG4gICAgdGhpcy5oaWdobGlnaHRIZWxwZXIoaW5kZXggPCAwID8gdGhpcy5tZW51SXRlbXMubGVuZ3RoIDogaW5kZXgsIC0xKTtcbiAgfVxuXG4gIC8qKiBIaWdobGlnaHRzIHRoZSBmaXJzdCBoaWdobGlnaHRhYmxlIGl0ZW0uICovXG4gIHByaXZhdGUgaGlnaGxpZ2h0Rmlyc3QoKSB7XG4gICAgdGhpcy5oaWdobGlnaHRIZWxwZXIoLTEsIDEpO1xuICB9XG5cbiAgLyoqIEhpZ2hsaWdodHMgdGhlIGxhc3QgaGlnaGxpZ2h0YWJsZSBpdGVtLiAqL1xuICBwcml2YXRlIGhpZ2hsaWdodExhc3QoKSB7XG4gICAgdGhpcy5oaWdobGlnaHRIZWxwZXIodGhpcy5tZW51SXRlbXMubGVuZ3RoLCAtMSk7XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgbWFuYWdlcyB0aGUgZGV0YWlscyBvZiBtb3ZpbmcgdGhlIGhpZ2hsaWdodCBhbW9uZ1xuICAgKiBjaGlsZCBtZW51aXRlbXMgaW4gcmVzcG9uc2UgdG8ga2V5Ym9hcmQgZXZlbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhcnRJbmRleCBTdGFydCBpbmRleC5cbiAgICogQHBhcmFtIGRlbHRhIFN0ZXAgZGlyZWN0aW9uOiAxIHRvIGdvIGRvd24sIC0xIHRvIGdvIHVwLlxuICAgKi9cbiAgcHJpdmF0ZSBoaWdobGlnaHRIZWxwZXIoc3RhcnRJbmRleDogbnVtYmVyLCBkZWx0YTogbnVtYmVyKSB7XG4gICAgbGV0IGluZGV4ID0gc3RhcnRJbmRleCArIGRlbHRhO1xuICAgIGxldCBtZW51SXRlbTtcbiAgICB3aGlsZSAobWVudUl0ZW0gPSB0aGlzLm1lbnVJdGVtc1tpbmRleF0pIHtcbiAgICAgIGlmIChtZW51SXRlbS5pc0VuYWJsZWQoKSkge1xuICAgICAgICB0aGlzLnNldEhpZ2hsaWdodGVkKG1lbnVJdGVtKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpbmRleCArPSBkZWx0YTtcbiAgICB9XG4gIH1cblxuICAvLyBNb3VzZSBldmVudHMuXG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgbW91c2VvdmVyIGV2ZW50cy4gSGlnaGxpZ2h0IG1lbnVpdGVtcyBhcyB0aGUgdXNlciBob3ZlcnMgb3ZlciB0aGVtLlxuICAgKlxuICAgKiBAcGFyYW0gZSBNb3VzZSBldmVudCB0byBoYW5kbGUuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU1vdXNlT3ZlcihlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBjb25zdCBtZW51SXRlbSA9IHRoaXMuZ2V0TWVudUl0ZW0oZS50YXJnZXQgYXMgRWxlbWVudCk7XG5cbiAgICBpZiAobWVudUl0ZW0pIHtcbiAgICAgIGlmIChtZW51SXRlbS5pc0VuYWJsZWQoKSkge1xuICAgICAgICBpZiAodGhpcy5oaWdobGlnaHRlZEl0ZW0gIT09IG1lbnVJdGVtKSB7XG4gICAgICAgICAgdGhpcy5zZXRIaWdobGlnaHRlZChtZW51SXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0SGlnaGxpZ2h0ZWQobnVsbCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgY2xpY2sgZXZlbnRzLiBQYXNzIHRoZSBldmVudCBvbnRvIHRoZSBjaGlsZCBtZW51aXRlbSB0byBoYW5kbGUuXG4gICAqXG4gICAqIEBwYXJhbSBlIENsaWNrIGV2ZW50IHRvIGhhbmRsZS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlQ2xpY2soZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3Qgb2xkQ29vcmRzID0gdGhpcy5vcGVuaW5nQ29vcmRzO1xuICAgIC8vIENsZWFyIG91dCB0aGUgc2F2ZWQgb3BlbmluZyBjb29yZHMgaW1tZWRpYXRlbHkgc28gdGhleSdyZSBub3QgdXNlZCB0d2ljZS5cbiAgICB0aGlzLm9wZW5pbmdDb29yZHMgPSBudWxsO1xuICAgIGlmIChvbGRDb29yZHMgJiYgdHlwZW9mIGUuY2xpZW50WCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IG5ldyBDb29yZGluYXRlKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgIGlmIChDb29yZGluYXRlLmRpc3RhbmNlKG9sZENvb3JkcywgbmV3Q29vcmRzKSA8IDEpIHtcbiAgICAgICAgLy8gVGhpcyBtZW51IHdhcyBvcGVuZWQgYnkgYSBtb3VzZWRvd24gYW5kIHdlJ3JlIGhhbmRsaW5nIHRoZSBjb25zZXF1ZW50XG4gICAgICAgIC8vIGNsaWNrIGV2ZW50LiBUaGUgY29vcmRzIGhhdmVuJ3QgY2hhbmdlZCwgbWVhbmluZyB0aGlzIHdhcyB0aGUgc2FtZVxuICAgICAgICAvLyBvcGVuaW5nIGV2ZW50LiBEb24ndCBkbyB0aGUgdXN1YWwgYmVoYXZpb3IgYmVjYXVzZSB0aGUgbWVudSBqdXN0XG4gICAgICAgIC8vIHBvcHBlZCB1cCB1bmRlciB0aGUgbW91c2UgYW5kIHRoZSB1c2VyIGRpZG4ndCBtZWFuIHRvIGFjdGl2YXRlIHRoaXNcbiAgICAgICAgLy8gaXRlbS5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG1lbnVJdGVtID0gdGhpcy5nZXRNZW51SXRlbShlLnRhcmdldCBhcyBFbGVtZW50KTtcbiAgICBpZiAobWVudUl0ZW0pIHtcbiAgICAgIG1lbnVJdGVtLnBlcmZvcm1BY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyBtb3VzZSBlbnRlciBldmVudHMuIEZvY3VzIHRoZSBlbGVtZW50LlxuICAgKlxuICAgKiBAcGFyYW0gX2UgTW91c2UgZXZlbnQgdG8gaGFuZGxlLlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVNb3VzZUVudGVyKF9lOiBQb2ludGVyRXZlbnQpIHtcbiAgICB0aGlzLmZvY3VzKCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyBtb3VzZSBsZWF2ZSBldmVudHMuIEJsdXIgYW5kIGNsZWFyIGhpZ2hsaWdodC5cbiAgICpcbiAgICogQHBhcmFtIF9lIE1vdXNlIGV2ZW50IHRvIGhhbmRsZS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlTW91c2VMZWF2ZShfZTogUG9pbnRlckV2ZW50KSB7XG4gICAgaWYgKHRoaXMuZ2V0RWxlbWVudCgpKSB7XG4gICAgICB0aGlzLmJsdXIoKTtcbiAgICAgIHRoaXMuc2V0SGlnaGxpZ2h0ZWQobnVsbCk7XG4gICAgfVxuICB9XG5cbiAgLy8gS2V5Ym9hcmQgZXZlbnRzLlxuXG4gIC8qKlxuICAgKiBBdHRlbXB0cyB0byBoYW5kbGUgYSBrZXlib2FyZCBldmVudCwgaWYgdGhlIG1lbnUgaXRlbSBpcyBlbmFibGVkLCBieVxuICAgKiBjYWxsaW5nXG4gICAqIHtAbGluayBNZW51I2hhbmRsZUtleUV2ZW50SW50ZXJuYWxffS5cbiAgICpcbiAgICogQHBhcmFtIGUgS2V5IGV2ZW50IHRvIGhhbmRsZS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlS2V5RXZlbnQoZTogRXZlbnQpIHtcbiAgICBpZiAoIXRoaXMubWVudUl0ZW1zLmxlbmd0aCkge1xuICAgICAgLy8gRW1wdHkgbWVudS5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qga2V5Ym9hcmRFdmVudCA9IGUgYXMgS2V5Ym9hcmRFdmVudDtcbiAgICBpZiAoa2V5Ym9hcmRFdmVudC5zaGlmdEtleSB8fCBrZXlib2FyZEV2ZW50LmN0cmxLZXkgfHxcbiAgICAgICAga2V5Ym9hcmRFdmVudC5tZXRhS2V5IHx8IGtleWJvYXJkRXZlbnQuYWx0S2V5KSB7XG4gICAgICAvLyBEbyBub3QgaGFuZGxlIHRoZSBrZXkgZXZlbnQgaWYgYW55IG1vZGlmaWVyIGtleSBpcyBwcmVzc2VkLlxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGhpZ2hsaWdodGVkID0gdGhpcy5oaWdobGlnaHRlZEl0ZW07XG4gICAgc3dpdGNoIChrZXlib2FyZEV2ZW50LmtleUNvZGUpIHtcbiAgICAgIGNhc2UgS2V5Q29kZXMuRU5URVI6XG4gICAgICBjYXNlIEtleUNvZGVzLlNQQUNFOlxuICAgICAgICBpZiAoaGlnaGxpZ2h0ZWQpIHtcbiAgICAgICAgICBoaWdobGlnaHRlZC5wZXJmb3JtQWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgS2V5Q29kZXMuVVA6XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0UHJldmlvdXMoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgS2V5Q29kZXMuRE9XTjpcbiAgICAgICAgdGhpcy5oaWdobGlnaHROZXh0KCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIEtleUNvZGVzLlBBR0VfVVA6XG4gICAgICBjYXNlIEtleUNvZGVzLkhPTUU6XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0Rmlyc3QoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgS2V5Q29kZXMuUEFHRV9ET1dOOlxuICAgICAgY2FzZSBLZXlDb2Rlcy5FTkQ6XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0TGFzdCgpO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gTm90IGEga2V5IHRoZSBtZW51IGlzIGludGVyZXN0ZWQgaW4uXG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gVGhlIG1lbnUgdXNlZCB0aGlzIGtleSwgZG9uJ3QgbGV0IGl0IGhhdmUgc2Vjb25kYXJ5IGVmZmVjdHMuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzaXplIG9mIGEgcmVuZGVyZWQgbWVudS5cbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IHdpdGggd2lkdGggYW5kIGhlaWdodCBwcm9wZXJ0aWVzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFNpemUoKTogU2l6ZSB7XG4gICAgY29uc3QgbWVudURvbSA9IHRoaXMuZ2V0RWxlbWVudCgpIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgIGNvbnN0IG1lbnVTaXplID0gc3R5bGUuZ2V0U2l6ZShtZW51RG9tKTtcbiAgICAvLyBSZWNhbGN1bGF0ZSBoZWlnaHQgZm9yIHRoZSB0b3RhbCBjb250ZW50LCBub3Qgb25seSBib3ggaGVpZ2h0LlxuICAgIG1lbnVTaXplLmhlaWdodCA9IG1lbnVEb20uc2Nyb2xsSGVpZ2h0O1xuICAgIHJldHVybiBtZW51U2l6ZTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEJsb2NrbHkgbWVudSBpdGVtIHNpbWlsYXIgdG8gQ2xvc3VyZSdzIGdvb2cudWkuTWVudUl0ZW1cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5NZW51SXRlbScpO1xuXG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0ICogYXMgaWRHZW5lcmF0b3IgZnJvbSAnLi91dGlscy9pZGdlbmVyYXRvci5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgYW4gaXRlbSBpbiBhIG1lbnUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuTWVudUl0ZW1cbiAqL1xuZXhwb3J0IGNsYXNzIE1lbnVJdGVtIHtcbiAgLyoqIElzIHRoZSBtZW51IGl0ZW0gY2xpY2thYmxlLCBhcyBvcHBvc2VkIHRvIGdyZXllZC1vdXQuICovXG4gIHByaXZhdGUgZW5hYmxlZCA9IHRydWU7XG5cbiAgLyoqIFRoZSBET00gZWxlbWVudCBmb3IgdGhlIG1lbnUgaXRlbS4gKi9cbiAgcHJpdmF0ZSBlbGVtZW50OiBIVE1MRGl2RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogV2hldGhlciB0aGUgbWVudSBpdGVtIGlzIHJlbmRlcmVkIHJpZ2h0LXRvLWxlZnQuICovXG4gIHByaXZhdGUgcmlnaHRUb0xlZnQgPSBmYWxzZTtcblxuICAvKiogQVJJQSBuYW1lIGZvciB0aGlzIG1lbnUuICovXG4gIHByaXZhdGUgcm9sZU5hbWU6IGFyaWEuUm9sZXxudWxsID0gbnVsbDtcblxuICAvKiogSXMgdGhpcyBtZW51IGl0ZW0gY2hlY2thYmxlLiAqL1xuICBwcml2YXRlIGNoZWNrYWJsZSA9IGZhbHNlO1xuXG4gIC8qKiBJcyB0aGlzIG1lbnUgaXRlbSBjdXJyZW50bHkgY2hlY2tlZC4gKi9cbiAgcHJpdmF0ZSBjaGVja2VkID0gZmFsc2U7XG5cbiAgLyoqIElzIHRoaXMgbWVudSBpdGVtIGN1cnJlbnRseSBoaWdobGlnaHRlZC4gKi9cbiAgcHJpdmF0ZSBoaWdobGlnaHQgPSBmYWxzZTtcblxuICAvKiogQm91bmQgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoaXMgbWVudSBpdGVtIGlzIGNsaWNrZWQuICovXG4gIHByaXZhdGUgYWN0aW9uSGFuZGxlcjogRnVuY3Rpb258bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb250ZW50IFRleHQgY2FwdGlvbiB0byBkaXNwbGF5IGFzIHRoZSBjb250ZW50IG9mIHRoZSBpdGVtLCBvciBhXG4gICAqICAgICBIVE1MIGVsZW1lbnQgdG8gZGlzcGxheS5cbiAgICogQHBhcmFtIG9wdF92YWx1ZSBEYXRhL21vZGVsIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWVudSBpdGVtLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBwcml2YXRlIHJlYWRvbmx5IGNvbnRlbnQ6IHN0cmluZ3xIVE1MRWxlbWVudCxcbiAgICAgIHByaXZhdGUgcmVhZG9ubHkgb3B0X3ZhbHVlPzogc3RyaW5nKSB7fVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRoZSBtZW51aXRlbSdzIERPTS5cbiAgICpcbiAgICogQHJldHVybnMgQ29tcGxldGVkIERPTS5cbiAgICovXG4gIGNyZWF0ZURvbSgpOiBFbGVtZW50IHtcbiAgICBjb25zdCBlbGVtZW50ID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTtcbiAgICBlbGVtZW50LmlkID0gaWRHZW5lcmF0b3IuZ2V0TmV4dFVuaXF1ZUlkKCk7XG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcblxuICAgIC8vIFNldCBjbGFzcyBhbmQgc3R5bGVcbiAgICAvLyBnb29nLW1lbnVpdGVtKiBpcyBkZXByZWNhdGVkLCB1c2UgYmxvY2tseU1lbnVJdGVtKi4gIE1heSAyMDIwLlxuICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gJ2Jsb2NrbHlNZW51SXRlbSBnb29nLW1lbnVpdGVtICcgK1xuICAgICAgICAodGhpcy5lbmFibGVkID8gJycgOlxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Jsb2NrbHlNZW51SXRlbURpc2FibGVkIGdvb2ctbWVudWl0ZW0tZGlzYWJsZWQgJykgK1xuICAgICAgICAodGhpcy5jaGVja2VkID8gJ2Jsb2NrbHlNZW51SXRlbVNlbGVjdGVkIGdvb2ctb3B0aW9uLXNlbGVjdGVkICcgOiAnJykgK1xuICAgICAgICAodGhpcy5oaWdobGlnaHQgPyAnYmxvY2tseU1lbnVJdGVtSGlnaGxpZ2h0IGdvb2ctbWVudWl0ZW0taGlnaGxpZ2h0ICcgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAnJykgK1xuICAgICAgICAodGhpcy5yaWdodFRvTGVmdCA/ICdibG9ja2x5TWVudUl0ZW1SdGwgZ29vZy1tZW51aXRlbS1ydGwgJyA6ICcnKTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICAgIGNvbnRlbnQuY2xhc3NOYW1lID0gJ2Jsb2NrbHlNZW51SXRlbUNvbnRlbnQgZ29vZy1tZW51aXRlbS1jb250ZW50JztcbiAgICAvLyBBZGQgYSBjaGVja2JveCBmb3IgY2hlY2thYmxlIG1lbnUgaXRlbXMuXG4gICAgaWYgKHRoaXMuY2hlY2thYmxlKSB7XG4gICAgICBjb25zdCBjaGVja2JveCA9IChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XG4gICAgICBjaGVja2JveC5jbGFzc05hbWUgPSAnYmxvY2tseU1lbnVJdGVtQ2hlY2tib3ggZ29vZy1tZW51aXRlbS1jaGVja2JveCc7XG4gICAgICBjb250ZW50LmFwcGVuZENoaWxkKGNoZWNrYm94KTtcbiAgICB9XG5cbiAgICBsZXQgY29udGVudERvbTogTm9kZSA9IHRoaXMuY29udGVudCBhcyBIVE1MRWxlbWVudDtcbiAgICBpZiAodHlwZW9mIHRoaXMuY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnRlbnREb20gPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmNvbnRlbnQpO1xuICAgIH1cbiAgICBjb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnREb20pO1xuICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQoY29udGVudCk7XG5cbiAgICAvLyBJbml0aWFsaXplIEFSSUEgcm9sZSBhbmQgc3RhdGUuXG4gICAgaWYgKHRoaXMucm9sZU5hbWUpIHtcbiAgICAgIGFyaWEuc2V0Um9sZShlbGVtZW50LCB0aGlzLnJvbGVOYW1lKTtcbiAgICB9XG4gICAgYXJpYS5zZXRTdGF0ZShcbiAgICAgICAgZWxlbWVudCwgYXJpYS5TdGF0ZS5TRUxFQ1RFRCwgdGhpcy5jaGVja2FibGUgJiYgdGhpcy5jaGVja2VkIHx8IGZhbHNlKTtcbiAgICBhcmlhLnNldFN0YXRlKGVsZW1lbnQsIGFyaWEuU3RhdGUuRElTQUJMRUQsICF0aGlzLmVuYWJsZWQpO1xuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICAvKiogRGlzcG9zZSBvZiB0aGlzIG1lbnUgaXRlbS4gKi9cbiAgZGlzcG9zZSgpIHtcbiAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG1lbnUgaXRlbSdzIGVsZW1lbnQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBET00gZWxlbWVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRFbGVtZW50KCk6IEVsZW1lbnR8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB1bmlxdWUgSUQgZm9yIHRoaXMgbWVudSBpdGVtLlxuICAgKlxuICAgKiBAcmV0dXJucyBVbmlxdWUgY29tcG9uZW50IElELlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudCEuaWQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRoZSBtZW51IGl0ZW0uXG4gICAqXG4gICAqIEByZXR1cm5zIHZhbHVlIFZhbHVlIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWVudSBpdGVtLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFZhbHVlKCk6IHN0cmluZ3xudWxsIHtcbiAgICByZXR1cm4gdGhpcy5vcHRfdmFsdWUgPz8gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbWVudSBpdGVtJ3MgcmVuZGVyaW5nIGRpcmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHJ0bCBUcnVlIGlmIFJUTCwgZmFsc2UgaWYgTFRSLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldFJpZ2h0VG9MZWZ0KHJ0bDogYm9vbGVhbikge1xuICAgIHRoaXMucmlnaHRUb0xlZnQgPSBydGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBtZW51IGl0ZW0ncyBhY2Nlc3NpYmlsaXR5IHJvbGUuXG4gICAqXG4gICAqIEBwYXJhbSByb2xlTmFtZSBSb2xlIG5hbWUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Um9sZShyb2xlTmFtZTogYXJpYS5Sb2xlKSB7XG4gICAgdGhpcy5yb2xlTmFtZSA9IHJvbGVOYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIG1lbnUgaXRlbSB0byBiZSBjaGVja2FibGUgb3Igbm90LiBTZXQgdG8gdHJ1ZSBmb3IgbWVudSBpdGVtc1xuICAgKiB0aGF0IHJlcHJlc2VudCBjaGVja2FibGUgb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGNoZWNrYWJsZSBXaGV0aGVyIHRoZSBtZW51IGl0ZW0gaXMgY2hlY2thYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldENoZWNrYWJsZShjaGVja2FibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmNoZWNrYWJsZSA9IGNoZWNrYWJsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3Mgb3IgdW5jaGVja3MgdGhlIGNvbXBvbmVudC5cbiAgICpcbiAgICogQHBhcmFtIGNoZWNrZWQgV2hldGhlciB0byBjaGVjayBvciB1bmNoZWNrIHRoZSBjb21wb25lbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Q2hlY2tlZChjaGVja2VkOiBib29sZWFuKSB7XG4gICAgdGhpcy5jaGVja2VkID0gY2hlY2tlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWdobGlnaHRzIG9yIHVuaGlnaGxpZ2h0cyB0aGUgY29tcG9uZW50LlxuICAgKlxuICAgKiBAcGFyYW0gaGlnaGxpZ2h0IFdoZXRoZXIgdG8gaGlnaGxpZ2h0IG9yIHVuaGlnaGxpZ2h0IHRoZSBjb21wb25lbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0SGlnaGxpZ2h0ZWQoaGlnaGxpZ2h0OiBib29sZWFuKSB7XG4gICAgdGhpcy5oaWdobGlnaHQgPSBoaWdobGlnaHQ7XG5cbiAgICBjb25zdCBlbCA9IHRoaXMuZ2V0RWxlbWVudCgpO1xuICAgIGlmIChlbCAmJiB0aGlzLmlzRW5hYmxlZCgpKSB7XG4gICAgICAvLyBnb29nLW1lbnVpdGVtLWhpZ2hsaWdodCBpcyBkZXByZWNhdGVkLCB1c2UgYmxvY2tseU1lbnVJdGVtSGlnaGxpZ2h0LlxuICAgICAgLy8gTWF5IDIwMjAuXG4gICAgICBjb25zdCBuYW1lID0gJ2Jsb2NrbHlNZW51SXRlbUhpZ2hsaWdodCc7XG4gICAgICBjb25zdCBuYW1lRGVwID0gJ2dvb2ctbWVudWl0ZW0taGlnaGxpZ2h0JztcbiAgICAgIGlmIChoaWdobGlnaHQpIHtcbiAgICAgICAgZG9tLmFkZENsYXNzKGVsLCBuYW1lKTtcbiAgICAgICAgZG9tLmFkZENsYXNzKGVsLCBuYW1lRGVwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvbS5yZW1vdmVDbGFzcyhlbCwgbmFtZSk7XG4gICAgICAgIGRvbS5yZW1vdmVDbGFzcyhlbCwgbmFtZURlcCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgbWVudSBpdGVtIGlzIGVuYWJsZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgbWVudSBpdGVtIGlzIGVuYWJsZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNFbmFibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmVuYWJsZWQ7XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlcyBvciBkaXNhYmxlcyB0aGUgbWVudSBpdGVtLlxuICAgKlxuICAgKiBAcGFyYW0gZW5hYmxlZCBXaGV0aGVyIHRvIGVuYWJsZSBvciBkaXNhYmxlIHRoZSBtZW51IGl0ZW0uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0RW5hYmxlZChlbmFibGVkOiBib29sZWFuKSB7XG4gICAgdGhpcy5lbmFibGVkID0gZW5hYmxlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtcyB0aGUgYXBwcm9wcmlhdGUgYWN0aW9uIHdoZW4gdGhlIG1lbnUgaXRlbSBpcyBhY3RpdmF0ZWRcbiAgICogYnkgdGhlIHVzZXIuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcGVyZm9ybUFjdGlvbigpIHtcbiAgICBpZiAodGhpcy5pc0VuYWJsZWQoKSAmJiB0aGlzLmFjdGlvbkhhbmRsZXIpIHtcbiAgICAgIHRoaXMuYWN0aW9uSGFuZGxlcih0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBoYW5kbGVyIHRoYXQncyBjYWxsZWQgd2hlbiB0aGUgbWVudSBpdGVtIGlzIGFjdGl2YXRlZCBieSB0aGUgdXNlci5cbiAgICogYG9iamAgd2lsbCBiZSB1c2VkIGFzIHRoZSAndGhpcycgb2JqZWN0IGluIHRoZSBmdW5jdGlvbiB3aGVuIGNhbGxlZC5cbiAgICpcbiAgICogQHBhcmFtIGZuIFRoZSBoYW5kbGVyLlxuICAgKiBAcGFyYW0gb2JqIFVzZWQgYXMgdGhlICd0aGlzJyBvYmplY3QgaW4gZm4gd2hlbiBjYWxsZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb25BY3Rpb24oZm46IChwMTogTWVudUl0ZW0pID0+IHZvaWQsIG9iajogb2JqZWN0KSB7XG4gICAgdGhpcy5hY3Rpb25IYW5kbGVyID0gZm4uYmluZChvYmopO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogRXZlbnRzIGZpcmVkIGFzIGEgcmVzdWx0IG9mIGJ1YmJsZSBvcGVuLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5CdWJibGVPcGVuJyk7XG5cbmltcG9ydCB0eXBlIHtBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBidWJibGUgb3BlbiBldmVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMuQnViYmxlT3BlblxuICovXG5leHBvcnQgY2xhc3MgQnViYmxlT3BlbiBleHRlbmRzIFVpQmFzZSB7XG4gIGJsb2NrSWQ/OiBzdHJpbmc7XG4gIGlzT3Blbj86IGJvb2xlYW47XG4gIGJ1YmJsZVR5cGU/OiBCdWJibGVUeXBlO1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5CVUJCTEVfT1BFTjtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF9ibG9jayBUaGUgYXNzb2NpYXRlZCBibG9jay4gVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X2lzT3BlbiBXaGV0aGVyIHRoZSBidWJibGUgaXMgb3BlbmluZyAoZmFsc2UgaWYgY2xvc2luZykuXG4gICAqICAgICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfYnViYmxlVHlwZSBUaGUgdHlwZSBvZiBidWJibGUuIE9uZSBvZiAnbXV0YXRvcicsICdjb21tZW50JyBvclxuICAgKiAgICAgJ3dhcm5pbmcnLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIG9wdF9ibG9jaz86IEJsb2NrU3ZnLCBvcHRfaXNPcGVuPzogYm9vbGVhbiwgb3B0X2J1YmJsZVR5cGU/OiBCdWJibGVUeXBlKSB7XG4gICAgY29uc3Qgd29ya3NwYWNlSWQgPSBvcHRfYmxvY2sgPyBvcHRfYmxvY2sud29ya3NwYWNlLmlkIDogdW5kZWZpbmVkO1xuICAgIHN1cGVyKHdvcmtzcGFjZUlkKTtcbiAgICBpZiAoIW9wdF9ibG9jaykgcmV0dXJuO1xuXG4gICAgdGhpcy5ibG9ja0lkID0gb3B0X2Jsb2NrLmlkO1xuXG4gICAgLyoqIFdoZXRoZXIgdGhlIGJ1YmJsZSBpcyBvcGVuaW5nIChmYWxzZSBpZiBjbG9zaW5nKS4gKi9cbiAgICB0aGlzLmlzT3BlbiA9IG9wdF9pc09wZW47XG5cbiAgICAvKiogVGhlIHR5cGUgb2YgYnViYmxlLiBPbmUgb2YgJ211dGF0b3InLCAnY29tbWVudCcsIG9yICd3YXJuaW5nJy4gKi9cbiAgICB0aGlzLmJ1YmJsZVR5cGUgPSBvcHRfYnViYmxlVHlwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSB0b0pzb24oKTogQnViYmxlT3Blbkpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBCdWJibGVPcGVuSnNvbjtcbiAgICBpZiAodGhpcy5pc09wZW4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdXaGV0aGVyIHRoaXMgZXZlbnQgaXMgZm9yIG9wZW5pbmcgdGhlIGJ1YmJsZSBpcyB1bmRlZmluZWQuICcgK1xuICAgICAgICAgICdFaXRoZXIgcGFzcyB0aGUgdmFsdWUgdG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5idWJibGVUeXBlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSB0eXBlIG9mIGJ1YmJsZSBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIHRoZSAnICtcbiAgICAgICAgICAndmFsdWUgdG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ2lzT3BlbiddID0gdGhpcy5pc09wZW47XG4gICAganNvblsnYnViYmxlVHlwZSddID0gdGhpcy5idWJibGVUeXBlO1xuICAgIGpzb25bJ2Jsb2NrSWQnXSA9IHRoaXMuYmxvY2tJZCB8fCAnJztcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBCdWJibGVPcGVuSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5CdWJibGVPcGVuLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMuaXNPcGVuID0ganNvblsnaXNPcGVuJ107XG4gICAgdGhpcy5idWJibGVUeXBlID0ganNvblsnYnViYmxlVHlwZSddO1xuICAgIHRoaXMuYmxvY2tJZCA9IGpzb25bJ2Jsb2NrSWQnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgQnViYmxlT3BlbiwgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdFxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZlxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IEJ1YmJsZU9wZW5Kc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgQnViYmxlT3BlbiB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBCdWJibGVPcGVuKCkpIGFzXG4gICAgICAgIEJ1YmJsZU9wZW47XG4gICAgbmV3RXZlbnQuaXNPcGVuID0ganNvblsnaXNPcGVuJ107XG4gICAgbmV3RXZlbnQuYnViYmxlVHlwZSA9IGpzb25bJ2J1YmJsZVR5cGUnXTtcbiAgICBuZXdFdmVudC5ibG9ja0lkID0ganNvblsnYmxvY2tJZCddO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxufVxuXG5leHBvcnQgZW51bSBCdWJibGVUeXBlIHtcbiAgTVVUQVRPUiA9ICdtdXRhdG9yJyxcbiAgQ09NTUVOVCA9ICdjb21tZW50JyxcbiAgV0FSTklORyA9ICd3YXJuaW5nJyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWJibGVPcGVuSnNvbiBleHRlbmRzIEFic3RyYWN0RXZlbnRKc29uIHtcbiAgaXNPcGVuOiBib29sZWFuO1xuICBidWJibGVUeXBlOiBCdWJibGVUeXBlO1xuICBibG9ja0lkOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuQlVCQkxFX09QRU4sIEJ1YmJsZU9wZW4pO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSBzY3JvbGxiYXIuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuU2Nyb2xsYmFyJyk7XG5cbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBUb3VjaCBmcm9tICcuL3RvdWNoLmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgdHlwZSB7TWV0cmljc30gZnJvbSAnLi91dGlscy9tZXRyaWNzLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIEEgbm90ZSBvbiB1bml0czogbW9zdCBvZiB0aGUgbnVtYmVycyB0aGF0IGFyZSBpbiBDU1MgcGl4ZWxzIGFyZSBzY2FsZWQgaWYgdGhlXG4gKiBzY3JvbGxiYXIgaXMgaW4gYSBtdXRhdG9yLlxuICovXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgcHVyZSBTVkcgc2Nyb2xsYmFyLlxuICogVGhpcyB0ZWNobmlxdWUgb2ZmZXJzIGEgc2Nyb2xsYmFyIHRoYXQgaXMgZ3VhcmFudGVlZCB0byB3b3JrLCBidXQgbWF5IG5vdFxuICogbG9vayBvciBiZWhhdmUgbGlrZSB0aGUgc3lzdGVtJ3Mgc2Nyb2xsYmFycy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5TY3JvbGxiYXJcbiAqL1xuZXhwb3J0IGNsYXNzIFNjcm9sbGJhciB7XG4gIC8qKlxuICAgKiBXaWR0aCBvZiB2ZXJ0aWNhbCBzY3JvbGxiYXIgb3IgaGVpZ2h0IG9mIGhvcml6b250YWwgc2Nyb2xsYmFyIGluIENTU1xuICAgKiBwaXhlbHMuIFNjcm9sbGJhcnMgc2hvdWxkIGJlIGxhcmdlciBvbiB0b3VjaCBkZXZpY2VzLlxuICAgKi9cbiAgc3RhdGljIHNjcm9sbGJhclRoaWNrbmVzcyA9IFRvdWNoLlRPVUNIX0VOQUJMRUQgPyAyNSA6IDE1O1xuXG4gIC8qKlxuICAgKiBEZWZhdWx0IG1hcmdpbiBhcm91bmQgdGhlIHNjcm9sbGJhciAoYmV0d2VlbiB0aGUgc2Nyb2xsYmFyIGFuZCB0aGUgZWRnZSBvZlxuICAgKiB0aGUgdmlld3BvcnQgaW4gcGl4ZWxzKS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9TQ1JPTExCQVJfTUFSR0lOID0gMC41O1xuXG4gIC8qKiBXaGV0aGVyIHRoaXMgc2Nyb2xsYmFyIGlzIHBhcnQgb2YgYSBwYWlyLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IHBhaXI6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIE1hcmdpbiBhcm91bmQgdGhlIHNjcm9sbGJhciAoYmV0d2VlbiB0aGUgc2Nyb2xsYmFyIGFuZCB0aGUgZWRnZSBvZiB0aGVcbiAgICogdmlld3BvcnQgaW4gcGl4ZWxzKS5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgbWFyZ2luOiBudW1iZXI7XG5cbiAgLyoqIFByZXZpb3VzbHkgcmVjb3JkZWQgbWV0cmljcyBmcm9tIHRoZSB3b3Jrc3BhY2UuICovXG4gIHByaXZhdGUgb2xkSG9zdE1ldHJpY3M6IE1ldHJpY3N8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSByYXRpbyBvZiBoYW5kbGUgcG9zaXRpb24gb2Zmc2V0IHRvIHdvcmtzcGFjZSBjb250ZW50IGRpc3BsYWNlbWVudC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICByYXRpbyA9IDE7XG5cbiAgLyoqXG4gICAqIFRoZSBsb2NhdGlvbiBvZiB0aGUgb3JpZ2luIG9mIHRoZSB3b3Jrc3BhY2UgdGhhdCB0aGUgc2Nyb2xsYmFyIGlzIGluLFxuICAgKiBtZWFzdXJlZCBpbiBDU1MgcGl4ZWxzIHJlbGF0aXZlIHRvIHRoZSBpbmplY3Rpb24gZGl2IG9yaWdpbi4gIFRoaXMgaXNcbiAgICogdXN1YWxseSAoMCwgMCkuICBXaGVuIHRoZSBzY3JvbGxiYXIgaXMgaW4gYSBmbHlvdXQgaXQgbWF5IGhhdmUgYVxuICAgKiBkaWZmZXJlbnQgb3JpZ2luLlxuICAgKi9cbiAgcHJpdmF0ZSBvcmlnaW4gPSBuZXcgQ29vcmRpbmF0ZSgwLCAwKTtcblxuICAvKipcbiAgICogVGhlIHBvc2l0aW9uIG9mIHRoZSBtb3VzZSBhbG9uZyB0aGlzIHNjcm9sbGJhcidzIG1ham9yIGF4aXMgYXQgdGhlIHN0YXJ0XG4gICAqIG9mIHRoZSBtb3N0IHJlY2VudCBkcmFnLiBVbml0cyBhcmUgQ1NTIHBpeGVscywgd2l0aCAoMCwgMCkgYXQgdGhlIHRvcFxuICAgKiBsZWZ0IG9mIHRoZSBicm93c2VyIHdpbmRvdy4gRm9yIGEgaG9yaXpvbnRhbCBzY3JvbGxiYXIgdGhpcyBpcyB0aGUgeFxuICAgKiBjb29yZGluYXRlIG9mIHRoZSBtb3VzZSBkb3duIGV2ZW50OyBmb3IgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaXQncyB0aGUgeVxuICAgKiBjb29yZGluYXRlIG9mIHRoZSBtb3VzZSBkb3duIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBzdGFydERyYWdNb3VzZSA9IDA7XG5cbiAgLyoqXG4gICAqIFRoZSBsZW5ndGggb2YgdGhlIHNjcm9sbGJhcnMgKGluY2x1ZGluZyB0aGUgaGFuZGxlIGFuZCB0aGUgYmFja2dyb3VuZCksXG4gICAqIGluIENTUyBwaXhlbHMuIFRoaXMgaXMgZXF1aXZhbGVudCB0byBzY3JvbGxiYXIgYmFja2dyb3VuZCBsZW5ndGggYW5kIHRoZVxuICAgKiBhcmVhIHdpdGhpbiB3aGljaCB0aGUgc2Nyb2xsYmFyIGhhbmRsZSBjYW4gbW92ZS5cbiAgICovXG4gIHByaXZhdGUgc2Nyb2xsYmFyTGVuZ3RoID0gMDtcblxuICAvKiogVGhlIGxlbmd0aCBvZiB0aGUgc2Nyb2xsYmFyIGhhbmRsZSBpbiBDU1MgcGl4ZWxzLiAqL1xuICBwcml2YXRlIGhhbmRsZUxlbmd0aCA9IDA7XG5cbiAgLyoqXG4gICAqIFRoZSBvZmZzZXQgb2YgdGhlIHN0YXJ0IG9mIHRoZSBoYW5kbGUgZnJvbSB0aGUgc2Nyb2xsYmFyIHBvc2l0aW9uLCBpbiBDU1NcbiAgICogcGl4ZWxzLlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVQb3NpdGlvbiA9IDA7XG5cbiAgcHJpdmF0ZSBzdGFydERyYWdIYW5kbGUgPSAwO1xuXG4gIC8qKiBXaGV0aGVyIHRoZSBzY3JvbGxiYXIgaGFuZGxlIGlzIHZpc2libGUuICovXG4gIHByaXZhdGUgaXNIYW5kbGVWaXNpYmxlID0gdHJ1ZTtcblxuICAvKiogV2hldGhlciB0aGUgd29ya3NwYWNlIGNvbnRhaW5pbmcgdGhpcyBzY3JvbGxiYXIgaXMgdmlzaWJsZS4gKi9cbiAgcHJpdmF0ZSBjb250YWluZXJWaXNpYmxlID0gdHJ1ZTtcblxuICAvKiogVGhlIHRyYW5zcGFyZW50IGJhY2tncm91bmQgYmVoaW5kIHRoZSBoYW5kbGUuICovXG4gIHByaXZhdGUgc3ZnQmFja2dyb3VuZDogU1ZHUmVjdEVsZW1lbnQ7XG5cbiAgLyoqIFRoZSB2aXNpYmxlIGhhbmRsZSB0aGF0IGNhbiBiZSBkcmFnZ2VkIGFyb3VuZC4gKi9cbiAgcHJpdmF0ZSBzdmdIYW5kbGU6IFNWR1JlY3RFbGVtZW50O1xuXG4gIC8qKiBUaGUgb3V0ZXJtb3N0IFNWRyBlbGVtZW50LCB3aGljaCBjb250YWlucyBhbGwgcGFydHMgb2YgdGhlIHNjcm9sbGJhci4gKi9cbiAgcHJpdmF0ZSBvdXRlclN2ZzogU1ZHU1ZHRWxlbWVudDtcblxuICAvKipcbiAgICogVGhlIHVwcGVyIGxlZnQgY29ybmVyIG9mIHRoZSBzY3JvbGxiYXIncyBTVkcgZ3JvdXAgaW4gQ1NTIHBpeGVscyByZWxhdGl2ZVxuICAgKiB0byB0aGUgc2Nyb2xsYmFyJ3Mgb3JpZ2luLiAgVGhpcyBpcyB1c3VhbGx5IHJlbGF0aXZlIHRvIHRoZSBpbmplY3Rpb24gZGl2XG4gICAqIG9yaWdpbi5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBwb3NpdGlvbiA9IG5ldyBDb29yZGluYXRlKDAsIDApO1xuXG4gIC8qKlxuICAgKiBUaGUgRE9NIGF0dHJpYnV0ZSB0aGF0IGNvbnRyb2xzIHRoZSBsZW5ndGggb2YgdGhlIHNjcm9sbGJhci4gRGlmZmVyZW50XG4gICAqIGZvciBob3Jpem9udGFsIGFuZCB2ZXJ0aWNhbCBzY3JvbGxiYXJzLlxuICAgKi9cbiAgbGVuZ3RoQXR0cmlidXRlXzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgRE9NIGF0dHJpYnV0ZSB0aGF0IGNvbnRyb2xzIHRoZSBwb3NpdGlvbiBvZiB0aGUgc2Nyb2xsYmFyLlxuICAgKiBEaWZmZXJlbnQgZm9yIGhvcml6b250YWwgYW5kIHZlcnRpY2FsIHNjcm9sbGJhcnMuXG4gICAqL1xuICBwb3NpdGlvbkF0dHJpYnV0ZV86IHN0cmluZztcblxuICAvKiogSGFuZGxlciBmb3IgbW91c2UgZG93biBldmVudHMgb24gdGhlIGJhY2tncm91bmQgb2YgdGhlIHNjcm9sbGJhci4gKi9cbiAgb25Nb3VzZURvd25CYXJXcmFwcGVyXzogYnJvd3NlckV2ZW50cy5EYXRhO1xuXG4gIC8qKiBIYW5kbGVyIGZvciBtb3VzZSBkb3duIGV2ZW50cyBvbiB0aGUgaGFuZGxlIG9mIHRoZSBzY3JvbGxiYXIuICovXG4gIG9uTW91c2VEb3duSGFuZGxlV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YTtcblxuICAvKiogSGFuZGxlciBmb3IgbW91c2UgbW92ZSBldmVudHMgZHVyaW5nIHNjcm9sbGJhciBkcmFncy4gKi9cbiAgb25Nb3VzZVVwV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogSGFuZGxlciBmb3IgbW91c2UgdXAgZXZlbnRzIHRvIGVuZCBzY3JvbGxiYXIgZHJhZ3MuICovXG4gIG9uTW91c2VNb3ZlV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBXb3Jrc3BhY2UgdG8gYmluZCB0aGUgc2Nyb2xsYmFyIHRvLlxuICAgKiBAcGFyYW0gaG9yaXpvbnRhbCBUcnVlIGlmIGhvcml6b250YWwsIGZhbHNlIGlmIHZlcnRpY2FsLlxuICAgKiBAcGFyYW0gb3B0X3BhaXIgVHJ1ZSBpZiBzY3JvbGxiYXIgaXMgcGFydCBvZiBhIGhvcml6L3ZlcnQgcGFpci5cbiAgICogQHBhcmFtIG9wdF9jbGFzcyBBIGNsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhpcyBzY3JvbGxiYXIuXG4gICAqIEBwYXJhbSBvcHRfbWFyZ2luIFRoZSBtYXJnaW4gdG8gYXBwbHkgdG8gdGhpcyBzY3JvbGxiYXIuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIHByaXZhdGUgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcsIHByaXZhdGUgcmVhZG9ubHkgaG9yaXpvbnRhbDogYm9vbGVhbixcbiAgICAgIG9wdF9wYWlyPzogYm9vbGVhbiwgb3B0X2NsYXNzPzogc3RyaW5nLCBvcHRfbWFyZ2luPzogbnVtYmVyKSB7XG4gICAgdGhpcy5wYWlyID0gb3B0X3BhaXIgfHwgZmFsc2U7XG5cbiAgICB0aGlzLm1hcmdpbiA9IG9wdF9tYXJnaW4gIT09IHVuZGVmaW5lZCA/IG9wdF9tYXJnaW4gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2Nyb2xsYmFyLkRFRkFVTFRfU0NST0xMQkFSX01BUkdJTjtcblxuICAgIGxldCBjbGFzc05hbWUgPVxuICAgICAgICAnYmxvY2tseVNjcm9sbGJhcicgKyAodGhpcy5ob3Jpem9udGFsID8gJ0hvcml6b250YWwnIDogJ1ZlcnRpY2FsJyk7XG4gICAgaWYgKG9wdF9jbGFzcykge1xuICAgICAgY2xhc3NOYW1lICs9ICcgJyArIG9wdF9jbGFzcztcbiAgICB9XG5cbiAgICAvKiBDcmVhdGUgdGhlIGZvbGxvd2luZyBET006XG4gICAgICA8c3ZnIGNsYXNzPVwiYmxvY2tseVNjcm9sbGJhckhvcml6b250YWwgb3B0aW9uYWxDbGFzc1wiPlxuICAgICAgICA8Zz5cbiAgICAgICAgICA8cmVjdCBjbGFzcz1cImJsb2NrbHlTY3JvbGxiYXJCYWNrZ3JvdW5kXCIgLz5cbiAgICAgICAgICA8cmVjdCBjbGFzcz1cImJsb2NrbHlTY3JvbGxiYXJIYW5kbGVcIiByeD1cIjhcIiByeT1cIjhcIiAvPlxuICAgICAgICA8L2c+XG4gICAgICA8L3N2Zz5cbiAgICAqL1xuICAgIHRoaXMub3V0ZXJTdmcgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuU1ZHLCB7J2NsYXNzJzogY2xhc3NOYW1lfSk7XG4gICAgLy8gQ2hpbGQgZ3JvdXAgdG8gaG9sZCB0aGUgaGFuZGxlIGFuZCBiYWNrZ3JvdW5kIHRvZ2V0aGVyLlxuICAgIGNvbnN0IGdyb3VwID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkcsIHt9LCB0aGlzLm91dGVyU3ZnKTtcblxuICAgIHRoaXMuc3ZnQmFja2dyb3VuZCA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwgeydjbGFzcyc6ICdibG9ja2x5U2Nyb2xsYmFyQmFja2dyb3VuZCd9LCBncm91cCk7XG5cbiAgICBjb25zdCByYWRpdXMgPSBNYXRoLmZsb29yKChTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzIC0gNSkgLyAyKTtcbiAgICB0aGlzLnN2Z0hhbmRsZSA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCxcbiAgICAgICAgeydjbGFzcyc6ICdibG9ja2x5U2Nyb2xsYmFySGFuZGxlJywgJ3J4JzogcmFkaXVzLCAncnknOiByYWRpdXN9LCBncm91cCk7XG5cbiAgICB0aGlzLndvcmtzcGFjZS5nZXRUaGVtZU1hbmFnZXIoKS5zdWJzY3JpYmUoXG4gICAgICAgIHRoaXMuc3ZnSGFuZGxlLCAnc2Nyb2xsYmFyQ29sb3VyJywgJ2ZpbGwnKTtcbiAgICB0aGlzLndvcmtzcGFjZS5nZXRUaGVtZU1hbmFnZXIoKS5zdWJzY3JpYmUoXG4gICAgICAgIHRoaXMuc3ZnSGFuZGxlLCAnc2Nyb2xsYmFyT3BhY2l0eScsICdmaWxsLW9wYWNpdHknKTtcblxuICAgIC8vIEFkZCBldmVyeXRoaW5nIHRvIHRoZSBET00uXG4gICAgZG9tLmluc2VydEFmdGVyKHRoaXMub3V0ZXJTdmcsIHRoaXMud29ya3NwYWNlLmdldFBhcmVudFN2ZygpKTtcblxuICAgIHRoaXMuc2V0SW5pdGlhbFRoaWNrbmVzcygpO1xuXG4gICAgaWYgKGhvcml6b250YWwpIHtcbiAgICAgIHRoaXMubGVuZ3RoQXR0cmlidXRlXyA9ICd3aWR0aCc7XG4gICAgICB0aGlzLnBvc2l0aW9uQXR0cmlidXRlXyA9ICd4JztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sZW5ndGhBdHRyaWJ1dGVfID0gJ2hlaWdodCc7XG4gICAgICB0aGlzLnBvc2l0aW9uQXR0cmlidXRlXyA9ICd5JztcbiAgICB9XG5cbiAgICB0aGlzLm9uTW91c2VEb3duQmFyV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGhpcy5zdmdCYWNrZ3JvdW5kLCAncG9pbnRlcmRvd24nLCB0aGlzLCB0aGlzLm9uTW91c2VEb3duQmFyKTtcbiAgICB0aGlzLm9uTW91c2VEb3duSGFuZGxlV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGhpcy5zdmdIYW5kbGUsICdwb2ludGVyZG93bicsIHRoaXMsIHRoaXMub25Nb3VzZURvd25IYW5kbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgc2l6ZSBvZiB0aGUgc2Nyb2xsYmFyIERPTSBlbGVtZW50cyBhbG9uZyB0aGUgbWlub3IgYXhpcy5cbiAgICovXG4gIHByaXZhdGUgc2V0SW5pdGlhbFRoaWNrbmVzcygpIHtcbiAgICBjb25zdCBzY3JvbGxiYXJUaGlja25lc3MgPSBTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzO1xuICAgIGlmICh0aGlzLmhvcml6b250YWwpIHtcbiAgICAgIHRoaXMuc3ZnQmFja2dyb3VuZC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIFN0cmluZyhzY3JvbGxiYXJUaGlja25lc3MpKTtcbiAgICAgIHRoaXMub3V0ZXJTdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBTdHJpbmcoc2Nyb2xsYmFyVGhpY2tuZXNzKSk7XG4gICAgICB0aGlzLnN2Z0hhbmRsZS5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIFN0cmluZyhzY3JvbGxiYXJUaGlja25lc3MgLSA1KSk7XG4gICAgICB0aGlzLnN2Z0hhbmRsZS5zZXRBdHRyaWJ1dGUoJ3knLCBTdHJpbmcoMi41KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3ZnQmFja2dyb3VuZC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgU3RyaW5nKHNjcm9sbGJhclRoaWNrbmVzcykpO1xuICAgICAgdGhpcy5vdXRlclN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgU3RyaW5nKHNjcm9sbGJhclRoaWNrbmVzcykpO1xuICAgICAgdGhpcy5zdmdIYW5kbGUuc2V0QXR0cmlidXRlKCd3aWR0aCcsIFN0cmluZyhzY3JvbGxiYXJUaGlja25lc3MgLSA1KSk7XG4gICAgICB0aGlzLnN2Z0hhbmRsZS5zZXRBdHRyaWJ1dGUoJ3gnLCBTdHJpbmcoMi41KSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2YgdGhpcyBzY3JvbGxiYXIuIFJlbW92ZSBET00gZWxlbWVudHMsIGV2ZW50IGxpc3RlbmVycyxcbiAgICogYW5kIHRoZW1lIHN1YnNjcmlwdGlvbnMuXG4gICAqXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy5jbGVhblVwKCk7XG4gICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbk1vdXNlRG93bkJhcldyYXBwZXJfKTtcbiAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uTW91c2VEb3duSGFuZGxlV3JhcHBlcl8pO1xuXG4gICAgZG9tLnJlbW92ZU5vZGUodGhpcy5vdXRlclN2Zyk7XG4gICAgdGhpcy53b3Jrc3BhY2UuZ2V0VGhlbWVNYW5hZ2VyKCkudW5zdWJzY3JpYmUodGhpcy5zdmdIYW5kbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cmFpbiB0aGUgaGFuZGxlJ3MgbGVuZ3RoIHdpdGhpbiB0aGUgbWluaW11bSAoMCkgYW5kIG1heGltdW1cbiAgICogKHNjcm9sbGJhciBiYWNrZ3JvdW5kKSB2YWx1ZXMgYWxsb3dlZCBmb3IgdGhlIHNjcm9sbGJhci5cbiAgICpcbiAgICogQHBhcmFtIHZhbHVlIFZhbHVlIHRoYXQgaXMgcG90ZW50aWFsbHkgb3V0IG9mIGJvdW5kcywgaW4gQ1NTIHBpeGVscy5cbiAgICogQHJldHVybnMgQ29uc3RyYWluZWQgdmFsdWUsIGluIENTUyBwaXhlbHMuXG4gICAqL1xuICBwcml2YXRlIGNvbnN0cmFpbkhhbmRsZUxlbmd0aCh2YWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAodmFsdWUgPD0gMCB8fCBpc05hTih2YWx1ZSkpIHtcbiAgICAgIHZhbHVlID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsdWUgPSBNYXRoLm1pbih2YWx1ZSwgdGhpcy5zY3JvbGxiYXJMZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBsZW5ndGggb2YgdGhlIHNjcm9sbGJhcidzIGhhbmRsZSBhbmQgY2hhbmdlIHRoZSBTVkcgYXR0cmlidXRlXG4gICAqIGFjY29yZGluZ2x5LlxuICAgKlxuICAgKiBAcGFyYW0gbmV3TGVuZ3RoIFRoZSBuZXcgc2Nyb2xsYmFyIGhhbmRsZSBsZW5ndGggaW4gQ1NTIHBpeGVscy5cbiAgICovXG4gIHByaXZhdGUgc2V0SGFuZGxlTGVuZ3RoKG5ld0xlbmd0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5oYW5kbGVMZW5ndGggPSBuZXdMZW5ndGg7XG4gICAgdGhpcy5zdmdIYW5kbGUuc2V0QXR0cmlidXRlKFxuICAgICAgICB0aGlzLmxlbmd0aEF0dHJpYnV0ZV8sIFN0cmluZyh0aGlzLmhhbmRsZUxlbmd0aCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cmFpbiB0aGUgaGFuZGxlJ3MgcG9zaXRpb24gd2l0aGluIHRoZSBtaW5pbXVtICgwKSBhbmQgbWF4aW11bSB2YWx1ZXNcbiAgICogYWxsb3dlZCBmb3IgdGhlIHNjcm9sbGJhci5cbiAgICpcbiAgICogQHBhcmFtIHZhbHVlIFZhbHVlIHRoYXQgaXMgcG90ZW50aWFsbHkgb3V0IG9mIGJvdW5kcywgaW4gQ1NTIHBpeGVscy5cbiAgICogQHJldHVybnMgQ29uc3RyYWluZWQgdmFsdWUsIGluIENTUyBwaXhlbHMuXG4gICAqL1xuICBwcml2YXRlIGNvbnN0cmFpbkhhbmRsZVBvc2l0aW9uKHZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGlmICh2YWx1ZSA8PSAwIHx8IGlzTmFOKHZhbHVlKSkge1xuICAgICAgdmFsdWUgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBIYW5kbGUgbGVuZ3RoIHNob3VsZCBuZXZlciBiZSBncmVhdGVyIHRoYW4gdGhpcy5zY3JvbGxiYXJMZW5ndGhfLlxuICAgICAgLy8gSWYgdGhlIHZpZXdTaXplIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgc2Nyb2xsU2l6ZSwgdGhlXG4gICAgICAvLyBoYW5kbGVMZW5ndGggd2lsbCBlbmQgdXAgZXF1YWwgdG8gdGhpcy5zY3JvbGxiYXJMZW5ndGhfLlxuICAgICAgdmFsdWUgPSBNYXRoLm1pbih2YWx1ZSwgdGhpcy5zY3JvbGxiYXJMZW5ndGggLSB0aGlzLmhhbmRsZUxlbmd0aCk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIG9mZnNldCBvZiB0aGUgc2Nyb2xsYmFyJ3MgaGFuZGxlIGZyb20gdGhlIHNjcm9sbGJhcidzIHBvc2l0aW9uLCBhbmRcbiAgICogY2hhbmdlIHRoZSBTVkcgYXR0cmlidXRlIGFjY29yZGluZ2x5LlxuICAgKlxuICAgKiBAcGFyYW0gbmV3UG9zaXRpb24gVGhlIG5ldyBzY3JvbGxiYXIgaGFuZGxlIG9mZnNldCBpbiBDU1MgcGl4ZWxzLlxuICAgKi9cbiAgc2V0SGFuZGxlUG9zaXRpb24obmV3UG9zaXRpb246IG51bWJlcikge1xuICAgIHRoaXMuaGFuZGxlUG9zaXRpb24gPSBuZXdQb3NpdGlvbjtcbiAgICB0aGlzLnN2Z0hhbmRsZS5zZXRBdHRyaWJ1dGUoXG4gICAgICAgIHRoaXMucG9zaXRpb25BdHRyaWJ1dGVfLCBTdHJpbmcodGhpcy5oYW5kbGVQb3NpdGlvbikpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgc2l6ZSBvZiB0aGUgc2Nyb2xsYmFyJ3MgYmFja2dyb3VuZCBhbmQgY2hhbmdlIHRoZSBTVkcgYXR0cmlidXRlXG4gICAqIGFjY29yZGluZ2x5LlxuICAgKlxuICAgKiBAcGFyYW0gbmV3U2l6ZSBUaGUgbmV3IHNjcm9sbGJhciBiYWNrZ3JvdW5kIGxlbmd0aCBpbiBDU1MgcGl4ZWxzLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRTY3JvbGxiYXJMZW5ndGgobmV3U2l6ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5zY3JvbGxiYXJMZW5ndGggPSBuZXdTaXplO1xuICAgIHRoaXMub3V0ZXJTdmcuc2V0QXR0cmlidXRlKFxuICAgICAgICB0aGlzLmxlbmd0aEF0dHJpYnV0ZV8sIFN0cmluZyh0aGlzLnNjcm9sbGJhckxlbmd0aCkpO1xuICAgIHRoaXMuc3ZnQmFja2dyb3VuZC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgIHRoaXMubGVuZ3RoQXR0cmlidXRlXywgU3RyaW5nKHRoaXMuc2Nyb2xsYmFyTGVuZ3RoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgc2Nyb2xsYmFyJ3MgU1ZHIGdyb3VwIGluIENTUyBwaXhlbHMgcmVsYXRpdmUgdG8gdGhlXG4gICAqIHNjcm9sbGJhcidzIG9yaWdpbi4gIFRoaXMgc2V0cyB0aGUgc2Nyb2xsYmFyJ3MgbG9jYXRpb24gd2l0aGluIHRoZVxuICAgKiB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSB4IFRoZSBuZXcgeCBjb29yZGluYXRlLlxuICAgKiBAcGFyYW0geSBUaGUgbmV3IHkgY29vcmRpbmF0ZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRQb3NpdGlvbih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMucG9zaXRpb24ueCA9IHg7XG4gICAgdGhpcy5wb3NpdGlvbi55ID0geTtcblxuICAgIGNvbnN0IHRlbXBYID0gdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vcmlnaW4ueDtcbiAgICBjb25zdCB0ZW1wWSA9IHRoaXMucG9zaXRpb24ueSArIHRoaXMub3JpZ2luLnk7XG4gICAgY29uc3QgdHJhbnNmb3JtID0gJ3RyYW5zbGF0ZSgnICsgdGVtcFggKyAncHgsJyArIHRlbXBZICsgJ3B4KSc7XG4gICAgZG9tLnNldENzc1RyYW5zZm9ybSh0aGlzLm91dGVyU3ZnLCB0cmFuc2Zvcm0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY2FsY3VsYXRlIHRoZSBzY3JvbGxiYXIncyBsb2NhdGlvbiBhbmQgaXRzIGxlbmd0aC5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9tZXRyaWNzIEEgZGF0YSBzdHJ1Y3R1cmUgb2YgZnJvbSB0aGUgZGVzY3JpYmluZyBhbGwgdGhlIHJlcXVpcmVkXG4gICAqICAgICBkaW1lbnNpb25zLiAgSWYgbm90IHByb3ZpZGVkLCBpdCB3aWxsIGJlIGZldGNoZWQgZnJvbSB0aGUgaG9zdCBvYmplY3QuXG4gICAqL1xuICByZXNpemUob3B0X21ldHJpY3M/OiBNZXRyaWNzKSB7XG4gICAgLy8gRGV0ZXJtaW5lIHRoZSBsb2NhdGlvbiwgaGVpZ2h0IGFuZCB3aWR0aCBvZiB0aGUgaG9zdCBlbGVtZW50LlxuICAgIGxldCBob3N0TWV0cmljcyA9IG9wdF9tZXRyaWNzO1xuICAgIGlmICghaG9zdE1ldHJpY3MpIHtcbiAgICAgIGhvc3RNZXRyaWNzID0gdGhpcy53b3Jrc3BhY2UuZ2V0TWV0cmljcygpO1xuICAgICAgaWYgKCFob3N0TWV0cmljcykge1xuICAgICAgICAvLyBIb3N0IGVsZW1lbnQgaXMgbGlrZWx5IG5vdCB2aXNpYmxlLlxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub2xkSG9zdE1ldHJpY3MgJiZcbiAgICAgICAgU2Nyb2xsYmFyLm1ldHJpY3NBcmVFcXVpdmFsZW50KGhvc3RNZXRyaWNzLCB0aGlzLm9sZEhvc3RNZXRyaWNzKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhvcml6b250YWwpIHtcbiAgICAgIHRoaXMucmVzaXplSG9yaXpvbnRhbChob3N0TWV0cmljcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVzaXplVmVydGljYWwoaG9zdE1ldHJpY3MpO1xuICAgIH1cblxuICAgIHRoaXMub2xkSG9zdE1ldHJpY3MgPSBob3N0TWV0cmljcztcblxuICAgIC8vIFJlc2l6aW5nIG1heSBoYXZlIGNhdXNlZCBzb21lIHNjcm9sbGluZy5cbiAgICB0aGlzLnVwZGF0ZU1ldHJpY3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGEgcmVzaXplVmlldyBpcyBuZWNlc3NhcnkgYnkgY29tcGFyaW5nIHRoZSBwYXNzZWRcbiAgICogaG9zdE1ldHJpY3Mgd2l0aCBjYWNoZWQgb2xkIGhvc3QgbWV0cmljcy5cbiAgICpcbiAgICogQHBhcmFtIGhvc3RNZXRyaWNzIEEgZGF0YSBzdHJ1Y3R1cmUgZGVzY3JpYmluZyBhbGwgdGhlIHJlcXVpcmVkIGRpbWVuc2lvbnMsXG4gICAqICAgICBwb3NzaWJseSBmZXRjaGVkIGZyb20gdGhlIGhvc3Qgb2JqZWN0LlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgcmVzaXplVmlldyBpcyBuZWNlc3NhcnkuXG4gICAqL1xuICBwcml2YXRlIHJlcXVpcmVzVmlld1Jlc2l6ZShob3N0TWV0cmljczogTWV0cmljcyk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5vbGRIb3N0TWV0cmljcykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9sZEhvc3RNZXRyaWNzLnZpZXdXaWR0aCAhPT0gaG9zdE1ldHJpY3Mudmlld1dpZHRoIHx8XG4gICAgICAgIHRoaXMub2xkSG9zdE1ldHJpY3Mudmlld0hlaWdodCAhPT0gaG9zdE1ldHJpY3Mudmlld0hlaWdodCB8fFxuICAgICAgICB0aGlzLm9sZEhvc3RNZXRyaWNzLmFic29sdXRlTGVmdCAhPT0gaG9zdE1ldHJpY3MuYWJzb2x1dGVMZWZ0IHx8XG4gICAgICAgIHRoaXMub2xkSG9zdE1ldHJpY3MuYWJzb2x1dGVUb3AgIT09IGhvc3RNZXRyaWNzLmFic29sdXRlVG9wO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY2FsY3VsYXRlIGEgaG9yaXpvbnRhbCBzY3JvbGxiYXIncyBsb2NhdGlvbiBhbmQgbGVuZ3RoLlxuICAgKlxuICAgKiBAcGFyYW0gaG9zdE1ldHJpY3MgQSBkYXRhIHN0cnVjdHVyZSBkZXNjcmliaW5nIGFsbCB0aGUgcmVxdWlyZWQgZGltZW5zaW9ucyxcbiAgICogICAgIHBvc3NpYmx5IGZldGNoZWQgZnJvbSB0aGUgaG9zdCBvYmplY3QuXG4gICAqL1xuICBwcml2YXRlIHJlc2l6ZUhvcml6b250YWwoaG9zdE1ldHJpY3M6IE1ldHJpY3MpIHtcbiAgICBpZiAodGhpcy5yZXF1aXJlc1ZpZXdSZXNpemUoaG9zdE1ldHJpY3MpKSB7XG4gICAgICB0aGlzLnJlc2l6ZVZpZXdIb3Jpem9udGFsKGhvc3RNZXRyaWNzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZXNpemVDb250ZW50SG9yaXpvbnRhbChob3N0TWV0cmljcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY2FsY3VsYXRlIGEgaG9yaXpvbnRhbCBzY3JvbGxiYXIncyBsb2NhdGlvbiBvbiB0aGUgc2NyZWVuIGFuZCBwYXRoXG4gICAqIGxlbmd0aC4gVGhpcyBzaG91bGQgYmUgY2FsbGVkIHdoZW4gdGhlIGxheW91dCBvciBzaXplIG9mIHRoZSB3aW5kb3cgaGFzXG4gICAqIGNoYW5nZWQuXG4gICAqXG4gICAqIEBwYXJhbSBob3N0TWV0cmljcyBBIGRhdGEgc3RydWN0dXJlIGRlc2NyaWJpbmcgYWxsIHRoZSByZXF1aXJlZCBkaW1lbnNpb25zLFxuICAgKiAgICAgcG9zc2libHkgZmV0Y2hlZCBmcm9tIHRoZSBob3N0IG9iamVjdC5cbiAgICovXG4gIHJlc2l6ZVZpZXdIb3Jpem9udGFsKGhvc3RNZXRyaWNzOiBNZXRyaWNzKSB7XG4gICAgbGV0IHZpZXdTaXplID0gaG9zdE1ldHJpY3Mudmlld1dpZHRoIC0gdGhpcy5tYXJnaW4gKiAyO1xuICAgIGlmICh0aGlzLnBhaXIpIHtcbiAgICAgIC8vIFNob3J0ZW4gdGhlIHNjcm9sbGJhciB0byBtYWtlIHJvb20gZm9yIHRoZSBjb3JuZXIgc3F1YXJlLlxuICAgICAgdmlld1NpemUgLT0gU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcztcbiAgICB9XG4gICAgdGhpcy5zZXRTY3JvbGxiYXJMZW5ndGgoTWF0aC5tYXgoMCwgdmlld1NpemUpKTtcblxuICAgIGxldCB4Q29vcmRpbmF0ZSA9IGhvc3RNZXRyaWNzLmFic29sdXRlTGVmdCArIHRoaXMubWFyZ2luO1xuICAgIGlmICh0aGlzLnBhaXIgJiYgdGhpcy53b3Jrc3BhY2UuUlRMKSB7XG4gICAgICB4Q29vcmRpbmF0ZSArPSBTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzO1xuICAgIH1cblxuICAgIC8vIEhvcml6b250YWwgdG9vbGJhciBzaG91bGQgYWx3YXlzIGJlIGp1c3QgYWJvdmUgdGhlIGJvdHRvbSBvZiB0aGVcbiAgICAvLyB3b3Jrc3BhY2UuXG4gICAgY29uc3QgeUNvb3JkaW5hdGUgPSBob3N0TWV0cmljcy5hYnNvbHV0ZVRvcCArIGhvc3RNZXRyaWNzLnZpZXdIZWlnaHQgLVxuICAgICAgICBTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzIC0gdGhpcy5tYXJnaW47XG4gICAgdGhpcy5zZXRQb3NpdGlvbih4Q29vcmRpbmF0ZSwgeUNvb3JkaW5hdGUpO1xuXG4gICAgLy8gSWYgdGhlIHZpZXcgaGFzIGJlZW4gcmVzaXplZCwgYSBjb250ZW50IHJlc2l6ZSB3aWxsIGFsc28gYmUgbmVjZXNzYXJ5LlxuICAgIC8vIFRoZSByZXZlcnNlIGlzIG5vdCB0cnVlLlxuICAgIHRoaXMucmVzaXplQ29udGVudEhvcml6b250YWwoaG9zdE1ldHJpY3MpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY2FsY3VsYXRlIGEgaG9yaXpvbnRhbCBzY3JvbGxiYXIncyBsb2NhdGlvbiB3aXRoaW4gaXRzIHBhdGggYW5kIGxlbmd0aC5cbiAgICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIHdoZW4gdGhlIGNvbnRlbnRzIG9mIHRoZSB3b3Jrc3BhY2UgaGF2ZSBjaGFuZ2VkLlxuICAgKlxuICAgKiBAcGFyYW0gaG9zdE1ldHJpY3MgQSBkYXRhIHN0cnVjdHVyZSBkZXNjcmliaW5nIGFsbCB0aGUgcmVxdWlyZWQgZGltZW5zaW9ucyxcbiAgICogICAgIHBvc3NpYmx5IGZldGNoZWQgZnJvbSB0aGUgaG9zdCBvYmplY3QuXG4gICAqL1xuICByZXNpemVDb250ZW50SG9yaXpvbnRhbChob3N0TWV0cmljczogTWV0cmljcykge1xuICAgIGlmIChob3N0TWV0cmljcy52aWV3V2lkdGggPj0gaG9zdE1ldHJpY3Muc2Nyb2xsV2lkdGgpIHtcbiAgICAgIC8vIHZpZXdXaWR0aCBpcyBvZnRlbiBncmVhdGVyIHRoYW4gc2Nyb2xsV2lkdGggaW4gZmx5b3V0cyBhbmRcbiAgICAgIC8vIG5vbi1zY3JvbGxhYmxlIHdvcmtzcGFjZXMuXG4gICAgICB0aGlzLnNldEhhbmRsZUxlbmd0aCh0aGlzLnNjcm9sbGJhckxlbmd0aCk7XG4gICAgICB0aGlzLnNldEhhbmRsZVBvc2l0aW9uKDApO1xuICAgICAgaWYgKCF0aGlzLnBhaXIpIHtcbiAgICAgICAgLy8gVGhlIHNjcm9sbGJhciBpc24ndCBuZWVkZWQuXG4gICAgICAgIC8vIFRoaXMgZG9lc24ndCBhcHBseSB0byBzY3JvbGxiYXIgcGFpcnMgYmVjYXVzZSBpbnRlcmFjdGlvbnMgd2l0aCB0aGVcbiAgICAgICAgLy8gY29ybmVyIHNxdWFyZSBhcmVuJ3QgaGFuZGxlZC5cbiAgICAgICAgdGhpcy5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLnBhaXIpIHtcbiAgICAgIC8vIFRoZSBzY3JvbGxiYXIgaXMgbmVlZGVkLiBPbmx5IG5vbi1wYWlyZWQgc2Nyb2xsYmFycyBhcmUgaGlkZGVuL3Nob3duLlxuICAgICAgdGhpcy5zZXRWaXNpYmxlKHRydWUpO1xuICAgIH1cblxuICAgIC8vIFJlc2l6ZSB0aGUgaGFuZGxlLlxuICAgIGxldCBoYW5kbGVMZW5ndGggPVxuICAgICAgICB0aGlzLnNjcm9sbGJhckxlbmd0aCAqIGhvc3RNZXRyaWNzLnZpZXdXaWR0aCAvIGhvc3RNZXRyaWNzLnNjcm9sbFdpZHRoO1xuICAgIGhhbmRsZUxlbmd0aCA9IHRoaXMuY29uc3RyYWluSGFuZGxlTGVuZ3RoKGhhbmRsZUxlbmd0aCk7XG4gICAgdGhpcy5zZXRIYW5kbGVMZW5ndGgoaGFuZGxlTGVuZ3RoKTtcblxuICAgIC8vIENvbXB1dGUgdGhlIGhhbmRsZSBvZmZzZXQuXG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSBoYW5kbGUgY2FuIGJlIGJldHdlZW46XG4gICAgLy8gICAgIDAgYW5kIHRoaXMuc2Nyb2xsYmFyTGVuZ3RoXyAtIGhhbmRsZUxlbmd0aFxuICAgIC8vIElmIHZpZXdMZWZ0ID09PSBzY3JvbGxMZWZ0XG4gICAgLy8gICAgIHRoZW4gdGhlIG9mZnNldCBzaG91bGQgYmUgMFxuICAgIC8vIElmIHZpZXdSaWdodCA9PT0gc2Nyb2xsUmlnaHRcbiAgICAvLyAgICAgdGhlbiB2aWV3TGVmdCA9IHNjcm9sbExlZnQgKyBzY3JvbGxXaWR0aCAtIHZpZXdXaWR0aFxuICAgIC8vICAgICB0aGVuIHRoZSBvZmZzZXQgc2hvdWxkIGJlIG1heCBvZmZzZXRcblxuICAgIGNvbnN0IG1heFNjcm9sbERpc3RhbmNlID0gaG9zdE1ldHJpY3Muc2Nyb2xsV2lkdGggLSBob3N0TWV0cmljcy52aWV3V2lkdGg7XG4gICAgY29uc3QgY29udGVudERpc3BsYWNlbWVudCA9IGhvc3RNZXRyaWNzLnZpZXdMZWZ0IC0gaG9zdE1ldHJpY3Muc2Nyb2xsTGVmdDtcbiAgICAvLyBQZXJjZW50IG9mIGNvbnRlbnQgdG8gdGhlIGxlZnQgb2Ygb3VyIGN1cnJlbnQgcG9zaXRpb24uXG4gICAgY29uc3Qgb2Zmc2V0UmF0aW8gPSBjb250ZW50RGlzcGxhY2VtZW50IC8gbWF4U2Nyb2xsRGlzdGFuY2U7XG4gICAgLy8gQXJlYSBhdmFpbGFibGUgdG8gc2Nyb2xsICogcGVyY2VudCB0byB0aGUgbGVmdFxuICAgIGNvbnN0IG1heEhhbmRsZU9mZnNldCA9IHRoaXMuc2Nyb2xsYmFyTGVuZ3RoIC0gdGhpcy5oYW5kbGVMZW5ndGg7XG4gICAgbGV0IGhhbmRsZU9mZnNldCA9IG1heEhhbmRsZU9mZnNldCAqIG9mZnNldFJhdGlvO1xuICAgIGhhbmRsZU9mZnNldCA9IHRoaXMuY29uc3RyYWluSGFuZGxlUG9zaXRpb24oaGFuZGxlT2Zmc2V0KTtcbiAgICB0aGlzLnNldEhhbmRsZVBvc2l0aW9uKGhhbmRsZU9mZnNldCk7XG5cbiAgICAvLyBDb21wdXRlIHJhdGlvIChmb3IgdXNlIHdpdGggc2V0IGNhbGxzLCB3aGljaCBwYXNzIGluIGNvbnRlbnRcbiAgICAvLyBkaXNwbGFjZW1lbnQpLlxuICAgIHRoaXMucmF0aW8gPSBtYXhIYW5kbGVPZmZzZXQgLyBtYXhTY3JvbGxEaXN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNhbGN1bGF0ZSBhIHZlcnRpY2FsIHNjcm9sbGJhcidzIGxvY2F0aW9uIGFuZCBsZW5ndGguXG4gICAqXG4gICAqIEBwYXJhbSBob3N0TWV0cmljcyBBIGRhdGEgc3RydWN0dXJlIGRlc2NyaWJpbmcgYWxsIHRoZSByZXF1aXJlZCBkaW1lbnNpb25zLFxuICAgKiAgICAgcG9zc2libHkgZmV0Y2hlZCBmcm9tIHRoZSBob3N0IG9iamVjdC5cbiAgICovXG4gIHByaXZhdGUgcmVzaXplVmVydGljYWwoaG9zdE1ldHJpY3M6IE1ldHJpY3MpIHtcbiAgICBpZiAodGhpcy5yZXF1aXJlc1ZpZXdSZXNpemUoaG9zdE1ldHJpY3MpKSB7XG4gICAgICB0aGlzLnJlc2l6ZVZpZXdWZXJ0aWNhbChob3N0TWV0cmljcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVzaXplQ29udGVudFZlcnRpY2FsKGhvc3RNZXRyaWNzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjYWxjdWxhdGUgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIncyBsb2NhdGlvbiBvbiB0aGUgc2NyZWVuIGFuZCBwYXRoIGxlbmd0aC5cbiAgICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIHdoZW4gdGhlIGxheW91dCBvciBzaXplIG9mIHRoZSB3aW5kb3cgaGFzIGNoYW5nZWQuXG4gICAqXG4gICAqIEBwYXJhbSBob3N0TWV0cmljcyBBIGRhdGEgc3RydWN0dXJlIGRlc2NyaWJpbmcgYWxsIHRoZSByZXF1aXJlZCBkaW1lbnNpb25zLFxuICAgKiAgICAgcG9zc2libHkgZmV0Y2hlZCBmcm9tIHRoZSBob3N0IG9iamVjdC5cbiAgICovXG4gIHJlc2l6ZVZpZXdWZXJ0aWNhbChob3N0TWV0cmljczogTWV0cmljcykge1xuICAgIGxldCB2aWV3U2l6ZSA9IGhvc3RNZXRyaWNzLnZpZXdIZWlnaHQgLSB0aGlzLm1hcmdpbiAqIDI7XG4gICAgaWYgKHRoaXMucGFpcikge1xuICAgICAgLy8gU2hvcnRlbiB0aGUgc2Nyb2xsYmFyIHRvIG1ha2Ugcm9vbSBmb3IgdGhlIGNvcm5lciBzcXVhcmUuXG4gICAgICB2aWV3U2l6ZSAtPSBTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzO1xuICAgIH1cbiAgICB0aGlzLnNldFNjcm9sbGJhckxlbmd0aChNYXRoLm1heCgwLCB2aWV3U2l6ZSkpO1xuXG4gICAgY29uc3QgeENvb3JkaW5hdGUgPSB0aGlzLndvcmtzcGFjZS5SVEwgP1xuICAgICAgICBob3N0TWV0cmljcy5hYnNvbHV0ZUxlZnQgKyB0aGlzLm1hcmdpbiA6XG4gICAgICAgIGhvc3RNZXRyaWNzLmFic29sdXRlTGVmdCArIGhvc3RNZXRyaWNzLnZpZXdXaWR0aCAtXG4gICAgICAgICAgICBTY3JvbGxiYXIuc2Nyb2xsYmFyVGhpY2tuZXNzIC0gdGhpcy5tYXJnaW47XG5cbiAgICBjb25zdCB5Q29vcmRpbmF0ZSA9IGhvc3RNZXRyaWNzLmFic29sdXRlVG9wICsgdGhpcy5tYXJnaW47XG4gICAgdGhpcy5zZXRQb3NpdGlvbih4Q29vcmRpbmF0ZSwgeUNvb3JkaW5hdGUpO1xuXG4gICAgLy8gSWYgdGhlIHZpZXcgaGFzIGJlZW4gcmVzaXplZCwgYSBjb250ZW50IHJlc2l6ZSB3aWxsIGFsc28gYmUgbmVjZXNzYXJ5LlxuICAgIC8vIFRoZSByZXZlcnNlIGlzIG5vdCB0cnVlLlxuICAgIHRoaXMucmVzaXplQ29udGVudFZlcnRpY2FsKGhvc3RNZXRyaWNzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNhbGN1bGF0ZSBhIHZlcnRpY2FsIHNjcm9sbGJhcidzIGxvY2F0aW9uIHdpdGhpbiBpdHMgcGF0aCBhbmQgbGVuZ3RoLlxuICAgKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgd2hlbiB0aGUgY29udGVudHMgb2YgdGhlIHdvcmtzcGFjZSBoYXZlIGNoYW5nZWQuXG4gICAqXG4gICAqIEBwYXJhbSBob3N0TWV0cmljcyBBIGRhdGEgc3RydWN0dXJlIGRlc2NyaWJpbmcgYWxsIHRoZSByZXF1aXJlZCBkaW1lbnNpb25zLFxuICAgKiAgICAgcG9zc2libHkgZmV0Y2hlZCBmcm9tIHRoZSBob3N0IG9iamVjdC5cbiAgICovXG4gIHJlc2l6ZUNvbnRlbnRWZXJ0aWNhbChob3N0TWV0cmljczogTWV0cmljcykge1xuICAgIGlmIChob3N0TWV0cmljcy52aWV3SGVpZ2h0ID49IGhvc3RNZXRyaWNzLnNjcm9sbEhlaWdodCkge1xuICAgICAgLy8gdmlld0hlaWdodCBpcyBvZnRlbiBncmVhdGVyIHRoYW4gc2Nyb2xsSGVpZ2h0IGluIGZseW91dHMgYW5kXG4gICAgICAvLyBub24tc2Nyb2xsYWJsZSB3b3Jrc3BhY2VzLlxuICAgICAgdGhpcy5zZXRIYW5kbGVMZW5ndGgodGhpcy5zY3JvbGxiYXJMZW5ndGgpO1xuICAgICAgdGhpcy5zZXRIYW5kbGVQb3NpdGlvbigwKTtcbiAgICAgIGlmICghdGhpcy5wYWlyKSB7XG4gICAgICAgIC8vIFRoZSBzY3JvbGxiYXIgaXNuJ3QgbmVlZGVkLlxuICAgICAgICAvLyBUaGlzIGRvZXNuJ3QgYXBwbHkgdG8gc2Nyb2xsYmFyIHBhaXJzIGJlY2F1c2UgaW50ZXJhY3Rpb25zIHdpdGggdGhlXG4gICAgICAgIC8vIGNvcm5lciBzcXVhcmUgYXJlbid0IGhhbmRsZWQuXG4gICAgICAgIHRoaXMuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmICghdGhpcy5wYWlyKSB7XG4gICAgICAvLyBUaGUgc2Nyb2xsYmFyIGlzIG5lZWRlZC4gT25seSBub24tcGFpcmVkIHNjcm9sbGJhcnMgYXJlIGhpZGRlbi9zaG93bi5cbiAgICAgIHRoaXMuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICB9XG5cbiAgICAvLyBSZXNpemUgdGhlIGhhbmRsZS5cbiAgICBsZXQgaGFuZGxlTGVuZ3RoID0gdGhpcy5zY3JvbGxiYXJMZW5ndGggKiBob3N0TWV0cmljcy52aWV3SGVpZ2h0IC9cbiAgICAgICAgaG9zdE1ldHJpY3Muc2Nyb2xsSGVpZ2h0O1xuICAgIGhhbmRsZUxlbmd0aCA9IHRoaXMuY29uc3RyYWluSGFuZGxlTGVuZ3RoKGhhbmRsZUxlbmd0aCk7XG4gICAgdGhpcy5zZXRIYW5kbGVMZW5ndGgoaGFuZGxlTGVuZ3RoKTtcblxuICAgIC8vIENvbXB1dGUgdGhlIGhhbmRsZSBvZmZzZXQuXG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSBoYW5kbGUgY2FuIGJlIGJldHdlZW46XG4gICAgLy8gICAgIDAgYW5kIHRoaXMuc2Nyb2xsYmFyTGVuZ3RoXyAtIGhhbmRsZUxlbmd0aFxuICAgIC8vIElmIHZpZXdUb3AgPT09IHNjcm9sbFRvcFxuICAgIC8vICAgICB0aGVuIHRoZSBvZmZzZXQgc2hvdWxkIGJlIDBcbiAgICAvLyBJZiB2aWV3Qm90dG9tID09PSBzY3JvbGxCb3R0b21cbiAgICAvLyAgICAgdGhlbiB2aWV3VG9wID0gc2Nyb2xsVG9wICsgc2Nyb2xsSGVpZ2h0IC0gdmlld0hlaWdodFxuICAgIC8vICAgICB0aGVuIHRoZSBvZmZzZXQgc2hvdWxkIGJlIG1heCBvZmZzZXRcblxuICAgIGNvbnN0IG1heFNjcm9sbERpc3RhbmNlID0gaG9zdE1ldHJpY3Muc2Nyb2xsSGVpZ2h0IC0gaG9zdE1ldHJpY3Mudmlld0hlaWdodDtcbiAgICBjb25zdCBjb250ZW50RGlzcGxhY2VtZW50ID0gaG9zdE1ldHJpY3Mudmlld1RvcCAtIGhvc3RNZXRyaWNzLnNjcm9sbFRvcDtcbiAgICAvLyBQZXJjZW50IG9mIGNvbnRlbnQgdG8gdGhlIGxlZnQgb2Ygb3VyIGN1cnJlbnQgcG9zaXRpb24uXG4gICAgY29uc3Qgb2Zmc2V0UmF0aW8gPSBjb250ZW50RGlzcGxhY2VtZW50IC8gbWF4U2Nyb2xsRGlzdGFuY2U7XG4gICAgLy8gQXJlYSBhdmFpbGFibGUgdG8gc2Nyb2xsICogcGVyY2VudCB0byB0aGUgbGVmdFxuICAgIGNvbnN0IG1heEhhbmRsZU9mZnNldCA9IHRoaXMuc2Nyb2xsYmFyTGVuZ3RoIC0gdGhpcy5oYW5kbGVMZW5ndGg7XG4gICAgbGV0IGhhbmRsZU9mZnNldCA9IG1heEhhbmRsZU9mZnNldCAqIG9mZnNldFJhdGlvO1xuICAgIGhhbmRsZU9mZnNldCA9IHRoaXMuY29uc3RyYWluSGFuZGxlUG9zaXRpb24oaGFuZGxlT2Zmc2V0KTtcbiAgICB0aGlzLnNldEhhbmRsZVBvc2l0aW9uKGhhbmRsZU9mZnNldCk7XG5cbiAgICAvLyBDb21wdXRlIHJhdGlvIChmb3IgdXNlIHdpdGggc2V0IGNhbGxzLCB3aGljaCBwYXNzIGluIGNvbnRlbnRcbiAgICAvLyBkaXNwbGFjZW1lbnQpLlxuICAgIHRoaXMucmF0aW8gPSBtYXhIYW5kbGVPZmZzZXQgLyBtYXhTY3JvbGxEaXN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJcyB0aGUgc2Nyb2xsYmFyIHZpc2libGUuICBOb24tcGFpcmVkIHNjcm9sbGJhcnMgZGlzYXBwZWFyIHdoZW4gdGhleSBhcmVuJ3RcbiAgICogbmVlZGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHZpc2libGUuXG4gICAqL1xuICBpc1Zpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNIYW5kbGVWaXNpYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoZSBzY3JvbGxiYXIncyBjb250YWluZXIgaXMgdmlzaWJsZSBhbmQgdXBkYXRlXG4gICAqIGRpc3BsYXkgYWNjb3JkaW5nbHkgaWYgdmlzaWJpbGl0eSBoYXMgY2hhbmdlZC5cbiAgICpcbiAgICogQHBhcmFtIHZpc2libGUgV2hldGhlciB0aGUgY29udGFpbmVyIGlzIHZpc2libGVcbiAgICovXG4gIHNldENvbnRhaW5lclZpc2libGUodmlzaWJsZTogYm9vbGVhbikge1xuICAgIGNvbnN0IHZpc2liaWxpdHlDaGFuZ2VkID0gdmlzaWJsZSAhPT0gdGhpcy5jb250YWluZXJWaXNpYmxlO1xuXG4gICAgdGhpcy5jb250YWluZXJWaXNpYmxlID0gdmlzaWJsZTtcbiAgICBpZiAodmlzaWJpbGl0eUNoYW5nZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheV8oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhlIHNjcm9sbGJhciBpcyB2aXNpYmxlLlxuICAgKiBPbmx5IGFwcGxpZXMgdG8gbm9uLXBhaXJlZCBzY3JvbGxiYXJzLlxuICAgKlxuICAgKiBAcGFyYW0gdmlzaWJsZSBUcnVlIGlmIHZpc2libGUuXG4gICAqL1xuICBzZXRWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB2aXNpYmlsaXR5Q2hhbmdlZCA9IHZpc2libGUgIT09IHRoaXMuaXNWaXNpYmxlKCk7XG5cbiAgICAvLyBJZGVhbGx5IHRoaXMgd291bGQgYWxzbyBhcHBseSB0byBzY3JvbGxiYXIgcGFpcnMsIGJ1dCB0aGF0J3MgYSBiaWdnZXJcbiAgICAvLyBoZWFkYWNoZSAoZHVlIHRvIGludGVyYWN0aW9ucyB3aXRoIHRoZSBjb3JuZXIgc3F1YXJlKS5cbiAgICBpZiAodGhpcy5wYWlyKSB7XG4gICAgICB0aHJvdyBFcnJvcignVW5hYmxlIHRvIHRvZ2dsZSB2aXNpYmlsaXR5IG9mIHBhaXJlZCBzY3JvbGxiYXJzLicpO1xuICAgIH1cbiAgICB0aGlzLmlzSGFuZGxlVmlzaWJsZSA9IHZpc2libGU7XG4gICAgaWYgKHZpc2liaWxpdHlDaGFuZ2VkKSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BsYXlfKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB2aXNpYmlsaXR5IG9mIHNjcm9sbGJhciBiYXNlZCBvbiB3aGV0aGVyIGl0IHRoaW5rcyBpdCBzaG91bGRcbiAgICogYmUgdmlzaWJsZSBhbmQgd2hldGhlciBpdHMgY29udGFpbmluZyB3b3Jrc3BhY2UgaXMgdmlzaWJsZS5cbiAgICogV2UgY2Fubm90IHJlbHkgb24gdGhlIGNvbnRhaW5pbmcgd29ya3NwYWNlIGJlaW5nIGhpZGRlbiB0byBoaWRlIHVzXG4gICAqIGJlY2F1c2UgaXQgaXMgbm90IG5lY2Vzc2FyaWx5IG91ciBwYXJlbnQgaW4gdGhlIERPTS5cbiAgICovXG4gIHVwZGF0ZURpc3BsYXlfKCkge1xuICAgIGxldCBzaG93ID0gdHJ1ZTtcbiAgICAvLyBDaGVjayB3aGV0aGVyIG91ciBwYXJlbnQvY29udGFpbmVyIGlzIHZpc2libGUuXG4gICAgaWYgKCF0aGlzLmNvbnRhaW5lclZpc2libGUpIHtcbiAgICAgIHNob3cgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hvdyA9IHRoaXMuaXNWaXNpYmxlKCk7XG4gICAgfVxuICAgIGlmIChzaG93KSB7XG4gICAgICB0aGlzLm91dGVyU3ZnLnNldEF0dHJpYnV0ZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm91dGVyU3ZnLnNldEF0dHJpYnV0ZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCBieSBvbmUgcGFnZWZ1bC5cbiAgICogQ2FsbGVkIHdoZW4gc2Nyb2xsYmFyIGJhY2tncm91bmQgaXMgY2xpY2tlZC5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2UgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25Nb3VzZURvd25CYXIoZTogTW91c2VFdmVudCkge1xuICAgIHRoaXMud29ya3NwYWNlLm1hcmtGb2N1c2VkKCk7XG4gICAgVG91Y2guY2xlYXJUb3VjaElkZW50aWZpZXIoKTsgIC8vIFRoaXMgaXMgcmVhbGx5IGEgY2xpY2suXG4gICAgdGhpcy5jbGVhblVwKCk7XG4gICAgaWYgKGJyb3dzZXJFdmVudHMuaXNSaWdodEJ1dHRvbihlKSkge1xuICAgICAgLy8gUmlnaHQtY2xpY2suXG4gICAgICAvLyBTY3JvbGxiYXJzIGhhdmUgbm8gY29udGV4dCBtZW51LlxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbW91c2VYWSA9IGJyb3dzZXJFdmVudHMubW91c2VUb1N2ZyhcbiAgICAgICAgZSwgdGhpcy53b3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCksIHRoaXMud29ya3NwYWNlLmdldEludmVyc2VTY3JlZW5DVE0oKSk7XG4gICAgY29uc3QgbW91c2VMb2NhdGlvbiA9IHRoaXMuaG9yaXpvbnRhbCA/IG1vdXNlWFkueCA6IG1vdXNlWFkueTtcblxuICAgIGNvbnN0IGhhbmRsZVhZID0gc3ZnTWF0aC5nZXRJbmplY3Rpb25EaXZYWSh0aGlzLnN2Z0hhbmRsZSk7XG4gICAgY29uc3QgaGFuZGxlU3RhcnQgPSB0aGlzLmhvcml6b250YWwgPyBoYW5kbGVYWS54IDogaGFuZGxlWFkueTtcbiAgICBsZXQgaGFuZGxlUG9zaXRpb24gPSB0aGlzLmhhbmRsZVBvc2l0aW9uO1xuXG4gICAgY29uc3QgcGFnZUxlbmd0aCA9IHRoaXMuaGFuZGxlTGVuZ3RoICogMC45NTtcbiAgICBpZiAobW91c2VMb2NhdGlvbiA8PSBoYW5kbGVTdGFydCkge1xuICAgICAgLy8gRGVjcmVhc2UgdGhlIHNjcm9sbGJhcidzIHZhbHVlIGJ5IGEgcGFnZS5cbiAgICAgIGhhbmRsZVBvc2l0aW9uIC09IHBhZ2VMZW5ndGg7XG4gICAgfSBlbHNlIGlmIChtb3VzZUxvY2F0aW9uID49IGhhbmRsZVN0YXJ0ICsgdGhpcy5oYW5kbGVMZW5ndGgpIHtcbiAgICAgIC8vIEluY3JlYXNlIHRoZSBzY3JvbGxiYXIncyB2YWx1ZSBieSBhIHBhZ2UuXG4gICAgICBoYW5kbGVQb3NpdGlvbiArPSBwYWdlTGVuZ3RoO1xuICAgIH1cblxuICAgIHRoaXMuc2V0SGFuZGxlUG9zaXRpb24odGhpcy5jb25zdHJhaW5IYW5kbGVQb3NpdGlvbihoYW5kbGVQb3NpdGlvbikpO1xuXG4gICAgdGhpcy51cGRhdGVNZXRyaWNzKCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgYSBkcmFnZ2luZyBvcGVyYXRpb24uXG4gICAqIENhbGxlZCB3aGVuIHNjcm9sbGJhciBoYW5kbGUgaXMgY2xpY2tlZC5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2UgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25Nb3VzZURvd25IYW5kbGUoZTogUG9pbnRlckV2ZW50KSB7XG4gICAgdGhpcy53b3Jrc3BhY2UubWFya0ZvY3VzZWQoKTtcbiAgICB0aGlzLmNsZWFuVXAoKTtcbiAgICBpZiAoYnJvd3NlckV2ZW50cy5pc1JpZ2h0QnV0dG9uKGUpKSB7XG4gICAgICAvLyBSaWdodC1jbGljay5cbiAgICAgIC8vIFNjcm9sbGJhcnMgaGF2ZSBubyBjb250ZXh0IG1lbnUuXG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBMb29rIHVwIHRoZSBjdXJyZW50IHRyYW5zbGF0aW9uIGFuZCByZWNvcmQgaXQuXG4gICAgdGhpcy5zdGFydERyYWdIYW5kbGUgPSB0aGlzLmhhbmRsZVBvc2l0aW9uO1xuXG4gICAgLy8gVGVsbCB0aGUgd29ya3NwYWNlIHRvIHNldHVwIGl0cyBkcmFnIHN1cmZhY2Ugc2luY2UgaXQgaXMgYWJvdXQgdG8gbW92ZS5cbiAgICAvLyBvbk1vdXNlTW92ZUhhbmRsZSB3aWxsIGNhbGwgb25TY3JvbGwgd2hpY2ggYWN0dWFsbHkgdGVsbHMgdGhlIHdvcmtzcGFjZVxuICAgIC8vIHRvIG1vdmUuXG4gICAgdGhpcy53b3Jrc3BhY2Uuc2V0dXBEcmFnU3VyZmFjZSgpO1xuXG4gICAgLy8gUmVjb3JkIHRoZSBjdXJyZW50IG1vdXNlIHBvc2l0aW9uLlxuICAgIHRoaXMuc3RhcnREcmFnTW91c2UgPSB0aGlzLmhvcml6b250YWwgPyBlLmNsaWVudFggOiBlLmNsaWVudFk7XG4gICAgdGhpcy5vbk1vdXNlVXBXcmFwcGVyXyA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBkb2N1bWVudCwgJ3BvaW50ZXJ1cCcsIHRoaXMsIHRoaXMub25Nb3VzZVVwSGFuZGxlKTtcbiAgICB0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgZG9jdW1lbnQsICdwb2ludGVybW92ZScsIHRoaXMsIHRoaXMub25Nb3VzZU1vdmVIYW5kbGUpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYWcgdGhlIHNjcm9sbGJhcidzIGhhbmRsZS5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2UgbW92ZSBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25Nb3VzZU1vdmVIYW5kbGUoZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3QgY3VycmVudE1vdXNlID0gdGhpcy5ob3Jpem9udGFsID8gZS5jbGllbnRYIDogZS5jbGllbnRZO1xuICAgIGNvbnN0IG1vdXNlRGVsdGEgPSBjdXJyZW50TW91c2UgLSB0aGlzLnN0YXJ0RHJhZ01vdXNlO1xuICAgIGNvbnN0IGhhbmRsZVBvc2l0aW9uID0gdGhpcy5zdGFydERyYWdIYW5kbGUgKyBtb3VzZURlbHRhO1xuICAgIC8vIFBvc2l0aW9uIHRoZSBiYXIuXG4gICAgdGhpcy5zZXRIYW5kbGVQb3NpdGlvbih0aGlzLmNvbnN0cmFpbkhhbmRsZVBvc2l0aW9uKGhhbmRsZVBvc2l0aW9uKSk7XG4gICAgdGhpcy51cGRhdGVNZXRyaWNzKCk7XG4gIH1cblxuICAvKiogUmVsZWFzZSB0aGUgc2Nyb2xsYmFyIGhhbmRsZSBhbmQgcmVzZXQgc3RhdGUgYWNjb3JkaW5nbHkuICovXG4gIHByaXZhdGUgb25Nb3VzZVVwSGFuZGxlKCkge1xuICAgIC8vIFRlbGwgdGhlIHdvcmtzcGFjZSB0byBjbGVhbiB1cCBub3cgdGhhdCB0aGUgd29ya3NwYWNlIGlzIGRvbmUgbW92aW5nLlxuICAgIHRoaXMud29ya3NwYWNlLnJlc2V0RHJhZ1N1cmZhY2UoKTtcbiAgICBUb3VjaC5jbGVhclRvdWNoSWRlbnRpZmllcigpO1xuICAgIHRoaXMuY2xlYW5VcCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgY2hhZmYgYW5kIHN0b3AgYmluZGluZyB0byBtb3VzZXVwIGFuZCBtb3VzZW1vdmUgZXZlbnRzLiAgQ2FsbCB0aGlzIHRvXG4gICAqIHdyYXAgdXAgbG9vc2UgZW5kcyBhc3NvY2lhdGVkIHdpdGggdGhlIHNjcm9sbGJhci5cbiAgICovXG4gIHByaXZhdGUgY2xlYW5VcCgpIHtcbiAgICB0aGlzLndvcmtzcGFjZS5oaWRlQ2hhZmYodHJ1ZSk7XG4gICAgaWYgKHRoaXMub25Nb3VzZVVwV3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25Nb3VzZVVwV3JhcHBlcl8pO1xuICAgICAgdGhpcy5vbk1vdXNlVXBXcmFwcGVyXyA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25Nb3VzZU1vdmVXcmFwcGVyXyk7XG4gICAgICB0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgdG8gY2FsY3VsYXRlIHRoZSByYXRpbyBvZiBoYW5kbGUgcG9zaXRpb24gdG8gc2Nyb2xsYmFyIHZpZXcgc2l6ZS5cbiAgICpcbiAgICogQHJldHVybnMgUmF0aW8uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0UmF0aW9fKCk6IG51bWJlciB7XG4gICAgY29uc3Qgc2Nyb2xsSGFuZGxlUmFuZ2UgPSB0aGlzLnNjcm9sbGJhckxlbmd0aCAtIHRoaXMuaGFuZGxlTGVuZ3RoO1xuICAgIGxldCByYXRpbyA9IHRoaXMuaGFuZGxlUG9zaXRpb24gLyBzY3JvbGxIYW5kbGVSYW5nZTtcbiAgICBpZiAoaXNOYU4ocmF0aW8pKSB7XG4gICAgICByYXRpbyA9IDA7XG4gICAgfVxuICAgIHJldHVybiByYXRpbztcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHdvcmtzcGFjZSBtZXRyaWNzIGJhc2VkIG9uIG5ldyBzY3JvbGwgcmF0aW8uIENhbGxlZCB3aGVuIHNjcm9sbGJhclxuICAgKiBpcyBtb3ZlZC5cbiAgICovXG4gIHByaXZhdGUgdXBkYXRlTWV0cmljcygpIHtcbiAgICBjb25zdCByYXRpbyA9IHRoaXMuZ2V0UmF0aW9fKCk7XG4gICAgaWYgKHRoaXMuaG9yaXpvbnRhbCkge1xuICAgICAgdGhpcy53b3Jrc3BhY2Uuc2V0TWV0cmljcyh7eDogcmF0aW99KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy53b3Jrc3BhY2Uuc2V0TWV0cmljcyh7eTogcmF0aW99KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzY3JvbGxiYXIgaGFuZGxlJ3MgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgY29udGVudCBkaXNwbGFjZW1lbnQsIHJlbGF0aXZlIHRvIHRoZSB2aWV3IGluIHBpeGVscy5cbiAgICogQHBhcmFtIHVwZGF0ZU1ldHJpY3MgV2hldGhlciB0byB1cGRhdGUgbWV0cmljcyBvbiB0aGlzIHNldCBjYWxsLlxuICAgKiAgICBEZWZhdWx0cyB0byB0cnVlLlxuICAgKi9cbiAgc2V0KHZhbHVlOiBudW1iZXIsIHVwZGF0ZU1ldHJpY3M/OiBib29sZWFuKSB7XG4gICAgdGhpcy5zZXRIYW5kbGVQb3NpdGlvbih0aGlzLmNvbnN0cmFpbkhhbmRsZVBvc2l0aW9uKHZhbHVlICogdGhpcy5yYXRpbykpO1xuICAgIGlmICh1cGRhdGVNZXRyaWNzIHx8IHVwZGF0ZU1ldHJpY3MgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy51cGRhdGVNZXRyaWNzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCB0aGUgb3JpZ2luIG9mIHRoZSB3b3Jrc3BhY2UgdGhhdCB0aGUgc2Nyb2xsYmFyIGlzIGluLCBpbiBwaXhlbHNcbiAgICogcmVsYXRpdmUgdG8gdGhlIGluamVjdGlvbiBkaXYgb3JpZ2luLiBUaGlzIGlzIGZvciB0aW1lcyB3aGVuIHRoZSBzY3JvbGxiYXJcbiAgICogaXMgdXNlZCBpbiBhbiBvYmplY3Qgd2hvc2Ugb3JpZ2luIGlzbid0IHRoZSBzYW1lIGFzIHRoZSBtYWluIHdvcmtzcGFjZVxuICAgKiAoZS5nLiBpbiBhIGZseW91dC4pXG4gICAqXG4gICAqIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHNjcm9sbGJhcidzIG9yaWdpbiwgaW4gQ1NTIHBpeGVscy5cbiAgICogQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgc2Nyb2xsYmFyJ3Mgb3JpZ2luLCBpbiBDU1MgcGl4ZWxzLlxuICAgKi9cbiAgc2V0T3JpZ2luKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5vcmlnaW4gPSBuZXcgQ29vcmRpbmF0ZSh4LCB5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gZmlyc3QgQW4gb2JqZWN0IGNvbnRhaW5pbmcgY29tcHV0ZWQgbWVhc3VyZW1lbnRzIG9mIGEgd29ya3NwYWNlLlxuICAgKiBAcGFyYW0gc2Vjb25kIEFub3RoZXIgb2JqZWN0IGNvbnRhaW5pbmcgY29tcHV0ZWQgbWVhc3VyZW1lbnRzIG9mIGFcbiAgICogICAgIHdvcmtzcGFjZS5cbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgdHdvIHNldHMgb2YgbWV0cmljcyBhcmUgZXF1aXZhbGVudC5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIG1ldHJpY3NBcmVFcXVpdmFsZW50KGZpcnN0OiBNZXRyaWNzLCBzZWNvbmQ6IE1ldHJpY3MpOlxuICAgICAgYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZpcnN0LnZpZXdXaWR0aCA9PT0gc2Vjb25kLnZpZXdXaWR0aCAmJlxuICAgICAgICBmaXJzdC52aWV3SGVpZ2h0ID09PSBzZWNvbmQudmlld0hlaWdodCAmJlxuICAgICAgICBmaXJzdC52aWV3TGVmdCA9PT0gc2Vjb25kLnZpZXdMZWZ0ICYmXG4gICAgICAgIGZpcnN0LnZpZXdUb3AgPT09IHNlY29uZC52aWV3VG9wICYmXG4gICAgICAgIGZpcnN0LmFic29sdXRlVG9wID09PSBzZWNvbmQuYWJzb2x1dGVUb3AgJiZcbiAgICAgICAgZmlyc3QuYWJzb2x1dGVMZWZ0ID09PSBzZWNvbmQuYWJzb2x1dGVMZWZ0ICYmXG4gICAgICAgIGZpcnN0LnNjcm9sbFdpZHRoID09PSBzZWNvbmQuc2Nyb2xsV2lkdGggJiZcbiAgICAgICAgZmlyc3Quc2Nyb2xsSGVpZ2h0ID09PSBzZWNvbmQuc2Nyb2xsSGVpZ2h0ICYmXG4gICAgICAgIGZpcnN0LnNjcm9sbExlZnQgPT09IHNlY29uZC5zY3JvbGxMZWZ0ICYmXG4gICAgICAgIGZpcnN0LnNjcm9sbFRvcCA9PT0gc2Vjb25kLnNjcm9sbFRvcDtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSBVSSBidWJibGUuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuQnViYmxlJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja0RyYWdTdXJmYWNlU3ZnfSBmcm9tICcuL2Jsb2NrX2RyYWdfc3VyZmFjZS5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgdHlwZSB7SUJ1YmJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYnViYmxlLmpzJztcbmltcG9ydCB0eXBlIHtDb250YWluZXJSZWdpb259IGZyb20gJy4vbWV0cmljc19tYW5hZ2VyLmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyfSBmcm9tICcuL3Njcm9sbGJhci5qcyc7XG5pbXBvcnQgKiBhcyBUb3VjaCBmcm9tICcuL3RvdWNoLmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgKiBhcyBtYXRoIGZyb20gJy4vdXRpbHMvbWF0aC5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vdXRpbHMvc2l6ZS5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuaW1wb3J0ICogYXMgdXNlckFnZW50IGZyb20gJy4vdXRpbHMvdXNlcmFnZW50LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgVUkgYnViYmxlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkJ1YmJsZVxuICovXG5leHBvcnQgY2xhc3MgQnViYmxlIGltcGxlbWVudHMgSUJ1YmJsZSB7XG4gIC8qKiBXaWR0aCBvZiB0aGUgYm9yZGVyIGFyb3VuZCB0aGUgYnViYmxlLiAqL1xuICBzdGF0aWMgQk9SREVSX1dJRFRIID0gNjtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB0aGUgdGhpY2tuZXNzIG9mIHRoZSBiYXNlIG9mIHRoZSBhcnJvdyBpbiByZWxhdGlvbiB0byB0aGUgc2l6ZVxuICAgKiBvZiB0aGUgYnViYmxlLiAgSGlnaGVyIG51bWJlcnMgcmVzdWx0IGluIHRoaW5uZXIgYXJyb3dzLlxuICAgKi9cbiAgc3RhdGljIEFSUk9XX1RISUNLTkVTUyA9IDU7XG5cbiAgLyoqIFRoZSBudW1iZXIgb2YgZGVncmVlcyB0aGF0IHRoZSBhcnJvdyBiZW5kcyBjb3VudGVyLWNsb2Nrd2lzZS4gKi9cbiAgc3RhdGljIEFSUk9XX0FOR0xFID0gMjA7XG5cbiAgLyoqXG4gICAqIFRoZSBzaGFycG5lc3Mgb2YgdGhlIGFycm93J3MgYmVuZC4gIEhpZ2hlciBudW1iZXJzIHJlc3VsdCBpbiBzbW9vdGhlclxuICAgKiBhcnJvd3MuXG4gICAqL1xuICBzdGF0aWMgQVJST1dfQkVORCA9IDQ7XG5cbiAgLyoqIERpc3RhbmNlIGJldHdlZW4gYXJyb3cgcG9pbnQgYW5kIGFuY2hvciBwb2ludC4gKi9cbiAgc3RhdGljIEFOQ0hPUl9SQURJVVMgPSA4O1xuXG4gIC8qKiBNb3VzZSB1cCBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIHN0YXRpYyBvbk1vdXNlVXBXcmFwcGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIE1vdXNlIG1vdmUgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBzdGF0aWMgb25Nb3VzZU1vdmVXcmFwcGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgd29ya3NwYWNlXzogV29ya3NwYWNlU3ZnO1xuICBjb250ZW50XzogU1ZHRWxlbWVudDtcbiAgc2hhcGVfOiBTVkdFbGVtZW50O1xuXG4gIC8qKiBGbGFnIHRvIHN0b3AgaW5jcmVtZW50YWwgcmVuZGVyaW5nIGR1cmluZyBjb25zdHJ1Y3Rpb24uICovXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZWQ6IGJvb2xlYW47XG5cbiAgLyoqIFRoZSBTVkcgZ3JvdXAgY29udGFpbmluZyBhbGwgcGFydHMgb2YgdGhlIGJ1YmJsZS4gKi9cbiAgcHJpdmF0ZSBidWJibGVHcm91cDogU1ZHR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBTVkcgcGF0aCBmb3IgdGhlIGFycm93IGZyb20gdGhlIGJ1YmJsZSB0byB0aGUgaWNvbiBvbiB0aGUgYmxvY2suXG4gICAqL1xuICBwcml2YXRlIGJ1YmJsZUFycm93OiBTVkdQYXRoRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIFNWRyByZWN0IGZvciB0aGUgbWFpbiBib2R5IG9mIHRoZSBidWJibGUuICovXG4gIHByaXZhdGUgYnViYmxlQmFjazogU1ZHUmVjdEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBTVkcgZ3JvdXAgZm9yIHRoZSByZXNpemUgaGFzaCBtYXJrcyBvbiBzb21lIGJ1YmJsZXMuICovXG4gIHByaXZhdGUgcmVzaXplR3JvdXA6IFNWR0dFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBBYnNvbHV0ZSBjb29yZGluYXRlIG9mIGFuY2hvciBwb2ludCwgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLiAqL1xuICBwcml2YXRlIGFuY2hvclhZITogQ29vcmRpbmF0ZTtcblxuICAvKipcbiAgICogUmVsYXRpdmUgWCBjb29yZGluYXRlIG9mIGJ1YmJsZSB3aXRoIHJlc3BlY3QgdG8gdGhlIGFuY2hvcidzIGNlbnRyZSxcbiAgICogaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBJbiBSVEwgbW9kZSB0aGUgaW5pdGlhbCB2YWx1ZSBpcyBuZWdhdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSByZWxhdGl2ZUxlZnQgPSAwO1xuXG4gIC8qKlxuICAgKiBSZWxhdGl2ZSBZIGNvb3JkaW5hdGUgb2YgYnViYmxlIHdpdGggcmVzcGVjdCB0byB0aGUgYW5jaG9yJ3MgY2VudHJlLCBpblxuICAgKiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBwcml2YXRlIHJlbGF0aXZlVG9wID0gMDtcblxuICAvKiogV2lkdGggb2YgYnViYmxlLCBpbiB3b3Jrc3BhY2UgdW5pdHMuICovXG4gIHByaXZhdGUgd2lkdGggPSAwO1xuXG4gIC8qKiBIZWlnaHQgb2YgYnViYmxlLCBpbiB3b3Jrc3BhY2UgdW5pdHMuICovXG4gIHByaXZhdGUgaGVpZ2h0ID0gMDtcblxuICAvKiogQXV0b21hdGljYWxseSBwb3NpdGlvbiBhbmQgcmVwb3NpdGlvbiB0aGUgYnViYmxlLiAqL1xuICBwcml2YXRlIGF1dG9MYXlvdXQgPSB0cnVlO1xuXG4gIC8qKiBNZXRob2QgdG8gY2FsbCBvbiByZXNpemUgb2YgYnViYmxlLiAqL1xuICBwcml2YXRlIHJlc2l6ZUNhbGxiYWNrOiAoKCkgPT4gdm9pZCl8bnVsbCA9IG51bGw7XG5cbiAgLyoqIE1ldGhvZCB0byBjYWxsIG9uIG1vdmUgb2YgYnViYmxlLiAqL1xuICBwcml2YXRlIG1vdmVDYWxsYmFjazogKCgpID0+IHZvaWQpfG51bGwgPSBudWxsO1xuXG4gIC8qKiBNb3VzZSBkb3duIG9uIGJ1YmJsZUJhY2sgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbk1vdXNlRG93bkJ1YmJsZVdyYXBwZXI6IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogTW91c2UgZG93biBvbiByZXNpemVHcm91cCBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIG9uTW91c2VEb3duUmVzaXplV3JhcHBlcjogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBEZXNjcmliZXMgd2hldGhlciB0aGlzIGJ1YmJsZSBoYXMgYmVlbiBkaXNwb3NlZCBvZiAobm9kZXMgYW5kIGV2ZW50XG4gICAqIGxpc3RlbmVycyByZW1vdmVkIGZyb20gdGhlIHBhZ2UpIG9yIG5vdC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBkaXNwb3NlZCA9IGZhbHNlO1xuICBwcml2YXRlIGFycm93UmFkaWFuczogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2Ugb24gd2hpY2ggdG8gZHJhdyB0aGUgYnViYmxlLlxuICAgKiBAcGFyYW0gY29udGVudCBTVkcgY29udGVudCBmb3IgdGhlIGJ1YmJsZS5cbiAgICogQHBhcmFtIHNoYXBlIFNWRyBlbGVtZW50IHRvIGF2b2lkIGVjbGlwc2luZy5cbiAgICogQHBhcmFtIGFuY2hvclhZIEFic29sdXRlIHBvc2l0aW9uIG9mIGJ1YmJsZSdzIGFuY2hvciBwb2ludC5cbiAgICogQHBhcmFtIGJ1YmJsZVdpZHRoIFdpZHRoIG9mIGJ1YmJsZSwgb3IgbnVsbCBpZiBub3QgcmVzaXphYmxlLlxuICAgKiBAcGFyYW0gYnViYmxlSGVpZ2h0IEhlaWdodCBvZiBidWJibGUsIG9yIG51bGwgaWYgbm90IHJlc2l6YWJsZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcsIGNvbnRlbnQ6IFNWR0VsZW1lbnQsIHNoYXBlOiBTVkdFbGVtZW50LFxuICAgICAgYW5jaG9yWFk6IENvb3JkaW5hdGUsIGJ1YmJsZVdpZHRoOiBudW1iZXJ8bnVsbCxcbiAgICAgIGJ1YmJsZUhlaWdodDogbnVtYmVyfG51bGwpIHtcbiAgICB0aGlzLnJlbmRlcmVkID0gZmFsc2U7XG4gICAgdGhpcy53b3Jrc3BhY2VfID0gd29ya3NwYWNlO1xuICAgIHRoaXMuY29udGVudF8gPSBjb250ZW50O1xuICAgIHRoaXMuc2hhcGVfID0gc2hhcGU7XG5cbiAgICBsZXQgYW5nbGUgPSBCdWJibGUuQVJST1dfQU5HTEU7XG4gICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgIGFuZ2xlID0gLWFuZ2xlO1xuICAgIH1cbiAgICB0aGlzLmFycm93UmFkaWFucyA9IG1hdGgudG9SYWRpYW5zKGFuZ2xlKTtcblxuICAgIGNvbnN0IGNhbnZhcyA9IHdvcmtzcGFjZS5nZXRCdWJibGVDYW52YXMoKTtcbiAgICBjYW52YXMuYXBwZW5kQ2hpbGQoXG4gICAgICAgIHRoaXMuY3JlYXRlRG9tKGNvbnRlbnQsICEhKGJ1YmJsZVdpZHRoICYmIGJ1YmJsZUhlaWdodCkpKTtcblxuICAgIHRoaXMuc2V0QW5jaG9yTG9jYXRpb24oYW5jaG9yWFkpO1xuICAgIGlmICghYnViYmxlV2lkdGggfHwgIWJ1YmJsZUhlaWdodCkge1xuICAgICAgY29uc3QgYkJveCA9ICh0aGlzLmNvbnRlbnRfIGFzIFNWR0dyYXBoaWNzRWxlbWVudCkuZ2V0QkJveCgpO1xuICAgICAgYnViYmxlV2lkdGggPSBiQm94LndpZHRoICsgMiAqIEJ1YmJsZS5CT1JERVJfV0lEVEg7XG4gICAgICBidWJibGVIZWlnaHQgPSBiQm94LmhlaWdodCArIDIgKiBCdWJibGUuQk9SREVSX1dJRFRIO1xuICAgIH1cbiAgICB0aGlzLnNldEJ1YmJsZVNpemUoYnViYmxlV2lkdGgsIGJ1YmJsZUhlaWdodCk7XG5cbiAgICAvLyBSZW5kZXIgdGhlIGJ1YmJsZS5cbiAgICB0aGlzLnBvc2l0aW9uQnViYmxlKCk7XG4gICAgdGhpcy5yZW5kZXJBcnJvdygpO1xuICAgIHRoaXMucmVuZGVyZWQgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYnViYmxlJ3MgRE9NLlxuICAgKlxuICAgKiBAcGFyYW0gY29udGVudCBTVkcgY29udGVudCBmb3IgdGhlIGJ1YmJsZS5cbiAgICogQHBhcmFtIGhhc1Jlc2l6ZSBBZGQgZGlhZ29uYWwgcmVzaXplIGdyaXBwZXIgaWYgdHJ1ZS5cbiAgICogQHJldHVybnMgVGhlIGJ1YmJsZSdzIFNWRyBncm91cC5cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRG9tKGNvbnRlbnQ6IEVsZW1lbnQsIGhhc1Jlc2l6ZTogYm9vbGVhbik6IFNWR0VsZW1lbnQge1xuICAgIC8qIENyZWF0ZSB0aGUgYnViYmxlLiAgSGVyZSdzIHRoZSBtYXJrdXAgdGhhdCB3aWxsIGJlIGdlbmVyYXRlZDpcbiAgICAgICAgPGc+XG4gICAgICAgICAgPGcgZmlsdGVyPVwidXJsKCNibG9ja2x5RW1ib3NzRmlsdGVyODM3NDkzKVwiPlxuICAgICAgICAgICAgPHBhdGggZD1cIi4uLiBaXCIgLz5cbiAgICAgICAgICAgIDxyZWN0IGNsYXNzPVwiYmxvY2tseURyYWdnYWJsZVwiIHJ4PVwiOFwiIHJ5PVwiOFwiIHdpZHRoPVwiMTgwXCJcbiAgICAgICBoZWlnaHQ9XCIxODBcIi8+XG4gICAgICAgICAgPC9nPlxuICAgICAgICAgIDxnIHRyYW5zZm9ybT1cInRyYW5zbGF0ZSgxNjUsIDE2NSlcIiBjbGFzcz1cImJsb2NrbHlSZXNpemVTRVwiPlxuICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPVwiMCwxNSAxNSwxNSAxNSwwXCIvPlxuICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJibG9ja2x5UmVzaXplTGluZVwiIHgxPVwiNVwiIHkxPVwiMTRcIiB4Mj1cIjE0XCIgeTI9XCI1XCIvPlxuICAgICAgICAgICAgPGxpbmUgY2xhc3M9XCJibG9ja2x5UmVzaXplTGluZVwiIHgxPVwiMTBcIiB5MT1cIjE0XCIgeDI9XCIxNFwiIHkyPVwiMTBcIi8+XG4gICAgICAgICAgPC9nPlxuICAgICAgICAgIFsuLi5jb250ZW50IGdvZXMgaGVyZS4uLl1cbiAgICAgICAgPC9nPlxuICAgICAgICAqL1xuICAgIHRoaXMuYnViYmxlR3JvdXAgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuRywge30pO1xuICAgIGxldCBmaWx0ZXI6IHtmaWx0ZXI/OiBzdHJpbmd9ID0ge1xuICAgICAgJ2ZpbHRlcic6ICd1cmwoIycgK1xuICAgICAgICAgIHRoaXMud29ya3NwYWNlXy5nZXRSZW5kZXJlcigpLmdldENvbnN0YW50cygpLmVtYm9zc0ZpbHRlcklkICsgJyknLFxuICAgIH07XG4gICAgaWYgKHVzZXJBZ2VudC5KYXZhRngpIHtcbiAgICAgIC8vIE11bHRpcGxlIHJlcG9ydHMgdGhhdCBKYXZhRlggY2FuJ3QgaGFuZGxlIGZpbHRlcnMuXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Jsb2NrbHkvaXNzdWVzLzk5XG4gICAgICBmaWx0ZXIgPSB7fTtcbiAgICB9XG4gICAgY29uc3QgYnViYmxlRW1ib3NzID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkcsIGZpbHRlciwgdGhpcy5idWJibGVHcm91cCk7XG4gICAgdGhpcy5idWJibGVBcnJvdyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5QQVRILCB7fSwgYnViYmxlRW1ib3NzKTtcbiAgICB0aGlzLmJ1YmJsZUJhY2sgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlJFQ1QsIHtcbiAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseURyYWdnYWJsZScsXG4gICAgICAgICAgJ3gnOiAwLFxuICAgICAgICAgICd5JzogMCxcbiAgICAgICAgICAncngnOiBCdWJibGUuQk9SREVSX1dJRFRILFxuICAgICAgICAgICdyeSc6IEJ1YmJsZS5CT1JERVJfV0lEVEgsXG4gICAgICAgIH0sXG4gICAgICAgIGJ1YmJsZUVtYm9zcyk7XG4gICAgaWYgKGhhc1Jlc2l6ZSkge1xuICAgICAgdGhpcy5yZXNpemVHcm91cCA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5HLCB7XG4gICAgICAgICAgICAnY2xhc3MnOiB0aGlzLndvcmtzcGFjZV8uUlRMID8gJ2Jsb2NrbHlSZXNpemVTVycgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdibG9ja2x5UmVzaXplU0UnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5idWJibGVHcm91cCk7XG4gICAgICBjb25zdCByZXNpemVTaXplID0gMiAqIEJ1YmJsZS5CT1JERVJfV0lEVEg7XG4gICAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuUE9MWUdPTixcbiAgICAgICAgICB7J3BvaW50cyc6ICcwLHggeCx4IHgsMCcucmVwbGFjZSgveC9nLCByZXNpemVTaXplLnRvU3RyaW5nKCkpfSxcbiAgICAgICAgICB0aGlzLnJlc2l6ZUdyb3VwKTtcbiAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5MSU5FLCB7XG4gICAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseVJlc2l6ZUxpbmUnLFxuICAgICAgICAgICAgJ3gxJzogcmVzaXplU2l6ZSAvIDMsXG4gICAgICAgICAgICAneTEnOiByZXNpemVTaXplIC0gMSxcbiAgICAgICAgICAgICd4Mic6IHJlc2l6ZVNpemUgLSAxLFxuICAgICAgICAgICAgJ3kyJzogcmVzaXplU2l6ZSAvIDMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0aGlzLnJlc2l6ZUdyb3VwKTtcbiAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5MSU5FLCB7XG4gICAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseVJlc2l6ZUxpbmUnLFxuICAgICAgICAgICAgJ3gxJzogcmVzaXplU2l6ZSAqIDIgLyAzLFxuICAgICAgICAgICAgJ3kxJzogcmVzaXplU2l6ZSAtIDEsXG4gICAgICAgICAgICAneDInOiByZXNpemVTaXplIC0gMSxcbiAgICAgICAgICAgICd5Mic6IHJlc2l6ZVNpemUgKiAyIC8gMyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMucmVzaXplR3JvdXApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlc2l6ZUdyb3VwID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMud29ya3NwYWNlXy5vcHRpb25zLnJlYWRPbmx5KSB7XG4gICAgICB0aGlzLm9uTW91c2VEb3duQnViYmxlV3JhcHBlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICAgIHRoaXMuYnViYmxlQmFjaywgJ3BvaW50ZXJkb3duJywgdGhpcywgdGhpcy5idWJibGVNb3VzZURvd24pO1xuICAgICAgaWYgKHRoaXMucmVzaXplR3JvdXApIHtcbiAgICAgICAgdGhpcy5vbk1vdXNlRG93blJlc2l6ZVdyYXBwZXIgPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICAgIHRoaXMucmVzaXplR3JvdXAsICdwb2ludGVyZG93bicsIHRoaXMsIHRoaXMucmVzaXplTW91c2VEb3duKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5idWJibGVHcm91cC5hcHBlbmRDaGlsZChjb250ZW50KTtcbiAgICByZXR1cm4gdGhpcy5idWJibGVHcm91cDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHJvb3Qgbm9kZSBvZiB0aGUgYnViYmxlJ3MgU1ZHIGdyb3VwLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcm9vdCBTVkcgbm9kZSBvZiB0aGUgYnViYmxlJ3MgZ3JvdXAuXG4gICAqL1xuICBnZXRTdmdSb290KCk6IFNWR0VsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmJ1YmJsZUdyb3VwIGFzIFNWR0VsZW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICogRXhwb3NlIHRoZSBibG9jaydzIElEIG9uIHRoZSBidWJibGUncyB0b3AtbGV2ZWwgU1ZHIGdyb3VwLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgYmxvY2suXG4gICAqL1xuICBzZXRTdmdJZChpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5idWJibGVHcm91cD8uc2V0QXR0cmlidXRlKCdkYXRhLWJsb2NrLWlkJywgaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJkb3duIG9uIGJ1YmJsZSdzIGJvcmRlci5cbiAgICpcbiAgICogQHBhcmFtIGUgUG9pbnRlciBkb3duIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBidWJibGVNb3VzZURvd24oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3QgZ2VzdHVyZSA9IHRoaXMud29ya3NwYWNlXy5nZXRHZXN0dXJlKGUpO1xuICAgIGlmIChnZXN0dXJlKSB7XG4gICAgICBnZXN0dXJlLmhhbmRsZUJ1YmJsZVN0YXJ0KGUsIHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBjb250ZXh0IG1lbnUgZm9yIHRoaXMgYnViYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gX2UgTW91c2UgZXZlbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2hvd0NvbnRleHRNZW51KF9lOiBFdmVudCkge31cbiAgLy8gTk9QIG9uIGJ1YmJsZXMsIGJ1dCB1c2VkIGJ5IHRoZSBidWJibGUgZHJhZ2dlciB0byBwYXNzIGV2ZW50cyB0b1xuICAvLyB3b3Jrc3BhY2UgY29tbWVudHMuXG5cbiAgLyoqXG4gICAqIEdldCB3aGV0aGVyIHRoaXMgYnViYmxlIGlzIGRlbGV0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgZGVsZXRhYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzRGVsZXRhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHN0eWxlIG9mIHRoaXMgYnViYmxlIHdoZW4gaXQgaXMgZHJhZ2dlZCBvdmVyIGEgZGVsZXRlIGFyZWEuXG4gICAqXG4gICAqIEBwYXJhbSBfZW5hYmxlIFRydWUgaWYgdGhlIGJ1YmJsZSBpcyBhYm91dCB0byBiZSBkZWxldGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBzZXREZWxldGVTdHlsZShfZW5hYmxlOiBib29sZWFuKSB7fVxuICAvLyBOT1AgaWYgYnViYmxlIGlzIG5vdCBkZWxldGFibGUuXG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJkb3duIG9uIGJ1YmJsZSdzIHJlc2l6ZSBjb3JuZXIuXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgcmVzaXplTW91c2VEb3duKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIHRoaXMucHJvbW90ZSgpO1xuICAgIEJ1YmJsZS51bmJpbmREcmFnRXZlbnRzKCk7XG4gICAgaWYgKGJyb3dzZXJFdmVudHMuaXNSaWdodEJ1dHRvbihlKSkge1xuICAgICAgLy8gTm8gcmlnaHQtY2xpY2suXG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBMZWZ0LWNsaWNrIChvciBtaWRkbGUgY2xpY2spXG4gICAgdGhpcy53b3Jrc3BhY2VfLnN0YXJ0RHJhZyhcbiAgICAgICAgZSxcbiAgICAgICAgbmV3IENvb3JkaW5hdGUoXG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZV8uUlRMID8gLXRoaXMud2lkdGggOiB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCkpO1xuXG4gICAgQnViYmxlLm9uTW91c2VVcFdyYXBwZXIgPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgZG9jdW1lbnQsICdwb2ludGVydXAnLCB0aGlzLCBCdWJibGUuYnViYmxlTW91c2VVcCk7XG4gICAgQnViYmxlLm9uTW91c2VNb3ZlV3JhcHBlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBkb2N1bWVudCwgJ3BvaW50ZXJtb3ZlJywgdGhpcywgdGhpcy5yZXNpemVNb3VzZU1vdmUpO1xuICAgIHRoaXMud29ya3NwYWNlXy5oaWRlQ2hhZmYoKTtcbiAgICAvLyBUaGlzIGV2ZW50IGhhcyBiZWVuIGhhbmRsZWQuICBObyBuZWVkIHRvIGJ1YmJsZSB1cCB0byB0aGUgZG9jdW1lbnQuXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemUgdGhpcyBidWJibGUgdG8gZm9sbG93IHRoZSBwb2ludGVyLlxuICAgKlxuICAgKiBAcGFyYW0gZSBQb2ludGVyIG1vdmUgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIHJlc2l6ZU1vdXNlTW92ZShlOiBQb2ludGVyRXZlbnQpIHtcbiAgICB0aGlzLmF1dG9MYXlvdXQgPSBmYWxzZTtcbiAgICBjb25zdCBuZXdYWSA9IHRoaXMud29ya3NwYWNlXy5tb3ZlRHJhZyhlKTtcbiAgICB0aGlzLnNldEJ1YmJsZVNpemUodGhpcy53b3Jrc3BhY2VfLlJUTCA/IC1uZXdYWS54IDogbmV3WFkueCwgbmV3WFkueSk7XG4gICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgIC8vIFJUTCByZXF1aXJlcyB0aGUgYnViYmxlIHRvIG1vdmUgaXRzIGxlZnQgZWRnZS5cbiAgICAgIHRoaXMucG9zaXRpb25CdWJibGUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBmdW5jdGlvbiBhcyBhIGNhbGxiYWNrIGV2ZW50IGZvciB3aGVuIHRoZSBidWJibGUgaXMgcmVzaXplZC5cbiAgICpcbiAgICogQHBhcmFtIGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIG9uIHJlc2l6ZS5cbiAgICovXG4gIHJlZ2lzdGVyUmVzaXplRXZlbnQoY2FsbGJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICB0aGlzLnJlc2l6ZUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBmdW5jdGlvbiBhcyBhIGNhbGxiYWNrIGV2ZW50IGZvciB3aGVuIHRoZSBidWJibGUgaXMgbW92ZWQuXG4gICAqXG4gICAqIEBwYXJhbSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCBvbiBtb3ZlLlxuICAgKi9cbiAgcmVnaXN0ZXJNb3ZlRXZlbnQoY2FsbGJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICB0aGlzLm1vdmVDYWxsYmFjayA9IGNhbGxiYWNrO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgdGhpcyBidWJibGUgdG8gdGhlIHRvcCBvZiB0aGUgc3RhY2suXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IHRoZSBidWJibGUgaGFzIGJlZW4gbW92ZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHJvbW90ZSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzdmdHcm91cCA9IHRoaXMuYnViYmxlR3JvdXA/LnBhcmVudE5vZGU7XG4gICAgaWYgKHN2Z0dyb3VwPy5sYXN0Q2hpbGQgIT09IHRoaXMuYnViYmxlR3JvdXAgJiYgdGhpcy5idWJibGVHcm91cCkge1xuICAgICAgc3ZnR3JvdXA/LmFwcGVuZENoaWxkKHRoaXMuYnViYmxlR3JvdXApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgYW5jaG9yIGhhcyBtb3ZlZC5cbiAgICogVXBkYXRlIHRoZSBhcnJvdyBhbmQgYnViYmxlIGFjY29yZGluZ2x5LlxuICAgKlxuICAgKiBAcGFyYW0geHkgQWJzb2x1dGUgbG9jYXRpb24uXG4gICAqL1xuICBzZXRBbmNob3JMb2NhdGlvbih4eTogQ29vcmRpbmF0ZSkge1xuICAgIHRoaXMuYW5jaG9yWFkgPSB4eTtcbiAgICBpZiAodGhpcy5yZW5kZXJlZCkge1xuICAgICAgdGhpcy5wb3NpdGlvbkJ1YmJsZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBQb3NpdGlvbiB0aGUgYnViYmxlIHNvIHRoYXQgaXQgZG9lcyBub3QgZmFsbCBvZmYtc2NyZWVuLiAqL1xuICBwcml2YXRlIGxheW91dEJ1YmJsZSgpIHtcbiAgICAvLyBHZXQgdGhlIG1ldHJpY3MgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgIGNvbnN0IHZpZXdNZXRyaWNzID1cbiAgICAgICAgdGhpcy53b3Jrc3BhY2VfLmdldE1ldHJpY3NNYW5hZ2VyKCkuZ2V0Vmlld01ldHJpY3ModHJ1ZSk7XG5cbiAgICBjb25zdCBvcHRpbWFsTGVmdCA9IHRoaXMuZ2V0T3B0aW1hbFJlbGF0aXZlTGVmdCh2aWV3TWV0cmljcyk7XG4gICAgY29uc3Qgb3B0aW1hbFRvcCA9IHRoaXMuZ2V0T3B0aW1hbFJlbGF0aXZlVG9wKHZpZXdNZXRyaWNzKTtcbiAgICBjb25zdCBiYm94ID0gKHRoaXMuc2hhcGVfIGFzIFNWR0dyYXBoaWNzRWxlbWVudCkuZ2V0QkJveCgpO1xuXG4gICAgY29uc3QgdG9wUG9zaXRpb24gPSB7XG4gICAgICB4OiBvcHRpbWFsTGVmdCxcbiAgICAgIHk6IC10aGlzLmhlaWdodCAtXG4gICAgICAgICAgICAgIHRoaXMud29ya3NwYWNlXy5nZXRSZW5kZXJlcigpLmdldENvbnN0YW50cygpLk1JTl9CTE9DS19IRUlHSFQgYXNcbiAgICAgICAgICBudW1iZXIsXG4gICAgfTtcbiAgICBjb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IC10aGlzLndpZHRoIC0gMzAsIHk6IG9wdGltYWxUb3B9O1xuICAgIGNvbnN0IGVuZFBvc2l0aW9uID0ge3g6IGJib3gud2lkdGgsIHk6IG9wdGltYWxUb3B9O1xuICAgIGNvbnN0IGJvdHRvbVBvc2l0aW9uID0ge3g6IG9wdGltYWxMZWZ0LCB5OiBiYm94LmhlaWdodH07XG5cbiAgICBjb25zdCBjbG9zZXJQb3NpdGlvbiA9XG4gICAgICAgIGJib3gud2lkdGggPCBiYm94LmhlaWdodCA/IGVuZFBvc2l0aW9uIDogYm90dG9tUG9zaXRpb247XG4gICAgY29uc3QgZmFydGhlclBvc2l0aW9uID1cbiAgICAgICAgYmJveC53aWR0aCA8IGJib3guaGVpZ2h0ID8gYm90dG9tUG9zaXRpb24gOiBlbmRQb3NpdGlvbjtcblxuICAgIGNvbnN0IHRvcFBvc2l0aW9uT3ZlcmxhcCA9IHRoaXMuZ2V0T3ZlcmxhcCh0b3BQb3NpdGlvbiwgdmlld01ldHJpY3MpO1xuICAgIGNvbnN0IHN0YXJ0UG9zaXRpb25PdmVybGFwID0gdGhpcy5nZXRPdmVybGFwKHN0YXJ0UG9zaXRpb24sIHZpZXdNZXRyaWNzKTtcbiAgICBjb25zdCBjbG9zZXJQb3NpdGlvbk92ZXJsYXAgPSB0aGlzLmdldE92ZXJsYXAoY2xvc2VyUG9zaXRpb24sIHZpZXdNZXRyaWNzKTtcbiAgICBjb25zdCBmYXJ0aGVyUG9zaXRpb25PdmVybGFwID1cbiAgICAgICAgdGhpcy5nZXRPdmVybGFwKGZhcnRoZXJQb3NpdGlvbiwgdmlld01ldHJpY3MpO1xuXG4gICAgLy8gU2V0IHRoZSBwb3NpdGlvbiB0byB3aGljaGV2ZXIgcG9zaXRpb24gc2hvd3MgdGhlIG1vc3Qgb2YgdGhlIGJ1YmJsZSxcbiAgICAvLyB3aXRoIHRpZWJyZWFrcyBnb2luZyBpbiB0aGUgb3JkZXI6IHRvcCA+IHN0YXJ0ID4gY2xvc2UgPiBmYXIuXG4gICAgY29uc3QgbW9zdE92ZXJsYXAgPSBNYXRoLm1heChcbiAgICAgICAgdG9wUG9zaXRpb25PdmVybGFwLCBzdGFydFBvc2l0aW9uT3ZlcmxhcCwgY2xvc2VyUG9zaXRpb25PdmVybGFwLFxuICAgICAgICBmYXJ0aGVyUG9zaXRpb25PdmVybGFwKTtcbiAgICBpZiAodG9wUG9zaXRpb25PdmVybGFwID09PSBtb3N0T3ZlcmxhcCkge1xuICAgICAgdGhpcy5yZWxhdGl2ZUxlZnQgPSB0b3BQb3NpdGlvbi54O1xuICAgICAgdGhpcy5yZWxhdGl2ZVRvcCA9IHRvcFBvc2l0aW9uLnk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzdGFydFBvc2l0aW9uT3ZlcmxhcCA9PT0gbW9zdE92ZXJsYXApIHtcbiAgICAgIHRoaXMucmVsYXRpdmVMZWZ0ID0gc3RhcnRQb3NpdGlvbi54O1xuICAgICAgdGhpcy5yZWxhdGl2ZVRvcCA9IHN0YXJ0UG9zaXRpb24ueTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNsb3NlclBvc2l0aW9uT3ZlcmxhcCA9PT0gbW9zdE92ZXJsYXApIHtcbiAgICAgIHRoaXMucmVsYXRpdmVMZWZ0ID0gY2xvc2VyUG9zaXRpb24ueDtcbiAgICAgIHRoaXMucmVsYXRpdmVUb3AgPSBjbG9zZXJQb3NpdGlvbi55O1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBUT0RPOiBJIGJlbGlldmUgcmVsYXRpdmVMZWZ0XyBzaG91bGQgYWN0dWFsbHkgYmUgY2FsbGVkIHJlbGF0aXZlU3RhcnRfXG4gICAgLy8gIGFuZCB0aGVuIHRoZSBtYXRoIHNob3VsZCBiZSBmaXhlZCB0byByZWZsZWN0IHRoaXMuIChob3BlZnVsbHkgaXQnbGxcbiAgICAvLyAgbWFrZSBpdCBsb29rIHNpbXBsZXIpXG4gICAgdGhpcy5yZWxhdGl2ZUxlZnQgPSBmYXJ0aGVyUG9zaXRpb24ueDtcbiAgICB0aGlzLnJlbGF0aXZlVG9wID0gZmFydGhlclBvc2l0aW9uLnk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSB3aGF0IHBlcmNlbnRhZ2Ugb2YgdGhlIGJ1YmJsZSBvdmVybGFwcyB3aXRoIHRoZSB2aXNpYmxlXG4gICAqIHdvcmtzcGFjZSAod2hhdCBwZXJjZW50YWdlIG9mIHRoZSBidWJibGUgaXMgdmlzaWJsZSkuXG4gICAqXG4gICAqIEBwYXJhbSByZWxhdGl2ZU1pbiBUaGUgcG9zaXRpb24gb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGUgYnViYmxlXG4gICAqICAgICByZWxhdGl2ZSB0byB0aGUgYW5jaG9yIHBvaW50LlxuICAgKiBAcGFyYW0gdmlld01ldHJpY3MgVGhlIHZpZXcgbWV0cmljcyBvZiB0aGUgd29ya3NwYWNlIHRoZSBidWJibGUgd2lsbCBhcHBlYXJcbiAgICogICAgIGluLlxuICAgKiBAcmV0dXJucyBUaGUgcGVyY2VudGFnZSBvZiB0aGUgYnViYmxlIHRoYXQgaXMgdmlzaWJsZS5cbiAgICovXG4gIHByaXZhdGUgZ2V0T3ZlcmxhcChcbiAgICAgIHJlbGF0aXZlTWluOiB7eDogbnVtYmVyLCB5OiBudW1iZXJ9LFxuICAgICAgdmlld01ldHJpY3M6IENvbnRhaW5lclJlZ2lvbik6IG51bWJlciB7XG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIGJ1YmJsZSBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAgY29uc3QgYnViYmxlTWluID0ge1xuICAgICAgeDogdGhpcy53b3Jrc3BhY2VfLlJUTCA/IHRoaXMuYW5jaG9yWFkueCAtIHJlbGF0aXZlTWluLnggLSB0aGlzLndpZHRoIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZU1pbi54ICsgdGhpcy5hbmNob3JYWS54LFxuICAgICAgeTogcmVsYXRpdmVNaW4ueSArIHRoaXMuYW5jaG9yWFkueSxcbiAgICB9O1xuICAgIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgYm90dG9tLXJpZ2h0IGNvcm5lciBvZiB0aGUgYnViYmxlIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICBjb25zdCBidWJibGVNYXggPSB7XG4gICAgICB4OiBidWJibGVNaW4ueCArIHRoaXMud2lkdGgsXG4gICAgICB5OiBidWJibGVNaW4ueSArIHRoaXMuaGVpZ2h0LFxuICAgIH07XG5cbiAgICAvLyBXZSBjb3VsZCBhZGp1c3QgdGhlc2UgdmFsdWVzIHRvIGFjY291bnQgZm9yIHRoZSBzY3JvbGxiYXJzLCBidXQgdGhlXG4gICAgLy8gYnViYmxlcyBzaG91bGQgaGF2ZSBiZWVuIGFkanVzdGVkIHRvIG5vdCBjb2xsaWRlIHdpdGggdGhlbSBhbnl3YXksIHNvXG4gICAgLy8gZ2l2aW5nIHRoZSB3b3Jrc3BhY2UgYSBzbGlnaHRseSBsYXJnZXIgXCJib3VuZGluZyBib3hcIiBzaG91bGRuJ3QgYWZmZWN0XG4gICAgLy8gdGhlIGNhbGN1bGF0aW9uLlxuXG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIHdvcmtzcGFjZS5cbiAgICBjb25zdCB3b3Jrc3BhY2VNaW4gPSB7eDogdmlld01ldHJpY3MubGVmdCwgeTogdmlld01ldHJpY3MudG9wfTtcbiAgICAvLyBUaGUgcG9zaXRpb24gb2YgdGhlIGJvdHRvbS1yaWdodCBjb3JuZXIgb2YgdGhlIHdvcmtzcGFjZS5cbiAgICBjb25zdCB3b3Jrc3BhY2VNYXggPSB7XG4gICAgICB4OiB2aWV3TWV0cmljcy5sZWZ0ICsgdmlld01ldHJpY3Mud2lkdGgsXG4gICAgICB5OiB2aWV3TWV0cmljcy50b3AgKyB2aWV3TWV0cmljcy5oZWlnaHQsXG4gICAgfTtcblxuICAgIGNvbnN0IG92ZXJsYXBXaWR0aCA9IE1hdGgubWluKGJ1YmJsZU1heC54LCB3b3Jrc3BhY2VNYXgueCkgLVxuICAgICAgICBNYXRoLm1heChidWJibGVNaW4ueCwgd29ya3NwYWNlTWluLngpO1xuICAgIGNvbnN0IG92ZXJsYXBIZWlnaHQgPSBNYXRoLm1pbihidWJibGVNYXgueSwgd29ya3NwYWNlTWF4LnkpIC1cbiAgICAgICAgTWF0aC5tYXgoYnViYmxlTWluLnksIHdvcmtzcGFjZU1pbi55KTtcbiAgICByZXR1cm4gTWF0aC5tYXgoXG4gICAgICAgIDAsXG4gICAgICAgIE1hdGgubWluKDEsIG92ZXJsYXBXaWR0aCAqIG92ZXJsYXBIZWlnaHQgLyAodGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0KSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB3aGF0IHRoZSBvcHRpbWFsIGhvcml6b250YWwgcG9zaXRpb24gb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZlxuICAgKiB0aGUgYnViYmxlIGlzIChyZWxhdGl2ZSB0byB0aGUgYW5jaG9yIHBvaW50KSBzbyB0aGF0IHRoZSBtb3N0IGFyZWEgb2YgdGhlXG4gICAqIGJ1YmJsZSBpcyBzaG93bi5cbiAgICpcbiAgICogQHBhcmFtIHZpZXdNZXRyaWNzIFRoZSB2aWV3IG1ldHJpY3Mgb2YgdGhlIHdvcmtzcGFjZSB0aGUgYnViYmxlIHdpbGwgYXBwZWFyXG4gICAqICAgICBpbi5cbiAgICogQHJldHVybnMgVGhlIG9wdGltYWwgaG9yaXpvbnRhbCBwb3NpdGlvbiBvZiB0aGUgdG9wLWxlZnQgY29ybmVyIG9mIHRoZVxuICAgKiAgICAgYnViYmxlLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRPcHRpbWFsUmVsYXRpdmVMZWZ0KHZpZXdNZXRyaWNzOiBDb250YWluZXJSZWdpb24pOiBudW1iZXIge1xuICAgIGxldCByZWxhdGl2ZUxlZnQgPSAtdGhpcy53aWR0aCAvIDQ7XG5cbiAgICAvLyBObyBhbW91bnQgb2Ygc2xpZGluZyBsZWZ0IG9yIHJpZ2h0IHdpbGwgZ2l2ZSB1cyBhIGJldHRlciBvdmVybGFwLlxuICAgIGlmICh0aGlzLndpZHRoID4gdmlld01ldHJpY3Mud2lkdGgpIHtcbiAgICAgIHJldHVybiByZWxhdGl2ZUxlZnQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgIC8vIEJ1YmJsZSBjb29yZGluYXRlcyBhcmUgZmxpcHBlZCBpbiBSVEwuXG4gICAgICBjb25zdCBidWJibGVSaWdodCA9IHRoaXMuYW5jaG9yWFkueCAtIHJlbGF0aXZlTGVmdDtcbiAgICAgIGNvbnN0IGJ1YmJsZUxlZnQgPSBidWJibGVSaWdodCAtIHRoaXMud2lkdGg7XG5cbiAgICAgIGNvbnN0IHdvcmtzcGFjZVJpZ2h0ID0gdmlld01ldHJpY3MubGVmdCArIHZpZXdNZXRyaWNzLndpZHRoO1xuICAgICAgY29uc3Qgd29ya3NwYWNlTGVmdCA9IHZpZXdNZXRyaWNzLmxlZnQgK1xuICAgICAgICAgIC8vIFRoaWNrbmVzcyBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAgICAgICAgU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcyAvIHRoaXMud29ya3NwYWNlXy5zY2FsZTtcblxuICAgICAgaWYgKGJ1YmJsZUxlZnQgPCB3b3Jrc3BhY2VMZWZ0KSB7XG4gICAgICAgIC8vIFNsaWRlIHRoZSBidWJibGUgcmlnaHQgdW50aWwgaXQgaXMgb25zY3JlZW4uXG4gICAgICAgIHJlbGF0aXZlTGVmdCA9IC0od29ya3NwYWNlTGVmdCAtIHRoaXMuYW5jaG9yWFkueCArIHRoaXMud2lkdGgpO1xuICAgICAgfSBlbHNlIGlmIChidWJibGVSaWdodCA+IHdvcmtzcGFjZVJpZ2h0KSB7XG4gICAgICAgIC8vIFNsaWRlIHRoZSBidWJibGUgbGVmdCB1bnRpbCBpdCBpcyBvbnNjcmVlbi5cbiAgICAgICAgcmVsYXRpdmVMZWZ0ID0gLSh3b3Jrc3BhY2VSaWdodCAtIHRoaXMuYW5jaG9yWFkueCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGJ1YmJsZUxlZnQgPSByZWxhdGl2ZUxlZnQgKyB0aGlzLmFuY2hvclhZLng7XG4gICAgICBjb25zdCBidWJibGVSaWdodCA9IGJ1YmJsZUxlZnQgKyB0aGlzLndpZHRoO1xuXG4gICAgICBjb25zdCB3b3Jrc3BhY2VMZWZ0ID0gdmlld01ldHJpY3MubGVmdDtcbiAgICAgIGNvbnN0IHdvcmtzcGFjZVJpZ2h0ID0gdmlld01ldHJpY3MubGVmdCArIHZpZXdNZXRyaWNzLndpZHRoIC1cbiAgICAgICAgICAvLyBUaGlja25lc3MgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgICAgICAgIFNjcm9sbGJhci5zY3JvbGxiYXJUaGlja25lc3MgLyB0aGlzLndvcmtzcGFjZV8uc2NhbGU7XG5cbiAgICAgIGlmIChidWJibGVMZWZ0IDwgd29ya3NwYWNlTGVmdCkge1xuICAgICAgICAvLyBTbGlkZSB0aGUgYnViYmxlIHJpZ2h0IHVudGlsIGl0IGlzIG9uc2NyZWVuLlxuICAgICAgICByZWxhdGl2ZUxlZnQgPSB3b3Jrc3BhY2VMZWZ0IC0gdGhpcy5hbmNob3JYWS54O1xuICAgICAgfSBlbHNlIGlmIChidWJibGVSaWdodCA+IHdvcmtzcGFjZVJpZ2h0KSB7XG4gICAgICAgIC8vIFNsaWRlIHRoZSBidWJibGUgbGVmdCB1bnRpbCBpdCBpcyBvbnNjcmVlbi5cbiAgICAgICAgcmVsYXRpdmVMZWZ0ID0gd29ya3NwYWNlUmlnaHQgLSB0aGlzLmFuY2hvclhZLnggLSB0aGlzLndpZHRoO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZWxhdGl2ZUxlZnQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHdoYXQgdGhlIG9wdGltYWwgdmVydGljYWwgcG9zaXRpb24gb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZlxuICAgKiB0aGUgYnViYmxlIGlzIChyZWxhdGl2ZSB0byB0aGUgYW5jaG9yIHBvaW50KSBzbyB0aGF0IHRoZSBtb3N0IGFyZWEgb2YgdGhlXG4gICAqIGJ1YmJsZSBpcyBzaG93bi5cbiAgICpcbiAgICogQHBhcmFtIHZpZXdNZXRyaWNzIFRoZSB2aWV3IG1ldHJpY3Mgb2YgdGhlIHdvcmtzcGFjZSB0aGUgYnViYmxlIHdpbGwgYXBwZWFyXG4gICAqICAgICBpbi5cbiAgICogQHJldHVybnMgVGhlIG9wdGltYWwgdmVydGljYWwgcG9zaXRpb24gb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGVcbiAgICogICAgIGJ1YmJsZS5cbiAgICovXG4gIHByaXZhdGUgZ2V0T3B0aW1hbFJlbGF0aXZlVG9wKHZpZXdNZXRyaWNzOiBDb250YWluZXJSZWdpb24pOiBudW1iZXIge1xuICAgIGxldCByZWxhdGl2ZVRvcCA9IC10aGlzLmhlaWdodCAvIDQ7XG5cbiAgICAvLyBObyBhbW91bnQgb2Ygc2xpZGluZyB1cCBvciBkb3duIHdpbGwgZ2l2ZSB1cyBhIGJldHRlciBvdmVybGFwLlxuICAgIGlmICh0aGlzLmhlaWdodCA+IHZpZXdNZXRyaWNzLmhlaWdodCkge1xuICAgICAgcmV0dXJuIHJlbGF0aXZlVG9wO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1YmJsZVRvcCA9IHRoaXMuYW5jaG9yWFkueSArIHJlbGF0aXZlVG9wO1xuICAgIGNvbnN0IGJ1YmJsZUJvdHRvbSA9IGJ1YmJsZVRvcCArIHRoaXMuaGVpZ2h0O1xuICAgIGNvbnN0IHdvcmtzcGFjZVRvcCA9IHZpZXdNZXRyaWNzLnRvcDtcbiAgICBjb25zdCB3b3Jrc3BhY2VCb3R0b20gPSB2aWV3TWV0cmljcy50b3AgK1xuICAgICAgICB2aWV3TWV0cmljcy5oZWlnaHQgLSAgLy8gVGhpY2tuZXNzIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICAgICAgU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcyAvIHRoaXMud29ya3NwYWNlXy5zY2FsZTtcblxuICAgIGNvbnN0IGFuY2hvclkgPSB0aGlzLmFuY2hvclhZLnk7XG4gICAgaWYgKGJ1YmJsZVRvcCA8IHdvcmtzcGFjZVRvcCkge1xuICAgICAgLy8gU2xpZGUgdGhlIGJ1YmJsZSBkb3duIHVudGlsIGl0IGlzIG9uc2NyZWVuLlxuICAgICAgcmVsYXRpdmVUb3AgPSB3b3Jrc3BhY2VUb3AgLSBhbmNob3JZO1xuICAgIH0gZWxzZSBpZiAoYnViYmxlQm90dG9tID4gd29ya3NwYWNlQm90dG9tKSB7XG4gICAgICAvLyBTbGlkZSB0aGUgYnViYmxlIHVwIHVudGlsIGl0IGlzIG9uc2NyZWVuLlxuICAgICAgcmVsYXRpdmVUb3AgPSB3b3Jrc3BhY2VCb3R0b20gLSBhbmNob3JZIC0gdGhpcy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlbGF0aXZlVG9wO1xuICB9XG5cbiAgLyoqIE1vdmUgdGhlIGJ1YmJsZSB0byBhIGxvY2F0aW9uIHJlbGF0aXZlIHRvIHRoZSBhbmNob3IncyBjZW50cmUuICovXG4gIHByaXZhdGUgcG9zaXRpb25CdWJibGUoKSB7XG4gICAgbGV0IGxlZnQgPSB0aGlzLmFuY2hvclhZLng7XG4gICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgIGxlZnQgLT0gdGhpcy5yZWxhdGl2ZUxlZnQgKyB0aGlzLndpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZWZ0ICs9IHRoaXMucmVsYXRpdmVMZWZ0O1xuICAgIH1cbiAgICBjb25zdCB0b3AgPSB0aGlzLnJlbGF0aXZlVG9wICsgdGhpcy5hbmNob3JYWS55O1xuICAgIHRoaXMubW92ZVRvKGxlZnQsIHRvcCk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgYnViYmxlIGdyb3VwIHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24gaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgKlxuICAgKiBAcGFyYW0geCBUaGUgeCBwb3NpdGlvbiB0byBtb3ZlIHRvLlxuICAgKiBAcGFyYW0geSBUaGUgeSBwb3NpdGlvbiB0byBtb3ZlIHRvLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1vdmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMuYnViYmxlR3JvdXA/LnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHggKyAnLCcgKyB5ICsgJyknKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmlnZ2VycyBhIG1vdmUgY2FsbGJhY2sgaWYgb25lIGV4aXN0cyBhdCB0aGUgZW5kIG9mIGEgZHJhZy5cbiAgICpcbiAgICogQHBhcmFtIGFkZGluZyBUcnVlIGlmIGFkZGluZywgZmFsc2UgaWYgcmVtb3ZpbmcuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0RHJhZ2dpbmcoYWRkaW5nOiBib29sZWFuKSB7XG4gICAgaWYgKCFhZGRpbmcgJiYgdGhpcy5tb3ZlQ2FsbGJhY2spIHtcbiAgICAgIHRoaXMubW92ZUNhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgZGltZW5zaW9ucyBvZiB0aGlzIGJ1YmJsZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGhlaWdodCBhbmQgd2lkdGggb2YgdGhlIGJ1YmJsZS5cbiAgICovXG4gIGdldEJ1YmJsZVNpemUoKTogU2l6ZSB7XG4gICAgcmV0dXJuIG5ldyBTaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaXplIHRoaXMgYnViYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gd2lkdGggV2lkdGggb2YgdGhlIGJ1YmJsZS5cbiAgICogQHBhcmFtIGhlaWdodCBIZWlnaHQgb2YgdGhlIGJ1YmJsZS5cbiAgICovXG4gIHNldEJ1YmJsZVNpemUod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICBjb25zdCBkb3VibGVCb3JkZXJXaWR0aCA9IDIgKiBCdWJibGUuQk9SREVSX1dJRFRIO1xuICAgIC8vIE1pbmltdW0gc2l6ZSBvZiBhIGJ1YmJsZS5cbiAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBkb3VibGVCb3JkZXJXaWR0aCArIDQ1KTtcbiAgICBoZWlnaHQgPSBNYXRoLm1heChoZWlnaHQsIGRvdWJsZUJvcmRlcldpZHRoICsgMjApO1xuICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICB0aGlzLmJ1YmJsZUJhY2s/LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aC50b1N0cmluZygpKTtcbiAgICB0aGlzLmJ1YmJsZUJhY2s/LnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0LnRvU3RyaW5nKCkpO1xuICAgIGlmICh0aGlzLnJlc2l6ZUdyb3VwKSB7XG4gICAgICBpZiAodGhpcy53b3Jrc3BhY2VfLlJUTCkge1xuICAgICAgICAvLyBNaXJyb3IgdGhlIHJlc2l6ZSBncm91cC5cbiAgICAgICAgY29uc3QgcmVzaXplU2l6ZSA9IDIgKiBCdWJibGUuQk9SREVSX1dJRFRIO1xuICAgICAgICB0aGlzLnJlc2l6ZUdyb3VwLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAgICAgJ3RyYW5zbGF0ZSgnICsgcmVzaXplU2l6ZSArICcsJyArIChoZWlnaHQgLSBkb3VibGVCb3JkZXJXaWR0aCkgK1xuICAgICAgICAgICAgICAgICcpIHNjYWxlKC0xIDEpJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlc2l6ZUdyb3VwLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAgICAgJ3RyYW5zbGF0ZSgnICsgKHdpZHRoIC0gZG91YmxlQm9yZGVyV2lkdGgpICsgJywnICtcbiAgICAgICAgICAgICAgICAoaGVpZ2h0IC0gZG91YmxlQm9yZGVyV2lkdGgpICsgJyknKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuYXV0b0xheW91dCkge1xuICAgICAgdGhpcy5sYXlvdXRCdWJibGUoKTtcbiAgICB9XG4gICAgdGhpcy5wb3NpdGlvbkJ1YmJsZSgpO1xuICAgIHRoaXMucmVuZGVyQXJyb3coKTtcblxuICAgIC8vIEFsbG93IHRoZSBjb250ZW50cyB0byByZXNpemUuXG4gICAgaWYgKHRoaXMucmVzaXplQ2FsbGJhY2spIHtcbiAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICAvKiogRHJhdyB0aGUgYXJyb3cgYmV0d2VlbiB0aGUgYnViYmxlIGFuZCB0aGUgb3JpZ2luLiAqL1xuICBwcml2YXRlIHJlbmRlckFycm93KCkge1xuICAgIGNvbnN0IHN0ZXBzID0gW107XG4gICAgLy8gRmluZCB0aGUgcmVsYXRpdmUgY29vcmRpbmF0ZXMgb2YgdGhlIGNlbnRlciBvZiB0aGUgYnViYmxlLlxuICAgIGNvbnN0IHJlbEJ1YmJsZVggPSB0aGlzLndpZHRoIC8gMjtcbiAgICBjb25zdCByZWxCdWJibGVZID0gdGhpcy5oZWlnaHQgLyAyO1xuICAgIC8vIEZpbmQgdGhlIHJlbGF0aXZlIGNvb3JkaW5hdGVzIG9mIHRoZSBjZW50ZXIgb2YgdGhlIGFuY2hvci5cbiAgICBsZXQgcmVsQW5jaG9yWCA9IC10aGlzLnJlbGF0aXZlTGVmdDtcbiAgICBsZXQgcmVsQW5jaG9yWSA9IC10aGlzLnJlbGF0aXZlVG9wO1xuICAgIGlmIChyZWxCdWJibGVYID09PSByZWxBbmNob3JYICYmIHJlbEJ1YmJsZVkgPT09IHJlbEFuY2hvclkpIHtcbiAgICAgIC8vIE51bGwgY2FzZS4gIEJ1YmJsZSBpcyBkaXJlY3RseSBvbiB0b3Agb2YgdGhlIGFuY2hvci5cbiAgICAgIC8vIFNob3J0IGNpcmN1aXQgdGhpcyByYXRoZXIgdGhhbiB3YWRlIHRocm91Z2ggZGl2aWRlIGJ5IHplcm9zLlxuICAgICAgc3RlcHMucHVzaCgnTSAnICsgcmVsQnViYmxlWCArICcsJyArIHJlbEJ1YmJsZVkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDb21wdXRlIHRoZSBhbmdsZSBvZiB0aGUgYXJyb3cncyBsaW5lLlxuICAgICAgY29uc3QgcmlzZSA9IHJlbEFuY2hvclkgLSByZWxCdWJibGVZO1xuICAgICAgbGV0IHJ1biA9IHJlbEFuY2hvclggLSByZWxCdWJibGVYO1xuICAgICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgICAgcnVuICo9IC0xO1xuICAgICAgfVxuICAgICAgY29uc3QgaHlwb3RlbnVzZSA9IE1hdGguc3FydChyaXNlICogcmlzZSArIHJ1biAqIHJ1bik7XG4gICAgICBsZXQgYW5nbGUgPSBNYXRoLmFjb3MocnVuIC8gaHlwb3RlbnVzZSk7XG4gICAgICBpZiAocmlzZSA8IDApIHtcbiAgICAgICAgYW5nbGUgPSAyICogTWF0aC5QSSAtIGFuZ2xlO1xuICAgICAgfVxuICAgICAgLy8gQ29tcHV0ZSBhIGxpbmUgcGVycGVuZGljdWxhciB0byB0aGUgYXJyb3cuXG4gICAgICBsZXQgcmlnaHRBbmdsZSA9IGFuZ2xlICsgTWF0aC5QSSAvIDI7XG4gICAgICBpZiAocmlnaHRBbmdsZSA+IE1hdGguUEkgKiAyKSB7XG4gICAgICAgIHJpZ2h0QW5nbGUgLT0gTWF0aC5QSSAqIDI7XG4gICAgICB9XG4gICAgICBjb25zdCByaWdodFJpc2UgPSBNYXRoLnNpbihyaWdodEFuZ2xlKTtcbiAgICAgIGNvbnN0IHJpZ2h0UnVuID0gTWF0aC5jb3MocmlnaHRBbmdsZSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgdGhpY2tuZXNzIG9mIHRoZSBiYXNlIG9mIHRoZSBhcnJvdy5cbiAgICAgIGNvbnN0IGJ1YmJsZVNpemUgPSB0aGlzLmdldEJ1YmJsZVNpemUoKTtcbiAgICAgIGxldCB0aGlja25lc3MgPVxuICAgICAgICAgIChidWJibGVTaXplLndpZHRoICsgYnViYmxlU2l6ZS5oZWlnaHQpIC8gQnViYmxlLkFSUk9XX1RISUNLTkVTUztcbiAgICAgIHRoaWNrbmVzcyA9IE1hdGgubWluKHRoaWNrbmVzcywgYnViYmxlU2l6ZS53aWR0aCwgYnViYmxlU2l6ZS5oZWlnaHQpIC8gNDtcblxuICAgICAgLy8gQmFjayB0aGUgdGlwIG9mIHRoZSBhcnJvdyBvZmYgb2YgdGhlIGFuY2hvci5cbiAgICAgIGNvbnN0IGJhY2tvZmZSYXRpbyA9IDEgLSBCdWJibGUuQU5DSE9SX1JBRElVUyAvIGh5cG90ZW51c2U7XG4gICAgICByZWxBbmNob3JYID0gcmVsQnViYmxlWCArIGJhY2tvZmZSYXRpbyAqIHJ1bjtcbiAgICAgIHJlbEFuY2hvclkgPSByZWxCdWJibGVZICsgYmFja29mZlJhdGlvICogcmlzZTtcblxuICAgICAgLy8gQ29vcmRpbmF0ZXMgZm9yIHRoZSBiYXNlIG9mIHRoZSBhcnJvdy5cbiAgICAgIGNvbnN0IGJhc2VYMSA9IHJlbEJ1YmJsZVggKyB0aGlja25lc3MgKiByaWdodFJ1bjtcbiAgICAgIGNvbnN0IGJhc2VZMSA9IHJlbEJ1YmJsZVkgKyB0aGlja25lc3MgKiByaWdodFJpc2U7XG4gICAgICBjb25zdCBiYXNlWDIgPSByZWxCdWJibGVYIC0gdGhpY2tuZXNzICogcmlnaHRSdW47XG4gICAgICBjb25zdCBiYXNlWTIgPSByZWxCdWJibGVZIC0gdGhpY2tuZXNzICogcmlnaHRSaXNlO1xuXG4gICAgICAvLyBEaXN0b3J0aW9uIHRvIGN1cnZlIHRoZSBhcnJvdy5cbiAgICAgIGxldCBzd2lybEFuZ2xlID0gYW5nbGUgKyB0aGlzLmFycm93UmFkaWFucztcbiAgICAgIGlmIChzd2lybEFuZ2xlID4gTWF0aC5QSSAqIDIpIHtcbiAgICAgICAgc3dpcmxBbmdsZSAtPSBNYXRoLlBJICogMjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN3aXJsUmlzZSA9IE1hdGguc2luKHN3aXJsQW5nbGUpICogaHlwb3RlbnVzZSAvIEJ1YmJsZS5BUlJPV19CRU5EO1xuICAgICAgY29uc3Qgc3dpcmxSdW4gPSBNYXRoLmNvcyhzd2lybEFuZ2xlKSAqIGh5cG90ZW51c2UgLyBCdWJibGUuQVJST1dfQkVORDtcblxuICAgICAgc3RlcHMucHVzaCgnTScgKyBiYXNlWDEgKyAnLCcgKyBiYXNlWTEpO1xuICAgICAgc3RlcHMucHVzaChcbiAgICAgICAgICAnQycgKyAoYmFzZVgxICsgc3dpcmxSdW4pICsgJywnICsgKGJhc2VZMSArIHN3aXJsUmlzZSkgKyAnICcgK1xuICAgICAgICAgIHJlbEFuY2hvclggKyAnLCcgKyByZWxBbmNob3JZICsgJyAnICsgcmVsQW5jaG9yWCArICcsJyArIHJlbEFuY2hvclkpO1xuICAgICAgc3RlcHMucHVzaChcbiAgICAgICAgICAnQycgKyByZWxBbmNob3JYICsgJywnICsgcmVsQW5jaG9yWSArICcgJyArIChiYXNlWDIgKyBzd2lybFJ1bikgK1xuICAgICAgICAgICcsJyArIChiYXNlWTIgKyBzd2lybFJpc2UpICsgJyAnICsgYmFzZVgyICsgJywnICsgYmFzZVkyKTtcbiAgICB9XG4gICAgc3RlcHMucHVzaCgneicpO1xuICAgIHRoaXMuYnViYmxlQXJyb3c/LnNldEF0dHJpYnV0ZSgnZCcsIHN0ZXBzLmpvaW4oJyAnKSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hhbmdlIHRoZSBjb2xvdXIgb2YgYSBidWJibGUuXG4gICAqXG4gICAqIEBwYXJhbSBoZXhDb2xvdXIgSGV4IGNvZGUgb2YgY29sb3VyLlxuICAgKi9cbiAgc2V0Q29sb3VyKGhleENvbG91cjogc3RyaW5nKSB7XG4gICAgdGhpcy5idWJibGVCYWNrPy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCBoZXhDb2xvdXIpO1xuICAgIHRoaXMuYnViYmxlQXJyb3c/LnNldEF0dHJpYnV0ZSgnZmlsbCcsIGhleENvbG91cik7XG4gIH1cblxuICAvKiogRGlzcG9zZSBvZiB0aGlzIGJ1YmJsZS4gKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5vbk1vdXNlRG93bkJ1YmJsZVdyYXBwZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25Nb3VzZURvd25CdWJibGVXcmFwcGVyKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub25Nb3VzZURvd25SZXNpemVXcmFwcGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uTW91c2VEb3duUmVzaXplV3JhcHBlcik7XG4gICAgfVxuICAgIEJ1YmJsZS51bmJpbmREcmFnRXZlbnRzKCk7XG4gICAgZG9tLnJlbW92ZU5vZGUodGhpcy5idWJibGVHcm91cCk7XG4gICAgdGhpcy5kaXNwb3NlZCA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGlzIGJ1YmJsZSBkdXJpbmcgYSBkcmFnLCB0YWtpbmcgaW50byBhY2NvdW50IHdoZXRoZXIgb3Igbm90IHRoZXJlIGlzXG4gICAqIGEgZHJhZyBzdXJmYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gZHJhZ1N1cmZhY2UgVGhlIHN1cmZhY2UgdGhhdCBjYXJyaWVzIHJlbmRlcmVkIGl0ZW1zIGR1cmluZyBhIGRyYWcsXG4gICAqICAgICBvciBudWxsIGlmIG5vIGRyYWcgc3VyZmFjZSBpcyBpbiB1c2UuXG4gICAqIEBwYXJhbSBuZXdMb2MgVGhlIGxvY2F0aW9uIHRvIHRyYW5zbGF0ZSB0bywgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1vdmVEdXJpbmdEcmFnKGRyYWdTdXJmYWNlOiBCbG9ja0RyYWdTdXJmYWNlU3ZnLCBuZXdMb2M6IENvb3JkaW5hdGUpIHtcbiAgICBpZiAoZHJhZ1N1cmZhY2UpIHtcbiAgICAgIGRyYWdTdXJmYWNlLnRyYW5zbGF0ZVN1cmZhY2UobmV3TG9jLngsIG5ld0xvYy55KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tb3ZlVG8obmV3TG9jLngsIG5ld0xvYy55KTtcbiAgICB9XG4gICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgIHRoaXMucmVsYXRpdmVMZWZ0ID0gdGhpcy5hbmNob3JYWS54IC0gbmV3TG9jLnggLSB0aGlzLndpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbGF0aXZlTGVmdCA9IG5ld0xvYy54IC0gdGhpcy5hbmNob3JYWS54O1xuICAgIH1cbiAgICB0aGlzLnJlbGF0aXZlVG9wID0gbmV3TG9jLnkgLSB0aGlzLmFuY2hvclhZLnk7XG4gICAgdGhpcy5yZW5kZXJBcnJvdygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGlzIGJ1YmJsZSdzIGJvZHlcbiAgICogcmVsYXRpdmUgdG8gdGhlIGRyYXdpbmcgc3VyZmFjZSdzIG9yaWdpbiAoMCwwKSwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKlxuICAgKiBAcmV0dXJucyBPYmplY3Qgd2l0aCAueCBhbmQgLnkgcHJvcGVydGllcy5cbiAgICovXG4gIGdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIG5ldyBDb29yZGluYXRlKFxuICAgICAgICB0aGlzLndvcmtzcGFjZV8uUlRMID9cbiAgICAgICAgICAgIC10aGlzLnJlbGF0aXZlTGVmdCArIHRoaXMuYW5jaG9yWFkueCAtIHRoaXMud2lkdGggOlxuICAgICAgICAgICAgdGhpcy5hbmNob3JYWS54ICsgdGhpcy5yZWxhdGl2ZUxlZnQsXG4gICAgICAgIHRoaXMuYW5jaG9yWFkueSArIHRoaXMucmVsYXRpdmVUb3ApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIGF1dG8tbGF5b3V0IG9mIHRoaXMgYnViYmxlIGlzIGVuYWJsZWQuICBUaGUgZmlyc3QgdGltZSBhIGJ1YmJsZVxuICAgKiBpcyBzaG93biBpdCBwb3NpdGlvbnMgaXRzZWxmIHRvIG5vdCBjb3ZlciBhbnkgYmxvY2tzLiAgT25jZSBhIHVzZXIgaGFzXG4gICAqIGRyYWdnZWQgaXQgdG8gcmVwb3NpdGlvbiwgaXQgcmVuZGVycyB3aGVyZSB0aGUgdXNlciBwdXQgaXQuXG4gICAqXG4gICAqIEBwYXJhbSBlbmFibGUgVHJ1ZSBpZiBhdXRvLWxheW91dCBzaG91bGQgYmUgZW5hYmxlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldEF1dG9MYXlvdXQoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5hdXRvTGF5b3V0ID0gZW5hYmxlO1xuICB9XG5cbiAgLyoqIFN0b3AgYmluZGluZyB0byB0aGUgZ2xvYmFsIG1vdXNldXAgYW5kIG1vdXNlbW92ZSBldmVudHMuICovXG4gIHByaXZhdGUgc3RhdGljIHVuYmluZERyYWdFdmVudHMoKSB7XG4gICAgaWYgKEJ1YmJsZS5vbk1vdXNlVXBXcmFwcGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZChCdWJibGUub25Nb3VzZVVwV3JhcHBlcik7XG4gICAgICBCdWJibGUub25Nb3VzZVVwV3JhcHBlciA9IG51bGw7XG4gICAgfVxuICAgIGlmIChCdWJibGUub25Nb3VzZU1vdmVXcmFwcGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZChCdWJibGUub25Nb3VzZU1vdmVXcmFwcGVyKTtcbiAgICAgIEJ1YmJsZS5vbk1vdXNlTW92ZVdyYXBwZXIgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVydXAgZXZlbnQgd2hpbGUgZHJhZ2dpbmcgYSBidWJibGUncyBib3JkZXIgb3IgcmVzaXplIGhhbmRsZS5cbiAgICpcbiAgICogQHBhcmFtIF9lIFBvaW50ZXIgdXAgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBidWJibGVNb3VzZVVwKF9lOiBQb2ludGVyRXZlbnQpIHtcbiAgICBUb3VjaC5jbGVhclRvdWNoSWRlbnRpZmllcigpO1xuICAgIEJ1YmJsZS51bmJpbmREcmFnRXZlbnRzKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSB0ZXh0IGZvciBhIG5vbiBlZGl0YWJsZSBidWJibGUuXG4gICAqXG4gICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IHRvIGRpc3BsYXkuXG4gICAqIEByZXR1cm5zIFRoZSB0b3AtbGV2ZWwgbm9kZSBvZiB0aGUgdGV4dC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgdGV4dFRvRG9tKHRleHQ6IHN0cmluZyk6IFNWR1RleHRFbGVtZW50IHtcbiAgICBjb25zdCBwYXJhZ3JhcGggPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuVEVYVCwge1xuICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlUZXh0IGJsb2NrbHlCdWJibGVUZXh0IGJsb2NrbHlOb1BvaW50ZXJFdmVudHMnLFxuICAgICAgJ3knOiBCdWJibGUuQk9SREVSX1dJRFRILFxuICAgIH0pO1xuICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgnXFxuJyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdHNwYW5FbGVtZW50ID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgICAgU3ZnLlRTUEFOLCB7J2R5JzogJzFlbScsICd4JzogQnViYmxlLkJPUkRFUl9XSURUSH0sIHBhcmFncmFwaCk7XG4gICAgICBjb25zdCB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmVzW2ldKTtcbiAgICAgIHRzcGFuRWxlbWVudC5hcHBlbmRDaGlsZCh0ZXh0Tm9kZSk7XG4gICAgfVxuICAgIHJldHVybiBwYXJhZ3JhcGg7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGJ1YmJsZSB0aGF0IGNhbiBub3QgYmUgZWRpdGVkLlxuICAgKlxuICAgKiBAcGFyYW0gcGFyYWdyYXBoRWxlbWVudCBUaGUgdGV4dCBlbGVtZW50IGZvciB0aGUgbm9uIGVkaXRhYmxlIGJ1YmJsZS5cbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0aGF0IHRoZSBidWJibGUgaXMgYXR0YWNoZWQgdG8uXG4gICAqIEBwYXJhbSBpY29uWFkgVGhlIGNvb3JkaW5hdGUgb2YgdGhlIGljb24uXG4gICAqIEByZXR1cm5zIFRoZSBub24gZWRpdGFibGUgYnViYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVOb25FZGl0YWJsZUJ1YmJsZShcbiAgICAgIHBhcmFncmFwaEVsZW1lbnQ6IFNWR1RleHRFbGVtZW50LCBibG9jazogQmxvY2tTdmcsXG4gICAgICBpY29uWFk6IENvb3JkaW5hdGUpOiBCdWJibGUge1xuICAgIGNvbnN0IGJ1YmJsZSA9IG5ldyBCdWJibGUoXG4gICAgICAgIGJsb2NrLndvcmtzcGFjZSEsIHBhcmFncmFwaEVsZW1lbnQsIGJsb2NrLnBhdGhPYmplY3Quc3ZnUGF0aCwgKGljb25YWSksXG4gICAgICAgIG51bGwsIG51bGwpO1xuICAgIC8vIEV4cG9zZSB0aGlzIGJ1YmJsZSdzIGJsb2NrJ3MgSUQgb24gaXRzIHRvcC1sZXZlbCBTVkcgZ3JvdXAuXG4gICAgYnViYmxlLnNldFN2Z0lkKGJsb2NrLmlkKTtcbiAgICBpZiAoYmxvY2suUlRMKSB7XG4gICAgICAvLyBSaWdodC1hbGlnbiB0aGUgcGFyYWdyYXBoLlxuICAgICAgLy8gVGhpcyBjYW5ub3QgYmUgZG9uZSB1bnRpbCB0aGUgYnViYmxlIGlzIHJlbmRlcmVkIG9uIHNjcmVlbi5cbiAgICAgIGNvbnN0IG1heFdpZHRoID0gcGFyYWdyYXBoRWxlbWVudC5nZXRCQm94KCkud2lkdGg7XG4gICAgICBmb3IgKGxldCBpID0gMCwgdGV4dEVsZW1lbnQ7XG4gICAgICAgICAgIHRleHRFbGVtZW50ID0gcGFyYWdyYXBoRWxlbWVudC5jaGlsZE5vZGVzW2ldIGFzIFNWR1RTcGFuRWxlbWVudDtcbiAgICAgICAgICAgaSsrKSB7XG4gICAgICAgIHRleHRFbGVtZW50LnNldEF0dHJpYnV0ZSgndGV4dC1hbmNob3InLCAnZW5kJyk7XG4gICAgICAgIHRleHRFbGVtZW50LnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAgICd4JywgKG1heFdpZHRoICsgQnViYmxlLkJPUkRFUl9XSURUSCkudG9TdHJpbmcoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBidWJibGU7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbGwgdGhlIHZhbHVlcyB0aGF0IHdlIGV4cGVjdCBkZXZlbG9wZXJzIHRvIGJlIGFibGUgdG8gY2hhbmdlXG4gKiBiZWZvcmUgaW5qZWN0aW5nIEJsb2NrbHkuIENoYW5naW5nIHRoZXNlIHZhbHVlcyBkdXJpbmcgcnVuIHRpbWUgaXMgbm90XG4gKiBnZW5lcmFsbHkgcmVjb21tZW5kZWQuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LmNvbmZpZ1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmNvbmZpZycpO1xuXG5cbi8qKlxuICogQWxsIHRoZSB2YWx1ZXMgdGhhdCB3ZSBleHBlY3QgZGV2ZWxvcGVycyB0byBiZSBhYmxlIHRvIGNoYW5nZVxuICogYmVmb3JlIGluamVjdGluZyBCbG9ja2x5LlxuICovXG5pbnRlcmZhY2UgQ29uZmlnIHtcbiAgZHJhZ1JhZGl1czogbnVtYmVyO1xuICBmbHlvdXREcmFnUmFkaXVzOiBudW1iZXI7XG4gIHNuYXBSYWRpdXM6IG51bWJlcjtcbiAgY3VycmVudENvbm5lY3Rpb25QcmVmZXJlbmNlOiBudW1iZXI7XG4gIGJ1bXBEZWxheTogbnVtYmVyO1xuICBjb25uZWN0aW5nU25hcFJhZGl1czogbnVtYmVyO1xufVxuXG4vKiogRGVmYXVsdCBzbmFwIHJhZGl1cy4gKi9cbmNvbnN0IERFRkFVTFRfU05BUF9SQURJVVMgPSAyODtcblxuLyoqXG4gKiBPYmplY3QgaG9sZGluZyBhbGwgdGhlIHZhbHVlcyBvbiBCbG9ja2x5IHRoYXQgd2UgZXhwZWN0IGRldmVsb3BlcnMgdG8gYmVcbiAqIGFibGUgdG8gY2hhbmdlLlxuICovXG5leHBvcnQgY29uc3QgY29uZmlnOiBDb25maWcgPSB7XG4gIC8qKlxuICAgKiBOdW1iZXIgb2YgcGl4ZWxzIHRoZSBtb3VzZSBtdXN0IG1vdmUgYmVmb3JlIGEgZHJhZyBzdGFydHMuXG4gICAqXG4gICAqIEBhbGlhcyBCbG9ja2x5LmNvbmZpZy5kcmFnUmFkaXVzXG4gICAqL1xuICBkcmFnUmFkaXVzOiA1LFxuICAvKipcbiAgICogTnVtYmVyIG9mIHBpeGVscyB0aGUgbW91c2UgbXVzdCBtb3ZlIGJlZm9yZSBhIGRyYWcvc2Nyb2xsIHN0YXJ0cyBmcm9tIHRoZVxuICAgKiBmbHlvdXQuICBCZWNhdXNlIHRoZSBkcmFnLWludGVudGlvbiBpcyBkZXRlcm1pbmVkIHdoZW4gdGhpcyBpcyByZWFjaGVkLCBpdFxuICAgKiBpcyBsYXJnZXIgdGhhbiBkcmFnUmFkaXVzIHNvIHRoYXQgdGhlIGRyYWctZGlyZWN0aW9uIGlzIGNsZWFyZXIuXG4gICAqXG4gICAqIEBhbGlhcyBCbG9ja2x5LmNvbmZpZy5mbHlvdXREcmFnUmFkaXVzXG4gICAqL1xuICBmbHlvdXREcmFnUmFkaXVzOiAxMCxcbiAgLyoqXG4gICAqIE1heGltdW0gbWlzYWxpZ25tZW50IGJldHdlZW4gY29ubmVjdGlvbnMgZm9yIHRoZW0gdG8gc25hcCB0b2dldGhlci5cbiAgICpcbiAgICogQGFsaWFzIEJsb2NrbHkuY29uZmlnLnNuYXBSYWRpdXNcbiAgICovXG4gIHNuYXBSYWRpdXM6IERFRkFVTFRfU05BUF9SQURJVVMsXG4gIC8qKlxuICAgKiBNYXhpbXVtIG1pc2FsaWdubWVudCBiZXR3ZWVuIGNvbm5lY3Rpb25zIGZvciB0aGVtIHRvIHNuYXAgdG9nZXRoZXIuXG4gICAqIFRoaXMgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBzbmFwIHJhZGl1cy5cbiAgICpcbiAgICogQGFsaWFzIEJsb2NrbHkuY29uZmlnLmNvbm5lY3RpbmdTbmFwUmFkaXVzXG4gICAqL1xuICBjb25uZWN0aW5nU25hcFJhZGl1czogREVGQVVMVF9TTkFQX1JBRElVUyxcbiAgLyoqXG4gICAqIEhvdyBtdWNoIHRvIHByZWZlciBzdGF5aW5nIGNvbm5lY3RlZCB0byB0aGUgY3VycmVudCBjb25uZWN0aW9uIG92ZXIgbW92aW5nXG4gICAqIHRvIGEgbmV3IGNvbm5lY3Rpb24uICBUaGUgY3VycmVudCBwcmV2aWV3ZWQgY29ubmVjdGlvbiBpcyBjb25zaWRlcmVkIHRvIGJlXG4gICAqIHRoaXMgbXVjaCBjbG9zZXIgdG8gdGhlIG1hdGNoaW5nIGNvbm5lY3Rpb24gb24gdGhlIGJsb2NrIHRoYW4gaXQgYWN0dWFsbHlcbiAgICogaXMuXG4gICAqXG4gICAqIEBhbGlhcyBCbG9ja2x5LmNvbmZpZy5jdXJyZW50Q29ubmVjdGlvblByZWZlcmVuY2VcbiAgICovXG4gIGN1cnJlbnRDb25uZWN0aW9uUHJlZmVyZW5jZTogOCxcbiAgLyoqXG4gICAqIERlbGF5IGluIG1zIGJldHdlZW4gdHJpZ2dlciBhbmQgYnVtcGluZyB1bmNvbm5lY3RlZCBibG9jayBvdXQgb2YgYWxpZ25tZW50LlxuICAgKlxuICAgKiBAYWxpYXMgQmxvY2tseS5jb25maWcuYnVtcERlbGF5XG4gICAqL1xuICBidW1wRGVsYXk6IDI1MCxcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0IHJlcHJlc2VudGluZyBhbiBpY29uIG9uIGEgYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuSWNvbicpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgdHlwZSB7QnViYmxlfSBmcm9tICcuL2J1YmJsZS5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTaXplfSBmcm9tICcuL3V0aWxzL3NpemUuanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcbmltcG9ydCAqIGFzIHN2Z01hdGggZnJvbSAnLi91dGlscy9zdmdfbWF0aC5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhbiBpY29uLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5Lkljb25cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEljb24ge1xuICBwcm90ZWN0ZWQgYmxvY2tfOiBCbG9ja1N2Z3xudWxsO1xuICAvKiogVGhlIGljb24gU1ZHIGdyb3VwLiAqL1xuICBpY29uR3JvdXBfOiBTVkdHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogV2hldGhlciB0aGlzIGljb24gZ2V0cyBoaWRkZW4gd2hlbiB0aGUgYmxvY2sgaXMgY29sbGFwc2VkLiAqL1xuICBjb2xsYXBzZUhpZGRlbiA9IHRydWU7XG5cbiAgLyoqIEhlaWdodCBhbmQgd2lkdGggb2YgaWNvbnMuICovXG4gIHJlYWRvbmx5IFNJWkUgPSAxNztcblxuICAvKiogQnViYmxlIFVJIChpZiB2aXNpYmxlKS4gKi9cbiAgcHJvdGVjdGVkIGJ1YmJsZV86IEJ1YmJsZXxudWxsID0gbnVsbDtcblxuICAvKiogQWJzb2x1dGUgY29vcmRpbmF0ZSBvZiBpY29uJ3MgY2VudGVyLiAqL1xuICBwcm90ZWN0ZWQgaWNvblhZXzogQ29vcmRpbmF0ZXxudWxsID0gbnVsbDtcblxuICAvKiogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBhc3NvY2lhdGVkIHdpdGggdGhpcyBpY29uLiAqL1xuICBjb25zdHJ1Y3RvcihibG9jazogQmxvY2tTdmd8bnVsbCkge1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0NhbGxpbmcgdGhlIEljb24gY29uc3RydWN0b3Igd2l0aCBhIG51bGwgYmxvY2snLCAndmVyc2lvbiA5JyxcbiAgICAgICAgICAndmVyc2lvbiAxMCcsICdhIG5vbi1udWxsIGJsb2NrJyk7XG4gICAgfVxuICAgIHRoaXMuYmxvY2tfID0gYmxvY2s7XG4gIH1cblxuICAvKiogQ3JlYXRlIHRoZSBpY29uIG9uIHRoZSBibG9jay4gKi9cbiAgY3JlYXRlSWNvbigpIHtcbiAgICBpZiAodGhpcy5pY29uR3JvdXBfKSB7XG4gICAgICAvLyBJY29uIGFscmVhZHkgZXhpc3RzLlxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvKiBIZXJlJ3MgdGhlIG1hcmt1cCB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkOlxuICAgICAgICA8ZyBjbGFzcz1cImJsb2NrbHlJY29uR3JvdXBcIj5cbiAgICAgICAgICAuLi5cbiAgICAgICAgPC9nPlxuICAgICAgICAqL1xuICAgIHRoaXMuaWNvbkdyb3VwXyA9XG4gICAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5HLCB7J2NsYXNzJzogJ2Jsb2NrbHlJY29uR3JvdXAnfSk7XG4gICAgaWYgKHRoaXMuZ2V0QmxvY2soKS5pc0luRmx5b3V0KSB7XG4gICAgICBkb20uYWRkQ2xhc3ModGhpcy5pY29uR3JvdXBfLCAnYmxvY2tseUljb25Hcm91cFJlYWRvbmx5Jyk7XG4gICAgfVxuICAgIHRoaXMuZHJhd0ljb25fKHRoaXMuaWNvbkdyb3VwXyk7XG5cbiAgICB0aGlzLmdldEJsb2NrKCkuZ2V0U3ZnUm9vdCgpLmFwcGVuZENoaWxkKHRoaXMuaWNvbkdyb3VwXyk7XG4gICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIHRoaXMuaWNvbkdyb3VwXywgJ3BvaW50ZXJ1cCcsIHRoaXMsIHRoaXMuaWNvbkNsaWNrXyk7XG4gICAgdGhpcy51cGRhdGVFZGl0YWJsZSgpO1xuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgdGhpcyBpY29uLiAqL1xuICBkaXNwb3NlKCkge1xuICAgIGRvbS5yZW1vdmVOb2RlKHRoaXMuaWNvbkdyb3VwXyk7ICAvLyBEaXNwb3NlIG9mIGFuZCB1bmxpbmsgdGhlIGljb24uXG4gICAgdGhpcy5zZXRWaXNpYmxlKGZhbHNlKTsgICAgICAgICAgIC8vIERpc3Bvc2Ugb2YgYW5kIHVubGluayB0aGUgYnViYmxlLlxuICB9XG5cbiAgLyoqIEFkZCBvciByZW1vdmUgdGhlIFVJIGluZGljYXRpbmcgaWYgdGhpcyBpY29uIG1heSBiZSBjbGlja2VkIG9yIG5vdC4gKi9cbiAgdXBkYXRlRWRpdGFibGUoKSB7XG4gICAgLy8gTm8tb3Agb24gdGhlIGJhc2UgY2xhc3MuXG4gIH1cblxuICAvKipcbiAgICogSXMgdGhlIGFzc29jaWF0ZWQgYnViYmxlIHZpc2libGU/XG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGJ1YmJsZSBpcyB2aXNpYmxlLlxuICAgKi9cbiAgaXNWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuYnViYmxlXztcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGlja2luZyBvbiB0aGUgaWNvbiB0b2dnbGVzIGlmIHRoZSBidWJibGUgaXMgdmlzaWJsZS5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2UgY2xpY2sgZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgaWNvbkNsaWNrXyhlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBpZiAodGhpcy5nZXRCbG9jaygpLndvcmtzcGFjZS5pc0RyYWdnaW5nKCkpIHtcbiAgICAgIC8vIERyYWcgb3BlcmF0aW9uIGlzIGNvbmNsdWRpbmcuICBEb24ndCBvcGVuIHRoZSBlZGl0b3IuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5nZXRCbG9jaygpLmlzSW5GbHlvdXQgJiYgIWJyb3dzZXJFdmVudHMuaXNSaWdodEJ1dHRvbihlKSkge1xuICAgICAgdGhpcy5zZXRWaXNpYmxlKCF0aGlzLmlzVmlzaWJsZSgpKTtcbiAgICB9XG4gIH1cblxuICAvKiogQ2hhbmdlIHRoZSBjb2xvdXIgb2YgdGhlIGFzc29jaWF0ZWQgYnViYmxlIHRvIG1hdGNoIGl0cyBibG9jay4gKi9cbiAgYXBwbHlDb2xvdXIoKSB7XG4gICAgaWYgKHRoaXMuYnViYmxlXyAmJiB0aGlzLmlzVmlzaWJsZSgpKSB7XG4gICAgICB0aGlzLmJ1YmJsZV8uc2V0Q29sb3VyKHRoaXMuZ2V0QmxvY2soKS5zdHlsZS5jb2xvdXJQcmltYXJ5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIGljb24gaGFzIG1vdmVkLiAgVXBkYXRlIHRoZSBhcnJvdyBhY2NvcmRpbmdseS5cbiAgICpcbiAgICogQHBhcmFtIHh5IEFic29sdXRlIGxvY2F0aW9uIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICovXG4gIHNldEljb25Mb2NhdGlvbih4eTogQ29vcmRpbmF0ZSkge1xuICAgIHRoaXMuaWNvblhZXyA9IHh5O1xuICAgIGlmICh0aGlzLmJ1YmJsZV8gJiYgdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgdGhpcy5idWJibGVfLnNldEFuY2hvckxvY2F0aW9uKHh5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIGljb24gaGFzIG1vdmVkLCBidXQgd2UgZG9uJ3QgcmVhbGx5IGtub3cgd2hlcmUuXG4gICAqIFJlY29tcHV0ZSB0aGUgaWNvbidzIGxvY2F0aW9uIGZyb20gc2NyYXRjaC5cbiAgICovXG4gIGNvbXB1dGVJY29uTG9jYXRpb24oKSB7XG4gICAgLy8gRmluZCBjb29yZGluYXRlcyBmb3IgdGhlIGNlbnRyZSBvZiB0aGUgaWNvbiBhbmQgdXBkYXRlIHRoZSBhcnJvdy5cbiAgICBjb25zdCBibG9ja1hZID0gdGhpcy5nZXRCbG9jaygpLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcbiAgICBjb25zdCBpY29uWFkgPSBzdmdNYXRoLmdldFJlbGF0aXZlWFkodGhpcy5pY29uR3JvdXBfIGFzIFNWR0VsZW1lbnQpO1xuICAgIGNvbnN0IG5ld1hZID0gbmV3IENvb3JkaW5hdGUoXG4gICAgICAgIGJsb2NrWFkueCArIGljb25YWS54ICsgdGhpcy5TSVpFIC8gMixcbiAgICAgICAgYmxvY2tYWS55ICsgaWNvblhZLnkgKyB0aGlzLlNJWkUgLyAyKTtcbiAgICBpZiAoIUNvb3JkaW5hdGUuZXF1YWxzKHRoaXMuZ2V0SWNvbkxvY2F0aW9uKCksIG5ld1hZKSkge1xuICAgICAgdGhpcy5zZXRJY29uTG9jYXRpb24obmV3WFkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBjZW50ZXIgb2YgdGhlIGJsb2NrJ3MgaWNvbiByZWxhdGl2ZSB0byB0aGUgc3VyZmFjZS5cbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IHdpdGggeCBhbmQgeSBwcm9wZXJ0aWVzIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICovXG4gIGdldEljb25Mb2NhdGlvbigpOiBDb29yZGluYXRlfG51bGwge1xuICAgIHJldHVybiB0aGlzLmljb25YWV87XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzaXplIG9mIHRoZSBpY29uIGFzIHVzZWQgZm9yIHJlbmRlcmluZy5cbiAgICogVGhpcyBkaWZmZXJzIGZyb20gdGhlIGFjdHVhbCBzaXplIG9mIHRoZSBpY29uLCBiZWNhdXNlIGl0IGJ1bGdlcyBzbGlnaHRseVxuICAgKiBvdXQgb2YgaXRzIHJvdyByYXRoZXIgdGhhbiBpbmNyZWFzaW5nIHRoZSBoZWlnaHQgb2YgaXRzIHJvdy5cbiAgICpcbiAgICogQHJldHVybnMgSGVpZ2h0IGFuZCB3aWR0aC5cbiAgICovXG4gIGdldENvcnJlY3RlZFNpemUoKTogU2l6ZSB7XG4gICAgLy8gVE9ETyAoIzI1NjIpOiBSZW1vdmUgZ2V0Q29ycmVjdGVkU2l6ZS5cbiAgICByZXR1cm4gbmV3IFNpemUodGhpcy5TSVpFLCB0aGlzLlNJWkUgLSAyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IHRoZSBpY29uLlxuICAgKlxuICAgKiBAcGFyYW0gX2dyb3VwIFRoZSBpY29uIGdyb3VwLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdJY29uXyhfZ3JvdXA6IEVsZW1lbnQpIHt9XG4gIC8vIE5vLW9wIG9uIGJhc2UgY2xhc3MuXG5cbiAgLyoqXG4gICAqIFNob3cgb3IgaGlkZSB0aGUgYnViYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gX3Zpc2libGUgVHJ1ZSBpZiB0aGUgYnViYmxlIHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKi9cbiAgc2V0VmlzaWJsZShfdmlzaWJsZTogYm9vbGVhbikge31cblxuICAvKipcbiAgICogQHJldHVybnMgVGhlIGJsb2NrIHRoaXMgaWNvbiBpcyBhdHRhY2hlZCB0by5cbiAgICovXG4gIHByb3RlY3RlZCBnZXRCbG9jaygpOiBCbG9ja1N2ZyB7XG4gICAgaWYgKCF0aGlzLmJsb2NrXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdCbG9jayBpcyBub3Qgc2V0IGZvciB0aGlzIGljb24uJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuYmxvY2tfO1xuICB9XG59XG4vLyBOby1vcCBvbiBiYXNlIGNsYXNzXG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBhIHRoZW1lLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRoZW1lJyk7XG5cbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4vcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgb2JqZWN0IGZyb20gJy4vdXRpbHMvb2JqZWN0LmpzJztcblxuXG5leHBvcnQgaW50ZXJmYWNlIElUaGVtZSB7XG4gIGJsb2NrU3R5bGVzPzoge1trZXk6IHN0cmluZ106IFBhcnRpYWw8QmxvY2tTdHlsZT59O1xuICBjYXRlZ29yeVN0eWxlcz86IHtba2V5OiBzdHJpbmddOiBDYXRlZ29yeVN0eWxlfTtcbiAgY29tcG9uZW50U3R5bGVzPzogQ29tcG9uZW50U3R5bGU7XG4gIGZvbnRTdHlsZT86IEZvbnRTdHlsZTtcbiAgc3RhcnRIYXRzPzogYm9vbGVhbjtcbiAgYmFzZT86IHN0cmluZ3xUaGVtZTtcbiAgbmFtZTogc3RyaW5nO1xufVxuXG4vKipcbiAqIENsYXNzIGZvciBhIHRoZW1lLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRoZW1lXG4gKi9cbmV4cG9ydCBjbGFzcyBUaGVtZSBpbXBsZW1lbnRzIElUaGVtZSB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgYmxvY2tTdHlsZXM6IHtba2V5OiBzdHJpbmddOiBCbG9ja1N0eWxlfTtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjYXRlZ29yeVN0eWxlczoge1trZXk6IHN0cmluZ106IENhdGVnb3J5U3R5bGV9O1xuICAvKiogQGludGVybmFsICovXG4gIGNvbXBvbmVudFN0eWxlczogQ29tcG9uZW50U3R5bGU7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgZm9udFN0eWxlOiBGb250U3R5bGU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRvIGFkZCBhICdoYXQnIG9uIHRvcCBvZiBhbGwgYmxvY2tzIHdpdGggbm8gcHJldmlvdXMgb3JcbiAgICogb3V0cHV0IGNvbm5lY3Rpb25zLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXJ0SGF0cz86IGJvb2xlYW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogQHBhcmFtIG5hbWUgVGhlbWUgbmFtZS5cbiAgICogQHBhcmFtIG9wdF9ibG9ja1N0eWxlcyBBIG1hcCBmcm9tIHN0eWxlIG5hbWVzIChzdHJpbmdzKSB0byBvYmplY3RzIHdpdGhcbiAgICogICAgIHN0eWxlIGF0dHJpYnV0ZXMgZm9yIGJsb2Nrcy5cbiAgICogQHBhcmFtIG9wdF9jYXRlZ29yeVN0eWxlcyBBIG1hcCBmcm9tIHN0eWxlIG5hbWVzIChzdHJpbmdzKSB0byBvYmplY3RzIHdpdGhcbiAgICogICAgIHN0eWxlIGF0dHJpYnV0ZXMgZm9yIGNhdGVnb3JpZXMuXG4gICAqIEBwYXJhbSBvcHRfY29tcG9uZW50U3R5bGVzIEEgbWFwIG9mIEJsb2NrbHkgY29tcG9uZW50IG5hbWVzIHRvIHN0eWxlIHZhbHVlLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBwdWJsaWMgbmFtZTogc3RyaW5nLFxuICAgICAgb3B0X2Jsb2NrU3R5bGVzPzoge1trZXk6IHN0cmluZ106IFBhcnRpYWw8QmxvY2tTdHlsZT59LFxuICAgICAgb3B0X2NhdGVnb3J5U3R5bGVzPzoge1trZXk6IHN0cmluZ106IENhdGVnb3J5U3R5bGV9LFxuICAgICAgb3B0X2NvbXBvbmVudFN0eWxlcz86IENvbXBvbmVudFN0eWxlKSB7XG4gICAgLyoqIFRoZSBibG9jayBzdHlsZXMgbWFwLiAqL1xuICAgIHRoaXMuYmxvY2tTdHlsZXMgPSBvcHRfYmxvY2tTdHlsZXMgfHwgT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIC8qKiBUaGUgY2F0ZWdvcnkgc3R5bGVzIG1hcC4gKi9cbiAgICB0aGlzLmNhdGVnb3J5U3R5bGVzID0gb3B0X2NhdGVnb3J5U3R5bGVzIHx8IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgICAvKiogVGhlIFVJIGNvbXBvbmVudHMgc3R5bGVzIG1hcC4gKi9cbiAgICB0aGlzLmNvbXBvbmVudFN0eWxlcyA9XG4gICAgICAgIG9wdF9jb21wb25lbnRTdHlsZXMgfHwgT2JqZWN0LmNyZWF0ZShudWxsKSBhcyBDb21wb25lbnRTdHlsZTtcblxuICAgIC8qKiBUaGUgZm9udCBzdHlsZS4gKi9cbiAgICB0aGlzLmZvbnRTdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCkgYXMgRm9udFN0eWxlO1xuXG4gICAgLy8gUmVnaXN0ZXIgdGhlIHRoZW1lIGJ5IG5hbWUuXG4gICAgcmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5USEVNRSwgbmFtZSwgdGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY2xhc3MgbmFtZSB0aGF0IGlkZW50aWZpZXMgdGhpcyB0aGVtZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIENTUyBjbGFzcyBuYW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldENsYXNzTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm5hbWUgKyAnLXRoZW1lJztcbiAgfVxuXG4gIC8qKlxuICAgKiBPdmVycmlkZXMgb3IgYWRkcyBhIHN0eWxlIHRvIHRoZSBibG9ja1N0eWxlcyBtYXAuXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja1N0eWxlTmFtZSBUaGUgbmFtZSBvZiB0aGUgYmxvY2sgc3R5bGUuXG4gICAqIEBwYXJhbSBibG9ja1N0eWxlIFRoZSBibG9jayBzdHlsZS5cbiAgICovXG4gIHNldEJsb2NrU3R5bGUoYmxvY2tTdHlsZU5hbWU6IHN0cmluZywgYmxvY2tTdHlsZTogQmxvY2tTdHlsZSkge1xuICAgIHRoaXMuYmxvY2tTdHlsZXNbYmxvY2tTdHlsZU5hbWVdID0gYmxvY2tTdHlsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPdmVycmlkZXMgb3IgYWRkcyBhIHN0eWxlIHRvIHRoZSBjYXRlZ29yeVN0eWxlcyBtYXAuXG4gICAqXG4gICAqIEBwYXJhbSBjYXRlZ29yeVN0eWxlTmFtZSBUaGUgbmFtZSBvZiB0aGUgY2F0ZWdvcnkgc3R5bGUuXG4gICAqIEBwYXJhbSBjYXRlZ29yeVN0eWxlIFRoZSBjYXRlZ29yeSBzdHlsZS5cbiAgICovXG4gIHNldENhdGVnb3J5U3R5bGUoY2F0ZWdvcnlTdHlsZU5hbWU6IHN0cmluZywgY2F0ZWdvcnlTdHlsZTogQ2F0ZWdvcnlTdHlsZSkge1xuICAgIHRoaXMuY2F0ZWdvcnlTdHlsZXNbY2F0ZWdvcnlTdHlsZU5hbWVdID0gY2F0ZWdvcnlTdHlsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzdHlsZSBmb3IgYSBnaXZlbiBCbG9ja2x5IFVJIGNvbXBvbmVudC4gIElmIHRoZSBzdHlsZSB2YWx1ZSBpcyBhXG4gICAqIHN0cmluZywgd2UgYXR0ZW1wdCB0byBmaW5kIHRoZSB2YWx1ZSBvZiBhbnkgbmFtZWQgcmVmZXJlbmNlcy5cbiAgICpcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudC5cbiAgICogQHJldHVybnMgVGhlIHN0eWxlIHZhbHVlLlxuICAgKi9cbiAgZ2V0Q29tcG9uZW50U3R5bGUoY29tcG9uZW50TmFtZTogc3RyaW5nKTogc3RyaW5nfG51bGwge1xuICAgIGNvbnN0IHN0eWxlID0gKHRoaXMuY29tcG9uZW50U3R5bGVzIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbY29tcG9uZW50TmFtZV07XG4gICAgaWYgKHN0eWxlICYmIHR5cGVvZiBzdHlsZSA9PT0gJ3N0cmluZycgJiYgdGhpcy5nZXRDb21wb25lbnRTdHlsZSgoc3R5bGUpKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29tcG9uZW50U3R5bGUoKHN0eWxlKSk7XG4gICAgfVxuICAgIHJldHVybiBzdHlsZSA/IFN0cmluZyhzdHlsZSkgOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyZSBhIHNwZWNpZmljIEJsb2NrbHkgVUkgY29tcG9uZW50IHdpdGggYSBzdHlsZSB2YWx1ZS5cbiAgICpcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudC5cbiAgICogQHBhcmFtIHN0eWxlVmFsdWUgVGhlIHN0eWxlIHZhbHVlLlxuICAgKi9cbiAgc2V0Q29tcG9uZW50U3R5bGUoY29tcG9uZW50TmFtZTogc3RyaW5nLCBzdHlsZVZhbHVlOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgICAodGhpcy5jb21wb25lbnRTdHlsZXMgYXMgQW55RHVyaW5nTWlncmF0aW9uKVtjb21wb25lbnROYW1lXSA9IHN0eWxlVmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJlIGEgdGhlbWUncyBmb250IHN0eWxlLlxuICAgKlxuICAgKiBAcGFyYW0gZm9udFN0eWxlIFRoZSBmb250IHN0eWxlLlxuICAgKi9cbiAgc2V0Rm9udFN0eWxlKGZvbnRTdHlsZTogRm9udFN0eWxlKSB7XG4gICAgdGhpcy5mb250U3R5bGUgPSBmb250U3R5bGU7XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJlIGEgdGhlbWUncyBzdGFydCBoYXRzLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhcnRIYXRzIFRydWUgaWYgdGhlIHRoZW1lIGVuYWJsZXMgc3RhcnQgaGF0cywgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgc2V0U3RhcnRIYXRzKHN0YXJ0SGF0czogYm9vbGVhbikge1xuICAgIHRoaXMuc3RhcnRIYXRzID0gc3RhcnRIYXRzO1xuICB9XG5cbiAgLyoqXG4gICAqIERlZmluZSBhIG5ldyBCbG9ja2x5IHRoZW1lLlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgdGhlbWUuXG4gICAqIEBwYXJhbSB0aGVtZU9iaiBBbiBvYmplY3QgY29udGFpbmluZyB0aGVtZSBwcm9wZXJ0aWVzLlxuICAgKiBAcmV0dXJucyBBIG5ldyBCbG9ja2x5IHRoZW1lLlxuICAgKi9cbiAgc3RhdGljIGRlZmluZVRoZW1lKG5hbWU6IHN0cmluZywgdGhlbWVPYmo6IElUaGVtZSk6IFRoZW1lIHtcbiAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IHRoZW1lID0gbmV3IFRoZW1lKG5hbWUpO1xuICAgIGxldCBiYXNlID0gdGhlbWVPYmpbJ2Jhc2UnXTtcbiAgICBpZiAoYmFzZSkge1xuICAgICAgaWYgKHR5cGVvZiBiYXNlID09PSAnc3RyaW5nJykge1xuICAgICAgICBiYXNlID0gcmVnaXN0cnkuZ2V0T2JqZWN0KHJlZ2lzdHJ5LlR5cGUuVEhFTUUsIGJhc2UpID8/IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmIChiYXNlIGluc3RhbmNlb2YgVGhlbWUpIHtcbiAgICAgICAgb2JqZWN0LmRlZXBNZXJnZSh0aGVtZSwgYmFzZSk7XG4gICAgICAgIHRoZW1lLm5hbWUgPSBuYW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIG9iamVjdC5kZWVwTWVyZ2UodGhlbWUuYmxvY2tTdHlsZXMsIHRoZW1lT2JqWydibG9ja1N0eWxlcyddKTtcbiAgICBvYmplY3QuZGVlcE1lcmdlKHRoZW1lLmNhdGVnb3J5U3R5bGVzLCB0aGVtZU9ialsnY2F0ZWdvcnlTdHlsZXMnXSk7XG4gICAgb2JqZWN0LmRlZXBNZXJnZSh0aGVtZS5jb21wb25lbnRTdHlsZXMsIHRoZW1lT2JqWydjb21wb25lbnRTdHlsZXMnXSk7XG4gICAgb2JqZWN0LmRlZXBNZXJnZSh0aGVtZS5mb250U3R5bGUsIHRoZW1lT2JqWydmb250U3R5bGUnXSk7XG4gICAgaWYgKHRoZW1lT2JqWydzdGFydEhhdHMnXSAhPT0gbnVsbCkge1xuICAgICAgdGhlbWUuc3RhcnRIYXRzID0gdGhlbWVPYmpbJ3N0YXJ0SGF0cyddO1xuICAgIH1cblxuICAgIHJldHVybiB0aGVtZTtcbiAgfVxufVxuXG5leHBvcnQgbmFtZXNwYWNlIFRoZW1lIHtcbiAgZXhwb3J0IGludGVyZmFjZSBCbG9ja1N0eWxlIHtcbiAgICBjb2xvdXJQcmltYXJ5OiBzdHJpbmc7XG4gICAgY29sb3VyU2Vjb25kYXJ5OiBzdHJpbmc7XG4gICAgY29sb3VyVGVydGlhcnk6IHN0cmluZztcbiAgICBoYXQ6IHN0cmluZztcbiAgfVxuXG4gIGV4cG9ydCBpbnRlcmZhY2UgQ2F0ZWdvcnlTdHlsZSB7XG4gICAgY29sb3VyOiBzdHJpbmc7XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudFN0eWxlIHtcbiAgICB3b3Jrc3BhY2VCYWNrZ3JvdW5kQ29sb3VyPzogc3RyaW5nO1xuICAgIHRvb2xib3hCYWNrZ3JvdW5kQ29sb3VyPzogc3RyaW5nO1xuICAgIHRvb2xib3hGb3JlZ3JvdW5kQ29sb3VyPzogc3RyaW5nO1xuICAgIGZseW91dEJhY2tncm91bmRDb2xvdXI/OiBzdHJpbmc7XG4gICAgZmx5b3V0Rm9yZWdyb3VuZENvbG91cj86IHN0cmluZztcbiAgICBmbHlvdXRPcGFjaXR5PzogbnVtYmVyO1xuICAgIHNjcm9sbGJhckNvbG91cj86IHN0cmluZztcbiAgICBzY3JvbGxiYXJPcGFjaXR5PzogbnVtYmVyO1xuICAgIGluc2VydGlvbk1hcmtlckNvbG91cj86IHN0cmluZztcbiAgICBpbnNlcnRpb25NYXJrZXJPcGFjaXR5PzogbnVtYmVyO1xuICAgIG1hcmtlckNvbG91cj86IHN0cmluZztcbiAgICBjdXJzb3JDb2xvdXI/OiBzdHJpbmc7XG4gICAgc2VsZWN0ZWRHbG93Q29sb3VyPzogc3RyaW5nO1xuICAgIHNlbGVjdGVkR2xvd09wYWNpdHk/OiBudW1iZXI7XG4gICAgcmVwbGFjZW1lbnRHbG93Q29sb3VyPzogc3RyaW5nO1xuICAgIHJlcGxhY2VtZW50R2xvd09wYWNpdHk/OiBudW1iZXI7XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIEZvbnRTdHlsZSB7XG4gICAgZmFtaWx5Pzogc3RyaW5nO1xuICAgIHdlaWdodD86IHN0cmluZztcbiAgICBzaXplPzogbnVtYmVyO1xuICB9XG59XG5cbmV4cG9ydCB0eXBlIEJsb2NrU3R5bGUgPSBUaGVtZS5CbG9ja1N0eWxlO1xuZXhwb3J0IHR5cGUgQ2F0ZWdvcnlTdHlsZSA9IFRoZW1lLkNhdGVnb3J5U3R5bGU7XG5leHBvcnQgdHlwZSBDb21wb25lbnRTdHlsZSA9IFRoZW1lLkNvbXBvbmVudFN0eWxlO1xuZXhwb3J0IHR5cGUgRm9udFN0eWxlID0gVGhlbWUuRm9udFN0eWxlO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzaWMgdGhlbWUuXG4gKiBDb250YWlucyBtdWx0aS1jb2xvdXJlZCBib3JkZXIgdG8gY3JlYXRlIHNoYWRvdyBlZmZlY3QuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LlRoZW1lcy5DbGFzc2ljXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVGhlbWVzLkNsYXNzaWMnKTtcblxuaW1wb3J0IHtUaGVtZX0gZnJvbSAnLi4vdGhlbWUuanMnO1xuXG5cbmNvbnN0IGRlZmF1bHRCbG9ja1N0eWxlcyA9IHtcbiAgJ2NvbG91cl9ibG9ja3MnOiB7J2NvbG91clByaW1hcnknOiAnMjAnfSxcbiAgJ2xpc3RfYmxvY2tzJzogeydjb2xvdXJQcmltYXJ5JzogJzI2MCd9LFxuICAnbG9naWNfYmxvY2tzJzogeydjb2xvdXJQcmltYXJ5JzogJzIxMCd9LFxuICAnbG9vcF9ibG9ja3MnOiB7J2NvbG91clByaW1hcnknOiAnMTIwJ30sXG4gICdtYXRoX2Jsb2Nrcyc6IHsnY29sb3VyUHJpbWFyeSc6ICcyMzAnfSxcbiAgJ3Byb2NlZHVyZV9ibG9ja3MnOiB7J2NvbG91clByaW1hcnknOiAnMjkwJ30sXG4gICd0ZXh0X2Jsb2Nrcyc6IHsnY29sb3VyUHJpbWFyeSc6ICcxNjAnfSxcbiAgJ3ZhcmlhYmxlX2Jsb2Nrcyc6IHsnY29sb3VyUHJpbWFyeSc6ICczMzAnfSxcbiAgJ3ZhcmlhYmxlX2R5bmFtaWNfYmxvY2tzJzogeydjb2xvdXJQcmltYXJ5JzogJzMxMCd9LFxuICAnaGF0X2Jsb2Nrcyc6IHsnY29sb3VyUHJpbWFyeSc6ICczMzAnLCAnaGF0JzogJ2NhcCd9LFxufTtcblxuY29uc3QgY2F0ZWdvcnlTdHlsZXMgPSB7XG4gICdjb2xvdXJfY2F0ZWdvcnknOiB7J2NvbG91cic6ICcyMCd9LFxuICAnbGlzdF9jYXRlZ29yeSc6IHsnY29sb3VyJzogJzI2MCd9LFxuICAnbG9naWNfY2F0ZWdvcnknOiB7J2NvbG91cic6ICcyMTAnfSxcbiAgJ2xvb3BfY2F0ZWdvcnknOiB7J2NvbG91cic6ICcxMjAnfSxcbiAgJ21hdGhfY2F0ZWdvcnknOiB7J2NvbG91cic6ICcyMzAnfSxcbiAgJ3Byb2NlZHVyZV9jYXRlZ29yeSc6IHsnY29sb3VyJzogJzI5MCd9LFxuICAndGV4dF9jYXRlZ29yeSc6IHsnY29sb3VyJzogJzE2MCd9LFxuICAndmFyaWFibGVfY2F0ZWdvcnknOiB7J2NvbG91cic6ICczMzAnfSxcbiAgJ3ZhcmlhYmxlX2R5bmFtaWNfY2F0ZWdvcnknOiB7J2NvbG91cic6ICczMTAnfSxcbn07XG5cbi8qKlxuICogQ2xhc3NpYyB0aGVtZS5cbiAqIENvbnRhaW5zIG11bHRpLWNvbG91cmVkIGJvcmRlciB0byBjcmVhdGUgc2hhZG93IGVmZmVjdC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5UaGVtZXMuQ2xhc3NpY1xuICovXG5leHBvcnQgY29uc3QgQ2xhc3NpYyA9IG5ldyBUaGVtZShcbiAgICAnY2xhc3NpYycsIGRlZmF1bHRCbG9ja1N0eWxlcyBhcyBBbnlEdXJpbmdNaWdyYXRpb24sIGNhdGVnb3J5U3R5bGVzKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgdGhhdCBjb250cm9scyBzZXR0aW5ncyBmb3IgdGhlIHdvcmtzcGFjZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5PcHRpb25zJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja2x5T3B0aW9uc30gZnJvbSAnLi9ibG9ja2x5X29wdGlvbnMuanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7VGhlbWV9IGZyb20gJy4vdGhlbWUuanMnO1xuaW1wb3J0IHtDbGFzc2ljfSBmcm9tICcuL3RoZW1lL2NsYXNzaWMuanMnO1xuaW1wb3J0ICogYXMgaWRHZW5lcmF0b3IgZnJvbSAnLi91dGlscy9pZGdlbmVyYXRvci5qcyc7XG5pbXBvcnQgdHlwZSB7TWV0cmljc30gZnJvbSAnLi91dGlscy9tZXRyaWNzLmpzJztcbmltcG9ydCAqIGFzIHRvb2xib3ggZnJvbSAnLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBQYXJzZSB0aGUgdXNlci1zcGVjaWZpZWQgb3B0aW9ucywgdXNpbmcgcmVhc29uYWJsZSBkZWZhdWx0cyB3aGVyZSBiZWhhdmlvdXJcbiAqIGlzIHVuc3BlY2lmaWVkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5Lk9wdGlvbnNcbiAqL1xuZXhwb3J0IGNsYXNzIE9wdGlvbnMge1xuICBSVEw6IGJvb2xlYW47XG4gIG9uZUJhc2VkSW5kZXg6IGJvb2xlYW47XG4gIGNvbGxhcHNlOiBib29sZWFuO1xuICBjb21tZW50czogYm9vbGVhbjtcbiAgZGlzYWJsZTogYm9vbGVhbjtcbiAgcmVhZE9ubHk6IGJvb2xlYW47XG4gIG1heEJsb2NrczogbnVtYmVyO1xuICBtYXhJbnN0YW5jZXM6IHtba2V5OiBzdHJpbmddOiBudW1iZXJ9fG51bGw7XG4gIG1vZGFsSW5wdXRzOiBib29sZWFuO1xuICBwYXRoVG9NZWRpYTogc3RyaW5nO1xuICBoYXNDYXRlZ29yaWVzOiBib29sZWFuO1xuICBtb3ZlT3B0aW9uczogTW92ZU9wdGlvbnM7XG4gIGhhc1Njcm9sbGJhcnM6IGJvb2xlYW47XG4gIGhhc1RyYXNoY2FuOiBib29sZWFuO1xuICBtYXhUcmFzaGNhbkNvbnRlbnRzOiBudW1iZXI7XG4gIGhhc1NvdW5kczogYm9vbGVhbjtcbiAgaGFzQ3NzOiBib29sZWFuO1xuICBob3Jpem9udGFsTGF5b3V0OiBib29sZWFuO1xuICBsYW5ndWFnZVRyZWU6IHRvb2xib3guVG9vbGJveEluZm98bnVsbDtcbiAgZ3JpZE9wdGlvbnM6IEdyaWRPcHRpb25zO1xuICB6b29tT3B0aW9uczogWm9vbU9wdGlvbnM7XG4gIHRvb2xib3hQb3NpdGlvbjogdG9vbGJveC5Qb3NpdGlvbjtcbiAgdGhlbWU6IFRoZW1lO1xuICByZW5kZXJlcjogc3RyaW5nO1xuICByZW5kZXJlck92ZXJyaWRlczoge1tyZW5kZXJlckNvbnN0YW50OiBzdHJpbmddOiBhbnl9fG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBTVkcgZWxlbWVudCBmb3IgdGhlIGdyaWQgcGF0dGVybi5cbiAgICogQ3JlYXRlZCBkdXJpbmcgaW5qZWN0aW9uLlxuICAgKi9cbiAgZ3JpZFBhdHRlcm46IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG4gIHBhcmVudFdvcmtzcGFjZTogV29ya3NwYWNlU3ZnfG51bGw7XG4gIHBsdWdpbnM6IHtba2V5OiBzdHJpbmddOiAobmV3KC4uLnAxOiBhbnlbXSkgPT4gYW55KXxzdHJpbmd9O1xuXG4gIC8qKlxuICAgKiBJZiBzZXQsIHNldHMgdGhlIHRyYW5zbGF0aW9uIG9mIHRoZSB3b3Jrc3BhY2UgdG8gbWF0Y2ggdGhlIHNjcm9sbGJhcnMuXG4gICAqIEEgZnVuY3Rpb24gdGhhdFxuICAgKiAgICAgc2V0cyB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIHdvcmtzcGFjZSB0byBtYXRjaCB0aGUgc2Nyb2xsYmFycy4gVGhlXG4gICAqICAgICBhcmd1bWVudCBDb250YWlucyBhbiB4IGFuZC9vciB5IHByb3BlcnR5IHdoaWNoIGlzIGEgZmxvYXQgYmV0d2VlbiAwXG4gICAqICAgICBhbmQgMSBzcGVjaWZ5aW5nIHRoZSBkZWdyZWUgb2Ygc2Nyb2xsaW5nLlxuICAgKi9cbiAgc2V0TWV0cmljcz86ICgocDE6IHt4PzogbnVtYmVyLCB5PzogbnVtYmVyfSkgPT4gdm9pZCkgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgbWV0cmljc1xuICAgKiAgICAgb2JqZWN0IHRoYXQgZGVzY3JpYmVzIHRoZSBjdXJyZW50IHdvcmtzcGFjZS5cbiAgICovXG4gIGdldE1ldHJpY3M/OiAoKCkgPT4gTWV0cmljcykgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRpb25zIERpY3Rpb25hcnkgb2Ygb3B0aW9ucy5cbiAgICogICAgIFNwZWNpZmljYXRpb246XG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2dldC1zdGFydGVkL3dlYiNjb25maWd1cmF0aW9uXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBCbG9ja2x5T3B0aW9ucykge1xuICAgIGxldCB0b29sYm94SnNvbkRlZiA9IG51bGw7XG4gICAgbGV0IGhhc0NhdGVnb3JpZXMgPSBmYWxzZTtcbiAgICBsZXQgaGFzVHJhc2hjYW4gPSBmYWxzZTtcbiAgICBsZXQgaGFzQ29sbGFwc2UgPSBmYWxzZTtcbiAgICBsZXQgaGFzQ29tbWVudHMgPSBmYWxzZTtcbiAgICBsZXQgaGFzRGlzYWJsZSA9IGZhbHNlO1xuICAgIGxldCBoYXNTb3VuZHMgPSBmYWxzZTtcbiAgICBjb25zdCByZWFkT25seSA9ICEhb3B0aW9uc1sncmVhZE9ubHknXTtcbiAgICBpZiAoIXJlYWRPbmx5KSB7XG4gICAgICB0b29sYm94SnNvbkRlZiA9XG4gICAgICAgICAgdG9vbGJveC5jb252ZXJ0VG9vbGJveERlZlRvSnNvbihvcHRpb25zWyd0b29sYm94J10gPz8gbnVsbCk7XG4gICAgICBoYXNDYXRlZ29yaWVzID0gdG9vbGJveC5oYXNDYXRlZ29yaWVzKHRvb2xib3hKc29uRGVmKTtcbiAgICAgIGNvbnN0IHJhd0hhc1RyYXNoY2FuID0gb3B0aW9uc1sndHJhc2hjYW4nXTtcbiAgICAgIGhhc1RyYXNoY2FuID1cbiAgICAgICAgICByYXdIYXNUcmFzaGNhbiA9PT0gdW5kZWZpbmVkID8gaGFzQ2F0ZWdvcmllcyA6IHJhd0hhc1RyYXNoY2FuO1xuICAgICAgY29uc3QgcmF3SGFzQ29sbGFwc2UgPSBvcHRpb25zWydjb2xsYXBzZSddO1xuICAgICAgaGFzQ29sbGFwc2UgPVxuICAgICAgICAgIHJhd0hhc0NvbGxhcHNlID09PSB1bmRlZmluZWQgPyBoYXNDYXRlZ29yaWVzIDogcmF3SGFzQ29sbGFwc2U7XG4gICAgICBjb25zdCByYXdIYXNDb21tZW50cyA9IG9wdGlvbnNbJ2NvbW1lbnRzJ107XG4gICAgICBoYXNDb21tZW50cyA9XG4gICAgICAgICAgcmF3SGFzQ29tbWVudHMgPT09IHVuZGVmaW5lZCA/IGhhc0NhdGVnb3JpZXMgOiByYXdIYXNDb21tZW50cztcbiAgICAgIGNvbnN0IHJhd0hhc0Rpc2FibGUgPSBvcHRpb25zWydkaXNhYmxlJ107XG4gICAgICBoYXNEaXNhYmxlID0gcmF3SGFzRGlzYWJsZSA9PT0gdW5kZWZpbmVkID8gaGFzQ2F0ZWdvcmllcyA6IHJhd0hhc0Rpc2FibGU7XG4gICAgICBjb25zdCByYXdIYXNTb3VuZHMgPSBvcHRpb25zWydzb3VuZHMnXTtcbiAgICAgIGhhc1NvdW5kcyA9IHJhd0hhc1NvdW5kcyA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IHJhd0hhc1NvdW5kcztcbiAgICB9XG5cbiAgICBsZXQgbWF4VHJhc2hjYW5Db250ZW50cyA9IG9wdGlvbnNbJ21heFRyYXNoY2FuQ29udGVudHMnXTtcbiAgICBpZiAoaGFzVHJhc2hjYW4pIHtcbiAgICAgIGlmIChtYXhUcmFzaGNhbkNvbnRlbnRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgbWF4VHJhc2hjYW5Db250ZW50cyA9IDMyO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBtYXhUcmFzaGNhbkNvbnRlbnRzID0gMDtcbiAgICB9XG4gICAgY29uc3QgcnRsID0gISFvcHRpb25zWydydGwnXTtcbiAgICBsZXQgaG9yaXpvbnRhbExheW91dCA9IG9wdGlvbnNbJ2hvcml6b250YWxMYXlvdXQnXTtcbiAgICBpZiAoaG9yaXpvbnRhbExheW91dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBob3Jpem9udGFsTGF5b3V0ID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHRvb2xib3hBdFN0YXJ0ID0gb3B0aW9uc1sndG9vbGJveFBvc2l0aW9uJ10gIT09ICdlbmQnO1xuXG4gICAgbGV0IHRvb2xib3hQb3NpdGlvbjogdG9vbGJveC5Qb3NpdGlvbjtcbiAgICBpZiAoaG9yaXpvbnRhbExheW91dCkge1xuICAgICAgdG9vbGJveFBvc2l0aW9uID1cbiAgICAgICAgICB0b29sYm94QXRTdGFydCA/IHRvb2xib3guUG9zaXRpb24uVE9QIDogdG9vbGJveC5Qb3NpdGlvbi5CT1RUT007XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvb2xib3hQb3NpdGlvbiA9IHRvb2xib3hBdFN0YXJ0ID09PSBydGwgPyB0b29sYm94LlBvc2l0aW9uLlJJR0hUIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYm94LlBvc2l0aW9uLkxFRlQ7XG4gICAgfVxuXG4gICAgbGV0IGhhc0NzcyA9IG9wdGlvbnNbJ2NzcyddO1xuICAgIGlmIChoYXNDc3MgPT09IHVuZGVmaW5lZCkge1xuICAgICAgaGFzQ3NzID0gdHJ1ZTtcbiAgICB9XG4gICAgbGV0IHBhdGhUb01lZGlhID0gJ2h0dHBzOi8vYmxvY2tseS1kZW1vLmFwcHNwb3QuY29tL3N0YXRpYy9tZWRpYS8nO1xuICAgIGlmIChvcHRpb25zWydtZWRpYSddKSB7XG4gICAgICBwYXRoVG9NZWRpYSA9IG9wdGlvbnNbJ21lZGlhJ10uZW5kc1dpdGgoJy8nKSA/IG9wdGlvbnNbJ21lZGlhJ10gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zWydtZWRpYSddICsgJy8nO1xuICAgIH0gZWxzZSBpZiAoJ3BhdGgnIGluIG9wdGlvbnMpIHtcbiAgICAgIC8vICdwYXRoJyBpcyBhIGRlcHJlY2F0ZWQgb3B0aW9uIHdoaWNoIGhhcyBiZWVuIHJlcGxhY2VkIGJ5ICdtZWRpYScuXG4gICAgICBkZXByZWNhdGlvbi53YXJuKCdwYXRoJywgJ05vdiAyMDE0JywgJ0p1bCAyMDIzJywgJ21lZGlhJyk7XG4gICAgICBwYXRoVG9NZWRpYSA9IChvcHRpb25zIGFzIGFueSlbJ3BhdGgnXSArICdtZWRpYS8nO1xuICAgIH1cbiAgICBjb25zdCByYXdPbmVCYXNlZEluZGV4ID0gb3B0aW9uc1snb25lQmFzZWRJbmRleCddO1xuICAgIGNvbnN0IG9uZUJhc2VkSW5kZXggPVxuICAgICAgICByYXdPbmVCYXNlZEluZGV4ID09PSB1bmRlZmluZWQgPyB0cnVlIDogcmF3T25lQmFzZWRJbmRleDtcbiAgICBjb25zdCByZW5kZXJlciA9IG9wdGlvbnNbJ3JlbmRlcmVyJ10gfHwgJ2dlcmFzJztcblxuICAgIGNvbnN0IHBsdWdpbnMgPSBvcHRpb25zWydwbHVnaW5zJ10gfHwge307XG5cbiAgICBsZXQgbW9kYWxJbnB1dHMgPSBvcHRpb25zWydtb2RhbElucHV0cyddO1xuICAgIGlmIChtb2RhbElucHV0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBtb2RhbElucHV0cyA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5SVEwgPSBydGw7XG4gICAgdGhpcy5vbmVCYXNlZEluZGV4ID0gb25lQmFzZWRJbmRleDtcbiAgICB0aGlzLmNvbGxhcHNlID0gaGFzQ29sbGFwc2U7XG4gICAgdGhpcy5jb21tZW50cyA9IGhhc0NvbW1lbnRzO1xuICAgIHRoaXMuZGlzYWJsZSA9IGhhc0Rpc2FibGU7XG4gICAgdGhpcy5yZWFkT25seSA9IHJlYWRPbmx5O1xuICAgIHRoaXMubWF4QmxvY2tzID0gb3B0aW9uc1snbWF4QmxvY2tzJ10gfHwgSW5maW5pdHk7XG4gICAgdGhpcy5tYXhJbnN0YW5jZXMgPSBvcHRpb25zWydtYXhJbnN0YW5jZXMnXSA/PyBudWxsO1xuICAgIHRoaXMubW9kYWxJbnB1dHMgPSBtb2RhbElucHV0cztcbiAgICB0aGlzLnBhdGhUb01lZGlhID0gcGF0aFRvTWVkaWE7XG4gICAgdGhpcy5oYXNDYXRlZ29yaWVzID0gaGFzQ2F0ZWdvcmllcztcbiAgICB0aGlzLm1vdmVPcHRpb25zID0gT3B0aW9ucy5wYXJzZU1vdmVPcHRpb25zXyhvcHRpb25zLCBoYXNDYXRlZ29yaWVzKTtcbiAgICAvKiogQGRlcHJlY2F0ZWQgIEphbnVhcnkgMjAxOSAqL1xuICAgIHRoaXMuaGFzU2Nyb2xsYmFycyA9ICEhdGhpcy5tb3ZlT3B0aW9ucy5zY3JvbGxiYXJzO1xuICAgIHRoaXMuaGFzVHJhc2hjYW4gPSBoYXNUcmFzaGNhbjtcbiAgICB0aGlzLm1heFRyYXNoY2FuQ29udGVudHMgPSBtYXhUcmFzaGNhbkNvbnRlbnRzO1xuICAgIHRoaXMuaGFzU291bmRzID0gaGFzU291bmRzO1xuICAgIHRoaXMuaGFzQ3NzID0gaGFzQ3NzO1xuICAgIHRoaXMuaG9yaXpvbnRhbExheW91dCA9IGhvcml6b250YWxMYXlvdXQ7XG4gICAgdGhpcy5sYW5ndWFnZVRyZWUgPSB0b29sYm94SnNvbkRlZjtcbiAgICB0aGlzLmdyaWRPcHRpb25zID0gT3B0aW9ucy5wYXJzZUdyaWRPcHRpb25zXyhvcHRpb25zKTtcbiAgICB0aGlzLnpvb21PcHRpb25zID0gT3B0aW9ucy5wYXJzZVpvb21PcHRpb25zXyhvcHRpb25zKTtcbiAgICB0aGlzLnRvb2xib3hQb3NpdGlvbiA9IHRvb2xib3hQb3NpdGlvbjtcbiAgICB0aGlzLnRoZW1lID0gT3B0aW9ucy5wYXJzZVRoZW1lT3B0aW9uc18ob3B0aW9ucyk7XG4gICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMucmVuZGVyZXJPdmVycmlkZXMgPSBvcHRpb25zWydyZW5kZXJlck92ZXJyaWRlcyddID8/IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcGFyZW50IG9mIHRoZSBjdXJyZW50IHdvcmtzcGFjZSwgb3IgbnVsbCBpZiB0aGVyZSBpcyBubyBwYXJlbnRcbiAgICAgKiB3b3Jrc3BhY2UuICBXZSBjYW4gYXNzZXJ0IHRoYXQgdGhpcyBpcyBvZiB0eXBlIFdvcmtzcGFjZVN2ZyBhcyBvcHBvc2VkIHRvXG4gICAgICogV29ya3NwYWNlIGFzIHRoaXMgaXMgb25seSB1c2VkIGluIGEgcmVuZGVyZWQgd29ya3NwYWNlLlxuICAgICAqL1xuICAgIHRoaXMucGFyZW50V29ya3NwYWNlID0gb3B0aW9uc1sncGFyZW50V29ya3NwYWNlJ10gPz8gbnVsbDtcblxuICAgIC8qKiBNYXAgb2YgcGx1Z2luIHR5cGUgdG8gbmFtZSBvZiByZWdpc3RlcmVkIHBsdWdpbiBvciBwbHVnaW4gY2xhc3MuICovXG4gICAgdGhpcy5wbHVnaW5zID0gcGx1Z2lucztcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgdXNlci1zcGVjaWZpZWQgbW92ZSBvcHRpb25zLCB1c2luZyByZWFzb25hYmxlIGRlZmF1bHRzIHdoZXJlXG4gICAqICAgIGJlaGF2aW91ciBpcyB1bnNwZWNpZmllZC5cbiAgICpcbiAgICogQHBhcmFtIG9wdGlvbnMgRGljdGlvbmFyeSBvZiBvcHRpb25zLlxuICAgKiBAcGFyYW0gaGFzQ2F0ZWdvcmllcyBXaGV0aGVyIHRoZSB3b3Jrc3BhY2UgaGFzIGNhdGVnb3JpZXMgb3Igbm90LlxuICAgKiBAcmV0dXJucyBOb3JtYWxpemVkIG1vdmUgb3B0aW9ucy5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIHBhcnNlTW92ZU9wdGlvbnNfKFxuICAgICAgb3B0aW9uczogQmxvY2tseU9wdGlvbnMsIGhhc0NhdGVnb3JpZXM6IGJvb2xlYW4pOiBNb3ZlT3B0aW9ucyB7XG4gICAgY29uc3QgbW92ZSA9IG9wdGlvbnNbJ21vdmUnXSB8fCB7fTtcbiAgICBjb25zdCBtb3ZlT3B0aW9ucyA9IHt9IGFzIE1vdmVPcHRpb25zO1xuICAgIGlmIChtb3ZlWydzY3JvbGxiYXJzJ10gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBvcHRpb25zWydzY3JvbGxiYXJzJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgbW92ZU9wdGlvbnMuc2Nyb2xsYmFycyA9IGhhc0NhdGVnb3JpZXM7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW92ZVsnc2Nyb2xsYmFycyddID09PSAnb2JqZWN0Jykge1xuICAgICAgbW92ZU9wdGlvbnMuc2Nyb2xsYmFycyA9IHtcbiAgICAgICAgJ2hvcml6b250YWwnOiAhIW1vdmVbJ3Njcm9sbGJhcnMnXVsnaG9yaXpvbnRhbCddLFxuICAgICAgICAndmVydGljYWwnOiAhIW1vdmVbJ3Njcm9sbGJhcnMnXVsndmVydGljYWwnXSxcbiAgICAgIH07XG4gICAgICAvLyBDb252ZXJ0IHNjcm9sbGJhcnMgb2JqZWN0IHRvIGJvb2xlYW4gaWYgdGhleSBoYXZlIHRoZSBzYW1lIHZhbHVlLlxuICAgICAgLy8gVGhpcyBhbGxvd3MgdXMgdG8gZWFzaWx5IGNoZWNrIGZvciB3aGV0aGVyIGFueSBzY3JvbGxiYXJzIGV4aXN0IHVzaW5nXG4gICAgICAvLyAhIW1vdmVPcHRpb25zLnNjcm9sbGJhcnMuXG4gICAgICBpZiAobW92ZU9wdGlvbnMuc2Nyb2xsYmFycy5ob3Jpem9udGFsICYmXG4gICAgICAgICAgbW92ZU9wdGlvbnMuc2Nyb2xsYmFycy52ZXJ0aWNhbCkge1xuICAgICAgICBtb3ZlT3B0aW9ucy5zY3JvbGxiYXJzID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgIW1vdmVPcHRpb25zLnNjcm9sbGJhcnMuaG9yaXpvbnRhbCAmJlxuICAgICAgICAgICFtb3ZlT3B0aW9ucy5zY3JvbGxiYXJzLnZlcnRpY2FsKSB7XG4gICAgICAgIG1vdmVPcHRpb25zLnNjcm9sbGJhcnMgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbW92ZU9wdGlvbnMuc2Nyb2xsYmFycyA9ICEhbW92ZVsnc2Nyb2xsYmFycyddIHx8ICEhb3B0aW9uc1snc2Nyb2xsYmFycyddO1xuICAgIH1cblxuICAgIGlmICghbW92ZU9wdGlvbnMuc2Nyb2xsYmFycyB8fCBtb3ZlWyd3aGVlbCddID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIERlZmF1bHRzIHRvIHRydWUgaWYgc2luZ2xlLWRpcmVjdGlvbiBzY3JvbGwgaXMgZW5hYmxlZC5cbiAgICAgIG1vdmVPcHRpb25zLndoZWVsID0gdHlwZW9mIG1vdmVPcHRpb25zLnNjcm9sbGJhcnMgPT09ICdvYmplY3QnO1xuICAgIH0gZWxzZSB7XG4gICAgICBtb3ZlT3B0aW9ucy53aGVlbCA9ICEhbW92ZVsnd2hlZWwnXTtcbiAgICB9XG4gICAgaWYgKCFtb3ZlT3B0aW9ucy5zY3JvbGxiYXJzKSB7XG4gICAgICBtb3ZlT3B0aW9ucy5kcmFnID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChtb3ZlWydkcmFnJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gRGVmYXVsdHMgdG8gdHJ1ZSBpZiBzY3JvbGxiYXJzIGlzIHRydWUuXG4gICAgICBtb3ZlT3B0aW9ucy5kcmFnID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbW92ZU9wdGlvbnMuZHJhZyA9ICEhbW92ZVsnZHJhZyddO1xuICAgIH1cbiAgICByZXR1cm4gbW92ZU9wdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2UgdGhlIHVzZXItc3BlY2lmaWVkIHpvb20gb3B0aW9ucywgdXNpbmcgcmVhc29uYWJsZSBkZWZhdWx0cyB3aGVyZVxuICAgKiBiZWhhdmlvdXIgaXMgdW5zcGVjaWZpZWQuICBTZWUgem9vbSBkb2N1bWVudGF0aW9uOlxuICAgKiAgIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NvbmZpZ3VyZS93ZWIvem9vbVxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBEaWN0aW9uYXJ5IG9mIG9wdGlvbnMuXG4gICAqIEByZXR1cm5zIE5vcm1hbGl6ZWQgem9vbSBvcHRpb25zLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgcGFyc2Vab29tT3B0aW9uc18ob3B0aW9uczogQmxvY2tseU9wdGlvbnMpOiBab29tT3B0aW9ucyB7XG4gICAgY29uc3Qgem9vbSA9IG9wdGlvbnNbJ3pvb20nXSB8fCB7fTtcbiAgICBjb25zdCB6b29tT3B0aW9ucyA9IHt9IGFzIFpvb21PcHRpb25zO1xuICAgIGlmICh6b29tWydjb250cm9scyddID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHpvb21PcHRpb25zLmNvbnRyb2xzID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHpvb21PcHRpb25zLmNvbnRyb2xzID0gISF6b29tWydjb250cm9scyddO1xuICAgIH1cbiAgICBpZiAoem9vbVsnd2hlZWwnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB6b29tT3B0aW9ucy53aGVlbCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB6b29tT3B0aW9ucy53aGVlbCA9ICEhem9vbVsnd2hlZWwnXTtcbiAgICB9XG4gICAgaWYgKHpvb21bJ3N0YXJ0U2NhbGUnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB6b29tT3B0aW9ucy5zdGFydFNjYWxlID0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgem9vbU9wdGlvbnMuc3RhcnRTY2FsZSA9IE51bWJlcih6b29tWydzdGFydFNjYWxlJ10pO1xuICAgIH1cbiAgICBpZiAoem9vbVsnbWF4U2NhbGUnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB6b29tT3B0aW9ucy5tYXhTY2FsZSA9IDM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHpvb21PcHRpb25zLm1heFNjYWxlID0gTnVtYmVyKHpvb21bJ21heFNjYWxlJ10pO1xuICAgIH1cbiAgICBpZiAoem9vbVsnbWluU2NhbGUnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB6b29tT3B0aW9ucy5taW5TY2FsZSA9IDAuMztcbiAgICB9IGVsc2Uge1xuICAgICAgem9vbU9wdGlvbnMubWluU2NhbGUgPSBOdW1iZXIoem9vbVsnbWluU2NhbGUnXSk7XG4gICAgfVxuICAgIGlmICh6b29tWydzY2FsZVNwZWVkJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgem9vbU9wdGlvbnMuc2NhbGVTcGVlZCA9IDEuMjtcbiAgICB9IGVsc2Uge1xuICAgICAgem9vbU9wdGlvbnMuc2NhbGVTcGVlZCA9IE51bWJlcih6b29tWydzY2FsZVNwZWVkJ10pO1xuICAgIH1cbiAgICBpZiAoem9vbVsncGluY2gnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB6b29tT3B0aW9ucy5waW5jaCA9IHpvb21PcHRpb25zLndoZWVsIHx8IHpvb21PcHRpb25zLmNvbnRyb2xzO1xuICAgIH0gZWxzZSB7XG4gICAgICB6b29tT3B0aW9ucy5waW5jaCA9ICEhem9vbVsncGluY2gnXTtcbiAgICB9XG4gICAgcmV0dXJuIHpvb21PcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHRoZSB1c2VyLXNwZWNpZmllZCBncmlkIG9wdGlvbnMsIHVzaW5nIHJlYXNvbmFibGUgZGVmYXVsdHMgd2hlcmVcbiAgICogYmVoYXZpb3VyIGlzIHVuc3BlY2lmaWVkLiBTZWUgZ3JpZCBkb2N1bWVudGF0aW9uOlxuICAgKiAgIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NvbmZpZ3VyZS93ZWIvZ3JpZFxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBEaWN0aW9uYXJ5IG9mIG9wdGlvbnMuXG4gICAqIEByZXR1cm5zIE5vcm1hbGl6ZWQgZ3JpZCBvcHRpb25zLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgcGFyc2VHcmlkT3B0aW9uc18ob3B0aW9uczogQmxvY2tseU9wdGlvbnMpOiBHcmlkT3B0aW9ucyB7XG4gICAgY29uc3QgZ3JpZCA9IG9wdGlvbnNbJ2dyaWQnXSB8fCB7fTtcbiAgICBjb25zdCBncmlkT3B0aW9ucyA9IHt9IGFzIEdyaWRPcHRpb25zO1xuICAgIGdyaWRPcHRpb25zLnNwYWNpbmcgPSBOdW1iZXIoZ3JpZFsnc3BhY2luZyddKSB8fCAwO1xuICAgIGdyaWRPcHRpb25zLmNvbG91ciA9IGdyaWRbJ2NvbG91ciddIHx8ICcjODg4JztcbiAgICBncmlkT3B0aW9ucy5sZW5ndGggPVxuICAgICAgICBncmlkWydsZW5ndGgnXSA9PT0gdW5kZWZpbmVkID8gMSA6IE51bWJlcihncmlkWydsZW5ndGgnXSk7XG4gICAgZ3JpZE9wdGlvbnMuc25hcCA9IGdyaWRPcHRpb25zLnNwYWNpbmcgPiAwICYmICEhZ3JpZFsnc25hcCddO1xuICAgIHJldHVybiBncmlkT3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgdXNlci1zcGVjaWZpZWQgdGhlbWUgb3B0aW9ucywgdXNpbmcgdGhlIGNsYXNzaWMgdGhlbWUgYXMgYVxuICAgKiBkZWZhdWx0LiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jb25maWd1cmUvd2ViL3RoZW1lc1xuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBEaWN0aW9uYXJ5IG9mIG9wdGlvbnMuXG4gICAqIEByZXR1cm5zIEEgQmxvY2tseSBUaGVtZS5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIHBhcnNlVGhlbWVPcHRpb25zXyhvcHRpb25zOiBCbG9ja2x5T3B0aW9ucyk6IFRoZW1lIHtcbiAgICBjb25zdCB0aGVtZSA9IG9wdGlvbnNbJ3RoZW1lJ10gfHwgQ2xhc3NpYztcbiAgICBpZiAodHlwZW9mIHRoZW1lID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIHJlZ2lzdHJ5LmdldE9iamVjdChyZWdpc3RyeS5UeXBlLlRIRU1FLCB0aGVtZSkgYXMgVGhlbWU7XG4gICAgfSBlbHNlIGlmICh0aGVtZSBpbnN0YW5jZW9mIFRoZW1lKSB7XG4gICAgICByZXR1cm4gdGhlbWU7XG4gICAgfVxuICAgIHJldHVybiBUaGVtZS5kZWZpbmVUaGVtZShcbiAgICAgICAgdGhlbWUubmFtZSB8fCAnYnVpbHRpbicgKyBpZEdlbmVyYXRvci5nZXROZXh0VW5pcXVlSWQoKSwgdGhlbWUpO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgT3B0aW9ucyB7XG4gIGV4cG9ydCBpbnRlcmZhY2UgR3JpZE9wdGlvbnMge1xuICAgIGNvbG91cjogc3RyaW5nO1xuICAgIGxlbmd0aDogbnVtYmVyO1xuICAgIHNuYXA6IGJvb2xlYW47XG4gICAgc3BhY2luZzogbnVtYmVyO1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBNb3ZlT3B0aW9ucyB7XG4gICAgZHJhZzogYm9vbGVhbjtcbiAgICBzY3JvbGxiYXJzOiBib29sZWFufFNjcm9sbGJhck9wdGlvbnM7XG4gICAgd2hlZWw6IGJvb2xlYW47XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIFNjcm9sbGJhck9wdGlvbnMge1xuICAgIGhvcml6b250YWw6IGJvb2xlYW47XG4gICAgdmVydGljYWw6IGJvb2xlYW47XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIFpvb21PcHRpb25zIHtcbiAgICBjb250cm9sczogYm9vbGVhbjtcbiAgICBtYXhTY2FsZTogbnVtYmVyO1xuICAgIG1pblNjYWxlOiBudW1iZXI7XG4gICAgcGluY2g6IGJvb2xlYW47XG4gICAgc2NhbGVTcGVlZDogbnVtYmVyO1xuICAgIHN0YXJ0U2NhbGU6IG51bWJlcjtcbiAgICB3aGVlbDogYm9vbGVhbjtcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBHcmlkT3B0aW9ucyA9IE9wdGlvbnMuR3JpZE9wdGlvbnM7XG5leHBvcnQgdHlwZSBNb3ZlT3B0aW9ucyA9IE9wdGlvbnMuTW92ZU9wdGlvbnM7XG5leHBvcnQgdHlwZSBTY3JvbGxiYXJPcHRpb25zID0gT3B0aW9ucy5TY3JvbGxiYXJPcHRpb25zO1xuZXhwb3J0IHR5cGUgWm9vbU9wdGlvbnMgPSBPcHRpb25zLlpvb21PcHRpb25zO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSBtdXRhdG9yIGRpYWxvZy4gIEEgbXV0YXRvciBhbGxvd3MgdGhlXG4gKiB1c2VyIHRvIGNoYW5nZSB0aGUgc2hhcGUgb2YgYSBibG9jayB1c2luZyBhIG5lc3RlZCBibG9ja3MgZWRpdG9yLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5Lk11dGF0b3InKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfYnViYmxlX29wZW4uanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tseU9wdGlvbnN9IGZyb20gJy4vYmxvY2tseV9vcHRpb25zLmpzJztcbmltcG9ydCB7QnViYmxlfSBmcm9tICcuL2J1YmJsZS5qcyc7XG5pbXBvcnQge2NvbmZpZ30gZnJvbSAnLi9jb25maWcuanMnO1xuaW1wb3J0IHR5cGUge0Nvbm5lY3Rpb259IGZyb20gJy4vY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7QWJzdHJhY3R9IGZyb20gJy4vZXZlbnRzL2V2ZW50c19hYnN0cmFjdC5qcyc7XG5pbXBvcnQge0Jsb2NrQ2hhbmdlfSBmcm9tICcuL2V2ZW50cy9ldmVudHNfYmxvY2tfY2hhbmdlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHtJY29ufSBmcm9tICcuL2ljb24uanMnO1xuaW1wb3J0IHtPcHRpb25zfSBmcm9tICcuL29wdGlvbnMuanMnO1xuaW1wb3J0IHR5cGUge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcbmltcG9ydCAqIGFzIHRvb2xib3ggZnJvbSAnLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCAqIGFzIHhtbCBmcm9tICcuL3V0aWxzL3htbC5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBtdXRhdG9yIGRpYWxvZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5NdXRhdG9yXG4gKi9cbmV4cG9ydCBjbGFzcyBNdXRhdG9yIGV4dGVuZHMgSWNvbiB7XG4gIHByaXZhdGUgcXVhcmtOYW1lczogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIFdvcmtzcGFjZSBpbiB0aGUgbXV0YXRvcidzIGJ1YmJsZS5cbiAgICogRHVlIHRvIGxlZ2FjeSBjb2RlIGluIHByb2NlZHVyZSBibG9jayBkZWZpbml0aW9ucywgdGhpcyBuYW1lXG4gICAqIGNhbm5vdCBjaGFuZ2UuXG4gICAqL1xuICBwcml2YXRlIHdvcmtzcGFjZV86IFdvcmtzcGFjZVN2Z3xudWxsID0gbnVsbDtcblxuICAvKiogV2lkdGggb2Ygd29ya3NwYWNlLiAqL1xuICBwcml2YXRlIHdvcmtzcGFjZVdpZHRoID0gMDtcblxuICAvKiogSGVpZ2h0IG9mIHdvcmtzcGFjZS4gKi9cbiAgcHJpdmF0ZSB3b3Jrc3BhY2VIZWlnaHQgPSAwO1xuXG4gIC8qKlxuICAgKiBUaGUgU1ZHIGVsZW1lbnQgdGhhdCBpcyB0aGUgcGFyZW50IG9mIHRoZSBtdXRhdG9yIHdvcmtzcGFjZSwgb3IgbnVsbCBpZlxuICAgKiBub3QgY3JlYXRlZC5cbiAgICovXG4gIHByaXZhdGUgc3ZnRGlhbG9nOiBTVkdTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgcm9vdCBibG9jayBvZiB0aGUgbXV0YXRvciB3b3Jrc3BhY2UsIGNyZWF0ZWQgYnkgZGVjb21wb3NpbmcgdGhlXG4gICAqIHNvdXJjZSBibG9jay5cbiAgICovXG4gIHByaXZhdGUgcm9vdEJsb2NrOiBCbG9ja1N2Z3xudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogRnVuY3Rpb24gcmVnaXN0ZXJlZCBvbiB0aGUgbWFpbiB3b3Jrc3BhY2UgdG8gdXBkYXRlIHRoZSBtdXRhdG9yIGNvbnRlbnRzXG4gICAqIHdoZW4gdGhlIG1haW4gd29ya3NwYWNlIGNoYW5nZXMuXG4gICAqL1xuICBwcml2YXRlIHNvdXJjZUxpc3RlbmVyOiBGdW5jdGlvbnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIFBJRCBhc3NvY2lhdGVkIHdpdGggdGhlIHVwZGF0ZVdvcmtwYWNlXyB0aW1lb3V0LCBvciBudWxsIGlmIG5vIHRpbWVvdXRcbiAgICogaXMgY3VycmVudGx5IHJ1bm5pbmcuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZVdvcmtzcGFjZVBpZDogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD58bnVsbCA9IG51bGw7XG5cbiAgLyoqIEBwYXJhbSBxdWFya05hbWVzIExpc3Qgb2YgbmFtZXMgb2Ygc3ViLWJsb2NrcyBmb3IgZmx5b3V0LiAqL1xuICBjb25zdHJ1Y3RvcihxdWFya05hbWVzOiBzdHJpbmdbXSwgYmxvY2s/OiBCbG9ja1N2Zykge1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0NhbGxpbmcgdGhlIE11dGF0b3IgY29uc3RydWN0b3Igd2l0aG91dCBwYXNzaW5nIHRoZSBibG9jayBpdCBpcyBhdHRhY2hlZCB0bycsXG4gICAgICAgICAgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJyxcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yIGJ5IHBhc3NpbmcgdGhlIGxpc3Qgb2Ygc3ViYmxvY2tzIGFuZCB0aGUgYmxvY2sgaW5zdGFuY2UgdG8gYXR0YWNoIHRoZSBtdXRhdG9yIHRvJyk7XG4gICAgfVxuICAgIHN1cGVyKGJsb2NrID8/IG51bGwpO1xuICAgIHRoaXMucXVhcmtOYW1lcyA9IHF1YXJrTmFtZXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBibG9jayB0aGlzIG11dGF0b3IgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIGFzc29jaWF0ZWQgd2l0aCB0aGlzIG11dGF0b3IuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0QmxvY2soYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgdGhpcy5ibG9ja18gPSBibG9jaztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSB3b3Jrc3BhY2UgaW5zaWRlIHRoaXMgbXV0YXRvciBpY29uJ3MgYnViYmxlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgd29ya3NwYWNlIGluc2lkZSB0aGlzIG11dGF0b3IgaWNvbidzIGJ1YmJsZSBvciBudWxsIGlmIHRoZVxuICAgKiAgICAgbXV0YXRvciBpc24ndCBvcGVuLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFdvcmtzcGFjZSgpOiBXb3Jrc3BhY2VTdmd8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMud29ya3NwYWNlXztcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IHRoZSBtdXRhdG9yIGljb24uXG4gICAqXG4gICAqIEBwYXJhbSBncm91cCBUaGUgaWNvbiBncm91cC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBkcmF3SWNvbl8oZ3JvdXA6IEVsZW1lbnQpIHtcbiAgICAvLyBTcXVhcmUgd2l0aCByb3VuZGVkIGNvcm5lcnMuXG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlJY29uU2hhcGUnLFxuICAgICAgICAgICdyeCc6ICc0JyxcbiAgICAgICAgICAncnknOiAnNCcsXG4gICAgICAgICAgJ2hlaWdodCc6ICcxNicsXG4gICAgICAgICAgJ3dpZHRoJzogJzE2JyxcbiAgICAgICAgfSxcbiAgICAgICAgZ3JvdXApO1xuICAgIC8vIEdlYXIgdGVldGguXG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5QQVRILCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlJY29uU3ltYm9sJyxcbiAgICAgICAgICAnZCc6ICdtNC4yMDMsNy4yOTYgMCwxLjM2OCAtMC45MiwwLjY3NyAtMC4xMSwwLjQxIDAuOSwxLjU1OSAwLjQxLCcgK1xuICAgICAgICAgICAgICAnMC4xMSAxLjA0MywtMC40NTcgMS4xODcsMC42ODMgMC4xMjcsMS4xMzQgMC4zLDAuMyAxLjgsMCAwLjMsJyArXG4gICAgICAgICAgICAgICctMC4yOTkgMC4xMjcsLTEuMTM4IDEuMTg1LC0wLjY4MiAxLjA0NiwwLjQ1OCAwLjQwOSwtMC4xMSAwLjksJyArXG4gICAgICAgICAgICAgICctMS41NTkgLTAuMTEsLTAuNDEgLTAuOTIsLTAuNjc3IDAsLTEuMzY2IDAuOTIsLTAuNjc3IDAuMTEsJyArXG4gICAgICAgICAgICAgICctMC40MSAtMC45LC0xLjU1OSAtMC40MDksLTAuMTA5IC0xLjA0NiwwLjQ1OCAtMS4xODUsLTAuNjgyICcgK1xuICAgICAgICAgICAgICAnLTAuMTI3LC0xLjEzOCAtMC4zLC0wLjI5OSAtMS44LDAgLTAuMywwLjMgLTAuMTI2LDEuMTM1IC0xLjE4NywnICtcbiAgICAgICAgICAgICAgJzAuNjgyIC0xLjA0MywtMC40NTcgLTAuNDEsMC4xMSAtMC44OTksMS41NTkgMC4xMDgsMC40MDl6JyxcbiAgICAgICAgfSxcbiAgICAgICAgZ3JvdXApO1xuICAgIC8vIEF4bGUgaG9sZS5cbiAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkNJUkNMRSxcbiAgICAgICAgeydjbGFzcyc6ICdibG9ja2x5SWNvblNoYXBlJywgJ3InOiAnMi43JywgJ2N4JzogJzgnLCAnY3knOiAnOCd9LCBncm91cCk7XG4gIH1cblxuICAvKipcbiAgICogQ2xpY2tpbmcgb24gdGhlIGljb24gdG9nZ2xlcyBpZiB0aGUgbXV0YXRvciBidWJibGUgaXMgdmlzaWJsZS5cbiAgICogRGlzYWJsZSBpZiBibG9jayBpcyB1bmVkaXRhYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBNb3VzZSBjbGljayBldmVudC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBpY29uQ2xpY2tfKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGlmICh0aGlzLmdldEJsb2NrKCkuaXNFZGl0YWJsZSgpKSB7XG4gICAgICBzdXBlci5pY29uQ2xpY2tfKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIGVkaXRvciBmb3IgdGhlIG11dGF0b3IncyBidWJibGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0b3AtbGV2ZWwgbm9kZSBvZiB0aGUgZWRpdG9yLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVFZGl0b3IoKTogU1ZHU1ZHRWxlbWVudCB7XG4gICAgLyogQ3JlYXRlIHRoZSBlZGl0b3IuICBIZXJlJ3MgdGhlIG1hcmt1cCB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkOlxuICAgICAgICA8c3ZnPlxuICAgICAgICAgIFtXb3Jrc3BhY2VdXG4gICAgICAgIDwvc3ZnPlxuICAgICAgICAqL1xuICAgIHRoaXMuc3ZnRGlhbG9nID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5TVkcsIHsneCc6IEJ1YmJsZS5CT1JERVJfV0lEVEgsICd5JzogQnViYmxlLkJPUkRFUl9XSURUSH0pO1xuICAgIC8vIENvbnZlcnQgdGhlIGxpc3Qgb2YgbmFtZXMgaW50byBhIGxpc3Qgb2YgWE1MIG9iamVjdHMgZm9yIHRoZSBmbHlvdXQuXG4gICAgbGV0IHF1YXJrWG1sO1xuICAgIGlmICh0aGlzLnF1YXJrTmFtZXMubGVuZ3RoKSB7XG4gICAgICBxdWFya1htbCA9IHhtbC5jcmVhdGVFbGVtZW50KCd4bWwnKTtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBxdWFya05hbWU7IHF1YXJrTmFtZSA9IHRoaXMucXVhcmtOYW1lc1tpXTsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB4bWwuY3JlYXRlRWxlbWVudCgnYmxvY2snKTtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCBxdWFya05hbWUpO1xuICAgICAgICBxdWFya1htbC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcXVhcmtYbWwgPSBudWxsO1xuICAgIH1cbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0QmxvY2soKTtcbiAgICBjb25zdCB3b3Jrc3BhY2VPcHRpb25zID0gbmV3IE9wdGlvbnMoKHtcbiAgICAgIC8vIElmIHlvdSB3YW50IHRvIGVuYWJsZSBkaXNhYmxpbmcsIGFsc28gcmVtb3ZlIHRoZVxuICAgICAgLy8gZXZlbnQgZmlsdGVyIGZyb20gd29ya3NwYWNlQ2hhbmdlZF8gLlxuICAgICAgJ2Rpc2FibGUnOiBmYWxzZSxcbiAgICAgICdwYXJlbnRXb3Jrc3BhY2UnOiBibG9jay53b3Jrc3BhY2UsXG4gICAgICAnbWVkaWEnOiBibG9jay53b3Jrc3BhY2Uub3B0aW9ucy5wYXRoVG9NZWRpYSxcbiAgICAgICdydGwnOiBibG9jay5SVEwsXG4gICAgICAnaG9yaXpvbnRhbExheW91dCc6IGZhbHNlLFxuICAgICAgJ3JlbmRlcmVyJzogYmxvY2sud29ya3NwYWNlLm9wdGlvbnMucmVuZGVyZXIsXG4gICAgICAncmVuZGVyZXJPdmVycmlkZXMnOiBibG9jay53b3Jrc3BhY2Uub3B0aW9ucy5yZW5kZXJlck92ZXJyaWRlcyxcbiAgICB9IGFzIEJsb2NrbHlPcHRpb25zKSk7XG4gICAgd29ya3NwYWNlT3B0aW9ucy50b29sYm94UG9zaXRpb24gPVxuICAgICAgICBibG9jay5SVEwgPyB0b29sYm94LlBvc2l0aW9uLlJJR0hUIDogdG9vbGJveC5Qb3NpdGlvbi5MRUZUO1xuICAgIGNvbnN0IGhhc0ZseW91dCA9ICEhcXVhcmtYbWw7XG4gICAgaWYgKGhhc0ZseW91dCkge1xuICAgICAgd29ya3NwYWNlT3B0aW9ucy5sYW5ndWFnZVRyZWUgPSB0b29sYm94LmNvbnZlcnRUb29sYm94RGVmVG9Kc29uKHF1YXJrWG1sKTtcbiAgICB9XG4gICAgdGhpcy53b3Jrc3BhY2VfID0gdGhpcy5uZXdXb3Jrc3BhY2VTdmcod29ya3NwYWNlT3B0aW9ucyk7XG4gICAgdGhpcy53b3Jrc3BhY2VfLmludGVybmFsSXNNdXRhdG9yID0gdHJ1ZTtcbiAgICB0aGlzLndvcmtzcGFjZV8uYWRkQ2hhbmdlTGlzdGVuZXIoZXZlbnRVdGlscy5kaXNhYmxlT3JwaGFucyk7XG5cbiAgICAvLyBNdXRhdG9yIGZseW91dHMgZ28gaW5zaWRlIHRoZSBtdXRhdG9yIHdvcmtzcGFjZSdzIDxnPiByYXRoZXIgdGhhbiBpblxuICAgIC8vIGEgdG9wIGxldmVsIFNWRy4gSW5zdGVhZCBvZiBoYW5kbGluZyBzY2FsZSB0aGVtc2VsdmVzLCBtdXRhdG9yc1xuICAgIC8vIGluaGVyaXQgc2NhbGUgZnJvbSB0aGUgcGFyZW50IHdvcmtzcGFjZS5cbiAgICAvLyBUbyBmaXggdGhpcywgc2NhbGUgbmVlZHMgdG8gYmUgYXBwbGllZCBhdCBhIGRpZmZlcmVudCBsZXZlbCBpbiB0aGUgRE9NLlxuICAgIGNvbnN0IGZseW91dFN2ZyA9IGhhc0ZseW91dCA/IHRoaXMud29ya3NwYWNlXy5hZGRGbHlvdXQoU3ZnLkcpIDogbnVsbDtcbiAgICBjb25zdCBiYWNrZ3JvdW5kID0gdGhpcy53b3Jrc3BhY2VfLmNyZWF0ZURvbSgnYmxvY2tseU11dGF0b3JCYWNrZ3JvdW5kJyk7XG5cbiAgICBpZiAoZmx5b3V0U3ZnKSB7XG4gICAgICAvLyBJbnNlcnQgdGhlIGZseW91dCBhZnRlciB0aGUgPHJlY3Q+IGJ1dCBiZWZvcmUgdGhlIGJsb2NrIGNhbnZhcyBzbyB0aGF0XG4gICAgICAvLyB0aGUgZmx5b3V0IGlzIHVuZGVybmVhdGggaW4gei1vcmRlci4gIFRoaXMgbWFrZXMgYmxvY2tzIGxheWVyaW5nIGR1cmluZ1xuICAgICAgLy8gZHJhZ2dpbmcgd29yayBwcm9wZXJseS5cbiAgICAgIGJhY2tncm91bmQuaW5zZXJ0QmVmb3JlKGZseW91dFN2ZywgdGhpcy53b3Jrc3BhY2VfLnN2Z0Jsb2NrQ2FudmFzXyk7XG4gICAgfVxuICAgIHRoaXMuc3ZnRGlhbG9nLmFwcGVuZENoaWxkKGJhY2tncm91bmQpO1xuXG4gICAgcmV0dXJuIHRoaXMuc3ZnRGlhbG9nO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICBuZXdXb3Jrc3BhY2VTdmcob3B0aW9uczogT3B0aW9ucyk6IFdvcmtzcGFjZVN2ZyB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnVGhlIGltcGxlbWVudGF0aW9uIG9mIG5ld1dvcmtzcGFjZVN2ZyBzaG91bGQgYmUgJyArXG4gICAgICAgICdtb25rZXktcGF0Y2hlZCBpbiBieSBibG9ja2x5LnRzJyk7XG4gIH1cblxuICAvKiogQWRkIG9yIHJlbW92ZSB0aGUgVUkgaW5kaWNhdGluZyBpZiB0aGlzIGljb24gbWF5IGJlIGNsaWNrZWQgb3Igbm90LiAqL1xuICBvdmVycmlkZSB1cGRhdGVFZGl0YWJsZSgpIHtcbiAgICBzdXBlci51cGRhdGVFZGl0YWJsZSgpO1xuICAgIGlmICghdGhpcy5nZXRCbG9jaygpLmlzSW5GbHlvdXQpIHtcbiAgICAgIGlmICh0aGlzLmdldEJsb2NrKCkuaXNFZGl0YWJsZSgpKSB7XG4gICAgICAgIGlmICh0aGlzLmljb25Hcm91cF8pIHtcbiAgICAgICAgICBkb20ucmVtb3ZlQ2xhc3ModGhpcy5pY29uR3JvdXBfLCAnYmxvY2tseUljb25Hcm91cFJlYWRvbmx5Jyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENsb3NlIGFueSBtdXRhdG9yIGJ1YmJsZS4gIEljb24gaXMgbm90IGNsaWNrYWJsZS5cbiAgICAgICAgdGhpcy5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgaWYgKHRoaXMuaWNvbkdyb3VwXykge1xuICAgICAgICAgIGRvbS5hZGRDbGFzcyh0aGlzLmljb25Hcm91cF8sICdibG9ja2x5SWNvbkdyb3VwUmVhZG9ubHknKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBSZXNpemUgdGhlIGJ1YmJsZSB0byBtYXRjaCB0aGUgc2l6ZSBvZiB0aGUgd29ya3NwYWNlLiAqL1xuICBwcml2YXRlIHJlc2l6ZUJ1YmJsZSgpIHtcbiAgICAvLyBJZiB0aGUgYnViYmxlIGV4aXN0cywgdGhlIHdvcmtzcGFjZSBhbHNvIGV4aXN0cy5cbiAgICBpZiAoIXRoaXMud29ya3NwYWNlXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBkb3VibGVCb3JkZXJXaWR0aCA9IDIgKiBCdWJibGUuQk9SREVSX1dJRFRIO1xuICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMud29ya3NwYWNlXy5nZXRDYW52YXMoKTtcbiAgICBjb25zdCB3b3Jrc3BhY2VTaXplID0gY2FudmFzLmdldEJCb3goKTtcbiAgICBsZXQgd2lkdGggPSB3b3Jrc3BhY2VTaXplLndpZHRoICsgd29ya3NwYWNlU2l6ZS54O1xuICAgIGxldCBoZWlnaHQgPSB3b3Jrc3BhY2VTaXplLmhlaWdodCArIGRvdWJsZUJvcmRlcldpZHRoICogMztcbiAgICBjb25zdCBmbHlvdXQgPSB0aGlzLndvcmtzcGFjZV8uZ2V0Rmx5b3V0KCk7XG4gICAgaWYgKGZseW91dCkge1xuICAgICAgY29uc3QgZmx5b3V0U2Nyb2xsTWV0cmljcyA9XG4gICAgICAgICAgZmx5b3V0LmdldFdvcmtzcGFjZSgpLmdldE1ldHJpY3NNYW5hZ2VyKCkuZ2V0U2Nyb2xsTWV0cmljcygpO1xuICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0LCBmbHlvdXRTY3JvbGxNZXRyaWNzLmhlaWdodCArIDIwKTtcbiAgICAgIHdpZHRoICs9IGZseW91dC5nZXRXaWR0aCgpO1xuICAgIH1cbiAgICBjb25zdCBpc1J0bCA9IHRoaXMuZ2V0QmxvY2soKS5SVEw7XG4gICAgaWYgKGlzUnRsKSB7XG4gICAgICB3aWR0aCA9IC13b3Jrc3BhY2VTaXplLng7XG4gICAgfVxuICAgIHdpZHRoICs9IGRvdWJsZUJvcmRlcldpZHRoICogMztcbiAgICAvLyBPbmx5IHJlc2l6ZSBpZiB0aGUgc2l6ZSBkaWZmZXJlbmNlIGlzIHNpZ25pZmljYW50LiAgRWxpbWluYXRlc1xuICAgIC8vIHNodWRkZXJpbmcuXG4gICAgaWYgKE1hdGguYWJzKHRoaXMud29ya3NwYWNlV2lkdGggLSB3aWR0aCkgPiBkb3VibGVCb3JkZXJXaWR0aCB8fFxuICAgICAgICBNYXRoLmFicyh0aGlzLndvcmtzcGFjZUhlaWdodCAtIGhlaWdodCkgPiBkb3VibGVCb3JkZXJXaWR0aCkge1xuICAgICAgLy8gUmVjb3JkIHNvbWUgbGF5b3V0IGluZm9ybWF0aW9uIGZvciB3b3Jrc3BhY2UgbWV0cmljcy5cbiAgICAgIHRoaXMud29ya3NwYWNlV2lkdGggPSB3aWR0aDtcbiAgICAgIHRoaXMud29ya3NwYWNlSGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgLy8gUmVzaXplIHRoZSBidWJibGUuXG4gICAgICB0aGlzLmJ1YmJsZV8hLnNldEJ1YmJsZVNpemUoXG4gICAgICAgICAgd2lkdGggKyBkb3VibGVCb3JkZXJXaWR0aCwgaGVpZ2h0ICsgZG91YmxlQm9yZGVyV2lkdGgpO1xuICAgICAgdGhpcy5zdmdEaWFsb2chLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBgJHt3aWR0aH1gKTtcbiAgICAgIHRoaXMuc3ZnRGlhbG9nIS5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGAke2hlaWdodH1gKTtcbiAgICAgIHRoaXMud29ya3NwYWNlXy5zZXRDYWNoZWRQYXJlbnRTdmdTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cblxuICAgIGlmIChpc1J0bCkge1xuICAgICAgLy8gU2Nyb2xsIHRoZSB3b3Jrc3BhY2UgdG8gYWx3YXlzIGxlZnQtYWxpZ24uXG4gICAgICBjYW52YXMuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKCR7dGhpcy53b3Jrc3BhY2VXaWR0aH0sIDApYCk7XG4gICAgfVxuICAgIHRoaXMud29ya3NwYWNlXy5yZXNpemUoKTtcbiAgfVxuXG4gIC8qKiBBIG1ldGhvZCBoYW5kbGVyIGZvciB3aGVuIHRoZSBidWJibGUgaXMgbW92ZWQuICovXG4gIHByaXZhdGUgb25CdWJibGVNb3ZlKCkge1xuICAgIGlmICh0aGlzLndvcmtzcGFjZV8pIHtcbiAgICAgIHRoaXMud29ya3NwYWNlXy5yZWNvcmREcmFnVGFyZ2V0cygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IG9yIGhpZGUgdGhlIG11dGF0b3IgYnViYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gdmlzaWJsZSBUcnVlIGlmIHRoZSBidWJibGUgc2hvdWxkIGJlIHZpc2libGUuXG4gICAqL1xuICBvdmVycmlkZSBzZXRWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBpZiAodmlzaWJsZSA9PT0gdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgLy8gTm8gY2hhbmdlLlxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0QmxvY2soKTtcbiAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJVQkJMRV9PUEVOKSkoXG4gICAgICAgIGJsb2NrLCB2aXNpYmxlLCAnbXV0YXRvcicpKTtcbiAgICBpZiAodmlzaWJsZSkge1xuICAgICAgLy8gQ3JlYXRlIHRoZSBidWJibGUuXG4gICAgICB0aGlzLmJ1YmJsZV8gPSBuZXcgQnViYmxlKFxuICAgICAgICAgIGJsb2NrLndvcmtzcGFjZSwgdGhpcy5jcmVhdGVFZGl0b3IoKSwgYmxvY2sucGF0aE9iamVjdC5zdmdQYXRoLFxuICAgICAgICAgICh0aGlzLmljb25YWV8gYXMgQ29vcmRpbmF0ZSksIG51bGwsIG51bGwpO1xuICAgICAgLy8gVGhlIHdvcmtzcGFjZSB3YXMgY3JlYXRlZCBpbiBjcmVhdGVFZGl0b3IuXG4gICAgICBjb25zdCB3cyA9IHRoaXMud29ya3NwYWNlXyE7XG4gICAgICAvLyBFeHBvc2UgdGhpcyBtdXRhdG9yJ3MgYmxvY2sncyBJRCBvbiBpdHMgdG9wLWxldmVsIFNWRyBncm91cC5cbiAgICAgIHRoaXMuYnViYmxlXy5zZXRTdmdJZChibG9jay5pZCk7XG4gICAgICB0aGlzLmJ1YmJsZV8ucmVnaXN0ZXJNb3ZlRXZlbnQodGhpcy5vbkJ1YmJsZU1vdmUuYmluZCh0aGlzKSk7XG4gICAgICBjb25zdCB0cmVlID0gd3Mub3B0aW9ucy5sYW5ndWFnZVRyZWU7XG4gICAgICBjb25zdCBmbHlvdXQgPSB3cy5nZXRGbHlvdXQoKTtcbiAgICAgIGlmICh0cmVlKSB7XG4gICAgICAgIGZseW91dCEuaW5pdCh3cyk7XG4gICAgICAgIGZseW91dCEuc2hvdyh0cmVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yb290QmxvY2sgPSBibG9jay5kZWNvbXBvc2UhKHdzKSE7XG4gICAgICBjb25zdCBibG9ja3MgPSB0aGlzLnJvb3RCbG9jay5nZXREZXNjZW5kYW50cyhmYWxzZSk7XG4gICAgICBmb3IgKGxldCBpID0gMCwgY2hpbGQ7IGNoaWxkID0gYmxvY2tzW2ldOyBpKyspIHtcbiAgICAgICAgY2hpbGQucmVuZGVyKCk7XG4gICAgICB9XG4gICAgICAvLyBUaGUgcm9vdCBibG9jayBzaG91bGQgbm90IGJlIGRyYWdnYWJsZSBvciBkZWxldGFibGUuXG4gICAgICB0aGlzLnJvb3RCbG9jay5zZXRNb3ZhYmxlKGZhbHNlKTtcbiAgICAgIHRoaXMucm9vdEJsb2NrLnNldERlbGV0YWJsZShmYWxzZSk7XG4gICAgICBsZXQgbWFyZ2luO1xuICAgICAgbGV0IHg7XG4gICAgICBpZiAoZmx5b3V0KSB7XG4gICAgICAgIG1hcmdpbiA9IGZseW91dC5DT1JORVJfUkFESVVTICogMjtcbiAgICAgICAgeCA9IHRoaXMucm9vdEJsb2NrLlJUTCA/IGZseW91dC5nZXRXaWR0aCgpICsgbWFyZ2luIDogbWFyZ2luO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWFyZ2luID0gMTY7XG4gICAgICAgIHggPSBtYXJnaW47XG4gICAgICB9XG4gICAgICBpZiAoYmxvY2suUlRMKSB7XG4gICAgICAgIHggPSAteDtcbiAgICAgIH1cbiAgICAgIHRoaXMucm9vdEJsb2NrLm1vdmVCeSh4LCBtYXJnaW4pO1xuICAgICAgLy8gU2F2ZSB0aGUgaW5pdGlhbCBjb25uZWN0aW9ucywgdGhlbiBsaXN0ZW4gZm9yIGZ1cnRoZXIgY2hhbmdlcy5cbiAgICAgIGlmIChibG9jay5zYXZlQ29ubmVjdGlvbnMpIHtcbiAgICAgICAgY29uc3QgdGhpc1Jvb3RCbG9jayA9IHRoaXMucm9vdEJsb2NrO1xuICAgICAgICBibG9jay5zYXZlQ29ubmVjdGlvbnModGhpc1Jvb3RCbG9jayk7XG4gICAgICAgIHRoaXMuc291cmNlTGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY3VycmVudEJsb2NrID0gdGhpcy5nZXRCbG9jaygpO1xuICAgICAgICAgIGlmIChjdXJyZW50QmxvY2suc2F2ZUNvbm5lY3Rpb25zKSB7XG4gICAgICAgICAgICBjdXJyZW50QmxvY2suc2F2ZUNvbm5lY3Rpb25zKHRoaXNSb290QmxvY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgYmxvY2sud29ya3NwYWNlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuc291cmNlTGlzdGVuZXIpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZXNpemVCdWJibGUoKTtcbiAgICAgIC8vIFdoZW4gdGhlIG11dGF0b3IncyB3b3Jrc3BhY2UgY2hhbmdlcywgdXBkYXRlIHRoZSBzb3VyY2UgYmxvY2suXG4gICAgICB3cy5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLndvcmtzcGFjZUNoYW5nZWQuYmluZCh0aGlzKSk7XG4gICAgICAvLyBVcGRhdGUgdGhlIHNvdXJjZSBibG9jayBpbW1lZGlhdGVseSBhZnRlciB0aGUgYnViYmxlIGJlY29tZXMgdmlzaWJsZS5cbiAgICAgIHRoaXMudXBkYXRlV29ya3NwYWNlKCk7XG4gICAgICB0aGlzLmFwcGx5Q29sb3VyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIERpc3Bvc2Ugb2YgdGhlIGJ1YmJsZS5cbiAgICAgIHRoaXMuc3ZnRGlhbG9nID0gbnVsbDtcbiAgICAgIHRoaXMud29ya3NwYWNlXyEuZGlzcG9zZSgpO1xuICAgICAgdGhpcy53b3Jrc3BhY2VfID0gbnVsbDtcbiAgICAgIHRoaXMucm9vdEJsb2NrID0gbnVsbDtcbiAgICAgIHRoaXMuYnViYmxlXz8uZGlzcG9zZSgpO1xuICAgICAgdGhpcy5idWJibGVfID0gbnVsbDtcbiAgICAgIHRoaXMud29ya3NwYWNlV2lkdGggPSAwO1xuICAgICAgdGhpcy53b3Jrc3BhY2VIZWlnaHQgPSAwO1xuICAgICAgaWYgKHRoaXMuc291cmNlTGlzdGVuZXIpIHtcbiAgICAgICAgYmxvY2sud29ya3NwYWNlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuc291cmNlTGlzdGVuZXIpO1xuICAgICAgICB0aGlzLnNvdXJjZUxpc3RlbmVyID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmlyZWQgd2hlbmV2ZXIgYSBjaGFuZ2UgaXMgbWFkZSB0byB0aGUgbXV0YXRvcidzIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGUgQ3VzdG9tIGRhdGEgZm9yIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSB3b3Jrc3BhY2VDaGFuZ2VkKGU6IEFic3RyYWN0KSB7XG4gICAgaWYgKCF0aGlzLnNob3VsZElnbm9yZU11dGF0b3JFdmVudF8oZSkgJiYgIXRoaXMudXBkYXRlV29ya3NwYWNlUGlkKSB7XG4gICAgICB0aGlzLnVwZGF0ZVdvcmtzcGFjZVBpZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVdvcmtzcGFjZVBpZCA9IG51bGw7XG4gICAgICAgIHRoaXMudXBkYXRlV29ya3NwYWNlKCk7XG4gICAgICB9LCAwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBnaXZlbiBldmVudCBpbiB0aGUgbXV0YXRvciB3b3Jrc3BhY2Ugc2hvdWxkIGJlIGlnbm9yZWRcbiAgICogd2hlbiBkZWNpZGluZyB3aGV0aGVyIHRvIHVwZGF0ZSB0aGUgd29ya3NwYWNlIGFuZCBjb21wb3NlIHRoZSBibG9jayBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBlIFRoZSBldmVudC5cbiAgICogQHJldHVybnMgV2hldGhlciB0byBpZ25vcmUgdGhlIGV2ZW50IG9yIG5vdC5cbiAgICovXG4gIHNob3VsZElnbm9yZU11dGF0b3JFdmVudF8oZTogQWJzdHJhY3QpIHtcbiAgICByZXR1cm4gZS5pc1VpRXZlbnQgfHwgZS50eXBlID09PSBldmVudFV0aWxzLkNSRUFURSB8fFxuICAgICAgICBlLnR5cGUgPT09IGV2ZW50VXRpbHMuQ0hBTkdFICYmXG4gICAgICAgIChlIGFzIEJsb2NrQ2hhbmdlKS5lbGVtZW50ID09PSAnZGlzYWJsZWQnO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIHNvdXJjZSBibG9jayB3aGVuIHRoZSBtdXRhdG9yJ3MgYmxvY2tzIGFyZSBjaGFuZ2VkLlxuICAgKiBCdW1wIGRvd24gYW55IGJsb2NrIHRoYXQncyB0b28gaGlnaC5cbiAgICovXG4gIHByaXZhdGUgdXBkYXRlV29ya3NwYWNlKCkge1xuICAgIGlmICghdGhpcy53b3Jrc3BhY2VfIS5pc0RyYWdnaW5nKCkpIHtcbiAgICAgIGNvbnN0IGJsb2NrcyA9IHRoaXMud29ya3NwYWNlXyEuZ2V0VG9wQmxvY2tzKGZhbHNlKTtcbiAgICAgIGNvbnN0IE1BUkdJTiA9IDIwO1xuXG4gICAgICBmb3IgKGxldCBiID0gMCwgYmxvY2s7IGJsb2NrID0gYmxvY2tzW2JdOyBiKyspIHtcbiAgICAgICAgY29uc3QgYmxvY2tYWSA9IGJsb2NrLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcblxuICAgICAgICAvLyBCdW1wIGFueSBibG9jayB0aGF0J3MgYWJvdmUgdGhlIHRvcCBiYWNrIGluc2lkZS5cbiAgICAgICAgaWYgKGJsb2NrWFkueSA8IE1BUkdJTikge1xuICAgICAgICAgIGJsb2NrLm1vdmVCeSgwLCBNQVJHSU4gLSBibG9ja1hZLnkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEJ1bXAgYW55IGJsb2NrIG92ZXJsYXBwaW5nIHRoZSBmbHlvdXQgYmFjayBpbnNpZGUuXG4gICAgICAgIGlmIChibG9jay5SVEwpIHtcbiAgICAgICAgICBsZXQgcmlnaHQgPSAtTUFSR0lOO1xuICAgICAgICAgIGNvbnN0IGZseW91dCA9IHRoaXMud29ya3NwYWNlXyEuZ2V0Rmx5b3V0KCk7XG4gICAgICAgICAgaWYgKGZseW91dCkge1xuICAgICAgICAgICAgcmlnaHQgLT0gZmx5b3V0LmdldFdpZHRoKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChibG9ja1hZLnggPiByaWdodCkge1xuICAgICAgICAgICAgYmxvY2subW92ZUJ5KHJpZ2h0IC0gYmxvY2tYWS54LCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoYmxvY2tYWS54IDwgTUFSR0lOKSB7XG4gICAgICAgICAgYmxvY2subW92ZUJ5KE1BUkdJTiAtIGJsb2NrWFkueCwgMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBXaGVuIHRoZSBtdXRhdG9yJ3Mgd29ya3NwYWNlIGNoYW5nZXMsIHVwZGF0ZSB0aGUgc291cmNlIGJsb2NrLlxuICAgIGlmICh0aGlzLnJvb3RCbG9jayAmJiB0aGlzLnJvb3RCbG9jay53b3Jrc3BhY2UgPT09IHRoaXMud29ya3NwYWNlXykge1xuICAgICAgY29uc3QgZXhpc3RpbmdHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgIGlmICghZXhpc3RpbmdHcm91cCkge1xuICAgICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgICAgfVxuICAgICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldEJsb2NrKCk7XG4gICAgICBjb25zdCBvbGRFeHRyYVN0YXRlID0gQmxvY2tDaGFuZ2UuZ2V0RXh0cmFCbG9ja1N0YXRlXyhibG9jayk7XG5cbiAgICAgIC8vIFN3aXRjaCBvZmYgcmVuZGVyaW5nIHdoaWxlIHRoZSBzb3VyY2UgYmxvY2sgaXMgcmVidWlsdC5cbiAgICAgIGNvbnN0IHNhdmVkUmVuZGVyZWQgPSBibG9jay5yZW5kZXJlZDtcbiAgICAgIC8vIFRPRE8oIzQyODgpOiBXZSBzaG91bGQgbm90IGJlIHNldHRpbmcgdGhlIHJlbmRlcmVkIHByb3BlcnR5IHRvIGZhbHNlLlxuICAgICAgYmxvY2sucmVuZGVyZWQgPSBmYWxzZTtcblxuICAgICAgLy8gQWxsb3cgdGhlIHNvdXJjZSBibG9jayB0byByZWJ1aWxkIGl0c2VsZi5cbiAgICAgIGJsb2NrLmNvbXBvc2UhKHRoaXMucm9vdEJsb2NrKTtcbiAgICAgIC8vIFJlc3RvcmUgcmVuZGVyaW5nIGFuZCBzaG93IHRoZSBjaGFuZ2VzLlxuICAgICAgYmxvY2sucmVuZGVyZWQgPSBzYXZlZFJlbmRlcmVkO1xuICAgICAgLy8gTXV0YXRpb24gbWF5IGhhdmUgYWRkZWQgc29tZSBlbGVtZW50cyB0aGF0IG5lZWQgaW5pdGlhbGl6aW5nLlxuICAgICAgYmxvY2suaW5pdFN2ZygpO1xuXG4gICAgICBpZiAoYmxvY2sucmVuZGVyZWQpIHtcbiAgICAgICAgYmxvY2sucmVuZGVyKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5ld0V4dHJhU3RhdGUgPSBCbG9ja0NoYW5nZS5nZXRFeHRyYUJsb2NrU3RhdGVfKGJsb2NrKTtcbiAgICAgIGlmIChvbGRFeHRyYVN0YXRlICE9PSBuZXdFeHRyYVN0YXRlKSB7XG4gICAgICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuQkxPQ0tfQ0hBTkdFKSkoXG4gICAgICAgICAgICBibG9jaywgJ211dGF0aW9uJywgbnVsbCwgb2xkRXh0cmFTdGF0ZSwgbmV3RXh0cmFTdGF0ZSkpO1xuICAgICAgICAvLyBFbnN1cmUgdGhhdCBhbnkgYnVtcCBpcyBwYXJ0IG9mIHRoaXMgbXV0YXRpb24ncyBldmVudCBncm91cC5cbiAgICAgICAgY29uc3QgbXV0YXRpb25Hcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zdCBvbGRHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgICAgICBldmVudFV0aWxzLnNldEdyb3VwKG11dGF0aW9uR3JvdXApO1xuICAgICAgICAgIGJsb2NrLmJ1bXBOZWlnaGJvdXJzKCk7XG4gICAgICAgICAgZXZlbnRVdGlscy5zZXRHcm91cChvbGRHcm91cCk7XG4gICAgICAgIH0sIGNvbmZpZy5idW1wRGVsYXkpO1xuICAgICAgfVxuXG4gICAgICAvLyBEb24ndCB1cGRhdGUgdGhlIGJ1YmJsZSB1bnRpbCB0aGUgZHJhZyBoYXMgZW5kZWQsIHRvIGF2b2lkIG1vdmluZ1xuICAgICAgLy8gYmxvY2tzIHVuZGVyIHRoZSBjdXJzb3IuXG4gICAgICBpZiAoIXRoaXMud29ya3NwYWNlXyEuaXNEcmFnZ2luZygpKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZXNpemVCdWJibGUoKSwgMCk7XG4gICAgICB9XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKGV4aXN0aW5nR3JvdXApO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBEaXNwb3NlIG9mIHRoaXMgbXV0YXRvci4gKi9cbiAgb3ZlcnJpZGUgZGlzcG9zZSgpIHtcbiAgICB0aGlzLmdldEJsb2NrKCkubXV0YXRvciA9IG51bGw7XG4gICAgc3VwZXIuZGlzcG9zZSgpO1xuICB9XG5cbiAgLyoqIFVwZGF0ZSB0aGUgc3R5bGVzIG9uIGFsbCBibG9ja3MgaW4gdGhlIG11dGF0b3IuICovXG4gIHVwZGF0ZUJsb2NrU3R5bGUoKSB7XG4gICAgY29uc3Qgd3MgPSB0aGlzLndvcmtzcGFjZV87XG5cbiAgICBpZiAod3MgJiYgd3MuZ2V0QWxsQmxvY2tzKGZhbHNlKSkge1xuICAgICAgY29uc3Qgd29ya3NwYWNlQmxvY2tzID0gd3MuZ2V0QWxsQmxvY2tzKGZhbHNlKTtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSB3b3Jrc3BhY2VCbG9ja3NbaV07IGkrKykge1xuICAgICAgICBibG9jay5zZXRTdHlsZShibG9jay5nZXRTdHlsZU5hbWUoKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZseW91dCA9IHdzLmdldEZseW91dCgpO1xuICAgICAgaWYgKGZseW91dCkge1xuICAgICAgICBjb25zdCBmbHlvdXRCbG9ja3MgPSBmbHlvdXQuZ2V0V29ya3NwYWNlKCkuZ2V0QWxsQmxvY2tzKGZhbHNlKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IGZseW91dEJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgICAgICAgYmxvY2suc2V0U3R5bGUoYmxvY2suZ2V0U3R5bGVOYW1lKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29ubmVjdCBhbiBibG9jayB0byBhIG11dGF0ZWQgaW5wdXQuXG4gICAqXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uQ2hpbGQgQ29ubmVjdGlvbiBvbiBjaGlsZCBibG9jay5cbiAgICogQHBhcmFtIGJsb2NrIFBhcmVudCBibG9jay5cbiAgICogQHBhcmFtIGlucHV0TmFtZSBOYW1lIG9mIGlucHV0IG9uIHBhcmVudCBibG9jay5cbiAgICogQHJldHVybnMgVHJ1ZSBpZmYgYSByZWNvbm5lY3Rpb24gd2FzIG1hZGUsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHN0YXRpYyByZWNvbm5lY3QoXG4gICAgICBjb25uZWN0aW9uQ2hpbGQ6IENvbm5lY3Rpb24sIGJsb2NrOiBCbG9jaywgaW5wdXROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBpZiAoIWNvbm5lY3Rpb25DaGlsZCB8fCAhY29ubmVjdGlvbkNoaWxkLmdldFNvdXJjZUJsb2NrKCkud29ya3NwYWNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7ICAvLyBObyBjb25uZWN0aW9uIG9yIGJsb2NrIGhhcyBiZWVuIGRlbGV0ZWQuXG4gICAgfVxuICAgIGNvbnN0IGNvbm5lY3Rpb25QYXJlbnQgPSBibG9jay5nZXRJbnB1dChpbnB1dE5hbWUpIS5jb25uZWN0aW9uO1xuICAgIGNvbnN0IGN1cnJlbnRQYXJlbnQgPSBjb25uZWN0aW9uQ2hpbGQudGFyZ2V0QmxvY2soKTtcbiAgICBpZiAoKCFjdXJyZW50UGFyZW50IHx8IGN1cnJlbnRQYXJlbnQgPT09IGJsb2NrKSAmJiBjb25uZWN0aW9uUGFyZW50ICYmXG4gICAgICAgIGNvbm5lY3Rpb25QYXJlbnQudGFyZ2V0Q29ubmVjdGlvbiAhPT0gY29ubmVjdGlvbkNoaWxkKSB7XG4gICAgICBpZiAoY29ubmVjdGlvblBhcmVudC5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgIC8vIFRoZXJlJ3MgYWxyZWFkeSBzb21ldGhpbmcgY29ubmVjdGVkIGhlcmUuICBHZXQgcmlkIG9mIGl0LlxuICAgICAgICBjb25uZWN0aW9uUGFyZW50LmRpc2Nvbm5lY3QoKTtcbiAgICAgIH1cbiAgICAgIGNvbm5lY3Rpb25QYXJlbnQuY29ubmVjdChjb25uZWN0aW9uQ2hpbGQpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHBhcmVudCB3b3Jrc3BhY2Ugb2YgYSB3b3Jrc3BhY2UgdGhhdCBpcyBpbnNpZGUgYSBtdXRhdG9yLCB0YWtpbmdcbiAgICogaW50byBhY2NvdW50IHdoZXRoZXIgaXQgaXMgYSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0aGF0IGlzIGluc2lkZSBhIG11dGF0b3IuXG4gICAqIEByZXR1cm5zIFRoZSBtdXRhdG9yJ3MgcGFyZW50IHdvcmtzcGFjZSBvciBudWxsLlxuICAgKi9cbiAgc3RhdGljIGZpbmRQYXJlbnRXcyh3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zyk6IFdvcmtzcGFjZVN2Z3xudWxsIHtcbiAgICBsZXQgb3V0ZXJXcyA9IG51bGw7XG4gICAgaWYgKHdvcmtzcGFjZSAmJiB3b3Jrc3BhY2Uub3B0aW9ucykge1xuICAgICAgY29uc3QgcGFyZW50ID0gd29ya3NwYWNlLm9wdGlvbnMucGFyZW50V29ya3NwYWNlO1xuICAgICAgLy8gSWYgd2Ugd2VyZSBpbiBhIGZseW91dCBpbiBhIG11dGF0b3IsIG5lZWQgdG8gZ28gdXAgdHdvIGxldmVscyB0byBmaW5kXG4gICAgICAvLyB0aGUgYWN0dWFsIHBhcmVudC5cbiAgICAgIGlmICh3b3Jrc3BhY2UuaXNGbHlvdXQpIHtcbiAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQub3B0aW9ucykge1xuICAgICAgICAgIG91dGVyV3MgPSBwYXJlbnQub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocGFyZW50KSB7XG4gICAgICAgIG91dGVyV3MgPSBwYXJlbnQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXRlcldzO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogRXZlbnRzIGZpcmVkIGFzIGEgcmVzdWx0IG9mIHRyYXNoY2FuIGZseW91dCBvcGVuIGFuZCBjbG9zZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuVHJhc2hjYW5PcGVuJyk7XG5cbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7QWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcblxuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB0cmFzaGNhbiBvcGVuIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5UcmFzaGNhbk9wZW5cbiAqL1xuZXhwb3J0IGNsYXNzIFRyYXNoY2FuT3BlbiBleHRlbmRzIFVpQmFzZSB7XG4gIGlzT3Blbj86IGJvb2xlYW47XG4gIG92ZXJyaWRlIHR5cGUgPSBldmVudFV0aWxzLlRSQVNIQ0FOX09QRU47XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfaXNPcGVuIFdoZXRoZXIgdGhlIHRyYXNoY2FuIGZseW91dCBpcyBvcGVuaW5nIChmYWxzZSBpZlxuICAgKiAgICAgb3BlbmluZykuIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG9wdF93b3Jrc3BhY2VJZCBUaGUgd29ya3NwYWNlIGlkZW50aWZpZXIgZm9yIHRoaXMgZXZlbnQuXG4gICAqICAgIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKG9wdF9pc09wZW4/OiBib29sZWFuLCBvcHRfd29ya3NwYWNlSWQ/OiBzdHJpbmcpIHtcbiAgICBzdXBlcihvcHRfd29ya3NwYWNlSWQpO1xuXG4gICAgLyoqIFdoZXRoZXIgdGhlIHRyYXNoY2FuIGZseW91dCBpcyBvcGVuaW5nIChmYWxzZSBpZiBjbG9zaW5nKS4gKi9cbiAgICB0aGlzLmlzT3BlbiA9IG9wdF9pc09wZW47XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIHRoZSBldmVudCBhcyBKU09OLlxuICAgKlxuICAgKiBAcmV0dXJucyBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgdG9Kc29uKCk6IFRyYXNoY2FuT3Blbkpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBUcmFzaGNhbk9wZW5Kc29uO1xuICAgIGlmICh0aGlzLmlzT3BlbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1doZXRoZXIgdGhpcyBpcyBhbHJlYWR5IG9wZW4gb3Igbm90IGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgJyArXG4gICAgICAgICAgJ2EgdmFsdWUgdG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ2lzT3BlbiddID0gdGhpcy5pc09wZW47XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogVHJhc2hjYW5PcGVuSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5UcmFzaGNhbk9wZW4ucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy5pc09wZW4gPSBqc29uWydpc09wZW4nXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgVHJhc2hjYW5PcGVuLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0XG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mXG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogVHJhc2hjYW5PcGVuSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIFRyYXNoY2FuT3BlbiB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBUcmFzaGNhbk9wZW4oKSkgYXNcbiAgICAgICAgVHJhc2hjYW5PcGVuO1xuICAgIG5ld0V2ZW50LmlzT3BlbiA9IGpzb25bJ2lzT3BlbiddO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyYXNoY2FuT3Blbkpzb24gZXh0ZW5kcyBBYnN0cmFjdEV2ZW50SnNvbiB7XG4gIGlzT3BlbjogYm9vbGVhbjtcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5UUkFTSENBTl9PUEVOLCBUcmFzaGNhbk9wZW4pO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1hbmFnZXIgZm9yIGFsbCBpdGVtcyByZWdpc3RlcmVkIHdpdGggdGhlIHdvcmtzcGFjZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db21wb25lbnRNYW5hZ2VyJyk7XG5cbmltcG9ydCB0eXBlIHtJQXV0b0hpZGVhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9hdXRvaGlkZWFibGUuanMnO1xuaW1wb3J0IHR5cGUge0lDb21wb25lbnR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2NvbXBvbmVudC5qcyc7XG5pbXBvcnQgdHlwZSB7SURlbGV0ZUFyZWF9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2RlbGV0ZV9hcmVhLmpzJztcbmltcG9ydCB0eXBlIHtJRHJhZ1RhcmdldH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ190YXJnZXQuanMnO1xuaW1wb3J0IHR5cGUge0lQb3NpdGlvbmFibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX3Bvc2l0aW9uYWJsZS5qcyc7XG5pbXBvcnQgKiBhcyBhcnJheVV0aWxzIGZyb20gJy4vdXRpbHMvYXJyYXkuanMnO1xuXG5cbmNsYXNzIENhcGFiaWxpdHk8X1Q+IHtcbiAgc3RhdGljIFBPU0lUSU9OQUJMRSA9IG5ldyBDYXBhYmlsaXR5PElQb3NpdGlvbmFibGU+KCdwb3NpdGlvbmFibGUnKTtcbiAgc3RhdGljIERSQUdfVEFSR0VUID0gbmV3IENhcGFiaWxpdHk8SURyYWdUYXJnZXQ+KCdkcmFnX3RhcmdldCcpO1xuICBzdGF0aWMgREVMRVRFX0FSRUEgPSBuZXcgQ2FwYWJpbGl0eTxJRGVsZXRlQXJlYT4oJ2RlbGV0ZV9hcmVhJyk7XG4gIHN0YXRpYyBBVVRPSElERUFCTEUgPSBuZXcgQ2FwYWJpbGl0eTxJQXV0b0hpZGVhYmxlPignYXV0b2hpZGVhYmxlJyk7XG4gIHByaXZhdGUgcmVhZG9ubHkgbmFtZV86IHN0cmluZztcbiAgLyoqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBjb21wb25lbnQgY2FwYWJpbGl0eS4gKi9cbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5uYW1lXyA9IG5hbWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgY2FwYWJpbGl0eS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIG5hbWUuXG4gICAqL1xuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm5hbWVfO1xuICB9XG59XG5cbi8qKlxuICogTWFuYWdlciBmb3IgYWxsIGl0ZW1zIHJlZ2lzdGVyZWQgd2l0aCB0aGUgd29ya3NwYWNlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbXBvbmVudE1hbmFnZXJcbiAqL1xuZXhwb3J0IGNsYXNzIENvbXBvbmVudE1hbmFnZXIge1xuICBzdGF0aWMgQ2FwYWJpbGl0eSA9IENhcGFiaWxpdHk7XG5cbiAgLyoqXG4gICAqIEEgbWFwIG9mIHRoZSBjb21wb25lbnRzIHJlZ2lzdGVyZWQgd2l0aCB0aGUgd29ya3NwYWNlLCBtYXBwZWQgdG8gaWQuXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbXBvbmVudERhdGEgPSBuZXcgTWFwPHN0cmluZywgQ29tcG9uZW50RGF0dW0+KCk7XG5cbiAgLyoqIEEgbWFwIG9mIGNhcGFiaWxpdGllcyB0byBjb21wb25lbnQgSURzLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGNhcGFiaWxpdHlUb0NvbXBvbmVudElkcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmdbXT4oKTtcblxuICAvKipcbiAgICogQWRkcyBhIGNvbXBvbmVudC5cbiAgICpcbiAgICogQHBhcmFtIGNvbXBvbmVudEluZm8gVGhlIGRhdGEgZm9yIHRoZSBjb21wb25lbnQgdG8gcmVnaXN0ZXIuXG4gICAqIEBwYXJhbSBvcHRfYWxsb3dPdmVycmlkZXMgVHJ1ZSB0byBwcmV2ZW50IGFuIGVycm9yIHdoZW4gb3ZlcnJpZGluZyBhblxuICAgKiAgICAgYWxyZWFkeSByZWdpc3RlcmVkIGl0ZW0uXG4gICAqL1xuICBhZGRDb21wb25lbnQoY29tcG9uZW50SW5mbzogQ29tcG9uZW50RGF0dW0sIG9wdF9hbGxvd092ZXJyaWRlcz86IGJvb2xlYW4pIHtcbiAgICAvLyBEb24ndCB0aHJvdyBhbiBlcnJvciBpZiBvcHRfYWxsb3dPdmVycmlkZXMgaXMgdHJ1ZS5cbiAgICBjb25zdCBpZCA9IGNvbXBvbmVudEluZm8uY29tcG9uZW50LmlkO1xuICAgIGlmICghb3B0X2FsbG93T3ZlcnJpZGVzICYmIHRoaXMuY29tcG9uZW50RGF0YS5oYXMoaWQpKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnUGx1Z2luIFwiJyArIGlkICsgJ1wiIHdpdGggY2FwYWJpbGl0aWVzIFwiJyArXG4gICAgICAgICAgdGhpcy5jb21wb25lbnREYXRhLmdldChpZCk/LmNhcGFiaWxpdGllcyArICdcIiBhbHJlYWR5IGFkZGVkLicpO1xuICAgIH1cbiAgICB0aGlzLmNvbXBvbmVudERhdGEuc2V0KGlkLCBjb21wb25lbnRJbmZvKTtcbiAgICBjb25zdCBzdHJpbmdDYXBhYmlsaXRpZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXBvbmVudEluZm8uY2FwYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjYXBhYmlsaXR5ID0gU3RyaW5nKGNvbXBvbmVudEluZm8uY2FwYWJpbGl0aWVzW2ldKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgc3RyaW5nQ2FwYWJpbGl0aWVzLnB1c2goY2FwYWJpbGl0eSk7XG4gICAgICBpZiAoIXRoaXMuY2FwYWJpbGl0eVRvQ29tcG9uZW50SWRzLmhhcyhjYXBhYmlsaXR5KSkge1xuICAgICAgICB0aGlzLmNhcGFiaWxpdHlUb0NvbXBvbmVudElkcy5zZXQoY2FwYWJpbGl0eSwgW2lkXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNhcGFiaWxpdHlUb0NvbXBvbmVudElkcy5nZXQoY2FwYWJpbGl0eSk/LnB1c2goaWQpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmNvbXBvbmVudERhdGEuZ2V0KGlkKSEuY2FwYWJpbGl0aWVzID0gc3RyaW5nQ2FwYWJpbGl0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBjb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBUaGUgSUQgb2YgdGhlIGNvbXBvbmVudCB0byByZW1vdmUuXG4gICAqL1xuICByZW1vdmVDb21wb25lbnQoaWQ6IHN0cmluZykge1xuICAgIGNvbnN0IGNvbXBvbmVudEluZm8gPSB0aGlzLmNvbXBvbmVudERhdGEuZ2V0KGlkKTtcbiAgICBpZiAoIWNvbXBvbmVudEluZm8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wb25lbnRJbmZvLmNhcGFiaWxpdGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2FwYWJpbGl0eSA9IFN0cmluZyhjb21wb25lbnRJbmZvLmNhcGFiaWxpdGllc1tpXSkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGFycmF5VXRpbHMucmVtb3ZlRWxlbSh0aGlzLmNhcGFiaWxpdHlUb0NvbXBvbmVudElkcy5nZXQoY2FwYWJpbGl0eSkhLCBpZCk7XG4gICAgfVxuICAgIHRoaXMuY29tcG9uZW50RGF0YS5kZWxldGUoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBjYXBhYmlsaXR5IHRvIGEgZXhpc3RpbmcgcmVnaXN0ZXJlZCBjb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBUaGUgSUQgb2YgdGhlIGNvbXBvbmVudCB0byBhZGQgdGhlIGNhcGFiaWxpdHkgdG8uXG4gICAqIEBwYXJhbSBjYXBhYmlsaXR5IFRoZSBjYXBhYmlsaXR5IHRvIGFkZC5cbiAgICovXG4gIGFkZENhcGFiaWxpdHk8VD4oaWQ6IHN0cmluZywgY2FwYWJpbGl0eTogc3RyaW5nfENhcGFiaWxpdHk8VD4pIHtcbiAgICBpZiAoIXRoaXMuZ2V0Q29tcG9uZW50KGlkKSkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBhZGQgY2FwYWJpbGl0eSwgXCInICsgY2FwYWJpbGl0eSArICdcIi4gUGx1Z2luIFwiJyArIGlkICtcbiAgICAgICAgICAnXCIgaGFzIG5vdCBiZWVuIGFkZGVkIHRvIHRoZSBDb21wb25lbnRNYW5hZ2VyJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmhhc0NhcGFiaWxpdHkoaWQsIGNhcGFiaWxpdHkpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ1BsdWdpbiBcIicgKyBpZCArICdhbHJlYWR5IGhhcyBjYXBhYmlsaXR5IFwiJyArIGNhcGFiaWxpdHkgKyAnXCInKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY2FwYWJpbGl0eSA9IFN0cmluZyhjYXBhYmlsaXR5KS50b0xvd2VyQ2FzZSgpO1xuICAgIHRoaXMuY29tcG9uZW50RGF0YS5nZXQoaWQpPy5jYXBhYmlsaXRpZXMucHVzaChjYXBhYmlsaXR5KTtcbiAgICB0aGlzLmNhcGFiaWxpdHlUb0NvbXBvbmVudElkcy5nZXQoY2FwYWJpbGl0eSk/LnB1c2goaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBjYXBhYmlsaXR5IGZyb20gYW4gZXhpc3RpbmcgcmVnaXN0ZXJlZCBjb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBUaGUgSUQgb2YgdGhlIGNvbXBvbmVudCB0byByZW1vdmUgdGhlIGNhcGFiaWxpdHkgZnJvbS5cbiAgICogQHBhcmFtIGNhcGFiaWxpdHkgVGhlIGNhcGFiaWxpdHkgdG8gcmVtb3ZlLlxuICAgKi9cbiAgcmVtb3ZlQ2FwYWJpbGl0eTxUPihpZDogc3RyaW5nLCBjYXBhYmlsaXR5OiBzdHJpbmd8Q2FwYWJpbGl0eTxUPikge1xuICAgIGlmICghdGhpcy5nZXRDb21wb25lbnQoaWQpKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IHJlbW92ZSBjYXBhYmlsaXR5LCBcIicgKyBjYXBhYmlsaXR5ICsgJ1wiLiBQbHVnaW4gXCInICsgaWQgK1xuICAgICAgICAgICdcIiBoYXMgbm90IGJlZW4gYWRkZWQgdG8gdGhlIENvbXBvbmVudE1hbmFnZXInKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmhhc0NhcGFiaWxpdHkoaWQsIGNhcGFiaWxpdHkpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ1BsdWdpbiBcIicgKyBpZCArICdkb2VzblxcJ3QgaGF2ZSBjYXBhYmlsaXR5IFwiJyArIGNhcGFiaWxpdHkgK1xuICAgICAgICAgICdcIiB0byByZW1vdmUnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY2FwYWJpbGl0eSA9IFN0cmluZyhjYXBhYmlsaXR5KS50b0xvd2VyQ2FzZSgpO1xuICAgIGFycmF5VXRpbHMucmVtb3ZlRWxlbSh0aGlzLmNvbXBvbmVudERhdGEuZ2V0KGlkKSEuY2FwYWJpbGl0aWVzLCBjYXBhYmlsaXR5KTtcbiAgICBhcnJheVV0aWxzLnJlbW92ZUVsZW0odGhpcy5jYXBhYmlsaXR5VG9Db21wb25lbnRJZHMuZ2V0KGNhcGFiaWxpdHkpISwgaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciB0aGUgY29tcG9uZW50IHdpdGggdGhpcyBpZCBoYXMgdGhlIHNwZWNpZmllZCBjYXBhYmlsaXR5LlxuICAgKlxuICAgKiBAcGFyYW0gaWQgVGhlIElEIG9mIHRoZSBjb21wb25lbnQgdG8gY2hlY2suXG4gICAqIEBwYXJhbSBjYXBhYmlsaXR5IFRoZSBjYXBhYmlsaXR5IHRvIGNoZWNrIGZvci5cbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgY29tcG9uZW50IGhhcyB0aGUgY2FwYWJpbGl0eS5cbiAgICovXG4gIGhhc0NhcGFiaWxpdHk8VD4oaWQ6IHN0cmluZywgY2FwYWJpbGl0eTogc3RyaW5nfENhcGFiaWxpdHk8VD4pOiBib29sZWFuIHtcbiAgICBjYXBhYmlsaXR5ID0gU3RyaW5nKGNhcGFiaWxpdHkpLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9uZW50RGF0YS5oYXMoaWQpICYmXG4gICAgICAgIHRoaXMuY29tcG9uZW50RGF0YS5nZXQoaWQpIS5jYXBhYmlsaXRpZXMuaW5kZXhPZihjYXBhYmlsaXR5KSAhPT0gLTE7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY29tcG9uZW50IHdpdGggdGhlIGdpdmVuIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgVGhlIElEIG9mIHRoZSBjb21wb25lbnQgdG8gZ2V0LlxuICAgKiBAcmV0dXJucyBUaGUgY29tcG9uZW50IHdpdGggdGhlIGdpdmVuIG5hbWUgb3IgdW5kZWZpbmVkIGlmIG5vdCBmb3VuZC5cbiAgICovXG4gIGdldENvbXBvbmVudChpZDogc3RyaW5nKTogSUNvbXBvbmVudHx1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudERhdGEuZ2V0KGlkKT8uY29tcG9uZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHRoZSBjb21wb25lbnRzIHdpdGggdGhlIHNwZWNpZmllZCBjYXBhYmlsaXR5LlxuICAgKlxuICAgKiBAcGFyYW0gY2FwYWJpbGl0eSBUaGUgY2FwYWJpbGl0eSBvZiB0aGUgY29tcG9uZW50LlxuICAgKiBAcGFyYW0gc29ydGVkIFdoZXRoZXIgdG8gcmV0dXJuIGxpc3Qgb3JkZXJlZCBieSB3ZWlnaHRzLlxuICAgKiBAcmV0dXJucyBUaGUgY29tcG9uZW50cyB0aGF0IG1hdGNoIHRoZSBzcGVjaWZpZWQgY2FwYWJpbGl0eS5cbiAgICovXG4gIGdldENvbXBvbmVudHM8VCBleHRlbmRzIElDb21wb25lbnQ+KFxuICAgICAgY2FwYWJpbGl0eTogc3RyaW5nfENhcGFiaWxpdHk8VD4sIHNvcnRlZDogYm9vbGVhbik6IFRbXSB7XG4gICAgY2FwYWJpbGl0eSA9IFN0cmluZyhjYXBhYmlsaXR5KS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGNvbXBvbmVudElkcyA9IHRoaXMuY2FwYWJpbGl0eVRvQ29tcG9uZW50SWRzLmdldChjYXBhYmlsaXR5KTtcbiAgICBpZiAoIWNvbXBvbmVudElkcykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBjb21wb25lbnRzOiBUW10gPSBbXTtcbiAgICBpZiAoc29ydGVkKSB7XG4gICAgICBjb25zdCBjb21wb25lbnREYXRhTGlzdDogQ29tcG9uZW50RGF0dW1bXSA9IFtdO1xuICAgICAgY29tcG9uZW50SWRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudERhdGFMaXN0LnB1c2godGhpcy5jb21wb25lbnREYXRhLmdldChpZCkhKTtcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50RGF0YUxpc3Quc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHJldHVybiBhLndlaWdodCAtIGIud2VpZ2h0O1xuICAgICAgfSk7XG4gICAgICBjb21wb25lbnREYXRhTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGNvbXBvbmVudERhdHVtKSB7XG4gICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnREYXR1bS5jb21wb25lbnQgYXMgVCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29tcG9uZW50SWRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudHMucHVzaCh0aGlzLmNvbXBvbmVudERhdGEuZ2V0KGlkKSEuY29tcG9uZW50IGFzIFQpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBjb21wb25lbnRzO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgQ29tcG9uZW50TWFuYWdlciB7XG4gIC8qKiBBbiBvYmplY3Qgc3RvcmluZyBjb21wb25lbnQgaW5mb3JtYXRpb24uICovXG4gIGV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50RGF0dW0ge1xuICAgIGNvbXBvbmVudDogSUNvbXBvbmVudDtcbiAgICBjYXBhYmlsaXRpZXM6IEFycmF5PHN0cmluZ3xDYXBhYmlsaXR5PElDb21wb25lbnQ+PjtcbiAgICB3ZWlnaHQ6IG51bWJlcjtcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBDb21wb25lbnREYXR1bSA9IENvbXBvbmVudE1hbmFnZXIuQ29tcG9uZW50RGF0dW07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ29udGFpbnMgY3VzdG9tIGVycm9ycyB0aHJvd24gYnkgdGhlIHNlcmlhbGl6YXRpb24gc3lzdGVtLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5zZXJpYWxpemF0aW9uLmV4Y2VwdGlvbnNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5zZXJpYWxpemF0aW9uLmV4Y2VwdGlvbnMnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuLi9ibG9jay5qcyc7XG5pbXBvcnQgdHlwZSB7U3RhdGV9IGZyb20gJy4vYmxvY2tzLmpzJztcblxuXG4vKiogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi5leGNlcHRpb25zLkRlc2VyaWFsaXphdGlvbkVycm9yICovXG5leHBvcnQgY2xhc3MgRGVzZXJpYWxpemF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7fVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gZXJyb3Igd2hlcmUgdGhlIHNlcmlhbGl6ZWQgc3RhdGUgaXMgZXhwZWN0ZWQgdG8gcHJvdmlkZSBhXG4gKiBibG9jayB0eXBlLCBidXQgaXQgaXMgbm90IHByb3ZpZGVkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24uZXhjZXB0aW9ucy5NaXNzaW5nQmxvY2tUeXBlXG4gKi9cbmV4cG9ydCBjbGFzcyBNaXNzaW5nQmxvY2tUeXBlIGV4dGVuZHMgRGVzZXJpYWxpemF0aW9uRXJyb3Ige1xuICAvKipcbiAgICogQHBhcmFtIHN0YXRlIFRoZSBzdGF0ZSBvYmplY3Qgd2hpY2ggaXMgbWlzc2luZyB0aGUgYmxvY2sgdHlwZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgc3RhdGU6IFN0YXRlKSB7XG4gICAgc3VwZXIoYEV4cGVjdGVkIHRvIGZpbmQgYSAndHlwZScgcHJvcGVydHksIGRlZmluaW5nIHRoZSBibG9jayB0eXBlYCk7XG4gIH1cbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGFuIGVycm9yIHdoZXJlIGRlc2VyaWFsaXphdGlvbiBlbmNvdW50ZXJlZCBhIGJsb2NrIHRoYXQgZGlkXG4gKiBub3QgaGF2ZSBhIGNvbm5lY3Rpb24gdGhhdCB3YXMgZGVmaW5lZCBpbiB0aGUgc2VyaWFsaXplZCBzdGF0ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5zZXJpYWxpemF0aW9uLmV4Y2VwdGlvbnMuTWlzc2luZ0Nvbm5lY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIE1pc3NpbmdDb25uZWN0aW9uIGV4dGVuZHMgRGVzZXJpYWxpemF0aW9uRXJyb3Ige1xuICAvKipcbiAgICogQHBhcmFtIGNvbm5lY3Rpb24gVGhlIG5hbWUgb2YgdGhlIGNvbm5lY3Rpb24gdGhhdCBpcyBtaXNzaW5nLiBFLmcuXG4gICAqICAgICAnSUYwJywgb3IgJ25leHQnLlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIG1pc3NpbmcgdGhlIGNvbm5lY3Rpb24uXG4gICAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGJhZCBjb25uZWN0aW9uLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbm5lY3Rpb246IHN0cmluZywgcHVibGljIGJsb2NrOiBCbG9jaywgcHVibGljIHN0YXRlOiBTdGF0ZSkge1xuICAgIHN1cGVyKGBUaGUgYmxvY2sgJHtibG9jay50b0RldlN0cmluZygpfSBpcyBtaXNzaW5nIGEobikgJHtjb25uZWN0aW9ufVxuY29ubmVjdGlvbmApO1xuICB9XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhbiBlcnJvciB3aGVyZSBkZXNlcmlhbGl6YXRpb24gdHJpZWQgdG8gY29ubmVjdCB0d28gY29ubmVjdGlvbnNcbiAqIHRoYXQgd2VyZSBub3QgY29tcGF0aWJsZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5zZXJpYWxpemF0aW9uLmV4Y2VwdGlvbnMuQmFkQ29ubmVjdGlvbkNoZWNrXG4gKi9cbmV4cG9ydCBjbGFzcyBCYWRDb25uZWN0aW9uQ2hlY2sgZXh0ZW5kcyBEZXNlcmlhbGl6YXRpb25FcnJvciB7XG4gIC8qKlxuICAgKiBAcGFyYW0gcmVhc29uIFRoZSByZWFzb24gdGhlIGNvbm5lY3Rpb25zIHdlcmUgbm90IGNvbXBhdGlibGUuXG4gICAqIEBwYXJhbSBjaGlsZENvbm5lY3Rpb24gVGhlIG5hbWUgb2YgdGhlIGluY29tcGF0aWJsZSBjaGlsZCBjb25uZWN0aW9uLiBFLmcuXG4gICAqICAgICAnb3V0cHV0JyBvciAncHJldmlvdXMnLlxuICAgKiBAcGFyYW0gY2hpbGRCbG9jayBUaGUgY2hpbGQgYmxvY2sgdGhhdCBjb3VsZCBub3QgY29ubmVjdCB0byBpdHMgcGFyZW50LlxuICAgKiBAcGFyYW0gY2hpbGRTdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY2hpbGQgYmxvY2suXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICByZWFzb246IHN0cmluZywgY2hpbGRDb25uZWN0aW9uOiBzdHJpbmcsIHB1YmxpYyBjaGlsZEJsb2NrOiBCbG9jayxcbiAgICAgIHB1YmxpYyBjaGlsZFN0YXRlOiBTdGF0ZSkge1xuICAgIHN1cGVyKGBUaGUgYmxvY2sgJHtjaGlsZEJsb2NrLnRvRGV2U3RyaW5nKCl9IGNvdWxkIG5vdCBjb25uZWN0IGl0c1xuJHtjaGlsZENvbm5lY3Rpb259IHRvIGl0cyBwYXJlbnQsIGJlY2F1c2U6ICR7cmVhc29ufWApO1xuICB9XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhbiBlcnJvciB3aGVyZSBkZXNlcmlhbGl6YXRpb24gZW5jb3VudGVyZWQgYSByZWFsIGJsb2NrIGFzIGl0XG4gKiB3YXMgZGVzZXJpYWxpemluZyBjaGlsZHJlbiBvZiBhIHNoYWRvdy5cbiAqIFRoaXMgaXMgYW4gZXJyb3IgYmVjYXVzZSBpdCBpcyBhbiBpbnZhcmlhbnQgb2YgQmxvY2tseSB0aGF0IHNoYWRvdyBibG9ja3NcbiAqIGRvIG5vdCBoYXZlIHJlYWwgY2hpbGRyZW4uXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuc2VyaWFsaXphdGlvbi5leGNlcHRpb25zLlJlYWxDaGlsZE9mU2hhZG93XG4gKi9cbmV4cG9ydCBjbGFzcyBSZWFsQ2hpbGRPZlNoYWRvdyBleHRlbmRzIERlc2VyaWFsaXphdGlvbkVycm9yIHtcbiAgLyoqXG4gICAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgcmVhbCBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgc3RhdGU6IFN0YXRlKSB7XG4gICAgc3VwZXIoYEVuY291bnRlcmVkIGEgcmVhbCBibG9jayB3aGljaCBpcyBkZWZpbmVkIGFzIGEgY2hpbGQgb2YgYSBzaGFkb3dcbmJsb2NrLiBJdCBpcyBhbiBpbnZhcmlhbnQgb2YgQmxvY2tseSB0aGF0IHNoYWRvdyBibG9ja3Mgb25seSBoYXZlIHNoYWRvd1xuY2hpbGRyZW5gKTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRoZSB0b3AgbGV2ZWwgbmFtZXNwYWNlIGZvciBwcmlvcml0aWVzIG9mIHBsdWdpbiBzZXJpYWxpemVycy5cbiAqIEluY2x1ZGVzIGNvbnN0YW50cyBmb3IgdGhlIHByaW9yaXRpZXMgb2YgZGlmZmVyZW50IHBsdWdpbiBzZXJpYWxpemVycy4gSGlnaGVyXG4gKiBwcmlvcml0aWVzIGFyZSBkZXNlcmlhbGl6ZWQgZmlyc3QuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnNlcmlhbGl6YXRpb24ucHJpb3JpdGllc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnNlcmlhbGl6YXRpb24ucHJpb3JpdGllcycpO1xuXG5cbi8qKlxuICogVGhlIHByaW9yaXR5IGZvciBkZXNlcmlhbGl6aW5nIHZhcmlhYmxlcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5zZXJpYWxpemF0aW9uLnByaW9yaXRpZXMuVkFSSUFCTEVTXG4gKi9cbmV4cG9ydCBjb25zdCBWQVJJQUJMRVMgPSAxMDA7XG5cbi8qKlxuICogVGhlIHByaW9yaXR5IGZvciBkZXNlcmlhbGl6aW5nIHZhcmlhYmxlIGRhdGEuXG4gKi9cbmV4cG9ydCBjb25zdCBQUk9DRURVUkVTID0gNzU7XG5cbi8qKlxuICogVGhlIHByaW9yaXR5IGZvciBkZXNlcmlhbGl6aW5nIGJsb2Nrcy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5zZXJpYWxpemF0aW9uLnByaW9yaXRpZXMuQkxPQ0tTXG4gKi9cbmV4cG9ydCBjb25zdCBCTE9DS1MgPSA1MDtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBibG9jayBjcmVhdGlvbiBldmVudC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuQmxvY2tDcmVhdGUnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuLi9ibG9jay5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja3MgZnJvbSAnLi4vc2VyaWFsaXphdGlvbi9ibG9ja3MuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4uL3htbC5qcyc7XG5cbmltcG9ydCB7QmxvY2tCYXNlLCBCbG9ja0Jhc2VKc29ufSBmcm9tICcuL2V2ZW50c19ibG9ja19iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrIGNyZWF0aW9uIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5CbG9ja0NyZWF0ZVxuICovXG5leHBvcnQgY2xhc3MgQmxvY2tDcmVhdGUgZXh0ZW5kcyBCbG9ja0Jhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5CTE9DS19DUkVBVEU7XG4gIHhtbD86IEVsZW1lbnR8RG9jdW1lbnRGcmFnbWVudDtcbiAgaWRzPzogc3RyaW5nW107XG4gIGpzb24/OiBibG9ja3MuU3RhdGU7XG5cbiAgLyoqIEBwYXJhbSBvcHRfYmxvY2sgVGhlIGNyZWF0ZWQgYmxvY2suICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuICovXG4gIGNvbnN0cnVjdG9yKG9wdF9ibG9jaz86IEJsb2NrKSB7XG4gICAgc3VwZXIob3B0X2Jsb2NrKTtcblxuICAgIGlmICghb3B0X2Jsb2NrKSB7XG4gICAgICByZXR1cm47ICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgfVxuXG4gICAgaWYgKG9wdF9ibG9jay5pc1NoYWRvdygpKSB7XG4gICAgICAvLyBNb3Zpbmcgc2hhZG93IGJsb2NrcyBpcyBoYW5kbGVkIHZpYSBkaXNjb25uZWN0aW9uLlxuICAgICAgdGhpcy5yZWNvcmRVbmRvID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy54bWwgPSBYbWwuYmxvY2tUb0RvbVdpdGhYWShvcHRfYmxvY2spO1xuICAgIHRoaXMuaWRzID0gZXZlbnRVdGlscy5nZXREZXNjZW5kYW50SWRzKG9wdF9ibG9jayk7XG5cbiAgICAvKiogSlNPTiByZXByZXNlbnRhdGlvbiBvZiB0aGUgYmxvY2sgdGhhdCB3YXMganVzdCBjcmVhdGVkLiAqL1xuICAgIHRoaXMuanNvbiA9IGJsb2Nrcy5zYXZlKG9wdF9ibG9jaywge2FkZENvb3JkaW5hdGVzOiB0cnVlfSkgYXMgYmxvY2tzLlN0YXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBCbG9ja0NyZWF0ZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBCbG9ja0NyZWF0ZUpzb247XG4gICAgaWYgKCF0aGlzLnhtbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgWE1MIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSBibG9jayB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5pZHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGJsb2NrIElEcyBhcmUgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmpzb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGJsb2NrIEpTT04gaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAganNvblsneG1sJ10gPSBYbWwuZG9tVG9UZXh0KHRoaXMueG1sKTtcbiAgICBqc29uWydpZHMnXSA9IHRoaXMuaWRzO1xuICAgIGpzb25bJ2pzb24nXSA9IHRoaXMuanNvbjtcbiAgICBpZiAoIXRoaXMucmVjb3JkVW5kbykge1xuICAgICAganNvblsncmVjb3JkVW5kbyddID0gdGhpcy5yZWNvcmRVbmRvO1xuICAgIH1cbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBCbG9ja0NyZWF0ZUpzb24pIHtcbiAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAnQmxvY2tseS5FdmVudHMuQmxvY2tDcmVhdGUucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy54bWwgPSBYbWwudGV4dFRvRG9tKGpzb25bJ3htbCddKTtcbiAgICB0aGlzLmlkcyA9IGpzb25bJ2lkcyddO1xuICAgIHRoaXMuanNvbiA9IGpzb25bJ2pzb24nXSBhcyBibG9ja3MuU3RhdGU7XG4gICAgaWYgKGpzb25bJ3JlY29yZFVuZG8nXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnJlY29yZFVuZG8gPSBqc29uWydyZWNvcmRVbmRvJ107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBCbG9ja0NyZWF0ZSwgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdFxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZlxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IEJsb2NrQ3JlYXRlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIEJsb2NrQ3JlYXRlIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IEJsb2NrQ3JlYXRlKCkpIGFzXG4gICAgICAgIEJsb2NrQ3JlYXRlO1xuICAgIG5ld0V2ZW50LnhtbCA9IFhtbC50ZXh0VG9Eb20oanNvblsneG1sJ10pO1xuICAgIG5ld0V2ZW50LmlkcyA9IGpzb25bJ2lkcyddO1xuICAgIG5ld0V2ZW50Lmpzb24gPSBqc29uWydqc29uJ10gYXMgYmxvY2tzLlN0YXRlO1xuICAgIGlmIChqc29uWydyZWNvcmRVbmRvJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3RXZlbnQucmVjb3JkVW5kbyA9IGpzb25bJ3JlY29yZFVuZG8nXTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1biBhIGNyZWF0aW9uIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZm9yd2FyZCBUcnVlIGlmIHJ1biBmb3J3YXJkLCBmYWxzZSBpZiBydW4gYmFja3dhcmQgKHVuZG8pLlxuICAgKi9cbiAgb3ZlcnJpZGUgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmdldEV2ZW50V29ya3NwYWNlXygpO1xuICAgIGlmICghdGhpcy5qc29uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBibG9jayBKU09OIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSBibG9jayB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5pZHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGJsb2NrIElEcyBhcmUgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKGZvcndhcmQpIHtcbiAgICAgIGJsb2Nrcy5hcHBlbmQodGhpcy5qc29uLCB3b3Jrc3BhY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5pZHNbaV07XG4gICAgICAgIGNvbnN0IGJsb2NrID0gd29ya3NwYWNlLmdldEJsb2NrQnlJZChpZCk7XG4gICAgICAgIGlmIChibG9jaykge1xuICAgICAgICAgIGJsb2NrLmRpc3Bvc2UoZmFsc2UpO1xuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSB0aGlzLmJsb2NrSWQpIHtcbiAgICAgICAgICAvLyBPbmx5IGNvbXBsYWluIGFib3V0IHJvb3QtbGV2ZWwgYmxvY2suXG4gICAgICAgICAgY29uc29sZS53YXJuKCdDYW5cXCd0IHVuY3JlYXRlIG5vbi1leGlzdGVudCBibG9jazogJyArIGlkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJsb2NrQ3JlYXRlSnNvbiBleHRlbmRzIEJsb2NrQmFzZUpzb24ge1xuICB4bWw6IHN0cmluZztcbiAgaWRzOiBzdHJpbmdbXTtcbiAganNvbjogb2JqZWN0O1xuICByZWNvcmRVbmRvPzogYm9vbGVhbjtcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5DUkVBVEUsIEJsb2NrQ3JlYXRlKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBibG9jayBkZWxldGUgZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkJsb2NrRGVsZXRlJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja30gZnJvbSAnLi4vYmxvY2suanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgYmxvY2tzIGZyb20gJy4uL3NlcmlhbGl6YXRpb24vYmxvY2tzLmpzJztcbmltcG9ydCAqIGFzIFhtbCBmcm9tICcuLi94bWwuanMnO1xuXG5pbXBvcnQge0Jsb2NrQmFzZSwgQmxvY2tCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfYmxvY2tfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBibG9jayBkZWxldGlvbiBldmVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMuQmxvY2tEZWxldGVcbiAqL1xuZXhwb3J0IGNsYXNzIEJsb2NrRGVsZXRlIGV4dGVuZHMgQmxvY2tCYXNlIHtcbiAgb2xkWG1sPzogRWxlbWVudHxEb2N1bWVudEZyYWdtZW50O1xuICBpZHM/OiBzdHJpbmdbXTtcbiAgd2FzU2hhZG93PzogYm9vbGVhbjtcbiAgb2xkSnNvbj86IGJsb2Nrcy5TdGF0ZTtcbiAgb3ZlcnJpZGUgdHlwZSA9IGV2ZW50VXRpbHMuQkxPQ0tfREVMRVRFO1xuXG4gIC8qKiBAcGFyYW0gb3B0X2Jsb2NrIFRoZSBkZWxldGVkIGJsb2NrLiAgVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LiAqL1xuICBjb25zdHJ1Y3RvcihvcHRfYmxvY2s/OiBCbG9jaykge1xuICAgIHN1cGVyKG9wdF9ibG9jayk7XG5cbiAgICBpZiAoIW9wdF9ibG9jaykge1xuICAgICAgcmV0dXJuOyAgLy8gQmxhbmsgZXZlbnQgdG8gYmUgcG9wdWxhdGVkIGJ5IGZyb21Kc29uLlxuICAgIH1cblxuICAgIGlmIChvcHRfYmxvY2suZ2V0UGFyZW50KCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdDb25uZWN0ZWQgYmxvY2tzIGNhbm5vdCBiZSBkZWxldGVkLicpO1xuICAgIH1cbiAgICBpZiAob3B0X2Jsb2NrLmlzU2hhZG93KCkpIHtcbiAgICAgIC8vIFJlc3Bhd25pbmcgc2hhZG93IGJsb2NrcyBpcyBoYW5kbGVkIHZpYSBkaXNjb25uZWN0aW9uLlxuICAgICAgdGhpcy5yZWNvcmRVbmRvID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5vbGRYbWwgPSBYbWwuYmxvY2tUb0RvbVdpdGhYWShvcHRfYmxvY2spO1xuICAgIHRoaXMuaWRzID0gZXZlbnRVdGlscy5nZXREZXNjZW5kYW50SWRzKG9wdF9ibG9jayk7XG5cbiAgICAvKiogV2FzIHRoZSBibG9jayB0aGF0IHdhcyBqdXN0IGRlbGV0ZWQgYSBzaGFkb3c/ICovXG4gICAgdGhpcy53YXNTaGFkb3cgPSBvcHRfYmxvY2suaXNTaGFkb3coKTtcblxuICAgIC8qKiBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBibG9jayB0aGF0IHdhcyBqdXN0IGRlbGV0ZWQuICovXG4gICAgdGhpcy5vbGRKc29uID1cbiAgICAgICAgYmxvY2tzLnNhdmUob3B0X2Jsb2NrLCB7YWRkQ29vcmRpbmF0ZXM6IHRydWV9KSBhcyBibG9ja3MuU3RhdGU7XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIHRoZSBldmVudCBhcyBKU09OLlxuICAgKlxuICAgKiBAcmV0dXJucyBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgdG9Kc29uKCk6IEJsb2NrRGVsZXRlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIEJsb2NrRGVsZXRlSnNvbjtcbiAgICBpZiAoIXRoaXMub2xkWG1sKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBvbGQgYmxvY2sgWE1MIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSBibG9jayAnICtcbiAgICAgICAgICAndG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5pZHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGJsb2NrIElEcyBhcmUgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKHRoaXMud2FzU2hhZG93ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnV2hldGhlciB0aGUgYmxvY2sgd2FzIGEgc2hhZG93IGlzIHVuZGVmaW5lZC4gRWl0aGVyICcgK1xuICAgICAgICAgICdwYXNzIGEgYmxvY2sgdG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5vbGRKc29uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBvbGQgYmxvY2sgSlNPTiBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgYmxvY2sgJyArXG4gICAgICAgICAgJ3RvIHRoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBqc29uWydvbGRYbWwnXSA9IFhtbC5kb21Ub1RleHQodGhpcy5vbGRYbWwpO1xuICAgIGpzb25bJ2lkcyddID0gdGhpcy5pZHM7XG4gICAganNvblsnd2FzU2hhZG93J10gPSB0aGlzLndhc1NoYWRvdztcbiAgICBqc29uWydvbGRKc29uJ10gPSB0aGlzLm9sZEpzb247XG4gICAgaWYgKCF0aGlzLnJlY29yZFVuZG8pIHtcbiAgICAgIGpzb25bJ3JlY29yZFVuZG8nXSA9IHRoaXMucmVjb3JkVW5kbztcbiAgICB9XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogQmxvY2tEZWxldGVKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLkJsb2NrRGVsZXRlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMub2xkWG1sID0gWG1sLnRleHRUb0RvbShqc29uWydvbGRYbWwnXSk7XG4gICAgdGhpcy5pZHMgPSBqc29uWydpZHMnXTtcbiAgICB0aGlzLndhc1NoYWRvdyA9XG4gICAgICAgIGpzb25bJ3dhc1NoYWRvdyddIHx8IHRoaXMub2xkWG1sLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NoYWRvdyc7XG4gICAgdGhpcy5vbGRKc29uID0ganNvblsnb2xkSnNvbiddO1xuICAgIGlmIChqc29uWydyZWNvcmRVbmRvJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5yZWNvcmRVbmRvID0ganNvblsncmVjb3JkVW5kbyddO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgQmxvY2tEZWxldGUsIGJ1dCB3ZSBjYW4ndCBzcGVjaWZ5IHRoYXQgZHVlIHRvIHRoZSBmYWN0IHRoYXRcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3ViY2xhc3NlcyBtdXN0IGJlIHN1cGVydHlwZXMgb2ZcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3VwZXJjbGFzc2VzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBCbG9ja0RlbGV0ZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlLCBldmVudD86IGFueSk6XG4gICAgICBCbG9ja0RlbGV0ZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBCbG9ja0RlbGV0ZSgpKSBhc1xuICAgICAgICBCbG9ja0RlbGV0ZTtcbiAgICBuZXdFdmVudC5vbGRYbWwgPSBYbWwudGV4dFRvRG9tKGpzb25bJ29sZFhtbCddKTtcbiAgICBuZXdFdmVudC5pZHMgPSBqc29uWydpZHMnXTtcbiAgICBuZXdFdmVudC53YXNTaGFkb3cgPVxuICAgICAgICBqc29uWyd3YXNTaGFkb3cnXSB8fCBuZXdFdmVudC5vbGRYbWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2hhZG93JztcbiAgICBuZXdFdmVudC5vbGRKc29uID0ganNvblsnb2xkSnNvbiddO1xuICAgIGlmIChqc29uWydyZWNvcmRVbmRvJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3RXZlbnQucmVjb3JkVW5kbyA9IGpzb25bJ3JlY29yZFVuZG8nXTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1biBhIGRlbGV0aW9uIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZm9yd2FyZCBUcnVlIGlmIHJ1biBmb3J3YXJkLCBmYWxzZSBpZiBydW4gYmFja3dhcmQgKHVuZG8pLlxuICAgKi9cbiAgb3ZlcnJpZGUgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmdldEV2ZW50V29ya3NwYWNlXygpO1xuICAgIGlmICghdGhpcy5pZHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGJsb2NrIElEcyBhcmUgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm9sZEpzb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIG9sZCBibG9jayBKU09OIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSBibG9jayAnICtcbiAgICAgICAgICAndG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5pZHNbaV07XG4gICAgICAgIGNvbnN0IGJsb2NrID0gd29ya3NwYWNlLmdldEJsb2NrQnlJZChpZCk7XG4gICAgICAgIGlmIChibG9jaykge1xuICAgICAgICAgIGJsb2NrLmRpc3Bvc2UoZmFsc2UpO1xuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSB0aGlzLmJsb2NrSWQpIHtcbiAgICAgICAgICAvLyBPbmx5IGNvbXBsYWluIGFib3V0IHJvb3QtbGV2ZWwgYmxvY2suXG4gICAgICAgICAgY29uc29sZS53YXJuKCdDYW5cXCd0IGRlbGV0ZSBub24tZXhpc3RlbnQgYmxvY2s6ICcgKyBpZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYmxvY2tzLmFwcGVuZCh0aGlzLm9sZEpzb24sIHdvcmtzcGFjZSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmxvY2tEZWxldGVKc29uIGV4dGVuZHMgQmxvY2tCYXNlSnNvbiB7XG4gIG9sZFhtbDogc3RyaW5nO1xuICBpZHM6IHN0cmluZ1tdO1xuICB3YXNTaGFkb3c6IGJvb2xlYW47XG4gIG9sZEpzb246IGJsb2Nrcy5TdGF0ZTtcbiAgcmVjb3JkVW5kbz86IGJvb2xlYW47XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuREVMRVRFLCBCbG9ja0RlbGV0ZSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQW4gZW51bSBmb3IgdGhlIHBvc3NpYmxlIHR5cGVzIG9mIGNvbm5lY3Rpb25zLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5Db25uZWN0aW9uVHlwZVxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkNvbm5lY3Rpb25UeXBlJyk7XG5cblxuLyoqXG4gKiBFbnVtIGZvciB0aGUgdHlwZSBvZiBhIGNvbm5lY3Rpb24gb3IgaW5wdXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29ubmVjdGlvblR5cGVcbiAqL1xuZXhwb3J0IGVudW0gQ29ubmVjdGlvblR5cGUge1xuICAvLyBBIHJpZ2h0LWZhY2luZyB2YWx1ZSBpbnB1dC4gIEUuZy4gJ3NldCBpdGVtIHRvJyBvciAncmV0dXJuJy5cbiAgSU5QVVRfVkFMVUUgPSAxLFxuICAvLyBBIGxlZnQtZmFjaW5nIHZhbHVlIG91dHB1dC4gIEUuZy4gJ3JhbmRvbSBmcmFjdGlvbicuXG4gIE9VVFBVVF9WQUxVRSxcbiAgLy8gQSBkb3duLWZhY2luZyBibG9jayBzdGFjay4gIEUuZy4gJ2lmLWRvJyBvciAnZWxzZScuXG4gIE5FWFRfU1RBVEVNRU5ULFxuICAvLyBBbiB1cC1mYWNpbmcgYmxvY2sgc3RhY2suICBFLmcuICdicmVhayBvdXQgb2YgbG9vcCcuXG4gIFBSRVZJT1VTX1NUQVRFTUVOVFxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEJsb2NrbHkgY29uc3RhbnRzLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5jb25zdGFudHNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5jb25zdGFudHMnKTtcblxuXG4vKipcbiAqIFRoZSBsYW5ndWFnZS1uZXV0cmFsIElEIGdpdmVuIHRvIHRoZSBjb2xsYXBzZWQgaW5wdXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuY29uc3RhbnRzLkNPTExBUFNFRF9JTlBVVF9OQU1FXG4gKi9cbmV4cG9ydCBjb25zdCBDT0xMQVBTRURfSU5QVVRfTkFNRSA9ICdfVEVNUF9DT0xMQVBTRURfSU5QVVQnO1xuXG4vKipcbiAqIFRoZSBsYW5ndWFnZS1uZXV0cmFsIElEIGdpdmVuIHRvIHRoZSBjb2xsYXBzZWQgZmllbGQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuY29uc3RhbnRzLkNPTExBUFNFRF9GSUVMRF9OQU1FXG4gKi9cbmV4cG9ydCBjb25zdCBDT0xMQVBTRURfRklFTERfTkFNRSA9ICdfVEVNUF9DT0xMQVBTRURfRklFTEQnO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE5vbi1lZGl0YWJsZSwgbm9uLXNlcmlhbGl6YWJsZSB0ZXh0IGZpZWxkLiAgVXNlZCBmb3IgdGl0bGVzLFxuICogICAgbGFiZWxzLCBldGMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRmllbGRMYWJlbCcpO1xuXG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtGaWVsZCwgRmllbGRDb25maWd9IGZyb20gJy4vZmllbGQuanMnO1xuaW1wb3J0ICogYXMgZmllbGRSZWdpc3RyeSBmcm9tICcuL2ZpZWxkX3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIHBhcnNpbmcgZnJvbSAnLi91dGlscy9wYXJzaW5nLmpzJztcbmltcG9ydCB0eXBlIHtTZW50aW5lbH0gZnJvbSAnLi91dGlscy9zZW50aW5lbC5qcyc7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgbm9uLWVkaXRhYmxlLCBub24tc2VyaWFsaXphYmxlIHRleHQgZmllbGQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmllbGRMYWJlbFxuICovXG5leHBvcnQgY2xhc3MgRmllbGRMYWJlbCBleHRlbmRzIEZpZWxkPHN0cmluZz4ge1xuICAvKiogVGhlIGh0bWwgY2xhc3MgbmFtZSB0byB1c2UgZm9yIHRoaXMgZmllbGQuICovXG4gIHByaXZhdGUgY2xhc3NfOiBzdHJpbmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEVkaXRhYmxlIGZpZWxkcyB1c3VhbGx5IHNob3cgc29tZSBzb3J0IG9mIFVJIGluZGljYXRpbmcgdGhleSBhcmVcbiAgICogZWRpdGFibGUuIFRoaXMgZmllbGQgc2hvdWxkIG5vdC5cbiAgICovXG4gIG92ZXJyaWRlIEVESVRBQkxFID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfdmFsdWUgVGhlIGluaXRpYWwgdmFsdWUgb2YgdGhlIGZpZWxkLiBTaG91bGQgY2FzdCB0byBhIHN0cmluZy5cbiAgICogICAgIERlZmF1bHRzIHRvIGFuIGVtcHR5IHN0cmluZyBpZiBudWxsIG9yIHVuZGVmaW5lZC4gQWxzbyBhY2NlcHRzXG4gICAqICAgICBGaWVsZC5TS0lQX1NFVFVQIGlmIHlvdSB3aXNoIHRvIHNraXAgc2V0dXAgKG9ubHkgdXNlZCBieSBzdWJjbGFzc2VzXG4gICAqICAgICB0aGF0IHdhbnQgdG8gaGFuZGxlIGNvbmZpZ3VyYXRpb24gYW5kIHNldHRpbmcgdGhlIGZpZWxkIHZhbHVlIGFmdGVyXG4gICAqICAgICB0aGVpciBvd24gY29uc3RydWN0b3JzIGhhdmUgcnVuKS5cbiAgICogQHBhcmFtIG9wdF9jbGFzcyBPcHRpb25hbCBDU1MgY2xhc3MgZm9yIHRoZSBmaWVsZCdzIHRleHQuXG4gICAqIEBwYXJhbSBvcHRfY29uZmlnIEEgbWFwIG9mIG9wdGlvbnMgdXNlZCB0byBjb25maWd1cmUgdGhlIGZpZWxkLlxuICAgKiAgICBTZWUgdGhlIFtmaWVsZCBjcmVhdGlvbiBkb2N1bWVudGF0aW9uXXtAbGlua1xuICAgKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy9maWVsZHMvYnVpbHQtaW4tZmllbGRzL2xhYmVsI2NyZWF0aW9ufVxuICAgKiBmb3IgYSBsaXN0IG9mIHByb3BlcnRpZXMgdGhpcyBwYXJhbWV0ZXIgc3VwcG9ydHMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIG9wdF92YWx1ZT86IHN0cmluZ3xTZW50aW5lbCwgb3B0X2NsYXNzPzogc3RyaW5nLFxuICAgICAgb3B0X2NvbmZpZz86IEZpZWxkTGFiZWxDb25maWcpIHtcbiAgICBzdXBlcihGaWVsZC5TS0lQX1NFVFVQKTtcblxuICAgIGlmIChvcHRfdmFsdWUgPT09IEZpZWxkLlNLSVBfU0VUVVApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKG9wdF9jb25maWcpIHtcbiAgICAgIHRoaXMuY29uZmlndXJlXyhvcHRfY29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbGFzc18gPSBvcHRfY2xhc3MgfHwgbnVsbDtcbiAgICB9XG4gICAgdGhpcy5zZXRWYWx1ZShvcHRfdmFsdWUpO1xuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGNvbmZpZ3VyZV8oY29uZmlnOiBGaWVsZExhYmVsQ29uZmlnKSB7XG4gICAgc3VwZXIuY29uZmlndXJlXyhjb25maWcpO1xuICAgIGlmIChjb25maWcuY2xhc3MpIHRoaXMuY2xhc3NfID0gY29uZmlnLmNsYXNzO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBibG9jayBVSSBmb3IgdGhpcyBsYWJlbC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBpbml0VmlldygpIHtcbiAgICB0aGlzLmNyZWF0ZVRleHRFbGVtZW50XygpO1xuICAgIGlmICh0aGlzLmNsYXNzXykge1xuICAgICAgZG9tLmFkZENsYXNzKHRoaXMuZ2V0VGV4dEVsZW1lbnQoKSwgdGhpcy5jbGFzc18pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmUgdGhhdCB0aGUgaW5wdXQgdmFsdWUgY2FzdHMgdG8gYSB2YWxpZCBzdHJpbmcuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfbmV3VmFsdWUgVGhlIGlucHV0IHZhbHVlLlxuICAgKiBAcmV0dXJucyBBIHZhbGlkIHN0cmluZywgb3IgbnVsbCBpZiBpbnZhbGlkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvQ2xhc3NWYWxpZGF0aW9uXyhvcHRfbmV3VmFsdWU/OiBBbnlEdXJpbmdNaWdyYXRpb24pOlxuICAgICAgc3RyaW5nfG51bGwge1xuICAgIGlmIChvcHRfbmV3VmFsdWUgPT09IG51bGwgfHwgb3B0X25ld1ZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gU3RyaW5nKG9wdF9uZXdWYWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBDU1MgY2xhc3MgYXBwbGllZCB0byB0aGUgZmllbGQncyB0ZXh0RWxlbWVudF8uXG4gICAqXG4gICAqIEBwYXJhbSBjc3NDbGFzcyBUaGUgbmV3IENTUyBjbGFzcyBuYW1lLCBvciBudWxsIHRvIHJlbW92ZS5cbiAgICovXG4gIHNldENsYXNzKGNzc0NsYXNzOiBzdHJpbmd8bnVsbCkge1xuICAgIGlmICh0aGlzLnRleHRFbGVtZW50Xykge1xuICAgICAgaWYgKHRoaXMuY2xhc3NfKSB7XG4gICAgICAgIGRvbS5yZW1vdmVDbGFzcyh0aGlzLnRleHRFbGVtZW50XywgdGhpcy5jbGFzc18pO1xuICAgICAgfVxuICAgICAgaWYgKGNzc0NsYXNzKSB7XG4gICAgICAgIGRvbS5hZGRDbGFzcyh0aGlzLnRleHRFbGVtZW50XywgY3NzQ2xhc3MpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmNsYXNzXyA9IGNzc0NsYXNzO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdCBhIEZpZWxkTGFiZWwgZnJvbSBhIEpTT04gYXJnIG9iamVjdCxcbiAgICogZGVyZWZlcmVuY2luZyBhbnkgc3RyaW5nIHRhYmxlIHJlZmVyZW5jZXMuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIEEgSlNPTiBvYmplY3Qgd2l0aCBvcHRpb25zICh0ZXh0LCBhbmQgY2xhc3MpLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihvcHRpb25zOiBGaWVsZExhYmVsRnJvbUpzb25Db25maWcpOiBGaWVsZExhYmVsIHtcbiAgICBjb25zdCB0ZXh0ID0gcGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMob3B0aW9ucy50ZXh0KTtcbiAgICAvLyBgdGhpc2AgbWlnaHQgYmUgYSBzdWJjbGFzcyBvZiBGaWVsZExhYmVsIGlmIHRoYXQgY2xhc3MgZG9lc24ndCBvdmVycmlkZVxuICAgIC8vIHRoZSBzdGF0aWMgZnJvbUpzb24gbWV0aG9kLlxuICAgIHJldHVybiBuZXcgdGhpcyh0ZXh0LCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICB9XG59XG5cbmZpZWxkUmVnaXN0cnkucmVnaXN0ZXIoJ2ZpZWxkX2xhYmVsJywgRmllbGRMYWJlbCk7XG5cbkZpZWxkTGFiZWwucHJvdG90eXBlLkRFRkFVTFRfVkFMVUUgPSAnJztcblxuLy8gY2xhbmctZm9ybWF0IG9mZlxuLy8gQ2xhbmcgZG9lcyBub3QgbGlrZSB0aGUgJ2NsYXNzJyBrZXl3b3JkIGJlaW5nIHVzZWQgYXMgYSBwcm9wZXJ0eS5cbi8qKlxuICogQ29uZmlnIG9wdGlvbnMgZm9yIHRoZSBsYWJlbCBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZExhYmVsQ29uZmlnIGV4dGVuZHMgRmllbGRDb25maWcge1xuICBjbGFzcz86IHN0cmluZztcbn1cbi8vIGNsYW5nLWZvcm1hdCBvblxuXG5cbi8qKlxuICogZnJvbUpzb24gY29uZmlnIG9wdGlvbnMgZm9yIHRoZSBsYWJlbCBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZExhYmVsRnJvbUpzb25Db25maWcgZXh0ZW5kcyBGaWVsZExhYmVsQ29uZmlnIHtcbiAgdGV4dD86IHN0cmluZztcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGFuIGlucHV0ICh2YWx1ZSwgc3RhdGVtZW50LCBvciBkdW1teSkuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuSW5wdXQnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2ZpZWxkX2xhYmVsLmpzJztcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Nvbm5lY3Rpb259IGZyb20gJy4vY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7RmllbGR9IGZyb20gJy4vZmllbGQuanMnO1xuaW1wb3J0ICogYXMgZmllbGRSZWdpc3RyeSBmcm9tICcuL2ZpZWxkX3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7aW5wdXRUeXBlc30gZnJvbSAnLi9pbnB1dF90eXBlcy5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuL3JlbmRlcmVkX2Nvbm5lY3Rpb24uanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGFuIGlucHV0IHdpdGggYW4gb3B0aW9uYWwgZmllbGQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuSW5wdXRcbiAqL1xuZXhwb3J0IGNsYXNzIElucHV0IHtcbiAgcHJpdmF0ZSBzb3VyY2VCbG9jazogQmxvY2s7XG4gIGZpZWxkUm93OiBGaWVsZFtdID0gW107XG4gIC8qKiBBbGlnbm1lbnQgb2YgaW5wdXQncyBmaWVsZHMgKGxlZnQsIHJpZ2h0IG9yIGNlbnRyZSkuICovXG4gIGFsaWduID0gQWxpZ24uTEVGVDtcblxuICAvKiogSXMgdGhlIGlucHV0IHZpc2libGU/ICovXG4gIHByaXZhdGUgdmlzaWJsZSA9IHRydWU7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBpbnB1dC5cbiAgICogQHBhcmFtIG5hbWUgTGFuZ3VhZ2UtbmV1dHJhbCBpZGVudGlmaWVyIHdoaWNoIG1heSB1c2VkIHRvIGZpbmQgdGhpcyBpbnB1dFxuICAgKiAgICAgYWdhaW4uXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgY29udGFpbmluZyB0aGlzIGlucHV0LlxuICAgKiBAcGFyYW0gY29ubmVjdGlvbiBPcHRpb25hbCBjb25uZWN0aW9uIGZvciB0aGlzIGlucHV0LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBwdWJsaWMgdHlwZTogbnVtYmVyLCBwdWJsaWMgbmFtZTogc3RyaW5nLCBibG9jazogQmxvY2ssXG4gICAgICBwdWJsaWMgY29ubmVjdGlvbjogQ29ubmVjdGlvbnxudWxsKSB7XG4gICAgaWYgKHR5cGUgIT09IGlucHV0VHlwZXMuRFVNTVkgJiYgIW5hbWUpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdWYWx1ZSBpbnB1dHMgYW5kIHN0YXRlbWVudCBpbnB1dHMgbXVzdCBoYXZlIG5vbi1lbXB0eSBuYW1lLicpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZUJsb2NrID0gYmxvY2s7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzb3VyY2UgYmxvY2sgZm9yIHRoaXMgaW5wdXQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBibG9jayB0aGlzIGlucHV0IGlzIHBhcnQgb2YuXG4gICAqL1xuICBnZXRTb3VyY2VCbG9jaygpOiBCbG9jayB7XG4gICAgcmV0dXJuIHRoaXMuc291cmNlQmxvY2s7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgZmllbGQgKG9yIGxhYmVsIGZyb20gc3RyaW5nKSwgYW5kIGFsbCBwcmVmaXggYW5kIHN1ZmZpeCBmaWVsZHMsIHRvXG4gICAqIHRoZSBlbmQgb2YgdGhlIGlucHV0J3MgZmllbGQgcm93LlxuICAgKlxuICAgKiBAcGFyYW0gZmllbGQgU29tZXRoaW5nIHRvIGFkZCBhcyBhIGZpZWxkLlxuICAgKiBAcGFyYW0gb3B0X25hbWUgTGFuZ3VhZ2UtbmV1dHJhbCBpZGVudGlmaWVyIHdoaWNoIG1heSB1c2VkIHRvIGZpbmQgdGhpc1xuICAgKiAgICAgZmllbGQgYWdhaW4uICBTaG91bGQgYmUgdW5pcXVlIHRvIHRoZSBob3N0IGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgYmVpbmcgYXBwZW5kIHRvICh0byBhbGxvdyBjaGFpbmluZykuXG4gICAqL1xuICBhcHBlbmRGaWVsZDxUPihmaWVsZDogc3RyaW5nfEZpZWxkPFQ+LCBvcHRfbmFtZT86IHN0cmluZyk6IElucHV0IHtcbiAgICB0aGlzLmluc2VydEZpZWxkQXQodGhpcy5maWVsZFJvdy5sZW5ndGgsIGZpZWxkLCBvcHRfbmFtZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogSW5zZXJ0cyBhIGZpZWxkIChvciBsYWJlbCBmcm9tIHN0cmluZyksIGFuZCBhbGwgcHJlZml4IGFuZCBzdWZmaXggZmllbGRzLFxuICAgKiBhdCB0aGUgbG9jYXRpb24gb2YgdGhlIGlucHV0J3MgZmllbGQgcm93LlxuICAgKlxuICAgKiBAcGFyYW0gaW5kZXggVGhlIGluZGV4IGF0IHdoaWNoIHRvIGluc2VydCBmaWVsZC5cbiAgICogQHBhcmFtIGZpZWxkIFNvbWV0aGluZyB0byBhZGQgYXMgYSBmaWVsZC5cbiAgICogQHBhcmFtIG9wdF9uYW1lIExhbmd1YWdlLW5ldXRyYWwgaWRlbnRpZmllciB3aGljaCBtYXkgdXNlZCB0byBmaW5kIHRoaXNcbiAgICogICAgIGZpZWxkIGFnYWluLiAgU2hvdWxkIGJlIHVuaXF1ZSB0byB0aGUgaG9zdCBibG9jay5cbiAgICogQHJldHVybnMgVGhlIGluZGV4IGZvbGxvd2luZyB0aGUgbGFzdCBpbnNlcnRlZCBmaWVsZC5cbiAgICovXG4gIGluc2VydEZpZWxkQXQ8VD4oaW5kZXg6IG51bWJlciwgZmllbGQ6IHN0cmluZ3xGaWVsZDxUPiwgb3B0X25hbWU/OiBzdHJpbmcpOlxuICAgICAgbnVtYmVyIHtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gdGhpcy5maWVsZFJvdy5sZW5ndGgpIHtcbiAgICAgIHRocm93IEVycm9yKCdpbmRleCAnICsgaW5kZXggKyAnIG91dCBvZiBib3VuZHMuJyk7XG4gICAgfVxuICAgIC8vIEZhbHN5IGZpZWxkIHZhbHVlcyBkb24ndCBnZW5lcmF0ZSBhIGZpZWxkLCB1bmxlc3MgdGhlIGZpZWxkIGlzIGFuIGVtcHR5XG4gICAgLy8gc3RyaW5nIGFuZCBuYW1lZC5cbiAgICBpZiAoIWZpZWxkICYmICEoZmllbGQgPT09ICcnICYmIG9wdF9uYW1lKSkge1xuICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGEgRmllbGRMYWJlbCB3aGVuIGdpdmVuIGEgcGxhaW4gdGV4dCBmaWVsZC5cbiAgICBpZiAodHlwZW9mIGZpZWxkID09PSAnc3RyaW5nJykge1xuICAgICAgZmllbGQgPSBmaWVsZFJlZ2lzdHJ5LmZyb21Kc29uKHtcbiAgICAgICAgdHlwZTogJ2ZpZWxkX2xhYmVsJyxcbiAgICAgICAgdGV4dDogZmllbGQsXG4gICAgICB9KSE7XG4gICAgfVxuXG4gICAgZmllbGQuc2V0U291cmNlQmxvY2sodGhpcy5zb3VyY2VCbG9jayk7XG4gICAgaWYgKHRoaXMuc291cmNlQmxvY2sucmVuZGVyZWQpIHtcbiAgICAgIGZpZWxkLmluaXQoKTtcbiAgICAgIGZpZWxkLmFwcGx5Q29sb3VyKCk7XG4gICAgfVxuICAgIGZpZWxkLm5hbWUgPSBvcHRfbmFtZTtcbiAgICBmaWVsZC5zZXRWaXNpYmxlKHRoaXMuaXNWaXNpYmxlKCkpO1xuXG4gICAgaWYgKGZpZWxkLnByZWZpeEZpZWxkKSB7XG4gICAgICAvLyBBZGQgYW55IHByZWZpeC5cbiAgICAgIGluZGV4ID0gdGhpcy5pbnNlcnRGaWVsZEF0KGluZGV4LCBmaWVsZC5wcmVmaXhGaWVsZCk7XG4gICAgfVxuICAgIC8vIEFkZCB0aGUgZmllbGQgdG8gdGhlIGZpZWxkIHJvdy5cbiAgICB0aGlzLmZpZWxkUm93LnNwbGljZShpbmRleCwgMCwgZmllbGQgYXMgRmllbGQpO1xuICAgIGluZGV4Kys7XG4gICAgaWYgKGZpZWxkLnN1ZmZpeEZpZWxkKSB7XG4gICAgICAvLyBBZGQgYW55IHN1ZmZpeC5cbiAgICAgIGluZGV4ID0gdGhpcy5pbnNlcnRGaWVsZEF0KGluZGV4LCBmaWVsZC5zdWZmaXhGaWVsZCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc291cmNlQmxvY2sucmVuZGVyZWQpIHtcbiAgICAgICh0aGlzLnNvdXJjZUJsb2NrIGFzIEJsb2NrU3ZnKS5yZW5kZXIoKTtcbiAgICAgIC8vIEFkZGluZyBhIGZpZWxkIHdpbGwgY2F1c2UgdGhlIGJsb2NrIHRvIGNoYW5nZSBzaGFwZS5cbiAgICAgIHRoaXMuc291cmNlQmxvY2suYnVtcE5laWdoYm91cnMoKTtcbiAgICB9XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIGZpZWxkIGZyb20gdGhpcyBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpZWxkLlxuICAgKiBAcGFyYW0gb3B0X3F1aWV0IFRydWUgdG8gcHJldmVudCBhbiBlcnJvciBpZiBmaWVsZCBpcyBub3QgcHJlc2VudC5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiBvcGVyYXRpb24gc3VjY2VlZHMsIGZhbHNlIGlmIGZpZWxkIGlzIG5vdCBwcmVzZW50IGFuZFxuICAgKiAgICAgb3B0X3F1aWV0IGlzIHRydWUuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgZmllbGQgaXMgbm90IHByZXNlbnQgYW5kIG9wdF9xdWlldCBpcyBmYWxzZS5cbiAgICovXG4gIHJlbW92ZUZpZWxkKG5hbWU6IHN0cmluZywgb3B0X3F1aWV0PzogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGkgPSAwLCBmaWVsZDsgZmllbGQgPSB0aGlzLmZpZWxkUm93W2ldOyBpKyspIHtcbiAgICAgIGlmIChmaWVsZC5uYW1lID09PSBuYW1lKSB7XG4gICAgICAgIGZpZWxkLmRpc3Bvc2UoKTtcbiAgICAgICAgdGhpcy5maWVsZFJvdy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZUJsb2NrLnJlbmRlcmVkKSB7XG4gICAgICAgICAgKHRoaXMuc291cmNlQmxvY2sgYXMgQmxvY2tTdmcpLnJlbmRlcigpO1xuICAgICAgICAgIC8vIFJlbW92aW5nIGEgZmllbGQgd2lsbCBjYXVzZSB0aGUgYmxvY2sgdG8gY2hhbmdlIHNoYXBlLlxuICAgICAgICAgIHRoaXMuc291cmNlQmxvY2suYnVtcE5laWdoYm91cnMoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9wdF9xdWlldCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aHJvdyBFcnJvcignRmllbGQgXCInICsgbmFtZSArICdcIiBub3QgZm91bmQuJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB3aGV0aGVyIHRoaXMgaW5wdXQgaXMgdmlzaWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdmlzaWJsZS5cbiAgICovXG4gIGlzVmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy52aXNpYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgd2hldGhlciB0aGlzIGlucHV0IGlzIHZpc2libGUgb3Igbm90LlxuICAgKiBTaG91bGQgb25seSBiZSB1c2VkIHRvIGNvbGxhcHNlL3VuY29sbGFwc2UgYSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIHZpc2libGUgVHJ1ZSBpZiB2aXNpYmxlLlxuICAgKiBAcmV0dXJucyBMaXN0IG9mIGJsb2NrcyB0byByZW5kZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0VmlzaWJsZSh2aXNpYmxlOiBib29sZWFuKTogQmxvY2tTdmdbXSB7XG4gICAgLy8gTm90ZTogQ3VycmVudGx5IHRoZXJlIGFyZSBvbmx5IHVuaXQgdGVzdHMgZm9yIGJsb2NrLnNldENvbGxhcHNlZCgpXG4gICAgLy8gYmVjYXVzZSB0aGlzIGZ1bmN0aW9uIGlzIHBhY2thZ2UuIElmIHRoaXMgZnVuY3Rpb24gZ29lcyBiYWNrIHRvIGJlaW5nIGFcbiAgICAvLyBwdWJsaWMgQVBJIHRlc3RzIChsb3RzIG9mIHRlc3RzKSBzaG91bGQgYmUgYWRkZWQuXG4gICAgbGV0IHJlbmRlckxpc3Q6IEFueUR1cmluZ01pZ3JhdGlvbltdID0gW107XG4gICAgaWYgKHRoaXMudmlzaWJsZSA9PT0gdmlzaWJsZSkge1xuICAgICAgcmV0dXJuIHJlbmRlckxpc3Q7XG4gICAgfVxuICAgIHRoaXMudmlzaWJsZSA9IHZpc2libGU7XG5cbiAgICBmb3IgKGxldCB5ID0gMCwgZmllbGQ7IGZpZWxkID0gdGhpcy5maWVsZFJvd1t5XTsgeSsrKSB7XG4gICAgICBmaWVsZC5zZXRWaXNpYmxlKHZpc2libGUpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25uZWN0aW9uKSB7XG4gICAgICBjb25zdCByZW5kZXJlZENvbm5lY3Rpb24gPSB0aGlzLmNvbm5lY3Rpb24gYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuICAgICAgLy8gSGFzIGEgY29ubmVjdGlvbi5cbiAgICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICAgIHJlbmRlckxpc3QgPSByZW5kZXJlZENvbm5lY3Rpb24uc3RhcnRUcmFja2luZ0FsbCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVuZGVyZWRDb25uZWN0aW9uLnN0b3BUcmFja2luZ0FsbCgpO1xuICAgICAgfVxuICAgICAgY29uc3QgY2hpbGQgPSByZW5kZXJlZENvbm5lY3Rpb24udGFyZ2V0QmxvY2soKTtcbiAgICAgIGlmIChjaGlsZCkge1xuICAgICAgICBjaGlsZC5nZXRTdmdSb290KCkuc3R5bGUuZGlzcGxheSA9IHZpc2libGUgPyAnYmxvY2snIDogJ25vbmUnO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVuZGVyTGlzdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXJrIGFsbCBmaWVsZHMgb24gdGhpcyBpbnB1dCBhcyBkaXJ0eS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYXJrRGlydHkoKSB7XG4gICAgZm9yIChsZXQgeSA9IDAsIGZpZWxkOyBmaWVsZCA9IHRoaXMuZmllbGRSb3dbeV07IHkrKykge1xuICAgICAgZmllbGQubWFya0RpcnR5KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSBhIGNvbm5lY3Rpb24ncyBjb21wYXRpYmlsaXR5LlxuICAgKlxuICAgKiBAcGFyYW0gY2hlY2sgQ29tcGF0aWJsZSB2YWx1ZSB0eXBlIG9yIGxpc3Qgb2YgdmFsdWUgdHlwZXMuICBOdWxsIGlmIGFsbFxuICAgKiAgICAgdHlwZXMgYXJlIGNvbXBhdGlibGUuXG4gICAqIEByZXR1cm5zIFRoZSBpbnB1dCBiZWluZyBtb2RpZmllZCAodG8gYWxsb3cgY2hhaW5pbmcpLlxuICAgKi9cbiAgc2V0Q2hlY2soY2hlY2s6IHN0cmluZ3xzdHJpbmdbXXxudWxsKTogSW5wdXQge1xuICAgIGlmICghdGhpcy5jb25uZWN0aW9uKSB7XG4gICAgICB0aHJvdyBFcnJvcignVGhpcyBpbnB1dCBkb2VzIG5vdCBoYXZlIGEgY29ubmVjdGlvbi4nKTtcbiAgICB9XG4gICAgdGhpcy5jb25uZWN0aW9uLnNldENoZWNrKGNoZWNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGhlIGFsaWdubWVudCBvZiB0aGUgY29ubmVjdGlvbidzIGZpZWxkKHMpLlxuICAgKlxuICAgKiBAcGFyYW0gYWxpZ24gT25lIG9mIHRoZSB2YWx1ZXMgb2YgQWxpZ24uICBJbiBSVEwgbW9kZSBkaXJlY3Rpb25zXG4gICAqICAgICBhcmUgcmV2ZXJzZWQsIGFuZCBBbGlnbi5SSUdIVCBhbGlnbnMgdG8gdGhlIGxlZnQuXG4gICAqIEByZXR1cm5zIFRoZSBpbnB1dCBiZWluZyBtb2RpZmllZCAodG8gYWxsb3cgY2hhaW5pbmcpLlxuICAgKi9cbiAgc2V0QWxpZ24oYWxpZ246IEFsaWduKTogSW5wdXQge1xuICAgIHRoaXMuYWxpZ24gPSBhbGlnbjtcbiAgICBpZiAodGhpcy5zb3VyY2VCbG9jay5yZW5kZXJlZCkge1xuICAgICAgY29uc3Qgc291cmNlQmxvY2sgPSB0aGlzLnNvdXJjZUJsb2NrIGFzIEJsb2NrU3ZnO1xuICAgICAgc291cmNlQmxvY2sucmVuZGVyKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZXMgdGhlIGNvbm5lY3Rpb24ncyBzaGFkb3cgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBzaGFkb3cgRE9NIHJlcHJlc2VudGF0aW9uIG9mIGEgYmxvY2sgb3IgbnVsbC5cbiAgICogQHJldHVybnMgVGhlIGlucHV0IGJlaW5nIG1vZGlmaWVkICh0byBhbGxvdyBjaGFpbmluZykuXG4gICAqL1xuICBzZXRTaGFkb3dEb20oc2hhZG93OiBFbGVtZW50fG51bGwpOiBJbnB1dCB7XG4gICAgaWYgKCF0aGlzLmNvbm5lY3Rpb24pIHtcbiAgICAgIHRocm93IEVycm9yKCdUaGlzIGlucHV0IGRvZXMgbm90IGhhdmUgYSBjb25uZWN0aW9uLicpO1xuICAgIH1cbiAgICB0aGlzLmNvbm5lY3Rpb24uc2V0U2hhZG93RG9tKHNoYWRvdyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgWE1MIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb25uZWN0aW9uJ3Mgc2hhZG93IGJsb2NrLlxuICAgKlxuICAgKiBAcmV0dXJucyBTaGFkb3cgRE9NIHJlcHJlc2VudGF0aW9uIG9mIGEgYmxvY2sgb3IgbnVsbC5cbiAgICovXG4gIGdldFNoYWRvd0RvbSgpOiBFbGVtZW50fG51bGwge1xuICAgIGlmICghdGhpcy5jb25uZWN0aW9uKSB7XG4gICAgICB0aHJvdyBFcnJvcignVGhpcyBpbnB1dCBkb2VzIG5vdCBoYXZlIGEgY29ubmVjdGlvbi4nKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbi5nZXRTaGFkb3dEb20oKTtcbiAgfVxuXG4gIC8qKiBJbml0aWFsaXplIHRoZSBmaWVsZHMgb24gdGhpcyBpbnB1dC4gKi9cbiAgaW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlQmxvY2sud29ya3NwYWNlLnJlbmRlcmVkKSB7XG4gICAgICByZXR1cm47ICAvLyBIZWFkbGVzcyBibG9ja3MgZG9uJ3QgbmVlZCBmaWVsZHMgaW5pdGlhbGl6ZWQuXG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5maWVsZFJvdy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5maWVsZFJvd1tpXS5pbml0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldmVyIGFsbCBsaW5rcyB0byB0aGlzIGlucHV0LlxuICAgKlxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICBkaXNwb3NlKCkge1xuICAgIGZvciAobGV0IGkgPSAwLCBmaWVsZDsgZmllbGQgPSB0aGlzLmZpZWxkUm93W2ldOyBpKyspIHtcbiAgICAgIGZpZWxkLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29ubmVjdGlvbikge1xuICAgICAgdGhpcy5jb25uZWN0aW9uLmRpc3Bvc2UoKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBJbnB1dCB7XG4gIC8qKlxuICAgKiBFbnVtIGZvciBhbGlnbm1lbnQgb2YgaW5wdXRzLlxuICAgKlxuICAgKiBAYWxpYXMgQmxvY2tseS5JbnB1dC5BbGlnblxuICAgKi9cbiAgZXhwb3J0IGVudW0gQWxpZ24ge1xuICAgIExFRlQgPSAtMSxcbiAgICBDRU5UUkUgPSAwLFxuICAgIFJJR0hUID0gMSxcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBBbGlnbiA9IElucHV0LkFsaWduO1xuZXhwb3J0IGNvbnN0IEFsaWduID0gSW5wdXQuQWxpZ247XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBvbmUgYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuQmxvY2snKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfYmxvY2tfY2hhbmdlLmpzJztcbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX2Jsb2NrX2NyZWF0ZS5qcyc7XG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19kZWxldGUuanMnO1xuXG5pbXBvcnQge0Jsb2Nrc30gZnJvbSAnLi9ibG9ja3MuanMnO1xuaW1wb3J0IHR5cGUge0NvbW1lbnR9IGZyb20gJy4vY29tbWVudC5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB0eXBlIHtBYnN0cmFjdH0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja01vdmV9IGZyb20gJy4vZXZlbnRzL2V2ZW50c19ibG9ja19tb3ZlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0ICogYXMgRXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMuanMnO1xuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCAqIGFzIGZpZWxkUmVnaXN0cnkgZnJvbSAnLi9maWVsZF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge0FsaWduLCBJbnB1dH0gZnJvbSAnLi9pbnB1dC5qcyc7XG5pbXBvcnQge2lucHV0VHlwZXN9IGZyb20gJy4vaW5wdXRfdHlwZXMuanMnO1xuaW1wb3J0IHR5cGUge0lBU1ROb2RlTG9jYXRpb259IGZyb20gJy4vaW50ZXJmYWNlcy9pX2FzdF9ub2RlX2xvY2F0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtJRGVsZXRhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9kZWxldGFibGUuanMnO1xuaW1wb3J0IHtBU1ROb2RlfSBmcm9tICcuL2tleWJvYXJkX25hdi9hc3Rfbm9kZS5qcyc7XG5pbXBvcnQgdHlwZSB7TXV0YXRvcn0gZnJvbSAnLi9tdXRhdG9yLmpzJztcbmltcG9ydCAqIGFzIFRvb2x0aXAgZnJvbSAnLi90b29sdGlwLmpzJztcbmltcG9ydCAqIGFzIGFycmF5VXRpbHMgZnJvbSAnLi91dGlscy9hcnJheS5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBpZEdlbmVyYXRvciBmcm9tICcuL3V0aWxzL2lkZ2VuZXJhdG9yLmpzJztcbmltcG9ydCAqIGFzIHBhcnNpbmcgZnJvbSAnLi91dGlscy9wYXJzaW5nLmpzJztcbmltcG9ydCB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCB0eXBlIHtWYXJpYWJsZU1vZGVsfSBmcm9tICcuL3ZhcmlhYmxlX21vZGVsLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBvbmUgYmxvY2suXG4gKiBOb3Qgbm9ybWFsbHkgY2FsbGVkIGRpcmVjdGx5LCB3b3Jrc3BhY2UubmV3QmxvY2soKSBpcyBwcmVmZXJyZWQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQmxvY2tcbiAqL1xuZXhwb3J0IGNsYXNzIEJsb2NrIGltcGxlbWVudHMgSUFTVE5vZGVMb2NhdGlvbiwgSURlbGV0YWJsZSB7XG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBjYWxsYmFjayBtZXRob2QgdG8gdXNlIHdoZW5ldmVyIHRoZSBibG9jaydzIHBhcmVudCB3b3Jrc3BhY2VcbiAgICogY2hhbmdlcy4gVGhpcyBpcyB1c3VhbGx5IG9ubHkgY2FsbGVkIGZyb20gdGhlIGNvbnN0cnVjdG9yLCB0aGUgYmxvY2sgdHlwZVxuICAgKiBpbml0aWFsaXplciBmdW5jdGlvbiwgb3IgYW4gZXh0ZW5zaW9uIGluaXRpYWxpemVyIGZ1bmN0aW9uLlxuICAgKi9cbiAgb25jaGFuZ2U/OiAoKHAxOiBBYnN0cmFjdCkgPT4gQW55RHVyaW5nTWlncmF0aW9uKXxudWxsO1xuXG4gIC8qKiBUaGUgbGFuZ3VhZ2UtbmV1dHJhbCBJRCBnaXZlbiB0byB0aGUgY29sbGFwc2VkIGlucHV0LiAqL1xuICBzdGF0aWMgcmVhZG9ubHkgQ09MTEFQU0VEX0lOUFVUX05BTUU6IHN0cmluZyA9IGNvbnN0YW50cy5DT0xMQVBTRURfSU5QVVRfTkFNRTtcblxuICAvKiogVGhlIGxhbmd1YWdlLW5ldXRyYWwgSUQgZ2l2ZW4gdG8gdGhlIGNvbGxhcHNlZCBmaWVsZC4gKi9cbiAgc3RhdGljIHJlYWRvbmx5IENPTExBUFNFRF9GSUVMRF9OQU1FOiBzdHJpbmcgPSBjb25zdGFudHMuQ09MTEFQU0VEX0ZJRUxEX05BTUU7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIHRleHQgZGF0YSB0aGF0IHJvdW5kLXRyaXBzIGJldHdlZW4gYmxvY2tzIGFuZCBYTUwuXG4gICAqIEhhcyBubyBlZmZlY3QuIE1heSBiZSB1c2VkIGJ5IDNyZCBwYXJ0aWVzIGZvciBtZXRhIGluZm9ybWF0aW9uLlxuICAgKi9cbiAgZGF0YTogc3RyaW5nfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBIYXMgdGhpcyBibG9jayBiZWVuIGRpc3Bvc2VkIG9mP1xuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRpc3Bvc2VkID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIENvbG91ciBvZiB0aGUgYmxvY2sgYXMgSFNWIGh1ZSB2YWx1ZSAoMC0zNjApXG4gICAqIFRoaXMgbWF5IGJlIG51bGwgaWYgdGhlIGJsb2NrIGNvbG91ciB3YXMgbm90IHNldCB2aWEgYSBodWUgbnVtYmVyLlxuICAgKi9cbiAgcHJpdmF0ZSBodWVfOiBudW1iZXJ8bnVsbCA9IG51bGw7XG5cbiAgLyoqIENvbG91ciBvZiB0aGUgYmxvY2sgaW4gJyNSUkdHQkInIGZvcm1hdC4gKi9cbiAgcHJvdGVjdGVkIGNvbG91cl8gPSAnIzAwMDAwMCc7XG5cbiAgLyoqIE5hbWUgb2YgdGhlIGJsb2NrIHN0eWxlLiAqL1xuICBwcm90ZWN0ZWQgc3R5bGVOYW1lXyA9ICcnO1xuXG4gIC8qKiBBbiBvcHRpb25hbCBtZXRob2QgY2FsbGVkIGR1cmluZyBpbml0aWFsaXphdGlvbi4gKi9cbiAgaW5pdD86ICgoKSA9PiBBbnlEdXJpbmdNaWdyYXRpb24pfG51bGwgPSB1bmRlZmluZWQ7XG5cbiAgLyoqIEFuIG9wdGlvbmFsIG1ldGhvZCBjYWxsZWQgZHVyaW5nIGRpc3Bvc2FsLiAqL1xuICBkZXN0cm95PzogKCgpID0+IHZvaWQpID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBzZXJpYWxpemF0aW9uIG1ldGhvZCBmb3IgZGVmaW5pbmcgaG93IHRvIHNlcmlhbGl6ZSB0aGVcbiAgICogbXV0YXRpb24gc3RhdGUgdG8gWE1MLiBUaGlzIG11c3QgYmUgY291cGxlZCB3aXRoIGRlZmluaW5nXG4gICAqIGBkb21Ub011dGF0aW9uYC5cbiAgICovXG4gIG11dGF0aW9uVG9Eb20/OiAoKC4uLnAxOiBBbnlEdXJpbmdNaWdyYXRpb25bXSkgPT4gRWxlbWVudCl8bnVsbCA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgZGVzZXJpYWxpemF0aW9uIG1ldGhvZCBmb3IgZGVmaW5pbmcgaG93IHRvIGRlc2VyaWFsaXplIHRoZVxuICAgKiBtdXRhdGlvbiBzdGF0ZSBmcm9tIFhNTC4gVGhpcyBtdXN0IGJlIGNvdXBsZWQgd2l0aCBkZWZpbmluZ1xuICAgKiBgbXV0YXRpb25Ub0RvbWAuXG4gICAqL1xuICBkb21Ub011dGF0aW9uPzogKChwMTogRWxlbWVudCkgPT4gQW55RHVyaW5nTWlncmF0aW9uKXxudWxsID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBzZXJpYWxpemF0aW9uIG1ldGhvZCBmb3IgZGVmaW5pbmcgaG93IHRvIHNlcmlhbGl6ZSB0aGVcbiAgICogYmxvY2sncyBleHRyYSBzdGF0ZSAoZWcgbXV0YXRpb24gc3RhdGUpIHRvIHNvbWV0aGluZyBKU09OIGNvbXBhdGlibGUuXG4gICAqIFRoaXMgbXVzdCBiZSBjb3VwbGVkIHdpdGggZGVmaW5pbmcgYGxvYWRFeHRyYVN0YXRlYC5cbiAgICovXG4gIHNhdmVFeHRyYVN0YXRlPzogKCgpID0+IEFueUR1cmluZ01pZ3JhdGlvbil8bnVsbCA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgc2VyaWFsaXphdGlvbiBtZXRob2QgZm9yIGRlZmluaW5nIGhvdyB0byBkZXNlcmlhbGl6ZSB0aGVcbiAgICogYmxvY2sncyBleHRyYSBzdGF0ZSAoZWcgbXV0YXRpb24gc3RhdGUpIGZyb20gc29tZXRoaW5nIEpTT04gY29tcGF0aWJsZS5cbiAgICogVGhpcyBtdXN0IGJlIGNvdXBsZWQgd2l0aCBkZWZpbmluZyBgc2F2ZUV4dHJhU3RhdGVgLlxuICAgKi9cbiAgbG9hZEV4dHJhU3RhdGU/OlxuICAgICAgKChwMTogQW55RHVyaW5nTWlncmF0aW9uKSA9PiBBbnlEdXJpbmdNaWdyYXRpb24pfG51bGwgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEFuIG9wdGlvbmFsIHByb3BlcnR5IGZvciBzdXBwcmVzc2luZyBhZGRpbmcgU1RBVEVNRU5UX1BSRUZJWCBhbmRcbiAgICogU1RBVEVNRU5UX1NVRkZJWCB0byBnZW5lcmF0ZWQgY29kZS5cbiAgICovXG4gIHN1cHByZXNzUHJlZml4U3VmZml4OiBib29sZWFufG51bGwgPSBmYWxzZTtcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgcHJvcGVydHkgZm9yIGRlY2xhcmluZyBkZXZlbG9wZXIgdmFyaWFibGVzLiAgUmV0dXJuIGEgbGlzdCBvZlxuICAgKiB2YXJpYWJsZSBuYW1lcyBmb3IgdXNlIGJ5IGdlbmVyYXRvcnMuICBEZXZlbG9wZXIgdmFyaWFibGVzIGFyZSBuZXZlclxuICAgKiBzaG93biB0byB0aGUgdXNlciwgYnV0IGFyZSBkZWNsYXJlZCBhcyBnbG9iYWwgdmFyaWFibGVzIGluIHRoZSBnZW5lcmF0ZWRcbiAgICogY29kZS5cbiAgICovXG4gIGdldERldmVsb3BlclZhcmlhYmxlcz86ICgoKSA9PiBzdHJpbmdbXSkgPSB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIHRoYXQgcmVjb25maWd1cmVzIHRoZSBibG9jayBiYXNlZCBvbiB0aGUgY29udGVudHMgb2ZcbiAgICogdGhlIG11dGF0b3IgZGlhbG9nLlxuICAgKi9cbiAgY29tcG9zZT86ICgocDE6IEJsb2NrKSA9PiB2b2lkKSA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCBwb3B1bGF0ZXMgdGhlIG11dGF0b3IncyBkaWFsb2cgd2l0aFxuICAgKiB0aGlzIGJsb2NrJ3MgY29tcG9uZW50cy5cbiAgICovXG4gIGRlY29tcG9zZT86ICgocDE6IFdvcmtzcGFjZSkgPT4gQmxvY2spID0gdW5kZWZpbmVkO1xuICBpZDogc3RyaW5nO1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ251bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgLy8gJ0Nvbm5lY3Rpb24nLlxuICBvdXRwdXRDb25uZWN0aW9uOiBDb25uZWN0aW9uID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAvLyAnQ29ubmVjdGlvbicuXG4gIG5leHRDb25uZWN0aW9uOiBDb25uZWN0aW9uID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAvLyAnQ29ubmVjdGlvbicuXG4gIHByZXZpb3VzQ29ubmVjdGlvbjogQ29ubmVjdGlvbiA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuICBpbnB1dExpc3Q6IElucHV0W10gPSBbXTtcbiAgaW5wdXRzSW5saW5lPzogYm9vbGVhbiA9IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBkaXNhYmxlZCA9IGZhbHNlO1xuICB0b29sdGlwOiBUb29sdGlwLlRpcEluZm8gPSAnJztcbiAgY29udGV4dE1lbnUgPSB0cnVlO1xuXG4gIHByb3RlY3RlZCBwYXJlbnRCbG9ja186IHRoaXN8bnVsbCA9IG51bGw7XG5cbiAgcHJvdGVjdGVkIGNoaWxkQmxvY2tzXzogdGhpc1tdID0gW107XG5cbiAgcHJpdmF0ZSBkZWxldGFibGVfID0gdHJ1ZTtcblxuICBwcml2YXRlIG1vdmFibGVfID0gdHJ1ZTtcblxuICBwcml2YXRlIGVkaXRhYmxlXyA9IHRydWU7XG5cbiAgcHJpdmF0ZSBpc1NoYWRvd18gPSBmYWxzZTtcblxuICBwcm90ZWN0ZWQgY29sbGFwc2VkXyA9IGZhbHNlO1xuICBwcm90ZWN0ZWQgb3V0cHV0U2hhcGVfOiBudW1iZXJ8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIElzIHRoZSBjdXJyZW50IGJsb2NrIGN1cnJlbnRseSBpbiB0aGUgcHJvY2VzcyBvZiBiZWluZyBkaXNwb3NlZD9cbiAgICovXG4gIHByaXZhdGUgZGlzcG9zaW5nID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgY29tbWVudCBhdHRhY2hlZCB0byB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAZGVwcmVjYXRlZCBBdWd1c3QgMjAxOS4gVXNlIGdldENvbW1lbnRUZXh0IGluc3RlYWQuXG4gICAqL1xuICBjb21tZW50OiBzdHJpbmd8Q29tbWVudHxudWxsID0gbnVsbDtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb21tZW50TW9kZWw6IENvbW1lbnRNb2RlbDtcbiAgcHJpdmF0ZSByZWFkb25seSB4eV86IENvb3JkaW5hdGU7XG4gIGlzSW5GbHlvdXQ6IGJvb2xlYW47XG4gIGlzSW5NdXRhdG9yOiBib29sZWFuO1xuICBSVEw6IGJvb2xlYW47XG5cbiAgLyoqIFRydWUgaWYgdGhpcyBibG9jayBpcyBhbiBpbnNlcnRpb24gbWFya2VyLiAqL1xuICBwcm90ZWN0ZWQgaXNJbnNlcnRpb25NYXJrZXJfID0gZmFsc2U7XG5cbiAgLyoqIE5hbWUgb2YgdGhlIHR5cGUgb2YgaGF0LiAqL1xuICBoYXQ/OiBzdHJpbmcgPSB1bmRlZmluZWQ7XG5cbiAgcmVuZGVyZWQ6IGJvb2xlYW58bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFN0cmluZyBmb3IgYmxvY2sgaGVscCwgb3IgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgVVJMLiBOdWxsIGZvciBubyBoZWxwLlxuICAgKi9cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlICdzdHJpbmdcbiAgLy8gfCBGdW5jdGlvbicuXG4gIGhlbHBVcmw6IHN0cmluZ3xGdW5jdGlvbiA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gIC8qKiBBIGJvdW5kIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHVzZSB3aGVuIHRoZSBwYXJlbnQgd29ya3NwYWNlIGNoYW5nZXMuICovXG4gIHByaXZhdGUgb25jaGFuZ2VXcmFwcGVyXzogKChwMTogQWJzdHJhY3QpID0+IEFueUR1cmluZ01pZ3JhdGlvbil8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEEgY291bnQgb2Ygc3RhdGVtZW50IGlucHV0cyBvbiB0aGUgYmxvY2suXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGVtZW50SW5wdXRDb3VudCA9IDA7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIHR5cGUhOiBzdHJpbmc7XG4gIC8vIFJlY29yZCBpbml0aWFsIGlubGluZSBzdGF0ZS5cbiAgaW5wdXRzSW5saW5lRGVmYXVsdD86IGJvb2xlYW47XG4gIHdvcmtzcGFjZTogV29ya3NwYWNlO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSBibG9jaydzIHdvcmtzcGFjZS5cbiAgICogQHBhcmFtIHByb3RvdHlwZU5hbWUgTmFtZSBvZiB0aGUgbGFuZ3VhZ2Ugb2JqZWN0IGNvbnRhaW5pbmcgdHlwZS1zcGVjaWZpY1xuICAgKiAgICAgZnVuY3Rpb25zIGZvciB0aGlzIGJsb2NrLlxuICAgKiBAcGFyYW0gb3B0X2lkIE9wdGlvbmFsIElELiAgVXNlIHRoaXMgSUQgaWYgcHJvdmlkZWQsIG90aGVyd2lzZSBjcmVhdGUgYSBuZXdcbiAgICogICAgIElELlxuICAgKiBAdGhyb3dzIFdoZW4gdGhlIHByb3RvdHlwZU5hbWUgaXMgbm90IHZhbGlkIG9yIG5vdCBhbGxvd2VkLlxuICAgKi9cbiAgY29uc3RydWN0b3Iod29ya3NwYWNlOiBXb3Jrc3BhY2UsIHByb3RvdHlwZU5hbWU6IHN0cmluZywgb3B0X2lkPzogc3RyaW5nKSB7XG4gICAgdGhpcy53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG5cbiAgICB0aGlzLmlkID0gb3B0X2lkICYmICF3b3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKG9wdF9pZCkgPyBvcHRfaWQgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkR2VuZXJhdG9yLmdlblVpZCgpO1xuICAgIHdvcmtzcGFjZS5zZXRCbG9ja0J5SWQodGhpcy5pZCwgdGhpcyk7XG5cbiAgICAvKiogQSBtb2RlbCBvZiB0aGUgY29tbWVudCBhdHRhY2hlZCB0byB0aGlzIGJsb2NrLiAqL1xuICAgIHRoaXMuY29tbWVudE1vZGVsID0ge3RleHQ6IG51bGwsIHBpbm5lZDogZmFsc2UsIHNpemU6IG5ldyBTaXplKDE2MCwgODApfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBibG9jaydzIHBvc2l0aW9uIGluIHdvcmtzcGFjZSB1bml0cy4gICgwLCAwKSBpcyBhdCB0aGUgd29ya3NwYWNlJ3NcbiAgICAgKiBvcmlnaW47IHNjYWxlIGRvZXMgbm90IGNoYW5nZSB0aGlzIHZhbHVlLlxuICAgICAqL1xuICAgIHRoaXMueHlfID0gbmV3IENvb3JkaW5hdGUoMCwgMCk7XG4gICAgdGhpcy5pc0luRmx5b3V0ID0gd29ya3NwYWNlLmlzRmx5b3V0O1xuICAgIHRoaXMuaXNJbk11dGF0b3IgPSB3b3Jrc3BhY2UuaXNNdXRhdG9yO1xuXG4gICAgdGhpcy5SVEwgPSB3b3Jrc3BhY2UuUlRMO1xuXG4gICAgLy8gQ29weSB0aGUgdHlwZS1zcGVjaWZpYyBmdW5jdGlvbnMgYW5kIGRhdGEgZnJvbSB0aGUgcHJvdG90eXBlLlxuICAgIGlmIChwcm90b3R5cGVOYW1lKSB7XG4gICAgICB0aGlzLnR5cGUgPSBwcm90b3R5cGVOYW1lO1xuICAgICAgY29uc3QgcHJvdG90eXBlID0gQmxvY2tzW3Byb3RvdHlwZU5hbWVdO1xuICAgICAgaWYgKCFwcm90b3R5cGUgfHwgdHlwZW9mIHByb3RvdHlwZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdJbnZhbGlkIGJsb2NrIGRlZmluaXRpb24gZm9yIHR5cGU6ICcgKyBwcm90b3R5cGVOYW1lKTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgcHJvdG90eXBlKTtcbiAgICB9XG5cbiAgICB3b3Jrc3BhY2UuYWRkVG9wQmxvY2sodGhpcyk7XG4gICAgd29ya3NwYWNlLmFkZFR5cGVkQmxvY2sodGhpcyk7XG5cbiAgICBpZiAobmV3LnRhcmdldCA9PT0gQmxvY2spIHtcbiAgICAgIHRoaXMuZG9Jbml0XygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBDYWxscyB0aGUgaW5pdCgpIGZ1bmN0aW9uIGFuZCBoYW5kbGVzIGFzc29jaWF0ZWQgZXZlbnQgZmlyaW5nLCBldGMuICovXG4gIHByb3RlY3RlZCBkb0luaXRfKCkge1xuICAgIC8vIEFsbCBldmVudHMgZmlyZWQgc2hvdWxkIGJlIHBhcnQgb2YgdGhlIHNhbWUgZ3JvdXAuXG4gICAgLy8gQW55IGV2ZW50cyBmaXJlZCBkdXJpbmcgaW5pdCBzaG91bGQgbm90IGJlIHVuZG9hYmxlLFxuICAgIC8vIHNvIHRoYXQgYmxvY2sgY3JlYXRpb24gaXMgYXRvbWljLlxuICAgIGNvbnN0IGV4aXN0aW5nR3JvdXAgPSBldmVudFV0aWxzLmdldEdyb3VwKCk7XG4gICAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgIH1cbiAgICBjb25zdCBpbml0aWFsVW5kb0ZsYWcgPSBldmVudFV0aWxzLmdldFJlY29yZFVuZG8oKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDYWxsIGFuIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uLCBpZiBpdCBleGlzdHMuXG4gICAgICBpZiAodHlwZW9mIHRoaXMuaW5pdCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBldmVudFV0aWxzLnNldFJlY29yZFVuZG8oZmFsc2UpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgZXZlbnRVdGlscy5zZXRSZWNvcmRVbmRvKGluaXRpYWxVbmRvRmxhZyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZpcmUgYSBjcmVhdGUgZXZlbnQuXG4gICAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX0NSRUFURSkpKHRoaXMpKTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgICAgfVxuICAgICAgLy8gSW4gY2FzZSBpbml0IHRocmV3LCByZWNvcmRVbmRvIGZsYWcgc2hvdWxkIHN0aWxsIGJlIHJlc2V0LlxuICAgICAgZXZlbnRVdGlscy5zZXRSZWNvcmRVbmRvKGluaXRpYWxVbmRvRmxhZyk7XG4gICAgfVxuICAgIHRoaXMuaW5wdXRzSW5saW5lRGVmYXVsdCA9IHRoaXMuaW5wdXRzSW5saW5lO1xuXG4gICAgLy8gQmluZCBhbiBvbmNoYW5nZSBmdW5jdGlvbiwgaWYgaXQgZXhpc3RzLlxuICAgIGlmICh0eXBlb2YgdGhpcy5vbmNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpcy5zZXRPbkNoYW5nZSh0aGlzLm9uY2hhbmdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gaGVhbFN0YWNrIElmIHRydWUsIHRoZW4gdHJ5IHRvIGhlYWwgYW55IGdhcCBieSBjb25uZWN0aW5nIHRoZSBuZXh0XG4gICAqICAgICBzdGF0ZW1lbnQgd2l0aCB0aGUgcHJldmlvdXMgc3RhdGVtZW50LiAgT3RoZXJ3aXNlLCBkaXNwb3NlIG9mIGFsbFxuICAgKiAgICAgY2hpbGRyZW4gb2YgdGhpcyBibG9jay5cbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgZGlzcG9zZShoZWFsU3RhY2s6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5pc0RlYWRPckR5aW5nKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gVGVybWluYXRlIG9uY2hhbmdlIGV2ZW50IGNhbGxzLlxuICAgIGlmICh0aGlzLm9uY2hhbmdlV3JhcHBlcl8pIHtcbiAgICAgIHRoaXMud29ya3NwYWNlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMub25jaGFuZ2VXcmFwcGVyXyk7XG4gICAgfVxuXG4gICAgdGhpcy51bnBsdWcoaGVhbFN0YWNrKTtcbiAgICBpZiAoZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19ERUxFVEUpKSh0aGlzKSk7XG4gICAgfVxuICAgIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFRoaXMgYmxvY2sgaXMgbm93IGF0IHRoZSB0b3Agb2YgdGhlIHdvcmtzcGFjZS5cbiAgICAgIC8vIFJlbW92ZSB0aGlzIGJsb2NrIGZyb20gdGhlIHdvcmtzcGFjZSdzIGxpc3Qgb2YgdG9wLW1vc3QgYmxvY2tzLlxuICAgICAgdGhpcy53b3Jrc3BhY2UucmVtb3ZlVG9wQmxvY2sodGhpcyk7XG4gICAgICB0aGlzLndvcmtzcGFjZS5yZW1vdmVUeXBlZEJsb2NrKHRoaXMpO1xuICAgICAgLy8gUmVtb3ZlIGZyb20gYmxvY2sgZGF0YWJhc2UuXG4gICAgICB0aGlzLndvcmtzcGFjZS5yZW1vdmVCbG9ja0J5SWQodGhpcy5pZCk7XG4gICAgICB0aGlzLmRpc3Bvc2luZyA9IHRydWU7XG5cbiAgICAgIC8vIEZpcnN0LCBkaXNwb3NlIG9mIGFsbCBteSBjaGlsZHJlbi5cbiAgICAgIGZvciAobGV0IGkgPSB0aGlzLmNoaWxkQmxvY2tzXy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICB0aGlzLmNoaWxkQmxvY2tzX1tpXS5kaXNwb3NlKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIC8vIFRoZW4gZGlzcG9zZSBvZiBteXNlbGYuXG4gICAgICAvLyBEaXNwb3NlIG9mIGFsbCBpbnB1dHMgYW5kIHRoZWlyIGZpZWxkcy5cbiAgICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICAgIGlucHV0LmRpc3Bvc2UoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW5wdXRMaXN0Lmxlbmd0aCA9IDA7XG4gICAgICAvLyBEaXNwb3NlIG9mIGFueSByZW1haW5pbmcgY29ubmVjdGlvbnMgKG5leHQvcHJldmlvdXMvb3V0cHV0KS5cbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25zID0gdGhpcy5nZXRDb25uZWN0aW9uc18odHJ1ZSk7XG4gICAgICBmb3IgKGxldCBpID0gMCwgY29ubmVjdGlvbjsgY29ubmVjdGlvbiA9IGNvbm5lY3Rpb25zW2ldOyBpKyspIHtcbiAgICAgICAgY29ubmVjdGlvbi5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgICBpZiAodHlwZW9mIHRoaXMuZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZGlzcG9zZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGJsb2NrIGlzIGVpdGhlciBpbiB0aGUgcHJvY2VzcyBvZiBiZWluZyBkaXNwb3NlZCwgb3JcbiAgICogaXMgZGlzcG9zZWQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNEZWFkT3JEeWluZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5kaXNwb3NpbmcgfHwgdGhpcy5kaXNwb3NlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIGluaXRNb2RlbCBvbiBhbGwgZmllbGRzIG9uIHRoZSBibG9jay5cbiAgICogTWF5IGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZS5cbiAgICogRWl0aGVyIGluaXRNb2RlbCBvciBpbml0U3ZnIG11c3QgYmUgY2FsbGVkIGFmdGVyIGNyZWF0aW5nIGEgYmxvY2sgYW5kXG4gICAqIGJlZm9yZSB0aGUgZmlyc3QgaW50ZXJhY3Rpb24gd2l0aCBpdC4gIEludGVyYWN0aW9ucyBpbmNsdWRlIFVJIGFjdGlvbnNcbiAgICogKGUuZy4gY2xpY2tpbmcgYW5kIGRyYWdnaW5nKSBhbmQgZmlyaW5nIGV2ZW50cyAoZS5nLiBjcmVhdGUsIGRlbGV0ZSwgYW5kXG4gICAqIGNoYW5nZSkuXG4gICAqL1xuICBpbml0TW9kZWwoKSB7XG4gICAgZm9yIChsZXQgaSA9IDAsIGlucHV0OyBpbnB1dCA9IHRoaXMuaW5wdXRMaXN0W2ldOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGogPSAwLCBmaWVsZDsgZmllbGQgPSBpbnB1dC5maWVsZFJvd1tqXTsgaisrKSB7XG4gICAgICAgIGlmIChmaWVsZC5pbml0TW9kZWwpIHtcbiAgICAgICAgICBmaWVsZC5pbml0TW9kZWwoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVbnBsdWcgdGhpcyBibG9jayBmcm9tIGl0cyBzdXBlcmlvciBibG9jay4gIElmIHRoaXMgYmxvY2sgaXMgYSBzdGF0ZW1lbnQsXG4gICAqIG9wdGlvbmFsbHkgcmVjb25uZWN0IHRoZSBibG9jayB1bmRlcm5lYXRoIHdpdGggdGhlIGJsb2NrIG9uIHRvcC5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9oZWFsU3RhY2sgRGlzY29ubmVjdCBjaGlsZCBzdGF0ZW1lbnQgYW5kIHJlY29ubmVjdCBzdGFjay5cbiAgICogICAgIERlZmF1bHRzIHRvIGZhbHNlLlxuICAgKi9cbiAgdW5wbHVnKG9wdF9oZWFsU3RhY2s/OiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgdGhpcy51bnBsdWdGcm9tUm93XyhvcHRfaGVhbFN0YWNrKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICB0aGlzLnVucGx1Z0Zyb21TdGFja18ob3B0X2hlYWxTdGFjayk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVucGx1ZyB0aGlzIGJsb2NrJ3Mgb3V0cHV0IGZyb20gYW4gaW5wdXQgb24gYW5vdGhlciBibG9jay4gIE9wdGlvbmFsbHlcbiAgICogcmVjb25uZWN0IHRoZSBibG9jaydzIHBhcmVudCB0byB0aGUgb25seSBjaGlsZCBibG9jaywgaWYgcG9zc2libGUuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfaGVhbFN0YWNrIERpc2Nvbm5lY3QgcmlnaHQtc2lkZSBibG9jayBhbmQgY29ubmVjdCB0byBsZWZ0LXNpZGVcbiAgICogICAgIGJsb2NrLiAgRGVmYXVsdHMgdG8gZmFsc2UuXG4gICAqL1xuICBwcml2YXRlIHVucGx1Z0Zyb21Sb3dfKG9wdF9oZWFsU3RhY2s/OiBib29sZWFuKSB7XG4gICAgbGV0IHBhcmVudENvbm5lY3Rpb24gPSBudWxsO1xuICAgIGlmICh0aGlzLm91dHB1dENvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkge1xuICAgICAgcGFyZW50Q29ubmVjdGlvbiA9IHRoaXMub3V0cHV0Q29ubmVjdGlvbi50YXJnZXRDb25uZWN0aW9uO1xuICAgICAgLy8gRGlzY29ubmVjdCBmcm9tIGFueSBzdXBlcmlvciBibG9jay5cbiAgICAgIHRoaXMub3V0cHV0Q29ubmVjdGlvbi5kaXNjb25uZWN0KCk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIGVhcmx5IGluIG9idmlvdXMgY2FzZXMuXG4gICAgaWYgKCFwYXJlbnRDb25uZWN0aW9uIHx8ICFvcHRfaGVhbFN0YWNrKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdGhpc0Nvbm5lY3Rpb24gPSB0aGlzLmdldE9ubHlWYWx1ZUNvbm5lY3Rpb25fKCk7XG4gICAgaWYgKCF0aGlzQ29ubmVjdGlvbiB8fCAhdGhpc0Nvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSB8fFxuICAgICAgICB0aGlzQ29ubmVjdGlvbi50YXJnZXRCbG9jaygpIS5pc1NoYWRvdygpKSB7XG4gICAgICAvLyBUb28gbWFueSBvciB0b28gZmV3IHBvc3NpYmxlIGNvbm5lY3Rpb25zIG9uIHRoaXMgYmxvY2ssIG9yIHRoZXJlJ3NcbiAgICAgIC8vIG5vdGhpbmcgb24gdGhlIG90aGVyIHNpZGUgb2YgdGhpcyBjb25uZWN0aW9uLlxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGNoaWxkQ29ubmVjdGlvbiA9IHRoaXNDb25uZWN0aW9uLnRhcmdldENvbm5lY3Rpb247XG4gICAgLy8gRGlzY29ubmVjdCB0aGUgY2hpbGQgYmxvY2suXG4gICAgY2hpbGRDb25uZWN0aW9uPy5kaXNjb25uZWN0KCk7XG4gICAgLy8gQ29ubmVjdCBjaGlsZCB0byB0aGUgcGFyZW50IGlmIHBvc3NpYmxlLCBvdGhlcndpc2UgYnVtcCBhd2F5LlxuICAgIGlmICh0aGlzLndvcmtzcGFjZS5jb25uZWN0aW9uQ2hlY2tlci5jYW5Db25uZWN0KFxuICAgICAgICAgICAgY2hpbGRDb25uZWN0aW9uLCBwYXJlbnRDb25uZWN0aW9uLCBmYWxzZSkpIHtcbiAgICAgIHBhcmVudENvbm5lY3Rpb24uY29ubmVjdChjaGlsZENvbm5lY3Rpb24hKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hpbGRDb25uZWN0aW9uPy5vbkZhaWxlZENvbm5lY3QocGFyZW50Q29ubmVjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNvbm5lY3Rpb24gb24gdGhlIHZhbHVlIGlucHV0IHRoYXQgaXMgY29ubmVjdGVkIHRvIGFub3RoZXJcbiAgICogYmxvY2suIFdoZW4gYW4gaW5zZXJ0aW9uIG1hcmtlciBpcyBjb25uZWN0ZWQgdG8gYSBjb25uZWN0aW9uIHdpdGggYSBibG9ja1xuICAgKiBhbHJlYWR5IGF0dGFjaGVkLCB0aGUgY29ubmVjdGVkIGJsb2NrIGlzIGF0dGFjaGVkIHRvIHRoZSBpbnNlcnRpb24gbWFya2VyLlxuICAgKiBTaW5jZSBvbmx5IG9uZSBibG9jayBjYW4gYmUgZGlzcGxhY2VkIGFuZCBhdHRhY2hlZCB0byB0aGUgaW5zZXJ0aW9uIG1hcmtlclxuICAgKiB0aGlzIHNob3VsZCBvbmx5IGV2ZXIgcmV0dXJuIG9uZSBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY29ubmVjdGlvbiBvbiB0aGUgdmFsdWUgaW5wdXQsIG9yIG51bGwuXG4gICAqL1xuICBwcml2YXRlIGdldE9ubHlWYWx1ZUNvbm5lY3Rpb25fKCk6IENvbm5lY3Rpb258bnVsbCB7XG4gICAgbGV0IGNvbm5lY3Rpb24gPSBudWxsO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHRoaXNDb25uZWN0aW9uID0gdGhpcy5pbnB1dExpc3RbaV0uY29ubmVjdGlvbjtcbiAgICAgIGlmICh0aGlzQ29ubmVjdGlvbiAmJlxuICAgICAgICAgIHRoaXNDb25uZWN0aW9uLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFICYmXG4gICAgICAgICAgdGhpc0Nvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbikge1xuICAgICAgICBpZiAoY29ubmVjdGlvbikge1xuICAgICAgICAgIHJldHVybiBudWxsOyAgLy8gTW9yZSB0aGFuIG9uZSB2YWx1ZSBpbnB1dCBmb3VuZC5cbiAgICAgICAgfVxuICAgICAgICBjb25uZWN0aW9uID0gdGhpc0Nvbm5lY3Rpb247XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb25uZWN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFVucGx1ZyB0aGlzIHN0YXRlbWVudCBibG9jayBmcm9tIGl0cyBzdXBlcmlvciBibG9jay4gIE9wdGlvbmFsbHkgcmVjb25uZWN0XG4gICAqIHRoZSBibG9jayB1bmRlcm5lYXRoIHdpdGggdGhlIGJsb2NrIG9uIHRvcC5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9oZWFsU3RhY2sgRGlzY29ubmVjdCBjaGlsZCBzdGF0ZW1lbnQgYW5kIHJlY29ubmVjdCBzdGFjay5cbiAgICogICAgIERlZmF1bHRzIHRvIGZhbHNlLlxuICAgKi9cbiAgcHJpdmF0ZSB1bnBsdWdGcm9tU3RhY2tfKG9wdF9oZWFsU3RhY2s/OiBib29sZWFuKSB7XG4gICAgbGV0IHByZXZpb3VzVGFyZ2V0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5wcmV2aW91c0Nvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkge1xuICAgICAgLy8gUmVtZW1iZXIgdGhlIGNvbm5lY3Rpb24gdGhhdCBhbnkgbmV4dCBzdGF0ZW1lbnRzIG5lZWQgdG8gY29ubmVjdCB0by5cbiAgICAgIHByZXZpb3VzVGFyZ2V0ID0gdGhpcy5wcmV2aW91c0Nvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbjtcbiAgICAgIC8vIERldGFjaCB0aGlzIGJsb2NrIGZyb20gdGhlIHBhcmVudCdzIHRyZWUuXG4gICAgICB0aGlzLnByZXZpb3VzQ29ubmVjdGlvbi5kaXNjb25uZWN0KCk7XG4gICAgfVxuICAgIGNvbnN0IG5leHRCbG9jayA9IHRoaXMuZ2V0TmV4dEJsb2NrKCk7XG4gICAgaWYgKG9wdF9oZWFsU3RhY2sgJiYgbmV4dEJsb2NrICYmICFuZXh0QmxvY2suaXNTaGFkb3coKSkge1xuICAgICAgLy8gRGlzY29ubmVjdCB0aGUgbmV4dCBzdGF0ZW1lbnQuXG4gICAgICBjb25zdCBuZXh0VGFyZ2V0ID0gdGhpcy5uZXh0Q29ubmVjdGlvbi50YXJnZXRDb25uZWN0aW9uO1xuICAgICAgbmV4dFRhcmdldD8uZGlzY29ubmVjdCgpO1xuICAgICAgaWYgKHByZXZpb3VzVGFyZ2V0ICYmXG4gICAgICAgICAgdGhpcy53b3Jrc3BhY2UuY29ubmVjdGlvbkNoZWNrZXIuY2FuQ29ubmVjdChcbiAgICAgICAgICAgICAgcHJldmlvdXNUYXJnZXQsIG5leHRUYXJnZXQsIGZhbHNlKSkge1xuICAgICAgICAvLyBBdHRhY2ggdGhlIG5leHQgc3RhdGVtZW50IHRvIHRoZSBwcmV2aW91cyBzdGF0ZW1lbnQuXG4gICAgICAgIHByZXZpb3VzVGFyZ2V0LmNvbm5lY3QobmV4dFRhcmdldCEpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFsbCBjb25uZWN0aW9ucyBvcmlnaW5hdGluZyBmcm9tIHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBfYWxsIElmIHRydWUsIHJldHVybiBhbGwgY29ubmVjdGlvbnMgZXZlbiBoaWRkZW4gb25lcy5cbiAgICogQHJldHVybnMgQXJyYXkgb2YgY29ubmVjdGlvbnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0Q29ubmVjdGlvbnNfKF9hbGw6IGJvb2xlYW4pOiBDb25uZWN0aW9uW10ge1xuICAgIGNvbnN0IG15Q29ubmVjdGlvbnMgPSBbXTtcbiAgICBpZiAodGhpcy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICBteUNvbm5lY3Rpb25zLnB1c2godGhpcy5vdXRwdXRDb25uZWN0aW9uKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICBteUNvbm5lY3Rpb25zLnB1c2godGhpcy5wcmV2aW91c0Nvbm5lY3Rpb24pO1xuICAgIH1cbiAgICBpZiAodGhpcy5uZXh0Q29ubmVjdGlvbikge1xuICAgICAgbXlDb25uZWN0aW9ucy5wdXNoKHRoaXMubmV4dENvbm5lY3Rpb24pO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgaWYgKGlucHV0LmNvbm5lY3Rpb24pIHtcbiAgICAgICAgbXlDb25uZWN0aW9ucy5wdXNoKGlucHV0LmNvbm5lY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbXlDb25uZWN0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBXYWxrcyBkb3duIGEgc3RhY2sgb2YgYmxvY2tzIGFuZCBmaW5kcyB0aGUgbGFzdCBuZXh0IGNvbm5lY3Rpb24gb24gdGhlXG4gICAqIHN0YWNrLlxuICAgKlxuICAgKiBAcGFyYW0gaWdub3JlU2hhZG93cyBJZiB0cnVlLHRoZSBsYXN0IGNvbm5lY3Rpb24gb24gYSBub24tc2hhZG93IGJsb2NrIHdpbGxcbiAgICogICAgIGJlIHJldHVybmVkLiBJZiBmYWxzZSwgdGhpcyB3aWxsIGZvbGxvdyBzaGFkb3dzIHRvIGZpbmQgdGhlIGxhc3RcbiAgICogICAgIGNvbm5lY3Rpb24uXG4gICAqIEByZXR1cm5zIFRoZSBsYXN0IG5leHQgY29ubmVjdGlvbiBvbiB0aGUgc3RhY2ssIG9yIG51bGwuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbGFzdENvbm5lY3Rpb25JblN0YWNrKGlnbm9yZVNoYWRvd3M6IGJvb2xlYW4pOiBDb25uZWN0aW9ufG51bGwge1xuICAgIGxldCBuZXh0Q29ubmVjdGlvbiA9IHRoaXMubmV4dENvbm5lY3Rpb247XG4gICAgd2hpbGUgKG5leHRDb25uZWN0aW9uKSB7XG4gICAgICBjb25zdCBuZXh0QmxvY2sgPSBuZXh0Q29ubmVjdGlvbi50YXJnZXRCbG9jaygpO1xuICAgICAgaWYgKCFuZXh0QmxvY2sgfHwgaWdub3JlU2hhZG93cyAmJiBuZXh0QmxvY2suaXNTaGFkb3coKSkge1xuICAgICAgICByZXR1cm4gbmV4dENvbm5lY3Rpb247XG4gICAgICB9XG4gICAgICBuZXh0Q29ubmVjdGlvbiA9IG5leHRCbG9jay5uZXh0Q29ubmVjdGlvbjtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQnVtcCB1bmNvbm5lY3RlZCBibG9ja3Mgb3V0IG9mIGFsaWdubWVudC4gIFR3byBibG9ja3Mgd2hpY2ggYXJlbid0IGFjdHVhbGx5XG4gICAqIGNvbm5lY3RlZCBzaG91bGQgbm90IGNvaW5jaWRlbnRhbGx5IGxpbmUgdXAgb24gc2NyZWVuLlxuICAgKi9cbiAgYnVtcE5laWdoYm91cnMoKSB7fVxuICAvLyBub29wLlxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHBhcmVudCBibG9jayBvciBudWxsIGlmIHRoaXMgYmxvY2sgaXMgYXQgdGhlIHRvcCBsZXZlbC4gVGhlXG4gICAqIHBhcmVudCBibG9jayBpcyBlaXRoZXIgdGhlIGJsb2NrIGNvbm5lY3RlZCB0byB0aGUgcHJldmlvdXMgY29ubmVjdGlvbiAoZm9yXG4gICAqIGEgc3RhdGVtZW50IGJsb2NrKSBvciB0aGUgYmxvY2sgY29ubmVjdGVkIHRvIHRoZSBvdXRwdXQgY29ubmVjdGlvbiAoZm9yIGFcbiAgICogdmFsdWUgYmxvY2spLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYmxvY2sgKGlmIGFueSkgdGhhdCBob2xkcyB0aGUgY3VycmVudCBibG9jay5cbiAgICovXG4gIGdldFBhcmVudCgpOiB0aGlzfG51bGwge1xuICAgIHJldHVybiB0aGlzLnBhcmVudEJsb2NrXztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGlucHV0IHRoYXQgY29ubmVjdHMgdG8gdGhlIHNwZWNpZmllZCBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIEEgYmxvY2sgY29ubmVjdGVkIHRvIGFuIGlucHV0IG9uIHRoaXMgYmxvY2suXG4gICAqIEByZXR1cm5zIFRoZSBpbnB1dCAoaWYgYW55KSB0aGF0IGNvbm5lY3RzIHRvIHRoZSBzcGVjaWZpZWQgYmxvY2suXG4gICAqL1xuICBnZXRJbnB1dFdpdGhCbG9jayhibG9jazogQmxvY2spOiBJbnB1dHxudWxsIHtcbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgaWYgKGlucHV0LmNvbm5lY3Rpb24gJiYgaW5wdXQuY29ubmVjdGlvbi50YXJnZXRCbG9jaygpID09PSBibG9jaykge1xuICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgcGFyZW50IGJsb2NrIHRoYXQgc3Vycm91bmRzIHRoZSBjdXJyZW50IGJsb2NrLCBvciBudWxsIGlmIHRoaXNcbiAgICogYmxvY2sgaGFzIG5vIHN1cnJvdW5kaW5nIGJsb2NrLiAgQSBwYXJlbnQgYmxvY2sgbWlnaHQganVzdCBiZSB0aGUgcHJldmlvdXNcbiAgICogc3RhdGVtZW50LCB3aGVyZWFzIHRoZSBzdXJyb3VuZGluZyBibG9jayBpcyBhbiBpZiBzdGF0ZW1lbnQsIHdoaWxlIGxvb3AsXG4gICAqIGV0Yy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGJsb2NrIChpZiBhbnkpIHRoYXQgc3Vycm91bmRzIHRoZSBjdXJyZW50IGJsb2NrLlxuICAgKi9cbiAgZ2V0U3Vycm91bmRQYXJlbnQoKTogdGhpc3xudWxsIHtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXMgKi9cbiAgICBsZXQgYmxvY2s6IHRoaXN8bnVsbCA9IHRoaXM7XG4gICAgbGV0IHByZXZCbG9jaztcbiAgICBkbyB7XG4gICAgICBwcmV2QmxvY2sgPSBibG9jaztcbiAgICAgIGJsb2NrID0gYmxvY2suZ2V0UGFyZW50KCk7XG4gICAgICBpZiAoIWJsb2NrKSB7XG4gICAgICAgIC8vIFJhbiBvZmYgdGhlIHRvcC5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoYmxvY2suZ2V0TmV4dEJsb2NrKCkgPT09IHByZXZCbG9jayk7XG4gICAgLy8gVGhpcyBibG9jayBpcyBhbiBlbmNsb3NpbmcgcGFyZW50LCBub3QganVzdCBhIHN0YXRlbWVudCBpbiBhIHN0YWNrLlxuICAgIHJldHVybiBibG9jaztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIG5leHQgc3RhdGVtZW50IGJsb2NrIGRpcmVjdGx5IGNvbm5lY3RlZCB0byB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgbmV4dCBzdGF0ZW1lbnQgYmxvY2sgb3IgbnVsbC5cbiAgICovXG4gIGdldE5leHRCbG9jaygpOiBCbG9ja3xudWxsIHtcbiAgICByZXR1cm4gdGhpcy5uZXh0Q29ubmVjdGlvbiAmJiB0aGlzLm5leHRDb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgYmxvY2sgY29ubmVjdGVkIHRvIHRoZSBwcmV2aW91cyBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcHJldmlvdXMgc3RhdGVtZW50IGJsb2NrIG9yIG51bGwuXG4gICAqL1xuICBnZXRQcmV2aW91c0Jsb2NrKCk6IEJsb2NrfG51bGwge1xuICAgIHJldHVybiB0aGlzLnByZXZpb3VzQ29ubmVjdGlvbiAmJiB0aGlzLnByZXZpb3VzQ29ubmVjdGlvbi50YXJnZXRCbG9jaygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgY29ubmVjdGlvbiBvbiB0aGUgZmlyc3Qgc3RhdGVtZW50IGlucHV0IG9uIHRoaXMgYmxvY2ssIG9yIG51bGxcbiAgICogaWYgdGhlcmUgYXJlIG5vbmUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBmaXJzdCBzdGF0ZW1lbnQgY29ubmVjdGlvbiBvciBudWxsLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldEZpcnN0U3RhdGVtZW50Q29ubmVjdGlvbigpOiBDb25uZWN0aW9ufG51bGwge1xuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbiAmJlxuICAgICAgICAgIGlucHV0LmNvbm5lY3Rpb24udHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LmNvbm5lY3Rpb247XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgdG9wLW1vc3QgYmxvY2sgaW4gdGhpcyBibG9jaydzIHRyZWUuXG4gICAqIFRoaXMgd2lsbCByZXR1cm4gaXRzZWxmIGlmIHRoaXMgYmxvY2sgaXMgYXQgdGhlIHRvcCBsZXZlbC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHJvb3QgYmxvY2suXG4gICAqL1xuICBnZXRSb290QmxvY2soKTogdGhpcyB7XG4gICAgbGV0IHJvb3RCbG9jazogdGhpcztcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXMgKi9cbiAgICBsZXQgYmxvY2s6IHRoaXN8bnVsbCA9IHRoaXM7XG4gICAgZG8ge1xuICAgICAgcm9vdEJsb2NrID0gYmxvY2s7XG4gICAgICBibG9jayA9IHJvb3RCbG9jay5wYXJlbnRCbG9ja187XG4gICAgfSB3aGlsZSAoYmxvY2spO1xuICAgIHJldHVybiByb290QmxvY2s7XG4gIH1cblxuICAvKipcbiAgICogV2FsayB1cCBmcm9tIHRoZSBnaXZlbiBibG9jayB1cCB0aHJvdWdoIHRoZSBzdGFjayBvZiBibG9ja3MgdG8gZmluZFxuICAgKiB0aGUgdG9wIGJsb2NrIG9mIHRoZSBzdWIgc3RhY2suIElmIHdlIGFyZSBuZXN0ZWQgaW4gYSBzdGF0ZW1lbnQgaW5wdXQgb25seVxuICAgKiBmaW5kIHRoZSB0b3AtbW9zdCBuZXN0ZWQgYmxvY2suIERvIG5vdCBnbyBhbGwgdGhlIHdheSB0byB0aGUgcm9vdCBibG9jay5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHRvcCBibG9jayBpbiBhIHN0YWNrLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFRvcFN0YWNrQmxvY2soKTogdGhpcyB7XG4gICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzICovXG4gICAgbGV0IGJsb2NrID0gdGhpcztcbiAgICBsZXQgcHJldmlvdXM7XG4gICAgZG8ge1xuICAgICAgcHJldmlvdXMgPSBibG9jay5nZXRQcmV2aW91c0Jsb2NrKCk7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ0Jsb2NrJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gICAgICAvLyAndGhpcycuXG4gICAgfSB3aGlsZSAocHJldmlvdXMgJiYgcHJldmlvdXMuZ2V0TmV4dEJsb2NrKCkgPT09IGJsb2NrICYmXG4gICAgICAgICAgICAgKGJsb2NrID0gcHJldmlvdXMgYXMgQW55RHVyaW5nTWlncmF0aW9uKSk7XG4gICAgcmV0dXJuIGJsb2NrO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYWxsIHRoZSBibG9ja3MgdGhhdCBhcmUgZGlyZWN0bHkgbmVzdGVkIGluc2lkZSB0aGlzIG9uZS5cbiAgICogSW5jbHVkZXMgdmFsdWUgYW5kIHN0YXRlbWVudCBpbnB1dHMsIGFzIHdlbGwgYXMgYW55IGZvbGxvd2luZyBzdGF0ZW1lbnQuXG4gICAqIEV4Y2x1ZGVzIGFueSBjb25uZWN0aW9uIG9uIGFuIG91dHB1dCB0YWIgb3IgYW55IHByZWNlZGluZyBzdGF0ZW1lbnQuXG4gICAqIEJsb2NrcyBhcmUgb3B0aW9uYWxseSBzb3J0ZWQgYnkgcG9zaXRpb247IHRvcCB0byBib3R0b20uXG4gICAqXG4gICAqIEBwYXJhbSBvcmRlcmVkIFNvcnQgdGhlIGxpc3QgaWYgdHJ1ZS5cbiAgICogQHJldHVybnMgQXJyYXkgb2YgYmxvY2tzLlxuICAgKi9cbiAgZ2V0Q2hpbGRyZW4ob3JkZXJlZDogYm9vbGVhbik6IEJsb2NrW10ge1xuICAgIGlmICghb3JkZXJlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuY2hpbGRCbG9ja3NfO1xuICAgIH1cbiAgICBjb25zdCBibG9ja3MgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgaWYgKGlucHV0LmNvbm5lY3Rpb24pIHtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBpbnB1dC5jb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7XG4gICAgICAgIGlmIChjaGlsZCkge1xuICAgICAgICAgIGJsb2Nrcy5wdXNoKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBuZXh0ID0gdGhpcy5nZXROZXh0QmxvY2soKTtcbiAgICBpZiAobmV4dCkge1xuICAgICAgYmxvY2tzLnB1c2gobmV4dCk7XG4gICAgfVxuICAgIHJldHVybiBibG9ja3M7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHBhcmVudCBvZiB0aGlzIGJsb2NrIHRvIGJlIGEgbmV3IGJsb2NrIG9yIG51bGwuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdQYXJlbnQgTmV3IHBhcmVudCBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRQYXJlbnQobmV3UGFyZW50OiB0aGlzfG51bGwpIHtcbiAgICBpZiAobmV3UGFyZW50ID09PSB0aGlzLnBhcmVudEJsb2NrXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHRoYXQgYmxvY2sgaXMgY29ubmVjdGVkIHRvIG5ldyBwYXJlbnQgaWYgbmV3IHBhcmVudCBpcyBub3QgbnVsbCBhbmRcbiAgICAvLyAgICB0aGF0IGJsb2NrIGlzIG5vdCBjb25uZWN0ZWQgdG8gc3VwZXJpb3Igb25lIGlmIG5ldyBwYXJlbnQgaXMgbnVsbC5cbiAgICBjb25zdCB0YXJnZXRCbG9jayA9XG4gICAgICAgIHRoaXMucHJldmlvdXNDb25uZWN0aW9uICYmIHRoaXMucHJldmlvdXNDb25uZWN0aW9uLnRhcmdldEJsb2NrKCkgfHxcbiAgICAgICAgdGhpcy5vdXRwdXRDb25uZWN0aW9uICYmIHRoaXMub3V0cHV0Q29ubmVjdGlvbi50YXJnZXRCbG9jaygpO1xuICAgIGNvbnN0IGlzQ29ubmVjdGVkID0gISF0YXJnZXRCbG9jaztcblxuICAgIGlmIChpc0Nvbm5lY3RlZCAmJiBuZXdQYXJlbnQgJiYgdGFyZ2V0QmxvY2sgIT09IG5ld1BhcmVudCkge1xuICAgICAgdGhyb3cgRXJyb3IoJ0Jsb2NrIGNvbm5lY3RlZCB0byBzdXBlcmlvciBvbmUgdGhhdCBpcyBub3QgbmV3IHBhcmVudC4nKTtcbiAgICB9IGVsc2UgaWYgKCFpc0Nvbm5lY3RlZCAmJiBuZXdQYXJlbnQpIHtcbiAgICAgIHRocm93IEVycm9yKCdCbG9jayBub3QgY29ubmVjdGVkIHRvIG5ldyBwYXJlbnQuJyk7XG4gICAgfSBlbHNlIGlmIChpc0Nvbm5lY3RlZCAmJiAhbmV3UGFyZW50KSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IHNldCBwYXJlbnQgdG8gbnVsbCB3aGlsZSBibG9jayBpcyBzdGlsbCBjb25uZWN0ZWQgdG8nICtcbiAgICAgICAgICAnIHN1cGVyaW9yIGJsb2NrLicpO1xuICAgIH1cblxuICAgIC8vIFRoaXMgYmxvY2sgaGFzbid0IGFjdHVhbGx5IG1vdmVkIG9uLXNjcmVlbiwgc28gdGhlcmUncyBubyBuZWVkIHRvXG4gICAgLy8gdXBkYXRlXG4gICAgLy8gICAgIGl0cyBjb25uZWN0aW9uIGxvY2F0aW9ucy5cbiAgICBpZiAodGhpcy5wYXJlbnRCbG9ja18pIHtcbiAgICAgIC8vIFJlbW92ZSB0aGlzIGJsb2NrIGZyb20gdGhlIG9sZCBwYXJlbnQncyBjaGlsZCBsaXN0LlxuICAgICAgYXJyYXlVdGlscy5yZW1vdmVFbGVtKHRoaXMucGFyZW50QmxvY2tfLmNoaWxkQmxvY2tzXywgdGhpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5ldyBwYXJlbnQgbXVzdCBiZSBub24tbnVsbCBzbyByZW1vdmUgdGhpcyBibG9jayBmcm9tIHRoZSB3b3Jrc3BhY2Unc1xuICAgICAgLy8gICAgIGxpc3Qgb2YgdG9wLW1vc3QgYmxvY2tzLlxuICAgICAgdGhpcy53b3Jrc3BhY2UucmVtb3ZlVG9wQmxvY2sodGhpcyk7XG4gICAgfVxuXG4gICAgdGhpcy5wYXJlbnRCbG9ja18gPSBuZXdQYXJlbnQ7XG4gICAgaWYgKG5ld1BhcmVudCkge1xuICAgICAgLy8gQWRkIHRoaXMgYmxvY2sgdG8gdGhlIG5ldyBwYXJlbnQncyBjaGlsZCBsaXN0LlxuICAgICAgbmV3UGFyZW50LmNoaWxkQmxvY2tzXy5wdXNoKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLndvcmtzcGFjZS5hZGRUb3BCbG9jayh0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbGwgdGhlIGJsb2NrcyB0aGF0IGFyZSBkaXJlY3RseSBvciBpbmRpcmVjdGx5IG5lc3RlZCBpbnNpZGUgdGhpcyBvbmUuXG4gICAqIEluY2x1ZGVzIHRoaXMgYmxvY2sgaW4gdGhlIGxpc3QuXG4gICAqIEluY2x1ZGVzIHZhbHVlIGFuZCBzdGF0ZW1lbnQgaW5wdXRzLCBhcyB3ZWxsIGFzIGFueSBmb2xsb3dpbmcgc3RhdGVtZW50cy5cbiAgICogRXhjbHVkZXMgYW55IGNvbm5lY3Rpb24gb24gYW4gb3V0cHV0IHRhYiBvciBhbnkgcHJlY2VkaW5nIHN0YXRlbWVudHMuXG4gICAqIEJsb2NrcyBhcmUgb3B0aW9uYWxseSBzb3J0ZWQgYnkgcG9zaXRpb247IHRvcCB0byBib3R0b20uXG4gICAqXG4gICAqIEBwYXJhbSBvcmRlcmVkIFNvcnQgdGhlIGxpc3QgaWYgdHJ1ZS5cbiAgICogQHJldHVybnMgRmxhdHRlbmVkIGFycmF5IG9mIGJsb2Nrcy5cbiAgICovXG4gIGdldERlc2NlbmRhbnRzKG9yZGVyZWQ6IGJvb2xlYW4pOiB0aGlzW10ge1xuICAgIGNvbnN0IGJsb2NrcyA9IFt0aGlzXTtcbiAgICBjb25zdCBjaGlsZEJsb2NrcyA9IHRoaXMuZ2V0Q2hpbGRyZW4ob3JkZXJlZCk7XG4gICAgZm9yIChsZXQgY2hpbGQsIGkgPSAwOyBjaGlsZCA9IGNoaWxkQmxvY2tzW2ldOyBpKyspIHtcbiAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnQmxvY2tbXScgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICd0aGlzW10nLlxuICAgICAgYmxvY2tzLnB1c2goLi4uY2hpbGQuZ2V0RGVzY2VuZGFudHMob3JkZXJlZCkgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIGJsb2NrcztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgd2hldGhlciB0aGlzIGJsb2NrIGlzIGRlbGV0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgZGVsZXRhYmxlLlxuICAgKi9cbiAgaXNEZWxldGFibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZGVsZXRhYmxlXyAmJiAhdGhpcy5pc1NoYWRvd18gJiYgIXRoaXMuaXNEZWFkT3JEeWluZygpICYmXG4gICAgICAgICF0aGlzLndvcmtzcGFjZS5vcHRpb25zLnJlYWRPbmx5O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgYmxvY2sgaXMgZGVsZXRhYmxlIG9yIG5vdC5cbiAgICpcbiAgICogQHBhcmFtIGRlbGV0YWJsZSBUcnVlIGlmIGRlbGV0YWJsZS5cbiAgICovXG4gIHNldERlbGV0YWJsZShkZWxldGFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmRlbGV0YWJsZV8gPSBkZWxldGFibGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBtb3ZhYmxlIG9yIG5vdC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBtb3ZhYmxlLlxuICAgKi9cbiAgaXNNb3ZhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm1vdmFibGVfICYmICF0aGlzLmlzU2hhZG93XyAmJiAhdGhpcy5pc0RlYWRPckR5aW5nKCkgJiZcbiAgICAgICAgIXRoaXMud29ya3NwYWNlLm9wdGlvbnMucmVhZE9ubHk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBtb3ZhYmxlIG9yIG5vdC5cbiAgICpcbiAgICogQHBhcmFtIG1vdmFibGUgVHJ1ZSBpZiBtb3ZhYmxlLlxuICAgKi9cbiAgc2V0TW92YWJsZShtb3ZhYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5tb3ZhYmxlXyA9IG1vdmFibGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgaXMgYmxvY2sgaXMgZHVwbGljYXRhYmxlIG9yIG5vdC4gSWYgZHVwbGljYXRpbmcgdGhpcyBibG9jayBhbmRcbiAgICogZGVzY2VuZGFudHMgd2lsbCBwdXQgdGhpcyBibG9jayBvdmVyIHRoZSB3b3Jrc3BhY2UncyBjYXBhY2l0eSB0aGlzIGJsb2NrIGlzXG4gICAqIG5vdCBkdXBsaWNhdGFibGUuIElmIGR1cGxpY2F0aW5nIHRoaXMgYmxvY2sgYW5kIGRlc2NlbmRhbnRzIHdpbGwgcHV0IGFueVxuICAgKiB0eXBlIG92ZXIgdGhlaXIgbWF4SW5zdGFuY2VzIHRoaXMgYmxvY2sgaXMgbm90IGR1cGxpY2F0YWJsZS5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBkdXBsaWNhdGFibGUuXG4gICAqL1xuICBpc0R1cGxpY2F0YWJsZSgpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMud29ya3NwYWNlLmhhc0Jsb2NrTGltaXRzKCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy53b3Jrc3BhY2UuaXNDYXBhY2l0eUF2YWlsYWJsZShcbiAgICAgICAgY29tbW9uLmdldEJsb2NrVHlwZUNvdW50cyh0aGlzLCB0cnVlKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBhIHNoYWRvdyBibG9jayBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgYSBzaGFkb3cuXG4gICAqL1xuICBpc1NoYWRvdygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc1NoYWRvd187XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBhIHNoYWRvdyBibG9jayBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBzaGFkb3cgVHJ1ZSBpZiBhIHNoYWRvdy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRTaGFkb3coc2hhZG93OiBib29sZWFuKSB7XG4gICAgdGhpcy5pc1NoYWRvd18gPSBzaGFkb3c7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBhbiBpbnNlcnRpb24gbWFya2VyIGJsb2NrIG9yIG5vdC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBhbiBpbnNlcnRpb24gbWFya2VyLlxuICAgKi9cbiAgaXNJbnNlcnRpb25NYXJrZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNJbnNlcnRpb25NYXJrZXJfO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgYmxvY2sgaXMgYW4gaW5zZXJ0aW9uIG1hcmtlciBibG9jayBvciBub3QuXG4gICAqIE9uY2Ugc2V0IHRoaXMgY2Fubm90IGJlIHVuc2V0LlxuICAgKlxuICAgKiBAcGFyYW0gaW5zZXJ0aW9uTWFya2VyIFRydWUgaWYgYW4gaW5zZXJ0aW9uIG1hcmtlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRJbnNlcnRpb25NYXJrZXIoaW5zZXJ0aW9uTWFya2VyOiBib29sZWFuKSB7XG4gICAgdGhpcy5pc0luc2VydGlvbk1hcmtlcl8gPSBpbnNlcnRpb25NYXJrZXI7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBlZGl0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgZWRpdGFibGUuXG4gICAqL1xuICBpc0VkaXRhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmVkaXRhYmxlXyAmJiAhdGhpcy5pc0RlYWRPckR5aW5nKCkgJiZcbiAgICAgICAgIXRoaXMud29ya3NwYWNlLm9wdGlvbnMucmVhZE9ubHk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBlZGl0YWJsZSBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBlZGl0YWJsZSBUcnVlIGlmIGVkaXRhYmxlLlxuICAgKi9cbiAgc2V0RWRpdGFibGUoZWRpdGFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmVkaXRhYmxlXyA9IGVkaXRhYmxlO1xuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMCwgZmllbGQ7IGZpZWxkID0gaW5wdXQuZmllbGRSb3dbal07IGorKykge1xuICAgICAgICBmaWVsZC51cGRhdGVFZGl0YWJsZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGlmIHRoaXMgYmxvY2sgaGFzIGJlZW4gZGlzcG9zZWQgb2YgLyBkZWxldGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgYmxvY2sgaGFzIGJlZW4gZGlzcG9zZWQgb2YgLyBkZWxldGVkLlxuICAgKi9cbiAgaXNEaXNwb3NlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5kaXNwb3NlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHRoZSBjb25uZWN0aW9uIG9uIHRoaXMgYmxvY2sgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgZ2l2ZW4gY29ubmVjdGlvblxuICAgKiBvbiB0aGUgb3RoZXIgYmxvY2suXG4gICAqIFVzZWQgdG8gbWF0Y2ggY29ubmVjdGlvbnMgYmV0d2VlbiBhIGJsb2NrIGFuZCBpdHMgaW5zZXJ0aW9uIG1hcmtlci5cbiAgICpcbiAgICogQHBhcmFtIG90aGVyQmxvY2sgVGhlIG90aGVyIGJsb2NrIHRvIG1hdGNoIGFnYWluc3QuXG4gICAqIEBwYXJhbSBjb25uIFRoZSBvdGhlciBjb25uZWN0aW9uIHRvIG1hdGNoLlxuICAgKiBAcmV0dXJucyBUaGUgbWF0Y2hpbmcgY29ubmVjdGlvbiBvbiB0aGlzIGJsb2NrLCBvciBudWxsLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldE1hdGNoaW5nQ29ubmVjdGlvbihvdGhlckJsb2NrOiBCbG9jaywgY29ubjogQ29ubmVjdGlvbik6IENvbm5lY3Rpb258bnVsbCB7XG4gICAgY29uc3QgY29ubmVjdGlvbnMgPSB0aGlzLmdldENvbm5lY3Rpb25zXyh0cnVlKTtcbiAgICBjb25zdCBvdGhlckNvbm5lY3Rpb25zID0gb3RoZXJCbG9jay5nZXRDb25uZWN0aW9uc18odHJ1ZSk7XG4gICAgaWYgKGNvbm5lY3Rpb25zLmxlbmd0aCAhPT0gb3RoZXJDb25uZWN0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHRocm93IEVycm9yKCdDb25uZWN0aW9uIGxpc3RzIGRpZCBub3QgbWF0Y2ggaW4gbGVuZ3RoLicpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG90aGVyQ29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChvdGhlckNvbm5lY3Rpb25zW2ldID09PSBjb25uKSB7XG4gICAgICAgIHJldHVybiBjb25uZWN0aW9uc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBVUkwgb2YgdGhpcyBibG9jaydzIGhlbHAgcGFnZS5cbiAgICpcbiAgICogQHBhcmFtIHVybCBVUkwgc3RyaW5nIGZvciBibG9jayBoZWxwLCBvciBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBVUkwuICBOdWxsXG4gICAqICAgICBmb3Igbm8gaGVscC5cbiAgICovXG4gIHNldEhlbHBVcmwodXJsOiBzdHJpbmd8RnVuY3Rpb24pIHtcbiAgICB0aGlzLmhlbHBVcmwgPSB1cmw7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgdG9vbHRpcCBmb3IgdGhpcyBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIG5ld1RpcCBUaGUgdGV4dCBmb3IgdGhlIHRvb2x0aXAsIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSB0ZXh0XG4gICAqICAgICBmb3IgdGhlIHRvb2x0aXAsIG9yIGEgcGFyZW50IG9iamVjdCB3aG9zZSB0b29sdGlwIHdpbGwgYmUgdXNlZC4gVG8gbm90XG4gICAqICAgICBkaXNwbGF5IGEgdG9vbHRpcCBwYXNzIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAqL1xuICBzZXRUb29sdGlwKG5ld1RpcDogVG9vbHRpcC5UaXBJbmZvKSB7XG4gICAgdGhpcy50b29sdGlwID0gbmV3VGlwO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHRvb2x0aXAgdGV4dCBmb3IgdGhpcyBibG9jay5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHRvb2x0aXAgdGV4dCBmb3IgdGhpcyBibG9jay5cbiAgICovXG4gIGdldFRvb2x0aXAoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gVG9vbHRpcC5nZXRUb29sdGlwT2ZPYmplY3QodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjb2xvdXIgb2YgYSBibG9jay5cbiAgICpcbiAgICogQHJldHVybnMgI1JSR0dCQiBzdHJpbmcuXG4gICAqL1xuICBnZXRDb2xvdXIoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jb2xvdXJfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbmFtZSBvZiB0aGUgYmxvY2sgc3R5bGUuXG4gICAqXG4gICAqIEByZXR1cm5zIE5hbWUgb2YgdGhlIGJsb2NrIHN0eWxlLlxuICAgKi9cbiAgZ2V0U3R5bGVOYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc3R5bGVOYW1lXztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIEhTViBodWUgdmFsdWUgb2YgYSBibG9jay4gIE51bGwgaWYgaHVlIG5vdCBzZXQuXG4gICAqXG4gICAqIEByZXR1cm5zIEh1ZSB2YWx1ZSAoMC0zNjApLlxuICAgKi9cbiAgZ2V0SHVlKCk6IG51bWJlcnxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5odWVfO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgY29sb3VyIG9mIGEgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBjb2xvdXIgSFNWIGh1ZSB2YWx1ZSAoMCB0byAzNjApLCAjUlJHR0JCIHN0cmluZywgb3IgYSBtZXNzYWdlXG4gICAqICAgICByZWZlcmVuY2Ugc3RyaW5nIHBvaW50aW5nIHRvIG9uZSBvZiB0aG9zZSB0d28gdmFsdWVzLlxuICAgKi9cbiAgc2V0Q29sb3VyKGNvbG91cjogbnVtYmVyfHN0cmluZykge1xuICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNpbmcucGFyc2VCbG9ja0NvbG91cihjb2xvdXIpO1xuICAgIHRoaXMuaHVlXyA9IHBhcnNlZC5odWU7XG4gICAgdGhpcy5jb2xvdXJfID0gcGFyc2VkLmhleDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHN0eWxlIGFuZCBjb2xvdXIgdmFsdWVzIG9mIGEgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja1N0eWxlTmFtZSBOYW1lIG9mIHRoZSBibG9jayBzdHlsZS5cbiAgICovXG4gIHNldFN0eWxlKGJsb2NrU3R5bGVOYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLnN0eWxlTmFtZV8gPSBibG9ja1N0eWxlTmFtZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gdXNlIHdoZW5ldmVyIHRoZSBibG9jaydzIHBhcmVudCB3b3Jrc3BhY2VcbiAgICogY2hhbmdlcywgcmVwbGFjaW5nIGFueSBwcmlvciBvbmNoYW5nZSBoYW5kbGVyLiBUaGlzIGlzIHVzdWFsbHkgb25seSBjYWxsZWRcbiAgICogZnJvbSB0aGUgY29uc3RydWN0b3IsIHRoZSBibG9jayB0eXBlIGluaXRpYWxpemVyIGZ1bmN0aW9uLCBvciBhbiBleHRlbnNpb25cbiAgICogaW5pdGlhbGl6ZXIgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBvbmNoYW5nZUZuIFRoZSBjYWxsYmFjayB0byBjYWxsIHdoZW4gdGhlIGJsb2NrJ3Mgd29ya3NwYWNlIGNoYW5nZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiBvbmNoYW5nZUZuIGlzIG5vdCBmYWxzZXkgYW5kIG5vdCBhIGZ1bmN0aW9uLlxuICAgKi9cbiAgc2V0T25DaGFuZ2Uob25jaGFuZ2VGbjogKHAxOiBBYnN0cmFjdCkgPT4gQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgaWYgKG9uY2hhbmdlRm4gJiYgdHlwZW9mIG9uY2hhbmdlRm4gIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IEVycm9yKCdvbmNoYW5nZSBtdXN0IGJlIGEgZnVuY3Rpb24uJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uY2hhbmdlV3JhcHBlcl8pIHtcbiAgICAgIHRoaXMud29ya3NwYWNlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMub25jaGFuZ2VXcmFwcGVyXyk7XG4gICAgfVxuICAgIHRoaXMub25jaGFuZ2UgPSBvbmNoYW5nZUZuO1xuICAgIHRoaXMub25jaGFuZ2VXcmFwcGVyXyA9IG9uY2hhbmdlRm4uYmluZCh0aGlzKTtcbiAgICB0aGlzLndvcmtzcGFjZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLm9uY2hhbmdlV3JhcHBlcl8pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG5hbWVkIGZpZWxkIGZyb20gYSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpZWxkLlxuICAgKiBAcmV0dXJucyBOYW1lZCBmaWVsZCwgb3IgbnVsbCBpZiBmaWVsZCBkb2VzIG5vdCBleGlzdC5cbiAgICovXG4gIGdldEZpZWxkKG5hbWU6IHN0cmluZyk6IEZpZWxkfG51bGwge1xuICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IFR5cGVFcnJvcihcbiAgICAgICAgICAnQmxvY2sucHJvdG90eXBlLmdldEZpZWxkIGV4cGVjdHMgYSBzdHJpbmcgJyArXG4gICAgICAgICAgJ3dpdGggdGhlIGZpZWxkIG5hbWUgYnV0IHJlY2VpdmVkICcgK1xuICAgICAgICAgIChuYW1lID09PSB1bmRlZmluZWQgPyAnbm90aGluZycgOiBuYW1lICsgJyBvZiB0eXBlICcgKyB0eXBlb2YgbmFtZSkgK1xuICAgICAgICAgICcgaW5zdGVhZCcpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDAsIGZpZWxkOyBmaWVsZCA9IGlucHV0LmZpZWxkUm93W2pdOyBqKyspIHtcbiAgICAgICAgaWYgKGZpZWxkLm5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB2YXJpYWJsZXMgcmVmZXJlbmNlZCBieSB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcmV0dXJucyBMaXN0IG9mIHZhcmlhYmxlIGlkcy5cbiAgICovXG4gIGdldFZhcnMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHZhcnMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDAsIGZpZWxkOyBmaWVsZCA9IGlucHV0LmZpZWxkUm93W2pdOyBqKyspIHtcbiAgICAgICAgaWYgKGZpZWxkLnJlZmVyZW5jZXNWYXJpYWJsZXMoKSkge1xuICAgICAgICAgIHZhcnMucHVzaChmaWVsZC5nZXRWYWx1ZSgpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFycztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHZhcmlhYmxlcyByZWZlcmVuY2VkIGJ5IHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEByZXR1cm5zIExpc3Qgb2YgdmFyaWFibGUgbW9kZWxzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFZhck1vZGVscygpOiBWYXJpYWJsZU1vZGVsW10ge1xuICAgIGNvbnN0IHZhcnMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDAsIGZpZWxkOyBmaWVsZCA9IGlucHV0LmZpZWxkUm93W2pdOyBqKyspIHtcbiAgICAgICAgaWYgKGZpZWxkLnJlZmVyZW5jZXNWYXJpYWJsZXMoKSkge1xuICAgICAgICAgIGNvbnN0IG1vZGVsID1cbiAgICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0VmFyaWFibGVCeUlkKGZpZWxkLmdldFZhbHVlKCkgYXMgc3RyaW5nKTtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgdmFyaWFibGUgYWN0dWFsbHkgZXhpc3RzIChhbmQgaXNuJ3QganVzdCBhIHBvdGVudGlhbFxuICAgICAgICAgIC8vIHZhcmlhYmxlKS5cbiAgICAgICAgICBpZiAobW9kZWwpIHtcbiAgICAgICAgICAgIHZhcnMucHVzaChtb2RlbCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIE5vdGlmaWNhdGlvbiB0aGF0IGEgdmFyaWFibGUgaXMgcmVuYW1pbmcgYnV0IGtlZXBpbmcgdGhlIHNhbWUgSUQuICBJZiB0aGVcbiAgICogdmFyaWFibGUgaXMgaW4gdXNlIG9uIHRoaXMgYmxvY2ssIHJlcmVuZGVyIHRvIHNob3cgdGhlIG5ldyBuYW1lLlxuICAgKlxuICAgKiBAcGFyYW0gdmFyaWFibGUgVGhlIHZhcmlhYmxlIGJlaW5nIHJlbmFtZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdXBkYXRlVmFyTmFtZSh2YXJpYWJsZTogVmFyaWFibGVNb2RlbCkge1xuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMCwgZmllbGQ7IGZpZWxkID0gaW5wdXQuZmllbGRSb3dbal07IGorKykge1xuICAgICAgICBpZiAoZmllbGQucmVmZXJlbmNlc1ZhcmlhYmxlcygpICYmXG4gICAgICAgICAgICB2YXJpYWJsZS5nZXRJZCgpID09PSBmaWVsZC5nZXRWYWx1ZSgpKSB7XG4gICAgICAgICAgZmllbGQucmVmcmVzaFZhcmlhYmxlTmFtZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE5vdGlmaWNhdGlvbiB0aGF0IGEgdmFyaWFibGUgaXMgcmVuYW1pbmcuXG4gICAqIElmIHRoZSBJRCBtYXRjaGVzIG9uZSBvZiB0aGlzIGJsb2NrJ3MgdmFyaWFibGVzLCByZW5hbWUgaXQuXG4gICAqXG4gICAqIEBwYXJhbSBvbGRJZCBJRCBvZiB2YXJpYWJsZSB0byByZW5hbWUuXG4gICAqIEBwYXJhbSBuZXdJZCBJRCBvZiBuZXcgdmFyaWFibGUuICBNYXkgYmUgdGhlIHNhbWUgYXMgb2xkSWQsIGJ1dCB3aXRoIGFuXG4gICAqICAgICB1cGRhdGVkIG5hbWUuXG4gICAqL1xuICByZW5hbWVWYXJCeUlkKG9sZElkOiBzdHJpbmcsIG5ld0lkOiBzdHJpbmcpIHtcbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDAsIGZpZWxkOyBmaWVsZCA9IGlucHV0LmZpZWxkUm93W2pdOyBqKyspIHtcbiAgICAgICAgaWYgKGZpZWxkLnJlZmVyZW5jZXNWYXJpYWJsZXMoKSAmJiBvbGRJZCA9PT0gZmllbGQuZ2V0VmFsdWUoKSkge1xuICAgICAgICAgIGZpZWxkLnNldFZhbHVlKG5ld0lkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsYW5ndWFnZS1uZXV0cmFsIHZhbHVlIG9mIHRoZSBnaXZlbiBmaWVsZC5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpZWxkLlxuICAgKiBAcmV0dXJucyBWYWx1ZSBvZiB0aGUgZmllbGQgb3IgbnVsbCBpZiBmaWVsZCBkb2VzIG5vdCBleGlzdC5cbiAgICovXG4gIGdldEZpZWxkVmFsdWUobmFtZTogc3RyaW5nKTogQW55RHVyaW5nTWlncmF0aW9uIHtcbiAgICBjb25zdCBmaWVsZCA9IHRoaXMuZ2V0RmllbGQobmFtZSk7XG4gICAgaWYgKGZpZWxkKSB7XG4gICAgICByZXR1cm4gZmllbGQuZ2V0VmFsdWUoKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIGZpZWxkIGZvciB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3VmFsdWUgVGhlIHZhbHVlIHRvIHNldC5cbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGZpZWxkIHRvIHNldCB0aGUgdmFsdWUgb2YuXG4gICAqL1xuICBzZXRGaWVsZFZhbHVlKG5ld1ZhbHVlOiBBbnlEdXJpbmdNaWdyYXRpb24sIG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGZpZWxkID0gdGhpcy5nZXRGaWVsZChuYW1lKTtcbiAgICBpZiAoIWZpZWxkKSB7XG4gICAgICB0aHJvdyBFcnJvcignRmllbGQgXCInICsgbmFtZSArICdcIiBub3QgZm91bmQuJyk7XG4gICAgfVxuICAgIGZpZWxkLnNldFZhbHVlKG5ld1ZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGlzIGJsb2NrIGNhbiBjaGFpbiBvbnRvIHRoZSBib3R0b20gb2YgYW5vdGhlciBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIG5ld0Jvb2xlYW4gVHJ1ZSBpZiB0aGVyZSBjYW4gYmUgYSBwcmV2aW91cyBzdGF0ZW1lbnQuXG4gICAqIEBwYXJhbSBvcHRfY2hlY2sgU3RhdGVtZW50IHR5cGUgb3IgbGlzdCBvZiBzdGF0ZW1lbnQgdHlwZXMuICBOdWxsL3VuZGVmaW5lZFxuICAgKiAgICAgaWYgYW55IHR5cGUgY291bGQgYmUgY29ubmVjdGVkLlxuICAgKi9cbiAgc2V0UHJldmlvdXNTdGF0ZW1lbnQobmV3Qm9vbGVhbjogYm9vbGVhbiwgb3B0X2NoZWNrPzogc3RyaW5nfHN0cmluZ1tdfG51bGwpIHtcbiAgICBpZiAobmV3Qm9vbGVhbikge1xuICAgICAgaWYgKG9wdF9jaGVjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9wdF9jaGVjayA9IG51bGw7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICAgIHRoaXMucHJldmlvdXNDb25uZWN0aW9uID1cbiAgICAgICAgICAgIHRoaXMubWFrZUNvbm5lY3Rpb25fKENvbm5lY3Rpb25UeXBlLlBSRVZJT1VTX1NUQVRFTUVOVCk7XG4gICAgICB9XG4gICAgICB0aGlzLnByZXZpb3VzQ29ubmVjdGlvbi5zZXRDaGVjayhvcHRfY2hlY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5wcmV2aW91c0Nvbm5lY3Rpb24pIHtcbiAgICAgICAgaWYgKHRoaXMucHJldmlvdXNDb25uZWN0aW9uLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAgICAgJ011c3QgZGlzY29ubmVjdCBwcmV2aW91cyBzdGF0ZW1lbnQgYmVmb3JlIHJlbW92aW5nICcgK1xuICAgICAgICAgICAgICAnY29ubmVjdGlvbi4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByZXZpb3VzQ29ubmVjdGlvbi5kaXNwb3NlKCk7XG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAgICAgICAvLyAnQ29ubmVjdGlvbicuXG4gICAgICAgIHRoaXMucHJldmlvdXNDb25uZWN0aW9uID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIGFub3RoZXIgYmxvY2sgY2FuIGNoYWluIG9udG8gdGhlIGJvdHRvbSBvZiB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Qm9vbGVhbiBUcnVlIGlmIHRoZXJlIGNhbiBiZSBhIG5leHQgc3RhdGVtZW50LlxuICAgKiBAcGFyYW0gb3B0X2NoZWNrIFN0YXRlbWVudCB0eXBlIG9yIGxpc3Qgb2Ygc3RhdGVtZW50IHR5cGVzLiAgTnVsbC91bmRlZmluZWRcbiAgICogICAgIGlmIGFueSB0eXBlIGNvdWxkIGJlIGNvbm5lY3RlZC5cbiAgICovXG4gIHNldE5leHRTdGF0ZW1lbnQobmV3Qm9vbGVhbjogYm9vbGVhbiwgb3B0X2NoZWNrPzogc3RyaW5nfHN0cmluZ1tdfG51bGwpIHtcbiAgICBpZiAobmV3Qm9vbGVhbikge1xuICAgICAgaWYgKG9wdF9jaGVjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9wdF9jaGVjayA9IG51bGw7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMubmV4dENvbm5lY3Rpb24pIHtcbiAgICAgICAgdGhpcy5uZXh0Q29ubmVjdGlvbiA9XG4gICAgICAgICAgICB0aGlzLm1ha2VDb25uZWN0aW9uXyhDb25uZWN0aW9uVHlwZS5ORVhUX1NUQVRFTUVOVCk7XG4gICAgICB9XG4gICAgICB0aGlzLm5leHRDb25uZWN0aW9uLnNldENoZWNrKG9wdF9jaGVjayk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLm5leHRDb25uZWN0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLm5leHRDb25uZWN0aW9uLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAgICAgJ011c3QgZGlzY29ubmVjdCBuZXh0IHN0YXRlbWVudCBiZWZvcmUgcmVtb3ZpbmcgJyArXG4gICAgICAgICAgICAgICdjb25uZWN0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmV4dENvbm5lY3Rpb24uZGlzcG9zZSgpO1xuICAgICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ251bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgICAgICAgLy8gJ0Nvbm5lY3Rpb24nLlxuICAgICAgICB0aGlzLm5leHRDb25uZWN0aW9uID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgYmxvY2sgcmV0dXJucyBhIHZhbHVlLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Qm9vbGVhbiBUcnVlIGlmIHRoZXJlIGlzIGFuIG91dHB1dC5cbiAgICogQHBhcmFtIG9wdF9jaGVjayBSZXR1cm5lZCB0eXBlIG9yIGxpc3Qgb2YgcmV0dXJuZWQgdHlwZXMuICBOdWxsIG9yXG4gICAqICAgICB1bmRlZmluZWQgaWYgYW55IHR5cGUgY291bGQgYmUgcmV0dXJuZWQgKGUuZy4gdmFyaWFibGUgZ2V0KS5cbiAgICovXG4gIHNldE91dHB1dChuZXdCb29sZWFuOiBib29sZWFuLCBvcHRfY2hlY2s/OiBzdHJpbmd8c3RyaW5nW118bnVsbCkge1xuICAgIGlmIChuZXdCb29sZWFuKSB7XG4gICAgICBpZiAob3B0X2NoZWNrID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgb3B0X2NoZWNrID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICAgIHRoaXMub3V0cHV0Q29ubmVjdGlvbiA9XG4gICAgICAgICAgICB0aGlzLm1ha2VDb25uZWN0aW9uXyhDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUUpO1xuICAgICAgfVxuICAgICAgdGhpcy5vdXRwdXRDb25uZWN0aW9uLnNldENoZWNrKG9wdF9jaGVjayk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgICAgaWYgKHRoaXMub3V0cHV0Q29ubmVjdGlvbi5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgICdNdXN0IGRpc2Nvbm5lY3Qgb3V0cHV0IHZhbHVlIGJlZm9yZSByZW1vdmluZyBjb25uZWN0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3V0cHV0Q29ubmVjdGlvbi5kaXNwb3NlKCk7XG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAgICAgICAvLyAnQ29ubmVjdGlvbicuXG4gICAgICAgIHRoaXMub3V0cHV0Q29ubmVjdGlvbiA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB2YWx1ZSBpbnB1dHMgYXJlIGFycmFuZ2VkIGhvcml6b250YWxseSBvciB2ZXJ0aWNhbGx5LlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Qm9vbGVhbiBUcnVlIGlmIGlucHV0cyBhcmUgaG9yaXpvbnRhbC5cbiAgICovXG4gIHNldElucHV0c0lubGluZShuZXdCb29sZWFuOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuaW5wdXRzSW5saW5lICE9PSBuZXdCb29sZWFuKSB7XG4gICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX0NIQU5HRSkpKFxuICAgICAgICAgIHRoaXMsICdpbmxpbmUnLCBudWxsLCB0aGlzLmlucHV0c0lubGluZSwgbmV3Qm9vbGVhbikpO1xuICAgICAgdGhpcy5pbnB1dHNJbmxpbmUgPSBuZXdCb29sZWFuO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgd2hldGhlciB2YWx1ZSBpbnB1dHMgYXJlIGFycmFuZ2VkIGhvcml6b250YWxseSBvciB2ZXJ0aWNhbGx5LlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGlucHV0cyBhcmUgaG9yaXpvbnRhbC5cbiAgICovXG4gIGdldElucHV0c0lubGluZSgpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5pbnB1dHNJbmxpbmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gU2V0IGV4cGxpY2l0bHkuXG4gICAgICByZXR1cm4gdGhpcy5pbnB1dHNJbmxpbmU7XG4gICAgfVxuICAgIC8vIE5vdCBkZWZpbmVkIGV4cGxpY2l0bHkuICBGaWd1cmUgb3V0IHdoYXQgd291bGQgbG9vayBiZXN0LlxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLmlucHV0TGlzdFtpIC0gMV0udHlwZSA9PT0gaW5wdXRUeXBlcy5EVU1NWSAmJlxuICAgICAgICAgIHRoaXMuaW5wdXRMaXN0W2ldLnR5cGUgPT09IGlucHV0VHlwZXMuRFVNTVkpIHtcbiAgICAgICAgLy8gVHdvIGR1bW15IGlucHV0cyBpbiBhIHJvdy4gIERvbid0IGlubGluZSB0aGVtLlxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLmlucHV0TGlzdFtpIC0gMV0udHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSAmJlxuICAgICAgICAgIHRoaXMuaW5wdXRMaXN0W2ldLnR5cGUgPT09IGlucHV0VHlwZXMuRFVNTVkpIHtcbiAgICAgICAgLy8gRHVtbXkgaW5wdXQgYWZ0ZXIgYSB2YWx1ZSBpbnB1dC4gIElubGluZSB0aGVtLlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgYmxvY2sncyBvdXRwdXQgc2hhcGUuXG4gICAqXG4gICAqIEBwYXJhbSBvdXRwdXRTaGFwZSBWYWx1ZSByZXByZXNlbnRpbmcgYW4gb3V0cHV0IHNoYXBlLlxuICAgKi9cbiAgc2V0T3V0cHV0U2hhcGUob3V0cHV0U2hhcGU6IG51bWJlcnxudWxsKSB7XG4gICAgdGhpcy5vdXRwdXRTaGFwZV8gPSBvdXRwdXRTaGFwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGJsb2NrJ3Mgb3V0cHV0IHNoYXBlLlxuICAgKlxuICAgKiBAcmV0dXJucyBWYWx1ZSByZXByZXNlbnRpbmcgb3V0cHV0IHNoYXBlIGlmIG9uZSBleGlzdHMuXG4gICAqL1xuICBnZXRPdXRwdXRTaGFwZSgpOiBudW1iZXJ8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMub3V0cHV0U2hhcGVfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB3aGV0aGVyIHRoaXMgYmxvY2sgaXMgZW5hYmxlZCBvciBub3QuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgZW5hYmxlZC5cbiAgICovXG4gIGlzRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuZGlzYWJsZWQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhlIGJsb2NrIGlzIGVuYWJsZWQgb3Igbm90LlxuICAgKlxuICAgKiBAcGFyYW0gZW5hYmxlZCBUcnVlIGlmIGVuYWJsZWQuXG4gICAqL1xuICBzZXRFbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5pc0VuYWJsZWQoKSAhPT0gZW5hYmxlZCkge1xuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmRpc2FibGVkO1xuICAgICAgdGhpcy5kaXNhYmxlZCA9ICFlbmFibGVkO1xuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19DSEFOR0UpKShcbiAgICAgICAgICB0aGlzLCAnZGlzYWJsZWQnLCBudWxsLCBvbGRWYWx1ZSwgIWVuYWJsZWQpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgdGhlIGJsb2NrIGlzIGRpc2FibGVkIG9yIG5vdCBkdWUgdG8gcGFyZW50cy5cbiAgICogVGhlIGJsb2NrJ3Mgb3duIGRpc2FibGVkIHByb3BlcnR5IGlzIG5vdCBjb25zaWRlcmVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGRpc2FibGVkLlxuICAgKi9cbiAgZ2V0SW5oZXJpdGVkRGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgbGV0IGFuY2VzdG9yID0gdGhpcy5nZXRTdXJyb3VuZFBhcmVudCgpO1xuICAgIHdoaWxlIChhbmNlc3Rvcikge1xuICAgICAgaWYgKGFuY2VzdG9yLmRpc2FibGVkKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgYW5jZXN0b3IgPSBhbmNlc3Rvci5nZXRTdXJyb3VuZFBhcmVudCgpO1xuICAgIH1cbiAgICAvLyBSYW4gb2ZmIHRoZSB0b3AuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB3aGV0aGVyIHRoZSBibG9jayBpcyBjb2xsYXBzZWQgb3Igbm90LlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGNvbGxhcHNlZC5cbiAgICovXG4gIGlzQ29sbGFwc2VkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvbGxhcHNlZF87XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhlIGJsb2NrIGlzIGNvbGxhcHNlZCBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBjb2xsYXBzZWQgVHJ1ZSBpZiBjb2xsYXBzZWQuXG4gICAqL1xuICBzZXRDb2xsYXBzZWQoY29sbGFwc2VkOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuY29sbGFwc2VkXyAhPT0gY29sbGFwc2VkKSB7XG4gICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX0NIQU5HRSkpKFxuICAgICAgICAgIHRoaXMsICdjb2xsYXBzZWQnLCBudWxsLCB0aGlzLmNvbGxhcHNlZF8sIGNvbGxhcHNlZCkpO1xuICAgICAgdGhpcy5jb2xsYXBzZWRfID0gY29sbGFwc2VkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBodW1hbi1yZWFkYWJsZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYmxvY2sgYW5kIGFueSBjaGlsZHJlbi5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9tYXhMZW5ndGggVHJ1bmNhdGUgdGhlIHN0cmluZyB0byB0aGlzIGxlbmd0aC5cbiAgICogQHBhcmFtIG9wdF9lbXB0eVRva2VuIFRoZSBwbGFjZWhvbGRlciBzdHJpbmcgdXNlZCB0byBkZW5vdGUgYW4gZW1wdHkgZmllbGQuXG4gICAqICAgICBJZiBub3Qgc3BlY2lmaWVkLCAnPycgaXMgdXNlZC5cbiAgICogQHJldHVybnMgVGV4dCBvZiBibG9jay5cbiAgICovXG4gIHRvU3RyaW5nKG9wdF9tYXhMZW5ndGg/OiBudW1iZXIsIG9wdF9lbXB0eVRva2VuPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCB0b2tlbnMgPSBbXTtcbiAgICBjb25zdCBlbXB0eUZpZWxkUGxhY2Vob2xkZXIgPSBvcHRfZW1wdHlUb2tlbiB8fCAnPyc7XG5cbiAgICAvLyBUZW1wb3JhcmlseSBzZXQgZmxhZyB0byBuYXZpZ2F0ZSB0byBhbGwgZmllbGRzLlxuICAgIGNvbnN0IHByZXZOYXZpZ2F0ZUZpZWxkcyA9IEFTVE5vZGUuTkFWSUdBVEVfQUxMX0ZJRUxEUztcbiAgICBBU1ROb2RlLk5BVklHQVRFX0FMTF9GSUVMRFMgPSB0cnVlO1xuXG4gICAgbGV0IG5vZGUgPSBBU1ROb2RlLmNyZWF0ZUJsb2NrTm9kZSh0aGlzKTtcbiAgICBjb25zdCByb290Tm9kZSA9IG5vZGU7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0byBhZGQgcGFyZW50aGVzZXMgYXJvdW5kIGFuIGlucHV0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbm5lY3Rpb24gVGhlIGNvbm5lY3Rpb24uXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB3ZSBzaG91bGQgYWRkIHBhcmVudGhlc2VzIGFyb3VuZCB0aGUgaW5wdXQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvdWxkQWRkUGFyZW50aGVzZXMoY29ubmVjdGlvbjogQ29ubmVjdGlvbik6IGJvb2xlYW4ge1xuICAgICAgbGV0IGNoZWNrcyA9IGNvbm5lY3Rpb24uZ2V0Q2hlY2soKTtcbiAgICAgIGlmICghY2hlY2tzICYmIGNvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbikge1xuICAgICAgICBjaGVja3MgPSBjb25uZWN0aW9uLnRhcmdldENvbm5lY3Rpb24uZ2V0Q2hlY2soKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAhIWNoZWNrcyAmJlxuICAgICAgICAgIChjaGVja3MuaW5kZXhPZignQm9vbGVhbicpICE9PSAtMSB8fCBjaGVja3MuaW5kZXhPZignTnVtYmVyJykgIT09IC0xKTtcbiAgICB9XG5cbiAgICAvKiogQ2hlY2sgdGhhdCB3ZSBoYXZlbid0IGNpcmNsZWQgYmFjayB0byB0aGUgb3JpZ2luYWwgcm9vdCBub2RlLiAqL1xuICAgIGZ1bmN0aW9uIGNoZWNrUm9vdCgpIHtcbiAgICAgIGlmIChub2RlICYmIG5vZGUuZ2V0VHlwZSgpID09PSByb290Tm9kZT8uZ2V0VHlwZSgpICYmXG4gICAgICAgICAgbm9kZS5nZXRMb2NhdGlvbigpID09PSByb290Tm9kZT8uZ2V0TG9jYXRpb24oKSkge1xuICAgICAgICBub2RlID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUcmF2ZXJzZSB0aGUgQVNUIGJ1aWxkaW5nIHVwIG91ciB0ZXh0IHN0cmluZy5cbiAgICB3aGlsZSAobm9kZSkge1xuICAgICAgc3dpdGNoIChub2RlLmdldFR5cGUoKSkge1xuICAgICAgICBjYXNlIEFTVE5vZGUudHlwZXMuSU5QVVQ6IHtcbiAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gbm9kZS5nZXRMb2NhdGlvbigpIGFzIENvbm5lY3Rpb247XG4gICAgICAgICAgaWYgKCFub2RlLmluKCkpIHtcbiAgICAgICAgICAgIHRva2Vucy5wdXNoKGVtcHR5RmllbGRQbGFjZWhvbGRlcik7XG4gICAgICAgICAgfSBlbHNlIGlmIChzaG91bGRBZGRQYXJlbnRoZXNlcyhjb25uZWN0aW9uKSkge1xuICAgICAgICAgICAgdG9rZW5zLnB1c2goJygnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBBU1ROb2RlLnR5cGVzLkZJRUxEOiB7XG4gICAgICAgICAgY29uc3QgZmllbGQgPSBub2RlLmdldExvY2F0aW9uKCkgYXMgRmllbGQ7XG4gICAgICAgICAgaWYgKGZpZWxkLm5hbWUgIT09IGNvbnN0YW50cy5DT0xMQVBTRURfRklFTERfTkFNRSkge1xuICAgICAgICAgICAgdG9rZW5zLnB1c2goZmllbGQuZ2V0VGV4dCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgY3VycmVudCA9IG5vZGU7XG4gICAgICBub2RlID0gY3VycmVudC5pbigpIHx8IGN1cnJlbnQubmV4dCgpO1xuICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgIC8vIENhbid0IGdvIGluIG9yIG5leHQsIGtlZXAgZ29pbmcgb3V0IHVudGlsIHdlIGNhbiBnbyBuZXh0LlxuICAgICAgICBub2RlID0gY3VycmVudC5vdXQoKTtcbiAgICAgICAgY2hlY2tSb290KCk7XG4gICAgICAgIHdoaWxlIChub2RlICYmICFub2RlLm5leHQoKSkge1xuICAgICAgICAgIG5vZGUgPSBub2RlLm91dCgpO1xuICAgICAgICAgIGNoZWNrUm9vdCgpO1xuICAgICAgICAgIC8vIElmIHdlIGhpdCBhbiBpbnB1dCBvbiB0aGUgd2F5IHVwLCBwb3NzaWJseSBjbG9zZSBvdXQgcGFyZW50aGVzZXMuXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5nZXRUeXBlKCkgPT09IEFTVE5vZGUudHlwZXMuSU5QVVQgJiZcbiAgICAgICAgICAgICAgc2hvdWxkQWRkUGFyZW50aGVzZXMobm9kZS5nZXRMb2NhdGlvbigpIGFzIENvbm5lY3Rpb24pKSB7XG4gICAgICAgICAgICB0b2tlbnMucHVzaCgnKScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgIG5vZGUgPSBub2RlLm5leHQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlc3RvcmUgc3RhdGUgb2YgTkFWSUdBVEVfQUxMX0ZJRUxEUy5cbiAgICBBU1ROb2RlLk5BVklHQVRFX0FMTF9GSUVMRFMgPSBwcmV2TmF2aWdhdGVGaWVsZHM7XG5cbiAgICAvLyBSdW4gdGhyb3VnaCBvdXIgdGV4dCBhcnJheSBhbmQgc2ltcGxpZnkgZXhwcmVzc2lvbiB0byByZW1vdmUgcGFyZW50aGVzZXNcbiAgICAvLyBhcm91bmQgc2luZ2xlIGZpZWxkIGJsb2Nrcy5cbiAgICAvLyBFLmcuIFsncmVwZWF0JywgJygnLCAnMTAnLCAnKScsICd0aW1lcycsICdkbycsICc/J11cbiAgICBmb3IgKGxldCBpID0gMjsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRva2Vuc1tpIC0gMl0gPT09ICcoJyAmJiB0b2tlbnNbaV0gPT09ICcpJykge1xuICAgICAgICB0b2tlbnNbaSAtIDJdID0gdG9rZW5zW2kgLSAxXTtcbiAgICAgICAgdG9rZW5zLnNwbGljZShpIC0gMSwgMik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSm9pbiB0aGUgdGV4dCBhcnJheSwgcmVtb3Zpbmcgc3BhY2VzIGFyb3VuZCBhZGRlZCBwYXJlbnRoZXNlcy5cbiAgICBsZXQgdGV4dDogc3RyaW5nID0gdG9rZW5zLnJlZHVjZShmdW5jdGlvbihhY2MsIHZhbHVlKSB7XG4gICAgICByZXR1cm4gYWNjICsgKGFjYy5zdWJzdHIoLTEpID09PSAnKCcgfHwgdmFsdWUgPT09ICcpJyA/ICcnIDogJyAnKSArIHZhbHVlO1xuICAgIH0sICcnKTtcblxuICAgIHRleHQgPSB0ZXh0LnRyaW0oKSB8fCAnPz8/JztcbiAgICBpZiAob3B0X21heExlbmd0aCkge1xuICAgICAgLy8gVE9ETzogSW1wcm92ZSB0cnVuY2F0aW9uIHNvIHRoYXQgdGV4dCBmcm9tIHRoaXMgYmxvY2sgaXMgZ2l2ZW5cbiAgICAgIC8vIHByaW9yaXR5LiBFLmcuIFwiMSsyKzMrNCs1KzYrNys4Kzk9MFwiIHNob3VsZCBiZSBcIi4uLjYrNys4Kzk9MFwiLCBub3RcbiAgICAgIC8vIFwiMSsyKzMrNCs1Li4uXCIuIEUuZy4gXCIxKzIrMys0KzU9Nis3KzgrOSswXCIgc2hvdWxkIGJlIFwiLi4uNCs1PTYrNy4uLlwiLlxuICAgICAgaWYgKHRleHQubGVuZ3RoID4gb3B0X21heExlbmd0aCkge1xuICAgICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoMCwgb3B0X21heExlbmd0aCAtIDMpICsgJy4uLic7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0ZXh0O1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3J0Y3V0IGZvciBhcHBlbmRpbmcgYSB2YWx1ZSBpbnB1dCByb3cuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIExhbmd1YWdlLW5ldXRyYWwgaWRlbnRpZmllciB3aGljaCBtYXkgdXNlZCB0byBmaW5kIHRoaXMgaW5wdXRcbiAgICogICAgIGFnYWluLiAgU2hvdWxkIGJlIHVuaXF1ZSB0byB0aGlzIGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgb2JqZWN0IGNyZWF0ZWQuXG4gICAqL1xuICBhcHBlbmRWYWx1ZUlucHV0KG5hbWU6IHN0cmluZyk6IElucHV0IHtcbiAgICByZXR1cm4gdGhpcy5hcHBlbmRJbnB1dF8oaW5wdXRUeXBlcy5WQUxVRSwgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvcnRjdXQgZm9yIGFwcGVuZGluZyBhIHN0YXRlbWVudCBpbnB1dCByb3cuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIExhbmd1YWdlLW5ldXRyYWwgaWRlbnRpZmllciB3aGljaCBtYXkgdXNlZCB0byBmaW5kIHRoaXMgaW5wdXRcbiAgICogICAgIGFnYWluLiAgU2hvdWxkIGJlIHVuaXF1ZSB0byB0aGlzIGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgb2JqZWN0IGNyZWF0ZWQuXG4gICAqL1xuICBhcHBlbmRTdGF0ZW1lbnRJbnB1dChuYW1lOiBzdHJpbmcpOiBJbnB1dCB7XG4gICAgcmV0dXJuIHRoaXMuYXBwZW5kSW5wdXRfKGlucHV0VHlwZXMuU1RBVEVNRU5ULCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG9ydGN1dCBmb3IgYXBwZW5kaW5nIGEgZHVtbXkgaW5wdXQgcm93LlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25hbWUgTGFuZ3VhZ2UtbmV1dHJhbCBpZGVudGlmaWVyIHdoaWNoIG1heSB1c2VkIHRvIGZpbmQgdGhpc1xuICAgKiAgICAgaW5wdXQgYWdhaW4uICBTaG91bGQgYmUgdW5pcXVlIHRvIHRoaXMgYmxvY2suXG4gICAqIEByZXR1cm5zIFRoZSBpbnB1dCBvYmplY3QgY3JlYXRlZC5cbiAgICovXG4gIGFwcGVuZER1bW15SW5wdXQob3B0X25hbWU/OiBzdHJpbmcpOiBJbnB1dCB7XG4gICAgcmV0dXJuIHRoaXMuYXBwZW5kSW5wdXRfKGlucHV0VHlwZXMuRFVNTVksIG9wdF9uYW1lIHx8ICcnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoaXMgYmxvY2sgdXNpbmcgYSBjcm9zcy1wbGF0Zm9ybSwgaW50ZXJuYXRpb25hbGl6YXRpb24tZnJpZW5kbHlcbiAgICogSlNPTiBkZXNjcmlwdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gU3RydWN0dXJlZCBkYXRhIGRlc2NyaWJpbmcgdGhlIGJsb2NrLlxuICAgKi9cbiAganNvbkluaXQoanNvbjogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgY29uc3Qgd2FybmluZ1ByZWZpeCA9IGpzb25bJ3R5cGUnXSA/ICdCbG9jayBcIicgKyBqc29uWyd0eXBlJ10gKyAnXCI6ICcgOiAnJztcblxuICAgIC8vIFZhbGlkYXRlIGlucHV0cy5cbiAgICBpZiAoanNvblsnb3V0cHV0J10gJiYganNvblsncHJldmlvdXNTdGF0ZW1lbnQnXSkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgd2FybmluZ1ByZWZpeCArXG4gICAgICAgICAgJ011c3Qgbm90IGhhdmUgYm90aCBhbiBvdXRwdXQgYW5kIGEgcHJldmlvdXNTdGF0ZW1lbnQuJyk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGJhc2ljIHByb3BlcnRpZXMgb2YgYmxvY2suXG4gICAgLy8gTWFrZXMgc3R5bGVzIGJhY2t3YXJkIGNvbXBhdGlibGUgd2l0aCBvbGQgd2F5IG9mIGRlZmluaW5nIGhhdCBzdHlsZS5cbiAgICBpZiAoanNvblsnc3R5bGUnXSAmJiBqc29uWydzdHlsZSddLmhhdCkge1xuICAgICAgdGhpcy5oYXQgPSBqc29uWydzdHlsZSddLmhhdDtcbiAgICAgIC8vIE11c3Qgc2V0IHRvIG51bGwgc28gaXQgZG9lc24ndCBlcnJvciB3aGVuIGNoZWNraW5nIGZvciBzdHlsZSBhbmRcbiAgICAgIC8vIGNvbG91ci5cbiAgICAgIGpzb25bJ3N0eWxlJ10gPSBudWxsO1xuICAgIH1cblxuICAgIGlmIChqc29uWydzdHlsZSddICYmIGpzb25bJ2NvbG91ciddKSB7XG4gICAgICB0aHJvdyBFcnJvcih3YXJuaW5nUHJlZml4ICsgJ011c3Qgbm90IGhhdmUgYm90aCBhIGNvbG91ciBhbmQgYSBzdHlsZS4nKTtcbiAgICB9IGVsc2UgaWYgKGpzb25bJ3N0eWxlJ10pIHtcbiAgICAgIHRoaXMuanNvbkluaXRTdHlsZV8oanNvbiwgd2FybmluZ1ByZWZpeCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuanNvbkluaXRDb2xvdXJfKGpzb24sIHdhcm5pbmdQcmVmaXgpO1xuICAgIH1cblxuICAgIC8vIEludGVycG9sYXRlIHRoZSBtZXNzYWdlIGJsb2Nrcy5cbiAgICBsZXQgaSA9IDA7XG4gICAgd2hpbGUgKGpzb25bJ21lc3NhZ2UnICsgaV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5pbnRlcnBvbGF0ZV8oXG4gICAgICAgICAganNvblsnbWVzc2FnZScgKyBpXSwganNvblsnYXJncycgKyBpXSB8fCBbXSxcbiAgICAgICAgICBqc29uWydsYXN0RHVtbXlBbGlnbicgKyBpXSwgd2FybmluZ1ByZWZpeCk7XG4gICAgICBpKys7XG4gICAgfVxuXG4gICAgaWYgKGpzb25bJ2lucHV0c0lubGluZSddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuc2V0SW5wdXRzSW5saW5lKGpzb25bJ2lucHV0c0lubGluZSddKTtcbiAgICB9XG4gICAgLy8gU2V0IG91dHB1dCBhbmQgcHJldmlvdXMvbmV4dCBjb25uZWN0aW9ucy5cbiAgICBpZiAoanNvblsnb3V0cHV0J10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5zZXRPdXRwdXQodHJ1ZSwganNvblsnb3V0cHV0J10pO1xuICAgIH1cbiAgICBpZiAoanNvblsnb3V0cHV0U2hhcGUnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnNldE91dHB1dFNoYXBlKGpzb25bJ291dHB1dFNoYXBlJ10pO1xuICAgIH1cbiAgICBpZiAoanNvblsncHJldmlvdXNTdGF0ZW1lbnQnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnNldFByZXZpb3VzU3RhdGVtZW50KHRydWUsIGpzb25bJ3ByZXZpb3VzU3RhdGVtZW50J10pO1xuICAgIH1cbiAgICBpZiAoanNvblsnbmV4dFN0YXRlbWVudCddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuc2V0TmV4dFN0YXRlbWVudCh0cnVlLCBqc29uWyduZXh0U3RhdGVtZW50J10pO1xuICAgIH1cbiAgICBpZiAoanNvblsndG9vbHRpcCddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IHJhd1ZhbHVlID0ganNvblsndG9vbHRpcCddO1xuICAgICAgY29uc3QgbG9jYWxpemVkVGV4dCA9IHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKHJhd1ZhbHVlKTtcbiAgICAgIHRoaXMuc2V0VG9vbHRpcChsb2NhbGl6ZWRUZXh0KTtcbiAgICB9XG4gICAgaWYgKGpzb25bJ2VuYWJsZUNvbnRleHRNZW51J10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5jb250ZXh0TWVudSA9ICEhanNvblsnZW5hYmxlQ29udGV4dE1lbnUnXTtcbiAgICB9XG4gICAgaWYgKGpzb25bJ3N1cHByZXNzUHJlZml4U3VmZml4J10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5zdXBwcmVzc1ByZWZpeFN1ZmZpeCA9ICEhanNvblsnc3VwcHJlc3NQcmVmaXhTdWZmaXgnXTtcbiAgICB9XG4gICAgaWYgKGpzb25bJ2hlbHBVcmwnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCByYXdWYWx1ZSA9IGpzb25bJ2hlbHBVcmwnXTtcbiAgICAgIGNvbnN0IGxvY2FsaXplZFZhbHVlID0gcGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMocmF3VmFsdWUpO1xuICAgICAgdGhpcy5zZXRIZWxwVXJsKGxvY2FsaXplZFZhbHVlKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBqc29uWydleHRlbnNpb25zJ10gPT09ICdzdHJpbmcnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgd2FybmluZ1ByZWZpeCArXG4gICAgICAgICAgJ0pTT04gYXR0cmlidXRlIFxcJ2V4dGVuc2lvbnNcXCcgc2hvdWxkIGJlIGFuIGFycmF5IG9mJyArXG4gICAgICAgICAgJyBzdHJpbmdzLiBGb3VuZCByYXcgc3RyaW5nIGluIEpTT04gZm9yIFxcJycgKyBqc29uWyd0eXBlJ10gK1xuICAgICAgICAgICdcXCcgYmxvY2suJyk7XG4gICAgICBqc29uWydleHRlbnNpb25zJ10gPSBbanNvblsnZXh0ZW5zaW9ucyddXTsgIC8vIENvcnJlY3QgYW5kIGNvbnRpbnVlLlxuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgbXV0YXRvciB0byB0aGUgYmxvY2suXG4gICAgaWYgKGpzb25bJ211dGF0b3InXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBFeHRlbnNpb25zLmFwcGx5KGpzb25bJ211dGF0b3InXSwgdGhpcywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgZXh0ZW5zaW9uTmFtZXMgPSBqc29uWydleHRlbnNpb25zJ107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZXh0ZW5zaW9uTmFtZXMpKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGV4dGVuc2lvbk5hbWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIEV4dGVuc2lvbnMuYXBwbHkoZXh0ZW5zaW9uTmFtZXNbal0sIHRoaXMsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgY29sb3VyIG9mIHRoaXMgYmxvY2sgZnJvbSB0aGUgSlNPTiBkZXNjcmlwdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gU3RydWN0dXJlZCBkYXRhIGRlc2NyaWJpbmcgdGhlIGJsb2NrLlxuICAgKiBAcGFyYW0gd2FybmluZ1ByZWZpeCBXYXJuaW5nIHByZWZpeCBzdHJpbmcgaWRlbnRpZnlpbmcgYmxvY2suXG4gICAqL1xuICBwcml2YXRlIGpzb25Jbml0Q29sb3VyXyhqc29uOiBBbnlEdXJpbmdNaWdyYXRpb24sIHdhcm5pbmdQcmVmaXg6IHN0cmluZykge1xuICAgIGlmICgnY29sb3VyJyBpbiBqc29uKSB7XG4gICAgICBpZiAoanNvblsnY29sb3VyJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zb2xlLndhcm4od2FybmluZ1ByZWZpeCArICdVbmRlZmluZWQgY29sb3VyIHZhbHVlLicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcmF3VmFsdWUgPSBqc29uWydjb2xvdXInXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLnNldENvbG91cihyYXdWYWx1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4od2FybmluZ1ByZWZpeCArICdJbGxlZ2FsIGNvbG91ciB2YWx1ZTogJywgcmF3VmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHN0eWxlIG9mIHRoaXMgYmxvY2sgZnJvbSB0aGUgSlNPTiBkZXNjcmlwdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gU3RydWN0dXJlZCBkYXRhIGRlc2NyaWJpbmcgdGhlIGJsb2NrLlxuICAgKiBAcGFyYW0gd2FybmluZ1ByZWZpeCBXYXJuaW5nIHByZWZpeCBzdHJpbmcgaWRlbnRpZnlpbmcgYmxvY2suXG4gICAqL1xuICBwcml2YXRlIGpzb25Jbml0U3R5bGVfKGpzb246IEFueUR1cmluZ01pZ3JhdGlvbiwgd2FybmluZ1ByZWZpeDogc3RyaW5nKSB7XG4gICAgY29uc3QgYmxvY2tTdHlsZU5hbWUgPSBqc29uWydzdHlsZSddO1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnNldFN0eWxlKGJsb2NrU3R5bGVOYW1lKTtcbiAgICB9IGNhdGNoIChzdHlsZUVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4od2FybmluZ1ByZWZpeCArICdTdHlsZSBkb2VzIG5vdCBleGlzdDogJywgYmxvY2tTdHlsZU5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQga2V5L3ZhbHVlcyBmcm9tIG1peGluT2JqIHRvIHRoaXMgYmxvY2sgb2JqZWN0LiBCeSBkZWZhdWx0LCB0aGlzIG1ldGhvZFxuICAgKiB3aWxsIGNoZWNrIHRoYXQgdGhlIGtleXMgaW4gbWl4aW5PYmogd2lsbCBub3Qgb3ZlcndyaXRlIGV4aXN0aW5nIHZhbHVlcyBpblxuICAgKiB0aGUgYmxvY2ssIGluY2x1ZGluZyBwcm90b3R5cGUgdmFsdWVzLiBUaGlzIHByb3ZpZGVzIHNvbWUgaW5zdXJhbmNlIGFnYWluc3RcbiAgICogbWl4aW4gLyBleHRlbnNpb24gaW5jb21wYXRpYmlsaXRpZXMgd2l0aCBmdXR1cmUgYmxvY2sgZmVhdHVyZXMuIFRoaXMgY2hlY2tcbiAgICogY2FuIGJlIGRpc2FibGVkIGJ5IHBhc3NpbmcgdHJ1ZSBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50LlxuICAgKlxuICAgKiBAcGFyYW0gbWl4aW5PYmogVGhlIGtleS92YWx1ZXMgcGFpcnMgdG8gYWRkIHRvIHRoaXMgYmxvY2sgb2JqZWN0LlxuICAgKiBAcGFyYW0gb3B0X2Rpc2FibGVDaGVjayBPcHRpb24gZmxhZyB0byBkaXNhYmxlIG92ZXJ3cml0ZSBjaGVja3MuXG4gICAqL1xuICBtaXhpbihtaXhpbk9iajogQW55RHVyaW5nTWlncmF0aW9uLCBvcHRfZGlzYWJsZUNoZWNrPzogYm9vbGVhbikge1xuICAgIGlmIChvcHRfZGlzYWJsZUNoZWNrICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgdHlwZW9mIG9wdF9kaXNhYmxlQ2hlY2sgIT09ICdib29sZWFuJykge1xuICAgICAgdGhyb3cgRXJyb3IoJ29wdF9kaXNhYmxlQ2hlY2sgbXVzdCBiZSBhIGJvb2xlYW4gaWYgcHJvdmlkZWQnKTtcbiAgICB9XG4gICAgaWYgKCFvcHRfZGlzYWJsZUNoZWNrKSB7XG4gICAgICBjb25zdCBvdmVyd3JpdGVzID0gW107XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBtaXhpbk9iaikge1xuICAgICAgICBpZiAoKHRoaXMgYXMgQW55RHVyaW5nTWlncmF0aW9uKVtrZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBvdmVyd3JpdGVzLnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG92ZXJ3cml0ZXMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgJ01peGluIHdpbGwgb3ZlcndyaXRlIGJsb2NrIG1lbWJlcnM6ICcgK1xuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkob3ZlcndyaXRlcykpO1xuICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIG1peGluT2JqKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcnBvbGF0ZSBhIG1lc3NhZ2UgZGVzY3JpcHRpb24gb250byB0aGUgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBtZXNzYWdlIFRleHQgY29udGFpbnMgaW50ZXJwb2xhdGlvbiB0b2tlbnMgKCUxLCAlMiwgLi4uKSB0aGF0IG1hdGNoXG4gICAqICAgICB3aXRoIGZpZWxkcyBvciBpbnB1dHMgZGVmaW5lZCBpbiB0aGUgYXJncyBhcnJheS5cbiAgICogQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIGludGVycG9sYXRlZC5cbiAgICogQHBhcmFtIGxhc3REdW1teUFsaWduIElmIGEgZHVtbXkgaW5wdXQgaXMgYWRkZWQgYXQgdGhlIGVuZCwgaG93IHNob3VsZCBpdFxuICAgKiAgICAgYmUgYWxpZ25lZD9cbiAgICogQHBhcmFtIHdhcm5pbmdQcmVmaXggV2FybmluZyBwcmVmaXggc3RyaW5nIGlkZW50aWZ5aW5nIGJsb2NrLlxuICAgKi9cbiAgcHJpdmF0ZSBpbnRlcnBvbGF0ZV8oXG4gICAgICBtZXNzYWdlOiBzdHJpbmcsIGFyZ3M6IEFueUR1cmluZ01pZ3JhdGlvbltdLFxuICAgICAgbGFzdER1bW15QWxpZ246IHN0cmluZ3x1bmRlZmluZWQsIHdhcm5pbmdQcmVmaXg6IHN0cmluZykge1xuICAgIGNvbnN0IHRva2VucyA9IHBhcnNpbmcudG9rZW5pemVJbnRlcnBvbGF0aW9uKG1lc3NhZ2UpO1xuICAgIHRoaXMudmFsaWRhdGVUb2tlbnNfKHRva2VucywgYXJncy5sZW5ndGgpO1xuICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5pbnRlcnBvbGF0ZUFyZ3VtZW50c18odG9rZW5zLCBhcmdzLCBsYXN0RHVtbXlBbGlnbik7XG5cbiAgICAvLyBBbiBhcnJheSBvZiBbZmllbGQsIGZpZWxkTmFtZV0gdHVwbGVzLlxuICAgIGNvbnN0IGZpZWxkU3RhY2sgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMCwgZWxlbWVudDsgZWxlbWVudCA9IGVsZW1lbnRzW2ldOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLmlzSW5wdXRLZXl3b3JkXyhlbGVtZW50Wyd0eXBlJ10pKSB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gdGhpcy5pbnB1dEZyb21Kc29uXyhlbGVtZW50LCB3YXJuaW5nUHJlZml4KTtcbiAgICAgICAgLy8gU2hvdWxkIG5ldmVyIGJlIG51bGwsIGJ1dCBqdXN0IGluIGNhc2UuXG4gICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgIGZvciAobGV0IGogPSAwLCB0dXBsZTsgdHVwbGUgPSBmaWVsZFN0YWNrW2pdOyBqKyspIHtcbiAgICAgICAgICAgIGlucHV0LmFwcGVuZEZpZWxkKHR1cGxlWzBdLCB0dXBsZVsxXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZpZWxkU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWxsIG90aGVyIHR5cGVzLCBpbmNsdWRpbmcgb25lcyBzdGFydGluZyB3aXRoICdpbnB1dF8nIGdldCByb3V0ZWRcbiAgICAgICAgLy8gaGVyZS5cbiAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmZpZWxkRnJvbUpzb25fKGVsZW1lbnQpO1xuICAgICAgICBpZiAoZmllbGQpIHtcbiAgICAgICAgICBmaWVsZFN0YWNrLnB1c2goW2ZpZWxkLCBlbGVtZW50WyduYW1lJ11dKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZXMgdGhhdCB0aGUgdG9rZW5zIGFyZSB3aXRoaW4gdGhlIGNvcnJlY3QgYm91bmRzLCB3aXRoIG5vXG4gICAqIGR1cGxpY2F0ZXMsIGFuZCB0aGF0IGFsbCBvZiB0aGUgYXJndW1lbnRzIGFyZSByZWZlcnJlZCB0by4gVGhyb3dzIGVycm9ycyBpZlxuICAgKiBhbnkgb2YgdGhlc2UgdGhpbmdzIGFyZSBub3QgdHJ1ZS5cbiAgICpcbiAgICogQHBhcmFtIHRva2VucyBBbiBhcnJheSBvZiB0b2tlbnMgdG8gdmFsaWRhdGVcbiAgICogQHBhcmFtIGFyZ3NDb3VudCBUaGUgbnVtYmVyIG9mIGFyZ3MgdGhhdCBuZWVkIHRvIGJlIHJlZmVycmVkIHRvLlxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZVRva2Vuc18odG9rZW5zOiBBcnJheTxzdHJpbmd8bnVtYmVyPiwgYXJnc0NvdW50OiBudW1iZXIpIHtcbiAgICBjb25zdCB2aXNpdGVkQXJnc0hhc2ggPSBbXTtcbiAgICBsZXQgdmlzaXRlZEFyZ3NDb3VudCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2ldO1xuICAgICAgaWYgKHR5cGVvZiB0b2tlbiAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW4gPCAxIHx8IHRva2VuID4gYXJnc0NvdW50KSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgJ0Jsb2NrIFwiJyArIHRoaXMudHlwZSArICdcIjogJyArXG4gICAgICAgICAgICAnTWVzc2FnZSBpbmRleCAlJyArIHRva2VuICsgJyBvdXQgb2YgcmFuZ2UuJyk7XG4gICAgICB9XG4gICAgICBpZiAodmlzaXRlZEFyZ3NIYXNoW3Rva2VuXSkge1xuICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAgICdCbG9jayBcIicgKyB0aGlzLnR5cGUgKyAnXCI6ICcgK1xuICAgICAgICAgICAgJ01lc3NhZ2UgaW5kZXggJScgKyB0b2tlbiArICcgZHVwbGljYXRlZC4nKTtcbiAgICAgIH1cbiAgICAgIHZpc2l0ZWRBcmdzSGFzaFt0b2tlbl0gPSB0cnVlO1xuICAgICAgdmlzaXRlZEFyZ3NDb3VudCsrO1xuICAgIH1cbiAgICBpZiAodmlzaXRlZEFyZ3NDb3VudCAhPT0gYXJnc0NvdW50KSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnQmxvY2sgXCInICsgdGhpcy50eXBlICsgJ1wiOiAnICtcbiAgICAgICAgICAnTWVzc2FnZSBkb2VzIG5vdCByZWZlcmVuY2UgYWxsICcgKyBhcmdzQ291bnQgKyAnIGFyZyhzKS4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5zZXJ0cyBhcmdzIGluIHBsYWNlIG9mIG51bWVyaWNhbCB0b2tlbnMuIFN0cmluZyBhcmdzIGFyZSBjb252ZXJ0ZWQgdG9cbiAgICogSlNPTiB0aGF0IGRlZmluZXMgYSBsYWJlbCBmaWVsZC4gSWYgbmVjZXNzYXJ5IGFuIGV4dHJhIGR1bW15IGlucHV0IGlzIGFkZGVkXG4gICAqIHRvIHRoZSBlbmQgb2YgdGhlIGVsZW1lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gdG9rZW5zIFRoZSB0b2tlbnMgdG8gaW50ZXJwb2xhdGVcbiAgICogQHBhcmFtIGFyZ3MgVGhlIGFyZ3VtZW50cyB0byBpbnNlcnQuXG4gICAqIEBwYXJhbSBsYXN0RHVtbXlBbGlnbiBUaGUgYWxpZ25tZW50IHRoZSBhZGRlZCBkdW1teSBpbnB1dCBzaG91bGQgaGF2ZSwgaWZcbiAgICogICAgIHdlIGFyZSByZXF1aXJlZCB0byBhZGQgb25lLlxuICAgKiBAcmV0dXJucyBUaGUgSlNPTiBkZWZpbml0aW9ucyBvZiBmaWVsZCBhbmQgaW5wdXRzIHRvIGFkZCB0byB0aGUgYmxvY2suXG4gICAqL1xuICBwcml2YXRlIGludGVycG9sYXRlQXJndW1lbnRzXyhcbiAgICAgIHRva2VuczogQXJyYXk8c3RyaW5nfG51bWJlcj4sIGFyZ3M6IEFycmF5PEFueUR1cmluZ01pZ3JhdGlvbnxzdHJpbmc+LFxuICAgICAgbGFzdER1bW15QWxpZ246IHN0cmluZ3x1bmRlZmluZWQpOiBBbnlEdXJpbmdNaWdyYXRpb25bXSB7XG4gICAgY29uc3QgZWxlbWVudHMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGVsZW1lbnQgPSB0b2tlbnNbaV07XG4gICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGVsZW1lbnQgPSBhcmdzW2VsZW1lbnQgLSAxXTtcbiAgICAgIH1cbiAgICAgIC8vIEFyZ3MgY2FuIGJlIHN0cmluZ3MsIHdoaWNoIGlzIHdoeSB0aGlzIGlzbid0IGVsc2VpZi5cbiAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICd7IHRleHQ6IHN0cmluZzsgdHlwZTogc3RyaW5nOyB9IHxcbiAgICAgICAgLy8gbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZSAnc3RyaW5nIHwgbnVtYmVyJy5cbiAgICAgICAgZWxlbWVudCA9IHRoaXMuc3RyaW5nVG9GaWVsZEpzb25fKGVsZW1lbnQpIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsZW1lbnRzLnB1c2goZWxlbWVudCk7XG4gICAgfVxuXG4gICAgY29uc3QgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoO1xuICAgIGlmIChsZW5ndGggJiZcbiAgICAgICAgIXRoaXMuaXNJbnB1dEtleXdvcmRfKFxuICAgICAgICAgICAgKGVsZW1lbnRzIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbbGVuZ3RoIC0gMV1bJ3R5cGUnXSkpIHtcbiAgICAgIGNvbnN0IGR1bW15SW5wdXQgPSB7J3R5cGUnOiAnaW5wdXRfZHVtbXknfTtcbiAgICAgIGlmIChsYXN0RHVtbXlBbGlnbikge1xuICAgICAgICAoZHVtbXlJbnB1dCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydhbGlnbiddID0gbGFzdER1bW15QWxpZ247XG4gICAgICB9XG4gICAgICBlbGVtZW50cy5wdXNoKGR1bW15SW5wdXQpO1xuICAgIH1cblxuICAgIHJldHVybiBlbGVtZW50cztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZmllbGQgZnJvbSB0aGUgSlNPTiBkZWZpbml0aW9uIG9mIGEgZmllbGQuIElmIGEgZmllbGQgd2l0aCB0aGVcbiAgICogZ2l2ZW4gdHlwZSBjYW5ub3QgYmUgZm91bmQsIHRoaXMgYXR0ZW1wdHMgdG8gY3JlYXRlIGEgZGlmZmVyZW50IGZpZWxkIHVzaW5nXG4gICAqIHRoZSAnYWx0JyBwcm9wZXJ0eSBvZiB0aGUgSlNPTiBkZWZpbml0aW9uIChpZiBpdCBleGlzdHMpLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byB0cnkgdG8gdHVybiBpbnRvIGEgZmllbGQuXG4gICAqIEByZXR1cm5zIFRoZSBmaWVsZCBkZWZpbmVkIGJ5IHRoZSBKU09OLCBvciBudWxsIGlmIG9uZSBjb3VsZG4ndCBiZSBjcmVhdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBmaWVsZEZyb21Kc29uXyhlbGVtZW50OiB7YWx0Pzogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIHRleHQ/OiBzdHJpbmd9KTpcbiAgICAgIEZpZWxkfG51bGwge1xuICAgIGNvbnN0IGZpZWxkID0gZmllbGRSZWdpc3RyeS5mcm9tSnNvbihlbGVtZW50KTtcbiAgICBpZiAoIWZpZWxkICYmIGVsZW1lbnRbJ2FsdCddKSB7XG4gICAgICBpZiAodHlwZW9mIGVsZW1lbnRbJ2FsdCddID09PSAnc3RyaW5nJykge1xuICAgICAgICBjb25zdCBqc29uID0gdGhpcy5zdHJpbmdUb0ZpZWxkSnNvbl8oZWxlbWVudFsnYWx0J10pO1xuICAgICAgICByZXR1cm4ganNvbiA/IHRoaXMuZmllbGRGcm9tSnNvbl8oanNvbikgOiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuZmllbGRGcm9tSnNvbl8oZWxlbWVudFsnYWx0J10pO1xuICAgIH1cbiAgICByZXR1cm4gZmllbGQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnB1dCBmcm9tIHRoZSBKU09OIGRlZmluaXRpb24gb2YgYW4gaW5wdXQuIFNldHMgdGhlIGlucHV0J3NcbiAgICogY2hlY2sgYW5kIGFsaWdubWVudCBpZiB0aGV5IGFyZSBwcm92aWRlZC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnQgVGhlIEpTT04gdG8gdHVybiBpbnRvIGFuIGlucHV0LlxuICAgKiBAcGFyYW0gd2FybmluZ1ByZWZpeCBUaGUgcHJlZml4IHRvIGFkZCB0byB3YXJuaW5ncyB0byBoZWxwIHRoZSBkZXZlbG9wZXJcbiAgICogICAgIGRlYnVnLlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgdGhhdCBoYXMgYmVlbiBjcmVhdGVkLCBvciBudWxsIGlmIG9uZSBjb3VsZCBub3QgYmVcbiAgICogICAgIGNyZWF0ZWQgZm9yIHNvbWUgcmVhc29uIChzaG91bGQgbmV2ZXIgaGFwcGVuKS5cbiAgICovXG4gIHByaXZhdGUgaW5wdXRGcm9tSnNvbl8oZWxlbWVudDogQW55RHVyaW5nTWlncmF0aW9uLCB3YXJuaW5nUHJlZml4OiBzdHJpbmcpOlxuICAgICAgSW5wdXR8bnVsbCB7XG4gICAgY29uc3QgYWxpZ25tZW50TG9va3VwID0ge1xuICAgICAgJ0xFRlQnOiBBbGlnbi5MRUZULFxuICAgICAgJ1JJR0hUJzogQWxpZ24uUklHSFQsXG4gICAgICAnQ0VOVFJFJzogQWxpZ24uQ0VOVFJFLFxuICAgICAgJ0NFTlRFUic6IEFsaWduLkNFTlRSRSxcbiAgICB9O1xuXG4gICAgbGV0IGlucHV0ID0gbnVsbDtcbiAgICBzd2l0Y2ggKGVsZW1lbnRbJ3R5cGUnXSkge1xuICAgICAgY2FzZSAnaW5wdXRfdmFsdWUnOlxuICAgICAgICBpbnB1dCA9IHRoaXMuYXBwZW5kVmFsdWVJbnB1dChlbGVtZW50WyduYW1lJ10pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2lucHV0X3N0YXRlbWVudCc6XG4gICAgICAgIGlucHV0ID0gdGhpcy5hcHBlbmRTdGF0ZW1lbnRJbnB1dChlbGVtZW50WyduYW1lJ10pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2lucHV0X2R1bW15JzpcbiAgICAgICAgaW5wdXQgPSB0aGlzLmFwcGVuZER1bW15SW5wdXQoZWxlbWVudFsnbmFtZSddKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIC8vIFNob3VsZCBuZXZlciBiZSBoaXQgYmVjYXVzZSBvZiBpbnRlcnBvbGF0ZV8ncyBjaGVja3MsIGJ1dCBqdXN0IGluIGNhc2UuXG4gICAgaWYgKCFpbnB1dCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKGVsZW1lbnRbJ2NoZWNrJ10pIHtcbiAgICAgIGlucHV0LnNldENoZWNrKGVsZW1lbnRbJ2NoZWNrJ10pO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudFsnYWxpZ24nXSkge1xuICAgICAgY29uc3QgYWxpZ25tZW50ID1cbiAgICAgICAgICAoYWxpZ25tZW50TG9va3VwIGFzXG4gICAgICAgICAgIEFueUR1cmluZ01pZ3JhdGlvbilbZWxlbWVudFsnYWxpZ24nXS50b1VwcGVyQ2FzZSgpXTtcbiAgICAgIGlmIChhbGlnbm1lbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zb2xlLndhcm4od2FybmluZ1ByZWZpeCArICdJbGxlZ2FsIGFsaWduIHZhbHVlOiAnLCBlbGVtZW50WydhbGlnbiddKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlucHV0LnNldEFsaWduKGFsaWdubWVudCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpbnB1dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIHN0cmluZyBtYXRjaGVzIG9uZSBvZiB0aGUgaW5wdXQga2V5d29yZHMuXG4gICAqXG4gICAqIEBwYXJhbSBzdHIgVGhlIHN0cmluZyB0byBjaGVjay5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgZ2l2ZW4gc3RyaW5nIG1hdGNoZXMgb25lIG9mIHRoZSBpbnB1dCBrZXl3b3JkcywgZmFsc2VcbiAgICogICAgIG90aGVyd2lzZS5cbiAgICovXG4gIHByaXZhdGUgaXNJbnB1dEtleXdvcmRfKHN0cjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHN0ciA9PT0gJ2lucHV0X3ZhbHVlJyB8fCBzdHIgPT09ICdpbnB1dF9zdGF0ZW1lbnQnIHx8XG4gICAgICAgIHN0ciA9PT0gJ2lucHV0X2R1bW15JztcbiAgfVxuXG4gIC8qKlxuICAgKiBUdXJucyBhIHN0cmluZyBpbnRvIHRoZSBKU09OIGRlZmluaXRpb24gb2YgYSBsYWJlbCBmaWVsZC4gSWYgdGhlIHN0cmluZ1xuICAgKiBiZWNvbWVzIGFuIGVtcHR5IHN0cmluZyB3aGVuIHRyaW1tZWQsIHRoaXMgcmV0dXJucyBudWxsLlxuICAgKlxuICAgKiBAcGFyYW0gc3RyIFN0cmluZyB0byB0dXJuIGludG8gdGhlIEpTT04gZGVmaW5pdGlvbiBvZiBhIGxhYmVsIGZpZWxkLlxuICAgKiBAcmV0dXJucyBUaGUgSlNPTiBkZWZpbml0aW9uIG9yIG51bGwuXG4gICAqL1xuICBwcml2YXRlIHN0cmluZ1RvRmllbGRKc29uXyhzdHI6IHN0cmluZyk6IHt0ZXh0OiBzdHJpbmcsIHR5cGU6IHN0cmluZ318bnVsbCB7XG4gICAgc3RyID0gc3RyLnRyaW0oKTtcbiAgICBpZiAoc3RyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAndHlwZSc6ICdmaWVsZF9sYWJlbCcsXG4gICAgICAgICd0ZXh0Jzogc3RyLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgdmFsdWUgaW5wdXQsIHN0YXRlbWVudCBpbnB1dCBvciBsb2NhbCB2YXJpYWJsZSB0byB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gdHlwZSBPbmUgb2YgQmxvY2tseS5pbnB1dFR5cGVzLlxuICAgKiBAcGFyYW0gbmFtZSBMYW5ndWFnZS1uZXV0cmFsIGlkZW50aWZpZXIgd2hpY2ggbWF5IHVzZWQgdG8gZmluZCB0aGlzIGlucHV0XG4gICAqICAgICBhZ2Fpbi4gIFNob3VsZCBiZSB1bmlxdWUgdG8gdGhpcyBibG9jay5cbiAgICogQHJldHVybnMgVGhlIGlucHV0IG9iamVjdCBjcmVhdGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGFwcGVuZElucHV0Xyh0eXBlOiBudW1iZXIsIG5hbWU6IHN0cmluZyk6IElucHV0IHtcbiAgICBsZXQgY29ubmVjdGlvbiA9IG51bGw7XG4gICAgaWYgKHR5cGUgPT09IGlucHV0VHlwZXMuVkFMVUUgfHwgdHlwZSA9PT0gaW5wdXRUeXBlcy5TVEFURU1FTlQpIHtcbiAgICAgIGNvbm5lY3Rpb24gPSB0aGlzLm1ha2VDb25uZWN0aW9uXyh0eXBlKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09IGlucHV0VHlwZXMuU1RBVEVNRU5UKSB7XG4gICAgICB0aGlzLnN0YXRlbWVudElucHV0Q291bnQrKztcbiAgICB9XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdDb25uZWN0aW9uIHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnQ29ubmVjdGlvbicuXG4gICAgY29uc3QgaW5wdXQgPVxuICAgICAgICBuZXcgSW5wdXQodHlwZSwgbmFtZSwgdGhpcywgKGNvbm5lY3Rpb24gYXMgQW55RHVyaW5nTWlncmF0aW9uKSk7XG4gICAgLy8gQXBwZW5kIGlucHV0IHRvIGxpc3QuXG4gICAgdGhpcy5pbnB1dExpc3QucHVzaChpbnB1dCk7XG4gICAgcmV0dXJuIGlucHV0O1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgYSBuYW1lZCBpbnB1dCB0byBhIGRpZmZlcmVudCBsb2NhdGlvbiBvbiB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgaW5wdXQgdG8gbW92ZS5cbiAgICogQHBhcmFtIHJlZk5hbWUgTmFtZSBvZiBpbnB1dCB0aGF0IHNob3VsZCBiZSBhZnRlciB0aGUgbW92ZWQgaW5wdXQsIG9yIG51bGxcbiAgICogICAgIHRvIGJlIHRoZSBpbnB1dCBhdCB0aGUgZW5kLlxuICAgKi9cbiAgbW92ZUlucHV0QmVmb3JlKG5hbWU6IHN0cmluZywgcmVmTmFtZTogc3RyaW5nfG51bGwpIHtcbiAgICBpZiAobmFtZSA9PT0gcmVmTmFtZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBGaW5kIGJvdGggaW5wdXRzLlxuICAgIGxldCBpbnB1dEluZGV4ID0gLTE7XG4gICAgbGV0IHJlZkluZGV4ID0gcmVmTmFtZSA/IC0xIDogdGhpcy5pbnB1dExpc3QubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICBpZiAoaW5wdXQubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICBpbnB1dEluZGV4ID0gaTtcbiAgICAgICAgaWYgKHJlZkluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHJlZk5hbWUgJiYgaW5wdXQubmFtZSA9PT0gcmVmTmFtZSkge1xuICAgICAgICByZWZJbmRleCA9IGk7XG4gICAgICAgIGlmIChpbnB1dEluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpbnB1dEluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgRXJyb3IoJ05hbWVkIGlucHV0IFwiJyArIG5hbWUgKyAnXCIgbm90IGZvdW5kLicpO1xuICAgIH1cbiAgICBpZiAocmVmSW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBFcnJvcignUmVmZXJlbmNlIGlucHV0IFwiJyArIHJlZk5hbWUgKyAnXCIgbm90IGZvdW5kLicpO1xuICAgIH1cbiAgICB0aGlzLm1vdmVOdW1iZXJlZElucHV0QmVmb3JlKGlucHV0SW5kZXgsIHJlZkluZGV4KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgbnVtYmVyZWQgaW5wdXQgdG8gYSBkaWZmZXJlbnQgbG9jYXRpb24gb24gdGhpcyBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGlucHV0SW5kZXggSW5kZXggb2YgdGhlIGlucHV0IHRvIG1vdmUuXG4gICAqIEBwYXJhbSByZWZJbmRleCBJbmRleCBvZiBpbnB1dCB0aGF0IHNob3VsZCBiZSBhZnRlciB0aGUgbW92ZWQgaW5wdXQuXG4gICAqL1xuICBtb3ZlTnVtYmVyZWRJbnB1dEJlZm9yZShpbnB1dEluZGV4OiBudW1iZXIsIHJlZkluZGV4OiBudW1iZXIpIHtcbiAgICAvLyBWYWxpZGF0ZSBhcmd1bWVudHMuXG4gICAgaWYgKGlucHV0SW5kZXggPT09IHJlZkluZGV4KSB7XG4gICAgICB0aHJvdyBFcnJvcignQ2FuXFwndCBtb3ZlIGlucHV0IHRvIGl0c2VsZi4nKTtcbiAgICB9XG4gICAgaWYgKGlucHV0SW5kZXggPj0gdGhpcy5pbnB1dExpc3QubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKCdJbnB1dCBpbmRleCAnICsgaW5wdXRJbmRleCArICcgb3V0IG9mIGJvdW5kcy4nKTtcbiAgICB9XG4gICAgaWYgKHJlZkluZGV4ID4gdGhpcy5pbnB1dExpc3QubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKCdSZWZlcmVuY2UgaW5wdXQgJyArIHJlZkluZGV4ICsgJyBvdXQgb2YgYm91bmRzLicpO1xuICAgIH1cbiAgICAvLyBSZW1vdmUgaW5wdXQuXG4gICAgY29uc3QgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpbnB1dEluZGV4XTtcbiAgICB0aGlzLmlucHV0TGlzdC5zcGxpY2UoaW5wdXRJbmRleCwgMSk7XG4gICAgaWYgKGlucHV0SW5kZXggPCByZWZJbmRleCkge1xuICAgICAgcmVmSW5kZXgtLTtcbiAgICB9XG4gICAgLy8gUmVpbnNlcnQgaW5wdXQuXG4gICAgdGhpcy5pbnB1dExpc3Quc3BsaWNlKHJlZkluZGV4LCAwLCBpbnB1dCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFuIGlucHV0IGZyb20gdGhpcyBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGlucHV0LlxuICAgKiBAcGFyYW0gb3B0X3F1aWV0IFRydWUgdG8gcHJldmVudCBhbiBlcnJvciBpZiBpbnB1dCBpcyBub3QgcHJlc2VudC5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiBvcGVyYXRpb24gc3VjY2VlZHMsIGZhbHNlIGlmIGlucHV0IGlzIG5vdCBwcmVzZW50IGFuZFxuICAgKiAgICAgb3B0X3F1aWV0IGlzIHRydWUuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgaW5wdXQgaXMgbm90IHByZXNlbnQgYW5kIG9wdF9xdWlldCBpcyBub3QgdHJ1ZS5cbiAgICovXG4gIHJlbW92ZUlucHV0KG5hbWU6IHN0cmluZywgb3B0X3F1aWV0PzogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICBpZiAoaW5wdXQubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5TVEFURU1FTlQpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlbWVudElucHV0Q291bnQtLTtcbiAgICAgICAgfVxuICAgICAgICBpbnB1dC5kaXNwb3NlKCk7XG4gICAgICAgIHRoaXMuaW5wdXRMaXN0LnNwbGljZShpLCAxKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChvcHRfcXVpZXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhyb3cgRXJyb3IoJ0lucHV0IG5vdCBmb3VuZDogJyArIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoZXMgdGhlIG5hbWVkIGlucHV0IG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGlucHV0LlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgb2JqZWN0LCBvciBudWxsIGlmIGlucHV0IGRvZXMgbm90IGV4aXN0LlxuICAgKi9cbiAgZ2V0SW5wdXQobmFtZTogc3RyaW5nKTogSW5wdXR8bnVsbCB7XG4gICAgZm9yIChsZXQgaSA9IDAsIGlucHV0OyBpbnB1dCA9IHRoaXMuaW5wdXRMaXN0W2ldOyBpKyspIHtcbiAgICAgIGlmIChpbnB1dC5uYW1lID09PSBuYW1lKSB7XG4gICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gVGhpcyBpbnB1dCBkb2VzIG5vdCBleGlzdC5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaGVzIHRoZSBibG9jayBhdHRhY2hlZCB0byB0aGUgbmFtZWQgaW5wdXQuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBpbnB1dC5cbiAgICogQHJldHVybnMgVGhlIGF0dGFjaGVkIHZhbHVlIGJsb2NrLCBvciBudWxsIGlmIHRoZSBpbnB1dCBpcyBlaXRoZXJcbiAgICogICAgIGRpc2Nvbm5lY3RlZCBvciBpZiB0aGUgaW5wdXQgZG9lcyBub3QgZXhpc3QuXG4gICAqL1xuICBnZXRJbnB1dFRhcmdldEJsb2NrKG5hbWU6IHN0cmluZyk6IEJsb2NrfG51bGwge1xuICAgIGNvbnN0IGlucHV0ID0gdGhpcy5nZXRJbnB1dChuYW1lKTtcbiAgICByZXR1cm4gaW5wdXQgJiYgaW5wdXQuY29ubmVjdGlvbiAmJiBpbnB1dC5jb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY29tbWVudCBvbiB0aGlzIGJsb2NrIChvciBudWxsIGlmIHRoZXJlIGlzIG5vIGNvbW1lbnQpLlxuICAgKlxuICAgKiBAcmV0dXJucyBCbG9jaydzIGNvbW1lbnQuXG4gICAqL1xuICBnZXRDb21tZW50VGV4dCgpOiBzdHJpbmd8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY29tbWVudE1vZGVsLnRleHQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoaXMgYmxvY2sncyBjb21tZW50IHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0LCBvciBudWxsIHRvIGRlbGV0ZS5cbiAgICovXG4gIHNldENvbW1lbnRUZXh0KHRleHQ6IHN0cmluZ3xudWxsKSB7XG4gICAgaWYgKHRoaXMuY29tbWVudE1vZGVsLnRleHQgPT09IHRleHQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19DSEFOR0UpKShcbiAgICAgICAgdGhpcywgJ2NvbW1lbnQnLCBudWxsLCB0aGlzLmNvbW1lbnRNb2RlbC50ZXh0LCB0ZXh0KSk7XG4gICAgdGhpcy5jb21tZW50TW9kZWwudGV4dCA9IHRleHQ7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdzdHJpbmcgfCBudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0b1xuICAgIC8vIHR5cGUgJ3N0cmluZyB8IENvbW1lbnQnLlxuICAgIHRoaXMuY29tbWVudCA9IHRleHQgYXMgQW55RHVyaW5nTWlncmF0aW9uOyAgLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LlxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGlzIGJsb2NrJ3Mgd2FybmluZyB0ZXh0LlxuICAgKlxuICAgKiBAcGFyYW0gX3RleHQgVGhlIHRleHQsIG9yIG51bGwgdG8gZGVsZXRlLlxuICAgKiBAcGFyYW0gX29wdF9pZCBBbiBvcHRpb25hbCBJRCBmb3IgdGhlIHdhcm5pbmcgdGV4dCB0byBiZSBhYmxlIHRvIG1haW50YWluXG4gICAqICAgICBtdWx0aXBsZSB3YXJuaW5ncy5cbiAgICovXG4gIHNldFdhcm5pbmdUZXh0KF90ZXh0OiBzdHJpbmd8bnVsbCwgX29wdF9pZD86IHN0cmluZykge31cbiAgLy8gTk9QLlxuXG4gIC8qKlxuICAgKiBHaXZlIHRoaXMgYmxvY2sgYSBtdXRhdG9yIGRpYWxvZy5cbiAgICpcbiAgICogQHBhcmFtIF9tdXRhdG9yIEEgbXV0YXRvciBkaWFsb2cgaW5zdGFuY2Ugb3IgbnVsbCB0byByZW1vdmUuXG4gICAqL1xuICBzZXRNdXRhdG9yKF9tdXRhdG9yOiBNdXRhdG9yKSB7fVxuICAvLyBOT1AuXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGlzIGJsb2NrIHJlbGF0aXZlIHRvIHRoZVxuICAgKiBkcmF3aW5nIHN1cmZhY2UncyBvcmlnaW4gKDAsMCksIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IHdpdGggLnggYW5kIC55IHByb3BlcnRpZXMuXG4gICAqL1xuICBnZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk6IENvb3JkaW5hdGUge1xuICAgIHJldHVybiB0aGlzLnh5XztcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgYmxvY2sgYnkgYSByZWxhdGl2ZSBvZmZzZXQuXG4gICAqXG4gICAqIEBwYXJhbSBkeCBIb3Jpem9udGFsIG9mZnNldCwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0gZHkgVmVydGljYWwgb2Zmc2V0LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBtb3ZlQnkoZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnBhcmVudEJsb2NrXykge1xuICAgICAgdGhyb3cgRXJyb3IoJ0Jsb2NrIGhhcyBwYXJlbnQuJyk7XG4gICAgfVxuICAgIGNvbnN0IGV2ZW50ID1cbiAgICAgICAgbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX01PVkUpKSh0aGlzKSBhcyBCbG9ja01vdmU7XG4gICAgdGhpcy54eV8udHJhbnNsYXRlKGR4LCBkeSk7XG4gICAgZXZlbnQucmVjb3JkTmV3KCk7XG4gICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBjb25uZWN0aW9uIG9mIHRoZSBzcGVjaWZpZWQgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgdGhlIGNvbm5lY3Rpb24gdG8gY3JlYXRlLlxuICAgKiBAcmV0dXJucyBBIG5ldyBjb25uZWN0aW9uIG9mIHRoZSBzcGVjaWZpZWQgdHlwZS5cbiAgICovXG4gIHByb3RlY3RlZCBtYWtlQ29ubmVjdGlvbl8odHlwZTogbnVtYmVyKTogQ29ubmVjdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBDb25uZWN0aW9uKHRoaXMsIHR5cGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY3Vyc2l2ZWx5IGNoZWNrcyB3aGV0aGVyIGFsbCBzdGF0ZW1lbnQgYW5kIHZhbHVlIGlucHV0cyBhcmUgZmlsbGVkIHdpdGhcbiAgICogYmxvY2tzLiBBbHNvIGNoZWNrcyBhbGwgZm9sbG93aW5nIHN0YXRlbWVudCBibG9ja3MgaW4gdGhpcyBzdGFjay5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9zaGFkb3dCbG9ja3NBcmVGaWxsZWQgQW4gb3B0aW9uYWwgYXJndW1lbnQgY29udHJvbGxpbmcgd2hldGhlclxuICAgKiAgICAgc2hhZG93IGJsb2NrcyBhcmUgY291bnRlZCBhcyBmaWxsZWQuIERlZmF1bHRzIHRvIHRydWUuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgYWxsIGlucHV0cyBhcmUgZmlsbGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBhbGxJbnB1dHNGaWxsZWQob3B0X3NoYWRvd0Jsb2Nrc0FyZUZpbGxlZD86IGJvb2xlYW4pOiBib29sZWFuIHtcbiAgICAvLyBBY2NvdW50IGZvciB0aGUgc2hhZG93IGJsb2NrIGZpbGxlZG5lc3MgdG9nZ2xlLlxuICAgIGlmIChvcHRfc2hhZG93QmxvY2tzQXJlRmlsbGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9wdF9zaGFkb3dCbG9ja3NBcmVGaWxsZWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoIW9wdF9zaGFkb3dCbG9ja3NBcmVGaWxsZWQgJiYgdGhpcy5pc1NoYWRvdygpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUmVjdXJzaXZlbHkgY2hlY2sgZWFjaCBpbnB1dCBibG9jayBvZiB0aGUgY3VycmVudCBibG9jay5cbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgaWYgKCFpbnB1dC5jb25uZWN0aW9uKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3QgdGFyZ2V0ID0gaW5wdXQuY29ubmVjdGlvbi50YXJnZXRCbG9jaygpO1xuICAgICAgaWYgKCF0YXJnZXQgfHwgIXRhcmdldC5hbGxJbnB1dHNGaWxsZWQob3B0X3NoYWRvd0Jsb2Nrc0FyZUZpbGxlZCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlY3Vyc2l2ZWx5IGNoZWNrIHRoZSBuZXh0IGJsb2NrIGFmdGVyIHRoZSBjdXJyZW50IGJsb2NrLlxuICAgIGNvbnN0IG5leHQgPSB0aGlzLmdldE5leHRCbG9jaygpO1xuICAgIGlmIChuZXh0KSB7XG4gICAgICByZXR1cm4gbmV4dC5hbGxJbnB1dHNGaWxsZWQob3B0X3NoYWRvd0Jsb2Nrc0FyZUZpbGxlZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyBkZXNjcmliaW5nIHRoaXMgQmxvY2sgaW4gZGV2ZWxvcGVyIHRlcm1zICh0eXBlXG4gICAqIG5hbWUgYW5kIElEOyBFbmdsaXNoIG9ubHkpLlxuICAgKlxuICAgKiBJbnRlbmRlZCB0byBvbiBiZSB1c2VkIGluIGNvbnNvbGUgbG9ncyBhbmQgZXJyb3JzLiBJZiB5b3UgbmVlZCBhIHN0cmluZ1xuICAgKiB0aGF0IHVzZXMgdGhlIHVzZXIncyBuYXRpdmUgbGFuZ3VhZ2UgKGluY2x1ZGluZyBibG9jayB0ZXh0LCBmaWVsZCB2YWx1ZXMsXG4gICAqIGFuZCBjaGlsZCBibG9ja3MpLCB1c2UgW3RvU3RyaW5nKClde0BsaW5rIEJsb2NrI3RvU3RyaW5nfS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGRlc2NyaXB0aW9uLlxuICAgKi9cbiAgdG9EZXZTdHJpbmcoKTogc3RyaW5nIHtcbiAgICBsZXQgbXNnID0gdGhpcy50eXBlID8gJ1wiJyArIHRoaXMudHlwZSArICdcIiBibG9jaycgOiAnQmxvY2snO1xuICAgIGlmICh0aGlzLmlkKSB7XG4gICAgICBtc2cgKz0gJyAoaWQ9XCInICsgdGhpcy5pZCArICdcIiknO1xuICAgIH1cbiAgICByZXR1cm4gbXNnO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgQmxvY2sge1xuICBleHBvcnQgaW50ZXJmYWNlIENvbW1lbnRNb2RlbCB7XG4gICAgdGV4dDogc3RyaW5nfG51bGw7XG4gICAgcGlubmVkOiBib29sZWFuO1xuICAgIHNpemU6IFNpemU7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgQ29tbWVudE1vZGVsID0gQmxvY2suQ29tbWVudE1vZGVsO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSBjb2RlIGNvbW1lbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuQ29tbWVudCcpO1xuXG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19jaGFuZ2UuanMnO1xuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfYnViYmxlX29wZW4uanMnO1xuXG5pbXBvcnQgdHlwZSB7Q29tbWVudE1vZGVsfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCB7QnViYmxlfSBmcm9tICcuL2J1YmJsZS5qcyc7XG5pbXBvcnQgKiBhcyBDc3MgZnJvbSAnLi9jc3MuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge0ljb259IGZyb20gJy4vaWNvbi5qcyc7XG5pbXBvcnQgdHlwZSB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgdHlwZSB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBjb21tZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbW1lbnRcbiAqL1xuZXhwb3J0IGNsYXNzIENvbW1lbnQgZXh0ZW5kcyBJY29uIHtcbiAgcHJpdmF0ZSByZWFkb25seSBtb2RlbDogQ29tbWVudE1vZGVsO1xuXG4gIC8qKlxuICAgKiBUaGUgbW9kZWwncyB0ZXh0IHZhbHVlIGF0IHRoZSBzdGFydCBvZiBhbiBlZGl0LlxuICAgKiBVc2VkIHRvIHRlbGwgaWYgYW4gZXZlbnQgc2hvdWxkIGJlIGZpcmVkIGF0IHRoZSBlbmQgb2YgYW4gZWRpdC5cbiAgICovXG4gIHByaXZhdGUgY2FjaGVkVGV4dDogc3RyaW5nfG51bGwgPSAnJztcblxuICAvKiogTW91c2UgdXAgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbk1vdXNlVXBXcmFwcGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFdoZWVsIGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgb25XaGVlbFdyYXBwZXI6IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogQ2hhbmdlIGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgb25DaGFuZ2VXcmFwcGVyOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIElucHV0IGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgb25JbnB1dFdyYXBwZXI6IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIFNWRyBlbGVtZW50IHRoYXQgY29udGFpbnMgdGhlIHRleHQgZWRpdCBhcmVhLCBvciBudWxsIGlmIG5vdCBjcmVhdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBmb3JlaWduT2JqZWN0OiBTVkdGb3JlaWduT2JqZWN0RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIGVkaXRhYmxlIHRleHQgYXJlYSwgb3IgbnVsbCBpZiBub3QgY3JlYXRlZC4gKi9cbiAgcHJpdmF0ZSB0ZXh0YXJlYV86IEhUTUxUZXh0QXJlYUVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSB0b3AtbGV2ZWwgbm9kZSBvZiB0aGUgY29tbWVudCB0ZXh0LCBvciBudWxsIGlmIG5vdCBjcmVhdGVkLiAqL1xuICBwcml2YXRlIHBhcmFncmFwaEVsZW1lbnRfOiBTVkdUZXh0RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBhc3NvY2lhdGVkIHdpdGggdGhpcyBjb21tZW50LiAqL1xuICBjb25zdHJ1Y3RvcihibG9jazogQmxvY2tTdmcpIHtcbiAgICBzdXBlcihibG9jayk7XG5cbiAgICAvKiogVGhlIG1vZGVsIGZvciB0aGlzIGNvbW1lbnQuICovXG4gICAgdGhpcy5tb2RlbCA9IGJsb2NrLmNvbW1lbnRNb2RlbDtcbiAgICAvLyBJZiBzb21lb25lIGNyZWF0ZXMgdGhlIGNvbW1lbnQgZGlyZWN0bHkgaW5zdGVhZCBvZiBjYWxsaW5nXG4gICAgLy8gYmxvY2suc2V0Q29tbWVudFRleHQgd2Ugd2FudCB0byBtYWtlIHN1cmUgdGhlIHRleHQgaXMgbm9uLW51bGw7XG4gICAgdGhpcy5tb2RlbC50ZXh0ID0gdGhpcy5tb2RlbC50ZXh0ID8/ICcnO1xuXG4gICAgdGhpcy5jcmVhdGVJY29uKCk7XG4gIH1cblxuICAvKipcbiAgICogRHJhdyB0aGUgY29tbWVudCBpY29uLlxuICAgKlxuICAgKiBAcGFyYW0gZ3JvdXAgVGhlIGljb24gZ3JvdXAuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZHJhd0ljb25fKGdyb3VwOiBFbGVtZW50KSB7XG4gICAgLy8gQ2lyY2xlLlxuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuQ0lSQ0xFLFxuICAgICAgICB7J2NsYXNzJzogJ2Jsb2NrbHlJY29uU2hhcGUnLCAncic6ICc4JywgJ2N4JzogJzgnLCAnY3knOiAnOCd9LCBncm91cCk7XG4gICAgLy8gQ2FuJ3QgdXNlIGEgcmVhbCAnPycgdGV4dCBjaGFyYWN0ZXIgc2luY2UgZGlmZmVyZW50IGJyb3dzZXJzIGFuZFxuICAgIC8vIG9wZXJhdGluZyBzeXN0ZW1zIHJlbmRlciBpdCBkaWZmZXJlbnRseS4gQm9keSBvZiBxdWVzdGlvbiBtYXJrLlxuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUEFUSCwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5SWNvblN5bWJvbCcsXG4gICAgICAgICAgJ2QnOiAnbTYuOCwxMGgyYzAuMDAzLC0wLjYxNyAwLjI3MSwtMC45NjIgMC42MzMsLTEuMjY2IDIuODc1LC0yLjQwNScgK1xuICAgICAgICAgICAgICAnMC42MDcsLTUuNTM0IC0zLjc2NSwtMy44NzR2MS43YzMuMTIsLTEuNjU3IDMuNjk4LDAuMTE4IDIuMzM2LDEuMjUnICtcbiAgICAgICAgICAgICAgJy0xLjIwMSwwLjk5OCAtMS4yMDEsMS41MjggLTEuMjA0LDIuMTl6JyxcbiAgICAgICAgfSxcbiAgICAgICAgZ3JvdXApO1xuICAgIC8vIERvdCBvZiBxdWVzdGlvbiBtYXJrLlxuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5SWNvblN5bWJvbCcsXG4gICAgICAgICAgJ3gnOiAnNi44JyxcbiAgICAgICAgICAneSc6ICcxMC43OCcsXG4gICAgICAgICAgJ2hlaWdodCc6ICcyJyxcbiAgICAgICAgICAnd2lkdGgnOiAnMicsXG4gICAgICAgIH0sXG4gICAgICAgIGdyb3VwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIGVkaXRvciBmb3IgdGhlIGNvbW1lbnQncyBidWJibGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0b3AtbGV2ZWwgbm9kZSBvZiB0aGUgZWRpdG9yLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVFZGl0b3IoKTogU1ZHRWxlbWVudCB7XG4gICAgLyogQ3JlYXRlIHRoZSBlZGl0b3IuICBIZXJlJ3MgdGhlIG1hcmt1cCB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkIGluXG4gICAgICAgICAqIGVkaXRhYmxlIG1vZGU6XG4gICAgICAgICAgPGZvcmVpZ25PYmplY3QgeD1cIjhcIiB5PVwiOFwiIHdpZHRoPVwiMTY0XCIgaGVpZ2h0PVwiMTY0XCI+XG4gICAgICAgICAgICA8Ym9keSB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIlxuICAgICAgIGNsYXNzPVwiYmxvY2tseU1pbmltYWxCb2R5XCI+IDx0ZXh0YXJlYVxuICAgICAgIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiIGNsYXNzPVwiYmxvY2tseUNvbW1lbnRUZXh0YXJlYVwiXG4gICAgICAgICAgICAgICAgICBzdHlsZT1cImhlaWdodDogMTY0cHg7IHdpZHRoOiAxNjRweDtcIj48L3RleHRhcmVhPlxuICAgICAgICAgICAgPC9ib2R5PlxuICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD5cbiAgICAgICAgICogRm9yIG5vbi1lZGl0YWJsZSBtb2RlIHNlZSBXYXJuaW5nLnRleHRUb0RvbV8uXG4gICAgICAgICAqL1xuXG4gICAgdGhpcy5mb3JlaWduT2JqZWN0ID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GT1JFSUdOT0JKRUNULFxuICAgICAgICB7J3gnOiBCdWJibGUuQk9SREVSX1dJRFRILCAneSc6IEJ1YmJsZS5CT1JERVJfV0lEVEh9KTtcblxuICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoZG9tLkhUTUxfTlMsICdib2R5Jyk7XG4gICAgYm9keS5zZXRBdHRyaWJ1dGUoJ3htbG5zJywgZG9tLkhUTUxfTlMpO1xuICAgIGJvZHkuY2xhc3NOYW1lID0gJ2Jsb2NrbHlNaW5pbWFsQm9keSc7XG5cbiAgICB0aGlzLnRleHRhcmVhXyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhkb20uSFRNTF9OUywgJ3RleHRhcmVhJykgYXNcbiAgICAgICAgSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgICBjb25zdCB0ZXh0YXJlYSA9IHRoaXMudGV4dGFyZWFfO1xuICAgIHRleHRhcmVhLmNsYXNzTmFtZSA9ICdibG9ja2x5Q29tbWVudFRleHRhcmVhJztcbiAgICB0ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoJ2RpcicsIHRoaXMuZ2V0QmxvY2soKS5SVEwgPyAnUlRMJyA6ICdMVFInKTtcbiAgICB0ZXh0YXJlYS52YWx1ZSA9IHRoaXMubW9kZWwudGV4dCA/PyAnJztcbiAgICB0aGlzLnJlc2l6ZVRleHRhcmVhKCk7XG5cbiAgICBib2R5LmFwcGVuZENoaWxkKHRleHRhcmVhKTtcbiAgICB0aGlzLmZvcmVpZ25PYmplY3QhLmFwcGVuZENoaWxkKGJvZHkpO1xuXG4gICAgdGhpcy5vbk1vdXNlVXBXcmFwcGVyID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIHRleHRhcmVhLCAnZm9jdXMnLCB0aGlzLCB0aGlzLnN0YXJ0RWRpdCwgdHJ1ZSk7XG4gICAgLy8gRG9uJ3Qgem9vbSB3aXRoIG1vdXNld2hlZWwuXG4gICAgdGhpcy5vbldoZWVsV3JhcHBlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICB0ZXh0YXJlYSwgJ3doZWVsJywgdGhpcywgZnVuY3Rpb24oZTogRXZlbnQpIHtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9KTtcbiAgICB0aGlzLm9uQ2hhbmdlV3JhcHBlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICB0ZXh0YXJlYSwgJ2NoYW5nZScsIHRoaXMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcGFyYW0gX2UgVW51c2VkIGV2ZW50IHBhcmFtZXRlci5cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uKHRoaXM6IENvbW1lbnQsIF9lOiBFdmVudCkge1xuICAgICAgICAgIGlmICh0aGlzLmNhY2hlZFRleHQgIT09IHRoaXMubW9kZWwudGV4dCkge1xuICAgICAgICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19DSEFOR0UpKShcbiAgICAgICAgICAgICAgICB0aGlzLmdldEJsb2NrKCksICdjb21tZW50JywgbnVsbCwgdGhpcy5jYWNoZWRUZXh0LFxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudGV4dCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgdGhpcy5vbklucHV0V3JhcHBlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICB0ZXh0YXJlYSwgJ2lucHV0JywgdGhpcyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwYXJhbSBfZSBVbnVzZWQgZXZlbnQgcGFyYW1ldGVyLlxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24odGhpczogQ29tbWVudCwgX2U6IEV2ZW50KSB7XG4gICAgICAgICAgdGhpcy5tb2RlbC50ZXh0ID0gdGV4dGFyZWEudmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgc2V0VGltZW91dCh0ZXh0YXJlYS5mb2N1cy5iaW5kKHRleHRhcmVhKSwgMCk7XG5cbiAgICByZXR1cm4gdGhpcy5mb3JlaWduT2JqZWN0O1xuICB9XG5cbiAgLyoqIEFkZCBvciByZW1vdmUgZWRpdGFiaWxpdHkgb2YgdGhlIGNvbW1lbnQuICovXG4gIG92ZXJyaWRlIHVwZGF0ZUVkaXRhYmxlKCkge1xuICAgIHN1cGVyLnVwZGF0ZUVkaXRhYmxlKCk7XG4gICAgaWYgKHRoaXMuaXNWaXNpYmxlKCkpIHtcbiAgICAgIC8vIFJlY3JlYXRlIHRoZSBidWJibGUgd2l0aCB0aGUgY29ycmVjdCBVSS5cbiAgICAgIHRoaXMuZGlzcG9zZUJ1YmJsZSgpO1xuICAgICAgdGhpcy5jcmVhdGVCdWJibGUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdHJpZ2dlcmVkIHdoZW4gdGhlIGJ1YmJsZSBoYXMgcmVzaXplZC5cbiAgICogUmVzaXplIHRoZSB0ZXh0IGFyZWEgYWNjb3JkaW5nbHkuXG4gICAqL1xuICBwcml2YXRlIG9uQnViYmxlUmVzaXplKCkge1xuICAgIGlmICghdGhpcy5pc1Zpc2libGUoKSB8fCAhdGhpcy5idWJibGVfKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5tb2RlbC5zaXplID0gdGhpcy5idWJibGVfLmdldEJ1YmJsZVNpemUoKTtcbiAgICB0aGlzLnJlc2l6ZVRleHRhcmVhKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzaXplcyB0aGUgdGV4dCBhcmVhIHRvIG1hdGNoIHRoZSBzaXplIGRlZmluZWQgb24gdGhlIG1vZGVsICh3aGljaCBpc1xuICAgKiB0aGUgc2l6ZSBvZiB0aGUgYnViYmxlKS5cbiAgICovXG4gIHByaXZhdGUgcmVzaXplVGV4dGFyZWEoKSB7XG4gICAgaWYgKCF0aGlzLnRleHRhcmVhXyB8fCAhdGhpcy5mb3JlaWduT2JqZWN0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNpemUgPSB0aGlzLm1vZGVsLnNpemU7XG4gICAgY29uc3QgZG91YmxlQm9yZGVyV2lkdGggPSAyICogQnViYmxlLkJPUkRFUl9XSURUSDtcbiAgICBjb25zdCB3aWR0aE1pbnVzQm9yZGVyID0gc2l6ZS53aWR0aCAtIGRvdWJsZUJvcmRlcldpZHRoO1xuICAgIGNvbnN0IGhlaWdodE1pbnVzQm9yZGVyID0gc2l6ZS5oZWlnaHQgLSBkb3VibGVCb3JkZXJXaWR0aDtcbiAgICB0aGlzLmZvcmVpZ25PYmplY3Quc2V0QXR0cmlidXRlKCd3aWR0aCcsIGAke3dpZHRoTWludXNCb3JkZXJ9YCk7XG4gICAgdGhpcy5mb3JlaWduT2JqZWN0LnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgYCR7aGVpZ2h0TWludXNCb3JkZXJ9YCk7XG4gICAgdGhpcy50ZXh0YXJlYV8uc3R5bGUud2lkdGggPSB3aWR0aE1pbnVzQm9yZGVyIC0gNCArICdweCc7XG4gICAgdGhpcy50ZXh0YXJlYV8uc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0TWludXNCb3JkZXIgLSA0ICsgJ3B4JztcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IG9yIGhpZGUgdGhlIGNvbW1lbnQgYnViYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gdmlzaWJsZSBUcnVlIGlmIHRoZSBidWJibGUgc2hvdWxkIGJlIHZpc2libGUuXG4gICAqL1xuICBvdmVycmlkZSBzZXRWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBpZiAodmlzaWJsZSA9PT0gdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJVQkJMRV9PUEVOKSkoXG4gICAgICAgIHRoaXMuZ2V0QmxvY2soKSwgdmlzaWJsZSwgJ2NvbW1lbnQnKSk7XG4gICAgdGhpcy5tb2RlbC5waW5uZWQgPSB2aXNpYmxlO1xuICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICB0aGlzLmNyZWF0ZUJ1YmJsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc3Bvc2VCdWJibGUoKTtcbiAgICB9XG4gIH1cblxuICAvKiogU2hvdyB0aGUgYnViYmxlLiBIYW5kbGVzIGRlY2lkaW5nIGlmIGl0IHNob3VsZCBiZSBlZGl0YWJsZSBvciBub3QuICovXG4gIHByaXZhdGUgY3JlYXRlQnViYmxlKCkge1xuICAgIGlmICghdGhpcy5nZXRCbG9jaygpLmlzRWRpdGFibGUoKSkge1xuICAgICAgdGhpcy5jcmVhdGVOb25FZGl0YWJsZUJ1YmJsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNyZWF0ZUVkaXRhYmxlQnViYmxlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIFNob3cgYW4gZWRpdGFibGUgYnViYmxlLiAqL1xuICBwcml2YXRlIGNyZWF0ZUVkaXRhYmxlQnViYmxlKCkge1xuICAgIGNvbnN0IGJsb2NrID0gdGhpcy5nZXRCbG9jaygpO1xuICAgIHRoaXMuYnViYmxlXyA9IG5ldyBCdWJibGUoXG4gICAgICAgIGJsb2NrLndvcmtzcGFjZSwgdGhpcy5jcmVhdGVFZGl0b3IoKSwgYmxvY2sucGF0aE9iamVjdC5zdmdQYXRoLFxuICAgICAgICAodGhpcy5pY29uWFlfIGFzIENvb3JkaW5hdGUpLCB0aGlzLm1vZGVsLnNpemUud2lkdGgsXG4gICAgICAgIHRoaXMubW9kZWwuc2l6ZS5oZWlnaHQpO1xuICAgIC8vIEV4cG9zZSB0aGlzIGNvbW1lbnQncyBibG9jaydzIElEIG9uIGl0cyB0b3AtbGV2ZWwgU1ZHIGdyb3VwLlxuICAgIHRoaXMuYnViYmxlXy5zZXRTdmdJZChibG9jay5pZCk7XG4gICAgdGhpcy5idWJibGVfLnJlZ2lzdGVyUmVzaXplRXZlbnQodGhpcy5vbkJ1YmJsZVJlc2l6ZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmFwcGx5Q29sb3VyKCk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyBhIG5vbi1lZGl0YWJsZSBidWJibGUuXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZU5vbkVkaXRhYmxlQnViYmxlKCkge1xuICAgIC8vIFRPRE8gKCMyOTE3KTogSXQgd291bGQgYmUgZ3JlYXQgaWYgdGhlIGNvbW1lbnQgY291bGQgc3VwcG9ydCBsaW5lIGJyZWFrcy5cbiAgICB0aGlzLnBhcmFncmFwaEVsZW1lbnRfID0gQnViYmxlLnRleHRUb0RvbSh0aGlzLm1vZGVsLnRleHQgPz8gJycpO1xuICAgIHRoaXMuYnViYmxlXyA9IEJ1YmJsZS5jcmVhdGVOb25FZGl0YWJsZUJ1YmJsZShcbiAgICAgICAgdGhpcy5wYXJhZ3JhcGhFbGVtZW50XywgdGhpcy5nZXRCbG9jaygpLCB0aGlzLmljb25YWV8gYXMgQ29vcmRpbmF0ZSk7XG4gICAgdGhpcy5hcHBseUNvbG91cigpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2YgdGhlIGJ1YmJsZS5cbiAgICovXG4gIHByaXZhdGUgZGlzcG9zZUJ1YmJsZSgpIHtcbiAgICBpZiAodGhpcy5vbk1vdXNlVXBXcmFwcGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uTW91c2VVcFdyYXBwZXIpO1xuICAgICAgdGhpcy5vbk1vdXNlVXBXcmFwcGVyID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMub25XaGVlbFdyYXBwZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25XaGVlbFdyYXBwZXIpO1xuICAgICAgdGhpcy5vbldoZWVsV3JhcHBlciA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uQ2hhbmdlV3JhcHBlcikge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbkNoYW5nZVdyYXBwZXIpO1xuICAgICAgdGhpcy5vbkNoYW5nZVdyYXBwZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5vbklucHV0V3JhcHBlcikge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbklucHV0V3JhcHBlcik7XG4gICAgICB0aGlzLm9uSW5wdXRXcmFwcGVyID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYnViYmxlXykge1xuICAgICAgdGhpcy5idWJibGVfLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuYnViYmxlXyA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMudGV4dGFyZWFfID0gbnVsbDtcbiAgICB0aGlzLmZvcmVpZ25PYmplY3QgPSBudWxsO1xuICAgIHRoaXMucGFyYWdyYXBoRWxlbWVudF8gPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxiYWNrIGZpcmVkIHdoZW4gYW4gZWRpdCBzdGFydHMuXG4gICAqXG4gICAqIEJyaW5nIHRoZSBjb21tZW50IHRvIHRoZSB0b3Agb2YgdGhlIHN0YWNrIHdoZW4gY2xpY2tlZCBvbi4gQWxzbyBjYWNoZSB0aGVcbiAgICogY3VycmVudCB0ZXh0IHNvIGl0IGNhbiBiZSB1c2VkIHRvIGZpcmUgYSBjaGFuZ2UgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBfZSBNb3VzZSB1cCBldmVudC5cbiAgICovXG4gIHByaXZhdGUgc3RhcnRFZGl0KF9lOiBQb2ludGVyRXZlbnQpIHtcbiAgICBpZiAodGhpcy5idWJibGVfPy5wcm9tb3RlKCkpIHtcbiAgICAgIC8vIFNpbmNlIHRoZSBhY3Qgb2YgbW92aW5nIHRoaXMgbm9kZSB3aXRoaW4gdGhlIERPTSBjYXVzZXMgYSBsb3NzIG9mXG4gICAgICAvLyBmb2N1cywgd2UgbmVlZCB0byByZWFwcGx5IHRoZSBmb2N1cy5cbiAgICAgIHRoaXMudGV4dGFyZWFfIS5mb2N1cygpO1xuICAgIH1cblxuICAgIHRoaXMuY2FjaGVkVGV4dCA9IHRoaXMubW9kZWwudGV4dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGRpbWVuc2lvbnMgb2YgdGhpcyBjb21tZW50J3MgYnViYmxlLlxuICAgKlxuICAgKiBAcmV0dXJucyBPYmplY3Qgd2l0aCB3aWR0aCBhbmQgaGVpZ2h0IHByb3BlcnRpZXMuXG4gICAqL1xuICBnZXRCdWJibGVTaXplKCk6IFNpemUge1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNpemU7XG4gIH1cblxuICAvKipcbiAgICogU2l6ZSB0aGlzIGNvbW1lbnQncyBidWJibGUuXG4gICAqXG4gICAqIEBwYXJhbSB3aWR0aCBXaWR0aCBvZiB0aGUgYnViYmxlLlxuICAgKiBAcGFyYW0gaGVpZ2h0IEhlaWdodCBvZiB0aGUgYnViYmxlLlxuICAgKi9cbiAgc2V0QnViYmxlU2l6ZSh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmJ1YmJsZV8pIHtcbiAgICAgIHRoaXMuYnViYmxlXy5zZXRCdWJibGVTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm1vZGVsLnNpemUud2lkdGggPSB3aWR0aDtcbiAgICAgIHRoaXMubW9kZWwuc2l6ZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY29tbWVudCdzIHZpZXcgdG8gbWF0Y2ggdGhlIG1vZGVsLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZVRleHQoKSB7XG4gICAgaWYgKHRoaXMudGV4dGFyZWFfKSB7XG4gICAgICB0aGlzLnRleHRhcmVhXy52YWx1ZSA9IHRoaXMubW9kZWwudGV4dCA/PyAnJztcbiAgICB9IGVsc2UgaWYgKHRoaXMucGFyYWdyYXBoRWxlbWVudF8pIHtcbiAgICAgIC8vIE5vbi1FZGl0YWJsZSBtb2RlLlxuICAgICAgLy8gVE9ETyAoIzI5MTcpOiBJZiAyOTE3IGdldHMgYWRkZWQgdGhpcyB3aWxsIHByb2JhYmx5IG5lZWQgdG8gYmUgdXBkYXRlZC5cbiAgICAgIHRoaXMucGFyYWdyYXBoRWxlbWVudF8uZmlyc3RDaGlsZCEudGV4dENvbnRlbnQgPSB0aGlzLm1vZGVsLnRleHQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2YgdGhpcyBjb21tZW50LlxuICAgKlxuICAgKiBJZiB5b3Ugd2FudCB0byByZWNlaXZlIGEgY29tbWVudCBcImRlbGV0ZVwiIGV2ZW50IChuZXdWYWx1ZTogbnVsbCksIHRoZW4gdGhpc1xuICAgKiBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS4gSW5zdGVhZCBjYWxsIGJsb2NrLnNldENvbW1lbnRUZXh0KG51bGwpO1xuICAgKi9cbiAgb3ZlcnJpZGUgZGlzcG9zZSgpIHtcbiAgICB0aGlzLmdldEJsb2NrKCkuY29tbWVudCA9IG51bGw7XG4gICAgc3VwZXIuZGlzcG9zZSgpO1xuICB9XG59XG5cbi8qKiBDU1MgZm9yIGJsb2NrIGNvbW1lbnQuICBTZWUgY3NzLmpzIGZvciB1c2UuICovXG5Dc3MucmVnaXN0ZXIoYFxuLmJsb2NrbHlDb21tZW50VGV4dGFyZWEge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmVmNDljO1xuICBib3JkZXI6IDA7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBtYXJnaW46IDA7XG4gIG91dGxpbmU6IDA7XG4gIHBhZGRpbmc6IDNweDtcbiAgcmVzaXplOiBub25lO1xuICB0ZXh0LW92ZXJmbG93OiBoaWRkZW47XG59XG5gKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBSZWdpc3RyeSBmb3IgY29udGV4dCBtZW51IG9wdGlvbiBpdGVtcy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db250ZXh0TWVudVJlZ2lzdHJ5Jyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciB0aGUgcmVnaXN0cnkgb2YgY29udGV4dCBtZW51IGl0ZW1zLiBUaGlzIGlzIGludGVuZGVkIHRvIGJlIGFcbiAqIHNpbmdsZXRvbi4gWW91IHNob3VsZCBub3QgY3JlYXRlIGEgbmV3IGluc3RhbmNlLCBhbmQgb25seSBhY2Nlc3MgdGhpcyBjbGFzc1xuICogZnJvbSBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbnRleHRNZW51UmVnaXN0cnlcbiAqL1xuZXhwb3J0IGNsYXNzIENvbnRleHRNZW51UmVnaXN0cnkge1xuICBzdGF0aWMgcmVnaXN0cnk6IENvbnRleHRNZW51UmVnaXN0cnk7XG4gIC8qKiBSZWdpc3RyeSBvZiBhbGwgcmVnaXN0ZXJlZCBSZWdpc3RyeUl0ZW1zLCBrZXllZCBieSBJRC4gKi9cbiAgcHJpdmF0ZSByZWdpc3RyeV8gPSBuZXcgTWFwPHN0cmluZywgUmVnaXN0cnlJdGVtPigpO1xuXG4gIC8qKiBSZXNldHMgdGhlIGV4aXN0aW5nIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiBDb250ZXh0TWVudVJlZ2lzdHJ5LiAqL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnJlc2V0KCk7XG4gIH1cblxuICAvKiogQ2xlYXIgYW5kIHJlY3JlYXRlIHRoZSByZWdpc3RyeS4gKi9cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5yZWdpc3RyeV8uY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYSBSZWdpc3RyeUl0ZW0uXG4gICAqXG4gICAqIEBwYXJhbSBpdGVtIENvbnRleHQgbWVudSBpdGVtIHRvIHJlZ2lzdGVyLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gaWYgYW4gaXRlbSB3aXRoIHRoZSBnaXZlbiBJRCBhbHJlYWR5IGV4aXN0cy5cbiAgICovXG4gIHJlZ2lzdGVyKGl0ZW06IFJlZ2lzdHJ5SXRlbSkge1xuICAgIGlmICh0aGlzLnJlZ2lzdHJ5Xy5oYXMoaXRlbS5pZCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdNZW51IGl0ZW0gd2l0aCBJRCBcIicgKyBpdGVtLmlkICsgJ1wiIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4nKTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3RyeV8uc2V0KGl0ZW0uaWQsIGl0ZW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFVucmVnaXN0ZXJzIGEgUmVnaXN0cnlJdGVtIHdpdGggdGhlIGdpdmVuIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgVGhlIElEIG9mIHRoZSBSZWdpc3RyeUl0ZW0gdG8gcmVtb3ZlLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gaWYgYW4gaXRlbSB3aXRoIHRoZSBnaXZlbiBJRCBkb2VzIG5vdCBleGlzdC5cbiAgICovXG4gIHVucmVnaXN0ZXIoaWQ6IHN0cmluZykge1xuICAgIGlmICghdGhpcy5yZWdpc3RyeV8uaGFzKGlkKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZW51IGl0ZW0gd2l0aCBJRCBcIicgKyBpZCArICdcIiBub3QgZm91bmQuJyk7XG4gICAgfVxuICAgIHRoaXMucmVnaXN0cnlfLmRlbGV0ZShpZCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIGlkIFRoZSBJRCBvZiB0aGUgUmVnaXN0cnlJdGVtIHRvIGdldC5cbiAgICogQHJldHVybnMgUmVnaXN0cnlJdGVtIG9yIG51bGwgaWYgbm90IGZvdW5kXG4gICAqL1xuICBnZXRJdGVtKGlkOiBzdHJpbmcpOiBSZWdpc3RyeUl0ZW18bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0cnlfLmdldChpZCkgPz8gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB2YWxpZCBjb250ZXh0IG1lbnUgb3B0aW9ucyBmb3IgdGhlIGdpdmVuIHNjb3BlIHR5cGUgKGUuZy4gYmxvY2sgb3JcbiAgICogd29ya3NwYWNlKSBhbmQgc2NvcGUuIEJsb2NrcyBhcmUgb25seSBzaG93biBpZiB0aGUgcHJlY29uZGl0aW9uRm4gc2hvd3NcbiAgICogdGhleSBzaG91bGQgbm90IGJlIGhpZGRlbi5cbiAgICpcbiAgICogQHBhcmFtIHNjb3BlVHlwZSBUeXBlIG9mIHNjb3BlIHdoZXJlIG1lbnUgc2hvdWxkIGJlIHNob3duIChlLmcuIG9uIGEgYmxvY2tcbiAgICogICAgIG9yIG9uIGEgd29ya3NwYWNlKVxuICAgKiBAcGFyYW0gc2NvcGUgQ3VycmVudCBzY29wZSBvZiBjb250ZXh0IG1lbnUgKGkuZS4sIHRoZSBleGFjdCB3b3Jrc3BhY2Ugb3JcbiAgICogICAgIGJsb2NrIGJlaW5nIGNsaWNrZWQgb24pXG4gICAqIEByZXR1cm5zIHRoZSBsaXN0IG9mIENvbnRleHRNZW51T3B0aW9uc1xuICAgKi9cbiAgZ2V0Q29udGV4dE1lbnVPcHRpb25zKHNjb3BlVHlwZTogU2NvcGVUeXBlLCBzY29wZTogU2NvcGUpOlxuICAgICAgQ29udGV4dE1lbnVPcHRpb25bXSB7XG4gICAgY29uc3QgbWVudU9wdGlvbnM6IENvbnRleHRNZW51T3B0aW9uW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5yZWdpc3RyeV8udmFsdWVzKCkpIHtcbiAgICAgIGlmIChzY29wZVR5cGUgPT09IGl0ZW0uc2NvcGVUeXBlKSB7XG4gICAgICAgIGNvbnN0IHByZWNvbmRpdGlvbiA9IGl0ZW0ucHJlY29uZGl0aW9uRm4oc2NvcGUpO1xuICAgICAgICBpZiAocHJlY29uZGl0aW9uICE9PSAnaGlkZGVuJykge1xuICAgICAgICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gdHlwZW9mIGl0ZW0uZGlzcGxheVRleHQgPT09ICdmdW5jdGlvbicgP1xuICAgICAgICAgICAgICBpdGVtLmRpc3BsYXlUZXh0KHNjb3BlKSA6XG4gICAgICAgICAgICAgIGl0ZW0uZGlzcGxheVRleHQ7XG4gICAgICAgICAgY29uc3QgbWVudU9wdGlvbjogQ29udGV4dE1lbnVPcHRpb24gPSB7XG4gICAgICAgICAgICB0ZXh0OiBkaXNwbGF5VGV4dCxcbiAgICAgICAgICAgIGVuYWJsZWQ6IHByZWNvbmRpdGlvbiA9PT0gJ2VuYWJsZWQnLFxuICAgICAgICAgICAgY2FsbGJhY2s6IGl0ZW0uY2FsbGJhY2ssXG4gICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgIHdlaWdodDogaXRlbS53ZWlnaHQsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBtZW51T3B0aW9ucy5wdXNoKG1lbnVPcHRpb24pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIG1lbnVPcHRpb25zLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgcmV0dXJuIGEud2VpZ2h0IC0gYi53ZWlnaHQ7XG4gICAgfSk7XG4gICAgcmV0dXJuIG1lbnVPcHRpb25zO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgQ29udGV4dE1lbnVSZWdpc3RyeSB7XG4gIC8qKlxuICAgKiBXaGVyZSB0aGlzIG1lbnUgaXRlbSBzaG91bGQgYmUgcmVuZGVyZWQuIElmIHRoZSBtZW51IGl0ZW0gc2hvdWxkIGJlXG4gICAqIHJlbmRlcmVkIGluIG11bHRpcGxlIHNjb3BlcywgZS5nLiBvbiBib3RoIGEgYmxvY2sgYW5kIGEgd29ya3NwYWNlLCBpdFxuICAgKiBzaG91bGQgYmUgcmVnaXN0ZXJlZCBmb3IgZWFjaCBzY29wZS5cbiAgICovXG4gIGV4cG9ydCBlbnVtIFNjb3BlVHlwZSB7XG4gICAgQkxPQ0sgPSAnYmxvY2snLFxuICAgIFdPUktTUEFDRSA9ICd3b3Jrc3BhY2UnLFxuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBhY3R1YWwgd29ya3NwYWNlL2Jsb2NrIHdoZXJlIHRoZSBtZW51IGlzIGJlaW5nIHJlbmRlcmVkLiBUaGlzIGlzIHBhc3NlZFxuICAgKiB0byBjYWxsYmFjayBhbmQgZGlzcGxheVRleHQgZnVuY3Rpb25zIHRoYXQgZGVwZW5kIG9uIHRoaXMgaW5mb3JtYXRpb24uXG4gICAqL1xuICBleHBvcnQgaW50ZXJmYWNlIFNjb3BlIHtcbiAgICBibG9jaz86IEJsb2NrU3ZnO1xuICAgIHdvcmtzcGFjZT86IFdvcmtzcGFjZVN2ZztcbiAgfVxuXG4gIC8qKlxuICAgKiBBIG1lbnUgaXRlbSBhcyBlbnRlcmVkIGluIHRoZSByZWdpc3RyeS5cbiAgICovXG4gIGV4cG9ydCBpbnRlcmZhY2UgUmVnaXN0cnlJdGVtIHtcbiAgICBjYWxsYmFjazogKHAxOiBTY29wZSkgPT4gdm9pZDtcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZTtcbiAgICBkaXNwbGF5VGV4dDogKChwMTogU2NvcGUpID0+IHN0cmluZyl8c3RyaW5nO1xuICAgIHByZWNvbmRpdGlvbkZuOiAocDE6IFNjb3BlKSA9PiBzdHJpbmc7XG4gICAgd2VpZ2h0OiBudW1iZXI7XG4gICAgaWQ6IHN0cmluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBBIG1lbnUgaXRlbSBhcyBwcmVzZW50ZWQgdG8gY29udGV4dG1lbnUuanMuXG4gICAqL1xuICBleHBvcnQgaW50ZXJmYWNlIENvbnRleHRNZW51T3B0aW9uIHtcbiAgICB0ZXh0OiBzdHJpbmc7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBjYWxsYmFjazogKHAxOiBTY29wZSkgPT4gdm9pZDtcbiAgICBzY29wZTogU2NvcGU7XG4gICAgd2VpZ2h0OiBudW1iZXI7XG4gIH1cblxuICAvKipcbiAgICogQSBzdWJzZXQgb2YgQ29udGV4dE1lbnVPcHRpb24gY29ycmVzcG9uZGluZyB0byB3aGF0IHdhcyBwdWJsaWNseVxuICAgKiBkb2N1bWVudGVkLiAgQ29udGV4dE1lbnVPcHRpb24gc2hvdWxkIGJlIHByZWZlcnJlZCBmb3IgbmV3IGNvZGUuXG4gICAqL1xuICBleHBvcnQgaW50ZXJmYWNlIExlZ2FjeUNvbnRleHRNZW51T3B0aW9uIHtcbiAgICB0ZXh0OiBzdHJpbmc7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBjYWxsYmFjazogKHAxOiBTY29wZSkgPT4gdm9pZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaW5nbGV0b24gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy4gQWxsIGludGVyYWN0aW9ucyB3aXRoIHRoaXMgY2xhc3Mgc2hvdWxkXG4gICAqIGJlIGRvbmUgb24gdGhpcyBvYmplY3QuXG4gICAqL1xuICBDb250ZXh0TWVudVJlZ2lzdHJ5LnJlZ2lzdHJ5ID0gbmV3IENvbnRleHRNZW51UmVnaXN0cnkoKTtcbn1cblxuZXhwb3J0IHR5cGUgU2NvcGVUeXBlID0gQ29udGV4dE1lbnVSZWdpc3RyeS5TY29wZVR5cGU7XG5leHBvcnQgY29uc3QgU2NvcGVUeXBlID0gQ29udGV4dE1lbnVSZWdpc3RyeS5TY29wZVR5cGU7XG5leHBvcnQgdHlwZSBTY29wZSA9IENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGU7XG5leHBvcnQgdHlwZSBSZWdpc3RyeUl0ZW0gPSBDb250ZXh0TWVudVJlZ2lzdHJ5LlJlZ2lzdHJ5SXRlbTtcbmV4cG9ydCB0eXBlIENvbnRleHRNZW51T3B0aW9uID0gQ29udGV4dE1lbnVSZWdpc3RyeS5Db250ZXh0TWVudU9wdGlvbjtcbmV4cG9ydCB0eXBlIExlZ2FjeUNvbnRleHRNZW51T3B0aW9uID1cbiAgICBDb250ZXh0TWVudVJlZ2lzdHJ5LkxlZ2FjeUNvbnRleHRNZW51T3B0aW9uO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1vZHVsZSB0aGF0IHByb3ZpZGVzIGNvbnN0YW50cyBmb3IgdXNlIGluc2lkZSBCbG9ja2x5LiBEbyBub3RcbiAqIHVzZSB0aGVzZSBjb25zdGFudHMgb3V0c2lkZSBvZiB0aGUgY29yZSBsaWJyYXJ5LlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5pbnRlcm5hbENvbnN0YW50c1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmludGVybmFsQ29uc3RhbnRzJyk7XG5cbmltcG9ydCB7Q29ubmVjdGlvblR5cGV9IGZyb20gJy4vY29ubmVjdGlvbl90eXBlLmpzJztcblxuXG4vKipcbiAqIE51bWJlciBvZiBjaGFyYWN0ZXJzIHRvIHRydW5jYXRlIGEgY29sbGFwc2VkIGJsb2NrIHRvLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmludGVybmFsQ29uc3RhbnRzLkNPTExBUFNFX0NIQVJTXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGNvbnN0IENPTExBUFNFX0NIQVJTID0gMzA7XG5cbi8qKlxuICogV2hlbiBkcmFnZ2luZyBhIGJsb2NrIG91dCBvZiBhIHN0YWNrLCBzcGxpdCB0aGUgc3RhY2sgaW4gdHdvICh0cnVlKSwgb3IgZHJhZ1xuICogb3V0IHRoZSBibG9jayBoZWFsaW5nIHRoZSBzdGFjayAoZmFsc2UpLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmludGVybmFsQ29uc3RhbnRzLkRSQUdfU1RBQ0tcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgY29uc3QgRFJBR19TVEFDSyA9IHRydWU7XG5cbi8qKlxuICogTG9va3VwIHRhYmxlIGZvciBkZXRlcm1pbmluZyB0aGUgb3Bwb3NpdGUgdHlwZSBvZiBhIGNvbm5lY3Rpb24uXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuaW50ZXJuYWxDb25zdGFudHMuT1BQT1NJVEVfVFlQRVxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBjb25zdCBPUFBPU0lURV9UWVBFOiBudW1iZXJbXSA9IFtdO1xuT1BQT1NJVEVfVFlQRVtDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRV0gPSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUU7XG5PUFBPU0lURV9UWVBFW0Nvbm5lY3Rpb25UeXBlLk9VVFBVVF9WQUxVRV0gPSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRTtcbk9QUE9TSVRFX1RZUEVbQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlRdID1cbiAgICBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlQ7XG5PUFBPU0lURV9UWVBFW0Nvbm5lY3Rpb25UeXBlLlBSRVZJT1VTX1NUQVRFTUVOVF0gPVxuICAgIENvbm5lY3Rpb25UeXBlLk5FWFRfU1RBVEVNRU5UO1xuXG4vKipcbiAqIFN0cmluZyBmb3IgdXNlIGluIHRoZSBkcm9wZG93biBjcmVhdGVkIGluIGZpZWxkX3ZhcmlhYmxlLlxuICogVGhpcyBzdHJpbmcgaW5kaWNhdGVzIHRoYXQgdGhpcyBvcHRpb24gaW4gdGhlIGRyb3Bkb3duIGlzICdSZW5hbWVcbiAqIHZhcmlhYmxlLi4uJyBhbmQgaWYgc2VsZWN0ZWQsIHNob3VsZCB0cmlnZ2VyIHRoZSBwcm9tcHQgdG8gcmVuYW1lIGEgdmFyaWFibGUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuaW50ZXJuYWxDb25zdGFudHMuUkVOQU1FX1ZBUklBQkxFX0lEXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGNvbnN0IFJFTkFNRV9WQVJJQUJMRV9JRCA9ICdSRU5BTUVfVkFSSUFCTEVfSUQnO1xuXG4vKipcbiAqIFN0cmluZyBmb3IgdXNlIGluIHRoZSBkcm9wZG93biBjcmVhdGVkIGluIGZpZWxkX3ZhcmlhYmxlLlxuICogVGhpcyBzdHJpbmcgaW5kaWNhdGVzIHRoYXQgdGhpcyBvcHRpb24gaW4gdGhlIGRyb3Bkb3duIGlzICdEZWxldGUgdGhlIFwiJTFcIlxuICogdmFyaWFibGUnIGFuZCBpZiBzZWxlY3RlZCwgc2hvdWxkIHRyaWdnZXIgdGhlIHByb21wdCB0byBkZWxldGUgYSB2YXJpYWJsZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5pbnRlcm5hbENvbnN0YW50cy5ERUxFVEVfVkFSSUFCTEVfSURcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgY29uc3QgREVMRVRFX1ZBUklBQkxFX0lEID0gJ0RFTEVURV9WQVJJQUJMRV9JRCc7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBhIG1hcmtlci5cbiAqIFVzZWQgcHJpbWFyaWx5IGZvciBrZXlib2FyZCBuYXZpZ2F0aW9uIHRvIHNob3cgYSBtYXJrZWQgbG9jYXRpb24uXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuTWFya2VyJyk7XG5cbi8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycyAqL1xuaW1wb3J0IHR5cGUge01hcmtlclN2Z30gZnJvbSAnLi4vcmVuZGVyZXJzL2NvbW1vbi9tYXJrZXJfc3ZnLmpzJztcblxuaW1wb3J0IHR5cGUge0FTVE5vZGV9IGZyb20gJy4vYXN0X25vZGUuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgbWFya2VyLlxuICogVGhpcyBpcyB1c2VkIGluIGtleWJvYXJkIG5hdmlnYXRpb24gdG8gc2F2ZSBhIGxvY2F0aW9uIGluIHRoZSBCbG9ja2x5IEFTVC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5NYXJrZXJcbiAqL1xuZXhwb3J0IGNsYXNzIE1hcmtlciB7XG4gIC8qKiBUaGUgY29sb3VyIG9mIHRoZSBtYXJrZXIuICovXG4gIGNvbG91cjogc3RyaW5nfG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgY3VycmVudCBsb2NhdGlvbiBvZiB0aGUgbWFya2VyLiAqL1xuICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ251bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgLy8gJ0FTVE5vZGUnLlxuICBwcml2YXRlIGN1ck5vZGVfOiBBU1ROb2RlID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqXG4gICAqIFRoZSBvYmplY3QgaW4gY2hhcmdlIG9mIGRyYXdpbmcgdGhlIHZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudFxuICAgKiBub2RlLlxuICAgKi9cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gIC8vICdNYXJrZXJTdmcnLlxuICBwcml2YXRlIGRyYXdlcl86IE1hcmtlclN2ZyA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gIC8qKiBUaGUgdHlwZSBvZiB0aGUgbWFya2VyLiAqL1xuICB0eXBlID0gJ21hcmtlcic7XG5cbiAgLyoqIENvbnN0cnVjdHMgYSBuZXcgTWFya2VyIGluc3RhbmNlLiAqL1xuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIG9iamVjdCBpbiBjaGFyZ2Ugb2YgZHJhd2luZyB0aGUgbWFya2VyLlxuICAgKlxuICAgKiBAcGFyYW0gZHJhd2VyIFRoZSBvYmplY3QgaW4gY2hhcmdlIG9mIGRyYXdpbmcgdGhlIG1hcmtlci5cbiAgICovXG4gIHNldERyYXdlcihkcmF3ZXI6IE1hcmtlclN2Zykge1xuICAgIHRoaXMuZHJhd2VyXyA9IGRyYXdlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgZHJhd2VyIGZvciB0aGUgbWFya2VyLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IGluIGNoYXJnZSBvZiBkcmF3aW5nIHRoZSBtYXJrZXIuXG4gICAqL1xuICBnZXREcmF3ZXIoKTogTWFya2VyU3ZnIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3ZXJfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGN1cnJlbnQgbG9jYXRpb24gb2YgdGhlIG1hcmtlci5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGN1cnJlbnQgZmllbGQsIGNvbm5lY3Rpb24sIG9yIGJsb2NrIHRoZSBtYXJrZXIgaXMgb24uXG4gICAqL1xuICBnZXRDdXJOb2RlKCk6IEFTVE5vZGUge1xuICAgIHJldHVybiB0aGlzLmN1ck5vZGVfO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbG9jYXRpb24gb2YgdGhlIG1hcmtlciBhbmQgY2FsbCB0aGUgdXBkYXRlIG1ldGhvZC5cbiAgICogU2V0dGluZyBpc1N0YWNrIHRvIHRydWUgd2lsbCBvbmx5IHdvcmsgaWYgdGhlIG5ld0xvY2F0aW9uIGlzIHRoZSB0b3AgbW9zdFxuICAgKiBvdXRwdXQgb3IgcHJldmlvdXMgY29ubmVjdGlvbiBvbiBhIHN0YWNrLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Tm9kZSBUaGUgbmV3IGxvY2F0aW9uIG9mIHRoZSBtYXJrZXIuXG4gICAqL1xuICBzZXRDdXJOb2RlKG5ld05vZGU6IEFTVE5vZGUpIHtcbiAgICBjb25zdCBvbGROb2RlID0gdGhpcy5jdXJOb2RlXztcbiAgICB0aGlzLmN1ck5vZGVfID0gbmV3Tm9kZTtcbiAgICBpZiAodGhpcy5kcmF3ZXJfKSB7XG4gICAgICB0aGlzLmRyYXdlcl8uZHJhdyhvbGROb2RlLCB0aGlzLmN1ck5vZGVfKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVkcmF3IHRoZSBjdXJyZW50IG1hcmtlci5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBkcmF3KCkge1xuICAgIGlmICh0aGlzLmRyYXdlcl8pIHtcbiAgICAgIHRoaXMuZHJhd2VyXy5kcmF3KHRoaXMuY3VyTm9kZV8sIHRoaXMuY3VyTm9kZV8pO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBIaWRlIHRoZSBtYXJrZXIgU1ZHLiAqL1xuICBoaWRlKCkge1xuICAgIGlmICh0aGlzLmRyYXdlcl8pIHtcbiAgICAgIHRoaXMuZHJhd2VyXy5oaWRlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgdGhpcyBtYXJrZXIuICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgaWYgKHRoaXMuZ2V0RHJhd2VyKCkpIHtcbiAgICAgIHRoaXMuZ2V0RHJhd2VyKCkuZGlzcG9zZSgpO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRoZSBjbGFzcyByZXByZXNlbnRpbmcgYSBjdXJzb3IuXG4gKiBVc2VkIHByaW1hcmlseSBmb3Iga2V5Ym9hcmQgbmF2aWdhdGlvbi5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5DdXJzb3InKTtcblxuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuXG5pbXBvcnQge0FTVE5vZGV9IGZyb20gJy4vYXN0X25vZGUuanMnO1xuaW1wb3J0IHtNYXJrZXJ9IGZyb20gJy4vbWFya2VyLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGN1cnNvci5cbiAqIEEgY3Vyc29yIGNvbnRyb2xzIGhvdyBhIHVzZXIgbmF2aWdhdGVzIHRoZSBCbG9ja2x5IEFTVC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5DdXJzb3JcbiAqL1xuZXhwb3J0IGNsYXNzIEN1cnNvciBleHRlbmRzIE1hcmtlciB7XG4gIG92ZXJyaWRlIHR5cGUgPSAnY3Vyc29yJztcblxuICAvKiogQGFsaWFzIEJsb2NrbHkuQ3Vyc29yICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgbmV4dCBjb25uZWN0aW9uLCBmaWVsZCwgb3IgYmxvY2suXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuZXh0IGVsZW1lbnQsIG9yIG51bGwgaWYgdGhlIGN1cnJlbnQgbm9kZSBpcyBub3Qgc2V0IG9yIHRoZXJlXG4gICAqICAgICBpcyBubyBuZXh0IHZhbHVlLlxuICAgKi9cbiAgbmV4dCgpOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGN1ck5vZGUgPSB0aGlzLmdldEN1ck5vZGUoKTtcbiAgICBpZiAoIWN1ck5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCBuZXdOb2RlID0gY3VyTm9kZS5uZXh0KCk7XG4gICAgd2hpbGUgKG5ld05vZGUgJiYgbmV3Tm9kZS5uZXh0KCkgJiZcbiAgICAgICAgICAgKG5ld05vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLk5FWFQgfHxcbiAgICAgICAgICAgIG5ld05vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLkJMT0NLKSkge1xuICAgICAgbmV3Tm9kZSA9IG5ld05vZGUubmV4dCgpO1xuICAgIH1cblxuICAgIGlmIChuZXdOb2RlKSB7XG4gICAgICB0aGlzLnNldEN1ck5vZGUobmV3Tm9kZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdOb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIGluIGNvbm5lY3Rpb24gb3IgZmllbGQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBpbiBlbGVtZW50LCBvciBudWxsIGlmIHRoZSBjdXJyZW50IG5vZGUgaXMgbm90IHNldCBvciB0aGVyZSBpc1xuICAgKiAgICAgbm8gaW4gdmFsdWUuXG4gICAqL1xuICBpbigpOiBBU1ROb2RlfG51bGwge1xuICAgIGxldCBjdXJOb2RlOiBBU1ROb2RlfG51bGwgPSB0aGlzLmdldEN1ck5vZGUoKTtcbiAgICBpZiAoIWN1ck5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBJZiB3ZSBhcmUgb24gYSBwcmV2aW91cyBvciBvdXRwdXQgY29ubmVjdGlvbiwgZ28gdG8gdGhlIGJsb2NrIGxldmVsXG4gICAgLy8gYmVmb3JlIHBlcmZvcm1pbmcgbmV4dCBvcGVyYXRpb24uXG4gICAgaWYgKGN1ck5vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLlBSRVZJT1VTIHx8XG4gICAgICAgIGN1ck5vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLk9VVFBVVCkge1xuICAgICAgY3VyTm9kZSA9IGN1ck5vZGUubmV4dCgpO1xuICAgIH1cbiAgICBjb25zdCBuZXdOb2RlID0gY3VyTm9kZT8uaW4oKSA/PyBudWxsO1xuXG4gICAgaWYgKG5ld05vZGUpIHtcbiAgICAgIHRoaXMuc2V0Q3VyTm9kZShuZXdOb2RlKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld05vZGU7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgcHJldmlvdXMgY29ubmVjdGlvbiwgZmllbGQsIG9yIGJsb2NrLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcHJldmlvdXMgZWxlbWVudCwgb3IgbnVsbCBpZiB0aGUgY3VycmVudCBub2RlIGlzIG5vdCBzZXQgb3JcbiAgICogICAgIHRoZXJlIGlzIG5vIHByZXZpb3VzIHZhbHVlLlxuICAgKi9cbiAgcHJldigpOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGN1ck5vZGUgPSB0aGlzLmdldEN1ck5vZGUoKTtcbiAgICBpZiAoIWN1ck5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBsZXQgbmV3Tm9kZSA9IGN1ck5vZGUucHJldigpO1xuXG4gICAgd2hpbGUgKG5ld05vZGUgJiYgbmV3Tm9kZS5wcmV2KCkgJiZcbiAgICAgICAgICAgKG5ld05vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLk5FWFQgfHxcbiAgICAgICAgICAgIG5ld05vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLkJMT0NLKSkge1xuICAgICAgbmV3Tm9kZSA9IG5ld05vZGUucHJldigpO1xuICAgIH1cblxuICAgIGlmIChuZXdOb2RlKSB7XG4gICAgICB0aGlzLnNldEN1ck5vZGUobmV3Tm9kZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdOb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIG91dCBjb25uZWN0aW9uLCBmaWVsZCwgb3IgYmxvY2suXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBvdXQgZWxlbWVudCwgb3IgbnVsbCBpZiB0aGUgY3VycmVudCBub2RlIGlzIG5vdCBzZXQgb3IgdGhlcmVcbiAgICogICAgIGlzIG5vIG91dCB2YWx1ZS5cbiAgICovXG4gIG91dCgpOiBBU1ROb2RlfG51bGwge1xuICAgIGNvbnN0IGN1ck5vZGUgPSB0aGlzLmdldEN1ck5vZGUoKTtcbiAgICBpZiAoIWN1ck5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBsZXQgbmV3Tm9kZSA9IGN1ck5vZGUub3V0KCk7XG5cbiAgICBpZiAobmV3Tm9kZSAmJiBuZXdOb2RlLmdldFR5cGUoKSA9PT0gQVNUTm9kZS50eXBlcy5CTE9DSykge1xuICAgICAgbmV3Tm9kZSA9IG5ld05vZGUucHJldigpIHx8IG5ld05vZGU7XG4gICAgfVxuXG4gICAgaWYgKG5ld05vZGUpIHtcbiAgICAgIHRoaXMuc2V0Q3VyTm9kZShuZXdOb2RlKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld05vZGU7XG4gIH1cbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5DVVJTT1IsIHJlZ2lzdHJ5LkRFRkFVTFQsIEN1cnNvcik7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBhIGJhc2ljIGN1cnNvci5cbiAqIFVzZWQgdG8gZGVtbyBzd2l0Y2hpbmcgYmV0d2VlbiBkaWZmZXJlbnQgY3Vyc29ycy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5CYXNpY0N1cnNvcicpO1xuXG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5cbmltcG9ydCB7QVNUTm9kZX0gZnJvbSAnLi9hc3Rfbm9kZS5qcyc7XG5pbXBvcnQge0N1cnNvcn0gZnJvbSAnLi9jdXJzb3IuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgYmFzaWMgY3Vyc29yLlxuICogVGhpcyB3aWxsIGFsbG93IHRoZSB1c2VyIHRvIGdldCB0byBhbGwgbm9kZXMgaW4gdGhlIEFTVCBieSBoaXR0aW5nIG5leHQgb3JcbiAqIHByZXZpb3VzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkJhc2ljQ3Vyc29yXG4gKi9cbmV4cG9ydCBjbGFzcyBCYXNpY0N1cnNvciBleHRlbmRzIEN1cnNvciB7XG4gIC8qKiBOYW1lIHVzZWQgZm9yIHJlZ2lzdGVyaW5nIGEgYmFzaWMgY3Vyc29yLiAqL1xuICBzdGF0aWMgcmVhZG9ubHkgcmVnaXN0cmF0aW9uTmFtZSA9ICdiYXNpY0N1cnNvcic7XG5cbiAgLyoqIEBhbGlhcyBCbG9ja2x5LkJhc2ljQ3Vyc29yICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgbmV4dCBub2RlIGluIHRoZSBwcmUgb3JkZXIgdHJhdmVyc2FsLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgbmV4dCBub2RlLCBvciBudWxsIGlmIHRoZSBjdXJyZW50IG5vZGUgaXMgbm90IHNldCBvciB0aGVyZSBpc1xuICAgKiAgICAgbm8gbmV4dCB2YWx1ZS5cbiAgICovXG4gIG92ZXJyaWRlIG5leHQoKTogQVNUTm9kZXxudWxsIHtcbiAgICBjb25zdCBjdXJOb2RlID0gdGhpcy5nZXRDdXJOb2RlKCk7XG4gICAgaWYgKCFjdXJOb2RlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgbmV3Tm9kZSA9IHRoaXMuZ2V0TmV4dE5vZGVfKGN1ck5vZGUsIHRoaXMudmFsaWROb2RlXyk7XG5cbiAgICBpZiAobmV3Tm9kZSkge1xuICAgICAgdGhpcy5zZXRDdXJOb2RlKG5ld05vZGUpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3Tm9kZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3IgYSBiYXNpYyBjdXJzb3Igd2Ugb25seSBoYXZlIHRoZSBhYmlsaXR5IHRvIGdvIG5leHQgYW5kIHByZXZpb3VzLCBzb1xuICAgKiBpbiB3aWxsIGFsc28gYWxsb3cgdGhlIHVzZXIgdG8gZ2V0IHRvIHRoZSBuZXh0IG5vZGUgaW4gdGhlIHByZSBvcmRlclxuICAgKiB0cmF2ZXJzYWwuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuZXh0IG5vZGUsIG9yIG51bGwgaWYgdGhlIGN1cnJlbnQgbm9kZSBpcyBub3Qgc2V0IG9yIHRoZXJlIGlzXG4gICAqICAgICBubyBuZXh0IHZhbHVlLlxuICAgKi9cbiAgb3ZlcnJpZGUgaW4oKTogQVNUTm9kZXxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5uZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgcHJldmlvdXMgbm9kZSBpbiB0aGUgcHJlIG9yZGVyIHRyYXZlcnNhbC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHByZXZpb3VzIG5vZGUsIG9yIG51bGwgaWYgdGhlIGN1cnJlbnQgbm9kZSBpcyBub3Qgc2V0IG9yIHRoZXJlXG4gICAqICAgICBpcyBubyBwcmV2aW91cyB2YWx1ZS5cbiAgICovXG4gIG92ZXJyaWRlIHByZXYoKTogQVNUTm9kZXxudWxsIHtcbiAgICBjb25zdCBjdXJOb2RlID0gdGhpcy5nZXRDdXJOb2RlKCk7XG4gICAgaWYgKCFjdXJOb2RlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgbmV3Tm9kZSA9IHRoaXMuZ2V0UHJldmlvdXNOb2RlXyhjdXJOb2RlLCB0aGlzLnZhbGlkTm9kZV8pO1xuXG4gICAgaWYgKG5ld05vZGUpIHtcbiAgICAgIHRoaXMuc2V0Q3VyTm9kZShuZXdOb2RlKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld05vZGU7XG4gIH1cblxuICAvKipcbiAgICogRm9yIGEgYmFzaWMgY3Vyc29yIHdlIG9ubHkgaGF2ZSB0aGUgYWJpbGl0eSB0byBnbyBuZXh0IGFuZCBwcmV2aW91cywgc29cbiAgICogb3V0IHdpbGwgYWxsb3cgdGhlIHVzZXIgdG8gZ2V0IHRvIHRoZSBwcmV2aW91cyBub2RlIGluIHRoZSBwcmUgb3JkZXJcbiAgICogdHJhdmVyc2FsLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcHJldmlvdXMgbm9kZSwgb3IgbnVsbCBpZiB0aGUgY3VycmVudCBub2RlIGlzIG5vdCBzZXQgb3IgdGhlcmVcbiAgICogICAgIGlzIG5vIHByZXZpb3VzIHZhbHVlLlxuICAgKi9cbiAgb3ZlcnJpZGUgb3V0KCk6IEFTVE5vZGV8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMucHJldigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZXMgcHJlIG9yZGVyIHRyYXZlcnNhbCB0byBuYXZpZ2F0ZSB0aGUgQmxvY2tseSBBU1QuIFRoaXMgd2lsbCBhbGxvd1xuICAgKiBhIHVzZXIgdG8gZWFzaWx5IG5hdmlnYXRlIHRoZSBlbnRpcmUgQmxvY2tseSBBU1Qgd2l0aG91dCBoYXZpbmcgdG8gZ28gaW5cbiAgICogYW5kIG91dCBsZXZlbHMgb24gdGhlIHRyZWUuXG4gICAqXG4gICAqIEBwYXJhbSBub2RlIFRoZSBjdXJyZW50IHBvc2l0aW9uIGluIHRoZSBBU1QuXG4gICAqIEBwYXJhbSBpc1ZhbGlkIEEgZnVuY3Rpb24gdHJ1ZS9mYWxzZSBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZ2l2ZW4gbm9kZVxuICAgKiAgICAgc2hvdWxkIGJlIHRyYXZlcnNlZC5cbiAgICogQHJldHVybnMgVGhlIG5leHQgbm9kZSBpbiB0aGUgdHJhdmVyc2FsLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldE5leHROb2RlXyhcbiAgICAgIG5vZGU6IEFTVE5vZGV8bnVsbCwgaXNWYWxpZDogKHAxOiBBU1ROb2RlfG51bGwpID0+IGJvb2xlYW4pOiBBU1ROb2RlXG4gICAgICB8bnVsbCB7XG4gICAgaWYgKCFub2RlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgbmV3Tm9kZSA9IG5vZGUuaW4oKSB8fCBub2RlLm5leHQoKTtcbiAgICBpZiAoaXNWYWxpZChuZXdOb2RlKSkge1xuICAgICAgcmV0dXJuIG5ld05vZGU7XG4gICAgfSBlbHNlIGlmIChuZXdOb2RlKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXROZXh0Tm9kZV8obmV3Tm9kZSwgaXNWYWxpZCk7XG4gICAgfVxuICAgIGNvbnN0IHNpYmxpbmdPclBhcmVudCA9IHRoaXMuZmluZFNpYmxpbmdPclBhcmVudF8obm9kZS5vdXQoKSk7XG4gICAgaWYgKGlzVmFsaWQoc2libGluZ09yUGFyZW50KSkge1xuICAgICAgcmV0dXJuIHNpYmxpbmdPclBhcmVudDtcbiAgICB9IGVsc2UgaWYgKHNpYmxpbmdPclBhcmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TmV4dE5vZGVfKHNpYmxpbmdPclBhcmVudCwgaXNWYWxpZCk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldmVyc2VzIHRoZSBwcmUgb3JkZXIgdHJhdmVyc2FsIGluIG9yZGVyIHRvIGZpbmQgdGhlIHByZXZpb3VzIG5vZGUuIFRoaXNcbiAgICogd2lsbCBhbGxvdyBhIHVzZXIgdG8gZWFzaWx5IG5hdmlnYXRlIHRoZSBlbnRpcmUgQmxvY2tseSBBU1Qgd2l0aG91dCBoYXZpbmdcbiAgICogdG8gZ28gaW4gYW5kIG91dCBsZXZlbHMgb24gdGhlIHRyZWUuXG4gICAqXG4gICAqIEBwYXJhbSBub2RlIFRoZSBjdXJyZW50IHBvc2l0aW9uIGluIHRoZSBBU1QuXG4gICAqIEBwYXJhbSBpc1ZhbGlkIEEgZnVuY3Rpb24gdHJ1ZS9mYWxzZSBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZ2l2ZW4gbm9kZVxuICAgKiAgICAgc2hvdWxkIGJlIHRyYXZlcnNlZC5cbiAgICogQHJldHVybnMgVGhlIHByZXZpb3VzIG5vZGUgaW4gdGhlIHRyYXZlcnNhbCBvciBudWxsIGlmIG5vIHByZXZpb3VzIG5vZGVcbiAgICogICAgIGV4aXN0cy5cbiAgICovXG4gIHByb3RlY3RlZCBnZXRQcmV2aW91c05vZGVfKFxuICAgICAgbm9kZTogQVNUTm9kZXxudWxsLCBpc1ZhbGlkOiAocDE6IEFTVE5vZGV8bnVsbCkgPT4gYm9vbGVhbik6IEFTVE5vZGVcbiAgICAgIHxudWxsIHtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBsZXQgbmV3Tm9kZTogQVNUTm9kZXxudWxsID0gbm9kZS5wcmV2KCk7XG5cbiAgICBpZiAobmV3Tm9kZSkge1xuICAgICAgbmV3Tm9kZSA9IHRoaXMuZ2V0UmlnaHRNb3N0Q2hpbGRfKG5ld05vZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdOb2RlID0gbm9kZS5vdXQoKTtcbiAgICB9XG4gICAgaWYgKGlzVmFsaWQobmV3Tm9kZSkpIHtcbiAgICAgIHJldHVybiBuZXdOb2RlO1xuICAgIH0gZWxzZSBpZiAobmV3Tm9kZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJldmlvdXNOb2RlXyhuZXdOb2RlLCBpc1ZhbGlkKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogRGVjaWRlcyB3aGF0IG5vZGVzIHRvIHRyYXZlcnNlIGFuZCB3aGljaCBvbmVzIHRvIHNraXAuIEN1cnJlbnRseSwgaXRcbiAgICogc2tpcHMgb3V0cHV0LCBzdGFjayBhbmQgd29ya3NwYWNlIG5vZGVzLlxuICAgKlxuICAgKiBAcGFyYW0gbm9kZSBUaGUgQVNUIG5vZGUgdG8gY2hlY2sgd2hldGhlciBpdCBpcyB2YWxpZC5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbm9kZSBzaG91bGQgYmUgdmlzaXRlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHZhbGlkTm9kZV8obm9kZTogQVNUTm9kZXxudWxsKTogYm9vbGVhbiB7XG4gICAgbGV0IGlzVmFsaWQgPSBmYWxzZTtcbiAgICBjb25zdCB0eXBlID0gbm9kZSAmJiBub2RlLmdldFR5cGUoKTtcbiAgICBpZiAodHlwZSA9PT0gQVNUTm9kZS50eXBlcy5PVVRQVVQgfHwgdHlwZSA9PT0gQVNUTm9kZS50eXBlcy5JTlBVVCB8fFxuICAgICAgICB0eXBlID09PSBBU1ROb2RlLnR5cGVzLkZJRUxEIHx8IHR5cGUgPT09IEFTVE5vZGUudHlwZXMuTkVYVCB8fFxuICAgICAgICB0eXBlID09PSBBU1ROb2RlLnR5cGVzLlBSRVZJT1VTIHx8IHR5cGUgPT09IEFTVE5vZGUudHlwZXMuV09SS1NQQUNFKSB7XG4gICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG4gIH1cblxuICAvKipcbiAgICogRnJvbSB0aGUgZ2l2ZW4gbm9kZSBmaW5kIGVpdGhlciB0aGUgbmV4dCB2YWxpZCBzaWJsaW5nIG9yIHBhcmVudC5cbiAgICpcbiAgICogQHBhcmFtIG5vZGUgVGhlIGN1cnJlbnQgcG9zaXRpb24gaW4gdGhlIEFTVC5cbiAgICogQHJldHVybnMgVGhlIHBhcmVudCBBU1Qgbm9kZSBvciBudWxsIGlmIHRoZXJlIGFyZSBubyB2YWxpZCBwYXJlbnRzLlxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kU2libGluZ09yUGFyZW50Xyhub2RlOiBBU1ROb2RlfG51bGwpOiBBU1ROb2RlfG51bGwge1xuICAgIGlmICghbm9kZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IG5leHROb2RlID0gbm9kZS5uZXh0KCk7XG4gICAgaWYgKG5leHROb2RlKSB7XG4gICAgICByZXR1cm4gbmV4dE5vZGU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmZpbmRTaWJsaW5nT3JQYXJlbnRfKG5vZGUub3V0KCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcmlnaHQgbW9zdCBjaGlsZCBvZiBhIG5vZGUuXG4gICAqXG4gICAqIEBwYXJhbSBub2RlIFRoZSBub2RlIHRvIGZpbmQgdGhlIHJpZ2h0IG1vc3QgY2hpbGQgb2YuXG4gICAqIEByZXR1cm5zIFRoZSByaWdodCBtb3N0IGNoaWxkIG9mIHRoZSBnaXZlbiBub2RlLCBvciB0aGUgbm9kZSBpZiBubyBjaGlsZFxuICAgKiAgICAgZXhpc3RzLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRSaWdodE1vc3RDaGlsZF8obm9kZTogQVNUTm9kZXxudWxsKTogQVNUTm9kZXxudWxsIHtcbiAgICBpZiAoIW5vZGUhLmluKCkpIHtcbiAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICBsZXQgbmV3Tm9kZSA9IG5vZGUhLmluKCk7XG4gICAgd2hpbGUgKG5ld05vZGUgJiYgbmV3Tm9kZS5uZXh0KCkpIHtcbiAgICAgIG5ld05vZGUgPSBuZXdOb2RlLm5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZ2V0UmlnaHRNb3N0Q2hpbGRfKG5ld05vZGUpO1xuICB9XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuQ1VSU09SLCBCYXNpY0N1cnNvci5yZWdpc3RyYXRpb25OYW1lLCBCYXNpY0N1cnNvcik7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBhIGN1cnNvciB0aGF0IGlzIHVzZWQgdG8gbmF2aWdhdGVcbiAqIGJldHdlZW4gdGFiIG5hdmlnYWJsZSBmaWVsZHMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVGFiTmF2aWdhdGVDdXJzb3InKTtcblxuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuLi9maWVsZC5qcyc7XG5cbmltcG9ydCB7QVNUTm9kZX0gZnJvbSAnLi9hc3Rfbm9kZS5qcyc7XG5pbXBvcnQge0Jhc2ljQ3Vyc29yfSBmcm9tICcuL2Jhc2ljX2N1cnNvci5qcyc7XG5cblxuLyoqXG4gKiBBIGN1cnNvciBmb3IgbmF2aWdhdGluZyBiZXR3ZWVuIHRhYiBuYXZpZ2FibGUgZmllbGRzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRhYk5hdmlnYXRlQ3Vyc29yXG4gKi9cbmV4cG9ydCBjbGFzcyBUYWJOYXZpZ2F0ZUN1cnNvciBleHRlbmRzIEJhc2ljQ3Vyc29yIHtcbiAgLyoqXG4gICAqIFNraXAgYWxsIG5vZGVzIGV4Y2VwdCBmb3IgdGFiIG5hdmlnYWJsZSBmaWVsZHMuXG4gICAqXG4gICAqIEBwYXJhbSBub2RlIFRoZSBBU1Qgbm9kZSB0byBjaGVjayB3aGV0aGVyIGl0IGlzIHZhbGlkLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBub2RlIHNob3VsZCBiZSB2aXNpdGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBvdmVycmlkZSB2YWxpZE5vZGVfKG5vZGU6IEFTVE5vZGV8bnVsbCk6IGJvb2xlYW4ge1xuICAgIGxldCBpc1ZhbGlkID0gZmFsc2U7XG4gICAgY29uc3QgdHlwZSA9IG5vZGUgJiYgbm9kZS5nZXRUeXBlKCk7XG4gICAgaWYgKG5vZGUpIHtcbiAgICAgIGNvbnN0IGxvY2F0aW9uID0gbm9kZS5nZXRMb2NhdGlvbigpIGFzIEZpZWxkO1xuICAgICAgaWYgKHR5cGUgPT09IEFTVE5vZGUudHlwZXMuRklFTEQgJiYgbG9jYXRpb24gJiZcbiAgICAgICAgICBsb2NhdGlvbi5pc1RhYk5hdmlnYWJsZSgpICYmIGxvY2F0aW9uLmlzQ2xpY2thYmxlKCkpIHtcbiAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpc1ZhbGlkO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ29tcG9uZW50cyBmb3IgY3JlYXRpbmcgY29ubmVjdGlvbnMgYmV0d2VlbiBibG9ja3MuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuUmVuZGVyZWRDb25uZWN0aW9uJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja30gZnJvbSAnLi9ibG9jay5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQge2NvbmZpZ30gZnJvbSAnLi9jb25maWcuanMnO1xuaW1wb3J0IHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge0Nvbm5lY3Rpb25EQn0gZnJvbSAnLi9jb25uZWN0aW9uX2RiLmpzJztcbmltcG9ydCB7Q29ubmVjdGlvblR5cGV9IGZyb20gJy4vY29ubmVjdGlvbl90eXBlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0ICogYXMgaW50ZXJuYWxDb25zdGFudHMgZnJvbSAnLi9pbnRlcm5hbF9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtDb29yZGluYXRlfSBmcm9tICcuL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuaW1wb3J0ICogYXMgc3ZnUGF0aHMgZnJvbSAnLi91dGlscy9zdmdfcGF0aHMuanMnO1xuXG5cbi8qKiBBIHNoYXBlIHRoYXQgaGFzIGEgcGF0aERvd24gcHJvcGVydHkuICovXG5pbnRlcmZhY2UgUGF0aERvd25TaGFwZSB7XG4gIHBhdGhEb3duOiBzdHJpbmc7XG59XG5cbi8qKiBBIHNoYXBlIHRoYXQgaGFzIGEgcGF0aExlZnQgcHJvcGVydHkuICovXG5pbnRlcmZhY2UgUGF0aExlZnRTaGFwZSB7XG4gIHBhdGhMZWZ0OiBzdHJpbmc7XG59XG5cbi8qKiBNYXhpbXVtIHJhbmRvbW5lc3MgaW4gd29ya3NwYWNlIHVuaXRzIGZvciBidW1waW5nIGEgYmxvY2suICovXG5jb25zdCBCVU1QX1JBTkRPTU5FU1MgPSAxMDtcblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBjb25uZWN0aW9uIGJldHdlZW4gYmxvY2tzIHRoYXQgbWF5IGJlIHJlbmRlcmVkIG9uIHNjcmVlbi5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5SZW5kZXJlZENvbm5lY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIFJlbmRlcmVkQ29ubmVjdGlvbiBleHRlbmRzIENvbm5lY3Rpb24ge1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBzb3VyY2VCbG9ja18hOiBCbG9ja1N2ZztcbiAgcHJpdmF0ZSByZWFkb25seSBkYl86IENvbm5lY3Rpb25EQjtcbiAgcHJpdmF0ZSByZWFkb25seSBkYk9wcG9zaXRlXzogQ29ubmVjdGlvbkRCO1xuICBwcml2YXRlIHJlYWRvbmx5IG9mZnNldEluQmxvY2tfOiBDb29yZGluYXRlO1xuICBwcml2YXRlIHRyYWNrZWRTdGF0ZV86IFRyYWNrZWRTdGF0ZTtcbiAgcHJpdmF0ZSBoaWdobGlnaHRQYXRoOiBTVkdQYXRoRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogQ29ubmVjdGlvbiB0aGlzIGNvbm5lY3Rpb24gY29ubmVjdHMgdG8uICBOdWxsIGlmIG5vdCBjb25uZWN0ZWQuICovXG4gIG92ZXJyaWRlIHRhcmdldENvbm5lY3Rpb246IFJlbmRlcmVkQ29ubmVjdGlvbnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQHBhcmFtIHNvdXJjZSBUaGUgYmxvY2sgZXN0YWJsaXNoaW5nIHRoaXMgY29ubmVjdGlvbi5cbiAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgdGhlIGNvbm5lY3Rpb24uXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihzb3VyY2U6IEJsb2NrU3ZnLCB0eXBlOiBudW1iZXIpIHtcbiAgICBzdXBlcihzb3VyY2UsIHR5cGUpO1xuXG4gICAgLyoqXG4gICAgICogQ29ubmVjdGlvbiBkYXRhYmFzZSBmb3IgY29ubmVjdGlvbnMgb2YgdGhpcyB0eXBlIG9uIHRoZSBjdXJyZW50XG4gICAgICogd29ya3NwYWNlLlxuICAgICAqL1xuICAgIHRoaXMuZGJfID0gc291cmNlLndvcmtzcGFjZS5jb25uZWN0aW9uREJMaXN0W3R5cGVdO1xuXG4gICAgLyoqXG4gICAgICogQ29ubmVjdGlvbiBkYXRhYmFzZSBmb3IgY29ubmVjdGlvbnMgY29tcGF0aWJsZSB3aXRoIHRoaXMgdHlwZSBvbiB0aGVcbiAgICAgKiBjdXJyZW50IHdvcmtzcGFjZS5cbiAgICAgKi9cbiAgICB0aGlzLmRiT3Bwb3NpdGVfID1cbiAgICAgICAgc291cmNlLndvcmtzcGFjZVxuICAgICAgICAgICAgLmNvbm5lY3Rpb25EQkxpc3RbaW50ZXJuYWxDb25zdGFudHMuT1BQT1NJVEVfVFlQRVt0eXBlXV07XG5cbiAgICAvKiogV29ya3NwYWNlIHVuaXRzLCAoMCwgMCkgaXMgdG9wIGxlZnQgb2YgYmxvY2suICovXG4gICAgdGhpcy5vZmZzZXRJbkJsb2NrXyA9IG5ldyBDb29yZGluYXRlKDAsIDApO1xuXG4gICAgLyoqIERlc2NyaWJlcyB0aGUgc3RhdGUgb2YgdGhpcyBjb25uZWN0aW9uJ3MgdHJhY2tlZC1uZXNzLiAqL1xuICAgIHRoaXMudHJhY2tlZFN0YXRlXyA9IFJlbmRlcmVkQ29ubmVjdGlvbi5UcmFja2VkU3RhdGUuV0lMTF9UUkFDSztcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIHRoaXMgY29ubmVjdGlvbi4gUmVtb3ZlIGl0IGZyb20gdGhlIGRhdGFiYXNlIChpZiBpdCBpc1xuICAgKiB0cmFja2VkKSBhbmQgY2FsbCB0aGUgc3VwZXItZnVuY3Rpb24gdG8gZGVhbCB3aXRoIGNvbm5lY3RlZCBibG9ja3MuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgZGlzcG9zZSgpIHtcbiAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgaWYgKHRoaXMudHJhY2tlZFN0YXRlXyA9PT0gUmVuZGVyZWRDb25uZWN0aW9uLlRyYWNrZWRTdGF0ZS5UUkFDS0VEKSB7XG4gICAgICB0aGlzLmRiXy5yZW1vdmVDb25uZWN0aW9uKHRoaXMsIHRoaXMueSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc291cmNlIGJsb2NrIGZvciB0aGlzIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBzb3VyY2UgYmxvY2suXG4gICAqL1xuICBvdmVycmlkZSBnZXRTb3VyY2VCbG9jaygpOiBCbG9ja1N2ZyB7XG4gICAgcmV0dXJuIHN1cGVyLmdldFNvdXJjZUJsb2NrKCkgYXMgQmxvY2tTdmc7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgYmxvY2sgdGhhdCB0aGlzIGNvbm5lY3Rpb24gY29ubmVjdHMgdG8uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb25uZWN0ZWQgYmxvY2sgb3IgbnVsbCBpZiBub25lIGlzIGNvbm5lY3RlZC5cbiAgICovXG4gIG92ZXJyaWRlIHRhcmdldEJsb2NrKCk6IEJsb2NrU3ZnfG51bGwge1xuICAgIHJldHVybiBzdXBlci50YXJnZXRCbG9jaygpIGFzIEJsb2NrU3ZnO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGRpc3RhbmNlIGJldHdlZW4gdGhpcyBjb25uZWN0aW9uIGFuZCBhbm90aGVyIGNvbm5lY3Rpb24gaW5cbiAgICogd29ya3NwYWNlIHVuaXRzLlxuICAgKlxuICAgKiBAcGFyYW0gb3RoZXJDb25uZWN0aW9uIFRoZSBvdGhlciBjb25uZWN0aW9uIHRvIG1lYXN1cmUgdGhlIGRpc3RhbmNlIHRvLlxuICAgKiBAcmV0dXJucyBUaGUgZGlzdGFuY2UgYmV0d2VlbiBjb25uZWN0aW9ucywgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKi9cbiAgZGlzdGFuY2VGcm9tKG90aGVyQ29ubmVjdGlvbjogQ29ubmVjdGlvbik6IG51bWJlciB7XG4gICAgY29uc3QgeERpZmYgPSB0aGlzLnggLSBvdGhlckNvbm5lY3Rpb24ueDtcbiAgICBjb25zdCB5RGlmZiA9IHRoaXMueSAtIG90aGVyQ29ubmVjdGlvbi55O1xuICAgIHJldHVybiBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgdGhlIGJsb2NrKHMpIGJlbG9uZ2luZyB0byB0aGUgY29ubmVjdGlvbiB0byBhIHBvaW50IHdoZXJlIHRoZXkgZG9uJ3RcbiAgICogdmlzdWFsbHkgaW50ZXJmZXJlIHdpdGggdGhlIHNwZWNpZmllZCBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdGljQ29ubmVjdGlvbiBUaGUgY29ubmVjdGlvbiB0byBtb3ZlIGF3YXkgZnJvbS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBidW1wQXdheUZyb20oc3RhdGljQ29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9uKSB7XG4gICAgaWYgKHRoaXMuc291cmNlQmxvY2tfLndvcmtzcGFjZS5pc0RyYWdnaW5nKCkpIHtcbiAgICAgIC8vIERvbid0IG1vdmUgYmxvY2tzIGFyb3VuZCB3aGlsZSB0aGUgdXNlciBpcyBkb2luZyB0aGUgc2FtZS5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gTW92ZSB0aGUgcm9vdCBibG9jay5cbiAgICBsZXQgcm9vdEJsb2NrID0gdGhpcy5zb3VyY2VCbG9ja18uZ2V0Um9vdEJsb2NrKCk7XG4gICAgaWYgKHJvb3RCbG9jay5pc0luRmx5b3V0KSB7XG4gICAgICAvLyBEb24ndCBtb3ZlIGJsb2NrcyBhcm91bmQgaW4gYSBmbHlvdXQuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCByZXZlcnNlID0gZmFsc2U7XG4gICAgaWYgKCFyb290QmxvY2suaXNNb3ZhYmxlKCkpIHtcbiAgICAgIC8vIENhbid0IGJ1bXAgYW4gdW5lZGl0YWJsZSBibG9jayBhd2F5LlxuICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBvdGhlciBibG9jayBpcyBtb3ZhYmxlLlxuICAgICAgcm9vdEJsb2NrID0gc3RhdGljQ29ubmVjdGlvbi5nZXRTb3VyY2VCbG9jaygpLmdldFJvb3RCbG9jaygpO1xuICAgICAgaWYgKCFyb290QmxvY2suaXNNb3ZhYmxlKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gU3dhcCB0aGUgY29ubmVjdGlvbnMgYW5kIG1vdmUgdGhlICdzdGF0aWMnIGNvbm5lY3Rpb24gaW5zdGVhZC5cbiAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdGhpcy1hbGlhcyAqL1xuICAgICAgc3RhdGljQ29ubmVjdGlvbiA9IHRoaXM7XG4gICAgICByZXZlcnNlID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gUmFpc2UgaXQgdG8gdGhlIHRvcCBmb3IgZXh0cmEgdmlzaWJpbGl0eS5cbiAgICBjb25zdCBzZWxlY3RlZCA9IGNvbW1vbi5nZXRTZWxlY3RlZCgpID09IHJvb3RCbG9jaztcbiAgICBzZWxlY3RlZCB8fCByb290QmxvY2suYWRkU2VsZWN0KCk7XG4gICAgbGV0IGR4ID0gc3RhdGljQ29ubmVjdGlvbi54ICsgY29uZmlnLnNuYXBSYWRpdXMgK1xuICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBCVU1QX1JBTkRPTU5FU1MpIC0gdGhpcy54O1xuICAgIGxldCBkeSA9IHN0YXRpY0Nvbm5lY3Rpb24ueSArIGNvbmZpZy5zbmFwUmFkaXVzICtcbiAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogQlVNUF9SQU5ET01ORVNTKSAtIHRoaXMueTtcbiAgICBpZiAocmV2ZXJzZSkge1xuICAgICAgLy8gV2hlbiByZXZlcnNpbmcgYSBidW1wIGR1ZSB0byBhbiB1bmVkaXRhYmxlIGJsb2NrLCBidW1wIHVwLlxuICAgICAgZHkgPSAtZHk7XG4gICAgfVxuICAgIGlmIChyb290QmxvY2suUlRMKSB7XG4gICAgICBkeCA9IHN0YXRpY0Nvbm5lY3Rpb24ueCAtIGNvbmZpZy5zbmFwUmFkaXVzIC1cbiAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBCVU1QX1JBTkRPTU5FU1MpIC0gdGhpcy54O1xuICAgIH1cbiAgICByb290QmxvY2subW92ZUJ5KGR4LCBkeSk7XG4gICAgc2VsZWN0ZWQgfHwgcm9vdEJsb2NrLnJlbW92ZVNlbGVjdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgY29ubmVjdGlvbidzIGNvb3JkaW5hdGVzLlxuICAgKlxuICAgKiBAcGFyYW0geCBOZXcgYWJzb2x1dGUgeCBjb29yZGluYXRlLCBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqIEBwYXJhbSB5IE5ldyBhYnNvbHV0ZSB5IGNvb3JkaW5hdGUsIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICovXG4gIG1vdmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnRyYWNrZWRTdGF0ZV8gPT09IFJlbmRlcmVkQ29ubmVjdGlvbi5UcmFja2VkU3RhdGUuV0lMTF9UUkFDSykge1xuICAgICAgdGhpcy5kYl8uYWRkQ29ubmVjdGlvbih0aGlzLCB5KTtcbiAgICAgIHRoaXMudHJhY2tlZFN0YXRlXyA9IFJlbmRlcmVkQ29ubmVjdGlvbi5UcmFja2VkU3RhdGUuVFJBQ0tFRDtcbiAgICB9IGVsc2UgaWYgKHRoaXMudHJhY2tlZFN0YXRlXyA9PT0gUmVuZGVyZWRDb25uZWN0aW9uLlRyYWNrZWRTdGF0ZS5UUkFDS0VEKSB7XG4gICAgICB0aGlzLmRiXy5yZW1vdmVDb25uZWN0aW9uKHRoaXMsIHRoaXMueSk7XG4gICAgICB0aGlzLmRiXy5hZGRDb25uZWN0aW9uKHRoaXMsIHkpO1xuICAgIH1cbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gIH1cblxuICAvKipcbiAgICogQ2hhbmdlIHRoZSBjb25uZWN0aW9uJ3MgY29vcmRpbmF0ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBkeCBDaGFuZ2UgdG8geCBjb29yZGluYXRlLCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBwYXJhbSBkeSBDaGFuZ2UgdG8geSBjb29yZGluYXRlLCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBtb3ZlQnkoZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xuICAgIHRoaXMubW92ZVRvKHRoaXMueCArIGR4LCB0aGlzLnkgKyBkeSk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGlzIGNvbm5lY3Rpb24gdG8gdGhlIGxvY2F0aW9uIGdpdmVuIGJ5IGl0cyBvZmZzZXQgd2l0aGluIHRoZSBibG9ja1xuICAgKiBhbmQgdGhlIGxvY2F0aW9uIG9mIHRoZSBibG9jaydzIHRvcCBsZWZ0IGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrVEwgVGhlIGxvY2F0aW9uIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIGJsb2NrLCBpblxuICAgKiAgICAgd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgKi9cbiAgbW92ZVRvT2Zmc2V0KGJsb2NrVEw6IENvb3JkaW5hdGUpIHtcbiAgICB0aGlzLm1vdmVUbyhcbiAgICAgICAgYmxvY2tUTC54ICsgdGhpcy5vZmZzZXRJbkJsb2NrXy54LCBibG9ja1RMLnkgKyB0aGlzLm9mZnNldEluQmxvY2tfLnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgb2Zmc2V0IG9mIHRoaXMgY29ubmVjdGlvbiByZWxhdGl2ZSB0byB0aGUgdG9wIGxlZnQgb2YgaXRzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0geCBUaGUgbmV3IHJlbGF0aXZlIHgsIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICogQHBhcmFtIHkgVGhlIG5ldyByZWxhdGl2ZSB5LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBzZXRPZmZzZXRJbkJsb2NrKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5vZmZzZXRJbkJsb2NrXy54ID0geDtcbiAgICB0aGlzLm9mZnNldEluQmxvY2tfLnkgPSB5O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgb2Zmc2V0IG9mIHRoaXMgY29ubmVjdGlvbiByZWxhdGl2ZSB0byB0aGUgdG9wIGxlZnQgb2YgaXRzIGJsb2NrLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgb2Zmc2V0IG9mIHRoZSBjb25uZWN0aW9uLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldE9mZnNldEluQmxvY2soKTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIHRoaXMub2Zmc2V0SW5CbG9ja187XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgYmxvY2tzIG9uIGVpdGhlciBzaWRlIG9mIHRoaXMgY29ubmVjdGlvbiByaWdodCBuZXh0IHRvIGVhY2ggb3RoZXIuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdGlnaHRlbigpIHtcbiAgICBjb25zdCBkeCA9IHRoaXMudGFyZ2V0Q29ubmVjdGlvbiEueCAtIHRoaXMueDtcbiAgICBjb25zdCBkeSA9IHRoaXMudGFyZ2V0Q29ubmVjdGlvbiEueSAtIHRoaXMueTtcbiAgICBpZiAoZHggIT09IDAgfHwgZHkgIT09IDApIHtcbiAgICAgIGNvbnN0IGJsb2NrID0gdGhpcy50YXJnZXRCbG9jaygpO1xuICAgICAgY29uc3Qgc3ZnUm9vdCA9IGJsb2NrIS5nZXRTdmdSb290KCk7XG4gICAgICBpZiAoIXN2Z1Jvb3QpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ2Jsb2NrIGlzIG5vdCByZW5kZXJlZC4nKTtcbiAgICAgIH1cbiAgICAgIC8vIFdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICAgIGNvbnN0IHh5ID0gc3ZnTWF0aC5nZXRSZWxhdGl2ZVhZKHN2Z1Jvb3QpO1xuICAgICAgYmxvY2shLmdldFN2Z1Jvb3QoKS5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArICh4eS54IC0gZHgpICsgJywnICsgKHh5LnkgLSBkeSkgKyAnKScpO1xuICAgICAgYmxvY2shLm1vdmVDb25uZWN0aW9ucygtZHgsIC1keSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIGNsb3Nlc3QgY29tcGF0aWJsZSBjb25uZWN0aW9uIHRvIHRoaXMgY29ubmVjdGlvbi5cbiAgICogQWxsIHBhcmFtZXRlcnMgYXJlIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICpcbiAgICogQHBhcmFtIG1heExpbWl0IFRoZSBtYXhpbXVtIHJhZGl1cyB0byBhbm90aGVyIGNvbm5lY3Rpb24uXG4gICAqIEBwYXJhbSBkeHkgT2Zmc2V0IGJldHdlZW4gdGhpcyBjb25uZWN0aW9uJ3MgbG9jYXRpb24gaW4gdGhlIGRhdGFiYXNlIGFuZFxuICAgKiAgICAgdGhlIGN1cnJlbnQgbG9jYXRpb24gKGFzIGEgcmVzdWx0IG9mIGRyYWdnaW5nKS5cbiAgICogQHJldHVybnMgQ29udGFpbnMgdHdvIHByb3BlcnRpZXM6ICdjb25uZWN0aW9uJyB3aGljaCBpcyBlaXRoZXIgYW5vdGhlclxuICAgKiAgICAgY29ubmVjdGlvbiBvciBudWxsLCBhbmQgJ3JhZGl1cycgd2hpY2ggaXMgdGhlIGRpc3RhbmNlLlxuICAgKi9cbiAgY2xvc2VzdChtYXhMaW1pdDogbnVtYmVyLCBkeHk6IENvb3JkaW5hdGUpOlxuICAgICAge2Nvbm5lY3Rpb246IFJlbmRlcmVkQ29ubmVjdGlvbnxudWxsLCByYWRpdXM6IG51bWJlcn0ge1xuICAgIHJldHVybiB0aGlzLmRiT3Bwb3NpdGVfLnNlYXJjaEZvckNsb3Nlc3QodGhpcywgbWF4TGltaXQsIGR4eSk7XG4gIH1cblxuICAvKiogQWRkIGhpZ2hsaWdodGluZyBhcm91bmQgdGhpcyBjb25uZWN0aW9uLiAqL1xuICBoaWdobGlnaHQoKSB7XG4gICAgaWYgKHRoaXMuaGlnaGxpZ2h0UGF0aCkge1xuICAgICAgLy8gVGhpcyBjb25uZWN0aW9uIGlzIGFscmVhZHkgaGlnaGxpZ2h0ZWRcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHN0ZXBzO1xuICAgIGNvbnN0IHNvdXJjZUJsb2NrU3ZnID0gKHRoaXMuc291cmNlQmxvY2tfKTtcbiAgICBjb25zdCByZW5kZXJDb25zdGFudHMgPVxuICAgICAgICBzb3VyY2VCbG9ja1N2Zy53b3Jrc3BhY2UuZ2V0UmVuZGVyZXIoKS5nZXRDb25zdGFudHMoKTtcbiAgICBjb25zdCBzaGFwZSA9IHJlbmRlckNvbnN0YW50cy5zaGFwZUZvcih0aGlzKTtcbiAgICBpZiAodGhpcy50eXBlID09PSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRSB8fFxuICAgICAgICB0aGlzLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLk9VVFBVVF9WQUxVRSkge1xuICAgICAgLy8gVmVydGljYWwgbGluZSwgcHV6emxlIHRhYiwgdmVydGljYWwgbGluZS5cbiAgICAgIGNvbnN0IHlMZW4gPSByZW5kZXJDb25zdGFudHMuVEFCX09GRlNFVF9GUk9NX1RPUDtcbiAgICAgIHN0ZXBzID0gc3ZnUGF0aHMubW92ZUJ5KDAsIC15TGVuKSArIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCB5TGVuKSArXG4gICAgICAgICAgKHNoYXBlIGFzIHVua25vd24gYXMgUGF0aERvd25TaGFwZSkucGF0aERvd24gK1xuICAgICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCB5TGVuKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgeExlbiA9XG4gICAgICAgICAgcmVuZGVyQ29uc3RhbnRzLk5PVENIX09GRlNFVF9MRUZUIC0gcmVuZGVyQ29uc3RhbnRzLkNPUk5FUl9SQURJVVM7XG4gICAgICAvLyBIb3Jpem9udGFsIGxpbmUsIG5vdGNoLCBob3Jpem9udGFsIGxpbmUuXG4gICAgICBzdGVwcyA9IHN2Z1BhdGhzLm1vdmVCeSgteExlbiwgMCkgKyBzdmdQYXRocy5saW5lT25BeGlzKCdoJywgeExlbikgK1xuICAgICAgICAgIChzaGFwZSBhcyB1bmtub3duIGFzIFBhdGhMZWZ0U2hhcGUpLnBhdGhMZWZ0ICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCdoJywgeExlbik7XG4gICAgfVxuICAgIGNvbnN0IHh5ID0gdGhpcy5zb3VyY2VCbG9ja18uZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgIGNvbnN0IHggPSB0aGlzLnggLSB4eS54O1xuICAgIGNvbnN0IHkgPSB0aGlzLnkgLSB4eS55O1xuICAgIHRoaXMuaGlnaGxpZ2h0UGF0aCA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUEFUSCwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5SGlnaGxpZ2h0ZWRDb25uZWN0aW9uUGF0aCcsXG4gICAgICAgICAgJ2QnOiBzdGVwcyxcbiAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZSgnICsgeCArICcsJyArIHkgKyAnKScgK1xuICAgICAgICAgICAgICAodGhpcy5zb3VyY2VCbG9ja18uUlRMID8gJyBzY2FsZSgtMSAxKScgOiAnJyksXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuc291cmNlQmxvY2tfLmdldFN2Z1Jvb3QoKSk7XG4gIH1cblxuICAvKiogUmVtb3ZlIHRoZSBoaWdobGlnaHRpbmcgYXJvdW5kIHRoaXMgY29ubmVjdGlvbi4gKi9cbiAgdW5oaWdobGlnaHQoKSB7XG4gICAgaWYgKHRoaXMuaGlnaGxpZ2h0UGF0aCkge1xuICAgICAgZG9tLnJlbW92ZU5vZGUodGhpcy5oaWdobGlnaHRQYXRoKTtcbiAgICAgIHRoaXMuaGlnaGxpZ2h0UGF0aCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgY29ubmVjdGlvbnMgaXMgdHJhY2tlZCBpbiB0aGUgZGF0YWJhc2Ugb3Igbm90LlxuICAgKlxuICAgKiBAcGFyYW0gZG9UcmFja2luZyBJZiB0cnVlLCBzdGFydCB0cmFja2luZy4gSWYgZmFsc2UsIHN0b3AgdHJhY2tpbmcuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0VHJhY2tpbmcoZG9UcmFja2luZzogYm9vbGVhbikge1xuICAgIGlmIChkb1RyYWNraW5nICYmXG4gICAgICAgICAgICB0aGlzLnRyYWNrZWRTdGF0ZV8gPT09IFJlbmRlcmVkQ29ubmVjdGlvbi5UcmFja2VkU3RhdGUuVFJBQ0tFRCB8fFxuICAgICAgICAhZG9UcmFja2luZyAmJlxuICAgICAgICAgICAgdGhpcy50cmFja2VkU3RhdGVfID09PSBSZW5kZXJlZENvbm5lY3Rpb24uVHJhY2tlZFN0YXRlLlVOVFJBQ0tFRCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5zb3VyY2VCbG9ja18uaXNJbkZseW91dCkge1xuICAgICAgLy8gRG9uJ3QgYm90aGVyIG1haW50YWluaW5nIGEgZGF0YWJhc2Ugb2YgY29ubmVjdGlvbnMgaW4gYSBmbHlvdXQuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChkb1RyYWNraW5nKSB7XG4gICAgICB0aGlzLmRiXy5hZGRDb25uZWN0aW9uKHRoaXMsIHRoaXMueSk7XG4gICAgICB0aGlzLnRyYWNrZWRTdGF0ZV8gPSBSZW5kZXJlZENvbm5lY3Rpb24uVHJhY2tlZFN0YXRlLlRSQUNLRUQ7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYWNrZWRTdGF0ZV8gPT09IFJlbmRlcmVkQ29ubmVjdGlvbi5UcmFja2VkU3RhdGUuVFJBQ0tFRCkge1xuICAgICAgdGhpcy5kYl8ucmVtb3ZlQ29ubmVjdGlvbih0aGlzLCB0aGlzLnkpO1xuICAgIH1cbiAgICB0aGlzLnRyYWNrZWRTdGF0ZV8gPSBSZW5kZXJlZENvbm5lY3Rpb24uVHJhY2tlZFN0YXRlLlVOVFJBQ0tFRDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIHRyYWNraW5nIHRoaXMgY29ubmVjdGlvbiwgYXMgd2VsbCBhcyBhbGwgZG93bi1zdHJlYW0gY29ubmVjdGlvbnMgb25cbiAgICogYW55IGJsb2NrIGF0dGFjaGVkIHRvIHRoaXMgY29ubmVjdGlvbi4gVGhpcyBoYXBwZW5zIHdoZW4gYSBibG9jayBpc1xuICAgKiBjb2xsYXBzZWQuXG4gICAqXG4gICAqIEFsc28gY2xvc2VzIGRvd24tc3RyZWFtIGljb25zL2J1YmJsZXMuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RvcFRyYWNraW5nQWxsKCkge1xuICAgIHRoaXMuc2V0VHJhY2tpbmcoZmFsc2UpO1xuICAgIGlmICh0aGlzLnRhcmdldENvbm5lY3Rpb24pIHtcbiAgICAgIGNvbnN0IGJsb2NrcyA9IHRoaXMudGFyZ2V0QmxvY2soKSEuZ2V0RGVzY2VuZGFudHMoZmFsc2UpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBibG9ja3NbaV07XG4gICAgICAgIC8vIFN0b3AgdHJhY2tpbmcgY29ubmVjdGlvbnMgb2YgYWxsIGNoaWxkcmVuLlxuICAgICAgICBjb25zdCBjb25uZWN0aW9ucyA9IGJsb2NrLmdldENvbm5lY3Rpb25zXyh0cnVlKTtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb25uZWN0aW9ucy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIChjb25uZWN0aW9uc1tqXSkuc2V0VHJhY2tpbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENsb3NlIGFsbCBidWJibGVzIG9mIGFsbCBjaGlsZHJlbi5cbiAgICAgICAgY29uc3QgaWNvbnMgPSBibG9jay5nZXRJY29ucygpO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGljb25zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgaWNvbnNbal0uc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgdHJhY2tpbmcgdGhpcyBjb25uZWN0aW9uLCBhcyB3ZWxsIGFzIGFsbCBkb3duLXN0cmVhbSBjb25uZWN0aW9ucyBvblxuICAgKiBhbnkgYmxvY2sgYXR0YWNoZWQgdG8gdGhpcyBjb25uZWN0aW9uLiBUaGlzIGhhcHBlbnMgd2hlbiBhIGJsb2NrIGlzXG4gICAqIGV4cGFuZGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBMaXN0IG9mIGJsb2NrcyB0byByZW5kZXIuXG4gICAqL1xuICBzdGFydFRyYWNraW5nQWxsKCk6IEJsb2NrW10ge1xuICAgIHRoaXMuc2V0VHJhY2tpbmcodHJ1ZSk7XG4gICAgLy8gQWxsIGJsb2NrcyB0aGF0IGFyZSBub3QgdHJhY2tlZCBtdXN0IHN0YXJ0IHRyYWNraW5nIGJlZm9yZSBhbnlcbiAgICAvLyByZW5kZXJpbmcgdGFrZXMgcGxhY2UsIHNpbmNlIHJlbmRlcmluZyByZXF1aXJlcyBrbm93aW5nIHRoZSBkaW1lbnNpb25zXG4gICAgLy8gb2YgbG93ZXIgYmxvY2tzLiBBbHNvLCBzaW5jZSByZW5kZXJpbmcgYSBibG9jayByZW5kZXJzIGFsbCBpdHMgcGFyZW50cyxcbiAgICAvLyB3ZSBvbmx5IG5lZWQgdG8gcmVuZGVyIHRoZSBsZWFmIG5vZGVzLlxuICAgIGxldCByZW5kZXJMaXN0OiBCbG9ja1tdID0gW107XG4gICAgaWYgKHRoaXMudHlwZSAhPT0gQ29ubmVjdGlvblR5cGUuSU5QVVRfVkFMVUUgJiZcbiAgICAgICAgdGhpcy50eXBlICE9PSBDb25uZWN0aW9uVHlwZS5ORVhUX1NUQVRFTUVOVCkge1xuICAgICAgLy8gT25seSBzcGlkZXIgZG93bi5cbiAgICAgIHJldHVybiByZW5kZXJMaXN0O1xuICAgIH1cbiAgICBjb25zdCBibG9jayA9IHRoaXMudGFyZ2V0QmxvY2soKTtcbiAgICBpZiAoYmxvY2spIHtcbiAgICAgIGxldCBjb25uZWN0aW9ucztcbiAgICAgIGlmIChibG9jay5pc0NvbGxhcHNlZCgpKSB7XG4gICAgICAgIC8vIFRoaXMgYmxvY2sgc2hvdWxkIG9ubHkgYmUgcGFydGlhbGx5IHJldmVhbGVkIHNpbmNlIGl0IGlzIGNvbGxhcHNlZC5cbiAgICAgICAgY29ubmVjdGlvbnMgPSBbXTtcbiAgICAgICAgYmxvY2sub3V0cHV0Q29ubmVjdGlvbiAmJiBjb25uZWN0aW9ucy5wdXNoKGJsb2NrLm91dHB1dENvbm5lY3Rpb24pO1xuICAgICAgICBibG9jay5uZXh0Q29ubmVjdGlvbiAmJiBjb25uZWN0aW9ucy5wdXNoKGJsb2NrLm5leHRDb25uZWN0aW9uKTtcbiAgICAgICAgYmxvY2sucHJldmlvdXNDb25uZWN0aW9uICYmIGNvbm5lY3Rpb25zLnB1c2goYmxvY2sucHJldmlvdXNDb25uZWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNob3cgYWxsIGNvbm5lY3Rpb25zIG9mIHRoaXMgYmxvY2suXG4gICAgICAgIGNvbm5lY3Rpb25zID0gYmxvY2suZ2V0Q29ubmVjdGlvbnNfKHRydWUpO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb25uZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICByZW5kZXJMaXN0LnB1c2goLi4uY29ubmVjdGlvbnNbaV0uc3RhcnRUcmFja2luZ0FsbCgpKTtcbiAgICAgIH1cbiAgICAgIGlmICghcmVuZGVyTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgLy8gTGVhZiBibG9jay5cbiAgICAgICAgcmVuZGVyTGlzdCA9IFtibG9ja107XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZW5kZXJMaXN0O1xuICB9XG5cbiAgLyoqXG4gICAqIEJlaGF2aW9yIGFmdGVyIGEgY29ubmVjdGlvbiBhdHRlbXB0IGZhaWxzLlxuICAgKiBCdW1wcyB0aGlzIGNvbm5lY3Rpb24gYXdheSBmcm9tIHRoZSBvdGhlciBjb25uZWN0aW9uLiBDYWxsZWQgd2hlbiBhblxuICAgKiBhdHRlbXB0ZWQgY29ubmVjdGlvbiBmYWlscy5cbiAgICpcbiAgICogQHBhcmFtIG90aGVyQ29ubmVjdGlvbiBDb25uZWN0aW9uIHRoYXQgdGhpcyBjb25uZWN0aW9uIGZhaWxlZCB0byBjb25uZWN0XG4gICAqICAgICB0by5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBvbkZhaWxlZENvbm5lY3Qob3RoZXJDb25uZWN0aW9uOiBDb25uZWN0aW9uKSB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKGV2ZW50VXRpbHMuZ2V0UmVjb3JkVW5kbygpKSB7XG4gICAgICBjb25zdCBncm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24odGhpczogUmVuZGVyZWRDb25uZWN0aW9uKSB7XG4gICAgICAgIGlmICghYmxvY2suaXNEaXNwb3NlZCgpICYmICFibG9jay5nZXRQYXJlbnQoKSkge1xuICAgICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZ3JvdXApO1xuICAgICAgICAgIHRoaXMuYnVtcEF3YXlGcm9tKG90aGVyQ29ubmVjdGlvbiBhcyBSZW5kZXJlZENvbm5lY3Rpb24pO1xuICAgICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9LmJpbmQodGhpcyksIGNvbmZpZy5idW1wRGVsYXkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNjb25uZWN0IHR3byBibG9ja3MgdGhhdCBhcmUgY29ubmVjdGVkIGJ5IHRoaXMgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHBhcmVudEJsb2NrIFRoZSBzdXBlcmlvciBibG9jay5cbiAgICogQHBhcmFtIGNoaWxkQmxvY2sgVGhlIGluZmVyaW9yIGJsb2NrLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRpc2Nvbm5lY3RJbnRlcm5hbF8oXG4gICAgICBwYXJlbnRCbG9jazogQmxvY2ssIGNoaWxkQmxvY2s6IEJsb2NrKSB7XG4gICAgc3VwZXIuZGlzY29ubmVjdEludGVybmFsXyhwYXJlbnRCbG9jaywgY2hpbGRCbG9jayk7XG4gICAgY29uc3QgcmVuZGVyZWRQYXJlbnQgPSBwYXJlbnRCbG9jayBhcyBCbG9ja1N2ZztcbiAgICBjb25zdCByZW5kZXJlZENoaWxkID0gY2hpbGRCbG9jayBhcyBCbG9ja1N2ZztcbiAgICAvLyBSZXJlbmRlciB0aGUgcGFyZW50IHNvIHRoYXQgaXQgbWF5IHJlZmxvdy5cbiAgICBpZiAocmVuZGVyZWRQYXJlbnQucmVuZGVyZWQpIHtcbiAgICAgIHJlbmRlcmVkUGFyZW50LnJlbmRlcigpO1xuICAgIH1cbiAgICBpZiAocmVuZGVyZWRDaGlsZC5yZW5kZXJlZCkge1xuICAgICAgcmVuZGVyZWRDaGlsZC51cGRhdGVEaXNhYmxlZCgpO1xuICAgICAgcmVuZGVyZWRDaGlsZC5yZW5kZXIoKTtcbiAgICAgIC8vIFJlc2V0IHZpc2liaWxpdHksIHNpbmNlIHRoZSBjaGlsZCBpcyBub3cgYSB0b3AgYmxvY2suXG4gICAgICByZW5kZXJlZENoaWxkLmdldFN2Z1Jvb3QoKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVzcGF3biB0aGUgc2hhZG93IGJsb2NrIGlmIHRoZXJlIHdhcyBvbmUgY29ubmVjdGVkIHRvIHRoZSB0aGlzIGNvbm5lY3Rpb24uXG4gICAqIFJlbmRlci9yZXJlbmRlciBibG9ja3MgYXMgbmVlZGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHJlc3Bhd25TaGFkb3dfKCkge1xuICAgIHN1cGVyLnJlc3Bhd25TaGFkb3dfKCk7XG4gICAgY29uc3QgYmxvY2tTaGFkb3cgPSB0aGlzLnRhcmdldEJsb2NrKCk7XG4gICAgaWYgKCFibG9ja1NoYWRvdykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBibG9ja1NoYWRvdy5pbml0U3ZnKCk7XG4gICAgYmxvY2tTaGFkb3cucmVuZGVyKGZhbHNlKTtcblxuICAgIGNvbnN0IHBhcmVudEJsb2NrID0gdGhpcy5nZXRTb3VyY2VCbG9jaygpO1xuICAgIGlmIChwYXJlbnRCbG9jay5yZW5kZXJlZCkge1xuICAgICAgcGFyZW50QmxvY2sucmVuZGVyKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYWxsIG5lYXJieSBjb21wYXRpYmxlIGNvbm5lY3Rpb25zIHRvIHRoaXMgY29ubmVjdGlvbi5cbiAgICogVHlwZSBjaGVja2luZyBkb2VzIG5vdCBhcHBseSwgc2luY2UgdGhpcyBmdW5jdGlvbiBpcyB1c2VkIGZvciBidW1waW5nLlxuICAgKlxuICAgKiBAcGFyYW0gbWF4TGltaXQgVGhlIG1heGltdW0gcmFkaXVzIHRvIGFub3RoZXIgY29ubmVjdGlvbiwgaW4gd29ya3NwYWNlXG4gICAqICAgICB1bml0cy5cbiAgICogQHJldHVybnMgTGlzdCBvZiBjb25uZWN0aW9ucy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBuZWlnaGJvdXJzKG1heExpbWl0OiBudW1iZXIpOiBSZW5kZXJlZENvbm5lY3Rpb25bXSB7XG4gICAgcmV0dXJuIHRoaXMuZGJPcHBvc2l0ZV8uZ2V0TmVpZ2hib3Vycyh0aGlzLCBtYXhMaW1pdCk7XG4gIH1cblxuICAvKipcbiAgICogQ29ubmVjdCB0d28gY29ubmVjdGlvbnMgdG9nZXRoZXIuICBUaGlzIGlzIHRoZSBjb25uZWN0aW9uIG9uIHRoZSBzdXBlcmlvclxuICAgKiBibG9jay4gIFJlcmVuZGVyIGJsb2NrcyBhcyBuZWVkZWQuXG4gICAqXG4gICAqIEBwYXJhbSBjaGlsZENvbm5lY3Rpb24gQ29ubmVjdGlvbiBvbiBpbmZlcmlvciBibG9jay5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBjb25uZWN0XyhjaGlsZENvbm5lY3Rpb246IENvbm5lY3Rpb24pIHtcbiAgICBzdXBlci5jb25uZWN0XyhjaGlsZENvbm5lY3Rpb24pO1xuXG4gICAgY29uc3QgcmVuZGVyZWRDaGlsZENvbm5lY3Rpb24gPSBjaGlsZENvbm5lY3Rpb24gYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuXG4gICAgY29uc3QgcGFyZW50QmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgY29uc3QgY2hpbGRCbG9jayA9IHJlbmRlcmVkQ2hpbGRDb25uZWN0aW9uLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgY29uc3QgcGFyZW50UmVuZGVyZWQgPSBwYXJlbnRCbG9jay5yZW5kZXJlZDtcbiAgICBjb25zdCBjaGlsZFJlbmRlcmVkID0gY2hpbGRCbG9jay5yZW5kZXJlZDtcblxuICAgIGlmIChwYXJlbnRSZW5kZXJlZCkge1xuICAgICAgcGFyZW50QmxvY2sudXBkYXRlRGlzYWJsZWQoKTtcbiAgICB9XG4gICAgaWYgKGNoaWxkUmVuZGVyZWQpIHtcbiAgICAgIGNoaWxkQmxvY2sudXBkYXRlRGlzYWJsZWQoKTtcbiAgICB9XG4gICAgaWYgKHBhcmVudFJlbmRlcmVkICYmIGNoaWxkUmVuZGVyZWQpIHtcbiAgICAgIGlmICh0aGlzLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLk5FWFRfU1RBVEVNRU5UIHx8XG4gICAgICAgICAgdGhpcy50eXBlID09PSBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlQpIHtcbiAgICAgICAgLy8gQ2hpbGQgYmxvY2sgbWF5IG5lZWQgdG8gc3F1YXJlIG9mZiBpdHMgY29ybmVycyBpZiBpdCBpcyBpbiBhIHN0YWNrLlxuICAgICAgICAvLyBSZW5kZXJpbmcgYSBjaGlsZCB3aWxsIHJlbmRlciBpdHMgcGFyZW50LlxuICAgICAgICBjaGlsZEJsb2NrLnJlbmRlcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ2hpbGQgYmxvY2sgZG9lcyBub3QgY2hhbmdlIHNoYXBlLiAgUmVuZGVyaW5nIHRoZSBwYXJlbnQgbm9kZSB3aWxsXG4gICAgICAgIC8vIG1vdmUgaXRzIGNvbm5lY3RlZCBjaGlsZHJlbiBpbnRvIHBvc2l0aW9uLlxuICAgICAgICBwYXJlbnRCbG9jay5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUaGUgaW5wdXQgdGhlIGNoaWxkIGJsb2NrIGlzIGNvbm5lY3RlZCB0byAoaWYgYW55KS5cbiAgICBjb25zdCBwYXJlbnRJbnB1dCA9IHBhcmVudEJsb2NrLmdldElucHV0V2l0aEJsb2NrKGNoaWxkQmxvY2spO1xuICAgIGlmIChwYXJlbnRJbnB1dCkge1xuICAgICAgY29uc3QgdmlzaWJsZSA9IHBhcmVudElucHV0LmlzVmlzaWJsZSgpO1xuICAgICAgY2hpbGRCbG9jay5nZXRTdmdSb290KCkuc3R5bGUuZGlzcGxheSA9IHZpc2libGUgPyAnYmxvY2snIDogJ25vbmUnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiB0aGlzIGNvbm5lY3Rpb24ncyBjb21wYXRpYmxlIHR5cGVzIGhhdmUgY2hhbmdlZC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBvbkNoZWNrQ2hhbmdlZF8oKSB7XG4gICAgLy8gVGhlIG5ldyB2YWx1ZSB0eXBlIG1heSBub3QgYmUgY29tcGF0aWJsZSB3aXRoIHRoZSBleGlzdGluZyBjb25uZWN0aW9uLlxuICAgIGlmICh0aGlzLmlzQ29ubmVjdGVkKCkgJiZcbiAgICAgICAgKCF0aGlzLnRhcmdldENvbm5lY3Rpb24gfHxcbiAgICAgICAgICF0aGlzLmdldENvbm5lY3Rpb25DaGVja2VyKCkuY2FuQ29ubmVjdChcbiAgICAgICAgICAgICB0aGlzLCB0aGlzLnRhcmdldENvbm5lY3Rpb24sIGZhbHNlKSkpIHtcbiAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5pc1N1cGVyaW9yKCkgPyB0aGlzLnRhcmdldEJsb2NrKCkgOiB0aGlzLnNvdXJjZUJsb2NrXztcbiAgICAgIGNoaWxkIS51bnBsdWcoKTtcbiAgICAgIC8vIEJ1bXAgYXdheS5cbiAgICAgIHRoaXMuc291cmNlQmxvY2tfLmJ1bXBOZWlnaGJvdXJzKCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgUmVuZGVyZWRDb25uZWN0aW9uIHtcbiAgLyoqXG4gICAqIEVudW0gZm9yIGRpZmZlcmVudCBraW5kcyBvZiB0cmFja2VkIHN0YXRlcy5cbiAgICpcbiAgICogV0lMTF9UUkFDSyBtZWFucyB0aGF0IHRoaXMgY29ubmVjdGlvbiB3aWxsIGFkZCBpdHNlbGYgdG9cbiAgICogdGhlIGRiIG9uIHRoZSBuZXh0IG1vdmVUbyBjYWxsIGl0IHJlY2VpdmVzLlxuICAgKlxuICAgKiBVTlRSQUNLRUQgbWVhbnMgdGhhdCB0aGlzIGNvbm5lY3Rpb24gd2lsbCBub3QgYWRkXG4gICAqIGl0c2VsZiB0byB0aGUgZGF0YWJhc2UgdW50aWwgc2V0VHJhY2tpbmcodHJ1ZSkgaXMgZXhwbGljaXRseSBjYWxsZWQuXG4gICAqXG4gICAqIFRSQUNLRUQgbWVhbnMgdGhhdCB0aGlzIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IGJlaW5nIHRyYWNrZWQuXG4gICAqL1xuICBleHBvcnQgZW51bSBUcmFja2VkU3RhdGUge1xuICAgIFdJTExfVFJBQ0sgPSAtMSxcbiAgICBVTlRSQUNLRUQgPSAwLFxuICAgIFRSQUNLRUQgPSAxLFxuICB9XG59XG5cbmV4cG9ydCB0eXBlIFRyYWNrZWRTdGF0ZSA9IFJlbmRlcmVkQ29ubmVjdGlvbi5UcmFja2VkU3RhdGU7XG5leHBvcnQgY29uc3QgVHJhY2tlZFN0YXRlID0gUmVuZGVyZWRDb25uZWN0aW9uLlRyYWNrZWRTdGF0ZTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGEgd2FybmluZy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5XYXJuaW5nJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX2J1YmJsZV9vcGVuLmpzJztcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQge0J1YmJsZX0gZnJvbSAnLi9idWJibGUuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge0ljb259IGZyb20gJy4vaWNvbi5qcyc7XG5pbXBvcnQgdHlwZSB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgd2FybmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5XYXJuaW5nXG4gKi9cbmV4cG9ydCBjbGFzcyBXYXJuaW5nIGV4dGVuZHMgSWNvbiB7XG4gIHByaXZhdGUgdGV4dDoge1trZXk6IHN0cmluZ106IHN0cmluZ307XG5cbiAgLyoqIFRoZSB0b3AtbGV2ZWwgbm9kZSBvZiB0aGUgd2FybmluZyB0ZXh0LCBvciBudWxsIGlmIG5vdCBjcmVhdGVkLiAqL1xuICBwcml2YXRlIHBhcmFncmFwaEVsZW1lbnQ6IFNWR1RleHRFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBEb2VzIHRoaXMgaWNvbiBnZXQgaGlkZGVuIHdoZW4gdGhlIGJsb2NrIGlzIGNvbGxhcHNlZD8gKi9cbiAgb3ZlcnJpZGUgY29sbGFwc2VIaWRkZW4gPSBmYWxzZTtcblxuICAvKiogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBhc3NvY2lhdGVkIHdpdGggdGhpcyB3YXJuaW5nLiAqL1xuICBjb25zdHJ1Y3RvcihibG9jazogQmxvY2tTdmcpIHtcbiAgICBzdXBlcihibG9jayk7XG4gICAgdGhpcy5jcmVhdGVJY29uKCk7XG4gICAgLy8gVGhlIHRleHQgb2JqZWN0IGNhbiBjb250YWluIG11bHRpcGxlIHdhcm5pbmdzLlxuICAgIHRoaXMudGV4dCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogRHJhdyB0aGUgd2FybmluZyBpY29uLlxuICAgKlxuICAgKiBAcGFyYW0gZ3JvdXAgVGhlIGljb24gZ3JvdXAuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZHJhd0ljb25fKGdyb3VwOiBFbGVtZW50KSB7XG4gICAgLy8gVHJpYW5nbGUgd2l0aCByb3VuZGVkIGNvcm5lcnMuXG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5QQVRILCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlJY29uU2hhcGUnLFxuICAgICAgICAgICdkJzogJ00yLDE1US0xLDE1IDAuNSwxMkw2LjUsMS43UTgsLTEgOS41LDEuN0wxNS41LDEyUTE3LDE1IDE0LDE1eicsXG4gICAgICAgIH0sXG4gICAgICAgIGdyb3VwKTtcbiAgICAvLyBDYW4ndCB1c2UgYSByZWFsICchJyB0ZXh0IGNoYXJhY3RlciBzaW5jZSBkaWZmZXJlbnQgYnJvd3NlcnMgYW5kXG4gICAgLy8gb3BlcmF0aW5nIHN5c3RlbXMgcmVuZGVyIGl0IGRpZmZlcmVudGx5LiBCb2R5IG9mIGV4Y2xhbWF0aW9uIHBvaW50LlxuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUEFUSCwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5SWNvblN5bWJvbCcsXG4gICAgICAgICAgJ2QnOiAnbTcsNC44djMuMTZsMC4yNywyLjI3aDEuNDZsMC4yNywtMi4yN3YtMy4xNnonLFxuICAgICAgICB9LFxuICAgICAgICBncm91cCk7XG4gICAgLy8gRG90IG9mIGV4Y2xhbWF0aW9uIHBvaW50LlxuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5SWNvblN5bWJvbCcsXG4gICAgICAgICAgJ3gnOiAnNycsXG4gICAgICAgICAgJ3knOiAnMTEnLFxuICAgICAgICAgICdoZWlnaHQnOiAnMicsXG4gICAgICAgICAgJ3dpZHRoJzogJzInLFxuICAgICAgICB9LFxuICAgICAgICBncm91cCk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyBvciBoaWRlIHRoZSB3YXJuaW5nIGJ1YmJsZS5cbiAgICpcbiAgICogQHBhcmFtIHZpc2libGUgVHJ1ZSBpZiB0aGUgYnViYmxlIHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgc2V0VmlzaWJsZSh2aXNpYmxlOiBib29sZWFuKSB7XG4gICAgaWYgKHZpc2libGUgPT09IHRoaXMuaXNWaXNpYmxlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CVUJCTEVfT1BFTikpKFxuICAgICAgICB0aGlzLmdldEJsb2NrKCksIHZpc2libGUsICd3YXJuaW5nJykpO1xuICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICB0aGlzLmNyZWF0ZUJ1YmJsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc3Bvc2VCdWJibGUoKTtcbiAgICB9XG4gIH1cblxuICAvKiogU2hvdyB0aGUgYnViYmxlLiAqL1xuICBwcml2YXRlIGNyZWF0ZUJ1YmJsZSgpIHtcbiAgICB0aGlzLnBhcmFncmFwaEVsZW1lbnQgPSBCdWJibGUudGV4dFRvRG9tKHRoaXMuZ2V0VGV4dCgpKTtcbiAgICB0aGlzLmJ1YmJsZV8gPSBCdWJibGUuY3JlYXRlTm9uRWRpdGFibGVCdWJibGUoXG4gICAgICAgIHRoaXMucGFyYWdyYXBoRWxlbWVudCwgdGhpcy5nZXRCbG9jaygpLCB0aGlzLmljb25YWV8gYXMgQ29vcmRpbmF0ZSk7XG4gICAgdGhpcy5hcHBseUNvbG91cigpO1xuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgdGhlIGJ1YmJsZSBhbmQgcmVmZXJlbmNlcyB0byBpdC4gKi9cbiAgcHJpdmF0ZSBkaXNwb3NlQnViYmxlKCkge1xuICAgIGlmICh0aGlzLmJ1YmJsZV8pIHtcbiAgICAgIHRoaXMuYnViYmxlXy5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmJ1YmJsZV8gPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnBhcmFncmFwaEVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGlzIHdhcm5pbmcncyB0ZXh0LlxuICAgKlxuICAgKiBAcGFyYW0gdGV4dCBXYXJuaW5nIHRleHQgKG9yICcnIHRvIGRlbGV0ZSkuIFRoaXMgc3VwcG9ydHMgbGluZWJyZWFrcy5cbiAgICogQHBhcmFtIGlkIEFuIElEIGZvciB0aGlzIHRleHQgZW50cnkgdG8gYmUgYWJsZSB0byBtYWludGFpbiBtdWx0aXBsZVxuICAgKiAgICAgd2FybmluZ3MuXG4gICAqL1xuICBzZXRUZXh0KHRleHQ6IHN0cmluZywgaWQ6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnRleHRbaWRdID09PSB0ZXh0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0ZXh0KSB7XG4gICAgICB0aGlzLnRleHRbaWRdID0gdGV4dDtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlIHRoaXMudGV4dFtpZF07XG4gICAgfVxuICAgIGlmICh0aGlzLmlzVmlzaWJsZSgpKSB7XG4gICAgICB0aGlzLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgdGhpcy5zZXRWaXNpYmxlKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhpcyB3YXJuaW5nJ3MgdGV4dHMuXG4gICAqXG4gICAqIEByZXR1cm5zIEFsbCB0ZXh0cyBjb25jYXRlbmF0ZWQgaW50byBvbmUgc3RyaW5nLlxuICAgKi9cbiAgZ2V0VGV4dCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGFsbFdhcm5pbmdzID0gW107XG4gICAgZm9yIChjb25zdCBpZCBpbiB0aGlzLnRleHQpIHtcbiAgICAgIGFsbFdhcm5pbmdzLnB1c2godGhpcy50ZXh0W2lkXSk7XG4gICAgfVxuICAgIHJldHVybiBhbGxXYXJuaW5ncy5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIC8qKiBEaXNwb3NlIG9mIHRoaXMgd2FybmluZy4gKi9cbiAgb3ZlcnJpZGUgZGlzcG9zZSgpIHtcbiAgICB0aGlzLmdldEJsb2NrKCkud2FybmluZyA9IG51bGw7XG4gICAgc3VwZXIuZGlzcG9zZSgpO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWV0aG9kcyBmb3IgZ3JhcGhpY2FsbHkgcmVuZGVyaW5nIGEgYmxvY2sgYXMgU1ZHLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkJsb2NrU3ZnJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX3NlbGVjdGVkLmpzJztcblxuaW1wb3J0IHtCbG9ja30gZnJvbSAnLi9ibG9jay5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja0FuaW1hdGlvbnMgZnJvbSAnLi9ibG9ja19hbmltYXRpb25zLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQge0NvbW1lbnR9IGZyb20gJy4vY29tbWVudC5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0IHtjb25maWd9IGZyb20gJy4vY29uZmlnLmpzJztcbmltcG9ydCB0eXBlIHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCAqIGFzIENvbnRleHRNZW51IGZyb20gJy4vY29udGV4dG1lbnUuanMnO1xuaW1wb3J0IHtDb250ZXh0TWVudU9wdGlvbiwgQ29udGV4dE1lbnVSZWdpc3RyeSwgTGVnYWN5Q29udGV4dE1lbnVPcHRpb259IGZyb20gJy4vY29udGV4dG1lbnVfcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrTW92ZX0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Jsb2NrX21vdmUuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7RmllbGR9IGZyb20gJy4vZmllbGQuanMnO1xuaW1wb3J0IHtGaWVsZExhYmVsfSBmcm9tICcuL2ZpZWxkX2xhYmVsLmpzJztcbmltcG9ydCB0eXBlIHtJY29ufSBmcm9tICcuL2ljb24uanMnO1xuaW1wb3J0IHR5cGUge0lucHV0fSBmcm9tICcuL2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtJQVNUTm9kZUxvY2F0aW9uU3ZnfSBmcm9tICcuL2ludGVyZmFjZXMvaV9hc3Rfbm9kZV9sb2NhdGlvbl9zdmcuanMnO1xuaW1wb3J0IHR5cGUge0lCb3VuZGVkRWxlbWVudH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYm91bmRlZF9lbGVtZW50LmpzJztcbmltcG9ydCB0eXBlIHtDb3B5RGF0YSwgSUNvcHlhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9jb3B5YWJsZS5qcyc7XG5pbXBvcnQgdHlwZSB7SURyYWdnYWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ2dhYmxlLmpzJztcbmltcG9ydCAqIGFzIGludGVybmFsQ29uc3RhbnRzIGZyb20gJy4vaW50ZXJuYWxfY29uc3RhbnRzLmpzJztcbmltcG9ydCB7QVNUTm9kZX0gZnJvbSAnLi9rZXlib2FyZF9uYXYvYXN0X25vZGUuanMnO1xuaW1wb3J0IHtUYWJOYXZpZ2F0ZUN1cnNvcn0gZnJvbSAnLi9rZXlib2FyZF9uYXYvdGFiX25hdmlnYXRlX2N1cnNvci5qcyc7XG5pbXBvcnQge01hcmtlck1hbmFnZXJ9IGZyb20gJy4vbWFya2VyX21hbmFnZXIuanMnO1xuaW1wb3J0IHtNc2d9IGZyb20gJy4vbXNnLmpzJztcbmltcG9ydCB0eXBlIHtNdXRhdG9yfSBmcm9tICcuL211dGF0b3IuanMnO1xuaW1wb3J0IHtSZW5kZXJlZENvbm5lY3Rpb259IGZyb20gJy4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7RGVidWcgYXMgQmxvY2tSZW5kZXJpbmdEZWJ1Z30gZnJvbSAnLi9yZW5kZXJlcnMvY29tbW9uL2RlYnVnZ2VyLmpzJztcbmltcG9ydCB0eXBlIHtJUGF0aE9iamVjdH0gZnJvbSAnLi9yZW5kZXJlcnMvY29tbW9uL2lfcGF0aF9vYmplY3QuanMnO1xuaW1wb3J0ICogYXMgYmxvY2tzIGZyb20gJy4vc2VyaWFsaXphdGlvbi9ibG9ja3MuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3R5bGV9IGZyb20gJy4vdGhlbWUuanMnO1xuaW1wb3J0ICogYXMgVG9vbHRpcCBmcm9tICcuL3Rvb2x0aXAuanMnO1xuaW1wb3J0IHtDb29yZGluYXRlfSBmcm9tICcuL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7UmVjdH0gZnJvbSAnLi91dGlscy9yZWN0LmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuaW1wb3J0IHtXYXJuaW5nfSBmcm9tICcuL3dhcm5pbmcuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi93b3Jrc3BhY2UuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrJ3MgU1ZHIHJlcHJlc2VudGF0aW9uLlxuICogTm90IG5vcm1hbGx5IGNhbGxlZCBkaXJlY3RseSwgd29ya3NwYWNlLm5ld0Jsb2NrKCkgaXMgcHJlZmVycmVkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkJsb2NrU3ZnXG4gKi9cbmV4cG9ydCBjbGFzcyBCbG9ja1N2ZyBleHRlbmRzIEJsb2NrIGltcGxlbWVudHMgSUFTVE5vZGVMb2NhdGlvblN2ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSUJvdW5kZWRFbGVtZW50LCBJQ29weWFibGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElEcmFnZ2FibGUge1xuICAvKipcbiAgICogQ29uc3RhbnQgZm9yIGlkZW50aWZ5aW5nIHJvd3MgdGhhdCBhcmUgdG8gYmUgcmVuZGVyZWQgaW5saW5lLlxuICAgKiBEb24ndCBjb2xsaWRlIHdpdGggQmxvY2tseS5pbnB1dFR5cGVzLlxuICAgKi9cbiAgc3RhdGljIHJlYWRvbmx5IElOTElORSA9IC0xO1xuXG4gIC8qKlxuICAgKiBJRCB0byBnaXZlIHRoZSBcImNvbGxhcHNlZCB3YXJuaW5nc1wiIHdhcm5pbmcuIEFsbG93cyB1cyB0byByZW1vdmUgdGhlXG4gICAqIFwiY29sbGFwc2VkIHdhcm5pbmdzXCIgd2FybmluZyB3aXRob3V0IHJlbW92aW5nIGFueSB3YXJuaW5ncyB0aGF0IGJlbG9uZyB0b1xuICAgKiB0aGUgYmxvY2suXG4gICAqL1xuICBzdGF0aWMgcmVhZG9ubHkgQ09MTEFQU0VEX1dBUk5JTkdfSUQgPSAnVEVNUF9DT0xMQVBTRURfV0FSTklOR18nO1xuICBvdmVycmlkZSBkZWNvbXBvc2U/OiAoKHAxOiBXb3Jrc3BhY2UpID0+IEJsb2NrU3ZnKTtcbiAgLy8gb3ZlcnJpZGUgY29tcG9zZT86ICgocDE6IEJsb2NrU3ZnKSA9PiB2b2lkKXxudWxsO1xuICBzYXZlQ29ubmVjdGlvbnM/OiAoKHAxOiBCbG9ja1N2ZykgPT4gQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgY3VzdG9tQ29udGV4dE1lbnU/OlxuICAgICAgKChwMTogQXJyYXk8Q29udGV4dE1lbnVPcHRpb258TGVnYWN5Q29udGV4dE1lbnVPcHRpb24+KSA9PlxuICAgICAgICAgICBBbnlEdXJpbmdNaWdyYXRpb24pfG51bGw7XG5cbiAgLyoqXG4gICAqIEFuIHByb3BlcnR5IHVzZWQgaW50ZXJuYWxseSB0byByZWZlcmVuY2UgdGhlIGJsb2NrJ3MgcmVuZGVyaW5nIGRlYnVnZ2VyLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlbmRlcmluZ0RlYnVnZ2VyOiBCbG9ja1JlbmRlcmluZ0RlYnVnfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBIZWlnaHQgb2YgdGhpcyBibG9jaywgbm90IGluY2x1ZGluZyBhbnkgc3RhdGVtZW50IGJsb2NrcyBhYm92ZSBvciBiZWxvdy5cbiAgICogSGVpZ2h0IGlzIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICovXG4gIGhlaWdodCA9IDA7XG5cbiAgLyoqXG4gICAqIFdpZHRoIG9mIHRoaXMgYmxvY2ssIGluY2x1ZGluZyBhbnkgY29ubmVjdGVkIHZhbHVlIGJsb2Nrcy5cbiAgICogV2lkdGggaXMgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKi9cbiAgd2lkdGggPSAwO1xuXG4gIC8qKlxuICAgKiBNYXAgZnJvbSBJRHMgZm9yIHdhcm5pbmdzIHRleHQgdG8gUElEcyBvZiBmdW5jdGlvbnMgdG8gYXBwbHkgdGhlbS5cbiAgICogVXNlZCB0byBiZSBhYmxlIHRvIG1haW50YWluIG11bHRpcGxlIHdhcm5pbmdzLlxuICAgKi9cbiAgcHJpdmF0ZSB3YXJuaW5nVGV4dERiID0gbmV3IE1hcDxzdHJpbmcsIFJldHVyblR5cGU8dHlwZW9mIHNldFRpbWVvdXQ+PigpO1xuXG4gIC8qKiBCbG9jaydzIG11dGF0b3IgaWNvbiAoaWYgYW55KS4gKi9cbiAgbXV0YXRvcjogTXV0YXRvcnxudWxsID0gbnVsbDtcblxuICAvKiogQmxvY2sncyBjb21tZW50IGljb24gKGlmIGFueSkuICovXG4gIHByaXZhdGUgY29tbWVudEljb25fOiBDb21tZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBCbG9jaydzIHdhcm5pbmcgaWNvbiAoaWYgYW55KS4gKi9cbiAgd2FybmluZzogV2FybmluZ3xudWxsID0gbnVsbDtcblxuICBwcml2YXRlIHN2Z0dyb3VwXzogU1ZHR0VsZW1lbnQ7XG4gIHN0eWxlOiBCbG9ja1N0eWxlO1xuICAvKiogQGludGVybmFsICovXG4gIHBhdGhPYmplY3Q6IElQYXRoT2JqZWN0O1xuICBvdmVycmlkZSByZW5kZXJlZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJcyB0aGlzIGJsb2NrIGN1cnJlbnRseSByZW5kZXJpbmc/IFVzZWQgdG8gc3RvcCByZWN1cnNpdmUgcmVuZGVyIGNhbGxzXG4gICAqIGZyb20gYWN0dWFsbHkgdHJpZ2dlcmluZyBhIHJlLXJlbmRlci5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVySXNJblByb2dyZXNzXyA9IGZhbHNlO1xuXG4gIC8qKiBXaGV0aGVyIG1vdXNlZG93biBldmVudHMgaGF2ZSBiZWVuIGJvdW5kIHlldC4gKi9cbiAgcHJpdmF0ZSBldmVudHNJbml0XyA9IGZhbHNlO1xuXG4gIG92ZXJyaWRlIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBvdmVycmlkZSBvdXRwdXRDb25uZWN0aW9uITogUmVuZGVyZWRDb25uZWN0aW9uO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBvdmVycmlkZSBuZXh0Q29ubmVjdGlvbiE6IFJlbmRlcmVkQ29ubmVjdGlvbjtcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgb3ZlcnJpZGUgcHJldmlvdXNDb25uZWN0aW9uITogUmVuZGVyZWRDb25uZWN0aW9uO1xuICBwcml2YXRlIHJlYWRvbmx5IHVzZURyYWdTdXJmYWNlXzogYm9vbGVhbjtcblxuICAvKipcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgYmxvY2sncyB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSBwcm90b3R5cGVOYW1lIE5hbWUgb2YgdGhlIGxhbmd1YWdlIG9iamVjdCBjb250YWluaW5nIHR5cGUtc3BlY2lmaWNcbiAgICogICAgIGZ1bmN0aW9ucyBmb3IgdGhpcyBibG9jay5cbiAgICogQHBhcmFtIG9wdF9pZCBPcHRpb25hbCBJRC4gIFVzZSB0aGlzIElEIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3XG4gICAqICAgICBJRC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnLCBwcm90b3R5cGVOYW1lOiBzdHJpbmcsIG9wdF9pZD86IHN0cmluZykge1xuICAgIHN1cGVyKHdvcmtzcGFjZSwgcHJvdG90eXBlTmFtZSwgb3B0X2lkKTtcbiAgICB0aGlzLndvcmtzcGFjZSA9IHdvcmtzcGFjZTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9wdGlvbmFsIG1ldGhvZCBjYWxsZWQgd2hlbiBhIG11dGF0b3IgZGlhbG9nIGlzIGZpcnN0IG9wZW5lZC5cbiAgICAgKiBUaGlzIGZ1bmN0aW9uIG11c3QgY3JlYXRlIGFuZCBpbml0aWFsaXplIGEgdG9wLWxldmVsIGJsb2NrIGZvciB0aGVcbiAgICAgKiBtdXRhdG9yIGRpYWxvZywgYW5kIHJldHVybiBpdC4gVGhpcyBmdW5jdGlvbiBzaG91bGQgYWxzbyBwb3B1bGF0ZSB0aGlzXG4gICAgICogdG9wLWxldmVsIGJsb2NrIHdpdGggYW55IHN1Yi1ibG9ja3Mgd2hpY2ggYXJlIGFwcHJvcHJpYXRlLiBUaGlzIG1ldGhvZFxuICAgICAqIG11c3QgYWxzbyBiZSBjb3VwbGVkIHdpdGggZGVmaW5pbmcgYSBgY29tcG9zZWAgbWV0aG9kIGZvciB0aGUgZGVmYXVsdFxuICAgICAqIG11dGF0aW9uIGRpYWxvZyBidXR0b24gYW5kIFVJIHRvIGFwcGVhci5cbiAgICAgKi9cbiAgICB0aGlzLmRlY29tcG9zZSA9IHRoaXMuZGVjb21wb3NlO1xuXG4gICAgLyoqXG4gICAgICogQW4gb3B0aW9uYWwgbWV0aG9kIGNhbGxlZCB3aGVuIGEgbXV0YXRvciBkaWFsb2cgc2F2ZXMgaXRzIGNvbnRlbnQuXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgdG8gbW9kaWZ5IHRoZSBvcmlnaW5hbCBibG9jayBhY2NvcmRpbmcgdG8gbmV3XG4gICAgICogc2V0dGluZ3MuIFRoaXMgbWV0aG9kIG11c3QgYWxzbyBiZSBjb3VwbGVkIHdpdGggZGVmaW5pbmcgYSBgZGVjb21wb3NlYFxuICAgICAqIG1ldGhvZCBmb3IgdGhlIGRlZmF1bHQgbXV0YXRpb24gZGlhbG9nIGJ1dHRvbiBhbmQgVUkgdG8gYXBwZWFyLlxuICAgICAqL1xuICAgIHRoaXMuY29tcG9zZSA9IHRoaXMuY29tcG9zZTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9wdGlvbmFsIG1ldGhvZCBjYWxsZWQgYnkgdGhlIGRlZmF1bHQgbXV0YXRvciBVSSB3aGljaCBnaXZlcyB0aGUgYmxvY2tcbiAgICAgKiBhIGNoYW5jZSB0byBzYXZlIGluZm9ybWF0aW9uIGFib3V0IHdoYXQgY2hpbGQgYmxvY2tzIGFyZSBjb25uZWN0ZWQgdG9cbiAgICAgKiB3aGF0IG11dGF0ZWQgY29ubmVjdGlvbnMuXG4gICAgICovXG4gICAgdGhpcy5zYXZlQ29ubmVjdGlvbnMgPSB0aGlzLnNhdmVDb25uZWN0aW9ucztcblxuICAgIC8qKiBBbiBvcHRpb25hbCBtZXRob2QgZm9yIGRlZmluaW5nIGN1c3RvbSBibG9jayBjb250ZXh0IG1lbnUgaXRlbXMuICovXG4gICAgdGhpcy5jdXN0b21Db250ZXh0TWVudSA9IHRoaXMuY3VzdG9tQ29udGV4dE1lbnU7XG4gICAgdGhpcy5zdmdHcm91cF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuRywge30pO1xuICAgICh0aGlzLnN2Z0dyb3VwXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRyYW5zbGF0ZV8gPSAnJztcblxuICAgIC8qKiBBIGJsb2NrIHN0eWxlIG9iamVjdC4gKi9cbiAgICB0aGlzLnN0eWxlID0gd29ya3NwYWNlLmdldFJlbmRlcmVyKCkuZ2V0Q29uc3RhbnRzKCkuZ2V0QmxvY2tTdHlsZShudWxsKTtcblxuICAgIC8qKiBUaGUgcmVuZGVyZXIncyBwYXRoIG9iamVjdC4gKi9cbiAgICB0aGlzLnBhdGhPYmplY3QgPVxuICAgICAgICB3b3Jrc3BhY2UuZ2V0UmVuZGVyZXIoKS5tYWtlUGF0aE9iamVjdCh0aGlzLnN2Z0dyb3VwXywgdGhpcy5zdHlsZSk7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRvIG1vdmUgdGhlIGJsb2NrIHRvIHRoZSBkcmFnIHN1cmZhY2Ugd2hlbiBpdCBpcyBkcmFnZ2VkLlxuICAgICAqIFRydWUgaWYgaXQgc2hvdWxkIG1vdmUsIGZhbHNlIGlmIGl0IHNob3VsZCBiZSB0cmFuc2xhdGVkIGRpcmVjdGx5LlxuICAgICAqL1xuICAgIHRoaXMudXNlRHJhZ1N1cmZhY2VfID0gISF3b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpO1xuXG4gICAgY29uc3Qgc3ZnUGF0aCA9IHRoaXMucGF0aE9iamVjdC5zdmdQYXRoO1xuICAgIChzdmdQYXRoIGFzIEFueUR1cmluZ01pZ3JhdGlvbikudG9vbHRpcCA9IHRoaXM7XG4gICAgVG9vbHRpcC5iaW5kTW91c2VFdmVudHMoc3ZnUGF0aCk7XG5cbiAgICAvLyBFeHBvc2UgdGhpcyBibG9jaydzIElEIG9uIGl0cyB0b3AtbGV2ZWwgU1ZHIGdyb3VwLlxuICAgIHRoaXMuc3ZnR3JvdXBfLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIHRoaXMuaWQpO1xuXG4gICAgdGhpcy5kb0luaXRfKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTVkcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGJsb2NrLlxuICAgKiBNYXkgYmUgY2FsbGVkIG1vcmUgdGhhbiBvbmNlLlxuICAgKi9cbiAgaW5pdFN2ZygpIHtcbiAgICBpZiAoIXRoaXMud29ya3NwYWNlLnJlbmRlcmVkKSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ1dvcmtzcGFjZSBpcyBoZWFkbGVzcy4nKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDAsIGlucHV0OyBpbnB1dCA9IHRoaXMuaW5wdXRMaXN0W2ldOyBpKyspIHtcbiAgICAgIGlucHV0LmluaXQoKTtcbiAgICB9XG4gICAgY29uc3QgaWNvbnMgPSB0aGlzLmdldEljb25zKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpY29ucy5sZW5ndGg7IGkrKykge1xuICAgICAgaWNvbnNbaV0uY3JlYXRlSWNvbigpO1xuICAgIH1cbiAgICB0aGlzLmFwcGx5Q29sb3VyKCk7XG4gICAgdGhpcy5wYXRoT2JqZWN0LnVwZGF0ZU1vdmFibGUodGhpcy5pc01vdmFibGUoKSk7XG4gICAgY29uc3Qgc3ZnID0gdGhpcy5nZXRTdmdSb290KCk7XG4gICAgaWYgKCF0aGlzLndvcmtzcGFjZS5vcHRpb25zLnJlYWRPbmx5ICYmICF0aGlzLmV2ZW50c0luaXRfICYmIHN2Zykge1xuICAgICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgICAgc3ZnLCAncG9pbnRlcmRvd24nLCB0aGlzLCB0aGlzLm9uTW91c2VEb3duXyk7XG4gICAgfVxuICAgIHRoaXMuZXZlbnRzSW5pdF8gPSB0cnVlO1xuXG4gICAgaWYgKCFzdmcucGFyZW50Tm9kZSkge1xuICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0Q2FudmFzKCkuYXBwZW5kQ2hpbGQoc3ZnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzZWNvbmRhcnkgY29sb3VyIG9mIGEgYmxvY2suXG4gICAqXG4gICAqIEByZXR1cm5zICNSUkdHQkIgc3RyaW5nLlxuICAgKi9cbiAgZ2V0Q29sb3VyU2Vjb25kYXJ5KCk6IHN0cmluZ3x1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnN0eWxlLmNvbG91clNlY29uZGFyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRlcnRpYXJ5IGNvbG91ciBvZiBhIGJsb2NrLlxuICAgKlxuICAgKiBAcmV0dXJucyAjUlJHR0JCIHN0cmluZy5cbiAgICovXG4gIGdldENvbG91clRlcnRpYXJ5KCk6IHN0cmluZ3x1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnN0eWxlLmNvbG91clRlcnRpYXJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdHMgdGhpcyBibG9jay4gSGlnaGxpZ2h0cyB0aGUgYmxvY2sgdmlzdWFsbHkgYW5kIGZpcmVzIGEgc2VsZWN0IGV2ZW50XG4gICAqIGlmIHRoZSBibG9jayBpcyBub3QgYWxyZWFkeSBzZWxlY3RlZC5cbiAgICovXG4gIHNlbGVjdCgpIHtcbiAgICBpZiAodGhpcy5pc1NoYWRvdygpICYmIHRoaXMuZ2V0UGFyZW50KCkpIHtcbiAgICAgIC8vIFNoYWRvdyBibG9ja3Mgc2hvdWxkIG5vdCBiZSBzZWxlY3RlZC5cbiAgICAgIHRoaXMuZ2V0UGFyZW50KCkhLnNlbGVjdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29tbW9uLmdldFNlbGVjdGVkKCkgPT09IHRoaXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IG9sZElkID0gbnVsbDtcbiAgICBpZiAoY29tbW9uLmdldFNlbGVjdGVkKCkpIHtcbiAgICAgIG9sZElkID0gY29tbW9uLmdldFNlbGVjdGVkKCkhLmlkO1xuICAgICAgLy8gVW5zZWxlY3QgYW55IHByZXZpb3VzbHkgc2VsZWN0ZWQgYmxvY2suXG4gICAgICBldmVudFV0aWxzLmRpc2FibGUoKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbW1vbi5nZXRTZWxlY3RlZCgpIS51bnNlbGVjdCgpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgZXZlbnRVdGlscy5lbmFibGUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZXZlbnQgPSBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuU0VMRUNURUQpKShcbiAgICAgICAgb2xkSWQsIHRoaXMuaWQsIHRoaXMud29ya3NwYWNlLmlkKTtcbiAgICBldmVudFV0aWxzLmZpcmUoZXZlbnQpO1xuICAgIGNvbW1vbi5zZXRTZWxlY3RlZCh0aGlzKTtcbiAgICB0aGlzLmFkZFNlbGVjdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuc2VsZWN0cyB0aGlzIGJsb2NrLiBVbmhpZ2hsaWdodHMgdGhlIGJsb2NrIGFuZCBmaXJlcyBhIHNlbGVjdCAoZmFsc2UpXG4gICAqIGV2ZW50IGlmIHRoZSBibG9jayBpcyBjdXJyZW50bHkgc2VsZWN0ZWQuXG4gICAqL1xuICB1bnNlbGVjdCgpIHtcbiAgICBpZiAoY29tbW9uLmdldFNlbGVjdGVkKCkgIT09IHRoaXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZXZlbnQgPSBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuU0VMRUNURUQpKShcbiAgICAgICAgdGhpcy5pZCwgbnVsbCwgdGhpcy53b3Jrc3BhY2UuaWQpO1xuICAgIGV2ZW50LndvcmtzcGFjZUlkID0gdGhpcy53b3Jrc3BhY2UuaWQ7XG4gICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgICBjb21tb24uc2V0U2VsZWN0ZWQobnVsbCk7XG4gICAgdGhpcy5yZW1vdmVTZWxlY3QoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbGlzdCBvZiBtdXRhdG9yLCBjb21tZW50LCBhbmQgd2FybmluZyBpY29ucy5cbiAgICpcbiAgICogQHJldHVybnMgTGlzdCBvZiBpY29ucy5cbiAgICovXG4gIGdldEljb25zKCk6IEljb25bXSB7XG4gICAgY29uc3QgaWNvbnMgPSBbXTtcbiAgICBpZiAodGhpcy5tdXRhdG9yKSB7XG4gICAgICBpY29ucy5wdXNoKHRoaXMubXV0YXRvcik7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbW1lbnRJY29uXykge1xuICAgICAgaWNvbnMucHVzaCh0aGlzLmNvbW1lbnRJY29uXyk7XG4gICAgfVxuICAgIGlmICh0aGlzLndhcm5pbmcpIHtcbiAgICAgIGljb25zLnB1c2godGhpcy53YXJuaW5nKTtcbiAgICB9XG4gICAgcmV0dXJuIGljb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHBhcmVudCBvZiB0aGlzIGJsb2NrIHRvIGJlIGEgbmV3IGJsb2NrIG9yIG51bGwuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdQYXJlbnQgTmV3IHBhcmVudCBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBzZXRQYXJlbnQobmV3UGFyZW50OiB0aGlzfG51bGwpIHtcbiAgICBjb25zdCBvbGRQYXJlbnQgPSB0aGlzLnBhcmVudEJsb2NrXztcbiAgICBpZiAobmV3UGFyZW50ID09PSBvbGRQYXJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBkb20uc3RhcnRUZXh0V2lkdGhDYWNoZSgpO1xuICAgIHN1cGVyLnNldFBhcmVudChuZXdQYXJlbnQpO1xuICAgIGRvbS5zdG9wVGV4dFdpZHRoQ2FjaGUoKTtcblxuICAgIGNvbnN0IHN2Z1Jvb3QgPSB0aGlzLmdldFN2Z1Jvb3QoKTtcblxuICAgIC8vIEJhaWwgZWFybHkgaWYgd29ya3NwYWNlIGlzIGNsZWFyaW5nLCBvciB3ZSBhcmVuJ3QgcmVuZGVyZWQuXG4gICAgLy8gV2Ugd29uJ3QgbmVlZCB0byByZWF0dGFjaCBvdXJzZWx2ZXMgYW55d2hlcmUuXG4gICAgaWYgKHRoaXMud29ya3NwYWNlLmlzQ2xlYXJpbmcgfHwgIXN2Z1Jvb3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBvbGRYWSA9IHRoaXMuZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgIGlmIChuZXdQYXJlbnQpIHtcbiAgICAgIChuZXdQYXJlbnQgYXMgQmxvY2tTdmcpLmdldFN2Z1Jvb3QoKS5hcHBlbmRDaGlsZChzdmdSb290KTtcbiAgICAgIGNvbnN0IG5ld1hZID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgICAvLyBNb3ZlIHRoZSBjb25uZWN0aW9ucyB0byBtYXRjaCB0aGUgY2hpbGQncyBuZXcgcG9zaXRpb24uXG4gICAgICB0aGlzLm1vdmVDb25uZWN0aW9ucyhuZXdYWS54IC0gb2xkWFkueCwgbmV3WFkueSAtIG9sZFhZLnkpO1xuICAgIH0gZWxzZSBpZiAob2xkUGFyZW50KSB7XG4gICAgICAvLyBJZiB3ZSBhcmUgbG9zaW5nIGEgcGFyZW50LCB3ZSB3YW50IHRvIG1vdmUgb3VyIERPTSBlbGVtZW50IHRvIHRoZVxuICAgICAgLy8gcm9vdCBvZiB0aGUgd29ya3NwYWNlLlxuICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0Q2FudmFzKCkuYXBwZW5kQ2hpbGQoc3ZnUm9vdCk7XG4gICAgICB0aGlzLnRyYW5zbGF0ZShvbGRYWS54LCBvbGRYWS55KTtcbiAgICB9XG5cbiAgICB0aGlzLmFwcGx5Q29sb3VyKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgdG9wLWxlZnQgY29ybmVyIG9mIHRoaXMgYmxvY2sgcmVsYXRpdmUgdG8gdGhlXG4gICAqIGRyYXdpbmcgc3VyZmFjZSdzIG9yaWdpbiAoMCwwKSwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBJZiB0aGUgYmxvY2sgaXMgb24gdGhlIHdvcmtzcGFjZSwgKDAsIDApIGlzIHRoZSBvcmlnaW4gb2YgdGhlIHdvcmtzcGFjZVxuICAgKiBjb29yZGluYXRlIHN5c3RlbS5cbiAgICogVGhpcyBkb2VzIG5vdCBjaGFuZ2Ugd2l0aCB3b3Jrc3BhY2Ugc2NhbGUuXG4gICAqXG4gICAqIEByZXR1cm5zIE9iamVjdCB3aXRoIC54IGFuZCAueSBwcm9wZXJ0aWVzIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICovXG4gIG92ZXJyaWRlIGdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTogQ29vcmRpbmF0ZSB7XG4gICAgbGV0IHggPSAwO1xuICAgIGxldCB5ID0gMDtcblxuICAgIGNvbnN0IGRyYWdTdXJmYWNlR3JvdXAgPSB0aGlzLnVzZURyYWdTdXJmYWNlXyA/XG4gICAgICAgIHRoaXMud29ya3NwYWNlLmdldEJsb2NrRHJhZ1N1cmZhY2UoKSEuZ2V0R3JvdXAoKSA6XG4gICAgICAgIG51bGw7XG5cbiAgICBsZXQgZWxlbWVudDogU1ZHRWxlbWVudCA9IHRoaXMuZ2V0U3ZnUm9vdCgpO1xuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICBkbyB7XG4gICAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGlzIGJsb2NrIGFuZCBldmVyeSBwYXJlbnQuXG4gICAgICAgIGNvbnN0IHh5ID0gc3ZnTWF0aC5nZXRSZWxhdGl2ZVhZKGVsZW1lbnQpO1xuICAgICAgICB4ICs9IHh5Lng7XG4gICAgICAgIHkgKz0geHkueTtcbiAgICAgICAgLy8gSWYgdGhpcyBlbGVtZW50IGlzIHRoZSBjdXJyZW50IGVsZW1lbnQgb24gdGhlIGRyYWcgc3VyZmFjZSwgaW5jbHVkZVxuICAgICAgICAvLyB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIGRyYWcgc3VyZmFjZSBpdHNlbGYuXG4gICAgICAgIGlmICh0aGlzLnVzZURyYWdTdXJmYWNlXyAmJlxuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpIS5nZXRDdXJyZW50QmxvY2soKSA9PT1cbiAgICAgICAgICAgICAgICBlbGVtZW50KSB7XG4gICAgICAgICAgY29uc3Qgc3VyZmFjZVRyYW5zbGF0aW9uID1cbiAgICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpIS5nZXRTdXJmYWNlVHJhbnNsYXRpb24oKTtcbiAgICAgICAgICB4ICs9IHN1cmZhY2VUcmFuc2xhdGlvbi54O1xuICAgICAgICAgIHkgKz0gc3VyZmFjZVRyYW5zbGF0aW9uLnk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSBhcyBTVkdFbGVtZW50O1xuICAgICAgfSB3aGlsZSAoZWxlbWVudCAmJiBlbGVtZW50ICE9PSB0aGlzLndvcmtzcGFjZS5nZXRDYW52YXMoKSAmJlxuICAgICAgICAgICAgICAgZWxlbWVudCAhPT0gZHJhZ1N1cmZhY2VHcm91cCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQ29vcmRpbmF0ZSh4LCB5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgYmxvY2sgYnkgYSByZWxhdGl2ZSBvZmZzZXQuXG4gICAqXG4gICAqIEBwYXJhbSBkeCBIb3Jpem9udGFsIG9mZnNldCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBwYXJhbSBkeSBWZXJ0aWNhbCBvZmZzZXQgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKi9cbiAgb3ZlcnJpZGUgbW92ZUJ5KGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5wYXJlbnRCbG9ja18pIHtcbiAgICAgIHRocm93IEVycm9yKCdCbG9jayBoYXMgcGFyZW50LicpO1xuICAgIH1cbiAgICBjb25zdCBldmVudHNFbmFibGVkID0gZXZlbnRVdGlscy5pc0VuYWJsZWQoKTtcbiAgICBsZXQgZXZlbnQ6IEJsb2NrTW92ZXxudWxsID0gbnVsbDtcbiAgICBpZiAoZXZlbnRzRW5hYmxlZCkge1xuICAgICAgZXZlbnQgPSBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuQkxPQ0tfTU9WRSkpISh0aGlzKSBhcyBCbG9ja01vdmU7XG4gICAgfVxuICAgIGNvbnN0IHh5ID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgdGhpcy50cmFuc2xhdGUoeHkueCArIGR4LCB4eS55ICsgZHkpO1xuICAgIHRoaXMubW92ZUNvbm5lY3Rpb25zKGR4LCBkeSk7XG4gICAgaWYgKGV2ZW50c0VuYWJsZWQgJiYgZXZlbnQpIHtcbiAgICAgIGV2ZW50IS5yZWNvcmROZXcoKTtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShldmVudCk7XG4gICAgfVxuICAgIHRoaXMud29ya3NwYWNlLnJlc2l6ZUNvbnRlbnRzKCk7XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNmb3JtcyBhIGJsb2NrIGJ5IHNldHRpbmcgdGhlIHRyYW5zbGF0aW9uIG9uIHRoZSB0cmFuc2Zvcm0gYXR0cmlidXRlXG4gICAqIG9mIHRoZSBibG9jaydzIFNWRy5cbiAgICpcbiAgICogQHBhcmFtIHggVGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgdHJhbnNsYXRpb24gaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0geSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSB0cmFuc2xhdGlvbiBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICB0cmFuc2xhdGUoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICB0aGlzLmdldFN2Z1Jvb3QoKS5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyB4ICsgJywnICsgeSArICcpJyk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGlzIGJsb2NrIHRvIGl0cyB3b3Jrc3BhY2UncyBkcmFnIHN1cmZhY2UsIGFjY291bnRpbmcgZm9yXG4gICAqIHBvc2l0aW9uaW5nLiBHZW5lcmFsbHkgc2hvdWxkIGJlIGNhbGxlZCBhdCB0aGUgc2FtZSB0aW1lIGFzXG4gICAqIHNldERyYWdnaW5nXyh0cnVlKS4gRG9lcyBub3RoaW5nIGlmIHVzZURyYWdTdXJmYWNlXyBpcyBmYWxzZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBtb3ZlVG9EcmFnU3VyZmFjZSgpIHtcbiAgICBpZiAoIXRoaXMudXNlRHJhZ1N1cmZhY2VfKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFRoZSB0cmFuc2xhdGlvbiBmb3IgZHJhZyBzdXJmYWNlIGJsb2NrcyxcbiAgICAvLyBpcyBlcXVhbCB0byB0aGUgY3VycmVudCByZWxhdGl2ZS10by1zdXJmYWNlIHBvc2l0aW9uLFxuICAgIC8vIHRvIGtlZXAgdGhlIHBvc2l0aW9uIGluIHN5bmMgYXMgaXQgbW92ZSBvbi9vZmYgdGhlIHN1cmZhY2UuXG4gICAgLy8gVGhpcyBpcyBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAgY29uc3QgeHkgPSB0aGlzLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcbiAgICB0aGlzLmNsZWFyVHJhbnNmb3JtQXR0cmlidXRlc18oKTtcbiAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0RyYWdTdXJmYWNlKCkhLnRyYW5zbGF0ZVN1cmZhY2UoeHkueCwgeHkueSk7XG4gICAgLy8gRXhlY3V0ZSB0aGUgbW92ZSBvbiB0aGUgdG9wLWxldmVsIFNWRyBjb21wb25lbnRcbiAgICBjb25zdCBzdmcgPSB0aGlzLmdldFN2Z1Jvb3QoKTtcbiAgICBpZiAoc3ZnKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZS5nZXRCbG9ja0RyYWdTdXJmYWNlKCkhLnNldEJsb2Nrc0FuZFNob3coc3ZnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhIGJsb2NrIHRvIGEgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB4eSBUaGUgcG9zaXRpb24gdG8gbW92ZSB0byBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBtb3ZlVG8oeHk6IENvb3JkaW5hdGUpIHtcbiAgICBjb25zdCBjdXJYWSA9IHRoaXMuZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgIHRoaXMubW92ZUJ5KHh5LnggLSBjdXJYWS54LCB4eS55IC0gY3VyWFkueSk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGlzIGJsb2NrIGJhY2sgdG8gdGhlIHdvcmtzcGFjZSBibG9jayBjYW52YXMuXG4gICAqIEdlbmVyYWxseSBzaG91bGQgYmUgY2FsbGVkIGF0IHRoZSBzYW1lIHRpbWUgYXMgc2V0RHJhZ2dpbmdfKGZhbHNlKS5cbiAgICogRG9lcyBub3RoaW5nIGlmIHVzZURyYWdTdXJmYWNlXyBpcyBmYWxzZS5cbiAgICpcbiAgICogQHBhcmFtIG5ld1hZIFRoZSBwb3NpdGlvbiB0aGUgYmxvY2sgc2hvdWxkIHRha2Ugb24gb24gdGhlIHdvcmtzcGFjZSBjYW52YXMsXG4gICAqICAgICBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbW92ZU9mZkRyYWdTdXJmYWNlKG5ld1hZOiBDb29yZGluYXRlKSB7XG4gICAgaWYgKCF0aGlzLnVzZURyYWdTdXJmYWNlXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBUcmFuc2xhdGUgdG8gY3VycmVudCBwb3NpdGlvbiwgdHVybmluZyBvZmYgM2QuXG4gICAgdGhpcy50cmFuc2xhdGUobmV3WFkueCwgbmV3WFkueSk7XG4gICAgdGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpIS5jbGVhckFuZEhpZGUoXG4gICAgICAgIHRoaXMud29ya3NwYWNlLmdldENhbnZhcygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoaXMgYmxvY2sgZHVyaW5nIGEgZHJhZywgdGFraW5nIGludG8gYWNjb3VudCB3aGV0aGVyIHdlIGFyZSB1c2luZyBhXG4gICAqIGRyYWcgc3VyZmFjZSB0byB0cmFuc2xhdGUgYmxvY2tzLlxuICAgKiBUaGlzIGJsb2NrIG11c3QgYmUgYSB0b3AtbGV2ZWwgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBuZXdMb2MgVGhlIGxvY2F0aW9uIHRvIHRyYW5zbGF0ZSB0bywgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1vdmVEdXJpbmdEcmFnKG5ld0xvYzogQ29vcmRpbmF0ZSkge1xuICAgIGlmICh0aGlzLnVzZURyYWdTdXJmYWNlXykge1xuICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpIS50cmFuc2xhdGVTdXJmYWNlKFxuICAgICAgICAgIG5ld0xvYy54LCBuZXdMb2MueSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICh0aGlzLnN2Z0dyb3VwXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnRyYW5zbGF0ZV8gPVxuICAgICAgICAgICd0cmFuc2xhdGUoJyArIG5ld0xvYy54ICsgJywnICsgbmV3TG9jLnkgKyAnKSc7XG4gICAgICAodGhpcy5zdmdHcm91cF8gYXMgQW55RHVyaW5nTWlncmF0aW9uKVxuICAgICAgICAgIC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAgICAgICAodGhpcy5zdmdHcm91cF8gYXMgQW55RHVyaW5nTWlncmF0aW9uKS50cmFuc2xhdGVfICtcbiAgICAgICAgICAgICAgICAgICh0aGlzLnN2Z0dyb3VwXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnNrZXdfKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgdGhlIGJsb2NrIG9mIHRyYW5zZm9ybT1cIi4uLlwiIGF0dHJpYnV0ZXMuXG4gICAqIFVzZWQgd2hlbiB0aGUgYmxvY2sgaXMgc3dpdGNoaW5nIGZyb20gM2QgdG8gMmQgdHJhbnNmb3JtIG9yIHZpY2UgdmVyc2EuXG4gICAqL1xuICBwcml2YXRlIGNsZWFyVHJhbnNmb3JtQXR0cmlidXRlc18oKSB7XG4gICAgdGhpcy5nZXRTdmdSb290KCkucmVtb3ZlQXR0cmlidXRlKCd0cmFuc2Zvcm0nKTtcbiAgfVxuXG4gIC8qKiBTbmFwIHRoaXMgYmxvY2sgdG8gdGhlIG5lYXJlc3QgZ3JpZCBwb2ludC4gKi9cbiAgc25hcFRvR3JpZCgpIHtcbiAgICBpZiAodGhpcy5pc0RlYWRPckR5aW5nKCkpIHtcbiAgICAgIHJldHVybjsgIC8vIERlbGV0ZWQgYmxvY2suXG4gICAgfVxuICAgIGlmICh0aGlzLndvcmtzcGFjZS5pc0RyYWdnaW5nKCkpIHtcbiAgICAgIHJldHVybjsgIC8vIERvbid0IGJ1bXAgYmxvY2tzIGR1cmluZyBhIGRyYWcuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmdldFBhcmVudCgpKSB7XG4gICAgICByZXR1cm47ICAvLyBPbmx5IHNuYXAgdG9wLWxldmVsIGJsb2Nrcy5cbiAgICB9XG4gICAgaWYgKHRoaXMuaXNJbkZseW91dCkge1xuICAgICAgcmV0dXJuOyAgLy8gRG9uJ3QgbW92ZSBibG9ja3MgYXJvdW5kIGluIGEgZmx5b3V0LlxuICAgIH1cbiAgICBjb25zdCBncmlkID0gdGhpcy53b3Jrc3BhY2UuZ2V0R3JpZCgpO1xuICAgIGlmICghZ3JpZCB8fCAhZ3JpZC5zaG91bGRTbmFwKCkpIHtcbiAgICAgIHJldHVybjsgIC8vIENvbmZpZyBzYXlzIG5vIHNuYXBwaW5nLlxuICAgIH1cbiAgICBjb25zdCBzcGFjaW5nID0gZ3JpZC5nZXRTcGFjaW5nKCk7XG4gICAgY29uc3QgaGFsZiA9IHNwYWNpbmcgLyAyO1xuICAgIGNvbnN0IHh5ID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgY29uc3QgZHggPVxuICAgICAgICBNYXRoLnJvdW5kKE1hdGgucm91bmQoKHh5LnggLSBoYWxmKSAvIHNwYWNpbmcpICogc3BhY2luZyArIGhhbGYgLSB4eS54KTtcbiAgICBjb25zdCBkeSA9XG4gICAgICAgIE1hdGgucm91bmQoTWF0aC5yb3VuZCgoeHkueSAtIGhhbGYpIC8gc3BhY2luZykgKiBzcGFjaW5nICsgaGFsZiAtIHh5LnkpO1xuICAgIGlmIChkeCB8fCBkeSkge1xuICAgICAgdGhpcy5tb3ZlQnkoZHgsIGR5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY29vcmRpbmF0ZXMgb2YgYSBib3VuZGluZyBib3ggZGVzY3JpYmluZyB0aGUgZGltZW5zaW9ucyBvZiB0aGlzXG4gICAqIGJsb2NrIGFuZCBhbnkgYmxvY2tzIHN0YWNrZWQgYmVsb3cgaXQuXG4gICAqIENvb3JkaW5hdGUgc3lzdGVtOiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqXG4gICAqIEByZXR1cm5zIE9iamVjdCB3aXRoIGNvb3JkaW5hdGVzIG9mIHRoZSBib3VuZGluZyBib3guXG4gICAqL1xuICBnZXRCb3VuZGluZ1JlY3RhbmdsZSgpOiBSZWN0IHtcbiAgICBjb25zdCBibG9ja1hZID0gdGhpcy5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgY29uc3QgYmxvY2tCb3VuZHMgPSB0aGlzLmdldEhlaWdodFdpZHRoKCk7XG4gICAgbGV0IGxlZnQ7XG4gICAgbGV0IHJpZ2h0O1xuICAgIGlmICh0aGlzLlJUTCkge1xuICAgICAgbGVmdCA9IGJsb2NrWFkueCAtIGJsb2NrQm91bmRzLndpZHRoO1xuICAgICAgcmlnaHQgPSBibG9ja1hZLng7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxlZnQgPSBibG9ja1hZLng7XG4gICAgICByaWdodCA9IGJsb2NrWFkueCArIGJsb2NrQm91bmRzLndpZHRoO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFJlY3QoYmxvY2tYWS55LCBibG9ja1hZLnkgKyBibG9ja0JvdW5kcy5oZWlnaHQsIGxlZnQsIHJpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOb3RpZnkgZXZlcnkgaW5wdXQgb24gdGhpcyBibG9jayB0byBtYXJrIGl0cyBmaWVsZHMgYXMgZGlydHkuXG4gICAqIEEgZGlydHkgZmllbGQgaXMgYSBmaWVsZCB0aGF0IG5lZWRzIHRvIGJlIHJlLXJlbmRlcmVkLlxuICAgKi9cbiAgbWFya0RpcnR5KCkge1xuICAgIHRoaXMucGF0aE9iamVjdC5jb25zdGFudHMgPSB0aGlzLndvcmtzcGFjZS5nZXRSZW5kZXJlcigpLmdldENvbnN0YW50cygpO1xuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsgaSsrKSB7XG4gICAgICBpbnB1dC5tYXJrRGlydHkoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhlIGJsb2NrIGlzIGNvbGxhcHNlZCBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBjb2xsYXBzZWQgVHJ1ZSBpZiBjb2xsYXBzZWQuXG4gICAqL1xuICBvdmVycmlkZSBzZXRDb2xsYXBzZWQoY29sbGFwc2VkOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuY29sbGFwc2VkXyA9PT0gY29sbGFwc2VkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN1cGVyLnNldENvbGxhcHNlZChjb2xsYXBzZWQpO1xuICAgIGlmICghY29sbGFwc2VkKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNvbGxhcHNlZF8oKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAvLyBEb24ndCBidW1wIG5laWdoYm91cnMuIFVzZXJzIGxpa2UgdG8gc3RvcmUgY29sbGFwc2VkIGZ1bmN0aW9ucyB0b2dldGhlclxuICAgICAgLy8gYW5kIGJ1bXBpbmcgbWFrZXMgdGhlbSBnbyBvdXQgb2YgYWxpZ25tZW50LlxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlcyBzdXJlIHRoYXQgd2hlbiB0aGUgYmxvY2sgaXMgY29sbGFwc2VkLCBpdCBpcyByZW5kZXJlZCBjb3JyZWN0bHlcbiAgICogZm9yIHRoYXQgc3RhdGUuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZUNvbGxhcHNlZF8oKSB7XG4gICAgY29uc3QgY29sbGFwc2VkID0gdGhpcy5pc0NvbGxhcHNlZCgpO1xuICAgIGNvbnN0IGNvbGxhcHNlZElucHV0TmFtZSA9IGNvbnN0YW50cy5DT0xMQVBTRURfSU5QVVRfTkFNRTtcbiAgICBjb25zdCBjb2xsYXBzZWRGaWVsZE5hbWUgPSBjb25zdGFudHMuQ09MTEFQU0VEX0ZJRUxEX05BTUU7XG5cbiAgICBmb3IgKGxldCBpID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgaWYgKGlucHV0Lm5hbWUgIT09IGNvbGxhcHNlZElucHV0TmFtZSkge1xuICAgICAgICBpbnB1dC5zZXRWaXNpYmxlKCFjb2xsYXBzZWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghY29sbGFwc2VkKSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc2FibGVkKCk7XG4gICAgICB0aGlzLnJlbW92ZUlucHV0KGNvbGxhcHNlZElucHV0TmFtZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaWNvbnMgPSB0aGlzLmdldEljb25zKCk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGljb247IGljb24gPSBpY29uc1tpXTsgaSsrKSB7XG4gICAgICBpY29uLnNldFZpc2libGUoZmFsc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IHRleHQgPSB0aGlzLnRvU3RyaW5nKGludGVybmFsQ29uc3RhbnRzLkNPTExBUFNFX0NIQVJTKTtcbiAgICBjb25zdCBmaWVsZCA9IHRoaXMuZ2V0RmllbGQoY29sbGFwc2VkRmllbGROYW1lKTtcbiAgICBpZiAoZmllbGQpIHtcbiAgICAgIGZpZWxkLnNldFZhbHVlKHRleHQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBpbnB1dCA9IHRoaXMuZ2V0SW5wdXQoY29sbGFwc2VkSW5wdXROYW1lKSB8fFxuICAgICAgICB0aGlzLmFwcGVuZER1bW15SW5wdXQoY29sbGFwc2VkSW5wdXROYW1lKTtcbiAgICBpbnB1dC5hcHBlbmRGaWVsZChuZXcgRmllbGRMYWJlbCh0ZXh0KSwgY29sbGFwc2VkRmllbGROYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuIHRoZSBuZXh0IChvciBwcmV2aW91cykgRmllbGRUZXh0SW5wdXQuXG4gICAqXG4gICAqIEBwYXJhbSBzdGFydCBDdXJyZW50IGZpZWxkLlxuICAgKiBAcGFyYW0gZm9yd2FyZCBJZiB0cnVlIGdvIGZvcndhcmQsIG90aGVyd2lzZSBiYWNrd2FyZC5cbiAgICovXG4gIHRhYihzdGFydDogRmllbGQsIGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB0YWJDdXJzb3IgPSBuZXcgVGFiTmF2aWdhdGVDdXJzb3IoKTtcbiAgICB0YWJDdXJzb3Iuc2V0Q3VyTm9kZShBU1ROb2RlLmNyZWF0ZUZpZWxkTm9kZShzdGFydCkhKTtcbiAgICBjb25zdCBjdXJyZW50Tm9kZSA9IHRhYkN1cnNvci5nZXRDdXJOb2RlKCk7XG5cbiAgICBpZiAoZm9yd2FyZCkge1xuICAgICAgdGFiQ3Vyc29yLm5leHQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFiQ3Vyc29yLnByZXYoKTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXh0Tm9kZSA9IHRhYkN1cnNvci5nZXRDdXJOb2RlKCk7XG4gICAgaWYgKG5leHROb2RlICYmIG5leHROb2RlICE9PSBjdXJyZW50Tm9kZSkge1xuICAgICAgY29uc3QgbmV4dEZpZWxkID0gbmV4dE5vZGUuZ2V0TG9jYXRpb24oKSBhcyBGaWVsZDtcbiAgICAgIG5leHRGaWVsZC5zaG93RWRpdG9yKCk7XG5cbiAgICAgIC8vIEFsc28gbW92ZSB0aGUgY3Vyc29yIGlmIHdlJ3JlIGluIGtleWJvYXJkIG5hdiBtb2RlLlxuICAgICAgaWYgKHRoaXMud29ya3NwYWNlLmtleWJvYXJkQWNjZXNzaWJpbGl0eU1vZGUpIHtcbiAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0Q3Vyc29yKCkhLnNldEN1ck5vZGUobmV4dE5vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVyZG93biBvbiBhbiBTVkcgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25Nb3VzZURvd25fKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGNvbnN0IGdlc3R1cmUgPSB0aGlzLndvcmtzcGFjZS5nZXRHZXN0dXJlKGUpO1xuICAgIGlmIChnZXN0dXJlKSB7XG4gICAgICBnZXN0dXJlLmhhbmRsZUJsb2NrU3RhcnQoZSwgdGhpcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgdGhlIGJsb2NrJ3MgaGVscCBwYWdlIGluIGEgbmV3IHdpbmRvdy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzaG93SGVscCgpIHtcbiAgICBjb25zdCB1cmwgPVxuICAgICAgICB0eXBlb2YgdGhpcy5oZWxwVXJsID09PSAnZnVuY3Rpb24nID8gdGhpcy5oZWxwVXJsKCkgOiB0aGlzLmhlbHBVcmw7XG4gICAgaWYgKHVybCkge1xuICAgICAgd2luZG93Lm9wZW4odXJsKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdGhlIGNvbnRleHQgbWVudSBmb3IgdGhpcyBibG9jay5cbiAgICpcbiAgICogQHJldHVybnMgQ29udGV4dCBtZW51IG9wdGlvbnMgb3IgbnVsbCBpZiBubyBtZW51LlxuICAgKi9cbiAgcHJvdGVjdGVkIGdlbmVyYXRlQ29udGV4dE1lbnUoKTpcbiAgICAgIEFycmF5PENvbnRleHRNZW51T3B0aW9ufExlZ2FjeUNvbnRleHRNZW51T3B0aW9uPnxudWxsIHtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2Uub3B0aW9ucy5yZWFkT25seSB8fCAhdGhpcy5jb250ZXh0TWVudSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAneyBibG9jazogdGhpczsgfScgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnU2NvcGUnLlxuICAgIGNvbnN0IG1lbnVPcHRpb25zID0gQ29udGV4dE1lbnVSZWdpc3RyeS5yZWdpc3RyeS5nZXRDb250ZXh0TWVudU9wdGlvbnMoXG4gICAgICAgIENvbnRleHRNZW51UmVnaXN0cnkuU2NvcGVUeXBlLkJMT0NLLFxuICAgICAgICB7YmxvY2s6IHRoaXN9IGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG5cbiAgICAvLyBBbGxvdyB0aGUgYmxvY2sgdG8gYWRkIG9yIG1vZGlmeSBtZW51T3B0aW9ucy5cbiAgICBpZiAodGhpcy5jdXN0b21Db250ZXh0TWVudSkge1xuICAgICAgdGhpcy5jdXN0b21Db250ZXh0TWVudShtZW51T3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1lbnVPcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgdGhlIGNvbnRleHQgbWVudSBmb3IgdGhpcyBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2UgZXZlbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2hvd0NvbnRleHRNZW51KGU6IEV2ZW50KSB7XG4gICAgY29uc3QgbWVudU9wdGlvbnMgPSB0aGlzLmdlbmVyYXRlQ29udGV4dE1lbnUoKTtcblxuICAgIGlmIChtZW51T3B0aW9ucyAmJiBtZW51T3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgIENvbnRleHRNZW51LnNob3coZSwgbWVudU9wdGlvbnMsIHRoaXMuUlRMKTtcbiAgICAgIENvbnRleHRNZW51LnNldEN1cnJlbnRCbG9jayh0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgY29ubmVjdGlvbnMgZm9yIHRoaXMgYmxvY2sgYW5kIGFsbCBibG9ja3MgYXR0YWNoZWQgdW5kZXIgaXQuXG4gICAqIEFsc28gdXBkYXRlIGFueSBhdHRhY2hlZCBidWJibGVzLlxuICAgKlxuICAgKiBAcGFyYW0gZHggSG9yaXpvbnRhbCBvZmZzZXQgZnJvbSBjdXJyZW50IGxvY2F0aW9uLCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBwYXJhbSBkeSBWZXJ0aWNhbCBvZmZzZXQgZnJvbSBjdXJyZW50IGxvY2F0aW9uLCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbW92ZUNvbm5lY3Rpb25zKGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcbiAgICBpZiAoIXRoaXMucmVuZGVyZWQpIHtcbiAgICAgIC8vIFJlbmRlcmluZyBpcyByZXF1aXJlZCB0byBsYXkgb3V0IHRoZSBibG9ja3MuXG4gICAgICAvLyBUaGlzIGlzIHByb2JhYmx5IGFuIGludmlzaWJsZSBibG9jayBhdHRhY2hlZCB0byBhIGNvbGxhcHNlZCBibG9jay5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbXlDb25uZWN0aW9ucyA9IHRoaXMuZ2V0Q29ubmVjdGlvbnNfKGZhbHNlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG15Q29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIG15Q29ubmVjdGlvbnNbaV0ubW92ZUJ5KGR4LCBkeSk7XG4gICAgfVxuICAgIGNvbnN0IGljb25zID0gdGhpcy5nZXRJY29ucygpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWNvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGljb25zW2ldLmNvbXB1dGVJY29uTG9jYXRpb24oKTtcbiAgICB9XG5cbiAgICAvLyBSZWN1cnNlIHRocm91Z2ggYWxsIGJsb2NrcyBhdHRhY2hlZCB1bmRlciB0aGlzIG9uZS5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2hpbGRCbG9ja3NfLmxlbmd0aDsgaSsrKSB7XG4gICAgICAodGhpcy5jaGlsZEJsb2Nrc19baV0gYXMgQmxvY2tTdmcpLm1vdmVDb25uZWN0aW9ucyhkeCwgZHkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWN1cnNpdmVseSBhZGRzIG9yIHJlbW92ZXMgdGhlIGRyYWdnaW5nIGNsYXNzIHRvIHRoaXMgbm9kZSBhbmQgaXRzXG4gICAqIGNoaWxkcmVuLlxuICAgKlxuICAgKiBAcGFyYW0gYWRkaW5nIFRydWUgaWYgYWRkaW5nLCBmYWxzZSBpZiByZW1vdmluZy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXREcmFnZ2luZyhhZGRpbmc6IGJvb2xlYW4pIHtcbiAgICBpZiAoYWRkaW5nKSB7XG4gICAgICBjb25zdCBncm91cCA9IHRoaXMuZ2V0U3ZnUm9vdCgpO1xuICAgICAgKGdyb3VwIGFzIEFueUR1cmluZ01pZ3JhdGlvbikudHJhbnNsYXRlXyA9ICcnO1xuICAgICAgKGdyb3VwIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc2tld18gPSAnJztcbiAgICAgIGNvbW1vbi5kcmFnZ2luZ0Nvbm5lY3Rpb25zLnB1c2goLi4udGhpcy5nZXRDb25uZWN0aW9uc18odHJ1ZSkpO1xuICAgICAgZG9tLmFkZENsYXNzKHRoaXMuc3ZnR3JvdXBfLCAnYmxvY2tseURyYWdnaW5nJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbW1vbi5kcmFnZ2luZ0Nvbm5lY3Rpb25zLmxlbmd0aCA9IDA7XG4gICAgICBkb20ucmVtb3ZlQ2xhc3ModGhpcy5zdmdHcm91cF8sICdibG9ja2x5RHJhZ2dpbmcnKTtcbiAgICB9XG4gICAgLy8gUmVjdXJzZSB0aHJvdWdoIGFsbCBibG9ja3MgYXR0YWNoZWQgdW5kZXIgdGhpcyBvbmUuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaWxkQmxvY2tzXy5sZW5ndGg7IGkrKykge1xuICAgICAgKHRoaXMuY2hpbGRCbG9ja3NfW2ldIGFzIEJsb2NrU3ZnKS5zZXREcmFnZ2luZyhhZGRpbmcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGlzIGJsb2NrIGlzIG1vdmFibGUgb3Igbm90LlxuICAgKlxuICAgKiBAcGFyYW0gbW92YWJsZSBUcnVlIGlmIG1vdmFibGUuXG4gICAqL1xuICBvdmVycmlkZSBzZXRNb3ZhYmxlKG1vdmFibGU6IGJvb2xlYW4pIHtcbiAgICBzdXBlci5zZXRNb3ZhYmxlKG1vdmFibGUpO1xuICAgIHRoaXMucGF0aE9iamVjdC51cGRhdGVNb3ZhYmxlKG1vdmFibGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgYmxvY2sgaXMgZWRpdGFibGUgb3Igbm90LlxuICAgKlxuICAgKiBAcGFyYW0gZWRpdGFibGUgVHJ1ZSBpZiBlZGl0YWJsZS5cbiAgICovXG4gIG92ZXJyaWRlIHNldEVkaXRhYmxlKGVkaXRhYmxlOiBib29sZWFuKSB7XG4gICAgc3VwZXIuc2V0RWRpdGFibGUoZWRpdGFibGUpO1xuICAgIGNvbnN0IGljb25zID0gdGhpcy5nZXRJY29ucygpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWNvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGljb25zW2ldLnVwZGF0ZUVkaXRhYmxlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgd2hldGhlciB0aGlzIGJsb2NrIGlzIGEgc2hhZG93IGJsb2NrIG9yIG5vdC5cbiAgICpcbiAgICogQHBhcmFtIHNoYWRvdyBUcnVlIGlmIGEgc2hhZG93LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIHNldFNoYWRvdyhzaGFkb3c6IGJvb2xlYW4pIHtcbiAgICBzdXBlci5zZXRTaGFkb3coc2hhZG93KTtcbiAgICB0aGlzLmFwcGx5Q29sb3VyKCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBibG9jayBpcyBhbiBpbnNlcnRpb24gbWFya2VyIGJsb2NrIG9yIG5vdC5cbiAgICogT25jZSBzZXQgdGhpcyBjYW5ub3QgYmUgdW5zZXQuXG4gICAqXG4gICAqIEBwYXJhbSBpbnNlcnRpb25NYXJrZXIgVHJ1ZSBpZiBhbiBpbnNlcnRpb24gbWFya2VyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIHNldEluc2VydGlvbk1hcmtlcihpbnNlcnRpb25NYXJrZXI6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5pc0luc2VydGlvbk1hcmtlcl8gPT09IGluc2VydGlvbk1hcmtlcikge1xuICAgICAgcmV0dXJuOyAgLy8gTm8gY2hhbmdlLlxuICAgIH1cbiAgICB0aGlzLmlzSW5zZXJ0aW9uTWFya2VyXyA9IGluc2VydGlvbk1hcmtlcjtcbiAgICBpZiAodGhpcy5pc0luc2VydGlvbk1hcmtlcl8pIHtcbiAgICAgIHRoaXMuc2V0Q29sb3VyKFxuICAgICAgICAgIHRoaXMud29ya3NwYWNlLmdldFJlbmRlcmVyKCkuZ2V0Q29uc3RhbnRzKCkuSU5TRVJUSU9OX01BUktFUl9DT0xPVVIpO1xuICAgICAgdGhpcy5wYXRoT2JqZWN0LnVwZGF0ZUluc2VydGlvbk1hcmtlcih0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSByb290IG5vZGUgb2YgdGhlIFNWRyBvciBudWxsIGlmIG5vbmUgZXhpc3RzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcm9vdCBTVkcgbm9kZSAocHJvYmFibHkgYSBncm91cCkuXG4gICAqL1xuICBnZXRTdmdSb290KCk6IFNWR0dFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5zdmdHcm91cF87XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gaGVhbFN0YWNrIElmIHRydWUsIHRoZW4gdHJ5IHRvIGhlYWwgYW55IGdhcCBieSBjb25uZWN0aW5nIHRoZSBuZXh0XG4gICAqICAgICBzdGF0ZW1lbnQgd2l0aCB0aGUgcHJldmlvdXMgc3RhdGVtZW50LiAgT3RoZXJ3aXNlLCBkaXNwb3NlIG9mIGFsbFxuICAgKiAgICAgY2hpbGRyZW4gb2YgdGhpcyBibG9jay5cbiAgICogQHBhcmFtIGFuaW1hdGUgSWYgdHJ1ZSwgc2hvdyBhIGRpc3Bvc2FsIGFuaW1hdGlvbiBhbmQgc291bmQuXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICovXG4gIG92ZXJyaWRlIGRpc3Bvc2UoaGVhbFN0YWNrPzogYm9vbGVhbiwgYW5pbWF0ZT86IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5pc0RlYWRPckR5aW5nKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVG9vbHRpcC5kaXNwb3NlKCk7XG4gICAgVG9vbHRpcC51bmJpbmRNb3VzZUV2ZW50cyh0aGlzLnBhdGhPYmplY3Quc3ZnUGF0aCk7XG4gICAgZG9tLnN0YXJ0VGV4dFdpZHRoQ2FjaGUoKTtcbiAgICAvLyBTYXZlIHRoZSBibG9jaydzIHdvcmtzcGFjZSB0ZW1wb3JhcmlseSBzbyB3ZSBjYW4gcmVzaXplIHRoZVxuICAgIC8vIGNvbnRlbnRzIG9uY2UgdGhlIGJsb2NrIGlzIGRpc3Bvc2VkLlxuICAgIGNvbnN0IGJsb2NrV29ya3NwYWNlID0gdGhpcy53b3Jrc3BhY2U7XG4gICAgLy8gSWYgdGhpcyBibG9jayBpcyBiZWluZyBkcmFnZ2VkLCB1bmxpbmsgdGhlIG1vdXNlIGV2ZW50cy5cbiAgICBpZiAoY29tbW9uLmdldFNlbGVjdGVkKCkgPT09IHRoaXMpIHtcbiAgICAgIHRoaXMudW5zZWxlY3QoKTtcbiAgICAgIHRoaXMud29ya3NwYWNlLmNhbmNlbEN1cnJlbnRHZXN0dXJlKCk7XG4gICAgfVxuICAgIC8vIElmIHRoaXMgYmxvY2sgaGFzIGEgY29udGV4dCBtZW51IG9wZW4sIGNsb3NlIGl0LlxuICAgIGlmIChDb250ZXh0TWVudS5nZXRDdXJyZW50QmxvY2soKSA9PT0gdGhpcykge1xuICAgICAgQ29udGV4dE1lbnUuaGlkZSgpO1xuICAgIH1cblxuICAgIGlmIChhbmltYXRlICYmIHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMudW5wbHVnKGhlYWxTdGFjayk7XG4gICAgICBibG9ja0FuaW1hdGlvbnMuZGlzcG9zZVVpRWZmZWN0KHRoaXMpO1xuICAgIH1cbiAgICAvLyBTdG9wIHJlcmVuZGVyaW5nLlxuICAgIHRoaXMucmVuZGVyZWQgPSBmYWxzZTtcblxuICAgIC8vIENsZWFyIHBlbmRpbmcgd2FybmluZ3MuXG4gICAgZm9yIChjb25zdCBuIG9mIHRoaXMud2FybmluZ1RleHREYi52YWx1ZXMoKSkge1xuICAgICAgY2xlYXJUaW1lb3V0KG4pO1xuICAgIH1cbiAgICB0aGlzLndhcm5pbmdUZXh0RGIuY2xlYXIoKTtcblxuICAgIGNvbnN0IGljb25zID0gdGhpcy5nZXRJY29ucygpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWNvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGljb25zW2ldLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICAvLyBKdXN0IGRlbGV0aW5nIHRoaXMgYmxvY2sgZnJvbSB0aGUgRE9NIHdvdWxkIHJlc3VsdCBpbiBhIG1lbW9yeSBsZWFrIGFzXG4gICAgLy8gd2VsbCBhcyBjb3JydXB0aW9uIG9mIHRoZSBjb25uZWN0aW9uIGRhdGFiYXNlLiAgVGhlcmVmb3JlIHdlIG11c3RcbiAgICAvLyBtZXRob2RpY2FsbHkgc3RlcCB0aHJvdWdoIHRoZSBibG9ja3MgYW5kIGNhcmVmdWxseSBkaXNhc3NlbWJsZSB0aGVtLlxuICAgIGlmIChjb21tb24uZ2V0U2VsZWN0ZWQoKSA9PT0gdGhpcykge1xuICAgICAgY29tbW9uLnNldFNlbGVjdGVkKG51bGwpO1xuICAgIH1cblxuICAgIHN1cGVyLmRpc3Bvc2UoISFoZWFsU3RhY2spO1xuXG4gICAgZG9tLnJlbW92ZU5vZGUodGhpcy5zdmdHcm91cF8pO1xuICAgIGJsb2NrV29ya3NwYWNlLnJlc2l6ZUNvbnRlbnRzKCk7XG4gICAgLy8gU2V2ZXIgSmF2YVNjcmlwdCB0byBET00gY29ubmVjdGlvbnMuXG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gICAgLy8gJ1NWR0dFbGVtZW50Jy5cbiAgICB0aGlzLnN2Z0dyb3VwXyA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuICAgIGRvbS5zdG9wVGV4dFdpZHRoQ2FjaGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYSBibG9jayBhbmQgaGlkZSBjaGFmZiB3aGVuIGRvaW5nIHNvLiBUaGUgYmxvY2sgd2lsbCBub3QgYmUgZGVsZXRlZFxuICAgKiBpZiBpdCdzIGluIGEgZmx5b3V0LiBUaGlzIGlzIGNhbGxlZCBmcm9tIHRoZSBjb250ZXh0IG1lbnUgYW5kIGtleWJvYXJkXG4gICAqIHNob3J0Y3V0cyBhcyB0aGUgZnVsbCBkZWxldGUgYWN0aW9uLiBJZiB5b3UgYXJlIGRpc3Bvc2luZyBvZiBhIGJsb2NrIGZyb21cbiAgICogdGhlIHdvcmtzcGFjZSBhbmQgZG9uJ3QgbmVlZCB0byBwZXJmb3JtIGZseW91dCBjaGVja3MsIGhhbmRsZSBldmVudFxuICAgKiBncm91cGluZywgb3IgaGlkZSBjaGFmZiwgdGhlbiB1c2UgYGJsb2NrLmRpc3Bvc2UoKWAgZGlyZWN0bHkuXG4gICAqL1xuICBjaGVja0FuZERlbGV0ZSgpIHtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuaXNGbHlvdXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgICB0aGlzLndvcmtzcGFjZS5oaWRlQ2hhZmYoKTtcbiAgICBpZiAodGhpcy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICAvLyBEbyBub3QgYXR0ZW1wdCB0byBoZWFsIHJvd3NcbiAgICAgIC8vIChodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Jsb2NrbHkvaXNzdWVzLzQ4MzIpXG4gICAgICB0aGlzLmRpc3Bvc2UoZmFsc2UsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc3Bvc2UoLyogaGVhbCAqL1xuICAgICAgICAgICAgICAgICAgIHRydWUsIHRydWUpO1xuICAgIH1cbiAgICBldmVudFV0aWxzLnNldEdyb3VwKGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgYSBibG9jayBmb3IgY29weWluZy5cbiAgICpcbiAgICogQHJldHVybnMgQ29weSBtZXRhZGF0YSwgb3IgbnVsbCBpZiB0aGUgYmxvY2sgaXMgYW4gaW5zZXJ0aW9uIG1hcmtlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICB0b0NvcHlEYXRhKCk6IENvcHlEYXRhfG51bGwge1xuICAgIGlmICh0aGlzLmlzSW5zZXJ0aW9uTWFya2VyXykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBzYXZlSW5mbzpcbiAgICAgICAgICBibG9ja3Muc2F2ZSh0aGlzLCB7YWRkQ29vcmRpbmF0ZXM6IHRydWUsIGFkZE5leHRCbG9ja3M6IGZhbHNlfSkgYXNcbiAgICAgICAgICBibG9ja3MuU3RhdGUsXG4gICAgICBzb3VyY2U6IHRoaXMud29ya3NwYWNlLFxuICAgICAgdHlwZUNvdW50czogY29tbW9uLmdldEJsb2NrVHlwZUNvdW50cyh0aGlzLCB0cnVlKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIGNvbG91ciBvZiB0aGUgYmxvY2sgdG8gbWF0Y2ggdGhlIGJsb2NrJ3Mgc3RhdGUuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYXBwbHlDb2xvdXIoKSB7XG4gICAgdGhpcy5wYXRoT2JqZWN0LmFwcGx5Q29sb3VyKHRoaXMpO1xuXG4gICAgY29uc3QgaWNvbnMgPSB0aGlzLmdldEljb25zKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpY29ucy5sZW5ndGg7IGkrKykge1xuICAgICAgaWNvbnNbaV0uYXBwbHlDb2xvdXIoKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCB4ID0gMCwgaW5wdXQ7IGlucHV0ID0gdGhpcy5pbnB1dExpc3RbeF07IHgrKykge1xuICAgICAgZm9yIChsZXQgeSA9IDAsIGZpZWxkOyBmaWVsZCA9IGlucHV0LmZpZWxkUm93W3ldOyB5KyspIHtcbiAgICAgICAgZmllbGQuYXBwbHlDb2xvdXIoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgY29sb3VyIG9mIHRoZSBibG9jayAoYW5kIGNoaWxkcmVuKSB0byBtYXRjaCB0aGUgY3VycmVudFxuICAgKiBkaXNhYmxlZCBzdGF0ZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICB1cGRhdGVEaXNhYmxlZCgpIHtcbiAgICBjb25zdCBjaGlsZHJlbiA9ICh0aGlzLmdldENoaWxkcmVuKGZhbHNlKSk7XG4gICAgdGhpcy5hcHBseUNvbG91cigpO1xuICAgIGlmICh0aGlzLmlzQ29sbGFwc2VkKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDAsIGNoaWxkOyBjaGlsZCA9IGNoaWxkcmVuW2ldOyBpKyspIHtcbiAgICAgIGlmIChjaGlsZC5yZW5kZXJlZCkge1xuICAgICAgICBjaGlsZC51cGRhdGVEaXNhYmxlZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGNvbW1lbnQgaWNvbiBhdHRhY2hlZCB0byB0aGlzIGJsb2NrLCBvciBudWxsIGlmIHRoZSBibG9jayBoYXMgbm9cbiAgICogY29tbWVudC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGNvbW1lbnQgaWNvbiBhdHRhY2hlZCB0byB0aGlzIGJsb2NrLCBvciBudWxsLlxuICAgKi9cbiAgZ2V0Q29tbWVudEljb24oKTogQ29tbWVudHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jb21tZW50SWNvbl87XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoaXMgYmxvY2sncyBjb21tZW50IHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0LCBvciBudWxsIHRvIGRlbGV0ZS5cbiAgICovXG4gIG92ZXJyaWRlIHNldENvbW1lbnRUZXh0KHRleHQ6IHN0cmluZ3xudWxsKSB7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnZ2V0JyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJyhuYW1lOiBzdHJpbmcpID0+IHZvaWQnLlxuICAgIGlmICh0aGlzLmNvbW1lbnRNb2RlbC50ZXh0ID09PSB0ZXh0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN1cGVyLnNldENvbW1lbnRUZXh0KHRleHQpO1xuXG4gICAgY29uc3Qgc2hvdWxkSGF2ZUNvbW1lbnQgPSB0ZXh0ICE9PSBudWxsO1xuICAgIGlmICghIXRoaXMuY29tbWVudEljb25fID09PSBzaG91bGRIYXZlQ29tbWVudCkge1xuICAgICAgLy8gSWYgdGhlIGNvbW1lbnQncyBzdGF0ZSBvZiBleGlzdGVuY2UgaXMgY29ycmVjdCwgYnV0IHRoZSB0ZXh0IGlzIG5ld1xuICAgICAgLy8gdGhhdCBtZWFucyB3ZSdyZSBqdXN0IHVwZGF0aW5nIGEgY29tbWVudC5cbiAgICAgIHRoaXMuY29tbWVudEljb25fIS51cGRhdGVUZXh0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzaG91bGRIYXZlQ29tbWVudCkge1xuICAgICAgdGhpcy5jb21tZW50SWNvbl8gPSBuZXcgQ29tbWVudCh0aGlzKTtcbiAgICAgIHRoaXMuY29tbWVudCA9IHRoaXMuY29tbWVudEljb25fOyAgLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LlxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbW1lbnRJY29uXyEuZGlzcG9zZSgpO1xuICAgICAgdGhpcy5jb21tZW50SWNvbl8gPSBudWxsO1xuICAgICAgdGhpcy5jb21tZW50ID0gbnVsbDsgIC8vIEZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS5cbiAgICB9XG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAvLyBBZGRpbmcgb3IgcmVtb3ZpbmcgYSBjb21tZW50IGljb24gd2lsbCBjYXVzZSB0aGUgYmxvY2sgdG8gY2hhbmdlIHNoYXBlLlxuICAgICAgdGhpcy5idW1wTmVpZ2hib3VycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhpcyBibG9jaydzIHdhcm5pbmcgdGV4dC5cbiAgICpcbiAgICogQHBhcmFtIHRleHQgVGhlIHRleHQsIG9yIG51bGwgdG8gZGVsZXRlLlxuICAgKiBAcGFyYW0gb3B0X2lkIEFuIG9wdGlvbmFsIElEIGZvciB0aGUgd2FybmluZyB0ZXh0IHRvIGJlIGFibGUgdG8gbWFpbnRhaW5cbiAgICogICAgIG11bHRpcGxlIHdhcm5pbmdzLlxuICAgKi9cbiAgb3ZlcnJpZGUgc2V0V2FybmluZ1RleHQodGV4dDogc3RyaW5nfG51bGwsIG9wdF9pZD86IHN0cmluZykge1xuICAgIGNvbnN0IGlkID0gb3B0X2lkIHx8ICcnO1xuICAgIGlmICghaWQpIHtcbiAgICAgIC8vIEtpbGwgYWxsIHByZXZpb3VzIHBlbmRpbmcgcHJvY2Vzc2VzLCB0aGlzIGVkaXQgc3VwZXJzZWRlcyB0aGVtIGFsbC5cbiAgICAgIGZvciAoY29uc3QgdGltZW91dCBvZiB0aGlzLndhcm5pbmdUZXh0RGIudmFsdWVzKCkpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgfVxuICAgICAgdGhpcy53YXJuaW5nVGV4dERiLmNsZWFyKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLndhcm5pbmdUZXh0RGIuaGFzKGlkKSkge1xuICAgICAgLy8gT25seSBxdWV1ZSB1cCB0aGUgbGF0ZXN0IGNoYW5nZS4gIEtpbGwgYW55IGVhcmxpZXIgcGVuZGluZyBwcm9jZXNzLlxuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMud2FybmluZ1RleHREYi5nZXQoaWQpISk7XG4gICAgICB0aGlzLndhcm5pbmdUZXh0RGIuZGVsZXRlKGlkKTtcbiAgICB9XG4gICAgaWYgKHRoaXMud29ya3NwYWNlLmlzRHJhZ2dpbmcoKSkge1xuICAgICAgLy8gRG9uJ3QgY2hhbmdlIHRoZSB3YXJuaW5nIHRleHQgZHVyaW5nIGEgZHJhZy5cbiAgICAgIC8vIFdhaXQgdW50aWwgdGhlIGRyYWcgZmluaXNoZXMuXG4gICAgICB0aGlzLndhcm5pbmdUZXh0RGIuc2V0KGlkLCBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNEZWFkT3JEeWluZygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndhcm5pbmdUZXh0RGIuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0V2FybmluZ1RleHQodGV4dCwgaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmlzSW5GbHlvdXQpIHtcbiAgICAgIHRleHQgPSBudWxsO1xuICAgIH1cblxuICAgIGxldCBjaGFuZ2VkU3RhdGUgPSBmYWxzZTtcbiAgICBpZiAodHlwZW9mIHRleHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAvLyBCdWJibGUgdXAgdG8gYWRkIGEgd2FybmluZyBvbiB0b3AtbW9zdCBjb2xsYXBzZWQgYmxvY2suXG4gICAgICBsZXQgcGFyZW50ID0gdGhpcy5nZXRTdXJyb3VuZFBhcmVudCgpO1xuICAgICAgbGV0IGNvbGxhcHNlZFBhcmVudCA9IG51bGw7XG4gICAgICB3aGlsZSAocGFyZW50KSB7XG4gICAgICAgIGlmIChwYXJlbnQuaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICAgIGNvbGxhcHNlZFBhcmVudCA9IHBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQgPSBwYXJlbnQuZ2V0U3Vycm91bmRQYXJlbnQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb2xsYXBzZWRQYXJlbnQpIHtcbiAgICAgICAgY29sbGFwc2VkUGFyZW50LnNldFdhcm5pbmdUZXh0KFxuICAgICAgICAgICAgTXNnWydDT0xMQVBTRURfV0FSTklOR1NfV0FSTklORyddLCBCbG9ja1N2Zy5DT0xMQVBTRURfV0FSTklOR19JRCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy53YXJuaW5nKSB7XG4gICAgICAgIHRoaXMud2FybmluZyA9IG5ldyBXYXJuaW5nKHRoaXMpO1xuICAgICAgICBjaGFuZ2VkU3RhdGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdGhpcy53YXJuaW5nIS5zZXRUZXh0KCh0ZXh0KSwgaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBEaXNwb3NlIGFsbCB3YXJuaW5ncyBpZiBubyBJRCBpcyBnaXZlbi5cbiAgICAgIGlmICh0aGlzLndhcm5pbmcgJiYgIWlkKSB7XG4gICAgICAgIHRoaXMud2FybmluZy5kaXNwb3NlKCk7XG4gICAgICAgIGNoYW5nZWRTdGF0ZSA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMud2FybmluZykge1xuICAgICAgICBjb25zdCBvbGRUZXh0ID0gdGhpcy53YXJuaW5nLmdldFRleHQoKTtcbiAgICAgICAgdGhpcy53YXJuaW5nLnNldFRleHQoJycsIGlkKTtcbiAgICAgICAgY29uc3QgbmV3VGV4dCA9IHRoaXMud2FybmluZy5nZXRUZXh0KCk7XG4gICAgICAgIGlmICghbmV3VGV4dCkge1xuICAgICAgICAgIHRoaXMud2FybmluZy5kaXNwb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2hhbmdlZFN0YXRlID0gb2xkVGV4dCAhPT0gbmV3VGV4dDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNoYW5nZWRTdGF0ZSAmJiB0aGlzLnJlbmRlcmVkKSB7XG4gICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgLy8gQWRkaW5nIG9yIHJlbW92aW5nIGEgd2FybmluZyBpY29uIHdpbGwgY2F1c2UgdGhlIGJsb2NrIHRvIGNoYW5nZSBzaGFwZS5cbiAgICAgIHRoaXMuYnVtcE5laWdoYm91cnMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2l2ZSB0aGlzIGJsb2NrIGEgbXV0YXRvciBkaWFsb2cuXG4gICAqXG4gICAqIEBwYXJhbSBtdXRhdG9yIEEgbXV0YXRvciBkaWFsb2cgaW5zdGFuY2Ugb3IgbnVsbCB0byByZW1vdmUuXG4gICAqL1xuICBvdmVycmlkZSBzZXRNdXRhdG9yKG11dGF0b3I6IE11dGF0b3J8bnVsbCkge1xuICAgIGlmICh0aGlzLm11dGF0b3IgJiYgdGhpcy5tdXRhdG9yICE9PSBtdXRhdG9yKSB7XG4gICAgICB0aGlzLm11dGF0b3IuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBpZiAobXV0YXRvcikge1xuICAgICAgbXV0YXRvci5zZXRCbG9jayh0aGlzKTtcbiAgICAgIHRoaXMubXV0YXRvciA9IG11dGF0b3I7XG4gICAgICBtdXRhdG9yLmNyZWF0ZUljb24oKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAvLyBBZGRpbmcgb3IgcmVtb3ZpbmcgYSBtdXRhdG9yIGljb24gd2lsbCBjYXVzZSB0aGUgYmxvY2sgdG8gY2hhbmdlIHNoYXBlLlxuICAgICAgdGhpcy5idW1wTmVpZ2hib3VycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGUgYmxvY2sgaXMgZW5hYmxlZCBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBlbmFibGVkIFRydWUgaWYgZW5hYmxlZC5cbiAgICovXG4gIG92ZXJyaWRlIHNldEVuYWJsZWQoZW5hYmxlZDogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLmlzRW5hYmxlZCgpICE9PSBlbmFibGVkKSB7XG4gICAgICBzdXBlci5zZXRFbmFibGVkKGVuYWJsZWQpO1xuICAgICAgaWYgKHRoaXMucmVuZGVyZWQgJiYgIXRoaXMuZ2V0SW5oZXJpdGVkRGlzYWJsZWQoKSkge1xuICAgICAgICB0aGlzLnVwZGF0ZURpc2FibGVkKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoZSBibG9jayBpcyBoaWdobGlnaHRlZCBvciBub3QuICBCbG9jayBoaWdobGlnaHRpbmcgaXNcbiAgICogb2Z0ZW4gdXNlZCB0byB2aXN1YWxseSBtYXJrIGJsb2NrcyBjdXJyZW50bHkgYmVpbmcgZXhlY3V0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSBoaWdobGlnaHRlZCBUcnVlIGlmIGhpZ2hsaWdodGVkLlxuICAgKi9cbiAgc2V0SGlnaGxpZ2h0ZWQoaGlnaGxpZ2h0ZWQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5wYXRoT2JqZWN0LnVwZGF0ZUhpZ2hsaWdodGVkKGhpZ2hsaWdodGVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHRoZSB2aXN1YWwgXCJzZWxlY3RcIiBlZmZlY3QgdG8gdGhlIGJsb2NrLCBidXQgZG9lcyBub3QgYWN0dWFsbHkgc2VsZWN0XG4gICAqIGl0IG9yIGZpcmUgYW4gZXZlbnQuXG4gICAqXG4gICAqIEBzZWUgQmxvY2tTdmcjc2VsZWN0XG4gICAqL1xuICBhZGRTZWxlY3QoKSB7XG4gICAgdGhpcy5wYXRoT2JqZWN0LnVwZGF0ZVNlbGVjdGVkKHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgdGhlIHZpc3VhbCBcInNlbGVjdFwiIGVmZmVjdCBmcm9tIHRoZSBibG9jaywgYnV0IGRvZXMgbm90IGFjdHVhbGx5XG4gICAqIHVuc2VsZWN0IGl0IG9yIGZpcmUgYW4gZXZlbnQuXG4gICAqXG4gICAqIEBzZWUgQmxvY2tTdmcjdW5zZWxlY3RcbiAgICovXG4gIHJlbW92ZVNlbGVjdCgpIHtcbiAgICB0aGlzLnBhdGhPYmplY3QudXBkYXRlU2VsZWN0ZWQoZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY3Vyc29yIG92ZXIgdGhpcyBibG9jayBieSBhZGRpbmcgb3IgcmVtb3ZpbmcgYSBjbGFzcy5cbiAgICpcbiAgICogQHBhcmFtIGVuYWJsZSBUcnVlIGlmIHRoZSBkZWxldGUgY3Vyc29yIHNob3VsZCBiZSBzaG93biwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldERlbGV0ZVN0eWxlKGVuYWJsZTogYm9vbGVhbikge1xuICAgIHRoaXMucGF0aE9iamVjdC51cGRhdGVEcmFnZ2luZ0RlbGV0ZShlbmFibGUpO1xuICB9XG5cbiAgLy8gT3ZlcnJpZGVzIG9mIGZ1bmN0aW9ucyBvbiBCbG9ja2x5LkJsb2NrIHRoYXQgdGFrZSBpbnRvIGFjY291bnQgd2hldGhlciB0aGVcblxuICAvLyBibG9jayBoYXMgYmVlbiByZW5kZXJlZC5cblxuICAvKipcbiAgICogR2V0IHRoZSBjb2xvdXIgb2YgYSBibG9jay5cbiAgICpcbiAgICogQHJldHVybnMgI1JSR0dCQiBzdHJpbmcuXG4gICAqL1xuICBvdmVycmlkZSBnZXRDb2xvdXIoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zdHlsZS5jb2xvdXJQcmltYXJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgY29sb3VyIG9mIGEgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBjb2xvdXIgSFNWIGh1ZSB2YWx1ZSwgb3IgI1JSR0dCQiBzdHJpbmcuXG4gICAqL1xuICBvdmVycmlkZSBzZXRDb2xvdXIoY29sb3VyOiBudW1iZXJ8c3RyaW5nKSB7XG4gICAgc3VwZXIuc2V0Q29sb3VyKGNvbG91cik7XG4gICAgY29uc3Qgc3R5bGVPYmogPVxuICAgICAgICB0aGlzLndvcmtzcGFjZS5nZXRSZW5kZXJlcigpLmdldENvbnN0YW50cygpLmdldEJsb2NrU3R5bGVGb3JDb2xvdXIoXG4gICAgICAgICAgICB0aGlzLmNvbG91cl8pO1xuXG4gICAgdGhpcy5wYXRoT2JqZWN0LnNldFN0eWxlKHN0eWxlT2JqLnN0eWxlKTtcbiAgICB0aGlzLnN0eWxlID0gc3R5bGVPYmouc3R5bGU7XG4gICAgdGhpcy5zdHlsZU5hbWVfID0gc3R5bGVPYmoubmFtZTtcblxuICAgIHRoaXMuYXBwbHlDb2xvdXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHN0eWxlIGFuZCBjb2xvdXIgdmFsdWVzIG9mIGEgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja1N0eWxlTmFtZSBOYW1lIG9mIHRoZSBibG9jayBzdHlsZS5cbiAgICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSBibG9jayBzdHlsZSBkb2VzIG5vdCBleGlzdC5cbiAgICovXG4gIG92ZXJyaWRlIHNldFN0eWxlKGJsb2NrU3R5bGVOYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBibG9ja1N0eWxlID1cbiAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0UmVuZGVyZXIoKS5nZXRDb25zdGFudHMoKS5nZXRCbG9ja1N0eWxlKFxuICAgICAgICAgICAgYmxvY2tTdHlsZU5hbWUpO1xuICAgIHRoaXMuc3R5bGVOYW1lXyA9IGJsb2NrU3R5bGVOYW1lO1xuXG4gICAgaWYgKGJsb2NrU3R5bGUpIHtcbiAgICAgIHRoaXMuaGF0ID0gYmxvY2tTdHlsZS5oYXQ7XG4gICAgICB0aGlzLnBhdGhPYmplY3Quc2V0U3R5bGUoYmxvY2tTdHlsZSk7XG4gICAgICAvLyBTZXQgY29sb3VyIHRvIG1hdGNoIEJsb2NrLlxuICAgICAgdGhpcy5jb2xvdXJfID0gYmxvY2tTdHlsZS5jb2xvdXJQcmltYXJ5O1xuICAgICAgdGhpcy5zdHlsZSA9IGJsb2NrU3R5bGU7XG5cbiAgICAgIHRoaXMuYXBwbHlDb2xvdXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgRXJyb3IoJ0ludmFsaWQgc3R5bGUgbmFtZTogJyArIGJsb2NrU3R5bGVOYW1lKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGlzIGJsb2NrIHRvIHRoZSBmcm9udCBvZiB0aGUgdmlzaWJsZSB3b3Jrc3BhY2UuXG4gICAqIDxnPiB0YWdzIGRvIG5vdCByZXNwZWN0IHotaW5kZXggc28gU1ZHIHJlbmRlcnMgdGhlbSBpbiB0aGVcbiAgICogb3JkZXIgdGhhdCB0aGV5IGFyZSBpbiB0aGUgRE9NLiAgQnkgcGxhY2luZyB0aGlzIGJsb2NrIGZpcnN0IHdpdGhpbiB0aGVcbiAgICogYmxvY2sgZ3JvdXAncyA8Zz4sIGl0IHdpbGwgcmVuZGVyIG9uIHRvcCBvZiBhbnkgb3RoZXIgYmxvY2tzLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGJyaW5nVG9Gcm9udCgpIHtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXMgKi9cbiAgICBsZXQgYmxvY2s6IHRoaXN8bnVsbCA9IHRoaXM7XG4gICAgZG8ge1xuICAgICAgY29uc3Qgcm9vdCA9IGJsb2NrLmdldFN2Z1Jvb3QoKTtcbiAgICAgIGNvbnN0IHBhcmVudCA9IHJvb3QucGFyZW50Tm9kZTtcbiAgICAgIGNvbnN0IGNoaWxkTm9kZXMgPSBwYXJlbnQhLmNoaWxkTm9kZXM7XG4gICAgICAvLyBBdm9pZCBtb3ZpbmcgdGhlIGJsb2NrIGlmIGl0J3MgYWxyZWFkeSBhdCB0aGUgYm90dG9tLlxuICAgICAgaWYgKGNoaWxkTm9kZXNbY2hpbGROb2Rlcy5sZW5ndGggLSAxXSAhPT0gcm9vdCkge1xuICAgICAgICBwYXJlbnQhLmFwcGVuZENoaWxkKHJvb3QpO1xuICAgICAgfVxuICAgICAgYmxvY2sgPSBibG9jay5nZXRQYXJlbnQoKTtcbiAgICB9IHdoaWxlIChibG9jayk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBibG9jayBjYW4gY2hhaW4gb250byB0aGUgYm90dG9tIG9mIGFub3RoZXIgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBuZXdCb29sZWFuIFRydWUgaWYgdGhlcmUgY2FuIGJlIGEgcHJldmlvdXMgc3RhdGVtZW50LlxuICAgKiBAcGFyYW0gb3B0X2NoZWNrIFN0YXRlbWVudCB0eXBlIG9yIGxpc3Qgb2Ygc3RhdGVtZW50IHR5cGVzLiAgTnVsbC91bmRlZmluZWRcbiAgICogICAgIGlmIGFueSB0eXBlIGNvdWxkIGJlIGNvbm5lY3RlZC5cbiAgICovXG4gIG92ZXJyaWRlIHNldFByZXZpb3VzU3RhdGVtZW50KFxuICAgICAgbmV3Qm9vbGVhbjogYm9vbGVhbiwgb3B0X2NoZWNrPzogc3RyaW5nfHN0cmluZ1tdfG51bGwpIHtcbiAgICBzdXBlci5zZXRQcmV2aW91c1N0YXRlbWVudChuZXdCb29sZWFuLCBvcHRfY2hlY2spO1xuXG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB0aGlzLmJ1bXBOZWlnaGJvdXJzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIGFub3RoZXIgYmxvY2sgY2FuIGNoYWluIG9udG8gdGhlIGJvdHRvbSBvZiB0aGlzIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Qm9vbGVhbiBUcnVlIGlmIHRoZXJlIGNhbiBiZSBhIG5leHQgc3RhdGVtZW50LlxuICAgKiBAcGFyYW0gb3B0X2NoZWNrIFN0YXRlbWVudCB0eXBlIG9yIGxpc3Qgb2Ygc3RhdGVtZW50IHR5cGVzLiAgTnVsbC91bmRlZmluZWRcbiAgICogICAgIGlmIGFueSB0eXBlIGNvdWxkIGJlIGNvbm5lY3RlZC5cbiAgICovXG4gIG92ZXJyaWRlIHNldE5leHRTdGF0ZW1lbnQoXG4gICAgICBuZXdCb29sZWFuOiBib29sZWFuLCBvcHRfY2hlY2s/OiBzdHJpbmd8c3RyaW5nW118bnVsbCkge1xuICAgIHN1cGVyLnNldE5leHRTdGF0ZW1lbnQobmV3Qm9vbGVhbiwgb3B0X2NoZWNrKTtcblxuICAgIGlmICh0aGlzLnJlbmRlcmVkKSB7XG4gICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgdGhpcy5idW1wTmVpZ2hib3VycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGlzIGJsb2NrIHJldHVybnMgYSB2YWx1ZS5cbiAgICpcbiAgICogQHBhcmFtIG5ld0Jvb2xlYW4gVHJ1ZSBpZiB0aGVyZSBpcyBhbiBvdXRwdXQuXG4gICAqIEBwYXJhbSBvcHRfY2hlY2sgUmV0dXJuZWQgdHlwZSBvciBsaXN0IG9mIHJldHVybmVkIHR5cGVzLiAgTnVsbCBvclxuICAgKiAgICAgdW5kZWZpbmVkIGlmIGFueSB0eXBlIGNvdWxkIGJlIHJldHVybmVkIChlLmcuIHZhcmlhYmxlIGdldCkuXG4gICAqL1xuICBvdmVycmlkZSBzZXRPdXRwdXQobmV3Qm9vbGVhbjogYm9vbGVhbiwgb3B0X2NoZWNrPzogc3RyaW5nfHN0cmluZ1tdfG51bGwpIHtcbiAgICBzdXBlci5zZXRPdXRwdXQobmV3Qm9vbGVhbiwgb3B0X2NoZWNrKTtcblxuICAgIGlmICh0aGlzLnJlbmRlcmVkKSB7XG4gICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgdGhpcy5idW1wTmVpZ2hib3VycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB2YWx1ZSBpbnB1dHMgYXJlIGFycmFuZ2VkIGhvcml6b250YWxseSBvciB2ZXJ0aWNhbGx5LlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Qm9vbGVhbiBUcnVlIGlmIGlucHV0cyBhcmUgaG9yaXpvbnRhbC5cbiAgICovXG4gIG92ZXJyaWRlIHNldElucHV0c0lubGluZShuZXdCb29sZWFuOiBib29sZWFuKSB7XG4gICAgc3VwZXIuc2V0SW5wdXRzSW5saW5lKG5ld0Jvb2xlYW4pO1xuXG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB0aGlzLmJ1bXBOZWlnaGJvdXJzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbiBpbnB1dCBmcm9tIHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBpbnB1dC5cbiAgICogQHBhcmFtIG9wdF9xdWlldCBUcnVlIHRvIHByZXZlbnQgZXJyb3IgaWYgaW5wdXQgaXMgbm90IHByZXNlbnQuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgb3BlcmF0aW9uIHN1Y2NlZWRzLCBmYWxzZSBpZiBpbnB1dCBpcyBub3QgcHJlc2VudCBhbmRcbiAgICogICAgIG9wdF9xdWlldCBpcyB0cnVlXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgaW5wdXQgaXMgbm90IHByZXNlbnQgYW5kIG9wdF9xdWlldCBpcyBub3QgdHJ1ZS5cbiAgICovXG4gIG92ZXJyaWRlIHJlbW92ZUlucHV0KG5hbWU6IHN0cmluZywgb3B0X3F1aWV0PzogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJlbW92ZWQgPSBzdXBlci5yZW1vdmVJbnB1dChuYW1lLCBvcHRfcXVpZXQpO1xuXG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAvLyBSZW1vdmluZyBhbiBpbnB1dCB3aWxsIGNhdXNlIHRoZSBibG9jayB0byBjaGFuZ2Ugc2hhcGUuXG4gICAgICB0aGlzLmJ1bXBOZWlnaGJvdXJzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlbW92ZWQ7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhIG51bWJlcmVkIGlucHV0IHRvIGEgZGlmZmVyZW50IGxvY2F0aW9uIG9uIHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dEluZGV4IEluZGV4IG9mIHRoZSBpbnB1dCB0byBtb3ZlLlxuICAgKiBAcGFyYW0gcmVmSW5kZXggSW5kZXggb2YgaW5wdXQgdGhhdCBzaG91bGQgYmUgYWZ0ZXIgdGhlIG1vdmVkIGlucHV0LlxuICAgKi9cbiAgb3ZlcnJpZGUgbW92ZU51bWJlcmVkSW5wdXRCZWZvcmUoaW5wdXRJbmRleDogbnVtYmVyLCByZWZJbmRleDogbnVtYmVyKSB7XG4gICAgc3VwZXIubW92ZU51bWJlcmVkSW5wdXRCZWZvcmUoaW5wdXRJbmRleCwgcmVmSW5kZXgpO1xuXG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAvLyBNb3ZpbmcgYW4gaW5wdXQgd2lsbCBjYXVzZSB0aGUgYmxvY2sgdG8gY2hhbmdlIHNoYXBlLlxuICAgICAgdGhpcy5idW1wTmVpZ2hib3VycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSB2YWx1ZSBpbnB1dCwgc3RhdGVtZW50IGlucHV0IG9yIGxvY2FsIHZhcmlhYmxlIHRvIHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSB0eXBlIE9uZSBvZiBCbG9ja2x5LmlucHV0VHlwZXMuXG4gICAqIEBwYXJhbSBuYW1lIExhbmd1YWdlLW5ldXRyYWwgaWRlbnRpZmllciB3aGljaCBtYXkgdXNlZCB0byBmaW5kIHRoaXMgaW5wdXRcbiAgICogICAgIGFnYWluLiAgU2hvdWxkIGJlIHVuaXF1ZSB0byB0aGlzIGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgaW5wdXQgb2JqZWN0IGNyZWF0ZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYXBwZW5kSW5wdXRfKHR5cGU6IG51bWJlciwgbmFtZTogc3RyaW5nKTogSW5wdXQge1xuICAgIGNvbnN0IGlucHV0ID0gc3VwZXIuYXBwZW5kSW5wdXRfKHR5cGUsIG5hbWUpO1xuXG4gICAgaWYgKHRoaXMucmVuZGVyZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAvLyBBZGRpbmcgYW4gaW5wdXQgd2lsbCBjYXVzZSB0aGUgYmxvY2sgdG8gY2hhbmdlIHNoYXBlLlxuICAgICAgdGhpcy5idW1wTmVpZ2hib3VycygpO1xuICAgIH1cbiAgICByZXR1cm4gaW5wdXQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB3aGV0aGVyIHRoaXMgYmxvY2sncyBjb25uZWN0aW9ucyBhcmUgdHJhY2tlZCBpbiB0aGUgZGF0YWJhc2Ugb3Igbm90LlxuICAgKlxuICAgKiBVc2VkIGJ5IHRoZSBkZXNlcmlhbGl6ZXIgdG8gYmUgbW9yZSBlZmZpY2llbnQuIFNldHRpbmcgYSBjb25uZWN0aW9uJ3NcbiAgICogdHJhY2tlZF8gdmFsdWUgdG8gZmFsc2Uga2VlcHMgaXQgZnJvbSBhZGRpbmcgaXRzZWxmIHRvIHRoZSBkYiB3aGVuIGl0XG4gICAqIGdldHMgaXRzIGZpcnN0IG1vdmVUbyBjYWxsLCBzYXZpbmcgZXhwZW5zaXZlIG9wcyBmb3IgbGF0ZXIuXG4gICAqXG4gICAqIEBwYXJhbSB0cmFjayBJZiB0cnVlLCBzdGFydCB0cmFja2luZy4gSWYgZmFsc2UsIHN0b3AgdHJhY2tpbmcuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Q29ubmVjdGlvblRyYWNraW5nKHRyYWNrOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICAodGhpcy5wcmV2aW91c0Nvbm5lY3Rpb24pLnNldFRyYWNraW5nKHRyYWNrKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgKHRoaXMub3V0cHV0Q29ubmVjdGlvbikuc2V0VHJhY2tpbmcodHJhY2spO1xuICAgIH1cbiAgICBpZiAodGhpcy5uZXh0Q29ubmVjdGlvbikge1xuICAgICAgKHRoaXMubmV4dENvbm5lY3Rpb24pLnNldFRyYWNraW5nKHRyYWNrKTtcbiAgICAgIGNvbnN0IGNoaWxkID0gKHRoaXMubmV4dENvbm5lY3Rpb24pLnRhcmdldEJsb2NrKCk7XG4gICAgICBpZiAoY2hpbGQpIHtcbiAgICAgICAgY2hpbGQuc2V0Q29ubmVjdGlvblRyYWNraW5nKHRyYWNrKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb2xsYXBzZWRfKSB7XG4gICAgICAvLyBXaGVuIHRyYWNrIGlzIHRydWUsIHdlIGRvbid0IHdhbnQgdG8gc3RhcnQgdHJhY2tpbmcgY29sbGFwc2VkXG4gICAgICAvLyBjb25uZWN0aW9ucy4gV2hlbiB0cmFjayBpcyBmYWxzZSwgd2UncmUgYWxyZWFkeSBub3QgdHJhY2tpbmdcbiAgICAgIC8vIGNvbGxhcHNlZCBjb25uZWN0aW9ucywgc28gbm8gbmVlZCB0byB1cGRhdGUuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmlucHV0TGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY29ubiA9IHRoaXMuaW5wdXRMaXN0W2ldLmNvbm5lY3Rpb24gYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuICAgICAgaWYgKGNvbm4pIHtcbiAgICAgICAgY29ubi5zZXRUcmFja2luZyh0cmFjayk7XG5cbiAgICAgICAgLy8gUGFzcyB0cmFja2luZyBvbiBkb3duIHRoZSBjaGFpbi5cbiAgICAgICAgY29uc3QgYmxvY2sgPSBjb25uLnRhcmdldEJsb2NrKCk7XG4gICAgICAgIGlmIChibG9jaykge1xuICAgICAgICAgIGJsb2NrLnNldENvbm5lY3Rpb25UcmFja2luZyh0cmFjayk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBjb25uZWN0aW9ucyBvcmlnaW5hdGluZyBmcm9tIHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBhbGwgSWYgdHJ1ZSwgcmV0dXJuIGFsbCBjb25uZWN0aW9ucyBldmVuIGhpZGRlbiBvbmVzLlxuICAgKiAgICAgT3RoZXJ3aXNlLCBmb3IgYSBub24tcmVuZGVyZWQgYmxvY2sgcmV0dXJuIGFuIGVtcHR5IGxpc3QsIGFuZCBmb3IgYVxuICAgKiBjb2xsYXBzZWQgYmxvY2sgZG9uJ3QgcmV0dXJuIGlucHV0cyBjb25uZWN0aW9ucy5cbiAgICogQHJldHVybnMgQXJyYXkgb2YgY29ubmVjdGlvbnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0Q29ubmVjdGlvbnNfKGFsbDogYm9vbGVhbik6IFJlbmRlcmVkQ29ubmVjdGlvbltdIHtcbiAgICBjb25zdCBteUNvbm5lY3Rpb25zID0gW107XG4gICAgaWYgKGFsbCB8fCB0aGlzLnJlbmRlcmVkKSB7XG4gICAgICBpZiAodGhpcy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICAgIG15Q29ubmVjdGlvbnMucHVzaCh0aGlzLm91dHB1dENvbm5lY3Rpb24pO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICAgIG15Q29ubmVjdGlvbnMucHVzaCh0aGlzLnByZXZpb3VzQ29ubmVjdGlvbik7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5uZXh0Q29ubmVjdGlvbikge1xuICAgICAgICBteUNvbm5lY3Rpb25zLnB1c2godGhpcy5uZXh0Q29ubmVjdGlvbik7XG4gICAgICB9XG4gICAgICBpZiAoYWxsIHx8ICF0aGlzLmNvbGxhcHNlZF8pIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlucHV0OyBpbnB1dCA9IHRoaXMuaW5wdXRMaXN0W2ldOyBpKyspIHtcbiAgICAgICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbikge1xuICAgICAgICAgICAgbXlDb25uZWN0aW9ucy5wdXNoKGlucHV0LmNvbm5lY3Rpb24gYXMgUmVuZGVyZWRDb25uZWN0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG15Q29ubmVjdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogV2Fsa3MgZG93biBhIHN0YWNrIG9mIGJsb2NrcyBhbmQgZmluZHMgdGhlIGxhc3QgbmV4dCBjb25uZWN0aW9uIG9uIHRoZVxuICAgKiBzdGFjay5cbiAgICpcbiAgICogQHBhcmFtIGlnbm9yZVNoYWRvd3MgSWYgdHJ1ZSx0aGUgbGFzdCBjb25uZWN0aW9uIG9uIGEgbm9uLXNoYWRvdyBibG9jayB3aWxsXG4gICAqICAgICBiZSByZXR1cm5lZC4gSWYgZmFsc2UsIHRoaXMgd2lsbCBmb2xsb3cgc2hhZG93cyB0byBmaW5kIHRoZSBsYXN0XG4gICAqICAgICBjb25uZWN0aW9uLlxuICAgKiBAcmV0dXJucyBUaGUgbGFzdCBuZXh0IGNvbm5lY3Rpb24gb24gdGhlIHN0YWNrLCBvciBudWxsLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGxhc3RDb25uZWN0aW9uSW5TdGFjayhpZ25vcmVTaGFkb3dzOiBib29sZWFuKTogUmVuZGVyZWRDb25uZWN0aW9uXG4gICAgICB8bnVsbCB7XG4gICAgcmV0dXJuIHN1cGVyLmxhc3RDb25uZWN0aW9uSW5TdGFjayhpZ25vcmVTaGFkb3dzKSBhcyBSZW5kZXJlZENvbm5lY3Rpb247XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgY29ubmVjdGlvbiBvbiB0aGlzIGJsb2NrIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIGdpdmVuIGNvbm5lY3Rpb25cbiAgICogb24gdGhlIG90aGVyIGJsb2NrLlxuICAgKiBVc2VkIHRvIG1hdGNoIGNvbm5lY3Rpb25zIGJldHdlZW4gYSBibG9jayBhbmQgaXRzIGluc2VydGlvbiBtYXJrZXIuXG4gICAqXG4gICAqIEBwYXJhbSBvdGhlckJsb2NrIFRoZSBvdGhlciBibG9jayB0byBtYXRjaCBhZ2FpbnN0LlxuICAgKiBAcGFyYW0gY29ubiBUaGUgb3RoZXIgY29ubmVjdGlvbiB0byBtYXRjaC5cbiAgICogQHJldHVybnMgVGhlIG1hdGNoaW5nIGNvbm5lY3Rpb24gb24gdGhpcyBibG9jaywgb3IgbnVsbC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBnZXRNYXRjaGluZ0Nvbm5lY3Rpb24ob3RoZXJCbG9jazogQmxvY2ssIGNvbm46IENvbm5lY3Rpb24pOlxuICAgICAgUmVuZGVyZWRDb25uZWN0aW9ufG51bGwge1xuICAgIHJldHVybiBzdXBlci5nZXRNYXRjaGluZ0Nvbm5lY3Rpb24ob3RoZXJCbG9jaywgY29ubikgYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGNvbm5lY3Rpb24gb2YgdGhlIHNwZWNpZmllZCB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgY29ubmVjdGlvbiB0byBjcmVhdGUuXG4gICAqIEByZXR1cm5zIEEgbmV3IGNvbm5lY3Rpb24gb2YgdGhlIHNwZWNpZmllZCB0eXBlLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIG1ha2VDb25uZWN0aW9uXyh0eXBlOiBudW1iZXIpOiBSZW5kZXJlZENvbm5lY3Rpb24ge1xuICAgIHJldHVybiBuZXcgUmVuZGVyZWRDb25uZWN0aW9uKHRoaXMsIHR5cGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgbmV4dCBzdGF0ZW1lbnQgYmxvY2sgZGlyZWN0bHkgY29ubmVjdGVkIHRvIHRoaXMgYmxvY2suXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuZXh0IHN0YXRlbWVudCBibG9jayBvciBudWxsLlxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0TmV4dEJsb2NrKCk6IEJsb2NrU3ZnfG51bGwge1xuICAgIHJldHVybiBzdXBlci5nZXROZXh0QmxvY2soKSBhcyBCbG9ja1N2ZztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBibG9jayBjb25uZWN0ZWQgdG8gdGhlIHByZXZpb3VzIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBwcmV2aW91cyBzdGF0ZW1lbnQgYmxvY2sgb3IgbnVsbC5cbiAgICovXG4gIG92ZXJyaWRlIGdldFByZXZpb3VzQmxvY2soKTogQmxvY2tTdmd8bnVsbCB7XG4gICAgcmV0dXJuIHN1cGVyLmdldFByZXZpb3VzQmxvY2soKSBhcyBCbG9ja1N2ZztcbiAgfVxuXG4gIC8qKlxuICAgKiBCdW1wcyB1bmNvbm5lY3RlZCBibG9ja3Mgb3V0IG9mIGFsaWdubWVudC5cbiAgICpcbiAgICogVHdvIGJsb2NrcyB3aGljaCBhcmVuJ3QgYWN0dWFsbHkgY29ubmVjdGVkIHNob3VsZCBub3QgY29pbmNpZGVudGFsbHkgbGluZVxuICAgKiB1cCBvbiBzY3JlZW4sIGJlY2F1c2UgdGhhdCBjcmVhdGVzIGNvbmZ1c2lvbiBmb3IgZW5kLXVzZXJzLlxuICAgKi9cbiAgb3ZlcnJpZGUgYnVtcE5laWdoYm91cnMoKSB7XG4gICAgdGhpcy5nZXRSb290QmxvY2soKS5idW1wTmVpZ2hib3Vyc0ludGVybmFsKCk7XG4gIH1cblxuICAvKipcbiAgICogQnVtcHMgdW5jb25uZWN0ZWQgYmxvY2tzIG91dCBvZiBhbGlnbm1lbnQuXG4gICAqL1xuICBwcml2YXRlIGJ1bXBOZWlnaGJvdXJzSW50ZXJuYWwoKSB7XG4gICAgY29uc3Qgcm9vdCA9IHRoaXMuZ2V0Um9vdEJsb2NrKCk7XG4gICAgaWYgKHRoaXMuaXNEZWFkT3JEeWluZygpIHx8IHRoaXMud29ya3NwYWNlLmlzRHJhZ2dpbmcoKSB8fFxuICAgICAgICByb290LmlzSW5GbHlvdXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuZWlnaGJvdXJJc0luU3RhY2sobmVpZ2hib3VyOiBSZW5kZXJlZENvbm5lY3Rpb24pIHtcbiAgICAgIHJldHVybiBuZWlnaGJvdXIuZ2V0U291cmNlQmxvY2soKS5nZXRSb290QmxvY2soKSA9PT0gcm9vdDtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGNvbm4gb2YgdGhpcy5nZXRDb25uZWN0aW9uc18oZmFsc2UpKSB7XG4gICAgICBpZiAoY29ubi5pc1N1cGVyaW9yKCkpIHtcbiAgICAgICAgLy8gUmVjdXJzZSBkb3duIHRoZSBibG9jayBzdGFjay5cbiAgICAgICAgY29ubi50YXJnZXRCbG9jaygpPy5idW1wTmVpZ2hib3Vyc0ludGVybmFsKCk7XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3QgbmVpZ2hib3VyIG9mIGNvbm4ubmVpZ2hib3Vycyhjb25maWcuc25hcFJhZGl1cykpIHtcbiAgICAgICAgLy8gRG9uJ3QgYnVtcCBhd2F5IGZyb20gdGhpbmdzIHRoYXQgYXJlIGluIG91ciBzdGFjay5cbiAgICAgICAgaWYgKG5laWdoYm91cklzSW5TdGFjayhuZWlnaGJvdXIpKSBjb250aW51ZTtcbiAgICAgICAgLy8gSWYgYm90aCBjb25uZWN0aW9ucyBhcmUgY29ubmVjdGVkLCB0aGF0J3MgZmluZS5cbiAgICAgICAgaWYgKGNvbm4uaXNDb25uZWN0ZWQoKSAmJiBuZWlnaGJvdXIuaXNDb25uZWN0ZWQoKSkgY29udGludWU7XG5cbiAgICAgICAgLy8gQWx3YXlzIGJ1bXAgdGhlIGluZmVyaW9yIGNvbm5lY3Rpb24uXG4gICAgICAgIGlmIChjb25uLmlzU3VwZXJpb3IoKSkge1xuICAgICAgICAgIG5laWdoYm91ci5idW1wQXdheUZyb20oY29ubik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29ubi5idW1wQXdheUZyb20obmVpZ2hib3VyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTY2hlZHVsZSBzbmFwcGluZyB0byBncmlkIGFuZCBidW1waW5nIG5laWdoYm91cnMgdG8gb2NjdXIgYWZ0ZXIgYSBicmllZlxuICAgKiBkZWxheS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzY2hlZHVsZVNuYXBBbmRCdW1wKCkge1xuICAgIC8vIEVuc3VyZSB0aGF0IGFueSBzbmFwIGFuZCBidW1wIGFyZSBwYXJ0IG9mIHRoaXMgbW92ZSdzIGV2ZW50IGdyb3VwLlxuICAgIGNvbnN0IGdyb3VwID0gZXZlbnRVdGlscy5nZXRHcm91cCgpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKGdyb3VwKTtcbiAgICAgIHRoaXMuc25hcFRvR3JpZCgpO1xuICAgICAgZXZlbnRVdGlscy5zZXRHcm91cChmYWxzZSk7XG4gICAgfSwgY29uZmlnLmJ1bXBEZWxheSAvIDIpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBldmVudFV0aWxzLnNldEdyb3VwKGdyb3VwKTtcbiAgICAgIHRoaXMuYnVtcE5laWdoYm91cnMoKTtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgIH0sIGNvbmZpZy5idW1wRGVsYXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9uIGEgYmxvY2sgc28gdGhhdCBpdCBkb2Vzbid0IG1vdmUgdGhlIHRhcmdldCBibG9jayB3aGVuIGNvbm5lY3RlZC5cbiAgICogVGhlIGJsb2NrIHRvIHBvc2l0aW9uIGlzIHVzdWFsbHkgZWl0aGVyIHRoZSBmaXJzdCBibG9jayBpbiBhIGRyYWdnZWQgc3RhY2tcbiAgICogb3IgYW4gaW5zZXJ0aW9uIG1hcmtlci5cbiAgICpcbiAgICogQHBhcmFtIHNvdXJjZUNvbm5lY3Rpb24gVGhlIGNvbm5lY3Rpb24gb24gdGhlIG1vdmluZyBibG9jaydzIHN0YWNrLlxuICAgKiBAcGFyYW0gdGFyZ2V0Q29ubmVjdGlvbiBUaGUgY29ubmVjdGlvbiB0aGF0IHNob3VsZCBzdGF5IHN0YXRpb25hcnkgYXMgdGhpc1xuICAgKiAgICAgYmxvY2sgaXMgcG9zaXRpb25lZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBwb3NpdGlvbk5lYXJDb25uZWN0aW9uKFxuICAgICAgc291cmNlQ29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9uLFxuICAgICAgdGFyZ2V0Q29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9uKSB7XG4gICAgLy8gV2Ugb25seSBuZWVkIHRvIHBvc2l0aW9uIHRoZSBuZXcgYmxvY2sgaWYgaXQncyBiZWZvcmUgdGhlIGV4aXN0aW5nIG9uZSxcbiAgICAvLyBvdGhlcndpc2UgaXRzIHBvc2l0aW9uIGlzIHNldCBieSB0aGUgcHJldmlvdXMgYmxvY2suXG4gICAgaWYgKHNvdXJjZUNvbm5lY3Rpb24udHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQgfHxcbiAgICAgICAgc291cmNlQ29ubmVjdGlvbi50eXBlID09PSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRSkge1xuICAgICAgY29uc3QgZHggPSB0YXJnZXRDb25uZWN0aW9uLnggLSBzb3VyY2VDb25uZWN0aW9uLng7XG4gICAgICBjb25zdCBkeSA9IHRhcmdldENvbm5lY3Rpb24ueSAtIHNvdXJjZUNvbm5lY3Rpb24ueTtcblxuICAgICAgdGhpcy5tb3ZlQnkoZHgsIGR5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgVGhlIGZpcnN0IHN0YXRlbWVudCBjb25uZWN0aW9uIG9yIG51bGwuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0Rmlyc3RTdGF0ZW1lbnRDb25uZWN0aW9uKCk6IFJlbmRlcmVkQ29ubmVjdGlvbnxudWxsIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0Rmlyc3RTdGF0ZW1lbnRDb25uZWN0aW9uKCkgYXMgUmVuZGVyZWRDb25uZWN0aW9uIHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGFsbCB0aGUgYmxvY2tzIHRoYXQgYXJlIGRpcmVjdGx5IG5lc3RlZCBpbnNpZGUgdGhpcyBvbmUuXG4gICAqIEluY2x1ZGVzIHZhbHVlIGFuZCBzdGF0ZW1lbnQgaW5wdXRzLCBhcyB3ZWxsIGFzIGFueSBmb2xsb3dpbmcgc3RhdGVtZW50LlxuICAgKiBFeGNsdWRlcyBhbnkgY29ubmVjdGlvbiBvbiBhbiBvdXRwdXQgdGFiIG9yIGFueSBwcmVjZWRpbmcgc3RhdGVtZW50LlxuICAgKiBCbG9ja3MgYXJlIG9wdGlvbmFsbHkgc29ydGVkIGJ5IHBvc2l0aW9uOyB0b3AgdG8gYm90dG9tLlxuICAgKlxuICAgKiBAcGFyYW0gb3JkZXJlZCBTb3J0IHRoZSBsaXN0IGlmIHRydWUuXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGJsb2Nrcy5cbiAgICovXG4gIG92ZXJyaWRlIGdldENoaWxkcmVuKG9yZGVyZWQ6IGJvb2xlYW4pOiBCbG9ja1N2Z1tdIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0Q2hpbGRyZW4ob3JkZXJlZCkgYXMgQmxvY2tTdmdbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMYXlzIG91dCBhbmQgcmVmbG93cyBhIGJsb2NrIGJhc2VkIG9uIGl0cyBjb250ZW50cyBhbmQgc2V0dGluZ3MuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfYnViYmxlIElmIGZhbHNlLCBqdXN0IHJlbmRlciB0aGlzIGJsb2NrLlxuICAgKiAgIElmIHRydWUsIGFsc28gcmVuZGVyIGJsb2NrJ3MgcGFyZW50LCBncmFuZHBhcmVudCwgZXRjLiAgRGVmYXVsdHMgdG8gdHJ1ZS5cbiAgICovXG4gIHJlbmRlcihvcHRfYnViYmxlPzogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLnJlbmRlcklzSW5Qcm9ncmVzc18pIHtcbiAgICAgIHJldHVybjsgIC8vIERvbid0IGFsbG93IHJlY3Vyc2l2ZSByZW5kZXJzLlxuICAgIH1cbiAgICB0aGlzLnJlbmRlcklzSW5Qcm9ncmVzc18gPSB0cnVlO1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnJlbmRlcmVkID0gdHJ1ZTtcbiAgICAgIGRvbS5zdGFydFRleHRXaWR0aENhY2hlKCk7XG5cbiAgICAgIGlmICh0aGlzLmlzQ29sbGFwc2VkKCkpIHtcbiAgICAgICAgdGhpcy51cGRhdGVDb2xsYXBzZWRfKCk7XG4gICAgICB9XG4gICAgICB0aGlzLndvcmtzcGFjZS5nZXRSZW5kZXJlcigpLnJlbmRlcih0aGlzKTtcbiAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbkxvY2F0aW9uc18oKTtcblxuICAgICAgaWYgKG9wdF9idWJibGUgIT09IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudEJsb2NrID0gdGhpcy5nZXRQYXJlbnQoKTtcbiAgICAgICAgaWYgKHBhcmVudEJsb2NrKSB7XG4gICAgICAgICAgcGFyZW50QmxvY2sucmVuZGVyKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFRvcC1tb3N0IGJsb2NrLiBGaXJlIGFuIGV2ZW50IHRvIGFsbG93IHNjcm9sbGJhcnMgdG8gcmVzaXplLlxuICAgICAgICAgIHRoaXMud29ya3NwYWNlLnJlc2l6ZUNvbnRlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZG9tLnN0b3BUZXh0V2lkdGhDYWNoZSgpO1xuICAgICAgdGhpcy51cGRhdGVNYXJrZXJzXygpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLnJlbmRlcklzSW5Qcm9ncmVzc18gPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKiogUmVkcmF3IGFueSBhdHRhY2hlZCBtYXJrZXIgb3IgY3Vyc29yIHN2Z3MgaWYgbmVlZGVkLiAqL1xuICBwcm90ZWN0ZWQgdXBkYXRlTWFya2Vyc18oKSB7XG4gICAgaWYgKHRoaXMud29ya3NwYWNlLmtleWJvYXJkQWNjZXNzaWJpbGl0eU1vZGUgJiYgdGhpcy5wYXRoT2JqZWN0LmN1cnNvclN2Zykge1xuICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0Q3Vyc29yKCkhLmRyYXcoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMud29ya3NwYWNlLmtleWJvYXJkQWNjZXNzaWJpbGl0eU1vZGUgJiYgdGhpcy5wYXRoT2JqZWN0Lm1hcmtlclN2Zykge1xuICAgICAgLy8gVE9ETygjNDU5Mik6IFVwZGF0ZSBhbGwgbWFya2VycyBvbiB0aGUgYmxvY2suXG4gICAgICB0aGlzLndvcmtzcGFjZS5nZXRNYXJrZXIoTWFya2VyTWFuYWdlci5MT0NBTF9NQVJLRVIpIS5kcmF3KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbGwgb2YgdGhlIGNvbm5lY3Rpb25zIG9uIHRoaXMgYmxvY2sgd2l0aCB0aGUgbmV3IGxvY2F0aW9uc1xuICAgKiBjYWxjdWxhdGVkIGR1cmluZyByZW5kZXJpbmcuICBBbHNvIG1vdmUgYWxsIG9mIHRoZSBjb25uZWN0ZWQgYmxvY2tzIGJhc2VkXG4gICAqIG9uIHRoZSBuZXcgY29ubmVjdGlvbiBsb2NhdGlvbnMuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZUNvbm5lY3Rpb25Mb2NhdGlvbnNfKCkge1xuICAgIGNvbnN0IGJsb2NrVEwgPSB0aGlzLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcbiAgICAvLyBEb24ndCB0aWdodGVuIHByZXZpb3VzIG9yIG91dHB1dCBjb25uZWN0aW9ucyBiZWNhdXNlIHRoZXkgYXJlIGluZmVyaW9yXG4gICAgLy8gY29ubmVjdGlvbnMuXG4gICAgaWYgKHRoaXMucHJldmlvdXNDb25uZWN0aW9uKSB7XG4gICAgICB0aGlzLnByZXZpb3VzQ29ubmVjdGlvbi5tb3ZlVG9PZmZzZXQoYmxvY2tUTCk7XG4gICAgfVxuICAgIGlmICh0aGlzLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgIHRoaXMub3V0cHV0Q29ubmVjdGlvbi5tb3ZlVG9PZmZzZXQoYmxvY2tUTCk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmlucHV0TGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY29ubiA9IHRoaXMuaW5wdXRMaXN0W2ldLmNvbm5lY3Rpb24gYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuICAgICAgaWYgKGNvbm4pIHtcbiAgICAgICAgY29ubi5tb3ZlVG9PZmZzZXQoYmxvY2tUTCk7XG4gICAgICAgIGlmIChjb25uLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICBjb25uLnRpZ2h0ZW4oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm5leHRDb25uZWN0aW9uKSB7XG4gICAgICB0aGlzLm5leHRDb25uZWN0aW9uLm1vdmVUb09mZnNldChibG9ja1RMKTtcbiAgICAgIGlmICh0aGlzLm5leHRDb25uZWN0aW9uLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgdGhpcy5uZXh0Q29ubmVjdGlvbi50aWdodGVuKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCB0aGUgY3Vyc29yIFNWRyB0byB0aGlzIGJsb2NrJ3MgU1ZHIGdyb3VwLlxuICAgKlxuICAgKiBAcGFyYW0gY3Vyc29yU3ZnIFRoZSBTVkcgcm9vdCBvZiB0aGUgY3Vyc29yIHRvIGJlIGFkZGVkIHRvIHRoZSBibG9jayBTVkdcbiAgICogICAgIGdyb3VwLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldEN1cnNvclN2ZyhjdXJzb3JTdmc6IFNWR0VsZW1lbnQpIHtcbiAgICB0aGlzLnBhdGhPYmplY3Quc2V0Q3Vyc29yU3ZnKGN1cnNvclN2Zyk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHRoZSBtYXJrZXIgU1ZHIHRvIHRoaXMgYmxvY2sncyBTVkcgZ3JvdXAuXG4gICAqXG4gICAqIEBwYXJhbSBtYXJrZXJTdmcgVGhlIFNWRyByb290IG9mIHRoZSBtYXJrZXIgdG8gYmUgYWRkZWQgdG8gdGhlIGJsb2NrIFNWR1xuICAgKiAgICAgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0TWFya2VyU3ZnKG1hcmtlclN2ZzogU1ZHRWxlbWVudCkge1xuICAgIHRoaXMucGF0aE9iamVjdC5zZXRNYXJrZXJTdmcobWFya2VyU3ZnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYm91bmRpbmcgYm94IGRlc2NyaWJpbmcgdGhlIGRpbWVuc2lvbnMgb2YgdGhpcyBibG9ja1xuICAgKiBhbmQgYW55IGJsb2NrcyBzdGFja2VkIGJlbG93IGl0LlxuICAgKlxuICAgKiBAcmV0dXJucyBPYmplY3Qgd2l0aCBoZWlnaHQgYW5kIHdpZHRoIHByb3BlcnRpZXMgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldEhlaWdodFdpZHRoKCk6IHtoZWlnaHQ6IG51bWJlciwgd2lkdGg6IG51bWJlcn0ge1xuICAgIGxldCBoZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICBsZXQgd2lkdGggPSB0aGlzLndpZHRoO1xuICAgIC8vIFJlY3Vyc2l2ZWx5IGFkZCBzaXplIG9mIHN1YnNlcXVlbnQgYmxvY2tzLlxuICAgIGNvbnN0IG5leHRCbG9jayA9IHRoaXMuZ2V0TmV4dEJsb2NrKCk7XG4gICAgaWYgKG5leHRCbG9jaykge1xuICAgICAgY29uc3QgbmV4dEhlaWdodFdpZHRoID0gbmV4dEJsb2NrLmdldEhlaWdodFdpZHRoKCk7XG4gICAgICBjb25zdCB0YWJIZWlnaHQgPVxuICAgICAgICAgIHRoaXMud29ya3NwYWNlLmdldFJlbmRlcmVyKCkuZ2V0Q29uc3RhbnRzKCkuTk9UQ0hfSEVJR0hUO1xuICAgICAgaGVpZ2h0ICs9IG5leHRIZWlnaHRXaWR0aC5oZWlnaHQgLSB0YWJIZWlnaHQ7XG4gICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBuZXh0SGVpZ2h0V2lkdGgud2lkdGgpO1xuICAgIH1cbiAgICByZXR1cm4ge2hlaWdodCwgd2lkdGh9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZpc3VhbCBlZmZlY3QgdG8gc2hvdyB0aGF0IGlmIHRoZSBkcmFnZ2luZyBibG9jayBpcyBkcm9wcGVkLCB0aGlzIGJsb2NrXG4gICAqIHdpbGwgYmUgcmVwbGFjZWQuICBJZiBhIHNoYWRvdyBibG9jaywgaXQgd2lsbCBkaXNhcHBlYXIuICBPdGhlcndpc2UgaXQgd2lsbFxuICAgKiBidW1wLlxuICAgKlxuICAgKiBAcGFyYW0gYWRkIFRydWUgaWYgaGlnaGxpZ2h0aW5nIHNob3VsZCBiZSBhZGRlZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBmYWRlRm9yUmVwbGFjZW1lbnQoYWRkOiBib29sZWFuKSB7XG4gICAgdGhpcy5wYXRoT2JqZWN0LnVwZGF0ZVJlcGxhY2VtZW50RmFkZShhZGQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZpc3VhbCBlZmZlY3QgdG8gc2hvdyB0aGF0IGlmIHRoZSBkcmFnZ2luZyBibG9jayBpcyBkcm9wcGVkIGl0IHdpbGwgY29ubmVjdFxuICAgKiB0byB0aGlzIGlucHV0LlxuICAgKlxuICAgKiBAcGFyYW0gY29ubiBUaGUgY29ubmVjdGlvbiBvbiB0aGUgaW5wdXQgdG8gaGlnaGxpZ2h0LlxuICAgKiBAcGFyYW0gYWRkIFRydWUgaWYgaGlnaGxpZ2h0aW5nIHNob3VsZCBiZSBhZGRlZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoaWdobGlnaHRTaGFwZUZvcklucHV0KGNvbm46IFJlbmRlcmVkQ29ubmVjdGlvbiwgYWRkOiBib29sZWFuKSB7XG4gICAgdGhpcy5wYXRoT2JqZWN0LnVwZGF0ZVNoYXBlRm9ySW5wdXRIaWdobGlnaHQoY29ubiwgYWRkKTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRoZSBhYnN0cmFjdCBjbGFzcyBmb3IgYSBjb21wb25lbnQgd2l0aCBjdXN0b20gYmVoYXZpb3VyIHdoZW4gYVxuICogYmxvY2sgb3IgYnViYmxlIGlzIGRyYWdnZWQgb3ZlciBvciBkcm9wcGVkIG9uIHRvcCBvZiBpdC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5EcmFnVGFyZ2V0Jyk7XG5cbmltcG9ydCB0eXBlIHtJRHJhZ1RhcmdldH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ190YXJnZXQuanMnO1xuaW1wb3J0IHR5cGUge0lEcmFnZ2FibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2RyYWdnYWJsZS5qcyc7XG5pbXBvcnQgdHlwZSB7UmVjdH0gZnJvbSAnLi91dGlscy9yZWN0LmpzJztcblxuXG4vKipcbiAqIEFic3RyYWN0IGNsYXNzIGZvciBhIGNvbXBvbmVudCB3aXRoIGN1c3RvbSBiZWhhdmlvdXIgd2hlbiBhIGJsb2NrIG9yIGJ1YmJsZVxuICogaXMgZHJhZ2dlZCBvdmVyIG9yIGRyb3BwZWQgb24gdG9wIG9mIGl0LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkRyYWdUYXJnZXRcbiAqL1xuZXhwb3J0IGNsYXNzIERyYWdUYXJnZXQgaW1wbGVtZW50cyBJRHJhZ1RhcmdldCB7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkIGZvciB0aGlzIGNvbXBvbmVudCB0aGF0IGlzIHVzZWQgdG8gcmVnaXN0ZXIgd2l0aCB0aGVcbiAgICogQ29tcG9uZW50TWFuYWdlci5cbiAgICovXG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIGlkITogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvciBmb3IgRHJhZ1RhcmdldC4gSXQgZXhpc3RzIHRvIGFkZCB0aGUgaWQgcHJvcGVydHkgYW5kIHNob3VsZCBub3RcbiAgICogYmUgY2FsbGVkIGRpcmVjdGx5LCBvbmx5IGJ5IGEgc3ViY2xhc3MuXG4gICAqL1xuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgd2hlbiBhIGN1cnNvciB3aXRoIGEgYmxvY2sgb3IgYnViYmxlIGVudGVycyB0aGlzIGRyYWcgdGFyZ2V0LlxuICAgKlxuICAgKiBAcGFyYW0gX2RyYWdFbGVtZW50IFRoZSBibG9jayBvciBidWJibGUgY3VycmVudGx5IGJlaW5nIGRyYWdnZWQuXG4gICAqL1xuICBvbkRyYWdFbnRlcihfZHJhZ0VsZW1lbnQ6IElEcmFnZ2FibGUpIHt9XG4gIC8vIG5vLW9wXG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgd2hlbiBhIGN1cnNvciB3aXRoIGEgYmxvY2sgb3IgYnViYmxlIGlzIGRyYWdnZWQgb3ZlciB0aGlzIGRyYWdcbiAgICogdGFyZ2V0LlxuICAgKlxuICAgKiBAcGFyYW0gX2RyYWdFbGVtZW50IFRoZSBibG9jayBvciBidWJibGUgY3VycmVudGx5IGJlaW5nIGRyYWdnZWQuXG4gICAqL1xuICBvbkRyYWdPdmVyKF9kcmFnRWxlbWVudDogSURyYWdnYWJsZSkge31cbiAgLy8gbm8tb3BcblxuICAvKipcbiAgICogSGFuZGxlcyB3aGVuIGEgY3Vyc29yIHdpdGggYSBibG9jayBvciBidWJibGUgZXhpdHMgdGhpcyBkcmFnIHRhcmdldC5cbiAgICpcbiAgICogQHBhcmFtIF9kcmFnRWxlbWVudCBUaGUgYmxvY2sgb3IgYnViYmxlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKi9cbiAgb25EcmFnRXhpdChfZHJhZ0VsZW1lbnQ6IElEcmFnZ2FibGUpIHt9XG4gIC8vIG5vLW9wXG4gIC8qKlxuICAgKiBIYW5kbGVzIHdoZW4gYSBibG9jayBvciBidWJibGUgaXMgZHJvcHBlZCBvbiB0aGlzIGNvbXBvbmVudC5cbiAgICogU2hvdWxkIG5vdCBoYW5kbGUgZGVsZXRlIGhlcmUuXG4gICAqXG4gICAqIEBwYXJhbSBfZHJhZ0VsZW1lbnQgVGhlIGJsb2NrIG9yIGJ1YmJsZSBjdXJyZW50bHkgYmVpbmcgZHJhZ2dlZC5cbiAgICovXG4gIG9uRHJvcChfZHJhZ0VsZW1lbnQ6IElEcmFnZ2FibGUpIHt9XG4gIC8vIG5vLW9wXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGJvdW5kaW5nIHJlY3RhbmdsZSBvZiB0aGUgZHJhZyB0YXJnZXQgYXJlYSBpbiBwaXhlbCB1bml0c1xuICAgKiByZWxhdGl2ZSB0byB0aGUgQmxvY2tseSBpbmplY3Rpb24gZGl2LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY29tcG9uZW50J3MgYm91bmRpbmcgYm94LiBOdWxsIGlmIGRyYWcgdGFyZ2V0IGFyZWEgc2hvdWxkIGJlXG4gICAqICAgICBpZ25vcmVkLlxuICAgKi9cbiAgZ2V0Q2xpZW50UmVjdCgpOiBSZWN0fG51bGwge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciB0aGUgcHJvdmlkZWQgYmxvY2sgb3IgYnViYmxlIHNob3VsZCBub3QgYmUgbW92ZWQgYWZ0ZXJcbiAgICogYmVpbmcgZHJvcHBlZCBvbiB0aGlzIGNvbXBvbmVudC4gSWYgdHJ1ZSwgdGhlIGVsZW1lbnQgd2lsbCByZXR1cm4gdG8gd2hlcmVcbiAgICogaXQgd2FzIHdoZW4gdGhlIGRyYWcgc3RhcnRlZC5cbiAgICpcbiAgICogQHBhcmFtIF9kcmFnRWxlbWVudCBUaGUgYmxvY2sgb3IgYnViYmxlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBibG9jayBvciBidWJibGUgcHJvdmlkZWQgc2hvdWxkIGJlIHJldHVybmVkIHRvIGRyYWdcbiAgICogICAgIHN0YXJ0LlxuICAgKi9cbiAgc2hvdWxkUHJldmVudE1vdmUoX2RyYWdFbGVtZW50OiBJRHJhZ2dhYmxlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGFic3RyYWN0IGNsYXNzIGZvciBhIGNvbXBvbmVudCB0aGF0IGNhbiBkZWxldGUgYSBibG9jayBvclxuICogYnViYmxlIHRoYXQgaXMgZHJvcHBlZCBvbiB0b3Agb2YgaXQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRGVsZXRlQXJlYScpO1xuXG5pbXBvcnQge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQge0RyYWdUYXJnZXR9IGZyb20gJy4vZHJhZ190YXJnZXQuanMnO1xuaW1wb3J0IHR5cGUge0lEZWxldGVBcmVhfSBmcm9tICcuL2ludGVyZmFjZXMvaV9kZWxldGVfYXJlYS5qcyc7XG5pbXBvcnQgdHlwZSB7SURyYWdnYWJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZHJhZ2dhYmxlLmpzJztcblxuXG4vKipcbiAqIEFic3RyYWN0IGNsYXNzIGZvciBhIGNvbXBvbmVudCB0aGF0IGNhbiBkZWxldGUgYSBibG9jayBvciBidWJibGUgdGhhdCBpc1xuICogZHJvcHBlZCBvbiB0b3Agb2YgaXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRGVsZXRlQXJlYVxuICovXG5leHBvcnQgY2xhc3MgRGVsZXRlQXJlYSBleHRlbmRzIERyYWdUYXJnZXQgaW1wbGVtZW50cyBJRGVsZXRlQXJlYSB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBsYXN0IGJsb2NrIG9yIGJ1YmJsZSBkcmFnZ2VkIG92ZXIgdGhpcyBkZWxldGUgYXJlYSB3b3VsZCBiZVxuICAgKiBkZWxldGVkIGlmIGRyb3BwZWQgb24gdGhpcyBjb21wb25lbnQuXG4gICAqIFRoaXMgcHJvcGVydHkgaXMgbm90IHVwZGF0ZWQgYWZ0ZXIgdGhlIGJsb2NrIG9yIGJ1YmJsZSBpcyBkZWxldGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIHdvdWxkRGVsZXRlXyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkIGZvciB0aGlzIGNvbXBvbmVudCB0aGF0IGlzIHVzZWQgdG8gcmVnaXN0ZXIgd2l0aCB0aGVcbiAgICogQ29tcG9uZW50TWFuYWdlci5cbiAgICovXG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIG92ZXJyaWRlIGlkITogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvciBmb3IgRGVsZXRlQXJlYS4gU2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHksIG9ubHkgYnkgYVxuICAgKiBzdWJjbGFzcy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBwcm92aWRlZCBibG9jayBvciBidWJibGUgd291bGQgYmUgZGVsZXRlZCBpZiBkcm9wcGVkIG9uXG4gICAqIHRoaXMgYXJlYS5cbiAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGNoZWNrIGlmIHRoZSBlbGVtZW50IGlzIGRlbGV0YWJsZSBhbmQgaXMgYWx3YXlzIGNhbGxlZFxuICAgKiBiZWZvcmUgb25EcmFnRW50ZXIvb25EcmFnT3Zlci9vbkRyYWdFeGl0LlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgYmxvY2sgb3IgYnViYmxlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKiBAcGFyYW0gY291bGRDb25uZWN0IFdoZXRoZXIgdGhlIGVsZW1lbnQgY291bGQgY291bGQgY29ubmVjdCB0byBhbm90aGVyLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBlbGVtZW50IHByb3ZpZGVkIHdvdWxkIGJlIGRlbGV0ZWQgaWYgZHJvcHBlZCBvbiB0aGlzXG4gICAqICAgICBhcmVhLlxuICAgKi9cbiAgd291bGREZWxldGUoZWxlbWVudDogSURyYWdnYWJsZSwgY291bGRDb25uZWN0OiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBCbG9ja1N2Zykge1xuICAgICAgY29uc3QgYmxvY2sgPSAoZWxlbWVudCk7XG4gICAgICBjb25zdCBjb3VsZERlbGV0ZUJsb2NrID0gIWJsb2NrLmdldFBhcmVudCgpICYmIGJsb2NrLmlzRGVsZXRhYmxlKCk7XG4gICAgICB0aGlzLnVwZGF0ZVdvdWxkRGVsZXRlXyhjb3VsZERlbGV0ZUJsb2NrICYmICFjb3VsZENvbm5lY3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVdvdWxkRGVsZXRlXyhlbGVtZW50LmlzRGVsZXRhYmxlKCkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy53b3VsZERlbGV0ZV87XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgaW50ZXJuYWwgd291bGREZWxldGVfIHN0YXRlLlxuICAgKlxuICAgKiBAcGFyYW0gd291bGREZWxldGUgVGhlIG5ldyB2YWx1ZSBmb3IgdGhlIHdvdWxkRGVsZXRlIHN0YXRlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHVwZGF0ZVdvdWxkRGVsZXRlXyh3b3VsZERlbGV0ZTogYm9vbGVhbikge1xuICAgIHRoaXMud291bGREZWxldGVfID0gd291bGREZWxldGU7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDb250YWlucyB0aGUgcGF0aCB0byBhIHNpbmdsZSBwbmcgdGF0IGhvbGRzIHRoZSBpbWFnZXMgZm9yIHRoZSB0cmFzaGNhblxuICogYXMgd2VsbCBhcyB0aGUgem9vbSBjb250cm9scy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5zcHJpdGUuU1BSSVRFXG4gKi9cbmV4cG9ydCBjb25zdCBTUFJJVEUgPSB7XG4gIHdpZHRoOiA5NixcbiAgaGVpZ2h0OiAxMjQsXG4gIHVybDogJ3Nwcml0ZXMucG5nJyxcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0IHJlcHJlc2VudGluZyBhIHRyYXNoIGNhbiBpY29uLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRyYXNoY2FuJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX3RyYXNoY2FuX29wZW4uanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tseU9wdGlvbnN9IGZyb20gJy4vYmxvY2tseV9vcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQge0NvbXBvbmVudE1hbmFnZXJ9IGZyb20gJy4vY29tcG9uZW50X21hbmFnZXIuanMnO1xuaW1wb3J0IHtEZWxldGVBcmVhfSBmcm9tICcuL2RlbGV0ZV9hcmVhLmpzJztcbmltcG9ydCB0eXBlIHtBYnN0cmFjdH0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja0RlbGV0ZX0gZnJvbSAnLi9ldmVudHMvZXZlbnRzX2Jsb2NrX2RlbGV0ZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtJQXV0b0hpZGVhYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9hdXRvaGlkZWFibGUuanMnO1xuaW1wb3J0IHR5cGUge0lEcmFnZ2FibGV9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2RyYWdnYWJsZS5qcyc7XG5pbXBvcnQgdHlwZSB7SUZseW91dH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZmx5b3V0LmpzJztcbmltcG9ydCB0eXBlIHtJUG9zaXRpb25hYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9wb3NpdGlvbmFibGUuanMnO1xuaW1wb3J0IHR5cGUge1VpTWV0cmljc30gZnJvbSAnLi9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHtPcHRpb25zfSBmcm9tICcuL29wdGlvbnMuanMnO1xuaW1wb3J0ICogYXMgdWlQb3NpdGlvbiBmcm9tICcuL3Bvc2l0aW9uYWJsZV9oZWxwZXJzLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUgKiBhcyBibG9ja3MgZnJvbSAnLi9zZXJpYWxpemF0aW9uL2Jsb2Nrcy5qcyc7XG5pbXBvcnQge1NQUklURX0gZnJvbSAnLi9zcHJpdGVzLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQge1JlY3R9IGZyb20gJy4vdXRpbHMvcmVjdC5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vdXRpbHMvc2l6ZS5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuaW1wb3J0IHtCbG9ja0luZm99IGZyb20gJy4vdXRpbHMvdG9vbGJveC5qcyc7XG5pbXBvcnQgKiBhcyB0b29sYm94IGZyb20gJy4vdXRpbHMvdG9vbGJveC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgdHJhc2ggY2FuLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRyYXNoY2FuXG4gKi9cbmV4cG9ydCBjbGFzcyBUcmFzaGNhbiBleHRlbmRzIERlbGV0ZUFyZWEgaW1wbGVtZW50cyBJQXV0b0hpZGVhYmxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQb3NpdGlvbmFibGUge1xuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZCBmb3IgdGhpcyBjb21wb25lbnQgdGhhdCBpcyB1c2VkIHRvIHJlZ2lzdGVyIHdpdGggdGhlXG4gICAqIENvbXBvbmVudE1hbmFnZXIuXG4gICAqL1xuICBvdmVycmlkZSBpZCA9ICd0cmFzaGNhbic7XG5cbiAgLyoqXG4gICAqIEEgbGlzdCBvZiBKU09OIChzdG9yZWQgYXMgc3RyaW5ncykgcmVwcmVzZW50aW5nIGJsb2NrcyBpbiB0aGUgdHJhc2hjYW4uXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbnRlbnRzXzogc3RyaW5nW10gPSBbXTtcblxuICAvKipcbiAgICogVGhlIHRyYXNoY2FuIGZseW91dC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBmbHlvdXQ6IElGbHlvdXR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEN1cnJlbnQgb3Blbi9jbG9zZSBzdGF0ZSBvZiB0aGUgbGlkLiAqL1xuICBpc0xpZE9wZW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogVGhlIG1pbmltdW0gb3Blbm5lc3Mgb2YgdGhlIGxpZC4gVXNlZCB0byBpbmRpY2F0ZSBpZiB0aGUgdHJhc2hjYW5cbiAgICogY29udGFpbnMgYmxvY2tzLlxuICAgKi9cbiAgcHJpdmF0ZSBtaW5PcGVubmVzc18gPSAwO1xuXG4gIC8qKiBUaGUgU1ZHIGdyb3VwIGNvbnRhaW5pbmcgdGhlIHRyYXNoIGNhbi4gKi9cbiAgcHJpdmF0ZSBzdmdHcm91cF86IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBTVkcgaW1hZ2UgZWxlbWVudCBvZiB0aGUgdHJhc2ggY2FuIGxpZC4gKi9cbiAgcHJpdmF0ZSBzdmdMaWRfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUYXNrIElEIG9mIG9wZW5pbmcvY2xvc2luZyBhbmltYXRpb24uICovXG4gIHByaXZhdGUgbGlkVGFza186IFJldHVyblR5cGU8dHlwZW9mIHNldFRpbWVvdXQ+fG51bGwgPSBudWxsO1xuXG4gIC8qKiBDdXJyZW50IHN0YXRlIG9mIGxpZCBvcGVuaW5nICgwLjAgPSBjbG9zZWQsIDEuMCA9IG9wZW4pLiAqL1xuICBwcml2YXRlIGxpZE9wZW5fID0gMDtcblxuICAvKiogTGVmdCBjb29yZGluYXRlIG9mIHRoZSB0cmFzaCBjYW4uICovXG4gIHByaXZhdGUgbGVmdF8gPSAwO1xuXG4gIC8qKiBUb3AgY29vcmRpbmF0ZSBvZiB0aGUgdHJhc2ggY2FuLiAqL1xuICBwcml2YXRlIHRvcF8gPSAwO1xuXG4gIC8qKiBXaGV0aGVyIHRoaXMgdHJhc2ggY2FuIGhhcyBiZWVuIGluaXRpYWxpemVkLiAqL1xuICBwcml2YXRlIGluaXRpYWxpemVkXyA9IGZhbHNlO1xuXG4gIC8qKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gc2l0IGluLiAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmICh0aGlzLndvcmtzcGFjZS5vcHRpb25zLm1heFRyYXNoY2FuQ29udGVudHMgPD0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBmbHlvdXQgb3B0aW9ucy5cbiAgICBjb25zdCBmbHlvdXRXb3Jrc3BhY2VPcHRpb25zID0gbmV3IE9wdGlvbnMoKHtcbiAgICAgICdzY3JvbGxiYXJzJzogdHJ1ZSxcbiAgICAgICdwYXJlbnRXb3Jrc3BhY2UnOiB0aGlzLndvcmtzcGFjZSxcbiAgICAgICdydGwnOiB0aGlzLndvcmtzcGFjZS5SVEwsXG4gICAgICAnb25lQmFzZWRJbmRleCc6IHRoaXMud29ya3NwYWNlLm9wdGlvbnMub25lQmFzZWRJbmRleCxcbiAgICAgICdyZW5kZXJlcic6IHRoaXMud29ya3NwYWNlLm9wdGlvbnMucmVuZGVyZXIsXG4gICAgICAncmVuZGVyZXJPdmVycmlkZXMnOiB0aGlzLndvcmtzcGFjZS5vcHRpb25zLnJlbmRlcmVyT3ZlcnJpZGVzLFxuICAgICAgJ21vdmUnOiB7XG4gICAgICAgICdzY3JvbGxiYXJzJzogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSBhcyBCbG9ja2x5T3B0aW9ucykpO1xuICAgIC8vIENyZWF0ZSB2ZXJ0aWNhbCBvciBob3Jpem9udGFsIGZseW91dC5cbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuaG9yaXpvbnRhbExheW91dCkge1xuICAgICAgZmx5b3V0V29ya3NwYWNlT3B0aW9ucy50b29sYm94UG9zaXRpb24gPVxuICAgICAgICAgIHRoaXMud29ya3NwYWNlLnRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveC5Qb3NpdGlvbi5UT1AgP1xuICAgICAgICAgIHRvb2xib3guUG9zaXRpb24uQk9UVE9NIDpcbiAgICAgICAgICB0b29sYm94LlBvc2l0aW9uLlRPUDtcbiAgICAgIGNvbnN0IEhvcml6b250YWxGbHlvdXQgPSByZWdpc3RyeS5nZXRDbGFzc0Zyb21PcHRpb25zKFxuICAgICAgICAgIHJlZ2lzdHJ5LlR5cGUuRkxZT1VUU19IT1JJWk9OVEFMX1RPT0xCT1gsIHRoaXMud29ya3NwYWNlLm9wdGlvbnMsXG4gICAgICAgICAgdHJ1ZSk7XG4gICAgICB0aGlzLmZseW91dCA9IG5ldyBIb3Jpem9udGFsRmx5b3V0IShmbHlvdXRXb3Jrc3BhY2VPcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmx5b3V0V29ya3NwYWNlT3B0aW9ucy50b29sYm94UG9zaXRpb24gPVxuICAgICAgICAgIHRoaXMud29ya3NwYWNlLnRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveC5Qb3NpdGlvbi5SSUdIVCA/XG4gICAgICAgICAgdG9vbGJveC5Qb3NpdGlvbi5MRUZUIDpcbiAgICAgICAgICB0b29sYm94LlBvc2l0aW9uLlJJR0hUO1xuICAgICAgY29uc3QgVmVydGljYWxGbHlvdXQgPSByZWdpc3RyeS5nZXRDbGFzc0Zyb21PcHRpb25zKFxuICAgICAgICAgIHJlZ2lzdHJ5LlR5cGUuRkxZT1VUU19WRVJUSUNBTF9UT09MQk9YLCB0aGlzLndvcmtzcGFjZS5vcHRpb25zLCB0cnVlKTtcbiAgICAgIHRoaXMuZmx5b3V0ID0gbmV3IFZlcnRpY2FsRmx5b3V0IShmbHlvdXRXb3Jrc3BhY2VPcHRpb25zKTtcbiAgICB9XG4gICAgdGhpcy53b3Jrc3BhY2UuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5vbkRlbGV0ZV8uYmluZCh0aGlzKSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSB0cmFzaCBjYW4gZWxlbWVudHMuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB0cmFzaCBjYW4ncyBTVkcgZ3JvdXAuXG4gICAqL1xuICBjcmVhdGVEb20oKTogU1ZHRWxlbWVudCB7XG4gICAgLyogSGVyZSdzIHRoZSBtYXJrdXAgdGhhdCB3aWxsIGJlIGdlbmVyYXRlZDpcbiAgICAgICAgPGcgY2xhc3M9XCJibG9ja2x5VHJhc2hcIj5cbiAgICAgICAgICA8Y2xpcHBhdGggaWQ9XCJibG9ja2x5VHJhc2hCb2R5Q2xpcFBhdGg4Mzc0OTNcIj5cbiAgICAgICAgICAgIDxyZWN0IHdpZHRoPVwiNDdcIiBoZWlnaHQ9XCI0NVwiIHk9XCIxNVwiPjwvcmVjdD5cbiAgICAgICAgICA8L2NsaXBwYXRoPlxuICAgICAgICAgIDxpbWFnZSB3aWR0aD1cIjY0XCIgaGVpZ2h0PVwiOTJcIiB5PVwiLTMyXCIgeGxpbms6aHJlZj1cIm1lZGlhL3Nwcml0ZXMucG5nXCJcbiAgICAgICAgICAgICAgY2xpcC1wYXRoPVwidXJsKCNibG9ja2x5VHJhc2hCb2R5Q2xpcFBhdGg4Mzc0OTMpXCI+PC9pbWFnZT5cbiAgICAgICAgICA8Y2xpcHBhdGggaWQ9XCJibG9ja2x5VHJhc2hMaWRDbGlwUGF0aDgzNzQ5M1wiPlxuICAgICAgICAgICAgPHJlY3Qgd2lkdGg9XCI0N1wiIGhlaWdodD1cIjE1XCI+PC9yZWN0PlxuICAgICAgICAgIDwvY2xpcHBhdGg+XG4gICAgICAgICAgPGltYWdlIHdpZHRoPVwiODRcIiBoZWlnaHQ9XCI5MlwiIHk9XCItMzJcIiB4bGluazpocmVmPVwibWVkaWEvc3ByaXRlcy5wbmdcIlxuICAgICAgICAgICAgICBjbGlwLXBhdGg9XCJ1cmwoI2Jsb2NrbHlUcmFzaExpZENsaXBQYXRoODM3NDkzKVwiPjwvaW1hZ2U+XG4gICAgICAgIDwvZz5cbiAgICAgICAgKi9cbiAgICB0aGlzLnN2Z0dyb3VwXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5HLCB7J2NsYXNzJzogJ2Jsb2NrbHlUcmFzaCd9KTtcbiAgICBsZXQgY2xpcDtcbiAgICBjb25zdCBybmQgPSBTdHJpbmcoTWF0aC5yYW5kb20oKSkuc3Vic3RyaW5nKDIpO1xuICAgIGNsaXAgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkNMSVBQQVRILCB7J2lkJzogJ2Jsb2NrbHlUcmFzaEJvZHlDbGlwUGF0aCcgKyBybmR9LCB0aGlzLnN2Z0dyb3VwXyk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7J3dpZHRoJzogV0lEVEgsICdoZWlnaHQnOiBCT0RZX0hFSUdIVCwgJ3knOiBMSURfSEVJR0hUfSxcbiAgICAgICAgY2xpcCk7XG4gICAgY29uc3QgYm9keSA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuSU1BR0UsIHtcbiAgICAgICAgICAnd2lkdGgnOiBTUFJJVEUud2lkdGgsXG4gICAgICAgICAgJ3gnOiAtU1BSSVRFX0xFRlQsXG4gICAgICAgICAgJ2hlaWdodCc6IFNQUklURS5oZWlnaHQsXG4gICAgICAgICAgJ3knOiAtU1BSSVRFX1RPUCxcbiAgICAgICAgICAnY2xpcC1wYXRoJzogJ3VybCgjYmxvY2tseVRyYXNoQm9keUNsaXBQYXRoJyArIHJuZCArICcpJyxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5zdmdHcm91cF8pO1xuICAgIGJvZHkuc2V0QXR0cmlidXRlTlMoXG4gICAgICAgIGRvbS5YTElOS19OUywgJ3hsaW5rOmhyZWYnLFxuICAgICAgICB0aGlzLndvcmtzcGFjZS5vcHRpb25zLnBhdGhUb01lZGlhICsgU1BSSVRFLnVybCk7XG5cbiAgICBjbGlwID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5DTElQUEFUSCwgeydpZCc6ICdibG9ja2x5VHJhc2hMaWRDbGlwUGF0aCcgKyBybmR9LCB0aGlzLnN2Z0dyb3VwXyk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7J3dpZHRoJzogV0lEVEgsICdoZWlnaHQnOiBMSURfSEVJR0hUfSwgY2xpcCk7XG4gICAgdGhpcy5zdmdMaWRfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5JTUFHRSwge1xuICAgICAgICAgICd3aWR0aCc6IFNQUklURS53aWR0aCxcbiAgICAgICAgICAneCc6IC1TUFJJVEVfTEVGVCxcbiAgICAgICAgICAnaGVpZ2h0JzogU1BSSVRFLmhlaWdodCxcbiAgICAgICAgICAneSc6IC1TUFJJVEVfVE9QLFxuICAgICAgICAgICdjbGlwLXBhdGgnOiAndXJsKCNibG9ja2x5VHJhc2hMaWRDbGlwUGF0aCcgKyBybmQgKyAnKScsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuc3ZnR3JvdXBfKTtcbiAgICB0aGlzLnN2Z0xpZF8uc2V0QXR0cmlidXRlTlMoXG4gICAgICAgIGRvbS5YTElOS19OUywgJ3hsaW5rOmhyZWYnLFxuICAgICAgICB0aGlzLndvcmtzcGFjZS5vcHRpb25zLnBhdGhUb01lZGlhICsgU1BSSVRFLnVybCk7XG5cbiAgICAvLyBiaW5kRXZlbnRXaXRoQ2hlY2tzXyBxdWFzaGVzIGV2ZW50cyB0b28gYWdncmVzc2l2ZWx5LiBTZWU6XG4gICAgLy8gaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9mb3J1bS8jIXRvcGljL2Jsb2NrbHkvUUY0eUI5V3gwMHNcbiAgICAvLyBVc2luZyBiaW5kRXZlbnRXaXRoQ2hlY2tzXyBmb3IgYmxvY2tpbmcgbW91c2Vkb3duIGNhdXNlcyBpc3N1ZSBpbiBtb2JpbGUuXG4gICAgLy8gU2VlICM0MzAzXG4gICAgYnJvd3NlckV2ZW50cy5iaW5kKFxuICAgICAgICB0aGlzLnN2Z0dyb3VwXywgJ3BvaW50ZXJkb3duJywgdGhpcywgdGhpcy5ibG9ja01vdXNlRG93bldoZW5PcGVuYWJsZV8pO1xuICAgIGJyb3dzZXJFdmVudHMuYmluZCh0aGlzLnN2Z0dyb3VwXywgJ3BvaW50ZXJ1cCcsIHRoaXMsIHRoaXMuY2xpY2spO1xuICAgIC8vIEJpbmQgdG8gYm9keSBpbnN0ZWFkIG9mIHRoaXMuc3ZnR3JvdXBfIHNvIHRoYXQgd2UgZG9uJ3QgZ2V0IGxpZCBqaXR0ZXJzXG4gICAgYnJvd3NlckV2ZW50cy5iaW5kKGJvZHksICdwb2ludGVyb3ZlcicsIHRoaXMsIHRoaXMubW91c2VPdmVyXyk7XG4gICAgYnJvd3NlckV2ZW50cy5iaW5kKGJvZHksICdwb2ludGVyb3V0JywgdGhpcywgdGhpcy5tb3VzZU91dF8pO1xuICAgIHRoaXMuYW5pbWF0ZUxpZF8oKTtcbiAgICByZXR1cm4gdGhpcy5zdmdHcm91cF87XG4gIH1cblxuICAvKiogSW5pdGlhbGl6ZXMgdGhlIHRyYXNoIGNhbi4gKi9cbiAgaW5pdCgpIHtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2Uub3B0aW9ucy5tYXhUcmFzaGNhbkNvbnRlbnRzID4gMCkge1xuICAgICAgZG9tLmluc2VydEFmdGVyKFxuICAgICAgICAgIHRoaXMuZmx5b3V0IS5jcmVhdGVEb20oU3ZnLlNWRykhLCB0aGlzLndvcmtzcGFjZS5nZXRQYXJlbnRTdmcoKSk7XG4gICAgICB0aGlzLmZseW91dCEuaW5pdCh0aGlzLndvcmtzcGFjZSk7XG4gICAgfVxuICAgIHRoaXMud29ya3NwYWNlLmdldENvbXBvbmVudE1hbmFnZXIoKS5hZGRDb21wb25lbnQoe1xuICAgICAgY29tcG9uZW50OiB0aGlzLFxuICAgICAgd2VpZ2h0OiAxLFxuICAgICAgY2FwYWJpbGl0aWVzOiBbXG4gICAgICAgIENvbXBvbmVudE1hbmFnZXIuQ2FwYWJpbGl0eS5BVVRPSElERUFCTEUsXG4gICAgICAgIENvbXBvbmVudE1hbmFnZXIuQ2FwYWJpbGl0eS5ERUxFVEVfQVJFQSxcbiAgICAgICAgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkRSQUdfVEFSR0VULFxuICAgICAgICBDb21wb25lbnRNYW5hZ2VyLkNhcGFiaWxpdHkuUE9TSVRJT05BQkxFLFxuICAgICAgXSxcbiAgICB9KTtcbiAgICB0aGlzLmluaXRpYWxpemVkXyA9IHRydWU7XG4gICAgdGhpcy5zZXRMaWRPcGVuKGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIHRoaXMgdHJhc2ggY2FuLlxuICAgKiBVbmxpbmsgZnJvbSBhbGwgRE9NIGVsZW1lbnRzIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzLlxuICAgKlxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMud29ya3NwYWNlLmdldENvbXBvbmVudE1hbmFnZXIoKS5yZW1vdmVDb21wb25lbnQoJ3RyYXNoY2FuJyk7XG4gICAgaWYgKHRoaXMuc3ZnR3JvdXBfKSB7XG4gICAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLnN2Z0dyb3VwXyk7XG4gICAgICB0aGlzLnN2Z0dyb3VwXyA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuc3ZnTGlkXyA9IG51bGw7XG4gICAgaWYgKHRoaXMubGlkVGFza18pIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmxpZFRhc2tfKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGUgdHJhc2hjYW4gaGFzIGNvbnRlbnRzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB0cmFzaGNhbiBoYXMgY29udGVudHMuXG4gICAqL1xuICBwcml2YXRlIGhhc0NvbnRlbnRzXygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLmNvbnRlbnRzXy5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSB0cmFzaGNhbiBjb250ZW50cy1mbHlvdXQgaXMgY3VycmVudGx5IG9wZW4uXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHRyYXNoY2FuIGNvbnRlbnRzLWZseW91dCBpcyBjdXJyZW50bHkgb3Blbi5cbiAgICovXG4gIGNvbnRlbnRzSXNPcGVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuZmx5b3V0ICYmIHRoaXMuZmx5b3V0LmlzVmlzaWJsZSgpO1xuICB9XG5cbiAgLyoqIE9wZW5zIHRoZSB0cmFzaGNhbiBmbHlvdXQuICovXG4gIG9wZW5GbHlvdXQoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudHNJc09wZW4oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjb250ZW50cyA9IHRoaXMuY29udGVudHNfLm1hcChmdW5jdGlvbihzdHJpbmcpIHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHN0cmluZyk7XG4gICAgfSk7XG4gICAgLy8gVHJhc2hjYW5zIHdpdGggbG90cyBvZiBibG9ja3MgY2FuIHRha2UgYSBzZWNvbmQgdG8gcmVuZGVyLlxuICAgIGNvbnN0IGJsb2NrbHlTdHlsZSA9IHRoaXMud29ya3NwYWNlLmdldFBhcmVudFN2ZygpLnN0eWxlO1xuICAgIGJsb2NrbHlTdHlsZS5jdXJzb3IgPSAnd2FpdCc7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmZseW91dD8uc2hvdyhjb250ZW50cyk7XG4gICAgICBibG9ja2x5U3R5bGUuY3Vyc29yID0gJyc7XG4gICAgfSwgMTApO1xuICAgIHRoaXMuZmlyZVVpRXZlbnRfKHRydWUpO1xuICB9XG5cbiAgLyoqIENsb3NlcyB0aGUgdHJhc2hjYW4gZmx5b3V0LiAqL1xuICBjbG9zZUZseW91dCgpIHtcbiAgICBpZiAoIXRoaXMuY29udGVudHNJc09wZW4oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmZseW91dD8uaGlkZSgpO1xuICAgIHRoaXMuZmlyZVVpRXZlbnRfKGZhbHNlKTtcbiAgICB0aGlzLndvcmtzcGFjZS5yZWNvcmREcmFnVGFyZ2V0cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGVzIHRoZSBjb21wb25lbnQuIENhbGxlZCBpbiBXb3Jrc3BhY2VTdmcuaGlkZUNoYWZmLlxuICAgKlxuICAgKiBAcGFyYW0gb25seUNsb3NlUG9wdXBzIFdoZXRoZXIgb25seSBwb3B1cHMgc2hvdWxkIGJlIGNsb3NlZC5cbiAgICogICAgIEZseW91dHMgc2hvdWxkIG5vdCBiZSBjbG9zZWQgaWYgdGhpcyBpcyB0cnVlLlxuICAgKi9cbiAgYXV0b0hpZGUob25seUNsb3NlUG9wdXBzOiBib29sZWFuKSB7XG4gICAgLy8gRm9yIG5vdyB0aGUgdHJhc2hjYW4gZmx5b3V0IGFsd2F5cyBhdXRvY2xvc2VzIGJlY2F1c2UgaXQgb3ZlcmxheXMgdGhlXG4gICAgLy8gdHJhc2hjYW4gVUkgKG5vIHRyYXNoY2FuIHRvIGNsaWNrIHRvIGNsb3NlIGl0KS5cbiAgICBpZiAoIW9ubHlDbG9zZVBvcHVwcyAmJiB0aGlzLmZseW91dCkge1xuICAgICAgdGhpcy5jbG9zZUZseW91dCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbXB0aWVzIHRoZSB0cmFzaGNhbidzIGNvbnRlbnRzLiBJZiB0aGUgY29udGVudHMtZmx5b3V0IGlzIGN1cnJlbnRseSBvcGVuXG4gICAqIGl0IHdpbGwgYmUgY2xvc2VkLlxuICAgKi9cbiAgZW1wdHlDb250ZW50cygpIHtcbiAgICBpZiAoIXRoaXMuaGFzQ29udGVudHNfKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50c18ubGVuZ3RoID0gMDtcbiAgICB0aGlzLnNldE1pbk9wZW5uZXNzXygwKTtcbiAgICB0aGlzLmNsb3NlRmx5b3V0KCk7XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb25zIHRoZSB0cmFzaGNhbi5cbiAgICogSXQgaXMgcG9zaXRpb25lZCBpbiB0aGUgb3Bwb3NpdGUgY29ybmVyIHRvIHRoZSBjb3JuZXIgdGhlXG4gICAqIGNhdGVnb3JpZXMvdG9vbGJveCBzdGFydHMgYXQuXG4gICAqXG4gICAqIEBwYXJhbSBtZXRyaWNzIFRoZSB3b3Jrc3BhY2UgbWV0cmljcy5cbiAgICogQHBhcmFtIHNhdmVkUG9zaXRpb25zIExpc3Qgb2YgcmVjdGFuZ2xlcyB0aGF0IGFyZSBhbHJlYWR5IG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqL1xuICBwb3NpdGlvbihtZXRyaWNzOiBVaU1ldHJpY3MsIHNhdmVkUG9zaXRpb25zOiBSZWN0W10pIHtcbiAgICAvLyBOb3QgeWV0IGluaXRpYWxpemVkLlxuICAgIGlmICghdGhpcy5pbml0aWFsaXplZF8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjb3JuZXJQb3NpdGlvbiA9XG4gICAgICAgIHVpUG9zaXRpb24uZ2V0Q29ybmVyT3Bwb3NpdGVUb29sYm94KHRoaXMud29ya3NwYWNlLCBtZXRyaWNzKTtcblxuICAgIGNvbnN0IGhlaWdodCA9IEJPRFlfSEVJR0hUICsgTElEX0hFSUdIVDtcbiAgICBjb25zdCBzdGFydFJlY3QgPSB1aVBvc2l0aW9uLmdldFN0YXJ0UG9zaXRpb25SZWN0KFxuICAgICAgICBjb3JuZXJQb3NpdGlvbiwgbmV3IFNpemUoV0lEVEgsIGhlaWdodCksIE1BUkdJTl9IT1JJWk9OVEFMLFxuICAgICAgICBNQVJHSU5fVkVSVElDQUwsIG1ldHJpY3MsIHRoaXMud29ya3NwYWNlKTtcblxuICAgIGNvbnN0IHZlcnRpY2FsUG9zaXRpb24gPSBjb3JuZXJQb3NpdGlvbi52ZXJ0aWNhbDtcbiAgICBjb25zdCBidW1wRGlyZWN0aW9uID0gdmVydGljYWxQb3NpdGlvbiA9PT0gdWlQb3NpdGlvbi52ZXJ0aWNhbFBvc2l0aW9uLlRPUCA/XG4gICAgICAgIHVpUG9zaXRpb24uYnVtcERpcmVjdGlvbi5ET1dOIDpcbiAgICAgICAgdWlQb3NpdGlvbi5idW1wRGlyZWN0aW9uLlVQO1xuICAgIGNvbnN0IHBvc2l0aW9uUmVjdCA9IHVpUG9zaXRpb24uYnVtcFBvc2l0aW9uUmVjdChcbiAgICAgICAgc3RhcnRSZWN0LCBNQVJHSU5fVkVSVElDQUwsIGJ1bXBEaXJlY3Rpb24sIHNhdmVkUG9zaXRpb25zKTtcblxuICAgIHRoaXMudG9wXyA9IHBvc2l0aW9uUmVjdC50b3A7XG4gICAgdGhpcy5sZWZ0XyA9IHBvc2l0aW9uUmVjdC5sZWZ0O1xuICAgIHRoaXMuc3ZnR3JvdXBfPy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyB0aGlzLmxlZnRfICsgJywnICsgdGhpcy50b3BfICsgJyknKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBib3VuZGluZyByZWN0YW5nbGUgb2YgdGhlIFVJIGVsZW1lbnQgaW4gcGl4ZWwgdW5pdHMgcmVsYXRpdmUgdG9cbiAgICogdGhlIEJsb2NrbHkgaW5qZWN0aW9uIGRpdi5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIFVJIGVsZW1lbnRzJ3MgYm91bmRpbmcgYm94LiBOdWxsIGlmIGJvdW5kaW5nIGJveCBzaG91bGQgYmVcbiAgICogICAgIGlnbm9yZWQgYnkgb3RoZXIgVUkgZWxlbWVudHMuXG4gICAqL1xuICBnZXRCb3VuZGluZ1JlY3RhbmdsZSgpOiBSZWN0fG51bGwge1xuICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMudG9wXyArIEJPRFlfSEVJR0hUICsgTElEX0hFSUdIVDtcbiAgICBjb25zdCByaWdodCA9IHRoaXMubGVmdF8gKyBXSURUSDtcbiAgICByZXR1cm4gbmV3IFJlY3QodGhpcy50b3BfLCBib3R0b20sIHRoaXMubGVmdF8sIHJpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBib3VuZGluZyByZWN0YW5nbGUgb2YgdGhlIGRyYWcgdGFyZ2V0IGFyZWEgaW4gcGl4ZWwgdW5pdHNcbiAgICogcmVsYXRpdmUgdG8gdmlld3BvcnQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb21wb25lbnQncyBib3VuZGluZyBib3guIE51bGwgaWYgZHJhZyB0YXJnZXQgYXJlYSBzaG91bGQgYmVcbiAgICogICAgIGlnbm9yZWQuXG4gICAqL1xuICBvdmVycmlkZSBnZXRDbGllbnRSZWN0KCk6IFJlY3R8bnVsbCB7XG4gICAgaWYgKCF0aGlzLnN2Z0dyb3VwXykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgdHJhc2hSZWN0ID0gdGhpcy5zdmdHcm91cF8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgdG9wID0gdHJhc2hSZWN0LnRvcCArIFNQUklURV9UT1AgLSBNQVJHSU5fSE9UU1BPVDtcbiAgICBjb25zdCBib3R0b20gPSB0b3AgKyBMSURfSEVJR0hUICsgQk9EWV9IRUlHSFQgKyAyICogTUFSR0lOX0hPVFNQT1Q7XG4gICAgY29uc3QgbGVmdCA9IHRyYXNoUmVjdC5sZWZ0ICsgU1BSSVRFX0xFRlQgLSBNQVJHSU5fSE9UU1BPVDtcbiAgICBjb25zdCByaWdodCA9IGxlZnQgKyBXSURUSCArIDIgKiBNQVJHSU5fSE9UU1BPVDtcbiAgICByZXR1cm4gbmV3IFJlY3QodG9wLCBib3R0b20sIGxlZnQsIHJpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHdoZW4gYSBjdXJzb3Igd2l0aCBhIGJsb2NrIG9yIGJ1YmJsZSBpcyBkcmFnZ2VkIG92ZXIgdGhpcyBkcmFnXG4gICAqIHRhcmdldC5cbiAgICpcbiAgICogQHBhcmFtIF9kcmFnRWxlbWVudCBUaGUgYmxvY2sgb3IgYnViYmxlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKi9cbiAgb3ZlcnJpZGUgb25EcmFnT3ZlcihfZHJhZ0VsZW1lbnQ6IElEcmFnZ2FibGUpIHtcbiAgICB0aGlzLnNldExpZE9wZW4odGhpcy53b3VsZERlbGV0ZV8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgd2hlbiBhIGN1cnNvciB3aXRoIGEgYmxvY2sgb3IgYnViYmxlIGV4aXRzIHRoaXMgZHJhZyB0YXJnZXQuXG4gICAqXG4gICAqIEBwYXJhbSBfZHJhZ0VsZW1lbnQgVGhlIGJsb2NrIG9yIGJ1YmJsZSBjdXJyZW50bHkgYmVpbmcgZHJhZ2dlZC5cbiAgICovXG4gIG92ZXJyaWRlIG9uRHJhZ0V4aXQoX2RyYWdFbGVtZW50OiBJRHJhZ2dhYmxlKSB7XG4gICAgdGhpcy5zZXRMaWRPcGVuKGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHdoZW4gYSBibG9jayBvciBidWJibGUgaXMgZHJvcHBlZCBvbiB0aGlzIGNvbXBvbmVudC5cbiAgICogU2hvdWxkIG5vdCBoYW5kbGUgZGVsZXRlIGhlcmUuXG4gICAqXG4gICAqIEBwYXJhbSBfZHJhZ0VsZW1lbnQgVGhlIGJsb2NrIG9yIGJ1YmJsZSBjdXJyZW50bHkgYmVpbmcgZHJhZ2dlZC5cbiAgICovXG4gIG92ZXJyaWRlIG9uRHJvcChfZHJhZ0VsZW1lbnQ6IElEcmFnZ2FibGUpIHtcbiAgICBzZXRUaW1lb3V0KHRoaXMuc2V0TGlkT3Blbi5iaW5kKHRoaXMsIGZhbHNlKSwgMTAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGbGlwIHRoZSBsaWQgb3BlbiBvciBzaHV0LlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdGUgVHJ1ZSBpZiBvcGVuLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldExpZE9wZW4oc3RhdGU6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5pc0xpZE9wZW4gPT09IHN0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmxpZFRhc2tfKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5saWRUYXNrXyk7XG4gICAgfVxuICAgIHRoaXMuaXNMaWRPcGVuID0gc3RhdGU7XG4gICAgdGhpcy5hbmltYXRlTGlkXygpO1xuICB9XG5cbiAgLyoqIFJvdGF0ZSB0aGUgbGlkIG9wZW4gb3IgY2xvc2VkIGJ5IG9uZSBzdGVwLiAgVGhlbiB3YWl0IGFuZCByZWN1cnNlLiAqL1xuICBwcml2YXRlIGFuaW1hdGVMaWRfKCkge1xuICAgIGNvbnN0IGZyYW1lcyA9IEFOSU1BVElPTl9GUkFNRVM7XG5cbiAgICBjb25zdCBkZWx0YSA9IDEgLyAoZnJhbWVzICsgMSk7XG4gICAgdGhpcy5saWRPcGVuXyArPSB0aGlzLmlzTGlkT3BlbiA/IGRlbHRhIDogLWRlbHRhO1xuICAgIHRoaXMubGlkT3Blbl8gPSBNYXRoLm1pbihNYXRoLm1heCh0aGlzLmxpZE9wZW5fLCB0aGlzLm1pbk9wZW5uZXNzXyksIDEpO1xuXG4gICAgdGhpcy5zZXRMaWRBbmdsZV8odGhpcy5saWRPcGVuXyAqIE1BWF9MSURfQU5HTEUpO1xuXG4gICAgLy8gTGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiBtaW4gYW5kIG1heC5cbiAgICBjb25zdCBvcGFjaXR5ID0gT1BBQ0lUWV9NSU4gKyB0aGlzLmxpZE9wZW5fICogKE9QQUNJVFlfTUFYIC0gT1BBQ0lUWV9NSU4pO1xuICAgIGlmICh0aGlzLnN2Z0dyb3VwXykge1xuICAgICAgdGhpcy5zdmdHcm91cF8uc3R5bGUub3BhY2l0eSA9IG9wYWNpdHkudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5saWRPcGVuXyA+IHRoaXMubWluT3Blbm5lc3NfICYmIHRoaXMubGlkT3Blbl8gPCAxKSB7XG4gICAgICB0aGlzLmxpZFRhc2tfID1cbiAgICAgICAgICBzZXRUaW1lb3V0KHRoaXMuYW5pbWF0ZUxpZF8uYmluZCh0aGlzKSwgQU5JTUFUSU9OX0xFTkdUSCAvIGZyYW1lcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgYW5nbGUgb2YgdGhlIHRyYXNoY2FuJ3MgbGlkLlxuICAgKlxuICAgKiBAcGFyYW0gbGlkQW5nbGUgVGhlIGFuZ2xlIGF0IHdoaWNoIHRvIHNldCB0aGUgbGlkLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRMaWRBbmdsZV8obGlkQW5nbGU6IG51bWJlcikge1xuICAgIGNvbnN0IG9wZW5BdFJpZ2h0ID1cbiAgICAgICAgdGhpcy53b3Jrc3BhY2UudG9vbGJveFBvc2l0aW9uID09PSB0b29sYm94LlBvc2l0aW9uLlJJR0hUIHx8XG4gICAgICAgIHRoaXMud29ya3NwYWNlLmhvcml6b250YWxMYXlvdXQgJiYgdGhpcy53b3Jrc3BhY2UuUlRMO1xuICAgIHRoaXMuc3ZnTGlkXz8uc2V0QXR0cmlidXRlKFxuICAgICAgICAndHJhbnNmb3JtJyxcbiAgICAgICAgJ3JvdGF0ZSgnICsgKG9wZW5BdFJpZ2h0ID8gLWxpZEFuZ2xlIDogbGlkQW5nbGUpICsgJywnICtcbiAgICAgICAgICAgIChvcGVuQXRSaWdodCA/IDQgOiBXSURUSCAtIDQpICsgJywnICsgKExJRF9IRUlHSFQgLSAyKSArICcpJyk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgbWluaW11bSBvcGVubmVzcyBvZiB0aGUgdHJhc2hjYW4gbGlkLiBJZiB0aGUgbGlkIGlzIGN1cnJlbnRseVxuICAgKiBjbG9zZWQsIHRoaXMgd2lsbCB1cGRhdGUgbGlkJ3MgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSBuZXdNaW4gVGhlIG5ldyBtaW5pbXVtIG9wZW5uZXNzIG9mIHRoZSBsaWQuIFNob3VsZCBiZSBiZXR3ZWVuIDBcbiAgICogICAgIGFuZCAxLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRNaW5PcGVubmVzc18obmV3TWluOiBudW1iZXIpIHtcbiAgICB0aGlzLm1pbk9wZW5uZXNzXyA9IG5ld01pbjtcbiAgICBpZiAoIXRoaXMuaXNMaWRPcGVuKSB7XG4gICAgICB0aGlzLnNldExpZEFuZ2xlXyhuZXdNaW4gKiBNQVhfTElEX0FOR0xFKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmxpcCB0aGUgbGlkIHNodXQuXG4gICAqIENhbGxlZCBleHRlcm5hbGx5IGFmdGVyIGEgZHJhZy5cbiAgICovXG4gIGNsb3NlTGlkKCkge1xuICAgIHRoaXMuc2V0TGlkT3BlbihmYWxzZSk7XG4gIH1cblxuICAvKiogSW5zcGVjdCB0aGUgY29udGVudHMgb2YgdGhlIHRyYXNoLiAqL1xuICBjbGljaygpIHtcbiAgICBpZiAoIXRoaXMuaGFzQ29udGVudHNfKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5vcGVuRmx5b3V0KCk7XG4gIH1cblxuICAvKipcbiAgICogRmlyZXMgYSBVSSBldmVudCBmb3IgdHJhc2hjYW4gZmx5b3V0IG9wZW4gb3IgY2xvc2UuXG4gICAqXG4gICAqIEBwYXJhbSB0cmFzaGNhbk9wZW4gV2hldGhlciB0aGUgZmx5b3V0IGlzIG9wZW5pbmcuXG4gICAqL1xuICBwcml2YXRlIGZpcmVVaUV2ZW50Xyh0cmFzaGNhbk9wZW46IGJvb2xlYW4pIHtcbiAgICBjb25zdCB1aUV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlRSQVNIQ0FOX09QRU4pKShcbiAgICAgICAgdHJhc2hjYW5PcGVuLCB0aGlzLndvcmtzcGFjZS5pZCk7XG4gICAgZXZlbnRVdGlscy5maXJlKHVpRXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXZlbnRzIGEgd29ya3NwYWNlIHNjcm9sbCBhbmQgY2xpY2sgZXZlbnQgaWYgdGhlIHRyYXNoY2FuIGhhcyBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEgbW91c2UgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgYmxvY2tNb3VzZURvd25XaGVuT3BlbmFibGVfKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGlmICghdGhpcy5jb250ZW50c0lzT3BlbigpICYmIHRoaXMuaGFzQ29udGVudHNfKCkpIHtcbiAgICAgIC8vIERvbid0IHN0YXJ0IGEgd29ya3NwYWNlIHNjcm9sbC5cbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluZGljYXRlIHRoYXQgdGhlIHRyYXNoY2FuIGNhbiBiZSBjbGlja2VkIChieSBvcGVuaW5nIGl0KSBpZiBpdCBoYXMgYmxvY2tzLlxuICAgKi9cbiAgcHJpdmF0ZSBtb3VzZU92ZXJfKCkge1xuICAgIGlmICh0aGlzLmhhc0NvbnRlbnRzXygpKSB7XG4gICAgICB0aGlzLnNldExpZE9wZW4odHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsb3NlIHRoZSBsaWQgb2YgdGhlIHRyYXNoY2FuIGlmIGl0IHdhcyBvcGVuIChWaXMuIGl0IHdhcyBpbmRpY2F0aW5nIGl0IGhhZFxuICAgKiAgICBibG9ja3MpLlxuICAgKi9cbiAgcHJpdmF0ZSBtb3VzZU91dF8oKSB7XG4gICAgLy8gTm8gbmVlZCB0byBkbyBhIC5oYXNCbG9ja3MgY2hlY2sgaGVyZSBiZWNhdXNlIGlmIGl0IGRvZXNuJ3QgdGhlIHRyYXNoY2FuXG4gICAgLy8gd29uJ3QgYmUgb3BlbiBpbiB0aGUgZmlyc3QgcGxhY2UsIGFuZCBzZXRPcGVuIHdvbid0IHJ1bi5cbiAgICB0aGlzLnNldExpZE9wZW4oZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIEJMT0NLX0RFTEVURSBldmVudC4gQWRkcyBkZWxldGVkIGJsb2NrcyBvbGRYbWwgdG8gdGhlIGNvbnRlbnRcbiAgICogYXJyYXkuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBXb3Jrc3BhY2UgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIG9uRGVsZXRlXyhldmVudDogQWJzdHJhY3QpIHtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2Uub3B0aW9ucy5tYXhUcmFzaGNhbkNvbnRlbnRzIDw9IDAgfHxcbiAgICAgICAgZXZlbnQudHlwZSAhPT0gZXZlbnRVdGlscy5CTE9DS19ERUxFVEUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZGVsZXRlRXZlbnQgPSBldmVudCBhcyBCbG9ja0RlbGV0ZTtcbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gZXZlbnRVdGlscy5CTE9DS19ERUxFVEUgJiYgIWRlbGV0ZUV2ZW50Lndhc1NoYWRvdykge1xuICAgICAgaWYgKCFkZWxldGVFdmVudC5vbGRKc29uKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRW5jb3VudGVyZWQgYSBkZWxldGUgZXZlbnQgd2l0aG91dCBwcm9wZXIgb2xkSnNvbicpO1xuICAgICAgfVxuICAgICAgY29uc3QgY2xlYW5lZEpzb24gPVxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuY2xlYW5CbG9ja0pzb25fKGRlbGV0ZUV2ZW50Lm9sZEpzb24pKTtcbiAgICAgIGlmICh0aGlzLmNvbnRlbnRzXy5pbmRleE9mKGNsZWFuZWRKc29uKSAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5jb250ZW50c18udW5zaGlmdChjbGVhbmVkSnNvbik7XG4gICAgICB3aGlsZSAodGhpcy5jb250ZW50c18ubGVuZ3RoID5cbiAgICAgICAgICAgICB0aGlzLndvcmtzcGFjZS5vcHRpb25zLm1heFRyYXNoY2FuQ29udGVudHMpIHtcbiAgICAgICAgdGhpcy5jb250ZW50c18ucG9wKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2V0TWluT3Blbm5lc3NfKEhBU19CTE9DS1NfTElEX0FOR0xFKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgSlNPTiByZXByZXNlbnRpbmcgYSBibG9jayBpbnRvIHRleHQgdGhhdCBjYW4gYmUgc3RvcmVkIGluIHRoZVxuICAgKiBjb250ZW50IGFycmF5LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBBIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYSBibG9jaydzIHN0YXRlLlxuICAgKiBAcmV0dXJucyBBIEJsb2NrSW5mbyBvYmplY3QgY29ycmVzcG9uZGluZyB0byB0aGUgSlNPTiwgY2xlYW5lZCBvZiBhbGxcbiAgICogICAgIHVubmVjZXNzYXJ5IGF0dHJpYnV0ZXMuXG4gICAqL1xuICBwcml2YXRlIGNsZWFuQmxvY2tKc29uXyhqc29uOiBibG9ja3MuU3RhdGUpOiBCbG9ja0luZm8ge1xuICAgIC8vIENyZWF0ZSBhIGRlZXAgY29weS5cbiAgICBqc29uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShqc29uKSkgYXMgYmxvY2tzLlN0YXRlO1xuXG4gICAgLyoqXG4gICAgICogUmVzaGFwZSBKU09OIGludG8gYSBuaWNlciBmb3JtYXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ganNvbiBUaGUgSlNPTiB0byBjbGVhbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbGVhblJlYyhqc29uOiBibG9ja3MuU3RhdGUpIHtcbiAgICAgIGlmICghanNvbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGRlbGV0ZSBqc29uWydpZCddO1xuICAgICAgZGVsZXRlIGpzb25bJ3gnXTtcbiAgICAgIGRlbGV0ZSBqc29uWyd5J107XG4gICAgICBkZWxldGUganNvblsnZW5hYmxlZCddO1xuXG4gICAgICBpZiAoanNvblsnaWNvbnMnXSAmJiBqc29uWydpY29ucyddWydjb21tZW50J10pIHtcbiAgICAgICAgY29uc3QgY29tbWVudCA9IGpzb25bJ2ljb25zJ11bJ2NvbW1lbnQnXTtcbiAgICAgICAgZGVsZXRlIGNvbW1lbnRbJ2hlaWdodCddO1xuICAgICAgICBkZWxldGUgY29tbWVudFsnd2lkdGgnXTtcbiAgICAgICAgZGVsZXRlIGNvbW1lbnRbJ3Bpbm5lZCddO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpbnB1dHMgPSBqc29uWydpbnB1dHMnXTtcbiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBpbnB1dHMpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBpbnB1dHNbbmFtZV07XG4gICAgICAgIGNvbnN0IGJsb2NrID0gaW5wdXRbJ2Jsb2NrJ107XG4gICAgICAgIGNvbnN0IHNoYWRvdyA9IGlucHV0WydzaGFkb3cnXTtcbiAgICAgICAgaWYgKGJsb2NrKSB7XG4gICAgICAgICAgY2xlYW5SZWMoYmxvY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGFkb3cpIHtcbiAgICAgICAgICBjbGVhblJlYyhzaGFkb3cpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoanNvblsnbmV4dCddKSB7XG4gICAgICAgIGNvbnN0IG5leHQgPSBqc29uWyduZXh0J107XG4gICAgICAgIGNvbnN0IGJsb2NrID0gbmV4dFsnYmxvY2snXTtcbiAgICAgICAgY29uc3Qgc2hhZG93ID0gbmV4dFsnc2hhZG93J107XG4gICAgICAgIGlmIChibG9jaykge1xuICAgICAgICAgIGNsZWFuUmVjKGJsb2NrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hhZG93KSB7XG4gICAgICAgICAgY2xlYW5SZWMoc2hhZG93KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNsZWFuUmVjKGpzb24pO1xuXG4gICAgY29uc3QgYmxvY2tJbmZvOiBCbG9ja0luZm8gPSB7XG4gICAgICAna2luZCc6ICdCTE9DSycsXG4gICAgICAuLi5qc29uLFxuICAgIH07XG4gICAgcmV0dXJuIGJsb2NrSW5mbztcbiAgfVxufVxuXG5cbi8qKiBXaWR0aCBvZiBib3RoIHRoZSB0cmFzaCBjYW4gYW5kIGxpZCBpbWFnZXMuICovXG5jb25zdCBXSURUSCA9IDQ3O1xuXG4vKiogSGVpZ2h0IG9mIHRoZSB0cmFzaGNhbiBpbWFnZSAobWludXMgbGlkKS4gKi9cbmNvbnN0IEJPRFlfSEVJR0hUID0gNDQ7XG5cbi8qKiBIZWlnaHQgb2YgdGhlIGxpZCBpbWFnZS4gKi9cbmNvbnN0IExJRF9IRUlHSFQgPSAxNjtcblxuLyoqIERpc3RhbmNlIGJldHdlZW4gdHJhc2hjYW4gYW5kIGJvdHRvbSBvciB0b3AgZWRnZSBvZiB3b3Jrc3BhY2UuICovXG5jb25zdCBNQVJHSU5fVkVSVElDQUwgPSAyMDtcblxuLyoqIERpc3RhbmNlIGJldHdlZW4gdHJhc2hjYW4gYW5kIHJpZ2h0IG9yIGxlZnQgZWRnZSBvZiB3b3Jrc3BhY2UuICovXG5jb25zdCBNQVJHSU5fSE9SSVpPTlRBTCA9IDIwO1xuXG4vKiogRXh0ZW50IG9mIGhvdHNwb3Qgb24gYWxsIHNpZGVzIGJleW9uZCB0aGUgc2l6ZSBvZiB0aGUgaW1hZ2UuICovXG5jb25zdCBNQVJHSU5fSE9UU1BPVCA9IDEwO1xuXG4vKiogTG9jYXRpb24gb2YgdHJhc2hjYW4gaW4gc3ByaXRlIGltYWdlLiAqL1xuY29uc3QgU1BSSVRFX0xFRlQgPSAwO1xuXG4vKiogTG9jYXRpb24gb2YgdHJhc2hjYW4gaW4gc3ByaXRlIGltYWdlLiAqL1xuY29uc3QgU1BSSVRFX1RPUCA9IDMyO1xuXG4vKipcbiAqIFRoZSBvcGVubmVzcyBvZiB0aGUgbGlkIHdoZW4gdGhlIHRyYXNoY2FuIGNvbnRhaW5zIGJsb2Nrcy5cbiAqICAgICgwLjAgPSBjbG9zZWQsIDEuMCA9IG9wZW4pXG4gKi9cbmNvbnN0IEhBU19CTE9DS1NfTElEX0FOR0xFID0gMC4xO1xuXG4vKiogVGhlIGxlbmd0aCBvZiB0aGUgbGlkIG9wZW4vY2xvc2UgYW5pbWF0aW9uIGluIG1pbGxpc2Vjb25kcy4gKi9cbmNvbnN0IEFOSU1BVElPTl9MRU5HVEggPSA4MDtcblxuLyoqIFRoZSBudW1iZXIgb2YgZnJhbWVzIGluIHRoZSBhbmltYXRpb24uICovXG5jb25zdCBBTklNQVRJT05fRlJBTUVTID0gNDtcblxuLyoqIFRoZSBtaW5pbXVtIChyZXN0aW5nKSBvcGFjaXR5IG9mIHRoZSB0cmFzaGNhbiBhbmQgbGlkLiAqL1xuY29uc3QgT1BBQ0lUWV9NSU4gPSAwLjQ7XG5cbi8qKiBUaGUgbWF4aW11bSAoaG92ZXJlZCkgb3BhY2l0eSBvZiB0aGUgdHJhc2hjYW4gYW5kIGxpZC4gKi9cbmNvbnN0IE9QQUNJVFlfTUFYID0gMC44O1xuXG4vKipcbiAqIFRoZSBtYXhpbXVtIGFuZ2xlIHRoZSB0cmFzaGNhbiBsaWQgY2FuIG9wZW5zIHRvLiBBdCB0aGUgZW5kIG9mIHRoZSBvcGVuXG4gKiBhbmltYXRpb24gdGhlIGxpZCB3aWxsIGJlIG9wZW4gdG8gdGhpcyBhbmdsZS5cbiAqL1xuY29uc3QgTUFYX0xJRF9BTkdMRSA9IDQ1O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEV2ZW50cyBmaXJlZCBhcyBhIHJlc3VsdCBvZiBzZWxlY3RpbmcgYW4gaXRlbSBvbiB0aGUgdG9vbGJveC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuVG9vbGJveEl0ZW1TZWxlY3QnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHtBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB0b29sYm94IGl0ZW0gc2VsZWN0IGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5Ub29sYm94SXRlbVNlbGVjdFxuICovXG5leHBvcnQgY2xhc3MgVG9vbGJveEl0ZW1TZWxlY3QgZXh0ZW5kcyBVaUJhc2Uge1xuICBvbGRJdGVtPzogc3RyaW5nO1xuICBuZXdJdGVtPzogc3RyaW5nO1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5UT09MQk9YX0lURU1fU0VMRUNUO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X29sZEl0ZW0gVGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLlxuICAgKiAgICAgVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X25ld0l0ZW0gVGhlIG5ld2x5IHNlbGVjdGVkIHRvb2xib3ggaXRlbS4gVW5kZWZpbmVkIGZvciBhIGJsYW5rXG4gICAqICAgICBldmVudC5cbiAgICogQHBhcmFtIG9wdF93b3Jrc3BhY2VJZCBUaGUgd29ya3NwYWNlIGlkZW50aWZpZXIgZm9yIHRoaXMgZXZlbnQuXG4gICAqICAgIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X29sZEl0ZW0/OiBzdHJpbmd8bnVsbCwgb3B0X25ld0l0ZW0/OiBzdHJpbmd8bnVsbCxcbiAgICAgIG9wdF93b3Jrc3BhY2VJZD86IHN0cmluZykge1xuICAgIHN1cGVyKG9wdF93b3Jrc3BhY2VJZCk7XG5cbiAgICAvKiogVGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLiAqL1xuICAgIHRoaXMub2xkSXRlbSA9IG9wdF9vbGRJdGVtID8/IHVuZGVmaW5lZDtcblxuICAgIC8qKiBUaGUgbmV3bHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLiAqL1xuICAgIHRoaXMubmV3SXRlbSA9IG9wdF9uZXdJdGVtID8/IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSB0b0pzb24oKTogVG9vbGJveEl0ZW1TZWxlY3RKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgVG9vbGJveEl0ZW1TZWxlY3RKc29uO1xuICAgIGpzb25bJ29sZEl0ZW0nXSA9IHRoaXMub2xkSXRlbTtcbiAgICBqc29uWyduZXdJdGVtJ10gPSB0aGlzLm5ld0l0ZW07XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogVG9vbGJveEl0ZW1TZWxlY3RKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLlRvb2xib3hJdGVtU2VsZWN0LnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMub2xkSXRlbSA9IGpzb25bJ29sZEl0ZW0nXTtcbiAgICB0aGlzLm5ld0l0ZW0gPSBqc29uWyduZXdJdGVtJ107XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIFRvb2xib3hJdGVtU2VsZWN0LCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0XG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mXG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oXG4gICAgICBqc29uOiBUb29sYm94SXRlbVNlbGVjdEpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlLFxuICAgICAgZXZlbnQ/OiBhbnkpOiBUb29sYm94SXRlbVNlbGVjdCB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBUb29sYm94SXRlbVNlbGVjdCgpKSBhc1xuICAgICAgICBUb29sYm94SXRlbVNlbGVjdDtcbiAgICBuZXdFdmVudC5vbGRJdGVtID0ganNvblsnb2xkSXRlbSddO1xuICAgIG5ld0V2ZW50Lm5ld0l0ZW0gPSBqc29uWyduZXdJdGVtJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbGJveEl0ZW1TZWxlY3RKc29uIGV4dGVuZHMgQWJzdHJhY3RFdmVudEpzb24ge1xuICBvbGRJdGVtPzogc3RyaW5nO1xuICBuZXdJdGVtPzogc3RyaW5nO1xufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihcbiAgICByZWdpc3RyeS5UeXBlLkVWRU5ULCBldmVudFV0aWxzLlRPT0xCT1hfSVRFTV9TRUxFQ1QsIFRvb2xib3hJdGVtU2VsZWN0KTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbiBpdGVtIGluIHRoZSB0b29sYm94LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRvb2xib3hJdGVtJyk7XG5cbmltcG9ydCB0eXBlIHtJQ29sbGFwc2libGVUb29sYm94SXRlbX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX2NvbGxhcHNpYmxlX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgdHlwZSB7SVRvb2xib3h9IGZyb20gJy4uL2ludGVyZmFjZXMvaV90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtJVG9vbGJveEl0ZW19IGZyb20gJy4uL2ludGVyZmFjZXMvaV90b29sYm94X2l0ZW0uanMnO1xuaW1wb3J0ICogYXMgaWRHZW5lcmF0b3IgZnJvbSAnLi4vdXRpbHMvaWRnZW5lcmF0b3IuanMnO1xuaW1wb3J0IHR5cGUgKiBhcyB0b29sYm94IGZyb20gJy4uL3V0aWxzL3Rvb2xib3guanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYW4gaXRlbSBpbiB0aGUgdG9vbGJveC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sYm94SXRlbVxuICovXG5leHBvcnQgY2xhc3MgVG9vbGJveEl0ZW0gaW1wbGVtZW50cyBJVG9vbGJveEl0ZW0ge1xuICBwcm90ZWN0ZWQgaWRfOiBzdHJpbmc7XG4gIHByb3RlY3RlZCBwYXJlbnRfOiBJQ29sbGFwc2libGVUb29sYm94SXRlbXxudWxsO1xuICBwcm90ZWN0ZWQgbGV2ZWxfOiBudW1iZXI7XG4gIHByb3RlY3RlZCB0b29sYm94SXRlbURlZl86IHRvb2xib3guVG9vbGJveEl0ZW1JbmZvfG51bGw7XG4gIHByb3RlY3RlZCB3b3Jrc3BhY2VfOiBXb3Jrc3BhY2VTdmc7XG4gIC8qKiBUaGUgdG9vbGJveCB0aGlzIGNhdGVnb3J5IGJlbG9uZ3MgdG8uICovXG4gIHByb3RlY3RlZCByZWFkb25seSBwYXJlbnRUb29sYm94XzogSVRvb2xib3g7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB0b29sYm94SXRlbURlZiBUaGUgSlNPTiBkZWZpbmluZyB0aGUgdG9vbGJveCBpdGVtLlxuICAgKiBAcGFyYW0gcGFyZW50VG9vbGJveCBUaGUgdG9vbGJveCB0aGF0IGhvbGRzIHRoZSB0b29sYm94IGl0ZW0uXG4gICAqIEBwYXJhbSBvcHRfcGFyZW50IFRoZSBwYXJlbnQgdG9vbGJveCBpdGVtIG9yIG51bGwgaWYgdGhlIGNhdGVnb3J5IGRvZXMgbm90XG4gICAqICAgICBoYXZlIGEgcGFyZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICB0b29sYm94SXRlbURlZjogdG9vbGJveC5Ub29sYm94SXRlbUluZm8sIHBhcmVudFRvb2xib3g6IElUb29sYm94LFxuICAgICAgb3B0X3BhcmVudD86IElDb2xsYXBzaWJsZVRvb2xib3hJdGVtKSB7XG4gICAgLyoqIFRoZSBJRCBmb3IgdGhlIGNhdGVnb3J5LiAqL1xuICAgIHRoaXMuaWRfID0gKHRvb2xib3hJdGVtRGVmIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbJ3Rvb2xib3hpdGVtaWQnXSB8fFxuICAgICAgICBpZEdlbmVyYXRvci5nZXROZXh0VW5pcXVlSWQoKTtcblxuICAgIC8qKiBUaGUgcGFyZW50IG9mIHRoZSBjYXRlZ29yeS4gKi9cbiAgICB0aGlzLnBhcmVudF8gPSBvcHRfcGFyZW50IHx8IG51bGw7XG5cbiAgICAvKiogVGhlIGxldmVsIHRoYXQgdGhlIGNhdGVnb3J5IGlzIG5lc3RlZCBhdC4gKi9cbiAgICB0aGlzLmxldmVsXyA9IHRoaXMucGFyZW50XyA/IHRoaXMucGFyZW50Xy5nZXRMZXZlbCgpICsgMSA6IDA7XG5cbiAgICAvKiogVGhlIEpTT04gZGVmaW5pdGlvbiBvZiB0aGUgdG9vbGJveCBpdGVtLiAqL1xuICAgIHRoaXMudG9vbGJveEl0ZW1EZWZfID0gdG9vbGJveEl0ZW1EZWY7XG5cbiAgICB0aGlzLnBhcmVudFRvb2xib3hfID0gcGFyZW50VG9vbGJveDtcblxuICAgIC8qKiBUaGUgd29ya3NwYWNlIG9mIHRoZSBwYXJlbnQgdG9vbGJveC4gKi9cbiAgICB0aGlzLndvcmtzcGFjZV8gPSB0aGlzLnBhcmVudFRvb2xib3hfLmdldFdvcmtzcGFjZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemVzIHRoZSB0b29sYm94IGl0ZW0uXG4gICAqIFRoaXMgaW5jbHVkZXMgY3JlYXRpbmcgdGhlIERPTSBhbmQgdXBkYXRpbmcgdGhlIHN0YXRlIG9mIGFueSBpdGVtcyBiYXNlZFxuICAgKiBvbiB0aGUgaW5mbyBvYmplY3QuXG4gICAqL1xuICBpbml0KCkge31cbiAgLy8gTm8tb3AgYnkgZGVmYXVsdC5cblxuICAvKipcbiAgICogR2V0cyB0aGUgZGl2IGZvciB0aGUgdG9vbGJveCBpdGVtLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgZGl2IGZvciB0aGUgdG9vbGJveCBpdGVtLlxuICAgKi9cbiAgZ2V0RGl2KCk6IEVsZW1lbnR8bnVsbCB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgSFRNTCBlbGVtZW50IHRoYXQgaXMgY2xpY2thYmxlLlxuICAgKiBUaGUgcGFyZW50IHRvb2xib3ggZWxlbWVudCByZWNlaXZlcyBjbGlja3MuIFRoZSBwYXJlbnQgdG9vbGJveCB3aWxsIGFkZCBhblxuICAgKiBJRCB0byB0aGlzIGVsZW1lbnQgc28gaXQgY2FuIHBhc3MgdGhlIG9uQ2xpY2sgZXZlbnQgdG8gdGhlIGNvcnJlY3RcbiAgICogdG9vbGJveEl0ZW0uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBIVE1MIGVsZW1lbnQgdGhhdCByZWNlaXZlcyBjbGlja3MsIG9yIG51bGwgaWYgdGhpcyBpdGVtIHNob3VsZFxuICAgKiAgICAgbm90IHJlY2VpdmUgY2xpY2tzLlxuICAgKi9cbiAgZ2V0Q2xpY2tUYXJnZXQoKTogRWxlbWVudHxudWxsIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoaXMgdG9vbGJveCBpdGVtLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgSUQgZm9yIHRoZSB0b29sYm94IGl0ZW0uXG4gICAqL1xuICBnZXRJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlkXztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBwYXJlbnQgaWYgdGhlIHRvb2xib3ggaXRlbSBpcyBuZXN0ZWQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBwYXJlbnQgdG9vbGJveCBpdGVtLCBvciBudWxsIGlmIHRoaXMgdG9vbGJveCBpdGVtIGlzIG5vdFxuICAgKiAgICAgbmVzdGVkLlxuICAgKi9cbiAgZ2V0UGFyZW50KCk6IElDb2xsYXBzaWJsZVRvb2xib3hJdGVtfG51bGwge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIG5lc3RlZCBsZXZlbCBvZiB0aGUgY2F0ZWdvcnkuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuZXN0ZWQgbGV2ZWwgb2YgdGhlIGNhdGVnb3J5LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldExldmVsKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubGV2ZWxfO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHRvb2xib3ggaXRlbSBpcyBzZWxlY3RhYmxlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB0b29sYm94IGl0ZW0gY2FuIGJlIHNlbGVjdGVkLlxuICAgKi9cbiAgaXNTZWxlY3RhYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSB0b29sYm94IGl0ZW0gaXMgY29sbGFwc2libGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHRvb2xib3ggaXRlbSBpcyBjb2xsYXBzaWJsZS5cbiAgICovXG4gIGlzQ29sbGFwc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgdGhpcyB0b29sYm94IGl0ZW0uIE5vLW9wIGJ5IGRlZmF1bHQuICovXG4gIGRpc3Bvc2UoKSB7fVxuXG4gIC8qKlxuICAgKiBTZXRzIHdoZXRoZXIgdGhlIGNhdGVnb3J5IGlzIHZpc2libGUgb3Igbm90LlxuICAgKiBGb3IgYSBjYXRlZ29yeSB0byBiZSB2aXNpYmxlIGl0cyBwYXJlbnQgY2F0ZWdvcnkgbXVzdCBhbHNvIGJlIGV4cGFuZGVkLlxuICAgKlxuICAgKiBAcGFyYW0gX2lzVmlzaWJsZSBUcnVlIGlmIGNhdGVnb3J5IHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKi9cbiAgc2V0VmlzaWJsZV8oX2lzVmlzaWJsZTogYm9vbGVhbikge31cbn1cbi8vIG5vcCBieSBkZWZhdWx0XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQSB0b29sYm94IGNhdGVnb3J5IHVzZWQgdG8gb3JnYW5pemUgYmxvY2tzIGluIHRoZSB0b29sYm94LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRvb2xib3hDYXRlZ29yeScpO1xuXG5pbXBvcnQgKiBhcyBDc3MgZnJvbSAnLi4vY3NzLmpzJztcbmltcG9ydCB0eXBlIHtJQ29sbGFwc2libGVUb29sYm94SXRlbX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX2NvbGxhcHNpYmxlX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgdHlwZSB7SVNlbGVjdGFibGVUb29sYm94SXRlbX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3NlbGVjdGFibGVfdG9vbGJveF9pdGVtLmpzJztcbmltcG9ydCB0eXBlIHtJVG9vbGJveH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Rvb2xib3guanMnO1xuaW1wb3J0IHR5cGUge0lUb29sYm94SXRlbX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgdHlwZSB7Q2F0ZWdvcnlJbmZvLCBEeW5hbWljQ2F0ZWdvcnlJbmZvLCBGbHlvdXREZWZpbml0aW9uLCBGbHlvdXRJdGVtSW5mbywgRmx5b3V0SXRlbUluZm9BcnJheSwgU3RhdGljQ2F0ZWdvcnlJbmZvfSBmcm9tICcuLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIGFyaWEgZnJvbSAnLi4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQgKiBhcyBjb2xvdXJVdGlscyBmcm9tICcuLi91dGlscy9jb2xvdXIuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4uL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4uL3V0aWxzL3BhcnNpbmcuanMnO1xuaW1wb3J0ICogYXMgdG9vbGJveCBmcm9tICcuLi91dGlscy90b29sYm94LmpzJztcblxuaW1wb3J0IHtUb29sYm94SXRlbX0gZnJvbSAnLi90b29sYm94X2l0ZW0uanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgY2F0ZWdvcnkgaW4gYSB0b29sYm94LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlRvb2xib3hDYXRlZ29yeVxuICovXG5leHBvcnQgY2xhc3MgVG9vbGJveENhdGVnb3J5IGV4dGVuZHMgVG9vbGJveEl0ZW0gaW1wbGVtZW50c1xuICAgIElTZWxlY3RhYmxlVG9vbGJveEl0ZW0ge1xuICAvKiogTmFtZSB1c2VkIGZvciByZWdpc3RlcmluZyBhIHRvb2xib3ggY2F0ZWdvcnkuICovXG4gIHN0YXRpYyByZWdpc3RyYXRpb25OYW1lID0gJ2NhdGVnb3J5JztcblxuICAvKiogVGhlIG51bWJlciBvZiBwaXhlbHMgdG8gbW92ZSB0aGUgY2F0ZWdvcnkgb3ZlciBhdCBlYWNoIG5lc3RlZCBsZXZlbC4gKi9cbiAgc3RhdGljIG5lc3RlZFBhZGRpbmcgPSAxOTtcblxuICAvKiogVGhlIHdpZHRoIGluIHBpeGVscyBvZiB0aGUgc3RyaXAgb2YgY29sb3VyIG5leHQgdG8gZWFjaCBjYXRlZ29yeS4gKi9cbiAgc3RhdGljIGJvcmRlcldpZHRoID0gODtcblxuICAvKipcbiAgICogVGhlIGRlZmF1bHQgY29sb3VyIG9mIHRoZSBjYXRlZ29yeS4gVGhpcyBpcyB1c2VkIGFzIHRoZSBiYWNrZ3JvdW5kIGNvbG91clxuICAgKiBvZiB0aGUgY2F0ZWdvcnkgd2hlbiBpdCBpcyBzZWxlY3RlZC5cbiAgICovXG4gIHN0YXRpYyBkZWZhdWx0QmFja2dyb3VuZENvbG91ciA9ICcjNTdlJztcblxuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBvdmVycmlkZSB0b29sYm94SXRlbURlZl8hOiBDYXRlZ29yeUluZm87XG5cbiAgLyoqIFRoZSBuYW1lIHRoYXQgd2lsbCBiZSBkaXNwbGF5ZWQgb24gdGhlIGNhdGVnb3J5LiAqL1xuICBwcm90ZWN0ZWQgbmFtZV8gPSAnJztcblxuICAvKiogVGhlIGNvbG91ciBvZiB0aGUgY2F0ZWdvcnkuICovXG4gIHByb3RlY3RlZCBjb2xvdXJfID0gJyc7XG5cbiAgLyoqIFRoZSBodG1sIGNvbnRhaW5lciBmb3IgdGhlIGNhdGVnb3J5LiAqL1xuICBwcm90ZWN0ZWQgaHRtbERpdl86IEhUTUxEaXZFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgaHRtbCBlbGVtZW50IGZvciB0aGUgY2F0ZWdvcnkgcm93LiAqL1xuICBwcm90ZWN0ZWQgcm93RGl2XzogSFRNTERpdkVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBodG1sIGVsZW1lbnQgdGhhdCBob2xkcyBjaGlsZHJlbiBlbGVtZW50cyBvZiB0aGUgY2F0ZWdvcnkgcm93LiAqL1xuICBwcm90ZWN0ZWQgcm93Q29udGVudHNfOiBIVE1MRGl2RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIGh0bWwgZWxlbWVudCBmb3IgdGhlIHRvb2xib3ggaWNvbi4gKi9cbiAgcHJvdGVjdGVkIGljb25Eb21fOiBFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgaHRtbCBlbGVtZW50IGZvciB0aGUgdG9vbGJveCBsYWJlbC4gKi9cbiAgcHJvdGVjdGVkIGxhYmVsRG9tXzogRWxlbWVudHxudWxsID0gbnVsbDtcbiAgcHJvdGVjdGVkIGNzc0NvbmZpZ186IENzc0NvbmZpZztcblxuICAvKiogVHJ1ZSBpZiB0aGUgY2F0ZWdvcnkgaXMgbWVhbnQgdG8gYmUgaGlkZGVuLCBmYWxzZSBvdGhlcndpc2UuICovXG4gIHByb3RlY3RlZCBpc0hpZGRlbl8gPSBmYWxzZTtcblxuICAvKiogVHJ1ZSBpZiB0aGlzIGNhdGVnb3J5IGlzIGRpc2FibGVkLCBmYWxzZSBvdGhlcndpc2UuICovXG4gIHByb3RlY3RlZCBpc0Rpc2FibGVkXyA9IGZhbHNlO1xuXG4gIC8qKiBUaGUgZmx5b3V0IGl0ZW1zIGZvciB0aGlzIGNhdGVnb3J5LiAqL1xuICBwcm90ZWN0ZWQgZmx5b3V0SXRlbXNfOiBzdHJpbmd8Rmx5b3V0SXRlbUluZm9BcnJheSA9IFtdO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY2F0ZWdvcnlEZWYgVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBjYXRlZ29yeSBpbiB0aGVcbiAgICogICAgIHRvb2xib3guXG4gICAqIEBwYXJhbSBwYXJlbnRUb29sYm94IFRoZSBwYXJlbnQgdG9vbGJveCBmb3IgdGhlIGNhdGVnb3J5LlxuICAgKiBAcGFyYW0gb3B0X3BhcmVudCBUaGUgcGFyZW50IGNhdGVnb3J5IG9yIG51bGwgaWYgdGhlIGNhdGVnb3J5IGRvZXMgbm90IGhhdmVcbiAgICogICAgIGEgcGFyZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBjYXRlZ29yeURlZjogQ2F0ZWdvcnlJbmZvLCBwYXJlbnRUb29sYm94OiBJVG9vbGJveCxcbiAgICAgIG9wdF9wYXJlbnQ/OiBJQ29sbGFwc2libGVUb29sYm94SXRlbSkge1xuICAgIHN1cGVyKGNhdGVnb3J5RGVmLCBwYXJlbnRUb29sYm94LCBvcHRfcGFyZW50KTtcblxuICAgIC8qKiBBbGwgdGhlIGNzcyBjbGFzcyBuYW1lcyB0aGF0IGFyZSB1c2VkIHRvIGNyZWF0ZSBhIGNhdGVnb3J5LiAqL1xuICAgIHRoaXMuY3NzQ29uZmlnXyA9IHRoaXMubWFrZURlZmF1bHRDc3NDb25maWdfKCk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIHRvb2xib3ggaXRlbS5cbiAgICogVGhpcyBpbmNsdWRlcyBjcmVhdGluZyB0aGUgRE9NIGFuZCB1cGRhdGluZyB0aGUgc3RhdGUgb2YgYW55IGl0ZW1zIGJhc2VkXG4gICAqIG9uIHRoZSBpbmZvIG9iamVjdC5cbiAgICogSW5pdCBzaG91bGQgYmUgY2FsbGVkIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBjb25zdHJ1Y3Rpb24gb2YgdGhlIHRvb2xib3hcbiAgICogaXRlbSwgdG8gZW5zdXJlIHRoYXQgdGhlIGNhdGVnb3J5IGNvbnRlbnRzIGFyZSBwcm9wZXJseSBwYXJzZWQuXG4gICAqL1xuICBvdmVycmlkZSBpbml0KCkge1xuICAgIHRoaXMucGFyc2VDYXRlZ29yeURlZl8odGhpcy50b29sYm94SXRlbURlZl8pO1xuICAgIHRoaXMucGFyc2VDb250ZW50c18odGhpcy50b29sYm94SXRlbURlZl8pO1xuICAgIHRoaXMuY3JlYXRlRG9tXygpO1xuICAgIGlmICh0aGlzLnRvb2xib3hJdGVtRGVmX1snaGlkZGVuJ10gPT09ICd0cnVlJykge1xuICAgICAgdGhpcy5oaWRlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gb2JqZWN0IGhvbGRpbmcgdGhlIGRlZmF1bHQgY2xhc3NlcyBmb3IgYSBjYXRlZ29yeS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGhvbGRpbmcgYWxsIHRoZSBDU1MgY2xhc3NlcyBmb3IgYVxuICAgKiAgICAgY2F0ZWdvcnkuXG4gICAqL1xuICBwcm90ZWN0ZWQgbWFrZURlZmF1bHRDc3NDb25maWdfKCk6IENzc0NvbmZpZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdjb250YWluZXInOiAnYmxvY2tseVRvb2xib3hDYXRlZ29yeScsXG4gICAgICAncm93JzogJ2Jsb2NrbHlUcmVlUm93JyxcbiAgICAgICdyb3djb250ZW50Y29udGFpbmVyJzogJ2Jsb2NrbHlUcmVlUm93Q29udGVudENvbnRhaW5lcicsXG4gICAgICAnaWNvbic6ICdibG9ja2x5VHJlZUljb24nLFxuICAgICAgJ2xhYmVsJzogJ2Jsb2NrbHlUcmVlTGFiZWwnLFxuICAgICAgJ2NvbnRlbnRzJzogJ2Jsb2NrbHlUb29sYm94Q29udGVudHMnLFxuICAgICAgJ3NlbGVjdGVkJzogJ2Jsb2NrbHlUcmVlU2VsZWN0ZWQnLFxuICAgICAgJ29wZW5pY29uJzogJ2Jsb2NrbHlUcmVlSWNvbk9wZW4nLFxuICAgICAgJ2Nsb3NlZGljb24nOiAnYmxvY2tseVRyZWVJY29uQ2xvc2VkJyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlcyB0aGUgY29udGVudHMgYXJyYXkgZGVwZW5kaW5nIG9uIGlmIHRoZSBjYXRlZ29yeSBpcyBhIGR5bmFtaWNcbiAgICogY2F0ZWdvcnksIG9yIGlmIGl0cyBjb250ZW50cyBhcmUgbWVhbnQgdG8gYmUgc2hvd24gaW4gdGhlIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIGNhdGVnb3J5RGVmIFRoZSBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gY3JlYXRlIGEgY2F0ZWdvcnkuXG4gICAqL1xuICBwcm90ZWN0ZWQgcGFyc2VDb250ZW50c18oY2F0ZWdvcnlEZWY6IENhdGVnb3J5SW5mbykge1xuICAgIGlmICgnY3VzdG9tJyBpbiBjYXRlZ29yeURlZikge1xuICAgICAgdGhpcy5mbHlvdXRJdGVtc18gPSBjYXRlZ29yeURlZlsnY3VzdG9tJ107XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvbnRlbnRzID0gY2F0ZWdvcnlEZWZbJ2NvbnRlbnRzJ107XG4gICAgICBpZiAoIWNvbnRlbnRzKSByZXR1cm47XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29udGVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgaXRlbURlZiA9IGNvbnRlbnRzW2ldO1xuICAgICAgICBjb25zdCBmbHlvdXRJdGVtID0gaXRlbURlZiBhcyBGbHlvdXRJdGVtSW5mbztcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5mbHlvdXRJdGVtc18pKSB7XG4gICAgICAgICAgdGhpcy5mbHlvdXRJdGVtc18ucHVzaChmbHlvdXRJdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZXMgdGhlIG5vbi1jb250ZW50cyBwYXJ0cyBvZiB0aGUgY2F0ZWdvcnkgZGVmLlxuICAgKlxuICAgKiBAcGFyYW0gY2F0ZWdvcnlEZWYgVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBjYXRlZ29yeS5cbiAgICovXG4gIHByb3RlY3RlZCBwYXJzZUNhdGVnb3J5RGVmXyhjYXRlZ29yeURlZjogQ2F0ZWdvcnlJbmZvKSB7XG4gICAgdGhpcy5uYW1lXyA9ICduYW1lJyBpbiBjYXRlZ29yeURlZiA/XG4gICAgICAgIHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKGNhdGVnb3J5RGVmWyduYW1lJ10pIDpcbiAgICAgICAgJyc7XG4gICAgdGhpcy5jb2xvdXJfID0gdGhpcy5nZXRDb2xvdXJfKGNhdGVnb3J5RGVmKTtcbiAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICB0aGlzLmNzc0NvbmZpZ18sXG4gICAgICAgIGNhdGVnb3J5RGVmWydjc3Njb25maWcnXSB8fCAoY2F0ZWdvcnlEZWYgYXMgYW55KVsnY3NzQ29uZmlnJ10pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIERPTSBmb3IgdGhlIGNhdGVnb3J5LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcGFyZW50IGVsZW1lbnQgZm9yIHRoZSBjYXRlZ29yeS5cbiAgICovXG4gIHByb3RlY3RlZCBjcmVhdGVEb21fKCk6IEhUTUxEaXZFbGVtZW50IHtcbiAgICB0aGlzLmh0bWxEaXZfID0gdGhpcy5jcmVhdGVDb250YWluZXJfKCk7XG4gICAgYXJpYS5zZXRSb2xlKHRoaXMuaHRtbERpdl8sIGFyaWEuUm9sZS5UUkVFSVRFTSk7XG4gICAgYXJpYS5zZXRTdGF0ZSh0aGlzLmh0bWxEaXZfLCBhcmlhLlN0YXRlLlNFTEVDVEVELCBmYWxzZSk7XG4gICAgYXJpYS5zZXRTdGF0ZSh0aGlzLmh0bWxEaXZfLCBhcmlhLlN0YXRlLkxFVkVMLCB0aGlzLmxldmVsXyk7XG5cbiAgICB0aGlzLnJvd0Rpdl8gPSB0aGlzLmNyZWF0ZVJvd0NvbnRhaW5lcl8oKTtcbiAgICB0aGlzLnJvd0Rpdl8uc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJztcbiAgICB0aGlzLmh0bWxEaXZfLmFwcGVuZENoaWxkKHRoaXMucm93RGl2Xyk7XG5cbiAgICB0aGlzLnJvd0NvbnRlbnRzXyA9IHRoaXMuY3JlYXRlUm93Q29udGVudHNDb250YWluZXJfKCk7XG4gICAgdGhpcy5yb3dDb250ZW50c18uc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcbiAgICB0aGlzLnJvd0Rpdl8uYXBwZW5kQ2hpbGQodGhpcy5yb3dDb250ZW50c18pO1xuXG4gICAgdGhpcy5pY29uRG9tXyA9IHRoaXMuY3JlYXRlSWNvbkRvbV8oKTtcbiAgICBhcmlhLnNldFJvbGUodGhpcy5pY29uRG9tXywgYXJpYS5Sb2xlLlBSRVNFTlRBVElPTik7XG4gICAgdGhpcy5yb3dDb250ZW50c18uYXBwZW5kQ2hpbGQodGhpcy5pY29uRG9tXyk7XG5cbiAgICB0aGlzLmxhYmVsRG9tXyA9IHRoaXMuY3JlYXRlTGFiZWxEb21fKHRoaXMubmFtZV8pO1xuICAgIHRoaXMucm93Q29udGVudHNfLmFwcGVuZENoaWxkKHRoaXMubGFiZWxEb21fKTtcblxuICAgIGNvbnN0IGlkID0gdGhpcy5sYWJlbERvbV8uZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAgIGlmIChpZCkge1xuICAgICAgYXJpYS5zZXRTdGF0ZSh0aGlzLmh0bWxEaXZfLCBhcmlhLlN0YXRlLkxBQkVMTEVEQlksIGlkKTtcbiAgICB9XG5cbiAgICB0aGlzLmFkZENvbG91ckJvcmRlcl8odGhpcy5jb2xvdXJfKTtcblxuICAgIHJldHVybiB0aGlzLmh0bWxEaXZfO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIGNvbnRhaW5lciB0aGF0IGhvbGRzIHRoZSByb3cgYW5kIGFueSBzdWJjYXRlZ29yaWVzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgZGl2IHRoYXQgaG9sZHMgdGhlIGljb24gYW5kIHRoZSBsYWJlbC5cbiAgICovXG4gIHByb3RlY3RlZCBjcmVhdGVDb250YWluZXJfKCk6IEhUTUxEaXZFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNzc0NvbmZpZ19bJ2NvbnRhaW5lciddO1xuICAgIGlmIChjbGFzc05hbWUpIHtcbiAgICAgIGRvbS5hZGRDbGFzcyhjb250YWluZXIsIGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgcGFyZW50IG9mIHRoZSBjb250ZW50cyBjb250YWluZXIuIEFsbCBjbGlja3Mgd2lsbCBoYXBwZW4gb25cbiAgICogdGhpcyBkaXYuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBkaXYgdGhhdCBob2xkcyB0aGUgY29udGVudHMgY29udGFpbmVyLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZVJvd0NvbnRhaW5lcl8oKTogSFRNTERpdkVsZW1lbnQge1xuICAgIGNvbnN0IHJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuY3NzQ29uZmlnX1sncm93J107XG4gICAgaWYgKGNsYXNzTmFtZSkge1xuICAgICAgZG9tLmFkZENsYXNzKHJvd0RpdiwgY2xhc3NOYW1lKTtcbiAgICB9XG4gICAgY29uc3QgbmVzdGVkUGFkZGluZyA9XG4gICAgICAgIGAke1Rvb2xib3hDYXRlZ29yeS5uZXN0ZWRQYWRkaW5nICogdGhpcy5nZXRMZXZlbCgpfXB4YDtcbiAgICB0aGlzLndvcmtzcGFjZV8uUlRMID8gcm93RGl2LnN0eWxlLnBhZGRpbmdSaWdodCA9IG5lc3RlZFBhZGRpbmcgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICByb3dEaXYuc3R5bGUucGFkZGluZ0xlZnQgPSBuZXN0ZWRQYWRkaW5nO1xuICAgIHJldHVybiByb3dEaXY7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgY29udGFpbmVyIGZvciB0aGUgbGFiZWwgYW5kIGljb24uXG4gICAqIFRoaXMgaXMgbmVjZXNzYXJ5IHNvIHdlIGNhbiBzZXQgYWxsIHN1YmNhdGVnb3J5IHBvaW50ZXIgZXZlbnRzIHRvIG5vbmUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBkaXYgdGhhdCBob2xkcyB0aGUgaWNvbiBhbmQgdGhlIGxhYmVsLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZVJvd0NvbnRlbnRzQ29udGFpbmVyXygpOiBIVE1MRGl2RWxlbWVudCB7XG4gICAgY29uc3QgY29udGVudHNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNzc0NvbmZpZ19bJ3Jvd2NvbnRlbnRjb250YWluZXInXTtcbiAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICBkb20uYWRkQ2xhc3MoY29udGVudHNDb250YWluZXIsIGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50c0NvbnRhaW5lcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRoZSBzcGFuIHRoYXQgaG9sZHMgdGhlIGNhdGVnb3J5IGljb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBzcGFuIHRoYXQgaG9sZHMgdGhlIGNhdGVnb3J5IGljb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlSWNvbkRvbV8oKTogRWxlbWVudCB7XG4gICAgY29uc3QgdG9vbGJveEljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgaWYgKCF0aGlzLnBhcmVudFRvb2xib3hfLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNzc0NvbmZpZ19bJ2ljb24nXTtcbiAgICAgIGlmIChjbGFzc05hbWUpIHtcbiAgICAgICAgZG9tLmFkZENsYXNzKHRvb2xib3hJY29uLCBjbGFzc05hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRvb2xib3hJY29uLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJztcbiAgICByZXR1cm4gdG9vbGJveEljb247XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgc3BhbiB0aGF0IGhvbGRzIHRoZSBjYXRlZ29yeSBsYWJlbC5cbiAgICogVGhpcyBzaG91bGQgaGF2ZSBhbiBJRCBmb3IgYWNjZXNzaWJpbGl0eSBwdXJwb3Nlcy5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGNhdGVnb3J5LlxuICAgKiBAcmV0dXJucyBUaGUgc3BhbiB0aGF0IGhvbGRzIHRoZSBjYXRlZ29yeSBsYWJlbC5cbiAgICovXG4gIHByb3RlY3RlZCBjcmVhdGVMYWJlbERvbV8obmFtZTogc3RyaW5nKTogRWxlbWVudCB7XG4gICAgY29uc3QgdG9vbGJveExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIHRvb2xib3hMYWJlbC5zZXRBdHRyaWJ1dGUoJ2lkJywgdGhpcy5nZXRJZCgpICsgJy5sYWJlbCcpO1xuICAgIHRvb2xib3hMYWJlbC50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5jc3NDb25maWdfWydsYWJlbCddO1xuICAgIGlmIChjbGFzc05hbWUpIHtcbiAgICAgIGRvbS5hZGRDbGFzcyh0b29sYm94TGFiZWwsIGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIHJldHVybiB0b29sYm94TGFiZWw7XG4gIH1cblxuICAvKiogVXBkYXRlcyB0aGUgY29sb3VyIGZvciB0aGlzIGNhdGVnb3J5LiAqL1xuICByZWZyZXNoVGhlbWUoKSB7XG4gICAgdGhpcy5jb2xvdXJfID0gdGhpcy5nZXRDb2xvdXJfKHRoaXMudG9vbGJveEl0ZW1EZWZfKTtcbiAgICB0aGlzLmFkZENvbG91ckJvcmRlcl8odGhpcy5jb2xvdXJfKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgdGhlIHN0cmlwIG9mIGNvbG91ciB0byB0aGUgdG9vbGJveCBjYXRlZ29yeS5cbiAgICpcbiAgICogQHBhcmFtIGNvbG91ciBUaGUgY2F0ZWdvcnkgY29sb3VyLlxuICAgKi9cbiAgcHJvdGVjdGVkIGFkZENvbG91ckJvcmRlcl8oY29sb3VyOiBzdHJpbmcpIHtcbiAgICBpZiAoY29sb3VyKSB7XG4gICAgICBjb25zdCBib3JkZXIgPVxuICAgICAgICAgIFRvb2xib3hDYXRlZ29yeS5ib3JkZXJXaWR0aCArICdweCBzb2xpZCAnICsgKGNvbG91ciB8fCAnI2RkZCcpO1xuICAgICAgaWYgKHRoaXMud29ya3NwYWNlXy5SVEwpIHtcbiAgICAgICAgdGhpcy5yb3dEaXZfIS5zdHlsZS5ib3JkZXJSaWdodCA9IGJvcmRlcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucm93RGl2XyEuc3R5bGUuYm9yZGVyTGVmdCA9IGJvcmRlcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBlaXRoZXIgdGhlIGNvbG91ciBvciB0aGUgc3R5bGUgZm9yIGEgY2F0ZWdvcnkuXG4gICAqXG4gICAqIEBwYXJhbSBjYXRlZ29yeURlZiBUaGUgb2JqZWN0IGhvbGRpbmcgaW5mb3JtYXRpb24gb24gdGhlIGNhdGVnb3J5LlxuICAgKiBAcmV0dXJucyBUaGUgaGV4IGNvbG91ciBmb3IgdGhlIGNhdGVnb3J5LlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldENvbG91cl8oY2F0ZWdvcnlEZWY6IENhdGVnb3J5SW5mbyk6IHN0cmluZyB7XG4gICAgY29uc3Qgc3R5bGVOYW1lID1cbiAgICAgICAgY2F0ZWdvcnlEZWZbJ2NhdGVnb3J5c3R5bGUnXSB8fCAoY2F0ZWdvcnlEZWYgYXMgYW55KVsnY2F0ZWdvcnlTdHlsZSddO1xuICAgIGNvbnN0IGNvbG91ciA9IGNhdGVnb3J5RGVmWydjb2xvdXInXTtcblxuICAgIGlmIChjb2xvdXIgJiYgc3R5bGVOYW1lKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ1Rvb2xib3ggY2F0ZWdvcnkgXCInICsgdGhpcy5uYW1lXyArXG4gICAgICAgICAgJ1wiIG11c3Qgbm90IGhhdmUgYm90aCBhIHN0eWxlIGFuZCBhIGNvbG91cicpO1xuICAgIH0gZWxzZSBpZiAoc3R5bGVOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRDb2xvdXJmcm9tU3R5bGVfKHN0eWxlTmFtZSk7XG4gICAgfSBlbHNlIGlmIChjb2xvdXIpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcnNlQ29sb3VyXyhjb2xvdXIpO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgY29sb3VyIGZvciB0aGUgY2F0ZWdvcnkgdXNpbmcgdGhlIHN0eWxlIG5hbWUgYW5kIHJldHVybnMgdGhlIG5ld1xuICAgKiBjb2xvdXIgYXMgYSBoZXggc3RyaW5nLlxuICAgKlxuICAgKiBAcGFyYW0gc3R5bGVOYW1lIE5hbWUgb2YgdGhlIHN0eWxlLlxuICAgKiBAcmV0dXJucyBUaGUgaGV4IGNvbG91ciBmb3IgdGhlIGNhdGVnb3J5LlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRDb2xvdXJmcm9tU3R5bGVfKHN0eWxlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCB0aGVtZSA9IHRoaXMud29ya3NwYWNlXy5nZXRUaGVtZSgpO1xuICAgIGlmIChzdHlsZU5hbWUgJiYgdGhlbWUpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gdGhlbWUuY2F0ZWdvcnlTdHlsZXNbc3R5bGVOYW1lXTtcbiAgICAgIGlmIChzdHlsZSAmJiBzdHlsZS5jb2xvdXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VDb2xvdXJfKHN0eWxlLmNvbG91cik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAnU3R5bGUgXCInICsgc3R5bGVOYW1lICsgJ1wiIG11c3QgZXhpc3QgYW5kIGNvbnRhaW4gYSBjb2xvdXIgdmFsdWUnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIEhUTUwgZWxlbWVudCB0aGF0IGlzIGNsaWNrYWJsZS5cbiAgICogVGhlIHBhcmVudCB0b29sYm94IGVsZW1lbnQgcmVjZWl2ZXMgY2xpY2tzLiBUaGUgcGFyZW50IHRvb2xib3ggd2lsbCBhZGQgYW5cbiAgICogSUQgdG8gdGhpcyBlbGVtZW50IHNvIGl0IGNhbiBwYXNzIHRoZSBvbkNsaWNrIGV2ZW50IHRvIHRoZSBjb3JyZWN0XG4gICAqIHRvb2xib3hJdGVtLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgSFRNTCBlbGVtZW50IHRoYXQgcmVjZWl2ZXMgY2xpY2tzLlxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0Q2xpY2tUYXJnZXQoKTogRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMucm93RGl2XyBhcyBFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlcyB0aGUgY29sb3VyIG9uIHRoZSBjYXRlZ29yeS5cbiAgICpcbiAgICogQHBhcmFtIGNvbG91clZhbHVlIEhTViBodWUgdmFsdWUgKDAgdG8gMzYwKSwgI1JSR0dCQiBzdHJpbmcsIG9yIGEgbWVzc2FnZVxuICAgKiAgICAgcmVmZXJlbmNlIHN0cmluZyBwb2ludGluZyB0byBvbmUgb2YgdGhvc2UgdHdvIHZhbHVlcy5cbiAgICogQHJldHVybnMgVGhlIGhleCBjb2xvdXIgZm9yIHRoZSBjYXRlZ29yeS5cbiAgICovXG4gIHByaXZhdGUgcGFyc2VDb2xvdXJfKGNvbG91clZhbHVlOiBudW1iZXJ8c3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBEZWNvZGUgdGhlIGNvbG91ciBmb3IgYW55IHBvdGVudGlhbCBtZXNzYWdlIHJlZmVyZW5jZXNcbiAgICAvLyAoZWcuIGAle0JLWV9NQVRIX0hVRX1gKS5cbiAgICBjb25zdCBjb2xvdXIgPSBwYXJzaW5nLnJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcyhjb2xvdXJWYWx1ZSk7XG4gICAgaWYgKGNvbG91ciA9PSBudWxsIHx8IGNvbG91ciA9PT0gJycpIHtcbiAgICAgIC8vIE5vIGF0dHJpYnV0ZS4gTm8gY29sb3VyLlxuICAgICAgcmV0dXJuICcnO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBodWUgPSBOdW1iZXIoY29sb3VyKTtcbiAgICAgIGlmICghaXNOYU4oaHVlKSkge1xuICAgICAgICByZXR1cm4gY29sb3VyVXRpbHMuaHVlVG9IZXgoaHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGhleCA9IGNvbG91clV0aWxzLnBhcnNlKGNvbG91cik7XG4gICAgICAgIGlmIChoZXgpIHtcbiAgICAgICAgICByZXR1cm4gaGV4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgJ1Rvb2xib3ggY2F0ZWdvcnkgXCInICsgdGhpcy5uYW1lXyArXG4gICAgICAgICAgICAgICdcIiBoYXMgdW5yZWNvZ25pemVkIGNvbG91ciBhdHRyaWJ1dGU6ICcgKyBjb2xvdXIpO1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGFwcHJvcHJpYXRlIGNsYXNzZXMgdG8gZGlzcGxheSBhbiBvcGVuIGljb24uXG4gICAqXG4gICAqIEBwYXJhbSBpY29uRGl2IFRoZSBkaXYgdGhhdCBob2xkcyB0aGUgaWNvbi5cbiAgICovXG4gIHByb3RlY3RlZCBvcGVuSWNvbl8oaWNvbkRpdjogRWxlbWVudHxudWxsKSB7XG4gICAgaWYgKCFpY29uRGl2KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNsb3NlZEljb25DbGFzcyA9IHRoaXMuY3NzQ29uZmlnX1snY2xvc2VkaWNvbiddO1xuICAgIGlmIChjbG9zZWRJY29uQ2xhc3MpIHtcbiAgICAgIGRvbS5yZW1vdmVDbGFzc2VzKGljb25EaXYsIGNsb3NlZEljb25DbGFzcyk7XG4gICAgfVxuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuY3NzQ29uZmlnX1snb3Blbmljb24nXTtcbiAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICBkb20uYWRkQ2xhc3MoaWNvbkRpdiwgY2xhc3NOYW1lKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhcHByb3ByaWF0ZSBjbGFzc2VzIHRvIGRpc3BsYXkgYSBjbG9zZWQgaWNvbi5cbiAgICpcbiAgICogQHBhcmFtIGljb25EaXYgVGhlIGRpdiB0aGF0IGhvbGRzIHRoZSBpY29uLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNsb3NlSWNvbl8oaWNvbkRpdjogRWxlbWVudHxudWxsKSB7XG4gICAgaWYgKCFpY29uRGl2KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG9wZW5JY29uQ2xhc3MgPSB0aGlzLmNzc0NvbmZpZ19bJ29wZW5pY29uJ107XG4gICAgaWYgKG9wZW5JY29uQ2xhc3MpIHtcbiAgICAgIGRvbS5yZW1vdmVDbGFzc2VzKGljb25EaXYsIG9wZW5JY29uQ2xhc3MpO1xuICAgIH1cbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNzc0NvbmZpZ19bJ2Nsb3NlZGljb24nXTtcbiAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICBkb20uYWRkQ2xhc3MoaWNvbkRpdiwgY2xhc3NOYW1lKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB3aGV0aGVyIHRoZSBjYXRlZ29yeSBpcyB2aXNpYmxlIG9yIG5vdC5cbiAgICogRm9yIGEgY2F0ZWdvcnkgdG8gYmUgdmlzaWJsZSBpdHMgcGFyZW50IGNhdGVnb3J5IG11c3QgYWxzbyBiZSBleHBhbmRlZC5cbiAgICpcbiAgICogQHBhcmFtIGlzVmlzaWJsZSBUcnVlIGlmIGNhdGVnb3J5IHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgc2V0VmlzaWJsZV8oaXNWaXNpYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5odG1sRGl2XyEuc3R5bGUuZGlzcGxheSA9IGlzVmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgdGhpcy5pc0hpZGRlbl8gPSAhaXNWaXNpYmxlO1xuXG4gICAgaWYgKHRoaXMucGFyZW50VG9vbGJveF8uZ2V0U2VsZWN0ZWRJdGVtKCkgPT09IHRoaXMpIHtcbiAgICAgIHRoaXMucGFyZW50VG9vbGJveF8uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKiogSGlkZSB0aGUgY2F0ZWdvcnkuICovXG4gIGhpZGUoKSB7XG4gICAgdGhpcy5zZXRWaXNpYmxlXyhmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyB0aGUgY2F0ZWdvcnkuIENhdGVnb3J5IHdpbGwgb25seSBhcHBlYXIgaWYgaXRzIHBhcmVudCBjYXRlZ29yeSBpcyBhbHNvXG4gICAqIGV4cGFuZGVkLlxuICAgKi9cbiAgc2hvdygpIHtcbiAgICB0aGlzLnNldFZpc2libGVfKHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGNhdGVnb3J5IGlzIHZpc2libGUuXG4gICAqIEEgY2F0ZWdvcnkgaXMgb25seSB2aXNpYmxlIGlmIGFsbCBvZiBpdHMgYW5jZXN0b3JzIGFyZSBleHBhbmRlZCBhbmRcbiAgICogaXNIaWRkZW5fIGlzIGZhbHNlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBjYXRlZ29yeSBpcyB2aXNpYmxlLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBpc1Zpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmlzSGlkZGVuXyAmJiB0aGlzLmFsbEFuY2VzdG9yc0V4cGFuZGVkXygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYWxsIGFuY2VzdG9ycyBvZiBhIGNhdGVnb3J5IChwYXJlbnQgYW5kIHBhcmVudCdzIHBhcmVudCwgZXRjLikgYXJlXG4gICAqIGV4cGFuZGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIG9ubHkgaWYgZXZlcnkgYW5jZXN0b3IgaXMgZXhwYW5kZWRcbiAgICovXG4gIHByb3RlY3RlZCBhbGxBbmNlc3RvcnNFeHBhbmRlZF8oKTogYm9vbGVhbiB7XG4gICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzICovXG4gICAgbGV0IGNhdGVnb3J5OiBJVG9vbGJveEl0ZW0gPSB0aGlzO1xuICAgIHdoaWxlIChjYXRlZ29yeS5nZXRQYXJlbnQoKSkge1xuICAgICAgY2F0ZWdvcnkgPSBjYXRlZ29yeS5nZXRQYXJlbnQoKSE7XG4gICAgICBpZiAoIShjYXRlZ29yeSBhcyBJQ29sbGFwc2libGVUb29sYm94SXRlbSkuaXNFeHBhbmRlZCgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBvdmVycmlkZSBpc1NlbGVjdGFibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlKCkgJiYgIXRoaXMuaXNEaXNhYmxlZF87XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB3aGVuIHRoZSB0b29sYm94IGl0ZW0gaXMgY2xpY2tlZC5cbiAgICpcbiAgICogQHBhcmFtIF9lIENsaWNrIGV2ZW50IHRvIGhhbmRsZS5cbiAgICovXG4gIG9uQ2xpY2soX2U6IEV2ZW50KSB7fVxuICAvLyBOby1vcFxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBjdXJyZW50IGNhdGVnb3J5IGFzIHNlbGVjdGVkLlxuICAgKlxuICAgKiBAcGFyYW0gaXNTZWxlY3RlZCBUcnVlIGlmIHRoaXMgY2F0ZWdvcnkgaXMgc2VsZWN0ZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHNldFNlbGVjdGVkKGlzU2VsZWN0ZWQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMucm93RGl2Xykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNzc0NvbmZpZ19bJ3NlbGVjdGVkJ107XG4gICAgaWYgKGlzU2VsZWN0ZWQpIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRDb2xvdXIgPVxuICAgICAgICAgIHRoaXMucGFyc2VDb2xvdXJfKFRvb2xib3hDYXRlZ29yeS5kZWZhdWx0QmFja2dyb3VuZENvbG91cik7XG4gICAgICB0aGlzLnJvd0Rpdl8uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdGhpcy5jb2xvdXJfIHx8IGRlZmF1bHRDb2xvdXI7XG4gICAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICAgIGRvbS5hZGRDbGFzcyh0aGlzLnJvd0Rpdl8sIGNsYXNzTmFtZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucm93RGl2Xy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnJztcbiAgICAgIGlmIChjbGFzc05hbWUpIHtcbiAgICAgICAgZG9tLnJlbW92ZUNsYXNzKHRoaXMucm93RGl2XywgY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgYXJpYS5zZXRTdGF0ZSh0aGlzLmh0bWxEaXZfIGFzIEVsZW1lbnQsIGFyaWEuU3RhdGUuU0VMRUNURUQsIGlzU2VsZWN0ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgd2hldGhlciB0aGUgY2F0ZWdvcnkgaXMgZGlzYWJsZWQuXG4gICAqXG4gICAqIEBwYXJhbSBpc0Rpc2FibGVkIFRydWUgdG8gZGlzYWJsZSB0aGUgY2F0ZWdvcnksIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHNldERpc2FibGVkKGlzRGlzYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzRGlzYWJsZWRfID0gaXNEaXNhYmxlZDtcbiAgICB0aGlzLmdldERpdigpIS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgYCR7aXNEaXNhYmxlZH1gKTtcbiAgICBpc0Rpc2FibGVkID8gdGhpcy5nZXREaXYoKSEuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICd0cnVlJykgOlxuICAgICAgICAgICAgICAgICB0aGlzLmdldERpdigpIS5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbmFtZSBvZiB0aGUgY2F0ZWdvcnkuIFVzZWQgZm9yIGVtaXR0aW5nIGV2ZW50cy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIG5hbWUgb2YgdGhlIHRvb2xib3ggaXRlbS5cbiAgICovXG4gIGdldE5hbWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5uYW1lXztcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFBhcmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXJlbnRfO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0RGl2KCkge1xuICAgIHJldHVybiB0aGlzLmh0bWxEaXZfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGNvbnRlbnRzIG9mIHRoZSBjYXRlZ29yeS4gVGhlc2UgYXJlIGl0ZW1zIHRoYXQgYXJlIG1lYW50IHRvIGJlXG4gICAqIGRpc3BsYXllZCBpbiB0aGUgZmx5b3V0LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgZGVmaW5pdGlvbiBvZiBpdGVtcyB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGZseW91dC5cbiAgICovXG4gIGdldENvbnRlbnRzKCk6IEZseW91dEl0ZW1JbmZvQXJyYXl8c3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5mbHlvdXRJdGVtc187XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgY29udGVudHMgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBmbHlvdXQuXG4gICAqIElmIHRoZSBmbHlvdXQgaXMgb3BlbiB3aGVuIHRoZSBjb250ZW50cyBhcmUgdXBkYXRlZCwgcmVmcmVzaFNlbGVjdGlvbiBvblxuICAgKiB0aGUgdG9vbGJveCBtdXN0IGFsc28gYmUgY2FsbGVkLlxuICAgKlxuICAgKiBAcGFyYW0gY29udGVudHMgVGhlIGNvbnRlbnRzIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgZmx5b3V0LiBBIHN0cmluZyBjYW4gYmVcbiAgICogICAgIHN1cHBsaWVkIHRvIGNyZWF0ZSBhIGR5bmFtaWMgY2F0ZWdvcnkuXG4gICAqL1xuICB1cGRhdGVGbHlvdXRDb250ZW50cyhjb250ZW50czogRmx5b3V0RGVmaW5pdGlvbnxzdHJpbmcpIHtcbiAgICB0aGlzLmZseW91dEl0ZW1zXyA9IFtdO1xuXG4gICAgaWYgKHR5cGVvZiBjb250ZW50cyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IG5ld0RlZmluaXRpb246IER5bmFtaWNDYXRlZ29yeUluZm8gPSB7XG4gICAgICAgIGtpbmQ6IHRoaXMudG9vbGJveEl0ZW1EZWZfLmtpbmQsXG4gICAgICAgIGN1c3RvbTogY29udGVudHMsXG4gICAgICAgIGlkOiB0aGlzLnRvb2xib3hJdGVtRGVmXy5pZCxcbiAgICAgICAgY2F0ZWdvcnlzdHlsZTogdGhpcy50b29sYm94SXRlbURlZl8uY2F0ZWdvcnlzdHlsZSxcbiAgICAgICAgY29sb3VyOiB0aGlzLnRvb2xib3hJdGVtRGVmXy5jb2xvdXIsXG4gICAgICAgIGNzc2NvbmZpZzogdGhpcy50b29sYm94SXRlbURlZl8uY3NzY29uZmlnLFxuICAgICAgICBoaWRkZW46IHRoaXMudG9vbGJveEl0ZW1EZWZfLmhpZGRlbixcbiAgICAgIH07XG4gICAgICB0aGlzLnRvb2xib3hJdGVtRGVmXyA9IG5ld0RlZmluaXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5ld0RlZmluaXRpb246IFN0YXRpY0NhdGVnb3J5SW5mbyA9IHtcbiAgICAgICAga2luZDogdGhpcy50b29sYm94SXRlbURlZl8ua2luZCxcbiAgICAgICAgbmFtZTogJ25hbWUnIGluIHRoaXMudG9vbGJveEl0ZW1EZWZfID8gdGhpcy50b29sYm94SXRlbURlZl9bJ25hbWUnXSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnLFxuICAgICAgICBjb250ZW50czogdG9vbGJveC5jb252ZXJ0Rmx5b3V0RGVmVG9Kc29uQXJyYXkoY29udGVudHMpLFxuICAgICAgICBpZDogdGhpcy50b29sYm94SXRlbURlZl8uaWQsXG4gICAgICAgIGNhdGVnb3J5c3R5bGU6IHRoaXMudG9vbGJveEl0ZW1EZWZfLmNhdGVnb3J5c3R5bGUsXG4gICAgICAgIGNvbG91cjogdGhpcy50b29sYm94SXRlbURlZl8uY29sb3VyLFxuICAgICAgICBjc3Njb25maWc6IHRoaXMudG9vbGJveEl0ZW1EZWZfLmNzc2NvbmZpZyxcbiAgICAgICAgaGlkZGVuOiB0aGlzLnRvb2xib3hJdGVtRGVmXy5oaWRkZW4sXG4gICAgICB9O1xuICAgICAgdGhpcy50b29sYm94SXRlbURlZl8gPSBuZXdEZWZpbml0aW9uO1xuICAgIH1cbiAgICB0aGlzLnBhcnNlQ29udGVudHNfKHRoaXMudG9vbGJveEl0ZW1EZWZfKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGRpc3Bvc2UoKSB7XG4gICAgZG9tLnJlbW92ZU5vZGUodGhpcy5odG1sRGl2Xyk7XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBUb29sYm94Q2F0ZWdvcnkge1xuICAvKiogQWxsIHRoZSBDU1MgY2xhc3MgbmFtZXMgdGhhdCBhcmUgdXNlZCB0byBjcmVhdGUgYSBjYXRlZ29yeS4gKi9cbiAgZXhwb3J0IGludGVyZmFjZSBDc3NDb25maWcge1xuICAgIGNvbnRhaW5lcj86IHN0cmluZztcbiAgICByb3c/OiBzdHJpbmc7XG4gICAgcm93Y29udGVudGNvbnRhaW5lcj86IHN0cmluZztcbiAgICBpY29uPzogc3RyaW5nO1xuICAgIGxhYmVsPzogc3RyaW5nO1xuICAgIGNvbnRlbnRzPzogc3RyaW5nO1xuICAgIHNlbGVjdGVkPzogc3RyaW5nO1xuICAgIG9wZW5pY29uPzogc3RyaW5nO1xuICAgIGNsb3NlZGljb24/OiBzdHJpbmc7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgQ3NzQ29uZmlnID0gVG9vbGJveENhdGVnb3J5LkNzc0NvbmZpZztcblxuLyoqIENTUyBmb3IgVG9vbGJveC4gIFNlZSBjc3MuanMgZm9yIHVzZS4gKi9cbkNzcy5yZWdpc3RlcihgXG4uYmxvY2tseVRyZWVSb3c6bm90KC5ibG9ja2x5VHJlZVNlbGVjdGVkKTpob3ZlciB7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgLjIpO1xufVxuXG4uYmxvY2tseVRvb2xib3hEaXZbbGF5b3V0PVwiaFwiXSAuYmxvY2tseVRvb2xib3hDYXRlZ29yeSB7XG4gIG1hcmdpbjogMXB4IDVweCAxcHggMDtcbn1cblxuLmJsb2NrbHlUb29sYm94RGl2W2Rpcj1cIlJUTFwiXVtsYXlvdXQ9XCJoXCJdIC5ibG9ja2x5VG9vbGJveENhdGVnb3J5IHtcbiAgbWFyZ2luOiAxcHggMCAxcHggNXB4O1xufVxuXG4uYmxvY2tseVRyZWVSb3cge1xuICBoZWlnaHQ6IDIycHg7XG4gIGxpbmUtaGVpZ2h0OiAyMnB4O1xuICBtYXJnaW4tYm90dG9tOiAzcHg7XG4gIHBhZGRpbmctcmlnaHQ6IDhweDtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbn1cblxuLmJsb2NrbHlUb29sYm94RGl2W2Rpcj1cIlJUTFwiXSAuYmxvY2tseVRyZWVSb3cge1xuICBtYXJnaW4tbGVmdDogOHB4O1xuICBwYWRkaW5nLXJpZ2h0OiAwO1xufVxuXG4uYmxvY2tseVRyZWVJY29uIHtcbiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKDw8PFBBVEg+Pj4vc3ByaXRlcy5wbmcpO1xuICBoZWlnaHQ6IDE2cHg7XG4gIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gIHZpc2liaWxpdHk6IGhpZGRlbjtcbiAgd2lkdGg6IDE2cHg7XG59XG5cbi5ibG9ja2x5VHJlZUljb25DbG9zZWQge1xuICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMXB4O1xufVxuXG4uYmxvY2tseVRvb2xib3hEaXZbZGlyPVwiUlRMXCJdIC5ibG9ja2x5VHJlZUljb25DbG9zZWQge1xuICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xcHg7XG59XG5cbi5ibG9ja2x5VHJlZVNlbGVjdGVkPi5ibG9ja2x5VHJlZUljb25DbG9zZWQge1xuICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMzJweCAtMTdweDtcbn1cblxuLmJsb2NrbHlUb29sYm94RGl2W2Rpcj1cIlJUTFwiXSAuYmxvY2tseVRyZWVTZWxlY3RlZD4uYmxvY2tseVRyZWVJY29uQ2xvc2VkIHtcbiAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMTdweDtcbn1cblxuLmJsb2NrbHlUcmVlSWNvbk9wZW4ge1xuICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTZweCAtMXB4O1xufVxuXG4uYmxvY2tseVRyZWVTZWxlY3RlZD4uYmxvY2tseVRyZWVJY29uT3BlbiB7XG4gIGJhY2tncm91bmQtcG9zaXRpb246IC0xNnB4IC0xN3B4O1xufVxuXG4uYmxvY2tseVRyZWVMYWJlbCB7XG4gIGN1cnNvcjogZGVmYXVsdDtcbiAgZm9udDogMTZweCBzYW5zLXNlcmlmO1xuICBwYWRkaW5nOiAwIDNweDtcbiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbn1cblxuLmJsb2NrbHlUb29sYm94RGVsZXRlIC5ibG9ja2x5VHJlZUxhYmVsIHtcbiAgY3Vyc29yOiB1cmwoXCI8PDxQQVRIPj4+L2hhbmRkZWxldGUuY3VyXCIpLCBhdXRvO1xufVxuXG4uYmxvY2tseVRyZWVTZWxlY3RlZCAuYmxvY2tseVRyZWVMYWJlbCB7XG4gIGNvbG9yOiAjZmZmO1xufVxuYCk7XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuVE9PTEJPWF9JVEVNLCBUb29sYm94Q2F0ZWdvcnkucmVnaXN0cmF0aW9uTmFtZSxcbiAgICBUb29sYm94Q2F0ZWdvcnkpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEEgc2VwYXJhdG9yIHVzZWQgZm9yIHNlcGFyYXRpbmcgdG9vbGJveCBjYXRlZ29yaWVzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRvb2xib3hTZXBhcmF0b3InKTtcblxuaW1wb3J0ICogYXMgQ3NzIGZyb20gJy4uL2Nzcy5qcyc7XG5pbXBvcnQgdHlwZSB7SVRvb2xib3h9IGZyb20gJy4uL2ludGVyZmFjZXMvaV90b29sYm94LmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHR5cGUgKiBhcyB0b29sYm94IGZyb20gJy4uL3V0aWxzL3Rvb2xib3guanMnO1xuXG5pbXBvcnQge1Rvb2xib3hJdGVtfSBmcm9tICcuL3Rvb2xib3hfaXRlbS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB0b29sYm94IHNlcGFyYXRvci4gVGhpcyBpcyB0aGUgdGhpbiB2aXN1YWwgbGluZSB0aGF0IGFwcGVhcnMgb25cbiAqIHRoZSB0b29sYm94LiBUaGlzIGl0ZW0gaXMgbm90IGludGVyYWN0YWJsZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Ub29sYm94U2VwYXJhdG9yXG4gKi9cbmV4cG9ydCBjbGFzcyBUb29sYm94U2VwYXJhdG9yIGV4dGVuZHMgVG9vbGJveEl0ZW0ge1xuICAvKiogTmFtZSB1c2VkIGZvciByZWdpc3RlcmluZyBhIHRvb2xib3ggc2VwYXJhdG9yLiAqL1xuICBzdGF0aWMgcmVnaXN0cmF0aW9uTmFtZSA9ICdzZXAnO1xuXG4gIC8qKiBBbGwgdGhlIENTUyBjbGFzcyBuYW1lcyB0aGF0IGFyZSB1c2VkIHRvIGNyZWF0ZSBhIHNlcGFyYXRvci4gKi9cbiAgcHJvdGVjdGVkIGNzc0NvbmZpZ186IENzc0NvbmZpZyA9IHsnY29udGFpbmVyJzogJ2Jsb2NrbHlUcmVlU2VwYXJhdG9yJ307XG5cbiAgcHJpdmF0ZSBodG1sRGl2XzogSFRNTERpdkVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBzZXBhcmF0b3JEZWYgVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBzZXBhcmF0b3IuXG4gICAqIEBwYXJhbSB0b29sYm94IFRoZSBwYXJlbnQgdG9vbGJveCBmb3IgdGhlIHNlcGFyYXRvci5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHNlcGFyYXRvckRlZjogdG9vbGJveC5TZXBhcmF0b3JJbmZvLCB0b29sYm94OiBJVG9vbGJveCkge1xuICAgIHN1cGVyKHNlcGFyYXRvckRlZiwgdG9vbGJveCk7XG5cbiAgICBjb25zdCBjc3NDb25maWcgPVxuICAgICAgICBzZXBhcmF0b3JEZWZbJ2Nzc2NvbmZpZyddIHx8IChzZXBhcmF0b3JEZWYgYXMgYW55KVsnY3NzQ29uZmlnJ107XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLmNzc0NvbmZpZ18sIGNzc0NvbmZpZyk7XG4gIH1cblxuICBvdmVycmlkZSBpbml0KCkge1xuICAgIHRoaXMuY3JlYXRlRG9tXygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIERPTSBmb3IgYSBzZXBhcmF0b3IuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBwYXJlbnQgZWxlbWVudCBmb3IgdGhlIHNlcGFyYXRvci5cbiAgICovXG4gIHByb3RlY3RlZCBjcmVhdGVEb21fKCk6IEhUTUxEaXZFbGVtZW50IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNzc0NvbmZpZ19bJ2NvbnRhaW5lciddO1xuICAgIGlmIChjbGFzc05hbWUpIHtcbiAgICAgIGRvbS5hZGRDbGFzcyhjb250YWluZXIsIGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIHRoaXMuaHRtbERpdl8gPSBjb250YWluZXI7XG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfVxuXG4gIG92ZXJyaWRlIGdldERpdigpIHtcbiAgICByZXR1cm4gdGhpcy5odG1sRGl2XyBhcyBIVE1MRGl2RWxlbWVudDtcbiAgfVxuXG4gIG92ZXJyaWRlIGRpc3Bvc2UoKSB7XG4gICAgZG9tLnJlbW92ZU5vZGUodGhpcy5odG1sRGl2XyBhcyBIVE1MRGl2RWxlbWVudCk7XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBUb29sYm94U2VwYXJhdG9yIHtcbiAgZXhwb3J0IGludGVyZmFjZSBDc3NDb25maWcge1xuICAgIGNvbnRhaW5lcjogc3RyaW5nfHVuZGVmaW5lZDtcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBDc3NDb25maWcgPSBUb29sYm94U2VwYXJhdG9yLkNzc0NvbmZpZztcblxuLyoqIENTUyBmb3IgVG9vbGJveC4gIFNlZSBjc3MuanMgZm9yIHVzZS4gKi9cbkNzcy5yZWdpc3RlcihgXG4uYmxvY2tseVRyZWVTZXBhcmF0b3Ige1xuICBib3JkZXItYm90dG9tOiBzb2xpZCAjZTVlNWU1IDFweDtcbiAgaGVpZ2h0OiAwO1xuICBtYXJnaW46IDVweCAwO1xufVxuXG4uYmxvY2tseVRvb2xib3hEaXZbbGF5b3V0PVwiaFwiXSAuYmxvY2tseVRyZWVTZXBhcmF0b3Ige1xuICBib3JkZXItcmlnaHQ6IHNvbGlkICNlNWU1ZTUgMXB4O1xuICBib3JkZXItYm90dG9tOiBub25lO1xuICBoZWlnaHQ6IGF1dG87XG4gIG1hcmdpbjogMCA1cHggMCA1cHg7XG4gIHBhZGRpbmc6IDVweCAwO1xuICB3aWR0aDogMDtcbn1cbmApO1xuXG5yZWdpc3RyeS5yZWdpc3RlcihcbiAgICByZWdpc3RyeS5UeXBlLlRPT0xCT1hfSVRFTSwgVG9vbGJveFNlcGFyYXRvci5yZWdpc3RyYXRpb25OYW1lLFxuICAgIFRvb2xib3hTZXBhcmF0b3IpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEEgdG9vbGJveCBjYXRlZ29yeSB1c2VkIHRvIG9yZ2FuaXplIGJsb2NrcyBpbiB0aGUgdG9vbGJveC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db2xsYXBzaWJsZVRvb2xib3hDYXRlZ29yeScpO1xuXG5pbXBvcnQgdHlwZSB7SUNvbGxhcHNpYmxlVG9vbGJveEl0ZW19IGZyb20gJy4uL2ludGVyZmFjZXMvaV9jb2xsYXBzaWJsZV90b29sYm94X2l0ZW0uanMnO1xuaW1wb3J0IHR5cGUge0lUb29sYm94fSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfdG9vbGJveC5qcyc7XG5pbXBvcnQgdHlwZSB7SVRvb2xib3hJdGVtfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfdG9vbGJveF9pdGVtLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIGFyaWEgZnJvbSAnLi4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCAqIGFzIHRvb2xib3ggZnJvbSAnLi4vdXRpbHMvdG9vbGJveC5qcyc7XG5cbmltcG9ydCB7VG9vbGJveENhdGVnb3J5fSBmcm9tICcuL2NhdGVnb3J5LmpzJztcbmltcG9ydCB7VG9vbGJveFNlcGFyYXRvcn0gZnJvbSAnLi9zZXBhcmF0b3IuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgY2F0ZWdvcnkgaW4gYSB0b29sYm94IHRoYXQgY2FuIGJlIGNvbGxhcHNlZC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Db2xsYXBzaWJsZVRvb2xib3hDYXRlZ29yeVxuICovXG5leHBvcnQgY2xhc3MgQ29sbGFwc2libGVUb29sYm94Q2F0ZWdvcnkgZXh0ZW5kcyBUb29sYm94Q2F0ZWdvcnkgaW1wbGVtZW50c1xuICAgIElDb2xsYXBzaWJsZVRvb2xib3hJdGVtIHtcbiAgLyoqIE5hbWUgdXNlZCBmb3IgcmVnaXN0ZXJpbmcgYSBjb2xsYXBzaWJsZSB0b29sYm94IGNhdGVnb3J5LiAqL1xuICBzdGF0aWMgb3ZlcnJpZGUgcmVnaXN0cmF0aW9uTmFtZSA9ICdjb2xsYXBzaWJsZUNhdGVnb3J5JztcblxuICAvKiogQ29udGFpbmVyIGZvciBhbnkgY2hpbGQgY2F0ZWdvcmllcy4gKi9cbiAgcHJvdGVjdGVkIHN1YmNhdGVnb3JpZXNEaXZfOiBIVE1MRGl2RWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogV2hldGhlciBvciBub3QgdGhlIGNhdGVnb3J5IHNob3VsZCBkaXNwbGF5IGl0cyBzdWJjYXRlZ29yaWVzLiAqL1xuICBwcm90ZWN0ZWQgZXhwYW5kZWRfID0gZmFsc2U7XG5cbiAgLyoqIFRoZSBjaGlsZCB0b29sYm94IGl0ZW1zIGZvciB0aGlzIGNhdGVnb3J5LiAqL1xuICBwcm90ZWN0ZWQgdG9vbGJveEl0ZW1zXzogSVRvb2xib3hJdGVtW10gPSBbXTtcbiAgb3ZlcnJpZGUgZmx5b3V0SXRlbXNfOiBBbnlEdXJpbmdNaWdyYXRpb247XG4gIG92ZXJyaWRlIGlzSGlkZGVuXzogQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY2F0ZWdvcnlEZWYgVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSBjYXRlZ29yeSBpbiB0aGVcbiAgICogICAgIHRvb2xib3guXG4gICAqIEBwYXJhbSB0b29sYm94IFRoZSBwYXJlbnQgdG9vbGJveCBmb3IgdGhlIGNhdGVnb3J5LlxuICAgKiBAcGFyYW0gb3B0X3BhcmVudCBUaGUgcGFyZW50IGNhdGVnb3J5IG9yIG51bGwgaWYgdGhlIGNhdGVnb3J5IGRvZXMgbm90IGhhdmVcbiAgICogICAgIGEgcGFyZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBjYXRlZ29yeURlZjogdG9vbGJveC5DYXRlZ29yeUluZm8sIHRvb2xib3g6IElUb29sYm94LFxuICAgICAgb3B0X3BhcmVudD86IElDb2xsYXBzaWJsZVRvb2xib3hJdGVtKSB7XG4gICAgc3VwZXIoY2F0ZWdvcnlEZWYsIHRvb2xib3gsIG9wdF9wYXJlbnQpO1xuICB9XG5cbiAgb3ZlcnJpZGUgbWFrZURlZmF1bHRDc3NDb25maWdfKCkge1xuICAgIGNvbnN0IGNzc0NvbmZpZyA9IHN1cGVyLm1ha2VEZWZhdWx0Q3NzQ29uZmlnXygpO1xuICAgIChjc3NDb25maWcgYXMgQW55RHVyaW5nTWlncmF0aW9uKVsnY29udGVudHMnXSA9ICdibG9ja2x5VG9vbGJveENvbnRlbnRzJztcbiAgICByZXR1cm4gY3NzQ29uZmlnO1xuICB9XG5cbiAgb3ZlcnJpZGUgcGFyc2VDb250ZW50c18oY2F0ZWdvcnlEZWY6IHRvb2xib3guQ2F0ZWdvcnlJbmZvKSB7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBFbGVtZW50IGltcGxpY2l0bHkgaGFzIGFuICdhbnknIHR5cGUgYmVjYXVzZVxuICAgIC8vIGV4cHJlc3Npb24gb2YgdHlwZSAnXCJjb250ZW50c1wiJyBjYW4ndCBiZSB1c2VkIHRvIGluZGV4IHR5cGVcbiAgICAvLyAnQ2F0ZWdvcnlJbmZvJy5cbiAgICBjb25zdCBjb250ZW50cyA9IChjYXRlZ29yeURlZiBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydjb250ZW50cyddO1xuICAgIGxldCBwcmV2SXNGbHlvdXRJdGVtID0gdHJ1ZTtcblxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgRWxlbWVudCBpbXBsaWNpdGx5IGhhcyBhbiAnYW55JyB0eXBlIGJlY2F1c2VcbiAgICAvLyBleHByZXNzaW9uIG9mIHR5cGUgJ1wiY3VzdG9tXCInIGNhbid0IGJlIHVzZWQgdG8gaW5kZXggdHlwZSAnQ2F0ZWdvcnlJbmZvJy5cbiAgICBpZiAoKGNhdGVnb3J5RGVmIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbJ2N1c3RvbSddKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEVsZW1lbnQgaW1wbGljaXRseSBoYXMgYW4gJ2FueScgdHlwZVxuICAgICAgLy8gYmVjYXVzZSBleHByZXNzaW9uIG9mIHR5cGUgJ1wiY3VzdG9tXCInIGNhbid0IGJlIHVzZWQgdG8gaW5kZXggdHlwZVxuICAgICAgLy8gJ0NhdGVnb3J5SW5mbycuXG4gICAgICB0aGlzLmZseW91dEl0ZW1zXyA9IChjYXRlZ29yeURlZiBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydjdXN0b20nXTtcbiAgICB9IGVsc2UgaWYgKGNvbnRlbnRzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW1EZWYgPSBjb250ZW50c1tpXTtcbiAgICAgICAgLy8gU2VwYXJhdG9ycyBjYW4gZXhpc3QgYXMgZWl0aGVyIGEgZmx5b3V0IGl0ZW0gb3IgYSB0b29sYm94IGl0ZW0gc29cbiAgICAgICAgLy8gZGVjaWRlIHdoZXJlIGl0IGdvZXMgYmFzZWQgb24gdGhlIHR5cGUgb2YgdGhlIHByZXZpb3VzIGl0ZW0uXG4gICAgICAgIGlmICghcmVnaXN0cnkuaGFzSXRlbShyZWdpc3RyeS5UeXBlLlRPT0xCT1hfSVRFTSwgaXRlbURlZlsna2luZCddKSB8fFxuICAgICAgICAgICAgaXRlbURlZlsna2luZCddLnRvTG93ZXJDYXNlKCkgPT09XG4gICAgICAgICAgICAgICAgICAgIFRvb2xib3hTZXBhcmF0b3IucmVnaXN0cmF0aW9uTmFtZSAmJlxuICAgICAgICAgICAgICAgIHByZXZJc0ZseW91dEl0ZW0pIHtcbiAgICAgICAgICBjb25zdCBmbHlvdXRJdGVtID0gaXRlbURlZiBhcyB0b29sYm94LkZseW91dEl0ZW1JbmZvO1xuICAgICAgICAgIHRoaXMuZmx5b3V0SXRlbXNfLnB1c2goZmx5b3V0SXRlbSk7XG4gICAgICAgICAgcHJldklzRmx5b3V0SXRlbSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jcmVhdGVUb29sYm94SXRlbV8oaXRlbURlZik7XG4gICAgICAgICAgcHJldklzRmx5b3V0SXRlbSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB0b29sYm94IGl0ZW0gYW5kIGFkZHMgaXQgdG8gdGhlIGxpc3Qgb2YgdG9vbGJveCBpdGVtcy5cbiAgICpcbiAgICogQHBhcmFtIGl0ZW1EZWYgVGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBjcmVhdGUgYSB0b29sYm94IGl0ZW0uXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZVRvb2xib3hJdGVtXyhpdGVtRGVmOiB0b29sYm94LlRvb2xib3hJdGVtSW5mbykge1xuICAgIGxldCByZWdpc3RyeU5hbWUgPSBpdGVtRGVmWydraW5kJ107XG4gICAgY29uc3QgY2F0ZWdvcnlEZWYgPSBpdGVtRGVmIGFzIHRvb2xib3guQ2F0ZWdvcnlJbmZvO1xuICAgIC8vIENhdGVnb3JpZXMgdGhhdCBhcmUgY29sbGFwc2libGUgYXJlIGNyZWF0ZWQgdXNpbmcgYSBjbGFzcyByZWdpc3RlcmVkXG4gICAgLy8gdW5kZXIgYSBkaWZmZXJlbnQgbmFtZS5cbiAgICBpZiAocmVnaXN0cnlOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdDQVRFR09SWScgJiZcbiAgICAgICAgdG9vbGJveC5pc0NhdGVnb3J5Q29sbGFwc2libGUoY2F0ZWdvcnlEZWYpKSB7XG4gICAgICByZWdpc3RyeU5hbWUgPSBDb2xsYXBzaWJsZVRvb2xib3hDYXRlZ29yeS5yZWdpc3RyYXRpb25OYW1lO1xuICAgIH1cbiAgICBjb25zdCBUb29sYm94SXRlbUNsYXNzID1cbiAgICAgICAgcmVnaXN0cnkuZ2V0Q2xhc3MocmVnaXN0cnkuVHlwZS5UT09MQk9YX0lURU0sIHJlZ2lzdHJ5TmFtZSk7XG4gICAgY29uc3QgdG9vbGJveEl0ZW0gPVxuICAgICAgICBuZXcgVG9vbGJveEl0ZW1DbGFzcyEoaXRlbURlZiwgdGhpcy5wYXJlbnRUb29sYm94XywgdGhpcyk7XG4gICAgdGhpcy50b29sYm94SXRlbXNfLnB1c2godG9vbGJveEl0ZW0pO1xuICB9XG5cbiAgb3ZlcnJpZGUgaW5pdCgpIHtcbiAgICBzdXBlci5pbml0KCk7XG5cbiAgICB0aGlzLnNldEV4cGFuZGVkKFxuICAgICAgICAodGhpcy50b29sYm94SXRlbURlZl8gYXMgQW55RHVyaW5nTWlncmF0aW9uKVsnZXhwYW5kZWQnXSA9PT0gJ3RydWUnIHx8XG4gICAgICAgICh0aGlzLnRvb2xib3hJdGVtRGVmXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydleHBhbmRlZCddKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGNyZWF0ZURvbV8oKSB7XG4gICAgc3VwZXIuY3JlYXRlRG9tXygpO1xuXG4gICAgY29uc3Qgc3ViQ2F0ZWdvcmllcyA9IHRoaXMuZ2V0Q2hpbGRUb29sYm94SXRlbXMoKTtcbiAgICB0aGlzLnN1YmNhdGVnb3JpZXNEaXZfID0gdGhpcy5jcmVhdGVTdWJDYXRlZ29yaWVzRG9tXyhzdWJDYXRlZ29yaWVzKTtcbiAgICBhcmlhLnNldFJvbGUodGhpcy5zdWJjYXRlZ29yaWVzRGl2XywgYXJpYS5Sb2xlLkdST1VQKTtcbiAgICB0aGlzLmh0bWxEaXZfIS5hcHBlbmRDaGlsZCh0aGlzLnN1YmNhdGVnb3JpZXNEaXZfKTtcblxuICAgIHJldHVybiB0aGlzLmh0bWxEaXZfITtcbiAgfVxuXG4gIG92ZXJyaWRlIGNyZWF0ZUljb25Eb21fKCkge1xuICAgIGNvbnN0IHRvb2xib3hJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIGlmICghdGhpcy5wYXJlbnRUb29sYm94Xy5pc0hvcml6b250YWwoKSkge1xuICAgICAgY29uc3QgY2xhc3NOYW1lID0gKHRoaXMuY3NzQ29uZmlnXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWydpY29uJ107XG4gICAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICAgIGRvbS5hZGRDbGFzcyh0b29sYm94SWNvbiwgY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICAgIHRvb2xib3hJY29uLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG4gICAgfVxuXG4gICAgdG9vbGJveEljb24uc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snO1xuICAgIHJldHVybiB0b29sYm94SWNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIERPTSBmb3IgYWxsIHN1YmNhdGVnb3JpZXMuXG4gICAqXG4gICAqIEBwYXJhbSBzdWJjYXRlZ29yaWVzIFRoZSBzdWJjYXRlZ29yaWVzLlxuICAgKiBAcmV0dXJucyBUaGUgZGl2IGhvbGRpbmcgYWxsIHRoZSBzdWJjYXRlZ29yaWVzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZVN1YkNhdGVnb3JpZXNEb21fKHN1YmNhdGVnb3JpZXM6IElUb29sYm94SXRlbVtdKTpcbiAgICAgIEhUTUxEaXZFbGVtZW50IHtcbiAgICBjb25zdCBjb250ZW50c0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9ICh0aGlzLmNzc0NvbmZpZ18gYXMgQW55RHVyaW5nTWlncmF0aW9uKVsnY29udGVudHMnXTtcbiAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICBkb20uYWRkQ2xhc3MoY29udGVudHNDb250YWluZXIsIGNsYXNzTmFtZSk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJjYXRlZ29yaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBuZXdDYXRlZ29yeSA9IHN1YmNhdGVnb3JpZXNbaV07XG4gICAgICBuZXdDYXRlZ29yeS5pbml0KCk7XG4gICAgICBjb25zdCBuZXdDYXRlZ29yeURpdiA9IG5ld0NhdGVnb3J5LmdldERpdigpO1xuICAgICAgY29udGVudHNDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3Q2F0ZWdvcnlEaXYhKTtcbiAgICAgIGlmIChuZXdDYXRlZ29yeS5nZXRDbGlja1RhcmdldCkge1xuICAgICAgICBuZXdDYXRlZ29yeS5nZXRDbGlja1RhcmdldCgpPy5zZXRBdHRyaWJ1dGUoJ2lkJywgbmV3Q2F0ZWdvcnkuZ2V0SWQoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50c0NvbnRhaW5lcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVucyBvciBjbG9zZXMgdGhlIGN1cnJlbnQgY2F0ZWdvcnkuXG4gICAqXG4gICAqIEBwYXJhbSBpc0V4cGFuZGVkIFRydWUgdG8gZXhwYW5kIHRoZSBjYXRlZ29yeSwgZmFsc2UgdG8gY2xvc2UuXG4gICAqL1xuICBzZXRFeHBhbmRlZChpc0V4cGFuZGVkOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuZXhwYW5kZWRfID09PSBpc0V4cGFuZGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZXhwYW5kZWRfID0gaXNFeHBhbmRlZDtcbiAgICBpZiAoaXNFeHBhbmRlZCkge1xuICAgICAgdGhpcy5zdWJjYXRlZ29yaWVzRGl2XyEuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICB0aGlzLm9wZW5JY29uXyh0aGlzLmljb25Eb21fKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdWJjYXRlZ29yaWVzRGl2XyEuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgIHRoaXMuY2xvc2VJY29uXyh0aGlzLmljb25Eb21fKTtcbiAgICB9XG4gICAgYXJpYS5zZXRTdGF0ZShcbiAgICAgICAgdGhpcy5odG1sRGl2XyBhcyBIVE1MRGl2RWxlbWVudCwgYXJpYS5TdGF0ZS5FWFBBTkRFRCwgaXNFeHBhbmRlZCk7XG5cbiAgICB0aGlzLnBhcmVudFRvb2xib3hfLmhhbmRsZVRvb2xib3hJdGVtUmVzaXplKCk7XG4gIH1cblxuICBvdmVycmlkZSBzZXRWaXNpYmxlXyhpc1Zpc2libGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmh0bWxEaXZfIS5zdHlsZS5kaXNwbGF5ID0gaXNWaXNpYmxlID8gJ2Jsb2NrJyA6ICdub25lJztcbiAgICBjb25zdCBjaGlsZFRvb2xib3hJdGVtcyA9IHRoaXMuZ2V0Q2hpbGRUb29sYm94SXRlbXMoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkVG9vbGJveEl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IGNoaWxkVG9vbGJveEl0ZW1zW2ldO1xuICAgICAgY2hpbGQuc2V0VmlzaWJsZV8oaXNWaXNpYmxlKTtcbiAgICB9XG4gICAgdGhpcy5pc0hpZGRlbl8gPSAhaXNWaXNpYmxlO1xuXG4gICAgaWYgKHRoaXMucGFyZW50VG9vbGJveF8uZ2V0U2VsZWN0ZWRJdGVtKCkgPT09IHRoaXMpIHtcbiAgICAgIHRoaXMucGFyZW50VG9vbGJveF8uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGUgY2F0ZWdvcnkgaXMgZXhwYW5kZWQgdG8gc2hvdyBpdHMgY2hpbGQgc3ViY2F0ZWdvcmllcy5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdG9vbGJveCBpdGVtIHNob3dzIGl0cyBjaGlsZHJlbiwgZmFsc2UgaWYgaXQgaXNcbiAgICogICAgIGNvbGxhcHNlZC5cbiAgICovXG4gIGlzRXhwYW5kZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZXhwYW5kZWRfO1xuICB9XG5cbiAgb3ZlcnJpZGUgaXNDb2xsYXBzaWJsZSgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIG92ZXJyaWRlIG9uQ2xpY2soX2U6IEV2ZW50KSB7XG4gICAgdGhpcy50b2dnbGVFeHBhbmRlZCgpO1xuICB9XG5cbiAgLyoqIFRvZ2dsZXMgd2hldGhlciBvciBub3QgdGhlIGNhdGVnb3J5IGlzIGV4cGFuZGVkLiAqL1xuICB0b2dnbGVFeHBhbmRlZCgpIHtcbiAgICB0aGlzLnNldEV4cGFuZGVkKCF0aGlzLmV4cGFuZGVkXyk7XG4gIH1cblxuICBvdmVycmlkZSBnZXREaXYoKSB7XG4gICAgcmV0dXJuIHRoaXMuaHRtbERpdl87XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbnkgY2hpbGRyZW4gdG9vbGJveCBpdGVtcy4gKGV4LiBHZXRzIHRoZSBzdWJjYXRlZ29yaWVzKVxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY2hpbGQgdG9vbGJveCBpdGVtcy5cbiAgICovXG4gIGdldENoaWxkVG9vbGJveEl0ZW1zKCk6IElUb29sYm94SXRlbVtdIHtcbiAgICByZXR1cm4gdGhpcy50b29sYm94SXRlbXNfO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgQ29sbGFwc2libGVUb29sYm94Q2F0ZWdvcnkge1xuICAvKipcbiAgICogQWxsIHRoZSBDU1MgY2xhc3MgbmFtZXMgdGhhdCBhcmUgdXNlZCB0byBjcmVhdGUgYSBjb2xsYXBzaWJsZVxuICAgKiBjYXRlZ29yeS4gVGhpcyBpcyBhbGwgdGhlIHByb3BlcnRpZXMgZnJvbSB0aGUgcmVndWxhciBjYXRlZ29yeSBwbHVzXG4gICAqIGNvbnRlbnRzLlxuICAgKi9cbiAgZXhwb3J0IGludGVyZmFjZSBDc3NDb25maWcge1xuICAgIGNvbnRhaW5lcjogc3RyaW5nfG51bGw7XG4gICAgcm93OiBzdHJpbmd8bnVsbDtcbiAgICByb3djb250ZW50Y29udGFpbmVyOiBzdHJpbmd8bnVsbDtcbiAgICBpY29uOiBzdHJpbmd8bnVsbDtcbiAgICBsYWJlbDogc3RyaW5nfG51bGw7XG4gICAgc2VsZWN0ZWQ6IHN0cmluZ3xudWxsO1xuICAgIG9wZW5pY29uOiBzdHJpbmd8bnVsbDtcbiAgICBjbG9zZWRpY29uOiBzdHJpbmd8bnVsbDtcbiAgICBjb250ZW50czogc3RyaW5nfG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgQ3NzQ29uZmlnID0gQ29sbGFwc2libGVUb29sYm94Q2F0ZWdvcnkuQ3NzQ29uZmlnO1xuXG5yZWdpc3RyeS5yZWdpc3RlcihcbiAgICByZWdpc3RyeS5UeXBlLlRPT0xCT1hfSVRFTSwgQ29sbGFwc2libGVUb29sYm94Q2F0ZWdvcnkucmVnaXN0cmF0aW9uTmFtZSxcbiAgICBDb2xsYXBzaWJsZVRvb2xib3hDYXRlZ29yeSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVG9vbGJveCBmcm9tIHdoZW5jZSB0byBjcmVhdGUgYmxvY2tzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRvb2xib3gnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuLi9ldmVudHMvZXZlbnRzX3Rvb2xib3hfaXRlbV9zZWxlY3QuanMnO1xuXG5pbXBvcnQge0Jsb2NrU3ZnfSBmcm9tICcuLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrbHlPcHRpb25zfSBmcm9tICcuLi9ibG9ja2x5X29wdGlvbnMuanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi4vY29tbW9uLmpzJztcbmltcG9ydCB7Q29tcG9uZW50TWFuYWdlcn0gZnJvbSAnLi4vY29tcG9uZW50X21hbmFnZXIuanMnO1xuaW1wb3J0ICogYXMgQ3NzIGZyb20gJy4uL2Nzcy5qcyc7XG5pbXBvcnQge0RlbGV0ZUFyZWF9IGZyb20gJy4uL2RlbGV0ZV9hcmVhLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtJQXV0b0hpZGVhYmxlfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfYXV0b2hpZGVhYmxlLmpzJztcbmltcG9ydCB0eXBlIHtJQ29sbGFwc2libGVUb29sYm94SXRlbX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX2NvbGxhcHNpYmxlX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgdHlwZSB7SURyYWdnYWJsZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX2RyYWdnYWJsZS5qcyc7XG5pbXBvcnQgdHlwZSB7SUZseW91dH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX2ZseW91dC5qcyc7XG5pbXBvcnQgdHlwZSB7SUtleWJvYXJkQWNjZXNzaWJsZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX2tleWJvYXJkX2FjY2Vzc2libGUuanMnO1xuaW1wb3J0IHR5cGUge0lTZWxlY3RhYmxlVG9vbGJveEl0ZW19IGZyb20gJy4uL2ludGVyZmFjZXMvaV9zZWxlY3RhYmxlX3Rvb2xib3hfaXRlbS5qcyc7XG5pbXBvcnQgdHlwZSB7SVN0eWxlYWJsZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3N0eWxlYWJsZS5qcyc7XG5pbXBvcnQgdHlwZSB7SVRvb2xib3h9IGZyb20gJy4uL2ludGVyZmFjZXMvaV90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtJVG9vbGJveEl0ZW19IGZyb20gJy4uL2ludGVyZmFjZXMvaV90b29sYm94X2l0ZW0uanMnO1xuaW1wb3J0IHtPcHRpb25zfSBmcm9tICcuLi9vcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtLZXlib2FyZFNob3J0Y3V0fSBmcm9tICcuLi9zaG9ydGN1dF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBUb3VjaCBmcm9tICcuLi90b3VjaC5qcyc7XG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4uL3V0aWxzL2FyaWEuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4uL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQge0tleUNvZGVzfSBmcm9tICcuLi91dGlscy9rZXljb2Rlcy5qcyc7XG5pbXBvcnQge1JlY3R9IGZyb20gJy4uL3V0aWxzL3JlY3QuanMnO1xuaW1wb3J0ICogYXMgdG9vbGJveCBmcm9tICcuLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4uL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5pbXBvcnQgdHlwZSB7VG9vbGJveENhdGVnb3J5fSBmcm9tICcuL2NhdGVnb3J5LmpzJztcbmltcG9ydCB7Q29sbGFwc2libGVUb29sYm94Q2F0ZWdvcnl9IGZyb20gJy4vY29sbGFwc2libGVfY2F0ZWdvcnkuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgVG9vbGJveC5cbiAqIENyZWF0ZXMgdGhlIHRvb2xib3gncyBET00uXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVG9vbGJveFxuICovXG5leHBvcnQgY2xhc3MgVG9vbGJveCBleHRlbmRzIERlbGV0ZUFyZWEgaW1wbGVtZW50cyBJQXV0b0hpZGVhYmxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSUtleWJvYXJkQWNjZXNzaWJsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElTdHlsZWFibGUsIElUb29sYm94IHtcbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgSUQgZm9yIHRoaXMgY29tcG9uZW50IHRoYXQgaXMgdXNlZCB0byByZWdpc3RlciB3aXRoIHRoZVxuICAgKiBDb21wb25lbnRNYW5hZ2VyLlxuICAgKi9cbiAgb3ZlcnJpZGUgaWQgPSAndG9vbGJveCc7XG4gIHByb3RlY3RlZCB0b29sYm94RGVmXzogdG9vbGJveC5Ub29sYm94SW5mbztcbiAgcHJpdmF0ZSByZWFkb25seSBob3Jpem9udGFsTGF5b3V0XzogYm9vbGVhbjtcblxuICAvKiogVGhlIGh0bWwgY29udGFpbmVyIGZvciB0aGUgdG9vbGJveC4gKi9cbiAgSHRtbERpdjogSFRNTERpdkVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBodG1sIGNvbnRhaW5lciBmb3IgdGhlIGNvbnRlbnRzIG9mIGEgdG9vbGJveC4gKi9cbiAgcHJvdGVjdGVkIGNvbnRlbnRzRGl2XzogSFRNTERpdkVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFdoZXRoZXIgdGhlIFRvb2xib3ggaXMgdmlzaWJsZS4gKi9cbiAgcHJvdGVjdGVkIGlzVmlzaWJsZV8gPSBmYWxzZTtcblxuICAvKiogVGhlIGxpc3Qgb2YgaXRlbXMgaW4gdGhlIHRvb2xib3guICovXG4gIHByb3RlY3RlZCBjb250ZW50c186IElUb29sYm94SXRlbVtdID0gW107XG5cbiAgLyoqIFRoZSB3aWR0aCBvZiB0aGUgdG9vbGJveC4gKi9cbiAgcHJvdGVjdGVkIHdpZHRoXyA9IDA7XG5cbiAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIHRvb2xib3guICovXG4gIHByb3RlY3RlZCBoZWlnaHRfID0gMDtcbiAgUlRMOiBib29sZWFuO1xuXG4gIC8qKiBUaGUgZmx5b3V0IGZvciB0aGUgdG9vbGJveC4gKi9cbiAgcHJpdmF0ZSBmbHlvdXRfOiBJRmx5b3V0fG51bGwgPSBudWxsO1xuICBwcm90ZWN0ZWQgY29udGVudE1hcF86IHtba2V5OiBzdHJpbmddOiBJVG9vbGJveEl0ZW19O1xuICB0b29sYm94UG9zaXRpb246IHRvb2xib3guUG9zaXRpb247XG5cbiAgLyoqIFRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgaXRlbS4gKi9cbiAgcHJvdGVjdGVkIHNlbGVjdGVkSXRlbV86IElTZWxlY3RhYmxlVG9vbGJveEl0ZW18bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBwcmV2aW91c2x5IHNlbGVjdGVkIGl0ZW0uICovXG4gIHByb3RlY3RlZCBwcmV2aW91c2x5U2VsZWN0ZWRJdGVtXzogSVNlbGVjdGFibGVUb29sYm94SXRlbXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQXJyYXkgaG9sZGluZyBpbmZvIG5lZWRlZCB0byB1bmJpbmQgZXZlbnQgaGFuZGxlcnMuXG4gICAqIFVzZWQgZm9yIGRpc3Bvc2luZy5cbiAgICogRXg6IFtbbm9kZSwgbmFtZSwgZnVuY10sIFtub2RlLCBuYW1lLCBmdW5jXV0uXG4gICAqL1xuICBwcm90ZWN0ZWQgYm91bmRFdmVudHNfOiBicm93c2VyRXZlbnRzLkRhdGFbXSA9IFtdO1xuICBvdmVycmlkZSB3b3VsZERlbGV0ZV86IEFueUR1cmluZ01pZ3JhdGlvbjtcblxuICAvKiogVGhlIHdvcmtzcGFjZSB0aGlzIHRvb2xib3ggaXMgb24uICovXG4gIHByb3RlY3RlZCByZWFkb25seSB3b3Jrc3BhY2VfOiBXb3Jrc3BhY2VTdmc7XG5cbiAgLyoqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBpbiB3aGljaCB0byBjcmVhdGUgbmV3IGJsb2Nrcy4gKi9cbiAgY29uc3RydWN0b3Iod29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy53b3Jrc3BhY2VfID0gd29ya3NwYWNlO1xuXG4gICAgLyoqIFRoZSBKU09OIGRlc2NyaWJpbmcgdGhlIGNvbnRlbnRzIG9mIHRoaXMgdG9vbGJveC4gKi9cbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ1Rvb2xib3hJbmZvIHwgeyBjb250ZW50czogbmV2ZXJbXTsgfSdcbiAgICAvLyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlICdUb29sYm94SW5mbycuXG4gICAgdGhpcy50b29sYm94RGVmXyA9ICh3b3Jrc3BhY2Uub3B0aW9ucy5sYW5ndWFnZVRyZWUgfHwgeydjb250ZW50cyc6IFtdfSkgYXNcbiAgICAgICAgQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gICAgLyoqIFdoZXRoZXIgdGhlIHRvb2xib3ggc2hvdWxkIGJlIGxhaWQgb3V0IGhvcml6b250YWxseS4gKi9cbiAgICB0aGlzLmhvcml6b250YWxMYXlvdXRfID0gd29ya3NwYWNlLm9wdGlvbnMuaG9yaXpvbnRhbExheW91dDtcblxuICAgIC8qKiBJcyBSVEwgdnMgTFRSLiAqL1xuICAgIHRoaXMuUlRMID0gd29ya3NwYWNlLm9wdGlvbnMuUlRMO1xuXG4gICAgLyoqIEEgbWFwIGZyb20gdG9vbGJveCBpdGVtIElEcyB0byB0b29sYm94IGl0ZW1zLiAqL1xuICAgIHRoaXMuY29udGVudE1hcF8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgLyoqIFBvc2l0aW9uIG9mIHRoZSB0b29sYm94IGFuZCBmbHlvdXQgcmVsYXRpdmUgdG8gdGhlIHdvcmtzcGFjZS4gKi9cbiAgICB0aGlzLnRvb2xib3hQb3NpdGlvbiA9IHdvcmtzcGFjZS5vcHRpb25zLnRvb2xib3hQb3NpdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSBnaXZlbiBrZXlib2FyZCBzaG9ydGN1dC5cbiAgICpcbiAgICogQHBhcmFtIF9zaG9ydGN1dCBUaGUgc2hvcnRjdXQgdG8gYmUgaGFuZGxlZC5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgc2hvcnRjdXQgaGFzIGJlZW4gaGFuZGxlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgb25TaG9ydGN1dChfc2hvcnRjdXQ6IEtleWJvYXJkU2hvcnRjdXQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKiogSW5pdGlhbGl6ZXMgdGhlIHRvb2xib3ggKi9cbiAgaW5pdCgpIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLndvcmtzcGFjZV87XG4gICAgY29uc3Qgc3ZnID0gd29ya3NwYWNlLmdldFBhcmVudFN2ZygpO1xuXG4gICAgdGhpcy5mbHlvdXRfID0gdGhpcy5jcmVhdGVGbHlvdXRfKCk7XG5cbiAgICB0aGlzLkh0bWxEaXYgPSB0aGlzLmNyZWF0ZURvbV8odGhpcy53b3Jrc3BhY2VfKTtcbiAgICBkb20uaW5zZXJ0QWZ0ZXIodGhpcy5mbHlvdXRfLmNyZWF0ZURvbSgnc3ZnJyksIHN2Zyk7XG4gICAgdGhpcy5zZXRWaXNpYmxlKHRydWUpO1xuICAgIHRoaXMuZmx5b3V0Xy5pbml0KHdvcmtzcGFjZSk7XG5cbiAgICB0aGlzLnJlbmRlcih0aGlzLnRvb2xib3hEZWZfKTtcbiAgICBjb25zdCB0aGVtZU1hbmFnZXIgPSB3b3Jrc3BhY2UuZ2V0VGhlbWVNYW5hZ2VyKCk7XG4gICAgdGhlbWVNYW5hZ2VyLnN1YnNjcmliZShcbiAgICAgICAgdGhpcy5IdG1sRGl2LCAndG9vbGJveEJhY2tncm91bmRDb2xvdXInLCAnYmFja2dyb3VuZC1jb2xvcicpO1xuICAgIHRoZW1lTWFuYWdlci5zdWJzY3JpYmUodGhpcy5IdG1sRGl2LCAndG9vbGJveEZvcmVncm91bmRDb2xvdXInLCAnY29sb3InKTtcbiAgICB0aGlzLndvcmtzcGFjZV8uZ2V0Q29tcG9uZW50TWFuYWdlcigpLmFkZENvbXBvbmVudCh7XG4gICAgICBjb21wb25lbnQ6IHRoaXMsXG4gICAgICB3ZWlnaHQ6IDEsXG4gICAgICBjYXBhYmlsaXRpZXM6IFtcbiAgICAgICAgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkFVVE9ISURFQUJMRSxcbiAgICAgICAgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkRFTEVURV9BUkVBLFxuICAgICAgICBDb21wb25lbnRNYW5hZ2VyLkNhcGFiaWxpdHkuRFJBR19UQVJHRVQsXG4gICAgICBdLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIERPTSBmb3IgdGhlIHRvb2xib3guXG4gICAqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0aGlzIHRvb2xib3ggaXMgb24uXG4gICAqIEByZXR1cm5zIFRoZSBIVE1MIGNvbnRhaW5lciBmb3IgdGhlIHRvb2xib3guXG4gICAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlRG9tXyh3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zyk6IEhUTUxEaXZFbGVtZW50IHtcbiAgICBjb25zdCBzdmcgPSB3b3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCk7XG5cbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lcl8oKTtcblxuICAgIHRoaXMuY29udGVudHNEaXZfID0gdGhpcy5jcmVhdGVDb250ZW50c0NvbnRhaW5lcl8oKTtcbiAgICB0aGlzLmNvbnRlbnRzRGl2Xy50YWJJbmRleCA9IDA7XG4gICAgYXJpYS5zZXRSb2xlKHRoaXMuY29udGVudHNEaXZfLCBhcmlhLlJvbGUuVFJFRSk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY29udGVudHNEaXZfKTtcblxuICAgIHN2Zy5wYXJlbnROb2RlIS5pbnNlcnRCZWZvcmUoY29udGFpbmVyLCBzdmcpO1xuXG4gICAgdGhpcy5hdHRhY2hFdmVudHNfKGNvbnRhaW5lciwgdGhpcy5jb250ZW50c0Rpdl8pO1xuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgY29udGFpbmVyIGRpdiBmb3IgdGhlIHRvb2xib3guXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBIVE1MIGNvbnRhaW5lciBmb3IgdGhlIHRvb2xib3guXG4gICAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlQ29udGFpbmVyXygpOiBIVE1MRGl2RWxlbWVudCB7XG4gICAgY29uc3QgdG9vbGJveENvbnRhaW5lciA9IChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XG4gICAgdG9vbGJveENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2xheW91dCcsIHRoaXMuaXNIb3Jpem9udGFsKCkgPyAnaCcgOiAndicpO1xuICAgIGRvbS5hZGRDbGFzcyh0b29sYm94Q29udGFpbmVyLCAnYmxvY2tseVRvb2xib3hEaXYnKTtcbiAgICBkb20uYWRkQ2xhc3ModG9vbGJveENvbnRhaW5lciwgJ2Jsb2NrbHlOb25TZWxlY3RhYmxlJyk7XG4gICAgdG9vbGJveENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RpcicsIHRoaXMuUlRMID8gJ1JUTCcgOiAnTFRSJyk7XG4gICAgcmV0dXJuIHRvb2xib3hDb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgY29udGFpbmVyIGZvciBhbGwgdGhlIGNvbnRlbnRzIGluIHRoZSB0b29sYm94LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgSFRNTCBjb250YWluZXIgZm9yIHRoZSB0b29sYm94IGNvbnRlbnRzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZUNvbnRlbnRzQ29udGFpbmVyXygpOiBIVE1MRGl2RWxlbWVudCB7XG4gICAgY29uc3QgY29udGVudHNDb250YWluZXIgPSAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICAgIGRvbS5hZGRDbGFzcyhjb250ZW50c0NvbnRhaW5lciwgJ2Jsb2NrbHlUb29sYm94Q29udGVudHMnKTtcbiAgICBpZiAodGhpcy5pc0hvcml6b250YWwoKSkge1xuICAgICAgY29udGVudHNDb250YWluZXIuc3R5bGUuZmxleERpcmVjdGlvbiA9ICdyb3cnO1xuICAgIH1cbiAgICByZXR1cm4gY29udGVudHNDb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBldmVudCBsaXN0ZW5lcnMgdG8gdGhlIHRvb2xib3ggY29udGFpbmVyIGRpdi5cbiAgICpcbiAgICogQHBhcmFtIGNvbnRhaW5lciBUaGUgSFRNTCBjb250YWluZXIgZm9yIHRoZSB0b29sYm94LlxuICAgKiBAcGFyYW0gY29udGVudHNDb250YWluZXIgVGhlIEhUTUwgY29udGFpbmVyIGZvciB0aGUgY29udGVudHMgb2YgdGhlXG4gICAqICAgICB0b29sYm94LlxuICAgKi9cbiAgcHJvdGVjdGVkIGF0dGFjaEV2ZW50c18oXG4gICAgICBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50LCBjb250ZW50c0NvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcbiAgICAvLyBDbGlja2luZyBvbiB0b29sYm94IGNsb3NlcyBwb3B1cHMuXG4gICAgY29uc3QgY2xpY2tFdmVudCA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBjb250YWluZXIsICdwb2ludGVyZG93bicsIHRoaXMsIHRoaXMub25DbGlja18sXG4gICAgICAgIC8qIG9wdF9ub0NhcHR1cmVJZGVudGlmaWVyICovIGZhbHNlKTtcbiAgICB0aGlzLmJvdW5kRXZlbnRzXy5wdXNoKGNsaWNrRXZlbnQpO1xuXG4gICAgY29uc3Qga2V5RG93bkV2ZW50ID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIGNvbnRlbnRzQ29udGFpbmVyLCAna2V5ZG93bicsIHRoaXMsIHRoaXMub25LZXlEb3duXyxcbiAgICAgICAgLyogb3B0X25vQ2FwdHVyZUlkZW50aWZpZXIgKi8gZmFsc2UpO1xuICAgIHRoaXMuYm91bmRFdmVudHNfLnB1c2goa2V5RG93bkV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIG9uIGNsaWNrIGV2ZW50cyBmb3Igd2hlbiB0aGUgdG9vbGJveCBvciB0b29sYm94IGl0ZW1zIGFyZSBjbGlja2VkLlxuICAgKlxuICAgKiBAcGFyYW0gZSBDbGljayBldmVudCB0byBoYW5kbGUuXG4gICAqL1xuICBwcm90ZWN0ZWQgb25DbGlja18oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgaWYgKGJyb3dzZXJFdmVudHMuaXNSaWdodEJ1dHRvbihlKSB8fCBlLnRhcmdldCA9PT0gdGhpcy5IdG1sRGl2KSB7XG4gICAgICAvLyBDbG9zZSBmbHlvdXQuXG4gICAgICAoY29tbW9uLmdldE1haW5Xb3Jrc3BhY2UoKSBhcyBXb3Jrc3BhY2VTdmcpLmhpZGVDaGFmZihmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IGl0ZW1JZCA9ICh0YXJnZXRFbGVtZW50IGFzIEVsZW1lbnQpLmdldEF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgIGlmIChpdGVtSWQpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0VG9vbGJveEl0ZW1CeUlkKGl0ZW1JZCk7XG4gICAgICAgIGlmIChpdGVtIS5pc1NlbGVjdGFibGUoKSkge1xuICAgICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJdGVtKGl0ZW0pO1xuICAgICAgICAgIChpdGVtIGFzIElTZWxlY3RhYmxlVG9vbGJveEl0ZW0pLm9uQ2xpY2soZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEp1c3QgY2xvc2UgcG9wdXBzLlxuICAgICAgKGNvbW1vbi5nZXRNYWluV29ya3NwYWNlKCkgYXMgV29ya3NwYWNlU3ZnKS5oaWRlQ2hhZmYodHJ1ZSk7XG4gICAgfVxuICAgIFRvdWNoLmNsZWFyVG91Y2hJZGVudGlmaWVyKCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyBrZXkgZG93biBldmVudHMgZm9yIHRoZSB0b29sYm94LlxuICAgKlxuICAgKiBAcGFyYW0gZSBUaGUga2V5IGRvd24gZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb25LZXlEb3duXyhlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgbGV0IGhhbmRsZWQgPSBmYWxzZTtcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgY2FzZSBLZXlDb2Rlcy5ET1dOOlxuICAgICAgICBoYW5kbGVkID0gdGhpcy5zZWxlY3ROZXh0XygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgS2V5Q29kZXMuVVA6XG4gICAgICAgIGhhbmRsZWQgPSB0aGlzLnNlbGVjdFByZXZpb3VzXygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgS2V5Q29kZXMuTEVGVDpcbiAgICAgICAgaGFuZGxlZCA9IHRoaXMuc2VsZWN0UGFyZW50XygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgS2V5Q29kZXMuUklHSFQ6XG4gICAgICAgIGhhbmRsZWQgPSB0aGlzLnNlbGVjdENoaWxkXygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgS2V5Q29kZXMuRU5URVI6XG4gICAgICBjYXNlIEtleUNvZGVzLlNQQUNFOlxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEl0ZW1fICYmIHRoaXMuc2VsZWN0ZWRJdGVtXy5pc0NvbGxhcHNpYmxlKCkpIHtcbiAgICAgICAgICBjb25zdCBjb2xsYXBzaWJsZUl0ZW0gPSB0aGlzLnNlbGVjdGVkSXRlbV8gYXMgSUNvbGxhcHNpYmxlVG9vbGJveEl0ZW07XG4gICAgICAgICAgY29sbGFwc2libGVJdGVtLnRvZ2dsZUV4cGFuZGVkKCk7XG4gICAgICAgICAgaGFuZGxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBoYW5kbGVkID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoIWhhbmRsZWQgJiYgdGhpcy5zZWxlY3RlZEl0ZW1fKSB7XG4gICAgICAvLyBUT0RPKCM2MDk3KTogRmlndXJlIG91dCB3aG8gaW1wbGVtZW50cyBvbktleURvd24gYW5kIHdoaWNoIGludGVyZmFjZSBpdFxuICAgICAgLy8gc2hvdWxkIGJlIHBhcnQgb2YuXG4gICAgICBjb25zdCB1bnR5cGVkSXRlbSA9IHRoaXMuc2VsZWN0ZWRJdGVtXyBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gICAgICBpZiAodW50eXBlZEl0ZW0ub25LZXlEb3duKSB7XG4gICAgICAgIGhhbmRsZWQgPSB1bnR5cGVkSXRlbS5vbktleURvd24oZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGhhbmRsZWQpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgZmx5b3V0IGJhc2VkIG9uIHRoZSB0b29sYm94IGxheW91dC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGZseW91dCBmb3IgdGhlIHRvb2xib3guXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBtaXNzaW5nIGEgcmVxdWlyZSBmb3IgYEJsb2NrbHkuSG9yaXpvbnRhbEZseW91dGAsXG4gICAqICAgICBgQmxvY2tseS5WZXJ0aWNhbEZseW91dGAsIGFuZCBubyBmbHlvdXQgcGx1Z2luIGlzIHNwZWNpZmllZC5cbiAgICovXG4gIHByb3RlY3RlZCBjcmVhdGVGbHlvdXRfKCk6IElGbHlvdXQge1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMud29ya3NwYWNlXztcbiAgICAvLyBUT0RPICgjNDI0Nyk6IExvb2sgaW50byBhZGRpbmcgYSBtYWtlRmx5b3V0IG1ldGhvZCB0byBCbG9ja2x5IE9wdGlvbnMuXG4gICAgY29uc3Qgd29ya3NwYWNlT3B0aW9ucyA9IG5ldyBPcHRpb25zKCh7XG4gICAgICAncGFyZW50V29ya3NwYWNlJzogd29ya3NwYWNlLFxuICAgICAgJ3J0bCc6IHdvcmtzcGFjZS5SVEwsXG4gICAgICAnb25lQmFzZWRJbmRleCc6IHdvcmtzcGFjZS5vcHRpb25zLm9uZUJhc2VkSW5kZXgsXG4gICAgICAnaG9yaXpvbnRhbExheW91dCc6IHdvcmtzcGFjZS5ob3Jpem9udGFsTGF5b3V0LFxuICAgICAgJ3JlbmRlcmVyJzogd29ya3NwYWNlLm9wdGlvbnMucmVuZGVyZXIsXG4gICAgICAncmVuZGVyZXJPdmVycmlkZXMnOiB3b3Jrc3BhY2Uub3B0aW9ucy5yZW5kZXJlck92ZXJyaWRlcyxcbiAgICAgICdtb3ZlJzoge1xuICAgICAgICAnc2Nyb2xsYmFycyc6IHRydWUsXG4gICAgICB9LFxuICAgIH0gYXMgQmxvY2tseU9wdGlvbnMpKTtcbiAgICAvLyBPcHRpb25zIHRha2VzIGluIGVpdGhlciAnZW5kJyBvciAnc3RhcnQnLiBUaGlzIGhhcyBhbHJlYWR5IGJlZW4gcGFyc2VkIHRvXG4gICAgLy8gYmUgZWl0aGVyIDAgb3IgMSwgc28gc2V0IGl0IGFmdGVyLlxuICAgIHdvcmtzcGFjZU9wdGlvbnMudG9vbGJveFBvc2l0aW9uID0gd29ya3NwYWNlLm9wdGlvbnMudG9vbGJveFBvc2l0aW9uO1xuICAgIGxldCBGbHlvdXRDbGFzcyA9IG51bGw7XG4gICAgaWYgKHdvcmtzcGFjZS5ob3Jpem9udGFsTGF5b3V0KSB7XG4gICAgICBGbHlvdXRDbGFzcyA9IHJlZ2lzdHJ5LmdldENsYXNzRnJvbU9wdGlvbnMoXG4gICAgICAgICAgcmVnaXN0cnkuVHlwZS5GTFlPVVRTX0hPUklaT05UQUxfVE9PTEJPWCwgd29ya3NwYWNlLm9wdGlvbnMsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBGbHlvdXRDbGFzcyA9IHJlZ2lzdHJ5LmdldENsYXNzRnJvbU9wdGlvbnMoXG4gICAgICAgICAgcmVnaXN0cnkuVHlwZS5GTFlPVVRTX1ZFUlRJQ0FMX1RPT0xCT1gsIHdvcmtzcGFjZS5vcHRpb25zLCB0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBGbHlvdXRDbGFzcyEod29ya3NwYWNlT3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogRmlsbHMgdGhlIHRvb2xib3ggd2l0aCBuZXcgdG9vbGJveCBpdGVtcyBhbmQgcmVtb3ZlcyBhbnkgb2xkIGNvbnRlbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gdG9vbGJveERlZiBPYmplY3QgaG9sZGluZyBpbmZvcm1hdGlvbiBmb3IgY3JlYXRpbmcgYSB0b29sYm94LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlbmRlcih0b29sYm94RGVmOiB0b29sYm94LlRvb2xib3hJbmZvKSB7XG4gICAgdGhpcy50b29sYm94RGVmXyA9IHRvb2xib3hEZWY7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRlbnRzXy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdG9vbGJveEl0ZW0gPSB0aGlzLmNvbnRlbnRzX1tpXTtcbiAgICAgIGlmICh0b29sYm94SXRlbSkge1xuICAgICAgICB0b29sYm94SXRlbS5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuY29udGVudHNfID0gW107XG4gICAgdGhpcy5jb250ZW50TWFwXyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5yZW5kZXJDb250ZW50c18odG9vbGJveERlZlsnY29udGVudHMnXSk7XG4gICAgdGhpcy5wb3NpdGlvbigpO1xuICAgIHRoaXMuaGFuZGxlVG9vbGJveEl0ZW1SZXNpemUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGFsbCB0aGUgdG9vbGJveCBpdGVtcyB0byB0aGUgdG9vbGJveC5cbiAgICpcbiAgICogQHBhcmFtIHRvb2xib3hEZWYgQXJyYXkgaG9sZGluZyBvYmplY3RzIGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gb24gdGhlXG4gICAqICAgICBjb250ZW50cyBvZiB0aGUgdG9vbGJveC5cbiAgICovXG4gIHByb3RlY3RlZCByZW5kZXJDb250ZW50c18odG9vbGJveERlZjogdG9vbGJveC5Ub29sYm94SXRlbUluZm9bXSkge1xuICAgIC8vIFRoaXMgaXMgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuIEJ5IHVzaW5nIGRvY3VtZW50IGZyYWdtZW50IHdlIG9ubHkgaGF2ZVxuICAgIC8vIHRvIGFkZCB0byB0aGUgRE9NIG9uY2UuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b29sYm94RGVmLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0b29sYm94SXRlbURlZiA9IHRvb2xib3hEZWZbaV07XG4gICAgICB0aGlzLmNyZWF0ZVRvb2xib3hJdGVtXyh0b29sYm94SXRlbURlZiwgZnJhZ21lbnQpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRlbnRzRGl2XyEuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW5kIHJlbmRlcnMgdGhlIHRvb2xib3ggaXRlbS5cbiAgICpcbiAgICogQHBhcmFtIHRvb2xib3hJdGVtRGVmIEFueSBpbmZvcm1hdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBhbiBpdGVtIGluXG4gICAqICAgICB0aGUgdG9vbGJveC5cbiAgICogQHBhcmFtIGZyYWdtZW50IFRoZSBkb2N1bWVudCBmcmFnbWVudCB0byBhZGQgdGhlIGNoaWxkIHRvb2xib3ggZWxlbWVudHMgdG8uXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZVRvb2xib3hJdGVtXyhcbiAgICAgIHRvb2xib3hJdGVtRGVmOiB0b29sYm94LlRvb2xib3hJdGVtSW5mbywgZnJhZ21lbnQ6IERvY3VtZW50RnJhZ21lbnQpIHtcbiAgICBsZXQgcmVnaXN0cnlOYW1lID0gdG9vbGJveEl0ZW1EZWZbJ2tpbmQnXTtcblxuICAgIC8vIENhdGVnb3JpZXMgdGhhdCBhcmUgY29sbGFwc2libGUgYXJlIGNyZWF0ZWQgdXNpbmcgYSBjbGFzcyByZWdpc3RlcmVkXG4gICAgLy8gdW5kZXIgYSBkaWZmZXJlbnQgbmFtZS5cbiAgICBpZiAocmVnaXN0cnlOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdDQVRFR09SWScgJiZcbiAgICAgICAgdG9vbGJveC5pc0NhdGVnb3J5Q29sbGFwc2libGUodG9vbGJveEl0ZW1EZWYgYXMgdG9vbGJveC5DYXRlZ29yeUluZm8pKSB7XG4gICAgICByZWdpc3RyeU5hbWUgPSBDb2xsYXBzaWJsZVRvb2xib3hDYXRlZ29yeS5yZWdpc3RyYXRpb25OYW1lO1xuICAgIH1cblxuICAgIGNvbnN0IFRvb2xib3hJdGVtQ2xhc3MgPSByZWdpc3RyeS5nZXRDbGFzcyhcbiAgICAgICAgcmVnaXN0cnkuVHlwZS5UT09MQk9YX0lURU0sIHJlZ2lzdHJ5TmFtZS50b0xvd2VyQ2FzZSgpKTtcbiAgICBpZiAoVG9vbGJveEl0ZW1DbGFzcykge1xuICAgICAgY29uc3QgdG9vbGJveEl0ZW0gPSBuZXcgVG9vbGJveEl0ZW1DbGFzcyh0b29sYm94SXRlbURlZiwgdGhpcyk7XG4gICAgICB0b29sYm94SXRlbS5pbml0KCk7XG4gICAgICB0aGlzLmFkZFRvb2xib3hJdGVtXyh0b29sYm94SXRlbSk7XG4gICAgICBjb25zdCB0b29sYm94SXRlbURvbSA9IHRvb2xib3hJdGVtLmdldERpdigpO1xuICAgICAgaWYgKHRvb2xib3hJdGVtRG9tKSB7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRvb2xib3hJdGVtRG9tKTtcbiAgICAgIH1cbiAgICAgIC8vIEFkZHMgdGhlIElEIHRvIHRoZSBIVE1MIGVsZW1lbnQgdGhhdCBjYW4gcmVjZWl2ZSBhIGNsaWNrLlxuICAgICAgLy8gVGhpcyBpcyB1c2VkIGluIG9uQ2xpY2tfIHRvIGZpbmQgdGhlIHRvb2xib3hJdGVtIHRoYXQgd2FzIGNsaWNrZWQuXG4gICAgICBpZiAodG9vbGJveEl0ZW0uZ2V0Q2xpY2tUYXJnZXQoKSkge1xuICAgICAgICB0b29sYm94SXRlbS5nZXRDbGlja1RhcmdldCgpIS5zZXRBdHRyaWJ1dGUoJ2lkJywgdG9vbGJveEl0ZW0uZ2V0SWQoKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYW4gaXRlbSB0byB0aGUgdG9vbGJveC5cbiAgICpcbiAgICogQHBhcmFtIHRvb2xib3hJdGVtIFRoZSBpdGVtIGluIHRoZSB0b29sYm94LlxuICAgKi9cbiAgcHJvdGVjdGVkIGFkZFRvb2xib3hJdGVtXyh0b29sYm94SXRlbTogSVRvb2xib3hJdGVtKSB7XG4gICAgdGhpcy5jb250ZW50c18ucHVzaCh0b29sYm94SXRlbSk7XG4gICAgdGhpcy5jb250ZW50TWFwX1t0b29sYm94SXRlbS5nZXRJZCgpXSA9IHRvb2xib3hJdGVtO1xuICAgIGlmICh0b29sYm94SXRlbS5pc0NvbGxhcHNpYmxlKCkpIHtcbiAgICAgIGNvbnN0IGNvbGxhcHNpYmxlSXRlbSA9IHRvb2xib3hJdGVtIGFzIElDb2xsYXBzaWJsZVRvb2xib3hJdGVtO1xuICAgICAgY29uc3QgY2hpbGRUb29sYm94SXRlbXMgPSBjb2xsYXBzaWJsZUl0ZW0uZ2V0Q2hpbGRUb29sYm94SXRlbXMoKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRUb29sYm94SXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZFRvb2xib3hJdGVtc1tpXTtcbiAgICAgICAgdGhpcy5hZGRUb29sYm94SXRlbV8oY2hpbGQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBpdGVtcyBpbiB0aGUgdG9vbGJveC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGxpc3Qgb2YgaXRlbXMgaW4gdGhlIHRvb2xib3guXG4gICAqL1xuICBnZXRUb29sYm94SXRlbXMoKTogSVRvb2xib3hJdGVtW10ge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnRzXztcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgc3R5bGUgb24gdGhlIHRvb2xib3guIFVzdWFsbHkgdXNlZCB0byBjaGFuZ2UgdGhlIGN1cnNvci5cbiAgICpcbiAgICogQHBhcmFtIHN0eWxlIFRoZSBuYW1lIG9mIHRoZSBjbGFzcyB0byBhZGQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYWRkU3R5bGUoc3R5bGU6IHN0cmluZykge1xuICAgIGlmIChzdHlsZSAmJiB0aGlzLkh0bWxEaXYpIHtcbiAgICAgIGRvbS5hZGRDbGFzcyh0aGlzLkh0bWxEaXYsIHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIHN0eWxlIGZyb20gdGhlIHRvb2xib3guIFVzdWFsbHkgdXNlZCB0byBjaGFuZ2UgdGhlIGN1cnNvci5cbiAgICpcbiAgICogQHBhcmFtIHN0eWxlIFRoZSBuYW1lIG9mIHRoZSBjbGFzcyB0byByZW1vdmUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVtb3ZlU3R5bGUoc3R5bGU6IHN0cmluZykge1xuICAgIGlmIChzdHlsZSAmJiB0aGlzLkh0bWxEaXYpIHtcbiAgICAgIGRvbS5yZW1vdmVDbGFzcyh0aGlzLkh0bWxEaXYsIHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgYm91bmRpbmcgcmVjdGFuZ2xlIG9mIHRoZSBkcmFnIHRhcmdldCBhcmVhIGluIHBpeGVsIHVuaXRzXG4gICAqIHJlbGF0aXZlIHRvIHZpZXdwb3J0LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY29tcG9uZW50J3MgYm91bmRpbmcgYm94LiBOdWxsIGlmIGRyYWcgdGFyZ2V0IGFyZWEgc2hvdWxkIGJlXG4gICAqICAgICBpZ25vcmVkLlxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0Q2xpZW50UmVjdCgpOiBSZWN0fG51bGwge1xuICAgIGlmICghdGhpcy5IdG1sRGl2IHx8ICF0aGlzLmlzVmlzaWJsZV8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBCSUdfTlVNIGlzIG9mZnNjcmVlbiBwYWRkaW5nIHNvIHRoYXQgYmxvY2tzIGRyYWdnZWQgYmV5b25kIHRoZSB0b29sYm94XG4gICAgLy8gYXJlYSBhcmUgc3RpbGwgZGVsZXRlZC4gIE11c3QgYmUgc21hbGxlciB0aGFuIEluZmluaXR5LCBidXQgbGFyZ2VyIHRoYW5cbiAgICAvLyB0aGUgbGFyZ2VzdCBzY3JlZW4gc2l6ZS5cbiAgICBjb25zdCBCSUdfTlVNID0gMTAwMDAwMDA7XG4gICAgY29uc3QgdG9vbGJveFJlY3QgPSB0aGlzLkh0bWxEaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBjb25zdCB0b3AgPSB0b29sYm94UmVjdC50b3A7XG4gICAgY29uc3QgYm90dG9tID0gdG9wICsgdG9vbGJveFJlY3QuaGVpZ2h0O1xuICAgIGNvbnN0IGxlZnQgPSB0b29sYm94UmVjdC5sZWZ0O1xuICAgIGNvbnN0IHJpZ2h0ID0gbGVmdCArIHRvb2xib3hSZWN0LndpZHRoO1xuXG4gICAgLy8gQXNzdW1lcyB0aGF0IHRoZSB0b29sYm94IGlzIG9uIHRoZSBTVkcgZWRnZS4gIElmIHRoaXMgY2hhbmdlc1xuICAgIC8vIChlLmcuIHRvb2xib3hlcyBpbiBtdXRhdG9ycykgdGhlbiB0aGlzIGNvZGUgd2lsbCBuZWVkIHRvIGJlIG1vcmUgY29tcGxleC5cbiAgICBpZiAodGhpcy50b29sYm94UG9zaXRpb24gPT09IHRvb2xib3guUG9zaXRpb24uVE9QKSB7XG4gICAgICByZXR1cm4gbmV3IFJlY3QoLUJJR19OVU0sIGJvdHRvbSwgLUJJR19OVU0sIEJJR19OVU0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy50b29sYm94UG9zaXRpb24gPT09IHRvb2xib3guUG9zaXRpb24uQk9UVE9NKSB7XG4gICAgICByZXR1cm4gbmV3IFJlY3QodG9wLCBCSUdfTlVNLCAtQklHX05VTSwgQklHX05VTSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveC5Qb3NpdGlvbi5MRUZUKSB7XG4gICAgICByZXR1cm4gbmV3IFJlY3QoLUJJR19OVU0sIEJJR19OVU0sIC1CSUdfTlVNLCByaWdodCk7XG4gICAgfSBlbHNlIHsgIC8vIFJpZ2h0XG4gICAgICByZXR1cm4gbmV3IFJlY3QoLUJJR19OVU0sIEJJR19OVU0sIGxlZnQsIEJJR19OVU0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHByb3ZpZGVkIGJsb2NrIG9yIGJ1YmJsZSB3b3VsZCBiZSBkZWxldGVkIGlmIGRyb3BwZWQgb25cbiAgICogdGhpcyBhcmVhLlxuICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgY2hlY2sgaWYgdGhlIGVsZW1lbnQgaXMgZGVsZXRhYmxlIGFuZCBpcyBhbHdheXMgY2FsbGVkXG4gICAqIGJlZm9yZSBvbkRyYWdFbnRlci9vbkRyYWdPdmVyL29uRHJhZ0V4aXQuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50IFRoZSBibG9jayBvciBidWJibGUgY3VycmVudGx5IGJlaW5nIGRyYWdnZWQuXG4gICAqIEBwYXJhbSBfY291bGRDb25uZWN0IFdoZXRoZXIgdGhlIGVsZW1lbnQgY291bGQgY291bGQgY29ubmVjdCB0byBhbm90aGVyLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBlbGVtZW50IHByb3ZpZGVkIHdvdWxkIGJlIGRlbGV0ZWQgaWYgZHJvcHBlZCBvbiB0aGlzXG4gICAqICAgICBhcmVhLlxuICAgKi9cbiAgb3ZlcnJpZGUgd291bGREZWxldGUoZWxlbWVudDogSURyYWdnYWJsZSwgX2NvdWxkQ29ubmVjdDogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQmxvY2tTdmcpIHtcbiAgICAgIGNvbnN0IGJsb2NrID0gKGVsZW1lbnQpO1xuICAgICAgLy8gUHJlZmVyIGRyYWdnaW5nIHRvIHRoZSB0b29sYm94IG92ZXIgY29ubmVjdGluZyB0byBvdGhlciBibG9ja3MuXG4gICAgICB0aGlzLnVwZGF0ZVdvdWxkRGVsZXRlXyghYmxvY2suZ2V0UGFyZW50KCkgJiYgYmxvY2suaXNEZWxldGFibGUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlV291bGREZWxldGVfKGVsZW1lbnQuaXNEZWxldGFibGUoKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLndvdWxkRGVsZXRlXztcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHdoZW4gYSBjdXJzb3Igd2l0aCBhIGJsb2NrIG9yIGJ1YmJsZSBlbnRlcnMgdGhpcyBkcmFnIHRhcmdldC5cbiAgICpcbiAgICogQHBhcmFtIF9kcmFnRWxlbWVudCBUaGUgYmxvY2sgb3IgYnViYmxlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKi9cbiAgb3ZlcnJpZGUgb25EcmFnRW50ZXIoX2RyYWdFbGVtZW50OiBJRHJhZ2dhYmxlKSB7XG4gICAgdGhpcy51cGRhdGVDdXJzb3JEZWxldGVTdHlsZV8odHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB3aGVuIGEgY3Vyc29yIHdpdGggYSBibG9jayBvciBidWJibGUgZXhpdHMgdGhpcyBkcmFnIHRhcmdldC5cbiAgICpcbiAgICogQHBhcmFtIF9kcmFnRWxlbWVudCBUaGUgYmxvY2sgb3IgYnViYmxlIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKi9cbiAgb3ZlcnJpZGUgb25EcmFnRXhpdChfZHJhZ0VsZW1lbnQ6IElEcmFnZ2FibGUpIHtcbiAgICB0aGlzLnVwZGF0ZUN1cnNvckRlbGV0ZVN0eWxlXyhmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB3aGVuIGEgYmxvY2sgb3IgYnViYmxlIGlzIGRyb3BwZWQgb24gdGhpcyBjb21wb25lbnQuXG4gICAqIFNob3VsZCBub3QgaGFuZGxlIGRlbGV0ZSBoZXJlLlxuICAgKlxuICAgKiBAcGFyYW0gX2RyYWdFbGVtZW50IFRoZSBibG9jayBvciBidWJibGUgY3VycmVudGx5IGJlaW5nIGRyYWdnZWQuXG4gICAqL1xuICBvdmVycmlkZSBvbkRyb3AoX2RyYWdFbGVtZW50OiBJRHJhZ2dhYmxlKSB7XG4gICAgdGhpcy51cGRhdGVDdXJzb3JEZWxldGVTdHlsZV8oZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIGludGVybmFsIHdvdWxkRGVsZXRlXyBzdGF0ZS5cbiAgICpcbiAgICogQHBhcmFtIHdvdWxkRGVsZXRlIFRoZSBuZXcgdmFsdWUgZm9yIHRoZSB3b3VsZERlbGV0ZSBzdGF0ZS5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSB1cGRhdGVXb3VsZERlbGV0ZV8od291bGREZWxldGU6IGJvb2xlYW4pIHtcbiAgICBpZiAod291bGREZWxldGUgPT09IHRoaXMud291bGREZWxldGVfKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFRoaXMgbG9naWMgaGFuZGxlcyB1cGRhdGluZyB0aGUgZGVsZXRlU3R5bGUgcHJvcGVybHkgaWYgdGhlIGRlbGV0ZSBzdGF0ZVxuICAgIC8vIGNoYW5nZXMgd2hpbGUgdGhlIGJsb2NrIGlzIG92ZXIgdGhlIFRvb2xib3guIFRoaXMgY291bGQgaGFwcGVuIGlmIHRoZVxuICAgIC8vIGltcGxlbWVudGF0aW9uIG9mIHdvdWxkRGVsZXRlQmxvY2sgZGVwZW5kcyBvbiB0aGUgY291bGRDb25uZWN0IHBhcmFtZXRlclxuICAgIC8vIG9yIGlmIHRoZSBpc0RlbGV0YWJsZSBwcm9wZXJ0eSBvZiB0aGUgYmxvY2sgY3VycmVudGx5IGJlaW5nIGRyYWdnZWRcbiAgICAvLyBjaGFuZ2VzIGR1cmluZyB0aGUgZHJhZy5cbiAgICB0aGlzLnVwZGF0ZUN1cnNvckRlbGV0ZVN0eWxlXyhmYWxzZSk7XG4gICAgdGhpcy53b3VsZERlbGV0ZV8gPSB3b3VsZERlbGV0ZTtcbiAgICB0aGlzLnVwZGF0ZUN1cnNvckRlbGV0ZVN0eWxlXyh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIG9yIHJlbW92ZXMgdGhlIENTUyBzdHlsZSBvZiB0aGUgY3Vyc29yIG92ZXIgdGhlIHRvb2xib3ggYmFzZWQgd2hldGhlclxuICAgKiB0aGUgYmxvY2sgb3IgYnViYmxlIG92ZXIgaXQgaXMgZXhwZWN0ZWQgdG8gYmUgZGVsZXRlZCBpZiBkcm9wcGVkICh1c2luZyB0aGVcbiAgICogaW50ZXJuYWwgdGhpcy53b3VsZERlbGV0ZV8gcHJvcGVydHkpLlxuICAgKlxuICAgKiBAcGFyYW0gYWRkU3R5bGUgV2hldGhlciB0aGUgc3R5bGUgc2hvdWxkIGJlIGFkZGVkIG9yIHJlbW92ZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgdXBkYXRlQ3Vyc29yRGVsZXRlU3R5bGVfKGFkZFN0eWxlOiBib29sZWFuKSB7XG4gICAgY29uc3Qgc3R5bGUgPVxuICAgICAgICB0aGlzLndvdWxkRGVsZXRlXyA/ICdibG9ja2x5VG9vbGJveERlbGV0ZScgOiAnYmxvY2tseVRvb2xib3hHcmFiJztcbiAgICBpZiAoYWRkU3R5bGUpIHtcbiAgICAgIHRoaXMuYWRkU3R5bGUoc3R5bGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW92ZVN0eWxlKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdG9vbGJveCBpdGVtIHdpdGggdGhlIGdpdmVuIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgVGhlIElEIG9mIHRoZSB0b29sYm94IGl0ZW0uXG4gICAqIEByZXR1cm5zIFRoZSB0b29sYm94IGl0ZW0gd2l0aCB0aGUgZ2l2ZW4gSUQsIG9yIG51bGwgaWYgbm8gaXRlbSBleGlzdHMuXG4gICAqL1xuICBnZXRUb29sYm94SXRlbUJ5SWQoaWQ6IHN0cmluZyk6IElUb29sYm94SXRlbXxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jb250ZW50TWFwX1tpZF0gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB3aWR0aCBvZiB0aGUgdG9vbGJveC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHdpZHRoIG9mIHRoZSB0b29sYm94LlxuICAgKi9cbiAgZ2V0V2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy53aWR0aF87XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgaGVpZ2h0IG9mIHRoZSB0b29sYm94LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgd2lkdGggb2YgdGhlIHRvb2xib3guXG4gICAqL1xuICBnZXRIZWlnaHQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5oZWlnaHRfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHRvb2xib3ggZmx5b3V0LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgdG9vbGJveCBmbHlvdXQuXG4gICAqL1xuICBnZXRGbHlvdXQoKTogSUZseW91dHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5mbHlvdXRfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHdvcmtzcGFjZSBmb3IgdGhlIHRvb2xib3guXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBwYXJlbnQgd29ya3NwYWNlIGZvciB0aGUgdG9vbGJveC5cbiAgICovXG4gIGdldFdvcmtzcGFjZSgpOiBXb3Jrc3BhY2VTdmcge1xuICAgIHJldHVybiB0aGlzLndvcmtzcGFjZV87XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgc2VsZWN0ZWQgaXRlbS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHNlbGVjdGVkIGl0ZW0sIG9yIG51bGwgaWYgbm8gaXRlbSBpcyBjdXJyZW50bHkgc2VsZWN0ZWQuXG4gICAqL1xuICBnZXRTZWxlY3RlZEl0ZW0oKTogSVNlbGVjdGFibGVUb29sYm94SXRlbXxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZEl0ZW1fO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgaXRlbS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgaXRlbSwgb3IgbnVsbCBpZiBubyBpdGVtIHdhcyBwcmV2aW91c2x5XG4gICAqICAgICBzZWxlY3RlZC5cbiAgICovXG4gIGdldFByZXZpb3VzbHlTZWxlY3RlZEl0ZW0oKTogSVNlbGVjdGFibGVUb29sYm94SXRlbXxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5wcmV2aW91c2x5U2VsZWN0ZWRJdGVtXztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSB0b29sYm94IGlzIGhvcml6b250YWwuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHRvb2xib3ggaXMgaG9yaXpvbnRhbCwgZmFsc2UgaWYgdGhlIHRvb2xib3ggaXNcbiAgICogICAgIHZlcnRpY2FsLlxuICAgKi9cbiAgaXNIb3Jpem9udGFsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmhvcml6b250YWxMYXlvdXRfO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9ucyB0aGUgdG9vbGJveCBiYXNlZCBvbiB3aGV0aGVyIGl0IGlzIGEgaG9yaXpvbnRhbCB0b29sYm94IGFuZFxuICAgKiB3aGV0aGVyIHRoZSB3b3Jrc3BhY2UgaXMgaW4gcnRsLlxuICAgKi9cbiAgcG9zaXRpb24oKSB7XG4gICAgY29uc3Qgd29ya3NwYWNlTWV0cmljcyA9IHRoaXMud29ya3NwYWNlXy5nZXRNZXRyaWNzKCk7XG4gICAgY29uc3QgdG9vbGJveERpdiA9IHRoaXMuSHRtbERpdjtcbiAgICBpZiAoIXRvb2xib3hEaXYpIHtcbiAgICAgIC8vIE5vdCBpbml0aWFsaXplZCB5ZXQuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaG9yaXpvbnRhbExheW91dF8pIHtcbiAgICAgIHRvb2xib3hEaXYuc3R5bGUubGVmdCA9ICcwJztcbiAgICAgIHRvb2xib3hEaXYuc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xuICAgICAgdG9vbGJveERpdi5zdHlsZS53aWR0aCA9ICcxMDAlJztcbiAgICAgIHRoaXMuaGVpZ2h0XyA9IHRvb2xib3hEaXYub2Zmc2V0SGVpZ2h0O1xuICAgICAgdGhpcy53aWR0aF8gPSB3b3Jrc3BhY2VNZXRyaWNzLnZpZXdXaWR0aDtcbiAgICAgIGlmICh0aGlzLnRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveC5Qb3NpdGlvbi5UT1ApIHtcbiAgICAgICAgdG9vbGJveERpdi5zdHlsZS50b3AgPSAnMCc7XG4gICAgICB9IGVsc2UgeyAgLy8gQm90dG9tXG4gICAgICAgIHRvb2xib3hEaXYuc3R5bGUuYm90dG9tID0gJzAnO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy50b29sYm94UG9zaXRpb24gPT09IHRvb2xib3guUG9zaXRpb24uUklHSFQpIHtcbiAgICAgICAgdG9vbGJveERpdi5zdHlsZS5yaWdodCA9ICcwJztcbiAgICAgIH0gZWxzZSB7ICAvLyBMZWZ0XG4gICAgICAgIHRvb2xib3hEaXYuc3R5bGUubGVmdCA9ICcwJztcbiAgICAgIH1cbiAgICAgIHRvb2xib3hEaXYuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnO1xuICAgICAgdGhpcy53aWR0aF8gPSB0b29sYm94RGl2Lm9mZnNldFdpZHRoO1xuICAgICAgdGhpcy5oZWlnaHRfID0gd29ya3NwYWNlTWV0cmljcy52aWV3SGVpZ2h0O1xuICAgIH1cbiAgICB0aGlzLmZseW91dF8hLnBvc2l0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyByZXNpemluZyB0aGUgdG9vbGJveCB3aGVuIGEgdG9vbGJveCBpdGVtIHJlc2l6ZXMuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGFuZGxlVG9vbGJveEl0ZW1SZXNpemUoKSB7XG4gICAgLy8gUmVwb3NpdGlvbiB0aGUgd29ya3NwYWNlIHNvIHRoYXQgKDAsMCkgaXMgaW4gdGhlIGNvcnJlY3QgcG9zaXRpb25cbiAgICAvLyByZWxhdGl2ZSB0byB0aGUgbmV3IGFic29sdXRlIGVkZ2UgKGllIHRvb2xib3ggZWRnZSkuXG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy53b3Jrc3BhY2VfO1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLkh0bWxEaXYhLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IG5ld1ggPSB0aGlzLnRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveC5Qb3NpdGlvbi5MRUZUID9cbiAgICAgICAgd29ya3NwYWNlLnNjcm9sbFggKyByZWN0LndpZHRoIDpcbiAgICAgICAgd29ya3NwYWNlLnNjcm9sbFg7XG4gICAgY29uc3QgbmV3WSA9IHRoaXMudG9vbGJveFBvc2l0aW9uID09PSB0b29sYm94LlBvc2l0aW9uLlRPUCA/XG4gICAgICAgIHdvcmtzcGFjZS5zY3JvbGxZICsgcmVjdC5oZWlnaHQgOlxuICAgICAgICB3b3Jrc3BhY2Uuc2Nyb2xsWTtcbiAgICB3b3Jrc3BhY2UudHJhbnNsYXRlKG5ld1gsIG5ld1kpO1xuXG4gICAgLy8gRXZlbiB0aG91Z2ggdGhlIGRpdiBoYXNuJ3QgY2hhbmdlZCBzaXplLCB0aGUgdmlzaWJsZSB3b3Jrc3BhY2VcbiAgICAvLyBzdXJmYWNlIG9mIHRoZSB3b3Jrc3BhY2UgaGFzLCBzbyB3ZSBtYXkgbmVlZCB0byByZXBvc2l0aW9uIGV2ZXJ5dGhpbmcuXG4gICAgY29tbW9uLnN2Z1Jlc2l6ZSh3b3Jrc3BhY2UpO1xuICB9XG5cbiAgLyoqIFVuaGlnaGxpZ2h0cyBhbnkgcHJldmlvdXNseSBzZWxlY3RlZCBpdGVtLiAqL1xuICBjbGVhclNlbGVjdGlvbigpIHtcbiAgICB0aGlzLnNldFNlbGVjdGVkSXRlbShudWxsKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBjYXRlZ29yeSBjb2xvdXJzIGFuZCBiYWNrZ3JvdW5kIGNvbG91ciBvZiBzZWxlY3RlZCBjYXRlZ29yaWVzLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlZnJlc2hUaGVtZSgpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29udGVudHNfLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY29udGVudHNfW2ldO1xuICAgICAgLy8gVE9ETygjNjA5Nyk6IEZpeCB0eXBlcyBvciBhZGQgcmVmcmVzaFRoZW1lIHRvIElUb29sYm94SXRlbS5cbiAgICAgIGNvbnN0IGNoaWxkQXNDYXRlZ29yeSA9IGNoaWxkIGFzIFRvb2xib3hDYXRlZ29yeTtcbiAgICAgIGlmIChjaGlsZEFzQ2F0ZWdvcnkucmVmcmVzaFRoZW1lKSB7XG4gICAgICAgIGNoaWxkQXNDYXRlZ29yeS5yZWZyZXNoVGhlbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgZmx5b3V0J3MgY29udGVudCB3aXRob3V0IGNsb3NpbmcgaXQuICBTaG91bGQgYmUgdXNlZCBpblxuICAgKiByZXNwb25zZSB0byBhIGNoYW5nZSBpbiBvbmUgb2YgdGhlIGR5bmFtaWMgY2F0ZWdvcmllcywgc3VjaCBhcyB2YXJpYWJsZXMgb3JcbiAgICogcHJvY2VkdXJlcy5cbiAgICovXG4gIHJlZnJlc2hTZWxlY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtXyAmJiB0aGlzLnNlbGVjdGVkSXRlbV8uaXNTZWxlY3RhYmxlKCkgJiZcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1fLmdldENvbnRlbnRzKCkubGVuZ3RoKSB7XG4gICAgICB0aGlzLmZseW91dF8hLnNob3codGhpcy5zZWxlY3RlZEl0ZW1fLmdldENvbnRlbnRzKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93cyBvciBoaWRlcyB0aGUgdG9vbGJveC5cbiAgICpcbiAgICogQHBhcmFtIGlzVmlzaWJsZSBUcnVlIGlmIHRvb2xib3ggc2hvdWxkIGJlIHZpc2libGUuXG4gICAqL1xuICBzZXRWaXNpYmxlKGlzVmlzaWJsZTogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLmlzVmlzaWJsZV8gPT09IGlzVmlzaWJsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuSHRtbERpdiEuc3R5bGUuZGlzcGxheSA9IGlzVmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgdGhpcy5pc1Zpc2libGVfID0gaXNWaXNpYmxlO1xuICAgIC8vIEludmlzaWJsZSB0b29sYm94IGlzIGlnbm9yZWQgYXMgZHJhZyB0YXJnZXRzIGFuZCBtdXN0IGhhdmUgdGhlIGRyYWdcbiAgICAvLyB0YXJnZXQgdXBkYXRlZC5cbiAgICB0aGlzLndvcmtzcGFjZV8ucmVjb3JkRHJhZ1RhcmdldHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlcyB0aGUgY29tcG9uZW50LiBDYWxsZWQgaW4gV29ya3NwYWNlU3ZnLmhpZGVDaGFmZi5cbiAgICpcbiAgICogQHBhcmFtIG9ubHlDbG9zZVBvcHVwcyBXaGV0aGVyIG9ubHkgcG9wdXBzIHNob3VsZCBiZSBjbG9zZWQuXG4gICAqICAgICBGbHlvdXRzIHNob3VsZCBub3QgYmUgY2xvc2VkIGlmIHRoaXMgaXMgdHJ1ZS5cbiAgICovXG4gIGF1dG9IaWRlKG9ubHlDbG9zZVBvcHVwczogYm9vbGVhbikge1xuICAgIGlmICghb25seUNsb3NlUG9wdXBzICYmIHRoaXMuZmx5b3V0XyAmJiB0aGlzLmZseW91dF8uYXV0b0Nsb3NlKSB7XG4gICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGdpdmVuIGl0ZW0gYXMgc2VsZWN0ZWQuXG4gICAqIE5vLW9wIGlmIHRoZSBpdGVtIGlzIG5vdCBzZWxlY3RhYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3SXRlbSBUaGUgdG9vbGJveCBpdGVtIHRvIHNlbGVjdC5cbiAgICovXG4gIHNldFNlbGVjdGVkSXRlbShuZXdJdGVtOiBJVG9vbGJveEl0ZW18bnVsbCkge1xuICAgIGNvbnN0IG9sZEl0ZW0gPSB0aGlzLnNlbGVjdGVkSXRlbV87XG5cbiAgICBpZiAoIW5ld0l0ZW0gJiYgIW9sZEl0ZW0gfHwgbmV3SXRlbSAmJiAhbmV3SXRlbS5pc1NlbGVjdGFibGUoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBuZXdJdGVtID0gbmV3SXRlbSBhcyBJU2VsZWN0YWJsZVRvb2xib3hJdGVtO1xuXG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdJVG9vbGJveEl0ZW0nIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0lTZWxlY3RhYmxlVG9vbGJveEl0ZW0nLlxuICAgIGlmICh0aGlzLnNob3VsZERlc2VsZWN0SXRlbV8ob2xkSXRlbSwgbmV3SXRlbSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pICYmXG4gICAgICAgIG9sZEl0ZW0gIT09IG51bGwpIHtcbiAgICAgIHRoaXMuZGVzZWxlY3RJdGVtXyhvbGRJdGVtKTtcbiAgICB9XG5cbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0lUb29sYm94SXRlbScgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnSVNlbGVjdGFibGVUb29sYm94SXRlbScuXG4gICAgaWYgKHRoaXMuc2hvdWxkU2VsZWN0SXRlbV8ob2xkSXRlbSwgbmV3SXRlbSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pICYmXG4gICAgICAgIG5ld0l0ZW0gIT09IG51bGwpIHtcbiAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnSVRvb2xib3hJdGVtJyBpcyBub3RcbiAgICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0lTZWxlY3RhYmxlVG9vbGJveEl0ZW0nLlxuICAgICAgdGhpcy5zZWxlY3RJdGVtXyhvbGRJdGVtLCBuZXdJdGVtIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgfVxuXG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdJVG9vbGJveEl0ZW0nIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0lTZWxlY3RhYmxlVG9vbGJveEl0ZW0nLlxuICAgIHRoaXMudXBkYXRlRmx5b3V0XyhvbGRJdGVtLCBuZXdJdGVtIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdJVG9vbGJveEl0ZW0nIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0lTZWxlY3RhYmxlVG9vbGJveEl0ZW0nLlxuICAgIHRoaXMuZmlyZVNlbGVjdEV2ZW50XyhvbGRJdGVtLCBuZXdJdGVtIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogRGVjaWRlcyB3aGV0aGVyIHRoZSBvbGQgaXRlbSBzaG91bGQgYmUgZGVzZWxlY3RlZC5cbiAgICpcbiAgICogQHBhcmFtIG9sZEl0ZW0gVGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLlxuICAgKiBAcGFyYW0gbmV3SXRlbSBUaGUgbmV3bHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBvbGQgaXRlbSBzaG91bGQgYmUgZGVzZWxlY3RlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNob3VsZERlc2VsZWN0SXRlbV8oXG4gICAgICBvbGRJdGVtOiBJU2VsZWN0YWJsZVRvb2xib3hJdGVtfG51bGwsXG4gICAgICBuZXdJdGVtOiBJU2VsZWN0YWJsZVRvb2xib3hJdGVtfG51bGwpOiBib29sZWFuIHtcbiAgICAvLyBEZXNlbGVjdCB0aGUgb2xkIGl0ZW0gdW5sZXNzIHRoZSBvbGQgaXRlbSBpcyBjb2xsYXBzaWJsZSBhbmQgaGFzIGJlZW5cbiAgICAvLyBwcmV2aW91c2x5IGNsaWNrZWQgb24uXG4gICAgcmV0dXJuIG9sZEl0ZW0gIT09IG51bGwgJiZcbiAgICAgICAgKCFvbGRJdGVtLmlzQ29sbGFwc2libGUoKSB8fCBvbGRJdGVtICE9PSBuZXdJdGVtKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNpZGVzIHdoZXRoZXIgdGhlIG5ldyBpdGVtIHNob3VsZCBiZSBzZWxlY3RlZC5cbiAgICpcbiAgICogQHBhcmFtIG9sZEl0ZW0gVGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLlxuICAgKiBAcGFyYW0gbmV3SXRlbSBUaGUgbmV3bHkgc2VsZWN0ZWQgdG9vbGJveCBpdGVtLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBuZXcgaXRlbSBzaG91bGQgYmUgc2VsZWN0ZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHByb3RlY3RlZCBzaG91bGRTZWxlY3RJdGVtXyhcbiAgICAgIG9sZEl0ZW06IElTZWxlY3RhYmxlVG9vbGJveEl0ZW18bnVsbCxcbiAgICAgIG5ld0l0ZW06IElTZWxlY3RhYmxlVG9vbGJveEl0ZW18bnVsbCk6IGJvb2xlYW4ge1xuICAgIC8vIFNlbGVjdCB0aGUgbmV3IGl0ZW0gdW5sZXNzIHRoZSBvbGQgaXRlbSBlcXVhbHMgdGhlIG5ldyBpdGVtLlxuICAgIHJldHVybiBuZXdJdGVtICE9PSBudWxsICYmIG5ld0l0ZW0gIT09IG9sZEl0ZW07XG4gIH1cblxuICAvKipcbiAgICogRGVzZWxlY3RzIHRoZSBnaXZlbiBpdGVtLCBtYXJrcyBpdCBhcyB1bnNlbGVjdGVkLCBhbmQgdXBkYXRlcyBhcmlhIHN0YXRlLlxuICAgKlxuICAgKiBAcGFyYW0gaXRlbSBUaGUgcHJldmlvdXNseSBzZWxlY3RlZCB0b29sYm94IGl0ZW0gd2hpY2ggc2hvdWxkIGJlXG4gICAqICAgICBkZXNlbGVjdGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRlc2VsZWN0SXRlbV8oaXRlbTogSVNlbGVjdGFibGVUb29sYm94SXRlbSkge1xuICAgIHRoaXMuc2VsZWN0ZWRJdGVtXyA9IG51bGw7XG4gICAgdGhpcy5wcmV2aW91c2x5U2VsZWN0ZWRJdGVtXyA9IGl0ZW07XG4gICAgaXRlbS5zZXRTZWxlY3RlZChmYWxzZSk7XG4gICAgYXJpYS5zZXRTdGF0ZShcbiAgICAgICAgdGhpcy5jb250ZW50c0Rpdl8gYXMgRWxlbWVudCwgYXJpYS5TdGF0ZS5BQ1RJVkVERVNDRU5EQU5ULCAnJyk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0cyB0aGUgZ2l2ZW4gaXRlbSwgbWFya3MgaXQgc2VsZWN0ZWQsIGFuZCB1cGRhdGVzIGFyaWEgc3RhdGUuXG4gICAqXG4gICAqIEBwYXJhbSBvbGRJdGVtIFRoZSBwcmV2aW91c2x5IHNlbGVjdGVkIHRvb2xib3ggaXRlbS5cbiAgICogQHBhcmFtIG5ld0l0ZW0gVGhlIG5ld2x5IHNlbGVjdGVkIHRvb2xib3ggaXRlbS5cbiAgICovXG4gIHByb3RlY3RlZCBzZWxlY3RJdGVtXyhcbiAgICAgIG9sZEl0ZW06IElTZWxlY3RhYmxlVG9vbGJveEl0ZW18bnVsbCwgbmV3SXRlbTogSVNlbGVjdGFibGVUb29sYm94SXRlbSkge1xuICAgIHRoaXMuc2VsZWN0ZWRJdGVtXyA9IG5ld0l0ZW07XG4gICAgdGhpcy5wcmV2aW91c2x5U2VsZWN0ZWRJdGVtXyA9IG9sZEl0ZW07XG4gICAgbmV3SXRlbS5zZXRTZWxlY3RlZCh0cnVlKTtcbiAgICBhcmlhLnNldFN0YXRlKFxuICAgICAgICB0aGlzLmNvbnRlbnRzRGl2XyBhcyBFbGVtZW50LCBhcmlhLlN0YXRlLkFDVElWRURFU0NFTkRBTlQsXG4gICAgICAgIG5ld0l0ZW0uZ2V0SWQoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0cyB0aGUgdG9vbGJveCBpdGVtIGJ5IGl0cyBwb3NpdGlvbiBpbiB0aGUgbGlzdCBvZiB0b29sYm94IGl0ZW1zLlxuICAgKlxuICAgKiBAcGFyYW0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIHRvIHNlbGVjdC5cbiAgICovXG4gIHNlbGVjdEl0ZW1CeVBvc2l0aW9uKHBvc2l0aW9uOiBudW1iZXIpIHtcbiAgICBpZiAocG9zaXRpb24gPiAtMSAmJiBwb3NpdGlvbiA8IHRoaXMuY29udGVudHNfLmxlbmd0aCkge1xuICAgICAgY29uc3QgaXRlbSA9IHRoaXMuY29udGVudHNfW3Bvc2l0aW9uXTtcbiAgICAgIGlmIChpdGVtLmlzU2VsZWN0YWJsZSgpKSB7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJdGVtKGl0ZW0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNpZGVzIHdoZXRoZXIgdG8gaGlkZSBvciBzaG93IHRoZSBmbHlvdXQgZGVwZW5kaW5nIG9uIHRoZSBzZWxlY3RlZCBpdGVtLlxuICAgKlxuICAgKiBAcGFyYW0gb2xkSXRlbSBUaGUgcHJldmlvdXNseSBzZWxlY3RlZCB0b29sYm94IGl0ZW0uXG4gICAqIEBwYXJhbSBuZXdJdGVtIFRoZSBuZXdseSBzZWxlY3RlZCB0b29sYm94IGl0ZW0uXG4gICAqL1xuICBwcm90ZWN0ZWQgdXBkYXRlRmx5b3V0XyhcbiAgICAgIG9sZEl0ZW06IElTZWxlY3RhYmxlVG9vbGJveEl0ZW18bnVsbCxcbiAgICAgIG5ld0l0ZW06IElTZWxlY3RhYmxlVG9vbGJveEl0ZW18bnVsbCkge1xuICAgIGlmICghbmV3SXRlbSB8fCBvbGRJdGVtID09PSBuZXdJdGVtICYmICFuZXdJdGVtLmlzQ29sbGFwc2libGUoKSB8fFxuICAgICAgICAhbmV3SXRlbS5nZXRDb250ZW50cygpLmxlbmd0aCkge1xuICAgICAgdGhpcy5mbHlvdXRfIS5oaWRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmx5b3V0XyEuc2hvdyhuZXdJdGVtLmdldENvbnRlbnRzKCkpO1xuICAgICAgdGhpcy5mbHlvdXRfIS5zY3JvbGxUb1N0YXJ0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFuIGV2ZW50IHdoZW4gYSBuZXcgdG9vbGJveCBpdGVtIGlzIHNlbGVjdGVkLlxuICAgKlxuICAgKiBAcGFyYW0gb2xkSXRlbSBUaGUgcHJldmlvdXNseSBzZWxlY3RlZCB0b29sYm94IGl0ZW0uXG4gICAqIEBwYXJhbSBuZXdJdGVtIFRoZSBuZXdseSBzZWxlY3RlZCB0b29sYm94IGl0ZW0uXG4gICAqL1xuICBwcml2YXRlIGZpcmVTZWxlY3RFdmVudF8oXG4gICAgICBvbGRJdGVtOiBJU2VsZWN0YWJsZVRvb2xib3hJdGVtfG51bGwsXG4gICAgICBuZXdJdGVtOiBJU2VsZWN0YWJsZVRvb2xib3hJdGVtfG51bGwpIHtcbiAgICBjb25zdCBvbGRFbGVtZW50ID0gb2xkSXRlbSAmJiBvbGRJdGVtLmdldE5hbWUoKTtcbiAgICBsZXQgbmV3RWxlbWVudCA9IG5ld0l0ZW0gJiYgbmV3SXRlbS5nZXROYW1lKCk7XG4gICAgLy8gSW4gdGhpcyBjYXNlIHRoZSB0b29sYm94IGNsb3Nlcywgc28gdGhlIG5ld0VsZW1lbnQgc2hvdWxkIGJlIG51bGwuXG4gICAgaWYgKG9sZEl0ZW0gPT09IG5ld0l0ZW0pIHtcbiAgICAgIG5ld0VsZW1lbnQgPSBudWxsO1xuICAgIH1cbiAgICBjb25zdCBldmVudCA9IG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5UT09MQk9YX0lURU1fU0VMRUNUKSkoXG4gICAgICAgIG9sZEVsZW1lbnQsIG5ld0VsZW1lbnQsIHRoaXMud29ya3NwYWNlXy5pZCk7XG4gICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIGN1cnJlbnQgaXRlbSBpZiBpdCBpcyBleHBhbmRlZCwgb3Igc2VsZWN0cyB0aGUgcGFyZW50LlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGEgcGFyZW50IGNhdGVnb3J5IHdhcyBzZWxlY3RlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgcHJpdmF0ZSBzZWxlY3RQYXJlbnRfKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5zZWxlY3RlZEl0ZW1fKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtXy5pc0NvbGxhcHNpYmxlKCkgJiZcbiAgICAgICAgKHRoaXMuc2VsZWN0ZWRJdGVtXyBhcyBJQ29sbGFwc2libGVUb29sYm94SXRlbSkuaXNFeHBhbmRlZCgpKSB7XG4gICAgICBjb25zdCBjb2xsYXBzaWJsZUl0ZW0gPSB0aGlzLnNlbGVjdGVkSXRlbV8gYXMgSUNvbGxhcHNpYmxlVG9vbGJveEl0ZW07XG4gICAgICBjb2xsYXBzaWJsZUl0ZW0udG9nZ2xlRXhwYW5kZWQoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtXy5nZXRQYXJlbnQoKSAmJlxuICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbV8uZ2V0UGFyZW50KCkhLmlzU2VsZWN0YWJsZSgpKSB7XG4gICAgICB0aGlzLnNldFNlbGVjdGVkSXRlbSh0aGlzLnNlbGVjdGVkSXRlbV8uZ2V0UGFyZW50KCkpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3RzIHRoZSBmaXJzdCBjaGlsZCBvZiB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGl0ZW0sIG9yIG5vdGhpbmcgaWYgdGhlXG4gICAqIHRvb2xib3ggaXRlbSBoYXMgbm8gY2hpbGRyZW4uXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgYSBjaGlsZCBjYXRlZ29yeSB3YXMgc2VsZWN0ZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHByaXZhdGUgc2VsZWN0Q2hpbGRfKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5zZWxlY3RlZEl0ZW1fIHx8ICF0aGlzLnNlbGVjdGVkSXRlbV8uaXNDb2xsYXBzaWJsZSgpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGNvbGxhcHNpYmxlSXRlbSA9IHRoaXMuc2VsZWN0ZWRJdGVtXyBhcyBJQ29sbGFwc2libGVUb29sYm94SXRlbTtcbiAgICBpZiAoIWNvbGxhcHNpYmxlSXRlbS5pc0V4cGFuZGVkKCkpIHtcbiAgICAgIGNvbGxhcHNpYmxlSXRlbS50b2dnbGVFeHBhbmRlZCgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0TmV4dF8oKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3RzIHRoZSBuZXh0IHZpc2libGUgdG9vbGJveCBpdGVtLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGEgbmV4dCBjYXRlZ29yeSB3YXMgc2VsZWN0ZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHByaXZhdGUgc2VsZWN0TmV4dF8oKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLnNlbGVjdGVkSXRlbV8pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBsZXQgbmV4dEl0ZW1JZHggPSB0aGlzLmNvbnRlbnRzXy5pbmRleE9mKHRoaXMuc2VsZWN0ZWRJdGVtXykgKyAxO1xuICAgIGlmIChuZXh0SXRlbUlkeCA+IC0xICYmIG5leHRJdGVtSWR4IDwgdGhpcy5jb250ZW50c18ubGVuZ3RoKSB7XG4gICAgICBsZXQgbmV4dEl0ZW0gPSB0aGlzLmNvbnRlbnRzX1tuZXh0SXRlbUlkeF07XG4gICAgICB3aGlsZSAobmV4dEl0ZW0gJiYgIW5leHRJdGVtLmlzU2VsZWN0YWJsZSgpKSB7XG4gICAgICAgIG5leHRJdGVtID0gdGhpcy5jb250ZW50c19bKytuZXh0SXRlbUlkeF07XG4gICAgICB9XG4gICAgICBpZiAobmV4dEl0ZW0gJiYgbmV4dEl0ZW0uaXNTZWxlY3RhYmxlKCkpIHtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZEl0ZW0obmV4dEl0ZW0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdHMgdGhlIHByZXZpb3VzIHZpc2libGUgdG9vbGJveCBpdGVtLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGEgcHJldmlvdXMgY2F0ZWdvcnkgd2FzIHNlbGVjdGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBwcml2YXRlIHNlbGVjdFByZXZpb3VzXygpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuc2VsZWN0ZWRJdGVtXykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGxldCBwcmV2SXRlbUlkeCA9IHRoaXMuY29udGVudHNfLmluZGV4T2YodGhpcy5zZWxlY3RlZEl0ZW1fKSAtIDE7XG4gICAgaWYgKHByZXZJdGVtSWR4ID4gLTEgJiYgcHJldkl0ZW1JZHggPCB0aGlzLmNvbnRlbnRzXy5sZW5ndGgpIHtcbiAgICAgIGxldCBwcmV2SXRlbSA9IHRoaXMuY29udGVudHNfW3ByZXZJdGVtSWR4XTtcbiAgICAgIHdoaWxlIChwcmV2SXRlbSAmJiAhcHJldkl0ZW0uaXNTZWxlY3RhYmxlKCkpIHtcbiAgICAgICAgcHJldkl0ZW0gPSB0aGlzLmNvbnRlbnRzX1stLXByZXZJdGVtSWR4XTtcbiAgICAgIH1cbiAgICAgIGlmIChwcmV2SXRlbSAmJiBwcmV2SXRlbS5pc1NlbGVjdGFibGUoKSkge1xuICAgICAgICB0aGlzLnNldFNlbGVjdGVkSXRlbShwcmV2SXRlbSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKiogRGlzcG9zZXMgb2YgdGhpcyB0b29sYm94LiAqL1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMud29ya3NwYWNlXy5nZXRDb21wb25lbnRNYW5hZ2VyKCkucmVtb3ZlQ29tcG9uZW50KCd0b29sYm94Jyk7XG4gICAgdGhpcy5mbHlvdXRfIS5kaXNwb3NlKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRlbnRzXy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdG9vbGJveEl0ZW0gPSB0aGlzLmNvbnRlbnRzX1tpXTtcbiAgICAgIHRvb2xib3hJdGVtLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYm91bmRFdmVudHNfLmxlbmd0aDsgaisrKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLmJvdW5kRXZlbnRzX1tqXSk7XG4gICAgfVxuICAgIHRoaXMuYm91bmRFdmVudHNfID0gW107XG4gICAgdGhpcy5jb250ZW50c18gPSBbXTtcblxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnSFRNTERpdkVsZW1lbnQgfCBudWxsJyBpc1xuICAgIC8vIG5vdCBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdFbGVtZW50Jy5cbiAgICB0aGlzLndvcmtzcGFjZV8uZ2V0VGhlbWVNYW5hZ2VyKCkudW5zdWJzY3JpYmUoXG4gICAgICAgIHRoaXMuSHRtbERpdiBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIGRvbS5yZW1vdmVOb2RlKHRoaXMuSHRtbERpdik7XG4gIH1cbn1cblxuLyoqIENTUyBmb3IgVG9vbGJveC4gIFNlZSBjc3MuanMgZm9yIHVzZS4gKi9cbkNzcy5yZWdpc3RlcihgXG4uYmxvY2tseVRvb2xib3hEZWxldGUge1xuICBjdXJzb3I6IHVybChcIjw8PFBBVEg+Pj4vaGFuZGRlbGV0ZS5jdXJcIiksIGF1dG87XG59XG5cbi5ibG9ja2x5VG9vbGJveEdyYWIge1xuICBjdXJzb3I6IHVybChcIjw8PFBBVEg+Pj4vaGFuZGNsb3NlZC5jdXJcIiksIGF1dG87XG4gIGN1cnNvcjogZ3JhYmJpbmc7XG4gIGN1cnNvcjogLXdlYmtpdC1ncmFiYmluZztcbn1cblxuLyogQ2F0ZWdvcnkgdHJlZSBpbiBUb29sYm94LiAqL1xuLmJsb2NrbHlUb29sYm94RGl2IHtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2RkZDtcbiAgb3ZlcmZsb3cteDogdmlzaWJsZTtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgcGFkZGluZzogNHB4IDAgNHB4IDA7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgei1pbmRleDogNzA7ICAvKiBzbyBibG9ja3MgZ28gdW5kZXIgdG9vbGJveCB3aGVuIGRyYWdnaW5nICovXG4gIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogdHJhbnNwYXJlbnQ7ICAvKiBpc3N1ZSAjMTM0NSAqL1xufVxuXG4uYmxvY2tseVRvb2xib3hDb250ZW50cyB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtd3JhcDogd3JhcDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbn1cblxuLmJsb2NrbHlUb29sYm94Q29udGVudHM6Zm9jdXMge1xuICBvdXRsaW5lOiBub25lO1xufVxuYCk7XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuVE9PTEJPWCwgcmVnaXN0cnkuREVGQVVMVCwgVG9vbGJveCk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogWmVsb3MgdGhlbWUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LlRoZW1lcy5aZWxvc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlRoZW1lcy5aZWxvcycpO1xuXG5pbXBvcnQge1RoZW1lfSBmcm9tICcuLi90aGVtZS5qcyc7XG5cblxuY29uc3QgZGVmYXVsdEJsb2NrU3R5bGVzID0ge1xuICAnY29sb3VyX2Jsb2Nrcyc6IHtcbiAgICAnY29sb3VyUHJpbWFyeSc6ICcjQ0Y2M0NGJyxcbiAgICAnY29sb3VyU2Vjb25kYXJ5JzogJyNDOTRGQzknLFxuICAgICdjb2xvdXJUZXJ0aWFyeSc6ICcjQkQ0MkJEJyxcbiAgfSxcbiAgJ2xpc3RfYmxvY2tzJzoge1xuICAgICdjb2xvdXJQcmltYXJ5JzogJyM5OTY2RkYnLFxuICAgICdjb2xvdXJTZWNvbmRhcnknOiAnIzg1NUNENicsXG4gICAgJ2NvbG91clRlcnRpYXJ5JzogJyM3NzREQ0InLFxuICB9LFxuICAnbG9naWNfYmxvY2tzJzoge1xuICAgICdjb2xvdXJQcmltYXJ5JzogJyM0Qzk3RkYnLFxuICAgICdjb2xvdXJTZWNvbmRhcnknOiAnIzQyODBENycsXG4gICAgJ2NvbG91clRlcnRpYXJ5JzogJyMzMzczQ0MnLFxuICB9LFxuICAnbG9vcF9ibG9ja3MnOiB7XG4gICAgJ2NvbG91clByaW1hcnknOiAnIzBmQkQ4QycsXG4gICAgJ2NvbG91clNlY29uZGFyeSc6ICcjMERBNTdBJyxcbiAgICAnY29sb3VyVGVydGlhcnknOiAnIzBCOEU2OScsXG4gIH0sXG4gICdtYXRoX2Jsb2Nrcyc6IHtcbiAgICAnY29sb3VyUHJpbWFyeSc6ICcjNTlDMDU5JyxcbiAgICAnY29sb3VyU2Vjb25kYXJ5JzogJyM0NkI5NDYnLFxuICAgICdjb2xvdXJUZXJ0aWFyeSc6ICcjMzg5NDM4JyxcbiAgfSxcbiAgJ3Byb2NlZHVyZV9ibG9ja3MnOiB7XG4gICAgJ2NvbG91clByaW1hcnknOiAnI0ZGNjY4MCcsXG4gICAgJ2NvbG91clNlY29uZGFyeSc6ICcjRkY0RDZBJyxcbiAgICAnY29sb3VyVGVydGlhcnknOiAnI0ZGMzM1NScsXG4gIH0sXG4gICd0ZXh0X2Jsb2Nrcyc6IHtcbiAgICAnY29sb3VyUHJpbWFyeSc6ICcjRkZCRjAwJyxcbiAgICAnY29sb3VyU2Vjb25kYXJ5JzogJyNFNkFDMDAnLFxuICAgICdjb2xvdXJUZXJ0aWFyeSc6ICcjQ0M5OTAwJyxcbiAgfSxcbiAgJ3ZhcmlhYmxlX2Jsb2Nrcyc6IHtcbiAgICAnY29sb3VyUHJpbWFyeSc6ICcjRkY4QzFBJyxcbiAgICAnY29sb3VyU2Vjb25kYXJ5JzogJyNGRjgwMDAnLFxuICAgICdjb2xvdXJUZXJ0aWFyeSc6ICcjREI2RTAwJyxcbiAgfSxcbiAgJ3ZhcmlhYmxlX2R5bmFtaWNfYmxvY2tzJzoge1xuICAgICdjb2xvdXJQcmltYXJ5JzogJyNGRjhDMUEnLFxuICAgICdjb2xvdXJTZWNvbmRhcnknOiAnI0ZGODAwMCcsXG4gICAgJ2NvbG91clRlcnRpYXJ5JzogJyNEQjZFMDAnLFxuICB9LFxuICAnaGF0X2Jsb2Nrcyc6IHtcbiAgICAnY29sb3VyUHJpbWFyeSc6ICcjNEM5N0ZGJyxcbiAgICAnY29sb3VyU2Vjb25kYXJ5JzogJyM0MjgwRDcnLFxuICAgICdjb2xvdXJUZXJ0aWFyeSc6ICcjMzM3M0NDJyxcbiAgICAnaGF0JzogJ2NhcCcsXG4gIH0sXG59O1xuXG5jb25zdCBjYXRlZ29yeVN0eWxlcyA9IHtcbiAgJ2NvbG91cl9jYXRlZ29yeSc6IHsnY29sb3VyJzogJyNDRjYzQ0YnfSxcbiAgJ2xpc3RfY2F0ZWdvcnknOiB7J2NvbG91cic6ICcjOTk2NkZGJ30sXG4gICdsb2dpY19jYXRlZ29yeSc6IHsnY29sb3VyJzogJyM0Qzk3RkYnfSxcbiAgJ2xvb3BfY2F0ZWdvcnknOiB7J2NvbG91cic6ICcjMGZCRDhDJ30sXG4gICdtYXRoX2NhdGVnb3J5Jzogeydjb2xvdXInOiAnIzU5QzA1OSd9LFxuICAncHJvY2VkdXJlX2NhdGVnb3J5Jzogeydjb2xvdXInOiAnI0ZGNjY4MCd9LFxuICAndGV4dF9jYXRlZ29yeSc6IHsnY29sb3VyJzogJyNGRkJGMDAnfSxcbiAgJ3ZhcmlhYmxlX2NhdGVnb3J5Jzogeydjb2xvdXInOiAnI0ZGOEMxQSd9LFxuICAndmFyaWFibGVfZHluYW1pY19jYXRlZ29yeSc6IHsnY29sb3VyJzogJyNGRjhDMUEnfSxcbn07XG5cbi8qKlxuICogWmVsb3MgdGhlbWUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVGhlbWVzLlplbG9zXG4gKi9cbmV4cG9ydCBjb25zdCBaZWxvcyA9IG5ldyBUaGVtZSgnemVsb3MnLCBkZWZhdWx0QmxvY2tTdHlsZXMsIGNhdGVnb3J5U3R5bGVzKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBOYW1lc3BhY2UgZm9yIHRoZW1lcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuVGhlbWVzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVGhlbWVzJyk7XG5cbmltcG9ydCB7Q2xhc3NpY30gZnJvbSAnLi9jbGFzc2ljLmpzJztcbmltcG9ydCB7WmVsb3N9IGZyb20gJy4vemVsb3MuanMnO1xuXG5cbmV4cG9ydCB7Q2xhc3NpYywgWmVsb3N9O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEV2ZW50cyBmaXJlZCBhcyBhIHJlc3VsdCBvZiBVSSBjbGljayBpbiBCbG9ja2x5J3MgZWRpdG9yLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5DbGljaycpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4uL2Jsb2NrLmpzJztcbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7QWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcblxuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgY2xpY2sgZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLkNsaWNrXG4gKi9cbmV4cG9ydCBjbGFzcyBDbGljayBleHRlbmRzIFVpQmFzZSB7XG4gIGJsb2NrSWQ/OiBzdHJpbmc7XG4gIHRhcmdldFR5cGU/OiBDbGlja1RhcmdldDtcbiAgb3ZlcnJpZGUgdHlwZSA9IGV2ZW50VXRpbHMuQ0xJQ0s7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfYmxvY2sgVGhlIGFmZmVjdGVkIGJsb2NrLiBOdWxsIGZvciBjbGljayBldmVudHMgdGhhdCBkbyBub3QgaGF2ZVxuICAgKiAgICAgYW4gYXNzb2NpYXRlZCBibG9jayAoaS5lLiB3b3Jrc3BhY2UgY2xpY2spLiBVbmRlZmluZWQgZm9yIGEgYmxhbmtcbiAgICogICAgIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X3dvcmtzcGFjZUlkIFRoZSB3b3Jrc3BhY2UgaWRlbnRpZmllciBmb3IgdGhpcyBldmVudC5cbiAgICogICAgTm90IHVzZWQgaWYgYmxvY2sgaXMgcGFzc2VkLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfdGFyZ2V0VHlwZSBUaGUgdHlwZSBvZiBlbGVtZW50IHRhcmdldGVkIGJ5IHRoaXMgY2xpY2sgZXZlbnQuXG4gICAqICAgICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIG9wdF9ibG9jaz86IEJsb2NrfG51bGwsIG9wdF93b3Jrc3BhY2VJZD86IHN0cmluZ3xudWxsLFxuICAgICAgb3B0X3RhcmdldFR5cGU/OiBDbGlja1RhcmdldCkge1xuICAgIGxldCB3b3Jrc3BhY2VJZCA9IG9wdF9ibG9jayA/IG9wdF9ibG9jay53b3Jrc3BhY2UuaWQgOiBvcHRfd29ya3NwYWNlSWQ7XG4gICAgaWYgKHdvcmtzcGFjZUlkID09PSBudWxsKSB7XG4gICAgICB3b3Jrc3BhY2VJZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgc3VwZXIod29ya3NwYWNlSWQpO1xuXG4gICAgdGhpcy5ibG9ja0lkID0gb3B0X2Jsb2NrID8gb3B0X2Jsb2NrLmlkIDogdW5kZWZpbmVkO1xuXG4gICAgLyoqIFRoZSB0eXBlIG9mIGVsZW1lbnQgdGFyZ2V0ZWQgYnkgdGhpcyBjbGljayBldmVudC4gKi9cbiAgICB0aGlzLnRhcmdldFR5cGUgPSBvcHRfdGFyZ2V0VHlwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSB0b0pzb24oKTogQ2xpY2tKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgQ2xpY2tKc29uO1xuICAgIGlmICghdGhpcy50YXJnZXRUeXBlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBjbGljayB0YXJnZXQgdHlwZSBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgYmxvY2sgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBqc29uWyd0YXJnZXRUeXBlJ10gPSB0aGlzLnRhcmdldFR5cGU7XG4gICAganNvblsnYmxvY2tJZCddID0gdGhpcy5ibG9ja0lkO1xuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIGZyb21Kc29uKGpzb246IENsaWNrSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5DbGljay5wcm90b3R5cGUuZnJvbUpzb24nLCAndmVyc2lvbiA5JywgJ3ZlcnNpb24gMTAnLFxuICAgICAgICAnQmxvY2tseS5FdmVudHMuZnJvbUpzb24nKTtcbiAgICBzdXBlci5mcm9tSnNvbihqc29uKTtcbiAgICB0aGlzLnRhcmdldFR5cGUgPSBqc29uWyd0YXJnZXRUeXBlJ107XG4gICAgdGhpcy5ibG9ja0lkID0ganNvblsnYmxvY2tJZCddO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBDbGljaywgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdCBwYXJhbWV0ZXJzIHRvXG4gICAqICAgICBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZiBwYXJhbWV0ZXJzIHRvXG4gICAqICAgICBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IENsaWNrSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTogQ2xpY2sge1xuICAgIGNvbnN0IG5ld0V2ZW50ID1cbiAgICAgICAgc3VwZXIuZnJvbUpzb24oanNvbiwgd29ya3NwYWNlLCBldmVudCA/PyBuZXcgQ2xpY2soKSkgYXMgQ2xpY2s7XG4gICAgbmV3RXZlbnQudGFyZ2V0VHlwZSA9IGpzb25bJ3RhcmdldFR5cGUnXTtcbiAgICBuZXdFdmVudC5ibG9ja0lkID0ganNvblsnYmxvY2tJZCddO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxufVxuXG5leHBvcnQgZW51bSBDbGlja1RhcmdldCB7XG4gIEJMT0NLID0gJ2Jsb2NrJyxcbiAgV09SS1NQQUNFID0gJ3dvcmtzcGFjZScsXG4gIFpPT01fQ09OVFJPTFMgPSAnem9vbV9jb250cm9scycsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2xpY2tKc29uIGV4dGVuZHMgQWJzdHJhY3RFdmVudEpzb24ge1xuICB0YXJnZXRUeXBlOiBDbGlja1RhcmdldDtcbiAgYmxvY2tJZD86IHN0cmluZztcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5DTElDSywgQ2xpY2spO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1ldGhvZHMgZm9yIGRyYWdnaW5nIGEgYnViYmxlIHZpc3VhbGx5LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkJ1YmJsZURyYWdnZXInKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrRHJhZ1N1cmZhY2VTdmd9IGZyb20gJy4vYmxvY2tfZHJhZ19zdXJmYWNlLmpzJztcbmltcG9ydCB7Q29tcG9uZW50TWFuYWdlcn0gZnJvbSAnLi9jb21wb25lbnRfbWFuYWdlci5qcyc7XG5pbXBvcnQgdHlwZSB7Q29tbWVudE1vdmV9IGZyb20gJy4vZXZlbnRzL2V2ZW50c19jb21tZW50X21vdmUuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7SUJ1YmJsZX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfYnViYmxlLmpzJztcbmltcG9ydCB0eXBlIHtJRGVsZXRlQXJlYX0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZGVsZXRlX2FyZWEuanMnO1xuaW1wb3J0IHR5cGUge0lEcmFnVGFyZ2V0fSBmcm9tICcuL2ludGVyZmFjZXMvaV9kcmFnX3RhcmdldC5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZUNvbW1lbnRTdmd9IGZyb20gJy4vd29ya3NwYWNlX2NvbW1lbnRfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBidWJibGUgZHJhZ2dlci4gIEl0IG1vdmVzIHRoaW5ncyBvbiB0aGUgYnViYmxlIGNhbnZhcyBhcm91bmQgdGhlXG4gKiB3b3Jrc3BhY2Ugd2hlbiB0aGV5IGFyZSBiZWluZyBkcmFnZ2VkIGJ5IGEgbW91c2Ugb3IgdG91Y2guICBUaGVzZSBjYW4gYmVcbiAqIGJsb2NrIGNvbW1lbnRzLCBtdXRhdG9ycywgd2FybmluZ3MsIG9yIHdvcmtzcGFjZSBjb21tZW50cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5CdWJibGVEcmFnZ2VyXG4gKi9cbmV4cG9ydCBjbGFzcyBCdWJibGVEcmFnZ2VyIHtcbiAgLyoqIFdoaWNoIGRyYWcgdGFyZ2V0IHRoZSBtb3VzZSBwb2ludGVyIGlzIG92ZXIsIGlmIGFueS4gKi9cbiAgcHJpdmF0ZSBkcmFnVGFyZ2V0XzogSURyYWdUYXJnZXR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFdoZXRoZXIgdGhlIGJ1YmJsZSB3b3VsZCBiZSBkZWxldGVkIGlmIGRyb3BwZWQgaW1tZWRpYXRlbHkuICovXG4gIHByaXZhdGUgd291bGREZWxldGVCdWJibGVfID0gZmFsc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhcnRYWV86IENvb3JkaW5hdGU7XG4gIHByaXZhdGUgZHJhZ1N1cmZhY2VfOiBCbG9ja0RyYWdTdXJmYWNlU3ZnfG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBidWJibGUgVGhlIGl0ZW0gb24gdGhlIGJ1YmJsZSBjYW52YXMgdG8gZHJhZy5cbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIGRyYWcgb24uXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJ1YmJsZTogSUJ1YmJsZSwgcHJpdmF0ZSB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge1xuICAgIC8qKlxuICAgICAqIFRoZSBsb2NhdGlvbiBvZiB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBkcmFnZ2luZyBidWJibGUncyBib2R5IGF0IHRoZVxuICAgICAqIGJlZ2lubmluZyBvZiB0aGUgZHJhZywgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgICAqL1xuICAgIHRoaXMuc3RhcnRYWV8gPSB0aGlzLmJ1YmJsZS5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZHJhZyBzdXJmYWNlIHRvIG1vdmUgYnViYmxlcyB0byBkdXJpbmcgYSBkcmFnLCBvciBudWxsIGlmIG5vbmUgc2hvdWxkXG4gICAgICogYmUgdXNlZC4gIEJsb2NrIGRyYWdnaW5nIGFuZCBidWJibGUgZHJhZ2dpbmcgdXNlIHRoZSBzYW1lIHN1cmZhY2UuXG4gICAgICovXG4gICAgdGhpcy5kcmFnU3VyZmFjZV8gPSB3b3Jrc3BhY2UuZ2V0QmxvY2tEcmFnU3VyZmFjZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGRyYWdnaW5nIGEgYnViYmxlLiAgVGhpcyBpbmNsdWRlcyBtb3ZpbmcgaXQgdG8gdGhlIGRyYWcgc3VyZmFjZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGFydEJ1YmJsZURyYWcoKSB7XG4gICAgaWYgKCFldmVudFV0aWxzLmdldEdyb3VwKCkpIHtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy53b3Jrc3BhY2Uuc2V0UmVzaXplc0VuYWJsZWQoZmFsc2UpO1xuICAgIHRoaXMuYnViYmxlLnNldEF1dG9MYXlvdXQoZmFsc2UpO1xuICAgIGlmICh0aGlzLmRyYWdTdXJmYWNlXykge1xuICAgICAgdGhpcy5idWJibGUubW92ZVRvKDAsIDApO1xuICAgICAgdGhpcy5kcmFnU3VyZmFjZV8udHJhbnNsYXRlU3VyZmFjZSh0aGlzLnN0YXJ0WFlfLngsIHRoaXMuc3RhcnRYWV8ueSk7XG4gICAgICAvLyBFeGVjdXRlIHRoZSBtb3ZlIG9uIHRoZSB0b3AtbGV2ZWwgU1ZHIGNvbXBvbmVudC5cbiAgICAgIHRoaXMuZHJhZ1N1cmZhY2VfLnNldEJsb2Nrc0FuZFNob3codGhpcy5idWJibGUuZ2V0U3ZnUm9vdCgpKTtcbiAgICB9XG5cbiAgICB0aGlzLmJ1YmJsZS5zZXREcmFnZ2luZyAmJiB0aGlzLmJ1YmJsZS5zZXREcmFnZ2luZyh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGEgc3RlcCBvZiBidWJibGUgZHJhZ2dpbmcsIGJhc2VkIG9uIHRoZSBnaXZlbiBldmVudC4gIFVwZGF0ZSB0aGVcbiAgICogZGlzcGxheSBhY2NvcmRpbmdseS5cbiAgICpcbiAgICogQHBhcmFtIGUgVGhlIG1vc3QgcmVjZW50IG1vdmUgZXZlbnQuXG4gICAqIEBwYXJhbSBjdXJyZW50RHJhZ0RlbHRhWFkgSG93IGZhciB0aGUgcG9pbnRlciBoYXMgbW92ZWQgZnJvbSB0aGUgcG9zaXRpb25cbiAgICogICAgIGF0IHRoZSBzdGFydCBvZiB0aGUgZHJhZywgaW4gcGl4ZWwgdW5pdHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZHJhZ0J1YmJsZShlOiBQb2ludGVyRXZlbnQsIGN1cnJlbnREcmFnRGVsdGFYWTogQ29vcmRpbmF0ZSkge1xuICAgIGNvbnN0IGRlbHRhID0gdGhpcy5waXhlbHNUb1dvcmtzcGFjZVVuaXRzXyhjdXJyZW50RHJhZ0RlbHRhWFkpO1xuICAgIGNvbnN0IG5ld0xvYyA9IENvb3JkaW5hdGUuc3VtKHRoaXMuc3RhcnRYWV8sIGRlbHRhKTtcbiAgICB0aGlzLmJ1YmJsZS5tb3ZlRHVyaW5nRHJhZyh0aGlzLmRyYWdTdXJmYWNlXywgbmV3TG9jKTtcblxuICAgIGNvbnN0IG9sZERyYWdUYXJnZXQgPSB0aGlzLmRyYWdUYXJnZXRfO1xuICAgIHRoaXMuZHJhZ1RhcmdldF8gPSB0aGlzLndvcmtzcGFjZS5nZXREcmFnVGFyZ2V0KGUpO1xuXG4gICAgY29uc3Qgb2xkV291bGREZWxldGVCdWJibGUgPSB0aGlzLndvdWxkRGVsZXRlQnViYmxlXztcbiAgICB0aGlzLndvdWxkRGVsZXRlQnViYmxlXyA9IHRoaXMuc2hvdWxkRGVsZXRlXyh0aGlzLmRyYWdUYXJnZXRfKTtcbiAgICBpZiAob2xkV291bGREZWxldGVCdWJibGUgIT09IHRoaXMud291bGREZWxldGVCdWJibGVfKSB7XG4gICAgICAvLyBQcmV2ZW50IHVubmVjZXNzYXJ5IGFkZC9yZW1vdmUgY2xhc3MgY2FsbHMuXG4gICAgICB0aGlzLnVwZGF0ZUN1cnNvckR1cmluZ0J1YmJsZURyYWdfKCk7XG4gICAgfVxuICAgIC8vIENhbGwgZHJhZyBlbnRlci9leGl0L292ZXIgYWZ0ZXIgd291bGREZWxldGVCbG9jayBpcyBjYWxsZWQgaW5cbiAgICAvLyBzaG91bGREZWxldGVfXG4gICAgaWYgKHRoaXMuZHJhZ1RhcmdldF8gIT09IG9sZERyYWdUYXJnZXQpIHtcbiAgICAgIG9sZERyYWdUYXJnZXQgJiYgb2xkRHJhZ1RhcmdldC5vbkRyYWdFeGl0KHRoaXMuYnViYmxlKTtcbiAgICAgIHRoaXMuZHJhZ1RhcmdldF8gJiYgdGhpcy5kcmFnVGFyZ2V0Xy5vbkRyYWdFbnRlcih0aGlzLmJ1YmJsZSk7XG4gICAgfVxuICAgIHRoaXMuZHJhZ1RhcmdldF8gJiYgdGhpcy5kcmFnVGFyZ2V0Xy5vbkRyYWdPdmVyKHRoaXMuYnViYmxlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGVuZGluZyB0aGUgZHJhZyB3b3VsZCBkZWxldGUgdGhlIGJ1YmJsZS5cbiAgICpcbiAgICogQHBhcmFtIGRyYWdUYXJnZXQgVGhlIGRyYWcgdGFyZ2V0IHRoYXQgdGhlIGJ1YmJsZWUgaXMgY3VycmVudGx5IG92ZXIuXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgZHJvcHBpbmcgdGhlIGJ1YmJsZSBpbW1lZGlhdGVseSB3b3VsZCBkZWxldGUgdGhlIGJsb2NrLlxuICAgKi9cbiAgcHJpdmF0ZSBzaG91bGREZWxldGVfKGRyYWdUYXJnZXQ6IElEcmFnVGFyZ2V0fG51bGwpOiBib29sZWFuIHtcbiAgICBpZiAoZHJhZ1RhcmdldCkge1xuICAgICAgY29uc3QgY29tcG9uZW50TWFuYWdlciA9IHRoaXMud29ya3NwYWNlLmdldENvbXBvbmVudE1hbmFnZXIoKTtcbiAgICAgIGNvbnN0IGlzRGVsZXRlQXJlYSA9IGNvbXBvbmVudE1hbmFnZXIuaGFzQ2FwYWJpbGl0eShcbiAgICAgICAgICBkcmFnVGFyZ2V0LmlkLCBDb21wb25lbnRNYW5hZ2VyLkNhcGFiaWxpdHkuREVMRVRFX0FSRUEpO1xuICAgICAgaWYgKGlzRGVsZXRlQXJlYSkge1xuICAgICAgICByZXR1cm4gKGRyYWdUYXJnZXQgYXMgSURlbGV0ZUFyZWEpLndvdWxkRGVsZXRlKHRoaXMuYnViYmxlLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGN1cnNvciAoYW5kIHBvc3NpYmx5IHRoZSB0cmFzaCBjYW4gbGlkKSB0byByZWZsZWN0IHdoZXRoZXIgdGhlXG4gICAqIGRyYWdnaW5nIGJ1YmJsZSB3b3VsZCBiZSBkZWxldGVkIGlmIHJlbGVhc2VkIGltbWVkaWF0ZWx5LlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVDdXJzb3JEdXJpbmdCdWJibGVEcmFnXygpIHtcbiAgICB0aGlzLmJ1YmJsZS5zZXREZWxldGVTdHlsZSh0aGlzLndvdWxkRGVsZXRlQnViYmxlXyk7XG4gIH1cblxuICAvKipcbiAgICogRmluaXNoIGEgYnViYmxlIGRyYWcgYW5kIHB1dCB0aGUgYnViYmxlIGJhY2sgb24gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGUgVGhlIHBvaW50ZXJ1cCBldmVudC5cbiAgICogQHBhcmFtIGN1cnJlbnREcmFnRGVsdGFYWSBIb3cgZmFyIHRoZSBwb2ludGVyIGhhcyBtb3ZlZCBmcm9tIHRoZSBwb3NpdGlvblxuICAgKiAgICAgYXQgdGhlIHN0YXJ0IG9mIHRoZSBkcmFnLCBpbiBwaXhlbCB1bml0cy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBlbmRCdWJibGVEcmFnKGU6IFBvaW50ZXJFdmVudCwgY3VycmVudERyYWdEZWx0YVhZOiBDb29yZGluYXRlKSB7XG4gICAgLy8gTWFrZSBzdXJlIGludGVybmFsIHN0YXRlIGlzIGZyZXNoLlxuICAgIHRoaXMuZHJhZ0J1YmJsZShlLCBjdXJyZW50RHJhZ0RlbHRhWFkpO1xuXG4gICAgY29uc3QgcHJldmVudE1vdmUgPVxuICAgICAgICB0aGlzLmRyYWdUYXJnZXRfICYmIHRoaXMuZHJhZ1RhcmdldF8uc2hvdWxkUHJldmVudE1vdmUodGhpcy5idWJibGUpO1xuICAgIGxldCBuZXdMb2M7XG4gICAgaWYgKHByZXZlbnRNb3ZlKSB7XG4gICAgICBuZXdMb2MgPSB0aGlzLnN0YXJ0WFlfO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBkZWx0YSA9IHRoaXMucGl4ZWxzVG9Xb3Jrc3BhY2VVbml0c18oY3VycmVudERyYWdEZWx0YVhZKTtcbiAgICAgIG5ld0xvYyA9IENvb3JkaW5hdGUuc3VtKHRoaXMuc3RhcnRYWV8sIGRlbHRhKTtcbiAgICB9XG4gICAgLy8gTW92ZSB0aGUgYnViYmxlIHRvIGl0cyBmaW5hbCBsb2NhdGlvbi5cbiAgICB0aGlzLmJ1YmJsZS5tb3ZlVG8obmV3TG9jLngsIG5ld0xvYy55KTtcblxuICAgIGlmICh0aGlzLmRyYWdUYXJnZXRfKSB7XG4gICAgICB0aGlzLmRyYWdUYXJnZXRfLm9uRHJvcCh0aGlzLmJ1YmJsZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMud291bGREZWxldGVCdWJibGVfKSB7XG4gICAgICAvLyBGaXJlIGEgbW92ZSBldmVudCwgc28gd2Uga25vdyB3aGVyZSB0byBnbyBiYWNrIHRvIGZvciBhbiB1bmRvLlxuICAgICAgdGhpcy5maXJlTW92ZUV2ZW50XygpO1xuICAgICAgdGhpcy5idWJibGUuZGlzcG9zZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBQdXQgZXZlcnl0aGluZyBiYWNrIG9udG8gdGhlIGJ1YmJsZSBjYW52YXMuXG4gICAgICBpZiAodGhpcy5kcmFnU3VyZmFjZV8pIHtcbiAgICAgICAgdGhpcy5kcmFnU3VyZmFjZV8uY2xlYXJBbmRIaWRlKHRoaXMud29ya3NwYWNlLmdldEJ1YmJsZUNhbnZhcygpKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmJ1YmJsZS5zZXREcmFnZ2luZykge1xuICAgICAgICB0aGlzLmJ1YmJsZS5zZXREcmFnZ2luZyhmYWxzZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmZpcmVNb3ZlRXZlbnRfKCk7XG4gICAgfVxuICAgIHRoaXMud29ya3NwYWNlLnNldFJlc2l6ZXNFbmFibGVkKHRydWUpO1xuXG4gICAgZXZlbnRVdGlscy5zZXRHcm91cChmYWxzZSk7XG4gIH1cblxuICAvKiogRmlyZSBhIG1vdmUgZXZlbnQgYXQgdGhlIGVuZCBvZiBhIGJ1YmJsZSBkcmFnLiAqL1xuICBwcml2YXRlIGZpcmVNb3ZlRXZlbnRfKCkge1xuICAgIGlmICh0aGlzLmJ1YmJsZSBpbnN0YW5jZW9mIFdvcmtzcGFjZUNvbW1lbnRTdmcpIHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkNPTU1FTlRfTU9WRSkpKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWJibGUpIGFzIENvbW1lbnRNb3ZlO1xuICAgICAgZXZlbnQuc2V0T2xkQ29vcmRpbmF0ZSh0aGlzLnN0YXJ0WFlfKTtcbiAgICAgIGV2ZW50LnJlY29yZE5ldygpO1xuICAgICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgICB9XG4gICAgLy8gVE9ETyAoZmVuaWNoZWwpOiBtb3ZlIGV2ZW50cyBmb3IgY29tbWVudHMuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYSBjb29yZGluYXRlIG9iamVjdCBmcm9tIHBpeGVscyB0byB3b3Jrc3BhY2UgdW5pdHMsIGluY2x1ZGluZyBhXG4gICAqIGNvcnJlY3Rpb24gZm9yIG11dGF0b3Igd29ya3NwYWNlcy5cbiAgICogVGhpcyBmdW5jdGlvbiBkb2VzIG5vdCBjb25zaWRlciBkaWZmZXJpbmcgb3JpZ2lucy4gIEl0IHNpbXBseSBzY2FsZXMgdGhlXG4gICAqIGlucHV0J3MgeCBhbmQgeSB2YWx1ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBwaXhlbENvb3JkIEEgY29vcmRpbmF0ZSB3aXRoIHggYW5kIHkgdmFsdWVzIGluIENTUyBwaXhlbCB1bml0cy5cbiAgICogQHJldHVybnMgVGhlIGlucHV0IGNvb3JkaW5hdGUgZGl2aWRlZCBieSB0aGUgd29ya3NwYWNlIHNjYWxlLlxuICAgKi9cbiAgcHJpdmF0ZSBwaXhlbHNUb1dvcmtzcGFjZVVuaXRzXyhwaXhlbENvb3JkOiBDb29yZGluYXRlKTogQ29vcmRpbmF0ZSB7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IENvb3JkaW5hdGUoXG4gICAgICAgIHBpeGVsQ29vcmQueCAvIHRoaXMud29ya3NwYWNlLnNjYWxlLFxuICAgICAgICBwaXhlbENvb3JkLnkgLyB0aGlzLndvcmtzcGFjZS5zY2FsZSk7XG4gICAgaWYgKHRoaXMud29ya3NwYWNlLmlzTXV0YXRvcikge1xuICAgICAgLy8gSWYgd2UncmUgaW4gYSBtdXRhdG9yLCBpdHMgc2NhbGUgaXMgYWx3YXlzIDEsIHB1cmVseSBiZWNhdXNlIG9mIHNvbWVcbiAgICAgIC8vIG9kZGl0aWVzIGluIG91ciByZW5kZXJpbmcgb3B0aW1pemF0aW9ucy4gIFRoZSBhY3R1YWwgc2NhbGUgaXMgdGhlIHNhbWVcbiAgICAgIC8vIGFzIHRoZSBzY2FsZSBvbiB0aGUgcGFyZW50IHdvcmtzcGFjZS4gRml4IHRoYXQgZm9yIGRyYWdnaW5nLlxuICAgICAgY29uc3QgbWFpblNjYWxlID0gdGhpcy53b3Jrc3BhY2Uub3B0aW9ucy5wYXJlbnRXb3Jrc3BhY2UhLnNjYWxlO1xuICAgICAgcmVzdWx0LnNjYWxlKDEgLyBtYWluU2NhbGUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWV0aG9kcyBmb3IgZHJhZ2dpbmcgYSB3b3Jrc3BhY2UgdmlzdWFsbHkuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuV29ya3NwYWNlRHJhZ2dlcicpO1xuXG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0IHtDb29yZGluYXRlfSBmcm9tICcuL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIHdvcmtzcGFjZSBkcmFnZ2VyLiAgSXQgbW92ZXMgdGhlIHdvcmtzcGFjZSBhcm91bmQgd2hlbiBpdCBpc1xuICogYmVpbmcgZHJhZ2dlZCBieSBhIG1vdXNlIG9yIHRvdWNoLlxuICogTm90ZSB0aGF0IHRoZSB3b3Jrc3BhY2UgaXRzZWxmIG1hbmFnZXMgd2hldGhlciBvciBub3QgaXQgaGFzIGEgZHJhZyBzdXJmYWNlXG4gKiBhbmQgaG93IHRvIGRvIHRyYW5zbGF0aW9ucyBiYXNlZCBvbiB0aGF0LiAgVGhpcyBzaW1wbHkgcGFzc2VzIHRoZSByaWdodFxuICogY29tbWFuZHMgYmFzZWQgb24gZXZlbnRzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LldvcmtzcGFjZURyYWdnZXJcbiAqL1xuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZURyYWdnZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IGhvcml6b250YWxTY3JvbGxFbmFibGVkXzogYm9vbGVhbjtcbiAgcHJpdmF0ZSByZWFkb25seSB2ZXJ0aWNhbFNjcm9sbEVuYWJsZWRfOiBib29sZWFuO1xuICBwcm90ZWN0ZWQgc3RhcnRTY3JvbGxYWV86IENvb3JkaW5hdGU7XG5cbiAgLyoqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBkcmFnLiAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKSB7XG4gICAgLyoqIFdoZXRoZXIgaG9yaXpvbnRhbCBzY3JvbGwgaXMgZW5hYmxlZC4gKi9cbiAgICB0aGlzLmhvcml6b250YWxTY3JvbGxFbmFibGVkXyA9IHRoaXMud29ya3NwYWNlLmlzTW92YWJsZUhvcml6b250YWxseSgpO1xuXG4gICAgLyoqIFdoZXRoZXIgdmVydGljYWwgc2Nyb2xsIGlzIGVuYWJsZWQuICovXG4gICAgdGhpcy52ZXJ0aWNhbFNjcm9sbEVuYWJsZWRfID0gdGhpcy53b3Jrc3BhY2UuaXNNb3ZhYmxlVmVydGljYWxseSgpO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNjcm9sbCBwb3NpdGlvbiBvZiB0aGUgd29ya3NwYWNlIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGRyYWcuXG4gICAgICogQ29vcmRpbmF0ZSBzeXN0ZW06IHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgICAqL1xuICAgIHRoaXMuc3RhcnRTY3JvbGxYWV8gPSBuZXcgQ29vcmRpbmF0ZSh3b3Jrc3BhY2Uuc2Nyb2xsWCwgd29ya3NwYWNlLnNjcm9sbFkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldmVyIGFsbCBsaW5rcyBmcm9tIHRoaXMgb2JqZWN0LlxuICAgKlxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ251bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgICAvLyAnV29ya3NwYWNlU3ZnJy5cbiAgICB0aGlzLndvcmtzcGFjZSA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGRyYWdnaW5nIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhcnREcmFnKCkge1xuICAgIGlmIChjb21tb24uZ2V0U2VsZWN0ZWQoKSkge1xuICAgICAgY29tbW9uLmdldFNlbGVjdGVkKCkhLnVuc2VsZWN0KCk7XG4gICAgfVxuICAgIHRoaXMud29ya3NwYWNlLnNldHVwRHJhZ1N1cmZhY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5pc2ggZHJhZ2dpbmcgdGhlIHdvcmtzcGFjZSBhbmQgcHV0IGV2ZXJ5dGhpbmcgYmFjayB3aGVyZSBpdCBiZWxvbmdzLlxuICAgKlxuICAgKiBAcGFyYW0gY3VycmVudERyYWdEZWx0YVhZIEhvdyBmYXIgdGhlIHBvaW50ZXIgaGFzIG1vdmVkIGZyb20gdGhlIHBvc2l0aW9uXG4gICAqICAgICBhdCB0aGUgc3RhcnQgb2YgdGhlIGRyYWcsIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGVuZERyYWcoY3VycmVudERyYWdEZWx0YVhZOiBDb29yZGluYXRlKSB7XG4gICAgLy8gTWFrZSBzdXJlIGV2ZXJ5dGhpbmcgaXMgdXAgdG8gZGF0ZS5cbiAgICB0aGlzLmRyYWcoY3VycmVudERyYWdEZWx0YVhZKTtcbiAgICB0aGlzLndvcmtzcGFjZS5yZXNldERyYWdTdXJmYWNlKCk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgd29ya3NwYWNlIGJhc2VkIG9uIHRoZSBtb3N0IHJlY2VudCBtb3VzZSBtb3ZlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBjdXJyZW50RHJhZ0RlbHRhWFkgSG93IGZhciB0aGUgcG9pbnRlciBoYXMgbW92ZWQgZnJvbSB0aGUgcG9zaXRpb25cbiAgICogICAgIGF0IHRoZSBzdGFydCBvZiB0aGUgZHJhZywgaW4gcGl4ZWwgY29vcmRpbmF0ZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZHJhZyhjdXJyZW50RHJhZ0RlbHRhWFk6IENvb3JkaW5hdGUpIHtcbiAgICBjb25zdCBuZXdYWSA9IENvb3JkaW5hdGUuc3VtKHRoaXMuc3RhcnRTY3JvbGxYWV8sIGN1cnJlbnREcmFnRGVsdGFYWSk7XG5cbiAgICBpZiAodGhpcy5ob3Jpem9udGFsU2Nyb2xsRW5hYmxlZF8gJiYgdGhpcy52ZXJ0aWNhbFNjcm9sbEVuYWJsZWRfKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZS5zY3JvbGwobmV3WFkueCwgbmV3WFkueSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmhvcml6b250YWxTY3JvbGxFbmFibGVkXykge1xuICAgICAgdGhpcy53b3Jrc3BhY2Uuc2Nyb2xsKG5ld1hZLngsIHRoaXMud29ya3NwYWNlLnNjcm9sbFkpO1xuICAgIH0gZWxzZSBpZiAodGhpcy52ZXJ0aWNhbFNjcm9sbEVuYWJsZWRfKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZS5zY3JvbGwodGhpcy53b3Jrc3BhY2Uuc2Nyb2xsWCwgbmV3WFkueSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgc3RhdGUuJyk7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIGNsYXNzIHJlcHJlc2VudGluZyBhbiBpbi1wcm9ncmVzcyBnZXN0dXJlLCBlLmcuIGEgZHJhZyxcbiAqIHRhcCwgb3IgcGluY2ggdG8gem9vbS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5HZXN0dXJlJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9ldmVudHMvZXZlbnRzX2NsaWNrLmpzJztcblxuaW1wb3J0ICogYXMgYmxvY2tBbmltYXRpb25zIGZyb20gJy4vYmxvY2tfYW5pbWF0aW9ucy5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQge0J1YmJsZURyYWdnZXJ9IGZyb20gJy4vYnViYmxlX2RyYWdnZXIuanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4vY29tbW9uLmpzJztcbmltcG9ydCB7Y29uZmlnfSBmcm9tICcuL2NvbmZpZy5qcyc7XG5pbXBvcnQgKiBhcyBkcm9wRG93bkRpdiBmcm9tICcuL2Ryb3Bkb3duZGl2LmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCB0eXBlIHtJQmxvY2tEcmFnZ2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9ibG9ja19kcmFnZ2VyLmpzJztcbmltcG9ydCB0eXBlIHtJQnViYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9idWJibGUuanMnO1xuaW1wb3J0IHR5cGUge0lGbHlvdXR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2ZseW91dC5qcyc7XG5pbXBvcnQgKiBhcyBpbnRlcm5hbENvbnN0YW50cyBmcm9tICcuL2ludGVybmFsX2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIFRvb2x0aXAgZnJvbSAnLi90b29sdGlwLmpzJztcbmltcG9ydCAqIGFzIFRvdWNoIGZyb20gJy4vdG91Y2guanMnO1xuaW1wb3J0IHtDb29yZGluYXRlfSBmcm9tICcuL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuaW1wb3J0IHtXb3Jrc3BhY2VDb21tZW50U3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9jb21tZW50X3N2Zy5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZURyYWdnZXJ9IGZyb20gJy4vd29ya3NwYWNlX2RyYWdnZXIuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIE5vdGU6IEluIHRoaXMgZmlsZSBcInN0YXJ0XCIgcmVmZXJzIHRvIHBvaW50ZXJkb3duXG4gKiBldmVudHMuICBcIkVuZFwiIHJlZmVycyB0byBwb2ludGVydXAgZXZlbnRzLlxuICovXG5cbi8qKiBBIG11bHRpcGxpZXIgdXNlZCB0byBjb252ZXJ0IHRoZSBnZXN0dXJlIHNjYWxlIHRvIGEgem9vbSBpbiBkZWx0YS4gKi9cbmNvbnN0IFpPT01fSU5fTVVMVElQTElFUiA9IDU7XG5cbi8qKiBBIG11bHRpcGxpZXIgdXNlZCB0byBjb252ZXJ0IHRoZSBnZXN0dXJlIHNjYWxlIHRvIGEgem9vbSBvdXQgZGVsdGEuICovXG5jb25zdCBaT09NX09VVF9NVUxUSVBMSUVSID0gNjtcblxuLyoqXG4gKiBDbGFzcyBmb3Igb25lIGdlc3R1cmUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuR2VzdHVyZVxuICovXG5leHBvcnQgY2xhc3MgR2VzdHVyZSB7XG4gIC8qKlxuICAgKiBUaGUgcG9zaXRpb24gb2YgdGhlIHBvaW50ZXIgd2hlbiB0aGUgZ2VzdHVyZSBzdGFydGVkLiAgVW5pdHMgYXJlIENTU1xuICAgKiBwaXhlbHMsIHdpdGggKDAsIDApIGF0IHRoZSB0b3AgbGVmdCBvZiB0aGUgYnJvd3NlciB3aW5kb3cgKHBvaW50ZXIgZXZlbnRcbiAgICogY2xpZW50WC9ZKS5cbiAgICovXG4gIHByaXZhdGUgbW91c2VEb3duWFlfID0gbmV3IENvb3JkaW5hdGUoMCwgMCk7XG4gIHByaXZhdGUgY3VycmVudERyYWdEZWx0YVhZXzogQ29vcmRpbmF0ZTtcblxuICAvKipcbiAgICogVGhlIGJ1YmJsZSB0aGF0IHRoZSBnZXN0dXJlIHN0YXJ0ZWQgb24sIG9yIG51bGwgaWYgaXQgZGlkIG5vdCBzdGFydCBvbiBhXG4gICAqIGJ1YmJsZS5cbiAgICovXG4gIHByaXZhdGUgc3RhcnRCdWJibGVfOiBJQnViYmxlfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgdGhhdCB0aGUgZ2VzdHVyZSBzdGFydGVkIG9uLCBvciBudWxsIGlmIGl0IGRpZCBub3Qgc3RhcnQgb24gYVxuICAgKiBmaWVsZC5cbiAgICovXG4gIHByaXZhdGUgc3RhcnRGaWVsZF86IEZpZWxkfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgYmxvY2sgdGhhdCB0aGUgZ2VzdHVyZSBzdGFydGVkIG9uLCBvciBudWxsIGlmIGl0IGRpZCBub3Qgc3RhcnQgb24gYVxuICAgKiBibG9jay5cbiAgICovXG4gIHByaXZhdGUgc3RhcnRCbG9ja186IEJsb2NrU3ZnfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgYmxvY2sgdGhhdCB0aGlzIGdlc3R1cmUgdGFyZ2V0cy4gIElmIHRoZSBnZXN0dXJlIHN0YXJ0ZWQgb24gYVxuICAgKiBzaGFkb3cgYmxvY2ssIHRoaXMgaXMgdGhlIGZpcnN0IG5vbi1zaGFkb3cgcGFyZW50IG9mIHRoZSBibG9jay4gIElmIHRoZVxuICAgKiBnZXN0dXJlIHN0YXJ0ZWQgaW4gdGhlIGZseW91dCwgdGhpcyBpcyB0aGUgcm9vdCBibG9jayBvZiB0aGUgYmxvY2sgZ3JvdXBcbiAgICogdGhhdCB3YXMgY2xpY2tlZCBvciBkcmFnZ2VkLlxuICAgKi9cbiAgcHJpdmF0ZSB0YXJnZXRCbG9ja186IEJsb2NrU3ZnfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgd29ya3NwYWNlIHRoYXQgdGhlIGdlc3R1cmUgc3RhcnRlZCBvbi4gIFRoZXJlIG1heSBiZSBtdWx0aXBsZVxuICAgKiB3b3Jrc3BhY2VzIG9uIGEgcGFnZTsgdGhpcyBpcyBtb3JlIGFjY3VyYXRlIHRoYW4gdXNpbmdcbiAgICogQmxvY2tseS5jb21tb24uZ2V0TWFpbldvcmtzcGFjZSgpLlxuICAgKi9cbiAgcHJvdGVjdGVkIHN0YXJ0V29ya3NwYWNlXzogV29ya3NwYWNlU3ZnfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBwb2ludGVyIGhhcyBhdCBhbnkgcG9pbnQgbW92ZWQgb3V0IG9mIHRoZSBkcmFnIHJhZGl1cy5cbiAgICogQSBnZXN0dXJlIHRoYXQgZXhjZWVkcyB0aGUgZHJhZyByYWRpdXMgaXMgYSBkcmFnIGV2ZW4gaWYgaXQgZW5kcyBleGFjdGx5XG4gICAqIGF0IGl0cyBzdGFydCBwb2ludC5cbiAgICovXG4gIHByaXZhdGUgaGFzRXhjZWVkZWREcmFnUmFkaXVzXyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBBIGhhbmRsZSB0byB1c2UgdG8gdW5iaW5kIGEgcG9pbnRlcm1vdmUgbGlzdGVuZXIgYXQgdGhlIGVuZCBvZiBhIGRyYWcuXG4gICAqIE9wYXF1ZSBkYXRhIHJldHVybmVkIGZyb20gQmxvY2tseS5iaW5kRXZlbnRXaXRoQ2hlY2tzXy5cbiAgICovXG4gIHByb3RlY3RlZCBvbk1vdmVXcmFwcGVyXzogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBBIGhhbmRsZSB0byB1c2UgdG8gdW5iaW5kIGEgcG9pbnRlcnVwIGxpc3RlbmVyIGF0IHRoZSBlbmQgb2YgYSBkcmFnLlxuICAgKiBPcGFxdWUgZGF0YSByZXR1cm5lZCBmcm9tIEJsb2NrbHkuYmluZEV2ZW50V2l0aENoZWNrc18uXG4gICAqL1xuICBwcm90ZWN0ZWQgb25VcFdyYXBwZXJfOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBvYmplY3QgdHJhY2tpbmcgYSBidWJibGUgZHJhZywgb3IgbnVsbCBpZiBub25lIGlzIGluIHByb2dyZXNzLiAqL1xuICBwcml2YXRlIGJ1YmJsZURyYWdnZXJfOiBCdWJibGVEcmFnZ2VyfG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgb2JqZWN0IHRyYWNraW5nIGEgYmxvY2sgZHJhZywgb3IgbnVsbCBpZiBub25lIGlzIGluIHByb2dyZXNzLiAqL1xuICBwcml2YXRlIGJsb2NrRHJhZ2dlcl86IElCbG9ja0RyYWdnZXJ8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBvYmplY3QgdHJhY2tpbmcgYSB3b3Jrc3BhY2Ugb3IgZmx5b3V0IHdvcmtzcGFjZSBkcmFnLCBvciBudWxsIGlmIG5vbmVcbiAgICogaXMgaW4gcHJvZ3Jlc3MuXG4gICAqL1xuICBwcml2YXRlIHdvcmtzcGFjZURyYWdnZXJfOiBXb3Jrc3BhY2VEcmFnZ2VyfG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgZmx5b3V0IGEgZ2VzdHVyZSBzdGFydGVkIGluLCBpZiBhbnkuICovXG4gIHByaXZhdGUgZmx5b3V0XzogSUZseW91dHxudWxsID0gbnVsbDtcblxuICAvKiogQm9vbGVhbiBmb3Igc2FuaXR5LWNoZWNraW5nIHRoYXQgc29tZSBjb2RlIGlzIG9ubHkgY2FsbGVkIG9uY2UuICovXG4gIHByaXZhdGUgY2FsbGVkVXBkYXRlSXNEcmFnZ2luZ18gPSBmYWxzZTtcblxuICAvKiogQm9vbGVhbiBmb3Igc2FuaXR5LWNoZWNraW5nIHRoYXQgc29tZSBjb2RlIGlzIG9ubHkgY2FsbGVkIG9uY2UuICovXG4gIHByaXZhdGUgaGFzU3RhcnRlZF8gPSBmYWxzZTtcblxuICAvKiogQm9vbGVhbiB1c2VkIGludGVybmFsbHkgdG8gYnJlYWsgYSBjeWNsZSBpbiBkaXNwb3NhbC4gKi9cbiAgcHJvdGVjdGVkIGlzRW5kaW5nXyA9IGZhbHNlO1xuICBwcml2YXRlIGhlYWxTdGFja186IGJvb2xlYW47XG5cbiAgLyoqIFRoZSBldmVudCB0aGF0IG1vc3QgcmVjZW50bHkgdXBkYXRlZCB0aGlzIGdlc3R1cmUuICovXG4gIHByaXZhdGUgbW9zdFJlY2VudEV2ZW50XzogUG9pbnRlckV2ZW50O1xuXG4gIC8qKiBCb29sZWFuIGZvciB3aGV0aGVyIG9yIG5vdCB0aGlzIGdlc3R1cmUgaXMgYSBtdWx0aS10b3VjaCBnZXN0dXJlLiAqL1xuICBwcml2YXRlIGlzTXVsdGlUb3VjaF8gPSBmYWxzZTtcblxuICAvKiogQSBtYXAgb2YgY2FjaGVkIHBvaW50cyB1c2VkIGZvciB0cmFja2luZyBtdWx0aS10b3VjaCBnZXN0dXJlcy4gKi9cbiAgcHJpdmF0ZSBjYWNoZWRQb2ludHMgPSBuZXcgTWFwPHN0cmluZywgQ29vcmRpbmF0ZXxudWxsPigpO1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHRoZSByYXRpbyBiZXR3ZWVuIHRoZSBzdGFydGluZyBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0b3VjaCBwb2ludHNcbiAgICogYW5kIHRoZSBtb3N0IHJlY2VudCBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0b3VjaCBwb2ludHMuXG4gICAqIFNjYWxlcyBiZXR3ZWVuIDAgYW5kIDEgbWVhbiB0aGUgbW9zdCByZWNlbnQgem9vbSB3YXMgYSB6b29tIG91dC5cbiAgICogU2NhbGVzIGFib3ZlIDEuMCBtZWFuIHRoZSBtb3N0IHJlY2VudCB6b29tIHdhcyBhIHpvb20gaW4uXG4gICAqL1xuICBwcml2YXRlIHByZXZpb3VzU2NhbGVfID0gMDtcblxuICAvKiogVGhlIHN0YXJ0aW5nIGRpc3RhbmNlIGJldHdlZW4gdHdvIHRvdWNoIHBvaW50cy4gKi9cbiAgcHJpdmF0ZSBzdGFydERpc3RhbmNlXyA9IDA7XG5cbiAgLyoqXG4gICAqIEEgaGFuZGxlIHRvIHVzZSB0byB1bmJpbmQgdGhlIHNlY29uZCBwb2ludGVyZG93biBsaXN0ZW5lclxuICAgKiBhdCB0aGUgZW5kIG9mIGEgZHJhZy5cbiAgICogT3BhcXVlIGRhdGEgcmV0dXJuZWQgZnJvbSBCbG9ja2x5LmJpbmRFdmVudFdpdGhDaGVja3NfLlxuICAgKi9cbiAgcHJpdmF0ZSBvblN0YXJ0V3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogQm9vbGVhbiBmb3Igd2hldGhlciBvciBub3QgdGhlIHdvcmtzcGFjZSBzdXBwb3J0cyBwaW5jaC16b29tLiAqL1xuICBwcml2YXRlIGlzUGluY2hab29tRW5hYmxlZF86IGJvb2xlYW58bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBvd25lciBvZiB0aGUgZHJvcGRvd25EaXYgd2hlbiB0aGlzIGdlc3R1cmUgZmlyc3Qgc3RhcnRzLlxuICAgKiBOZWVkZWQgYmVjYXVzZSB3ZSdsbCBjbG9zZSB0aGUgZHJvcGRvd24gYmVmb3JlIGZpZWxkcyBnZXQgdG9cbiAgICogYWN0IG9uIHRoZWlyIGV2ZW50cywgYW5kIHNvbWUgZmllbGRzIGNhcmUgYWJvdXQgd2hvIG93bnNcbiAgICogdGhlIGRyb3Bkb3duLlxuICAgKi9cbiAgY3VycmVudERyb3Bkb3duT3duZXI6IEZpZWxkfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gZSBUaGUgZXZlbnQgdGhhdCBraWNrZWQgb2ZmIHRoaXMgZ2VzdHVyZS5cbiAgICogQHBhcmFtIGNyZWF0b3JXb3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0aGF0IGNyZWF0ZWQgdGhpcyBnZXN0dXJlIGFuZCBoYXMgYVxuICAgKiAgICAgcmVmZXJlbmNlIHRvIGl0LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBlOiBQb2ludGVyRXZlbnQsIHByaXZhdGUgcmVhZG9ubHkgY3JlYXRvcldvcmtzcGFjZTogV29ya3NwYWNlU3ZnKSB7XG4gICAgdGhpcy5tb3N0UmVjZW50RXZlbnRfID0gZTtcblxuICAgIC8qKlxuICAgICAqIEhvdyBmYXIgdGhlIHBvaW50ZXIgaGFzIG1vdmVkIGR1cmluZyB0aGlzIGRyYWcsIGluIHBpeGVsIHVuaXRzLlxuICAgICAqICgwLCAwKSBpcyBhdCB0aGlzLm1vdXNlRG93blhZXy5cbiAgICAgKi9cbiAgICB0aGlzLmN1cnJlbnREcmFnRGVsdGFYWV8gPSBuZXcgQ29vcmRpbmF0ZSgwLCAwKTtcblxuICAgIC8qKlxuICAgICAqIEJvb2xlYW4gdXNlZCB0byBpbmRpY2F0ZSB3aGV0aGVyIG9yIG5vdCB0byBoZWFsIHRoZSBzdGFjayBhZnRlclxuICAgICAqIGRpc2Nvbm5lY3RpbmcgYSBibG9jay5cbiAgICAgKi9cbiAgICB0aGlzLmhlYWxTdGFja18gPSAhaW50ZXJuYWxDb25zdGFudHMuRFJBR19TVEFDSztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXZlciBhbGwgbGlua3MgZnJvbSB0aGlzIG9iamVjdC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBkaXNwb3NlKCkge1xuICAgIFRvdWNoLmNsZWFyVG91Y2hJZGVudGlmaWVyKCk7XG4gICAgVG9vbHRpcC51bmJsb2NrKCk7XG4gICAgLy8gQ2xlYXIgdGhlIG93bmVyJ3MgcmVmZXJlbmNlIHRvIHRoaXMgZ2VzdHVyZS5cbiAgICB0aGlzLmNyZWF0b3JXb3Jrc3BhY2UuY2xlYXJHZXN0dXJlKCk7XG5cbiAgICBpZiAodGhpcy5vbk1vdmVXcmFwcGVyXykge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbk1vdmVXcmFwcGVyXyk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uVXBXcmFwcGVyXykge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vblVwV3JhcHBlcl8pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmJsb2NrRHJhZ2dlcl8pIHtcbiAgICAgIHRoaXMuYmxvY2tEcmFnZ2VyXy5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLndvcmtzcGFjZURyYWdnZXJfKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZURyYWdnZXJfLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vblN0YXJ0V3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25TdGFydFdyYXBwZXJfKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGludGVybmFsIHN0YXRlIGJhc2VkIG9uIGFuIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZSBUaGUgbW9zdCByZWNlbnQgcG9pbnRlciBldmVudC5cbiAgICovXG4gIHByaXZhdGUgdXBkYXRlRnJvbUV2ZW50XyhlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBjb25zdCBjdXJyZW50WFkgPSBuZXcgQ29vcmRpbmF0ZShlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgY29uc3QgY2hhbmdlZCA9IHRoaXMudXBkYXRlRHJhZ0RlbHRhXyhjdXJyZW50WFkpO1xuICAgIC8vIEV4Y2VlZGVkIHRoZSBkcmFnIHJhZGl1cyBmb3IgdGhlIGZpcnN0IHRpbWUuXG4gICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlSXNEcmFnZ2luZ18oKTtcbiAgICAgIFRvdWNoLmxvbmdTdG9wKCk7XG4gICAgfVxuICAgIHRoaXMubW9zdFJlY2VudEV2ZW50XyA9IGU7XG4gIH1cblxuICAvKipcbiAgICogRE8gTUFUSCB0byBzZXQgY3VycmVudERyYWdEZWx0YVhZXyBiYXNlZCBvbiB0aGUgbW9zdCByZWNlbnQgcG9pbnRlclxuICAgKiBwb3NpdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGN1cnJlbnRYWSBUaGUgbW9zdCByZWNlbnQgcG9pbnRlciBwb3NpdGlvbiwgaW4gcGl4ZWwgdW5pdHMsXG4gICAqICAgICB3aXRoICgwLCAwKSBhdCB0aGUgd2luZG93J3MgdG9wIGxlZnQgY29ybmVyLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBkcmFnIGp1c3QgZXhjZWVkZWQgdGhlIGRyYWcgcmFkaXVzIGZvciB0aGUgZmlyc3QgdGltZS5cbiAgICovXG4gIHByaXZhdGUgdXBkYXRlRHJhZ0RlbHRhXyhjdXJyZW50WFk6IENvb3JkaW5hdGUpOiBib29sZWFuIHtcbiAgICB0aGlzLmN1cnJlbnREcmFnRGVsdGFYWV8gPVxuICAgICAgICBDb29yZGluYXRlLmRpZmZlcmVuY2UoY3VycmVudFhZLCAodGhpcy5tb3VzZURvd25YWV8pKTtcblxuICAgIGlmICghdGhpcy5oYXNFeGNlZWRlZERyYWdSYWRpdXNfKSB7XG4gICAgICBjb25zdCBjdXJyZW50RHJhZ0RlbHRhID0gQ29vcmRpbmF0ZS5tYWduaXR1ZGUodGhpcy5jdXJyZW50RHJhZ0RlbHRhWFlfKTtcblxuICAgICAgLy8gVGhlIGZseW91dCBoYXMgYSBkaWZmZXJlbnQgZHJhZyByYWRpdXMgZnJvbSB0aGUgcmVzdCBvZiBCbG9ja2x5LlxuICAgICAgY29uc3QgbGltaXRSYWRpdXMgPVxuICAgICAgICAgIHRoaXMuZmx5b3V0XyA/IGNvbmZpZy5mbHlvdXREcmFnUmFkaXVzIDogY29uZmlnLmRyYWdSYWRpdXM7XG5cbiAgICAgIHRoaXMuaGFzRXhjZWVkZWREcmFnUmFkaXVzXyA9IGN1cnJlbnREcmFnRGVsdGEgPiBsaW1pdFJhZGl1cztcbiAgICAgIHJldHVybiB0aGlzLmhhc0V4Y2VlZGVkRHJhZ1JhZGl1c187XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhpcyBnZXN0dXJlIHRvIHJlY29yZCB3aGV0aGVyIGEgYmxvY2sgaXMgYmVpbmcgZHJhZ2dlZCBmcm9tIHRoZVxuICAgKiBmbHlvdXQuXG4gICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBvbiBhIHBvaW50ZXJtb3ZlIGV2ZW50IHRoZSBmaXJzdCB0aW1lXG4gICAqIHRoZSBkcmFnIHJhZGl1cyBpcyBleGNlZWRlZC4gIEl0IHNob3VsZCBiZSBjYWxsZWQgbm8gbW9yZSB0aGFuIG9uY2UgcGVyXG4gICAqIGdlc3R1cmUuIElmIGEgYmxvY2sgc2hvdWxkIGJlIGRyYWdnZWQgZnJvbSB0aGUgZmx5b3V0IHRoaXMgZnVuY3Rpb24gY3JlYXRlc1xuICAgKiB0aGUgbmV3IGJsb2NrIG9uIHRoZSBtYWluIHdvcmtzcGFjZSBhbmQgdXBkYXRlcyB0YXJnZXRCbG9ja18gYW5kXG4gICAqIHN0YXJ0V29ya3NwYWNlXy5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBhIGJsb2NrIGlzIGJlaW5nIGRyYWdnZWQgZnJvbSB0aGUgZmx5b3V0LlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVJc0RyYWdnaW5nRnJvbUZseW91dF8oKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLnRhcmdldEJsb2NrXyB8fFxuICAgICAgICAhdGhpcy5mbHlvdXRfPy5pc0Jsb2NrQ3JlYXRhYmxlKHRoaXMudGFyZ2V0QmxvY2tfKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuZmx5b3V0Xy50YXJnZXRXb3Jrc3BhY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHVwZGF0ZSBkcmFnZ2luZyBmcm9tIHRoZSBmbHlvdXQgYmVjYXVzZSB0aGUgJyArXG4gICAgICAgICAgJ2ZseW91dCdzIHRhcmdldCB3b3Jrc3BhY2UgaXMgdW5kZWZpbmVkYCk7XG4gICAgfVxuICAgIGlmICghdGhpcy5mbHlvdXRfLmlzU2Nyb2xsYWJsZSgpIHx8XG4gICAgICAgIHRoaXMuZmx5b3V0Xy5pc0RyYWdUb3dhcmRXb3Jrc3BhY2UodGhpcy5jdXJyZW50RHJhZ0RlbHRhWFlfKSkge1xuICAgICAgdGhpcy5zdGFydFdvcmtzcGFjZV8gPSB0aGlzLmZseW91dF8udGFyZ2V0V29ya3NwYWNlO1xuICAgICAgdGhpcy5zdGFydFdvcmtzcGFjZV8udXBkYXRlU2NyZWVuQ2FsY3VsYXRpb25zSWZTY3JvbGxlZCgpO1xuICAgICAgLy8gU3RhcnQgdGhlIGV2ZW50IGdyb3VwIG5vdywgc28gdGhhdCB0aGUgc2FtZSBldmVudCBncm91cCBpcyB1c2VkIGZvclxuICAgICAgLy8gYmxvY2sgY3JlYXRpb24gYW5kIGJsb2NrIGRyYWdnaW5nLlxuICAgICAgaWYgKCFldmVudFV0aWxzLmdldEdyb3VwKCkpIHtcbiAgICAgICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgICAgIH1cbiAgICAgIC8vIFRoZSBzdGFydCBibG9jayBpcyBubyBsb25nZXIgcmVsZXZhbnQsIGJlY2F1c2UgdGhpcyBpcyBhIGRyYWcuXG4gICAgICB0aGlzLnN0YXJ0QmxvY2tfID0gbnVsbDtcbiAgICAgIHRoaXMudGFyZ2V0QmxvY2tfID0gdGhpcy5mbHlvdXRfLmNyZWF0ZUJsb2NrKHRoaXMudGFyZ2V0QmxvY2tfKTtcbiAgICAgIHRoaXMudGFyZ2V0QmxvY2tfLnNlbGVjdCgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhpcyBnZXN0dXJlIHRvIHJlY29yZCB3aGV0aGVyIGEgYnViYmxlIGlzIGJlaW5nIGRyYWdnZWQuXG4gICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBvbiBhIHBvaW50ZXJtb3ZlIGV2ZW50IHRoZSBmaXJzdCB0aW1lXG4gICAqIHRoZSBkcmFnIHJhZGl1cyBpcyBleGNlZWRlZC4gIEl0IHNob3VsZCBiZSBjYWxsZWQgbm8gbW9yZSB0aGFuIG9uY2UgcGVyXG4gICAqIGdlc3R1cmUuIElmIGEgYnViYmxlIHNob3VsZCBiZSBkcmFnZ2VkIHRoaXMgZnVuY3Rpb24gY3JlYXRlcyB0aGUgbmVjZXNzYXJ5XG4gICAqIEJ1YmJsZURyYWdnZXIgYW5kIHN0YXJ0cyB0aGUgZHJhZy5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBhIGJ1YmJsZSBpcyBiZWluZyBkcmFnZ2VkLlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVJc0RyYWdnaW5nQnViYmxlXygpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuc3RhcnRCdWJibGVfKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5zdGFydERyYWdnaW5nQnViYmxlXygpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdG8gc3RhcnQgYSBibG9jayBkcmFnLiBJZiBhIGJsb2NrIHNob3VsZCBiZSBkcmFnZ2VkLCBlaXRoZXJcbiAgICogZnJvbSB0aGUgZmx5b3V0IG9yIGluIHRoZSB3b3Jrc3BhY2UsIGNyZWF0ZSB0aGUgbmVjZXNzYXJ5IEJsb2NrRHJhZ2dlciBhbmRcbiAgICogc3RhcnQgdGhlIGRyYWcuXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBvbiBhIHBvaW50ZXJtb3ZlIGV2ZW50IHRoZSBmaXJzdCB0aW1lXG4gICAqIHRoZSBkcmFnIHJhZGl1cyBpcyBleGNlZWRlZC4gIEl0IHNob3VsZCBiZSBjYWxsZWQgbm8gbW9yZSB0aGFuIG9uY2UgcGVyXG4gICAqIGdlc3R1cmUuIElmIGEgYmxvY2sgc2hvdWxkIGJlIGRyYWdnZWQsIGVpdGhlciBmcm9tIHRoZSBmbHlvdXQgb3IgaW4gdGhlXG4gICAqIHdvcmtzcGFjZSwgdGhpcyBmdW5jdGlvbiBjcmVhdGVzIHRoZSBuZWNlc3NhcnkgQmxvY2tEcmFnZ2VyIGFuZCBzdGFydHMgdGhlXG4gICAqIGRyYWcuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgYSBibG9jayBpcyBiZWluZyBkcmFnZ2VkLlxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVJc0RyYWdnaW5nQmxvY2tfKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy50YXJnZXRCbG9ja18pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZmx5b3V0Xykge1xuICAgICAgaWYgKHRoaXMudXBkYXRlSXNEcmFnZ2luZ0Zyb21GbHlvdXRfKCkpIHtcbiAgICAgICAgdGhpcy5zdGFydERyYWdnaW5nQmxvY2tfKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy50YXJnZXRCbG9ja18uaXNNb3ZhYmxlKCkpIHtcbiAgICAgIHRoaXMuc3RhcnREcmFnZ2luZ0Jsb2NrXygpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRvIHN0YXJ0IGEgd29ya3NwYWNlIGRyYWcuIElmIGEgd29ya3NwYWNlIGlzIGJlaW5nIGRyYWdnZWQsXG4gICAqIGNyZWF0ZSB0aGUgbmVjZXNzYXJ5IFdvcmtzcGFjZURyYWdnZXIgYW5kIHN0YXJ0IHRoZSBkcmFnLlxuICAgKlxuICAgKiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBjYWxsZWQgb24gYSBwb2ludGVybW92ZSBldmVudCB0aGUgZmlyc3QgdGltZVxuICAgKiB0aGUgZHJhZyByYWRpdXMgaXMgZXhjZWVkZWQuICBJdCBzaG91bGQgYmUgY2FsbGVkIG5vIG1vcmUgdGhhbiBvbmNlIHBlclxuICAgKiBnZXN0dXJlLiBJZiBhIHdvcmtzcGFjZSBpcyBiZWluZyBkcmFnZ2VkIHRoaXMgZnVuY3Rpb24gY3JlYXRlcyB0aGVcbiAgICogbmVjZXNzYXJ5IFdvcmtzcGFjZURyYWdnZXIgYW5kIHN0YXJ0cyB0aGUgZHJhZy5cbiAgICovXG4gIHByaXZhdGUgdXBkYXRlSXNEcmFnZ2luZ1dvcmtzcGFjZV8oKSB7XG4gICAgaWYgKCF0aGlzLnN0YXJ0V29ya3NwYWNlXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgdXBkYXRlIGRyYWdnaW5nIHRoZSB3b3Jrc3BhY2UgYmVjYXVzZSB0aGUgJyArXG4gICAgICAgICAgJ3N0YXJ0IHdvcmtzcGFjZSBpcyB1bmRlZmluZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCB3c01vdmFibGUgPSB0aGlzLmZseW91dF8gP1xuICAgICAgICB0aGlzLmZseW91dF8uaXNTY3JvbGxhYmxlKCkgOlxuICAgICAgICB0aGlzLnN0YXJ0V29ya3NwYWNlXyAmJiB0aGlzLnN0YXJ0V29ya3NwYWNlXy5pc0RyYWdnYWJsZSgpO1xuICAgIGlmICghd3NNb3ZhYmxlKSByZXR1cm47XG5cbiAgICB0aGlzLndvcmtzcGFjZURyYWdnZXJfID0gbmV3IFdvcmtzcGFjZURyYWdnZXIodGhpcy5zdGFydFdvcmtzcGFjZV8pO1xuXG4gICAgdGhpcy53b3Jrc3BhY2VEcmFnZ2VyXy5zdGFydERyYWcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhpcyBnZXN0dXJlIHRvIHJlY29yZCB3aGV0aGVyIGFueXRoaW5nIGlzIGJlaW5nIGRyYWdnZWQuXG4gICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBvbiBhIHBvaW50ZXJtb3ZlIGV2ZW50IHRoZSBmaXJzdCB0aW1lXG4gICAqIHRoZSBkcmFnIHJhZGl1cyBpcyBleGNlZWRlZC4gIEl0IHNob3VsZCBiZSBjYWxsZWQgbm8gbW9yZSB0aGFuIG9uY2UgcGVyXG4gICAqIGdlc3R1cmUuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZUlzRHJhZ2dpbmdfKCkge1xuICAgIC8vIFNhbml0eSBjaGVjay5cbiAgICBpZiAodGhpcy5jYWxsZWRVcGRhdGVJc0RyYWdnaW5nXykge1xuICAgICAgdGhyb3cgRXJyb3IoJ3VwZGF0ZUlzRHJhZ2dpbmdfIHNob3VsZCBvbmx5IGJlIGNhbGxlZCBvbmNlIHBlciBnZXN0dXJlLicpO1xuICAgIH1cbiAgICB0aGlzLmNhbGxlZFVwZGF0ZUlzRHJhZ2dpbmdfID0gdHJ1ZTtcblxuICAgIC8vIEZpcnN0IGNoZWNrIGlmIGl0IHdhcyBhIGJ1YmJsZSBkcmFnLiAgQnViYmxlcyBhbHdheXMgc2l0IG9uIHRvcCBvZlxuICAgIC8vIGJsb2Nrcy5cbiAgICBpZiAodGhpcy51cGRhdGVJc0RyYWdnaW5nQnViYmxlXygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFRoZW4gY2hlY2sgaWYgaXQgd2FzIGEgYmxvY2sgZHJhZy5cbiAgICBpZiAodGhpcy51cGRhdGVJc0RyYWdnaW5nQmxvY2tfKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gVGhlbiBjaGVjayBpZiBpdCdzIGEgd29ya3NwYWNlIGRyYWcuXG4gICAgdGhpcy51cGRhdGVJc0RyYWdnaW5nV29ya3NwYWNlXygpO1xuICB9XG5cbiAgLyoqIENyZWF0ZSBhIGJsb2NrIGRyYWdnZXIgYW5kIHN0YXJ0IGRyYWdnaW5nIHRoZSBzZWxlY3RlZCBibG9jay4gKi9cbiAgcHJpdmF0ZSBzdGFydERyYWdnaW5nQmxvY2tfKCkge1xuICAgIGNvbnN0IEJsb2NrRHJhZ2dlckNsYXNzID0gcmVnaXN0cnkuZ2V0Q2xhc3NGcm9tT3B0aW9ucyhcbiAgICAgICAgcmVnaXN0cnkuVHlwZS5CTE9DS19EUkFHR0VSLCB0aGlzLmNyZWF0b3JXb3Jrc3BhY2Uub3B0aW9ucywgdHJ1ZSk7XG5cbiAgICB0aGlzLmJsb2NrRHJhZ2dlcl8gPVxuICAgICAgICBuZXcgQmxvY2tEcmFnZ2VyQ2xhc3MhKCh0aGlzLnRhcmdldEJsb2NrXyksICh0aGlzLnN0YXJ0V29ya3NwYWNlXykpO1xuICAgIHRoaXMuYmxvY2tEcmFnZ2VyXyEuc3RhcnREcmFnKHRoaXMuY3VycmVudERyYWdEZWx0YVhZXywgdGhpcy5oZWFsU3RhY2tfKTtcbiAgICB0aGlzLmJsb2NrRHJhZ2dlcl8hLmRyYWcodGhpcy5tb3N0UmVjZW50RXZlbnRfLCB0aGlzLmN1cnJlbnREcmFnRGVsdGFYWV8pO1xuICB9XG5cbiAgLy8gVE9ETyAoZmVuaWNoZWwpOiBQb3NzaWJseSBjb21iaW5lIHRoaXMgYW5kIHN0YXJ0RHJhZ2dpbmdCbG9ja18uXG4gIC8qKiBDcmVhdGUgYSBidWJibGUgZHJhZ2dlciBhbmQgc3RhcnQgZHJhZ2dpbmcgdGhlIHNlbGVjdGVkIGJ1YmJsZS4gKi9cbiAgcHJpdmF0ZSBzdGFydERyYWdnaW5nQnViYmxlXygpIHtcbiAgICBpZiAoIXRoaXMuc3RhcnRCdWJibGVfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCB1cGRhdGUgZHJhZ2dpbmcgdGhlIGJ1YmJsZSBiZWNhdXNlIHRoZSBzdGFydCAnICtcbiAgICAgICAgICAnYnViYmxlIGlzIHVuZGVmaW5lZCcpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc3RhcnRXb3Jrc3BhY2VfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCB1cGRhdGUgZHJhZ2dpbmcgdGhlIGJ1YmJsZSBiZWNhdXNlIHRoZSBzdGFydCAnICtcbiAgICAgICAgICAnd29ya3NwYWNlIGlzIHVuZGVmaW5lZCcpO1xuICAgIH1cblxuICAgIHRoaXMuYnViYmxlRHJhZ2dlcl8gPVxuICAgICAgICBuZXcgQnViYmxlRHJhZ2dlcih0aGlzLnN0YXJ0QnViYmxlXywgdGhpcy5zdGFydFdvcmtzcGFjZV8pO1xuICAgIHRoaXMuYnViYmxlRHJhZ2dlcl8uc3RhcnRCdWJibGVEcmFnKCk7XG4gICAgdGhpcy5idWJibGVEcmFnZ2VyXy5kcmFnQnViYmxlKFxuICAgICAgICB0aGlzLm1vc3RSZWNlbnRFdmVudF8sIHRoaXMuY3VycmVudERyYWdEZWx0YVhZXyk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgYSBnZXN0dXJlOiB1cGRhdGUgdGhlIHdvcmtzcGFjZSB0byBpbmRpY2F0ZSB0aGF0IGEgZ2VzdHVyZSBpcyBpblxuICAgKiBwcm9ncmVzcyBhbmQgYmluZCBwb2ludGVybW92ZSBhbmQgcG9pbnRlcnVwIGhhbmRsZXJzLlxuICAgKlxuICAgKiBAcGFyYW0gZSBBIHBvaW50ZXJkb3duIGV2ZW50LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRvU3RhcnQoZTogUG9pbnRlckV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLnN0YXJ0V29ya3NwYWNlXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3Qgc3RhcnQgdGhlIHRvdWNoIGdlc3R1cmUgYmVjYXVhc2UgdGhlIHN0YXJ0ICcgK1xuICAgICAgICAgICd3b3Jrc3BhY2UgaXMgdW5kZWZpbmVkJyk7XG4gICAgfVxuICAgIHRoaXMuaXNQaW5jaFpvb21FbmFibGVkXyA9IHRoaXMuc3RhcnRXb3Jrc3BhY2VfLm9wdGlvbnMuem9vbU9wdGlvbnMgJiZcbiAgICAgICAgdGhpcy5zdGFydFdvcmtzcGFjZV8ub3B0aW9ucy56b29tT3B0aW9ucy5waW5jaDtcblxuICAgIGlmIChicm93c2VyRXZlbnRzLmlzVGFyZ2V0SW5wdXQoZSkpIHtcbiAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5oYXNTdGFydGVkXyA9IHRydWU7XG5cbiAgICBibG9ja0FuaW1hdGlvbnMuZGlzY29ubmVjdFVpU3RvcCgpO1xuXG4gICAgdGhpcy5zdGFydFdvcmtzcGFjZV8udXBkYXRlU2NyZWVuQ2FsY3VsYXRpb25zSWZTY3JvbGxlZCgpO1xuICAgIGlmICh0aGlzLnN0YXJ0V29ya3NwYWNlXy5pc011dGF0b3IpIHtcbiAgICAgIC8vIE11dGF0b3IncyBjb29yZGluYXRlIHN5c3RlbSBjb3VsZCBiZSBvdXQgb2YgZGF0ZSBiZWNhdXNlIHRoZSBidWJibGUgd2FzXG4gICAgICAvLyBkcmFnZ2VkLCB0aGUgYmxvY2sgd2FzIG1vdmVkLCB0aGUgcGFyZW50IHdvcmtzcGFjZSB6b29tZWQsIGV0Yy5cbiAgICAgIHRoaXMuc3RhcnRXb3Jrc3BhY2VfLnJlc2l6ZSgpO1xuICAgIH1cblxuICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZmllbGQgb3ducyB0aGUgZHJvcGRvd24gYmVmb3JlIHdlIGNsb3NlIGl0LlxuICAgIHRoaXMuY3VycmVudERyb3Bkb3duT3duZXIgPSBkcm9wRG93bkRpdi5nZXRPd25lcigpO1xuICAgIC8vIEhpZGUgY2hhZmYgYWxzbyBoaWRlcyB0aGUgZmx5b3V0LCBzbyBkb24ndCBkbyBpdCBpZiB0aGUgY2xpY2sgaXMgaW4gYVxuICAgIC8vIGZseW91dC5cbiAgICB0aGlzLnN0YXJ0V29ya3NwYWNlXy5oaWRlQ2hhZmYoISF0aGlzLmZseW91dF8pO1xuXG4gICAgdGhpcy5zdGFydFdvcmtzcGFjZV8ubWFya0ZvY3VzZWQoKTtcbiAgICB0aGlzLm1vc3RSZWNlbnRFdmVudF8gPSBlO1xuXG4gICAgVG9vbHRpcC5ibG9jaygpO1xuXG4gICAgaWYgKHRoaXMudGFyZ2V0QmxvY2tfKSB7XG4gICAgICB0aGlzLnRhcmdldEJsb2NrXy5zZWxlY3QoKTtcbiAgICB9XG5cbiAgICBpZiAoYnJvd3NlckV2ZW50cy5pc1JpZ2h0QnV0dG9uKGUpKSB7XG4gICAgICB0aGlzLmhhbmRsZVJpZ2h0Q2xpY2soZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGUudHlwZS50b0xvd2VyQ2FzZSgpID09PSAncG9pbnRlcmRvd24nICYmIGUucG9pbnRlclR5cGUgIT09ICdtb3VzZScpIHtcbiAgICAgIFRvdWNoLmxvbmdTdGFydChlLCB0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLm1vdXNlRG93blhZXyA9IG5ldyBDb29yZGluYXRlKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICB0aGlzLmhlYWxTdGFja18gPSBlLmFsdEtleSB8fCBlLmN0cmxLZXkgfHwgZS5tZXRhS2V5O1xuXG4gICAgdGhpcy5iaW5kTW91c2VFdmVudHMoZSk7XG5cbiAgICBpZiAoIXRoaXMuaXNFbmRpbmdfKSB7XG4gICAgICB0aGlzLmhhbmRsZVRvdWNoU3RhcnQoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJpbmQgZ2VzdHVyZSBldmVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEgcG9pbnRlcmRvd24gZXZlbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYmluZE1vdXNlRXZlbnRzKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIHRoaXMub25TdGFydFdyYXBwZXJfID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIGRvY3VtZW50LCAncG9pbnRlcmRvd24nLCBudWxsLCB0aGlzLmhhbmRsZVN0YXJ0LmJpbmQodGhpcyksXG4gICAgICAgIC8qIG9wdF9ub0NhcHR1cmVJZGVudGlmaWVyICovIHRydWUpO1xuICAgIHRoaXMub25Nb3ZlV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgZG9jdW1lbnQsICdwb2ludGVybW92ZScsIG51bGwsIHRoaXMuaGFuZGxlTW92ZS5iaW5kKHRoaXMpLFxuICAgICAgICAvKiBvcHRfbm9DYXB0dXJlSWRlbnRpZmllciAqLyB0cnVlKTtcbiAgICB0aGlzLm9uVXBXcmFwcGVyXyA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBkb2N1bWVudCwgJ3BvaW50ZXJ1cCcsIG51bGwsIHRoaXMuaGFuZGxlVXAuYmluZCh0aGlzKSxcbiAgICAgICAgLyogb3B0X25vQ2FwdHVyZUlkZW50aWZpZXIgKi8gdHJ1ZSk7XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVyZG93biBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGUgQSBwb2ludGVyZG93biBldmVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYW5kbGVTdGFydChlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBpZiAodGhpcy5pc0RyYWdnaW5nKCkpIHtcbiAgICAgIC8vIEEgZHJhZyBoYXMgYWxyZWFkeSBzdGFydGVkLCBzbyB0aGlzIGNhbiBubyBsb25nZXIgYmUgYSBwaW5jaC16b29tLlxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZVRvdWNoU3RhcnQoZSk7XG5cbiAgICBpZiAodGhpcy5pc011bHRpVG91Y2goKSkge1xuICAgICAgVG91Y2gubG9uZ1N0b3AoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcm1vdmUgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEgcG9pbnRlcm1vdmUgZXZlbnQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGFuZGxlTW92ZShlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBpZiAoKHRoaXMuaXNEcmFnZ2luZygpICYmIFRvdWNoLnNob3VsZEhhbmRsZUV2ZW50KGUpKSB8fFxuICAgICAgICAhdGhpcy5pc011bHRpVG91Y2goKSkge1xuICAgICAgdGhpcy51cGRhdGVGcm9tRXZlbnRfKGUpO1xuICAgICAgaWYgKHRoaXMud29ya3NwYWNlRHJhZ2dlcl8pIHtcbiAgICAgICAgdGhpcy53b3Jrc3BhY2VEcmFnZ2VyXy5kcmFnKHRoaXMuY3VycmVudERyYWdEZWx0YVhZXyk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuYmxvY2tEcmFnZ2VyXykge1xuICAgICAgICB0aGlzLmJsb2NrRHJhZ2dlcl8uZHJhZyhcbiAgICAgICAgICAgIHRoaXMubW9zdFJlY2VudEV2ZW50XywgdGhpcy5jdXJyZW50RHJhZ0RlbHRhWFlfKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5idWJibGVEcmFnZ2VyXykge1xuICAgICAgICB0aGlzLmJ1YmJsZURyYWdnZXJfLmRyYWdCdWJibGUoXG4gICAgICAgICAgICB0aGlzLm1vc3RSZWNlbnRFdmVudF8sIHRoaXMuY3VycmVudERyYWdEZWx0YVhZXyk7XG4gICAgICB9XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc011bHRpVG91Y2goKSkge1xuICAgICAgdGhpcy5oYW5kbGVUb3VjaE1vdmUoZSk7XG4gICAgICBUb3VjaC5sb25nU3RvcCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVydXAgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEgcG9pbnRlcnVwIGV2ZW50LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhbmRsZVVwKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGlmICghdGhpcy5pc0RyYWdnaW5nKCkpIHtcbiAgICAgIHRoaXMuaGFuZGxlVG91Y2hFbmQoZSk7XG4gICAgfVxuICAgIGlmICghdGhpcy5pc011bHRpVG91Y2goKSB8fCB0aGlzLmlzRHJhZ2dpbmcoKSkge1xuICAgICAgaWYgKCFUb3VjaC5zaG91bGRIYW5kbGVFdmVudChlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVwZGF0ZUZyb21FdmVudF8oZSk7XG4gICAgICBUb3VjaC5sb25nU3RvcCgpO1xuXG4gICAgICBpZiAodGhpcy5pc0VuZGluZ18pIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1RyeWluZyB0byBlbmQgYSBnZXN0dXJlIHJlY3Vyc2l2ZWx5LicpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmlzRW5kaW5nXyA9IHRydWU7XG4gICAgICAvLyBUaGUgb3JkZXJpbmcgb2YgdGhlc2UgY2hlY2tzIGlzIGltcG9ydGFudDogZHJhZ3MgaGF2ZSBoaWdoZXIgcHJpb3JpdHlcbiAgICAgIC8vIHRoYW4gY2xpY2tzLiAgRmllbGRzIGhhdmUgaGlnaGVyIHByaW9yaXR5IHRoYW4gYmxvY2tzOyBibG9ja3MgaGF2ZVxuICAgICAgLy8gaGlnaGVyIHByaW9yaXR5IHRoYW4gd29ya3NwYWNlcy4gVGhlIG9yZGVyaW5nIHdpdGhpbiBkcmFncyBkb2VzIG5vdFxuICAgICAgLy8gbWF0dGVyLCBiZWNhdXNlIHRoZSB0aHJlZSB0eXBlcyBvZiBkcmFnZ2luZyBhcmUgZXhjbHVzaXZlLlxuICAgICAgaWYgKHRoaXMuYnViYmxlRHJhZ2dlcl8pIHtcbiAgICAgICAgdGhpcy5idWJibGVEcmFnZ2VyXy5lbmRCdWJibGVEcmFnKGUsIHRoaXMuY3VycmVudERyYWdEZWx0YVhZXyk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuYmxvY2tEcmFnZ2VyXykge1xuICAgICAgICB0aGlzLmJsb2NrRHJhZ2dlcl8uZW5kRHJhZyhlLCB0aGlzLmN1cnJlbnREcmFnRGVsdGFYWV8pO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLndvcmtzcGFjZURyYWdnZXJfKSB7XG4gICAgICAgIHRoaXMud29ya3NwYWNlRHJhZ2dlcl8uZW5kRHJhZyh0aGlzLmN1cnJlbnREcmFnRGVsdGFYWV8pO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzQnViYmxlQ2xpY2tfKCkpIHtcbiAgICAgICAgLy8gQnViYmxlcyBhcmUgaW4gZnJvbnQgb2YgYWxsIGZpZWxkcyBhbmQgYmxvY2tzLlxuICAgICAgICB0aGlzLmRvQnViYmxlQ2xpY2tfKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNGaWVsZENsaWNrXygpKSB7XG4gICAgICAgIHRoaXMuZG9GaWVsZENsaWNrXygpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzQmxvY2tDbGlja18oKSkge1xuICAgICAgICB0aGlzLmRvQmxvY2tDbGlja18oKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1dvcmtzcGFjZUNsaWNrXygpKSB7XG4gICAgICAgIHRoaXMuZG9Xb3Jrc3BhY2VDbGlja18oZSk7XG4gICAgICB9XG5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIHRoaXMuZGlzcG9zZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcmRvd24gZXZlbnQgYW5kIGtlZXAgdHJhY2sgb2YgY3VycmVudFxuICAgKiBwb2ludGVycy5cbiAgICpcbiAgICogQHBhcmFtIGUgQSBwb2ludGVyZG93biBldmVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYW5kbGVUb3VjaFN0YXJ0KGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGNvbnN0IHBvaW50ZXJJZCA9IFRvdWNoLmdldFRvdWNoSWRlbnRpZmllckZyb21FdmVudChlKTtcbiAgICAvLyBzdG9yZSB0aGUgcG9pbnRlcklkIGluIHRoZSBjdXJyZW50IGxpc3Qgb2YgcG9pbnRlcnNcbiAgICB0aGlzLmNhY2hlZFBvaW50cy5zZXQocG9pbnRlcklkLCB0aGlzLmdldFRvdWNoUG9pbnQoZSkpO1xuICAgIGNvbnN0IHBvaW50ZXJzID0gQXJyYXkuZnJvbSh0aGlzLmNhY2hlZFBvaW50cy5rZXlzKCkpO1xuICAgIC8vIElmIHR3byBwb2ludGVycyBhcmUgZG93biwgc3RvcmUgaW5mb1xuICAgIGlmIChwb2ludGVycy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGNvbnN0IHBvaW50MCA9ICh0aGlzLmNhY2hlZFBvaW50cy5nZXQocG9pbnRlcnNbMF0pKSE7XG4gICAgICBjb25zdCBwb2ludDEgPSAodGhpcy5jYWNoZWRQb2ludHMuZ2V0KHBvaW50ZXJzWzFdKSkhO1xuICAgICAgdGhpcy5zdGFydERpc3RhbmNlXyA9IENvb3JkaW5hdGUuZGlzdGFuY2UocG9pbnQwLCBwb2ludDEpO1xuICAgICAgdGhpcy5pc011bHRpVG91Y2hfID0gdHJ1ZTtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcm1vdmUgZXZlbnQgYW5kIHpvb20gaW4vb3V0IGlmIHR3byBwb2ludGVyc1xuICAgKiBhcmUgb24gdGhlIHNjcmVlbi5cbiAgICpcbiAgICogQHBhcmFtIGUgQSBwb2ludGVybW92ZSBldmVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYW5kbGVUb3VjaE1vdmUoZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3QgcG9pbnRlcklkID0gVG91Y2guZ2V0VG91Y2hJZGVudGlmaWVyRnJvbUV2ZW50KGUpO1xuICAgIC8vIFVwZGF0ZSB0aGUgY2FjaGVcbiAgICB0aGlzLmNhY2hlZFBvaW50cy5zZXQocG9pbnRlcklkLCB0aGlzLmdldFRvdWNoUG9pbnQoZSkpO1xuXG4gICAgaWYgKHRoaXMuaXNQaW5jaFpvb21FbmFibGVkXyAmJiB0aGlzLmNhY2hlZFBvaW50cy5zaXplID09PSAyKSB7XG4gICAgICB0aGlzLmhhbmRsZVBpbmNoXyhlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oYW5kbGVNb3ZlKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgcGluY2ggem9vbSBnZXN0dXJlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBBIHBvaW50ZXJtb3ZlIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVQaW5jaF8oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3QgcG9pbnRlcnMgPSBBcnJheS5mcm9tKHRoaXMuY2FjaGVkUG9pbnRzLmtleXMoKSk7XG4gICAgLy8gQ2FsY3VsYXRlIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gcG9pbnRlcnNcbiAgICBjb25zdCBwb2ludDAgPSAodGhpcy5jYWNoZWRQb2ludHMuZ2V0KHBvaW50ZXJzWzBdKSkhO1xuICAgIGNvbnN0IHBvaW50MSA9ICh0aGlzLmNhY2hlZFBvaW50cy5nZXQocG9pbnRlcnNbMV0pKSE7XG4gICAgY29uc3QgbW92ZURpc3RhbmNlID0gQ29vcmRpbmF0ZS5kaXN0YW5jZShwb2ludDAsIHBvaW50MSk7XG4gICAgY29uc3Qgc2NhbGUgPSBtb3ZlRGlzdGFuY2UgLyB0aGlzLnN0YXJ0RGlzdGFuY2VfO1xuXG4gICAgaWYgKHRoaXMucHJldmlvdXNTY2FsZV8gPiAwICYmIHRoaXMucHJldmlvdXNTY2FsZV8gPCBJbmZpbml0eSkge1xuICAgICAgY29uc3QgZ2VzdHVyZVNjYWxlID0gc2NhbGUgLSB0aGlzLnByZXZpb3VzU2NhbGVfO1xuICAgICAgY29uc3QgZGVsdGEgPSBnZXN0dXJlU2NhbGUgPiAwID8gZ2VzdHVyZVNjYWxlICogWk9PTV9JTl9NVUxUSVBMSUVSIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlc3R1cmVTY2FsZSAqIFpPT01fT1VUX01VTFRJUExJRVI7XG4gICAgICBpZiAoIXRoaXMuc3RhcnRXb3Jrc3BhY2VfKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdDYW5ub3QgaGFuZGxlIGEgcGluY2ggYmVjYXVzZSB0aGUgc3RhcnQgd29ya3NwYWNlICcgK1xuICAgICAgICAgICAgJ2lzIHVuZGVmaW5lZCcpO1xuICAgICAgfVxuICAgICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5zdGFydFdvcmtzcGFjZV87XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGJyb3dzZXJFdmVudHMubW91c2VUb1N2ZyhcbiAgICAgICAgICBlLCB3b3Jrc3BhY2UuZ2V0UGFyZW50U3ZnKCksIHdvcmtzcGFjZS5nZXRJbnZlcnNlU2NyZWVuQ1RNKCkpO1xuICAgICAgd29ya3NwYWNlLnpvb20ocG9zaXRpb24ueCwgcG9zaXRpb24ueSwgZGVsdGEpO1xuICAgIH1cbiAgICB0aGlzLnByZXZpb3VzU2NhbGVfID0gc2NhbGU7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJ1cCBldmVudCBhbmQgZW5kIHRoZSBnZXN0dXJlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBBIHBvaW50ZXJ1cCBldmVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYW5kbGVUb3VjaEVuZChlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBjb25zdCBwb2ludGVySWQgPSBUb3VjaC5nZXRUb3VjaElkZW50aWZpZXJGcm9tRXZlbnQoZSk7XG4gICAgaWYgKHRoaXMuY2FjaGVkUG9pbnRzLmhhcyhwb2ludGVySWQpKSB7XG4gICAgICB0aGlzLmNhY2hlZFBvaW50cy5kZWxldGUocG9pbnRlcklkKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY2FjaGVkUG9pbnRzLnNpemUgPCAyKSB7XG4gICAgICB0aGlzLmNhY2hlZFBvaW50cy5jbGVhcigpO1xuICAgICAgdGhpcy5wcmV2aW91c1NjYWxlXyA9IDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBmdW5jdGlvbiByZXR1cm5pbmcgdGhlIGN1cnJlbnQgdG91Y2ggcG9pbnQgY29vcmRpbmF0ZS5cbiAgICpcbiAgICogQHBhcmFtIGUgQSBwb2ludGVyIGV2ZW50LlxuICAgKiBAcmV0dXJucyBUaGUgY3VycmVudCB0b3VjaCBwb2ludCBjb29yZGluYXRlXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0VG91Y2hQb2ludChlOiBQb2ludGVyRXZlbnQpOiBDb29yZGluYXRlfG51bGwge1xuICAgIGlmICghdGhpcy5zdGFydFdvcmtzcGFjZV8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IENvb3JkaW5hdGUoZS5wYWdlWCwgZS5wYWdlWSk7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGlzIGdlc3R1cmUgaXMgcGFydCBvZiBhIG11bHRpLXRvdWNoIGdlc3R1cmUuXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBnZXN0dXJlIGlzIHBhcnQgb2YgYSBtdWx0aS10b3VjaCBnZXN0dXJlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzTXVsdGlUb3VjaCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc011bHRpVG91Y2hfO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbCBhbiBpbi1wcm9ncmVzcyBnZXN0dXJlLiAgSWYgYSB3b3Jrc3BhY2Ugb3IgYmxvY2sgZHJhZyBpcyBpblxuICAgKiBwcm9ncmVzcywgZW5kIHRoZSBkcmFnIGF0IHRoZSBtb3N0IHJlY2VudCBsb2NhdGlvbi5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjYW5jZWwoKSB7XG4gICAgLy8gRGlzcG9zaW5nIG9mIGEgYmxvY2sgY2FuY2VscyBpbi1wcm9ncmVzcyBkcmFncywgYnV0IGRyYWdnaW5nIHRvIGEgZGVsZXRlXG4gICAgLy8gYXJlYSBkaXNwb3NlcyBvZiBhIGJsb2NrIGFuZCBsZWFkcyB0byByZWN1cnNpdmUgZGlzcG9zYWwuIEJyZWFrIHRoYXRcbiAgICAvLyBjeWNsZS5cbiAgICBpZiAodGhpcy5pc0VuZGluZ18pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVG91Y2gubG9uZ1N0b3AoKTtcbiAgICBpZiAodGhpcy5idWJibGVEcmFnZ2VyXykge1xuICAgICAgdGhpcy5idWJibGVEcmFnZ2VyXy5lbmRCdWJibGVEcmFnKFxuICAgICAgICAgIHRoaXMubW9zdFJlY2VudEV2ZW50XywgdGhpcy5jdXJyZW50RHJhZ0RlbHRhWFlfKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuYmxvY2tEcmFnZ2VyXykge1xuICAgICAgdGhpcy5ibG9ja0RyYWdnZXJfLmVuZERyYWcoXG4gICAgICAgICAgdGhpcy5tb3N0UmVjZW50RXZlbnRfLCB0aGlzLmN1cnJlbnREcmFnRGVsdGFYWV8pO1xuICAgIH0gZWxzZSBpZiAodGhpcy53b3Jrc3BhY2VEcmFnZ2VyXykge1xuICAgICAgdGhpcy53b3Jrc3BhY2VEcmFnZ2VyXy5lbmREcmFnKHRoaXMuY3VycmVudERyYWdEZWx0YVhZXyk7XG4gICAgfVxuICAgIHRoaXMuZGlzcG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHJlYWwgb3IgZmFrZWQgcmlnaHQtY2xpY2sgZXZlbnQgYnkgc2hvd2luZyBhIGNvbnRleHQgbWVudS5cbiAgICpcbiAgICogQHBhcmFtIGUgQSBwb2ludGVyZG93biBldmVudC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYW5kbGVSaWdodENsaWNrKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGlmICh0aGlzLnRhcmdldEJsb2NrXykge1xuICAgICAgdGhpcy5icmluZ0Jsb2NrVG9Gcm9udF8oKTtcbiAgICAgIHRoaXMudGFyZ2V0QmxvY2tfLndvcmtzcGFjZS5oaWRlQ2hhZmYoISF0aGlzLmZseW91dF8pO1xuICAgICAgdGhpcy50YXJnZXRCbG9ja18uc2hvd0NvbnRleHRNZW51KGUpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5zdGFydEJ1YmJsZV8pIHtcbiAgICAgIHRoaXMuc3RhcnRCdWJibGVfLnNob3dDb250ZXh0TWVudShlKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuc3RhcnRXb3Jrc3BhY2VfICYmICF0aGlzLmZseW91dF8pIHtcbiAgICAgIHRoaXMuc3RhcnRXb3Jrc3BhY2VfLmhpZGVDaGFmZigpO1xuICAgICAgdGhpcy5zdGFydFdvcmtzcGFjZV8uc2hvd0NvbnRleHRNZW51KGUpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IEhhbmRsZSByaWdodC1jbGljayBvbiBhIGJ1YmJsZS5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIHRoaXMuZGlzcG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJkb3duIGV2ZW50IG9uIGEgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gZSBBIHBvaW50ZXJkb3duIGV2ZW50LlxuICAgKiBAcGFyYW0gd3MgVGhlIHdvcmtzcGFjZSB0aGUgZXZlbnQgaGl0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhbmRsZVdzU3RhcnQoZTogUG9pbnRlckV2ZW50LCB3czogV29ya3NwYWNlU3ZnKSB7XG4gICAgaWYgKHRoaXMuaGFzU3RhcnRlZF8pIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdUcmllZCB0byBjYWxsIGdlc3R1cmUuaGFuZGxlV3NTdGFydCwgJyArXG4gICAgICAgICAgJ2J1dCB0aGUgZ2VzdHVyZSBoYWQgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQuJyk7XG4gICAgfVxuICAgIHRoaXMuc2V0U3RhcnRXb3Jrc3BhY2VfKHdzKTtcbiAgICB0aGlzLm1vc3RSZWNlbnRFdmVudF8gPSBlO1xuICAgIHRoaXMuZG9TdGFydChlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaXJlcyBhIHdvcmtzcGFjZSBjbGljayBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIHdzIFRoZSB3b3Jrc3BhY2UgdGhhdCBhIHVzZXIgY2xpY2tzIG9uLlxuICAgKi9cbiAgcHJpdmF0ZSBmaXJlV29ya3NwYWNlQ2xpY2tfKHdzOiBXb3Jrc3BhY2VTdmcpIHtcbiAgICBldmVudFV0aWxzLmZpcmUoXG4gICAgICAgIG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5DTElDSykpKG51bGwsIHdzLmlkLCAnd29ya3NwYWNlJykpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBhIHBvaW50ZXJkb3duIGV2ZW50IG9uIGEgZmx5b3V0LlxuICAgKlxuICAgKiBAcGFyYW0gZSBBIHBvaW50ZXJkb3duIGV2ZW50LlxuICAgKiBAcGFyYW0gZmx5b3V0IFRoZSBmbHlvdXQgdGhlIGV2ZW50IGhpdC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYW5kbGVGbHlvdXRTdGFydChlOiBQb2ludGVyRXZlbnQsIGZseW91dDogSUZseW91dCkge1xuICAgIGlmICh0aGlzLmhhc1N0YXJ0ZWRfKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnVHJpZWQgdG8gY2FsbCBnZXN0dXJlLmhhbmRsZUZseW91dFN0YXJ0LCAnICtcbiAgICAgICAgICAnYnV0IHRoZSBnZXN0dXJlIGhhZCBhbHJlYWR5IGJlZW4gc3RhcnRlZC4nKTtcbiAgICB9XG4gICAgdGhpcy5zZXRTdGFydEZseW91dF8oZmx5b3V0KTtcbiAgICB0aGlzLmhhbmRsZVdzU3RhcnQoZSwgZmx5b3V0LmdldFdvcmtzcGFjZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBwb2ludGVyZG93biBldmVudCBvbiBhIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gZSBBIHBvaW50ZXJkb3duIGV2ZW50LlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRoZSBldmVudCBoaXQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGFuZGxlQmxvY2tTdGFydChlOiBQb2ludGVyRXZlbnQsIGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIGlmICh0aGlzLmhhc1N0YXJ0ZWRfKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnVHJpZWQgdG8gY2FsbCBnZXN0dXJlLmhhbmRsZUJsb2NrU3RhcnQsICcgK1xuICAgICAgICAgICdidXQgdGhlIGdlc3R1cmUgaGFkIGFscmVhZHkgYmVlbiBzdGFydGVkLicpO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXJ0QmxvY2soYmxvY2spO1xuICAgIHRoaXMubW9zdFJlY2VudEV2ZW50XyA9IGU7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcmRvd24gZXZlbnQgb24gYSBidWJibGUuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEgcG9pbnRlcmRvd24gZXZlbnQuXG4gICAqIEBwYXJhbSBidWJibGUgVGhlIGJ1YmJsZSB0aGUgZXZlbnQgaGl0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhbmRsZUJ1YmJsZVN0YXJ0KGU6IFBvaW50ZXJFdmVudCwgYnViYmxlOiBJQnViYmxlKSB7XG4gICAgaWYgKHRoaXMuaGFzU3RhcnRlZF8pIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdUcmllZCB0byBjYWxsIGdlc3R1cmUuaGFuZGxlQnViYmxlU3RhcnQsICcgK1xuICAgICAgICAgICdidXQgdGhlIGdlc3R1cmUgaGFkIGFscmVhZHkgYmVlbiBzdGFydGVkLicpO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXJ0QnViYmxlKGJ1YmJsZSk7XG4gICAgdGhpcy5tb3N0UmVjZW50RXZlbnRfID0gZTtcbiAgfVxuXG4gIC8qIEJlZ2luIGZ1bmN0aW9ucyBkZWZpbmluZyB3aGF0IGFjdGlvbnMgdG8gdGFrZSB0byBleGVjdXRlIGNsaWNrcyBvbiBlYWNoXG4gICAqIHR5cGUgb2YgdGFyZ2V0LiAgQW55IGRldmVsb3BlciB3YW50aW5nIHRvIGFkZCBiZWhhdmlvdXIgb24gY2xpY2tzIHNob3VsZFxuICAgKiBtb2RpZnkgb25seSB0aGlzIGNvZGUuICovXG5cbiAgLyoqIEV4ZWN1dGUgYSBidWJibGUgY2xpY2suICovXG4gIHByaXZhdGUgZG9CdWJibGVDbGlja18oKSB7XG4gICAgLy8gVE9ETyAoIzE2NzMpOiBDb25zaXN0ZW50IGhhbmRsaW5nIG9mIHNpbmdsZSBjbGlja3MuXG4gICAgaWYgKHRoaXMuc3RhcnRCdWJibGVfIGluc3RhbmNlb2YgV29ya3NwYWNlQ29tbWVudFN2Zykge1xuICAgICAgdGhpcy5zdGFydEJ1YmJsZV8uc2V0Rm9jdXMoKTtcbiAgICAgIHRoaXMuc3RhcnRCdWJibGVfLnNlbGVjdCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBFeGVjdXRlIGEgZmllbGQgY2xpY2suICovXG4gIHByaXZhdGUgZG9GaWVsZENsaWNrXygpIHtcbiAgICBpZiAoIXRoaXMuc3RhcnRGaWVsZF8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IGRvIGEgZmllbGQgY2xpY2sgYmVjYXVzZSB0aGUgc3RhcnQgZmllbGQgaXMgJyArXG4gICAgICAgICAgJ3VuZGVmaW5lZCcpO1xuICAgIH1cblxuICAgIC8vIE9ubHkgc2hvdyB0aGUgZWRpdG9yIGlmIHRoZSBmaWVsZCdzIGVkaXRvciB3YXNuJ3QgYWxyZWFkeSBvcGVuXG4gICAgLy8gcmlnaHQgYmVmb3JlIHRoaXMgZ2VzdHVyZSBzdGFydGVkLlxuICAgIGNvbnN0IGRyb3Bkb3duQWxyZWFkeU9wZW4gPSB0aGlzLmN1cnJlbnREcm9wZG93bk93bmVyID09PSB0aGlzLnN0YXJ0RmllbGRfO1xuICAgIGlmICghZHJvcGRvd25BbHJlYWR5T3Blbikge1xuICAgICAgdGhpcy5zdGFydEZpZWxkXy5zaG93RWRpdG9yKHRoaXMubW9zdFJlY2VudEV2ZW50Xyk7XG4gICAgfVxuICAgIHRoaXMuYnJpbmdCbG9ja1RvRnJvbnRfKCk7XG4gIH1cblxuICAvKiogRXhlY3V0ZSBhIGJsb2NrIGNsaWNrLiAqL1xuICBwcml2YXRlIGRvQmxvY2tDbGlja18oKSB7XG4gICAgLy8gQmxvY2sgY2xpY2sgaW4gYW4gYXV0b2Nsb3NpbmcgZmx5b3V0LlxuICAgIGlmICh0aGlzLmZseW91dF8gJiYgdGhpcy5mbHlvdXRfLmF1dG9DbG9zZSkge1xuICAgICAgaWYgKCF0aGlzLnRhcmdldEJsb2NrXykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnQ2Fubm90IGRvIGEgYmxvY2sgY2xpY2sgYmVjYXVzZSB0aGUgdGFyZ2V0IGJsb2NrIGlzICcgK1xuICAgICAgICAgICAgJ3VuZGVmaW5lZCcpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMudGFyZ2V0QmxvY2tfLmlzRW5hYmxlZCgpKSB7XG4gICAgICAgIGlmICghZXZlbnRVdGlscy5nZXRHcm91cCgpKSB7XG4gICAgICAgICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdCbG9jayA9IHRoaXMuZmx5b3V0Xy5jcmVhdGVCbG9jayh0aGlzLnRhcmdldEJsb2NrXyk7XG4gICAgICAgIG5ld0Jsb2NrLnNjaGVkdWxlU25hcEFuZEJ1bXAoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCF0aGlzLnN0YXJ0V29ya3NwYWNlXykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnQ2Fubm90IGRvIGEgYmxvY2sgY2xpY2sgYmVjYXVzZSB0aGUgc3RhcnQgd29ya3NwYWNlICcgK1xuICAgICAgICAgICAgJ2lzIHVuZGVmaW5lZCcpO1xuICAgICAgfVxuICAgICAgLy8gQ2xpY2tzIGV2ZW50cyBhcmUgb24gdGhlIHN0YXJ0IGJsb2NrLCBldmVuIGlmIGl0IHdhcyBhIHNoYWRvdy5cbiAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkNMSUNLKSkoXG4gICAgICAgICAgdGhpcy5zdGFydEJsb2NrXywgdGhpcy5zdGFydFdvcmtzcGFjZV8uaWQsICdibG9jaycpO1xuICAgICAgZXZlbnRVdGlscy5maXJlKGV2ZW50KTtcbiAgICB9XG4gICAgdGhpcy5icmluZ0Jsb2NrVG9Gcm9udF8oKTtcbiAgICBldmVudFV0aWxzLnNldEdyb3VwKGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGEgd29ya3NwYWNlIGNsaWNrLiBXaGVuIGluIGFjY2Vzc2liaWxpdHkgbW9kZSBzaGlmdCBjbGlja2luZyB3aWxsXG4gICAqIG1vdmUgdGhlIGN1cnNvci5cbiAgICpcbiAgICogQHBhcmFtIF9lIEEgcG9pbnRlcnVwIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBkb1dvcmtzcGFjZUNsaWNrXyhfZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3Qgd3MgPSB0aGlzLmNyZWF0b3JXb3Jrc3BhY2U7XG4gICAgaWYgKGNvbW1vbi5nZXRTZWxlY3RlZCgpKSB7XG4gICAgICBjb21tb24uZ2V0U2VsZWN0ZWQoKSEudW5zZWxlY3QoKTtcbiAgICB9XG4gICAgdGhpcy5maXJlV29ya3NwYWNlQ2xpY2tfKHRoaXMuc3RhcnRXb3Jrc3BhY2VfIHx8IHdzKTtcbiAgfVxuXG4gIC8qIEVuZCBmdW5jdGlvbnMgZGVmaW5pbmcgd2hhdCBhY3Rpb25zIHRvIHRha2UgdG8gZXhlY3V0ZSBjbGlja3Mgb24gZWFjaCB0eXBlXG4gICAqIG9mIHRhcmdldC4gKi9cblxuICAvLyBUT0RPIChmZW5pY2hlbCk6IE1vdmUgYnViYmxlcyB0byB0aGUgZnJvbnQuXG5cbiAgLyoqXG4gICAqIE1vdmUgdGhlIGRyYWdnZWQvY2xpY2tlZCBibG9jayB0byB0aGUgZnJvbnQgb2YgdGhlIHdvcmtzcGFjZSBzbyB0aGF0IGl0IGlzXG4gICAqIG5vdCBvY2NsdWRlZCBieSBvdGhlciBibG9ja3MuXG4gICAqL1xuICBwcml2YXRlIGJyaW5nQmxvY2tUb0Zyb250XygpIHtcbiAgICAvLyBCbG9ja3MgaW4gdGhlIGZseW91dCBkb24ndCBvdmVybGFwLCBzbyBza2lwIHRoZSB3b3JrLlxuICAgIGlmICh0aGlzLnRhcmdldEJsb2NrXyAmJiAhdGhpcy5mbHlvdXRfKSB7XG4gICAgICB0aGlzLnRhcmdldEJsb2NrXy5icmluZ1RvRnJvbnQoKTtcbiAgICB9XG4gIH1cblxuICAvKiBCZWdpbiBmdW5jdGlvbnMgZm9yIHBvcHVsYXRpbmcgYSBnZXN0dXJlIGF0IHBvaW50ZXJkb3duLiAqL1xuXG4gIC8qKlxuICAgKiBSZWNvcmQgdGhlIGZpZWxkIHRoYXQgYSBnZXN0dXJlIHN0YXJ0ZWQgb24uXG4gICAqXG4gICAqIEBwYXJhbSBmaWVsZCBUaGUgZmllbGQgdGhlIGdlc3R1cmUgc3RhcnRlZCBvbi5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRTdGFydEZpZWxkKGZpZWxkOiBGaWVsZCkge1xuICAgIGlmICh0aGlzLmhhc1N0YXJ0ZWRfKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnVHJpZWQgdG8gY2FsbCBnZXN0dXJlLnNldFN0YXJ0RmllbGQsICcgK1xuICAgICAgICAgICdidXQgdGhlIGdlc3R1cmUgaGFkIGFscmVhZHkgYmVlbiBzdGFydGVkLicpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc3RhcnRGaWVsZF8pIHtcbiAgICAgIHRoaXMuc3RhcnRGaWVsZF8gPSBmaWVsZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIHRoZSBidWJibGUgdGhhdCBhIGdlc3R1cmUgc3RhcnRlZCBvblxuICAgKlxuICAgKiBAcGFyYW0gYnViYmxlIFRoZSBidWJibGUgdGhlIGdlc3R1cmUgc3RhcnRlZCBvbi5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRTdGFydEJ1YmJsZShidWJibGU6IElCdWJibGUpIHtcbiAgICBpZiAoIXRoaXMuc3RhcnRCdWJibGVfKSB7XG4gICAgICB0aGlzLnN0YXJ0QnViYmxlXyA9IGJ1YmJsZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIHRoZSBibG9jayB0aGF0IGEgZ2VzdHVyZSBzdGFydGVkIG9uLCBhbmQgc2V0IHRoZSB0YXJnZXQgYmxvY2tcbiAgICogYXBwcm9wcmlhdGVseS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0aGUgZ2VzdHVyZSBzdGFydGVkIG9uLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldFN0YXJ0QmxvY2soYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgLy8gSWYgdGhlIGdlc3R1cmUgYWxyZWFkeSB3ZW50IHRocm91Z2ggYSBidWJibGUsIGRvbid0IHNldCB0aGUgc3RhcnQgYmxvY2suXG4gICAgaWYgKCF0aGlzLnN0YXJ0QmxvY2tfICYmICF0aGlzLnN0YXJ0QnViYmxlXykge1xuICAgICAgdGhpcy5zdGFydEJsb2NrXyA9IGJsb2NrO1xuICAgICAgaWYgKGJsb2NrLmlzSW5GbHlvdXQgJiYgYmxvY2sgIT09IGJsb2NrLmdldFJvb3RCbG9jaygpKSB7XG4gICAgICAgIHRoaXMuc2V0VGFyZ2V0QmxvY2tfKGJsb2NrLmdldFJvb3RCbG9jaygpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0VGFyZ2V0QmxvY2tfKGJsb2NrKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIHRoZSBibG9jayB0aGF0IGEgZ2VzdHVyZSB0YXJnZXRzLCBtZWFuaW5nIHRoZSBibG9jayB0aGF0IHdpbGwgYmVcbiAgICogZHJhZ2dlZCBpZiB0aGlzIHR1cm5zIGludG8gYSBkcmFnLiAgSWYgdGhpcyBibG9jayBpcyBhIHNoYWRvdywgdGhhdCB3aWxsIGJlXG4gICAqIGl0cyBmaXJzdCBub24tc2hhZG93IHBhcmVudC5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0aGUgZ2VzdHVyZSB0YXJnZXRzLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRUYXJnZXRCbG9ja18oYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgaWYgKGJsb2NrLmlzU2hhZG93KCkpIHtcbiAgICAgIC8vIE5vbi1udWxsIGFzc2VydGlvbiBpcyBmaW5lIGIvYyBpdCBpcyBhbiBpbnZhcmlhbnQgdGhhdCBzaGFkb3dzIGFsd2F5c1xuICAgICAgLy8gaGF2ZSBwYXJlbnRzLlxuICAgICAgdGhpcy5zZXRUYXJnZXRCbG9ja18oYmxvY2suZ2V0UGFyZW50KCkhKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50YXJnZXRCbG9ja18gPSBibG9jaztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIHRoZSB3b3Jrc3BhY2UgdGhhdCBhIGdlc3R1cmUgc3RhcnRlZCBvbi5cbiAgICpcbiAgICogQHBhcmFtIHdzIFRoZSB3b3Jrc3BhY2UgdGhlIGdlc3R1cmUgc3RhcnRlZCBvbi5cbiAgICovXG4gIHByaXZhdGUgc2V0U3RhcnRXb3Jrc3BhY2VfKHdzOiBXb3Jrc3BhY2VTdmcpIHtcbiAgICBpZiAoIXRoaXMuc3RhcnRXb3Jrc3BhY2VfKSB7XG4gICAgICB0aGlzLnN0YXJ0V29ya3NwYWNlXyA9IHdzO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmQgdGhlIGZseW91dCB0aGF0IGEgZ2VzdHVyZSBzdGFydGVkIG9uLlxuICAgKlxuICAgKiBAcGFyYW0gZmx5b3V0IFRoZSBmbHlvdXQgdGhlIGdlc3R1cmUgc3RhcnRlZCBvbi5cbiAgICovXG4gIHByaXZhdGUgc2V0U3RhcnRGbHlvdXRfKGZseW91dDogSUZseW91dCkge1xuICAgIGlmICghdGhpcy5mbHlvdXRfKSB7XG4gICAgICB0aGlzLmZseW91dF8gPSBmbHlvdXQ7XG4gICAgfVxuICB9XG5cbiAgLyogRW5kIGZ1bmN0aW9ucyBmb3IgcG9wdWxhdGluZyBhIGdlc3R1cmUgYXQgcG9pbnRlcmRvd24uICovXG5cbiAgLyogQmVnaW4gaGVscGVyIGZ1bmN0aW9ucyBkZWZpbmluZyB0eXBlcyBvZiBjbGlja3MuICBBbnkgZGV2ZWxvcGVyIHdhbnRpbmdcbiAgICogdG8gY2hhbmdlIHRoZSBkZWZpbml0aW9uIG9mIGEgY2xpY2sgc2hvdWxkIG1vZGlmeSBvbmx5IHRoaXMgY29kZS4gKi9cblxuICAvKipcbiAgICogV2hldGhlciB0aGlzIGdlc3R1cmUgaXMgYSBjbGljayBvbiBhIGJ1YmJsZS4gIFRoaXMgc2hvdWxkIG9ubHkgYmUgY2FsbGVkXG4gICAqIHdoZW4gZW5kaW5nIGEgZ2VzdHVyZSAocG9pbnRlcnVwKS5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGlzIGdlc3R1cmUgd2FzIGEgY2xpY2sgb24gYSBidWJibGUuXG4gICAqL1xuICBwcml2YXRlIGlzQnViYmxlQ2xpY2tfKCk6IGJvb2xlYW4ge1xuICAgIC8vIEEgYnViYmxlIGNsaWNrIHN0YXJ0cyBvbiBhIGJ1YmJsZSBhbmQgbmV2ZXIgZXNjYXBlcyB0aGUgZHJhZyByYWRpdXMuXG4gICAgY29uc3QgaGFzU3RhcnRCdWJibGUgPSAhIXRoaXMuc3RhcnRCdWJibGVfO1xuICAgIHJldHVybiBoYXNTdGFydEJ1YmJsZSAmJiAhdGhpcy5oYXNFeGNlZWRlZERyYWdSYWRpdXNfO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhpcyBnZXN0dXJlIGlzIGEgY2xpY2sgb24gYSBibG9jay4gIFRoaXMgc2hvdWxkIG9ubHkgYmUgY2FsbGVkXG4gICAqIHdoZW4gZW5kaW5nIGEgZ2VzdHVyZSAocG9pbnRlcnVwKS5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGlzIGdlc3R1cmUgd2FzIGEgY2xpY2sgb24gYSBibG9jay5cbiAgICovXG4gIHByaXZhdGUgaXNCbG9ja0NsaWNrXygpOiBib29sZWFuIHtcbiAgICAvLyBBIGJsb2NrIGNsaWNrIHN0YXJ0cyBvbiBhIGJsb2NrLCBuZXZlciBlc2NhcGVzIHRoZSBkcmFnIHJhZGl1cywgYW5kIGlzXG4gICAgLy8gbm90IGEgZmllbGQgY2xpY2suXG4gICAgY29uc3QgaGFzU3RhcnRCbG9jayA9ICEhdGhpcy5zdGFydEJsb2NrXztcbiAgICByZXR1cm4gaGFzU3RhcnRCbG9jayAmJiAhdGhpcy5oYXNFeGNlZWRlZERyYWdSYWRpdXNfICYmXG4gICAgICAgICF0aGlzLmlzRmllbGRDbGlja18oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoaXMgZ2VzdHVyZSBpcyBhIGNsaWNrIG9uIGEgZmllbGQuICBUaGlzIHNob3VsZCBvbmx5IGJlIGNhbGxlZFxuICAgKiB3aGVuIGVuZGluZyBhIGdlc3R1cmUgKHBvaW50ZXJ1cCkuXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBnZXN0dXJlIHdhcyBhIGNsaWNrIG9uIGEgZmllbGQuXG4gICAqL1xuICBwcml2YXRlIGlzRmllbGRDbGlja18oKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZmllbGRDbGlja2FibGUgPVxuICAgICAgICB0aGlzLnN0YXJ0RmllbGRfID8gdGhpcy5zdGFydEZpZWxkXy5pc0NsaWNrYWJsZSgpIDogZmFsc2U7XG4gICAgcmV0dXJuIGZpZWxkQ2xpY2thYmxlICYmICF0aGlzLmhhc0V4Y2VlZGVkRHJhZ1JhZGl1c18gJiZcbiAgICAgICAgKCF0aGlzLmZseW91dF8gfHwgIXRoaXMuZmx5b3V0Xy5hdXRvQ2xvc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhpcyBnZXN0dXJlIGlzIGEgY2xpY2sgb24gYSB3b3Jrc3BhY2UuICBUaGlzIHNob3VsZCBvbmx5IGJlIGNhbGxlZFxuICAgKiB3aGVuIGVuZGluZyBhIGdlc3R1cmUgKHBvaW50ZXJ1cCkuXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBnZXN0dXJlIHdhcyBhIGNsaWNrIG9uIGEgd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSBpc1dvcmtzcGFjZUNsaWNrXygpOiBib29sZWFuIHtcbiAgICBjb25zdCBvbmx5VG91Y2hlZFdvcmtzcGFjZSA9XG4gICAgICAgICF0aGlzLnN0YXJ0QmxvY2tfICYmICF0aGlzLnN0YXJ0QnViYmxlXyAmJiAhdGhpcy5zdGFydEZpZWxkXztcbiAgICByZXR1cm4gb25seVRvdWNoZWRXb3Jrc3BhY2UgJiYgIXRoaXMuaGFzRXhjZWVkZWREcmFnUmFkaXVzXztcbiAgfVxuXG4gIC8qIEVuZCBoZWxwZXIgZnVuY3Rpb25zIGRlZmluaW5nIHR5cGVzIG9mIGNsaWNrcy4gKi9cblxuICAvKipcbiAgICogV2hldGhlciB0aGlzIGdlc3R1cmUgaXMgYSBkcmFnIG9mIGVpdGhlciBhIHdvcmtzcGFjZSBvciBibG9jay5cbiAgICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZXh0ZXJuYWxseSB0byBibG9jayBhY3Rpb25zIHRoYXQgY2Fubm90IGJlIHRha2VuXG4gICAqIG1pZC1kcmFnIChlLmcuIHVzaW5nIHRoZSBrZXlib2FyZCB0byBkZWxldGUgdGhlIHNlbGVjdGVkIGJsb2NrcykuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhpcyBnZXN0dXJlIGlzIGEgZHJhZyBvZiBhIHdvcmtzcGFjZSBvciBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0RyYWdnaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMud29ya3NwYWNlRHJhZ2dlcl8gfHwgISF0aGlzLmJsb2NrRHJhZ2dlcl8gfHxcbiAgICAgICAgISF0aGlzLmJ1YmJsZURyYWdnZXJfO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhpcyBnZXN0dXJlIGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZC4gIEluIHRoZW9yeSBldmVyeSBwb2ludGVyZG93blxuICAgKiBoYXMgYSBjb3JyZXNwb25kaW5nIHBvaW50ZXJ1cCwgYnV0IGluIHJlYWxpdHkgaXQgaXMgcG9zc2libGUgdG8gbG9zZSBhXG4gICAqIHBvaW50ZXJ1cCwgbGVhdmluZyBhbiBpbi1wcm9jZXNzIGdlc3R1cmUgaGFuZ2luZy5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGlzIGdlc3R1cmUgd2FzIGEgY2xpY2sgb24gYSB3b3Jrc3BhY2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGFzU3RhcnRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkXztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIHRoZSBpbnNlcnRpb24gbWFya2VycyB0aGF0IGN1cnJlbnRseSBleGlzdC4gIEJsb2NrIGRyYWdzIGhhdmVcbiAgICogMCwgMSwgb3IgMiBpbnNlcnRpb24gbWFya2Vycy5cbiAgICpcbiAgICogQHJldHVybnMgQSBwb3NzaWJseSBlbXB0eSBsaXN0IG9mIGluc2VydGlvbiBtYXJrZXIgYmxvY2tzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldEluc2VydGlvbk1hcmtlcnMoKTogQmxvY2tTdmdbXSB7XG4gICAgaWYgKHRoaXMuYmxvY2tEcmFnZ2VyXykge1xuICAgICAgcmV0dXJuIHRoaXMuYmxvY2tEcmFnZ2VyXy5nZXRJbnNlcnRpb25NYXJrZXJzKCk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50IGRyYWdnZXIgaWYgYW4gaXRlbSBpcyBiZWluZyBkcmFnZ2VkLiBOdWxsIGlmIG5vdGhpbmcgaXNcbiAgICogYmVpbmcgZHJhZ2dlZC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGRyYWdnZXIgdGhhdCBpcyBjdXJyZW50bHkgaW4gdXNlIG9yIG51bGwgaWYgbm8gZHJhZyBpcyBpblxuICAgKiAgICAgcHJvZ3Jlc3MuXG4gICAqL1xuICBnZXRDdXJyZW50RHJhZ2dlcigpOiBXb3Jrc3BhY2VEcmFnZ2VyfEJ1YmJsZURyYWdnZXJ8SUJsb2NrRHJhZ2dlcnxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5ibG9ja0RyYWdnZXJfID8/IHRoaXMud29ya3NwYWNlRHJhZ2dlcl8gPz8gdGhpcy5idWJibGVEcmFnZ2VyXztcbiAgfVxuXG4gIC8qKlxuICAgKiBJcyBhIGRyYWcgb3Igb3RoZXIgZ2VzdHVyZSBjdXJyZW50bHkgaW4gcHJvZ3Jlc3Mgb24gYW55IHdvcmtzcGFjZT9cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBnZXN0dXJlIGlzIG9jY3VycmluZy5cbiAgICovXG4gIHN0YXRpYyBpblByb2dyZXNzKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHdvcmtzcGFjZXMgPSBjb21tb24uZ2V0QWxsV29ya3NwYWNlcygpO1xuICAgIGZvciAobGV0IGkgPSAwLCB3b3Jrc3BhY2U7IHdvcmtzcGFjZSA9IHdvcmtzcGFjZXNbaV07IGkrKykge1xuICAgICAgLy8gTm90IGFjdHVhbGx5IG5lY2Vzc2FyaWx5IGEgV29ya3NwYWNlU3ZnLCBidXQgaXQgZG9lc24ndCBtYXR0ZXIgYi9jXG4gICAgICAvLyB3ZSdyZSBqdXN0IGNoZWNraW5nIGlmIHRoZSBwcm9wZXJ0eSBleGlzdHMuIFRoZW9yZXRpY2FsbHkgd2Ugd291bGRcbiAgICAgIC8vIHdhbnQgdG8gdXNlIGluc3RhbmNlb2YsIGJ1dCB0aGF0IGNhdXNlcyBhIGNpcmN1bGFyIGRlcGVuZGVuY3kuXG4gICAgICBpZiAoKHdvcmtzcGFjZSBhcyBXb3Jrc3BhY2VTdmcpLmN1cnJlbnRHZXN0dXJlXykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVGhlIG5hbWVzcGFjZSB1c2VkIHRvIGtlZXAgdHJhY2sgb2Yga2V5Ym9hcmQgc2hvcnRjdXRzIGFuZCB0aGVcbiAqIGtleSBjb2RlcyB1c2VkIHRvIGV4ZWN1dGUgdGhvc2Ugc2hvcnRjdXRzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LlNob3J0Y3V0UmVnaXN0cnknKTtcblxuaW1wb3J0IHtLZXlDb2Rlc30gZnJvbSAnLi91dGlscy9rZXljb2Rlcy5qcyc7XG5pbXBvcnQgKiBhcyBvYmplY3QgZnJvbSAnLi91dGlscy9vYmplY3QuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIHRoZSByZWdpc3RyeSBvZiBrZXlib2FyZCBzaG9ydGN1dHMuIFRoaXMgaXMgaW50ZW5kZWQgdG8gYmUgYVxuICogc2luZ2xldG9uLiBZb3Ugc2hvdWxkIG5vdCBjcmVhdGUgYSBuZXcgaW5zdGFuY2UsIGFuZCBvbmx5IGFjY2VzcyB0aGlzIGNsYXNzXG4gKiBmcm9tIFNob3J0Y3V0UmVnaXN0cnkucmVnaXN0cnkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuU2hvcnRjdXRSZWdpc3RyeVxuICovXG5leHBvcnQgY2xhc3MgU2hvcnRjdXRSZWdpc3RyeSB7XG4gIHN0YXRpYyByZWFkb25seSByZWdpc3RyeSA9IG5ldyBTaG9ydGN1dFJlZ2lzdHJ5KCk7XG5cbiAgLyoqIFJlZ2lzdHJ5IG9mIGFsbCBrZXlib2FyZCBzaG9ydGN1dHMsIGtleWVkIGJ5IG5hbWUgb2Ygc2hvcnRjdXQuICovXG4gIHByaXZhdGUgc2hvcnRjdXRzID0gbmV3IE1hcDxzdHJpbmcsIEtleWJvYXJkU2hvcnRjdXQ+KCk7XG5cbiAgLyoqIE1hcCBvZiBrZXkgY29kZXMgdG8gYW4gYXJyYXkgb2Ygc2hvcnRjdXQgbmFtZXMuICovXG4gIHByaXZhdGUga2V5TWFwID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZ1tdPigpO1xuXG4gIC8qKiBSZXNldHMgdGhlIGV4aXN0aW5nIFNob3J0Y3V0UmVnaXN0cnkgc2luZ2xldG9uLiAqL1xuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMucmVzZXQoKTtcbiAgfVxuXG4gIC8qKiBDbGVhciBhbmQgcmVjcmVhdGUgdGhlIHJlZ2lzdHJ5IGFuZCBrZXlNYXAuICovXG4gIHJlc2V0KCkge1xuICAgIHRoaXMuc2hvcnRjdXRzLmNsZWFyKCk7XG4gICAgdGhpcy5rZXlNYXAuY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYSBrZXlib2FyZCBzaG9ydGN1dC5cbiAgICpcbiAgICogQHBhcmFtIHNob3J0Y3V0IFRoZSBzaG9ydGN1dCBmb3IgdGhpcyBrZXkgY29kZS5cbiAgICogQHBhcmFtIG9wdF9hbGxvd092ZXJyaWRlcyBUcnVlIHRvIHByZXZlbnQgYSB3YXJuaW5nIHdoZW4gb3ZlcnJpZGluZyBhblxuICAgKiAgICAgYWxyZWFkeSByZWdpc3RlcmVkIGl0ZW0uXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiBhIHNob3J0Y3V0IHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cy5cbiAgICovXG4gIHJlZ2lzdGVyKHNob3J0Y3V0OiBLZXlib2FyZFNob3J0Y3V0LCBvcHRfYWxsb3dPdmVycmlkZXM/OiBib29sZWFuKSB7XG4gICAgY29uc3QgcmVnaXN0ZXJlZFNob3J0Y3V0ID0gdGhpcy5zaG9ydGN1dHMuZ2V0KHNob3J0Y3V0Lm5hbWUpO1xuICAgIGlmIChyZWdpc3RlcmVkU2hvcnRjdXQgJiYgIW9wdF9hbGxvd092ZXJyaWRlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBTaG9ydGN1dCBuYW1lZCBcIiR7c2hvcnRjdXQubmFtZX1cIiBhbHJlYWR5IGV4aXN0cy5gKTtcbiAgICB9XG4gICAgdGhpcy5zaG9ydGN1dHMuc2V0KHNob3J0Y3V0Lm5hbWUsIHNob3J0Y3V0KTtcblxuICAgIGNvbnN0IGtleUNvZGVzID0gc2hvcnRjdXQua2V5Q29kZXM7XG4gICAgaWYgKGtleUNvZGVzICYmIGtleUNvZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5Q29kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy5hZGRLZXlNYXBwaW5nKFxuICAgICAgICAgICAga2V5Q29kZXNbaV0sIHNob3J0Y3V0Lm5hbWUsICEhc2hvcnRjdXQuYWxsb3dDb2xsaXNpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVbnJlZ2lzdGVycyBhIGtleWJvYXJkIHNob3J0Y3V0IHJlZ2lzdGVyZWQgd2l0aCB0aGUgZ2l2ZW4ga2V5IGNvZGUuIFRoaXNcbiAgICogd2lsbCBhbHNvIHJlbW92ZSBhbnkga2V5IG1hcHBpbmdzIHRoYXQgcmVmZXJlbmNlIHRoaXMgc2hvcnRjdXQuXG4gICAqXG4gICAqIEBwYXJhbSBzaG9ydGN1dE5hbWUgVGhlIG5hbWUgb2YgdGhlIHNob3J0Y3V0IHRvIHVucmVnaXN0ZXIuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgYW4gaXRlbSB3YXMgdW5yZWdpc3RlcmVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICB1bnJlZ2lzdGVyKHNob3J0Y3V0TmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgc2hvcnRjdXQgPSB0aGlzLnNob3J0Y3V0cy5nZXQoc2hvcnRjdXROYW1lKTtcblxuICAgIGlmICghc2hvcnRjdXQpIHtcbiAgICAgIGNvbnNvbGUud2FybihgS2V5Ym9hcmQgc2hvcnRjdXQgbmFtZWQgXCIke3Nob3J0Y3V0TmFtZX1cIiBub3QgZm91bmQuYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5yZW1vdmVBbGxLZXlNYXBwaW5ncyhzaG9ydGN1dE5hbWUpO1xuXG4gICAgdGhpcy5zaG9ydGN1dHMuZGVsZXRlKHNob3J0Y3V0TmFtZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIG1hcHBpbmcgYmV0d2VlbiBhIGtleWNvZGUgYW5kIGEga2V5Ym9hcmQgc2hvcnRjdXQuXG4gICAqXG4gICAqIEBwYXJhbSBrZXlDb2RlIFRoZSBrZXkgY29kZSBmb3IgdGhlIGtleWJvYXJkIHNob3J0Y3V0LiBJZiByZWdpc3RlcmluZyBhIGtleVxuICAgKiAgICAgY29kZSB3aXRoIGEgbW9kaWZpZXIgKGV4OiBjdHJsK2MpIHVzZVxuICAgKiAgICAgU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5O1xuICAgKiBAcGFyYW0gc2hvcnRjdXROYW1lIFRoZSBuYW1lIG9mIHRoZSBzaG9ydGN1dCB0byBleGVjdXRlIHdoZW4gdGhlIGdpdmVuXG4gICAqICAgICBrZXljb2RlIGlzIHByZXNzZWQuXG4gICAqIEBwYXJhbSBvcHRfYWxsb3dDb2xsaXNpb24gVHJ1ZSB0byBwcmV2ZW50IGFuIGVycm9yIHdoZW4gYWRkaW5nIGEgc2hvcnRjdXRcbiAgICogICAgIHRvIGEga2V5IHRoYXQgaXMgYWxyZWFkeSBtYXBwZWQgdG8gYSBzaG9ydGN1dC5cbiAgICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSBnaXZlbiBrZXkgY29kZSBpcyBhbHJlYWR5IG1hcHBlZCB0byBhIHNob3J0Y3V0LlxuICAgKi9cbiAgYWRkS2V5TWFwcGluZyhcbiAgICAgIGtleUNvZGU6IHN0cmluZ3xudW1iZXJ8S2V5Q29kZXMsIHNob3J0Y3V0TmFtZTogc3RyaW5nLFxuICAgICAgb3B0X2FsbG93Q29sbGlzaW9uPzogYm9vbGVhbikge1xuICAgIGtleUNvZGUgPSBTdHJpbmcoa2V5Q29kZSk7XG4gICAgY29uc3Qgc2hvcnRjdXROYW1lcyA9IHRoaXMua2V5TWFwLmdldChrZXlDb2RlKTtcbiAgICBpZiAoc2hvcnRjdXROYW1lcyAmJiAhb3B0X2FsbG93Q29sbGlzaW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFNob3J0Y3V0IG5hbWVkIFwiJHtcbiAgICAgICAgICBzaG9ydGN1dE5hbWV9XCIgY29sbGlkZXMgd2l0aCBzaG9ydGN1dHMgXCIke3Nob3J0Y3V0TmFtZXN9XCJgKTtcbiAgICB9IGVsc2UgaWYgKHNob3J0Y3V0TmFtZXMgJiYgb3B0X2FsbG93Q29sbGlzaW9uKSB7XG4gICAgICBzaG9ydGN1dE5hbWVzLnVuc2hpZnQoc2hvcnRjdXROYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5rZXlNYXAuc2V0KGtleUNvZGUsIFtzaG9ydGN1dE5hbWVdKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIG1hcHBpbmcgYmV0d2VlbiBhIGtleWNvZGUgYW5kIGEga2V5Ym9hcmQgc2hvcnRjdXQuXG4gICAqXG4gICAqIEBwYXJhbSBrZXlDb2RlIFRoZSBrZXkgY29kZSBmb3IgdGhlIGtleWJvYXJkIHNob3J0Y3V0LiBJZiByZWdpc3RlcmluZyBhIGtleVxuICAgKiAgICAgY29kZSB3aXRoIGEgbW9kaWZpZXIgKGV4OiBjdHJsK2MpIHVzZVxuICAgKiAgICAgU2hvcnRjdXRSZWdpc3RyeS5yZWdpc3RyeS5jcmVhdGVTZXJpYWxpemVkS2V5O1xuICAgKiBAcGFyYW0gc2hvcnRjdXROYW1lIFRoZSBuYW1lIG9mIHRoZSBzaG9ydGN1dCB0byBleGVjdXRlIHdoZW4gdGhlIGdpdmVuXG4gICAqICAgICBrZXljb2RlIGlzIHByZXNzZWQuXG4gICAqIEBwYXJhbSBvcHRfcXVpZXQgVHJ1ZSB0byBub3QgY29uc29sZSB3YXJuIHdoZW4gdGhlcmUgaXMgbm8gc2hvcnRjdXQgdG9cbiAgICogICAgIHJlbW92ZS5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiBhIGtleSBtYXBwaW5nIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICByZW1vdmVLZXlNYXBwaW5nKGtleUNvZGU6IHN0cmluZywgc2hvcnRjdXROYW1lOiBzdHJpbmcsIG9wdF9xdWlldD86IGJvb2xlYW4pOlxuICAgICAgYm9vbGVhbiB7XG4gICAgY29uc3Qgc2hvcnRjdXROYW1lcyA9IHRoaXMua2V5TWFwLmdldChrZXlDb2RlKTtcblxuICAgIGlmICghc2hvcnRjdXROYW1lcykge1xuICAgICAgaWYgKCFvcHRfcXVpZXQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBObyBrZXlib2FyZCBzaG9ydGN1dCBuYW1lZCBcIiR7XG4gICAgICAgICAgICBzaG9ydGN1dE5hbWV9XCIgcmVnaXN0ZXJlZCB3aXRoIGtleSBjb2RlIFwiJHtrZXlDb2RlfVwiYCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3Qgc2hvcnRjdXRJZHggPSBzaG9ydGN1dE5hbWVzLmluZGV4T2Yoc2hvcnRjdXROYW1lKTtcbiAgICBpZiAoc2hvcnRjdXRJZHggPiAtMSkge1xuICAgICAgc2hvcnRjdXROYW1lcy5zcGxpY2Uoc2hvcnRjdXRJZHgsIDEpO1xuICAgICAgaWYgKHNob3J0Y3V0TmFtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMua2V5TWFwLmRlbGV0ZShrZXlDb2RlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoIW9wdF9xdWlldCkge1xuICAgICAgY29uc29sZS53YXJuKGBObyBrZXlib2FyZCBzaG9ydGN1dCBuYW1lZCBcIiR7XG4gICAgICAgICAgc2hvcnRjdXROYW1lfVwiIHJlZ2lzdGVyZWQgd2l0aCBrZXkgY29kZSBcIiR7a2V5Q29kZX1cImApO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbGwgdGhlIGtleSBtYXBwaW5ncyBmb3IgYSBzaG9ydGN1dCB3aXRoIHRoZSBnaXZlbiBuYW1lLlxuICAgKiBVc2VmdWwgd2hlbiBjaGFuZ2luZyB0aGUgZGVmYXVsdCBrZXkgbWFwcGluZ3MgYW5kIHRoZSBrZXkgY29kZXMgcmVnaXN0ZXJlZFxuICAgKiB0byB0aGUgc2hvcnRjdXQgYXJlIHVua25vd24uXG4gICAqXG4gICAqIEBwYXJhbSBzaG9ydGN1dE5hbWUgVGhlIG5hbWUgb2YgdGhlIHNob3J0Y3V0IHRvIHJlbW92ZSBmcm9tIHRoZSBrZXkgbWFwLlxuICAgKi9cbiAgcmVtb3ZlQWxsS2V5TWFwcGluZ3Moc2hvcnRjdXROYW1lOiBzdHJpbmcpIHtcbiAgICBmb3IgKGNvbnN0IGtleUNvZGUgb2YgdGhpcy5rZXlNYXAua2V5cygpKSB7XG4gICAgICB0aGlzLnJlbW92ZUtleU1hcHBpbmcoa2V5Q29kZSwgc2hvcnRjdXROYW1lLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUga2V5IG1hcC4gU2V0dGluZyB0aGUga2V5IG1hcCB3aWxsIG92ZXJyaWRlIGFueSBkZWZhdWx0IGtleVxuICAgKiBtYXBwaW5ncy5cbiAgICpcbiAgICogQHBhcmFtIG5ld0tleU1hcCBUaGUgb2JqZWN0IHdpdGgga2V5IGNvZGUgdG8gc2hvcnRjdXQgbmFtZXMuXG4gICAqL1xuICBzZXRLZXlNYXAobmV3S2V5TWFwOiB7W2tleTogc3RyaW5nXTogc3RyaW5nW119KSB7XG4gICAgdGhpcy5rZXlNYXAuY2xlYXIoKTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBuZXdLZXlNYXApIHtcbiAgICAgIHRoaXMua2V5TWFwLnNldChrZXksIG5ld0tleU1hcFtrZXldKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY3VycmVudCBrZXkgbWFwLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IGhvbGRpbmcga2V5IGNvZGVzIHRvIFNob3J0Y3V0UmVnaXN0cnkuS2V5Ym9hcmRTaG9ydGN1dC5cbiAgICovXG4gIGdldEtleU1hcCgpOiB7W2tleTogc3RyaW5nXTogc3RyaW5nW119IHtcbiAgICBjb25zdCBsZWdhY3lLZXlNYXA6IHtba2V5OiBzdHJpbmddOiBzdHJpbmdbXX0gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMua2V5TWFwKSB7XG4gICAgICBsZWdhY3lLZXlNYXBba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gbGVnYWN5S2V5TWFwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHJlZ2lzdHJ5IG9mIGtleWJvYXJkIHNob3J0Y3V0cy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHJlZ2lzdHJ5IG9mIGtleWJvYXJkIHNob3J0Y3V0cy5cbiAgICovXG4gIGdldFJlZ2lzdHJ5KCk6IHtba2V5OiBzdHJpbmddOiBLZXlib2FyZFNob3J0Y3V0fSB7XG4gICAgY29uc3QgbGVnYWN5UmVnaXN0cnk6IHtba2V5OiBzdHJpbmddOiBLZXlib2FyZFNob3J0Y3V0fSA9XG4gICAgICAgIE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5zaG9ydGN1dHMpIHtcbiAgICAgIGxlZ2FjeVJlZ2lzdHJ5W2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdC5kZWVwTWVyZ2UoT2JqZWN0LmNyZWF0ZShudWxsKSwgbGVnYWN5UmVnaXN0cnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMga2V5IGRvd24gZXZlbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSBtYWluIHdvcmtzcGFjZSB3aGVyZSB0aGUgZXZlbnQgd2FzIGNhcHR1cmVkLlxuICAgKiBAcGFyYW0gZSBUaGUga2V5IGRvd24gZXZlbnQuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGV2ZW50IHdhcyBoYW5kbGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBvbktleURvd24od29ya3NwYWNlOiBXb3Jrc3BhY2UsIGU6IEtleWJvYXJkRXZlbnQpOiBib29sZWFuIHtcbiAgICBjb25zdCBrZXkgPSB0aGlzLnNlcmlhbGl6ZUtleUV2ZW50XyhlKTtcbiAgICBjb25zdCBzaG9ydGN1dE5hbWVzID0gdGhpcy5nZXRTaG9ydGN1dE5hbWVzQnlLZXlDb2RlKGtleSk7XG4gICAgaWYgKCFzaG9ydGN1dE5hbWVzKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwLCBzaG9ydGN1dE5hbWU7IHNob3J0Y3V0TmFtZSA9IHNob3J0Y3V0TmFtZXNbaV07IGkrKykge1xuICAgICAgY29uc3Qgc2hvcnRjdXQgPSB0aGlzLnNob3J0Y3V0cy5nZXQoc2hvcnRjdXROYW1lKTtcbiAgICAgIGlmICghc2hvcnRjdXQ/LnByZWNvbmRpdGlvbkZuIHx8IHNob3J0Y3V0Py5wcmVjb25kaXRpb25Gbih3b3Jrc3BhY2UpKSB7XG4gICAgICAgIC8vIElmIHRoZSBrZXkgaGFzIGJlZW4gaGFuZGxlZCwgc3RvcCBwcm9jZXNzaW5nIHNob3J0Y3V0cy5cbiAgICAgICAgaWYgKHNob3J0Y3V0Py5jYWxsYmFjayAmJiBzaG9ydGN1dD8uY2FsbGJhY2sod29ya3NwYWNlLCBlLCBzaG9ydGN1dCkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgc2hvcnRjdXRzIHJlZ2lzdGVyZWQgdG8gdGhlIGdpdmVuIGtleSBjb2RlLlxuICAgKlxuICAgKiBAcGFyYW0ga2V5Q29kZSBUaGUgc2VyaWFsaXplZCBrZXkgY29kZS5cbiAgICogQHJldHVybnMgVGhlIGxpc3Qgb2Ygc2hvcnRjdXRzIHRvIGNhbGwgd2hlbiB0aGUgZ2l2ZW4ga2V5Q29kZSBpcyB1c2VkLlxuICAgKiAgICAgVW5kZWZpbmVkIGlmIG5vIHNob3J0Y3V0cyBleGlzdC5cbiAgICovXG4gIGdldFNob3J0Y3V0TmFtZXNCeUtleUNvZGUoa2V5Q29kZTogc3RyaW5nKTogc3RyaW5nW118dW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5rZXlNYXAuZ2V0KGtleUNvZGUpIHx8IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNlcmlhbGl6ZWQga2V5IGNvZGVzIHRoYXQgdGhlIHNob3J0Y3V0IHdpdGggdGhlIGdpdmVuIG5hbWUgaXNcbiAgICogcmVnaXN0ZXJlZCB1bmRlci5cbiAgICpcbiAgICogQHBhcmFtIHNob3J0Y3V0TmFtZSBUaGUgbmFtZSBvZiB0aGUgc2hvcnRjdXQuXG4gICAqIEByZXR1cm5zIEFuIGFycmF5IHdpdGggYWxsIHRoZSBrZXkgY29kZXMgdGhlIHNob3J0Y3V0IGlzIHJlZ2lzdGVyZWQgdW5kZXIuXG4gICAqL1xuICBnZXRLZXlDb2Rlc0J5U2hvcnRjdXROYW1lKHNob3J0Y3V0TmFtZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGtleXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IFtrZXlDb2RlLCBzaG9ydGN1dHNdIG9mIHRoaXMua2V5TWFwKSB7XG4gICAgICBjb25zdCBzaG9ydGN1dElkeCA9IHNob3J0Y3V0cy5pbmRleE9mKHNob3J0Y3V0TmFtZSk7XG4gICAgICBpZiAoc2hvcnRjdXRJZHggPiAtMSkge1xuICAgICAgICBrZXlzLnB1c2goa2V5Q29kZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBrZXlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6ZXMgYSBrZXkgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEga2V5IGRvd24gZXZlbnQuXG4gICAqIEByZXR1cm5zIFRoZSBzZXJpYWxpemVkIGtleSBjb2RlIGZvciB0aGUgZ2l2ZW4gZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIHNlcmlhbGl6ZUtleUV2ZW50XyhlOiBLZXlib2FyZEV2ZW50KTogc3RyaW5nIHtcbiAgICBsZXQgc2VyaWFsaXplZEtleSA9ICcnO1xuICAgIGZvciAoY29uc3QgbW9kaWZpZXIgaW4gU2hvcnRjdXRSZWdpc3RyeS5tb2RpZmllcktleXMpIHtcbiAgICAgIGlmIChlLmdldE1vZGlmaWVyU3RhdGUobW9kaWZpZXIpKSB7XG4gICAgICAgIGlmIChzZXJpYWxpemVkS2V5ICE9PSAnJykge1xuICAgICAgICAgIHNlcmlhbGl6ZWRLZXkgKz0gJysnO1xuICAgICAgICB9XG4gICAgICAgIHNlcmlhbGl6ZWRLZXkgKz0gbW9kaWZpZXI7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzZXJpYWxpemVkS2V5ICE9PSAnJyAmJiBlLmtleUNvZGUpIHtcbiAgICAgIHNlcmlhbGl6ZWRLZXkgPSBzZXJpYWxpemVkS2V5ICsgJysnICsgZS5rZXlDb2RlO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlKSB7XG4gICAgICBzZXJpYWxpemVkS2V5ID0gZS5rZXlDb2RlLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIHJldHVybiBzZXJpYWxpemVkS2V5O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyB3aGV0aGVyIGFueSBvZiB0aGUgZ2l2ZW4gbW9kaWZpZXJzIGFyZSBub3QgdmFsaWQuXG4gICAqXG4gICAqIEBwYXJhbSBtb2RpZmllcnMgTGlzdCBvZiBtb2RpZmllcnMgdG8gYmUgdXNlZCB3aXRoIHRoZSBrZXkuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGUgbW9kaWZpZXIgaXMgbm90IGluIHRoZSB2YWxpZCBtb2RpZmllcnMgbGlzdC5cbiAgICovXG4gIHByaXZhdGUgY2hlY2tNb2RpZmllcnNfKG1vZGlmaWVyczogS2V5Q29kZXNbXSkge1xuICAgIGZvciAobGV0IGkgPSAwLCBtb2RpZmllcjsgbW9kaWZpZXIgPSBtb2RpZmllcnNbaV07IGkrKykge1xuICAgICAgaWYgKCEobW9kaWZpZXIgaW4gU2hvcnRjdXRSZWdpc3RyeS5tb2RpZmllcktleXMpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtb2RpZmllciArICcgaXMgbm90IGEgdmFsaWQgbW9kaWZpZXIga2V5LicpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRoZSBzZXJpYWxpemVkIGtleSBjb2RlIHRoYXQgd2lsbCBiZSB1c2VkIGluIHRoZSBrZXkgbWFwLlxuICAgKlxuICAgKiBAcGFyYW0ga2V5Q29kZSBOdW1iZXIgY29kZSByZXByZXNlbnRpbmcgdGhlIGtleS5cbiAgICogQHBhcmFtIG1vZGlmaWVycyBMaXN0IG9mIG1vZGlmaWVyIGtleSBjb2RlcyB0byBiZSB1c2VkIHdpdGggdGhlIGtleS4gQWxsXG4gICAqICAgICB2YWxpZCBtb2RpZmllcnMgY2FuIGJlIGZvdW5kIGluIHRoZSBTaG9ydGN1dFJlZ2lzdHJ5Lm1vZGlmaWVyS2V5cy5cbiAgICogQHJldHVybnMgVGhlIHNlcmlhbGl6ZWQga2V5IGNvZGUgZm9yIHRoZSBnaXZlbiBtb2RpZmllcnMgYW5kIGtleS5cbiAgICovXG4gIGNyZWF0ZVNlcmlhbGl6ZWRLZXkoa2V5Q29kZTogbnVtYmVyLCBtb2RpZmllcnM6IEtleUNvZGVzW118bnVsbCk6IHN0cmluZyB7XG4gICAgbGV0IHNlcmlhbGl6ZWRLZXkgPSAnJztcblxuICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgIHRoaXMuY2hlY2tNb2RpZmllcnNfKG1vZGlmaWVycyk7XG4gICAgICBmb3IgKGNvbnN0IG1vZGlmaWVyIGluIFNob3J0Y3V0UmVnaXN0cnkubW9kaWZpZXJLZXlzKSB7XG4gICAgICAgIGNvbnN0IG1vZGlmaWVyS2V5Q29kZSA9XG4gICAgICAgICAgICAoU2hvcnRjdXRSZWdpc3RyeS5tb2RpZmllcktleXMgYXMgQW55RHVyaW5nTWlncmF0aW9uKVttb2RpZmllcl07XG4gICAgICAgIGlmIChtb2RpZmllcnMuaW5kZXhPZihtb2RpZmllcktleUNvZGUpID4gLTEpIHtcbiAgICAgICAgICBpZiAoc2VyaWFsaXplZEtleSAhPT0gJycpIHtcbiAgICAgICAgICAgIHNlcmlhbGl6ZWRLZXkgKz0gJysnO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZXJpYWxpemVkS2V5ICs9IG1vZGlmaWVyO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHNlcmlhbGl6ZWRLZXkgIT09ICcnICYmIGtleUNvZGUpIHtcbiAgICAgIHNlcmlhbGl6ZWRLZXkgPSBzZXJpYWxpemVkS2V5ICsgJysnICsga2V5Q29kZTtcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUpIHtcbiAgICAgIHNlcmlhbGl6ZWRLZXkgPSBrZXlDb2RlLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIHJldHVybiBzZXJpYWxpemVkS2V5O1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgU2hvcnRjdXRSZWdpc3RyeSB7XG4gIGV4cG9ydCBpbnRlcmZhY2UgS2V5Ym9hcmRTaG9ydGN1dCB7XG4gICAgY2FsbGJhY2s/OiAoKHAxOiBXb3Jrc3BhY2UsIHAyOiBFdmVudCwgcDM6IEtleWJvYXJkU2hvcnRjdXQpID0+IGJvb2xlYW4pO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwcmVjb25kaXRpb25Gbj86ICgocDE6IFdvcmtzcGFjZSkgPT4gYm9vbGVhbik7XG4gICAgbWV0YWRhdGE/OiBvYmplY3Q7XG4gICAga2V5Q29kZXM/OiAobnVtYmVyfHN0cmluZylbXTtcbiAgICBhbGxvd0NvbGxpc2lvbj86IGJvb2xlYW47XG4gIH1cblxuICAvKiogU3VwcG9ydGVkIG1vZGlmaWVycy4gKi9cbiAgZXhwb3J0IGVudW0gbW9kaWZpZXJLZXlzIHtcbiAgICBTaGlmdCA9IEtleUNvZGVzLlNISUZULFxuICAgIENvbnRyb2wgPSBLZXlDb2Rlcy5DVFJMLFxuICAgIEFsdCA9IEtleUNvZGVzLkFMVCxcbiAgICBNZXRhID0gS2V5Q29kZXMuTUVUQSxcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBLZXlib2FyZFNob3J0Y3V0ID0gU2hvcnRjdXRSZWdpc3RyeS5LZXlib2FyZFNob3J0Y3V0O1xuLy8gTm8gbmVlZCB0byBleHBvcnQgU2hvcmN1dFJlZ2lzdHJ5Lm1vZGlmaWVyS2V5cyBmcm9tIHRoZSBtb2R1bGUgYXQgdGhpcyB0aW1lXG4vLyBiZWNhdXNlICgxKSBpdCB3YXNuJ3QgYXV0b21hdGljYWxseSBjb252ZXJ0ZWQgYnkgdGhlIGF1dG9tYXRpYyBtaWdyYXRpb25cbi8vIHNjcmlwdCwgKDIpIHRoZSBuYW1lIGRvZXNuJ3QgZm9sbG93IHRoZSBzdHlsZWd1aWRlLlxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEV2ZW50cyBmaXJlZCBhcyBhIHJlc3VsdCBvZiBhIHRoZW1lIHVwZGF0ZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuVGhlbWVDaGFuZ2UnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHtBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB0aGVtZSBjaGFuZ2UgZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLlRoZW1lQ2hhbmdlXG4gKi9cbmV4cG9ydCBjbGFzcyBUaGVtZUNoYW5nZSBleHRlbmRzIFVpQmFzZSB7XG4gIHRoZW1lTmFtZT86IHN0cmluZztcbiAgb3ZlcnJpZGUgdHlwZSA9IGV2ZW50VXRpbHMuVEhFTUVfQ0hBTkdFO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X3RoZW1lTmFtZSBUaGUgdGhlbWUgbmFtZS4gVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X3dvcmtzcGFjZUlkIFRoZSB3b3Jrc3BhY2UgaWRlbnRpZmllciBmb3IgdGhpcyBldmVudC5cbiAgICogICAgZXZlbnQuIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKG9wdF90aGVtZU5hbWU/OiBzdHJpbmcsIG9wdF93b3Jrc3BhY2VJZD86IHN0cmluZykge1xuICAgIHN1cGVyKG9wdF93b3Jrc3BhY2VJZCk7XG5cbiAgICAvKiogVGhlIHRoZW1lIG5hbWUuICovXG4gICAgdGhpcy50aGVtZU5hbWUgPSBvcHRfdGhlbWVOYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBUaGVtZUNoYW5nZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBUaGVtZUNoYW5nZUpzb247XG4gICAgaWYgKCF0aGlzLnRoZW1lTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgdGhlbWUgbmFtZSBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgdGhlbWUgbmFtZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ3RoZW1lTmFtZSddID0gdGhpcy50aGVtZU5hbWU7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogVGhlbWVDaGFuZ2VKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLlRoZW1lQ2hhbmdlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMudGhlbWVOYW1lID0ganNvblsndGhlbWVOYW1lJ107XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIFRoZW1lQ2hhbmdlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0XG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mXG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogVGhlbWVDaGFuZ2VKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgVGhlbWVDaGFuZ2Uge1xuICAgIGNvbnN0IG5ld0V2ZW50ID1cbiAgICAgICAgc3VwZXIuZnJvbUpzb24oanNvbiwgd29ya3NwYWNlLCBldmVudCA/PyBuZXcgVGhlbWVDaGFuZ2UoKSkgYXNcbiAgICAgICAgVGhlbWVDaGFuZ2U7XG4gICAgbmV3RXZlbnQudGhlbWVOYW1lID0ganNvblsndGhlbWVOYW1lJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGhlbWVDaGFuZ2VKc29uIGV4dGVuZHMgQWJzdHJhY3RFdmVudEpzb24ge1xuICB0aGVtZU5hbWU6IHN0cmluZztcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5USEVNRV9DSEFOR0UsIFRoZW1lQ2hhbmdlKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBFdmVudHMgZmlyZWQgYXMgYSByZXN1bHQgb2YgYSB2aWV3cG9ydCBjaGFuZ2UuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLlZpZXdwb3J0Q2hhbmdlJyk7XG5cbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7QWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB7VWlCYXNlfSBmcm9tICcuL2V2ZW50c191aV9iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgdmlld3BvcnQgY2hhbmdlIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5WaWV3cG9ydENoYW5nZVxuICovXG5leHBvcnQgY2xhc3MgVmlld3BvcnRDaGFuZ2UgZXh0ZW5kcyBVaUJhc2Uge1xuICB2aWV3VG9wPzogbnVtYmVyO1xuICB2aWV3TGVmdD86IG51bWJlcjtcbiAgc2NhbGU/OiBudW1iZXI7XG4gIG9sZFNjYWxlPzogbnVtYmVyO1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5WSUVXUE9SVF9DSEFOR0U7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfdG9wIFRvcC1lZGdlIG9mIHRoZSB2aXNpYmxlIHBvcnRpb24gb2YgdGhlIHdvcmtzcGFjZSwgcmVsYXRpdmVcbiAgICogICAgIHRvIHRoZSB3b3Jrc3BhY2Ugb3JpZ2luLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfbGVmdCBMZWZ0LWVkZ2Ugb2YgdGhlIHZpc2libGUgcG9ydGlvbiBvZiB0aGUgd29ya3NwYWNlIHJlbGF0aXZlXG4gICAqICAgICB0byB0aGUgd29ya3NwYWNlIG9yaWdpbi4gVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X3NjYWxlIFRoZSBzY2FsZSBvZiB0aGUgd29ya3NwYWNlLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfd29ya3NwYWNlSWQgVGhlIHdvcmtzcGFjZSBpZGVudGlmaWVyIGZvciB0aGlzIGV2ZW50LlxuICAgKiAgICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfb2xkU2NhbGUgVGhlIG9sZCBzY2FsZSBvZiB0aGUgd29ya3NwYWNlLiBVbmRlZmluZWQgZm9yIGEgYmxhbmtcbiAgICogICAgIGV2ZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBvcHRfdG9wPzogbnVtYmVyLCBvcHRfbGVmdD86IG51bWJlciwgb3B0X3NjYWxlPzogbnVtYmVyLFxuICAgICAgb3B0X3dvcmtzcGFjZUlkPzogc3RyaW5nLCBvcHRfb2xkU2NhbGU/OiBudW1iZXIpIHtcbiAgICBzdXBlcihvcHRfd29ya3NwYWNlSWQpO1xuXG4gICAgLyoqXG4gICAgICogVG9wLWVkZ2Ugb2YgdGhlIHZpc2libGUgcG9ydGlvbiBvZiB0aGUgd29ya3NwYWNlLCByZWxhdGl2ZSB0byB0aGVcbiAgICAgKiB3b3Jrc3BhY2Ugb3JpZ2luLlxuICAgICAqL1xuICAgIHRoaXMudmlld1RvcCA9IG9wdF90b3A7XG5cbiAgICAvKipcbiAgICAgKiBMZWZ0LWVkZ2Ugb2YgdGhlIHZpc2libGUgcG9ydGlvbiBvZiB0aGUgd29ya3NwYWNlLCByZWxhdGl2ZSB0byB0aGVcbiAgICAgKiB3b3Jrc3BhY2Ugb3JpZ2luLlxuICAgICAqL1xuICAgIHRoaXMudmlld0xlZnQgPSBvcHRfbGVmdDtcblxuICAgIC8qKiBUaGUgc2NhbGUgb2YgdGhlIHdvcmtzcGFjZS4gKi9cbiAgICB0aGlzLnNjYWxlID0gb3B0X3NjYWxlO1xuXG4gICAgLyoqIFRoZSBvbGQgc2NhbGUgb2YgdGhlIHdvcmtzcGFjZS4gKi9cbiAgICB0aGlzLm9sZFNjYWxlID0gb3B0X29sZFNjYWxlO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBWaWV3cG9ydENoYW5nZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBWaWV3cG9ydENoYW5nZUpzb247XG4gICAgaWYgKHRoaXMudmlld1RvcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSB2aWV3IHRvcCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgdmFsdWUgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBpZiAodGhpcy52aWV3TGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSB2aWV3IGxlZnQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhbHVlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc2NhbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgc2NhbGUgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhbHVlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub2xkU2NhbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgb2xkIHNjYWxlIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YWx1ZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ3ZpZXdUb3AnXSA9IHRoaXMudmlld1RvcDtcbiAgICBqc29uWyd2aWV3TGVmdCddID0gdGhpcy52aWV3TGVmdDtcbiAgICBqc29uWydzY2FsZSddID0gdGhpcy5zY2FsZTtcbiAgICBqc29uWydvbGRTY2FsZSddID0gdGhpcy5vbGRTY2FsZTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBWaWV3cG9ydENoYW5nZUpzb24pIHtcbiAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAnQmxvY2tseS5FdmVudHMuVmlld3BvcnQucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJyxcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy52aWV3VG9wID0ganNvblsndmlld1RvcCddO1xuICAgIHRoaXMudmlld0xlZnQgPSBqc29uWyd2aWV3TGVmdCddO1xuICAgIHRoaXMuc2NhbGUgPSBqc29uWydzY2FsZSddO1xuICAgIHRoaXMub2xkU2NhbGUgPSBqc29uWydvbGRTY2FsZSddO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBWaWV3cG9ydCwgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdCBwYXJhbWV0ZXJzXG4gICAqICAgICB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZiBwYXJhbWV0ZXJzIHRvXG4gICAqICAgICBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IFZpZXdwb3J0Q2hhbmdlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIFZpZXdwb3J0Q2hhbmdlIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IFZpZXdwb3J0Q2hhbmdlKCkpIGFzXG4gICAgICAgIFZpZXdwb3J0Q2hhbmdlO1xuICAgIG5ld0V2ZW50LnZpZXdUb3AgPSBqc29uWyd2aWV3VG9wJ107XG4gICAgbmV3RXZlbnQudmlld0xlZnQgPSBqc29uWyd2aWV3TGVmdCddO1xuICAgIG5ld0V2ZW50LnNjYWxlID0ganNvblsnc2NhbGUnXTtcbiAgICBuZXdFdmVudC5vbGRTY2FsZSA9IGpzb25bJ29sZFNjYWxlJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlld3BvcnRDaGFuZ2VKc29uIGV4dGVuZHMgQWJzdHJhY3RFdmVudEpzb24ge1xuICB2aWV3VG9wOiBudW1iZXI7XG4gIHZpZXdMZWZ0OiBudW1iZXI7XG4gIHNjYWxlOiBudW1iZXI7XG4gIG9sZFNjYWxlOiBudW1iZXI7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuVklFV1BPUlRfQ0hBTkdFLCBWaWV3cG9ydENoYW5nZSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQSBkYXRhYmFzZSBvZiBhbGwgdGhlIHJlbmRlcmVkIGNvbm5lY3Rpb25zIHRoYXQgY291bGRcbiAqICAgIHBvc3NpYmx5IGJlIGNvbm5lY3RlZCB0byAoaS5lLiBub3QgY29sbGFwc2VkLCBldGMpLlxuICogICAgU29ydGVkIGJ5IHkgY29vcmRpbmF0ZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db25uZWN0aW9uREInKTtcblxuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0IHR5cGUge0lDb25uZWN0aW9uQ2hlY2tlcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29ubmVjdGlvbl9jaGVja2VyLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlZENvbm5lY3Rpb259IGZyb20gJy4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcblxuXG4vKipcbiAqIERhdGFiYXNlIG9mIGNvbm5lY3Rpb25zLlxuICogQ29ubmVjdGlvbnMgYXJlIHN0b3JlZCBpbiBvcmRlciBvZiB0aGVpciB2ZXJ0aWNhbCBjb21wb25lbnQuICBUaGlzIHdheVxuICogY29ubmVjdGlvbnMgaW4gYW4gYXJlYSBtYXkgYmUgbG9va2VkIHVwIHF1aWNrbHkgdXNpbmcgYSBiaW5hcnkgc2VhcmNoLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkNvbm5lY3Rpb25EQlxuICovXG5leHBvcnQgY2xhc3MgQ29ubmVjdGlvbkRCIHtcbiAgLyoqIEFycmF5IG9mIGNvbm5lY3Rpb25zIHNvcnRlZCBieSB5IHBvc2l0aW9uIGluIHdvcmtzcGFjZSB1bml0cy4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBjb25uZWN0aW9uc186IFJlbmRlcmVkQ29ubmVjdGlvbltdID0gW107XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uQ2hlY2tlciBUaGUgd29ya3NwYWNlJ3MgY29ubmVjdGlvbiB0eXBlIGNoZWNrZXIsIHVzZWQgdG9cbiAgICogICAgIGRlY2lkZSBpZiBjb25uZWN0aW9ucyBhcmUgdmFsaWQgZHVyaW5nIGEgZHJhZy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29ubmVjdGlvbkNoZWNrZXI6IElDb25uZWN0aW9uQ2hlY2tlcikge31cblxuICAvKipcbiAgICogQWRkIGEgY29ubmVjdGlvbiB0byB0aGUgZGF0YWJhc2UuIFNob3VsZCBub3QgYWxyZWFkeSBleGlzdCBpbiB0aGUgZGF0YWJhc2UuXG4gICAqXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uIFRoZSBjb25uZWN0aW9uIHRvIGJlIGFkZGVkLlxuICAgKiBAcGFyYW0geVBvcyBUaGUgeSBwb3NpdGlvbiB1c2VkIHRvIGRlY2lkZSB3aGVyZSB0byBpbnNlcnQgdGhlIGNvbm5lY3Rpb24uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYWRkQ29ubmVjdGlvbihjb25uZWN0aW9uOiBSZW5kZXJlZENvbm5lY3Rpb24sIHlQb3M6IG51bWJlcikge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jYWxjdWxhdGVJbmRleEZvcllQb3NfKHlQb3MpO1xuICAgIHRoaXMuY29ubmVjdGlvbnNfLnNwbGljZShpbmRleCwgMCwgY29ubmVjdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBTdGFydHMgYnkgZG9pbmcgYSBiaW5hcnkgc2VhcmNoIHRvIGZpbmQgdGhlIGFwcHJveGltYXRlIGxvY2F0aW9uLCB0aGVuXG4gICAqIGxpbmVhcmx5IHNlYXJjaGVzIG5lYXJieSBmb3IgdGhlIGV4YWN0IGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBjb25uIFRoZSBjb25uZWN0aW9uIHRvIGZpbmQuXG4gICAqIEBwYXJhbSB5UG9zIFRoZSB5IHBvc2l0aW9uIHVzZWQgdG8gZmluZCB0aGUgaW5kZXggb2YgdGhlIGNvbm5lY3Rpb24uXG4gICAqIEByZXR1cm5zIFRoZSBpbmRleCBvZiB0aGUgY29ubmVjdGlvbiwgb3IgLTEgaWYgdGhlIGNvbm5lY3Rpb24gd2FzIG5vdFxuICAgKiAgICAgZm91bmQuXG4gICAqL1xuICBwcml2YXRlIGZpbmRJbmRleE9mQ29ubmVjdGlvbl8oY29ubjogUmVuZGVyZWRDb25uZWN0aW9uLCB5UG9zOiBudW1iZXIpOlxuICAgICAgbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMuY29ubmVjdGlvbnNfLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cblxuICAgIGNvbnN0IGJlc3RHdWVzcyA9IHRoaXMuY2FsY3VsYXRlSW5kZXhGb3JZUG9zXyh5UG9zKTtcbiAgICBpZiAoYmVzdEd1ZXNzID49IHRoaXMuY29ubmVjdGlvbnNfLmxlbmd0aCkge1xuICAgICAgLy8gTm90IGluIGxpc3RcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG5cbiAgICB5UG9zID0gY29ubi55O1xuICAgIC8vIFdhbGsgZm9yd2FyZCBhbmQgYmFjayBvbiB0aGUgeSBheGlzIGxvb2tpbmcgZm9yIHRoZSBjb25uZWN0aW9uLlxuICAgIGxldCBwb2ludGVyID0gYmVzdEd1ZXNzO1xuICAgIHdoaWxlIChwb2ludGVyID49IDAgJiYgdGhpcy5jb25uZWN0aW9uc19bcG9pbnRlcl0ueSA9PT0geVBvcykge1xuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbnNfW3BvaW50ZXJdID09PSBjb25uKSB7XG4gICAgICAgIHJldHVybiBwb2ludGVyO1xuICAgICAgfVxuICAgICAgcG9pbnRlci0tO1xuICAgIH1cblxuICAgIHBvaW50ZXIgPSBiZXN0R3Vlc3M7XG4gICAgd2hpbGUgKHBvaW50ZXIgPCB0aGlzLmNvbm5lY3Rpb25zXy5sZW5ndGggJiZcbiAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uc19bcG9pbnRlcl0ueSA9PT0geVBvcykge1xuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbnNfW3BvaW50ZXJdID09PSBjb25uKSB7XG4gICAgICAgIHJldHVybiBwb2ludGVyO1xuICAgICAgfVxuICAgICAgcG9pbnRlcisrO1xuICAgIH1cbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIGNvcnJlY3QgaW5kZXggZm9yIHRoZSBnaXZlbiB5IHBvc2l0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0geVBvcyBUaGUgeSBwb3NpdGlvbiB1c2VkIHRvIGRlY2lkZSB3aGVyZSB0byBpbnNlcnQgdGhlIGNvbm5lY3Rpb24uXG4gICAqIEByZXR1cm5zIFRoZSBjYW5kaWRhdGUgaW5kZXguXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUluZGV4Rm9yWVBvc18oeVBvczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMuY29ubmVjdGlvbnNfLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGxldCBwb2ludGVyTWluID0gMDtcbiAgICBsZXQgcG9pbnRlck1heCA9IHRoaXMuY29ubmVjdGlvbnNfLmxlbmd0aDtcbiAgICB3aGlsZSAocG9pbnRlck1pbiA8IHBvaW50ZXJNYXgpIHtcbiAgICAgIGNvbnN0IHBvaW50ZXJNaWQgPSBNYXRoLmZsb29yKChwb2ludGVyTWluICsgcG9pbnRlck1heCkgLyAyKTtcbiAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25zX1twb2ludGVyTWlkXS55IDwgeVBvcykge1xuICAgICAgICBwb2ludGVyTWluID0gcG9pbnRlck1pZCArIDE7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY29ubmVjdGlvbnNfW3BvaW50ZXJNaWRdLnkgPiB5UG9zKSB7XG4gICAgICAgIHBvaW50ZXJNYXggPSBwb2ludGVyTWlkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcG9pbnRlck1pbiA9IHBvaW50ZXJNaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcG9pbnRlck1pbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYSBjb25uZWN0aW9uIGZyb20gdGhlIGRhdGFiYXNlLiAgTXVzdCBhbHJlYWR5IGV4aXN0IGluIERCLlxuICAgKlxuICAgKiBAcGFyYW0gY29ubmVjdGlvbiBUaGUgY29ubmVjdGlvbiB0byBiZSByZW1vdmVkLlxuICAgKiBAcGFyYW0geVBvcyBUaGUgeSBwb3NpdGlvbiB1c2VkIHRvIGZpbmQgdGhlIGluZGV4IG9mIHRoZSBjb25uZWN0aW9uLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvbm5lY3Rpb24gY2Fubm90IGJlIGZvdW5kIGluIHRoZSBkYXRhYmFzZS5cbiAgICovXG4gIHJlbW92ZUNvbm5lY3Rpb24oY29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9uLCB5UG9zOiBudW1iZXIpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZmluZEluZGV4T2ZDb25uZWN0aW9uXyhjb25uZWN0aW9uLCB5UG9zKTtcbiAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBFcnJvcignVW5hYmxlIHRvIGZpbmQgY29ubmVjdGlvbiBpbiBjb25uZWN0aW9uREIuJyk7XG4gICAgfVxuICAgIHRoaXMuY29ubmVjdGlvbnNfLnNwbGljZShpbmRleCwgMSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbGwgbmVhcmJ5IGNvbm5lY3Rpb25zIHRvIHRoZSBnaXZlbiBjb25uZWN0aW9uLlxuICAgKiBUeXBlIGNoZWNraW5nIGRvZXMgbm90IGFwcGx5LCBzaW5jZSB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgZm9yIGJ1bXBpbmcuXG4gICAqXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uIFRoZSBjb25uZWN0aW9uIHdob3NlIG5laWdoYm91cnMgc2hvdWxkIGJlIHJldHVybmVkLlxuICAgKiBAcGFyYW0gbWF4UmFkaXVzIFRoZSBtYXhpbXVtIHJhZGl1cyB0byBhbm90aGVyIGNvbm5lY3Rpb24uXG4gICAqIEByZXR1cm5zIExpc3Qgb2YgY29ubmVjdGlvbnMuXG4gICAqL1xuICBnZXROZWlnaGJvdXJzKGNvbm5lY3Rpb246IFJlbmRlcmVkQ29ubmVjdGlvbiwgbWF4UmFkaXVzOiBudW1iZXIpOlxuICAgICAgUmVuZGVyZWRDb25uZWN0aW9uW10ge1xuICAgIGNvbnN0IGRiID0gdGhpcy5jb25uZWN0aW9uc187XG4gICAgY29uc3QgY3VycmVudFggPSBjb25uZWN0aW9uLng7XG4gICAgY29uc3QgY3VycmVudFkgPSBjb25uZWN0aW9uLnk7XG5cbiAgICAvLyBCaW5hcnkgc2VhcmNoIHRvIGZpbmQgdGhlIGNsb3Nlc3QgeSBsb2NhdGlvbi5cbiAgICBsZXQgcG9pbnRlck1pbiA9IDA7XG4gICAgbGV0IHBvaW50ZXJNYXggPSBkYi5sZW5ndGggLSAyO1xuICAgIGxldCBwb2ludGVyTWlkID0gcG9pbnRlck1heDtcbiAgICB3aGlsZSAocG9pbnRlck1pbiA8IHBvaW50ZXJNaWQpIHtcbiAgICAgIGlmIChkYltwb2ludGVyTWlkXS55IDwgY3VycmVudFkpIHtcbiAgICAgICAgcG9pbnRlck1pbiA9IHBvaW50ZXJNaWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwb2ludGVyTWF4ID0gcG9pbnRlck1pZDtcbiAgICAgIH1cbiAgICAgIHBvaW50ZXJNaWQgPSBNYXRoLmZsb29yKChwb2ludGVyTWluICsgcG9pbnRlck1heCkgLyAyKTtcbiAgICB9XG5cbiAgICBjb25zdCBuZWlnaGJvdXJzOiBSZW5kZXJlZENvbm5lY3Rpb25bXSA9IFtdO1xuICAgIC8qKlxuICAgICAqIENvbXB1dGVzIGlmIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24gaXMgd2l0aGluIHRoZSBhbGxvd2VkIHJhZGl1cyBvZlxuICAgICAqIGFub3RoZXIgY29ubmVjdGlvbi4gVGhpcyBmdW5jdGlvbiBpcyBhIGNsb3N1cmUgYW5kIGhhcyBhY2Nlc3MgdG8gb3V0c2lkZVxuICAgICAqIHZhcmlhYmxlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB5SW5kZXggVGhlIG90aGVyIGNvbm5lY3Rpb24ncyBpbmRleCBpbiB0aGUgZGF0YWJhc2UuXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgY3VycmVudCBjb25uZWN0aW9uJ3MgdmVydGljYWwgZGlzdGFuY2UgZnJvbSB0aGVcbiAgICAgKiAgICAgb3RoZXIgY29ubmVjdGlvbiBpcyBsZXNzIHRoYW4gdGhlIGFsbG93ZWQgcmFkaXVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNoZWNrQ29ubmVjdGlvbl8oeUluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgIGNvbnN0IGR4ID0gY3VycmVudFggLSBkYlt5SW5kZXhdLng7XG4gICAgICBjb25zdCBkeSA9IGN1cnJlbnRZIC0gZGJbeUluZGV4XS55O1xuICAgICAgY29uc3QgciA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gICAgICBpZiAociA8PSBtYXhSYWRpdXMpIHtcbiAgICAgICAgbmVpZ2hib3Vycy5wdXNoKGRiW3lJbmRleF0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGR5IDwgbWF4UmFkaXVzO1xuICAgIH1cblxuICAgIC8vIFdhbGsgZm9yd2FyZCBhbmQgYmFjayBvbiB0aGUgeSBheGlzIGxvb2tpbmcgZm9yIHRoZSBjbG9zZXN0IHgseSBwb2ludC5cbiAgICBwb2ludGVyTWluID0gcG9pbnRlck1pZDtcbiAgICBwb2ludGVyTWF4ID0gcG9pbnRlck1pZDtcbiAgICBpZiAoZGIubGVuZ3RoKSB7XG4gICAgICB3aGlsZSAocG9pbnRlck1pbiA+PSAwICYmIGNoZWNrQ29ubmVjdGlvbl8ocG9pbnRlck1pbikpIHtcbiAgICAgICAgcG9pbnRlck1pbi0tO1xuICAgICAgfVxuICAgICAgZG8ge1xuICAgICAgICBwb2ludGVyTWF4Kys7XG4gICAgICB9IHdoaWxlIChwb2ludGVyTWF4IDwgZGIubGVuZ3RoICYmIGNoZWNrQ29ubmVjdGlvbl8ocG9pbnRlck1heCkpO1xuICAgIH1cblxuICAgIHJldHVybiBuZWlnaGJvdXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIElzIHRoZSBjYW5kaWRhdGUgY29ubmVjdGlvbiBjbG9zZSB0byB0aGUgcmVmZXJlbmNlIGNvbm5lY3Rpb24uXG4gICAqIEV4dHJlbWVseSBmYXN0OyBvbmx5IGxvb2tzIGF0IFkgZGlzdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBpbmRleCBJbmRleCBpbiBkYXRhYmFzZSBvZiBjYW5kaWRhdGUgY29ubmVjdGlvbi5cbiAgICogQHBhcmFtIGJhc2VZIFJlZmVyZW5jZSBjb25uZWN0aW9uJ3MgWSB2YWx1ZS5cbiAgICogQHBhcmFtIG1heFJhZGl1cyBUaGUgbWF4aW11bSByYWRpdXMgdG8gYW5vdGhlciBjb25uZWN0aW9uLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGNvbm5lY3Rpb24gaXMgaW4gcmFuZ2UuXG4gICAqL1xuICBwcml2YXRlIGlzSW5ZUmFuZ2VfKGluZGV4OiBudW1iZXIsIGJhc2VZOiBudW1iZXIsIG1heFJhZGl1czogbnVtYmVyKTpcbiAgICAgIGJvb2xlYW4ge1xuICAgIHJldHVybiBNYXRoLmFicyh0aGlzLmNvbm5lY3Rpb25zX1tpbmRleF0ueSAtIGJhc2VZKSA8PSBtYXhSYWRpdXM7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgY2xvc2VzdCBjb21wYXRpYmxlIGNvbm5lY3Rpb24gdG8gdGhpcyBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gY29ubiBUaGUgY29ubmVjdGlvbiBzZWFyY2hpbmcgZm9yIGEgY29tcGF0aWJsZSBtYXRlLlxuICAgKiBAcGFyYW0gbWF4UmFkaXVzIFRoZSBtYXhpbXVtIHJhZGl1cyB0byBhbm90aGVyIGNvbm5lY3Rpb24uXG4gICAqIEBwYXJhbSBkeHkgT2Zmc2V0IGJldHdlZW4gdGhpcyBjb25uZWN0aW9uJ3MgbG9jYXRpb24gaW4gdGhlIGRhdGFiYXNlIGFuZFxuICAgKiAgICAgdGhlIGN1cnJlbnQgbG9jYXRpb24gKGFzIGEgcmVzdWx0IG9mIGRyYWdnaW5nKS5cbiAgICogQHJldHVybnMgQ29udGFpbnMgdHdvIHByb3BlcnRpZXM6ICdjb25uZWN0aW9uJyB3aGljaCBpcyBlaXRoZXIgYW5vdGhlclxuICAgKiAgICAgY29ubmVjdGlvbiBvciBudWxsLCBhbmQgJ3JhZGl1cycgd2hpY2ggaXMgdGhlIGRpc3RhbmNlLlxuICAgKi9cbiAgc2VhcmNoRm9yQ2xvc2VzdChcbiAgICAgIGNvbm46IFJlbmRlcmVkQ29ubmVjdGlvbiwgbWF4UmFkaXVzOiBudW1iZXIsXG4gICAgICBkeHk6IENvb3JkaW5hdGUpOiB7Y29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9ufG51bGwsIHJhZGl1czogbnVtYmVyfSB7XG4gICAgaWYgKCF0aGlzLmNvbm5lY3Rpb25zXy5sZW5ndGgpIHtcbiAgICAgIC8vIERvbid0IGJvdGhlci5cbiAgICAgIHJldHVybiB7Y29ubmVjdGlvbjogbnVsbCwgcmFkaXVzOiBtYXhSYWRpdXN9O1xuICAgIH1cblxuICAgIC8vIFN0YXNoIHRoZSB2YWx1ZXMgb2YgeCBhbmQgeSBmcm9tIGJlZm9yZSB0aGUgZHJhZy5cbiAgICBjb25zdCBiYXNlWSA9IGNvbm4ueTtcbiAgICBjb25zdCBiYXNlWCA9IGNvbm4ueDtcblxuICAgIGNvbm4ueCA9IGJhc2VYICsgZHh5Lng7XG4gICAgY29ubi55ID0gYmFzZVkgKyBkeHkueTtcblxuICAgIC8vIGNhbGN1bGF0ZUluZGV4Rm9yWVBvc18gZmluZHMgYW4gaW5kZXggZm9yIGluc2VydGlvbiwgd2hpY2ggaXMgYWx3YXlzXG4gICAgLy8gYWZ0ZXIgYW55IGJsb2NrIHdpdGggdGhlIHNhbWUgeSBpbmRleC4gIFdlIHdhbnQgdG8gc2VhcmNoIGJvdGggZm9yd2FyZFxuICAgIC8vIGFuZCBiYWNrLCBzbyBzZWFyY2ggb24gYm90aCBzaWRlcyBvZiB0aGUgaW5kZXguXG4gICAgY29uc3QgY2xvc2VzdEluZGV4ID0gdGhpcy5jYWxjdWxhdGVJbmRleEZvcllQb3NfKGNvbm4ueSk7XG5cbiAgICBsZXQgYmVzdENvbm5lY3Rpb24gPSBudWxsO1xuICAgIGxldCBiZXN0UmFkaXVzID0gbWF4UmFkaXVzO1xuICAgIGxldCB0ZW1wO1xuXG4gICAgLy8gV2FsayBmb3J3YXJkIGFuZCBiYWNrIG9uIHRoZSB5IGF4aXMgbG9va2luZyBmb3IgdGhlIGNsb3Nlc3QgeCx5IHBvaW50LlxuICAgIGxldCBwb2ludGVyTWluID0gY2xvc2VzdEluZGV4IC0gMTtcbiAgICB3aGlsZSAocG9pbnRlck1pbiA+PSAwICYmIHRoaXMuaXNJbllSYW5nZV8ocG9pbnRlck1pbiwgY29ubi55LCBtYXhSYWRpdXMpKSB7XG4gICAgICB0ZW1wID0gdGhpcy5jb25uZWN0aW9uc19bcG9pbnRlck1pbl07XG4gICAgICBpZiAodGhpcy5jb25uZWN0aW9uQ2hlY2tlci5jYW5Db25uZWN0KGNvbm4sIHRlbXAsIHRydWUsIGJlc3RSYWRpdXMpKSB7XG4gICAgICAgIGJlc3RDb25uZWN0aW9uID0gdGVtcDtcbiAgICAgICAgYmVzdFJhZGl1cyA9IHRlbXAuZGlzdGFuY2VGcm9tKGNvbm4pO1xuICAgICAgfVxuICAgICAgcG9pbnRlck1pbi0tO1xuICAgIH1cblxuICAgIGxldCBwb2ludGVyTWF4ID0gY2xvc2VzdEluZGV4O1xuICAgIHdoaWxlIChwb2ludGVyTWF4IDwgdGhpcy5jb25uZWN0aW9uc18ubGVuZ3RoICYmXG4gICAgICAgICAgIHRoaXMuaXNJbllSYW5nZV8ocG9pbnRlck1heCwgY29ubi55LCBtYXhSYWRpdXMpKSB7XG4gICAgICB0ZW1wID0gdGhpcy5jb25uZWN0aW9uc19bcG9pbnRlck1heF07XG4gICAgICBpZiAodGhpcy5jb25uZWN0aW9uQ2hlY2tlci5jYW5Db25uZWN0KGNvbm4sIHRlbXAsIHRydWUsIGJlc3RSYWRpdXMpKSB7XG4gICAgICAgIGJlc3RDb25uZWN0aW9uID0gdGVtcDtcbiAgICAgICAgYmVzdFJhZGl1cyA9IHRlbXAuZGlzdGFuY2VGcm9tKGNvbm4pO1xuICAgICAgfVxuICAgICAgcG9pbnRlck1heCsrO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IHRoZSB2YWx1ZXMgb2YgeCBhbmQgeS5cbiAgICBjb25uLnggPSBiYXNlWDtcbiAgICBjb25uLnkgPSBiYXNlWTtcbiAgICAvLyBJZiB0aGVyZSB3ZXJlIG5vIHZhbGlkIGNvbm5lY3Rpb25zLCBiZXN0Q29ubmVjdGlvbiB3aWxsIGJlIG51bGwuXG4gICAgcmV0dXJuIHtjb25uZWN0aW9uOiBiZXN0Q29ubmVjdGlvbiwgcmFkaXVzOiBiZXN0UmFkaXVzfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGEgc2V0IG9mIGNvbm5lY3Rpb24gREJzIGZvciBhIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGNoZWNrZXIgVGhlIHdvcmtzcGFjZSdzIGNvbm5lY3Rpb24gY2hlY2tlciwgdXNlZCB0byBkZWNpZGUgaWZcbiAgICogICAgIGNvbm5lY3Rpb25zIGFyZSB2YWxpZCBkdXJpbmcgYSBkcmFnLlxuICAgKiBAcmV0dXJucyBBcnJheSBvZiBkYXRhYmFzZXMuXG4gICAqL1xuICBzdGF0aWMgaW5pdChjaGVja2VyOiBJQ29ubmVjdGlvbkNoZWNrZXIpOiBDb25uZWN0aW9uREJbXSB7XG4gICAgLy8gQ3JlYXRlIGZvdXIgZGF0YWJhc2VzLCBvbmUgZm9yIGVhY2ggY29ubmVjdGlvbiB0eXBlLlxuICAgIGNvbnN0IGRiTGlzdCA9IFtdO1xuICAgIGRiTGlzdFtDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRV0gPSBuZXcgQ29ubmVjdGlvbkRCKGNoZWNrZXIpO1xuICAgIGRiTGlzdFtDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUVdID0gbmV3IENvbm5lY3Rpb25EQihjaGVja2VyKTtcbiAgICBkYkxpc3RbQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlRdID0gbmV3IENvbm5lY3Rpb25EQihjaGVja2VyKTtcbiAgICBkYkxpc3RbQ29ubmVjdGlvblR5cGUuUFJFVklPVVNfU1RBVEVNRU5UXSA9IG5ldyBDb25uZWN0aW9uREIoY2hlY2tlcik7XG4gICAgcmV0dXJuIGRiTGlzdDtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCBmb3IgY29uZmlndXJpbmcgYW5kIHVwZGF0aW5nIGEgd29ya3NwYWNlIGdyaWQgaW5cbiAqIEJsb2NrbHkuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuR3JpZCcpO1xuXG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcbmltcG9ydCB7R3JpZE9wdGlvbnN9IGZyb20gJy4vb3B0aW9ucy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB3b3Jrc3BhY2UncyBncmlkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkdyaWRcbiAqL1xuZXhwb3J0IGNsYXNzIEdyaWQge1xuICBwcml2YXRlIHJlYWRvbmx5IHNwYWNpbmc6IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBsZW5ndGg6IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBsaW5lMTogU1ZHRWxlbWVudDtcbiAgcHJpdmF0ZSByZWFkb25seSBsaW5lMjogU1ZHRWxlbWVudDtcbiAgcHJpdmF0ZSByZWFkb25seSBzbmFwVG9HcmlkOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gcGF0dGVybiBUaGUgZ3JpZCdzIFNWRyBwYXR0ZXJuLCBjcmVhdGVkIGR1cmluZyBpbmplY3Rpb24uXG4gICAqIEBwYXJhbSBvcHRpb25zIEEgZGljdGlvbmFyeSBvZiBub3JtYWxpemVkIG9wdGlvbnMgZm9yIHRoZSBncmlkLlxuICAgKiAgICAgU2VlIGdyaWQgZG9jdW1lbnRhdGlvbjpcbiAgICogICAgIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NvbmZpZ3VyZS93ZWIvZ3JpZFxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwYXR0ZXJuOiBTVkdFbGVtZW50LCBvcHRpb25zOiBHcmlkT3B0aW9ucykge1xuICAgIC8qKiBUaGUgc3BhY2luZyBvZiB0aGUgZ3JpZCBsaW5lcyAoaW4gcHgpLiAqL1xuICAgIHRoaXMuc3BhY2luZyA9IG9wdGlvbnNbJ3NwYWNpbmcnXSA/PyAwO1xuXG4gICAgLyoqIEhvdyBsb25nIHRoZSBncmlkIGxpbmVzIHNob3VsZCBiZSAoaW4gcHgpLiAqL1xuICAgIHRoaXMubGVuZ3RoID0gb3B0aW9uc1snbGVuZ3RoJ10gPz8gMTtcblxuICAgIC8qKiBUaGUgaG9yaXpvbnRhbCBncmlkIGxpbmUsIGlmIGl0IGV4aXN0cy4gKi9cbiAgICB0aGlzLmxpbmUxID0gcGF0dGVybi5maXJzdENoaWxkIGFzIFNWR0VsZW1lbnQ7XG5cbiAgICAvKiogVGhlIHZlcnRpY2FsIGdyaWQgbGluZSwgaWYgaXQgZXhpc3RzLiAqL1xuICAgIHRoaXMubGluZTIgPSB0aGlzLmxpbmUxICYmIHRoaXMubGluZTEubmV4dFNpYmxpbmcgYXMgU1ZHRWxlbWVudDtcblxuICAgIC8qKiBXaGV0aGVyIGJsb2NrcyBzaG91bGQgc25hcCB0byB0aGUgZ3JpZC4gKi9cbiAgICB0aGlzLnNuYXBUb0dyaWQgPSBvcHRpb25zWydzbmFwJ10gPz8gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBibG9ja3Mgc2hvdWxkIHNuYXAgdG8gdGhlIGdyaWQsIGJhc2VkIG9uIHRoZSBpbml0aWFsIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgYmxvY2tzIHNob3VsZCBzbmFwLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2hvdWxkU25hcCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zbmFwVG9HcmlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc3BhY2luZyBvZiB0aGUgZ3JpZCBwb2ludHMgKGluIHB4KS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHNwYWNpbmcgb2YgdGhlIGdyaWQgcG9pbnRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFNwYWNpbmcoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5zcGFjaW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgSUQgb2YgdGhlIHBhdHRlcm4gZWxlbWVudCwgd2hpY2ggc2hvdWxkIGJlIHJhbmRvbWl6ZWQgdG8gYXZvaWRcbiAgICogY29uZmxpY3RzIHdpdGggb3RoZXIgQmxvY2tseSBpbnN0YW5jZXMgb24gdGhlIHBhZ2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBwYXR0ZXJuIElELlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFBhdHRlcm5JZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnBhdHRlcm4uaWQ7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBncmlkIHdpdGggYSBuZXcgc2NhbGUuXG4gICAqXG4gICAqIEBwYXJhbSBzY2FsZSBUaGUgbmV3IHdvcmtzcGFjZSBzY2FsZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICB1cGRhdGUoc2NhbGU6IG51bWJlcikge1xuICAgIC8vIE1TSUUgZnJlYWtzIGlmIGl0IHNlZXMgYSAweDAgcGF0dGVybiwgc28gc2V0IGVtcHR5IHBhdHRlcm5zIHRvIDEwMHgxMDAuXG4gICAgY29uc3Qgc2FmZVNwYWNpbmcgPSB0aGlzLnNwYWNpbmcgKiBzY2FsZSB8fCAxMDA7XG5cbiAgICB0aGlzLnBhdHRlcm4uc2V0QXR0cmlidXRlKCd3aWR0aCcsIHNhZmVTcGFjaW5nLnRvU3RyaW5nKCkpO1xuICAgIHRoaXMucGF0dGVybi5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIHNhZmVTcGFjaW5nLnRvU3RyaW5nKCkpO1xuXG4gICAgbGV0IGhhbGYgPSBNYXRoLmZsb29yKHRoaXMuc3BhY2luZyAvIDIpICsgMC41O1xuICAgIGxldCBzdGFydCA9IGhhbGYgLSB0aGlzLmxlbmd0aCAvIDI7XG4gICAgbGV0IGVuZCA9IGhhbGYgKyB0aGlzLmxlbmd0aCAvIDI7XG5cbiAgICBoYWxmICo9IHNjYWxlO1xuICAgIHN0YXJ0ICo9IHNjYWxlO1xuICAgIGVuZCAqPSBzY2FsZTtcblxuICAgIHRoaXMuc2V0TGluZUF0dHJpYnV0ZXModGhpcy5saW5lMSwgc2NhbGUsIHN0YXJ0LCBlbmQsIGhhbGYsIGhhbGYpO1xuICAgIHRoaXMuc2V0TGluZUF0dHJpYnV0ZXModGhpcy5saW5lMiwgc2NhbGUsIGhhbGYsIGhhbGYsIHN0YXJ0LCBlbmQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgYXR0cmlidXRlcyBvbiBvbmUgb2YgdGhlIGxpbmVzIGluIHRoZSBncmlkLiAgVXNlIHRoaXMgdG8gdXBkYXRlIHRoZVxuICAgKiBsZW5ndGggYW5kIHN0cm9rZSB3aWR0aCBvZiB0aGUgZ3JpZCBsaW5lcy5cbiAgICpcbiAgICogQHBhcmFtIGxpbmUgV2hpY2ggbGluZSB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSB3aWR0aCBUaGUgbmV3IHN0cm9rZSBzaXplIChpbiBweCkuXG4gICAqIEBwYXJhbSB4MSBUaGUgbmV3IHggc3RhcnQgcG9zaXRpb24gb2YgdGhlIGxpbmUgKGluIHB4KS5cbiAgICogQHBhcmFtIHgyIFRoZSBuZXcgeCBlbmQgcG9zaXRpb24gb2YgdGhlIGxpbmUgKGluIHB4KS5cbiAgICogQHBhcmFtIHkxIFRoZSBuZXcgeSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgbGluZSAoaW4gcHgpLlxuICAgKiBAcGFyYW0geTIgVGhlIG5ldyB5IGVuZCBwb3NpdGlvbiBvZiB0aGUgbGluZSAoaW4gcHgpLlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRMaW5lQXR0cmlidXRlcyhcbiAgICAgIGxpbmU6IFNWR0VsZW1lbnQsIHdpZHRoOiBudW1iZXIsIHgxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkxOiBudW1iZXIsXG4gICAgICB5MjogbnVtYmVyKSB7XG4gICAgaWYgKGxpbmUpIHtcbiAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCB3aWR0aC50b1N0cmluZygpKTtcbiAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd4MScsIHgxLnRvU3RyaW5nKCkpO1xuICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoJ3kxJywgeTEudG9TdHJpbmcoKSk7XG4gICAgICBsaW5lLnNldEF0dHJpYnV0ZSgneDInLCB4Mi50b1N0cmluZygpKTtcbiAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd5MicsIHkyLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoZSBncmlkIHRvIGEgbmV3IHggYW5kIHkgcG9zaXRpb24sIGFuZCBtYWtlIHN1cmUgdGhhdCBjaGFuZ2UgaXNcbiAgICogdmlzaWJsZS5cbiAgICpcbiAgICogQHBhcmFtIHggVGhlIG5ldyB4IHBvc2l0aW9uIG9mIHRoZSBncmlkIChpbiBweCkuXG4gICAqIEBwYXJhbSB5IFRoZSBuZXcgeSBwb3NpdGlvbiBvZiB0aGUgZ3JpZCAoaW4gcHgpLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1vdmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMucGF0dGVybi5zZXRBdHRyaWJ1dGUoJ3gnLCB4LnRvU3RyaW5nKCkpO1xuICAgIHRoaXMucGF0dGVybi5zZXRBdHRyaWJ1dGUoJ3knLCB5LnRvU3RyaW5nKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgRE9NIGZvciB0aGUgZ3JpZCBkZXNjcmliZWQgYnkgb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIHJuZCBBIHJhbmRvbSBJRCB0byBhcHBlbmQgdG8gdGhlIHBhdHRlcm4ncyBJRC5cbiAgICogQHBhcmFtIGdyaWRPcHRpb25zIFRoZSBvYmplY3QgY29udGFpbmluZyBncmlkIGNvbmZpZ3VyYXRpb24uXG4gICAqIEBwYXJhbSBkZWZzIFRoZSByb290IFNWRyBlbGVtZW50IGZvciB0aGlzIHdvcmtzcGFjZSdzIGRlZnMuXG4gICAqIEByZXR1cm5zIFRoZSBTVkcgZWxlbWVudCBmb3IgdGhlIGdyaWQgcGF0dGVybi5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlRG9tKHJuZDogc3RyaW5nLCBncmlkT3B0aW9uczogR3JpZE9wdGlvbnMsIGRlZnM6IFNWR0VsZW1lbnQpOlxuICAgICAgU1ZHRWxlbWVudCB7XG4gICAgLypcbiAgICAgICAgICA8cGF0dGVybiBpZD1cImJsb2NrbHlHcmlkUGF0dGVybjgzNzQ5M1wiIHBhdHRlcm5Vbml0cz1cInVzZXJTcGFjZU9uVXNlXCI+XG4gICAgICAgICAgICA8cmVjdCBzdHJva2U9XCIjODg4XCIgLz5cbiAgICAgICAgICAgIDxyZWN0IHN0cm9rZT1cIiM4ODhcIiAvPlxuICAgICAgICAgIDwvcGF0dGVybj5cbiAgICAgICAgKi9cbiAgICBjb25zdCBncmlkUGF0dGVybiA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUEFUVEVSTixcbiAgICAgICAgeydpZCc6ICdibG9ja2x5R3JpZFBhdHRlcm4nICsgcm5kLCAncGF0dGVyblVuaXRzJzogJ3VzZXJTcGFjZU9uVXNlJ30sXG4gICAgICAgIGRlZnMpO1xuICAgIC8vIHgxLCB5MSwgeDEsIHgyIHByb3BlcnRpZXMgd2lsbCBiZSBzZXQgbGF0ZXIgaW4gdXBkYXRlLlxuICAgIGlmICgoZ3JpZE9wdGlvbnNbJ2xlbmd0aCddID8/IDEpID4gMCAmJiAoZ3JpZE9wdGlvbnNbJ3NwYWNpbmcnXSA/PyAwKSA+IDApIHtcbiAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5MSU5FLCB7J3N0cm9rZSc6IGdyaWRPcHRpb25zWydjb2xvdXInXX0sIGdyaWRQYXR0ZXJuKTtcbiAgICAgIGlmIChncmlkT3B0aW9uc1snbGVuZ3RoJ10gPz8gMSA+IDEpIHtcbiAgICAgICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgICAgICBTdmcuTElORSwgeydzdHJva2UnOiBncmlkT3B0aW9uc1snY29sb3VyJ119LCBncmlkUGF0dGVybik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEVkZ2UgMTYgZG9lc24ndCBoYW5kbGUgZW1wdHkgcGF0dGVybnNcbiAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5MSU5FLCB7fSwgZ3JpZFBhdHRlcm4pO1xuICAgIH1cbiAgICByZXR1cm4gZ3JpZFBhdHRlcm47XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgaGFuZGxpbmcgdmFyaWFibGUgYW5kIHByb2NlZHVyZSBuYW1lcy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5OYW1lcycpO1xuXG5pbXBvcnQge01zZ30gZnJvbSAnLi9tc2cuanMnO1xuLy8gaW1wb3J0ICogYXMgUHJvY2VkdXJlcyBmcm9tICcuL3Byb2NlZHVyZXMuanMnO1xuaW1wb3J0IHR5cGUge1ZhcmlhYmxlTWFwfSBmcm9tICcuL3ZhcmlhYmxlX21hcC5qcyc7XG5pbXBvcnQgKiBhcyBWYXJpYWJsZXMgZnJvbSAnLi92YXJpYWJsZXMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgZGF0YWJhc2Ugb2YgZW50aXR5IG5hbWVzICh2YXJpYWJsZXMsIHByb2NlZHVyZXMsIGV0YykuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuTmFtZXNcbiAqL1xuZXhwb3J0IGNsYXNzIE5hbWVzIHtcbiAgc3RhdGljIERFVkVMT1BFUl9WQVJJQUJMRV9UWVBFOiBOYW1lVHlwZTtcbiAgcHJpdmF0ZSByZWFkb25seSB2YXJpYWJsZVByZWZpeF86IHN0cmluZztcblxuICAvKiogQSBzZXQgb2YgcmVzZXJ2ZWQgd29yZHMuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVzZXJ2ZWRXb3JkczogU2V0PHN0cmluZz47XG5cbiAgLyoqXG4gICAqIEEgbWFwIGZyb20gdHlwZSAoZS5nLiBuYW1lLCBwcm9jZWR1cmUpIHRvIG1hcHMgZnJvbSBuYW1lcyB0byBnZW5lcmF0ZWRcbiAgICogbmFtZXMuXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGRiID0gbmV3IE1hcDxzdHJpbmcsIE1hcDxzdHJpbmcsIHN0cmluZz4+KCk7XG5cbiAgLyoqIEEgc2V0IG9mIHVzZWQgbmFtZXMgdG8gYXZvaWQgY29sbGlzaW9ucy4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBkYlJldmVyc2UgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICAvKipcbiAgICogVGhlIHZhcmlhYmxlIG1hcCBmcm9tIHRoZSB3b3Jrc3BhY2UsIGNvbnRhaW5pbmcgQmxvY2tseSB2YXJpYWJsZSBtb2RlbHMuXG4gICAqL1xuICBwcml2YXRlIHZhcmlhYmxlTWFwXzogVmFyaWFibGVNYXB8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSByZXNlcnZlZFdvcmRzTGlzdCBBIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcgb2Ygd29yZHMgdGhhdCBhcmUgaWxsZWdhbFxuICAgKiAgICAgZm9yIHVzZSBhcyBuYW1lcyBpbiBhIGxhbmd1YWdlIChlLmcuICduZXcsaWYsdGhpcywuLi4nKS5cbiAgICogQHBhcmFtIG9wdF92YXJpYWJsZVByZWZpeCBTb21lIGxhbmd1YWdlcyBuZWVkIGEgJyQnIG9yIGEgbmFtZXNwYWNlIGJlZm9yZVxuICAgKiAgICAgYWxsIHZhcmlhYmxlIG5hbWVzIChidXQgbm90IHByb2NlZHVyZSBuYW1lcykuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihyZXNlcnZlZFdvcmRzTGlzdDogc3RyaW5nLCBvcHRfdmFyaWFibGVQcmVmaXg/OiBzdHJpbmcpIHtcbiAgICAvKiogVGhlIHByZWZpeCB0byBhdHRhY2ggdG8gdmFyaWFibGUgbmFtZXMgaW4gZ2VuZXJhdGVkIGNvZGUuICovXG4gICAgdGhpcy52YXJpYWJsZVByZWZpeF8gPSBvcHRfdmFyaWFibGVQcmVmaXggfHwgJyc7XG5cbiAgICB0aGlzLnJlc2VydmVkV29yZHMgPVxuICAgICAgICBuZXcgU2V0PHN0cmluZz4ocmVzZXJ2ZWRXb3Jkc0xpc3QgPyByZXNlcnZlZFdvcmRzTGlzdC5zcGxpdCgnLCcpIDogW10pO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtcHR5IHRoZSBkYXRhYmFzZSBhbmQgc3RhcnQgZnJvbSBzY3JhdGNoLiAgVGhlIHJlc2VydmVkIHdvcmRzIGFyZSBrZXB0LlxuICAgKi9cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5kYi5jbGVhcigpO1xuICAgIHRoaXMuZGJSZXZlcnNlLmNsZWFyKCk7XG4gICAgdGhpcy52YXJpYWJsZU1hcF8gPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgdmFyaWFibGUgbWFwIHRoYXQgbWFwcyBmcm9tIHZhcmlhYmxlIG5hbWUgdG8gdmFyaWFibGUgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gbWFwIFRoZSBtYXAgdG8gdHJhY2suXG4gICAqL1xuICBzZXRWYXJpYWJsZU1hcChtYXA6IFZhcmlhYmxlTWFwKSB7XG4gICAgdGhpcy52YXJpYWJsZU1hcF8gPSBtYXA7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBuYW1lIGZvciBhIHVzZXItZGVmaW5lZCB2YXJpYWJsZSwgYmFzZWQgb24gaXRzIElELlxuICAgKiBUaGlzIHNob3VsZCBvbmx5IGJlIHVzZWQgZm9yIHZhcmlhYmxlcyBvZiBOYW1lVHlwZSBWQVJJQUJMRS5cbiAgICpcbiAgICogQHBhcmFtIGlkIFRoZSBJRCB0byBsb29rIHVwIGluIHRoZSB2YXJpYWJsZSBtYXAuXG4gICAqIEByZXR1cm5zIFRoZSBuYW1lIG9mIHRoZSByZWZlcmVuY2VkIHZhcmlhYmxlLCBvciBudWxsIGlmIHRoZXJlIHdhcyBub1xuICAgKiAgICAgdmFyaWFibGUgbWFwIG9yIHRoZSB2YXJpYWJsZSB3YXMgbm90IGZvdW5kIGluIHRoZSBtYXAuXG4gICAqL1xuICBwcml2YXRlIGdldE5hbWVGb3JVc2VyVmFyaWFibGVfKGlkOiBzdHJpbmcpOiBzdHJpbmd8bnVsbCB7XG4gICAgaWYgKCF0aGlzLnZhcmlhYmxlTWFwXykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICdEZXByZWNhdGVkIGNhbGwgdG8gTmFtZXMucHJvdG90eXBlLmdldE5hbWUgd2l0aG91dCAnICtcbiAgICAgICAgICAnZGVmaW5pbmcgYSB2YXJpYWJsZSBtYXAuIFRvIGZpeCwgYWRkIHRoZSBmb2xsb3dpbmcgY29kZSBpbiB5b3VyICcgK1xuICAgICAgICAgICdnZW5lcmF0b3JcXCdzIGluaXQoKSBmdW5jdGlvbjpcXG4nICtcbiAgICAgICAgICAnQmxvY2tseS5Zb3VyR2VuZXJhdG9yTmFtZS5uYW1lREJfLnNldFZhcmlhYmxlTWFwKCcgK1xuICAgICAgICAgICd3b3Jrc3BhY2UuZ2V0VmFyaWFibGVNYXAoKSk7Jyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnZhcmlhYmxlTWFwXy5nZXRWYXJpYWJsZUJ5SWQoaWQpO1xuICAgIGlmICh2YXJpYWJsZSkge1xuICAgICAgcmV0dXJuIHZhcmlhYmxlLm5hbWU7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIG5hbWVzIGZvciB1c2VyIHZhcmlhYmxlcywgYnV0IG9ubHkgb25lcyB0aGF0IGFyZSBiZWluZyB1c2VkLlxuICAgKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFdvcmtzcGFjZSB0byBnZW5lcmF0ZSB2YXJpYWJsZXMgZnJvbS5cbiAgICovXG4gIHBvcHVsYXRlVmFyaWFibGVzKHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XG4gICAgY29uc3QgdmFyaWFibGVzID0gVmFyaWFibGVzLmFsbFVzZWRWYXJNb2RlbHMod29ya3NwYWNlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhcmlhYmxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5nZXROYW1lKHZhcmlhYmxlc1tpXS5nZXRJZCgpLCBOYW1lVHlwZS5WQVJJQUJMRSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIG5hbWVzIGZvciBwcm9jZWR1cmVzLlxuICAgKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFdvcmtzcGFjZSB0byBnZW5lcmF0ZSBwcm9jZWR1cmVzIGZyb20uXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gIHBvcHVsYXRlUHJvY2VkdXJlcyh3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1RoZSBpbXBsZW1lbnRhdGlvbiBvZiBwb3B1bGF0ZVByb2NlZHVyZXMgc2hvdWxkIGJlICcgK1xuICAgICAgICAnbW9ua2V5LXBhdGNoZWQgaW4gYnkgYmxvY2tseS50cycpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYSBCbG9ja2x5IGVudGl0eSBuYW1lIHRvIGEgbGVnYWwgZXhwb3J0YWJsZSBlbnRpdHkgbmFtZS5cbiAgICpcbiAgICogQHBhcmFtIG5hbWVPcklkIFRoZSBCbG9ja2x5IGVudGl0eSBuYW1lIChubyBjb25zdHJhaW50cykgb3IgdmFyaWFibGUgSUQuXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBuYW1lIGluIEJsb2NrbHkgKCdWQVJJQUJMRScsICdQUk9DRURVUkUnLFxuICAgKiAgICAgJ0RFVkVMT1BFUl9WQVJJQUJMRScsIGV0Yy4uLikuXG4gICAqIEByZXR1cm5zIEFuIGVudGl0eSBuYW1lIHRoYXQgaXMgbGVnYWwgaW4gdGhlIGV4cG9ydGVkIGxhbmd1YWdlLlxuICAgKi9cbiAgZ2V0TmFtZShuYW1lT3JJZDogc3RyaW5nLCB0eXBlOiBOYW1lVHlwZXxzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCBuYW1lID0gbmFtZU9ySWQ7XG4gICAgaWYgKHR5cGUgPT09IE5hbWVUeXBlLlZBUklBQkxFKSB7XG4gICAgICBjb25zdCB2YXJOYW1lID0gdGhpcy5nZXROYW1lRm9yVXNlclZhcmlhYmxlXyhuYW1lT3JJZCk7XG4gICAgICBpZiAodmFyTmFtZSkge1xuICAgICAgICAvLyBTdWNjZXNzZnVsIElEIGxvb2t1cC5cbiAgICAgICAgbmFtZSA9IHZhck5hbWU7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG5vcm1hbGl6ZWROYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgY29uc3QgaXNWYXIgPVxuICAgICAgICB0eXBlID09PSBOYW1lVHlwZS5WQVJJQUJMRSB8fCB0eXBlID09PSBOYW1lVHlwZS5ERVZFTE9QRVJfVkFSSUFCTEU7XG5cbiAgICBjb25zdCBwcmVmaXggPSBpc1ZhciA/IHRoaXMudmFyaWFibGVQcmVmaXhfIDogJyc7XG4gICAgaWYgKCF0aGlzLmRiLmhhcyh0eXBlKSkge1xuICAgICAgdGhpcy5kYi5zZXQodHlwZSwgbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSk7XG4gICAgfVxuICAgIGNvbnN0IHR5cGVEYiA9IHRoaXMuZGIuZ2V0KHR5cGUpO1xuICAgIGlmICh0eXBlRGIhLmhhcyhub3JtYWxpemVkTmFtZSkpIHtcbiAgICAgIHJldHVybiBwcmVmaXggKyB0eXBlRGIhLmdldChub3JtYWxpemVkTmFtZSk7XG4gICAgfVxuICAgIGNvbnN0IHNhZmVOYW1lID0gdGhpcy5nZXREaXN0aW5jdE5hbWUobmFtZSwgdHlwZSk7XG4gICAgdHlwZURiIS5zZXQobm9ybWFsaXplZE5hbWUsIHNhZmVOYW1lLnN1YnN0cihwcmVmaXgubGVuZ3RoKSk7XG4gICAgcmV0dXJuIHNhZmVOYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhIGxpc3Qgb2YgYWxsIGtub3duIHVzZXItY3JlYXRlZCBuYW1lcyBvZiBhIHNwZWNpZmllZCBuYW1lIHR5cGUuXG4gICAqXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIGVudGl0eSBpbiBCbG9ja2x5ICgnVkFSSUFCTEUnLCAnUFJPQ0VEVVJFJyxcbiAgICogICAgICdERVZFTE9QRVJfVkFSSUFCTEUnLCBldGMuLi4pLlxuICAgKiBAcmV0dXJucyBBIGxpc3Qgb2YgQmxvY2tseSBlbnRpdHkgbmFtZXMgKG5vIGNvbnN0cmFpbnRzKS5cbiAgICovXG4gIGdldFVzZXJOYW1lcyh0eXBlOiBOYW1lVHlwZXxzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgdXNlck5hbWVzID0gdGhpcy5kYi5nZXQodHlwZSk/LmtleXMoKTtcbiAgICByZXR1cm4gdXNlck5hbWVzID8gQXJyYXkuZnJvbSh1c2VyTmFtZXMpIDogW107XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydCBhIEJsb2NrbHkgZW50aXR5IG5hbWUgdG8gYSBsZWdhbCBleHBvcnRhYmxlIGVudGl0eSBuYW1lLlxuICAgKiBFbnN1cmUgdGhhdCB0aGlzIGlzIGEgbmV3IG5hbWUgbm90IG92ZXJsYXBwaW5nIGFueSBwcmV2aW91c2x5IGRlZmluZWQgbmFtZS5cbiAgICogQWxzbyBjaGVjayBhZ2FpbnN0IGxpc3Qgb2YgcmVzZXJ2ZWQgd29yZHMgZm9yIHRoZSBjdXJyZW50IGxhbmd1YWdlIGFuZFxuICAgKiBlbnN1cmUgbmFtZSBkb2Vzbid0IGNvbGxpZGUuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBCbG9ja2x5IGVudGl0eSBuYW1lIChubyBjb25zdHJhaW50cykuXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIGVudGl0eSBpbiBCbG9ja2x5ICgnVkFSSUFCTEUnLCAnUFJPQ0VEVVJFJyxcbiAgICogICAgICdERVZFTE9QRVJfVkFSSUFCTEUnLCBldGMuLi4pLlxuICAgKiBAcmV0dXJucyBBbiBlbnRpdHkgbmFtZSB0aGF0IGlzIGxlZ2FsIGluIHRoZSBleHBvcnRlZCBsYW5ndWFnZS5cbiAgICovXG4gIGdldERpc3RpbmN0TmFtZShuYW1lOiBzdHJpbmcsIHR5cGU6IE5hbWVUeXBlfHN0cmluZyk6IHN0cmluZyB7XG4gICAgbGV0IHNhZmVOYW1lID0gdGhpcy5zYWZlTmFtZV8obmFtZSk7XG4gICAgbGV0IGkgPSAnJztcbiAgICB3aGlsZSAodGhpcy5kYlJldmVyc2UuaGFzKHNhZmVOYW1lICsgaSkgfHxcbiAgICAgICAgICAgdGhpcy5yZXNlcnZlZFdvcmRzLmhhcyhzYWZlTmFtZSArIGkpKSB7XG4gICAgICAvLyBDb2xsaXNpb24gd2l0aCBleGlzdGluZyBuYW1lLiAgQ3JlYXRlIGEgdW5pcXVlIG5hbWUuXG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ3N0cmluZyB8IDInIGlzIG5vdCBhc3NpZ25hYmxlIHRvXG4gICAgICAvLyB0eXBlICdzdHJpbmcnLlxuICAgICAgaSA9IChpID8gaSArIDEgOiAyKSBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gICAgfVxuICAgIHNhZmVOYW1lICs9IGk7XG4gICAgdGhpcy5kYlJldmVyc2UuYWRkKHNhZmVOYW1lKTtcbiAgICBjb25zdCBpc1ZhciA9XG4gICAgICAgIHR5cGUgPT09IE5hbWVUeXBlLlZBUklBQkxFIHx8IHR5cGUgPT09IE5hbWVUeXBlLkRFVkVMT1BFUl9WQVJJQUJMRTtcbiAgICBjb25zdCBwcmVmaXggPSBpc1ZhciA/IHRoaXMudmFyaWFibGVQcmVmaXhfIDogJyc7XG4gICAgcmV0dXJuIHByZWZpeCArIHNhZmVOYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmVuIGEgcHJvcG9zZWQgZW50aXR5IG5hbWUsIGdlbmVyYXRlIGEgbmFtZSB0aGF0IGNvbmZvcm1zIHRvIHRoZVxuICAgKiBbX0EtWmEtel1bX0EtWmEtejAtOV0qIGZvcm1hdCB0aGF0IG1vc3QgbGFuZ3VhZ2VzIGNvbnNpZGVyIGxlZ2FsIGZvclxuICAgKiB2YXJpYWJsZSBhbmQgZnVuY3Rpb24gbmFtZXMuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFBvdGVudGlhbGx5IGlsbGVnYWwgZW50aXR5IG5hbWUuXG4gICAqIEByZXR1cm5zIFNhZmUgZW50aXR5IG5hbWUuXG4gICAqL1xuICBwcml2YXRlIHNhZmVOYW1lXyhuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICghbmFtZSkge1xuICAgICAgbmFtZSA9IE1zZ1snVU5OQU1FRF9LRVknXSB8fCAndW5uYW1lZCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFVuZm9ydHVuYXRlbHkgbmFtZXMgaW4gbm9uLWxhdGluIGNoYXJhY3RlcnMgd2lsbCBsb29rIGxpa2VcbiAgICAgIC8vIF9FOV85Rl9CM19FNF9COV85MCB3aGljaCBpcyBwcmV0dHkgbWVhbmluZ2xlc3MuXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Jsb2NrbHkvaXNzdWVzLzE2NTRcbiAgICAgIG5hbWUgPSBlbmNvZGVVUkkobmFtZS5yZXBsYWNlKC8gL2csICdfJykpLnJlcGxhY2UoL1teXFx3XS9nLCAnXycpO1xuICAgICAgLy8gTW9zdCBsYW5ndWFnZXMgZG9uJ3QgYWxsb3cgbmFtZXMgd2l0aCBsZWFkaW5nIG51bWJlcnMuXG4gICAgICBpZiAoJzAxMjM0NTY3ODknLmluZGV4T2YobmFtZVswXSkgIT09IC0xKSB7XG4gICAgICAgIG5hbWUgPSAnbXlfJyArIG5hbWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIERvIHRoZSBnaXZlbiB0d28gZW50aXR5IG5hbWVzIHJlZmVyIHRvIHRoZSBzYW1lIGVudGl0eT9cbiAgICogQmxvY2tseSBuYW1lcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZS5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUxIEZpcnN0IG5hbWUuXG4gICAqIEBwYXJhbSBuYW1lMiBTZWNvbmQgbmFtZS5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiBuYW1lcyBhcmUgdGhlIHNhbWUuXG4gICAqL1xuICBzdGF0aWMgZXF1YWxzKG5hbWUxOiBzdHJpbmcsIG5hbWUyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAvLyBuYW1lMS5sb2NhbGVDb21wYXJlKG5hbWUyKSBpcyBzbG93ZXIuXG4gICAgcmV0dXJuIG5hbWUxLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUyLnRvTG93ZXJDYXNlKCk7XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBOYW1lcyB7XG4gIC8qKlxuICAgKiBFbnVtIGZvciB0aGUgdHlwZSBvZiBhIG5hbWUuIERpZmZlcmVudCBuYW1lIHR5cGVzIG1heSBoYXZlIGRpZmZlcmVudCBydWxlc1xuICAgKiBhYm91dCBjb2xsaXNpb25zLlxuICAgKiBXaGVuIEphdmFTY3JpcHQgKG9yIG1vc3Qgb3RoZXIgbGFuZ3VhZ2VzKSBpcyBnZW5lcmF0ZWQsIHZhcmlhYmxlICdmb28nIGFuZFxuICAgKiBwcm9jZWR1cmUgJ2Zvbycgd291bGQgY29sbGlkZS4gIEhvd2V2ZXIsIEJsb2NrbHkgaGFzIG5vIHN1Y2ggcHJvYmxlbXMgc2luY2VcbiAgICogdmFyaWFibGUgZ2V0ICdmb28nIGFuZCBwcm9jZWR1cmUgY2FsbCAnZm9vJyBhcmUgdW5hbWJpZ3VvdXMuXG4gICAqIFRoZXJlZm9yZSwgQmxvY2tseSBrZWVwcyBhIHNlcGFyYXRlIG5hbWUgdHlwZSB0byBkaXNhbWJpZ3VhdGUuXG4gICAqIGdldE5hbWUoJ2ZvbycsICdWQVJJQUJMRScpID0gJ2ZvbydcbiAgICogZ2V0TmFtZSgnZm9vJywgJ1BST0NFRFVSRScpID0gJ2ZvbzInXG4gICAqXG4gICAqIEBhbGlhcyBCbG9ja2x5Lk5hbWVzLk5hbWVUeXBlXG4gICAqL1xuICBleHBvcnQgZW51bSBOYW1lVHlwZSB7XG4gICAgREVWRUxPUEVSX1ZBUklBQkxFID0gJ0RFVkVMT1BFUl9WQVJJQUJMRScsXG4gICAgVkFSSUFCTEUgPSAnVkFSSUFCTEUnLFxuICAgIFBST0NFRFVSRSA9ICdQUk9DRURVUkUnLFxuICB9XG59XG5cbmV4cG9ydCB0eXBlIE5hbWVUeXBlID0gTmFtZXMuTmFtZVR5cGU7XG5leHBvcnQgY29uc3QgTmFtZVR5cGUgPSBOYW1lcy5OYW1lVHlwZTtcblxuLyoqXG4gKiBDb25zdGFudCB0byBzZXBhcmF0ZSBkZXZlbG9wZXIgdmFyaWFibGUgbmFtZXMgZnJvbSB1c2VyLWRlZmluZWQgdmFyaWFibGVcbiAqIG5hbWVzIHdoZW4gcnVubmluZyBnZW5lcmF0b3JzLlxuICogQSBkZXZlbG9wZXIgdmFyaWFibGUgd2lsbCBiZSBkZWNsYXJlZCBhcyBhIGdsb2JhbCBpbiB0aGUgZ2VuZXJhdGVkIGNvZGUsIGJ1dFxuICogd2lsbCBuZXZlciBiZSBzaG93biB0byB0aGUgdXNlciBpbiB0aGUgd29ya3NwYWNlIG9yIHN0b3JlZCBpbiB0aGUgdmFyaWFibGVcbiAqIG1hcC5cbiAqL1xuTmFtZXMuREVWRUxPUEVSX1ZBUklBQkxFX1RZUEUgPSBOYW1lVHlwZS5ERVZFTE9QRVJfVkFSSUFCTEU7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB7SVByb2NlZHVyZU1hcH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tYXAuanMnO1xuaW1wb3J0IHR5cGUge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQge2lzT2JzZXJ2YWJsZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX29ic2VydmFibGUuanMnO1xuaW1wb3J0IHt0cmlnZ2VyUHJvY2VkdXJlc1VwZGF0ZX0gZnJvbSAnLi91cGRhdGVfcHJvY2VkdXJlcy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbmV4cG9ydCBjbGFzcyBPYnNlcnZhYmxlUHJvY2VkdXJlTWFwIGV4dGVuZHNcbiAgICBNYXA8c3RyaW5nLCBJUHJvY2VkdXJlTW9kZWw+IGltcGxlbWVudHMgSVByb2NlZHVyZU1hcCB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgd29ya3NwYWNlOiBXb3Jrc3BhY2UpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIGdpdmVuIHByb2NlZHVyZSBtb2RlbCB0byB0aGUgcHJvY2VkdXJlIG1hcC5cbiAgICovXG4gIG92ZXJyaWRlIHNldChpZDogc3RyaW5nLCBwcm9jOiBJUHJvY2VkdXJlTW9kZWwpOiB0aGlzIHtcbiAgICBpZiAodGhpcy5nZXQoaWQpID09PSBwcm9jKSByZXR1cm4gdGhpcztcbiAgICBzdXBlci5zZXQoaWQsIHByb2MpO1xuICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuUFJPQ0VEVVJFX0NSRUFURSkpKFxuICAgICAgICB0aGlzLndvcmtzcGFjZSwgcHJvYykpO1xuICAgIGlmIChpc09ic2VydmFibGUocHJvYykpIHByb2Muc3RhcnRQdWJsaXNoaW5nKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyB0aGUgUHJvY2VkdXJlTW9kZWwgd2l0aCB0aGUgZ2l2ZW4gSUQgZnJvbSB0aGUgcHJvY2VkdXJlIG1hcCAoaWYgaXRcbiAgICogZXhpc3RzKS5cbiAgICovXG4gIG92ZXJyaWRlIGRlbGV0ZShpZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcHJvYyA9IHRoaXMuZ2V0KGlkKTtcbiAgICBjb25zdCBleGlzdGVkID0gc3VwZXIuZGVsZXRlKGlkKTtcbiAgICBpZiAoIWV4aXN0ZWQpIHJldHVybiBleGlzdGVkO1xuICAgIHRyaWdnZXJQcm9jZWR1cmVzVXBkYXRlKHRoaXMud29ya3NwYWNlKTtcbiAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlBST0NFRFVSRV9ERUxFVEUpKShcbiAgICAgICAgdGhpcy53b3Jrc3BhY2UsIHByb2MpKTtcbiAgICBpZiAoaXNPYnNlcnZhYmxlKHByb2MpKSBwcm9jLnN0b3BQdWJsaXNoaW5nKCk7XG4gICAgcmV0dXJuIGV4aXN0ZWQ7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbGwgUHJvY2VkdXJlTW9kZWxzIGZyb20gdGhlIHByb2NlZHVyZSBtYXAuXG4gICAqL1xuICBvdmVycmlkZSBjbGVhcigpIHtcbiAgICBpZiAoIXRoaXMuc2l6ZSkgcmV0dXJuO1xuICAgIGZvciAoY29uc3QgaWQgb2YgdGhpcy5rZXlzKCkpIHtcbiAgICAgIGNvbnN0IHByb2MgPSB0aGlzLmdldChpZCk7XG4gICAgICBzdXBlci5kZWxldGUoaWQpO1xuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5QUk9DRURVUkVfREVMRVRFKSkoXG4gICAgICAgICAgdGhpcy53b3Jrc3BhY2UsIHByb2MpKTtcbiAgICB9XG4gICAgdHJpZ2dlclByb2NlZHVyZXNVcGRhdGUodGhpcy53b3Jrc3BhY2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIGdpdmVuIFByb2NlZHVyZU1vZGVsIHRvIHRoZSBtYXAgb2YgcHJvY2VkdXJlIG1vZGVscywgc28gdGhhdFxuICAgKiBibG9ja3MgY2FuIGZpbmQgaXQuXG4gICAqL1xuICBhZGQocHJvYzogSVByb2NlZHVyZU1vZGVsKTogdGhpcyB7XG4gICAgLy8gVE9ETygjNjUyNik6IFNlZSBpZiB0aGlzIG1ldGhvZCBpcyBhY3R1YWxseSB1c2VmdWwuXG4gICAgcmV0dXJuIHRoaXMuc2V0KHByb2MuZ2V0SWQoKSwgcHJvYyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbGwgb2YgdGhlIHByb2NlZHVyZXMgc3RvcmVkIGluIHRoaXMgbWFwLlxuICAgKi9cbiAgZ2V0UHJvY2VkdXJlcygpOiBJUHJvY2VkdXJlTW9kZWxbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLnZhbHVlcygpXTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4uL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge2dlblVpZH0gZnJvbSAnLi4vdXRpbHMvaWRnZW5lcmF0b3IuanMnO1xuaW1wb3J0IHR5cGUge0lQYXJhbWV0ZXJNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3BhcmFtZXRlcl9tb2RlbC5qcyc7XG5pbXBvcnQgdHlwZSB7SVByb2NlZHVyZU1vZGVsfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfcHJvY2VkdXJlX21vZGVsLmpzJztcbmltcG9ydCB7aXNPYnNlcnZhYmxlfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfb2JzZXJ2YWJsZS5qcyc7XG5pbXBvcnQge3RyaWdnZXJQcm9jZWR1cmVzVXBkYXRlfSBmcm9tICcuL3VwZGF0ZV9wcm9jZWR1cmVzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuZXhwb3J0IGNsYXNzIE9ic2VydmFibGVQcm9jZWR1cmVNb2RlbCBpbXBsZW1lbnRzIElQcm9jZWR1cmVNb2RlbCB7XG4gIHByaXZhdGUgaWQ6IHN0cmluZztcbiAgcHJpdmF0ZSBuYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgcGFyYW1ldGVyczogSVBhcmFtZXRlck1vZGVsW10gPSBbXTtcbiAgcHJpdmF0ZSByZXR1cm5UeXBlczogc3RyaW5nW118bnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZW5hYmxlZCA9IHRydWU7XG4gIHByaXZhdGUgc2hvdWxkRmlyZUV2ZW50cyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHJpdmF0ZSByZWFkb25seSB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgbmFtZTogc3RyaW5nLCBpZD86IHN0cmluZykge1xuICAgIHRoaXMuaWQgPSBpZCA/PyBnZW5VaWQoKTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG5cbiAgLyoqIFNldHMgdGhlIGh1bWFuLXJlYWRhYmxlIG5hbWUgb2YgdGhlIHByb2NlZHVyZS4gKi9cbiAgc2V0TmFtZShuYW1lOiBzdHJpbmcpOiB0aGlzIHtcbiAgICBpZiAobmFtZSA9PT0gdGhpcy5uYW1lKSByZXR1cm4gdGhpcztcbiAgICBjb25zdCBwcmV2TmFtZSA9IHRoaXMubmFtZTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRyaWdnZXJQcm9jZWR1cmVzVXBkYXRlKHRoaXMud29ya3NwYWNlKTtcbiAgICBpZiAodGhpcy5zaG91bGRGaXJlRXZlbnRzKSB7XG4gICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlBST0NFRFVSRV9SRU5BTUUpKShcbiAgICAgICAgICB0aGlzLndvcmtzcGFjZSwgdGhpcywgcHJldk5hbWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogSW5zZXJ0cyBhIHBhcmFtZXRlciBpbnRvIHRoZSBsaXN0IG9mIHBhcmFtZXRlcnMuXG4gICAqXG4gICAqIFRvIG1vdmUgYSBwYXJhbWV0ZXIsIGZpcnN0IGRlbGV0ZSBpdCwgYW5kIHRoZW4gcmUtaW5zZXJ0LlxuICAgKi9cbiAgaW5zZXJ0UGFyYW1ldGVyKHBhcmFtZXRlck1vZGVsOiBJUGFyYW1ldGVyTW9kZWwsIGluZGV4OiBudW1iZXIpOiB0aGlzIHtcbiAgICBpZiAodGhpcy5wYXJhbWV0ZXJzW2luZGV4XSAmJlxuICAgICAgICB0aGlzLnBhcmFtZXRlcnNbaW5kZXhdLmdldElkKCkgPT09IHBhcmFtZXRlck1vZGVsLmdldElkKCkpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHRoaXMucGFyYW1ldGVycy5zcGxpY2UoaW5kZXgsIDAsIHBhcmFtZXRlck1vZGVsKTtcbiAgICBwYXJhbWV0ZXJNb2RlbC5zZXRQcm9jZWR1cmVNb2RlbCh0aGlzKTtcbiAgICBpZiAoaXNPYnNlcnZhYmxlKHBhcmFtZXRlck1vZGVsKSkge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkRmlyZUV2ZW50cykge1xuICAgICAgICBwYXJhbWV0ZXJNb2RlbC5zdGFydFB1Ymxpc2hpbmcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmFtZXRlck1vZGVsLnN0b3BQdWJsaXNoaW5nKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdHJpZ2dlclByb2NlZHVyZXNVcGRhdGUodGhpcy53b3Jrc3BhY2UpO1xuICAgIGlmICh0aGlzLnNob3VsZEZpcmVFdmVudHMpIHtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShcbiAgICAgICAgICBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1BBUkFNRVRFUl9DUkVBVEUpKShcbiAgICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UsIHRoaXMsIHBhcmFtZXRlck1vZGVsLCBpbmRleCkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKiBSZW1vdmVzIHRoZSBwYXJhbWV0ZXIgYXQgdGhlIGdpdmVuIGluZGV4IGZyb20gdGhlIHBhcmFtZXRlciBsaXN0LiAqL1xuICBkZWxldGVQYXJhbWV0ZXIoaW5kZXg6IG51bWJlcik6IHRoaXMge1xuICAgIGlmICghdGhpcy5wYXJhbWV0ZXJzW2luZGV4XSkgcmV0dXJuIHRoaXM7XG4gICAgY29uc3Qgb2xkUGFyYW0gPSB0aGlzLnBhcmFtZXRlcnNbaW5kZXhdO1xuXG4gICAgdGhpcy5wYXJhbWV0ZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgdHJpZ2dlclByb2NlZHVyZXNVcGRhdGUodGhpcy53b3Jrc3BhY2UpO1xuICAgIGlmIChpc09ic2VydmFibGUob2xkUGFyYW0pKSB7XG4gICAgICBvbGRQYXJhbS5zdG9wUHVibGlzaGluZygpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNob3VsZEZpcmVFdmVudHMpIHtcbiAgICAgIGV2ZW50VXRpbHMuZmlyZShcbiAgICAgICAgICBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1BBUkFNRVRFUl9ERUxFVEUpKShcbiAgICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UsIHRoaXMsIG9sZFBhcmFtLCBpbmRleCkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHdoZXRoZXIgdGhlIHByb2NlZHVyZSBoYXMgYSByZXR1cm4gdmFsdWUgKGVtcHR5IGFycmF5KSBvciBubyByZXR1cm5cbiAgICogdmFsdWUgKG51bGwpLlxuICAgKlxuICAgKiBUaGUgYnVpbHQtaW4gcHJvY2VkdXJlIG1vZGVsIGRvZXMgbm90IHN1cHBvcnQgcHJvY2VkdXJlcyB0aGF0IGhhdmUgYWN0dWFsXG4gICAqIHJldHVybiB0eXBlcyAoaS5lLiBub24tZW1wdHkgYXJyYXlzLCBlLmcuIFsnbnVtYmVyJ10pLiBJZiB5b3Ugd2FudCB5b3VyXG4gICAqIHByb2NlZHVyZSBibG9jayB0byBoYXZlIHJldHVybiB0eXBlcywgeW91IG5lZWQgdG8gaW1wbGVtZW50IHlvdXIgb3duXG4gICAqIHByb2NlZHVyZSBtb2RlbC5cbiAgICovXG4gIHNldFJldHVyblR5cGVzKHR5cGVzOiBzdHJpbmdbXXxudWxsKTogdGhpcyB7XG4gICAgaWYgKHR5cGVzICYmIHR5cGVzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYnVpbHQtaW4gUHJvY2VkdXJlTW9kZWwgZG9lcyBub3Qgc3VwcG9ydCB0eXBpbmcuIFlvdSBuZWVkIHRvICcgK1xuICAgICAgICAgICdpbXBsZW1lbnQgeW91ciBvd24gY3VzdG9tIFByb2NlZHVyZU1vZGVsLicpO1xuICAgIH1cbiAgICAvLyBFaXRoZXIgdGhleSdyZSBib3RoIGFuIGVtcHR5IGFycmF5LCBvciBib3RoIG51bGwuIE5vb3AgZWl0aGVyIHdheS5cbiAgICBpZiAoISF0eXBlcyA9PT0gISF0aGlzLnJldHVyblR5cGVzKSByZXR1cm4gdGhpcztcbiAgICBjb25zdCBvbGRSZXR1cm5UeXBlcyA9IHRoaXMucmV0dXJuVHlwZXM7XG4gICAgdGhpcy5yZXR1cm5UeXBlcyA9IHR5cGVzO1xuICAgIHRyaWdnZXJQcm9jZWR1cmVzVXBkYXRlKHRoaXMud29ya3NwYWNlKTtcbiAgICBpZiAodGhpcy5zaG91bGRGaXJlRXZlbnRzKSB7XG4gICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlBST0NFRFVSRV9DSEFOR0VfUkVUVVJOKSkoXG4gICAgICAgICAgdGhpcy53b3Jrc3BhY2UsIHRoaXMsIG9sZFJldHVyblR5cGVzKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgd2hldGhlciB0aGlzIHByb2NlZHVyZSBpcyBlbmFibGVkL2Rpc2FibGVkLiBJZiBhIHByb2NlZHVyZSBpcyBkaXNhYmxlZFxuICAgKiBhbGwgcHJvY2VkdXJlIGNhbGxlciBibG9ja3Mgc2hvdWxkIGJlIGRpc2FibGVkIGFzIHdlbGwuXG4gICAqL1xuICBzZXRFbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pOiB0aGlzIHtcbiAgICBpZiAoZW5hYmxlZCA9PT0gdGhpcy5lbmFibGVkKSByZXR1cm4gdGhpcztcbiAgICB0aGlzLmVuYWJsZWQgPSBlbmFibGVkO1xuICAgIHRyaWdnZXJQcm9jZWR1cmVzVXBkYXRlKHRoaXMud29ya3NwYWNlKTtcbiAgICBpZiAodGhpcy5zaG91bGRGaXJlRXZlbnRzKSB7XG4gICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlBST0NFRFVSRV9FTkFCTEUpKShcbiAgICAgICAgICB0aGlzLndvcmtzcGFjZSwgdGhpcykpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKiBSZXR1cm5zIHRoZSB1bmlxdWUgbGFuZ3VhZ2UtbmV1dHJhbCBJRCBmb3IgdGhlIHByb2NlZHVyZS4gKi9cbiAgZ2V0SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxuXG4gIC8qKiBSZXR1cm5zIHRoZSBodW1hbi1yZWFkYWJsZSBuYW1lIG9mIHRoZSBwcm9jZWR1cmUuICovXG4gIGdldE5hbWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5uYW1lO1xuICB9XG5cbiAgLyoqIFJldHVybnMgdGhlIHBhcmFtZXRlciBhdCB0aGUgZ2l2ZW4gaW5kZXggaW4gdGhlIHBhcmFtZXRlciBsaXN0LiAqL1xuICBnZXRQYXJhbWV0ZXIoaW5kZXg6IG51bWJlcik6IElQYXJhbWV0ZXJNb2RlbCB7XG4gICAgcmV0dXJuIHRoaXMucGFyYW1ldGVyc1tpbmRleF07XG4gIH1cblxuICAvKiogUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgb2YgdGhlIHBhcmFtZXRlcnMgaW4gdGhlIHBhcmFtZXRlciBsaXN0LiAqL1xuICBnZXRQYXJhbWV0ZXJzKCk6IElQYXJhbWV0ZXJNb2RlbFtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMucGFyYW1ldGVyc107XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcmV0dXJuIHR5cGUgb2YgdGhlIHByb2NlZHVyZS5cbiAgICpcbiAgICogTnVsbCByZXByZXNlbnRzIGEgcHJvY2VkdXJlIHRoYXQgZG9lcyBub3QgcmV0dXJuIGEgdmFsdWUuXG4gICAqL1xuICBnZXRSZXR1cm5UeXBlcygpOiBzdHJpbmdbXXxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5yZXR1cm5UeXBlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHByb2NlZHVyZSBpcyBlbmFibGVkL2Rpc2FibGVkLiBJZiBhIHByb2NlZHVyZSBpc1xuICAgKiBkaXNhYmxlZCwgYWxsIHByb2NlZHVyZSBjYWxsZXIgYmxvY2tzIHNob3VsZCBiZSBkaXNhYmxlZCBhcyB3ZWxsLlxuICAgKi9cbiAgZ2V0RW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5lbmFibGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFRlbGxzIHRoZSBwcm9jZWR1cmUgbW9kZWwgaXQgc2hvdWxkIGZpcmUgZXZlbnRzLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXJ0UHVibGlzaGluZygpIHtcbiAgICB0aGlzLnNob3VsZEZpcmVFdmVudHMgPSB0cnVlO1xuICAgIGZvciAoY29uc3QgcGFyYW0gb2YgdGhpcy5wYXJhbWV0ZXJzKSB7XG4gICAgICBpZiAoaXNPYnNlcnZhYmxlKHBhcmFtKSkgcGFyYW0uc3RhcnRQdWJsaXNoaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRlbGxzIHRoZSBwcm9jZWR1cmUgbW9kZWwgaXQgc2hvdWxkIG5vdCBmaXJlIGV2ZW50cy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdG9wUHVibGlzaGluZygpIHtcbiAgICB0aGlzLnNob3VsZEZpcmVFdmVudHMgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IHBhcmFtIG9mIHRoaXMucGFyYW1ldGVycykge1xuICAgICAgaWYgKGlzT2JzZXJ2YWJsZShwYXJhbSkpIHBhcmFtLnN0b3BQdWJsaXNoaW5nKCk7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB7Z2VuVWlkfSBmcm9tICcuLi91dGlscy9pZGdlbmVyYXRvci5qcyc7XG5pbXBvcnQgdHlwZSB7SVBhcmFtZXRlck1vZGVsfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfcGFyYW1ldGVyX21vZGVsLmpzJztcbmltcG9ydCB0eXBlIHtJUHJvY2VkdXJlTW9kZWx9IGZyb20gJy4uL2ludGVyZmFjZXMvaV9wcm9jZWR1cmVfbW9kZWwnO1xuaW1wb3J0IHt0cmlnZ2VyUHJvY2VkdXJlc1VwZGF0ZX0gZnJvbSAnLi91cGRhdGVfcHJvY2VkdXJlcy5qcyc7XG5pbXBvcnQgdHlwZSB7VmFyaWFibGVNb2RlbH0gZnJvbSAnLi4vdmFyaWFibGVfbW9kZWwuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG5leHBvcnQgY2xhc3MgT2JzZXJ2YWJsZVBhcmFtZXRlck1vZGVsIGltcGxlbWVudHMgSVBhcmFtZXRlck1vZGVsIHtcbiAgcHJpdmF0ZSBpZDogc3RyaW5nO1xuICBwcml2YXRlIHZhcmlhYmxlOiBWYXJpYWJsZU1vZGVsO1xuICBwcml2YXRlIHNob3VsZEZpcmVFdmVudHMgPSBmYWxzZTtcbiAgcHJpdmF0ZSBwcm9jZWR1cmVNb2RlbDogSVByb2NlZHVyZU1vZGVsfG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHJpdmF0ZSByZWFkb25seSB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgbmFtZTogc3RyaW5nLCBpZD86IHN0cmluZykge1xuICAgIHRoaXMuaWQgPSBpZCA/PyBnZW5VaWQoKTtcbiAgICB0aGlzLnZhcmlhYmxlID1cbiAgICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0VmFyaWFibGUobmFtZSkgPz8gd29ya3NwYWNlLmNyZWF0ZVZhcmlhYmxlKG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIG5hbWUgb2YgdGhpcyBwYXJhbWV0ZXIgdG8gdGhlIGdpdmVuIG5hbWUuXG4gICAqL1xuICBzZXROYW1lKG5hbWU6IHN0cmluZyk6IHRoaXMge1xuICAgIGlmIChuYW1lID09PSB0aGlzLnZhcmlhYmxlLm5hbWUpIHJldHVybiB0aGlzO1xuICAgIGNvbnN0IG9sZE5hbWUgPSB0aGlzLnZhcmlhYmxlLm5hbWU7XG4gICAgdGhpcy52YXJpYWJsZSA9XG4gICAgICAgIHRoaXMud29ya3NwYWNlLmdldFZhcmlhYmxlKG5hbWUpID8/IHRoaXMud29ya3NwYWNlLmNyZWF0ZVZhcmlhYmxlKG5hbWUpO1xuICAgIHRyaWdnZXJQcm9jZWR1cmVzVXBkYXRlKHRoaXMud29ya3NwYWNlKTtcbiAgICBpZiAodGhpcy5zaG91bGRGaXJlRXZlbnRzKSB7XG4gICAgICBldmVudFV0aWxzLmZpcmUoXG4gICAgICAgICAgbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlBST0NFRFVSRV9QQVJBTUVURVJfUkVOQU1FKSkoXG4gICAgICAgICAgICAgIHRoaXMud29ya3NwYWNlLCB0aGlzLnByb2NlZHVyZU1vZGVsLCB0aGlzLCBvbGROYW1lKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuaW1wbGVtZW50ZWQuIFRoZSBidWlsdC1pbiBQYXJhbWV0ZXJNb2RlbCBkb2VzIG5vdCBzdXBwb3J0IHR5cGluZy5cbiAgICogSWYgeW91IHdhbnQgeW91ciBwcm9jZWR1cmUgYmxvY2tzIHRvIGhhdmUgdHlwZWQgcGFyYW1ldGVycywgeW91IG5lZWQgdG9cbiAgICogaW1wbGVtZW50IHlvdXIgb3duIFBhcmFtZXRlck1vZGVsLlxuICAgKlxuICAgKiBAdGhyb3dzIFRocm93cyBmb3IgdGhlIE9ic2VydmFibGVQYXJhbWV0ZXJNb2RlbCBzcGVjaWZpY2FsbHkgYmVjYXVzZSB0aGlzXG4gICAqICAgICBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZC5cbiAgICovXG4gIHNldFR5cGVzKF90eXBlczogc3RyaW5nW10pOiB0aGlzIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUaGUgYnVpbHQtaW4gUGFyYW1ldGVyTW9kZWwgZG9lcyBub3Qgc3VwcG9ydCB0eXBpbmcuIFlvdSBuZWVkIHRvICcgK1xuICAgICAgICAnaW1wbGVtZW50IHlvdXIgb3duIGN1c3RvbSBQYXJhbWV0ZXJNb2RlbC4nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBuYW1lIG9mIHRoaXMgcGFyYW1ldGVyLlxuICAgKi9cbiAgZ2V0TmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnZhcmlhYmxlLm5hbWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdHlwZXMgb2YgdGhpcyBwYXJhbWV0ZXIuXG4gICAqL1xuICBnZXRUeXBlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHVuaXF1ZSBsYW5ndWFnZS1uZXV0cmFsIElEIGZvciB0aGUgcGFyYW1ldGVyLlxuICAgKlxuICAgKiBUaGlzIHJlcHJlc2VudHMgdGhlIGlkZW50aWZ5IG9mIHRoZSB2YXJpYWJsZSBtb2RlbCB3aGljaCBkb2VzIG5vdCBjaGFuZ2VcbiAgICogb3ZlciB0aW1lLlxuICAgKi9cbiAgZ2V0SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxuXG4gIC8qKiBSZXR1cm5zIHRoZSB2YXJpYWJsZSBtb2RlbCBhc3NvY2lhdGVkIHdpdGggdGhlIHBhcmFtZXRlciBtb2RlbC4gKi9cbiAgZ2V0VmFyaWFibGVNb2RlbCgpOiBWYXJpYWJsZU1vZGVsIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUZWxscyB0aGUgcGFyYW1ldGVyIG1vZGVsIGl0IHNob3VsZCBmaXJlIGV2ZW50cy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGFydFB1Ymxpc2hpbmcoKSB7XG4gICAgdGhpcy5zaG91bGRGaXJlRXZlbnRzID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUZWxscyB0aGUgcGFyYW1ldGVyIG1vZGVsIGl0IHNob3VsZCBub3QgZmlyZSBldmVudHMuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RvcFB1Ymxpc2hpbmcoKSB7XG4gICAgdGhpcy5zaG91bGRGaXJlRXZlbnRzID0gZmFsc2U7XG4gIH1cblxuICAvKiogU2V0cyB0aGUgcHJvY2VkdXJlIG1vZGVsIHRoaXMgcGFyYW1ldGVyIGlzIGEgcGFydCBvZi4gKi9cbiAgc2V0UHJvY2VkdXJlTW9kZWwobW9kZWw6IElQcm9jZWR1cmVNb2RlbCk6IHRoaXMge1xuICAgIC8vIFRPRE86IE5vdCBzdXJlIGlmIHdlIHdhbnQgdG8gZG8gdGhpcywgb3IgYWNjZXB0IGl0IHZpYSB0aGUgY29uc3RydWN0b3IuXG4gICAgLy8gICBUaGF0IG1lYW5zIGl0IGNvdWxkIGJlIG5vbi1udWxsLCBidXQgaXQgd291bGQgYWxzbyBicmVhayB0aGUgZmx1ZW50XG4gICAgLy8gICBBUEkuXG4gICAgdGhpcy5wcm9jZWR1cmVNb2RlbCA9IG1vZGVsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWVhc3VyYWJsZSB0eXBlcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuVHlwZXNcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5UeXBlcycpO1xuXG5pbXBvcnQgdHlwZSB7TWVhc3VyYWJsZX0gZnJvbSAnLi9iYXNlLmpzJztcbmltcG9ydCB0eXBlIHtSb3d9IGZyb20gJy4vcm93LmpzJztcblxuXG4vKipcbiAqIFR5cGVzIG9mIHJlbmRlcmluZyBlbGVtZW50cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5UeXBlc1xuICovXG5jbGFzcyBUeXBlc0NvbnRhaW5lciB7XG4gIFtpbmRleDogc3RyaW5nXTogbnVtYmVyfEZ1bmN0aW9uO1xuXG4gIE5PTkUgPSAwOyAgICAgICAgICAgICAgICAgICAgICAgLy8gTm9uZVxuICBGSUVMRCA9IDEgPDwgMDsgICAgICAgICAgICAgICAgIC8vIEZpZWxkLlxuICBIQVQgPSAxIDw8IDE7ICAgICAgICAgICAgICAgICAgIC8vIEhhdC5cbiAgSUNPTiA9IDEgPDwgMjsgICAgICAgICAgICAgICAgICAvLyBJY29uLlxuICBTUEFDRVIgPSAxIDw8IDM7ICAgICAgICAgICAgICAgIC8vIFNwYWNlci5cbiAgQkVUV0VFTl9ST1dfU1BBQ0VSID0gMSA8PCA0OyAgICAvLyBCZXR3ZWVuIFJvdyBTcGFjZXIuXG4gIElOX1JPV19TUEFDRVIgPSAxIDw8IDU7ICAgICAgICAgLy8gSW4gUm93IFNwYWNlci5cbiAgRVhURVJOQUxfVkFMVUVfSU5QVVQgPSAxIDw8IDY7ICAvLyBFeHRlcm5hbCBWYWx1ZSBJbnB1dC5cbiAgSU5QVVQgPSAxIDw8IDc7ICAgICAgICAgICAgICAgICAvLyBJbnB1dC5cbiAgSU5MSU5FX0lOUFVUID0gMSA8PCA4OyAgICAgICAgICAvLyBJbmxpbmUgSW5wdXQuXG4gIFNUQVRFTUVOVF9JTlBVVCA9IDEgPDwgOTsgICAgICAgLy8gU3RhdGVtZW50IElucHV0LlxuICBDT05ORUNUSU9OID0gMSA8PCAxMDsgICAgICAgICAgIC8vIENvbm5lY3Rpb24uXG4gIFBSRVZJT1VTX0NPTk5FQ1RJT04gPSAxIDw8IDExOyAgLy8gUHJldmlvdXMgQ29ubmVjdGlvbi5cbiAgTkVYVF9DT05ORUNUSU9OID0gMSA8PCAxMjsgICAgICAvLyBOZXh0IENvbm5lY3Rpb24uXG4gIE9VVFBVVF9DT05ORUNUSU9OID0gMSA8PCAxMzsgICAgLy8gT3V0cHV0IENvbm5lY3Rpb24uXG4gIENPUk5FUiA9IDEgPDwgMTQ7ICAgICAgICAgICAgICAgLy8gQ29ybmVyLlxuICBMRUZUX1NRVUFSRV9DT1JORVIgPSAxIDw8IDE1OyAgIC8vIFNxdWFyZSBDb3JuZXIuXG4gIExFRlRfUk9VTkRfQ09STkVSID0gMSA8PCAxNjsgICAgLy8gUm91bmQgQ29ybmVyLlxuICBSSUdIVF9TUVVBUkVfQ09STkVSID0gMSA8PCAxNzsgIC8vIFJpZ2h0IFNxdWFyZSBDb3JuZXIuXG4gIFJJR0hUX1JPVU5EX0NPUk5FUiA9IDEgPDwgMTg7ICAgLy8gUmlnaHQgUm91bmQgQ29ybmVyLlxuICBKQUdHRURfRURHRSA9IDEgPDwgMTk7ICAgICAgICAgIC8vIEphZ2dlZCBFZGdlLlxuICBST1cgPSAxIDw8IDIwOyAgICAgICAgICAgICAgICAgIC8vIFJvdy5cbiAgVE9QX1JPVyA9IDEgPDwgMjE7ICAgICAgICAgICAgICAvLyBUb3AgUm93LlxuICBCT1RUT01fUk9XID0gMSA8PCAyMjsgICAgICAgICAgIC8vIEJvdHRvbSBSb3cuXG4gIElOUFVUX1JPVyA9IDEgPDwgMjM7ICAgICAgICAgICAgLy8gSW5wdXQgUm93LlxuXG4gIC8qKlxuICAgKiBBIExlZnQgQ29ybmVyIFVuaW9uIFR5cGUuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgTEVGVF9DT1JORVIgPSB0aGlzLkxFRlRfU1FVQVJFX0NPUk5FUiB8IHRoaXMuTEVGVF9ST1VORF9DT1JORVI7XG5cbiAgLyoqXG4gICAqIEEgUmlnaHQgQ29ybmVyIFVuaW9uIFR5cGUuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgUklHSFRfQ09STkVSID0gdGhpcy5SSUdIVF9TUVVBUkVfQ09STkVSIHwgdGhpcy5SSUdIVF9ST1VORF9DT1JORVI7XG5cbiAgLyoqXG4gICAqIE5leHQgZmxhZyB2YWx1ZSB0byB1c2UgZm9yIGN1c3RvbSByZW5kZXJpbmcgZWxlbWVudCB0eXBlcy5cbiAgICogVGhpcyBtdXN0IGJlIHVwZGF0ZWQgdG8gcmVmbGVjdCB0aGUgbmV4dCBlbnVtIGZsYWcgdmFsdWVcbiAgICogdG8gdXNlIGlmIGFkZGl0aW9uYWwgZWxlbWVudHMgYXJlIGFkZGVkIHRvXG4gICAqIGBUeXBlc2AuXG4gICAqL1xuICBuZXh0VHlwZVZhbHVlXyA9IDEgPDwgMjQ7XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgZW51bSBmbGFnIHZhbHVlIG9mIGFuIGV4aXN0aW5nIHR5cGUgb3IgcmVnaXN0ZXIgYSBuZXcgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgVGhlIG5hbWUgb2YgdGhlIHR5cGUuXG4gICAqIEByZXR1cm5zIFRoZSBlbnVtIGZsYWcgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRoYXQgdHlwZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRUeXBlKHR5cGU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGhpcywgdHlwZSkpIHtcbiAgICAgIHRoaXNbdHlwZV0gPSB0aGlzLm5leHRUeXBlVmFsdWVfO1xuICAgICAgdGhpcy5uZXh0VHlwZVZhbHVlXyA8PD0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXNbdHlwZV0gYXMgbnVtYmVyO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGZpZWxkLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGZpZWxkLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzRmllbGQoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuRklFTEQ7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgaGF0LlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGhhdC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0hhdChlbGVtOiBNZWFzdXJhYmxlKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZWxlbS50eXBlICYgdGhpcy5IQVQ7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGFuIGljb24uXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtIFRoZSBlbGVtZW50IHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyAxIGlmIHRoZSBvYmplY3Qgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGFuIGljb24uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNJY29uKGVsZW06IE1lYXN1cmFibGUpOiBudW1iZXIge1xuICAgIHJldHVybiBlbGVtLnR5cGUgJiB0aGlzLklDT047XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgc3BhY2VyLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIHNwYWNlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc1NwYWNlcihlbGVtOiBNZWFzdXJhYmxlfFJvdyk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuU1BBQ0VSO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhbiBpbi1yb3cgc3BhY2VyLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhbiBpbi1yb3cgc3BhY2VyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzSW5Sb3dTcGFjZXIoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuSU5fUk9XX1NQQUNFUjtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYW4gaW5wdXQuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtIFRoZSBlbGVtZW50IHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyAxIGlmIHRoZSBvYmplY3Qgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGFuIGlucHV0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzSW5wdXQoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuSU5QVVQ7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGFuIGV4dGVybmFsIGlucHV0LlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhbiBleHRlcm5hbCBpbnB1dC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0V4dGVybmFsSW5wdXQoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuRVhURVJOQUxfVkFMVUVfSU5QVVQ7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGFuIGlubGluZSBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYW4gaW5saW5lIGlucHV0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzSW5saW5lSW5wdXQoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuSU5MSU5FX0lOUFVUO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIHN0YXRlbWVudCBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBzdGF0ZW1lbnQgaW5wdXQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNTdGF0ZW1lbnRJbnB1dChlbGVtOiBNZWFzdXJhYmxlKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZWxlbS50eXBlICYgdGhpcy5TVEFURU1FTlRfSU5QVVQ7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgcHJldmlvdXMgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBwcmV2aW91cyBjb25uZWN0aW9uLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzUHJldmlvdXNDb25uZWN0aW9uKGVsZW06IE1lYXN1cmFibGUpOiBudW1iZXIge1xuICAgIHJldHVybiBlbGVtLnR5cGUgJiB0aGlzLlBSRVZJT1VTX0NPTk5FQ1RJT047XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgbmV4dCBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIG5leHQgY29ubmVjdGlvbi5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc05leHRDb25uZWN0aW9uKGVsZW06IE1lYXN1cmFibGUpOiBudW1iZXIge1xuICAgIHJldHVybiBlbGVtLnR5cGUgJiB0aGlzLk5FWFRfQ09OTkVDVElPTjtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBwcmV2aW91cyBvciBuZXh0XG4gICAqIGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtIFRoZSBlbGVtZW50IHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyAxIGlmIHRoZSBvYmplY3Qgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgcHJldmlvdXMgb3IgbmV4dFxuICAgKiAgICAgY29ubmVjdGlvbi5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc1ByZXZpb3VzT3JOZXh0Q29ubmVjdGlvbihlbGVtOiBNZWFzdXJhYmxlKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZWxlbS50eXBlICYgKHRoaXMuUFJFVklPVVNfQ09OTkVDVElPTiB8IHRoaXMuTkVYVF9DT05ORUNUSU9OKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBsZWZ0IHJvdW5kIGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBsZWZ0IHJvdW5kIGNvcm5lci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0xlZnRSb3VuZGVkQ29ybmVyKGVsZW06IE1lYXN1cmFibGUpOiBudW1iZXIge1xuICAgIHJldHVybiBlbGVtLnR5cGUgJiB0aGlzLkxFRlRfUk9VTkRfQ09STkVSO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIHJpZ2h0IHJvdW5kIGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSByaWdodCByb3VuZCBjb3JuZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNSaWdodFJvdW5kZWRDb3JuZXIoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuUklHSFRfUk9VTkRfQ09STkVSO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGxlZnQgc3F1YXJlIGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBsZWZ0IHNxdWFyZSBjb3JuZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNMZWZ0U3F1YXJlQ29ybmVyKGVsZW06IE1lYXN1cmFibGUpOiBudW1iZXIge1xuICAgIHJldHVybiBlbGVtLnR5cGUgJiB0aGlzLkxFRlRfU1FVQVJFX0NPUk5FUjtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSByaWdodCBzcXVhcmUgY29ybmVyLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIHJpZ2h0IHNxdWFyZSBjb3JuZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNSaWdodFNxdWFyZUNvcm5lcihlbGVtOiBNZWFzdXJhYmxlKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZWxlbS50eXBlICYgdGhpcy5SSUdIVF9TUVVBUkVfQ09STkVSO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBjb3JuZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNDb3JuZXIoZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGVsZW0udHlwZSAmIHRoaXMuQ09STkVSO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGphZ2dlZCBlZGdlLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIGphZ2dlZCBlZGdlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzSmFnZ2VkRWRnZShlbGVtOiBNZWFzdXJhYmxlKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZWxlbS50eXBlICYgdGhpcy5KQUdHRURfRURHRTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSByb3cuXG4gICAqXG4gICAqIEBwYXJhbSByb3cgVGhlIHJvdyB0byBjaGVjay5cbiAgICogQHJldHVybnMgMSBpZiB0aGUgb2JqZWN0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIHJvdy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc1Jvdyhyb3c6IFJvdyk6IG51bWJlciB7XG4gICAgcmV0dXJuIHJvdy50eXBlICYgdGhpcy5ST1c7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgYmV0d2Vlbi1yb3cgc3BhY2VyLlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSByb3cgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBiZXR3ZWVuLXJvdyBzcGFjZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaXNCZXR3ZWVuUm93U3BhY2VyKHJvdzogUm93KTogbnVtYmVyIHtcbiAgICByZXR1cm4gcm93LnR5cGUgJiB0aGlzLkJFVFdFRU5fUk9XX1NQQUNFUjtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSB0b3Agcm93LlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSByb3cgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSB0b3Agcm93LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzVG9wUm93KHJvdzogUm93KTogbnVtYmVyIHtcbiAgICByZXR1cm4gcm93LnR5cGUgJiB0aGlzLlRPUF9ST1c7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciBhIG1lYXN1cmFibGUgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgYm90dG9tIHJvdy5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyAxIGlmIHRoZSBvYmplY3Qgc3RvcmVzIGluZm9ybWF0aW9uIGFib3V0IGEgYm90dG9tIHJvdy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0JvdHRvbVJvdyhyb3c6IFJvdyk6IG51bWJlciB7XG4gICAgcmV0dXJuIHJvdy50eXBlICYgdGhpcy5CT1RUT01fUk9XO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBtZWFzdXJhYmxlIHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBhIHRvcCBvciBib3R0b20gcm93LlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSByb3cgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSB0b3Agb3IgYm90dG9tIHJvdy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc1RvcE9yQm90dG9tUm93KHJvdzogUm93KTogbnVtYmVyIHtcbiAgICByZXR1cm4gcm93LnR5cGUgJiAodGhpcy5UT1BfUk9XIHwgdGhpcy5CT1RUT01fUk9XKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgbWVhc3VyYWJsZSBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYW4gaW5wdXQgcm93LlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSByb3cgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIDEgaWYgdGhlIG9iamVjdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYW4gaW5wdXQgcm93LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGlzSW5wdXRSb3cocm93OiBSb3cpOiBudW1iZXIge1xuICAgIHJldHVybiByb3cudHlwZSAmIHRoaXMuSU5QVVRfUk9XO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBUeXBlcyA9IG5ldyBUeXBlc0NvbnRhaW5lcigpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1ldGhvZHMgZm9yIGdyYXBoaWNhbGx5IHJlbmRlcmluZyBhIGJsb2NrIGFzIFNWRy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5NZWFzdXJhYmxlJyk7XG5cbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBUaGUgYmFzZSBjbGFzcyB0byByZXByZXNlbnQgYSBwYXJ0IG9mIGEgYmxvY2sgdGhhdCB0YWtlcyB1cCBzcGFjZSBkdXJpbmdcbiAqIHJlbmRlcmluZy4gIFRoZSBjb25zdHJ1Y3RvciBmb3IgZWFjaCBub24tc3BhY2VyIE1lYXN1cmFibGUgcmVjb3JkcyB0aGUgc2l6ZVxuICogb2YgdGhlIGJsb2NrIGVsZW1lbnQgKGUuZy4gZmllbGQsIHN0YXRlbWVudCBpbnB1dCkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuTWVhc3VyYWJsZVxuICovXG5leHBvcnQgY2xhc3MgTWVhc3VyYWJsZSB7XG4gIHdpZHRoID0gMDtcblxuICBoZWlnaHQgPSAwO1xuICB0eXBlOiBudW1iZXI7XG4gIHhQb3MgPSAwO1xuXG4gIGNlbnRlcmxpbmUgPSAwO1xuICBub3RjaE9mZnNldDogbnVtYmVyO1xuXG4gIC8qKiBUaGUgcmVuZGVyZXIncyBjb25zdGFudCBwcm92aWRlci4gKi9cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGNvbnN0YW50c186IENvbnN0YW50UHJvdmlkZXI7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyKSB7XG4gICAgdGhpcy5jb25zdGFudHNfID0gY29uc3RhbnRzO1xuXG4gICAgdGhpcy50eXBlID0gVHlwZXMuTk9ORTtcblxuICAgIHRoaXMubm90Y2hPZmZzZXQgPSB0aGlzLmNvbnN0YW50c18uTk9UQ0hfT0ZGU0VUX0xFRlQ7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGEgc2luZ2xlIHJvdyBvbiBhIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlJvdycpO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB0eXBlIHtNZWFzdXJhYmxlfSBmcm9tICcuL2Jhc2UuanMnO1xuaW1wb3J0IHR5cGUge0luUm93U3BhY2VyfSBmcm9tICcuL2luX3Jvd19zcGFjZXIuanMnO1xuaW1wb3J0IHR5cGUge0lucHV0Q29ubmVjdGlvbn0gZnJvbSAnLi9pbnB1dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IHJlcHJlc2VudGluZyBhIHNpbmdsZSByb3cgb24gYSByZW5kZXJlZCBibG9jayBhbmQgYWxsIG9mIGl0c1xuICogc3ViY29tcG9uZW50cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5Sb3dcbiAqL1xuZXhwb3J0IGNsYXNzIFJvdyB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgdHlwZTogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBBbiBhcnJheSBvZiBlbGVtZW50cyBjb250YWluZWQgaW4gdGhpcyByb3cuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZWxlbWVudHM6IE1lYXN1cmFibGVbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBUaGUgaGVpZ2h0IG9mIHRoZSByb3cuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGVpZ2h0ID0gMDtcblxuICAvKipcbiAgICogVGhlIHdpZHRoIG9mIHRoZSByb3csIGZyb20gdGhlIGxlZnQgZWRnZSBvZiB0aGUgYmxvY2sgdG8gdGhlIHJpZ2h0LlxuICAgKiBEb2VzIG5vdCBpbmNsdWRlIGNoaWxkIGJsb2NrcyB1bmxlc3MgdGhleSBhcmUgaW5saW5lLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHdpZHRoID0gMDtcblxuICAvKipcbiAgICogVGhlIG1pbmltdW0gaGVpZ2h0IG9mIHRoZSByb3cuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWluSGVpZ2h0ID0gMDtcblxuICAvKipcbiAgICogVGhlIG1pbmltdW0gd2lkdGggb2YgdGhlIHJvdywgZnJvbSB0aGUgbGVmdCBlZGdlIG9mIHRoZSBibG9jayB0byB0aGVcbiAgICogcmlnaHQuIERvZXMgbm90IGluY2x1ZGUgY2hpbGQgYmxvY2tzIHVubGVzcyB0aGV5IGFyZSBpbmxpbmUuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWluV2lkdGggPSAwO1xuXG4gIC8qKlxuICAgKiBUaGUgd2lkdGggb2YgdGhlIHJvdywgZnJvbSB0aGUgbGVmdCBlZGdlIG9mIHRoZSBibG9jayB0byB0aGUgZWRnZSBvZiB0aGVcbiAgICogYmxvY2sgb3IgYW55IGNvbm5lY3RlZCBjaGlsZCBibG9ja3MuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgd2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzID0gMDtcblxuICAvKipcbiAgICogVGhlIFkgcG9zaXRpb24gb2YgdGhlIHJvdyByZWxhdGl2ZSB0byB0aGUgb3JpZ2luIG9mIHRoZSBibG9jaydzIHN2Z1xuICAgKiBncm91cC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICB5UG9zID0gMDtcblxuICAvKipcbiAgICogVGhlIFggcG9zaXRpb24gb2YgdGhlIHJvdyByZWxhdGl2ZSB0byB0aGUgb3JpZ2luIG9mIHRoZSBibG9jaydzIHN2Z1xuICAgKiBncm91cC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICB4UG9zID0gMDtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgcm93IGhhcyBhbnkgZXh0ZXJuYWwgaW5wdXRzLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhc0V4dGVybmFsSW5wdXQgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgcm93IGhhcyBhbnkgc3RhdGVtZW50IGlucHV0cy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYXNTdGF0ZW1lbnQgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hlcmUgdGhlIGxlZnQgZWRnZSBvZiBhbGwgb2YgdGhlIHN0YXRlbWVudCBpbnB1dHMgb24gdGhlIGJsb2NrIHNob3VsZFxuICAgKiBiZS4gVGhpcyBtYWtlcyBzdXJlIHRoYXQgc3RhdGVtZW50IGlucHV0cyB3aGljaCBhcmUgcHJvY2VkZWQgYnkgZmllbGRzXG4gICAqIG9mIHZhcml1cyB3aWR0aHMgYXJlIGFsbCBhbGlnbmVkLlxuICAgKi9cbiAgc3RhdGVtZW50RWRnZSA9IDA7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHJvdyBoYXMgYW55IGlubGluZSBpbnB1dHMuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaGFzSW5saW5lSW5wdXQgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgcm93IGhhcyBhbnkgZHVtbXkgaW5wdXRzLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhc0R1bW15SW5wdXQgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgcm93IGhhcyBhIGphZ2dlZCBlZGdlLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhc0phZ2dlZEVkZ2UgPSBmYWxzZTtcbiAgbm90Y2hPZmZzZXQ6IG51bWJlcjtcblxuICAvKipcbiAgICogQWxpZ25tZW50IG9mIHRoZSByb3cuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYWxpZ246IG51bWJlcnxudWxsID0gbnVsbDtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgY29uc3RhbnRzXzogQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIpIHtcbiAgICAvKiogVGhlIHJlbmRlcmVyJ3MgY29uc3RhbnQgcHJvdmlkZXIuICovXG4gICAgdGhpcy5jb25zdGFudHNfID0gY29uc3RhbnRzO1xuXG4gICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgcmVuZGVyaW5nIG9iamVjdC4gKi9cbiAgICB0aGlzLnR5cGUgPSBUeXBlcy5ST1c7XG5cbiAgICB0aGlzLm5vdGNoT2Zmc2V0ID0gdGhpcy5jb25zdGFudHNfLk5PVENIX09GRlNFVF9MRUZUO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbGFzdCBpbnB1dCBvbiB0aGlzIHJvdywgaWYgaXQgaGFzIG9uZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGxhc3QgaW5wdXQgb24gdGhlIHJvdywgb3IgbnVsbC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRMYXN0SW5wdXQoKTogSW5wdXRDb25uZWN0aW9ufG51bGwge1xuICAgIC8vIFRPRE86IENvbnNpZGVyIG1vdmluZyB0aGlzIHRvIElucHV0Um93LCBpZiBwb3NzaWJsZS5cbiAgICBmb3IgKGxldCBpID0gdGhpcy5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgZWxlbSA9IHRoaXMuZWxlbWVudHNbaV07XG4gICAgICBpZiAoVHlwZXMuaXNJbnB1dChlbGVtKSkge1xuICAgICAgICByZXR1cm4gZWxlbSBhcyBJbnB1dENvbm5lY3Rpb247XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEluc3BlY3QgYWxsIHN1YmNvbXBvbmVudHMgYW5kIHBvcHVsYXRlIGFsbCBzaXplIHByb3BlcnRpZXMgb24gdGhlIHJvdy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBtZWFzdXJlKCkge1xuICAgIHRocm93IEVycm9yKCdVbmV4cGVjdGVkIGF0dGVtcHQgdG8gbWVhc3VyZSBhIGJhc2UgUm93LicpO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgd2hldGhlciB0aGlzIHJvdyBzaG91bGQgc3RhcnQgd2l0aCBhbiBlbGVtZW50IHNwYWNlci5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgcm93IHNob3VsZCBzdGFydCB3aXRoIGEgc3BhY2VyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXJ0c1dpdGhFbGVtU3BhY2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgd2hldGhlciB0aGlzIHJvdyBzaG91bGQgZW5kIHdpdGggYW4gZWxlbWVudCBzcGFjZXIuXG4gICAqXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgdGhlIHJvdyBzaG91bGQgZW5kIHdpdGggYSBzcGFjZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZW5kc1dpdGhFbGVtU3BhY2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBnZXQgdGhlIGZpcnN0IHNwYWNlciBlbGVtZW50IG9uIHRoaXMgcm93LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgZmlyc3Qgc3BhY2VyIGVsZW1lbnQgb24gdGhpcyByb3cuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0Rmlyc3RTcGFjZXIoKTogSW5Sb3dTcGFjZXJ8bnVsbCB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBlbGVtID0gdGhpcy5lbGVtZW50c1tpXTtcbiAgICAgIGlmIChUeXBlcy5pc1NwYWNlcihlbGVtKSkge1xuICAgICAgICByZXR1cm4gZWxlbSBhcyBJblJvd1NwYWNlcjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIGdldCB0aGUgbGFzdCBzcGFjZXIgZWxlbWVudCBvbiB0aGlzIHJvdy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGxhc3Qgc3BhY2VyIGVsZW1lbnQgb24gdGhpcyByb3cuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0TGFzdFNwYWNlcigpOiBJblJvd1NwYWNlcnxudWxsIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgZWxlbSA9IHRoaXMuZWxlbWVudHNbaV07XG4gICAgICBpZiAoVHlwZXMuaXNTcGFjZXIoZWxlbSkpIHtcbiAgICAgICAgcmV0dXJuIGVsZW0gYXMgSW5Sb3dTcGFjZXI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0IHJlcHJlc2VudGluZyBhIGJvdHRvbSByb3cgb24gYSByZW5kZXJlZCBibG9jay5cbiAqIG9mIGl0cyBzdWJjb21wb25lbnRzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkJvdHRvbVJvdycpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uLy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB0eXBlIHtOZXh0Q29ubmVjdGlvbn0gZnJvbSAnLi9uZXh0X2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtSb3d9IGZyb20gJy4vcm93LmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCBlbGVtZW50cyBhcmUgaW4gdGhlIGJvdHRvbSByb3cgb2ZcbiAqIGEgYmxvY2sgYXMgd2VsbCBhcyBzcGFjaW5nIGluZm9ybWF0aW9uIGZvciB0aGUgYm90dG9tIHJvdy5cbiAqIEVsZW1lbnRzIGluIGEgYm90dG9tIHJvdyBjYW4gY29uc2lzdCBvZiBjb3JuZXJzLCBzcGFjZXJzIGFuZCBuZXh0XG4gKiBjb25uZWN0aW9ucy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5Cb3R0b21Sb3dcbiAqL1xuZXhwb3J0IGNsYXNzIEJvdHRvbVJvdyBleHRlbmRzIFJvdyB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoaXMgcm93IGhhcyBhIG5leHQgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBoYXNOZXh0Q29ubmVjdGlvbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgbmV4dCBjb25uZWN0aW9uIG9uIHRoZSByb3csIGlmIGFueS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25uZWN0aW9uOiBOZXh0Q29ubmVjdGlvbnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIGFtb3VudCB0aGF0IHRoZSBib3R0b20gb2YgdGhlIGJsb2NrIGV4dGVuZHMgYmVsb3cgdGhlIGhvcml6b250YWxcbiAgICogZWRnZSwgZS5nLiBiZWNhdXNlIG9mIGEgbmV4dCBjb25uZWN0aW9uLiAgTXVzdCBiZSBub24tbmVnYXRpdmUgKHNlZVxuICAgKiAjMjgyMCkuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGVzY2VuZGVySGVpZ2h0ID0gMDtcblxuICAvKipcbiAgICogVGhlIFkgcG9zaXRpb24gb2YgdGhlIGJvdHRvbSBlZGdlIG9mIHRoZSBibG9jaywgcmVsYXRpdmUgdG8gdGhlIG9yaWdpblxuICAgKiBvZiB0aGUgYmxvY2sgcmVuZGVyaW5nLlxuICAgKi9cbiAgYmFzZWxpbmUgPSAwO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlcikge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG4gICAgdGhpcy50eXBlIHw9IFR5cGVzLkJPVFRPTV9ST1c7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgYm90dG9tIHJvdyBoYXMgYSBsZWZ0IHNxdWFyZSBjb3JuZXIuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgd2hvc2UgYm90dG9tIHJvdyB0aGlzIHJlcHJlc2VudHMuXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IHRoZSBib3R0b20gcm93IGhhcyBhIGxlZnQgc3F1YXJlIGNvcm5lci5cbiAgICovXG4gIGhhc0xlZnRTcXVhcmVDb3JuZXIoYmxvY2s6IEJsb2NrU3ZnKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhYmxvY2sub3V0cHV0Q29ubmVjdGlvbiB8fCAhIWJsb2NrLmdldE5leHRCbG9jaygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGJvdHRvbSByb3cgaGFzIGEgcmlnaHQgc3F1YXJlIGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgd2hvc2UgYm90dG9tIHJvdyB0aGlzIHJlcHJlc2VudHMuXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IHRoZSBib3R0b20gcm93IGhhcyBhIHJpZ2h0IHNxdWFyZSBjb3JuZXIuXG4gICAqL1xuICBoYXNSaWdodFNxdWFyZUNvcm5lcihfYmxvY2s6IEJsb2NrU3ZnKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBvdmVycmlkZSBtZWFzdXJlKCkge1xuICAgIGxldCBoZWlnaHQgPSAwO1xuICAgIGxldCB3aWR0aCA9IDA7XG4gICAgbGV0IGRlc2NlbmRlckhlaWdodCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBlbGVtID0gdGhpcy5lbGVtZW50c1tpXTtcbiAgICAgIHdpZHRoICs9IGVsZW0ud2lkdGg7XG4gICAgICBpZiAoIVR5cGVzLmlzU3BhY2VyKGVsZW0pKSB7XG4gICAgICAgIC8vIE5vdGU6IHRoaXMgYXNzdW1lcyB0aGF0IG5leHQgY29ubmVjdGlvbnMgaGF2ZSAqb25seSogZGVzY2VuZGVySGVpZ2h0LFxuICAgICAgICAvLyB3aXRoIG5vIGhlaWdodCBhYm92ZSB0aGUgYmFzZWxpbmUuXG4gICAgICAgIGlmIChUeXBlcy5pc05leHRDb25uZWN0aW9uKGVsZW0pKSB7XG4gICAgICAgICAgZGVzY2VuZGVySGVpZ2h0ID0gTWF0aC5tYXgoZGVzY2VuZGVySGVpZ2h0LCBlbGVtLmhlaWdodCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0LCBlbGVtLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy53aWR0aCA9IE1hdGgubWF4KHRoaXMubWluV2lkdGgsIHdpZHRoKTtcbiAgICB0aGlzLmhlaWdodCA9IE1hdGgubWF4KHRoaXMubWluSGVpZ2h0LCBoZWlnaHQpICsgZGVzY2VuZGVySGVpZ2h0O1xuICAgIHRoaXMuZGVzY2VuZGVySGVpZ2h0ID0gZGVzY2VuZGVySGVpZ2h0O1xuICAgIHRoaXMud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzID0gdGhpcy53aWR0aDtcbiAgfVxuXG4gIG92ZXJyaWRlIHN0YXJ0c1dpdGhFbGVtU3BhY2VyKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG92ZXJyaWRlIGVuZHNXaXRoRWxlbVNwYWNlcigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBCYXNlIGNsYXNzIHJlcHJlc2VudGluZyB0aGUgc3BhY2UgYSBjb25uZWN0aW9uIHRha2VzIHVwIGR1cmluZ1xuICogcmVuZGVyaW5nLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkNvbm5lY3Rpb24nKTtcblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzICovXG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyLCBTaGFwZX0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7TWVhc3VyYWJsZX0gZnJvbSAnLi9iYXNlLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogVGhlIGJhc2UgY2xhc3MgdG8gcmVwcmVzZW50IGEgY29ubmVjdGlvbiBhbmQgdGhlIHNwYWNlIHRoYXQgaXQgdGFrZXMgdXAgb25cbiAqIHRoZSBibG9jay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5Db25uZWN0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBDb25uZWN0aW9uIGV4dGVuZHMgTWVhc3VyYWJsZSB7XG4gIHNoYXBlOiBTaGFwZTtcbiAgaXNEeW5hbWljU2hhcGU6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uTW9kZWwgVGhlIGNvbm5lY3Rpb24gb2JqZWN0IG9uIHRoZSBibG9jayB0aGF0IHRoaXNcbiAgICogICAgIHJlcHJlc2VudHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIHB1YmxpYyBjb25uZWN0aW9uTW9kZWw6IFJlbmRlcmVkQ29ubmVjdGlvbikge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG5cbiAgICB0aGlzLnNoYXBlID0gdGhpcy5jb25zdGFudHNfLnNoYXBlRm9yKGNvbm5lY3Rpb25Nb2RlbCk7XG5cbiAgICB0aGlzLmlzRHluYW1pY1NoYXBlID0gJ2lzRHluYW1pYycgaW4gdGhpcy5zaGFwZSAmJiB0aGlzLnNoYXBlLmlzRHluYW1pYztcbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuQ09OTkVDVElPTjtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyBpbnB1dHMgd2l0aCBjb25uZWN0aW9ucyBvbiBhIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLklucHV0Q29ubmVjdGlvbicpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uLy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7SW5wdXR9IGZyb20gJy4uLy4uL2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlZENvbm5lY3Rpb259IGZyb20gJy4uLy4uL3JlbmRlcmVkX2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge0Nvbm5lY3Rpb259IGZyb20gJy4vY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuL3R5cGVzLmpzJztcblxuXG4vKipcbiAqIFRoZSBiYXNlIGNsYXNzIHRvIHJlcHJlc2VudCBhbiBpbnB1dCB0aGF0IHRha2VzIHVwIHNwYWNlIG9uIGEgYmxvY2tcbiAqIGR1cmluZyByZW5kZXJpbmdcbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5JbnB1dENvbm5lY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIElucHV0Q29ubmVjdGlvbiBleHRlbmRzIENvbm5lY3Rpb24ge1xuICBhbGlnbjogbnVtYmVyO1xuICBjb25uZWN0ZWRCbG9jazogQmxvY2tTdmd8bnVsbDtcbiAgY29ubmVjdGVkQmxvY2tXaWR0aDogbnVtYmVyO1xuICBjb25uZWN0ZWRCbG9ja0hlaWdodDogbnVtYmVyO1xuICBjb25uZWN0aW9uT2Zmc2V0WCA9IDA7XG4gIGNvbm5lY3Rpb25PZmZzZXRZID0gMDtcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQHBhcmFtIGlucHV0IFRoZSBpbnB1dCB0byBtZWFzdXJlIGFuZCBzdG9yZSBpbmZvcm1hdGlvbiBmb3IuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyLCBwdWJsaWMgaW5wdXQ6IElucHV0KSB7XG4gICAgc3VwZXIoY29uc3RhbnRzLCBpbnB1dC5jb25uZWN0aW9uIGFzIFJlbmRlcmVkQ29ubmVjdGlvbik7XG5cbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuSU5QVVQ7XG5cbiAgICB0aGlzLmFsaWduID0gaW5wdXQuYWxpZ247XG5cbiAgICB0aGlzLmNvbm5lY3RlZEJsb2NrID1cbiAgICAgICAgKGlucHV0LmNvbm5lY3Rpb24gJiYgaW5wdXQuY29ubmVjdGlvbi50YXJnZXRCbG9jaygpID9cbiAgICAgICAgICAgICBpbnB1dC5jb25uZWN0aW9uLnRhcmdldEJsb2NrKCkgYXMgQmxvY2tTdmcgOlxuICAgICAgICAgICAgIG51bGwpO1xuXG4gICAgaWYgKHRoaXMuY29ubmVjdGVkQmxvY2spIHtcbiAgICAgIGNvbnN0IGJCb3ggPSB0aGlzLmNvbm5lY3RlZEJsb2NrLmdldEhlaWdodFdpZHRoKCk7XG4gICAgICB0aGlzLmNvbm5lY3RlZEJsb2NrV2lkdGggPSBiQm94LndpZHRoO1xuICAgICAgdGhpcy5jb25uZWN0ZWRCbG9ja0hlaWdodCA9IGJCb3guaGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbm5lY3RlZEJsb2NrV2lkdGggPSAwO1xuICAgICAgdGhpcy5jb25uZWN0ZWRCbG9ja0hlaWdodCA9IDA7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2xhc3MgcmVwcmVzZW50aW5nIGV4dGVybmFsIHZhbHVlIGlucHV0cyB3aXRoIGNvbm5lY3Rpb25zIG9uIGFcbiAqIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkV4dGVybmFsVmFsdWVJbnB1dCcpO1xuXG4vKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMgKi9cbmltcG9ydCB0eXBlIHtJbnB1dH0gZnJvbSAnLi4vLi4vaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge0lucHV0Q29ubmVjdGlvbn0gZnJvbSAnLi9pbnB1dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGFuIGV4dGVybmFsIHZhbHVlIGlucHV0XG4gKiB0YWtlcyB1cCBkdXJpbmcgcmVuZGVyaW5nXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuRXh0ZXJuYWxWYWx1ZUlucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBFeHRlcm5hbFZhbHVlSW5wdXQgZXh0ZW5kcyBJbnB1dENvbm5lY3Rpb24ge1xuICBvdmVycmlkZSBoZWlnaHQgPSAwO1xuICBvdmVycmlkZSB3aWR0aDogbnVtYmVyO1xuICBvdmVycmlkZSBjb25uZWN0aW9uT2Zmc2V0WTogbnVtYmVyO1xuICBjb25uZWN0aW9uSGVpZ2h0OiBudW1iZXI7XG4gIGNvbm5lY3Rpb25XaWR0aDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAcGFyYW0gaW5wdXQgVGhlIGV4dGVybmFsIHZhbHVlIGlucHV0IHRvIG1lYXN1cmUgYW5kIHN0b3JlIGluZm9ybWF0aW9uIGZvci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIGlucHV0OiBJbnB1dCkge1xuICAgIHN1cGVyKGNvbnN0YW50cywgaW5wdXQpO1xuICAgIHRoaXMudHlwZSB8PSBUeXBlcy5FWFRFUk5BTF9WQUxVRV9JTlBVVDtcbiAgICBpZiAoIXRoaXMuY29ubmVjdGVkQmxvY2spIHtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5zaGFwZS5oZWlnaHQgYXMgbnVtYmVyO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuY29ubmVjdGVkQmxvY2tIZWlnaHQgLVxuICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5UQUJfT0ZGU0VUX0ZST01fVE9QIC0gdGhpcy5jb25zdGFudHNfLk1FRElVTV9QQURESU5HO1xuICAgIH1cblxuICAgIHRoaXMud2lkdGggPSB0aGlzLnNoYXBlLndpZHRoIGFzXG4gICAgICAgIG51bWJlciArIHRoaXMuY29uc3RhbnRzXy5FWFRFUk5BTF9WQUxVRV9JTlBVVF9QQURESU5HO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uT2Zmc2V0WSA9IHRoaXMuY29uc3RhbnRzXy5UQUJfT0ZGU0VUX0ZST01fVE9QO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uSGVpZ2h0ID0gdGhpcy5zaGFwZS5oZWlnaHQgYXMgbnVtYmVyO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uV2lkdGggPSB0aGlzLnNoYXBlLndpZHRoIGFzIG51bWJlcjtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdHMgcmVwcmVzZW50aW5nIGEgZmllbGQgaW4gYSByb3cgb2YgYSByZW5kZXJlZFxuICogYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tSZW5kZXJpbmcuRmllbGQnKTtcblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzICovXG5pbXBvcnQgdHlwZSB7RmllbGQgYXMgQmxvY2tseUZpZWxkfSBmcm9tICcuLi8uLi9maWVsZC5qcyc7XG5pbXBvcnQgdHlwZSB7SW5wdXR9IGZyb20gJy4uLy4uL2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHtNZWFzdXJhYmxlfSBmcm9tICcuL2Jhc2UuanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3BhY2UgYSBmaWVsZCB0YWtlcyB1cCBkdXJpbmdcbiAqIHJlbmRlcmluZ1xuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkZpZWxkXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWVsZCBleHRlbmRzIE1lYXN1cmFibGUge1xuICBpc0VkaXRhYmxlOiBib29sZWFuO1xuICBmbGlwUnRsOiBib29sZWFuO1xuICBvdmVycmlkZSBoZWlnaHQ6IG51bWJlcjtcbiAgb3ZlcnJpZGUgd2lkdGg6IG51bWJlcjtcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQHBhcmFtIGZpZWxkIFRoZSBmaWVsZCB0byBtZWFzdXJlIGFuZCBzdG9yZSBpbmZvcm1hdGlvbiBmb3IuXG4gICAqIEBwYXJhbSBwYXJlbnRJbnB1dCBUaGUgcGFyZW50IGlucHV0IGZvciB0aGUgZmllbGQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIHB1YmxpYyBmaWVsZDogQmxvY2tseUZpZWxkLFxuICAgICAgcHVibGljIHBhcmVudElucHV0OiBJbnB1dCkge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG5cbiAgICB0aGlzLmlzRWRpdGFibGUgPSBmaWVsZC5FRElUQUJMRTtcblxuICAgIHRoaXMuZmxpcFJ0bCA9IGZpZWxkLmdldEZsaXBSdGwoKTtcbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuRklFTEQ7XG5cbiAgICBjb25zdCBzaXplID0gdGhpcy5maWVsZC5nZXRTaXplKCk7XG5cbiAgICB0aGlzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgdGhpcy53aWR0aCA9IHNpemUud2lkdGg7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3RzIHJlcHJlc2VudGluZyBhIGhhdCBpbiBhIHJvdyBvZiBhIHJlbmRlcmVkXG4gKiBibG9jay5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5IYXQnKTtcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge01lYXN1cmFibGV9IGZyb20gJy4vYmFzZS5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuL3R5cGVzLmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzcGFjZSBhIGhhdCB0YWtlcyB1cCBkdXJpbmdcbiAqIHJlbmRlcmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5IYXRcbiAqL1xuZXhwb3J0IGNsYXNzIEhhdCBleHRlbmRzIE1lYXN1cmFibGUge1xuICBhc2NlbmRlckhlaWdodDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlcikge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG4gICAgdGhpcy50eXBlIHw9IFR5cGVzLkhBVDtcblxuICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5jb25zdGFudHNfLlNUQVJUX0hBVC5oZWlnaHQ7XG4gICAgdGhpcy53aWR0aCA9IHRoaXMuY29uc3RhbnRzXy5TVEFSVF9IQVQud2lkdGg7XG5cbiAgICB0aGlzLmFzY2VuZGVySGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3RzIHJlcHJlc2VudGluZyBhbiBpY29uIGluIGEgcm93IG9mIGEgcmVuZGVyZWRcbiAqIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkljb24nKTtcblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzICovXG5pbXBvcnQgdHlwZSB7SWNvbiBhcyBCbG9ja2x5SWNvbn0gZnJvbSAnLi4vLi4vaWNvbi5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7TWVhc3VyYWJsZX0gZnJvbSAnLi9iYXNlLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGFuIGljb24gdGFrZXMgdXAgZHVyaW5nXG4gKiByZW5kZXJpbmdcbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5JY29uXG4gKi9cbmV4cG9ydCBjbGFzcyBJY29uIGV4dGVuZHMgTWVhc3VyYWJsZSB7XG4gIGlzVmlzaWJsZTogYm9vbGVhbjtcbiAgZmxpcFJ0bCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3BhY2UgYW4gaWNvbiB0YWtlcyB1cCBkdXJpbmdcbiAgICogcmVuZGVyaW5nXG4gICAqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBpY29uIFRoZSBpY29uIHRvIG1lYXN1cmUgYW5kIHN0b3JlIGluZm9ybWF0aW9uIGZvci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIHB1YmxpYyBpY29uOiBCbG9ja2x5SWNvbikge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG5cbiAgICB0aGlzLmlzVmlzaWJsZSA9IGljb24uaXNWaXNpYmxlKCk7XG4gICAgdGhpcy50eXBlIHw9IFR5cGVzLklDT047XG5cbiAgICBjb25zdCBzaXplID0gaWNvbi5nZXRDb3JyZWN0ZWRTaXplKCk7XG4gICAgdGhpcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgICB0aGlzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdHMgcmVwcmVzZW50aW5nIGEgc3BhY2VyIGluIGEgcm93IG9mIGEgcmVuZGVyZWRcbiAqIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkluUm93U3BhY2VyJyk7XG5cbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHtNZWFzdXJhYmxlfSBmcm9tICcuL2Jhc2UuanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCBhIHNwYWNlciBiZXR3ZWVuIHR3byBlbGVtZW50cyBvbiBhXG4gKiByb3cuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuSW5Sb3dTcGFjZXJcbiAqL1xuZXhwb3J0IGNsYXNzIEluUm93U3BhY2VyIGV4dGVuZHMgTWVhc3VyYWJsZSB7XG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSBzcGFjZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyLCB3aWR0aDogbnVtYmVyKSB7XG4gICAgc3VwZXIoY29uc3RhbnRzKTtcbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuU1BBQ0VSIHwgVHlwZXMuSU5fUk9XX1NQQUNFUjtcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmNvbnN0YW50c18uU1BBQ0VSX0RFRkFVTFRfSEVJR0hUO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2xhc3MgcmVwcmVzZW50aW5nIGlubGluZSBpbnB1dHMgd2l0aCBjb25uZWN0aW9ucyBvbiBhIHJlbmRlcmVkXG4gKiBibG9jay5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5JbmxpbmVJbnB1dCcpO1xuXG4vKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMgKi9cbmltcG9ydCB0eXBlIHtJbnB1dH0gZnJvbSAnLi4vLi4vaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge0lucHV0Q29ubmVjdGlvbn0gZnJvbSAnLi9pbnB1dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGFuIGlubGluZSBpbnB1dCB0YWtlcyB1cFxuICogZHVyaW5nIHJlbmRlcmluZ1xuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLklubGluZUlucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBJbmxpbmVJbnB1dCBleHRlbmRzIElucHV0Q29ubmVjdGlvbiB7XG4gIGNvbm5lY3Rpb25IZWlnaHQ6IG51bWJlcjtcbiAgY29ubmVjdGlvbldpZHRoOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgaW5saW5lIGlucHV0IHRvIG1lYXN1cmUgYW5kIHN0b3JlIGluZm9ybWF0aW9uIGZvci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIGlucHV0OiBJbnB1dCkge1xuICAgIHN1cGVyKGNvbnN0YW50cywgaW5wdXQpO1xuICAgIHRoaXMudHlwZSB8PSBUeXBlcy5JTkxJTkVfSU5QVVQ7XG5cbiAgICBpZiAoIXRoaXMuY29ubmVjdGVkQmxvY2spIHtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5jb25zdGFudHNfLkVNUFRZX0lOTElORV9JTlBVVF9IRUlHSFQ7XG4gICAgICB0aGlzLndpZHRoID0gdGhpcy5jb25zdGFudHNfLkVNUFRZX0lOTElORV9JTlBVVF9QQURESU5HO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBXZSBhbGxvdyB0aGUgZGFyayBwYXRoIHRvIHNob3cgb24gdGhlIHBhcmVudCBibG9jayBzbyB0aGF0IHRoZSBjaGlsZFxuICAgICAgLy8gYmxvY2sgbG9va3MgZW1ib3NzZWQuICBUaGlzIHRha2VzIHVwIGFuIGV4dHJhIHBpeGVsIGluIGJvdGggeCBhbmQgeS5cbiAgICAgIHRoaXMud2lkdGggPSB0aGlzLmNvbm5lY3RlZEJsb2NrV2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuY29ubmVjdGVkQmxvY2tIZWlnaHQ7XG4gICAgfVxuXG4gICAgdGhpcy5jb25uZWN0aW9uSGVpZ2h0ID0gIXRoaXMuaXNEeW5hbWljU2hhcGUgP1xuICAgICAgICB0aGlzLnNoYXBlLmhlaWdodCBhcyBudW1iZXIgOlxuICAgICAgICAodGhpcy5zaGFwZS5oZWlnaHQgYXMgKHAxOiBudW1iZXIpID0+IG51bWJlcikodGhpcy5oZWlnaHQpO1xuXG4gICAgdGhpcy5jb25uZWN0aW9uV2lkdGggPSAhdGhpcy5pc0R5bmFtaWNTaGFwZSA/XG4gICAgICAgIHRoaXMuc2hhcGUud2lkdGggYXMgbnVtYmVyIDpcbiAgICAgICAgKHRoaXMuc2hhcGUud2lkdGggYXMgKHAxOiBudW1iZXIpID0+IG51bWJlcikodGhpcy5oZWlnaHQpO1xuICAgIGlmICghdGhpcy5jb25uZWN0ZWRCbG9jaykge1xuICAgICAgdGhpcy53aWR0aCArPSB0aGlzLmNvbm5lY3Rpb25XaWR0aCAqICh0aGlzLmlzRHluYW1pY1NoYXBlID8gMiA6IDEpO1xuICAgIH1cblxuICAgIHRoaXMuY29ubmVjdGlvbk9mZnNldFkgPSAnY29ubmVjdGlvbk9mZnNldFknIGluIHRoaXMuc2hhcGUgP1xuICAgICAgICB0aGlzLnNoYXBlLmNvbm5lY3Rpb25PZmZzZXRZKHRoaXMuY29ubmVjdGlvbkhlaWdodCkgOlxuICAgICAgICB0aGlzLmNvbnN0YW50c18uVEFCX09GRlNFVF9GUk9NX1RPUDtcblxuICAgIHRoaXMuY29ubmVjdGlvbk9mZnNldFggPSAnY29ubmVjdGlvbk9mZnNldFgnIGluIHRoaXMuc2hhcGUgP1xuICAgICAgICB0aGlzLnNoYXBlLmNvbm5lY3Rpb25PZmZzZXRYKHRoaXMuY29ubmVjdGlvbldpZHRoKSA6XG4gICAgICAgIDA7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgc3RhdGVtZW50IGlucHV0cyB3aXRoIGNvbm5lY3Rpb25zIG9uIGFcbiAqIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlN0YXRlbWVudElucHV0Jyk7XG5cbi8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycyAqL1xuaW1wb3J0IHR5cGUge0lucHV0fSBmcm9tICcuLi8uLi9pbnB1dC5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7SW5wdXRDb25uZWN0aW9ufSBmcm9tICcuL2lucHV0X2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3BhY2UgYSBzdGF0ZW1lbnQgaW5wdXQgdGFrZXMgdXBcbiAqIGR1cmluZyByZW5kZXJpbmdcbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5TdGF0ZW1lbnRJbnB1dFxuICovXG5leHBvcnQgY2xhc3MgU3RhdGVtZW50SW5wdXQgZXh0ZW5kcyBJbnB1dENvbm5lY3Rpb24ge1xuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQHBhcmFtIGlucHV0IFRoZSBzdGF0ZW1lbnQgaW5wdXQgdG8gbWVhc3VyZSBhbmQgc3RvcmUgaW5mb3JtYXRpb24gZm9yLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlciwgaW5wdXQ6IElucHV0KSB7XG4gICAgc3VwZXIoY29uc3RhbnRzLCBpbnB1dCk7XG4gICAgdGhpcy50eXBlIHw9IFR5cGVzLlNUQVRFTUVOVF9JTlBVVDtcblxuICAgIGlmICghdGhpcy5jb25uZWN0ZWRCbG9jaykge1xuICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLmNvbnN0YW50c18uRU1QVFlfU1RBVEVNRU5UX0lOUFVUX0hFSUdIVDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gV2UgYWxsb3cgdGhlIGRhcmsgcGF0aCB0byBzaG93IG9uIHRoZSBwYXJlbnQgYmxvY2sgc28gdGhhdCB0aGUgY2hpbGRcbiAgICAgIC8vIGJsb2NrIGxvb2tzIGVtYm9zc2VkLiAgVGhpcyB0YWtlcyB1cCBhbiBleHRyYSBwaXhlbCBpbiBib3RoIHggYW5kIHkuXG4gICAgICB0aGlzLmhlaWdodCA9XG4gICAgICAgICAgdGhpcy5jb25uZWN0ZWRCbG9ja0hlaWdodCArIHRoaXMuY29uc3RhbnRzXy5TVEFURU1FTlRfQk9UVE9NX1NQQUNFUjtcbiAgICB9XG4gICAgdGhpcy53aWR0aCA9IHRoaXMuY29uc3RhbnRzXy5TVEFURU1FTlRfSU5QVVRfTk9UQ0hfT0ZGU0VUICtcbiAgICAgICAgKHRoaXMuc2hhcGUud2lkdGggYXMgbnVtYmVyKTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSByb3cgdGhhdCBob2xkcyBvbmUgb3IgbW9yZSBpbnB1dHMgb24gYVxuICogcmVuZGVyZWQgYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tSZW5kZXJpbmcuSW5wdXRSb3cnKTtcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge0V4dGVybmFsVmFsdWVJbnB1dH0gZnJvbSAnLi9leHRlcm5hbF92YWx1ZV9pbnB1dC5qcyc7XG5pbXBvcnQge0lucHV0Q29ubmVjdGlvbn0gZnJvbSAnLi9pbnB1dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7Um93fSBmcm9tICcuL3Jvdy5qcyc7XG5pbXBvcnQge1N0YXRlbWVudElucHV0fSBmcm9tICcuL3N0YXRlbWVudF9pbnB1dC5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuL3R5cGVzLmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IGEgcm93IHRoYXQgaG9sZHMgb25lIG9yIG1vcmUgaW5wdXRzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLklucHV0Um93XG4gKi9cbmV4cG9ydCBjbGFzcyBJbnB1dFJvdyBleHRlbmRzIFJvdyB7XG4gIC8qKlxuICAgKiBUaGUgdG90YWwgd2lkdGggb2YgYWxsIGJsb2NrcyBjb25uZWN0ZWQgdG8gdGhpcyByb3cuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29ubmVjdGVkQmxvY2tXaWR0aHMgPSAwO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlcikge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG4gICAgdGhpcy50eXBlIHw9IFR5cGVzLklOUFVUX1JPVztcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnNwZWN0IGFsbCBzdWJjb21wb25lbnRzIGFuZCBwb3B1bGF0ZSBhbGwgc2l6ZSBwcm9wZXJ0aWVzIG9uIHRoZSByb3cuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgbWVhc3VyZSgpIHtcbiAgICB0aGlzLndpZHRoID0gdGhpcy5taW5XaWR0aDtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMubWluSGVpZ2h0O1xuICAgIGxldCBjb25uZWN0ZWRCbG9ja1dpZHRocyA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBlbGVtID0gdGhpcy5lbGVtZW50c1tpXTtcbiAgICAgIHRoaXMud2lkdGggKz0gZWxlbS53aWR0aDtcbiAgICAgIGlmIChUeXBlcy5pc0lucHV0KGVsZW0pICYmIGVsZW0gaW5zdGFuY2VvZiBJbnB1dENvbm5lY3Rpb24pIHtcbiAgICAgICAgaWYgKFR5cGVzLmlzU3RhdGVtZW50SW5wdXQoZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIFN0YXRlbWVudElucHV0KSB7XG4gICAgICAgICAgY29ubmVjdGVkQmxvY2tXaWR0aHMgKz0gZWxlbS5jb25uZWN0ZWRCbG9ja1dpZHRoO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgVHlwZXMuaXNFeHRlcm5hbElucHV0KGVsZW0pICYmIGVsZW0gaW5zdGFuY2VvZiBFeHRlcm5hbFZhbHVlSW5wdXQgJiZcbiAgICAgICAgICAgIGVsZW0uY29ubmVjdGVkQmxvY2tXaWR0aCAhPT0gMCkge1xuICAgICAgICAgIGNvbm5lY3RlZEJsb2NrV2lkdGhzICs9XG4gICAgICAgICAgICAgIGVsZW0uY29ubmVjdGVkQmxvY2tXaWR0aCAtIGVsZW0uY29ubmVjdGlvbldpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIVR5cGVzLmlzU3BhY2VyKGVsZW0pKSB7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gTWF0aC5tYXgodGhpcy5oZWlnaHQsIGVsZW0uaGVpZ2h0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5jb25uZWN0ZWRCbG9ja1dpZHRocyA9IGNvbm5lY3RlZEJsb2NrV2lkdGhzO1xuICAgIHRoaXMud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzID0gdGhpcy53aWR0aCArIGNvbm5lY3RlZEJsb2NrV2lkdGhzO1xuICB9XG5cbiAgb3ZlcnJpZGUgZW5kc1dpdGhFbGVtU3BhY2VyKCkge1xuICAgIHJldHVybiAhdGhpcy5oYXNFeHRlcm5hbElucHV0ICYmICF0aGlzLmhhc1N0YXRlbWVudDtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdHMgcmVwcmVzZW50aW5nIGEgamFnZ2VkIGVkZ2UgaW4gYSByb3cgb2YgYSByZW5kZXJlZFxuICogYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tSZW5kZXJpbmcuSmFnZ2VkRWRnZScpO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7TWVhc3VyYWJsZX0gZnJvbSAnLi9iYXNlLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGphZ2dlZCBlZGdlIG9mIGEgY29sbGFwc2VkIGJsb2NrXG4gKiB0YWtlcyB1cCBkdXJpbmcgcmVuZGVyaW5nXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuSmFnZ2VkRWRnZVxuICovXG5leHBvcnQgY2xhc3MgSmFnZ2VkRWRnZSBleHRlbmRzIE1lYXN1cmFibGUge1xuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIpIHtcbiAgICBzdXBlcihjb25zdGFudHMpO1xuICAgIHRoaXMudHlwZSB8PSBUeXBlcy5KQUdHRURfRURHRTtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuY29uc3RhbnRzXy5KQUdHRURfVEVFVEguaGVpZ2h0O1xuICAgIHRoaXMud2lkdGggPSB0aGlzLmNvbnN0YW50c18uSkFHR0VEX1RFRVRILndpZHRoO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2xhc3MgcmVwcmVzZW50aW5nIHRoZSBzcGFjZSBhIG5leHQgY29ubmVjdGlvbiB0YWtlcyB1cCBkdXJpbmdcbiAqIHJlbmRlcmluZy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5OZXh0Q29ubmVjdGlvbicpO1xuXG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3BhY2UgYSBuZXh0IGNvbm5lY3Rpb24gdGFrZXNcbiAqIHVwIGR1cmluZyByZW5kZXJpbmcuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuTmV4dENvbm5lY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIE5leHRDb25uZWN0aW9uIGV4dGVuZHMgQ29ubmVjdGlvbiB7XG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAcGFyYW0gY29ubmVjdGlvbk1vZGVsIFRoZSBjb25uZWN0aW9uIG9iamVjdCBvbiB0aGUgYmxvY2sgdGhhdCB0aGlzXG4gICAqICAgICByZXByZXNlbnRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyLCBjb25uZWN0aW9uTW9kZWw6IFJlbmRlcmVkQ29ubmVjdGlvbikge1xuICAgIHN1cGVyKGNvbnN0YW50cywgY29ubmVjdGlvbk1vZGVsKTtcbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuTkVYVF9DT05ORUNUSU9OO1xuICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5zaGFwZS5oZWlnaHQgYXMgbnVtYmVyO1xuICAgIHRoaXMud2lkdGggPSB0aGlzLnNoYXBlLndpZHRoIGFzIG51bWJlcjtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgc3BhY2UgYSBvdXRwdXQgY29ubmVjdGlvbiB0YWtlcyB1cFxuICogZHVyaW5nIHJlbmRlcmluZy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5PdXRwdXRDb25uZWN0aW9uJyk7XG5cbmltcG9ydCB0eXBlIHtSZW5kZXJlZENvbm5lY3Rpb259IGZyb20gJy4uLy4uL3JlbmRlcmVkX2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge0Nvbm5lY3Rpb259IGZyb20gJy4vY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuL3R5cGVzLmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzcGFjZSBhbiBvdXRwdXQgY29ubmVjdGlvbiB0YWtlc1xuICogdXAgZHVyaW5nIHJlbmRlcmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5PdXRwdXRDb25uZWN0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBPdXRwdXRDb25uZWN0aW9uIGV4dGVuZHMgQ29ubmVjdGlvbiB7XG4gIHN0YXJ0WDogbnVtYmVyO1xuICBjb25uZWN0aW9uT2Zmc2V0WTogbnVtYmVyO1xuICBjb25uZWN0aW9uT2Zmc2V0WCA9IDA7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uTW9kZWwgVGhlIGNvbm5lY3Rpb24gb2JqZWN0IG9uIHRoZSBibG9jayB0aGF0IHRoaXNcbiAgICogICAgIHJlcHJlc2VudHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIGNvbm5lY3Rpb25Nb2RlbDogUmVuZGVyZWRDb25uZWN0aW9uKSB7XG4gICAgc3VwZXIoY29uc3RhbnRzLCBjb25uZWN0aW9uTW9kZWwpO1xuICAgIHRoaXMudHlwZSB8PSBUeXBlcy5PVVRQVVRfQ09OTkVDVElPTjtcblxuICAgIHRoaXMuaGVpZ2h0ID0gIXRoaXMuaXNEeW5hbWljU2hhcGUgPyB0aGlzLnNoYXBlLmhlaWdodCBhcyBudW1iZXIgOiAwO1xuICAgIHRoaXMud2lkdGggPSAhdGhpcy5pc0R5bmFtaWNTaGFwZSA/IHRoaXMuc2hhcGUud2lkdGggYXMgbnVtYmVyIDogMDtcblxuICAgIHRoaXMuc3RhcnRYID0gdGhpcy53aWR0aDtcblxuICAgIHRoaXMuY29ubmVjdGlvbk9mZnNldFkgPSB0aGlzLmNvbnN0YW50c18uVEFCX09GRlNFVF9GUk9NX1RPUDtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgc3BhY2UgYSBwcmV2aW91cyBjb25uZWN0aW9uIHRha2VzIHVwXG4gKiBkdXJpbmcgcmVuZGVyaW5nLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlByZXZpb3VzQ29ubmVjdGlvbicpO1xuXG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3BhY2UgYSBwcmV2aW91cyBjb25uZWN0aW9uIHRha2VzXG4gKiB1cCBkdXJpbmcgcmVuZGVyaW5nLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlByZXZpb3VzQ29ubmVjdGlvblxuICovXG5leHBvcnQgY2xhc3MgUHJldmlvdXNDb25uZWN0aW9uIGV4dGVuZHMgQ29ubmVjdGlvbiB7XG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAcGFyYW0gY29ubmVjdGlvbk1vZGVsIFRoZSBjb25uZWN0aW9uIG9iamVjdCBvbiB0aGUgYmxvY2sgdGhhdCB0aGlzXG4gICAqICAgICByZXByZXNlbnRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyLCBjb25uZWN0aW9uTW9kZWw6IFJlbmRlcmVkQ29ubmVjdGlvbikge1xuICAgIHN1cGVyKGNvbnN0YW50cywgY29ubmVjdGlvbk1vZGVsKTtcbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuUFJFVklPVVNfQ09OTkVDVElPTjtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuc2hhcGUuaGVpZ2h0IGFzIG51bWJlcjtcbiAgICB0aGlzLndpZHRoID0gdGhpcy5zaGFwZS53aWR0aCBhcyBudW1iZXI7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3RzIHJlcHJlc2VudGluZyBhIHJvdW5kIGNvcm5lciBpbiBhIHJvdyBvZiBhIHJlbmRlcmVkXG4gKiBibG9jay5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5Sb3VuZENvcm5lcicpO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7TWVhc3VyYWJsZX0gZnJvbSAnLi9iYXNlLmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGEgcm91bmRlZCBjb3JuZXIgdGFrZXMgdXBcbiAqIGR1cmluZyByZW5kZXJpbmcuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuUm91bmRDb3JuZXJcbiAqL1xuZXhwb3J0IGNsYXNzIFJvdW5kQ29ybmVyIGV4dGVuZHMgTWVhc3VyYWJsZSB7XG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAcGFyYW0gb3B0X3Bvc2l0aW9uIFRoZSBwb3NpdGlvbiBvZiB0aGlzIGNvcm5lci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIG9wdF9wb3NpdGlvbj86IHN0cmluZykge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG4gICAgdGhpcy50eXBlID1cbiAgICAgICAgKCFvcHRfcG9zaXRpb24gfHwgb3B0X3Bvc2l0aW9uID09PSAnbGVmdCcgPyBUeXBlcy5MRUZUX1JPVU5EX0NPUk5FUiA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZXMuUklHSFRfUk9VTkRfQ09STkVSKSB8XG4gICAgICAgIFR5cGVzLkNPUk5FUjtcbiAgICB0aGlzLndpZHRoID0gdGhpcy5jb25zdGFudHNfLkNPUk5FUl9SQURJVVM7XG4gICAgLy8gVGhlIHJvdW5kZWQgY29ybmVyIGV4dGVuZHMgaW50byB0aGUgbmV4dCByb3cgYnkgNCBzbyB3ZSBvbmx5IHRha2UgdGhlXG4gICAgLy8gaGVpZ2h0IHRoYXQgaXMgYWxpZ25lZCB3aXRoIHRoaXMgcm93LlxuICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5jb25zdGFudHNfLkNPUk5FUl9SQURJVVMgLyAyO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0IHJlcHJlc2VudGluZyBhIHNwYWNlciBiZXR3ZWVuIHR3byByb3dzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlNwYWNlclJvdycpO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7SW5Sb3dTcGFjZXJ9IGZyb20gJy4vaW5fcm93X3NwYWNlci5qcyc7XG5pbXBvcnQge1Jvd30gZnJvbSAnLi9yb3cuanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi90eXBlcy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCBhIHNwYWNlciBiZXR3ZWVuIHR3byByb3dzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlNwYWNlclJvd1xuICovXG5leHBvcnQgY2xhc3MgU3BhY2VyUm93IGV4dGVuZHMgUm93IHtcbiAgZm9sbG93c1N0YXRlbWVudCA9IGZhbHNlO1xuXG4gIHByZWNlZGVzU3RhdGVtZW50ID0gZmFsc2U7XG5cbiAgb3ZlcnJpZGUgd2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzID0gMDtcbiAgb3ZlcnJpZGUgZWxlbWVudHM6IEluUm93U3BhY2VyW107XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgc3BhY2VyLlxuICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSBzcGFjZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIHB1YmxpYyBvdmVycmlkZSBoZWlnaHQ6IG51bWJlcixcbiAgICAgIHB1YmxpYyBvdmVycmlkZSB3aWR0aDogbnVtYmVyKSB7XG4gICAgc3VwZXIoY29uc3RhbnRzKTtcbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuU1BBQ0VSIHwgVHlwZXMuQkVUV0VFTl9ST1dfU1BBQ0VSO1xuXG4gICAgdGhpcy5lbGVtZW50cyA9IFtuZXcgSW5Sb3dTcGFjZXIodGhpcy5jb25zdGFudHNfLCB3aWR0aCldO1xuICB9XG5cbiAgb3ZlcnJpZGUgbWVhc3VyZSgpIHt9XG59XG4vLyBOT1AuICBXaWR0aCBhbmQgaGVpZ2h0IHdlcmUgc2V0IGF0IGNyZWF0aW9uLlxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdHMgcmVwcmVzZW50aW5nIGEgc3F1YXJlIGNvcm5lciBpbiBhIHJvdyBvZiBhIHJlbmRlcmVkXG4gKiBibG9jay5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5TcXVhcmVDb3JuZXInKTtcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQge01lYXN1cmFibGV9IGZyb20gJy4vYmFzZS5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuL3R5cGVzLmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzcGFjZSBhIHNxdWFyZSBjb3JuZXIgdGFrZXMgdXBcbiAqIGR1cmluZyByZW5kZXJpbmcuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuU3F1YXJlQ29ybmVyXG4gKi9cbmV4cG9ydCBjbGFzcyBTcXVhcmVDb3JuZXIgZXh0ZW5kcyBNZWFzdXJhYmxlIHtcbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBvcHRfcG9zaXRpb24gVGhlIHBvc2l0aW9uIG9mIHRoaXMgY29ybmVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlciwgb3B0X3Bvc2l0aW9uPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoY29uc3RhbnRzKTtcbiAgICB0aGlzLnR5cGUgPVxuICAgICAgICAoIW9wdF9wb3NpdGlvbiB8fCBvcHRfcG9zaXRpb24gPT09ICdsZWZ0JyA/IFR5cGVzLkxFRlRfU1FVQVJFX0NPUk5FUiA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZXMuUklHSFRfU1FVQVJFX0NPUk5FUikgfFxuICAgICAgICBUeXBlcy5DT1JORVI7XG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmNvbnN0YW50c18uTk9fUEFERElORztcbiAgICB0aGlzLndpZHRoID0gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGEgdG9wIHJvdyBvbiBhIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlRvcFJvdycpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uLy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7SGF0fSBmcm9tICcuL2hhdC5qcyc7XG5pbXBvcnQgdHlwZSB7UHJldmlvdXNDb25uZWN0aW9ufSBmcm9tICcuL3ByZXZpb3VzX2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtSb3d9IGZyb20gJy4vcm93LmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4vdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCBlbGVtZW50cyBhcmUgaW4gdGhlIHRvcCByb3cgb2YgYVxuICogYmxvY2sgYXMgd2VsbCBhcyBzaXppbmcgaW5mb3JtYXRpb24gZm9yIHRoZSB0b3Agcm93LlxuICogRWxlbWVudHMgaW4gYSB0b3Agcm93IGNhbiBjb25zaXN0IG9mIGNvcm5lcnMsIGhhdHMsIHNwYWNlcnMsIGFuZCBwcmV2aW91c1xuICogY29ubmVjdGlvbnMuXG4gKiBBZnRlciB0aGlzIGNvbnN0cnVjdG9yIGlzIGNhbGxlZCwgdGhlIHJvdyB3aWxsIGNvbnRhaW4gYWxsIG5vbi1zcGFjZXJcbiAqIGVsZW1lbnRzIGl0IG5lZWRzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlRvcFJvd1xuICovXG5leHBvcnQgY2xhc3MgVG9wUm93IGV4dGVuZHMgUm93IHtcbiAgLyoqXG4gICAqIFRoZSBzdGFydGluZyBwb2ludCBmb3IgZHJhd2luZyB0aGUgcm93LCBpbiB0aGUgeSBkaXJlY3Rpb24uXG4gICAqIFRoaXMgYWxsb3dzIHVzIHRvIGRyYXcgaGF0cyBhbmQgc2ltaWxhciBzaGFwZXMgdGhhdCBkb24ndCBzdGFydCBhdCB0aGVcbiAgICogb3JpZ2luLiBNdXN0IGJlIG5vbi1uZWdhdGl2ZSAoc2VlICMyODIwKS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjYXBsaW5lID0gMDtcblxuICAvKiogSG93IG11Y2ggdGhlIHJvdyBleHRlbmRzIHVwIGFib3ZlIGl0cyBjYXBsaW5lLiAqL1xuICBhc2NlbmRlckhlaWdodCA9IDA7XG5cbiAgLyoqIFdoZXRoZXIgdGhlIGJsb2NrIGhhcyBhIHByZXZpb3VzIGNvbm5lY3Rpb24uICovXG4gIGhhc1ByZXZpb3VzQ29ubmVjdGlvbiA9IGZhbHNlO1xuXG4gIC8qKiBUaGUgcHJldmlvdXMgY29ubmVjdGlvbiBvbiB0aGUgYmxvY2ssIGlmIGFueS4gKi9cbiAgY29ubmVjdGlvbjogUHJldmlvdXNDb25uZWN0aW9ufG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJpbmcgY29uc3RhbnRzIHByb3ZpZGVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlcikge1xuICAgIHN1cGVyKGNvbnN0YW50cyk7XG5cbiAgICB0aGlzLnR5cGUgfD0gVHlwZXMuVE9QX1JPVztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSB0b3Agcm93IGhhcyBhIGxlZnQgc3F1YXJlIGNvcm5lci5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB3aG9zZSB0b3Agcm93IHRoaXMgcmVwcmVzZW50cy5cbiAgICogQHJldHVybnMgV2hldGhlciBvciBub3QgdGhlIHRvcCByb3cgaGFzIGEgbGVmdCBzcXVhcmUgY29ybmVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhc0xlZnRTcXVhcmVDb3JuZXIoYmxvY2s6IEJsb2NrU3ZnKTogYm9vbGVhbiB7XG4gICAgY29uc3QgaGFzSGF0ID1cbiAgICAgICAgKGJsb2NrLmhhdCA/IGJsb2NrLmhhdCA9PT0gJ2NhcCcgOiB0aGlzLmNvbnN0YW50c18uQUREX1NUQVJUX0hBVFMpICYmXG4gICAgICAgICFibG9jay5vdXRwdXRDb25uZWN0aW9uICYmICFibG9jay5wcmV2aW91c0Nvbm5lY3Rpb247XG4gICAgY29uc3QgcHJldkJsb2NrID0gYmxvY2suZ2V0UHJldmlvdXNCbG9jaygpO1xuXG4gICAgcmV0dXJuICEhYmxvY2sub3V0cHV0Q29ubmVjdGlvbiB8fCBoYXNIYXQgfHxcbiAgICAgICAgKHByZXZCbG9jayA/IHByZXZCbG9jay5nZXROZXh0QmxvY2soKSA9PT0gYmxvY2sgOiBmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgdG9wIHJvdyBoYXMgYSByaWdodCBzcXVhcmUgY29ybmVyLlxuICAgKlxuICAgKiBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayB3aG9zZSB0b3Agcm93IHRoaXMgcmVwcmVzZW50cy5cbiAgICogQHJldHVybnMgV2hldGhlciBvciBub3QgdGhlIHRvcCByb3cgaGFzIGEgcmlnaHQgc3F1YXJlIGNvcm5lci5cbiAgICovXG4gIGhhc1JpZ2h0U3F1YXJlQ29ybmVyKF9ibG9jazogQmxvY2tTdmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIG92ZXJyaWRlIG1lYXN1cmUoKSB7XG4gICAgbGV0IGhlaWdodCA9IDA7XG4gICAgbGV0IHdpZHRoID0gMDtcbiAgICBsZXQgYXNjZW5kZXJIZWlnaHQgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZWxlbSA9IHRoaXMuZWxlbWVudHNbaV07XG4gICAgICB3aWR0aCArPSBlbGVtLndpZHRoO1xuICAgICAgaWYgKCFUeXBlcy5pc1NwYWNlcihlbGVtKSkge1xuICAgICAgICBpZiAoVHlwZXMuaXNIYXQoZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIEhhdCkge1xuICAgICAgICAgIGFzY2VuZGVySGVpZ2h0ID0gTWF0aC5tYXgoYXNjZW5kZXJIZWlnaHQsIGVsZW0uYXNjZW5kZXJIZWlnaHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhlaWdodCA9IE1hdGgubWF4KGhlaWdodCwgZWxlbS5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMud2lkdGggPSBNYXRoLm1heCh0aGlzLm1pbldpZHRoLCB3aWR0aCk7XG4gICAgdGhpcy5oZWlnaHQgPSBNYXRoLm1heCh0aGlzLm1pbkhlaWdodCwgaGVpZ2h0KSArIGFzY2VuZGVySGVpZ2h0O1xuICAgIHRoaXMuYXNjZW5kZXJIZWlnaHQgPSBhc2NlbmRlckhlaWdodDtcbiAgICB0aGlzLmNhcGxpbmUgPSB0aGlzLmFzY2VuZGVySGVpZ2h0O1xuICAgIHRoaXMud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzID0gdGhpcy53aWR0aDtcbiAgfVxuXG4gIG92ZXJyaWRlIHN0YXJ0c1dpdGhFbGVtU3BhY2VyKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG92ZXJyaWRlIGVuZHNXaXRoRWxlbVNwYWNlcigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBNZXRob2RzIGZvciByZW5kZXJpbmcgZGVidWcgZ3JhcGhpY3MuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuYmxvY2tSZW5kZXJpbmcuRGVidWcnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi4vLi4vY29ubmVjdGlvbl90eXBlLmpzJztcbmltcG9ydCB7RmllbGRMYWJlbH0gZnJvbSAnLi4vLi4vZmllbGRfbGFiZWwuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlcmVkQ29ubmVjdGlvbn0gZnJvbSAnLi4vLi4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi4vLi4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuLi8uLi91dGlscy9zdmcuanMnO1xuaW1wb3J0IHR5cGUge01lYXN1cmFibGV9IGZyb20gJy4uL21lYXN1cmFibGVzL2Jhc2UuanMnO1xuaW1wb3J0IHtGaWVsZH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvZmllbGQuanMnO1xuaW1wb3J0IHR5cGUge0luUm93U3BhY2VyfSBmcm9tICcuLi9tZWFzdXJhYmxlcy9pbl9yb3dfc3BhY2VyLmpzJztcbmltcG9ydCB7SW5wdXRDb25uZWN0aW9ufSBmcm9tICcuLi9tZWFzdXJhYmxlcy9pbnB1dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3Jvdy5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuLi9tZWFzdXJhYmxlcy90eXBlcy5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVySW5mbyBhcyBaZWxvc0luZm99IGZyb20gJy4uL3plbG9zL2luZm8uanMnO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlckluZm99IGZyb20gJy4vaW5mby5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCByZW5kZXJzIHJlY3RhbmdsZXMgYW5kIGRvdHMgZm9yIGRlYnVnZ2luZyByZW5kZXJpbmcgY29kZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5EZWJ1Z1xuICovXG5leHBvcnQgY2xhc3MgRGVidWcge1xuICAvKipcbiAgICogQ29uZmlndXJhdGlvbiBvYmplY3QgY29udGFpbmluZyBib29sZWFucyB0byBlbmFibGUgYW5kIGRpc2FibGUgZGVidWdcbiAgICogcmVuZGVyaW5nIG9mIHNwZWNpZmljIHJlbmRlcmluZyBjb21wb25lbnRzLlxuICAgKi9cbiAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICByb3dTcGFjZXJzOiB0cnVlLFxuICAgIGVsZW1TcGFjZXJzOiB0cnVlLFxuICAgIHJvd3M6IHRydWUsXG4gICAgZWxlbXM6IHRydWUsXG4gICAgY29ubmVjdGlvbnM6IHRydWUsXG4gICAgYmxvY2tCb3VuZHM6IHRydWUsXG4gICAgY29ubmVjdGVkQmxvY2tCb3VuZHM6IHRydWUsXG4gICAgcmVuZGVyOiB0cnVlLFxuICB9O1xuXG4gIC8qKiBBbiBhcnJheSBvZiBTVkcgZWxlbWVudHMgdGhhdCBoYXZlIGJlZW4gY3JlYXRlZCBieSB0aGlzIG9iamVjdC4gKi9cbiAgcHJpdmF0ZSBkZWJ1Z0VsZW1lbnRzXzogU1ZHRWxlbWVudFtdID0gW107XG5cbiAgLyoqXG4gICAqIFRoZSBTVkcgcm9vdCBvZiB0aGUgYmxvY2sgdGhhdCBpcyBiZWluZyByZW5kZXJlZC4gIERlYnVnIGVsZW1lbnRzIHdpbGxcbiAgICogYmUgYXR0YWNoZWQgdG8gdGhpcyByb290LlxuICAgKi9cbiAgcHJpdmF0ZSBzdmdSb290XzogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICBwcml2YXRlIHJhbmRvbUNvbG91cl8gPSAnJztcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyZXIncyBjb25zdGFudHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIpIHt9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbGwgZWxlbWVudHMgdGhlIHRoaXMgb2JqZWN0IGNyZWF0ZWQgb24gdGhlIGxhc3QgcGFzcy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjbGVhckVsZW1zKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZWxlbSA9IHRoaXMuZGVidWdFbGVtZW50c19baV07XG4gICAgICBkb20ucmVtb3ZlTm9kZShlbGVtKTtcbiAgICB9XG5cbiAgICB0aGlzLmRlYnVnRWxlbWVudHNfID0gW107XG4gIH1cblxuICAvKipcbiAgICogRHJhdyBhIGRlYnVnIHJlY3RhbmdsZSBmb3IgYSBzcGFjZXIgKGVtcHR5KSByb3cuXG4gICAqXG4gICAqIEBwYXJhbSByb3cgVGhlIHJvdyB0byByZW5kZXIuXG4gICAqIEBwYXJhbSBjdXJzb3JZIFRoZSB5IHBvc2l0aW9uIG9mIHRoZSB0b3Agb2YgdGhlIHJvdy5cbiAgICogQHBhcmFtIGlzUnRsIFdoZXRoZXIgdGhlIGJsb2NrIGlzIHJlbmRlcmVkIFJUTC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBkcmF3U3BhY2VyUm93KHJvdzogUm93LCBjdXJzb3JZOiBudW1iZXIsIGlzUnRsOiBib29sZWFuKSB7XG4gICAgaWYgKCFEZWJ1Zy5jb25maWcucm93U3BhY2Vycykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGhlaWdodCA9IE1hdGguYWJzKHJvdy5oZWlnaHQpO1xuICAgIGNvbnN0IGlzTmVnYXRpdmVTcGFjaW5nID0gcm93LmhlaWdodCA8IDA7XG4gICAgaWYgKGlzTmVnYXRpdmVTcGFjaW5nKSB7XG4gICAgICBjdXJzb3JZIC09IGhlaWdodDtcbiAgICB9XG5cbiAgICB0aGlzLmRlYnVnRWxlbWVudHNfLnB1c2goZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ3Jvd1NwYWNlclJlY3QgYmxvY2tSZW5kZXJEZWJ1ZycsXG4gICAgICAgICAgJ3gnOiBpc1J0bCA/IC0ocm93LnhQb3MgKyByb3cud2lkdGgpIDogcm93LnhQb3MsXG4gICAgICAgICAgJ3knOiBjdXJzb3JZLFxuICAgICAgICAgICd3aWR0aCc6IHJvdy53aWR0aCxcbiAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0LFxuICAgICAgICAgICdzdHJva2UnOiBpc05lZ2F0aXZlU3BhY2luZyA/ICdibGFjaycgOiAnYmx1ZScsXG4gICAgICAgICAgJ2ZpbGwnOiAnYmx1ZScsXG4gICAgICAgICAgJ2ZpbGwtb3BhY2l0eSc6ICcwLjUnLFxuICAgICAgICAgICdzdHJva2Utd2lkdGgnOiAnMXB4JyxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5zdmdSb290XykpO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgYSBkZWJ1ZyByZWN0YW5nbGUgZm9yIGEgaG9yaXpvbnRhbCBzcGFjZXIuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtIFRoZSBzcGFjZXIgdG8gcmVuZGVyLlxuICAgKiBAcGFyYW0gcm93SGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIGNvbnRhaW5lciByb3cuXG4gICAqIEBwYXJhbSBpc1J0bCBXaGV0aGVyIHRoZSBibG9jayBpcyByZW5kZXJlZCBSVEwuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZHJhd1NwYWNlckVsZW0oZWxlbTogSW5Sb3dTcGFjZXIsIHJvd0hlaWdodDogbnVtYmVyLCBpc1J0bDogYm9vbGVhbikge1xuICAgIGlmICghRGVidWcuY29uZmlnLmVsZW1TcGFjZXJzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgd2lkdGggPSBNYXRoLmFicyhlbGVtLndpZHRoKTtcbiAgICBjb25zdCBpc05lZ2F0aXZlU3BhY2luZyA9IGVsZW0ud2lkdGggPCAwO1xuICAgIGxldCB4UG9zID0gaXNOZWdhdGl2ZVNwYWNpbmcgPyBlbGVtLnhQb3MgLSB3aWR0aCA6IGVsZW0ueFBvcztcbiAgICBpZiAoaXNSdGwpIHtcbiAgICAgIHhQb3MgPSAtKHhQb3MgKyB3aWR0aCk7XG4gICAgfVxuICAgIGNvbnN0IHlQb3MgPSBlbGVtLmNlbnRlcmxpbmUgLSBlbGVtLmhlaWdodCAvIDI7XG4gICAgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5wdXNoKGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwge1xuICAgICAgICAgICdjbGFzcyc6ICdlbGVtU3BhY2VyUmVjdCBibG9ja1JlbmRlckRlYnVnJyxcbiAgICAgICAgICAneCc6IHhQb3MsXG4gICAgICAgICAgJ3knOiB5UG9zLFxuICAgICAgICAgICd3aWR0aCc6IHdpZHRoLFxuICAgICAgICAgICdoZWlnaHQnOiBlbGVtLmhlaWdodCxcbiAgICAgICAgICAnc3Ryb2tlJzogJ3BpbmsnLFxuICAgICAgICAgICdmaWxsJzogaXNOZWdhdGl2ZVNwYWNpbmcgPyAnYmxhY2snIDogJ3BpbmsnLFxuICAgICAgICAgICdmaWxsLW9wYWNpdHknOiAnMC41JyxcbiAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogJzFweCcsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuc3ZnUm9vdF8pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgZGVidWcgcmVjdGFuZ2xlIGZvciBhbiBpbi1yb3cgZWxlbWVudC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW0gVGhlIGVsZW1lbnQgdG8gcmVuZGVyLlxuICAgKiBAcGFyYW0gaXNSdGwgV2hldGhlciB0aGUgYmxvY2sgaXMgcmVuZGVyZWQgUlRMLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdSZW5kZXJlZEVsZW0oZWxlbTogTWVhc3VyYWJsZSwgaXNSdGw6IGJvb2xlYW4pIHtcbiAgICBpZiAoRGVidWcuY29uZmlnLmVsZW1zKSB7XG4gICAgICBsZXQgeFBvcyA9IGVsZW0ueFBvcztcbiAgICAgIGlmIChpc1J0bCkge1xuICAgICAgICB4UG9zID0gLSh4UG9zICsgZWxlbS53aWR0aCk7XG4gICAgICB9XG4gICAgICBjb25zdCB5UG9zID0gZWxlbS5jZW50ZXJsaW5lIC0gZWxlbS5oZWlnaHQgLyAyO1xuICAgICAgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5wdXNoKGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgICAnY2xhc3MnOiAncm93UmVuZGVyaW5nUmVjdCBibG9ja1JlbmRlckRlYnVnJyxcbiAgICAgICAgICAgICd4JzogeFBvcyxcbiAgICAgICAgICAgICd5JzogeVBvcyxcbiAgICAgICAgICAgICd3aWR0aCc6IGVsZW0ud2lkdGgsXG4gICAgICAgICAgICAnaGVpZ2h0JzogZWxlbS5oZWlnaHQsXG4gICAgICAgICAgICAnc3Ryb2tlJzogJ2JsYWNrJyxcbiAgICAgICAgICAgICdmaWxsJzogJ25vbmUnLFxuICAgICAgICAgICAgJ3N0cm9rZS13aWR0aCc6ICcxcHgnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5zdmdSb290XykpO1xuXG4gICAgICBpZiAoVHlwZXMuaXNGaWVsZChlbGVtKSAmJiBlbGVtIGluc3RhbmNlb2YgRmllbGQgJiZcbiAgICAgICAgICBlbGVtLmZpZWxkIGluc3RhbmNlb2YgRmllbGRMYWJlbCkge1xuICAgICAgICBjb25zdCBiYXNlbGluZSA9IHRoaXMuY29uc3RhbnRzLkZJRUxEX1RFWFRfQkFTRUxJTkU7XG4gICAgICAgIHRoaXMuZGVidWdFbGVtZW50c18ucHVzaChkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgICAgICdjbGFzcyc6ICdyb3dSZW5kZXJpbmdSZWN0IGJsb2NrUmVuZGVyRGVidWcnLFxuICAgICAgICAgICAgICAneCc6IHhQb3MsXG4gICAgICAgICAgICAgICd5JzogeVBvcyArIGJhc2VsaW5lLFxuICAgICAgICAgICAgICAnd2lkdGgnOiBlbGVtLndpZHRoLFxuICAgICAgICAgICAgICAnaGVpZ2h0JzogJzAuMXB4JyxcbiAgICAgICAgICAgICAgJ3N0cm9rZSc6ICdyZWQnLFxuICAgICAgICAgICAgICAnZmlsbCc6ICdub25lJyxcbiAgICAgICAgICAgICAgJ3N0cm9rZS13aWR0aCc6ICcwLjVweCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGhpcy5zdmdSb290XykpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChUeXBlcy5pc0lucHV0KGVsZW0pICYmIGVsZW0gaW5zdGFuY2VvZiBJbnB1dENvbm5lY3Rpb24gJiZcbiAgICAgICAgRGVidWcuY29uZmlnLmNvbm5lY3Rpb25zKSB7XG4gICAgICB0aGlzLmRyYXdDb25uZWN0aW9uKGVsZW0uY29ubmVjdGlvbk1vZGVsKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRHJhdyBhIGNpcmNsZSBhdCB0aGUgbG9jYXRpb24gb2YgdGhlIGdpdmVuIGNvbm5lY3Rpb24uICBJbnB1dHMgYW5kIG91dHB1dHNcbiAgICogc2hhcmUgdGhlIHNhbWUgY29sb3VycywgYXMgZG8gcHJldmlvdXMgYW5kIG5leHQuICBXaGVuIHBvc2l0aW9uZWQgY29ycmVjdGx5XG4gICAqIGEgY29ubmVjdGVkIHBhaXIgd2lsbCBsb29rIGxpa2UgYSBidWxsc2V5ZS5cbiAgICpcbiAgICogQHBhcmFtIGNvbm4gVGhlIGNvbm5lY3Rpb24gdG8gY2lyY2xlLlxuICAgKiBAc3VwcHJlc3Mge3Zpc2liaWxpdHl9IFN1cHByZXNzIHZpc2liaWxpdHkgb2YgY29ubi5vZmZzZXRJbkJsb2NrXyBzaW5jZVxuICAgKiB0aGlzIGlzIGEgZGVidWcgbW9kdWxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdDb25uZWN0aW9uKGNvbm46IFJlbmRlcmVkQ29ubmVjdGlvbikge1xuICAgIGlmICghRGVidWcuY29uZmlnLmNvbm5lY3Rpb25zKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGNvbG91ciA9ICcnO1xuICAgIGxldCBzaXplID0gMDtcbiAgICBsZXQgZmlsbCA9ICcnO1xuICAgIGlmIChjb25uLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFKSB7XG4gICAgICBzaXplID0gNDtcbiAgICAgIGNvbG91ciA9ICdtYWdlbnRhJztcbiAgICAgIGZpbGwgPSAnbm9uZSc7XG4gICAgfSBlbHNlIGlmIChjb25uLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLk9VVFBVVF9WQUxVRSkge1xuICAgICAgc2l6ZSA9IDI7XG4gICAgICBjb2xvdXIgPSAnbWFnZW50YSc7XG4gICAgICBmaWxsID0gY29sb3VyO1xuICAgIH0gZWxzZSBpZiAoY29ubi50eXBlID09PSBDb25uZWN0aW9uVHlwZS5ORVhUX1NUQVRFTUVOVCkge1xuICAgICAgc2l6ZSA9IDQ7XG4gICAgICBjb2xvdXIgPSAnZ29sZGVucm9kJztcbiAgICAgIGZpbGwgPSAnbm9uZSc7XG4gICAgfSBlbHNlIGlmIChjb25uLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLlBSRVZJT1VTX1NUQVRFTUVOVCkge1xuICAgICAgc2l6ZSA9IDI7XG4gICAgICBjb2xvdXIgPSAnZ29sZGVucm9kJztcbiAgICAgIGZpbGwgPSBjb2xvdXI7XG4gICAgfVxuICAgIHRoaXMuZGVidWdFbGVtZW50c18ucHVzaChkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkNJUkNMRSwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja1JlbmRlckRlYnVnJyxcbiAgICAgICAgICAnY3gnOiBjb25uLmdldE9mZnNldEluQmxvY2soKS54LFxuICAgICAgICAgICdjeSc6IGNvbm4uZ2V0T2Zmc2V0SW5CbG9jaygpLnksXG4gICAgICAgICAgJ3InOiBzaXplLFxuICAgICAgICAgICdmaWxsJzogZmlsbCxcbiAgICAgICAgICAnc3Ryb2tlJzogY29sb3VyLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLnN2Z1Jvb3RfKSk7XG4gIH1cblxuICAvKipcbiAgICogRHJhdyBhIGRlYnVnIHJlY3RhbmdsZSBmb3IgYSBub24tZW1wdHkgcm93LlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSBub24tZW1wdHkgcm93IHRvIHJlbmRlci5cbiAgICogQHBhcmFtIGN1cnNvclkgVGhlIHkgcG9zaXRpb24gb2YgdGhlIHRvcCBvZiB0aGUgcm93LlxuICAgKiBAcGFyYW0gaXNSdGwgV2hldGhlciB0aGUgYmxvY2sgaXMgcmVuZGVyZWQgUlRMLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdSZW5kZXJlZFJvdyhyb3c6IFJvdywgY3Vyc29yWTogbnVtYmVyLCBpc1J0bDogYm9vbGVhbikge1xuICAgIGlmICghRGVidWcuY29uZmlnLnJvd3MpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5wdXNoKGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwge1xuICAgICAgICAgICdjbGFzcyc6ICdlbGVtUmVuZGVyaW5nUmVjdCBibG9ja1JlbmRlckRlYnVnJyxcbiAgICAgICAgICAneCc6IGlzUnRsID8gLShyb3cueFBvcyArIHJvdy53aWR0aCkgOiByb3cueFBvcyxcbiAgICAgICAgICAneSc6IHJvdy55UG9zLFxuICAgICAgICAgICd3aWR0aCc6IHJvdy53aWR0aCxcbiAgICAgICAgICAnaGVpZ2h0Jzogcm93LmhlaWdodCxcbiAgICAgICAgICAnc3Ryb2tlJzogJ3JlZCcsXG4gICAgICAgICAgJ2ZpbGwnOiAnbm9uZScsXG4gICAgICAgICAgJ3N0cm9rZS13aWR0aCc6ICcxcHgnLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLnN2Z1Jvb3RfKSk7XG5cbiAgICBpZiAoVHlwZXMuaXNUb3BPckJvdHRvbVJvdyhyb3cpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKERlYnVnLmNvbmZpZy5jb25uZWN0ZWRCbG9ja0JvdW5kcykge1xuICAgICAgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5wdXNoKGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgICAnY2xhc3MnOiAnY29ubmVjdGVkQmxvY2tXaWR0aCBibG9ja1JlbmRlckRlYnVnJyxcbiAgICAgICAgICAgICd4JzogaXNSdGwgPyAtKHJvdy54UG9zICsgcm93LndpZHRoV2l0aENvbm5lY3RlZEJsb2NrcykgOiByb3cueFBvcyxcbiAgICAgICAgICAgICd5Jzogcm93LnlQb3MsXG4gICAgICAgICAgICAnd2lkdGgnOiByb3cud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzLFxuICAgICAgICAgICAgJ2hlaWdodCc6IHJvdy5oZWlnaHQsXG4gICAgICAgICAgICAnc3Ryb2tlJzogdGhpcy5yYW5kb21Db2xvdXJfLFxuICAgICAgICAgICAgJ2ZpbGwnOiAnbm9uZScsXG4gICAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogJzFweCcsXG4gICAgICAgICAgICAnc3Ryb2tlLWRhc2hhcnJheSc6ICczLDMnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5zdmdSb290XykpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGRlYnVnIHJlY3RhbmdsZXMgZm9yIGEgbm9uLWVtcHR5IHJvdyBhbmQgYWxsIG9mIGl0cyBzdWJjb21wb25lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSBub24tZW1wdHkgcm93IHRvIHJlbmRlci5cbiAgICogQHBhcmFtIGN1cnNvclkgVGhlIHkgcG9zaXRpb24gb2YgdGhlIHRvcCBvZiB0aGUgcm93LlxuICAgKiBAcGFyYW0gaXNSdGwgV2hldGhlciB0aGUgYmxvY2sgaXMgcmVuZGVyZWQgUlRMLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdSb3dXaXRoRWxlbWVudHMocm93OiBSb3csIGN1cnNvclk6IG51bWJlciwgaXNSdGw6IGJvb2xlYW4pIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvdy5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZWxlbSA9IHJvdy5lbGVtZW50c1tpXTtcbiAgICAgIGlmICghZWxlbSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0Egcm93IGhhcyBhbiB1bmRlZmluZWQgb3IgbnVsbCBlbGVtZW50LicsIHJvdywgZWxlbSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKFR5cGVzLmlzU3BhY2VyKGVsZW0pKSB7XG4gICAgICAgIHRoaXMuZHJhd1NwYWNlckVsZW0oZWxlbSBhcyBJblJvd1NwYWNlciwgcm93LmhlaWdodCwgaXNSdGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kcmF3UmVuZGVyZWRFbGVtKGVsZW0sIGlzUnRsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kcmF3UmVuZGVyZWRSb3cocm93LCBjdXJzb3JZLCBpc1J0bCk7XG4gIH1cblxuICAvKipcbiAgICogRHJhdyBhIGRlYnVnIHJlY3RhbmdsZSBhcm91bmQgdGhlIGVudGlyZSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGluZm8gUmVuZGVyaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBibG9jayB0byBkZWJ1Zy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBkcmF3Qm91bmRpbmdCb3goaW5mbzogUmVuZGVySW5mbykge1xuICAgIGlmICghRGVidWcuY29uZmlnLmJsb2NrQm91bmRzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIEJvdW5kaW5nIGJveCB3aXRob3V0IGNoaWxkcmVuLlxuICAgIGxldCB4UG9zID0gaW5mby5SVEwgPyAtaW5mby53aWR0aCA6IDA7XG4gICAgY29uc3QgeVBvcyA9IDA7XG4gICAgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5wdXNoKGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja0JvdW5kaW5nQm94IGJsb2NrUmVuZGVyRGVidWcnLFxuICAgICAgICAgICd4JzogeFBvcyxcbiAgICAgICAgICAneSc6IHlQb3MsXG4gICAgICAgICAgJ3dpZHRoJzogaW5mby53aWR0aCxcbiAgICAgICAgICAnaGVpZ2h0JzogaW5mby5oZWlnaHQsXG4gICAgICAgICAgJ3N0cm9rZSc6ICdibGFjaycsXG4gICAgICAgICAgJ2ZpbGwnOiAnbm9uZScsXG4gICAgICAgICAgJ3N0cm9rZS13aWR0aCc6ICcxcHgnLFxuICAgICAgICAgICdzdHJva2UtZGFzaGFycmF5JzogJzUsNScsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuc3ZnUm9vdF8pKTtcblxuICAgIGlmIChEZWJ1Zy5jb25maWcuY29ubmVjdGVkQmxvY2tCb3VuZHMpIHtcbiAgICAgIC8vIEJvdW5kaW5nIGJveCB3aXRoIGNoaWxkcmVuLlxuICAgICAgeFBvcyA9IGluZm8uUlRMID8gLWluZm8ud2lkdGhXaXRoQ2hpbGRyZW4gOiAwO1xuICAgICAgdGhpcy5kZWJ1Z0VsZW1lbnRzXy5wdXNoKGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tSZW5kZXJEZWJ1ZycsXG4gICAgICAgICAgICAneCc6IHhQb3MsXG4gICAgICAgICAgICAneSc6IHlQb3MsXG4gICAgICAgICAgICAnd2lkdGgnOiBpbmZvLndpZHRoV2l0aENoaWxkcmVuLFxuICAgICAgICAgICAgJ2hlaWdodCc6IGluZm8uaGVpZ2h0LFxuICAgICAgICAgICAgJ3N0cm9rZSc6ICcjREY1N0JDJyxcbiAgICAgICAgICAgICdmaWxsJzogJ25vbmUnLFxuICAgICAgICAgICAgJ3N0cm9rZS13aWR0aCc6ICcxcHgnLFxuICAgICAgICAgICAgJ3N0cm9rZS1kYXNoYXJyYXknOiAnMywzJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMuc3ZnUm9vdF8pKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRG8gYWxsIG9mIHRoZSB3b3JrIHRvIGRyYXcgZGVidWcgaW5mb3JtYXRpb24gZm9yIHRoZSB3aG9sZSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBkcmF3IGRlYnVnIGluZm9ybWF0aW9uIGZvci5cbiAgICogQHBhcmFtIGluZm8gUmVuZGVyaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBibG9jayB0byBkZWJ1Zy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBkcmF3RGVidWcoYmxvY2s6IEJsb2NrU3ZnLCBpbmZvOiBSZW5kZXJJbmZvKSB7XG4gICAgdGhpcy5jbGVhckVsZW1zKCk7XG4gICAgdGhpcy5zdmdSb290XyA9IGJsb2NrLmdldFN2Z1Jvb3QoKTtcblxuICAgIHRoaXMucmFuZG9tQ29sb3VyXyA9XG4gICAgICAgICcjJyArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2Nzc3MjE1KS50b1N0cmluZygxNik7XG5cbiAgICBsZXQgY3Vyc29yWSA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmZvLnJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHJvdyA9IGluZm8ucm93c1tpXTtcbiAgICAgIGlmIChUeXBlcy5pc0JldHdlZW5Sb3dTcGFjZXIocm93KSkge1xuICAgICAgICB0aGlzLmRyYXdTcGFjZXJSb3cocm93LCBjdXJzb3JZLCBpbmZvLlJUTCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXdSb3dXaXRoRWxlbWVudHMocm93LCBjdXJzb3JZLCBpbmZvLlJUTCk7XG4gICAgICB9XG4gICAgICBjdXJzb3JZICs9IHJvdy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgaWYgKGJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbikge1xuICAgICAgdGhpcy5kcmF3Q29ubmVjdGlvbihibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYmxvY2submV4dENvbm5lY3Rpb24pIHtcbiAgICAgIHRoaXMuZHJhd0Nvbm5lY3Rpb24oYmxvY2submV4dENvbm5lY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYmxvY2sub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgdGhpcy5kcmF3Q29ubmVjdGlvbihibG9jay5vdXRwdXRDb25uZWN0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVE9ETzogRmluZCBhIGJldHRlciB3YXkgdG8gZG8gdGhpcyBjaGVjayB3aXRob3V0IHB1bGxpbmcgaW4gYWxsIG9mXG4gICAgICogemVsb3MsIG9yIGp1c3QgZGVsZXRlIHRoaXMgbGluZSBvciB0aGUgd2hvbGUgZGVidWcgcmVuZGVyZXIuXG4gICAgICovXG4gICAgY29uc3QgbWF5YmVaZWxvc0luZm8gPSBpbmZvIGFzIFplbG9zSW5mbztcbiAgICBpZiAobWF5YmVaZWxvc0luZm8ucmlnaHRTaWRlKSB7XG4gICAgICB0aGlzLmRyYXdSZW5kZXJlZEVsZW0obWF5YmVaZWxvc0luZm8ucmlnaHRTaWRlLCBpbmZvLlJUTCk7XG4gICAgfVxuXG4gICAgdGhpcy5kcmF3Qm91bmRpbmdCb3goaW5mbyk7XG5cbiAgICB0aGlzLmRyYXdSZW5kZXIoYmxvY2sucGF0aE9iamVjdC5zdmdQYXRoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGEgZGVidWcgZmlsdGVyIHRvIGhpZ2hsaWdodCB0aGF0IGEgYmxvY2sgaGFzIGJlZW4gcmVuZGVyZWQuXG4gICAqXG4gICAqIEBwYXJhbSBzdmdQYXRoIFRoZSBibG9jaydzIFNWRyBwYXRoLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdSZW5kZXIoc3ZnUGF0aDogU1ZHRWxlbWVudCkge1xuICAgIGlmICghRGVidWcuY29uZmlnLnJlbmRlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzdmdQYXRoLnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ2ZpbHRlcicsICd1cmwoIycgKyB0aGlzLmNvbnN0YW50cy5kZWJ1Z0ZpbHRlcklkICsgJyknKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgc3ZnUGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbHRlcicsICcnKTtcbiAgICB9LCAxMDApO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWV0aG9kcyBmb3IgZ3JhcGhpY2FsbHkgcmVuZGVyaW5nIGEgYmxvY2sgYXMgU1ZHLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkRyYXdlcicpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uLy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4uLy4uL3V0aWxzLmpzJztcbmltcG9ydCAqIGFzIHN2Z1BhdGhzIGZyb20gJy4uLy4uL3V0aWxzL3N2Z19wYXRocy5qcyc7XG5pbXBvcnQge0Nvbm5lY3Rpb259IGZyb20gJy4uL21lYXN1cmFibGVzL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge0V4dGVybmFsVmFsdWVJbnB1dH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvZXh0ZXJuYWxfdmFsdWVfaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuLi9tZWFzdXJhYmxlcy9maWVsZC5qcyc7XG5pbXBvcnQgdHlwZSB7SWNvbn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvaWNvbi5qcyc7XG5pbXBvcnQgdHlwZSB7SW5saW5lSW5wdXR9IGZyb20gJy4uL21lYXN1cmFibGVzL2lubGluZV9pbnB1dC5qcyc7XG5pbXBvcnQgdHlwZSB7UHJldmlvdXNDb25uZWN0aW9ufSBmcm9tICcuLi9tZWFzdXJhYmxlcy9wcmV2aW91c19jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3Jvdy5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuLi9tZWFzdXJhYmxlcy90eXBlcy5qcyc7XG5cbmltcG9ydCB7aXNEeW5hbWljU2hhcGV9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyLCBOb3RjaCwgUHV6emxlVGFifSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICcuL2RlYnVnLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgZHJhd3MgYSBibG9jayBiYXNlZCBvbiB0aGUgZ2l2ZW4gcmVuZGVyaW5nIGluZm9ybWF0aW9uLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLkRyYXdlclxuICovXG5leHBvcnQgY2xhc3MgRHJhd2VyIHtcbiAgYmxvY2tfOiBCbG9ja1N2ZztcbiAgaW5mb186IFJlbmRlckluZm87XG4gIHRvcExlZnRfOiBDb29yZGluYXRlO1xuICBvdXRsaW5lUGF0aF8gPSAnJztcbiAgaW5saW5lUGF0aF8gPSAnJztcbiAgcHJvdGVjdGVkIGNvbnN0YW50c186IENvbnN0YW50UHJvdmlkZXI7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gcmVuZGVyLlxuICAgKiBAcGFyYW0gaW5mbyBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgaW5mb3JtYXRpb24gbmVlZGVkIHRvIHJlbmRlciB0aGlzXG4gICAqICAgICBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihibG9jazogQmxvY2tTdmcsIGluZm86IFJlbmRlckluZm8pIHtcbiAgICB0aGlzLmJsb2NrXyA9IGJsb2NrO1xuICAgIHRoaXMuaW5mb18gPSBpbmZvO1xuICAgIHRoaXMudG9wTGVmdF8gPSBibG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG5cbiAgICAvKiogVGhlIHJlbmRlcmVyJ3MgY29uc3RhbnQgcHJvdmlkZXIuICovXG4gICAgdGhpcy5jb25zdGFudHNfID0gaW5mby5nZXRSZW5kZXJlcigpLmdldENvbnN0YW50cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgdGhlIGJsb2NrIHRvIHRoZSB3b3Jrc3BhY2UuIEhlcmUgXCJkcmF3aW5nXCIgbWVhbnMgc2V0dGluZyBTVkcgcGF0aFxuICAgKiBlbGVtZW50cyBhbmQgbW92aW5nIGZpZWxkcywgaWNvbnMsIGFuZCBjb25uZWN0aW9ucyBvbiB0aGUgc2NyZWVuLlxuICAgKlxuICAgKiBUaGUgcGllY2VzIG9mIHRoZSBwYXRocyBhcmUgcHVzaGVkIGludG8gYXJyYXlzIG9mIFwic3RlcHNcIiwgd2hpY2ggYXJlIHRoZW5cbiAgICogam9pbmVkIHdpdGggc3BhY2VzIGFuZCBzZXQgZGlyZWN0bHkgb24gdGhlIGJsb2NrLiAgVGhpcyBndWFyYW50ZWVzIHRoYXRcbiAgICogdGhlIHN0ZXBzIGFyZSBzZXBhcmF0ZWQgYnkgc3BhY2VzIGZvciBpbXByb3ZlZCByZWFkYWJpbGl0eSwgYnV0IGlzbid0XG4gICAqIHJlcXVpcmVkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXcoKSB7XG4gICAgdGhpcy5oaWRlSGlkZGVuSWNvbnNfKCk7XG4gICAgdGhpcy5kcmF3T3V0bGluZV8oKTtcbiAgICB0aGlzLmRyYXdJbnRlcm5hbHNfKCk7XG5cbiAgICB0aGlzLmJsb2NrXy5wYXRoT2JqZWN0LnNldFBhdGgodGhpcy5vdXRsaW5lUGF0aF8gKyAnXFxuJyArIHRoaXMuaW5saW5lUGF0aF8pO1xuICAgIGlmICh0aGlzLmluZm9fLlJUTCkge1xuICAgICAgdGhpcy5ibG9ja18ucGF0aE9iamVjdC5mbGlwUlRMKCk7XG4gICAgfVxuICAgIGlmIChkZWJ1Zy5pc0RlYnVnZ2VyRW5hYmxlZCgpKSB7XG4gICAgICB0aGlzLmJsb2NrXy5yZW5kZXJpbmdEZWJ1Z2dlcj8uZHJhd0RlYnVnKHRoaXMuYmxvY2tfLCB0aGlzLmluZm9fKTtcbiAgICB9XG4gICAgdGhpcy5yZWNvcmRTaXplT25CbG9ja18oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlIHNpemluZyBpbmZvcm1hdGlvbiBiYWNrIHRvIHRoZSBibG9ja1xuICAgKiBNb3N0IG9mIHRoZSByZW5kZXJpbmcgaW5mb3JtYXRpb24gY2FuIGJlIHRocm93biBhd2F5IGF0IHRoZSBlbmQgb2YgdGhlXG4gICAqIHJlbmRlci4gQW55dGhpbmcgdGhhdCBuZWVkcyB0byBiZSBrZXB0IGFyb3VuZCBzaG91bGQgYmUgc2V0IGluIHRoaXNcbiAgICogZnVuY3Rpb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVjb3JkU2l6ZU9uQmxvY2tfKCkge1xuICAgIC8vIFRoaXMgaXMgdXNlZCB3aGVuIHRoZSBibG9jayBpcyByZXBvcnRpbmcgaXRzIHNpemUgdG8gYW55b25lIGVsc2UuXG4gICAgLy8gVGhlIGRhcmsgcGF0aCBhZGRzIHRvIHRoZSBzaXplIG9mIHRoZSBibG9jayBpbiBib3RoIFggYW5kIFkuXG4gICAgdGhpcy5ibG9ja18uaGVpZ2h0ID0gdGhpcy5pbmZvXy5oZWlnaHQ7XG4gICAgdGhpcy5ibG9ja18ud2lkdGggPSB0aGlzLmluZm9fLndpZHRoV2l0aENoaWxkcmVuO1xuICB9XG5cbiAgLyoqIEhpZGUgaWNvbnMgdGhhdCB3ZXJlIG1hcmtlZCBhcyBoaWRkZW4uICovXG4gIHByb3RlY3RlZCBoaWRlSGlkZGVuSWNvbnNfKCkge1xuICAgIGZvciAobGV0IGkgPSAwLCBpY29uSW5mbzsgaWNvbkluZm8gPSB0aGlzLmluZm9fLmhpZGRlbkljb25zW2ldOyBpKyspIHtcbiAgICAgIGljb25JbmZvLmljb24uaWNvbkdyb3VwXz8uc2V0QXR0cmlidXRlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICB9XG4gIH1cblxuICAvKiogQ3JlYXRlIHRoZSBvdXRsaW5lIG9mIHRoZSBibG9jay4gIFRoaXMgaXMgYSBzaW5nbGUgY29udGludW91cyBwYXRoLiAqL1xuICBwcm90ZWN0ZWQgZHJhd091dGxpbmVfKCkge1xuICAgIHRoaXMuZHJhd1RvcF8oKTtcbiAgICBmb3IgKGxldCByID0gMTsgciA8IHRoaXMuaW5mb18ucm93cy5sZW5ndGggLSAxOyByKyspIHtcbiAgICAgIGNvbnN0IHJvdyA9IHRoaXMuaW5mb18ucm93c1tyXTtcbiAgICAgIGlmIChyb3cuaGFzSmFnZ2VkRWRnZSkge1xuICAgICAgICB0aGlzLmRyYXdKYWdnZWRFZGdlXyhyb3cpO1xuICAgICAgfSBlbHNlIGlmIChyb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICAgIHRoaXMuZHJhd1N0YXRlbWVudElucHV0Xyhyb3cpO1xuICAgICAgfSBlbHNlIGlmIChyb3cuaGFzRXh0ZXJuYWxJbnB1dCkge1xuICAgICAgICB0aGlzLmRyYXdWYWx1ZUlucHV0Xyhyb3cpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kcmF3UmlnaHRTaWRlUm93Xyhyb3cpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRyYXdCb3R0b21fKCk7XG4gICAgdGhpcy5kcmF3TGVmdF8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3RlcHMgZm9yIHRoZSB0b3AgY29ybmVyIG9mIHRoZSBibG9jaywgdGFraW5nIGludG8gYWNjb3VudFxuICAgKiBkZXRhaWxzIHN1Y2ggYXMgaGF0cyBhbmQgcm91bmRlZCBjb3JuZXJzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdUb3BfKCkge1xuICAgIGNvbnN0IHRvcFJvdyA9IHRoaXMuaW5mb18udG9wUm93O1xuICAgIGNvbnN0IGVsZW1lbnRzID0gdG9wUm93LmVsZW1lbnRzO1xuXG4gICAgdGhpcy5wb3NpdGlvblByZXZpb3VzQ29ubmVjdGlvbl8oKTtcbiAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5tb3ZlQnkodG9wUm93LnhQb3MsIHRoaXMuaW5mb18uc3RhcnRZKTtcbiAgICBmb3IgKGxldCBpID0gMCwgZWxlbTsgZWxlbSA9IGVsZW1lbnRzW2ldOyBpKyspIHtcbiAgICAgIGlmIChUeXBlcy5pc0xlZnRSb3VuZGVkQ29ybmVyKGVsZW0pKSB7XG4gICAgICAgIHRoaXMub3V0bGluZVBhdGhfICs9IHRoaXMuY29uc3RhbnRzXy5PVVRTSURFX0NPUk5FUlMudG9wTGVmdDtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNSaWdodFJvdW5kZWRDb3JuZXIoZWxlbSkpIHtcbiAgICAgICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gdGhpcy5jb25zdGFudHNfLk9VVFNJREVfQ09STkVSUy50b3BSaWdodDtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgVHlwZXMuaXNQcmV2aW91c0Nvbm5lY3Rpb24oZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIENvbm5lY3Rpb24pIHtcbiAgICAgICAgdGhpcy5vdXRsaW5lUGF0aF8gKz1cbiAgICAgICAgICAgICgoZWxlbSBhcyBQcmV2aW91c0Nvbm5lY3Rpb24pLnNoYXBlIGFzIE5vdGNoKS5wYXRoTGVmdDtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNIYXQoZWxlbSkpIHtcbiAgICAgICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gdGhpcy5jb25zdGFudHNfLlNUQVJUX0hBVC5wYXRoO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc1NwYWNlcihlbGVtKSkge1xuICAgICAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCdoJywgZWxlbS53aWR0aCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIE5vIGJyYW5jaCBmb3IgYSBzcXVhcmUgY29ybmVyLCBiZWNhdXNlIGl0J3MgYSBuby1vcC5cbiAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgdG9wUm93LmhlaWdodCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHN0ZXBzIGZvciB0aGUgamFnZ2VkIGVkZ2Ugb2YgYSByb3cgb24gYSBjb2xsYXBzZWQgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSByb3cgVGhlIHJvdyB0byBkcmF3IHRoZSBzaWRlIG9mLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdKYWdnZWRFZGdlXyhyb3c6IFJvdykge1xuICAgIGNvbnN0IHJlbWFpbmRlciA9IHJvdy5oZWlnaHQgLSB0aGlzLmNvbnN0YW50c18uSkFHR0VEX1RFRVRILmhlaWdodDtcbiAgICB0aGlzLm91dGxpbmVQYXRoXyArPVxuICAgICAgICB0aGlzLmNvbnN0YW50c18uSkFHR0VEX1RFRVRILnBhdGggKyBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgcmVtYWluZGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3RlcHMgZm9yIGFuIGV4dGVybmFsIHZhbHVlIGlucHV0LCByZW5kZXJlZCBhcyBhIG5vdGNoIGluIHRoZSBzaWRlXG4gICAqIG9mIHRoZSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRoYXQgdGhpcyBpbnB1dCBiZWxvbmdzIHRvLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdWYWx1ZUlucHV0Xyhyb3c6IFJvdykge1xuICAgIGNvbnN0IGlucHV0ID0gcm93LmdldExhc3RJbnB1dCgpIGFzIEV4dGVybmFsVmFsdWVJbnB1dCB8IElubGluZUlucHV0O1xuICAgIHRoaXMucG9zaXRpb25FeHRlcm5hbFZhbHVlQ29ubmVjdGlvbl8ocm93KTtcblxuICAgIGNvbnN0IHBhdGhEb3duID0gaXNEeW5hbWljU2hhcGUoaW5wdXQuc2hhcGUpID9cbiAgICAgICAgaW5wdXQuc2hhcGUucGF0aERvd24oaW5wdXQuaGVpZ2h0KSA6XG4gICAgICAgIChpbnB1dC5zaGFwZSBhcyBQdXp6bGVUYWIpLnBhdGhEb3duO1xuXG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gc3ZnUGF0aHMubGluZU9uQXhpcygnSCcsIGlucHV0LnhQb3MgKyBpbnB1dC53aWR0aCkgK1xuICAgICAgICBwYXRoRG93biArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCByb3cuaGVpZ2h0IC0gaW5wdXQuY29ubmVjdGlvbkhlaWdodCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHN0ZXBzIGZvciBhIHN0YXRlbWVudCBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRoYXQgdGhpcyBpbnB1dCBiZWxvbmdzIHRvLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdTdGF0ZW1lbnRJbnB1dF8ocm93OiBSb3cpIHtcbiAgICBjb25zdCBpbnB1dCA9IHJvdy5nZXRMYXN0SW5wdXQoKTtcbiAgICBpZiAoIWlucHV0KSByZXR1cm47XG4gICAgLy8gV2hlcmUgdG8gc3RhcnQgZHJhd2luZyB0aGUgbm90Y2gsIHdoaWNoIGlzIG9uIHRoZSByaWdodCBzaWRlIGluIExUUi5cbiAgICBjb25zdCB4ID0gaW5wdXQueFBvcyArIGlucHV0Lm5vdGNoT2Zmc2V0ICsgKGlucHV0LnNoYXBlIGFzIE5vdGNoKS53aWR0aDtcblxuICAgIGNvbnN0IGlubmVyVG9wTGVmdENvcm5lciA9IChpbnB1dC5zaGFwZSBhcyBOb3RjaCkucGF0aFJpZ2h0ICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcyhcbiAgICAgICAgICAgICdoJywgLShpbnB1dC5ub3RjaE9mZnNldCAtIHRoaXMuY29uc3RhbnRzXy5JTlNJREVfQ09STkVSUy53aWR0aCkpICtcbiAgICAgICAgdGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTLnBhdGhUb3A7XG5cbiAgICBjb25zdCBpbm5lckhlaWdodCA9IHJvdy5oZWlnaHQgLSAyICogdGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTLmhlaWdodDtcblxuICAgIHRoaXMub3V0bGluZVBhdGhfICs9IHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ0gnLCB4KSArIGlubmVyVG9wTGVmdENvcm5lciArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCBpbm5lckhlaWdodCkgK1xuICAgICAgICB0aGlzLmNvbnN0YW50c18uSU5TSURFX0NPUk5FUlMucGF0aEJvdHRvbSArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ0gnLCByb3cueFBvcyArIHJvdy53aWR0aCk7XG5cbiAgICB0aGlzLnBvc2l0aW9uU3RhdGVtZW50SW5wdXRDb25uZWN0aW9uXyhyb3cpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBzdGVwcyBmb3IgdGhlIHJpZ2h0IHNpZGUgb2YgYSByb3cgdGhhdCBkb2VzIG5vdCBoYXZlIHZhbHVlIG9yXG4gICAqIHN0YXRlbWVudCBpbnB1dCBjb25uZWN0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRvIGRyYXcgdGhlIHNpZGUgb2YuXG4gICAqL1xuICBwcm90ZWN0ZWQgZHJhd1JpZ2h0U2lkZVJvd18ocm93OiBSb3cpIHtcbiAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgcm93LnlQb3MgKyByb3cuaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3RlcHMgZm9yIHRoZSBib3R0b20gZWRnZSBvZiBhIGJsb2NrLCBwb3NzaWJseSBpbmNsdWRpbmcgYSBub3RjaFxuICAgKiBmb3IgdGhlIG5leHQgY29ubmVjdGlvbi5cbiAgICovXG4gIHByb3RlY3RlZCBkcmF3Qm90dG9tXygpIHtcbiAgICBjb25zdCBib3R0b21Sb3cgPSB0aGlzLmluZm9fLmJvdHRvbVJvdztcbiAgICBjb25zdCBlbGVtcyA9IGJvdHRvbVJvdy5lbGVtZW50cztcbiAgICB0aGlzLnBvc2l0aW9uTmV4dENvbm5lY3Rpb25fKCk7XG5cbiAgICBsZXQgcmlnaHRDb3JuZXJZT2Zmc2V0ID0gMDtcbiAgICBsZXQgb3V0bGluZVBhdGggPSAnJztcbiAgICBmb3IgKGxldCBpID0gZWxlbXMubGVuZ3RoIC0gMSwgZWxlbTsgZWxlbSA9IGVsZW1zW2ldOyBpLS0pIHtcbiAgICAgIGlmIChUeXBlcy5pc05leHRDb25uZWN0aW9uKGVsZW0pICYmIGVsZW0gaW5zdGFuY2VvZiBDb25uZWN0aW9uKSB7XG4gICAgICAgIG91dGxpbmVQYXRoICs9IChlbGVtLnNoYXBlIGFzIE5vdGNoKS5wYXRoUmlnaHQ7XG4gICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzTGVmdFNxdWFyZUNvcm5lcihlbGVtKSkge1xuICAgICAgICBvdXRsaW5lUGF0aCArPSBzdmdQYXRocy5saW5lT25BeGlzKCdIJywgYm90dG9tUm93LnhQb3MpO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc0xlZnRSb3VuZGVkQ29ybmVyKGVsZW0pKSB7XG4gICAgICAgIG91dGxpbmVQYXRoICs9IHRoaXMuY29uc3RhbnRzXy5PVVRTSURFX0NPUk5FUlMuYm90dG9tTGVmdDtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNSaWdodFJvdW5kZWRDb3JuZXIoZWxlbSkpIHtcbiAgICAgICAgb3V0bGluZVBhdGggKz0gdGhpcy5jb25zdGFudHNfLk9VVFNJREVfQ09STkVSUy5ib3R0b21SaWdodDtcbiAgICAgICAgcmlnaHRDb3JuZXJZT2Zmc2V0ID0gdGhpcy5jb25zdGFudHNfLk9VVFNJREVfQ09STkVSUy5yaWdodEhlaWdodDtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNTcGFjZXIoZWxlbSkpIHtcbiAgICAgICAgb3V0bGluZVBhdGggKz0gc3ZnUGF0aHMubGluZU9uQXhpcygnaCcsIGVsZW0ud2lkdGggKiAtMSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz1cbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnVicsIGJvdHRvbVJvdy5iYXNlbGluZSAtIHJpZ2h0Q29ybmVyWU9mZnNldCk7XG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gb3V0bGluZVBhdGg7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHN0ZXBzIGZvciB0aGUgbGVmdCBzaWRlIG9mIHRoZSBibG9jaywgd2hpY2ggbWF5IGluY2x1ZGUgYW4gb3V0cHV0XG4gICAqIGNvbm5lY3Rpb25cbiAgICovXG4gIHByb3RlY3RlZCBkcmF3TGVmdF8oKSB7XG4gICAgY29uc3Qgb3V0cHV0Q29ubmVjdGlvbiA9IHRoaXMuaW5mb18ub3V0cHV0Q29ubmVjdGlvbjtcbiAgICB0aGlzLnBvc2l0aW9uT3V0cHV0Q29ubmVjdGlvbl8oKTtcblxuICAgIGlmIChvdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICBjb25zdCB0YWJCb3R0b20gPVxuICAgICAgICAgIG91dHB1dENvbm5lY3Rpb24uY29ubmVjdGlvbk9mZnNldFkgKyBvdXRwdXRDb25uZWN0aW9uLmhlaWdodDtcbiAgICAgIGNvbnN0IHBhdGhVcCA9IGlzRHluYW1pY1NoYXBlKG91dHB1dENvbm5lY3Rpb24uc2hhcGUpID9cbiAgICAgICAgICBvdXRwdXRDb25uZWN0aW9uLnNoYXBlLnBhdGhVcChvdXRwdXRDb25uZWN0aW9uLmhlaWdodCkgOlxuICAgICAgICAgIChvdXRwdXRDb25uZWN0aW9uLnNoYXBlIGFzIFB1enpsZVRhYikucGF0aFVwO1xuXG4gICAgICAvLyBEcmF3IGEgbGluZSB1cCB0byB0aGUgYm90dG9tIG9mIHRoZSB0YWIuXG4gICAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgdGFiQm90dG9tKSArIHBhdGhVcDtcbiAgICB9XG4gICAgLy8gQ2xvc2Ugb2ZmIHRoZSBwYXRoLiAgVGhpcyBkcmF3cyBhIHZlcnRpY2FsIGxpbmUgdXAgdG8gdGhlIHN0YXJ0IG9mIHRoZVxuICAgIC8vIGJsb2NrJ3MgcGF0aCwgd2hpY2ggbWF5IGJlIGVpdGhlciBhIHJvdW5kZWQgb3IgYSBzaGFycCBjb3JuZXIuXG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gJ3onO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgdGhlIGludGVybmFscyBvZiB0aGUgYmxvY2s6IGlubGluZSBpbnB1dHMsIGZpZWxkcywgYW5kIGljb25zLiAgVGhlc2VcbiAgICogZG8gbm90IGRlcGVuZCBvbiB0aGUgb3V0ZXIgcGF0aCBmb3IgcGxhY2VtZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdJbnRlcm5hbHNfKCkge1xuICAgIGZvciAobGV0IGkgPSAwLCByb3c7IHJvdyA9IHRoaXMuaW5mb18ucm93c1tpXTsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMCwgZWxlbTsgZWxlbSA9IHJvdy5lbGVtZW50c1tqXTsgaisrKSB7XG4gICAgICAgIGlmIChUeXBlcy5pc0lubGluZUlucHV0KGVsZW0pKSB7XG4gICAgICAgICAgdGhpcy5kcmF3SW5saW5lSW5wdXRfKGVsZW0gYXMgSW5saW5lSW5wdXQpO1xuICAgICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzSWNvbihlbGVtKSB8fCBUeXBlcy5pc0ZpZWxkKGVsZW0pKSB7XG4gICAgICAgICAgdGhpcy5sYXlvdXRGaWVsZF8oZWxlbSBhcyBGaWVsZCB8IEljb24pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFB1c2ggYSBmaWVsZCBvciBpY29uJ3MgbmV3IHBvc2l0aW9uIHRvIGl0cyBTVkcgcm9vdC5cbiAgICpcbiAgICogQHBhcmFtIGZpZWxkSW5mbyBUaGUgcmVuZGVyaW5nIGluZm9ybWF0aW9uIGZvciB0aGUgZmllbGQgb3IgaWNvbi5cbiAgICovXG4gIHByb3RlY3RlZCBsYXlvdXRGaWVsZF8oZmllbGRJbmZvOiBJY29ufEZpZWxkKSB7XG4gICAgY29uc3Qgc3ZnR3JvdXAgPSBUeXBlcy5pc0ZpZWxkKGZpZWxkSW5mbykgP1xuICAgICAgICAoZmllbGRJbmZvIGFzIEZpZWxkKS5maWVsZC5nZXRTdmdSb290KCkhIDpcbiAgICAgICAgKGZpZWxkSW5mbyBhcyBJY29uKS5pY29uLmljb25Hcm91cF8hOyAgLy8gTmV2ZXIgbnVsbCBpbiByZW5kZXJlZCBjYXNlLlxuXG4gICAgY29uc3QgeVBvcyA9IGZpZWxkSW5mby5jZW50ZXJsaW5lIC0gZmllbGRJbmZvLmhlaWdodCAvIDI7XG4gICAgbGV0IHhQb3MgPSBmaWVsZEluZm8ueFBvcztcbiAgICBsZXQgc2NhbGUgPSAnJztcbiAgICBpZiAodGhpcy5pbmZvXy5SVEwpIHtcbiAgICAgIHhQb3MgPSAtKHhQb3MgKyBmaWVsZEluZm8ud2lkdGgpO1xuICAgICAgaWYgKGZpZWxkSW5mby5mbGlwUnRsKSB7XG4gICAgICAgIHhQb3MgKz0gZmllbGRJbmZvLndpZHRoO1xuICAgICAgICBzY2FsZSA9ICdzY2FsZSgtMSAxKSc7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChUeXBlcy5pc0ljb24oZmllbGRJbmZvKSkge1xuICAgICAgc3ZnR3JvdXAuc2V0QXR0cmlidXRlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICBzdmdHcm91cC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHhQb3MgKyAnLCcgKyB5UG9zICsgJyknKTtcbiAgICAgIChmaWVsZEluZm8gYXMgSWNvbikuaWNvbi5jb21wdXRlSWNvbkxvY2F0aW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN2Z0dyb3VwLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgeFBvcyArICcsJyArIHlQb3MgKyAnKScgKyBzY2FsZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaW5mb18uaXNJbnNlcnRpb25NYXJrZXIpIHtcbiAgICAgIC8vIEZpZWxkcyBhbmQgaWNvbnMgYXJlIGludmlzaWJsZSBvbiBpbnNlcnRpb24gbWFya2VyLiAgVGhleSBzdGlsbCBoYXZlIHRvXG4gICAgICAvLyBiZSByZW5kZXJlZCBzbyB0aGF0IHRoZSBibG9jayBjYW4gYmUgc2l6ZWQgY29ycmVjdGx5LlxuICAgICAgc3ZnR3JvdXAuc2V0QXR0cmlidXRlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIHN0ZXBzIGZvciBhbiBpbmxpbmUgaW5wdXQuXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGlucHV0IHRvIHJlbmRlci5cbiAgICovXG4gIHByb3RlY3RlZCBkcmF3SW5saW5lSW5wdXRfKGlucHV0OiBJbmxpbmVJbnB1dCkge1xuICAgIGNvbnN0IHdpZHRoID0gaW5wdXQud2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gaW5wdXQuaGVpZ2h0O1xuICAgIGNvbnN0IHlQb3MgPSBpbnB1dC5jZW50ZXJsaW5lIC0gaGVpZ2h0IC8gMjtcblxuICAgIGNvbnN0IGNvbm5lY3Rpb25Ub3AgPSBpbnB1dC5jb25uZWN0aW9uT2Zmc2V0WTtcbiAgICBjb25zdCBjb25uZWN0aW9uQm90dG9tID0gaW5wdXQuY29ubmVjdGlvbkhlaWdodCArIGNvbm5lY3Rpb25Ub3A7XG4gICAgY29uc3QgY29ubmVjdGlvblJpZ2h0ID0gaW5wdXQueFBvcyArIGlucHV0LmNvbm5lY3Rpb25XaWR0aDtcblxuICAgIHRoaXMuaW5saW5lUGF0aF8gKz0gc3ZnUGF0aHMubW92ZVRvKGNvbm5lY3Rpb25SaWdodCwgeVBvcykgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgY29ubmVjdGlvblRvcCkgK1xuICAgICAgICAoaW5wdXQuc2hhcGUgYXMgUHV6emxlVGFiKS5wYXRoRG93biArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCBoZWlnaHQgLSBjb25uZWN0aW9uQm90dG9tKSArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ2gnLCB3aWR0aCAtIGlucHV0LmNvbm5lY3Rpb25XaWR0aCkgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgLWhlaWdodCkgKyAneic7XG5cbiAgICB0aGlzLnBvc2l0aW9uSW5saW5lSW5wdXRDb25uZWN0aW9uXyhpbnB1dCk7XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb24gdGhlIGNvbm5lY3Rpb24gb24gYW4gaW5saW5lIHZhbHVlIGlucHV0LCB0YWtpbmcgaW50byBhY2NvdW50XG4gICAqIFJUTCBhbmQgdGhlIHNtYWxsIGdhcCBiZXR3ZWVuIHRoZSBwYXJlbnQgYmxvY2sgYW5kIGNoaWxkIGJsb2NrIHdoaWNoIGxldHNcbiAgICogdGhlIHBhcmVudCBibG9jaydzIGRhcmsgcGF0aCBzaG93IHRocm91Z2guXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGlucHV0IHRoYXQgdGhlIGNvbm5lY3Rpb24gaXMgb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25JbmxpbmVJbnB1dENvbm5lY3Rpb25fKGlucHV0OiBJbmxpbmVJbnB1dCkge1xuICAgIGNvbnN0IHlQb3MgPSBpbnB1dC5jZW50ZXJsaW5lIC0gaW5wdXQuaGVpZ2h0IC8gMjtcbiAgICAvLyBNb3ZlIHRoZSBjb25uZWN0aW9uLlxuICAgIGlmIChpbnB1dC5jb25uZWN0aW9uTW9kZWwpIHtcbiAgICAgIC8vIHhQb3MgYWxyZWFkeSBjb250YWlucyBpbmZvIGFib3V0IHN0YXJ0WFxuICAgICAgbGV0IGNvbm5YID0gaW5wdXQueFBvcyArIGlucHV0LmNvbm5lY3Rpb25XaWR0aCArIGlucHV0LmNvbm5lY3Rpb25PZmZzZXRYO1xuICAgICAgaWYgKHRoaXMuaW5mb18uUlRMKSB7XG4gICAgICAgIGNvbm5YICo9IC0xO1xuICAgICAgfVxuICAgICAgaW5wdXQuY29ubmVjdGlvbk1vZGVsLnNldE9mZnNldEluQmxvY2soXG4gICAgICAgICAgY29ublgsIHlQb3MgKyBpbnB1dC5jb25uZWN0aW9uT2Zmc2V0WSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9uIHRoZSBjb25uZWN0aW9uIG9uIGEgc3RhdGVtZW50IGlucHV0LCB0YWtpbmcgaW50byBhY2NvdW50XG4gICAqIFJUTCBhbmQgdGhlIHNtYWxsIGdhcCBiZXR3ZWVuIHRoZSBwYXJlbnQgYmxvY2sgYW5kIGNoaWxkIGJsb2NrIHdoaWNoIGxldHNcbiAgICogdGhlIHBhcmVudCBibG9jaydzIGRhcmsgcGF0aCBzaG93IHRocm91Z2guXG4gICAqXG4gICAqIEBwYXJhbSByb3cgVGhlIHJvdyB0aGF0IHRoZSBjb25uZWN0aW9uIGlzIG9uLlxuICAgKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uU3RhdGVtZW50SW5wdXRDb25uZWN0aW9uXyhyb3c6IFJvdykge1xuICAgIGNvbnN0IGlucHV0ID0gcm93LmdldExhc3RJbnB1dCgpO1xuICAgIGlmIChpbnB1dD8uY29ubmVjdGlvbk1vZGVsKSB7XG4gICAgICBsZXQgY29ublggPSByb3cueFBvcyArIHJvdy5zdGF0ZW1lbnRFZGdlICsgaW5wdXQubm90Y2hPZmZzZXQ7XG4gICAgICBpZiAodGhpcy5pbmZvXy5SVEwpIHtcbiAgICAgICAgY29ublggKj0gLTE7XG4gICAgICB9XG4gICAgICBpbnB1dC5jb25uZWN0aW9uTW9kZWwuc2V0T2Zmc2V0SW5CbG9jayhjb25uWCwgcm93LnlQb3MpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiB0aGUgY29ubmVjdGlvbiBvbiBhbiBleHRlcm5hbCB2YWx1ZSBpbnB1dCwgdGFraW5nIGludG8gYWNjb3VudFxuICAgKiBSVEwgYW5kIHRoZSBzbWFsbCBnYXAgYmV0d2VlbiB0aGUgcGFyZW50IGJsb2NrIGFuZCBjaGlsZCBibG9jayB3aGljaCBsZXRzXG4gICAqIHRoZSBwYXJlbnQgYmxvY2sncyBkYXJrIHBhdGggc2hvdyB0aHJvdWdoLlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSByb3cgdGhhdCB0aGUgY29ubmVjdGlvbiBpcyBvbi5cbiAgICovXG4gIHByb3RlY3RlZCBwb3NpdGlvbkV4dGVybmFsVmFsdWVDb25uZWN0aW9uXyhyb3c6IFJvdykge1xuICAgIGNvbnN0IGlucHV0ID0gcm93LmdldExhc3RJbnB1dCgpO1xuICAgIGlmIChpbnB1dCAmJiBpbnB1dC5jb25uZWN0aW9uTW9kZWwpIHtcbiAgICAgIGxldCBjb25uWCA9IHJvdy54UG9zICsgcm93LndpZHRoO1xuICAgICAgaWYgKHRoaXMuaW5mb18uUlRMKSB7XG4gICAgICAgIGNvbm5YICo9IC0xO1xuICAgICAgfVxuICAgICAgaW5wdXQuY29ubmVjdGlvbk1vZGVsLnNldE9mZnNldEluQmxvY2soY29ublgsIHJvdy55UG9zKTtcbiAgICB9XG4gIH1cblxuICAvKiogUG9zaXRpb24gdGhlIHByZXZpb3VzIGNvbm5lY3Rpb24gb24gYSBibG9jay4gKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uUHJldmlvdXNDb25uZWN0aW9uXygpIHtcbiAgICBjb25zdCB0b3BSb3cgPSB0aGlzLmluZm9fLnRvcFJvdztcbiAgICBpZiAodG9wUm93LmNvbm5lY3Rpb24pIHtcbiAgICAgIGNvbnN0IHggPSB0b3BSb3cueFBvcyArIHRvcFJvdy5ub3RjaE9mZnNldDtcbiAgICAgIGNvbnN0IGNvbm5YID0gdGhpcy5pbmZvXy5SVEwgPyAteCA6IHg7XG4gICAgICB0b3BSb3cuY29ubmVjdGlvbi5jb25uZWN0aW9uTW9kZWwuc2V0T2Zmc2V0SW5CbG9jayhjb25uWCwgMCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIFBvc2l0aW9uIHRoZSBuZXh0IGNvbm5lY3Rpb24gb24gYSBibG9jay4gKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uTmV4dENvbm5lY3Rpb25fKCkge1xuICAgIGNvbnN0IGJvdHRvbVJvdyA9IHRoaXMuaW5mb18uYm90dG9tUm93O1xuXG4gICAgaWYgKGJvdHRvbVJvdy5jb25uZWN0aW9uKSB7XG4gICAgICBjb25zdCBjb25uSW5mbyA9IGJvdHRvbVJvdy5jb25uZWN0aW9uO1xuICAgICAgY29uc3QgeCA9IGNvbm5JbmZvLnhQb3M7ICAvLyBBbHJlYWR5IGNvbnRhaW5zIGluZm8gYWJvdXQgc3RhcnRYLlxuICAgICAgY29uc3QgY29ublggPSB0aGlzLmluZm9fLlJUTCA/IC14IDogeDtcbiAgICAgIGNvbm5JbmZvLmNvbm5lY3Rpb25Nb2RlbC5zZXRPZmZzZXRJbkJsb2NrKGNvbm5YLCBib3R0b21Sb3cuYmFzZWxpbmUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBQb3NpdGlvbiB0aGUgb3V0cHV0IGNvbm5lY3Rpb24gb24gYSBibG9jay4gKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uT3V0cHV0Q29ubmVjdGlvbl8oKSB7XG4gICAgaWYgKHRoaXMuaW5mb18ub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgY29uc3QgeCA9XG4gICAgICAgICAgdGhpcy5pbmZvXy5zdGFydFggKyB0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24uY29ubmVjdGlvbk9mZnNldFg7XG4gICAgICBjb25zdCBjb25uWCA9IHRoaXMuaW5mb18uUlRMID8gLXggOiB4O1xuICAgICAgdGhpcy5ibG9ja18ub3V0cHV0Q29ubmVjdGlvbi5zZXRPZmZzZXRJbkJsb2NrKFxuICAgICAgICAgIGNvbm5YLCB0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24uY29ubmVjdGlvbk9mZnNldFkpO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1ldGhvZHMgZm9yIGdyYXBoaWNhbGx5IHJlbmRlcmluZyBhIGJsb2NrIGFzIFNWRy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5SZW5kZXJJbmZvJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB7QWxpZ24sIElucHV0fSBmcm9tICcuLi8uLi9pbnB1dC5qcyc7XG5pbXBvcnQge2lucHV0VHlwZXN9IGZyb20gJy4uLy4uL2lucHV0X3R5cGVzLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlZENvbm5lY3Rpb259IGZyb20gJy4uLy4uL3JlbmRlcmVkX2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge01lYXN1cmFibGV9IGZyb20gJy4uL21lYXN1cmFibGVzL2Jhc2UuanMnO1xuaW1wb3J0IHtCb3R0b21Sb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL2JvdHRvbV9yb3cuanMnO1xuaW1wb3J0IHtFeHRlcm5hbFZhbHVlSW5wdXR9IGZyb20gJy4uL21lYXN1cmFibGVzL2V4dGVybmFsX3ZhbHVlX2lucHV0LmpzJztcbmltcG9ydCB7RmllbGR9IGZyb20gJy4uL21lYXN1cmFibGVzL2ZpZWxkLmpzJztcbmltcG9ydCB7SGF0fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9oYXQuanMnO1xuaW1wb3J0IHtJY29ufSBmcm9tICcuLi9tZWFzdXJhYmxlcy9pY29uLmpzJztcbmltcG9ydCB7SW5Sb3dTcGFjZXJ9IGZyb20gJy4uL21lYXN1cmFibGVzL2luX3Jvd19zcGFjZXIuanMnO1xuaW1wb3J0IHtJbmxpbmVJbnB1dH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvaW5saW5lX2lucHV0LmpzJztcbmltcG9ydCB7SW5wdXRSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL2lucHV0X3Jvdy5qcyc7XG5pbXBvcnQge0phZ2dlZEVkZ2V9IGZyb20gJy4uL21lYXN1cmFibGVzL2phZ2dlZF9lZGdlLmpzJztcbmltcG9ydCB7TmV4dENvbm5lY3Rpb259IGZyb20gJy4uL21lYXN1cmFibGVzL25leHRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQge091dHB1dENvbm5lY3Rpb259IGZyb20gJy4uL21lYXN1cmFibGVzL291dHB1dF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7UHJldmlvdXNDb25uZWN0aW9ufSBmcm9tICcuLi9tZWFzdXJhYmxlcy9wcmV2aW91c19jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7Um91bmRDb3JuZXJ9IGZyb20gJy4uL21lYXN1cmFibGVzL3JvdW5kX2Nvcm5lci5qcyc7XG5pbXBvcnQgdHlwZSB7Um93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9yb3cuanMnO1xuaW1wb3J0IHtTcGFjZXJSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3NwYWNlcl9yb3cuanMnO1xuaW1wb3J0IHtTcXVhcmVDb3JuZXJ9IGZyb20gJy4uL21lYXN1cmFibGVzL3NxdWFyZV9jb3JuZXIuanMnO1xuaW1wb3J0IHtTdGF0ZW1lbnRJbnB1dH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvc3RhdGVtZW50X2lucHV0LmpzJztcbmltcG9ydCB7VG9wUm93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy90b3Bfcm93LmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4uL21lYXN1cmFibGVzL3R5cGVzLmpzJztcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgc2l6aW5nIGluZm9ybWF0aW9uIG5lZWRlZCB0byBkcmF3IHRoaXMgYmxvY2suXG4gKlxuICogVGhpcyBtZWFzdXJlIHBhc3MgZG9lcyBub3QgcHJvcGFnYXRlIGNoYW5nZXMgdG8gdGhlIGJsb2NrIChhbHRob3VnaCBmaWVsZHNcbiAqIG1heSBjaG9vc2UgdG8gcmVyZW5kZXIgd2hlbiBnZXRTaXplKCkgaXMgY2FsbGVkKS4gIEhvd2V2ZXIsIGNhbGxpbmcgaXRcbiAqIHJlcGVhdGVkbHkgbWF5IGJlIGV4cGVuc2l2ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5ibG9ja1JlbmRlcmluZy5SZW5kZXJJbmZvXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJJbmZvIHtcbiAgYmxvY2tfOiBCbG9ja1N2ZztcbiAgcHJvdGVjdGVkIGNvbnN0YW50c186IENvbnN0YW50UHJvdmlkZXI7XG4gIG91dHB1dENvbm5lY3Rpb246IE91dHB1dENvbm5lY3Rpb258bnVsbDtcbiAgaXNJbmxpbmU6IGJvb2xlYW47XG4gIGlzQ29sbGFwc2VkOiBib29sZWFuO1xuICBpc0luc2VydGlvbk1hcmtlcjogYm9vbGVhbjtcbiAgUlRMOiBib29sZWFuO1xuXG4gIC8qKiBUaGUgYmxvY2sgcmVuZGVyZXIgaW4gdXNlLiAqL1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcmVuZGVyZXJfITogUmVuZGVyZXI7XG5cbiAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIHJlbmRlcmVkIGJsb2NrLCBpbmNsdWRpbmcgY2hpbGQgYmxvY2tzLiAqL1xuICBoZWlnaHQgPSAwO1xuXG4gIC8qKiBUaGUgd2lkdGggb2YgdGhlIHJlbmRlcmVkIGJsb2NrLCBpbmNsdWRpbmcgY2hpbGQgYmxvY2tzLiAqL1xuICB3aWR0aFdpdGhDaGlsZHJlbiA9IDA7XG5cbiAgLyoqXG4gICAqIFRoZSB3aWR0aCBvZiB0aGUgcmVuZGVyZWQgYmxvY2ssIGV4Y2x1ZGluZyBjaGlsZCBibG9ja3MuICBUaGlzIGlzIHRoZVxuICAgKiByaWdodCBlZGdlIG9mIHRoZSBibG9jayB3aGVuIHJlbmRlcmVkIExUUi5cbiAgICovXG4gIHdpZHRoID0gMDtcbiAgc3RhdGVtZW50RWRnZSA9IDA7XG5cbiAgLyoqIEFuIGFycmF5IG9mIFJvdyBvYmplY3RzIGNvbnRhaW5pbmcgc2l6aW5nIGluZm9ybWF0aW9uLiAqL1xuICByb3dzOiBSb3dbXSA9IFtdO1xuXG4gIC8qKiBBbiBhcnJheSBvZiBpbnB1dCByb3dzIG9uIHRoZSBibG9jay4gKi9cbiAgaW5wdXRSb3dzOiBJbnB1dFJvd1tdID0gW107XG5cbiAgLyoqIEFuIGFycmF5IG9mIG1lYXN1cmFibGUgb2JqZWN0cyBjb250YWluaW5nIGhpZGRlbiBpY29ucy4gKi9cbiAgaGlkZGVuSWNvbnM6IEljb25bXSA9IFtdO1xuICB0b3BSb3c6IFRvcFJvdztcbiAgYm90dG9tUm93OiBCb3R0b21Sb3c7XG5cbiAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSBzdGFydCBwb2ludCBmb3IgZHJhd2luZywgcmVsYXRpdmUgdG8gdGhlIGJsb2NrJ3NcbiAgLy8gbG9jYXRpb24uXG4gIHN0YXJ0WCA9IDA7XG4gIHN0YXJ0WSA9IDA7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSByZW5kZXJlciBUaGUgcmVuZGVyZXIgaW4gdXNlLlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIG1lYXN1cmUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IocmVuZGVyZXI6IFJlbmRlcmVyLCBibG9jazogQmxvY2tTdmcpIHtcbiAgICB0aGlzLnJlbmRlcmVyXyA9IHJlbmRlcmVyO1xuXG4gICAgdGhpcy5ibG9ja18gPSBibG9jaztcblxuICAgIC8qKiBUaGUgcmVuZGVyZXIncyBjb25zdGFudCBwcm92aWRlci4gKi9cbiAgICB0aGlzLmNvbnN0YW50c18gPSB0aGlzLnJlbmRlcmVyXy5nZXRDb25zdGFudHMoKTtcblxuICAgIC8qKlxuICAgICAqIEEgbWVhc3VyYWJsZSByZXByZXNlbnRpbmcgdGhlIG91dHB1dCBjb25uZWN0aW9uIGlmIHRoZSBibG9jayBoYXMgb25lLlxuICAgICAqIE90aGVyd2lzZSBudWxsLlxuICAgICAqL1xuICAgIHRoaXMub3V0cHV0Q29ubmVjdGlvbiA9IGJsb2NrLm91dHB1dENvbm5lY3Rpb24gP1xuICAgICAgICBuZXcgT3V0cHV0Q29ubmVjdGlvbih0aGlzLmNvbnN0YW50c18sIGJsb2NrLm91dHB1dENvbm5lY3Rpb24pIDpcbiAgICAgICAgbnVsbDtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIGJsb2NrIHNob3VsZCBiZSByZW5kZXJlZCBhcyBhIHNpbmdsZSBsaW5lLCBlaXRoZXIgYmVjYXVzZVxuICAgICAqIGl0J3MgaW5saW5lIG9yIGJlY2F1c2UgaXQgaGFzIGJlZW4gY29sbGFwc2VkLlxuICAgICAqL1xuICAgIHRoaXMuaXNJbmxpbmUgPSBibG9jay5nZXRJbnB1dHNJbmxpbmUoKSAmJiAhYmxvY2suaXNDb2xsYXBzZWQoKTtcblxuICAgIC8qKiBXaGV0aGVyIHRoZSBibG9jayBpcyBjb2xsYXBzZWQuICovXG4gICAgdGhpcy5pc0NvbGxhcHNlZCA9IGJsb2NrLmlzQ29sbGFwc2VkKCk7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoZSBibG9jayBpcyBhbiBpbnNlcnRpb24gbWFya2VyLiAgSW5zZXJ0aW9uIG1hcmtlcnMgYXJlIHRoZSBzYW1lXG4gICAgICogc2hhcGUgYXMgbm9ybWFsIGJsb2NrcywgYnV0IGRvbid0IHNob3cgZmllbGRzLlxuICAgICAqL1xuICAgIHRoaXMuaXNJbnNlcnRpb25NYXJrZXIgPSBibG9jay5pc0luc2VydGlvbk1hcmtlcigpO1xuXG4gICAgLyoqIFRydWUgaWYgdGhlIGJsb2NrIHNob3VsZCBiZSByZW5kZXJlZCByaWdodC10by1sZWZ0LiAqL1xuICAgIHRoaXMuUlRMID0gYmxvY2suUlRMO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IHdpdGggcmVuZGVyaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0b3Agcm93IG9mIHRoZSBibG9jay5cbiAgICAgKi9cbiAgICB0aGlzLnRvcFJvdyA9IG5ldyBUb3BSb3codGhpcy5jb25zdGFudHNfKTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCB3aXRoIHJlbmRlcmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYm90dG9tIHJvdyBvZiB0aGUgYmxvY2suXG4gICAgICovXG4gICAgdGhpcy5ib3R0b21Sb3cgPSBuZXcgQm90dG9tUm93KHRoaXMuY29uc3RhbnRzXyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBibG9jayByZW5kZXJlciBpbiB1c2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBibG9jayByZW5kZXJlciBpbiB1c2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0UmVuZGVyZXIoKTogUmVuZGVyZXIge1xuICAgIHJldHVybiB0aGlzLnJlbmRlcmVyXztcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3B1bGF0ZSBhbmQgcmV0dXJuIGFuIG9iamVjdCBjb250YWluaW5nIGFsbCBzaXppbmcgaW5mb3JtYXRpb24gbmVlZGVkIHRvXG4gICAqIGRyYXcgdGhpcyBibG9jay5cbiAgICpcbiAgICogVGhpcyBtZWFzdXJlIHBhc3MgZG9lcyBub3QgcHJvcGFnYXRlIGNoYW5nZXMgdG8gdGhlIGJsb2NrIChhbHRob3VnaCBmaWVsZHNcbiAgICogbWF5IGNob29zZSB0byByZXJlbmRlciB3aGVuIGdldFNpemUoKSBpcyBjYWxsZWQpLiAgSG93ZXZlciwgY2FsbGluZyBpdFxuICAgKiByZXBlYXRlZGx5IG1heSBiZSBleHBlbnNpdmUuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWVhc3VyZSgpIHtcbiAgICB0aGlzLmNyZWF0ZVJvd3NfKCk7XG4gICAgdGhpcy5hZGRFbGVtU3BhY2luZ18oKTtcbiAgICB0aGlzLmFkZFJvd1NwYWNpbmdfKCk7XG4gICAgdGhpcy5jb21wdXRlQm91bmRzXygpO1xuICAgIHRoaXMuYWxpZ25Sb3dFbGVtZW50c18oKTtcbiAgICB0aGlzLmZpbmFsaXplXygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSByb3dzIG9mIE1lYXN1cmFibGUgb2JqZWN0cyByZXByZXNlbnRpbmcgYWxsIHJlbmRlcmFibGUgcGFydHMgb2YgdGhlXG4gICAqIGJsb2NrLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZVJvd3NfKCkge1xuICAgIHRoaXMucG9wdWxhdGVUb3BSb3dfKCk7XG4gICAgdGhpcy5yb3dzLnB1c2godGhpcy50b3BSb3cpO1xuICAgIGxldCBhY3RpdmVSb3cgPSBuZXcgSW5wdXRSb3codGhpcy5jb25zdGFudHNfKTtcbiAgICB0aGlzLmlucHV0Um93cy5wdXNoKGFjdGl2ZVJvdyk7XG5cbiAgICAvLyBJY29ucyBhbHdheXMgZ28gb24gdGhlIGZpcnN0IHJvdywgYmVmb3JlIGFueXRoaW5nIGVsc2UuXG4gICAgY29uc3QgaWNvbnMgPSB0aGlzLmJsb2NrXy5nZXRJY29ucygpO1xuICAgIGZvciAobGV0IGkgPSAwLCBpY29uOyBpY29uID0gaWNvbnNbaV07IGkrKykge1xuICAgICAgY29uc3QgaWNvbkluZm8gPSBuZXcgSWNvbih0aGlzLmNvbnN0YW50c18sIGljb24pO1xuICAgICAgaWYgKHRoaXMuaXNDb2xsYXBzZWQgJiYgaWNvbi5jb2xsYXBzZUhpZGRlbikge1xuICAgICAgICB0aGlzLmhpZGRlbkljb25zLnB1c2goaWNvbkluZm8pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2goaWNvbkluZm8pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBsYXN0SW5wdXQgPSB1bmRlZmluZWQ7XG4gICAgLy8gTG9vcCBhY3Jvc3MgYWxsIG9mIHRoZSBpbnB1dHMgb24gdGhlIGJsb2NrLCBjcmVhdGluZyBvYmplY3RzIGZvciBhbnl0aGluZ1xuICAgIC8vIHRoYXQgbmVlZHMgdG8gYmUgcmVuZGVyZWQgYW5kIGJyZWFraW5nIHRoZSBibG9jayB1cCBpbnRvIHZpc3VhbCByb3dzLlxuICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSB0aGlzLmJsb2NrXy5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgaWYgKCFpbnB1dC5pc1Zpc2libGUoKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnNob3VsZFN0YXJ0TmV3Um93XyhpbnB1dCwgbGFzdElucHV0KSkge1xuICAgICAgICAvLyBGaW5pc2ggdGhpcyByb3cgYW5kIGNyZWF0ZSBhIG5ldyBvbmUuXG4gICAgICAgIHRoaXMucm93cy5wdXNoKGFjdGl2ZVJvdyk7XG4gICAgICAgIGFjdGl2ZVJvdyA9IG5ldyBJbnB1dFJvdyh0aGlzLmNvbnN0YW50c18pO1xuICAgICAgICB0aGlzLmlucHV0Um93cy5wdXNoKGFjdGl2ZVJvdyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFsbCBvZiB0aGUgZmllbGRzIGluIGFuIGlucHV0IGdvIG9uIHRoZSBzYW1lIHJvdy5cbiAgICAgIGZvciAobGV0IGogPSAwLCBmaWVsZDsgZmllbGQgPSBpbnB1dC5maWVsZFJvd1tqXTsgaisrKSB7XG4gICAgICAgIGFjdGl2ZVJvdy5lbGVtZW50cy5wdXNoKG5ldyBGaWVsZCh0aGlzLmNvbnN0YW50c18sIGZpZWxkLCBpbnB1dCkpO1xuICAgICAgfVxuICAgICAgdGhpcy5hZGRJbnB1dF8oaW5wdXQsIGFjdGl2ZVJvdyk7XG4gICAgICBsYXN0SW5wdXQgPSBpbnB1dDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0NvbGxhcHNlZCkge1xuICAgICAgYWN0aXZlUm93Lmhhc0phZ2dlZEVkZ2UgPSB0cnVlO1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IEphZ2dlZEVkZ2UodGhpcy5jb25zdGFudHNfKSk7XG4gICAgfVxuXG4gICAgaWYgKGFjdGl2ZVJvdy5lbGVtZW50cy5sZW5ndGggfHwgYWN0aXZlUm93Lmhhc0R1bW15SW5wdXQpIHtcbiAgICAgIHRoaXMucm93cy5wdXNoKGFjdGl2ZVJvdyk7XG4gICAgfVxuICAgIHRoaXMucG9wdWxhdGVCb3R0b21Sb3dfKCk7XG4gICAgdGhpcy5yb3dzLnB1c2godGhpcy5ib3R0b21Sb3cpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbGwgbm9uLXNwYWNlciBlbGVtZW50cyB0aGF0IGJlbG9uZyBvbiB0aGUgdG9wIHJvdy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBwb3B1bGF0ZVRvcFJvd18oKSB7XG4gICAgY29uc3QgaGFzUHJldmlvdXMgPSAhIXRoaXMuYmxvY2tfLnByZXZpb3VzQ29ubmVjdGlvbjtcbiAgICBjb25zdCBoYXNIYXQgPSAodGhpcy5ibG9ja18uaGF0ID8gdGhpcy5ibG9ja18uaGF0ID09PSAnY2FwJyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5BRERfU1RBUlRfSEFUUykgJiZcbiAgICAgICAgIXRoaXMub3V0cHV0Q29ubmVjdGlvbiAmJiAhaGFzUHJldmlvdXM7XG5cbiAgICBsZXQgY29ybmVyQ2xhc3MgPSB0aGlzLnRvcFJvdy5oYXNMZWZ0U3F1YXJlQ29ybmVyKHRoaXMuYmxvY2tfKSA/XG4gICAgICAgIFNxdWFyZUNvcm5lciA6XG4gICAgICAgIFJvdW5kQ29ybmVyO1xuICAgIHRoaXMudG9wUm93LmVsZW1lbnRzLnB1c2gobmV3IGNvcm5lckNsYXNzKHRoaXMuY29uc3RhbnRzXykpO1xuXG4gICAgaWYgKGhhc0hhdCkge1xuICAgICAgY29uc3QgaGF0ID0gbmV3IEhhdCh0aGlzLmNvbnN0YW50c18pO1xuICAgICAgdGhpcy50b3BSb3cuZWxlbWVudHMucHVzaChoYXQpO1xuICAgICAgdGhpcy50b3BSb3cuY2FwbGluZSA9IGhhdC5hc2NlbmRlckhlaWdodDtcbiAgICB9IGVsc2UgaWYgKGhhc1ByZXZpb3VzKSB7XG4gICAgICB0aGlzLnRvcFJvdy5oYXNQcmV2aW91c0Nvbm5lY3Rpb24gPSB0cnVlO1xuICAgICAgdGhpcy50b3BSb3cuY29ubmVjdGlvbiA9IG5ldyBQcmV2aW91c0Nvbm5lY3Rpb24oXG4gICAgICAgICAgdGhpcy5jb25zdGFudHNfLFxuICAgICAgICAgICh0aGlzLmJsb2NrXy5wcmV2aW91c0Nvbm5lY3Rpb24gYXMgUmVuZGVyZWRDb25uZWN0aW9uKSk7XG4gICAgICB0aGlzLnRvcFJvdy5lbGVtZW50cy5wdXNoKHRoaXMudG9wUm93LmNvbm5lY3Rpb24pO1xuICAgIH1cblxuICAgIGNvbnN0IHByZWNlZGVzU3RhdGVtZW50ID0gdGhpcy5ibG9ja18uaW5wdXRMaXN0Lmxlbmd0aCAmJlxuICAgICAgICB0aGlzLmJsb2NrXy5pbnB1dExpc3RbMF0udHlwZSA9PT0gaW5wdXRUeXBlcy5TVEFURU1FTlQ7XG5cbiAgICAvLyBUaGlzIGlzIHRoZSBtaW5pbXVtIGhlaWdodCBmb3IgdGhlIHJvdy4gSWYgb25lIG9mIGl0cyBlbGVtZW50cyBoYXMgYVxuICAgIC8vIGdyZWF0ZXIgaGVpZ2h0IGl0IHdpbGwgYmUgb3ZlcndyaXR0ZW4gaW4gdGhlIGNvbXB1dGUgcGFzcy5cbiAgICBpZiAocHJlY2VkZXNTdGF0ZW1lbnQgJiYgIXRoaXMuYmxvY2tfLmlzQ29sbGFwc2VkKCkpIHtcbiAgICAgIHRoaXMudG9wUm93Lm1pbkhlaWdodCA9XG4gICAgICAgICAgdGhpcy5jb25zdGFudHNfLlRPUF9ST1dfUFJFQ0VERVNfU1RBVEVNRU5UX01JTl9IRUlHSFQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudG9wUm93Lm1pbkhlaWdodCA9IHRoaXMuY29uc3RhbnRzXy5UT1BfUk9XX01JTl9IRUlHSFQ7XG4gICAgfVxuXG4gICAgY29ybmVyQ2xhc3MgPSB0aGlzLnRvcFJvdy5oYXNSaWdodFNxdWFyZUNvcm5lcih0aGlzLmJsb2NrXykgPyBTcXVhcmVDb3JuZXIgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUm91bmRDb3JuZXI7XG4gICAgdGhpcy50b3BSb3cuZWxlbWVudHMucHVzaChuZXcgY29ybmVyQ2xhc3ModGhpcy5jb25zdGFudHNfLCAncmlnaHQnKSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFsbCBub24tc3BhY2VyIGVsZW1lbnRzIHRoYXQgYmVsb25nIG9uIHRoZSBib3R0b20gcm93LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHBvcHVsYXRlQm90dG9tUm93XygpIHtcbiAgICB0aGlzLmJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbiA9ICEhdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb247XG5cbiAgICBjb25zdCBmb2xsb3dzU3RhdGVtZW50ID0gdGhpcy5ibG9ja18uaW5wdXRMaXN0Lmxlbmd0aCAmJlxuICAgICAgICB0aGlzLmJsb2NrXy5pbnB1dExpc3RbdGhpcy5ibG9ja18uaW5wdXRMaXN0Lmxlbmd0aCAtIDFdLnR5cGUgPT09XG4gICAgICAgICAgICBpbnB1dFR5cGVzLlNUQVRFTUVOVDtcblxuICAgIC8vIFRoaXMgaXMgdGhlIG1pbmltdW0gaGVpZ2h0IGZvciB0aGUgcm93LiBJZiBvbmUgb2YgaXRzIGVsZW1lbnRzIGhhcyBhXG4gICAgLy8gZ3JlYXRlciBoZWlnaHQgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiBpbiB0aGUgY29tcHV0ZSBwYXNzLlxuICAgIGlmIChmb2xsb3dzU3RhdGVtZW50KSB7XG4gICAgICB0aGlzLmJvdHRvbVJvdy5taW5IZWlnaHQgPVxuICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5CT1RUT01fUk9XX0FGVEVSX1NUQVRFTUVOVF9NSU5fSEVJR0hUO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJvdHRvbVJvdy5taW5IZWlnaHQgPSB0aGlzLmNvbnN0YW50c18uQk9UVE9NX1JPV19NSU5fSEVJR0hUO1xuICAgIH1cblxuICAgIGNvbnN0IGxlZnRTcXVhcmVDb3JuZXIgPSB0aGlzLmJvdHRvbVJvdy5oYXNMZWZ0U3F1YXJlQ29ybmVyKHRoaXMuYmxvY2tfKTtcblxuICAgIGlmIChsZWZ0U3F1YXJlQ29ybmVyKSB7XG4gICAgICB0aGlzLmJvdHRvbVJvdy5lbGVtZW50cy5wdXNoKG5ldyBTcXVhcmVDb3JuZXIodGhpcy5jb25zdGFudHNfKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYm90dG9tUm93LmVsZW1lbnRzLnB1c2gobmV3IFJvdW5kQ29ybmVyKHRoaXMuY29uc3RhbnRzXykpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbikge1xuICAgICAgdGhpcy5ib3R0b21Sb3cuY29ubmVjdGlvbiA9IG5ldyBOZXh0Q29ubmVjdGlvbihcbiAgICAgICAgICB0aGlzLmNvbnN0YW50c18sICh0aGlzLmJsb2NrXy5uZXh0Q29ubmVjdGlvbiBhcyBSZW5kZXJlZENvbm5lY3Rpb24pKTtcbiAgICAgIHRoaXMuYm90dG9tUm93LmVsZW1lbnRzLnB1c2godGhpcy5ib3R0b21Sb3cuY29ubmVjdGlvbik7XG4gICAgfVxuXG4gICAgY29uc3QgcmlnaHRTcXVhcmVDb3JuZXIgPSB0aGlzLmJvdHRvbVJvdy5oYXNSaWdodFNxdWFyZUNvcm5lcih0aGlzLmJsb2NrXyk7XG5cbiAgICBpZiAocmlnaHRTcXVhcmVDb3JuZXIpIHtcbiAgICAgIHRoaXMuYm90dG9tUm93LmVsZW1lbnRzLnB1c2gobmV3IFNxdWFyZUNvcm5lcih0aGlzLmNvbnN0YW50c18sICdyaWdodCcpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ib3R0b21Sb3cuZWxlbWVudHMucHVzaChuZXcgUm91bmRDb3JuZXIodGhpcy5jb25zdGFudHNfLCAncmlnaHQnKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBpbnB1dCBlbGVtZW50IHRvIHRoZSBhY3RpdmUgcm93LCBpZiBuZWVkZWQsIGFuZCByZWNvcmQgdGhlIHR5cGUgb2ZcbiAgICogdGhlIGlucHV0IG9uIHRoZSByb3cuXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgaW5wdXQgdG8gcmVjb3JkIGluZm9ybWF0aW9uIGFib3V0LlxuICAgKiBAcGFyYW0gYWN0aXZlUm93IFRoZSByb3cgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgcG9wdWxhdGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGFkZElucHV0XyhpbnB1dDogSW5wdXQsIGFjdGl2ZVJvdzogUm93KSB7XG4gICAgLy8gTm9uLWR1bW15IGlucHV0cyBoYXZlIHZpc3VhbCByZXByZXNlbnRhdGlvbnMgb25zY3JlZW4uXG4gICAgaWYgKHRoaXMuaXNJbmxpbmUgJiYgaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSkge1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IElubGluZUlucHV0KHRoaXMuY29uc3RhbnRzXywgaW5wdXQpKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNJbmxpbmVJbnB1dCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLlNUQVRFTUVOVCkge1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IFN0YXRlbWVudElucHV0KHRoaXMuY29uc3RhbnRzXywgaW5wdXQpKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNTdGF0ZW1lbnQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSkge1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IEV4dGVybmFsVmFsdWVJbnB1dCh0aGlzLmNvbnN0YW50c18sIGlucHV0KSk7XG4gICAgICBhY3RpdmVSb3cuaGFzRXh0ZXJuYWxJbnB1dCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLkRVTU1ZKSB7XG4gICAgICAvLyBEdW1teSBpbnB1dHMgaGF2ZSBubyB2aXN1YWwgcmVwcmVzZW50YXRpb24sIGJ1dCB0aGUgaW5mb3JtYXRpb24gaXNcbiAgICAgIC8vIHN0aWxsIGltcG9ydGFudC5cbiAgICAgIGFjdGl2ZVJvdy5taW5IZWlnaHQgPSBNYXRoLm1heChcbiAgICAgICAgICBhY3RpdmVSb3cubWluSGVpZ2h0LFxuICAgICAgICAgIGlucHV0LmdldFNvdXJjZUJsb2NrKCkgJiYgaW5wdXQuZ2V0U291cmNlQmxvY2soKSEuaXNTaGFkb3coKSA/XG4gICAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5EVU1NWV9JTlBVVF9TSEFET1dfTUlOX0hFSUdIVCA6XG4gICAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5EVU1NWV9JTlBVVF9NSU5fSEVJR0hUKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNEdW1teUlucHV0ID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGFjdGl2ZVJvdy5hbGlnbiA9PT0gbnVsbCkge1xuICAgICAgYWN0aXZlUm93LmFsaWduID0gaW5wdXQuYWxpZ247XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlY2lkZSB3aGV0aGVyIHRvIHN0YXJ0IGEgbmV3IHJvdyBiZXR3ZWVuIHRoZSB0d28gQmxvY2tseS5JbnB1dHMuXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgZmlyc3QgaW5wdXQgdG8gY29uc2lkZXJcbiAgICogQHBhcmFtIGxhc3RJbnB1dCBUaGUgaW5wdXQgdGhhdCBmb2xsb3dzLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBuZXh0IGlucHV0IHNob3VsZCBiZSByZW5kZXJlZCBvbiBhIG5ldyByb3cuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2hvdWxkU3RhcnROZXdSb3dfKGlucHV0OiBJbnB1dCwgbGFzdElucHV0PzogSW5wdXQpOiBib29sZWFuIHtcbiAgICAvLyBJZiB0aGlzIGlzIHRoZSBmaXJzdCBpbnB1dCwganVzdCBhZGQgdG8gdGhlIGV4aXN0aW5nIHJvdy5cbiAgICAvLyBUaGF0IHJvdyBpcyBlaXRoZXIgZW1wdHkgb3IgaGFzIHNvbWUgaWNvbnMgaW4gaXQuXG4gICAgaWYgKCFsYXN0SW5wdXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gQSBzdGF0ZW1lbnQgaW5wdXQgb3IgYW4gaW5wdXQgZm9sbG93aW5nIG9uZSBhbHdheXMgZ2V0cyBhIG5ldyByb3cuXG4gICAgaWYgKGlucHV0LnR5cGUgPT09IGlucHV0VHlwZXMuU1RBVEVNRU5UIHx8XG4gICAgICAgIGxhc3RJbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLlNUQVRFTUVOVCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIFZhbHVlIGFuZCBkdW1teSBpbnB1dHMgZ2V0IG5ldyByb3cgaWYgaW5wdXRzIGFyZSBub3QgaW5saW5lZC5cbiAgICBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSB8fCBpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLkRVTU1ZKSB7XG4gICAgICByZXR1cm4gIXRoaXMuaXNJbmxpbmU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKiBBZGQgaG9yaXpvbnRhbCBzcGFjaW5nIGJldHdlZW4gYW5kIGFyb3VuZCBlbGVtZW50cyB3aXRoaW4gZWFjaCByb3cuICovXG4gIHByb3RlY3RlZCBhZGRFbGVtU3BhY2luZ18oKSB7XG4gICAgZm9yIChsZXQgaSA9IDAsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpKyspIHtcbiAgICAgIGNvbnN0IG9sZEVsZW1zID0gcm93LmVsZW1lbnRzO1xuICAgICAgcm93LmVsZW1lbnRzID0gW107XG4gICAgICAvLyBObyBzcGFjaW5nIG5lZWRlZCBiZWZvcmUgdGhlIGNvcm5lciBvbiB0aGUgdG9wIHJvdyBvciB0aGUgYm90dG9tIHJvdy5cbiAgICAgIGlmIChyb3cuc3RhcnRzV2l0aEVsZW1TcGFjZXIoKSkge1xuICAgICAgICAvLyBUaGVyZSdzIGEgc3BhY2VyIGJlZm9yZSB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgcm93LlxuICAgICAgICByb3cuZWxlbWVudHMucHVzaChuZXcgSW5Sb3dTcGFjZXIoXG4gICAgICAgICAgICB0aGlzLmNvbnN0YW50c18sIHRoaXMuZ2V0SW5Sb3dTcGFjaW5nXyhudWxsLCBvbGRFbGVtc1swXSkpKTtcbiAgICAgIH1cbiAgICAgIGlmICghb2xkRWxlbXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCBvbGRFbGVtcy5sZW5ndGggLSAxOyBlKyspIHtcbiAgICAgICAgcm93LmVsZW1lbnRzLnB1c2gob2xkRWxlbXNbZV0pO1xuICAgICAgICBjb25zdCBzcGFjaW5nID0gdGhpcy5nZXRJblJvd1NwYWNpbmdfKG9sZEVsZW1zW2VdLCBvbGRFbGVtc1tlICsgMV0pO1xuICAgICAgICByb3cuZWxlbWVudHMucHVzaChuZXcgSW5Sb3dTcGFjZXIodGhpcy5jb25zdGFudHNfLCBzcGFjaW5nKSk7XG4gICAgICB9XG4gICAgICByb3cuZWxlbWVudHMucHVzaChvbGRFbGVtc1tvbGRFbGVtcy5sZW5ndGggLSAxXSk7XG4gICAgICBpZiAocm93LmVuZHNXaXRoRWxlbVNwYWNlcigpKSB7XG4gICAgICAgIC8vIFRoZXJlJ3MgYSBzcGFjZXIgYWZ0ZXIgdGhlIGxhc3QgZWxlbWVudCBpbiB0aGUgcm93LlxuICAgICAgICByb3cuZWxlbWVudHMucHVzaChuZXcgSW5Sb3dTcGFjZXIoXG4gICAgICAgICAgICB0aGlzLmNvbnN0YW50c18sXG4gICAgICAgICAgICB0aGlzLmdldEluUm93U3BhY2luZ18ob2xkRWxlbXNbb2xkRWxlbXMubGVuZ3RoIC0gMV0sIG51bGwpKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0aGUgd2lkdGggb2YgYSBzcGFjZXIgZWxlbWVudCBpbiBhIHJvdyBiYXNlZCBvbiB0aGUgcHJldmlvdXMgYW5kXG4gICAqIG5leHQgZWxlbWVudHMgaW4gdGhhdCByb3cuICBGb3IgaW5zdGFuY2UsIGV4dHJhIHBhZGRpbmcgaXMgYWRkZWQgYmV0d2VlblxuICAgKiB0d28gZWRpdGFibGUgZmllbGRzLlxuICAgKlxuICAgKiBAcGFyYW0gcHJldiBUaGUgZWxlbWVudCBiZWZvcmUgdGhlIHNwYWNlci5cbiAgICogQHBhcmFtIG5leHQgVGhlIGVsZW1lbnQgYWZ0ZXIgdGhlIHNwYWNlci5cbiAgICogQHJldHVybnMgVGhlIHNpemUgb2YgdGhlIHNwYWNpbmcgYmV0d2VlbiB0aGUgdHdvIGVsZW1lbnRzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldEluUm93U3BhY2luZ18ocHJldjogTWVhc3VyYWJsZXxudWxsLCBuZXh0OiBNZWFzdXJhYmxlfG51bGwpOlxuICAgICAgbnVtYmVyIHtcbiAgICBpZiAoIXByZXYpIHtcbiAgICAgIC8vIFN0YXRlbWVudCBpbnB1dCBwYWRkaW5nLlxuICAgICAgaWYgKG5leHQgJiYgVHlwZXMuaXNTdGF0ZW1lbnRJbnB1dChuZXh0KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLlNUQVRFTUVOVF9JTlBVVF9QQURESU5HX0xFRlQ7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEJldHdlZW4gaW5wdXRzIGFuZCB0aGUgZW5kIG9mIHRoZSByb3cuXG4gICAgaWYgKHByZXYgJiYgVHlwZXMuaXNJbnB1dChwcmV2KSAmJiAhbmV4dCkge1xuICAgICAgaWYgKFR5cGVzLmlzRXh0ZXJuYWxJbnB1dChwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQocHJldikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc1N0YXRlbWVudElucHV0KHByZXYpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTk9fUEFERElORztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTcGFjaW5nIGJldHdlZW4gYSBzcXVhcmUgY29ybmVyIGFuZCBhIHByZXZpb3VzIG9yIG5leHQgY29ubmVjdGlvblxuICAgIGlmIChwcmV2ICYmIFR5cGVzLmlzTGVmdFNxdWFyZUNvcm5lcihwcmV2KSAmJiBuZXh0KSB7XG4gICAgICBpZiAoVHlwZXMuaXNQcmV2aW91c0Nvbm5lY3Rpb24obmV4dCkgfHwgVHlwZXMuaXNOZXh0Q29ubmVjdGlvbihuZXh0KSkge1xuICAgICAgICByZXR1cm4gbmV4dC5ub3RjaE9mZnNldDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTcGFjaW5nIGJldHdlZW4gYSByb3VuZGVkIGNvcm5lciBhbmQgYSBwcmV2aW91cyBvciBuZXh0IGNvbm5lY3Rpb24uXG4gICAgaWYgKHByZXYgJiYgVHlwZXMuaXNMZWZ0Um91bmRlZENvcm5lcihwcmV2KSAmJiBuZXh0KSB7XG4gICAgICBpZiAoVHlwZXMuaXNQcmV2aW91c0Nvbm5lY3Rpb24obmV4dCkgfHwgVHlwZXMuaXNOZXh0Q29ubmVjdGlvbihuZXh0KSkge1xuICAgICAgICByZXR1cm4gbmV4dC5ub3RjaE9mZnNldCAtIHRoaXMuY29uc3RhbnRzXy5DT1JORVJfUkFESVVTO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUVESVVNX1BBRERJTkc7XG4gIH1cblxuICAvKipcbiAgICogRmlndXJlIG91dCB3aGVyZSB0aGUgcmlnaHQgZWRnZSBvZiB0aGUgYmxvY2sgYW5kIHJpZ2h0IGVkZ2Ugb2Ygc3RhdGVtZW50XG4gICAqIGlucHV0cyBzaG91bGQgYmUgcGxhY2VkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNvbXB1dGVCb3VuZHNfKCkge1xuICAgIGxldCB3aWRlc3RTdGF0ZW1lbnRSb3dGaWVsZHMgPSAwO1xuICAgIGxldCBibG9ja1dpZHRoID0gMDtcbiAgICBsZXQgd2lkZXN0Um93V2l0aENvbm5lY3RlZEJsb2NrcyA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDAsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpKyspIHtcbiAgICAgIHJvdy5tZWFzdXJlKCk7XG4gICAgICBibG9ja1dpZHRoID0gTWF0aC5tYXgoYmxvY2tXaWR0aCwgcm93LndpZHRoKTtcbiAgICAgIGlmIChyb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHN0YXRlbWVudElucHV0ID0gcm93LmdldExhc3RJbnB1dCgpO1xuICAgICAgICBjb25zdCBpbm5lcldpZHRoID0gcm93LndpZHRoIC0gKHN0YXRlbWVudElucHV0Py53aWR0aCA/PyAwKTtcbiAgICAgICAgd2lkZXN0U3RhdGVtZW50Um93RmllbGRzID1cbiAgICAgICAgICAgIE1hdGgubWF4KHdpZGVzdFN0YXRlbWVudFJvd0ZpZWxkcywgaW5uZXJXaWR0aCk7XG4gICAgICB9XG4gICAgICB3aWRlc3RSb3dXaXRoQ29ubmVjdGVkQmxvY2tzID1cbiAgICAgICAgICBNYXRoLm1heCh3aWRlc3RSb3dXaXRoQ29ubmVjdGVkQmxvY2tzLCByb3cud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlbWVudEVkZ2UgPSB3aWRlc3RTdGF0ZW1lbnRSb3dGaWVsZHM7XG4gICAgdGhpcy53aWR0aCA9IGJsb2NrV2lkdGg7XG5cbiAgICBmb3IgKGxldCBpID0gMCwgcm93OyByb3cgPSB0aGlzLnJvd3NbaV07IGkrKykge1xuICAgICAgaWYgKHJvdy5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgICAgcm93LnN0YXRlbWVudEVkZ2UgPSB0aGlzLnN0YXRlbWVudEVkZ2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy53aWR0aFdpdGhDaGlsZHJlbiA9IE1hdGgubWF4KGJsb2NrV2lkdGgsIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MpO1xuXG4gICAgaWYgKHRoaXMub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgdGhpcy5zdGFydFggPSB0aGlzLm91dHB1dENvbm5lY3Rpb24ud2lkdGg7XG4gICAgICB0aGlzLndpZHRoICs9IHRoaXMub3V0cHV0Q29ubmVjdGlvbi53aWR0aDtcbiAgICAgIHRoaXMud2lkdGhXaXRoQ2hpbGRyZW4gKz0gdGhpcy5vdXRwdXRDb25uZWN0aW9uLndpZHRoO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYSBzcGFjaW5nIG1heSBiZSBuZWNlc3NhcnkgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHJpZ2h0IHNpZGVzIG9mIGFsbFxuICAgKiByb3dzIGxpbmUgdXAuICBUaGlzIGNhbiBvbmx5IGJlIGNhbGN1bGF0ZWQgYWZ0ZXIgYSBmaXJzdCBwYXNzIHRvIGNhbGN1bGF0ZVxuICAgKiB0aGUgc2l6ZXMgb2YgYWxsIHJvd3MuXG4gICAqL1xuICBwcm90ZWN0ZWQgYWxpZ25Sb3dFbGVtZW50c18oKSB7XG4gICAgZm9yIChsZXQgaSA9IDAsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpKyspIHtcbiAgICAgIGlmIChyb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICAgIHRoaXMuYWxpZ25TdGF0ZW1lbnRSb3dfKHJvdyBhcyBJbnB1dFJvdyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjdXJyZW50V2lkdGggPSByb3cud2lkdGg7XG4gICAgICAgIGNvbnN0IGRlc2lyZWRXaWR0aCA9IHRoaXMuZ2V0RGVzaXJlZFJvd1dpZHRoXyhyb3cpO1xuICAgICAgICBjb25zdCBtaXNzaW5nU3BhY2UgPSBkZXNpcmVkV2lkdGggLSBjdXJyZW50V2lkdGg7XG4gICAgICAgIGlmIChtaXNzaW5nU3BhY2UgPiAwKSB7XG4gICAgICAgICAgdGhpcy5hZGRBbGlnbm1lbnRQYWRkaW5nXyhyb3csIG1pc3NpbmdTcGFjZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFR5cGVzLmlzVG9wT3JCb3R0b21Sb3cocm93KSkge1xuICAgICAgICAgIHJvdy53aWR0aFdpdGhDb25uZWN0ZWRCbG9ja3MgPSByb3cud2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSBkZXNpcmVkIHdpZHRoIG9mIGFuIGlucHV0IHJvdy5cbiAgICpcbiAgICogQHBhcmFtIF9yb3cgVGhlIGlucHV0IHJvdy5cbiAgICogQHJldHVybnMgVGhlIGRlc2lyZWQgd2lkdGggb2YgdGhlIGlucHV0IHJvdy5cbiAgICovXG4gIHByb3RlY3RlZCBnZXREZXNpcmVkUm93V2lkdGhfKF9yb3c6IFJvdyk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMud2lkdGggLSB0aGlzLnN0YXJ0WDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb2RpZnkgdGhlIGdpdmVuIHJvdyB0byBhZGQgdGhlIGdpdmVuIGFtb3VudCBvZiBwYWRkaW5nIGFyb3VuZCBpdHMgZmllbGRzLlxuICAgKiBUaGUgZXhhY3QgbG9jYXRpb24gb2YgdGhlIHBhZGRpbmcgaXMgYmFzZWQgb24gdGhlIGFsaWdubWVudCBwcm9wZXJ0eSBvZiB0aGVcbiAgICogbGFzdCBpbnB1dCBpbiB0aGUgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSByb3cgVGhlIHJvdyB0byBhZGQgcGFkZGluZyB0by5cbiAgICogQHBhcmFtIG1pc3NpbmdTcGFjZSBIb3cgbXVjaCBwYWRkaW5nIHRvIGFkZC5cbiAgICovXG4gIHByb3RlY3RlZCBhZGRBbGlnbm1lbnRQYWRkaW5nXyhyb3c6IFJvdywgbWlzc2luZ1NwYWNlOiBudW1iZXIpIHtcbiAgICBjb25zdCBmaXJzdFNwYWNlciA9IHJvdy5nZXRGaXJzdFNwYWNlcigpO1xuICAgIGNvbnN0IGxhc3RTcGFjZXIgPSByb3cuZ2V0TGFzdFNwYWNlcigpO1xuICAgIGlmIChyb3cuaGFzRXh0ZXJuYWxJbnB1dCB8fCByb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICByb3cud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzICs9IG1pc3NpbmdTcGFjZTtcbiAgICB9XG5cbiAgICAvLyBEZWNpZGUgd2hlcmUgdGhlIGV4dHJhIHBhZGRpbmcgZ29lcy5cbiAgICBpZiAocm93LmFsaWduID09PSBBbGlnbi5MRUZUICYmIGxhc3RTcGFjZXIpIHtcbiAgICAgIC8vIEFkZCBwYWRkaW5nIHRvIHRoZSBlbmQgb2YgdGhlIHJvdy5cbiAgICAgIGxhc3RTcGFjZXIud2lkdGggKz0gbWlzc2luZ1NwYWNlO1xuICAgIH0gZWxzZSBpZiAocm93LmFsaWduID09PSBBbGlnbi5DRU5UUkUgJiYgZmlyc3RTcGFjZXIgJiYgbGFzdFNwYWNlcikge1xuICAgICAgLy8gU3BsaXQgdGhlIHBhZGRpbmcgYmV0d2VlbiB0aGUgYmVnaW5uaW5nIGFuZCBlbmQgb2YgdGhlIHJvdy5cbiAgICAgIGZpcnN0U3BhY2VyLndpZHRoICs9IG1pc3NpbmdTcGFjZSAvIDI7XG4gICAgICBsYXN0U3BhY2VyLndpZHRoICs9IG1pc3NpbmdTcGFjZSAvIDI7XG4gICAgfSBlbHNlIGlmIChyb3cuYWxpZ24gPT09IEFsaWduLlJJR0hUICYmIGZpcnN0U3BhY2VyKSB7XG4gICAgICAvLyBBZGQgcGFkZGluZyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSByb3cuXG4gICAgICBmaXJzdFNwYWNlci53aWR0aCArPSBtaXNzaW5nU3BhY2U7XG4gICAgfSBlbHNlIGlmIChsYXN0U3BhY2VyKSB7XG4gICAgICAvLyBEZWZhdWx0IHRvIGxlZnQtYWxpZ25pbmcuXG4gICAgICBsYXN0U3BhY2VyLndpZHRoICs9IG1pc3NpbmdTcGFjZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByb3cud2lkdGggKz0gbWlzc2luZ1NwYWNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsaWduIHRoZSBlbGVtZW50cyBvZiBhIHN0YXRlbWVudCByb3cgYmFzZWQgb24gY29tcHV0ZWQgYm91bmRzLlxuICAgKiBVbmxpa2Ugb3RoZXIgdHlwZXMgb2Ygcm93cywgc3RhdGVtZW50IHJvd3MgYWRkIHNwYWNlIGluIG11bHRpcGxlIHBsYWNlcy5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgc3RhdGVtZW50IHJvdyB0byByZXNpemUuXG4gICAqL1xuICBwcm90ZWN0ZWQgYWxpZ25TdGF0ZW1lbnRSb3dfKHJvdzogSW5wdXRSb3cpIHtcbiAgICBjb25zdCBzdGF0ZW1lbnRJbnB1dCA9IHJvdy5nZXRMYXN0SW5wdXQoKTtcbiAgICBpZiAoIXN0YXRlbWVudElucHV0KSByZXR1cm47XG4gICAgbGV0IGN1cnJlbnRXaWR0aCA9IHJvdy53aWR0aCAtIHN0YXRlbWVudElucHV0LndpZHRoO1xuICAgIGxldCBkZXNpcmVkV2lkdGggPSB0aGlzLnN0YXRlbWVudEVkZ2U7XG4gICAgLy8gQWRkIHBhZGRpbmcgYmVmb3JlIHRoZSBzdGF0ZW1lbnQgaW5wdXQuXG4gICAgY29uc3QgbWlzc2luZ1NwYWNlID0gZGVzaXJlZFdpZHRoIC0gY3VycmVudFdpZHRoO1xuICAgIGlmIChtaXNzaW5nU3BhY2UgPiAwKSB7XG4gICAgICB0aGlzLmFkZEFsaWdubWVudFBhZGRpbmdfKHJvdywgbWlzc2luZ1NwYWNlKTtcbiAgICB9XG4gICAgLy8gQWxzbyB3aWRlbiB0aGUgc3RhdGVtZW50IGlucHV0IHRvIHJlYWNoIHRvIHRoZSByaWdodCBzaWRlIG9mIHRoZVxuICAgIC8vIGJsb2NrLiBOb3RlIHRoYXQgdGhpcyBkb2VzIG5vdCBhZGQgcGFkZGluZy5cbiAgICBjdXJyZW50V2lkdGggPSByb3cud2lkdGg7XG4gICAgZGVzaXJlZFdpZHRoID0gdGhpcy5nZXREZXNpcmVkUm93V2lkdGhfKHJvdyk7XG4gICAgc3RhdGVtZW50SW5wdXQud2lkdGggKz0gZGVzaXJlZFdpZHRoIC0gY3VycmVudFdpZHRoO1xuICAgIHN0YXRlbWVudElucHV0LmhlaWdodCA9IE1hdGgubWF4KHN0YXRlbWVudElucHV0LmhlaWdodCwgcm93LmhlaWdodCk7XG4gICAgcm93LndpZHRoICs9IGRlc2lyZWRXaWR0aCAtIGN1cnJlbnRXaWR0aDtcbiAgICByb3cud2lkdGhXaXRoQ29ubmVjdGVkQmxvY2tzID1cbiAgICAgICAgTWF0aC5tYXgocm93LndpZHRoLCB0aGlzLnN0YXRlbWVudEVkZ2UgKyByb3cuY29ubmVjdGVkQmxvY2tXaWR0aHMpO1xuICB9XG5cbiAgLyoqIEFkZCBzcGFjZXJzIGJldHdlZW4gcm93cyBhbmQgc2V0IHRoZWlyIHNpemVzLiAqL1xuICBwcm90ZWN0ZWQgYWRkUm93U3BhY2luZ18oKSB7XG4gICAgY29uc3Qgb2xkUm93cyA9IHRoaXMucm93cztcbiAgICB0aGlzLnJvd3MgPSBbXTtcblxuICAgIGZvciAobGV0IHIgPSAwOyByIDwgb2xkUm93cy5sZW5ndGg7IHIrKykge1xuICAgICAgdGhpcy5yb3dzLnB1c2gob2xkUm93c1tyXSk7XG4gICAgICBpZiAociAhPT0gb2xkUm93cy5sZW5ndGggLSAxKSB7XG4gICAgICAgIHRoaXMucm93cy5wdXNoKHRoaXMubWFrZVNwYWNlclJvd18ob2xkUm93c1tyXSwgb2xkUm93c1tyICsgMV0pKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgc3BhY2VyIHJvdyB0byBnbyBiZXR3ZWVuIHByZXYgYW5kIG5leHQsIGFuZCBzZXQgaXRzIHNpemUuXG4gICAqXG4gICAqIEBwYXJhbSBwcmV2IFRoZSBwcmV2aW91cyByb3cuXG4gICAqIEBwYXJhbSBuZXh0IFRoZSBuZXh0IHJvdy5cbiAgICogQHJldHVybnMgVGhlIG5ld2x5IGNyZWF0ZWQgc3BhY2VyIHJvdy5cbiAgICovXG4gIHByb3RlY3RlZCBtYWtlU3BhY2VyUm93XyhwcmV2OiBSb3csIG5leHQ6IFJvdyk6IFNwYWNlclJvdyB7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5nZXRTcGFjZXJSb3dIZWlnaHRfKHByZXYsIG5leHQpO1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5nZXRTcGFjZXJSb3dXaWR0aF8ocHJldiwgbmV4dCk7XG4gICAgY29uc3Qgc3BhY2VyID0gbmV3IFNwYWNlclJvdyh0aGlzLmNvbnN0YW50c18sIGhlaWdodCwgd2lkdGgpO1xuICAgIGlmIChwcmV2Lmhhc1N0YXRlbWVudCkge1xuICAgICAgc3BhY2VyLmZvbGxvd3NTdGF0ZW1lbnQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAobmV4dC5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgIHNwYWNlci5wcmVjZWRlc1N0YXRlbWVudCA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBzcGFjZXI7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiBhIHNwYWNlciByb3cuXG4gICAqXG4gICAqIEBwYXJhbSBfcHJldiBUaGUgcm93IGJlZm9yZSB0aGUgc3BhY2VyLlxuICAgKiBAcGFyYW0gX25leHQgVGhlIHJvdyBhZnRlciB0aGUgc3BhY2VyLlxuICAgKiBAcmV0dXJucyBUaGUgZGVzaXJlZCB3aWR0aCBvZiB0aGUgc3BhY2VyIHJvdyBiZXR3ZWVuIHRoZXNlIHR3byByb3dzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldFNwYWNlclJvd1dpZHRoXyhfcHJldjogUm93LCBfbmV4dDogUm93KTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy53aWR0aCAtIHRoaXMuc3RhcnRYO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0aGUgaGVpZ2h0IG9mIGEgc3BhY2VyIHJvdy5cbiAgICpcbiAgICogQHBhcmFtIF9wcmV2IFRoZSByb3cgYmVmb3JlIHRoZSBzcGFjZXIuXG4gICAqIEBwYXJhbSBfbmV4dCBUaGUgcm93IGFmdGVyIHRoZSBzcGFjZXIuXG4gICAqIEByZXR1cm5zIFRoZSBkZXNpcmVkIGhlaWdodCBvZiB0aGUgc3BhY2VyIHJvdyBiZXR3ZWVuIHRoZXNlIHR3byByb3dzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldFNwYWNlclJvd0hlaWdodF8oX3ByZXY6IFJvdywgX25leHQ6IFJvdyk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgdGhlIGNlbnRlcmxpbmUgb2YgYW4gZWxlbWVudCBpbiBhIHJlbmRlcmVkIHJvdy5cbiAgICogVGhpcyBiYXNlIGltcGxlbWVudGF0aW9uIHB1dHMgdGhlIGNlbnRlcmxpbmUgYXQgdGhlIG1pZGRsZSBvZiB0aGUgcm93XG4gICAqIHZlcnRpY2FsbHksIHdpdGggbm8gc3BlY2lhbCBjYXNlcy4gIFlvdSB3aWxsIGxpa2VseSBuZWVkIGV4dHJhIGxvZ2ljIHRvXG4gICAqIGhhbmRsZSAoYXQgbWluaW11bSkgdG9wIGFuZCBib3R0b20gcm93cy5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IGNvbnRhaW5pbmcgdGhlIGVsZW1lbnQuXG4gICAqIEBwYXJhbSBlbGVtIFRoZSBlbGVtZW50IHRvIHBsYWNlLlxuICAgKiBAcmV0dXJucyBUaGUgZGVzaXJlZCBjZW50ZXJsaW5lIG9mIHRoZSBnaXZlbiBlbGVtZW50LCBhcyBhbiBvZmZzZXQgZnJvbSB0aGVcbiAgICogICAgIHRvcCBsZWZ0IG9mIHRoZSBibG9jay5cbiAgICovXG4gIHByb3RlY3RlZCBnZXRFbGVtQ2VudGVybGluZV8ocm93OiBSb3csIGVsZW06IE1lYXN1cmFibGUpOiBudW1iZXIge1xuICAgIGlmIChUeXBlcy5pc1NwYWNlcihlbGVtKSkge1xuICAgICAgcmV0dXJuIHJvdy55UG9zICsgZWxlbS5oZWlnaHQgLyAyO1xuICAgIH1cbiAgICBpZiAoVHlwZXMuaXNCb3R0b21Sb3cocm93KSkge1xuICAgICAgY29uc3QgYm90dG9tUm93ID0gcm93IGFzIEJvdHRvbVJvdztcbiAgICAgIGNvbnN0IGJhc2VsaW5lID1cbiAgICAgICAgICBib3R0b21Sb3cueVBvcyArIGJvdHRvbVJvdy5oZWlnaHQgLSBib3R0b21Sb3cuZGVzY2VuZGVySGVpZ2h0O1xuICAgICAgaWYgKFR5cGVzLmlzTmV4dENvbm5lY3Rpb24oZWxlbSkpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VsaW5lICsgZWxlbS5oZWlnaHQgLyAyO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VsaW5lIC0gZWxlbS5oZWlnaHQgLyAyO1xuICAgIH1cbiAgICBpZiAoVHlwZXMuaXNUb3BSb3cocm93KSkge1xuICAgICAgY29uc3QgdG9wUm93ID0gcm93IGFzIFRvcFJvdztcbiAgICAgIGlmIChUeXBlcy5pc0hhdChlbGVtKSkge1xuICAgICAgICByZXR1cm4gdG9wUm93LmNhcGxpbmUgLSBlbGVtLmhlaWdodCAvIDI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9wUm93LmNhcGxpbmUgKyBlbGVtLmhlaWdodCAvIDI7XG4gICAgfVxuICAgIHJldHVybiByb3cueVBvcyArIHJvdy5oZWlnaHQgLyAyO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCBmaW5hbCBwb3NpdGlvbiBpbmZvcm1hdGlvbiBvbiBlbGVtZW50cyBvbiB0aGUgZ2l2ZW4gcm93LCBmb3IgdXNlIGluXG4gICAqIGRyYXdpbmcuICBBdCBtaW5pbXVtIHRoaXMgcmVjb3JkcyB4UG9zIGFuZCBjZW50ZXJsaW5lIG9uIGVhY2ggZWxlbWVudC5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IGNvbnRhaW5pbmcgdGhlIGVsZW1lbnRzLlxuICAgKi9cbiAgcHJvdGVjdGVkIHJlY29yZEVsZW1Qb3NpdGlvbnNfKHJvdzogUm93KSB7XG4gICAgbGV0IHhDdXJzb3IgPSByb3cueFBvcztcbiAgICBmb3IgKGxldCBqID0gMCwgZWxlbTsgZWxlbSA9IHJvdy5lbGVtZW50c1tqXTsgaisrKSB7XG4gICAgICAvLyBOb3cgdGhhdCByb3cgaGVpZ2h0cyBhcmUgZmluYWxpemVkLCBtYWtlIHNwYWNlcnMgdXNlIHRoZSByb3cgaGVpZ2h0LlxuICAgICAgaWYgKFR5cGVzLmlzU3BhY2VyKGVsZW0pKSB7XG4gICAgICAgIGVsZW0uaGVpZ2h0ID0gcm93LmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGVsZW0ueFBvcyA9IHhDdXJzb3I7XG4gICAgICBlbGVtLmNlbnRlcmxpbmUgPSB0aGlzLmdldEVsZW1DZW50ZXJsaW5lXyhyb3csIGVsZW0pO1xuICAgICAgeEN1cnNvciArPSBlbGVtLndpZHRoO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIGFueSBmaW5hbCBjaGFuZ2VzIHRvIHRoZSByZW5kZXJpbmcgaW5mb3JtYXRpb24gb2JqZWN0LiAgSW4gcGFydGljdWxhcixcbiAgICogc3RvcmUgdGhlIHkgcG9zaXRpb24gb2YgZWFjaCByb3csIGFuZCByZWNvcmQgdGhlIGhlaWdodCBvZiB0aGUgZnVsbCBibG9jay5cbiAgICovXG4gIHByb3RlY3RlZCBmaW5hbGl6ZV8oKSB7XG4gICAgLy8gUGVyZm9ybWFuY2Ugbm90ZTogdGhpcyBjb3VsZCBiZSBjb21iaW5lZCB3aXRoIHRoZSBkcmF3IHBhc3MsIGlmIHRoZSB0aW1lXG4gICAgLy8gdGhhdCB0aGlzIHRha2VzIGlzIGV4Y2Vzc2l2ZS4gIEJ1dCBpdCBzaG91bGRuJ3QgYmUsIGJlY2F1c2UgaXQgb25seVxuICAgIC8vIGFjY2Vzc2VzIGFuZCBzZXRzIHByb3BlcnRpZXMgdGhhdCBhbHJlYWR5IGV4aXN0IG9uIHRoZSBvYmplY3RzLlxuICAgIGxldCB3aWRlc3RSb3dXaXRoQ29ubmVjdGVkQmxvY2tzID0gMDtcbiAgICBsZXQgeUN1cnNvciA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDAsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpKyspIHtcbiAgICAgIHJvdy55UG9zID0geUN1cnNvcjtcbiAgICAgIHJvdy54UG9zID0gdGhpcy5zdGFydFg7XG4gICAgICB5Q3Vyc29yICs9IHJvdy5oZWlnaHQ7XG5cbiAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgPVxuICAgICAgICAgIE1hdGgubWF4KHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MsIHJvdy53aWR0aFdpdGhDb25uZWN0ZWRCbG9ja3MpO1xuICAgICAgdGhpcy5yZWNvcmRFbGVtUG9zaXRpb25zXyhyb3cpO1xuICAgIH1cbiAgICBpZiAodGhpcy5vdXRwdXRDb25uZWN0aW9uICYmIHRoaXMuYmxvY2tfLm5leHRDb25uZWN0aW9uKSB7XG4gICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmJsb2NrXy5uZXh0Q29ubmVjdGlvbi50YXJnZXRCbG9jaygpO1xuICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAvLyBJbmNsdWRlIHdpZHRoIG9mIGNvbm5lY3RlZCBibG9jayBpbiB2YWx1ZSB0byBzdGFjayB3aWR0aCBtZWFzdXJlbWVudC5cbiAgICAgICAgd2lkZXN0Um93V2l0aENvbm5lY3RlZEJsb2NrcyA9IE1hdGgubWF4KFxuICAgICAgICAgICAgd2lkZXN0Um93V2l0aENvbm5lY3RlZEJsb2NrcywgdGFyZ2V0LmdldEhlaWdodFdpZHRoKCkud2lkdGgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMud2lkdGhXaXRoQ2hpbGRyZW4gPSB3aWRlc3RSb3dXaXRoQ29ubmVjdGVkQmxvY2tzICsgdGhpcy5zdGFydFg7XG5cbiAgICB0aGlzLmhlaWdodCA9IHlDdXJzb3I7XG4gICAgdGhpcy5zdGFydFkgPSB0aGlzLnRvcFJvdy5jYXBsaW5lO1xuICAgIHRoaXMuYm90dG9tUm93LmJhc2VsaW5lID0geUN1cnNvciAtIHRoaXMuYm90dG9tUm93LmRlc2NlbmRlckhlaWdodDtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEV2ZW50cyBmaXJlZCBhcyBhIHJlc3VsdCBvZiBhIG1hcmtlciBtb3ZlLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5NYXJrZXJNb3ZlJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja30gZnJvbSAnLi4vYmxvY2suanMnO1xuaW1wb3J0IHtBU1ROb2RlfSBmcm9tICcuLi9rZXlib2FyZF9uYXYvYXN0X25vZGUuanMnO1xuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcbmltcG9ydCB7QWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcblxuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIG1hcmtlciBtb3ZlIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5NYXJrZXJNb3ZlXG4gKi9cbmV4cG9ydCBjbGFzcyBNYXJrZXJNb3ZlIGV4dGVuZHMgVWlCYXNlIHtcbiAgYmxvY2tJZD86IHN0cmluZztcbiAgb2xkTm9kZT86IEFTVE5vZGU7XG4gIG5ld05vZGU/OiBBU1ROb2RlO1xuICBpc0N1cnNvcj86IGJvb2xlYW47XG4gIG92ZXJyaWRlIHR5cGUgPSBldmVudFV0aWxzLk1BUktFUl9NT1ZFO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X2Jsb2NrIFRoZSBhZmZlY3RlZCBibG9jay4gTnVsbCBpZiBjdXJyZW50IG5vZGUgaXMgb2YgdHlwZVxuICAgKiAgICAgd29ya3NwYWNlLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBpc0N1cnNvciBXaGV0aGVyIHRoaXMgaXMgYSBjdXJzb3IgZXZlbnQuIFVuZGVmaW5lZCBmb3IgYSBibGFua1xuICAgKiAgICAgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfb2xkTm9kZSBUaGUgb2xkIG5vZGUgdGhlIG1hcmtlciB1c2VkIHRvIGJlIG9uLlxuICAgKiAgICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqIEBwYXJhbSBvcHRfbmV3Tm9kZSBUaGUgbmV3IG5vZGUgdGhlIG1hcmtlciBpcyBub3cgb24uXG4gICAqICAgIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X2Jsb2NrPzogQmxvY2t8bnVsbCwgaXNDdXJzb3I/OiBib29sZWFuLCBvcHRfb2xkTm9kZT86IEFTVE5vZGV8bnVsbCxcbiAgICAgIG9wdF9uZXdOb2RlPzogQVNUTm9kZSkge1xuICAgIGxldCB3b3Jrc3BhY2VJZCA9IG9wdF9ibG9jayA/IG9wdF9ibG9jay53b3Jrc3BhY2UuaWQgOiB1bmRlZmluZWQ7XG4gICAgaWYgKG9wdF9uZXdOb2RlICYmIG9wdF9uZXdOb2RlLmdldFR5cGUoKSA9PT0gQVNUTm9kZS50eXBlcy5XT1JLU1BBQ0UpIHtcbiAgICAgIHdvcmtzcGFjZUlkID0gKG9wdF9uZXdOb2RlLmdldExvY2F0aW9uKCkgYXMgV29ya3NwYWNlKS5pZDtcbiAgICB9XG4gICAgc3VwZXIod29ya3NwYWNlSWQpO1xuXG4gICAgLyoqIFRoZSBibG9jayBpZGVudGlmaWVyIGZvciB0aGlzIGV2ZW50LiAqL1xuICAgIHRoaXMuYmxvY2tJZCA9IG9wdF9ibG9jaz8uaWQ7XG5cbiAgICAvKiogVGhlIG9sZCBub2RlIHRoZSBtYXJrZXIgdXNlZCB0byBiZSBvbi4gKi9cbiAgICB0aGlzLm9sZE5vZGUgPSBvcHRfb2xkTm9kZSB8fCB1bmRlZmluZWQ7XG5cbiAgICAvKiogVGhlIG5ldyBub2RlIHRoZSAgbWFya2VyIGlzIG5vdyBvbi4gKi9cbiAgICB0aGlzLm5ld05vZGUgPSBvcHRfbmV3Tm9kZTtcblxuICAgIC8qKiBXaGV0aGVyIHRoaXMgaXMgYSBjdXJzb3IgZXZlbnQuICovXG4gICAgdGhpcy5pc0N1cnNvciA9IGlzQ3Vyc29yO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBNYXJrZXJNb3ZlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIE1hcmtlck1vdmVKc29uO1xuICAgIGlmICh0aGlzLmlzQ3Vyc29yID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnV2hldGhlciB0aGlzIGlzIGEgY3Vyc29yIGV2ZW50IG9yIG5vdCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzICcgK1xuICAgICAgICAgICdhIHZhbHVlIHRvIHRoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMubmV3Tm9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgbmV3IG5vZGUgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIG5vZGUgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBqc29uWydpc0N1cnNvciddID0gdGhpcy5pc0N1cnNvcjtcbiAgICBqc29uWydibG9ja0lkJ10gPSB0aGlzLmJsb2NrSWQ7XG4gICAganNvblsnb2xkTm9kZSddID0gdGhpcy5vbGROb2RlO1xuICAgIGpzb25bJ25ld05vZGUnXSA9IHRoaXMubmV3Tm9kZTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBNYXJrZXJNb3ZlSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5NYXJrZXJNb3ZlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMuaXNDdXJzb3IgPSBqc29uWydpc0N1cnNvciddO1xuICAgIHRoaXMuYmxvY2tJZCA9IGpzb25bJ2Jsb2NrSWQnXTtcbiAgICB0aGlzLm9sZE5vZGUgPSBqc29uWydvbGROb2RlJ107XG4gICAgdGhpcy5uZXdOb2RlID0ganNvblsnbmV3Tm9kZSddO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBNYXJrZXJNb3ZlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0XG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mXG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogTWFya2VyTW92ZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlLCBldmVudD86IGFueSk6XG4gICAgICBNYXJrZXJNb3ZlIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IE1hcmtlck1vdmUoKSkgYXNcbiAgICAgICAgTWFya2VyTW92ZTtcbiAgICBuZXdFdmVudC5pc0N1cnNvciA9IGpzb25bJ2lzQ3Vyc29yJ107XG4gICAgbmV3RXZlbnQuYmxvY2tJZCA9IGpzb25bJ2Jsb2NrSWQnXTtcbiAgICBuZXdFdmVudC5vbGROb2RlID0ganNvblsnb2xkTm9kZSddO1xuICAgIG5ld0V2ZW50Lm5ld05vZGUgPSBqc29uWyduZXdOb2RlJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWFya2VyTW92ZUpzb24gZXh0ZW5kcyBBYnN0cmFjdEV2ZW50SnNvbiB7XG4gIGlzQ3Vyc29yOiBib29sZWFuO1xuICBibG9ja0lkPzogc3RyaW5nO1xuICBvbGROb2RlPzogQVNUTm9kZTtcbiAgbmV3Tm9kZTogQVNUTm9kZTtcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5NQVJLRVJfTU9WRSwgTWFya2VyTW92ZSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWV0aG9kcyBmb3IgZ3JhcGhpY2FsbHkgcmVuZGVyaW5nIGEgbWFya2VyIGFzIFNWRy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5NYXJrZXJTdmcnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuLi8uLi9ldmVudHMvZXZlbnRzX21hcmtlcl9tb3ZlLmpzJztcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Nvbm5lY3Rpb259IGZyb20gJy4uLy4uL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi4vLi4vY29ubmVjdGlvbl90eXBlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi4vLi4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtGaWVsZH0gZnJvbSAnLi4vLi4vZmllbGQuanMnO1xuaW1wb3J0IHR5cGUge0lBU1ROb2RlTG9jYXRpb25Tdmd9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvaV9hc3Rfbm9kZV9sb2NhdGlvbl9zdmcuanMnO1xuaW1wb3J0IHtBU1ROb2RlfSBmcm9tICcuLi8uLi9rZXlib2FyZF9uYXYvYXN0X25vZGUuanMnO1xuaW1wb3J0IHR5cGUge01hcmtlcn0gZnJvbSAnLi4vLi4va2V5Ym9hcmRfbmF2L21hcmtlci5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi8uLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4uLy4uL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdQYXRocyBmcm9tICcuLi8uLi91dGlscy9zdmdfcGF0aHMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi4vLi4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyLCBOb3RjaCwgUHV6emxlVGFifSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqIFRoZSBuYW1lIG9mIHRoZSBDU1MgY2xhc3MgZm9yIGEgY3Vyc29yLiAqL1xuY29uc3QgQ1VSU09SX0NMQVNTID0gJ2Jsb2NrbHlDdXJzb3InO1xuXG4vKiogVGhlIG5hbWUgb2YgdGhlIENTUyBjbGFzcyBmb3IgYSBtYXJrZXIuICovXG5jb25zdCBNQVJLRVJfQ0xBU1MgPSAnYmxvY2tseU1hcmtlcic7XG5cbi8qKlxuICogV2hhdCB3ZSBtdWx0aXBseSB0aGUgaGVpZ2h0IGJ5IHRvIGdldCB0aGUgaGVpZ2h0IG9mIHRoZSBtYXJrZXIuXG4gKiBPbmx5IHVzZWQgZm9yIHRoZSBibG9jayBhbmQgYmxvY2sgY29ubmVjdGlvbnMuXG4gKi9cbmNvbnN0IEhFSUdIVF9NVUxUSVBMSUVSID0gMyAvIDQ7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgbWFya2VyLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLk1hcmtlclN2Z1xuICovXG5leHBvcnQgY2xhc3MgTWFya2VyU3ZnIHtcbiAgLyoqXG4gICAqIFRoZSB3b3Jrc3BhY2UsIGZpZWxkLCBvciBibG9jayB0aGF0IHRoZSBtYXJrZXIgU1ZHIGVsZW1lbnQgc2hvdWxkIGJlXG4gICAqIGF0dGFjaGVkIHRvLlxuICAgKi9cbiAgcHJpdmF0ZSBwYXJlbnRfOiBJQVNUTm9kZUxvY2F0aW9uU3ZnfG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgY3VycmVudCBTVkcgZWxlbWVudCBmb3IgdGhlIG1hcmtlci4gKi9cbiAgY3VycmVudE1hcmtlclN2ZzogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcbiAgY29sb3VyXzogc3RyaW5nO1xuXG4gIC8qKiBUaGUgcm9vdCBTVkcgZ3JvdXAgY29udGFpbmluZyB0aGUgbWFya2VyLiAqL1xuICBwcm90ZWN0ZWQgbWFya2VyU3ZnXzogU1ZHR0VsZW1lbnR8bnVsbCA9IG51bGw7XG4gIHByb3RlY3RlZCBzdmdHcm91cF86IFNWR0dFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIHByb3RlY3RlZCBtYXJrZXJCbG9ja186IFNWR1BhdGhFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIHByb3RlY3RlZCBtYXJrZXJJbnB1dF86IFNWR1BhdGhFbGVtZW50fG51bGwgPSBudWxsO1xuICBwcm90ZWN0ZWQgbWFya2VyU3ZnTGluZV86IFNWR1JlY3RFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIHByb3RlY3RlZCBtYXJrZXJTdmdSZWN0XzogU1ZHUmVjdEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBjb25zdGFudHMgbmVjZXNzYXJ5IHRvIGRyYXcgdGhlIG1hcmtlci4gKi9cbiAgcHJvdGVjdGVkIGNvbnN0YW50c186IENvbnN0YW50UHJvdmlkZXI7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0aGUgbWFya2VyIGJlbG9uZ3MgdG8uXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIGNvbnN0YW50cyBmb3IgdGhlIHJlbmRlcmVyLlxuICAgKiBAcGFyYW0gbWFya2VyIFRoZSBtYXJrZXIgdG8gZHJhdy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHJpdmF0ZSByZWFkb25seSB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZywgY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyLFxuICAgICAgcHJpdmF0ZSByZWFkb25seSBtYXJrZXI6IE1hcmtlcikge1xuICAgIHRoaXMuY29uc3RhbnRzXyA9IGNvbnN0YW50cztcblxuICAgIGNvbnN0IGRlZmF1bHRDb2xvdXIgPSB0aGlzLmlzQ3Vyc29yKCkgPyB0aGlzLmNvbnN0YW50c18uQ1VSU09SX0NPTE9VUiA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5NQVJLRVJfQ09MT1VSO1xuXG4gICAgLyoqIFRoZSBjb2xvdXIgb2YgdGhlIG1hcmtlci4gKi9cbiAgICB0aGlzLmNvbG91cl8gPSBtYXJrZXIuY29sb3VyIHx8IGRlZmF1bHRDb2xvdXI7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSByb290IG5vZGUgb2YgdGhlIFNWRyBvciBudWxsIGlmIG5vbmUgZXhpc3RzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgcm9vdCBTVkcgbm9kZS5cbiAgICovXG4gIGdldFN2Z1Jvb3QoKTogU1ZHRWxlbWVudHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5zdmdHcm91cF87XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBtYXJrZXIuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBtYXJrZXIgdG8gZHJhdyBmb3IuXG4gICAqL1xuICBnZXRNYXJrZXIoKTogTWFya2VyIHtcbiAgICByZXR1cm4gdGhpcy5tYXJrZXI7XG4gIH1cblxuICAvKipcbiAgICogVHJ1ZSBpZiB0aGUgbWFya2VyIHNob3VsZCBiZSBkcmF3biBhcyBhIGN1cnNvciwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKiBBIGN1cnNvciBpcyBkcmF3biBhcyBhIGZsYXNoaW5nIGxpbmUuIEEgbWFya2VyIGlzIGRyYXduIGFzIGEgc29saWQgbGluZS5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbWFya2VyIGlzIGEgY3Vyc29yLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBpc0N1cnNvcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5tYXJrZXIudHlwZSA9PT0gJ2N1cnNvcic7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBET00gZWxlbWVudCBmb3IgdGhlIG1hcmtlci5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIG1hcmtlciBjb250cm9scyBTVkcgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY3JlYXRlRG9tKCk6IFNWR0VsZW1lbnQge1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuaXNDdXJzb3IoKSA/IENVUlNPUl9DTEFTUyA6IE1BUktFUl9DTEFTUztcblxuICAgIHRoaXMuc3ZnR3JvdXBfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkcsIHsnY2xhc3MnOiBjbGFzc05hbWV9KTtcblxuICAgIHRoaXMuY3JlYXRlRG9tSW50ZXJuYWxfKCk7XG4gICAgcmV0dXJuIHRoaXMuc3ZnR3JvdXBfO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaGVzIHRoZSBTVkcgcm9vdCBvZiB0aGUgbWFya2VyIHRvIHRoZSBTVkcgZ3JvdXAgb2YgdGhlIHBhcmVudC5cbiAgICpcbiAgICogQHBhcmFtIG5ld1BhcmVudCBUaGUgd29ya3NwYWNlLCBmaWVsZCwgb3IgYmxvY2sgdGhhdCB0aGUgbWFya2VyIFNWRyBlbGVtZW50XG4gICAqICAgICBzaG91bGQgYmUgYXR0YWNoZWQgdG8uXG4gICAqL1xuICBwcm90ZWN0ZWQgc2V0UGFyZW50XyhuZXdQYXJlbnQ6IElBU1ROb2RlTG9jYXRpb25TdmcpIHtcbiAgICBpZiAoIXRoaXMuaXNDdXJzb3IoKSkge1xuICAgICAgaWYgKHRoaXMucGFyZW50Xykge1xuICAgICAgICB0aGlzLnBhcmVudF8uc2V0TWFya2VyU3ZnKG51bGwpO1xuICAgICAgfVxuICAgICAgbmV3UGFyZW50LnNldE1hcmtlclN2Zyh0aGlzLmdldFN2Z1Jvb3QoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLnBhcmVudF8pIHtcbiAgICAgICAgdGhpcy5wYXJlbnRfLnNldEN1cnNvclN2ZyhudWxsKTtcbiAgICAgIH1cbiAgICAgIG5ld1BhcmVudC5zZXRDdXJzb3JTdmcodGhpcy5nZXRTdmdSb290KCkpO1xuICAgIH1cbiAgICB0aGlzLnBhcmVudF8gPSBuZXdQYXJlbnQ7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBtYXJrZXIuXG4gICAqXG4gICAqIEBwYXJhbSBvbGROb2RlIFRoZSBwcmV2aW91cyBub2RlIHRoZSBtYXJrZXIgd2FzIG9uIG9yIG51bGwuXG4gICAqIEBwYXJhbSBjdXJOb2RlIFRoZSBub2RlIHRoYXQgd2Ugd2FudCB0byBkcmF3IHRoZSBtYXJrZXIgZm9yLlxuICAgKi9cbiAgZHJhdyhvbGROb2RlOiBBU1ROb2RlLCBjdXJOb2RlOiBBU1ROb2RlKSB7XG4gICAgaWYgKCFjdXJOb2RlKSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnN0YW50c18gPSB0aGlzLndvcmtzcGFjZS5nZXRSZW5kZXJlcigpLmdldENvbnN0YW50cygpO1xuXG4gICAgY29uc3QgZGVmYXVsdENvbG91ciA9IHRoaXMuaXNDdXJzb3IoKSA/IHRoaXMuY29uc3RhbnRzXy5DVVJTT1JfQ09MT1VSIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zdGFudHNfLk1BUktFUl9DT0xPVVI7XG4gICAgdGhpcy5jb2xvdXJfID0gdGhpcy5tYXJrZXIuY29sb3VyIHx8IGRlZmF1bHRDb2xvdXI7XG4gICAgdGhpcy5hcHBseUNvbG91cl8oY3VyTm9kZSk7XG5cbiAgICB0aGlzLnNob3dBdExvY2F0aW9uXyhjdXJOb2RlKTtcblxuICAgIHRoaXMuZmlyZU1hcmtlckV2ZW50XyhvbGROb2RlLCBjdXJOb2RlKTtcblxuICAgIC8vIEVuc3VyZXMgdGhlIG1hcmtlciB3aWxsIGJlIHZpc2libGUgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIG1vdmUuXG4gICAgY29uc3QgYW5pbWF0ZSA9IHRoaXMuY3VycmVudE1hcmtlclN2ZyEuY2hpbGROb2Rlc1swXTtcbiAgICBpZiAoYW5pbWF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAoYW5pbWF0ZSBhcyBTVkdBbmltYXRpb25FbGVtZW50KS5iZWdpbkVsZW1lbnQgJiZcbiAgICAgICAgICAoYW5pbWF0ZSBhcyBTVkdBbmltYXRpb25FbGVtZW50KS5iZWdpbkVsZW1lbnQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBtYXJrZXIncyB2aXNpYmxlIHN0YXRlIGJhc2VkIG9uIHRoZSB0eXBlIG9mIGN1ck5vZGUuLlxuICAgKlxuICAgKiBAcGFyYW0gY3VyTm9kZSBUaGUgbm9kZSB0aGF0IHdlIHdhbnQgdG8gZHJhdyB0aGUgbWFya2VyIGZvci5cbiAgICovXG4gIHByb3RlY3RlZCBzaG93QXRMb2NhdGlvbl8oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIGNvbnN0IGN1ck5vZGVBc0Nvbm5lY3Rpb24gPSBjdXJOb2RlLmdldExvY2F0aW9uKCkgYXMgQ29ubmVjdGlvbjtcbiAgICBjb25zdCBjb25uZWN0aW9uVHlwZSA9IGN1ck5vZGVBc0Nvbm5lY3Rpb24udHlwZTtcbiAgICBpZiAoY3VyTm9kZS5nZXRUeXBlKCkgPT09IEFTVE5vZGUudHlwZXMuQkxPQ0spIHtcbiAgICAgIHRoaXMuc2hvd1dpdGhCbG9ja18oY3VyTm9kZSk7XG4gICAgfSBlbHNlIGlmIChjdXJOb2RlLmdldFR5cGUoKSA9PT0gQVNUTm9kZS50eXBlcy5PVVRQVVQpIHtcbiAgICAgIHRoaXMuc2hvd1dpdGhPdXRwdXRfKGN1ck5vZGUpO1xuICAgIH0gZWxzZSBpZiAoY29ubmVjdGlvblR5cGUgPT09IENvbm5lY3Rpb25UeXBlLklOUFVUX1ZBTFVFKSB7XG4gICAgICB0aGlzLnNob3dXaXRoSW5wdXRfKGN1ck5vZGUpO1xuICAgIH0gZWxzZSBpZiAoY29ubmVjdGlvblR5cGUgPT09IENvbm5lY3Rpb25UeXBlLk5FWFRfU1RBVEVNRU5UKSB7XG4gICAgICB0aGlzLnNob3dXaXRoTmV4dF8oY3VyTm9kZSk7XG4gICAgfSBlbHNlIGlmIChjdXJOb2RlLmdldFR5cGUoKSA9PT0gQVNUTm9kZS50eXBlcy5QUkVWSU9VUykge1xuICAgICAgdGhpcy5zaG93V2l0aFByZXZpb3VzXyhjdXJOb2RlKTtcbiAgICB9IGVsc2UgaWYgKGN1ck5vZGUuZ2V0VHlwZSgpID09PSBBU1ROb2RlLnR5cGVzLkZJRUxEKSB7XG4gICAgICB0aGlzLnNob3dXaXRoRmllbGRfKGN1ck5vZGUpO1xuICAgIH0gZWxzZSBpZiAoY3VyTm9kZS5nZXRUeXBlKCkgPT09IEFTVE5vZGUudHlwZXMuV09SS1NQQUNFKSB7XG4gICAgICB0aGlzLnNob3dXaXRoQ29vcmRpbmF0ZXNfKGN1ck5vZGUpO1xuICAgIH0gZWxzZSBpZiAoY3VyTm9kZS5nZXRUeXBlKCkgPT09IEFTVE5vZGUudHlwZXMuU1RBQ0spIHtcbiAgICAgIHRoaXMuc2hvd1dpdGhTdGFja18oY3VyTm9kZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIERpc3BsYXlcbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBtYXJrZXIgYXMgYSBjb21iaW5hdGlvbiBvZiB0aGUgcHJldmlvdXMgY29ubmVjdGlvbiBhbmQgYmxvY2ssXG4gICAqIHRoZSBvdXRwdXQgY29ubmVjdGlvbiBhbmQgYmxvY2ssIG9yIGp1c3QgdGhlIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gY3VyTm9kZSBUaGUgbm9kZSB0byBkcmF3IHRoZSBtYXJrZXIgZm9yLlxuICAgKi9cbiAgcHJpdmF0ZSBzaG93V2l0aEJsb2NrUHJldk91dHB1dF8oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIGNvbnN0IGJsb2NrID0gY3VyTm9kZS5nZXRTb3VyY2VCbG9jaygpIGFzIEJsb2NrU3ZnO1xuICAgIGNvbnN0IHdpZHRoID0gYmxvY2sud2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gYmxvY2suaGVpZ2h0O1xuICAgIGNvbnN0IG1hcmtlckhlaWdodCA9IGhlaWdodCAqIEhFSUdIVF9NVUxUSVBMSUVSO1xuICAgIGNvbnN0IG1hcmtlck9mZnNldCA9IHRoaXMuY29uc3RhbnRzXy5DVVJTT1JfQkxPQ0tfUEFERElORztcblxuICAgIGlmIChibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24pIHtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25TaGFwZSA9XG4gICAgICAgICAgdGhpcy5jb25zdGFudHNfLnNoYXBlRm9yKGJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbikgYXMgTm90Y2g7XG4gICAgICB0aGlzLnBvc2l0aW9uUHJldmlvdXNfKFxuICAgICAgICAgIHdpZHRoLCBtYXJrZXJPZmZzZXQsIG1hcmtlckhlaWdodCwgY29ubmVjdGlvblNoYXBlKTtcbiAgICB9IGVsc2UgaWYgKGJsb2NrLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25TaGFwZSA9XG4gICAgICAgICAgdGhpcy5jb25zdGFudHNfLnNoYXBlRm9yKGJsb2NrLm91dHB1dENvbm5lY3Rpb24pIGFzIFB1enpsZVRhYjtcbiAgICAgIHRoaXMucG9zaXRpb25PdXRwdXRfKHdpZHRoLCBoZWlnaHQsIGNvbm5lY3Rpb25TaGFwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucG9zaXRpb25CbG9ja18od2lkdGgsIG1hcmtlck9mZnNldCwgbWFya2VySGVpZ2h0KTtcbiAgICB9XG4gICAgdGhpcy5zZXRQYXJlbnRfKGJsb2NrKTtcbiAgICB0aGlzLnNob3dDdXJyZW50XygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9uIGFuZCBkaXNwbGF5IHRoZSBtYXJrZXIgZm9yIGEgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBjdXJOb2RlIFRoZSBub2RlIHRvIGRyYXcgdGhlIG1hcmtlciBmb3IuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2hvd1dpdGhCbG9ja18oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIHRoaXMuc2hvd1dpdGhCbG9ja1ByZXZPdXRwdXRfKGN1ck5vZGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9uIGFuZCBkaXNwbGF5IHRoZSBtYXJrZXIgZm9yIGEgcHJldmlvdXMgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGN1ck5vZGUgVGhlIG5vZGUgdG8gZHJhdyB0aGUgbWFya2VyIGZvci5cbiAgICovXG4gIHByb3RlY3RlZCBzaG93V2l0aFByZXZpb3VzXyhjdXJOb2RlOiBBU1ROb2RlKSB7XG4gICAgdGhpcy5zaG93V2l0aEJsb2NrUHJldk91dHB1dF8oY3VyTm9kZSk7XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb24gYW5kIGRpc3BsYXkgdGhlIG1hcmtlciBmb3IgYW4gb3V0cHV0IGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBjdXJOb2RlIFRoZSBub2RlIHRvIGRyYXcgdGhlIG1hcmtlciBmb3IuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2hvd1dpdGhPdXRwdXRfKGN1ck5vZGU6IEFTVE5vZGUpIHtcbiAgICB0aGlzLnNob3dXaXRoQmxvY2tQcmV2T3V0cHV0XyhjdXJOb2RlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiBhbmQgZGlzcGxheSB0aGUgbWFya2VyIGZvciBhIHdvcmtzcGFjZSBjb29yZGluYXRlLlxuICAgKiBUaGlzIGlzIGEgaG9yaXpvbnRhbCBsaW5lLlxuICAgKlxuICAgKiBAcGFyYW0gY3VyTm9kZSBUaGUgbm9kZSB0byBkcmF3IHRoZSBtYXJrZXIgZm9yLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNob3dXaXRoQ29vcmRpbmF0ZXNfKGN1ck5vZGU6IEFTVE5vZGUpIHtcbiAgICBjb25zdCB3c0Nvb3JkaW5hdGUgPSBjdXJOb2RlLmdldFdzQ29vcmRpbmF0ZSgpO1xuICAgIGxldCB4ID0gd3NDb29yZGluYXRlLng7XG4gICAgY29uc3QgeSA9IHdzQ29vcmRpbmF0ZS55O1xuXG4gICAgaWYgKHRoaXMud29ya3NwYWNlLlJUTCkge1xuICAgICAgeCAtPSB0aGlzLmNvbnN0YW50c18uQ1VSU09SX1dTX1dJRFRIO1xuICAgIH1cblxuICAgIHRoaXMucG9zaXRpb25MaW5lXyh4LCB5LCB0aGlzLmNvbnN0YW50c18uQ1VSU09SX1dTX1dJRFRIKTtcbiAgICB0aGlzLnNldFBhcmVudF8odGhpcy53b3Jrc3BhY2UpO1xuICAgIHRoaXMuc2hvd0N1cnJlbnRfKCk7XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb24gYW5kIGRpc3BsYXkgdGhlIG1hcmtlciBmb3IgYSBmaWVsZC5cbiAgICogVGhpcyBpcyBhIGJveCBhcm91bmQgdGhlIGZpZWxkLlxuICAgKlxuICAgKiBAcGFyYW0gY3VyTm9kZSBUaGUgbm9kZSB0byBkcmF3IHRoZSBtYXJrZXIgZm9yLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNob3dXaXRoRmllbGRfKGN1ck5vZGU6IEFTVE5vZGUpIHtcbiAgICBjb25zdCBmaWVsZCA9IGN1ck5vZGUuZ2V0TG9jYXRpb24oKSBhcyBGaWVsZDtcbiAgICBjb25zdCB3aWR0aCA9IGZpZWxkLmdldFNpemUoKS53aWR0aDtcbiAgICBjb25zdCBoZWlnaHQgPSBmaWVsZC5nZXRTaXplKCkuaGVpZ2h0O1xuXG4gICAgdGhpcy5wb3NpdGlvblJlY3RfKDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIHRoaXMuc2V0UGFyZW50XyhmaWVsZCk7XG4gICAgdGhpcy5zaG93Q3VycmVudF8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiBhbmQgZGlzcGxheSB0aGUgbWFya2VyIGZvciBhbiBpbnB1dC5cbiAgICogVGhpcyBpcyBhIHB1enpsZSBwaWVjZS5cbiAgICpcbiAgICogQHBhcmFtIGN1ck5vZGUgVGhlIG5vZGUgdG8gZHJhdyB0aGUgbWFya2VyIGZvci5cbiAgICovXG4gIHByb3RlY3RlZCBzaG93V2l0aElucHV0XyhjdXJOb2RlOiBBU1ROb2RlKSB7XG4gICAgY29uc3QgY29ubmVjdGlvbiA9IGN1ck5vZGUuZ2V0TG9jYXRpb24oKSBhcyBSZW5kZXJlZENvbm5lY3Rpb247XG4gICAgY29uc3Qgc291cmNlQmxvY2sgPSAoY29ubmVjdGlvbi5nZXRTb3VyY2VCbG9jaygpKTtcblxuICAgIHRoaXMucG9zaXRpb25JbnB1dF8oY29ubmVjdGlvbik7XG4gICAgdGhpcy5zZXRQYXJlbnRfKHNvdXJjZUJsb2NrKTtcbiAgICB0aGlzLnNob3dDdXJyZW50XygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9uIGFuZCBkaXNwbGF5IHRoZSBtYXJrZXIgZm9yIGEgbmV4dCBjb25uZWN0aW9uLlxuICAgKiBUaGlzIGlzIGEgaG9yaXpvbnRhbCBsaW5lLlxuICAgKlxuICAgKiBAcGFyYW0gY3VyTm9kZSBUaGUgbm9kZSB0byBkcmF3IHRoZSBtYXJrZXIgZm9yLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNob3dXaXRoTmV4dF8oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBjdXJOb2RlLmdldExvY2F0aW9uKCkgYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuICAgIGNvbnN0IHRhcmdldEJsb2NrID0gKGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKSk7XG4gICAgbGV0IHggPSAwO1xuICAgIGNvbnN0IHkgPSBjb25uZWN0aW9uLmdldE9mZnNldEluQmxvY2soKS55O1xuICAgIGNvbnN0IHdpZHRoID0gdGFyZ2V0QmxvY2suZ2V0SGVpZ2h0V2lkdGgoKS53aWR0aDtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuUlRMKSB7XG4gICAgICB4ID0gLXdpZHRoO1xuICAgIH1cbiAgICB0aGlzLnBvc2l0aW9uTGluZV8oeCwgeSwgd2lkdGgpO1xuICAgIHRoaXMuc2V0UGFyZW50Xyh0YXJnZXRCbG9jayk7XG4gICAgdGhpcy5zaG93Q3VycmVudF8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiBhbmQgZGlzcGxheSB0aGUgbWFya2VyIGZvciBhIHN0YWNrLlxuICAgKiBUaGlzIGlzIGEgYm94IHdpdGggZXh0cmEgcGFkZGluZyBhcm91bmQgdGhlIGVudGlyZSBzdGFjayBvZiBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBjdXJOb2RlIFRoZSBub2RlIHRvIGRyYXcgdGhlIG1hcmtlciBmb3IuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2hvd1dpdGhTdGFja18oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIGNvbnN0IGJsb2NrID0gY3VyTm9kZS5nZXRMb2NhdGlvbigpIGFzIEJsb2NrU3ZnO1xuXG4gICAgLy8gR2V0cyB0aGUgaGVpZ2h0IGFuZCB3aWR0aCBvZiBlbnRpcmUgc3RhY2suXG4gICAgY29uc3QgaGVpZ2h0V2lkdGggPSBibG9jay5nZXRIZWlnaHRXaWR0aCgpO1xuXG4gICAgLy8gQWRkIHBhZGRpbmcgc28gdGhhdCBiZWluZyBvbiBhIHN0YWNrIGxvb2tzIGRpZmZlcmVudCB0aGFuIGJlaW5nIG9uIGFcbiAgICAvLyBibG9jay5cbiAgICBjb25zdCB3aWR0aCA9IGhlaWdodFdpZHRoLndpZHRoICsgdGhpcy5jb25zdGFudHNfLkNVUlNPUl9TVEFDS19QQURESU5HO1xuICAgIGNvbnN0IGhlaWdodCA9IGhlaWdodFdpZHRoLmhlaWdodCArIHRoaXMuY29uc3RhbnRzXy5DVVJTT1JfU1RBQ0tfUEFERElORztcblxuICAgIC8vIFNoaWZ0IHRoZSByZWN0YW5nbGUgc2xpZ2h0bHkgdG8gdXBwZXIgbGVmdCBzbyBwYWRkaW5nIGlzIGVxdWFsIG9uIGFsbFxuICAgIC8vIHNpZGVzLlxuICAgIGNvbnN0IHhQYWRkaW5nID0gLXRoaXMuY29uc3RhbnRzXy5DVVJTT1JfU1RBQ0tfUEFERElORyAvIDI7XG4gICAgY29uc3QgeVBhZGRpbmcgPSAtdGhpcy5jb25zdGFudHNfLkNVUlNPUl9TVEFDS19QQURESU5HIC8gMjtcblxuICAgIGxldCB4ID0geFBhZGRpbmc7XG4gICAgY29uc3QgeSA9IHlQYWRkaW5nO1xuXG4gICAgaWYgKHRoaXMud29ya3NwYWNlLlJUTCkge1xuICAgICAgeCA9IC0od2lkdGggKyB4UGFkZGluZyk7XG4gICAgfVxuICAgIHRoaXMucG9zaXRpb25SZWN0Xyh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB0aGlzLnNldFBhcmVudF8oYmxvY2spO1xuICAgIHRoaXMuc2hvd0N1cnJlbnRfKCk7XG4gIH1cblxuICAvKiogU2hvdyB0aGUgY3VycmVudCBtYXJrZXIuICovXG4gIHByb3RlY3RlZCBzaG93Q3VycmVudF8oKSB7XG4gICAgdGhpcy5oaWRlKCk7XG4gICAgaWYgKHRoaXMuY3VycmVudE1hcmtlclN2Zykge1xuICAgICAgdGhpcy5jdXJyZW50TWFya2VyU3ZnLnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICB9XG4gIH1cblxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogUG9zaXRpb25cbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiB0aGUgbWFya2VyIGZvciBhIGJsb2NrLlxuICAgKiBEaXNwbGF5cyBhbiBvdXRsaW5lIG9mIHRoZSB0b3AgaGFsZiBvZiBhIHJlY3RhbmdsZSBhcm91bmQgYSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgYmxvY2suXG4gICAqIEBwYXJhbSBtYXJrZXJPZmZzZXQgVGhlIGV4dHJhIHBhZGRpbmcgZm9yIGFyb3VuZCB0aGUgYmxvY2suXG4gICAqIEBwYXJhbSBtYXJrZXJIZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgbWFya2VyLlxuICAgKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uQmxvY2tfKFxuICAgICAgd2lkdGg6IG51bWJlciwgbWFya2VyT2Zmc2V0OiBudW1iZXIsIG1hcmtlckhlaWdodDogbnVtYmVyKSB7XG4gICAgY29uc3QgbWFya2VyUGF0aCA9IHN2Z1BhdGhzLm1vdmVCeSgtbWFya2VyT2Zmc2V0LCBtYXJrZXJIZWlnaHQpICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnVicsIC1tYXJrZXJPZmZzZXQpICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnSCcsIHdpZHRoICsgbWFya2VyT2Zmc2V0ICogMikgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgbWFya2VySGVpZ2h0KTtcbiAgICBpZiAoIXRoaXMubWFya2VyQmxvY2tfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ2NyZWF0ZURvbSBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBwb3NpdGlvbmluZyB0aGUgbWFya2VyJyk7XG4gICAgfVxuICAgIHRoaXMubWFya2VyQmxvY2tfLnNldEF0dHJpYnV0ZSgnZCcsIG1hcmtlclBhdGgpO1xuICAgIGlmICh0aGlzLndvcmtzcGFjZS5SVEwpIHtcbiAgICAgIHRoaXMuZmxpcFJ0bF8odGhpcy5tYXJrZXJCbG9ja18pO1xuICAgIH1cbiAgICB0aGlzLmN1cnJlbnRNYXJrZXJTdmcgPSB0aGlzLm1hcmtlckJsb2NrXztcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiB0aGUgbWFya2VyIGZvciBhbiBpbnB1dCBjb25uZWN0aW9uLlxuICAgKiBEaXNwbGF5cyBhIGZpbGxlZCBpbiBwdXp6bGUgcGllY2UuXG4gICAqXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uIFRoZSBjb25uZWN0aW9uIHRvIHBvc2l0aW9uIG1hcmtlciBhcm91bmQuXG4gICAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25JbnB1dF8oY29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9uKSB7XG4gICAgY29uc3QgeCA9IGNvbm5lY3Rpb24uZ2V0T2Zmc2V0SW5CbG9jaygpLng7XG4gICAgY29uc3QgeSA9IGNvbm5lY3Rpb24uZ2V0T2Zmc2V0SW5CbG9jaygpLnk7XG5cbiAgICBjb25zdCBwYXRoID0gc3ZnUGF0aHMubW92ZVRvKDAsIDApICtcbiAgICAgICAgKHRoaXMuY29uc3RhbnRzXy5zaGFwZUZvcihjb25uZWN0aW9uKSBhcyBQdXp6bGVUYWIpLnBhdGhEb3duO1xuXG4gICAgdGhpcy5tYXJrZXJJbnB1dF8hLnNldEF0dHJpYnV0ZSgnZCcsIHBhdGgpO1xuICAgIHRoaXMubWFya2VySW5wdXRfIS5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAndHJhbnNsYXRlKCcgKyB4ICsgJywnICsgeSArICcpJyArXG4gICAgICAgICAgICAodGhpcy53b3Jrc3BhY2UuUlRMID8gJyBzY2FsZSgtMSAxKScgOiAnJykpO1xuICAgIHRoaXMuY3VycmVudE1hcmtlclN2ZyA9IHRoaXMubWFya2VySW5wdXRfO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgYW5kIHNob3cgdGhlIG1hcmtlciBhdCB0aGUgc3BlY2lmaWVkIGNvb3JkaW5hdGUgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBEaXNwbGF5cyBhIGhvcml6b250YWwgbGluZS5cbiAgICpcbiAgICogQHBhcmFtIHggVGhlIG5ldyB4LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBwYXJhbSB5IFRoZSBuZXcgeSwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0gd2lkdGggVGhlIG5ldyB3aWR0aCwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uTGluZV8oeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIpIHtcbiAgICBpZiAoIXRoaXMubWFya2VyU3ZnTGluZV8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY3JlYXRlRG9tIHNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIHBvc2l0aW9uaW5nIHRoZSBsaW5lJyk7XG4gICAgfVxuICAgIHRoaXMubWFya2VyU3ZnTGluZV8uc2V0QXR0cmlidXRlKCd4JywgYCR7eH1gKTtcbiAgICB0aGlzLm1hcmtlclN2Z0xpbmVfLnNldEF0dHJpYnV0ZSgneScsIGAke3l9YCk7XG4gICAgdGhpcy5tYXJrZXJTdmdMaW5lXy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7d2lkdGh9YCk7XG4gICAgdGhpcy5jdXJyZW50TWFya2VyU3ZnID0gdGhpcy5tYXJrZXJTdmdMaW5lXztcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiB0aGUgbWFya2VyIGZvciBhbiBvdXRwdXQgY29ubmVjdGlvbi5cbiAgICogRGlzcGxheXMgYSBwdXp6bGUgb3V0bGluZSBhbmQgdGhlIHRvcCBhbmQgYm90dG9tIHBhdGguXG4gICAqXG4gICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIGJsb2NrLlxuICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIGJsb2NrLlxuICAgKiBAcGFyYW0gY29ubmVjdGlvblNoYXBlIFRoZSBzaGFwZSBvYmplY3QgZm9yIHRoZSBjb25uZWN0aW9uLlxuICAgKi9cbiAgcHJvdGVjdGVkIHBvc2l0aW9uT3V0cHV0XyhcbiAgICAgIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBjb25uZWN0aW9uU2hhcGU6IFB1enpsZVRhYikge1xuICAgIGlmICghdGhpcy5tYXJrZXJCbG9ja18pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnY3JlYXRlRG9tIHNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIHBvc2l0aW9uaW5nIHRoZSBvdXRwdXQnKTtcbiAgICB9XG4gICAgY29uc3QgbWFya2VyUGF0aCA9IHN2Z1BhdGhzLm1vdmVCeSh3aWR0aCwgMCkgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCdoJywgLSh3aWR0aCAtIGNvbm5lY3Rpb25TaGFwZS53aWR0aCkpICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygndicsIHRoaXMuY29uc3RhbnRzXy5UQUJfT0ZGU0VUX0ZST01fVE9QKSArXG4gICAgICAgIGNvbm5lY3Rpb25TaGFwZS5wYXRoRG93biArIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ1YnLCBoZWlnaHQpICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnSCcsIHdpZHRoKTtcbiAgICB0aGlzLm1hcmtlckJsb2NrXy5zZXRBdHRyaWJ1dGUoJ2QnLCBtYXJrZXJQYXRoKTtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuUlRMKSB7XG4gICAgICB0aGlzLmZsaXBSdGxfKHRoaXMubWFya2VyQmxvY2tfKTtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50TWFya2VyU3ZnID0gdGhpcy5tYXJrZXJCbG9ja187XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb24gdGhlIG1hcmtlciBmb3IgYSBwcmV2aW91cyBjb25uZWN0aW9uLlxuICAgKiBEaXNwbGF5cyBhIGhhbGYgcmVjdGFuZ2xlIHdpdGggYSBub3RjaCBpbiB0aGUgdG9wIHRvIHJlcHJlc2VudCB0aGUgcHJldmlvdXNcbiAgICogY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgYmxvY2suXG4gICAqIEBwYXJhbSBtYXJrZXJPZmZzZXQgVGhlIG9mZnNldCBvZiB0aGUgbWFya2VyIGZyb20gYXJvdW5kIHRoZSBibG9jay5cbiAgICogQHBhcmFtIG1hcmtlckhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBtYXJrZXIuXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uU2hhcGUgVGhlIHNoYXBlIG9iamVjdCBmb3IgdGhlIGNvbm5lY3Rpb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25QcmV2aW91c18oXG4gICAgICB3aWR0aDogbnVtYmVyLCBtYXJrZXJPZmZzZXQ6IG51bWJlciwgbWFya2VySGVpZ2h0OiBudW1iZXIsXG4gICAgICBjb25uZWN0aW9uU2hhcGU6IE5vdGNoKSB7XG4gICAgaWYgKCF0aGlzLm1hcmtlckJsb2NrXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdjcmVhdGVEb20gc2hvdWxkIGJlIGNhbGxlZCBiZWZvcmUgcG9zaXRpb25pbmcgdGhlIHByZXZpb3VzIGNvbm5lY3Rpb24gbWFya2VyJyk7XG4gICAgfVxuICAgIGNvbnN0IG1hcmtlclBhdGggPSBzdmdQYXRocy5tb3ZlQnkoLW1hcmtlck9mZnNldCwgbWFya2VySGVpZ2h0KSArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ1YnLCAtbWFya2VyT2Zmc2V0KSArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ0gnLCB0aGlzLmNvbnN0YW50c18uTk9UQ0hfT0ZGU0VUX0xFRlQpICtcbiAgICAgICAgY29ubmVjdGlvblNoYXBlLnBhdGhMZWZ0ICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnSCcsIHdpZHRoICsgbWFya2VyT2Zmc2V0ICogMikgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgbWFya2VySGVpZ2h0KTtcbiAgICB0aGlzLm1hcmtlckJsb2NrXy5zZXRBdHRyaWJ1dGUoJ2QnLCBtYXJrZXJQYXRoKTtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuUlRMKSB7XG4gICAgICB0aGlzLmZsaXBSdGxfKHRoaXMubWFya2VyQmxvY2tfKTtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50TWFya2VyU3ZnID0gdGhpcy5tYXJrZXJCbG9ja187XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhbmQgc2hvdyB0aGUgbWFya2VyIGF0IHRoZSBzcGVjaWZpZWQgY29vcmRpbmF0ZSBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIERpc3BsYXlzIGEgZmlsbGVkIGluIHJlY3RhbmdsZS5cbiAgICpcbiAgICogQHBhcmFtIHggVGhlIG5ldyB4LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqIEBwYXJhbSB5IFRoZSBuZXcgeSwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0gd2lkdGggVGhlIG5ldyB3aWR0aCwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBuZXcgaGVpZ2h0LCBpbiB3b3Jrc3BhY2UgdW5pdHMuXG4gICAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25SZWN0Xyh4OiBudW1iZXIsIHk6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICBpZiAoIXRoaXMubWFya2VyU3ZnUmVjdF8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY3JlYXRlRG9tIHNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIHBvc2l0aW9uaW5nIHRoZSByZWN0Jyk7XG4gICAgfVxuICAgIHRoaXMubWFya2VyU3ZnUmVjdF8uc2V0QXR0cmlidXRlKCd4JywgYCR7eH1gKTtcbiAgICB0aGlzLm1hcmtlclN2Z1JlY3RfLnNldEF0dHJpYnV0ZSgneScsIGAke3l9YCk7XG4gICAgdGhpcy5tYXJrZXJTdmdSZWN0Xy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7d2lkdGh9YCk7XG4gICAgdGhpcy5tYXJrZXJTdmdSZWN0Xy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGAke2hlaWdodH1gKTtcbiAgICB0aGlzLmN1cnJlbnRNYXJrZXJTdmcgPSB0aGlzLm1hcmtlclN2Z1JlY3RfO1xuICB9XG5cbiAgLyoqXG4gICAqIEZsaXAgdGhlIFNWRyBwYXRocyBpbiBSVEwuXG4gICAqXG4gICAqIEBwYXJhbSBtYXJrZXJTdmcgVGhlIG1hcmtlciB0aGF0IHdlIHdhbnQgdG8gZmxpcC5cbiAgICovXG4gIHByaXZhdGUgZmxpcFJ0bF8obWFya2VyU3ZnOiBTVkdFbGVtZW50KSB7XG4gICAgbWFya2VyU3ZnLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgJ3NjYWxlKC0xIDEpJyk7XG4gIH1cblxuICAvKiogSGlkZSB0aGUgbWFya2VyLiAqL1xuICBoaWRlKCkge1xuICAgIGlmICghdGhpcy5tYXJrZXJTdmdMaW5lXyB8fCAhdGhpcy5tYXJrZXJTdmdSZWN0XyB8fCAhdGhpcy5tYXJrZXJJbnB1dF8gfHxcbiAgICAgICAgIXRoaXMubWFya2VyQmxvY2tfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyZWF0ZURvbSBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBoaWRpbmcgdGhlIG1hcmtlcicpO1xuICAgIH1cbiAgICB0aGlzLm1hcmtlclN2Z0xpbmVfLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgdGhpcy5tYXJrZXJTdmdSZWN0Xy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIHRoaXMubWFya2VySW5wdXRfLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgdGhpcy5tYXJrZXJCbG9ja18uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgfVxuXG4gIC8qKlxuICAgKiBGaXJlIGV2ZW50IGZvciB0aGUgbWFya2VyIG9yIG1hcmtlci5cbiAgICpcbiAgICogQHBhcmFtIG9sZE5vZGUgVGhlIG9sZCBub2RlIHRoZSBtYXJrZXIgdXNlZCB0byBiZSBvbi5cbiAgICogQHBhcmFtIGN1ck5vZGUgVGhlIG5ldyBub2RlIHRoZSBtYXJrZXIgaXMgY3VycmVudGx5IG9uLlxuICAgKi9cbiAgcHJpdmF0ZSBmaXJlTWFya2VyRXZlbnRfKG9sZE5vZGU6IEFTVE5vZGUsIGN1ck5vZGU6IEFTVE5vZGUpIHtcbiAgICBjb25zdCBjdXJCbG9jayA9IGN1ck5vZGUuZ2V0U291cmNlQmxvY2soKTtcbiAgICBjb25zdCBldmVudCA9IG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5NQVJLRVJfTU9WRSkpKFxuICAgICAgICBjdXJCbG9jaywgdGhpcy5pc0N1cnNvcigpLCBvbGROb2RlLCBjdXJOb2RlKTtcbiAgICBldmVudFV0aWxzLmZpcmUoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcHJvcGVydGllcyB0byBtYWtlIGEgbWFya2VyIGJsaW5rLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IGhvbGRpbmcgYXR0cmlidXRlcyB0byBtYWtlIHRoZSBtYXJrZXIgYmxpbmsuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0QmxpbmtQcm9wZXJ0aWVzXygpOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdhdHRyaWJ1dGVUeXBlJzogJ1hNTCcsXG4gICAgICAnYXR0cmlidXRlTmFtZSc6ICdmaWxsJyxcbiAgICAgICdkdXInOiAnMXMnLFxuICAgICAgJ3ZhbHVlcyc6IHRoaXMuY29sb3VyXyArICc7dHJhbnNwYXJlbnQ7dHJhbnNwYXJlbnQ7JyxcbiAgICAgICdyZXBlYXRDb3VudCc6ICdpbmRlZmluaXRlJyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgbWFya2VyIFNWRy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIFNWRyBub2RlIGNyZWF0ZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgY3JlYXRlRG9tSW50ZXJuYWxfKCk6IEVsZW1lbnQge1xuICAgIC8qIFRoaXMgbWFya3VwIHdpbGwgYmUgZ2VuZXJhdGVkIGFuZCBhZGRlZCB0byB0aGUgLnN2Z0dyb3VwXzpcbiAgICAgICAgPGc+XG4gICAgICAgICAgPHJlY3Qgd2lkdGg9XCIxMDBcIiBoZWlnaHQ9XCI1XCI+XG4gICAgICAgICAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVUeXBlPVwiWE1MXCIgYXR0cmlidXRlTmFtZT1cImZpbGxcIiBkdXI9XCIxc1wiXG4gICAgICAgICAgICAgIHZhbHVlcz1cInRyYW5zcGFyZW50O3RyYW5zcGFyZW50OyNmZmY7dHJhbnNwYXJlbnRcIlxuICAgICAgICByZXBlYXRDb3VudD1cImluZGVmaW5pdGVcIiAvPlxuICAgICAgICAgIDwvcmVjdD5cbiAgICAgICAgPC9nPlxuICAgICAgICAqL1xuXG4gICAgdGhpcy5tYXJrZXJTdmdfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5HLCB7XG4gICAgICAgICAgJ3dpZHRoJzogdGhpcy5jb25zdGFudHNfLkNVUlNPUl9XU19XSURUSCxcbiAgICAgICAgICAnaGVpZ2h0JzogdGhpcy5jb25zdGFudHNfLldTX0NVUlNPUl9IRUlHSFQsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuc3ZnR3JvdXBfKTtcblxuICAgIC8vIEEgaG9yaXpvbnRhbCBsaW5lIHVzZWQgdG8gcmVwcmVzZW50IGEgd29ya3NwYWNlIGNvb3JkaW5hdGUgb3IgbmV4dFxuICAgIC8vIGNvbm5lY3Rpb24uXG4gICAgdGhpcy5tYXJrZXJTdmdMaW5lXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUkVDVCwge1xuICAgICAgICAgICd3aWR0aCc6IHRoaXMuY29uc3RhbnRzXy5DVVJTT1JfV1NfV0lEVEgsXG4gICAgICAgICAgJ2hlaWdodCc6IHRoaXMuY29uc3RhbnRzXy5XU19DVVJTT1JfSEVJR0hULFxuICAgICAgICAgICdzdHlsZSc6ICdkaXNwbGF5OiBub25lJyxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5tYXJrZXJTdmdfKTtcblxuICAgIC8vIEEgZmlsbGVkIGluIHJlY3RhbmdsZSB1c2VkIHRvIHJlcHJlc2VudCBhIHN0YWNrLlxuICAgIHRoaXMubWFya2VyU3ZnUmVjdF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlJFQ1QsIHtcbiAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseVZlcnRpY2FsTWFya2VyJyxcbiAgICAgICAgICAncngnOiAxMCxcbiAgICAgICAgICAncnknOiAxMCxcbiAgICAgICAgICAnc3R5bGUnOiAnZGlzcGxheTogbm9uZScsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMubWFya2VyU3ZnXyk7XG5cbiAgICAvLyBBIGZpbGxlZCBpbiBwdXp6bGUgcGllY2UgdXNlZCB0byByZXByZXNlbnQgYW4gaW5wdXQgdmFsdWUuXG4gICAgdGhpcy5tYXJrZXJJbnB1dF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlBBVEgsIHsndHJhbnNmb3JtJzogJycsICdzdHlsZSc6ICdkaXNwbGF5OiBub25lJ30sIHRoaXMubWFya2VyU3ZnXyk7XG5cbiAgICAvLyBBIHBhdGggdXNlZCB0byByZXByZXNlbnQgYSBwcmV2aW91cyBjb25uZWN0aW9uIGFuZCBhIGJsb2NrLCBhbiBvdXRwdXRcbiAgICAvLyBjb25uZWN0aW9uIGFuZCBhIGJsb2NrLCBvciBhIGJsb2NrLlxuICAgIHRoaXMubWFya2VyQmxvY2tfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5QQVRILCB7XG4gICAgICAgICAgJ3RyYW5zZm9ybSc6ICcnLFxuICAgICAgICAgICdzdHlsZSc6ICdkaXNwbGF5OiBub25lJyxcbiAgICAgICAgICAnZmlsbCc6ICdub25lJyxcbiAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogdGhpcy5jb25zdGFudHNfLkNVUlNPUl9TVFJPS0VfV0lEVEgsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMubWFya2VyU3ZnXyk7XG5cbiAgICAvLyBNYXJrZXJzIGFuZCBzdGFjayBtYXJrZXJzIGRvbid0IGJsaW5rLlxuICAgIGlmICh0aGlzLmlzQ3Vyc29yKCkpIHtcbiAgICAgIGNvbnN0IGJsaW5rUHJvcGVydGllcyA9IHRoaXMuZ2V0QmxpbmtQcm9wZXJ0aWVzXygpO1xuICAgICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkFOSU1BVEUsIGJsaW5rUHJvcGVydGllcywgdGhpcy5tYXJrZXJTdmdMaW5lXyk7XG4gICAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuQU5JTUFURSwgYmxpbmtQcm9wZXJ0aWVzLCB0aGlzLm1hcmtlcklucHV0Xyk7XG4gICAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuQU5JTUFURSwgey4uLmJsaW5rUHJvcGVydGllcywgYXR0cmlidXRlTmFtZTogJ3N0cm9rZSd9LFxuICAgICAgICAgIHRoaXMubWFya2VyQmxvY2tfKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5tYXJrZXJTdmdfO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IHRoZSBtYXJrZXIncyBjb2xvdXIuXG4gICAqXG4gICAqIEBwYXJhbSBfY3VyTm9kZSBUaGUgbm9kZSB0aGF0IHdlIHdhbnQgdG8gZHJhdyB0aGUgbWFya2VyIGZvci5cbiAgICovXG4gIHByb3RlY3RlZCBhcHBseUNvbG91cl8oX2N1ck5vZGU6IEFTVE5vZGUpIHtcbiAgICBpZiAoIXRoaXMubWFya2VyU3ZnTGluZV8gfHwgIXRoaXMubWFya2VyU3ZnUmVjdF8gfHwgIXRoaXMubWFya2VySW5wdXRfIHx8XG4gICAgICAgICF0aGlzLm1hcmtlckJsb2NrXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdjcmVhdGVEb20gc2hvdWxkIGJlIGNhbGxlZCBiZWZvcmUgYXBwbHlpbmcgY29sb3IgdG8gdGhlIG1hcmtlcmonKTtcbiAgICB9XG4gICAgdGhpcy5tYXJrZXJTdmdMaW5lXy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCB0aGlzLmNvbG91cl8pO1xuICAgIHRoaXMubWFya2VyU3ZnUmVjdF8uc2V0QXR0cmlidXRlKCdzdHJva2UnLCB0aGlzLmNvbG91cl8pO1xuICAgIHRoaXMubWFya2VySW5wdXRfLnNldEF0dHJpYnV0ZSgnZmlsbCcsIHRoaXMuY29sb3VyXyk7XG4gICAgdGhpcy5tYXJrZXJCbG9ja18uc2V0QXR0cmlidXRlKCdzdHJva2UnLCB0aGlzLmNvbG91cl8pO1xuXG4gICAgaWYgKHRoaXMuaXNDdXJzb3IoKSkge1xuICAgICAgY29uc3QgdmFsdWVzID0gdGhpcy5jb2xvdXJfICsgJzt0cmFuc3BhcmVudDt0cmFuc3BhcmVudDsnO1xuICAgICAgdGhpcy5tYXJrZXJTdmdMaW5lXy5maXJzdEVsZW1lbnRDaGlsZCEuc2V0QXR0cmlidXRlKCd2YWx1ZXMnLCB2YWx1ZXMpO1xuICAgICAgdGhpcy5tYXJrZXJJbnB1dF8uZmlyc3RFbGVtZW50Q2hpbGQhLnNldEF0dHJpYnV0ZSgndmFsdWVzJywgdmFsdWVzKTtcbiAgICAgIHRoaXMubWFya2VyQmxvY2tfLmZpcnN0RWxlbWVudENoaWxkIS5zZXRBdHRyaWJ1dGUoJ3ZhbHVlcycsIHZhbHVlcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgdGhpcyBtYXJrZXIuICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgaWYgKHRoaXMuc3ZnR3JvdXBfKSB7XG4gICAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLnN2Z0dyb3VwXyk7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgb3ducyBhIGJsb2NrJ3MgcmVuZGVyaW5nIFNWRyBlbGVtZW50cy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ibG9ja1JlbmRlcmluZy5QYXRoT2JqZWN0Jyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N0eWxlfSBmcm9tICcuLi8uLi90aGVtZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi4vLi4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuLi8uLi91dGlscy9zdmcuanMnO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHR5cGUge0lQYXRoT2JqZWN0fSBmcm9tICcuL2lfcGF0aF9vYmplY3QuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgaGFuZGxlcyBjcmVhdGluZyBhbmQgc2V0dGluZyBlYWNoIG9mIHRoZSBTVkcgZWxlbWVudHNcbiAqIHVzZWQgYnkgdGhlIHJlbmRlcmVyLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlBhdGhPYmplY3RcbiAqL1xuZXhwb3J0IGNsYXNzIFBhdGhPYmplY3QgaW1wbGVtZW50cyBJUGF0aE9iamVjdCB7XG4gIHN2Z1Jvb3Q6IFNWR0VsZW1lbnQ7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3ZnUGF0aDogU1ZHRWxlbWVudDtcblxuICAvKipcbiAgICogSG9sZHMgdGhlIGN1cnNvcnMgc3ZnIGVsZW1lbnQgd2hlbiB0aGUgY3Vyc29yIGlzIGF0dGFjaGVkIHRvIHRoZSBibG9jay5cbiAgICogVGhpcyBpcyBudWxsIGlmIHRoZXJlIGlzIG5vIGN1cnNvciBvbiB0aGUgYmxvY2suXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY3Vyc29yU3ZnOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBIb2xkcyB0aGUgbWFya2VycyBzdmcgZWxlbWVudCB3aGVuIHRoZSBtYXJrZXIgaXMgYXR0YWNoZWQgdG8gdGhlIGJsb2NrLlxuICAgKiBUaGlzIGlzIG51bGwgaWYgdGhlcmUgaXMgbm8gbWFya2VyIG9uIHRoZSBibG9jay5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYXJrZXJTdmc6IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXI7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3R5bGU6IEJsb2NrU3R5bGU7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSByb290IFRoZSByb290IFNWRyBlbGVtZW50LlxuICAgKiBAcGFyYW0gc3R5bGUgVGhlIHN0eWxlIG9iamVjdCB0byB1c2UgZm9yIGNvbG91cmluZy5cbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyZXIncyBjb25zdGFudHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICByb290OiBTVkdFbGVtZW50LCBzdHlsZTogQmxvY2tTdHlsZSwgY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyKSB7XG4gICAgdGhpcy5jb25zdGFudHMgPSBjb25zdGFudHM7XG4gICAgdGhpcy5zdHlsZSA9IHN0eWxlO1xuICAgIHRoaXMuc3ZnUm9vdCA9IHJvb3Q7XG5cbiAgICAvKiogVGhlIHByaW1hcnkgcGF0aCBvZiB0aGUgYmxvY2suICovXG4gICAgdGhpcy5zdmdQYXRoID1cbiAgICAgICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLlBBVEgsIHsnY2xhc3MnOiAnYmxvY2tseVBhdGgnfSwgdGhpcy5zdmdSb290KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHBhdGggZ2VuZXJhdGVkIGJ5IHRoZSByZW5kZXJlciBvbnRvIHRoZSByZXNwZWN0aXZlIFNWRyBlbGVtZW50LlxuICAgKlxuICAgKiBAcGFyYW0gcGF0aFN0cmluZyBUaGUgcGF0aC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRQYXRoKHBhdGhTdHJpbmc6IHN0cmluZykge1xuICAgIHRoaXMuc3ZnUGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCBwYXRoU3RyaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGbGlwIHRoZSBTVkcgcGF0aHMgaW4gUlRMLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGZsaXBSVEwoKSB7XG4gICAgLy8gTWlycm9yIHRoZSBibG9jaydzIHBhdGguXG4gICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgJ3NjYWxlKC0xIDEpJyk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHRoZSBjdXJzb3IgU1ZHIHRvIHRoaXMgYmxvY2sncyBTVkcgZ3JvdXAuXG4gICAqXG4gICAqIEBwYXJhbSBjdXJzb3JTdmcgVGhlIFNWRyByb290IG9mIHRoZSBjdXJzb3IgdG8gYmUgYWRkZWQgdG8gdGhlIGJsb2NrIFNWR1xuICAgKiAgICAgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Q3Vyc29yU3ZnKGN1cnNvclN2ZzogU1ZHRWxlbWVudCkge1xuICAgIGlmICghY3Vyc29yU3ZnKSB7XG4gICAgICB0aGlzLmN1cnNvclN2ZyA9IG51bGw7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zdmdSb290LmFwcGVuZENoaWxkKGN1cnNvclN2Zyk7XG4gICAgdGhpcy5jdXJzb3JTdmcgPSBjdXJzb3JTdmc7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHRoZSBtYXJrZXIgU1ZHIHRvIHRoaXMgYmxvY2sncyBTVkcgZ3JvdXAuXG4gICAqXG4gICAqIEBwYXJhbSBtYXJrZXJTdmcgVGhlIFNWRyByb290IG9mIHRoZSBtYXJrZXIgdG8gYmUgYWRkZWQgdG8gdGhlIGJsb2NrIFNWR1xuICAgKiAgICAgZ3JvdXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0TWFya2VyU3ZnKG1hcmtlclN2ZzogU1ZHRWxlbWVudCkge1xuICAgIGlmICghbWFya2VyU3ZnKSB7XG4gICAgICB0aGlzLm1hcmtlclN2ZyA9IG51bGw7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3Vyc29yU3ZnKSB7XG4gICAgICB0aGlzLnN2Z1Jvb3QuaW5zZXJ0QmVmb3JlKG1hcmtlclN2ZywgdGhpcy5jdXJzb3JTdmcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN2Z1Jvb3QuYXBwZW5kQ2hpbGQobWFya2VyU3ZnKTtcbiAgICB9XG4gICAgdGhpcy5tYXJrZXJTdmcgPSBtYXJrZXJTdmc7XG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgdGhlIHN0b3JlZCBjb2xvdXJzIHRvIHRoZSBibG9jaydzIHBhdGgsIHRha2luZyBpbnRvIGFjY291bnQgd2hldGhlclxuICAgKiB0aGUgcGF0aHMgYmVsb25nIHRvIGEgc2hhZG93IGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIHNvdXJjZSBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBhcHBseUNvbG91cihibG9jazogQmxvY2tTdmcpIHtcbiAgICB0aGlzLnN2Z1BhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCB0aGlzLnN0eWxlLmNvbG91clRlcnRpYXJ5KTtcbiAgICB0aGlzLnN2Z1BhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5zdHlsZS5jb2xvdXJQcmltYXJ5KTtcblxuICAgIHRoaXMudXBkYXRlU2hhZG93XyhibG9jay5pc1NoYWRvdygpKTtcbiAgICB0aGlzLnVwZGF0ZURpc2FibGVkXyghYmxvY2suaXNFbmFibGVkKCkgfHwgYmxvY2suZ2V0SW5oZXJpdGVkRGlzYWJsZWQoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzdHlsZS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrU3R5bGUgVGhlIGJsb2NrIHN0eWxlIHRvIHVzZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRTdHlsZShibG9ja1N0eWxlOiBCbG9ja1N0eWxlKSB7XG4gICAgdGhpcy5zdHlsZSA9IGJsb2NrU3R5bGU7XG4gIH1cblxuICAvKipcbiAgICogQWRkIG9yIHJlbW92ZSB0aGUgZ2l2ZW4gQ1NTIGNsYXNzIG9uIHRoZSBwYXRoIG9iamVjdCdzIHJvb3QgU1ZHIGVsZW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBjbGFzc05hbWUgVGhlIG5hbWUgb2YgdGhlIGNsYXNzIHRvIGFkZCBvciByZW1vdmVcbiAgICogQHBhcmFtIGFkZCBUcnVlIGlmIHRoZSBjbGFzcyBzaG91bGQgYmUgYWRkZWQuICBGYWxzZSBpZiBpdCBzaG91bGQgYmVcbiAgICogICAgIHJlbW92ZWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2V0Q2xhc3NfKGNsYXNzTmFtZTogc3RyaW5nLCBhZGQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoIWNsYXNzTmFtZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYWRkKSB7XG4gICAgICBkb20uYWRkQ2xhc3ModGhpcy5zdmdSb290LCBjbGFzc05hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb20ucmVtb3ZlQ2xhc3ModGhpcy5zdmdSb290LCBjbGFzc05hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGUgYmxvY2sgc2hvd3MgYSBoaWdobGlnaHQgb3Igbm90LiAgQmxvY2sgaGlnaGxpZ2h0aW5nIGlzXG4gICAqIG9mdGVuIHVzZWQgdG8gdmlzdWFsbHkgbWFyayBibG9ja3MgY3VycmVudGx5IGJlaW5nIGV4ZWN1dGVkLlxuICAgKlxuICAgKiBAcGFyYW0gZW5hYmxlIFRydWUgaWYgaGlnaGxpZ2h0ZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdXBkYXRlSGlnaGxpZ2h0ZWQoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgaWYgKGVuYWJsZSkge1xuICAgICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAnZmlsdGVyJywgJ3VybCgjJyArIHRoaXMuY29uc3RhbnRzLmVtYm9zc0ZpbHRlcklkICsgJyknKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZSgnZmlsdGVyJywgJ25vbmUnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgbG9vayBvZiB0aGUgYmxvY2sgdG8gcmVmbGVjdCBhIHNoYWRvdyBzdGF0ZS5cbiAgICpcbiAgICogQHBhcmFtIHNoYWRvdyBUcnVlIGlmIHRoZSBibG9jayBpcyBhIHNoYWRvdyBibG9jay5cbiAgICovXG4gIHByb3RlY3RlZCB1cGRhdGVTaGFkb3dfKHNoYWRvdzogYm9vbGVhbikge1xuICAgIGlmIChzaGFkb3cpIHtcbiAgICAgIHRoaXMuc3ZnUGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICdub25lJyk7XG4gICAgICB0aGlzLnN2Z1BhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5zdHlsZS5jb2xvdXJTZWNvbmRhcnkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBsb29rIG9mIHRoZSBibG9jayB0byByZWZsZWN0IGEgZGlzYWJsZWQgc3RhdGUuXG4gICAqXG4gICAqIEBwYXJhbSBkaXNhYmxlZCBUcnVlIGlmIGRpc2FibGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIHVwZGF0ZURpc2FibGVkXyhkaXNhYmxlZDogYm9vbGVhbikge1xuICAgIHRoaXMuc2V0Q2xhc3NfKCdibG9ja2x5RGlzYWJsZWQnLCBkaXNhYmxlZCk7XG4gICAgaWYgKGRpc2FibGVkKSB7XG4gICAgICB0aGlzLnN2Z1BhdGguc2V0QXR0cmlidXRlKFxuICAgICAgICAgICdmaWxsJywgJ3VybCgjJyArIHRoaXMuY29uc3RhbnRzLmRpc2FibGVkUGF0dGVybklkICsgJyknKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIG9yIHJlbW92ZSBzdHlsaW5nIHNob3dpbmcgdGhhdCBhIGJsb2NrIGlzIHNlbGVjdGVkLlxuICAgKlxuICAgKiBAcGFyYW0gZW5hYmxlIFRydWUgaWYgc2VsZWN0aW9uIGlzIGVuYWJsZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICB1cGRhdGVTZWxlY3RlZChlbmFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNldENsYXNzXygnYmxvY2tseVNlbGVjdGVkJywgZW5hYmxlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgb3IgcmVtb3ZlIHN0eWxpbmcgc2hvd2luZyB0aGF0IGEgYmxvY2sgaXMgZHJhZ2dlZCBvdmVyIGEgZGVsZXRlIGFyZWEuXG4gICAqXG4gICAqIEBwYXJhbSBlbmFibGUgVHJ1ZSBpZiB0aGUgYmxvY2sgaXMgYmVpbmcgZHJhZ2dlZCBvdmVyIGEgZGVsZXRlIGFyZWEsIGZhbHNlXG4gICAqICAgICBvdGhlcndpc2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdXBkYXRlRHJhZ2dpbmdEZWxldGUoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5zZXRDbGFzc18oJ2Jsb2NrbHlEcmFnZ2luZ0RlbGV0ZScsIGVuYWJsZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIG9yIHJlbW92ZSBzdHlsaW5nIHNob3dpbmcgdGhhdCBhIGJsb2NrIGlzIGFuIGluc2VydGlvbiBtYXJrZXIuXG4gICAqXG4gICAqIEBwYXJhbSBlbmFibGUgVHJ1ZSBpZiB0aGUgYmxvY2sgaXMgYW4gaW5zZXJ0aW9uIG1hcmtlciwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZUluc2VydGlvbk1hcmtlcihlbmFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNldENsYXNzXygnYmxvY2tseUluc2VydGlvbk1hcmtlcicsIGVuYWJsZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIG9yIHJlbW92ZSBzdHlsaW5nIHNob3dpbmcgdGhhdCBhIGJsb2NrIGlzIG1vdmFibGUuXG4gICAqXG4gICAqIEBwYXJhbSBlbmFibGUgVHJ1ZSBpZiB0aGUgYmxvY2sgaXMgbW92YWJsZSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZU1vdmFibGUoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5zZXRDbGFzc18oJ2Jsb2NrbHlEcmFnZ2FibGUnLCBlbmFibGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBvciByZW1vdmUgc3R5bGluZyB0aGF0IHNob3dzIHRoYXQgaWYgdGhlIGRyYWdnaW5nIGJsb2NrIGlzIGRyb3BwZWQsXG4gICAqIHRoaXMgYmxvY2sgd2lsbCBiZSByZXBsYWNlZC4gIElmIGEgc2hhZG93IGJsb2NrLCBpdCB3aWxsIGRpc2FwcGVhci5cbiAgICogT3RoZXJ3aXNlIGl0IHdpbGwgYnVtcC5cbiAgICpcbiAgICogQHBhcmFtIGVuYWJsZSBUcnVlIGlmIHN0eWxpbmcgc2hvdWxkIGJlIGFkZGVkLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZVJlcGxhY2VtZW50RmFkZShlbmFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNldENsYXNzXygnYmxvY2tseVJlcGxhY2VhYmxlJywgZW5hYmxlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgb3IgcmVtb3ZlIHN0eWxpbmcgdGhhdCBzaG93cyB0aGF0IGlmIHRoZSBkcmFnZ2luZyBibG9jayBpcyBkcm9wcGVkLFxuICAgKiB0aGlzIGJsb2NrIHdpbGwgYmUgY29ubmVjdGVkIHRvIHRoZSBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIF9jb25uIFRoZSBjb25uZWN0aW9uIG9uIHRoZSBpbnB1dCB0byBoaWdobGlnaHQuXG4gICAqIEBwYXJhbSBfZW5hYmxlIFRydWUgaWYgc3R5bGluZyBzaG91bGQgYmUgYWRkZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdXBkYXRlU2hhcGVGb3JJbnB1dEhpZ2hsaWdodChfY29ubjogQ29ubmVjdGlvbiwgX2VuYWJsZTogYm9vbGVhbikge1xuICAgIC8vIE5PT1BcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIHRoYXQgY29udHJvbHMgdXBkYXRlcyB0byBjb25uZWN0aW9ucyBkdXJpbmcgZHJhZ3MuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuSW5zZXJ0aW9uTWFya2VyTWFuYWdlcicpO1xuXG5pbXBvcnQgKiBhcyBibG9ja0FuaW1hdGlvbnMgZnJvbSAnLi9ibG9ja19hbmltYXRpb25zLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4vY29tbW9uLmpzJztcbmltcG9ydCB7Q29tcG9uZW50TWFuYWdlcn0gZnJvbSAnLi9jb21wb25lbnRfbWFuYWdlci5qcyc7XG5pbXBvcnQge2NvbmZpZ30gZnJvbSAnLi9jb25maWcuanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0lEZWxldGVBcmVhfSBmcm9tICcuL2ludGVyZmFjZXMvaV9kZWxldGVfYXJlYS5qcyc7XG5pbXBvcnQgdHlwZSB7SURyYWdUYXJnZXR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2RyYWdfdGFyZ2V0LmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlZENvbm5lY3Rpb259IGZyb20gJy4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqIFJlcHJlc2VudHMgYSBuZWFyYnkgdmFsaWQgY29ubmVjdGlvbi4gKi9cbmludGVyZmFjZSBDYW5kaWRhdGVDb25uZWN0aW9uIHtcbiAgLyoqXG4gICAqIEEgbmVhcmJ5IHZhbGlkIGNvbm5lY3Rpb24gdGhhdCBpcyBjb21wYXRpYmxlIHdpdGggbG9jYWwuXG4gICAqIFRoaXMgaXMgbm90IG9uIGFueSBvZiB0aGUgYmxvY2tzIHRoYXQgYXJlIGJlaW5nIGRyYWdnZWQuXG4gICAqL1xuICBjbG9zZXN0OiBSZW5kZXJlZENvbm5lY3Rpb247XG4gIC8qKlxuICAgKiBBIGNvbm5lY3Rpb24gb24gdGhlIGRyYWdnaW5nIHN0YWNrIHRoYXQgaXMgY29tcGF0aWJsZSB3aXRoIGNsb3Nlc3QuIFRoaXMgaXNcbiAgICogb24gdGhlIHRvcCBibG9jayB0aGF0IGlzIGJlaW5nIGRyYWdnZWQgb3IgdGhlIGxhc3QgYmxvY2sgaW4gdGhlIGRyYWdnaW5nXG4gICAqIHN0YWNrLlxuICAgKi9cbiAgbG9jYWw6IFJlbmRlcmVkQ29ubmVjdGlvbjtcbiAgcmFkaXVzOiBudW1iZXI7XG59XG5cbi8qKlxuICogQW4gZXJyb3IgbWVzc2FnZSB0byB0aHJvdyBpZiB0aGUgYmxvY2sgY3JlYXRlZCBieSBjcmVhdGVNYXJrZXJCbG9ja18gaXNcbiAqIG1pc3NpbmcgYW55IGNvbXBvbmVudHMuXG4gKi9cbmNvbnN0IERVUExJQ0FURV9CTE9DS19FUlJPUiA9ICdUaGUgaW5zZXJ0aW9uIG1hcmtlciAnICtcbiAgICAnbWFuYWdlciB0cmllZCB0byBjcmVhdGUgYSBtYXJrZXIgYnV0IHRoZSByZXN1bHQgaXMgbWlzc2luZyAlMS4gSWYgJyArXG4gICAgJ3lvdSBhcmUgdXNpbmcgYSBtdXRhdG9yLCBtYWtlIHN1cmUgeW91ciBkb21Ub011dGF0aW9uIG1ldGhvZCBpcyAnICtcbiAgICAncHJvcGVybHkgZGVmaW5lZC4nO1xuXG4vKipcbiAqIENsYXNzIHRoYXQgY29udHJvbHMgdXBkYXRlcyB0byBjb25uZWN0aW9ucyBkdXJpbmcgZHJhZ3MuICBJdCBpcyBwcmltYXJpbHlcbiAqIHJlc3BvbnNpYmxlIGZvciBmaW5kaW5nIHRoZSBjbG9zZXN0IGVsaWdpYmxlIGNvbm5lY3Rpb24gYW5kIGhpZ2hsaWdodGluZyBvclxuICogdW5oaWdobGlnaHRpbmcgaXQgYXMgbmVlZGVkIGR1cmluZyBhIGRyYWcuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuSW5zZXJ0aW9uTWFya2VyTWFuYWdlclxuICovXG5leHBvcnQgY2xhc3MgSW5zZXJ0aW9uTWFya2VyTWFuYWdlciB7XG4gIC8qKlxuICAgKiBUaGUgdG9wIGJsb2NrIGluIHRoZSBzdGFjayBiZWluZyBkcmFnZ2VkLlxuICAgKiBEb2VzIG5vdCBjaGFuZ2UgZHVyaW5nIGEgZHJhZy5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgdG9wQmxvY2s6IEJsb2NrU3ZnO1xuXG4gIC8qKlxuICAgKiBUaGUgd29ya3NwYWNlIG9uIHdoaWNoIHRoZXNlIGNvbm5lY3Rpb25zIGFyZSBiZWluZyBkcmFnZ2VkLlxuICAgKiBEb2VzIG5vdCBjaGFuZ2UgZHVyaW5nIGEgZHJhZy5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmc7XG5cbiAgLyoqXG4gICAqIFRoZSBsYXN0IGNvbm5lY3Rpb24gb24gdGhlIHN0YWNrLCBpZiBpdCdzIG5vdCB0aGUgbGFzdCBjb25uZWN0aW9uIG9uIHRoZVxuICAgKiBmaXJzdCBibG9jay5cbiAgICogU2V0IGluIGluaXRBdmFpbGFibGVDb25uZWN0aW9ucywgaWYgYXQgYWxsLlxuICAgKi9cbiAgcHJpdmF0ZSBsYXN0T25TdGFjazogUmVuZGVyZWRDb25uZWN0aW9ufG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgaW5zZXJ0aW9uIG1hcmtlciBjb3JyZXNwb25kaW5nIHRvIHRoZSBsYXN0IGJsb2NrIGluIHRoZSBzdGFjaywgaWZcbiAgICogdGhhdCdzIG5vdCB0aGUgc2FtZSBhcyB0aGUgZmlyc3QgYmxvY2sgaW4gdGhlIHN0YWNrLlxuICAgKiBTZXQgaW4gaW5pdEF2YWlsYWJsZUNvbm5lY3Rpb25zLCBpZiBhdCBhbGxcbiAgICovXG4gIHByaXZhdGUgbGFzdE1hcmtlcjogQmxvY2tTdmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBpbnNlcnRpb24gbWFya2VyIHRoYXQgc2hvd3MgdXAgYmV0d2VlbiBibG9ja3MgdG8gc2hvdyB3aGVyZSBhIGJsb2NrXG4gICAqIHdvdWxkIGdvIGlmIGRyb3BwZWQgaW1tZWRpYXRlbHkuXG4gICAqL1xuICBwcml2YXRlIGZpcnN0TWFya2VyOiBCbG9ja1N2ZztcblxuICAvKipcbiAgICogSW5mb3JtYXRpb24gYWJvdXQgdGhlIGNvbm5lY3Rpb24gdGhhdCB3b3VsZCBiZSBtYWRlIGlmIHRoZSBkcmFnZ2luZyBibG9ja1xuICAgKiB3ZXJlIHJlbGVhc2VkIGltbWVkaWF0ZWx5LiBVcGRhdGVkIG9uIGV2ZXJ5IG1vdXNlIG1vdmUuXG4gICAqL1xuICBwcml2YXRlIGFjdGl2ZUNhbmRpZGF0ZTogQ2FuZGlkYXRlQ29ubmVjdGlvbnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgYmxvY2sgd291bGQgYmUgZGVsZXRlZCBpZiBpdCB3ZXJlIGRyb3BwZWQgaW1tZWRpYXRlbHkuXG4gICAqIFVwZGF0ZWQgb24gZXZlcnkgbW91c2UgbW92ZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBwdWJsaWMgd291bGREZWxldGVCbG9jayA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBDb25uZWN0aW9uIG9uIHRoZSBpbnNlcnRpb24gbWFya2VyIGJsb2NrIHRoYXQgY29ycmVzcG9uZHMgdG9cbiAgICogdGhlIGFjdGl2ZSBjYW5kaWRhdGUncyBsb2NhbCBjb25uZWN0aW9uIG9uIHRoZSBjdXJyZW50bHkgZHJhZ2dlZCBibG9jay5cbiAgICovXG4gIHByaXZhdGUgbWFya2VyQ29ubmVjdGlvbjogUmVuZGVyZWRDb25uZWN0aW9ufG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgYmxvY2sgdGhhdCBjdXJyZW50bHkgaGFzIGFuIGlucHV0IGJlaW5nIGhpZ2hsaWdodGVkLCBvciBudWxsLiAqL1xuICBwcml2YXRlIGhpZ2hsaWdodGVkQmxvY2s6IEJsb2NrU3ZnfG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgYmxvY2sgYmVpbmcgZmFkZWQgdG8gaW5kaWNhdGUgcmVwbGFjZW1lbnQsIG9yIG51bGwuICovXG4gIHByaXZhdGUgZmFkZWRCbG9jazogQmxvY2tTdmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBjb25uZWN0aW9ucyBvbiB0aGUgZHJhZ2dpbmcgYmxvY2tzIHRoYXQgYXJlIGF2YWlsYWJsZSB0byBjb25uZWN0IHRvXG4gICAqIG90aGVyIGJsb2Nrcy4gIFRoaXMgaW5jbHVkZXMgYWxsIG9wZW4gY29ubmVjdGlvbnMgb24gdGhlIHRvcCBibG9jaywgYXNcbiAgICogd2VsbCBhcyB0aGUgbGFzdCBjb25uZWN0aW9uIG9uIHRoZSBibG9jayBzdGFjay5cbiAgICovXG4gIHByaXZhdGUgYXZhaWxhYmxlQ29ubmVjdGlvbnM6IFJlbmRlcmVkQ29ubmVjdGlvbltdO1xuXG4gIC8qKiBAcGFyYW0gYmxvY2sgVGhlIHRvcCBibG9jayBpbiB0aGUgc3RhY2sgYmVpbmcgZHJhZ2dlZC4gKi9cbiAgY29uc3RydWN0b3IoYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgY29tbW9uLnNldFNlbGVjdGVkKGJsb2NrKTtcbiAgICB0aGlzLnRvcEJsb2NrID0gYmxvY2s7XG5cbiAgICB0aGlzLndvcmtzcGFjZSA9IGJsb2NrLndvcmtzcGFjZTtcblxuICAgIHRoaXMuZmlyc3RNYXJrZXIgPSB0aGlzLmNyZWF0ZU1hcmtlckJsb2NrKHRoaXMudG9wQmxvY2spO1xuXG4gICAgdGhpcy5hdmFpbGFibGVDb25uZWN0aW9ucyA9IHRoaXMuaW5pdEF2YWlsYWJsZUNvbm5lY3Rpb25zKCk7XG4gIH1cblxuICAvKipcbiAgICogU2V2ZXIgYWxsIGxpbmtzIGZyb20gdGhpcyBvYmplY3QuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICB0aGlzLmF2YWlsYWJsZUNvbm5lY3Rpb25zLmxlbmd0aCA9IDA7XG5cbiAgICBldmVudFV0aWxzLmRpc2FibGUoKTtcbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMuZmlyc3RNYXJrZXIpIHtcbiAgICAgICAgdGhpcy5maXJzdE1hcmtlci5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5sYXN0TWFya2VyKSB7XG4gICAgICAgIHRoaXMubGFzdE1hcmtlci5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgYXZhaWxhYmxlIGNvbm5lY3Rpb25zIGZvciB0aGUgdG9wIGJsb2NrLiBUaGVzZSBjb25uZWN0aW9ucyBjYW5cbiAgICogY2hhbmdlIGlmIGEgYmxvY2sgaXMgdW5wbHVnZ2VkIGFuZCB0aGUgc3RhY2sgaXMgaGVhbGVkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVwZGF0ZUF2YWlsYWJsZUNvbm5lY3Rpb25zKCkge1xuICAgIHRoaXMuYXZhaWxhYmxlQ29ubmVjdGlvbnMgPSB0aGlzLmluaXRBdmFpbGFibGVDb25uZWN0aW9ucygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB3aGV0aGVyIHRoZSBibG9jayB3b3VsZCBiZSBjb25uZWN0ZWQgaWYgZHJvcHBlZCBpbW1lZGlhdGVseSwgYmFzZWRcbiAgICogb24gaW5mb3JtYXRpb24gZnJvbSB0aGUgbW9zdCByZWNlbnQgbW92ZSBldmVudC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgYmxvY2sgd291bGQgYmUgY29ubmVjdGVkIGlmIGRyb3BwZWQgaW1tZWRpYXRlbHkuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgd291bGRDb25uZWN0QmxvY2soKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5hY3RpdmVDYW5kaWRhdGU7XG4gIH1cblxuICAvKipcbiAgICogQ29ubmVjdCB0byB0aGUgY2xvc2VzdCBjb25uZWN0aW9uIGFuZCByZW5kZXIgdGhlIHJlc3VsdHMuXG4gICAqIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGEgZHJhZy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBhcHBseUNvbm5lY3Rpb25zKCkge1xuICAgIGlmICghdGhpcy5hY3RpdmVDYW5kaWRhdGUpIHJldHVybjtcbiAgICAvLyBEb24ndCBmaXJlIGV2ZW50cyBmb3IgaW5zZXJ0aW9uIG1hcmtlcnMuXG4gICAgZXZlbnRVdGlscy5kaXNhYmxlKCk7XG4gICAgdGhpcy5oaWRlUHJldmlldygpO1xuICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgY29uc3Qge2xvY2FsLCBjbG9zZXN0fSA9IHRoaXMuYWN0aXZlQ2FuZGlkYXRlO1xuICAgIC8vIENvbm5lY3QgdHdvIGJsb2NrcyB0b2dldGhlci5cbiAgICBsb2NhbC5jb25uZWN0KGNsb3Nlc3QpO1xuICAgIGlmICh0aGlzLnRvcEJsb2NrLnJlbmRlcmVkKSB7XG4gICAgICAvLyBUcmlnZ2VyIGEgY29ubmVjdGlvbiBhbmltYXRpb24uXG4gICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY29ubmVjdGlvbiBpcyBpbmZlcmlvciAobG93ZXIgaW4gdGhlIHNvdXJjZSBzdGFjaykuXG4gICAgICBjb25zdCBpbmZlcmlvckNvbm5lY3Rpb24gPSBsb2NhbC5pc1N1cGVyaW9yKCkgPyBjbG9zZXN0IDogbG9jYWw7XG4gICAgICBibG9ja0FuaW1hdGlvbnMuY29ubmVjdGlvblVpRWZmZWN0KGluZmVyaW9yQ29ubmVjdGlvbi5nZXRTb3VyY2VCbG9jaygpKTtcbiAgICAgIC8vIEJyaW5nIHRoZSBqdXN0LWVkaXRlZCBzdGFjayB0byB0aGUgZnJvbnQuXG4gICAgICBjb25zdCByb290QmxvY2sgPSB0aGlzLnRvcEJsb2NrLmdldFJvb3RCbG9jaygpO1xuICAgICAgcm9vdEJsb2NrLmJyaW5nVG9Gcm9udCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29ubmVjdGlvbnMgYmFzZWQgb24gdGhlIG1vc3QgcmVjZW50IG1vdmUgbG9jYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSBkeHkgUG9zaXRpb24gcmVsYXRpdmUgdG8gZHJhZyBzdGFydCwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcGFyYW0gZHJhZ1RhcmdldCBUaGUgZHJhZyB0YXJnZXQgdGhhdCB0aGUgYmxvY2sgaXMgY3VycmVudGx5IG92ZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgdXBkYXRlKGR4eTogQ29vcmRpbmF0ZSwgZHJhZ1RhcmdldDogSURyYWdUYXJnZXR8bnVsbCkge1xuICAgIGNvbnN0IG5ld0NhbmRpZGF0ZSA9IHRoaXMuZ2V0Q2FuZGlkYXRlKGR4eSk7XG5cbiAgICB0aGlzLndvdWxkRGVsZXRlQmxvY2sgPSB0aGlzLnNob3VsZERlbGV0ZSghIW5ld0NhbmRpZGF0ZSwgZHJhZ1RhcmdldCk7XG5cbiAgICBjb25zdCBzaG91bGRVcGRhdGUgPVxuICAgICAgICB0aGlzLndvdWxkRGVsZXRlQmxvY2sgfHwgdGhpcy5zaG91bGRVcGRhdGVQcmV2aWV3cyhuZXdDYW5kaWRhdGUsIGR4eSk7XG5cbiAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XG4gICAgICAvLyBEb24ndCBmaXJlIGV2ZW50cyBmb3IgaW5zZXJ0aW9uIG1hcmtlciBjcmVhdGlvbiBvciBtb3ZlbWVudC5cbiAgICAgIGV2ZW50VXRpbHMuZGlzYWJsZSgpO1xuICAgICAgdGhpcy5tYXliZUhpZGVQcmV2aWV3KG5ld0NhbmRpZGF0ZSk7XG4gICAgICB0aGlzLm1heWJlU2hvd1ByZXZpZXcobmV3Q2FuZGlkYXRlKTtcbiAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbiBpbnNlcnRpb24gbWFya2VyIHRoYXQgcmVwcmVzZW50cyB0aGUgZ2l2ZW4gYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBzb3VyY2VCbG9jayBUaGUgYmxvY2sgdGhhdCB0aGUgaW5zZXJ0aW9uIG1hcmtlciB3aWxsIHJlcHJlc2VudC5cbiAgICogQHJldHVybnMgVGhlIGluc2VydGlvbiBtYXJrZXIgdGhhdCByZXByZXNlbnRzIHRoZSBnaXZlbiBibG9jay5cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlTWFya2VyQmxvY2soc291cmNlQmxvY2s6IEJsb2NrU3ZnKTogQmxvY2tTdmcge1xuICAgIGNvbnN0IGltVHlwZSA9IHNvdXJjZUJsb2NrLnR5cGU7XG5cbiAgICBldmVudFV0aWxzLmRpc2FibGUoKTtcbiAgICBsZXQgcmVzdWx0OiBCbG9ja1N2ZztcbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gdGhpcy53b3Jrc3BhY2UubmV3QmxvY2soaW1UeXBlKTtcbiAgICAgIHJlc3VsdC5zZXRJbnNlcnRpb25NYXJrZXIodHJ1ZSk7XG4gICAgICBpZiAoc291cmNlQmxvY2suc2F2ZUV4dHJhU3RhdGUpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSBzb3VyY2VCbG9jay5zYXZlRXh0cmFTdGF0ZSgpO1xuICAgICAgICBpZiAoc3RhdGUgJiYgcmVzdWx0LmxvYWRFeHRyYVN0YXRlKSB7XG4gICAgICAgICAgcmVzdWx0LmxvYWRFeHRyYVN0YXRlKHN0YXRlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzb3VyY2VCbG9jay5tdXRhdGlvblRvRG9tKSB7XG4gICAgICAgIGNvbnN0IG9sZE11dGF0aW9uRG9tID0gc291cmNlQmxvY2subXV0YXRpb25Ub0RvbSgpO1xuICAgICAgICBpZiAob2xkTXV0YXRpb25Eb20gJiYgcmVzdWx0LmRvbVRvTXV0YXRpb24pIHtcbiAgICAgICAgICByZXN1bHQuZG9tVG9NdXRhdGlvbihvbGRNdXRhdGlvbkRvbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIENvcHkgZmllbGQgdmFsdWVzIGZyb20gdGhlIG90aGVyIGJsb2NrLiAgVGhlc2UgdmFsdWVzIG1heSBpbXBhY3QgdGhlXG4gICAgICAvLyByZW5kZXJlZCBzaXplIG9mIHRoZSBpbnNlcnRpb24gbWFya2VyLiAgTm90ZSB0aGF0IHdlIGRvIG5vdCBjYXJlIGFib3V0XG4gICAgICAvLyBjaGlsZCBibG9ja3MgaGVyZS5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlQmxvY2suaW5wdXRMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZUlucHV0ID0gc291cmNlQmxvY2suaW5wdXRMaXN0W2ldO1xuICAgICAgICBpZiAoc291cmNlSW5wdXQubmFtZSA9PT0gY29uc3RhbnRzLkNPTExBUFNFRF9JTlBVVF9OQU1FKSB7XG4gICAgICAgICAgY29udGludWU7ICAvLyBJZ25vcmUgdGhlIGNvbGxhcHNlZCBpbnB1dC5cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXN1bHRJbnB1dCA9IHJlc3VsdC5pbnB1dExpc3RbaV07XG4gICAgICAgIGlmICghcmVzdWx0SW5wdXQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoRFVQTElDQVRFX0JMT0NLX0VSUk9SLnJlcGxhY2UoJyUxJywgJ2FuIGlucHV0JykpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc291cmNlSW5wdXQuZmllbGRSb3cubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBjb25zdCBzb3VyY2VGaWVsZCA9IHNvdXJjZUlucHV0LmZpZWxkUm93W2pdO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdEZpZWxkID0gcmVzdWx0SW5wdXQuZmllbGRSb3dbal07XG4gICAgICAgICAgaWYgKCFyZXN1bHRGaWVsZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKERVUExJQ0FURV9CTE9DS19FUlJPUi5yZXBsYWNlKCclMScsICdhIGZpZWxkJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHRGaWVsZC5zZXRWYWx1ZShzb3VyY2VGaWVsZC5nZXRWYWx1ZSgpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXN1bHQuc2V0Q29sbGFwc2VkKHNvdXJjZUJsb2NrLmlzQ29sbGFwc2VkKCkpO1xuICAgICAgcmVzdWx0LnNldElucHV0c0lubGluZShzb3VyY2VCbG9jay5nZXRJbnB1dHNJbmxpbmUoKSk7XG5cbiAgICAgIHJlc3VsdC5pbml0U3ZnKCk7XG4gICAgICByZXN1bHQuZ2V0U3ZnUm9vdCgpLnNldEF0dHJpYnV0ZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgZXZlbnRVdGlscy5lbmFibGUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFBvcHVsYXRlIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBjb25uZWN0aW9ucyBvbiB0aGlzIGJsb2NrIHN0YWNrLiAgVGhpc1xuICAgKiBzaG91bGQgb25seSBiZSBjYWxsZWQgb25jZSwgYXQgdGhlIGJlZ2lubmluZyBvZiBhIGRyYWcuIElmIHRoZSBzdGFjayBoYXNcbiAgICogbW9yZSB0aGFuIG9uZSBibG9jaywgdGhpcyBmdW5jdGlvbiB3aWxsIHBvcHVsYXRlIGxhc3RPblN0YWNrIGFuZCBjcmVhdGVcbiAgICogdGhlIGNvcnJlc3BvbmRpbmcgaW5zZXJ0aW9uIG1hcmtlci5cbiAgICpcbiAgICogQHJldHVybnMgQSBsaXN0IG9mIGF2YWlsYWJsZSBjb25uZWN0aW9ucy5cbiAgICovXG4gIHByaXZhdGUgaW5pdEF2YWlsYWJsZUNvbm5lY3Rpb25zKCk6IFJlbmRlcmVkQ29ubmVjdGlvbltdIHtcbiAgICBjb25zdCBhdmFpbGFibGUgPSB0aGlzLnRvcEJsb2NrLmdldENvbm5lY3Rpb25zXyhmYWxzZSk7XG4gICAgLy8gQWxzbyBjaGVjayB0aGUgbGFzdCBjb25uZWN0aW9uIG9uIHRoaXMgc3RhY2tcbiAgICBjb25zdCBsYXN0T25TdGFjayA9IHRoaXMudG9wQmxvY2subGFzdENvbm5lY3Rpb25JblN0YWNrKHRydWUpO1xuICAgIGlmIChsYXN0T25TdGFjayAmJiBsYXN0T25TdGFjayAhPT0gdGhpcy50b3BCbG9jay5uZXh0Q29ubmVjdGlvbikge1xuICAgICAgYXZhaWxhYmxlLnB1c2gobGFzdE9uU3RhY2spO1xuICAgICAgdGhpcy5sYXN0T25TdGFjayA9IGxhc3RPblN0YWNrO1xuICAgICAgaWYgKHRoaXMubGFzdE1hcmtlcikge1xuICAgICAgICBldmVudFV0aWxzLmRpc2FibGUoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLmxhc3RNYXJrZXIuZGlzcG9zZSgpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGV2ZW50VXRpbHMuZW5hYmxlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMubGFzdE1hcmtlciA9IHRoaXMuY3JlYXRlTWFya2VyQmxvY2sobGFzdE9uU3RhY2suZ2V0U291cmNlQmxvY2soKSk7XG4gICAgfVxuICAgIHJldHVybiBhdmFpbGFibGU7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGUgcHJldmlld3MgKGluc2VydGlvbiBtYXJrZXIgYW5kIHJlcGxhY2VtZW50IG1hcmtlcikgc2hvdWxkIGJlXG4gICAqIHVwZGF0ZWQgYmFzZWQgb24gdGhlIGNsb3Nlc3QgY2FuZGlkYXRlIGFuZCB0aGUgY3VycmVudCBkcmFnIGRpc3RhbmNlLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3Q2FuZGlkYXRlIEEgbmV3IGNhbmRpZGF0ZSBjb25uZWN0aW9uIHRoYXQgbWF5IHJlcGxhY2UgdGhlIGN1cnJlbnRcbiAgICogICAgIGJlc3QgY2FuZGlkYXRlLlxuICAgKiBAcGFyYW0gZHh5IFBvc2l0aW9uIHJlbGF0aXZlIHRvIGRyYWcgc3RhcnQsIGluIHdvcmtzcGFjZSB1bml0cy5cbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgcHJldmlldyBzaG91bGQgYmUgdXBkYXRlZC5cbiAgICovXG4gIHByaXZhdGUgc2hvdWxkVXBkYXRlUHJldmlld3MoXG4gICAgICBuZXdDYW5kaWRhdGU6IENhbmRpZGF0ZUNvbm5lY3Rpb258bnVsbCwgZHh5OiBDb29yZGluYXRlKTogYm9vbGVhbiB7XG4gICAgLy8gT25seSBuZWVkIHRvIHVwZGF0ZSBpZiB3ZSB3ZXJlIHNob3dpbmcgYSBwcmV2aWV3IGJlZm9yZS5cbiAgICBpZiAoIW5ld0NhbmRpZGF0ZSkgcmV0dXJuICEhdGhpcy5hY3RpdmVDYW5kaWRhdGU7XG5cbiAgICAvLyBXZSB3ZXJlbid0IHNob3dpbmcgYSBwcmV2aWV3IGJlZm9yZSwgYnV0IHdlIHNob3VsZCBub3cuXG4gICAgaWYgKCF0aGlzLmFjdGl2ZUNhbmRpZGF0ZSkgcmV0dXJuIHRydWU7XG5cbiAgICAvLyBXZSdyZSBhbHJlYWR5IHNob3dpbmcgYW4gaW5zZXJ0aW9uIG1hcmtlci5cbiAgICAvLyBEZWNpZGUgd2hldGhlciB0aGUgbmV3IGNvbm5lY3Rpb24gaGFzIGhpZ2hlciBwcmlvcml0eS5cbiAgICBjb25zdCB7bG9jYWw6IGFjdGl2ZUxvY2FsLCBjbG9zZXN0OiBhY3RpdmVDbG9zZXN0fSA9IHRoaXMuYWN0aXZlQ2FuZGlkYXRlO1xuICAgIGlmIChhY3RpdmVDbG9zZXN0ID09PSBuZXdDYW5kaWRhdGUuY2xvc2VzdCAmJlxuICAgICAgICBhY3RpdmVMb2NhbCA9PT0gbmV3Q2FuZGlkYXRlLmxvY2FsKSB7XG4gICAgICAvLyBUaGUgY29ubmVjdGlvbiB3YXMgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgY29ubmVjdGlvbi5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCB4RGlmZiA9IGFjdGl2ZUxvY2FsLnggKyBkeHkueCAtIGFjdGl2ZUNsb3Nlc3QueDtcbiAgICBjb25zdCB5RGlmZiA9IGFjdGl2ZUxvY2FsLnkgKyBkeHkueSAtIGFjdGl2ZUNsb3Nlc3QueTtcbiAgICBjb25zdCBjdXJEaXN0YW5jZSA9IE1hdGguc3FydCh4RGlmZiAqIHhEaWZmICsgeURpZmYgKiB5RGlmZik7XG4gICAgLy8gU2xpZ2h0bHkgcHJlZmVyIHRoZSBleGlzdGluZyBwcmV2aWV3IG92ZXIgYSBuZXcgcHJldmlldy5cbiAgICByZXR1cm4gKFxuICAgICAgICBuZXdDYW5kaWRhdGUucmFkaXVzIDwgY3VyRGlzdGFuY2UgLSBjb25maWcuY3VycmVudENvbm5lY3Rpb25QcmVmZXJlbmNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHRoZSBuZWFyZXN0IHZhbGlkIGNvbm5lY3Rpb24sIHdoaWNoIG1heSBiZSB0aGUgc2FtZSBhcyB0aGUgY3VycmVudFxuICAgKiBjbG9zZXN0IGNvbm5lY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBkeHkgUG9zaXRpb24gcmVsYXRpdmUgdG8gZHJhZyBzdGFydCwgaW4gd29ya3NwYWNlIHVuaXRzLlxuICAgKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyBhIGxvY2FsIGNvbm5lY3Rpb24sIGEgY2xvc2VzdCBjb25uZWN0aW9uLCBhbmRcbiAgICogICAgIGEgcmFkaXVzLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRDYW5kaWRhdGUoZHh5OiBDb29yZGluYXRlKTogQ2FuZGlkYXRlQ29ubmVjdGlvbnxudWxsIHtcbiAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgYSBibG9jayBoYXMgYWRkZWQgb3IgcmVtb3ZlZCBjb25uZWN0aW9ucyBkdXJpbmcgYVxuICAgIC8vIGRyYWcsIChlLmcuIGluIGEgZHJhZy9tb3ZlIGV2ZW50IGhhbmRsZXIpLCBzbyBsZXQncyB1cGRhdGUgdGhlIGF2YWlsYWJsZVxuICAgIC8vIGNvbm5lY3Rpb25zLiBOb3RlIHRoYXQgdGhpcyB3aWxsIGJlIGNhbGxlZCBvbiBldmVyeSBtb3ZlIHdoaWxlIGRyYWdnaW5nLFxuICAgIC8vIHNvIGl0IG1pZ2h0IGNhdXNlIHNsb3duZXNzLCBlc3BlY2lhbGx5IGlmIHRoZSBibG9jayBzdGFjayBpcyBsYXJnZS4gIElmXG4gICAgLy8gc28sIG1heWJlIGl0IGNvdWxkIGJlIG1hZGUgbW9yZSBlZmZpY2llbnQuIEFsc28gbm90ZSB0aGF0IHdlIHdvbid0IHVwZGF0ZVxuICAgIC8vIHRoZSBjb25uZWN0aW9ucyBpZiB3ZSd2ZSBhbHJlYWR5IGNvbm5lY3RlZCB0aGUgaW5zZXJ0aW9uIG1hcmtlciB0byBhXG4gICAgLy8gYmxvY2suXG4gICAgaWYgKCF0aGlzLm1hcmtlckNvbm5lY3Rpb24gfHwgIXRoaXMubWFya2VyQ29ubmVjdGlvbi5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICB0aGlzLnVwZGF0ZUF2YWlsYWJsZUNvbm5lY3Rpb25zKCk7XG4gICAgfVxuXG4gICAgbGV0IHJhZGl1cyA9IHRoaXMuZ2V0U3RhcnRSYWRpdXMoKTtcbiAgICBsZXQgY2FuZGlkYXRlID0gbnVsbDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYXZhaWxhYmxlQ29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG15Q29ubmVjdGlvbiA9IHRoaXMuYXZhaWxhYmxlQ29ubmVjdGlvbnNbaV07XG4gICAgICBjb25zdCBuZWlnaGJvdXIgPSBteUNvbm5lY3Rpb24uY2xvc2VzdChyYWRpdXMsIGR4eSk7XG4gICAgICBpZiAobmVpZ2hib3VyLmNvbm5lY3Rpb24pIHtcbiAgICAgICAgY2FuZGlkYXRlID0ge1xuICAgICAgICAgIGNsb3Nlc3Q6IG5laWdoYm91ci5jb25uZWN0aW9uLFxuICAgICAgICAgIGxvY2FsOiBteUNvbm5lY3Rpb24sXG4gICAgICAgICAgcmFkaXVzOiBuZWlnaGJvdXIucmFkaXVzLFxuICAgICAgICB9O1xuICAgICAgICByYWRpdXMgPSBuZWlnaGJvdXIucmFkaXVzO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2FuZGlkYXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY2lkZSB0aGUgcmFkaXVzIGF0IHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZyBmb3IgdGhlIGNsb3Nlc3QgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHJhZGl1cyBhdCB3aGljaCB0byBzdGFydCB0aGUgc2VhcmNoIGZvciB0aGUgY2xvc2VzdFxuICAgKiAgICAgY29ubmVjdGlvbi5cbiAgICovXG4gIHByaXZhdGUgZ2V0U3RhcnRSYWRpdXMoKTogbnVtYmVyIHtcbiAgICAvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IGEgY29ubmVjdGlvbiBoaWdobGlnaHRlZCxcbiAgICAvLyBpbmNyZWFzZSB0aGUgcmFkaXVzIHdlIGNoZWNrIGZvciBtYWtpbmcgbmV3IGNvbm5lY3Rpb25zLlxuICAgIC8vIFdoZW4gYSBjb25uZWN0aW9uIGlzIGhpZ2hsaWdodGVkLCBibG9ja3MgbW92ZSBhcm91bmQgd2hlbiB0aGVcbiAgICAvLyBpbnNlcnRpb24gbWFya2VyIGlzIGNyZWF0ZWQsIHdoaWNoIGNvdWxkIGNhdXNlIHRoZSBjb25uZWN0aW9uIGJlY2FtZSBvdXRcbiAgICAvLyBvZiByYW5nZS4gQnkgaW5jcmVhc2luZyByYWRpdXNDb25uZWN0aW9uIHdoZW4gYSBjb25uZWN0aW9uIGFscmVhZHlcbiAgICAvLyBleGlzdHMsIHdlIG5ldmVyIFwibG9zZVwiIHRoZSBjb25uZWN0aW9uIGZyb20gdGhlIG9mZnNldC5cbiAgICByZXR1cm4gdGhpcy5hY3RpdmVDYW5kaWRhdGUgPyBjb25maWcuY29ubmVjdGluZ1NuYXBSYWRpdXMgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5zbmFwUmFkaXVzO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgZW5kaW5nIHRoZSBkcmFnIHdvdWxkIGRlbGV0ZSB0aGUgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBuZXdDYW5kaWRhdGUgV2hldGhlciB0aGVyZSBpcyBhIGNhbmRpZGF0ZSBjb25uZWN0aW9uIHRoYXQgdGhlXG4gICAqICAgICBibG9jayBjb3VsZCBjb25uZWN0IHRvIGlmIHRoZSBkcmFnIGVuZGVkIGltbWVkaWF0ZWx5LlxuICAgKiBAcGFyYW0gZHJhZ1RhcmdldCBUaGUgZHJhZyB0YXJnZXQgdGhhdCB0aGUgYmxvY2sgaXMgY3VycmVudGx5IG92ZXIuXG4gICAqIEByZXR1cm5zIFdoZXRoZXIgZHJvcHBpbmcgdGhlIGJsb2NrIGltbWVkaWF0ZWx5IHdvdWxkIGRlbGV0ZSB0aGUgYmxvY2suXG4gICAqL1xuICBwcml2YXRlIHNob3VsZERlbGV0ZShuZXdDYW5kaWRhdGU6IGJvb2xlYW4sIGRyYWdUYXJnZXQ6IElEcmFnVGFyZ2V0fG51bGwpOlxuICAgICAgYm9vbGVhbiB7XG4gICAgaWYgKGRyYWdUYXJnZXQpIHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudE1hbmFnZXIgPSB0aGlzLndvcmtzcGFjZS5nZXRDb21wb25lbnRNYW5hZ2VyKCk7XG4gICAgICBjb25zdCBpc0RlbGV0ZUFyZWEgPSBjb21wb25lbnRNYW5hZ2VyLmhhc0NhcGFiaWxpdHkoXG4gICAgICAgICAgZHJhZ1RhcmdldC5pZCwgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkRFTEVURV9BUkVBKTtcbiAgICAgIGlmIChpc0RlbGV0ZUFyZWEpIHtcbiAgICAgICAgcmV0dXJuIChkcmFnVGFyZ2V0IGFzIElEZWxldGVBcmVhKVxuICAgICAgICAgICAgLndvdWxkRGVsZXRlKHRoaXMudG9wQmxvY2ssIG5ld0NhbmRpZGF0ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGFuIGluc2VydGlvbiBtYXJrZXIgb3IgcmVwbGFjZW1lbnQgaGlnaGxpZ2h0aW5nIGR1cmluZyBhIGRyYWcsIGlmXG4gICAqIG5lZWRlZC5cbiAgICogQXQgdGhlIGJlZ2lubmluZyBvZiB0aGlzIGZ1bmN0aW9uLCB0aGlzLmFjdGl2ZUNvbm5lY3Rpb24gc2hvdWxkIGJlIG51bGwuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdDYW5kaWRhdGUgQSBuZXcgY2FuZGlkYXRlIGNvbm5lY3Rpb24gdGhhdCBtYXkgcmVwbGFjZSB0aGUgY3VycmVudFxuICAgKiAgICAgYmVzdCBjYW5kaWRhdGUuXG4gICAqL1xuICBwcml2YXRlIG1heWJlU2hvd1ByZXZpZXcobmV3Q2FuZGlkYXRlOiBDYW5kaWRhdGVDb25uZWN0aW9ufG51bGwpIHtcbiAgICBpZiAodGhpcy53b3VsZERlbGV0ZUJsb2NrKSByZXR1cm47ICAvLyBOb3BlLCBkb24ndCBhZGQgYSBtYXJrZXIuXG4gICAgaWYgKCFuZXdDYW5kaWRhdGUpIHJldHVybjsgICAgICAgICAgLy8gTm90aGluZyB0byBjb25uZWN0IHRvLlxuXG4gICAgY29uc3QgY2xvc2VzdCA9IG5ld0NhbmRpZGF0ZS5jbG9zZXN0O1xuXG4gICAgLy8gU29tZXRoaW5nIHdlbnQgd3JvbmcgYW5kIHdlJ3JlIHRyeWluZyB0byBjb25uZWN0IHRvIGFuIGludmFsaWRcbiAgICAvLyBjb25uZWN0aW9uLlxuICAgIGlmIChjbG9zZXN0ID09PSB0aGlzLmFjdGl2ZUNhbmRpZGF0ZT8uY2xvc2VzdCB8fFxuICAgICAgICBjbG9zZXN0LmdldFNvdXJjZUJsb2NrKCkuaXNJbnNlcnRpb25NYXJrZXIoKSkge1xuICAgICAgY29uc29sZS5sb2coJ1RyeWluZyB0byBjb25uZWN0IHRvIGFuIGluc2VydGlvbiBtYXJrZXInKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5hY3RpdmVDYW5kaWRhdGUgPSBuZXdDYW5kaWRhdGU7XG4gICAgLy8gQWRkIGFuIGluc2VydGlvbiBtYXJrZXIgb3IgcmVwbGFjZW1lbnQgbWFya2VyLlxuICAgIHRoaXMuc2hvd1ByZXZpZXcodGhpcy5hY3RpdmVDYW5kaWRhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgcHJldmlldyBzaG91bGQgYmUgc2hvd24uICBUaGlzIGZ1bmN0aW9uIGZpZ3VyZXMgb3V0IGlmIGl0IHNob3VsZCBiZSBhXG4gICAqIGJsb2NrIGhpZ2hsaWdodCBvciBhbiBpbnNlcnRpb24gbWFya2VyLCBhbmQgc2hvd3MgdGhlIGFwcHJvcHJpYXRlIG9uZS5cbiAgICpcbiAgICogQHBhcmFtIGFjdGl2ZUNhbmRpZGF0ZSBUaGUgY29ubmVjdGlvbiB0aGF0IHdpbGwgYmUgbWFkZSBpZiB0aGUgZHJhZyBlbmRzXG4gICAqICAgICBpbW1lZGlhdGVseS5cbiAgICovXG4gIHByaXZhdGUgc2hvd1ByZXZpZXcoYWN0aXZlQ2FuZGlkYXRlOiBDYW5kaWRhdGVDb25uZWN0aW9uKSB7XG4gICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLndvcmtzcGFjZS5nZXRSZW5kZXJlcigpO1xuICAgIGNvbnN0IG1ldGhvZCA9IHJlbmRlcmVyLmdldENvbm5lY3Rpb25QcmV2aWV3TWV0aG9kKFxuICAgICAgICBhY3RpdmVDYW5kaWRhdGUuY2xvc2VzdCwgYWN0aXZlQ2FuZGlkYXRlLmxvY2FsLCB0aGlzLnRvcEJsb2NrKTtcblxuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICBjYXNlIEluc2VydGlvbk1hcmtlck1hbmFnZXIuUFJFVklFV19UWVBFLklOUFVUX09VVExJTkU6XG4gICAgICAgIHRoaXMuc2hvd0luc2VydGlvbklucHV0T3V0bGluZShhY3RpdmVDYW5kaWRhdGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgSW5zZXJ0aW9uTWFya2VyTWFuYWdlci5QUkVWSUVXX1RZUEUuSU5TRVJUSU9OX01BUktFUjpcbiAgICAgICAgdGhpcy5zaG93SW5zZXJ0aW9uTWFya2VyKGFjdGl2ZUNhbmRpZGF0ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyLlBSRVZJRVdfVFlQRS5SRVBMQUNFTUVOVF9GQURFOlxuICAgICAgICB0aGlzLnNob3dSZXBsYWNlbWVudEZhZGUoYWN0aXZlQ2FuZGlkYXRlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gT3B0aW9uYWxseSBoaWdobGlnaHQgdGhlIGFjdHVhbCBjb25uZWN0aW9uLCBhcyBhIG5vZCB0byBwcmV2aW91c1xuICAgIC8vIGJlaGF2aW91ci5cbiAgICBpZiAocmVuZGVyZXIuc2hvdWxkSGlnaGxpZ2h0Q29ubmVjdGlvbihhY3RpdmVDYW5kaWRhdGUuY2xvc2VzdCkpIHtcbiAgICAgIGFjdGl2ZUNhbmRpZGF0ZS5jbG9zZXN0LmhpZ2hsaWdodCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIGFuIGluc2VydGlvbiBtYXJrZXIgb3IgcmVwbGFjZW1lbnQgaGlnaGxpZ2h0aW5nIGR1cmluZyBhIGRyYWcsIGlmXG4gICAqIG5lZWRlZC5cbiAgICogQXQgdGhlIGVuZCBvZiB0aGlzIGZ1bmN0aW9uLCB0aGlzLmFjdGl2ZUNhbmRpZGF0ZSB3aWxsIGJlIG51bGwuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdDYW5kaWRhdGUgQSBuZXcgY2FuZGlkYXRlIGNvbm5lY3Rpb24gdGhhdCBtYXkgcmVwbGFjZSB0aGUgY3VycmVudFxuICAgKiAgICAgYmVzdCBjYW5kaWRhdGUuXG4gICAqL1xuICBwcml2YXRlIG1heWJlSGlkZVByZXZpZXcobmV3Q2FuZGlkYXRlOiBDYW5kaWRhdGVDb25uZWN0aW9ufG51bGwpIHtcbiAgICAvLyBJZiB0aGVyZSdzIG5vIG5ldyBwcmV2aWV3LCByZW1vdmUgdGhlIG9sZCBvbmUgYnV0IGRvbid0IGJvdGhlciBkZWxldGluZ1xuICAgIC8vIGl0LiBXZSBtaWdodCBuZWVkIGl0IGxhdGVyLCBhbmQgdGhpcyBzYXZlcyBkaXNwb3Npbmcgb2YgaXQgYW5kIHJlY3JlYXRpbmdcbiAgICAvLyBpdC5cbiAgICBpZiAoIW5ld0NhbmRpZGF0ZSkge1xuICAgICAgdGhpcy5oaWRlUHJldmlldygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5hY3RpdmVDYW5kaWRhdGUpIHtcbiAgICAgICAgY29uc3QgY2xvc2VzdENoYW5nZWQgPVxuICAgICAgICAgICAgdGhpcy5hY3RpdmVDYW5kaWRhdGUuY2xvc2VzdCAhPT0gbmV3Q2FuZGlkYXRlLmNsb3Nlc3Q7XG4gICAgICAgIGNvbnN0IGxvY2FsQ2hhbmdlZCA9IHRoaXMuYWN0aXZlQ2FuZGlkYXRlLmxvY2FsICE9PSBuZXdDYW5kaWRhdGUubG9jYWw7XG5cbiAgICAgICAgLy8gSWYgdGhlcmUncyBhIG5ldyBwcmV2aWV3IGFuZCB0aGVyZSB3YXMgYSBwcmV2aWV3IGJlZm9yZSwgYW5kIGVpdGhlclxuICAgICAgICAvLyBjb25uZWN0aW9uIGhhcyBjaGFuZ2VkLCByZW1vdmUgdGhlIG9sZCBwcmV2aWV3LlxuICAgICAgICAvLyBBbHNvIGhpZGUgaWYgd2UgaGFkIGEgcHJldmlldyBiZWZvcmUgYnV0IG5vdyB3ZSdyZSBnb2luZyB0byBkZWxldGVcbiAgICAgICAgLy8gaW5zdGVhZC5cbiAgICAgICAgaWYgKChjbG9zZXN0Q2hhbmdlZCB8fCBsb2NhbENoYW5nZWQgfHwgdGhpcy53b3VsZERlbGV0ZUJsb2NrKSkge1xuICAgICAgICAgIHRoaXMuaGlkZVByZXZpZXcoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEVpdGhlciB3YXksIGNsZWFyIG91dCBvbGQgc3RhdGUuXG4gICAgdGhpcy5tYXJrZXJDb25uZWN0aW9uID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZUNhbmRpZGF0ZSA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQSBwcmV2aWV3IHNob3VsZCBiZSBoaWRkZW4uIExvb3AgdGhyb3VnaCBhbGwgcG9zc2libGUgcHJldmlldyBtb2Rlc1xuICAgKiBhbmQgaGlkZSBldmVyeXRoaW5nLlxuICAgKi9cbiAgcHJpdmF0ZSBoaWRlUHJldmlldygpIHtcbiAgICBjb25zdCBjbG9zZXN0ID0gdGhpcy5hY3RpdmVDYW5kaWRhdGU/LmNsb3Nlc3Q7XG4gICAgaWYgKGNsb3Nlc3QgJiYgY2xvc2VzdC50YXJnZXRCbG9jaygpICYmXG4gICAgICAgIHRoaXMud29ya3NwYWNlLmdldFJlbmRlcmVyKCkuc2hvdWxkSGlnaGxpZ2h0Q29ubmVjdGlvbihjbG9zZXN0KSkge1xuICAgICAgY2xvc2VzdC51bmhpZ2hsaWdodCgpO1xuICAgIH1cbiAgICB0aGlzLmhpZGVSZXBsYWNlbWVudEZhZGUoKTtcbiAgICB0aGlzLmhpZGVJbnNlcnRpb25JbnB1dE91dGxpbmUoKTtcbiAgICB0aGlzLmhpZGVJbnNlcnRpb25NYXJrZXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93cyBhbiBpbnNlcnRpb24gbWFya2VyIGNvbm5lY3RlZCB0byB0aGUgYXBwcm9wcmlhdGUgYmxvY2tzIChiYXNlZCBvblxuICAgKiBtYW5hZ2VyIHN0YXRlKS5cbiAgICpcbiAgICogQHBhcmFtIGFjdGl2ZUNhbmRpZGF0ZSBUaGUgY29ubmVjdGlvbiB0aGF0IHdpbGwgYmUgbWFkZSBpZiB0aGUgZHJhZyBlbmRzXG4gICAqICAgICBpbW1lZGlhdGVseS5cbiAgICovXG4gIHByaXZhdGUgc2hvd0luc2VydGlvbk1hcmtlcihhY3RpdmVDYW5kaWRhdGU6IENhbmRpZGF0ZUNvbm5lY3Rpb24pIHtcbiAgICBjb25zdCB7bG9jYWwsIGNsb3Nlc3R9ID0gYWN0aXZlQ2FuZGlkYXRlO1xuXG4gICAgY29uc3QgaXNMYXN0SW5TdGFjayA9IHRoaXMubGFzdE9uU3RhY2sgJiYgbG9jYWwgPT09IHRoaXMubGFzdE9uU3RhY2s7XG4gICAgbGV0IGluc2VydGlvbk1hcmtlciA9IGlzTGFzdEluU3RhY2sgPyB0aGlzLmxhc3RNYXJrZXIgOiB0aGlzLmZpcnN0TWFya2VyO1xuICAgIGlmICghaW5zZXJ0aW9uTWFya2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBzaG93IHRoZSBpbnNlcnRpb24gbWFya2VyIGJlY2F1c2UgdGhlcmUgaXMgbm8gaW5zZXJ0aW9uICcgK1xuICAgICAgICAgICdtYXJrZXIgYmxvY2snKTtcbiAgICB9XG4gICAgbGV0IGltQ29ubjtcbiAgICB0cnkge1xuICAgICAgaW1Db25uID1cbiAgICAgICAgICBpbnNlcnRpb25NYXJrZXIuZ2V0TWF0Y2hpbmdDb25uZWN0aW9uKGxvY2FsLmdldFNvdXJjZUJsb2NrKCksIGxvY2FsKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgdGhlIG51bWJlciBvZiBjb25uZWN0aW9ucyBvbiB0aGUgbG9jYWwgYmxvY2sgaGFzXG4gICAgICAvLyBjaGFuZ2VkIHNpbmNlIHRoZSBpbnNlcnRpb24gbWFya2VyIHdhcyBvcmlnaW5hbGx5IGNyZWF0ZWQuICBMZXQnc1xuICAgICAgLy8gcmVjcmVhdGUgdGhlIGluc2VydGlvbiBtYXJrZXIgYW5kIHRyeSBhZ2Fpbi4gSW4gdGhlb3J5IHdlIGNvdWxkXG4gICAgICAvLyBwcm9iYWJseSByZWNyZWF0ZSB0aGUgbWFya2VyIGJsb2NrIChlLmcuIGluIGdldENhbmRpZGF0ZV8pLCB3aGljaCBpc1xuICAgICAgLy8gY2FsbGVkIG1vcmUgb2Z0ZW4gZHVyaW5nIHRoZSBkcmFnLCBidXQgY3JlYXRpbmcgYSBibG9jayB0aGF0IG9mdGVuXG4gICAgICAvLyBtaWdodCBiZSB0b28gc2xvdywgc28gd2Ugb25seSBkbyBpdCBpZiBuZWNlc3NhcnkuXG4gICAgICB0aGlzLmZpcnN0TWFya2VyID0gdGhpcy5jcmVhdGVNYXJrZXJCbG9jayh0aGlzLnRvcEJsb2NrKTtcbiAgICAgIGluc2VydGlvbk1hcmtlciA9IGlzTGFzdEluU3RhY2sgPyB0aGlzLmxhc3RNYXJrZXIgOiB0aGlzLmZpcnN0TWFya2VyO1xuICAgICAgaWYgKCFpbnNlcnRpb25NYXJrZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgJ0Nhbm5vdCBzaG93IHRoZSBpbnNlcnRpb24gbWFya2VyIGJlY2F1c2UgdGhlcmUgaXMgbm8gaW5zZXJ0aW9uICcgK1xuICAgICAgICAgICAgJ21hcmtlciBibG9jaycpO1xuICAgICAgfVxuICAgICAgaW1Db25uID1cbiAgICAgICAgICBpbnNlcnRpb25NYXJrZXIuZ2V0TWF0Y2hpbmdDb25uZWN0aW9uKGxvY2FsLmdldFNvdXJjZUJsb2NrKCksIGxvY2FsKTtcbiAgICB9XG5cbiAgICBpZiAoIWltQ29ubikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3Qgc2hvdyB0aGUgaW5zZXJ0aW9uIG1hcmtlciBiZWNhdXNlIHRoZXJlIGlzIG5vICcgK1xuICAgICAgICAgICdhc3NvY2lhdGVkIGNvbm5lY3Rpb24nKTtcbiAgICB9XG5cbiAgICBpZiAoaW1Db25uID09PSB0aGlzLm1hcmtlckNvbm5lY3Rpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnTWFkZSBpdCB0byBzaG93SW5zZXJ0aW9uTWFya2VyXyBldmVuIHRob3VnaCB0aGUgbWFya2VyIGlzblxcJ3QgJyArXG4gICAgICAgICAgJ2NoYW5naW5nJyk7XG4gICAgfVxuXG4gICAgLy8gUmVuZGVyIGRpc2Nvbm5lY3RlZCBmcm9tIGV2ZXJ5dGhpbmcgZWxzZSBzbyB0aGF0IHdlIGhhdmUgYSB2YWxpZFxuICAgIC8vIGNvbm5lY3Rpb24gbG9jYXRpb24uXG4gICAgaW5zZXJ0aW9uTWFya2VyLnJlbmRlcigpO1xuICAgIGluc2VydGlvbk1hcmtlci5yZW5kZXJlZCA9IHRydWU7XG4gICAgaW5zZXJ0aW9uTWFya2VyLmdldFN2Z1Jvb3QoKS5zZXRBdHRyaWJ1dGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuXG4gICAgaWYgKGltQ29ubiAmJiBjbG9zZXN0KSB7XG4gICAgICAvLyBQb3NpdGlvbiBzbyB0aGF0IHRoZSBleGlzdGluZyBibG9jayBkb2Vzbid0IG1vdmUuXG4gICAgICBpbnNlcnRpb25NYXJrZXIucG9zaXRpb25OZWFyQ29ubmVjdGlvbihpbUNvbm4sIGNsb3Nlc3QpO1xuICAgIH1cbiAgICBpZiAoY2xvc2VzdCkge1xuICAgICAgLy8gQ29ubmVjdCgpIGFsc28gcmVuZGVycyB0aGUgaW5zZXJ0aW9uIG1hcmtlci5cbiAgICAgIGltQ29ubi5jb25uZWN0KGNsb3Nlc3QpO1xuICAgIH1cblxuICAgIHRoaXMubWFya2VyQ29ubmVjdGlvbiA9IGltQ29ubjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNjb25uZWN0cyBhbmQgaGlkZXMgdGhlIGN1cnJlbnQgaW5zZXJ0aW9uIG1hcmtlci4gU2hvdWxkIHJldHVybiB0aGVcbiAgICogYmxvY2tzIHRvIHRoZWlyIG9yaWdpbmFsIHN0YXRlLlxuICAgKi9cbiAgcHJpdmF0ZSBoaWRlSW5zZXJ0aW9uTWFya2VyKCkge1xuICAgIGlmICghdGhpcy5tYXJrZXJDb25uZWN0aW9uKSByZXR1cm47XG5cbiAgICBjb25zdCBtYXJrZXJDb25uID0gdGhpcy5tYXJrZXJDb25uZWN0aW9uO1xuICAgIGNvbnN0IGltQmxvY2sgPSBtYXJrZXJDb25uLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgY29uc3QgbWFya2VyTmV4dCA9IGltQmxvY2submV4dENvbm5lY3Rpb247XG4gICAgY29uc3QgbWFya2VyUHJldiA9IGltQmxvY2sucHJldmlvdXNDb25uZWN0aW9uO1xuICAgIGNvbnN0IG1hcmtlck91dHB1dCA9IGltQmxvY2sub3V0cHV0Q29ubmVjdGlvbjtcblxuICAgIGNvbnN0IGlzTmV4dCA9IG1hcmtlckNvbm4gPT09IG1hcmtlck5leHQ7XG5cbiAgICBjb25zdCBpc0ZpcnN0SW5TdGF0ZW1lbnRTdGFjayA9XG4gICAgICAgIGlzTmV4dCAmJiAhKG1hcmtlclByZXYgJiYgbWFya2VyUHJldi50YXJnZXRDb25uZWN0aW9uKTtcblxuICAgIGNvbnN0IGlzRmlyc3RJbk91dHB1dFN0YWNrID1cbiAgICAgICAgbWFya2VyQ29ubi50eXBlID09PSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRSAmJlxuICAgICAgICAhKG1hcmtlck91dHB1dCAmJiBtYXJrZXJPdXRwdXQudGFyZ2V0Q29ubmVjdGlvbik7XG4gICAgLy8gVGhlIGluc2VydGlvbiBtYXJrZXIgaXMgdGhlIGZpcnN0IGJsb2NrIGluIGEgc3RhY2suICBVbnBsdWcgd29uJ3QgZG9cbiAgICAvLyBhbnl0aGluZyBpbiB0aGF0IGNhc2UuICBJbnN0ZWFkLCB1bnBsdWcgdGhlIGZvbGxvd2luZyBibG9jay5cbiAgICBpZiAoaXNGaXJzdEluU3RhdGVtZW50U3RhY2sgfHwgaXNGaXJzdEluT3V0cHV0U3RhY2spIHtcbiAgICAgIG1hcmtlckNvbm4udGFyZ2V0QmxvY2soKSEudW5wbHVnKGZhbHNlKTtcbiAgICB9IGVsc2UgaWYgKG1hcmtlckNvbm4udHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQgJiYgIWlzTmV4dCkge1xuICAgICAgLy8gSW5zaWRlIG9mIGEgQy1ibG9jaywgZmlyc3Qgc3RhdGVtZW50IGNvbm5lY3Rpb24uXG4gICAgICBjb25zdCBpbm5lckNvbm5lY3Rpb24gPSBtYXJrZXJDb25uLnRhcmdldENvbm5lY3Rpb247XG4gICAgICBpZiAoaW5uZXJDb25uZWN0aW9uKSB7XG4gICAgICAgIGlubmVyQ29ubmVjdGlvbi5nZXRTb3VyY2VCbG9jaygpLnVucGx1ZyhmYWxzZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHByZXZpb3VzQmxvY2tOZXh0Q29ubmVjdGlvbiA9XG4gICAgICAgICAgbWFya2VyUHJldiA/IG1hcmtlclByZXYudGFyZ2V0Q29ubmVjdGlvbiA6IG51bGw7XG5cbiAgICAgIGltQmxvY2sudW5wbHVnKHRydWUpO1xuICAgICAgaWYgKHByZXZpb3VzQmxvY2tOZXh0Q29ubmVjdGlvbiAmJiBpbm5lckNvbm5lY3Rpb24pIHtcbiAgICAgICAgcHJldmlvdXNCbG9ja05leHRDb25uZWN0aW9uLmNvbm5lY3QoaW5uZXJDb25uZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaW1CbG9jay51bnBsdWcoLyogaGVhbFN0YWNrICovIHRydWUpO1xuICAgIH1cblxuICAgIGlmIChtYXJrZXJDb25uLnRhcmdldENvbm5lY3Rpb24pIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdtYXJrZXJDb25uZWN0aW9uIHN0aWxsIGNvbm5lY3RlZCBhdCB0aGUgZW5kIG9mICcgK1xuICAgICAgICAgICdkaXNjb25uZWN0SW5zZXJ0aW9uTWFya2VyJyk7XG4gICAgfVxuXG4gICAgdGhpcy5tYXJrZXJDb25uZWN0aW9uID0gbnVsbDtcbiAgICBjb25zdCBzdmcgPSBpbUJsb2NrLmdldFN2Z1Jvb3QoKTtcbiAgICBpZiAoc3ZnKSB7XG4gICAgICBzdmcuc2V0QXR0cmlidXRlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93cyBhbiBvdXRsaW5lIGFyb3VuZCB0aGUgaW5wdXQgdGhlIGNsb3Nlc3QgY29ubmVjdGlvbiBiZWxvbmdzIHRvLlxuICAgKlxuICAgKiBAcGFyYW0gYWN0aXZlQ2FuZGlkYXRlIFRoZSBjb25uZWN0aW9uIHRoYXQgd2lsbCBiZSBtYWRlIGlmIHRoZSBkcmFnIGVuZHNcbiAgICogICAgIGltbWVkaWF0ZWx5LlxuICAgKi9cbiAgcHJpdmF0ZSBzaG93SW5zZXJ0aW9uSW5wdXRPdXRsaW5lKGFjdGl2ZUNhbmRpZGF0ZTogQ2FuZGlkYXRlQ29ubmVjdGlvbikge1xuICAgIGNvbnN0IGNsb3Nlc3QgPSBhY3RpdmVDYW5kaWRhdGUuY2xvc2VzdDtcbiAgICB0aGlzLmhpZ2hsaWdodGVkQmxvY2sgPSBjbG9zZXN0LmdldFNvdXJjZUJsb2NrKCk7XG4gICAgdGhpcy5oaWdobGlnaHRlZEJsb2NrLmhpZ2hsaWdodFNoYXBlRm9ySW5wdXQoY2xvc2VzdCwgdHJ1ZSk7XG4gIH1cblxuICAvKiogSGlkZXMgYW55IHZpc2libGUgaW5wdXQgb3V0bGluZXMuICovXG4gIHByaXZhdGUgaGlkZUluc2VydGlvbklucHV0T3V0bGluZSgpIHtcbiAgICBpZiAoIXRoaXMuaGlnaGxpZ2h0ZWRCbG9jaykgcmV0dXJuO1xuXG4gICAgaWYgKCF0aGlzLmFjdGl2ZUNhbmRpZGF0ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgaGlkZSB0aGUgaW5zZXJ0aW9uIG1hcmtlciBvdXRsaW5lIGJlY2F1c2UgJyArXG4gICAgICAgICAgJ3RoZXJlIGlzIG5vIGFjdGl2ZSBjYW5kaWRhdGUnKTtcbiAgICB9XG4gICAgdGhpcy5oaWdobGlnaHRlZEJsb2NrLmhpZ2hsaWdodFNoYXBlRm9ySW5wdXQoXG4gICAgICAgIHRoaXMuYWN0aXZlQ2FuZGlkYXRlLmNsb3Nlc3QsIGZhbHNlKTtcbiAgICB0aGlzLmhpZ2hsaWdodGVkQmxvY2sgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3dzIGEgcmVwbGFjZW1lbnQgZmFkZSBhZmZlY3Qgb24gdGhlIGNsb3Nlc3QgY29ubmVjdGlvbidzIHRhcmdldCBibG9ja1xuICAgKiAodGhlIGJsb2NrIHRoYXQgaXMgY3VycmVudGx5IGNvbm5lY3RlZCB0byBpdCkuXG4gICAqXG4gICAqIEBwYXJhbSBhY3RpdmVDYW5kaWRhdGUgVGhlIGNvbm5lY3Rpb24gdGhhdCB3aWxsIGJlIG1hZGUgaWYgdGhlIGRyYWcgZW5kc1xuICAgKiAgICAgaW1tZWRpYXRlbHkuXG4gICAqL1xuICBwcml2YXRlIHNob3dSZXBsYWNlbWVudEZhZGUoYWN0aXZlQ2FuZGlkYXRlOiBDYW5kaWRhdGVDb25uZWN0aW9uKSB7XG4gICAgdGhpcy5mYWRlZEJsb2NrID0gYWN0aXZlQ2FuZGlkYXRlLmNsb3Nlc3QudGFyZ2V0QmxvY2soKTtcbiAgICBpZiAoIXRoaXMuZmFkZWRCbG9jaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3Qgc2hvdyB0aGUgcmVwbGFjZW1lbnQgZmFkZSBiZWNhdXNlIHRoZSAnICtcbiAgICAgICAgICAnY2xvc2VzdCBjb25uZWN0aW9uIGRvZXMgbm90IGhhdmUgYSB0YXJnZXQgYmxvY2snKTtcbiAgICB9XG4gICAgdGhpcy5mYWRlZEJsb2NrLmZhZGVGb3JSZXBsYWNlbWVudCh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlcy9SZW1vdmVzIGFueSB2aXNpYmxlIGZhZGUgYWZmZWN0cy5cbiAgICovXG4gIHByaXZhdGUgaGlkZVJlcGxhY2VtZW50RmFkZSgpIHtcbiAgICBpZiAoIXRoaXMuZmFkZWRCbG9jaykgcmV0dXJuO1xuXG4gICAgdGhpcy5mYWRlZEJsb2NrLmZhZGVGb3JSZXBsYWNlbWVudChmYWxzZSk7XG4gICAgdGhpcy5mYWRlZEJsb2NrID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIHRoZSBpbnNlcnRpb24gbWFya2VycyB0aGF0IGN1cnJlbnRseSBleGlzdC4gIERyYWdzIGhhdmUgMCwgMSxcbiAgICogb3IgMiBpbnNlcnRpb24gbWFya2Vycy5cbiAgICpcbiAgICogQHJldHVybnMgQSBwb3NzaWJseSBlbXB0eSBsaXN0IG9mIGluc2VydGlvbiBtYXJrZXIgYmxvY2tzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldEluc2VydGlvbk1hcmtlcnMoKTogQmxvY2tTdmdbXSB7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgaWYgKHRoaXMuZmlyc3RNYXJrZXIpIHtcbiAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZmlyc3RNYXJrZXIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5sYXN0TWFya2VyKSB7XG4gICAgICByZXN1bHQucHVzaCh0aGlzLmxhc3RNYXJrZXIpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgSW5zZXJ0aW9uTWFya2VyTWFuYWdlciB7XG4gIC8qKlxuICAgKiBBbiBlbnVtIGRlc2NyaWJpbmcgZGlmZmVyZW50IGtpbmRzIG9mIHByZXZpZXdzIHRoZSBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyXG4gICAqIGNvdWxkIGRpc3BsYXkuXG4gICAqL1xuICBleHBvcnQgZW51bSBQUkVWSUVXX1RZUEUge1xuICAgIElOU0VSVElPTl9NQVJLRVIgPSAwLFxuICAgIElOUFVUX09VVExJTkUgPSAxLFxuICAgIFJFUExBQ0VNRU5UX0ZBREUgPSAyLFxuICB9XG59XG5cbmV4cG9ydCB0eXBlIFByZXZpZXdUeXBlID0gSW5zZXJ0aW9uTWFya2VyTWFuYWdlci5QUkVWSUVXX1RZUEU7XG5leHBvcnQgY29uc3QgUHJldmlld1R5cGUgPSBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyLlBSRVZJRVdfVFlQRTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBCYXNlIHJlbmRlcmVyLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmJsb2NrUmVuZGVyaW5nLlJlbmRlcmVyJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja30gZnJvbSAnLi4vLi4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHtDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB7Q29ubmVjdGlvblR5cGV9IGZyb20gJy4uLy4uL2Nvbm5lY3Rpb25fdHlwZS5qcyc7XG5pbXBvcnQge0luc2VydGlvbk1hcmtlck1hbmFnZXIsIFByZXZpZXdUeXBlfSBmcm9tICcuLi8uLi9pbnNlcnRpb25fbWFya2VyX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge0lSZWdpc3RyYWJsZX0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9pX3JlZ2lzdHJhYmxlLmpzJztcbmltcG9ydCB0eXBlIHtNYXJrZXJ9IGZyb20gJy4uLy4uL2tleWJvYXJkX25hdi9tYXJrZXIuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlcmVkQ29ubmVjdGlvbn0gZnJvbSAnLi4vLi4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdHlsZSwgVGhlbWV9IGZyb20gJy4uLy4uL3RoZW1lLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4uLy4uL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5pbXBvcnQge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJy4vZGVidWcuanMnO1xuaW1wb3J0IHtEZWJ1Z30gZnJvbSAnLi9kZWJ1Z2dlci5qcyc7XG5pbXBvcnQge0RyYXdlcn0gZnJvbSAnLi9kcmF3ZXIuanMnO1xuaW1wb3J0IHR5cGUge0lQYXRoT2JqZWN0fSBmcm9tICcuL2lfcGF0aF9vYmplY3QuanMnO1xuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHtNYXJrZXJTdmd9IGZyb20gJy4vbWFya2VyX3N2Zy5qcyc7XG5pbXBvcnQge1BhdGhPYmplY3R9IGZyb20gJy4vcGF0aF9vYmplY3QuanMnO1xuXG5cbi8qKlxuICogVGhlIGJhc2UgY2xhc3MgZm9yIGEgYmxvY2sgcmVuZGVyZXIuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuYmxvY2tSZW5kZXJpbmcuUmVuZGVyZXJcbiAqL1xuZXhwb3J0IGNsYXNzIFJlbmRlcmVyIGltcGxlbWVudHMgSVJlZ2lzdHJhYmxlIHtcbiAgLyoqIFRoZSByZW5kZXJlcidzIGNvbnN0YW50IHByb3ZpZGVyLiAqL1xuICBwcm90ZWN0ZWQgY29uc3RhbnRzXyE6IENvbnN0YW50UHJvdmlkZXI7XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFJlbmRlcmluZyBjb25zdGFudCBvdmVycmlkZXMsIHBhc3NlZCBpbiB0aHJvdWdoIG9wdGlvbnMuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGVzOiBvYmplY3R8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSByZW5kZXJlciBuYW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY2xhc3MgbmFtZSB0aGF0IGlkZW50aWZpZXMgdGhpcyByZW5kZXJlci5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIENTUyBjbGFzcyBuYW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldENsYXNzTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm5hbWUgKyAnLXJlbmRlcmVyJztcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSByZW5kZXJlci5cbiAgICpcbiAgICogQHBhcmFtIHRoZW1lIFRoZSB3b3Jrc3BhY2UgdGhlbWUgb2JqZWN0LlxuICAgKiBAcGFyYW0gb3B0X3JlbmRlcmVyT3ZlcnJpZGVzIFJlbmRlcmluZyBjb25zdGFudCBvdmVycmlkZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgaW5pdChcbiAgICAgIHRoZW1lOiBUaGVtZSwgb3B0X3JlbmRlcmVyT3ZlcnJpZGVzPzoge1tyZW5kZXJlckNvbnN0YW50OiBzdHJpbmddOiBhbnl9KSB7XG4gICAgdGhpcy5jb25zdGFudHNfID0gdGhpcy5tYWtlQ29uc3RhbnRzXygpO1xuICAgIGlmIChvcHRfcmVuZGVyZXJPdmVycmlkZXMpIHtcbiAgICAgIHRoaXMub3ZlcnJpZGVzID0gb3B0X3JlbmRlcmVyT3ZlcnJpZGVzO1xuICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnN0YW50c18sIG9wdF9yZW5kZXJlck92ZXJyaWRlcyk7XG4gICAgfVxuICAgIHRoaXMuY29uc3RhbnRzXy5zZXRUaGVtZSh0aGVtZSk7XG4gICAgdGhpcy5jb25zdGFudHNfLmluaXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW55IERPTSBlbGVtZW50cyB0aGF0IHRoaXMgcmVuZGVyZXIgbmVlZHMuXG4gICAqXG4gICAqIEBwYXJhbSBzdmcgVGhlIHJvb3Qgb2YgdGhlIHdvcmtzcGFjZSdzIFNWRy5cbiAgICogQHBhcmFtIHRoZW1lIFRoZSB3b3Jrc3BhY2UgdGhlbWUgb2JqZWN0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNyZWF0ZURvbShzdmc6IFNWR0VsZW1lbnQsIHRoZW1lOiBUaGVtZSkge1xuICAgIHRoaXMuY29uc3RhbnRzXy5jcmVhdGVEb20oXG4gICAgICAgIHN2ZywgdGhpcy5uYW1lICsgJy0nICsgdGhlbWUubmFtZSxcbiAgICAgICAgJy4nICsgdGhpcy5nZXRDbGFzc05hbWUoKSArICcuJyArIHRoZW1lLmdldENsYXNzTmFtZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWZyZXNoIHRoZSByZW5kZXJlciBhZnRlciBhIHRoZW1lIGNoYW5nZS5cbiAgICpcbiAgICogQHBhcmFtIHN2ZyBUaGUgcm9vdCBvZiB0aGUgd29ya3NwYWNlJ3MgU1ZHLlxuICAgKiBAcGFyYW0gdGhlbWUgVGhlIHdvcmtzcGFjZSB0aGVtZSBvYmplY3QuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVmcmVzaERvbShzdmc6IFNWR0VsZW1lbnQsIHRoZW1lOiBUaGVtZSkge1xuICAgIGNvbnN0IHByZXZpb3VzQ29uc3RhbnRzID0gdGhpcy5nZXRDb25zdGFudHMoKTtcbiAgICBwcmV2aW91c0NvbnN0YW50cy5kaXNwb3NlKCk7XG4gICAgdGhpcy5jb25zdGFudHNfID0gdGhpcy5tYWtlQ29uc3RhbnRzXygpO1xuICAgIGlmICh0aGlzLm92ZXJyaWRlcykge1xuICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnN0YW50c18sIHRoaXMub3ZlcnJpZGVzKTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHRoZSBjb25zdGFudCBwcm92aWRlcidzIHJhbmRvbSBpZGVudGlmaWVyIGRvZXMgbm90IGNoYW5nZS5cbiAgICB0aGlzLmNvbnN0YW50c18ucmFuZG9tSWRlbnRpZmllciA9IHByZXZpb3VzQ29uc3RhbnRzLnJhbmRvbUlkZW50aWZpZXI7XG4gICAgdGhpcy5jb25zdGFudHNfLnNldFRoZW1lKHRoZW1lKTtcbiAgICB0aGlzLmNvbnN0YW50c18uaW5pdCgpO1xuICAgIHRoaXMuY3JlYXRlRG9tKHN2ZywgdGhlbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2YgdGhpcyByZW5kZXJlci5cbiAgICogRGVsZXRlIGFsbCBET00gZWxlbWVudHMgdGhhdCB0aGlzIHJlbmRlcmVyIGFuZCBpdHMgY29uc3RhbnRzIGNyZWF0ZWQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5jb25zdGFudHNfKSB7XG4gICAgICB0aGlzLmNvbnN0YW50c18uZGlzcG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJlbmRlcmVyJ3MgY29uc3RhbnQgcHJvdmlkZXIuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb25zdGFudCBwcm92aWRlci5cbiAgICovXG4gIHByb3RlY3RlZCBtYWtlQ29uc3RhbnRzXygpOiBDb25zdGFudFByb3ZpZGVyIHtcbiAgICByZXR1cm4gbmV3IENvbnN0YW50UHJvdmlkZXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJlbmRlcmVyJ3MgcmVuZGVyIGluZm8gb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIG1lYXN1cmUuXG4gICAqIEByZXR1cm5zIFRoZSByZW5kZXIgaW5mbyBvYmplY3QuXG4gICAqL1xuICBwcm90ZWN0ZWQgbWFrZVJlbmRlckluZm9fKGJsb2NrOiBCbG9ja1N2Zyk6IFJlbmRlckluZm8ge1xuICAgIHJldHVybiBuZXcgUmVuZGVySW5mbyh0aGlzLCBibG9jayk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIGRyYXdlci5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byByZW5kZXIuXG4gICAqIEBwYXJhbSBpbmZvIEFuIG9iamVjdCBjb250YWluaW5nIGFsbCBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gcmVuZGVyIHRoaXNcbiAgICogICAgIGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgZHJhd2VyLlxuICAgKi9cbiAgcHJvdGVjdGVkIG1ha2VEcmF3ZXJfKGJsb2NrOiBCbG9ja1N2ZywgaW5mbzogUmVuZGVySW5mbyk6IERyYXdlciB7XG4gICAgcmV0dXJuIG5ldyBEcmF3ZXIoYmxvY2ssIGluZm8pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgcmVuZGVyZXIncyBkZWJ1Z2dlci5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHJlbmRlcmVyIGRlYnVnZ2VyLlxuICAgKiBAc3VwcHJlc3Mge3N0cmljdE1vZHVsZURlcENoZWNrfSBEZWJ1ZyByZW5kZXJlciBvbmx5IGluY2x1ZGVkIGluXG4gICAqIHBsYXlncm91bmQuXG4gICAqL1xuICBwcm90ZWN0ZWQgbWFrZURlYnVnZ2VyXygpOiBEZWJ1ZyB7XG4gICAgcmV0dXJuIG5ldyBEZWJ1Zyh0aGlzLmdldENvbnN0YW50cygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJlbmRlcmVyJ3MgbWFya2VyIGRyYXdlci5cbiAgICpcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRoZSBtYXJrZXIgYmVsb25ncyB0by5cbiAgICogQHBhcmFtIG1hcmtlciBUaGUgbWFya2VyLlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IGluIGNoYXJnZSBvZiBkcmF3aW5nIHRoZSBtYXJrZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFrZU1hcmtlckRyYXdlcih3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZywgbWFya2VyOiBNYXJrZXIpOiBNYXJrZXJTdmcge1xuICAgIHJldHVybiBuZXcgTWFya2VyU3ZnKHdvcmtzcGFjZSwgdGhpcy5nZXRDb25zdGFudHMoKSwgbWFya2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgYSByZW5kZXJlciBwYXRoIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIHJvb3QgVGhlIHJvb3QgU1ZHIGVsZW1lbnQuXG4gICAqIEBwYXJhbSBzdHlsZSBUaGUgc3R5bGUgb2JqZWN0IHRvIHVzZSBmb3IgY29sb3VyaW5nLlxuICAgKiBAcmV0dXJucyBUaGUgcmVuZGVyZXIgcGF0aCBvYmplY3QuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFrZVBhdGhPYmplY3Qocm9vdDogU1ZHRWxlbWVudCwgc3R5bGU6IEJsb2NrU3R5bGUpOiBJUGF0aE9iamVjdCB7XG4gICAgcmV0dXJuIG5ldyBQYXRoT2JqZWN0KHJvb3QsIHN0eWxlLCAodGhpcy5jb25zdGFudHNfKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IHJlbmRlcmVyJ3MgY29uc3RhbnQgcHJvdmlkZXIuICBXZSBhc3N1bWUgdGhhdCB3aGVuIHRoaXMgaXNcbiAgICogY2FsbGVkLCB0aGUgcmVuZGVyZXIgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXplZC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGNvbnN0YW50IHByb3ZpZGVyLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldENvbnN0YW50cygpOiBDb25zdGFudFByb3ZpZGVyIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0byBoaWdobGlnaHQgYSBjb25uZWN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gX2Nvbm4gVGhlIGNvbm5lY3Rpb24gdG8gZGV0ZXJtaW5lIHdoZXRoZXIgb3Igbm90IHRvIGhpZ2hsaWdodC5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB3ZSBzaG91bGQgaGlnaGxpZ2h0IHRoZSBjb25uZWN0aW9uLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNob3VsZEhpZ2hsaWdodENvbm5lY3Rpb24oX2Nvbm46IENvbm5lY3Rpb24pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYW4gb3JwaGFuZWQgYmxvY2sgY2FuIGNvbm5lY3QgdG8gdGhlIFwiZW5kXCIgb2YgdGhlIHRvcEJsb2NrJ3NcbiAgICogYmxvY2stY2x1bXAuIElmIHRoZSBjbHVtcCBpcyBhIHJvdyB0aGUgZW5kIGlzIHRoZSBsYXN0IGlucHV0LiBJZiB0aGUgY2x1bXBcbiAgICogaXMgYSBzdGFjaywgdGhlIGVuZCBpcyB0aGUgbGFzdCBuZXh0IGNvbm5lY3Rpb24uIElmIHRoZSBjbHVtcCBpcyBuZWl0aGVyLFxuICAgKiB0aGVuIHRoaXMgcmV0dXJucyBmYWxzZS5cbiAgICpcbiAgICogQHBhcmFtIHRvcEJsb2NrIFRoZSB0b3AgYmxvY2sgb2YgdGhlIGJsb2NrIGNsdW1wIHdlIHdhbnQgdG8gdHJ5IGFuZCBjb25uZWN0XG4gICAqICAgICB0by5cbiAgICogQHBhcmFtIG9ycGhhbkJsb2NrIFRoZSBvcnBoYW4gYmxvY2sgdGhhdCB3YW50cyB0byBmaW5kIGEgaG9tZS5cbiAgICogQHBhcmFtIGxvY2FsVHlwZSBUaGUgdHlwZSBvZiB0aGUgY29ubmVjdGlvbiBiZWluZyBkcmFnZ2VkLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZXJlIGlzIGEgaG9tZSBmb3IgdGhlIG9ycGhhbiBvciBub3QuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3JwaGFuQ2FuQ29ubmVjdEF0RW5kKFxuICAgICAgdG9wQmxvY2s6IEJsb2NrU3ZnLCBvcnBoYW5CbG9jazogQmxvY2tTdmcsIGxvY2FsVHlwZTogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgb3JwaGFuQ29ubmVjdGlvbiA9IGxvY2FsVHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuT1VUUFVUX1ZBTFVFID9cbiAgICAgICAgb3JwaGFuQmxvY2sub3V0cHV0Q29ubmVjdGlvbiA6XG4gICAgICAgIG9ycGhhbkJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbjtcbiAgICByZXR1cm4gISFDb25uZWN0aW9uLmdldENvbm5lY3Rpb25Gb3JPcnBoYW5lZENvbm5lY3Rpb24oXG4gICAgICAgIHRvcEJsb2NrIGFzIEJsb2NrLCBvcnBoYW5Db25uZWN0aW9uIGFzIENvbm5lY3Rpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIENob29zZXMgYSBjb25uZWN0aW9uIHByZXZpZXcgbWV0aG9kIGJhc2VkIG9uIHRoZSBhdmFpbGFibGUgY29ubmVjdGlvbiwgdGhlXG4gICAqIGN1cnJlbnQgZHJhZ2dlZCBjb25uZWN0aW9uLCBhbmQgdGhlIGJsb2NrIGJlaW5nIGRyYWdnZWQuXG4gICAqXG4gICAqIEBwYXJhbSBjbG9zZXN0IFRoZSBhdmFpbGFibGUgY29ubmVjdGlvbi5cbiAgICogQHBhcmFtIGxvY2FsIFRoZSBjb25uZWN0aW9uIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKiBAcGFyYW0gdG9wQmxvY2sgVGhlIGJsb2NrIGN1cnJlbnRseSBiZWluZyBkcmFnZ2VkLlxuICAgKiBAcmV0dXJucyBUaGUgcHJldmlldyB0eXBlIHRvIGRpc3BsYXkuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0Q29ubmVjdGlvblByZXZpZXdNZXRob2QoXG4gICAgICBjbG9zZXN0OiBSZW5kZXJlZENvbm5lY3Rpb24sIGxvY2FsOiBSZW5kZXJlZENvbm5lY3Rpb24sXG4gICAgICB0b3BCbG9jazogQmxvY2tTdmcpOiBQcmV2aWV3VHlwZSB7XG4gICAgaWYgKGxvY2FsLnR5cGUgPT09IENvbm5lY3Rpb25UeXBlLk9VVFBVVF9WQUxVRSB8fFxuICAgICAgICBsb2NhbC50eXBlID09PSBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlQpIHtcbiAgICAgIGlmICghY2xvc2VzdC5pc0Nvbm5lY3RlZCgpIHx8XG4gICAgICAgICAgdGhpcy5vcnBoYW5DYW5Db25uZWN0QXRFbmQoXG4gICAgICAgICAgICAgIHRvcEJsb2NrLCBjbG9zZXN0LnRhcmdldEJsb2NrKCkgYXMgQmxvY2tTdmcsIGxvY2FsLnR5cGUpKSB7XG4gICAgICAgIHJldHVybiBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyLlBSRVZJRVdfVFlQRS5JTlNFUlRJT05fTUFSS0VSO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEluc2VydGlvbk1hcmtlck1hbmFnZXIuUFJFVklFV19UWVBFLlJFUExBQ0VNRU5UX0ZBREU7XG4gICAgfVxuXG4gICAgcmV0dXJuIEluc2VydGlvbk1hcmtlck1hbmFnZXIuUFJFVklFV19UWVBFLklOU0VSVElPTl9NQVJLRVI7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byByZW5kZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVuZGVyKGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIGlmIChkZWJ1Zy5pc0RlYnVnZ2VyRW5hYmxlZCgpICYmICFibG9jay5yZW5kZXJpbmdEZWJ1Z2dlcikge1xuICAgICAgYmxvY2sucmVuZGVyaW5nRGVidWdnZXIgPSB0aGlzLm1ha2VEZWJ1Z2dlcl8oKTtcbiAgICB9XG4gICAgY29uc3QgaW5mbyA9IHRoaXMubWFrZVJlbmRlckluZm9fKGJsb2NrKTtcbiAgICBpbmZvLm1lYXN1cmUoKTtcbiAgICB0aGlzLm1ha2VEcmF3ZXJfKGJsb2NrLCBpbmZvKS5kcmF3KCk7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgaW4gY2hhcmdlIG9mIHN0b3JpbmcgYW5kIHVwZGF0aW5nIGEgd29ya3NwYWNlIHRoZW1lXG4gKiAgICAgYW5kIFVJIGNvbXBvbmVudHMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVGhlbWVNYW5hZ2VyJyk7XG5cbmltcG9ydCB0eXBlIHtUaGVtZX0gZnJvbSAnLi90aGVtZS5qcyc7XG5pbXBvcnQgKiBhcyBhcnJheVV0aWxzIGZyb20gJy4vdXRpbHMvYXJyYXkuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4vd29ya3NwYWNlLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3Igc3RvcmluZyBhbmQgdXBkYXRpbmcgYSB3b3Jrc3BhY2UncyB0aGVtZSBhbmQgVUkgY29tcG9uZW50cy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5UaGVtZU1hbmFnZXJcbiAqL1xuZXhwb3J0IGNsYXNzIFRoZW1lTWFuYWdlciB7XG4gIC8qKiBBIGxpc3Qgb2Ygd29ya3NwYWNlcyB0aGF0IGFyZSBzdWJzY3JpYmVkIHRvIHRoaXMgdGhlbWUuICovXG4gIHByaXZhdGUgc3Vic2NyaWJlZFdvcmtzcGFjZXNfOiBXb3Jrc3BhY2VbXSA9IFtdO1xuICBwcml2YXRlIGNvbXBvbmVudERCID0gbmV3IE1hcDxzdHJpbmcsIENvbXBvbmVudFtdPigpO1xuICBvd25lcl86IEFueUR1cmluZ01pZ3JhdGlvbjtcblxuICAvKipcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgbWFpbiB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSB0aGVtZSBUaGUgd29ya3NwYWNlIHRoZW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgd29ya3NwYWNlOiBXb3Jrc3BhY2VTdmcsIHByaXZhdGUgdGhlbWU6IFRoZW1lKSB7fVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHdvcmtzcGFjZSB0aGVtZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHdvcmtzcGFjZSB0aGVtZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRUaGVtZSgpOiBUaGVtZSB7XG4gICAgcmV0dXJuIHRoaXMudGhlbWU7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSB3b3Jrc3BhY2UgdGhlbWUsIGFuZCByZWZyZXNoIHRoZSB3b3Jrc3BhY2UgYW5kIGFsbCBjb21wb25lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gdGhlbWUgVGhlIHdvcmtzcGFjZSB0aGVtZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRUaGVtZSh0aGVtZTogVGhlbWUpIHtcbiAgICBjb25zdCBwcmV2VGhlbWUgPSB0aGlzLnRoZW1lO1xuICAgIHRoaXMudGhlbWUgPSB0aGVtZTtcbiAgICAvLyBTZXQgdGhlIHRoZW1lIG5hbWUgb250byB0aGUgaW5qZWN0aW9uIGRpdi5cbiAgICBjb25zdCBpbmplY3Rpb25EaXYgPSB0aGlzLndvcmtzcGFjZS5nZXRJbmplY3Rpb25EaXYoKTtcbiAgICBpZiAoaW5qZWN0aW9uRGl2KSB7XG4gICAgICBpZiAocHJldlRoZW1lKSB7XG4gICAgICAgIGNvbnN0IG9sZENsYXNzTmFtZSA9IHByZXZUaGVtZS5nZXRDbGFzc05hbWUoKTtcbiAgICAgICAgaWYgKG9sZENsYXNzTmFtZSkge1xuICAgICAgICAgIGRvbS5yZW1vdmVDbGFzcyhpbmplY3Rpb25EaXYsIG9sZENsYXNzTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IG5ld0NsYXNzTmFtZSA9IHRoaXMudGhlbWUuZ2V0Q2xhc3NOYW1lKCk7XG4gICAgICBpZiAobmV3Q2xhc3NOYW1lKSB7XG4gICAgICAgIGRvbS5hZGRDbGFzcyhpbmplY3Rpb25EaXYsIG5ld0NsYXNzTmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVmcmVzaCBhbGwgc3Vic2NyaWJlZCB3b3Jrc3BhY2VzLlxuICAgIGZvciAobGV0IGkgPSAwLCB3b3Jrc3BhY2U7IHdvcmtzcGFjZSA9IHRoaXMuc3Vic2NyaWJlZFdvcmtzcGFjZXNfW2ldOyBpKyspIHtcbiAgICAgICh3b3Jrc3BhY2UgYXMgV29ya3NwYWNlU3ZnKS5yZWZyZXNoVGhlbWUoKTtcbiAgICB9XG5cbiAgICAvLyBSZWZyZXNoIGFsbCByZWdpc3RlcmVkIEJsb2NrbHkgVUkgY29tcG9uZW50cy5cbiAgICBmb3IgKGNvbnN0IFtrZXksIGNvbXBvbmVudExpc3RdIG9mIHRoaXMuY29tcG9uZW50REIpIHtcbiAgICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGNvbXBvbmVudExpc3QpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGNvbXBvbmVudC5lbGVtZW50O1xuICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBjb21wb25lbnQucHJvcGVydHlOYW1lO1xuICAgICAgICBjb25zdCBzdHlsZSA9IHRoaXMudGhlbWUgJiYgdGhpcy50aGVtZS5nZXRDb21wb25lbnRTdHlsZShrZXkpO1xuICAgICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdzdHlsZScgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgICAgICAvLyAnRWxlbWVudCcuXG4gICAgICAgIChlbGVtZW50IGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc3R5bGVbcHJvcGVydHlOYW1lXSA9IHN0eWxlIHx8ICcnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3Qgd29ya3NwYWNlIG9mIHRoaXMuc3Vic2NyaWJlZFdvcmtzcGFjZXNfKSB7XG4gICAgICAod29ya3NwYWNlIGFzIFdvcmtzcGFjZVN2ZykuaGlkZUNoYWZmKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN1YnNjcmliZSBhIHdvcmtzcGFjZSB0byBjaGFuZ2VzIHRvIHRoZSBzZWxlY3RlZCB0aGVtZS4gIElmIGEgbmV3IHRoZW1lIGlzXG4gICAqIHNldCwgdGhlIHdvcmtzcGFjZSBpcyBjYWxsZWQgdG8gcmVmcmVzaCBpdHMgYmxvY2tzLlxuICAgKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gc3Vic2NyaWJlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN1YnNjcmliZVdvcmtzcGFjZSh3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgIHRoaXMuc3Vic2NyaWJlZFdvcmtzcGFjZXNfLnB1c2god29ya3NwYWNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVbnN1YnNjcmliZSBhIHdvcmtzcGFjZSB0byBjaGFuZ2VzIHRvIHRoZSBzZWxlY3RlZCB0aGVtZS5cbiAgICpcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHVuc3Vic2NyaWJlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHVuc3Vic2NyaWJlV29ya3NwYWNlKHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XG4gICAgaWYgKCFhcnJheVV0aWxzLnJlbW92ZUVsZW0odGhpcy5zdWJzY3JpYmVkV29ya3NwYWNlc18sIHdvcmtzcGFjZSkpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgdW5zdWJzY3JpYmUgYSB3b3Jrc3BhY2UgdGhhdCBoYXNuXFwndCBiZWVuIHN1YnNjcmliZWQuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN1YnNjcmliZSBhbiBlbGVtZW50IHRvIGNoYW5nZXMgdG8gdGhlIHNlbGVjdGVkIHRoZW1lLiAgSWYgYSBuZXcgdGhlbWUgaXNcbiAgICogc2VsZWN0ZWQsIHRoZSBlbGVtZW50J3Mgc3R5bGUgaXMgcmVmcmVzaGVkIHdpdGggdGhlIG5ldyB0aGVtZSdzIHN0eWxlLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byBzdWJzY3JpYmUuXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIGNvbXBvbmVudC4gVGhpcyBtdXN0IGJlXG4gICAqICAgICB0aGUgc2FtZSBuYW1lIHVzZWQgdG8gY29uZmlndXJlIHRoZSBzdHlsZSBpbiB0aGUgVGhlbWUgb2JqZWN0LlxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIFRoZSBpbmxpbmUgc3R5bGUgcHJvcGVydHkgbmFtZSB0byB1cGRhdGUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3Vic2NyaWJlKGVsZW1lbnQ6IEVsZW1lbnQsIGNvbXBvbmVudE5hbWU6IHN0cmluZywgcHJvcGVydHlOYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMuY29tcG9uZW50REIuaGFzKGNvbXBvbmVudE5hbWUpKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudERCLnNldChjb21wb25lbnROYW1lLCBbXSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBlbGVtZW50IHRvIG91ciBjb21wb25lbnQgbWFwLlxuICAgIHRoaXMuY29tcG9uZW50REIuZ2V0KGNvbXBvbmVudE5hbWUpIS5wdXNoKHtlbGVtZW50LCBwcm9wZXJ0eU5hbWV9KTtcblxuICAgIC8vIEluaXRpYWxpemUgdGhlIGVsZW1lbnQgd2l0aCBpdHMgY29ycmVzcG9uZGluZyB0aGVtZSBzdHlsZS5cbiAgICBjb25zdCBzdHlsZSA9IHRoaXMudGhlbWUgJiYgdGhpcy50aGVtZS5nZXRDb21wb25lbnRTdHlsZShjb21wb25lbnROYW1lKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdzdHlsZScgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICdFbGVtZW50Jy5cbiAgICAoZWxlbWVudCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLnN0eWxlW3Byb3BlcnR5TmFtZV0gPSBzdHlsZSB8fCAnJztcbiAgfVxuXG4gIC8qKlxuICAgKiBVbnN1YnNjcmliZSBhbiBlbGVtZW50IHRvIGNoYW5nZXMgdG8gdGhlIHNlbGVjdGVkIHRoZW1lLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byB1bnN1YnNjcmliZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICB1bnN1YnNjcmliZShlbGVtZW50OiBFbGVtZW50KSB7XG4gICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIEdvIHRocm91Z2ggYWxsIGNvbXBvbmVudCwgYW5kIHJlbW92ZSBhbnkgcmVmZXJlbmNlcyB0byB0aGlzIGVsZW1lbnQuXG4gICAgZm9yIChjb25zdCBbY29tcG9uZW50TmFtZSwgZWxlbWVudHNdIG9mIHRoaXMuY29tcG9uZW50REIpIHtcbiAgICAgIGZvciAobGV0IGkgPSBlbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICBpZiAoZWxlbWVudHNbaV0uZWxlbWVudCA9PT0gZWxlbWVudCkge1xuICAgICAgICAgIGVsZW1lbnRzLnNwbGljZShpLCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gQ2xlYW4gdXAgdGhlIGNvbXBvbmVudCBtYXAgZW50cnkgaWYgdGhlIGxpc3QgaXMgZW1wdHkuXG4gICAgICBpZiAoIWVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudERCLmRlbGV0ZShjb21wb25lbnROYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIHRoZW1lIG1hbmFnZXIuXG4gICAqXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICogQGludGVybmFsXG4gICAqL1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMub3duZXJfID0gbnVsbDtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ251bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgICAvLyAnVGhlbWUnLlxuICAgIHRoaXMudGhlbWUgPSBudWxsIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFR5cGUgJ251bGwnIGlzIG5vdCBhc3NpZ25hYmxlIHRvIHR5cGVcbiAgICAvLyAnV29ya3NwYWNlW10nLlxuICAgIHRoaXMuc3Vic2NyaWJlZFdvcmtzcGFjZXNfID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG4gICAgdGhpcy5jb21wb25lbnREQi5jbGVhcigpO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgVGhlbWVNYW5hZ2VyIHtcbiAgLyoqIFRoZSB0eXBlIGZvciBhIEJsb2NrbHkgVUkgQ29tcG9uZW50LiAqL1xuICBleHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudCB7XG4gICAgZWxlbWVudDogRWxlbWVudDtcbiAgICBwcm9wZXJ0eU5hbWU6IHN0cmluZztcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBDb21wb25lbnQgPSBUaGVtZU1hbmFnZXIuQ29tcG9uZW50O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IGVuY2Fwc3VsYXRlcyBsb2dpYyBmb3IgY2hlY2tpbmcgd2hldGhlciBhXG4gKiBwb3RlbnRpYWwgY29ubmVjdGlvbiBpcyBzYWZlIGFuZCB2YWxpZC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Db25uZWN0aW9uQ2hlY2tlcicpO1xuXG5pbXBvcnQgKiBhcyBjb21tb24gZnJvbSAnLi9jb21tb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9ufSBmcm9tICcuL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi9jb25uZWN0aW9uX3R5cGUuanMnO1xuaW1wb3J0IHR5cGUge0lDb25uZWN0aW9uQ2hlY2tlcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfY29ubmVjdGlvbl9jaGVja2VyLmpzJztcbmltcG9ydCAqIGFzIGludGVybmFsQ29uc3RhbnRzIGZyb20gJy4vaW50ZXJuYWxfY29uc3RhbnRzLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlcmVkQ29ubmVjdGlvbn0gZnJvbSAnLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBjb25uZWN0aW9uIHR5cGUgY2hlY2tpbmcgbG9naWMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuQ29ubmVjdGlvbkNoZWNrZXJcbiAqL1xuZXhwb3J0IGNsYXNzIENvbm5lY3Rpb25DaGVja2VyIGltcGxlbWVudHMgSUNvbm5lY3Rpb25DaGVja2VyIHtcbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhlIGN1cnJlbnQgY29ubmVjdGlvbiBjYW4gY29ubmVjdCB3aXRoIHRoZSB0YXJnZXRcbiAgICogY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGEgQ29ubmVjdGlvbiB0byBjaGVjayBjb21wYXRpYmlsaXR5IHdpdGguXG4gICAqIEBwYXJhbSBiIENvbm5lY3Rpb24gdG8gY2hlY2sgY29tcGF0aWJpbGl0eSB3aXRoLlxuICAgKiBAcGFyYW0gaXNEcmFnZ2luZyBUcnVlIGlmIHRoZSBjb25uZWN0aW9uIGlzIGJlaW5nIG1hZGUgYnkgZHJhZ2dpbmcgYSBibG9jay5cbiAgICogQHBhcmFtIG9wdF9kaXN0YW5jZSBUaGUgbWF4IGFsbG93YWJsZSBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBjb25uZWN0aW9ucyBmb3JcbiAgICogICAgIGRyYWcgY2hlY2tzLlxuICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBjb25uZWN0aW9uIGlzIGxlZ2FsLlxuICAgKi9cbiAgY2FuQ29ubmVjdChcbiAgICAgIGE6IENvbm5lY3Rpb258bnVsbCwgYjogQ29ubmVjdGlvbnxudWxsLCBpc0RyYWdnaW5nOiBib29sZWFuLFxuICAgICAgb3B0X2Rpc3RhbmNlPzogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY2FuQ29ubmVjdFdpdGhSZWFzb24oYSwgYiwgaXNEcmFnZ2luZywgb3B0X2Rpc3RhbmNlKSA9PT1cbiAgICAgICAgQ29ubmVjdGlvbi5DQU5fQ09OTkVDVDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3Mgd2hldGhlciB0aGUgY3VycmVudCBjb25uZWN0aW9uIGNhbiBjb25uZWN0IHdpdGggdGhlIHRhcmdldFxuICAgKiBjb25uZWN0aW9uLCBhbmQgcmV0dXJuIGFuIGVycm9yIGNvZGUgaWYgdGhlcmUgYXJlIHByb2JsZW1zLlxuICAgKlxuICAgKiBAcGFyYW0gYSBDb25uZWN0aW9uIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkgd2l0aC5cbiAgICogQHBhcmFtIGIgQ29ubmVjdGlvbiB0byBjaGVjayBjb21wYXRpYmlsaXR5IHdpdGguXG4gICAqIEBwYXJhbSBpc0RyYWdnaW5nIFRydWUgaWYgdGhlIGNvbm5lY3Rpb24gaXMgYmVpbmcgbWFkZSBieSBkcmFnZ2luZyBhIGJsb2NrLlxuICAgKiBAcGFyYW0gb3B0X2Rpc3RhbmNlIFRoZSBtYXggYWxsb3dhYmxlIGRpc3RhbmNlIGJldHdlZW4gdGhlIGNvbm5lY3Rpb25zIGZvclxuICAgKiAgICAgZHJhZyBjaGVja3MuXG4gICAqIEByZXR1cm5zIENvbm5lY3Rpb24uQ0FOX0NPTk5FQ1QgaWYgdGhlIGNvbm5lY3Rpb24gaXMgbGVnYWwsIGFuIGVycm9yIGNvZGVcbiAgICogICAgIG90aGVyd2lzZS5cbiAgICovXG4gIGNhbkNvbm5lY3RXaXRoUmVhc29uKFxuICAgICAgYTogQ29ubmVjdGlvbnxudWxsLCBiOiBDb25uZWN0aW9ufG51bGwsIGlzRHJhZ2dpbmc6IGJvb2xlYW4sXG4gICAgICBvcHRfZGlzdGFuY2U/OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IHNhZmV0eSA9IHRoaXMuZG9TYWZldHlDaGVja3MoYSwgYik7XG4gICAgaWYgKHNhZmV0eSAhPT0gQ29ubmVjdGlvbi5DQU5fQ09OTkVDVCkge1xuICAgICAgcmV0dXJuIHNhZmV0eTtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgc2FmZXR5IGNoZWNrcyBwYXNzZWQsIGJvdGggY29ubmVjdGlvbnMgYXJlIG5vbi1udWxsLlxuICAgIGNvbnN0IGNvbm5PbmUgPSBhITtcbiAgICBjb25zdCBjb25uVHdvID0gYiE7XG4gICAgaWYgKCF0aGlzLmRvVHlwZUNoZWNrcyhjb25uT25lLCBjb25uVHdvKSkge1xuICAgICAgcmV0dXJuIENvbm5lY3Rpb24uUkVBU09OX0NIRUNLU19GQUlMRUQ7XG4gICAgfVxuXG4gICAgaWYgKGlzRHJhZ2dpbmcgJiZcbiAgICAgICAgIXRoaXMuZG9EcmFnQ2hlY2tzKFxuICAgICAgICAgICAgYSBhcyBSZW5kZXJlZENvbm5lY3Rpb24sIGIgYXMgUmVuZGVyZWRDb25uZWN0aW9uLFxuICAgICAgICAgICAgb3B0X2Rpc3RhbmNlIHx8IDApKSB7XG4gICAgICByZXR1cm4gQ29ubmVjdGlvbi5SRUFTT05fRFJBR19DSEVDS1NfRkFJTEVEO1xuICAgIH1cblxuICAgIHJldHVybiBDb25uZWN0aW9uLkNBTl9DT05ORUNUO1xuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgdGhhdCB0cmFuc2xhdGVzIGEgY29ubmVjdGlvbiBlcnJvciBjb2RlIGludG8gYSBzdHJpbmcuXG4gICAqXG4gICAqIEBwYXJhbSBlcnJvckNvZGUgVGhlIGVycm9yIGNvZGUuXG4gICAqIEBwYXJhbSBhIE9uZSBvZiB0aGUgdHdvIGNvbm5lY3Rpb25zIGJlaW5nIGNoZWNrZWQuXG4gICAqIEBwYXJhbSBiIFRoZSBzZWNvbmQgb2YgdGhlIHR3byBjb25uZWN0aW9ucyBiZWluZyBjaGVja2VkLlxuICAgKiBAcmV0dXJucyBBIGRldmVsb3Blci1yZWFkYWJsZSBlcnJvciBzdHJpbmcuXG4gICAqL1xuICBnZXRFcnJvck1lc3NhZ2UoZXJyb3JDb2RlOiBudW1iZXIsIGE6IENvbm5lY3Rpb258bnVsbCwgYjogQ29ubmVjdGlvbnxudWxsKTpcbiAgICAgIHN0cmluZyB7XG4gICAgc3dpdGNoIChlcnJvckNvZGUpIHtcbiAgICAgIGNhc2UgQ29ubmVjdGlvbi5SRUFTT05fU0VMRl9DT05ORUNUSU9OOlxuICAgICAgICByZXR1cm4gJ0F0dGVtcHRlZCB0byBjb25uZWN0IGEgYmxvY2sgdG8gaXRzZWxmLic7XG4gICAgICBjYXNlIENvbm5lY3Rpb24uUkVBU09OX0RJRkZFUkVOVF9XT1JLU1BBQ0VTOlxuICAgICAgICAvLyBVc3VhbGx5IHRoaXMgbWVhbnMgb25lIGJsb2NrIGhhcyBiZWVuIGRlbGV0ZWQuXG4gICAgICAgIHJldHVybiAnQmxvY2tzIG5vdCBvbiBzYW1lIHdvcmtzcGFjZS4nO1xuICAgICAgY2FzZSBDb25uZWN0aW9uLlJFQVNPTl9XUk9OR19UWVBFOlxuICAgICAgICByZXR1cm4gJ0F0dGVtcHQgdG8gY29ubmVjdCBpbmNvbXBhdGlibGUgdHlwZXMuJztcbiAgICAgIGNhc2UgQ29ubmVjdGlvbi5SRUFTT05fVEFSR0VUX05VTEw6XG4gICAgICAgIHJldHVybiAnVGFyZ2V0IGNvbm5lY3Rpb24gaXMgbnVsbC4nO1xuICAgICAgY2FzZSBDb25uZWN0aW9uLlJFQVNPTl9DSEVDS1NfRkFJTEVEOiB7XG4gICAgICAgIGNvbnN0IGNvbm5PbmUgPSBhITtcbiAgICAgICAgY29uc3QgY29ublR3byA9IGIhO1xuICAgICAgICBsZXQgbXNnID0gJ0Nvbm5lY3Rpb24gY2hlY2tzIGZhaWxlZC4gJztcbiAgICAgICAgbXNnICs9IGNvbm5PbmUgKyAnIGV4cGVjdGVkICcgKyBjb25uT25lLmdldENoZWNrKCkgKyAnLCBmb3VuZCAnICtcbiAgICAgICAgICAgIGNvbm5Ud28uZ2V0Q2hlY2soKTtcbiAgICAgICAgcmV0dXJuIG1zZztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29ubmVjdGlvbi5SRUFTT05fU0hBRE9XX1BBUkVOVDpcbiAgICAgICAgcmV0dXJuICdDb25uZWN0aW5nIG5vbi1zaGFkb3cgdG8gc2hhZG93IGJsb2NrLic7XG4gICAgICBjYXNlIENvbm5lY3Rpb24uUkVBU09OX0RSQUdfQ0hFQ0tTX0ZBSUxFRDpcbiAgICAgICAgcmV0dXJuICdEcmFnIGNoZWNrcyBmYWlsZWQuJztcbiAgICAgIGNhc2UgQ29ubmVjdGlvbi5SRUFTT05fUFJFVklPVVNfQU5EX09VVFBVVDpcbiAgICAgICAgcmV0dXJuICdCbG9jayB3b3VsZCBoYXZlIGFuIG91dHB1dCBhbmQgYSBwcmV2aW91cyBjb25uZWN0aW9uLic7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJ1Vua25vd24gY29ubmVjdGlvbiBmYWlsdXJlOiB0aGlzIHNob3VsZCBuZXZlciBoYXBwZW4hJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgdGhhdCBjb25uZWN0aW5nIHRoZSBnaXZlbiBjb25uZWN0aW9ucyBpcyBzYWZlLCBtZWFuaW5nIHRoYXQgaXQgd291bGRcbiAgICogbm90IGJyZWFrIGFueSBvZiBCbG9ja2x5J3MgYmFzaWMgYXNzdW1wdGlvbnMgKGUuZy4gbm8gc2VsZiBjb25uZWN0aW9ucykuXG4gICAqXG4gICAqIEBwYXJhbSBhIFRoZSBmaXJzdCBvZiB0aGUgY29ubmVjdGlvbnMgdG8gY2hlY2suXG4gICAqIEBwYXJhbSBiIFRoZSBzZWNvbmQgb2YgdGhlIGNvbm5lY3Rpb25zIHRvIGNoZWNrLlxuICAgKiBAcmV0dXJucyBBbiBlbnVtIHdpdGggdGhlIHJlYXNvbiB0aGlzIGNvbm5lY3Rpb24gaXMgc2FmZSBvciB1bnNhZmUuXG4gICAqL1xuICBkb1NhZmV0eUNoZWNrcyhhOiBDb25uZWN0aW9ufG51bGwsIGI6IENvbm5lY3Rpb258bnVsbCk6IG51bWJlciB7XG4gICAgaWYgKCFhIHx8ICFiKSB7XG4gICAgICByZXR1cm4gQ29ubmVjdGlvbi5SRUFTT05fVEFSR0VUX05VTEw7XG4gICAgfVxuICAgIGxldCBzdXBlcmlvckJsb2NrO1xuICAgIGxldCBpbmZlcmlvckJsb2NrO1xuICAgIGxldCBzdXBlcmlvckNvbm5lY3Rpb247XG4gICAgbGV0IGluZmVyaW9yQ29ubmVjdGlvbjtcbiAgICBpZiAoYS5pc1N1cGVyaW9yKCkpIHtcbiAgICAgIHN1cGVyaW9yQmxvY2sgPSBhLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgICBpbmZlcmlvckJsb2NrID0gYi5nZXRTb3VyY2VCbG9jaygpO1xuICAgICAgc3VwZXJpb3JDb25uZWN0aW9uID0gYTtcbiAgICAgIGluZmVyaW9yQ29ubmVjdGlvbiA9IGI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGluZmVyaW9yQmxvY2sgPSBhLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgICBzdXBlcmlvckJsb2NrID0gYi5nZXRTb3VyY2VCbG9jaygpO1xuICAgICAgaW5mZXJpb3JDb25uZWN0aW9uID0gYTtcbiAgICAgIHN1cGVyaW9yQ29ubmVjdGlvbiA9IGI7XG4gICAgfVxuICAgIGlmIChzdXBlcmlvckJsb2NrID09PSBpbmZlcmlvckJsb2NrKSB7XG4gICAgICByZXR1cm4gQ29ubmVjdGlvbi5SRUFTT05fU0VMRl9DT05ORUNUSU9OO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGluZmVyaW9yQ29ubmVjdGlvbi50eXBlICE9PVxuICAgICAgICBpbnRlcm5hbENvbnN0YW50cy5PUFBPU0lURV9UWVBFW3N1cGVyaW9yQ29ubmVjdGlvbi50eXBlXSkge1xuICAgICAgcmV0dXJuIENvbm5lY3Rpb24uUkVBU09OX1dST05HX1RZUEU7XG4gICAgfSBlbHNlIGlmIChzdXBlcmlvckJsb2NrLndvcmtzcGFjZSAhPT0gaW5mZXJpb3JCbG9jay53b3Jrc3BhY2UpIHtcbiAgICAgIHJldHVybiBDb25uZWN0aW9uLlJFQVNPTl9ESUZGRVJFTlRfV09SS1NQQUNFUztcbiAgICB9IGVsc2UgaWYgKHN1cGVyaW9yQmxvY2suaXNTaGFkb3coKSAmJiAhaW5mZXJpb3JCbG9jay5pc1NoYWRvdygpKSB7XG4gICAgICByZXR1cm4gQ29ubmVjdGlvbi5SRUFTT05fU0hBRE9XX1BBUkVOVDtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICBpbmZlcmlvckNvbm5lY3Rpb24udHlwZSA9PT0gQ29ubmVjdGlvblR5cGUuT1VUUFVUX1ZBTFVFICYmXG4gICAgICAgIGluZmVyaW9yQmxvY2sucHJldmlvdXNDb25uZWN0aW9uICYmXG4gICAgICAgIGluZmVyaW9yQmxvY2sucHJldmlvdXNDb25uZWN0aW9uLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgIHJldHVybiBDb25uZWN0aW9uLlJFQVNPTl9QUkVWSU9VU19BTkRfT1VUUFVUO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGluZmVyaW9yQ29ubmVjdGlvbi50eXBlID09PSBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlQgJiZcbiAgICAgICAgaW5mZXJpb3JCbG9jay5vdXRwdXRDb25uZWN0aW9uICYmXG4gICAgICAgIGluZmVyaW9yQmxvY2sub3V0cHV0Q29ubmVjdGlvbi5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICByZXR1cm4gQ29ubmVjdGlvbi5SRUFTT05fUFJFVklPVVNfQU5EX09VVFBVVDtcbiAgICB9XG4gICAgcmV0dXJuIENvbm5lY3Rpb24uQ0FOX0NPTk5FQ1Q7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgd2hldGhlciB0aGlzIGNvbm5lY3Rpb24gaXMgY29tcGF0aWJsZSB3aXRoIGFub3RoZXIgY29ubmVjdGlvbiB3aXRoXG4gICAqIHJlc3BlY3QgdG8gdGhlIHZhbHVlIHR5cGUgc3lzdGVtLiAgRS5nLiBzcXVhcmVfcm9vdChcIkhlbGxvXCIpIGlzIG5vdFxuICAgKiBjb21wYXRpYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gYSBDb25uZWN0aW9uIHRvIGNvbXBhcmUuXG4gICAqIEBwYXJhbSBiIENvbm5lY3Rpb24gdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBjb25uZWN0aW9ucyBzaGFyZSBhIHR5cGUuXG4gICAqL1xuICBkb1R5cGVDaGVja3MoYTogQ29ubmVjdGlvbiwgYjogQ29ubmVjdGlvbik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGNoZWNrQXJyYXlPbmUgPSBhLmdldENoZWNrKCk7XG4gICAgY29uc3QgY2hlY2tBcnJheVR3byA9IGIuZ2V0Q2hlY2soKTtcblxuICAgIGlmICghY2hlY2tBcnJheU9uZSB8fCAhY2hlY2tBcnJheVR3bykge1xuICAgICAgLy8gT25lIG9yIGJvdGggc2lkZXMgYXJlIHByb21pc2N1b3VzIGVub3VnaCB0aGF0IGFueXRoaW5nIHdpbGwgZml0LlxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIEZpbmQgYW55IGludGVyc2VjdGlvbiBpbiB0aGUgY2hlY2sgbGlzdHMuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGVja0FycmF5T25lLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY2hlY2tBcnJheVR3by5pbmRleE9mKGNoZWNrQXJyYXlPbmVbaV0pICE9PSAtMSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gTm8gaW50ZXJzZWN0aW9uLlxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRoaXMgY29ubmVjdGlvbiBjYW4gYmUgbWFkZSBieSBkcmFnZ2luZy5cbiAgICpcbiAgICogQHBhcmFtIGEgQ29ubmVjdGlvbiB0byBjb21wYXJlLlxuICAgKiBAcGFyYW0gYiBDb25uZWN0aW9uIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBtYXhpbXVtIGFsbG93YWJsZSBkaXN0YW5jZSBiZXR3ZWVuIGNvbm5lY3Rpb25zLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBjb25uZWN0aW9uIGlzIGFsbG93ZWQgZHVyaW5nIGEgZHJhZy5cbiAgICovXG4gIGRvRHJhZ0NoZWNrcyhhOiBSZW5kZXJlZENvbm5lY3Rpb24sIGI6IFJlbmRlcmVkQ29ubmVjdGlvbiwgZGlzdGFuY2U6IG51bWJlcik6XG4gICAgICBib29sZWFuIHtcbiAgICBpZiAoYS5kaXN0YW5jZUZyb20oYikgPiBkaXN0YW5jZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIERvbid0IGNvbnNpZGVyIGluc2VydGlvbiBtYXJrZXJzLlxuICAgIGlmIChiLmdldFNvdXJjZUJsb2NrKCkuaXNJbnNlcnRpb25NYXJrZXIoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHN3aXRjaCAoYi50eXBlKSB7XG4gICAgICBjYXNlIENvbm5lY3Rpb25UeXBlLlBSRVZJT1VTX1NUQVRFTUVOVDpcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FuQ29ubmVjdFRvUHJldmlvdXNfKGEsIGIpO1xuICAgICAgY2FzZSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUU6IHtcbiAgICAgICAgLy8gRG9uJ3Qgb2ZmZXIgdG8gY29ubmVjdCBhbiBhbHJlYWR5IGNvbm5lY3RlZCBsZWZ0IChtYWxlKSB2YWx1ZSBwbHVnIHRvXG4gICAgICAgIC8vIGFuIGF2YWlsYWJsZSByaWdodCAoZmVtYWxlKSB2YWx1ZSBwbHVnLlxuICAgICAgICBpZiAoYi5pc0Nvbm5lY3RlZCgpICYmICFiLnRhcmdldEJsb2NrKCkhLmlzSW5zZXJ0aW9uTWFya2VyKCkgfHxcbiAgICAgICAgICAgIGEuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29ubmVjdGlvblR5cGUuSU5QVVRfVkFMVUU6IHtcbiAgICAgICAgLy8gT2ZmZXJpbmcgdG8gY29ubmVjdCB0aGUgbGVmdCAobWFsZSkgb2YgYSB2YWx1ZSBibG9jayB0byBhbiBhbHJlYWR5XG4gICAgICAgIC8vIGNvbm5lY3RlZCB2YWx1ZSBwYWlyIGlzIG9rLCB3ZSdsbCBzcGxpY2UgaXQgaW4uXG4gICAgICAgIC8vIEhvd2V2ZXIsIGRvbid0IG9mZmVyIHRvIHNwbGljZSBpbnRvIGFuIGltbW92YWJsZSBibG9jay5cbiAgICAgICAgaWYgKGIuaXNDb25uZWN0ZWQoKSAmJiAhYi50YXJnZXRCbG9jaygpIS5pc01vdmFibGUoKSAmJlxuICAgICAgICAgICAgIWIudGFyZ2V0QmxvY2soKSEuaXNTaGFkb3coKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQ6IHtcbiAgICAgICAgLy8gRG9uJ3QgbGV0IGEgYmxvY2sgd2l0aCBubyBuZXh0IGNvbm5lY3Rpb24gYnVtcCBvdGhlciBibG9ja3Mgb3V0IG9mXG4gICAgICAgIC8vIHRoZSBzdGFjay4gIEJ1dCBjb3ZlcmluZyB1cCBhIHNoYWRvdyBibG9jayBvciBzdGFjayBvZiBzaGFkb3cgYmxvY2tzXG4gICAgICAgIC8vIGlzIGZpbmUuICBTaW1pbGFybHksIHJlcGxhY2luZyBhIHRlcm1pbmFsIHN0YXRlbWVudCB3aXRoIGFub3RoZXJcbiAgICAgICAgLy8gdGVybWluYWwgc3RhdGVtZW50IGlzIGFsbG93ZWQuXG4gICAgICAgIGlmIChiLmlzQ29ubmVjdGVkKCkgJiYgIWEuZ2V0U291cmNlQmxvY2soKS5uZXh0Q29ubmVjdGlvbiAmJlxuICAgICAgICAgICAgIWIudGFyZ2V0QmxvY2soKSEuaXNTaGFkb3coKSAmJiBiLnRhcmdldEJsb2NrKCkhLm5leHRDb25uZWN0aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gVW5leHBlY3RlZCBjb25uZWN0aW9uIHR5cGUuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBEb24ndCBsZXQgYmxvY2tzIHRyeSB0byBjb25uZWN0IHRvIHRoZW1zZWx2ZXMgb3Igb25lcyB0aGV5IG5lc3QuXG4gICAgaWYgKGNvbW1vbi5kcmFnZ2luZ0Nvbm5lY3Rpb25zLmluZGV4T2YoYikgIT09IC0xKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBkcmFnIGNoZWNraW5nLlxuICAgKlxuICAgKiBAcGFyYW0gYSBUaGUgY29ubmVjdGlvbiB0byBjaGVjaywgd2hpY2ggbXVzdCBiZSBhIHN0YXRlbWVudCBpbnB1dCBvciBuZXh0XG4gICAqICAgICBjb25uZWN0aW9uLlxuICAgKiBAcGFyYW0gYiBBIG5lYXJieSBjb25uZWN0aW9uIHRvIGNoZWNrLCB3aGljaCBtdXN0IGJlIGEgcHJldmlvdXMgY29ubmVjdGlvbi5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgY29ubmVjdGlvbiBpcyBhbGxvd2VkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgY2FuQ29ubmVjdFRvUHJldmlvdXNfKGE6IENvbm5lY3Rpb24sIGI6IENvbm5lY3Rpb24pOiBib29sZWFuIHtcbiAgICBpZiAoYS50YXJnZXRDb25uZWN0aW9uKSB7XG4gICAgICAvLyBUaGlzIGNvbm5lY3Rpb24gaXMgYWxyZWFkeSBvY2N1cGllZC5cbiAgICAgIC8vIEEgbmV4dCBjb25uZWN0aW9uIHdpbGwgbmV2ZXIgZGlzY29ubmVjdCBpdHNlbGYgbWlkLWRyYWcuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gRG9uJ3QgbGV0IGJsb2NrcyB0cnkgdG8gY29ubmVjdCB0byB0aGVtc2VsdmVzIG9yIG9uZXMgdGhleSBuZXN0LlxuICAgIGlmIChjb21tb24uZHJhZ2dpbmdDb25uZWN0aW9ucy5pbmRleE9mKGIpICE9PSAtMSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICghYi50YXJnZXRDb25uZWN0aW9uKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXRCbG9jayA9IGIudGFyZ2V0QmxvY2soKTtcbiAgICAvLyBJZiBpdCBpcyBjb25uZWN0ZWQgdG8gYSByZWFsIGJsb2NrLCBnYW1lIG92ZXIuXG4gICAgaWYgKCF0YXJnZXRCbG9jayEuaXNJbnNlcnRpb25NYXJrZXIoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBJZiBpdCdzIGNvbm5lY3RlZCB0byBhbiBpbnNlcnRpb24gbWFya2VyIGJ1dCB0aGF0IGluc2VydGlvbiBtYXJrZXJcbiAgICAvLyBpcyB0aGUgZmlyc3QgYmxvY2sgaW4gYSBzdGFjaywgaXQncyBzdGlsbCBmaW5lLiAgSWYgdGhhdCBpbnNlcnRpb25cbiAgICAvLyBtYXJrZXIgaXMgaW4gdGhlIG1pZGRsZSBvZiBhIHN0YWNrLCBpdCB3b24ndCB3b3JrLlxuICAgIHJldHVybiAhdGFyZ2V0QmxvY2shLmdldFByZXZpb3VzQmxvY2soKTtcbiAgfVxufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihcbiAgICByZWdpc3RyeS5UeXBlLkNPTk5FQ1RJT05fQ0hFQ0tFUiwgcmVnaXN0cnkuREVGQVVMVCwgQ29ubmVjdGlvbkNoZWNrZXIpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzZXMgZm9yIGFsbCB0eXBlcyBvZiB2YXJpYWJsZSBldmVudHMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLlZhckRlbGV0ZScpO1xuXG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7VmFyaWFibGVNb2RlbH0gZnJvbSAnLi4vdmFyaWFibGVfbW9kZWwuanMnO1xuXG5pbXBvcnQge1ZhckJhc2UsIFZhckJhc2VKc29ufSBmcm9tICcuL2V2ZW50c192YXJfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIHZhcmlhYmxlIGRlbGV0aW9uIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5WYXJEZWxldGVcbiAqL1xuZXhwb3J0IGNsYXNzIFZhckRlbGV0ZSBleHRlbmRzIFZhckJhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5WQVJfREVMRVRFO1xuICB2YXJUeXBlPzogc3RyaW5nO1xuICB2YXJOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X3ZhcmlhYmxlIFRoZSBkZWxldGVkIHZhcmlhYmxlLiBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfdmFyaWFibGU/OiBWYXJpYWJsZU1vZGVsKSB7XG4gICAgc3VwZXIob3B0X3ZhcmlhYmxlKTtcblxuICAgIGlmICghb3B0X3ZhcmlhYmxlKSB7XG4gICAgICByZXR1cm47ICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgfVxuICAgIHRoaXMudmFyVHlwZSA9IG9wdF92YXJpYWJsZS50eXBlO1xuICAgIHRoaXMudmFyTmFtZSA9IG9wdF92YXJpYWJsZS5uYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBWYXJEZWxldGVKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgVmFyRGVsZXRlSnNvbjtcbiAgICBpZiAoIXRoaXMudmFyVHlwZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgdmFyIHR5cGUgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhcmlhYmxlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnZhck5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHZhciBuYW1lIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YXJpYWJsZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ3ZhclR5cGUnXSA9IHRoaXMudmFyVHlwZTtcbiAgICBqc29uWyd2YXJOYW1lJ10gPSB0aGlzLnZhck5hbWU7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogVmFyRGVsZXRlSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5WYXJEZWxldGUucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy52YXJUeXBlID0ganNvblsndmFyVHlwZSddO1xuICAgIHRoaXMudmFyTmFtZSA9IGpzb25bJ3Zhck5hbWUnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgVmFyRGVsZXRlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0IHBhcmFtZXRlcnNcbiAgICogICAgIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mIHBhcmFtZXRlcnMgdG9cbiAgICogICAgIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogVmFyRGVsZXRlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIFZhckRlbGV0ZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBWYXJEZWxldGUoKSkgYXMgVmFyRGVsZXRlO1xuICAgIG5ld0V2ZW50LnZhclR5cGUgPSBqc29uWyd2YXJUeXBlJ107XG4gICAgbmV3RXZlbnQudmFyTmFtZSA9IGpzb25bJ3Zhck5hbWUnXTtcbiAgICByZXR1cm4gbmV3RXZlbnQ7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgdmFyaWFibGUgZGVsZXRpb24gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBmb3J3YXJkIFRydWUgaWYgcnVuIGZvcndhcmQsIGZhbHNlIGlmIHJ1biBiYWNrd2FyZCAodW5kbykuXG4gICAqL1xuICBvdmVycmlkZSBydW4oZm9yd2FyZDogYm9vbGVhbikge1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCk7XG4gICAgaWYgKCF0aGlzLnZhcklkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSB2YXIgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhcmlhYmxlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnZhck5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHZhciBuYW1lIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YXJpYWJsZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICB3b3Jrc3BhY2UuZGVsZXRlVmFyaWFibGVCeUlkKHRoaXMudmFySWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3b3Jrc3BhY2UuY3JlYXRlVmFyaWFibGUodGhpcy52YXJOYW1lLCB0aGlzLnZhclR5cGUsIHRoaXMudmFySWQpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhckRlbGV0ZUpzb24gZXh0ZW5kcyBWYXJCYXNlSnNvbiB7XG4gIHZhclR5cGU6IHN0cmluZztcbiAgdmFyTmFtZTogc3RyaW5nO1xufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihyZWdpc3RyeS5UeXBlLkVWRU5ULCBldmVudFV0aWxzLlZBUl9ERUxFVEUsIFZhckRlbGV0ZSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgdmFyaWFibGUgcmVuYW1lIGV2ZW50LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5WYXJSZW5hbWUnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge1ZhcmlhYmxlTW9kZWx9IGZyb20gJy4uL3ZhcmlhYmxlX21vZGVsLmpzJztcblxuaW1wb3J0IHtWYXJCYXNlLCBWYXJCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfdmFyX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB2YXJpYWJsZSByZW5hbWUgZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLlZhclJlbmFtZVxuICovXG5leHBvcnQgY2xhc3MgVmFyUmVuYW1lIGV4dGVuZHMgVmFyQmFzZSB7XG4gIG92ZXJyaWRlIHR5cGUgPSBldmVudFV0aWxzLlZBUl9SRU5BTUU7XG4gIG9sZE5hbWU/OiBzdHJpbmc7XG4gIG5ld05hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfdmFyaWFibGUgVGhlIHJlbmFtZWQgdmFyaWFibGUuIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG5ld05hbWUgVGhlIG5ldyBuYW1lIHRoZSB2YXJpYWJsZSB3aWxsIGJlIGNoYW5nZWQgdG8uXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfdmFyaWFibGU/OiBWYXJpYWJsZU1vZGVsLCBuZXdOYW1lPzogc3RyaW5nKSB7XG4gICAgc3VwZXIob3B0X3ZhcmlhYmxlKTtcblxuICAgIGlmICghb3B0X3ZhcmlhYmxlKSB7XG4gICAgICByZXR1cm47ICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgfVxuICAgIHRoaXMub2xkTmFtZSA9IG9wdF92YXJpYWJsZS5uYW1lO1xuICAgIHRoaXMubmV3TmFtZSA9IHR5cGVvZiBuZXdOYW1lID09PSAndW5kZWZpbmVkJyA/ICcnIDogbmV3TmFtZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSB0b0pzb24oKTogVmFyUmVuYW1lSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIFZhclJlbmFtZUpzb247XG4gICAgaWYgKCF0aGlzLm9sZE5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIG9sZCB2YXIgbmFtZSBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgdmFyaWFibGUgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMubmV3TmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgbmV3IHZhciBuYW1lIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YWx1ZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ29sZE5hbWUnXSA9IHRoaXMub2xkTmFtZTtcbiAgICBqc29uWyduZXdOYW1lJ10gPSB0aGlzLm5ld05hbWU7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogVmFyUmVuYW1lSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5WYXJSZW5hbWUucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy5vbGROYW1lID0ganNvblsnb2xkTmFtZSddO1xuICAgIHRoaXMubmV3TmFtZSA9IGpzb25bJ25ld05hbWUnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgVmFyUmVuYW1lLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0IHBhcmFtZXRlcnNcbiAgICogICAgIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mIHBhcmFtZXRlcnMgdG9cbiAgICogICAgIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogVmFyUmVuYW1lSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIFZhclJlbmFtZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBWYXJSZW5hbWUoKSkgYXMgVmFyUmVuYW1lO1xuICAgIG5ld0V2ZW50Lm9sZE5hbWUgPSBqc29uWydvbGROYW1lJ107XG4gICAgbmV3RXZlbnQubmV3TmFtZSA9IGpzb25bJ25ld05hbWUnXTtcbiAgICByZXR1cm4gbmV3RXZlbnQ7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgdmFyaWFibGUgcmVuYW1lIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZm9yd2FyZCBUcnVlIGlmIHJ1biBmb3J3YXJkLCBmYWxzZSBpZiBydW4gYmFja3dhcmQgKHVuZG8pLlxuICAgKi9cbiAgb3ZlcnJpZGUgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmdldEV2ZW50V29ya3NwYWNlXygpO1xuICAgIGlmICghdGhpcy52YXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgdmFyIElEIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YXJpYWJsZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5vbGROYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBvbGQgdmFyIG5hbWUgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhcmlhYmxlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm5ld05hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIG5ldyB2YXIgbmFtZSBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgdmFsdWUgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBpZiAoZm9yd2FyZCkge1xuICAgICAgd29ya3NwYWNlLnJlbmFtZVZhcmlhYmxlQnlJZCh0aGlzLnZhcklkLCB0aGlzLm5ld05hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3b3Jrc3BhY2UucmVuYW1lVmFyaWFibGVCeUlkKHRoaXMudmFySWQsIHRoaXMub2xkTmFtZSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFyUmVuYW1lSnNvbiBleHRlbmRzIFZhckJhc2VKc29uIHtcbiAgb2xkTmFtZTogc3RyaW5nO1xuICBuZXdOYW1lOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuVkFSX1JFTkFNRSwgVmFyUmVuYW1lKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGEgbWFwIG9mIHZhcmlhYmxlcyBhbmQgdGhlaXIgdHlwZXMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuVmFyaWFibGVNYXAnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfdmFyX2RlbGV0ZS5qcyc7XG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c192YXJfcmVuYW1lLmpzJztcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCAqIGFzIGRpYWxvZyBmcm9tICcuL2RpYWxvZy5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB7TXNnfSBmcm9tICcuL21zZy5qcyc7XG5pbXBvcnQge05hbWVzfSBmcm9tICcuL25hbWVzLmpzJztcbmltcG9ydCAqIGFzIGFycmF5VXRpbHMgZnJvbSAnLi91dGlscy9hcnJheS5qcyc7XG5pbXBvcnQgKiBhcyBpZEdlbmVyYXRvciBmcm9tICcuL3V0aWxzL2lkZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7VmFyaWFibGVNb2RlbH0gZnJvbSAnLi92YXJpYWJsZV9tb2RlbC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB2YXJpYWJsZSBtYXAuICBUaGlzIGNvbnRhaW5zIGEgZGljdGlvbmFyeSBkYXRhIHN0cnVjdHVyZSB3aXRoXG4gKiB2YXJpYWJsZSB0eXBlcyBhcyBrZXlzIGFuZCBsaXN0cyBvZiB2YXJpYWJsZXMgYXMgdmFsdWVzLiAgVGhlIGxpc3Qgb2ZcbiAqIHZhcmlhYmxlcyBhcmUgdGhlIHR5cGUgaW5kaWNhdGVkIGJ5IHRoZSBrZXkuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVmFyaWFibGVNYXBcbiAqL1xuZXhwb3J0IGNsYXNzIFZhcmlhYmxlTWFwIHtcbiAgLyoqXG4gICAqIEEgbWFwIGZyb20gdmFyaWFibGUgdHlwZSB0byBsaXN0IG9mIHZhcmlhYmxlIG5hbWVzLiAgVGhlIGxpc3RzIGNvbnRhaW5cbiAgICogYWxsIG9mIHRoZSBuYW1lZCB2YXJpYWJsZXMgaW4gdGhlIHdvcmtzcGFjZSwgaW5jbHVkaW5nIHZhcmlhYmxlcyB0aGF0IGFyZVxuICAgKiBub3QgY3VycmVudGx5IGluIHVzZS5cbiAgICovXG4gIHByaXZhdGUgdmFyaWFibGVNYXAgPSBuZXcgTWFwPHN0cmluZywgVmFyaWFibGVNb2RlbFtdPigpO1xuXG4gIC8qKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdGhpcyBtYXAgYmVsb25ncyB0by4gKi9cbiAgY29uc3RydWN0b3IocHVibGljIHdvcmtzcGFjZTogV29ya3NwYWNlKSB7fVxuXG4gIC8qKiBDbGVhciB0aGUgdmFyaWFibGUgbWFwLiAqL1xuICBjbGVhcigpIHtcbiAgICB0aGlzLnZhcmlhYmxlTWFwLmNsZWFyKCk7XG4gIH1cbiAgLyogQmVnaW4gZnVuY3Rpb25zIGZvciByZW5hbWluZyB2YXJpYWJsZXMuICovXG4gIC8qKlxuICAgKiBSZW5hbWUgdGhlIGdpdmVuIHZhcmlhYmxlIGJ5IHVwZGF0aW5nIGl0cyBuYW1lIGluIHRoZSB2YXJpYWJsZSBtYXAuXG4gICAqXG4gICAqIEBwYXJhbSB2YXJpYWJsZSBWYXJpYWJsZSB0byByZW5hbWUuXG4gICAqIEBwYXJhbSBuZXdOYW1lIE5ldyB2YXJpYWJsZSBuYW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlbmFtZVZhcmlhYmxlKHZhcmlhYmxlOiBWYXJpYWJsZU1vZGVsLCBuZXdOYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAodmFyaWFibGUubmFtZSA9PT0gbmV3TmFtZSkgcmV0dXJuO1xuICAgIGNvbnN0IHR5cGUgPSB2YXJpYWJsZS50eXBlO1xuICAgIGNvbnN0IGNvbmZsaWN0VmFyID0gdGhpcy5nZXRWYXJpYWJsZShuZXdOYW1lLCB0eXBlKTtcbiAgICBjb25zdCBibG9ja3MgPSB0aGlzLndvcmtzcGFjZS5nZXRBbGxCbG9ja3MoZmFsc2UpO1xuICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAodHJ1ZSk7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRoZSBJRHMgbWF5IG1hdGNoIGlmIHRoZSByZW5hbWUgaXMgYSBzaW1wbGUgY2FzZSBjaGFuZ2UgKG5hbWUxIC0+XG4gICAgICAvLyBOYW1lMSkuXG4gICAgICBpZiAoIWNvbmZsaWN0VmFyIHx8IGNvbmZsaWN0VmFyLmdldElkKCkgPT09IHZhcmlhYmxlLmdldElkKCkpIHtcbiAgICAgICAgdGhpcy5yZW5hbWVWYXJpYWJsZUFuZFVzZXNfKHZhcmlhYmxlLCBuZXdOYW1lLCBibG9ja3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZW5hbWVWYXJpYWJsZVdpdGhDb25mbGljdF8oXG4gICAgICAgICAgICB2YXJpYWJsZSwgbmV3TmFtZSwgY29uZmxpY3RWYXIsIGJsb2Nrcyk7XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5hbWUgYSB2YXJpYWJsZSBieSB1cGRhdGluZyBpdHMgbmFtZSBpbiB0aGUgdmFyaWFibGUgbWFwLiBJZGVudGlmeSB0aGVcbiAgICogdmFyaWFibGUgdG8gcmVuYW1lIHdpdGggdGhlIGdpdmVuIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdGhlIHZhcmlhYmxlIHRvIHJlbmFtZS5cbiAgICogQHBhcmFtIG5ld05hbWUgTmV3IHZhcmlhYmxlIG5hbWUuXG4gICAqL1xuICByZW5hbWVWYXJpYWJsZUJ5SWQoaWQ6IHN0cmluZywgbmV3TmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLmdldFZhcmlhYmxlQnlJZChpZCk7XG4gICAgaWYgKCF2YXJpYWJsZSkge1xuICAgICAgdGhyb3cgRXJyb3IoJ1RyaWVkIHRvIHJlbmFtZSBhIHZhcmlhYmxlIHRoYXQgZGlkblxcJ3QgZXhpc3QuIElEOiAnICsgaWQpO1xuICAgIH1cblxuICAgIHRoaXMucmVuYW1lVmFyaWFibGUodmFyaWFibGUsIG5ld05hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgbmFtZSBvZiB0aGUgZ2l2ZW4gdmFyaWFibGUgYW5kIHJlZnJlc2ggYWxsIHJlZmVyZW5jZXMgdG8gaXQuXG4gICAqIFRoZSBuZXcgbmFtZSBtdXN0IG5vdCBjb25mbGljdCB3aXRoIGFueSBleGlzdGluZyB2YXJpYWJsZSBuYW1lcy5cbiAgICpcbiAgICogQHBhcmFtIHZhcmlhYmxlIFZhcmlhYmxlIHRvIHJlbmFtZS5cbiAgICogQHBhcmFtIG5ld05hbWUgTmV3IHZhcmlhYmxlIG5hbWUuXG4gICAqIEBwYXJhbSBibG9ja3MgVGhlIGxpc3Qgb2YgYWxsIGJsb2NrcyBpbiB0aGUgd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZW5hbWVWYXJpYWJsZUFuZFVzZXNfKFxuICAgICAgdmFyaWFibGU6IFZhcmlhYmxlTW9kZWwsIG5ld05hbWU6IHN0cmluZywgYmxvY2tzOiBCbG9ja1tdKSB7XG4gICAgZXZlbnRVdGlscy5maXJlKFxuICAgICAgICBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuVkFSX1JFTkFNRSkpKHZhcmlhYmxlLCBuZXdOYW1lKSk7XG4gICAgdmFyaWFibGUubmFtZSA9IG5ld05hbWU7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGJsb2Nrc1tpXS51cGRhdGVWYXJOYW1lKHZhcmlhYmxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBuYW1lIG9mIHRoZSBnaXZlbiB2YXJpYWJsZSB0byB0aGUgc2FtZSBuYW1lIGFzIGFuIGV4aXN0aW5nXG4gICAqIHZhcmlhYmxlLiAgVGhlIHR3byB2YXJpYWJsZXMgYXJlIGNvYWxlc2NlZCBpbnRvIGEgc2luZ2xlIHZhcmlhYmxlIHdpdGggdGhlXG4gICAqIElEIG9mIHRoZSBleGlzdGluZyB2YXJpYWJsZSB0aGF0IHdhcyBhbHJlYWR5IHVzaW5nIG5ld05hbWUuIFJlZnJlc2ggYWxsXG4gICAqIHJlZmVyZW5jZXMgdG8gdGhlIHZhcmlhYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gdmFyaWFibGUgVmFyaWFibGUgdG8gcmVuYW1lLlxuICAgKiBAcGFyYW0gbmV3TmFtZSBOZXcgdmFyaWFibGUgbmFtZS5cbiAgICogQHBhcmFtIGNvbmZsaWN0VmFyIFRoZSB2YXJpYWJsZSB0aGF0IHdhcyBhbHJlYWR5IHVzaW5nIG5ld05hbWUuXG4gICAqIEBwYXJhbSBibG9ja3MgVGhlIGxpc3Qgb2YgYWxsIGJsb2NrcyBpbiB0aGUgd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZW5hbWVWYXJpYWJsZVdpdGhDb25mbGljdF8oXG4gICAgICB2YXJpYWJsZTogVmFyaWFibGVNb2RlbCwgbmV3TmFtZTogc3RyaW5nLCBjb25mbGljdFZhcjogVmFyaWFibGVNb2RlbCxcbiAgICAgIGJsb2NrczogQmxvY2tbXSkge1xuICAgIGNvbnN0IHR5cGUgPSB2YXJpYWJsZS50eXBlO1xuICAgIGNvbnN0IG9sZENhc2UgPSBjb25mbGljdFZhci5uYW1lO1xuXG4gICAgaWYgKG5ld05hbWUgIT09IG9sZENhc2UpIHtcbiAgICAgIC8vIFNpbXBsZSByZW5hbWUgdG8gY2hhbmdlIHRoZSBjYXNlIGFuZCB1cGRhdGUgcmVmZXJlbmNlcy5cbiAgICAgIHRoaXMucmVuYW1lVmFyaWFibGVBbmRVc2VzXyhjb25mbGljdFZhciwgbmV3TmFtZSwgYmxvY2tzKTtcbiAgICB9XG5cbiAgICAvLyBUaGVzZSBibG9ja3Mgbm93IHJlZmVyIHRvIGEgZGlmZmVyZW50IHZhcmlhYmxlLlxuICAgIC8vIFRoZXNlIHdpbGwgZmlyZSBjaGFuZ2UgZXZlbnRzLlxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBibG9ja3NbaV0ucmVuYW1lVmFyQnlJZCh2YXJpYWJsZS5nZXRJZCgpLCBjb25mbGljdFZhci5nZXRJZCgpKTtcbiAgICB9XG4gICAgLy8gRmluYWxseSBkZWxldGUgdGhlIG9yaWdpbmFsIHZhcmlhYmxlLCB3aGljaCBpcyBub3cgdW5yZWZlcmVuY2VkLlxuICAgIGV2ZW50VXRpbHMuZmlyZShuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuVkFSX0RFTEVURSkpKHZhcmlhYmxlKSk7XG4gICAgLy8gQW5kIHJlbW92ZSBpdCBmcm9tIHRoZSBsaXN0LlxuICAgIGFycmF5VXRpbHMucmVtb3ZlRWxlbSh0aGlzLnZhcmlhYmxlTWFwLmdldCh0eXBlKSEsIHZhcmlhYmxlKTtcbiAgfVxuICAvKiBFbmQgZnVuY3Rpb25zIGZvciByZW5hbWluZyB2YXJpYWJsZXMuICovXG4gIC8qKlxuICAgKiBDcmVhdGUgYSB2YXJpYWJsZSB3aXRoIGEgZ2l2ZW4gbmFtZSwgb3B0aW9uYWwgdHlwZSwgYW5kIG9wdGlvbmFsIElELlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgdmFyaWFibGUuIFRoaXMgbXVzdCBiZSB1bmlxdWUgYWNyb3NzIHZhcmlhYmxlc1xuICAgKiAgICAgYW5kIHByb2NlZHVyZXMuXG4gICAqIEBwYXJhbSBvcHRfdHlwZSBUaGUgdHlwZSBvZiB0aGUgdmFyaWFibGUgbGlrZSAnaW50JyBvciAnc3RyaW5nJy5cbiAgICogICAgIERvZXMgbm90IG5lZWQgdG8gYmUgdW5pcXVlLiBGaWVsZF92YXJpYWJsZSBjYW4gZmlsdGVyIHZhcmlhYmxlcyBiYXNlZFxuICAgKiBvbiB0aGVpciB0eXBlLiBUaGlzIHdpbGwgZGVmYXVsdCB0byAnJyB3aGljaCBpcyBhIHNwZWNpZmljIHR5cGUuXG4gICAqIEBwYXJhbSBvcHRfaWQgVGhlIHVuaXF1ZSBJRCBvZiB0aGUgdmFyaWFibGUuIFRoaXMgd2lsbCBkZWZhdWx0IHRvIGEgVVVJRC5cbiAgICogQHJldHVybnMgVGhlIG5ld2x5IGNyZWF0ZWQgdmFyaWFibGUuXG4gICAqL1xuICBjcmVhdGVWYXJpYWJsZShuYW1lOiBzdHJpbmcsIG9wdF90eXBlPzogc3RyaW5nfG51bGwsIG9wdF9pZD86IHN0cmluZ3xudWxsKTpcbiAgICAgIFZhcmlhYmxlTW9kZWwge1xuICAgIGxldCB2YXJpYWJsZSA9IHRoaXMuZ2V0VmFyaWFibGUobmFtZSwgb3B0X3R5cGUpO1xuICAgIGlmICh2YXJpYWJsZSkge1xuICAgICAgaWYgKG9wdF9pZCAmJiB2YXJpYWJsZS5nZXRJZCgpICE9PSBvcHRfaWQpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAnVmFyaWFibGUgXCInICsgbmFtZSArICdcIiBpcyBhbHJlYWR5IGluIHVzZSBhbmQgaXRzIGlkIGlzIFwiJyArXG4gICAgICAgICAgICB2YXJpYWJsZS5nZXRJZCgpICsgJ1wiIHdoaWNoIGNvbmZsaWN0cyB3aXRoIHRoZSBwYXNzZWQgaW4gJyArXG4gICAgICAgICAgICAnaWQsIFwiJyArIG9wdF9pZCArICdcIi4nKTtcbiAgICAgIH1cbiAgICAgIC8vIFRoZSB2YXJpYWJsZSBhbHJlYWR5IGV4aXN0cyBhbmQgaGFzIHRoZSBzYW1lIElELlxuICAgICAgcmV0dXJuIHZhcmlhYmxlO1xuICAgIH1cbiAgICBpZiAob3B0X2lkICYmIHRoaXMuZ2V0VmFyaWFibGVCeUlkKG9wdF9pZCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdWYXJpYWJsZSBpZCwgXCInICsgb3B0X2lkICsgJ1wiLCBpcyBhbHJlYWR5IGluIHVzZS4nKTtcbiAgICB9XG4gICAgY29uc3QgaWQgPSBvcHRfaWQgfHwgaWRHZW5lcmF0b3IuZ2VuVWlkKCk7XG4gICAgY29uc3QgdHlwZSA9IG9wdF90eXBlIHx8ICcnO1xuICAgIHZhcmlhYmxlID0gbmV3IFZhcmlhYmxlTW9kZWwodGhpcy53b3Jrc3BhY2UsIG5hbWUsIHR5cGUsIGlkKTtcblxuICAgIGNvbnN0IHZhcmlhYmxlcyA9IHRoaXMudmFyaWFibGVNYXAuZ2V0KHR5cGUpIHx8IFtdO1xuICAgIHZhcmlhYmxlcy5wdXNoKHZhcmlhYmxlKTtcbiAgICAvLyBEZWxldGUgdGhlIGxpc3Qgb2YgdmFyaWFibGVzIG9mIHRoaXMgdHlwZSwgYW5kIHJlLWFkZCBpdCBzbyB0aGF0XG4gICAgLy8gdGhlIG1vc3QgcmVjZW50IGFkZGl0aW9uIGlzIGF0IHRoZSBlbmQuXG4gICAgLy8gVGhpcyBpcyB1c2VkIHNvIHRoZSB0b29sYm94J3Mgc2V0IGJsb2NrIGlzIHNldCB0byB0aGUgbW9zdCByZWNlbnRcbiAgICAvLyB2YXJpYWJsZS5cbiAgICB0aGlzLnZhcmlhYmxlTWFwLmRlbGV0ZSh0eXBlKTtcbiAgICB0aGlzLnZhcmlhYmxlTWFwLnNldCh0eXBlLCB2YXJpYWJsZXMpO1xuXG4gICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5WQVJfQ1JFQVRFKSkodmFyaWFibGUpKTtcblxuICAgIHJldHVybiB2YXJpYWJsZTtcbiAgfVxuICAvKiBCZWdpbiBmdW5jdGlvbnMgZm9yIHZhcmlhYmxlIGRlbGV0aW9uLiAqL1xuICAvKipcbiAgICogRGVsZXRlIGEgdmFyaWFibGUuXG4gICAqXG4gICAqIEBwYXJhbSB2YXJpYWJsZSBWYXJpYWJsZSB0byBkZWxldGUuXG4gICAqL1xuICBkZWxldGVWYXJpYWJsZSh2YXJpYWJsZTogVmFyaWFibGVNb2RlbCkge1xuICAgIGNvbnN0IHZhcmlhYmxlSWQgPSB2YXJpYWJsZS5nZXRJZCgpO1xuICAgIGNvbnN0IHZhcmlhYmxlTGlzdCA9IHRoaXMudmFyaWFibGVNYXAuZ2V0KHZhcmlhYmxlLnR5cGUpO1xuICAgIGlmICh2YXJpYWJsZUxpc3QpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyaWFibGVMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRlbXBWYXIgPSB2YXJpYWJsZUxpc3RbaV07XG4gICAgICAgIGlmICh0ZW1wVmFyLmdldElkKCkgPT09IHZhcmlhYmxlSWQpIHtcbiAgICAgICAgICB2YXJpYWJsZUxpc3Quc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGV2ZW50VXRpbHMuZmlyZShcbiAgICAgICAgICAgICAgbmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLlZBUl9ERUxFVEUpKSh2YXJpYWJsZSkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYSB2YXJpYWJsZXMgYnkgdGhlIHBhc3NlZCBpbiBJRCBhbmQgYWxsIG9mIGl0cyB1c2VzIGZyb20gdGhpc1xuICAgKiB3b3Jrc3BhY2UuIE1heSBwcm9tcHQgdGhlIHVzZXIgZm9yIGNvbmZpcm1hdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGlkIElEIG9mIHZhcmlhYmxlIHRvIGRlbGV0ZS5cbiAgICovXG4gIGRlbGV0ZVZhcmlhYmxlQnlJZChpZDogc3RyaW5nKSB7XG4gICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLmdldFZhcmlhYmxlQnlJZChpZCk7XG4gICAgaWYgKHZhcmlhYmxlKSB7XG4gICAgICAvLyBDaGVjayB3aGV0aGVyIHRoaXMgdmFyaWFibGUgaXMgYSBmdW5jdGlvbiBwYXJhbWV0ZXIgYmVmb3JlIGRlbGV0aW5nLlxuICAgICAgY29uc3QgdmFyaWFibGVOYW1lID0gdmFyaWFibGUubmFtZTtcbiAgICAgIGNvbnN0IHVzZXMgPSB0aGlzLmdldFZhcmlhYmxlVXNlc0J5SWQoaWQpO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IHVzZXNbaV07IGkrKykge1xuICAgICAgICBpZiAoYmxvY2sudHlwZSA9PT0gJ3Byb2NlZHVyZXNfZGVmbm9yZXR1cm4nIHx8XG4gICAgICAgICAgICBibG9jay50eXBlID09PSAncHJvY2VkdXJlc19kZWZyZXR1cm4nKSB7XG4gICAgICAgICAgY29uc3QgcHJvY2VkdXJlTmFtZSA9IFN0cmluZyhibG9jay5nZXRGaWVsZFZhbHVlKCdOQU1FJykpO1xuICAgICAgICAgIGNvbnN0IGRlbGV0ZVRleHQgPSBNc2dbJ0NBTk5PVF9ERUxFVEVfVkFSSUFCTEVfUFJPQ0VEVVJFJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCclMScsIHZhcmlhYmxlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCclMicsIHByb2NlZHVyZU5hbWUpO1xuICAgICAgICAgIGRpYWxvZy5hbGVydChkZWxldGVUZXh0KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHVzZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAvLyBDb25maXJtIGJlZm9yZSBkZWxldGluZyBtdWx0aXBsZSBibG9ja3MuXG4gICAgICAgIGNvbnN0IGNvbmZpcm1UZXh0ID0gTXNnWydERUxFVEVfVkFSSUFCTEVfQ09ORklSTUFUSU9OJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJyUxJywgU3RyaW5nKHVzZXMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJyUyJywgdmFyaWFibGVOYW1lKTtcbiAgICAgICAgZGlhbG9nLmNvbmZpcm0oY29uZmlybVRleHQsIChvaykgPT4ge1xuICAgICAgICAgIGlmIChvayAmJiB2YXJpYWJsZSkge1xuICAgICAgICAgICAgdGhpcy5kZWxldGVWYXJpYWJsZUludGVybmFsKHZhcmlhYmxlLCB1c2VzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTm8gY29uZmlybWF0aW9uIG5lY2Vzc2FyeSBmb3IgYSBzaW5nbGUgYmxvY2suXG4gICAgICAgIHRoaXMuZGVsZXRlVmFyaWFibGVJbnRlcm5hbCh2YXJpYWJsZSwgdXNlcyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2FuXFwndCBkZWxldGUgbm9uLWV4aXN0ZW50IHZhcmlhYmxlOiAnICsgaWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgdmFyaWFibGUgYW5kIGFsbCBvZiBpdHMgdXNlcyBmcm9tIHRoaXMgd29ya3NwYWNlIHdpdGhvdXQgYXNraW5nXG4gICAqIHRoZSB1c2VyIGZvciBjb25maXJtYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB2YXJpYWJsZSBWYXJpYWJsZSB0byBkZWxldGUuXG4gICAqIEBwYXJhbSB1c2VzIEFuIGFycmF5IG9mIHVzZXMgb2YgdGhlIHZhcmlhYmxlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRlbGV0ZVZhcmlhYmxlSW50ZXJuYWwodmFyaWFibGU6IFZhcmlhYmxlTW9kZWwsIHVzZXM6IEJsb2NrW10pIHtcbiAgICBjb25zdCBleGlzdGluZ0dyb3VwID0gZXZlbnRVdGlscy5nZXRHcm91cCgpO1xuICAgIGlmICghZXhpc3RpbmdHcm91cCkge1xuICAgICAgZXZlbnRVdGlscy5zZXRHcm91cCh0cnVlKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB1c2VzW2ldLmRpc3Bvc2UodHJ1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmRlbGV0ZVZhcmlhYmxlKHZhcmlhYmxlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKiBFbmQgZnVuY3Rpb25zIGZvciB2YXJpYWJsZSBkZWxldGlvbi4gKi9cbiAgLyoqXG4gICAqIEZpbmQgdGhlIHZhcmlhYmxlIGJ5IHRoZSBnaXZlbiBuYW1lIGFuZCB0eXBlIGFuZCByZXR1cm4gaXQuICBSZXR1cm4gbnVsbCBpZlxuICAgKiAgICAgaXQgaXMgbm90IGZvdW5kLlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0byBjaGVjayBmb3IuXG4gICAqIEBwYXJhbSBvcHRfdHlwZSBUaGUgdHlwZSBvZiB0aGUgdmFyaWFibGUuICBJZiBub3QgcHJvdmlkZWQgaXQgZGVmYXVsdHMgdG9cbiAgICogICAgIHRoZSBlbXB0eSBzdHJpbmcsIHdoaWNoIGlzIGEgc3BlY2lmaWMgdHlwZS5cbiAgICogQHJldHVybnMgVGhlIHZhcmlhYmxlIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgaXQgd2FzIG5vdCBmb3VuZC5cbiAgICovXG4gIGdldFZhcmlhYmxlKG5hbWU6IHN0cmluZywgb3B0X3R5cGU/OiBzdHJpbmd8bnVsbCk6IFZhcmlhYmxlTW9kZWx8bnVsbCB7XG4gICAgY29uc3QgdHlwZSA9IG9wdF90eXBlIHx8ICcnO1xuICAgIGNvbnN0IGxpc3QgPSB0aGlzLnZhcmlhYmxlTWFwLmdldCh0eXBlKTtcbiAgICBpZiAobGlzdCkge1xuICAgICAgZm9yIChsZXQgaiA9IDAsIHZhcmlhYmxlOyB2YXJpYWJsZSA9IGxpc3Rbal07IGorKykge1xuICAgICAgICBpZiAoTmFtZXMuZXF1YWxzKHZhcmlhYmxlLm5hbWUsIG5hbWUpKSB7XG4gICAgICAgICAgcmV0dXJuIHZhcmlhYmxlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIHZhcmlhYmxlIGJ5IHRoZSBnaXZlbiBJRCBhbmQgcmV0dXJuIGl0LiAgUmV0dXJuIG51bGwgaWYgbm90IGZvdW5kLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgVGhlIElEIHRvIGNoZWNrIGZvci5cbiAgICogQHJldHVybnMgVGhlIHZhcmlhYmxlIHdpdGggdGhlIGdpdmVuIElELlxuICAgKi9cbiAgZ2V0VmFyaWFibGVCeUlkKGlkOiBzdHJpbmcpOiBWYXJpYWJsZU1vZGVsfG51bGwge1xuICAgIGZvciAoY29uc3QgW19rZXksIHZhcmlhYmxlc10gb2YgdGhpcy52YXJpYWJsZU1hcCkge1xuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB2YXJpYWJsZXMpIHtcbiAgICAgICAgaWYgKHZhcmlhYmxlLmdldElkKCkgPT09IGlkKSB7XG4gICAgICAgICAgcmV0dXJuIHZhcmlhYmxlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIGxpc3QgY29udGFpbmluZyBhbGwgb2YgdGhlIHZhcmlhYmxlcyBvZiBhIHNwZWNpZmllZCB0eXBlLiBJZiB0eXBlIGlzXG4gICAqICAgICBudWxsLCByZXR1cm4gbGlzdCBvZiB2YXJpYWJsZXMgd2l0aCBlbXB0eSBzdHJpbmcgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgVHlwZSBvZiB0aGUgdmFyaWFibGVzIHRvIGZpbmQuXG4gICAqIEByZXR1cm5zIFRoZSBzb3VnaHQgYWZ0ZXIgdmFyaWFibGVzIG9mIHRoZSBwYXNzZWQgaW4gdHlwZS4gQW4gZW1wdHkgYXJyYXlcbiAgICogICAgIGlmIG5vbmUgYXJlIGZvdW5kLlxuICAgKi9cbiAgZ2V0VmFyaWFibGVzT2ZUeXBlKHR5cGU6IHN0cmluZ3xudWxsKTogVmFyaWFibGVNb2RlbFtdIHtcbiAgICB0eXBlID0gdHlwZSB8fCAnJztcbiAgICBjb25zdCB2YXJpYWJsZUxpc3QgPSB0aGlzLnZhcmlhYmxlTWFwLmdldCh0eXBlKTtcbiAgICBpZiAodmFyaWFibGVMaXN0KSB7XG4gICAgICByZXR1cm4gdmFyaWFibGVMaXN0LnNsaWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHZhcmlhYmxlIGFuZCBwb3RlbnRpYWwgdmFyaWFibGUgdHlwZXMuICBUaGlzIGxpc3QgYWx3YXlzXG4gICAqIGNvbnRhaW5zIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAqXG4gICAqIEBwYXJhbSB3cyBUaGUgd29ya3NwYWNlIHVzZWQgdG8gbG9vayBmb3IgcG90ZW50aWFsIHZhcmlhYmxlcy4gVGhpcyBjYW4gYmVcbiAgICogICAgIGRpZmZlcmVudCB0aGFuIHRoZSB3b3Jrc3BhY2Ugc3RvcmVkIG9uIHRoaXMgb2JqZWN0IGlmIHRoZSBwYXNzZWQgaW4gd3NcbiAgICogICAgIGlzIGEgZmx5b3V0IHdvcmtzcGFjZS5cbiAgICogQHJldHVybnMgTGlzdCBvZiB2YXJpYWJsZSB0eXBlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRWYXJpYWJsZVR5cGVzKHdzOiBXb3Jrc3BhY2V8bnVsbCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCB2YXJpYWJsZVR5cGVzID0gbmV3IFNldDxzdHJpbmc+KHRoaXMudmFyaWFibGVNYXAua2V5cygpKTtcbiAgICBpZiAod3MgJiYgd3MuZ2V0UG90ZW50aWFsVmFyaWFibGVNYXAoKSkge1xuICAgICAgZm9yIChjb25zdCBrZXkgb2Ygd3MuZ2V0UG90ZW50aWFsVmFyaWFibGVNYXAoKSEudmFyaWFibGVNYXAua2V5cygpKSB7XG4gICAgICAgIHZhcmlhYmxlVHlwZXMuYWRkKGtleSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghdmFyaWFibGVUeXBlcy5oYXMoJycpKSB7XG4gICAgICB2YXJpYWJsZVR5cGVzLmFkZCgnJyk7XG4gICAgfVxuICAgIHJldHVybiBBcnJheS5mcm9tKHZhcmlhYmxlVHlwZXMudmFsdWVzKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdmFyaWFibGVzIG9mIGFsbCB0eXBlcy5cbiAgICpcbiAgICogQHJldHVybnMgTGlzdCBvZiB2YXJpYWJsZSBtb2RlbHMuXG4gICAqL1xuICBnZXRBbGxWYXJpYWJsZXMoKTogVmFyaWFibGVNb2RlbFtdIHtcbiAgICBsZXQgYWxsVmFyaWFibGVzOiBWYXJpYWJsZU1vZGVsW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHZhcmlhYmxlcyBvZiB0aGlzLnZhcmlhYmxlTWFwLnZhbHVlcygpKSB7XG4gICAgICBhbGxWYXJpYWJsZXMgPSBhbGxWYXJpYWJsZXMuY29uY2F0KHZhcmlhYmxlcyk7XG4gICAgfVxuICAgIHJldHVybiBhbGxWYXJpYWJsZXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbGwgb2YgdGhlIHZhcmlhYmxlIG5hbWVzIG9mIGFsbCB0eXBlcy5cbiAgICpcbiAgICogQHJldHVybnMgQWxsIG9mIHRoZSB2YXJpYWJsZSBuYW1lcyBvZiBhbGwgdHlwZXMuXG4gICAqL1xuICBnZXRBbGxWYXJpYWJsZU5hbWVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnZhcmlhYmxlTWFwLnZhbHVlcygpKVxuICAgICAgICAuZmxhdCgpXG4gICAgICAgIC5tYXAoKHZhcmlhYmxlKSA9PiB2YXJpYWJsZS5uYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGFsbCB0aGUgdXNlcyBvZiBhIG5hbWVkIHZhcmlhYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdGhlIHZhcmlhYmxlIHRvIGZpbmQuXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGJsb2NrIHVzYWdlcy5cbiAgICovXG4gIGdldFZhcmlhYmxlVXNlc0J5SWQoaWQ6IHN0cmluZyk6IEJsb2NrW10ge1xuICAgIGNvbnN0IHVzZXMgPSBbXTtcbiAgICBjb25zdCBibG9ja3MgPSB0aGlzLndvcmtzcGFjZS5nZXRBbGxCbG9ja3MoZmFsc2UpO1xuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBldmVyeSBibG9jayBhbmQgY2hlY2sgdGhlIG5hbWUuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGJsb2NrVmFyaWFibGVzID0gYmxvY2tzW2ldLmdldFZhck1vZGVscygpO1xuICAgICAgaWYgKGJsb2NrVmFyaWFibGVzKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmxvY2tWYXJpYWJsZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBpZiAoYmxvY2tWYXJpYWJsZXNbal0uZ2V0SWQoKSA9PT0gaWQpIHtcbiAgICAgICAgICAgIHVzZXMucHVzaChibG9ja3NbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXNlcztcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSB3b3Jrc3BhY2UuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuV29ya3NwYWNlJyk7XG5cbi8vIFVudXNlZCBpbXBvcnQgcHJlc2VydmVkIGZvciBzaWRlLWVmZmVjdHMuIFJlbW92ZSBpZiB1bm5lZWRlZC5cbmltcG9ydCAnLi9jb25uZWN0aW9uX2NoZWNrZXIuanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrbHlPcHRpb25zfSBmcm9tICcuL2Jsb2NrbHlfb3B0aW9ucy5qcyc7XG5pbXBvcnQgdHlwZSB7Q29ubmVjdGlvbkRCfSBmcm9tICcuL2Nvbm5lY3Rpb25fZGIuanMnO1xuaW1wb3J0IHR5cGUge0Fic3RyYWN0fSBmcm9tICcuL2V2ZW50cy9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0ICogYXMgY29tbW9uIGZyb20gJy4vY29tbW9uLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge0lBU1ROb2RlTG9jYXRpb259IGZyb20gJy4vaW50ZXJmYWNlcy9pX2FzdF9ub2RlX2xvY2F0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtJQ29ubmVjdGlvbkNoZWNrZXJ9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2Nvbm5lY3Rpb25fY2hlY2tlci5qcyc7XG5pbXBvcnQge09wdGlvbnN9IGZyb20gJy4vb3B0aW9ucy5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIGFycmF5VXRpbHMgZnJvbSAnLi91dGlscy9hcnJheS5qcyc7XG5pbXBvcnQgKiBhcyBpZEdlbmVyYXRvciBmcm9tICcuL3V0aWxzL2lkZ2VuZXJhdG9yLmpzJztcbmltcG9ydCAqIGFzIG1hdGggZnJvbSAnLi91dGlscy9tYXRoLmpzJztcbmltcG9ydCB0eXBlICogYXMgdG9vbGJveCBmcm9tICcuL3V0aWxzL3Rvb2xib3guanMnO1xuaW1wb3J0IHtWYXJpYWJsZU1hcH0gZnJvbSAnLi92YXJpYWJsZV9tYXAuanMnO1xuaW1wb3J0IHR5cGUge1ZhcmlhYmxlTW9kZWx9IGZyb20gJy4vdmFyaWFibGVfbW9kZWwuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZUNvbW1lbnR9IGZyb20gJy4vd29ya3NwYWNlX2NvbW1lbnQuanMnO1xuaW1wb3J0IHtJUHJvY2VkdXJlTWFwfSBmcm9tICcuL2ludGVyZmFjZXMvaV9wcm9jZWR1cmVfbWFwLmpzJztcbmltcG9ydCB7T2JzZXJ2YWJsZVByb2NlZHVyZU1hcH0gZnJvbSAnLi9wcm9jZWR1cmVzLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIHdvcmtzcGFjZS4gIFRoaXMgaXMgYSBkYXRhIHN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIGJsb2Nrcy5cbiAqIFRoZXJlIGlzIG5vIFVJLCBhbmQgY2FuIGJlIGNyZWF0ZWQgaGVhZGxlc3NseS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Xb3Jrc3BhY2VcbiAqL1xuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZSBpbXBsZW1lbnRzIElBU1ROb2RlTG9jYXRpb24ge1xuICAvKipcbiAgICogQW5nbGUgYXdheSBmcm9tIHRoZSBob3Jpem9udGFsIHRvIHN3ZWVwIGZvciBibG9ja3MuICBPcmRlciBvZiBleGVjdXRpb24gaXNcbiAgICogZ2VuZXJhbGx5IHRvcCB0byBib3R0b20sIGJ1dCBhIHNtYWxsIGFuZ2xlIGNoYW5nZXMgdGhlIHNjYW4gdG8gZ2l2ZSBhIGJpdFxuICAgKiBvZiBhIGxlZnQgdG8gcmlnaHQgYmlhcyAocmV2ZXJzZWQgaW4gUlRMKS4gIFVuaXRzIGFyZSBpbiBkZWdyZWVzLiBTZWU6XG4gICAqIGh0dHBzOi8vdHZ0cm9wZXMub3JnL3Btd2lraS9wbXdpa2kucGhwL01haW4vRGlhZ29uYWxCaWxsaW5nXG4gICAqL1xuICBzdGF0aWMgU0NBTl9BTkdMRSA9IDM7XG4gIGlkOiBzdHJpbmc7XG4gIG9wdGlvbnM6IE9wdGlvbnM7XG4gIFJUTDogYm9vbGVhbjtcbiAgaG9yaXpvbnRhbExheW91dDogYm9vbGVhbjtcbiAgdG9vbGJveFBvc2l0aW9uOiB0b29sYm94LlBvc2l0aW9uO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgd29ya3NwYWNlIGlzIHZpc2libGUgYW5kIGBmYWxzZWAgaWYgaXQncyBoZWFkbGVzcy5cbiAgICovXG4gIHJlbmRlcmVkID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIElzIHRoaXMgd29ya3NwYWNlIHRoZSBzdXJmYWNlIGZvciBhIGZseW91dD9cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBpbnRlcm5hbElzRmx5b3V0ID0gZmFsc2U7XG5cbiAgLyoqIElzIHRoaXMgd29ya3NwYWNlIHRoZSBzdXJmYWNlIGZvciBhIGZseW91dD8gKi9cbiAgZ2V0IGlzRmx5b3V0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmludGVybmFsSXNGbHlvdXQ7XG4gIH1cblxuICAvKipcbiAgICogSXMgdGhpcyB3b3Jrc3BhY2UgdGhlIHN1cmZhY2UgZm9yIGEgbXV0YXRvcj9cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBpbnRlcm5hbElzTXV0YXRvciA9IGZhbHNlO1xuXG4gIC8qKiBJcyB0aGlzIHdvcmtzcGFjZSB0aGUgc3VyZmFjZSBmb3IgYSBtdXRhdG9yPyAqL1xuICBnZXQgaXNNdXRhdG9yKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmludGVybmFsSXNNdXRhdG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYHRydWVgIGlmIHRoZSB3b3Jrc3BhY2UgaXMgY3VycmVudGx5IGluIHRoZSBwcm9jZXNzIG9mIGEgYnVsa1xuICAgKiBjbGVhci5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0NsZWFyaW5nID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIE1heGltdW0gbnVtYmVyIG9mIHVuZG8gZXZlbnRzIGluIHN0YWNrLiBgMGAgdHVybnMgb2ZmIHVuZG8sIGBJbmZpbml0eWBcbiAgICogc2V0cyBpdCB0byB1bmxpbWl0ZWQuXG4gICAqL1xuICBNQVhfVU5ETyA9IDEwMjQ7XG5cbiAgLyoqIFNldCBvZiBkYXRhYmFzZXMgZm9yIHJhcGlkIGxvb2t1cCBvZiBjb25uZWN0aW9uIGxvY2F0aW9ucy4gKi9cbiAgY29ubmVjdGlvbkRCTGlzdDogQ29ubmVjdGlvbkRCW10gPSBbXTtcbiAgY29ubmVjdGlvbkNoZWNrZXI6IElDb25uZWN0aW9uQ2hlY2tlcjtcblxuICBwcml2YXRlIHJlYWRvbmx5IHRvcEJsb2NrczogQmxvY2tbXSA9IFtdO1xuICBwcml2YXRlIHJlYWRvbmx5IHRvcENvbW1lbnRzOiBXb3Jrc3BhY2VDb21tZW50W10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBjb21tZW50REIgPSBuZXcgTWFwPHN0cmluZywgV29ya3NwYWNlQ29tbWVudD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBsaXN0ZW5lcnM6IEZ1bmN0aW9uW10gPSBbXTtcbiAgcHJvdGVjdGVkIHVuZG9TdGFja186IEFic3RyYWN0W10gPSBbXTtcbiAgcHJvdGVjdGVkIHJlZG9TdGFja186IEFic3RyYWN0W10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBibG9ja0RCID0gbmV3IE1hcDxzdHJpbmcsIEJsb2NrPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IHR5cGVkQmxvY2tzREIgPSBuZXcgTWFwPHN0cmluZywgQmxvY2tbXT4oKTtcbiAgcHJpdmF0ZSB2YXJpYWJsZU1hcDogVmFyaWFibGVNYXA7XG4gIHByaXZhdGUgcHJvY2VkdXJlTWFwOiBJUHJvY2VkdXJlTWFwID0gbmV3IE9ic2VydmFibGVQcm9jZWR1cmVNYXAodGhpcyk7XG5cbiAgLyoqXG4gICAqIEJsb2NrcyBpbiB0aGUgZmx5b3V0IGNhbiByZWZlciB0byB2YXJpYWJsZXMgdGhhdCBkb24ndCBleGlzdCBpbiB0aGUgbWFpblxuICAgKiB3b3Jrc3BhY2UuICBGb3IgaW5zdGFuY2UsIHRoZSBcImdldCBpdGVtIGluIGxpc3RcIiBibG9jayByZWZlcnMgdG8gYW5cbiAgICogXCJpdGVtXCIgdmFyaWFibGUgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIHRoZSB2YXJpYWJsZSBoYXMgYmVlbiBjcmVhdGVkIHlldC5cbiAgICogQSBGaWVsZFZhcmlhYmxlIG11c3QgYWx3YXlzIHJlZmVyIHRvIGEgVmFyaWFibGVNb2RlbC4gIFdlIHJlY29uY2lsZVxuICAgKiB0aGVzZSBieSB0cmFja2luZyBcInBvdGVudGlhbFwiIHZhcmlhYmxlcyBpbiB0aGUgZmx5b3V0LiAgVGhlc2UgdmFyaWFibGVzXG4gICAqIGJlY29tZSByZWFsIHdoZW4gcmVmZXJlbmNlcyB0byB0aGVtIGFyZSBkcmFnZ2VkIGludG8gdGhlIG1haW4gd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSBwb3RlbnRpYWxWYXJpYWJsZU1hcDogVmFyaWFibGVNYXB8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEBwYXJhbSBvcHRfb3B0aW9ucyBEaWN0aW9uYXJ5IG9mIG9wdGlvbnMuICovXG4gIGNvbnN0cnVjdG9yKG9wdF9vcHRpb25zPzogT3B0aW9ucykge1xuICAgIHRoaXMuaWQgPSBpZEdlbmVyYXRvci5nZW5VaWQoKTtcbiAgICBjb21tb24ucmVnaXN0ZXJXb3Jrc3BhY2UodGhpcyk7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0X29wdGlvbnMgfHwgbmV3IE9wdGlvbnMoKHt9IGFzIEJsb2NrbHlPcHRpb25zKSk7XG4gICAgdGhpcy5SVEwgPSAhIXRoaXMub3B0aW9ucy5SVEw7XG4gICAgdGhpcy5ob3Jpem9udGFsTGF5b3V0ID0gISF0aGlzLm9wdGlvbnMuaG9yaXpvbnRhbExheW91dDtcbiAgICB0aGlzLnRvb2xib3hQb3NpdGlvbiA9IHRoaXMub3B0aW9ucy50b29sYm94UG9zaXRpb247XG5cbiAgICBjb25zdCBjb25uZWN0aW9uQ2hlY2tlckNsYXNzID0gcmVnaXN0cnkuZ2V0Q2xhc3NGcm9tT3B0aW9ucyhcbiAgICAgICAgcmVnaXN0cnkuVHlwZS5DT05ORUNUSU9OX0NIRUNLRVIsIHRoaXMub3B0aW9ucywgdHJ1ZSk7XG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IHRoYXQgZW5jYXBzdWxhdGVzIGxvZ2ljIGZvciBzYWZldHksIHR5cGUsIGFuZCBkcmFnZ2luZyBjaGVja3MuXG4gICAgICovXG4gICAgdGhpcy5jb25uZWN0aW9uQ2hlY2tlciA9IG5ldyBjb25uZWN0aW9uQ2hlY2tlckNsYXNzISh0aGlzKTtcblxuICAgIC8qKlxuICAgICAqIEEgbWFwIGZyb20gdmFyaWFibGUgdHlwZSB0byBsaXN0IG9mIHZhcmlhYmxlIG5hbWVzLiAgVGhlIGxpc3RzIGNvbnRhaW5cbiAgICAgKiBhbGwgb2YgdGhlIG5hbWVkIHZhcmlhYmxlcyBpbiB0aGUgd29ya3NwYWNlLCBpbmNsdWRpbmcgdmFyaWFibGVzIHRoYXQgYXJlXG4gICAgICogbm90IGN1cnJlbnRseSBpbiB1c2UuXG4gICAgICovXG4gICAgdGhpcy52YXJpYWJsZU1hcCA9IG5ldyBWYXJpYWJsZU1hcCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIG9mIHRoaXMgd29ya3NwYWNlLlxuICAgKiBVbmxpbmsgZnJvbSBhbGwgRE9NIGVsZW1lbnRzIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzLlxuICAgKlxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMubGlzdGVuZXJzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5jbGVhcigpO1xuICAgIC8vIFJlbW92ZSBmcm9tIHdvcmtzcGFjZSBkYXRhYmFzZS5cbiAgICBjb21tb24udW5yZWdpc3RlcldvcmtwYWNlKHRoaXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBhcmUgZnVuY3Rpb24gZm9yIHNvcnRpbmcgb2JqZWN0cyAoYmxvY2tzLCBjb21tZW50cywgZXRjKSBieSBwb3NpdGlvbjtcbiAgICogICAgdG9wIHRvIGJvdHRvbSAod2l0aCBzbGlnaHQgTFRSIG9yIFJUTCBiaWFzKS5cbiAgICpcbiAgICogQHBhcmFtIGEgVGhlIGZpcnN0IG9iamVjdCB0byBjb21wYXJlLlxuICAgKiBAcGFyYW0gYiBUaGUgc2Vjb25kIG9iamVjdCB0byBjb21wYXJlLlxuICAgKiBAcmV0dXJucyBUaGUgY29tcGFyaXNvbiB2YWx1ZS4gVGhpcyB0ZWxscyBBcnJheS5zb3J0KCkgaG93IHRvIGNoYW5nZSBvYmplY3RcbiAgICogICAgIGEncyBpbmRleC5cbiAgICovXG4gIHByaXZhdGUgc29ydE9iamVjdHNfKGE6IEJsb2NrfFdvcmtzcGFjZUNvbW1lbnQsIGI6IEJsb2NrfFdvcmtzcGFjZUNvbW1lbnQpOlxuICAgICAgbnVtYmVyIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdnZXRSZWxhdGl2ZVRvU3VyZmFjZVhZJyBkb2VzIG5vdFxuICAgIC8vIGV4aXN0IG9uIHR5cGUgJ0Jsb2NrIHwgV29ya3NwYWNlQ29tbWVudCcuXG4gICAgY29uc3QgYVhZID0gKGEgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWScgZG9lcyBub3RcbiAgICAvLyBleGlzdCBvbiB0eXBlICdCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQnLlxuICAgIGNvbnN0IGJYWSA9IChiIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ29mZnNldCcgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICcoYTogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50LCBiOiBCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQpID0+IG51bWJlcicuXG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnb2Zmc2V0JyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJyhhOiBCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQsIGI6IEJsb2NrIHwgV29ya3NwYWNlQ29tbWVudCkgPT4gbnVtYmVyJy5cbiAgICByZXR1cm4gYVhZLnkgK1xuICAgICAgICAoV29ya3NwYWNlLnByb3RvdHlwZS5zb3J0T2JqZWN0c18gYXMgQW55RHVyaW5nTWlncmF0aW9uKS5vZmZzZXQgKlxuICAgICAgICBhWFkueCAtXG4gICAgICAgIChiWFkueSArXG4gICAgICAgICAoV29ya3NwYWNlLnByb3RvdHlwZS5zb3J0T2JqZWN0c18gYXMgQW55RHVyaW5nTWlncmF0aW9uKS5vZmZzZXQgKlxuICAgICAgICAgICAgIGJYWS54KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgYmxvY2sgdG8gdGhlIGxpc3Qgb2YgdG9wIGJsb2Nrcy5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIEJsb2NrIHRvIGFkZC5cbiAgICovXG4gIGFkZFRvcEJsb2NrKGJsb2NrOiBCbG9jaykge1xuICAgIHRoaXMudG9wQmxvY2tzLnB1c2goYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBibG9jayBmcm9tIHRoZSBsaXN0IG9mIHRvcCBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBCbG9jayB0byByZW1vdmUuXG4gICAqL1xuICByZW1vdmVUb3BCbG9jayhibG9jazogQmxvY2spIHtcbiAgICBpZiAoIWFycmF5VXRpbHMucmVtb3ZlRWxlbSh0aGlzLnRvcEJsb2NrcywgYmxvY2spKSB7XG4gICAgICB0aHJvdyBFcnJvcignQmxvY2sgbm90IHByZXNlbnQgaW4gd29ya3NwYWNlXFwncyBsaXN0IG9mIHRvcC1tb3N0IGJsb2Nrcy4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIHRvcC1sZXZlbCBibG9ja3MgYW5kIHJldHVybnMgdGhlbS4gIEJsb2NrcyBhcmUgb3B0aW9uYWxseSBzb3J0ZWRcbiAgICogYnkgcG9zaXRpb247IHRvcCB0byBib3R0b20gKHdpdGggc2xpZ2h0IExUUiBvciBSVEwgYmlhcykuXG4gICAqXG4gICAqIEBwYXJhbSBvcmRlcmVkIFNvcnQgdGhlIGxpc3QgaWYgdHJ1ZS5cbiAgICogQHJldHVybnMgVGhlIHRvcC1sZXZlbCBibG9jayBvYmplY3RzLlxuICAgKi9cbiAgZ2V0VG9wQmxvY2tzKG9yZGVyZWQ6IGJvb2xlYW4pOiBCbG9ja1tdIHtcbiAgICAvLyBDb3B5IHRoZSB0b3BCbG9ja3MgbGlzdC5cbiAgICBjb25zdCBibG9ja3MgPSAobmV3IEFycmF5PEJsb2NrPigpKS5jb25jYXQodGhpcy50b3BCbG9ja3MpO1xuICAgIGlmIChvcmRlcmVkICYmIGJsb2Nrcy5sZW5ndGggPiAxKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdvZmZzZXQnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAgIC8vICcoYTogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50LCBiOiBCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQpID0+IG51bWJlcicuXG4gICAgICAodGhpcy5zb3J0T2JqZWN0c18gYXMgQW55RHVyaW5nTWlncmF0aW9uKS5vZmZzZXQgPVxuICAgICAgICAgIE1hdGguc2luKG1hdGgudG9SYWRpYW5zKFdvcmtzcGFjZS5TQ0FOX0FOR0xFKSk7XG4gICAgICBpZiAodGhpcy5SVEwpIHtcbiAgICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnb2Zmc2V0JyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgICAgIC8vICcoYTogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50LCBiOiBCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQpID0+XG4gICAgICAgIC8vIG51bWJlcicuXG4gICAgICAgICh0aGlzLnNvcnRPYmplY3RzXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLm9mZnNldCAqPSAtMTtcbiAgICAgIH1cbiAgICAgIGJsb2Nrcy5zb3J0KHRoaXMuc29ydE9iamVjdHNfKTtcbiAgICB9XG4gICAgcmV0dXJuIGJsb2NrcztcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBibG9jayB0byB0aGUgbGlzdCBvZiBibG9ja3Mga2V5ZWQgYnkgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIEJsb2NrIHRvIGFkZC5cbiAgICovXG4gIGFkZFR5cGVkQmxvY2soYmxvY2s6IEJsb2NrKSB7XG4gICAgaWYgKCF0aGlzLnR5cGVkQmxvY2tzREIuaGFzKGJsb2NrLnR5cGUpKSB7XG4gICAgICB0aGlzLnR5cGVkQmxvY2tzREIuc2V0KGJsb2NrLnR5cGUsIFtdKTtcbiAgICB9XG4gICAgdGhpcy50eXBlZEJsb2Nrc0RCLmdldChibG9jay50eXBlKSEucHVzaChibG9jayk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGEgYmxvY2sgZnJvbSB0aGUgbGlzdCBvZiBibG9ja3Mga2V5ZWQgYnkgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIEJsb2NrIHRvIHJlbW92ZS5cbiAgICovXG4gIHJlbW92ZVR5cGVkQmxvY2soYmxvY2s6IEJsb2NrKSB7XG4gICAgYXJyYXlVdGlscy5yZW1vdmVFbGVtKHRoaXMudHlwZWRCbG9ja3NEQi5nZXQoYmxvY2sudHlwZSkhLCBibG9jayk7XG4gICAgaWYgKCF0aGlzLnR5cGVkQmxvY2tzREIuZ2V0KGJsb2NrLnR5cGUpIS5sZW5ndGgpIHtcbiAgICAgIHRoaXMudHlwZWRCbG9ja3NEQi5kZWxldGUoYmxvY2sudHlwZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSBibG9ja3Mgd2l0aCB0aGUgYXNzb2NpYXRlZCB0eXBlIGFuZCByZXR1cm5zIHRoZW0uIEJsb2NrcyBhcmVcbiAgICogb3B0aW9uYWxseSBzb3J0ZWQgYnkgcG9zaXRpb247IHRvcCB0byBib3R0b20gKHdpdGggc2xpZ2h0IExUUiBvciBSVEwgYmlhcykuXG4gICAqXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIGJsb2NrIHRvIHNlYXJjaCBmb3IuXG4gICAqIEBwYXJhbSBvcmRlcmVkIFNvcnQgdGhlIGxpc3QgaWYgdHJ1ZS5cbiAgICogQHJldHVybnMgVGhlIGJsb2NrcyBvZiB0aGUgZ2l2ZW4gdHlwZS5cbiAgICovXG4gIGdldEJsb2Nrc0J5VHlwZSh0eXBlOiBzdHJpbmcsIG9yZGVyZWQ6IGJvb2xlYW4pOiBCbG9ja1tdIHtcbiAgICBpZiAoIXRoaXMudHlwZWRCbG9ja3NEQi5oYXModHlwZSkpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgYmxvY2tzID0gdGhpcy50eXBlZEJsb2Nrc0RCLmdldCh0eXBlKSEuc2xpY2UoMCk7XG4gICAgaWYgKG9yZGVyZWQgJiYgYmxvY2tzICYmIGJsb2Nrcy5sZW5ndGggPiAxKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdvZmZzZXQnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAgIC8vICcoYTogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50LCBiOiBCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQpID0+IG51bWJlcicuXG4gICAgICAodGhpcy5zb3J0T2JqZWN0c18gYXMgQW55RHVyaW5nTWlncmF0aW9uKS5vZmZzZXQgPVxuICAgICAgICAgIE1hdGguc2luKG1hdGgudG9SYWRpYW5zKFdvcmtzcGFjZS5TQ0FOX0FOR0xFKSk7XG4gICAgICBpZiAodGhpcy5SVEwpIHtcbiAgICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnb2Zmc2V0JyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgICAgIC8vICcoYTogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50LCBiOiBCbG9jayB8IFdvcmtzcGFjZUNvbW1lbnQpID0+XG4gICAgICAgIC8vIG51bWJlcicuXG4gICAgICAgICh0aGlzLnNvcnRPYmplY3RzXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLm9mZnNldCAqPSAtMTtcbiAgICAgIH1cbiAgICAgIGJsb2Nrcy5zb3J0KHRoaXMuc29ydE9iamVjdHNfKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYmxvY2tzLmZpbHRlcihmdW5jdGlvbihibG9jazogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgICByZXR1cm4gIWJsb2NrLmlzSW5zZXJ0aW9uTWFya2VyKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIGNvbW1lbnQgdG8gdGhlIGxpc3Qgb2YgdG9wIGNvbW1lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gY29tbWVudCBjb21tZW50IHRvIGFkZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGRUb3BDb21tZW50KGNvbW1lbnQ6IFdvcmtzcGFjZUNvbW1lbnQpIHtcbiAgICB0aGlzLnRvcENvbW1lbnRzLnB1c2goY29tbWVudCk7XG5cbiAgICAvLyBOb3RlOiBJZiB0aGUgY29tbWVudCBkYXRhYmFzZSBzdGFydHMgdG8gaG9sZCBibG9jayBjb21tZW50cywgdGhpcyBtYXlcbiAgICAvLyBuZWVkIHRvIG1vdmUgdG8gYSBzZXBhcmF0ZSBmdW5jdGlvbi5cbiAgICBpZiAodGhpcy5jb21tZW50REIuaGFzKGNvbW1lbnQuaWQpKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ092ZXJyaWRpbmcgYW4gZXhpc3RpbmcgY29tbWVudCBvbiB0aGlzIHdvcmtzcGFjZSwgd2l0aCBpZCBcIicgK1xuICAgICAgICAgIGNvbW1lbnQuaWQgKyAnXCInKTtcbiAgICB9XG4gICAgdGhpcy5jb21tZW50REIuc2V0KGNvbW1lbnQuaWQsIGNvbW1lbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBjb21tZW50IGZyb20gdGhlIGxpc3Qgb2YgdG9wIGNvbW1lbnRzLlxuICAgKlxuICAgKiBAcGFyYW0gY29tbWVudCBjb21tZW50IHRvIHJlbW92ZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICByZW1vdmVUb3BDb21tZW50KGNvbW1lbnQ6IFdvcmtzcGFjZUNvbW1lbnQpIHtcbiAgICBpZiAoIWFycmF5VXRpbHMucmVtb3ZlRWxlbSh0aGlzLnRvcENvbW1lbnRzLCBjb21tZW50KSkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgJ0NvbW1lbnQgbm90IHByZXNlbnQgaW4gd29ya3NwYWNlXFwncyBsaXN0IG9mIHRvcC1tb3N0ICcgK1xuICAgICAgICAgICdjb21tZW50cy4nKTtcbiAgICB9XG4gICAgLy8gTm90ZTogSWYgdGhlIGNvbW1lbnQgZGF0YWJhc2Ugc3RhcnRzIHRvIGhvbGQgYmxvY2sgY29tbWVudHMsIHRoaXMgbWF5XG4gICAgLy8gbmVlZCB0byBtb3ZlIHRvIGEgc2VwYXJhdGUgZnVuY3Rpb24uXG4gICAgdGhpcy5jb21tZW50REIuZGVsZXRlKGNvbW1lbnQuaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSB0b3AtbGV2ZWwgY29tbWVudHMgYW5kIHJldHVybnMgdGhlbS4gIENvbW1lbnRzIGFyZSBvcHRpb25hbGx5XG4gICAqIHNvcnRlZCBieSBwb3NpdGlvbjsgdG9wIHRvIGJvdHRvbSAod2l0aCBzbGlnaHQgTFRSIG9yIFJUTCBiaWFzKS5cbiAgICpcbiAgICogQHBhcmFtIG9yZGVyZWQgU29ydCB0aGUgbGlzdCBpZiB0cnVlLlxuICAgKiBAcmV0dXJucyBUaGUgdG9wLWxldmVsIGNvbW1lbnQgb2JqZWN0cy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRUb3BDb21tZW50cyhvcmRlcmVkOiBib29sZWFuKTogV29ya3NwYWNlQ29tbWVudFtdIHtcbiAgICAvLyBDb3B5IHRoZSB0b3BDb21tZW50cyBsaXN0LlxuICAgIGNvbnN0IGNvbW1lbnRzID0gKG5ldyBBcnJheTxXb3Jrc3BhY2VDb21tZW50PigpKS5jb25jYXQodGhpcy50b3BDb21tZW50cyk7XG4gICAgaWYgKG9yZGVyZWQgJiYgY29tbWVudHMubGVuZ3RoID4gMSkge1xuICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnb2Zmc2V0JyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgICAvLyAnKGE6IEJsb2NrIHwgV29ya3NwYWNlQ29tbWVudCwgYjogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50KSA9PiBudW1iZXInLlxuICAgICAgKHRoaXMuc29ydE9iamVjdHNfIGFzIEFueUR1cmluZ01pZ3JhdGlvbikub2Zmc2V0ID1cbiAgICAgICAgICBNYXRoLnNpbihtYXRoLnRvUmFkaWFucyhXb3Jrc3BhY2UuU0NBTl9BTkdMRSkpO1xuICAgICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ29mZnNldCcgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgICAgICAvLyAnKGE6IEJsb2NrIHwgV29ya3NwYWNlQ29tbWVudCwgYjogQmxvY2sgfCBXb3Jrc3BhY2VDb21tZW50KSA9PlxuICAgICAgICAvLyBudW1iZXInLlxuICAgICAgICAodGhpcy5zb3J0T2JqZWN0c18gYXMgQW55RHVyaW5nTWlncmF0aW9uKS5vZmZzZXQgKj0gLTE7XG4gICAgICB9XG4gICAgICBjb21tZW50cy5zb3J0KHRoaXMuc29ydE9iamVjdHNfKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbW1lbnRzO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYWxsIGJsb2NrcyBpbiB3b3Jrc3BhY2UuICBCbG9ja3MgYXJlIG9wdGlvbmFsbHkgc29ydGVkXG4gICAqIGJ5IHBvc2l0aW9uOyB0b3AgdG8gYm90dG9tICh3aXRoIHNsaWdodCBMVFIgb3IgUlRMIGJpYXMpLlxuICAgKlxuICAgKiBAcGFyYW0gb3JkZXJlZCBTb3J0IHRoZSBsaXN0IGlmIHRydWUuXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGJsb2Nrcy5cbiAgICovXG4gIGdldEFsbEJsb2NrcyhvcmRlcmVkOiBib29sZWFuKTogQmxvY2tbXSB7XG4gICAgbGV0IGJsb2NrczogQW55RHVyaW5nTWlncmF0aW9uW107XG4gICAgaWYgKG9yZGVyZWQpIHtcbiAgICAgIC8vIFNsb3csIGJ1dCBvcmRlcmVkLlxuICAgICAgY29uc3QgdG9wQmxvY2tzID0gdGhpcy5nZXRUb3BCbG9ja3ModHJ1ZSk7XG4gICAgICBibG9ja3MgPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGJsb2Nrcy5wdXNoKC4uLnRvcEJsb2Nrc1tpXS5nZXREZXNjZW5kYW50cyh0cnVlKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZhc3QsIGJ1dCBpbiBubyBwYXJ0aWN1bGFyIG9yZGVyLlxuICAgICAgYmxvY2tzID0gdGhpcy5nZXRUb3BCbG9ja3MoZmFsc2UpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYmxvY2tzLnB1c2goLi4uYmxvY2tzW2ldLmdldENoaWxkcmVuKGZhbHNlKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSW5zZXJ0aW9uIG1hcmtlcnMgZXhpc3Qgb24gdGhlIHdvcmtzcGFjZSBmb3IgcmVuZGVyaW5nIHJlYXNvbnMsIGJ1dFxuICAgIC8vIGFyZW4ndCBcInJlYWxcIiBibG9ja3MgZnJvbSBhIGRldmVsb3BlciBwZXJzcGVjdGl2ZS5cbiAgICBjb25zdCBmaWx0ZXJlZCA9IGJsb2Nrcy5maWx0ZXIoZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgIHJldHVybiAhYmxvY2suaXNJbnNlcnRpb25NYXJrZXIoKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBmaWx0ZXJlZDtcbiAgfVxuXG4gIC8qKiBEaXNwb3NlIG9mIGFsbCBibG9ja3MgYW5kIGNvbW1lbnRzIGluIHdvcmtzcGFjZS4gKi9cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5pc0NsZWFyaW5nID0gdHJ1ZTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXhpc3RpbmdHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXAoKTtcbiAgICAgIGlmICghZXhpc3RpbmdHcm91cCkge1xuICAgICAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgICAgfVxuICAgICAgd2hpbGUgKHRoaXMudG9wQmxvY2tzLmxlbmd0aCkge1xuICAgICAgICB0aGlzLnRvcEJsb2Nrc1swXS5kaXNwb3NlKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHdoaWxlICh0aGlzLnRvcENvbW1lbnRzLmxlbmd0aCkge1xuICAgICAgICB0aGlzLnRvcENvbW1lbnRzW3RoaXMudG9wQ29tbWVudHMubGVuZ3RoIC0gMV0uZGlzcG9zZSgpO1xuICAgICAgfVxuICAgICAgaWYgKCFleGlzdGluZ0dyb3VwKSB7XG4gICAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuICAgICAgfVxuICAgICAgdGhpcy52YXJpYWJsZU1hcC5jbGVhcigpO1xuICAgICAgaWYgKHRoaXMucG90ZW50aWFsVmFyaWFibGVNYXApIHtcbiAgICAgICAgdGhpcy5wb3RlbnRpYWxWYXJpYWJsZU1hcC5jbGVhcigpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzQ2xlYXJpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKiBCZWdpbiBmdW5jdGlvbnMgdGhhdCBhcmUganVzdCBwYXNzLXRocm91Z2hzIHRvIHRoZSB2YXJpYWJsZSBtYXAuICovXG4gIC8qKlxuICAgKiBSZW5hbWUgYSB2YXJpYWJsZSBieSB1cGRhdGluZyBpdHMgbmFtZSBpbiB0aGUgdmFyaWFibGUgbWFwLiBJZGVudGlmeSB0aGVcbiAgICogdmFyaWFibGUgdG8gcmVuYW1lIHdpdGggdGhlIGdpdmVuIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdGhlIHZhcmlhYmxlIHRvIHJlbmFtZS5cbiAgICogQHBhcmFtIG5ld05hbWUgTmV3IHZhcmlhYmxlIG5hbWUuXG4gICAqL1xuICByZW5hbWVWYXJpYWJsZUJ5SWQoaWQ6IHN0cmluZywgbmV3TmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy52YXJpYWJsZU1hcC5yZW5hbWVWYXJpYWJsZUJ5SWQoaWQsIG5ld05hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHZhcmlhYmxlIHdpdGggYSBnaXZlbiBuYW1lLCBvcHRpb25hbCB0eXBlLCBhbmQgb3B0aW9uYWwgSUQuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZS4gVGhpcyBtdXN0IGJlIHVuaXF1ZSBhY3Jvc3MgdmFyaWFibGVzXG4gICAqICAgICBhbmQgcHJvY2VkdXJlcy5cbiAgICogQHBhcmFtIG9wdF90eXBlIFRoZSB0eXBlIG9mIHRoZSB2YXJpYWJsZSBsaWtlICdpbnQnIG9yICdzdHJpbmcnLlxuICAgKiAgICAgRG9lcyBub3QgbmVlZCB0byBiZSB1bmlxdWUuIEZpZWxkX3ZhcmlhYmxlIGNhbiBmaWx0ZXIgdmFyaWFibGVzIGJhc2VkXG4gICAqIG9uIHRoZWlyIHR5cGUuIFRoaXMgd2lsbCBkZWZhdWx0IHRvICcnIHdoaWNoIGlzIGEgc3BlY2lmaWMgdHlwZS5cbiAgICogQHBhcmFtIG9wdF9pZCBUaGUgdW5pcXVlIElEIG9mIHRoZSB2YXJpYWJsZS4gVGhpcyB3aWxsIGRlZmF1bHQgdG8gYSBVVUlELlxuICAgKiBAcmV0dXJucyBUaGUgbmV3bHkgY3JlYXRlZCB2YXJpYWJsZS5cbiAgICovXG4gIGNyZWF0ZVZhcmlhYmxlKG5hbWU6IHN0cmluZywgb3B0X3R5cGU/OiBzdHJpbmd8bnVsbCwgb3B0X2lkPzogc3RyaW5nfG51bGwpOlxuICAgICAgVmFyaWFibGVNb2RlbCB7XG4gICAgcmV0dXJuIHRoaXMudmFyaWFibGVNYXAuY3JlYXRlVmFyaWFibGUobmFtZSwgb3B0X3R5cGUsIG9wdF9pZCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbGwgdGhlIHVzZXMgb2YgdGhlIGdpdmVuIHZhcmlhYmxlLCB3aGljaCBpcyBpZGVudGlmaWVkIGJ5IElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdGhlIHZhcmlhYmxlIHRvIGZpbmQuXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGJsb2NrIHVzYWdlcy5cbiAgICovXG4gIGdldFZhcmlhYmxlVXNlc0J5SWQoaWQ6IHN0cmluZyk6IEJsb2NrW10ge1xuICAgIHJldHVybiB0aGlzLnZhcmlhYmxlTWFwLmdldFZhcmlhYmxlVXNlc0J5SWQoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhIHZhcmlhYmxlcyBieSB0aGUgcGFzc2VkIGluIElEIGFuZCBhbGwgb2YgaXRzIHVzZXMgZnJvbSB0aGlzXG4gICAqIHdvcmtzcGFjZS4gTWF5IHByb21wdCB0aGUgdXNlciBmb3IgY29uZmlybWF0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgdmFyaWFibGUgdG8gZGVsZXRlLlxuICAgKi9cbiAgZGVsZXRlVmFyaWFibGVCeUlkKGlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLnZhcmlhYmxlTWFwLmRlbGV0ZVZhcmlhYmxlQnlJZChpZCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgdmFyaWFibGUgYnkgdGhlIGdpdmVuIG5hbWUgYW5kIHJldHVybiBpdC4gUmV0dXJuIG51bGwgaWYgbm90XG4gICAqIGZvdW5kLlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0byBjaGVjayBmb3IuXG4gICAqIEBwYXJhbSBvcHRfdHlwZSBUaGUgdHlwZSBvZiB0aGUgdmFyaWFibGUuICBJZiBub3QgcHJvdmlkZWQgaXQgZGVmYXVsdHMgdG9cbiAgICogICAgIHRoZSBlbXB0eSBzdHJpbmcsIHdoaWNoIGlzIGEgc3BlY2lmaWMgdHlwZS5cbiAgICogQHJldHVybnMgVGhlIHZhcmlhYmxlIHdpdGggdGhlIGdpdmVuIG5hbWUuXG4gICAqL1xuICBnZXRWYXJpYWJsZShuYW1lOiBzdHJpbmcsIG9wdF90eXBlPzogc3RyaW5nKTogVmFyaWFibGVNb2RlbHxudWxsIHtcbiAgICAvLyBUT0RPICgjMTU1OSk6IFBvc3NpYmx5IGRlbGV0ZSB0aGlzIGZ1bmN0aW9uIGFmdGVyIHJlc29sdmluZyAjMTU1OS5cbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZU1hcC5nZXRWYXJpYWJsZShuYW1lLCBvcHRfdHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgdmFyaWFibGUgYnkgdGhlIGdpdmVuIElEIGFuZCByZXR1cm4gaXQuIFJldHVybiBudWxsIGlmIG5vdCBmb3VuZC5cbiAgICpcbiAgICogQHBhcmFtIGlkIFRoZSBJRCB0byBjaGVjayBmb3IuXG4gICAqIEByZXR1cm5zIFRoZSB2YXJpYWJsZSB3aXRoIHRoZSBnaXZlbiBJRC5cbiAgICovXG4gIGdldFZhcmlhYmxlQnlJZChpZDogc3RyaW5nKTogVmFyaWFibGVNb2RlbHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZU1hcC5nZXRWYXJpYWJsZUJ5SWQoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIHZhcmlhYmxlIHdpdGggdGhlIHNwZWNpZmllZCB0eXBlLiBJZiB0eXBlIGlzIG51bGwsIHJldHVybiBsaXN0IG9mXG4gICAqICAgICB2YXJpYWJsZXMgd2l0aCBlbXB0eSBzdHJpbmcgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgVHlwZSBvZiB0aGUgdmFyaWFibGVzIHRvIGZpbmQuXG4gICAqIEByZXR1cm5zIFRoZSBzb3VnaHQgYWZ0ZXIgdmFyaWFibGVzIG9mIHRoZSBwYXNzZWQgaW4gdHlwZS4gQW4gZW1wdHkgYXJyYXlcbiAgICogICAgIGlmIG5vbmUgYXJlIGZvdW5kLlxuICAgKi9cbiAgZ2V0VmFyaWFibGVzT2ZUeXBlKHR5cGU6IHN0cmluZ3xudWxsKTogVmFyaWFibGVNb2RlbFtdIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZU1hcC5nZXRWYXJpYWJsZXNPZlR5cGUodHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB2YXJpYWJsZSB0eXBlcy5cbiAgICpcbiAgICogQHJldHVybnMgTGlzdCBvZiB2YXJpYWJsZSB0eXBlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRWYXJpYWJsZVR5cGVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZU1hcC5nZXRWYXJpYWJsZVR5cGVzKHRoaXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdmFyaWFibGVzIG9mIGFsbCB0eXBlcy5cbiAgICpcbiAgICogQHJldHVybnMgTGlzdCBvZiB2YXJpYWJsZSBtb2RlbHMuXG4gICAqL1xuICBnZXRBbGxWYXJpYWJsZXMoKTogVmFyaWFibGVNb2RlbFtdIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZU1hcC5nZXRBbGxWYXJpYWJsZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFsbCB2YXJpYWJsZSBuYW1lcyBvZiBhbGwgdHlwZXMuXG4gICAqXG4gICAqIEByZXR1cm5zIExpc3Qgb2YgYWxsIHZhcmlhYmxlIG5hbWVzIG9mIGFsbCB0eXBlcy5cbiAgICovXG4gIGdldEFsbFZhcmlhYmxlTmFtZXMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiB0aGlzLnZhcmlhYmxlTWFwLmdldEFsbFZhcmlhYmxlTmFtZXMoKTtcbiAgfVxuICAvKiBFbmQgZnVuY3Rpb25zIHRoYXQgYXJlIGp1c3QgcGFzcy10aHJvdWdocyB0byB0aGUgdmFyaWFibGUgbWFwLiAqL1xuICAvKipcbiAgICogUmV0dXJucyB0aGUgaG9yaXpvbnRhbCBvZmZzZXQgb2YgdGhlIHdvcmtzcGFjZS5cbiAgICogSW50ZW5kZWQgZm9yIExUUi9SVEwgY29tcGF0aWJpbGl0eSBpbiBYTUwuXG4gICAqIE5vdCByZWxldmFudCBmb3IgYSBoZWFkbGVzcyB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFdpZHRoLlxuICAgKi9cbiAgZ2V0V2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qIGVzbGludC1kaXNhYmxlIGpzZG9jL3JlcXVpcmUtcmV0dXJucy1jaGVjayAqL1xuICAvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi9cbiAgLyoqXG4gICAqIE9idGFpbiBhIG5ld2x5IGNyZWF0ZWQgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBwcm90b3R5cGVOYW1lIE5hbWUgb2YgdGhlIGxhbmd1YWdlIG9iamVjdCBjb250YWluaW5nIHR5cGUtc3BlY2lmaWNcbiAgICogICAgIGZ1bmN0aW9ucyBmb3IgdGhpcyBibG9jay5cbiAgICogQHBhcmFtIG9wdF9pZCBPcHRpb25hbCBJRC4gIFVzZSB0aGlzIElEIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3XG4gICAqICAgICBJRC5cbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgYmxvY2suXG4gICAqL1xuICBuZXdCbG9jayhwcm90b3R5cGVOYW1lOiBzdHJpbmcsIG9wdF9pZD86IHN0cmluZyk6IEJsb2NrIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUaGUgaW1wbGVtZW50YXRpb24gb2YgbmV3QmxvY2sgc2hvdWxkIGJlICcgK1xuICAgICAgICAnbW9ua2V5LXBhdGNoZWQgaW4gYnkgYmxvY2tseS50cycpO1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgKi9cblxuICAvKipcbiAgICogVGhlIG51bWJlciBvZiBibG9ja3MgdGhhdCBtYXkgYmUgYWRkZWQgdG8gdGhlIHdvcmtzcGFjZSBiZWZvcmUgcmVhY2hpbmdcbiAgICogICAgIHRoZSBtYXhCbG9ja3MuXG4gICAqXG4gICAqIEByZXR1cm5zIE51bWJlciBvZiBibG9ja3MgbGVmdC5cbiAgICovXG4gIHJlbWFpbmluZ0NhcGFjaXR5KCk6IG51bWJlciB7XG4gICAgaWYgKGlzTmFOKHRoaXMub3B0aW9ucy5tYXhCbG9ja3MpKSB7XG4gICAgICByZXR1cm4gSW5maW5pdHk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tYXhCbG9ja3MgLSB0aGlzLmdldEFsbEJsb2NrcyhmYWxzZSkubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBudW1iZXIgb2YgYmxvY2tzIG9mIHRoZSBnaXZlbiB0eXBlIHRoYXQgbWF5IGJlIGFkZGVkIHRvIHRoZSB3b3Jrc3BhY2VcbiAgICogICAgYmVmb3JlIHJlYWNoaW5nIHRoZSBtYXhJbnN0YW5jZXMgYWxsb3dlZCBmb3IgdGhhdCB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0gdHlwZSBUeXBlIG9mIGJsb2NrIHRvIHJldHVybiBjYXBhY2l0eSBmb3IuXG4gICAqIEByZXR1cm5zIE51bWJlciBvZiBibG9ja3Mgb2YgdHlwZSBsZWZ0LlxuICAgKi9cbiAgcmVtYWluaW5nQ2FwYWNpdHlPZlR5cGUodHlwZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5tYXhJbnN0YW5jZXMpIHtcbiAgICAgIHJldHVybiBJbmZpbml0eTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXhJbnN0YW5jZU9mVHlwZSA9IHRoaXMub3B0aW9ucy5tYXhJbnN0YW5jZXNbdHlwZV0gIT09IHVuZGVmaW5lZCA/XG4gICAgICAgIHRoaXMub3B0aW9ucy5tYXhJbnN0YW5jZXNbdHlwZV0gOlxuICAgICAgICBJbmZpbml0eTtcblxuICAgIHJldHVybiBtYXhJbnN0YW5jZU9mVHlwZSAtIHRoaXMuZ2V0QmxvY2tzQnlUeXBlKHR5cGUsIGZhbHNlKS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlcmUgaXMgcmVtYWluaW5nIGNhcGFjaXR5IGZvciBibG9ja3Mgb2YgdGhlIGdpdmVuIGNvdW50cyB0byBiZVxuICAgKiAgICBjcmVhdGVkLiBJZiB0aGUgdG90YWwgbnVtYmVyIG9mIGJsb2NrcyByZXByZXNlbnRlZCBieSB0aGUgbWFwIGlzIG1vcmVcbiAgICogdGhhbiB0aGUgdG90YWwgcmVtYWluaW5nIGNhcGFjaXR5LCBpdCByZXR1cm5zIGZhbHNlLiBJZiBhIHR5cGUgY291bnQgaXNcbiAgICogbW9yZSB0aGFuIHRoZSByZW1haW5pbmcgY2FwYWNpdHkgZm9yIHRoYXQgdHlwZSwgaXQgcmV0dXJucyBmYWxzZS5cbiAgICpcbiAgICogQHBhcmFtIHR5cGVDb3VudHNNYXAgQSBtYXAgb2YgdHlwZXMgdG8gY291bnRzICh1c3VhbGx5IHJlcHJlc2VudGluZyBibG9ja3NcbiAgICogICAgIHRvIGJlIGNyZWF0ZWQpLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZXJlIGlzIGNhcGFjaXR5IGZvciB0aGUgZ2l2ZW4gbWFwLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBpc0NhcGFjaXR5QXZhaWxhYmxlKHR5cGVDb3VudHNNYXA6IEFueUR1cmluZ01pZ3JhdGlvbik6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5oYXNCbG9ja0xpbWl0cygpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgbGV0IGNvcHlhYmxlQmxvY2tzQ291bnQgPSAwO1xuICAgIGZvciAoY29uc3QgdHlwZSBpbiB0eXBlQ291bnRzTWFwKSB7XG4gICAgICBpZiAodHlwZUNvdW50c01hcFt0eXBlXSA+IHRoaXMucmVtYWluaW5nQ2FwYWNpdHlPZlR5cGUodHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29weWFibGVCbG9ja3NDb3VudCArPSB0eXBlQ291bnRzTWFwW3R5cGVdO1xuICAgIH1cbiAgICBpZiAoY29weWFibGVCbG9ja3NDb3VudCA+IHRoaXMucmVtYWluaW5nQ2FwYWNpdHkoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIHdvcmtzcGFjZSBoYXMgYW55IGxpbWl0cyBvbiB0aGUgbWF4aW11bSBudW1iZXIgb2YgYmxvY2tzLFxuICAgKiAgICBvciB0aGUgbWF4aW11bSBudW1iZXIgb2YgYmxvY2tzIG9mIHNwZWNpZmljIHR5cGVzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGl0IGhhcyBibG9jayBsaW1pdHMsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIGhhc0Jsb2NrTGltaXRzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWF4QmxvY2tzICE9PSBJbmZpbml0eSB8fCAhIXRoaXMub3B0aW9ucy5tYXhJbnN0YW5jZXM7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdW5kbyBzdGFjayBmb3Igd29ya3BsYWNlLlxuICAgKlxuICAgKiBAcmV0dXJucyB1bmRvIHN0YWNrXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0VW5kb1N0YWNrKCk6IEFic3RyYWN0W10ge1xuICAgIHJldHVybiB0aGlzLnVuZG9TdGFja187XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgcmVkbyBzdGFjayBmb3Igd29ya3BsYWNlLlxuICAgKlxuICAgKiBAcmV0dXJucyByZWRvIHN0YWNrXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0UmVkb1N0YWNrKCk6IEFic3RyYWN0W10ge1xuICAgIHJldHVybiB0aGlzLnJlZG9TdGFja187XG4gIH1cblxuICAvKipcbiAgICogVW5kbyBvciByZWRvIHRoZSBwcmV2aW91cyBhY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSByZWRvIEZhbHNlIGlmIHVuZG8sIHRydWUgaWYgcmVkby5cbiAgICovXG4gIHVuZG8ocmVkbzogYm9vbGVhbikge1xuICAgIGNvbnN0IGlucHV0U3RhY2sgPSByZWRvID8gdGhpcy5yZWRvU3RhY2tfIDogdGhpcy51bmRvU3RhY2tfO1xuICAgIGNvbnN0IG91dHB1dFN0YWNrID0gcmVkbyA/IHRoaXMudW5kb1N0YWNrXyA6IHRoaXMucmVkb1N0YWNrXztcbiAgICBjb25zdCBpbnB1dEV2ZW50ID0gaW5wdXRTdGFjay5wb3AoKTtcbiAgICBpZiAoIWlucHV0RXZlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGV2ZW50cyA9IFtpbnB1dEV2ZW50XTtcbiAgICAvLyBEbyBhbm90aGVyIHVuZG8vcmVkbyBpZiB0aGUgbmV4dCBvbmUgaXMgb2YgdGhlIHNhbWUgZ3JvdXAuXG4gICAgd2hpbGUgKGlucHV0U3RhY2subGVuZ3RoICYmIGlucHV0RXZlbnQuZ3JvdXAgJiZcbiAgICAgICAgICAgaW5wdXRFdmVudC5ncm91cCA9PT0gaW5wdXRTdGFja1tpbnB1dFN0YWNrLmxlbmd0aCAtIDFdLmdyb3VwKSB7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ0Fic3RyYWN0IHwgdW5kZWZpbmVkJyBpc1xuICAgICAgLy8gbm90IGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ0Fic3RyYWN0Jy5cbiAgICAgIGV2ZW50cy5wdXNoKGlucHV0U3RhY2sucG9wKCkgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICB9XG4gICAgLy8gUHVzaCB0aGVzZSBwb3BwZWQgZXZlbnRzIG9uIHRoZSBvcHBvc2l0ZSBzdGFjay5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZXZlbnQgPSBldmVudHNbaV07XG4gICAgICBvdXRwdXRTdGFjay5wdXNoKGV2ZW50KTtcbiAgICB9XG4gICAgZXZlbnRzID0gZXZlbnRVdGlscy5maWx0ZXIoZXZlbnRzLCByZWRvKTtcbiAgICBldmVudFV0aWxzLnNldFJlY29yZFVuZG8oZmFsc2UpO1xuICAgIHRyeSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBldmVudCA9IGV2ZW50c1tpXTtcbiAgICAgICAgZXZlbnQucnVuKHJlZG8pO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBldmVudFV0aWxzLnNldFJlY29yZFVuZG8odHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqIENsZWFyIHRoZSB1bmRvL3JlZG8gc3RhY2tzLiAqL1xuICBjbGVhclVuZG8oKSB7XG4gICAgdGhpcy51bmRvU3RhY2tfLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5yZWRvU3RhY2tfLmxlbmd0aCA9IDA7XG4gICAgLy8gU3RvcCBhbnkgZXZlbnRzIGFscmVhZHkgaW4gdGhlIGZpcmluZyBxdWV1ZSBmcm9tIGJlaW5nIHVuZG9hYmxlLlxuICAgIGV2ZW50VXRpbHMuY2xlYXJQZW5kaW5nVW5kbygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gc29tZXRoaW5nIGluIHRoaXMgd29ya3NwYWNlIGNoYW5nZXMsIGNhbGwgYSBmdW5jdGlvbi5cbiAgICogTm90ZSB0aGF0IHRoZXJlIG1heSBiZSBhIGZldyByZWNlbnQgZXZlbnRzIGFscmVhZHkgb24gdGhlIHN0YWNrLiAgVGh1cyB0aGVcbiAgICogbmV3IGNoYW5nZSBsaXN0ZW5lciBtaWdodCBiZSBjYWxsZWQgd2l0aCBldmVudHMgdGhhdCBvY2N1cnJlZCBhIGZld1xuICAgKiBtaWxsaXNlY29uZHMgYmVmb3JlIHRoZSBjaGFuZ2UgbGlzdGVuZXIgd2FzIGFkZGVkLlxuICAgKlxuICAgKiBAcGFyYW0gZnVuYyBGdW5jdGlvbiB0byBjYWxsLlxuICAgKiBAcmV0dXJucyBPYnNvbGV0ZSByZXR1cm4gdmFsdWUsIGlnbm9yZS5cbiAgICovXG4gIGFkZENoYW5nZUxpc3RlbmVyKGZ1bmM6IEZ1bmN0aW9uKTogRnVuY3Rpb24ge1xuICAgIHRoaXMubGlzdGVuZXJzLnB1c2goZnVuYyk7XG4gICAgcmV0dXJuIGZ1bmM7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCBsaXN0ZW5pbmcgZm9yIHRoaXMgd29ya3NwYWNlJ3MgY2hhbmdlcy5cbiAgICpcbiAgICogQHBhcmFtIGZ1bmMgRnVuY3Rpb24gdG8gc3RvcCBjYWxsaW5nLlxuICAgKi9cbiAgcmVtb3ZlQ2hhbmdlTGlzdGVuZXIoZnVuYzogRnVuY3Rpb24pIHtcbiAgICBhcnJheVV0aWxzLnJlbW92ZUVsZW0odGhpcy5saXN0ZW5lcnMsIGZ1bmMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpcmUgYSBjaGFuZ2UgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBFdmVudCB0byBmaXJlLlxuICAgKi9cbiAgZmlyZUNoYW5nZUxpc3RlbmVyKGV2ZW50OiBBYnN0cmFjdCkge1xuICAgIGlmIChldmVudC5yZWNvcmRVbmRvKSB7XG4gICAgICB0aGlzLnVuZG9TdGFja18ucHVzaChldmVudCk7XG4gICAgICB0aGlzLnJlZG9TdGFja18ubGVuZ3RoID0gMDtcbiAgICAgIHdoaWxlICh0aGlzLnVuZG9TdGFja18ubGVuZ3RoID4gdGhpcy5NQVhfVU5ETyAmJiB0aGlzLk1BWF9VTkRPID49IDApIHtcbiAgICAgICAgdGhpcy51bmRvU3RhY2tfLnNoaWZ0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5saXN0ZW5lcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLmxpc3RlbmVyc1tpXTtcbiAgICAgIGZ1bmMoZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHRoZSBibG9jayBvbiB0aGlzIHdvcmtzcGFjZSB3aXRoIHRoZSBzcGVjaWZpZWQgSUQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBvZiBibG9jayB0byBmaW5kLlxuICAgKiBAcmV0dXJucyBUaGUgc291Z2h0IGFmdGVyIGJsb2NrLCBvciBudWxsIGlmIG5vdCBmb3VuZC5cbiAgICovXG4gIGdldEJsb2NrQnlJZChpZDogc3RyaW5nKTogQmxvY2t8bnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuYmxvY2tEQi5nZXQoaWQpIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGEgYmxvY2sgb24gdGhpcyB3b3Jrc3BhY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIElELlxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgb2YgYmxvY2sgdG8gc2V0LlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHNldC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRCbG9ja0J5SWQoaWQ6IHN0cmluZywgYmxvY2s6IEJsb2NrKSB7XG4gICAgdGhpcy5ibG9ja0RCLnNldChpZCwgYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhIGJsb2NrIG9mZiB0aGlzIHdvcmtzcGFjZSB3aXRoIHRoZSBzcGVjaWZpZWQgSUQuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBvZiBibG9jayB0byBkZWxldGUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVtb3ZlQmxvY2tCeUlkKGlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLmJsb2NrREIuZGVsZXRlKGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIHRoZSBjb21tZW50IG9uIHRoaXMgd29ya3NwYWNlIHdpdGggdGhlIHNwZWNpZmllZCBJRC5cbiAgICpcbiAgICogQHBhcmFtIGlkIElEIG9mIGNvbW1lbnQgdG8gZmluZC5cbiAgICogQHJldHVybnMgVGhlIHNvdWdodCBhZnRlciBjb21tZW50LCBvciBudWxsIGlmIG5vdCBmb3VuZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRDb21tZW50QnlJZChpZDogc3RyaW5nKTogV29ya3NwYWNlQ29tbWVudHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jb21tZW50REIuZ2V0KGlkKSA/PyBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyB3aGV0aGVyIGFsbCB2YWx1ZSBhbmQgc3RhdGVtZW50IGlucHV0cyBpbiB0aGUgd29ya3NwYWNlIGFyZSBmaWxsZWRcbiAgICogd2l0aCBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfc2hhZG93QmxvY2tzQXJlRmlsbGVkIEFuIG9wdGlvbmFsIGFyZ3VtZW50IGNvbnRyb2xsaW5nIHdoZXRoZXJcbiAgICogICAgIHNoYWRvdyBibG9ja3MgYXJlIGNvdW50ZWQgYXMgZmlsbGVkLiBEZWZhdWx0cyB0byB0cnVlLlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIGFsbCBpbnB1dHMgYXJlIGZpbGxlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgYWxsSW5wdXRzRmlsbGVkKG9wdF9zaGFkb3dCbG9ja3NBcmVGaWxsZWQ/OiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgY29uc3QgYmxvY2tzID0gdGhpcy5nZXRUb3BCbG9ja3MoZmFsc2UpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBibG9jayA9IGJsb2Nrc1tpXTtcbiAgICAgIGlmICghYmxvY2suYWxsSW5wdXRzRmlsbGVkKG9wdF9zaGFkb3dCbG9ja3NBcmVGaWxsZWQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSB2YXJpYWJsZSBtYXAgdGhhdCBjb250YWlucyBcInBvdGVudGlhbFwiIHZhcmlhYmxlcy5cbiAgICogVGhlc2UgZXhpc3QgaW4gdGhlIGZseW91dCBidXQgbm90IGluIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBwb3RlbnRpYWwgdmFyaWFibGUgbWFwLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFBvdGVudGlhbFZhcmlhYmxlTWFwKCk6IFZhcmlhYmxlTWFwfG51bGwge1xuICAgIHJldHVybiB0aGlzLnBvdGVudGlhbFZhcmlhYmxlTWFwO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbmQgc3RvcmUgdGhlIHBvdGVudGlhbCB2YXJpYWJsZSBtYXAgZm9yIHRoaXMgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNyZWF0ZVBvdGVudGlhbFZhcmlhYmxlTWFwKCkge1xuICAgIHRoaXMucG90ZW50aWFsVmFyaWFibGVNYXAgPSBuZXcgVmFyaWFibGVNYXAodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBtYXAgb2YgYWxsIHZhcmlhYmxlcyBvbiB0aGUgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgdmFyaWFibGUgbWFwLlxuICAgKi9cbiAgZ2V0VmFyaWFibGVNYXAoKTogVmFyaWFibGVNYXAge1xuICAgIHJldHVybiB0aGlzLnZhcmlhYmxlTWFwO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbWFwIG9mIGFsbCB2YXJpYWJsZXMgb24gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHZhcmlhYmxlTWFwIFRoZSB2YXJpYWJsZSBtYXAuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0VmFyaWFibGVNYXAodmFyaWFibGVNYXA6IFZhcmlhYmxlTWFwKSB7XG4gICAgdGhpcy52YXJpYWJsZU1hcCA9IHZhcmlhYmxlTWFwO1xuICB9XG5cbiAgLyoqIFJldHVybnMgdGhlIG1hcCBvZiBhbGwgcHJvY2VkdXJlcyBvbiB0aGUgd29ya3BhY2UuICovXG4gIGdldFByb2NlZHVyZU1hcCgpOiBJUHJvY2VkdXJlTWFwIHtcbiAgICByZXR1cm4gdGhpcy5wcm9jZWR1cmVNYXA7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgd29ya3NwYWNlIHdpdGggdGhlIHNwZWNpZmllZCBJRC5cbiAgICpcbiAgICogQHBhcmFtIGlkIElEIG9mIHdvcmtzcGFjZSB0byBmaW5kLlxuICAgKiBAcmV0dXJucyBUaGUgc291Z2h0IGFmdGVyIHdvcmtzcGFjZSBvciBudWxsIGlmIG5vdCBmb3VuZC5cbiAgICovXG4gIHN0YXRpYyBnZXRCeUlkKGlkOiBzdHJpbmcpOiBXb3Jrc3BhY2V8bnVsbCB7XG4gICAgcmV0dXJuIGNvbW1vbi5nZXRXb3Jrc3BhY2VCeUlkKGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGFsbCB3b3Jrc3BhY2VzLlxuICAgKlxuICAgKiBAcmV0dXJucyBBcnJheSBvZiB3b3Jrc3BhY2VzLlxuICAgKi9cbiAgc3RhdGljIGdldEFsbCgpOiBXb3Jrc3BhY2VbXSB7XG4gICAgcmV0dXJuIGNvbW1vbi5nZXRBbGxXb3Jrc3BhY2VzKCk7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgaW4gY2hhcmdlIG9mIGxvYWRpbmcsIHN0b3JpbmcsIGFuZCBwbGF5aW5nIGF1ZGlvIGZvciBhXG4gKiAgICAgd29ya3NwYWNlLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LldvcmtzcGFjZUF1ZGlvJyk7XG5cbmltcG9ydCAqIGFzIHVzZXJBZ2VudCBmcm9tICcuL3V0aWxzL3VzZXJhZ2VudC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5cbi8qKlxuICogUHJldmVudCBhIHNvdW5kIGZyb20gcGxheWluZyBpZiBhbm90aGVyIHNvdW5kIHByZWNlZGVkIGl0IHdpdGhpbiB0aGlzIG1hbnlcbiAqIG1pbGxpc2Vjb25kcy5cbiAqL1xuY29uc3QgU09VTkRfTElNSVQgPSAxMDA7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGxvYWRpbmcsIHN0b3JpbmcsIGFuZCBwbGF5aW5nIGF1ZGlvIGZvciBhIHdvcmtzcGFjZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Xb3Jrc3BhY2VBdWRpb1xuICovXG5leHBvcnQgY2xhc3MgV29ya3NwYWNlQXVkaW8ge1xuICAvKiogRGF0YWJhc2Ugb2YgcHJlLWxvYWRlZCBzb3VuZHMuICovXG4gIHByaXZhdGUgc291bmRzID0gbmV3IE1hcDxzdHJpbmcsIEhUTUxBdWRpb0VsZW1lbnQ+KCk7XG5cbiAgLyoqIFRpbWUgdGhhdCB0aGUgbGFzdCBzb3VuZCB3YXMgcGxheWVkLiAqL1xuICBwcml2YXRlIGxhc3RTb3VuZF86IERhdGV8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBwYXJlbnRXb3Jrc3BhY2UgVGhlIHBhcmVudCBvZiB0aGUgd29ya3NwYWNlIHRoaXMgYXVkaW8gb2JqZWN0XG4gICAqICAgICBiZWxvbmdzIHRvLCBvciBudWxsLlxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwYXJlbnRXb3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge31cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIGF1ZGlvIG1hbmFnZXIuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICB0aGlzLnNvdW5kcy5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgYW4gYXVkaW8gZmlsZS4gIENhY2hlIGl0LCByZWFkeSBmb3IgaW5zdGFudGFuZW91cyBwbGF5aW5nLlxuICAgKlxuICAgKiBAcGFyYW0gZmlsZW5hbWVzIExpc3Qgb2YgZmlsZSB0eXBlcyBpbiBkZWNyZWFzaW5nIG9yZGVyIG9mIHByZWZlcmVuY2UgKGkuZS5cbiAgICogICAgIGluY3JlYXNpbmcgc2l6ZSkuICBFLmcuIFsnbWVkaWEvZ28ubXAzJywgJ21lZGlhL2dvLndhdiddIEZpbGVuYW1lc1xuICAgKiAgICAgaW5jbHVkZSBwYXRoIGZyb20gQmxvY2tseSdzIHJvb3QuICBGaWxlIGV4dGVuc2lvbnMgbWF0dGVyLlxuICAgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHNvdW5kLlxuICAgKi9cbiAgbG9hZChmaWxlbmFtZXM6IHN0cmluZ1tdLCBuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIWZpbGVuYW1lcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGF1ZGlvVGVzdDtcbiAgICB0cnkge1xuICAgICAgYXVkaW9UZXN0ID0gbmV3IGdsb2JhbFRoaXNbJ0F1ZGlvJ10oKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBObyBicm93c2VyIHN1cHBvcnQgZm9yIEF1ZGlvLlxuICAgICAgLy8gSUUgY2FuIHRocm93IGFuIGVycm9yIGV2ZW4gaWYgdGhlIEF1ZGlvIG9iamVjdCBleGlzdHMuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBzb3VuZDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVuYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZmlsZW5hbWUgPSBmaWxlbmFtZXNbaV07XG4gICAgICBjb25zdCBleHQgPSBmaWxlbmFtZS5tYXRjaCgvXFwuKFxcdyspJC8pO1xuICAgICAgaWYgKGV4dCAmJiBhdWRpb1Rlc3QuY2FuUGxheVR5cGUoJ2F1ZGlvLycgKyBleHRbMV0pKSB7XG4gICAgICAgIC8vIEZvdW5kIGFuIGF1ZGlvIGZvcm1hdCB3ZSBjYW4gcGxheS5cbiAgICAgICAgc291bmQgPSBuZXcgZ2xvYmFsVGhpc1snQXVkaW8nXShmaWxlbmFtZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc291bmQpIHtcbiAgICAgIHRoaXMuc291bmRzLnNldChuYW1lLCBzb3VuZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByZWxvYWQgYWxsIHRoZSBhdWRpbyBmaWxlcyBzbyB0aGF0IHRoZXkgcGxheSBxdWlja2x5IHdoZW4gYXNrZWQgZm9yLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHByZWxvYWQoKSB7XG4gICAgZm9yIChjb25zdCBzb3VuZCBvZiB0aGlzLnNvdW5kcy52YWx1ZXMoKSkge1xuICAgICAgc291bmQudm9sdW1lID0gMC4wMTtcbiAgICAgIGNvbnN0IHBsYXlQcm9taXNlID0gc291bmQucGxheSgpO1xuICAgICAgLy8gRWRnZSBkb2VzIG5vdCByZXR1cm4gYSBwcm9taXNlLCBzbyB3ZSBuZWVkIHRvIGNoZWNrLlxuICAgICAgaWYgKHBsYXlQcm9taXNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gSWYgd2UgZG9uJ3Qgd2FpdCBmb3IgdGhlIHBsYXkgcmVxdWVzdCB0byBjb21wbGV0ZSBiZWZvcmUgY2FsbGluZ1xuICAgICAgICAvLyBwYXVzZSgpIHdlIHdpbGwgZ2V0IGFuIGV4Y2VwdGlvbjogKERPTUV4Y2VwdGlvbjogVGhlIHBsYXkoKSByZXF1ZXN0XG4gICAgICAgIC8vIHdhcyBpbnRlcnJ1cHRlZCkgU2VlIG1vcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3dlYi91cGRhdGVzLzIwMTcvMDYvcGxheS1yZXF1ZXN0LXdhcy1pbnRlcnJ1cHRlZFxuICAgICAgICBwbGF5UHJvbWlzZS50aGVuKHNvdW5kLnBhdXNlKVxuICAgICAgICAgICAgLmNhdGNoKFxuICAgICAgICAgICAgICAgIC8vIFBsYXkgd2l0aG91dCB1c2VyIGludGVyYWN0aW9uIHdhcyBwcmV2ZW50ZWQuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7fSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzb3VuZC5wYXVzZSgpO1xuICAgICAgfVxuXG4gICAgICAvLyBpT1MgY2FuIG9ubHkgcHJvY2VzcyBvbmUgc291bmQgYXQgYSB0aW1lLiAgVHJ5aW5nIHRvIGxvYWQgbW9yZSB0aGFuIG9uZVxuICAgICAgLy8gY29ycnVwdHMgdGhlIGVhcmxpZXIgb25lcy4gIEp1c3QgbG9hZCBvbmUgYW5kIGxlYXZlIHRoZSBvdGhlcnNcbiAgICAgIC8vIHVuY2FjaGVkLlxuICAgICAgaWYgKHVzZXJBZ2VudC5JUEFEIHx8IHVzZXJBZ2VudC5JUEhPTkUpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBsYXkgYSBuYW1lZCBzb3VuZCBhdCBzcGVjaWZpZWQgdm9sdW1lLiAgSWYgdm9sdW1lIGlzIG5vdCBzcGVjaWZpZWQsXG4gICAqIHVzZSBmdWxsIHZvbHVtZSAoMSkuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIE5hbWUgb2Ygc291bmQuXG4gICAqIEBwYXJhbSBvcHRfdm9sdW1lIFZvbHVtZSBvZiBzb3VuZCAoMC0xKS5cbiAgICovXG4gIHBsYXkobmFtZTogc3RyaW5nLCBvcHRfdm9sdW1lPzogbnVtYmVyKSB7XG4gICAgY29uc3Qgc291bmQgPSB0aGlzLnNvdW5kcy5nZXQobmFtZSk7XG4gICAgaWYgKHNvdW5kKSB7XG4gICAgICAvLyBEb24ndCBwbGF5IG9uZSBzb3VuZCBvbiB0b3Agb2YgYW5vdGhlci5cbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBpZiAodGhpcy5sYXN0U291bmRfICE9PSBudWxsICYmXG4gICAgICAgICAgbm93LmdldFRpbWUoKSAtIHRoaXMubGFzdFNvdW5kXy5nZXRUaW1lKCkgPCBTT1VORF9MSU1JVCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmxhc3RTb3VuZF8gPSBub3c7XG4gICAgICBsZXQgbXlTb3VuZDtcbiAgICAgIGlmICh1c2VyQWdlbnQuSVBBRCB8fCB1c2VyQWdlbnQuQU5EUk9JRCkge1xuICAgICAgICAvLyBDcmVhdGluZyBhIG5ldyBhdWRpbyBub2RlIGNhdXNlcyBsYWcgaW4gQW5kcm9pZCBhbmQgaVBhZC4gIEFuZHJvaWRcbiAgICAgICAgLy8gcmVmZXRjaGVzIHRoZSBmaWxlIGZyb20gdGhlIHNlcnZlciwgaVBhZCB1c2VzIGEgc2luZ2xldG9uIGF1ZGlvXG4gICAgICAgIC8vIG5vZGUgd2hpY2ggbXVzdCBiZSBkZWxldGVkIGFuZCByZWNyZWF0ZWQgZm9yIGVhY2ggbmV3IGF1ZGlvIHRhZy5cbiAgICAgICAgbXlTb3VuZCA9IHNvdW5kO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbXlTb3VuZCA9IHNvdW5kLmNsb25lTm9kZSgpIGFzIEhUTUxBdWRpb0VsZW1lbnQ7XG4gICAgICB9XG4gICAgICBteVNvdW5kLnZvbHVtZSA9IG9wdF92b2x1bWUgPT09IHVuZGVmaW5lZCA/IDEgOiBvcHRfdm9sdW1lO1xuICAgICAgbXlTb3VuZC5wbGF5KCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnBhcmVudFdvcmtzcGFjZSkge1xuICAgICAgLy8gTWF5YmUgYSB3b3Jrc3BhY2Ugb24gYSBsb3dlciBsZXZlbCBrbm93cyBhYm91dCB0aGlzIHNvdW5kLlxuICAgICAgdGhpcy5wYXJlbnRXb3Jrc3BhY2UuZ2V0QXVkaW9NYW5hZ2VyKCkucGxheShuYW1lLCBvcHRfdm9sdW1lKTtcbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE1IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmVwcmVzZW50aW5nIGEgem9vbSBpY29ucy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5ab29tQ29udHJvbHMnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfY2xpY2suanMnO1xuXG5pbXBvcnQgKiBhcyBicm93c2VyRXZlbnRzIGZyb20gJy4vYnJvd3Nlcl9ldmVudHMuanMnO1xuaW1wb3J0IHtDb21wb25lbnRNYW5hZ2VyfSBmcm9tICcuL2NvbXBvbmVudF9tYW5hZ2VyLmpzJztcbmltcG9ydCAqIGFzIENzcyBmcm9tICcuL2Nzcy5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtJUG9zaXRpb25hYmxlfSBmcm9tICcuL2ludGVyZmFjZXMvaV9wb3NpdGlvbmFibGUuanMnO1xuaW1wb3J0IHR5cGUge1VpTWV0cmljc30gZnJvbSAnLi9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0ICogYXMgdWlQb3NpdGlvbiBmcm9tICcuL3Bvc2l0aW9uYWJsZV9oZWxwZXJzLmpzJztcbmltcG9ydCB7U1BSSVRFfSBmcm9tICcuL3Nwcml0ZXMuanMnO1xuaW1wb3J0ICogYXMgVG91Y2ggZnJvbSAnLi90b3VjaC5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtSZWN0fSBmcm9tICcuL3V0aWxzL3JlY3QuanMnO1xuaW1wb3J0IHtTaXplfSBmcm9tICcuL3V0aWxzL3NpemUuanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSB6b29tIGNvbnRyb2xzLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5Llpvb21Db250cm9sc1xuICovXG5leHBvcnQgY2xhc3MgWm9vbUNvbnRyb2xzIGltcGxlbWVudHMgSVBvc2l0aW9uYWJsZSB7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIElEIGZvciB0aGlzIGNvbXBvbmVudCB0aGF0IGlzIHVzZWQgdG8gcmVnaXN0ZXIgd2l0aCB0aGVcbiAgICogQ29tcG9uZW50TWFuYWdlci5cbiAgICovXG4gIGlkID0gJ3pvb21Db250cm9scyc7XG5cbiAgLyoqXG4gICAqIEEgaGFuZGxlIHRvIHVzZSB0byB1bmJpbmQgdGhlIG1vdXNlIGRvd24gZXZlbnQgaGFuZGxlciBmb3Igem9vbSByZXNldFxuICAgKiAgICBidXR0b24uIE9wYXF1ZSBkYXRhIHJldHVybmVkIGZyb20gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQuXG4gICAqL1xuICBwcml2YXRlIG9uWm9vbVJlc2V0V3JhcHBlcjogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBBIGhhbmRsZSB0byB1c2UgdG8gdW5iaW5kIHRoZSBtb3VzZSBkb3duIGV2ZW50IGhhbmRsZXIgZm9yIHpvb20gaW5cbiAgICogYnV0dG9uLiBPcGFxdWUgZGF0YSByZXR1cm5lZCBmcm9tIGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kLlxuICAgKi9cbiAgcHJpdmF0ZSBvblpvb21JbldyYXBwZXI6IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQSBoYW5kbGUgdG8gdXNlIHRvIHVuYmluZCB0aGUgbW91c2UgZG93biBldmVudCBoYW5kbGVyIGZvciB6b29tIG91dFxuICAgKiBidXR0b24uIE9wYXF1ZSBkYXRhIHJldHVybmVkIGZyb20gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQuXG4gICAqL1xuICBwcml2YXRlIG9uWm9vbU91dFdyYXBwZXI6IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIHpvb20gaW4gc3ZnIDxnPiBlbGVtZW50LiAqL1xuICBwcml2YXRlIHpvb21Jbkdyb3VwOiBTVkdHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIHpvb20gb3V0IHN2ZyA8Zz4gZWxlbWVudC4gKi9cbiAgcHJpdmF0ZSB6b29tT3V0R3JvdXA6IFNWR0dFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgem9vbSByZXNldCBzdmcgPGc+IGVsZW1lbnQuICovXG4gIHByaXZhdGUgem9vbVJlc2V0R3JvdXA6IFNWR0dFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBXaWR0aCBvZiB0aGUgem9vbSBjb250cm9scy4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBXSURUSCA9IDMyO1xuXG4gIC8qKiBIZWlnaHQgb2YgZWFjaCB6b29tIGNvbnRyb2wuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgSEVJR0hUID0gMzI7XG5cbiAgLyoqIFNtYWxsIHNwYWNpbmcgdXNlZCBiZXR3ZWVuIHRoZSB6b29tIGluIGFuZCBvdXQgY29udHJvbCwgaW4gcGl4ZWxzLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IFNNQUxMX1NQQUNJTkcgPSAyO1xuXG4gIC8qKlxuICAgKiBMYXJnZSBzcGFjaW5nIHVzZWQgYmV0d2VlbiB0aGUgem9vbSBpbiBhbmQgcmVzZXQgY29udHJvbCwgaW4gcGl4ZWxzLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBMQVJHRV9TUEFDSU5HID0gMTE7XG5cbiAgLyoqIERpc3RhbmNlIGJldHdlZW4gem9vbSBjb250cm9scyBhbmQgYm90dG9tIG9yIHRvcCBlZGdlIG9mIHdvcmtzcGFjZS4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBNQVJHSU5fVkVSVElDQUwgPSAyMDtcblxuICAvKiogRGlzdGFuY2UgYmV0d2VlbiB6b29tIGNvbnRyb2xzIGFuZCByaWdodCBvciBsZWZ0IGVkZ2Ugb2Ygd29ya3NwYWNlLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IE1BUkdJTl9IT1JJWk9OVEFMID0gMjA7XG5cbiAgLyoqIFRoZSBTVkcgZ3JvdXAgY29udGFpbmluZyB0aGUgem9vbSBjb250cm9scy4gKi9cbiAgcHJpdmF0ZSBzdmdHcm91cDogU1ZHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogTGVmdCBjb29yZGluYXRlIG9mIHRoZSB6b29tIGNvbnRyb2xzLiAqL1xuICBwcml2YXRlIGxlZnQgPSAwO1xuXG4gIC8qKiBUb3AgY29vcmRpbmF0ZSBvZiB0aGUgem9vbSBjb250cm9scy4gKi9cbiAgcHJpdmF0ZSB0b3AgPSAwO1xuXG4gIC8qKiBXaGV0aGVyIHRoaXMgaGFzIGJlZW4gaW5pdGlhbGl6ZWQuICovXG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICAvKiogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNpdCBpbi4gKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge31cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSB6b29tIGNvbnRyb2xzLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgem9vbSBjb250cm9scyBTVkcgZ3JvdXAuXG4gICAqL1xuICBjcmVhdGVEb20oKTogU1ZHRWxlbWVudCB7XG4gICAgdGhpcy5zdmdHcm91cCA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5HLCB7fSk7XG5cbiAgICAvLyBFYWNoIGZpbHRlci9wYXR0ZXJuIG5lZWRzIGEgdW5pcXVlIElEIGZvciB0aGUgY2FzZSBvZiBtdWx0aXBsZSBCbG9ja2x5XG4gICAgLy8gaW5zdGFuY2VzIG9uIGEgcGFnZS4gIEJyb3dzZXIgYmVoYXZpb3VyIGJlY29tZXMgdW5kZWZpbmVkIG90aGVyd2lzZS5cbiAgICAvLyBodHRwczovL25laWwuZnJhc2VyLm5hbWUvbmV3cy8yMDE1LzExLzAxL1xuICAgIGNvbnN0IHJuZCA9IFN0cmluZyhNYXRoLnJhbmRvbSgpKS5zdWJzdHJpbmcoMik7XG4gICAgdGhpcy5jcmVhdGVab29tT3V0U3ZnKHJuZCk7XG4gICAgdGhpcy5jcmVhdGVab29tSW5Tdmcocm5kKTtcbiAgICBpZiAodGhpcy53b3Jrc3BhY2UuaXNNb3ZhYmxlKCkpIHtcbiAgICAgIC8vIElmIHdlIHpvb20gdG8gdGhlIGNlbnRlciBhbmQgdGhlIHdvcmtzcGFjZSBpc24ndCBtb3ZhYmxlIHdlIGNvdWxkXG4gICAgICAvLyBsb29zZSBibG9ja3MgYXQgdGhlIGVkZ2VzIG9mIHRoZSB3b3Jrc3BhY2UuXG4gICAgICB0aGlzLmNyZWF0ZVpvb21SZXNldFN2ZyhybmQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zdmdHcm91cDtcbiAgfVxuXG4gIC8qKiBJbml0aWFsaXplcyB0aGUgem9vbSBjb250cm9scy4gKi9cbiAgaW5pdCgpIHtcbiAgICB0aGlzLndvcmtzcGFjZS5nZXRDb21wb25lbnRNYW5hZ2VyKCkuYWRkQ29tcG9uZW50KHtcbiAgICAgIGNvbXBvbmVudDogdGhpcyxcbiAgICAgIHdlaWdodDogMixcbiAgICAgIGNhcGFiaWxpdGllczogW0NvbXBvbmVudE1hbmFnZXIuQ2FwYWJpbGl0eS5QT1NJVElPTkFCTEVdLFxuICAgIH0pO1xuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2VzIG9mIHRoaXMgem9vbSBjb250cm9scy5cbiAgICogVW5saW5rIGZyb20gYWxsIERPTSBlbGVtZW50cyB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcy5cbiAgICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy53b3Jrc3BhY2UuZ2V0Q29tcG9uZW50TWFuYWdlcigpLnJlbW92ZUNvbXBvbmVudCgnem9vbUNvbnRyb2xzJyk7XG4gICAgaWYgKHRoaXMuc3ZnR3JvdXApIHtcbiAgICAgIGRvbS5yZW1vdmVOb2RlKHRoaXMuc3ZnR3JvdXApO1xuICAgIH1cbiAgICBpZiAodGhpcy5vblpvb21SZXNldFdyYXBwZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25ab29tUmVzZXRXcmFwcGVyKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub25ab29tSW5XcmFwcGVyKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uWm9vbUluV3JhcHBlcik7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uWm9vbU91dFdyYXBwZXIpIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25ab29tT3V0V3JhcHBlcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGJvdW5kaW5nIHJlY3RhbmdsZSBvZiB0aGUgVUkgZWxlbWVudCBpbiBwaXhlbCB1bml0cyByZWxhdGl2ZSB0b1xuICAgKiB0aGUgQmxvY2tseSBpbmplY3Rpb24gZGl2LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgVUkgZWxlbWVudHMncyBib3VuZGluZyBib3guIE51bGwgaWYgYm91bmRpbmcgYm94IHNob3VsZCBiZVxuICAgKiAgICAgaWdub3JlZCBieSBvdGhlciBVSSBlbGVtZW50cy5cbiAgICovXG4gIGdldEJvdW5kaW5nUmVjdGFuZ2xlKCk6IFJlY3R8bnVsbCB7XG4gICAgbGV0IGhlaWdodCA9IHRoaXMuU01BTExfU1BBQ0lORyArIDIgKiB0aGlzLkhFSUdIVDtcbiAgICBpZiAodGhpcy56b29tUmVzZXRHcm91cCkge1xuICAgICAgaGVpZ2h0ICs9IHRoaXMuTEFSR0VfU1BBQ0lORyArIHRoaXMuSEVJR0hUO1xuICAgIH1cbiAgICBjb25zdCBib3R0b20gPSB0aGlzLnRvcCArIGhlaWdodDtcbiAgICBjb25zdCByaWdodCA9IHRoaXMubGVmdCArIHRoaXMuV0lEVEg7XG4gICAgcmV0dXJuIG5ldyBSZWN0KHRoaXMudG9wLCBib3R0b20sIHRoaXMubGVmdCwgcmlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc2l0aW9ucyB0aGUgem9vbSBjb250cm9scy5cbiAgICogSXQgaXMgcG9zaXRpb25lZCBpbiB0aGUgb3Bwb3NpdGUgY29ybmVyIHRvIHRoZSBjb3JuZXIgdGhlXG4gICAqIGNhdGVnb3JpZXMvdG9vbGJveCBzdGFydHMgYXQuXG4gICAqXG4gICAqIEBwYXJhbSBtZXRyaWNzIFRoZSB3b3Jrc3BhY2UgbWV0cmljcy5cbiAgICogQHBhcmFtIHNhdmVkUG9zaXRpb25zIExpc3Qgb2YgcmVjdGFuZ2xlcyB0aGF0IGFyZSBhbHJlYWR5IG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqL1xuICBwb3NpdGlvbihtZXRyaWNzOiBVaU1ldHJpY3MsIHNhdmVkUG9zaXRpb25zOiBSZWN0W10pIHtcbiAgICAvLyBOb3QgeWV0IGluaXRpYWxpemVkLlxuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGNvcm5lclBvc2l0aW9uID1cbiAgICAgICAgdWlQb3NpdGlvbi5nZXRDb3JuZXJPcHBvc2l0ZVRvb2xib3godGhpcy53b3Jrc3BhY2UsIG1ldHJpY3MpO1xuICAgIGxldCBoZWlnaHQgPSB0aGlzLlNNQUxMX1NQQUNJTkcgKyAyICogdGhpcy5IRUlHSFQ7XG4gICAgaWYgKHRoaXMuem9vbVJlc2V0R3JvdXApIHtcbiAgICAgIGhlaWdodCArPSB0aGlzLkxBUkdFX1NQQUNJTkcgKyB0aGlzLkhFSUdIVDtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnRSZWN0ID0gdWlQb3NpdGlvbi5nZXRTdGFydFBvc2l0aW9uUmVjdChcbiAgICAgICAgY29ybmVyUG9zaXRpb24sIG5ldyBTaXplKHRoaXMuV0lEVEgsIGhlaWdodCksIHRoaXMuTUFSR0lOX0hPUklaT05UQUwsXG4gICAgICAgIHRoaXMuTUFSR0lOX1ZFUlRJQ0FMLCBtZXRyaWNzLCB0aGlzLndvcmtzcGFjZSk7XG5cbiAgICBjb25zdCB2ZXJ0aWNhbFBvc2l0aW9uID0gY29ybmVyUG9zaXRpb24udmVydGljYWw7XG4gICAgY29uc3QgYnVtcERpcmVjdGlvbiA9IHZlcnRpY2FsUG9zaXRpb24gPT09IHVpUG9zaXRpb24udmVydGljYWxQb3NpdGlvbi5UT1AgP1xuICAgICAgICB1aVBvc2l0aW9uLmJ1bXBEaXJlY3Rpb24uRE9XTiA6XG4gICAgICAgIHVpUG9zaXRpb24uYnVtcERpcmVjdGlvbi5VUDtcbiAgICBjb25zdCBwb3NpdGlvblJlY3QgPSB1aVBvc2l0aW9uLmJ1bXBQb3NpdGlvblJlY3QoXG4gICAgICAgIHN0YXJ0UmVjdCwgdGhpcy5NQVJHSU5fVkVSVElDQUwsIGJ1bXBEaXJlY3Rpb24sIHNhdmVkUG9zaXRpb25zKTtcblxuICAgIGlmICh2ZXJ0aWNhbFBvc2l0aW9uID09PSB1aVBvc2l0aW9uLnZlcnRpY2FsUG9zaXRpb24uVE9QKSB7XG4gICAgICBjb25zdCB6b29tSW5UcmFuc2xhdGVZID0gdGhpcy5TTUFMTF9TUEFDSU5HICsgdGhpcy5IRUlHSFQ7XG4gICAgICB0aGlzLnpvb21Jbkdyb3VwPy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwgJyArIHpvb21JblRyYW5zbGF0ZVkgKyAnKScpO1xuICAgICAgaWYgKHRoaXMuem9vbVJlc2V0R3JvdXApIHtcbiAgICAgICAgY29uc3Qgem9vbVJlc2V0VHJhbnNsYXRlWSA9XG4gICAgICAgICAgICB6b29tSW5UcmFuc2xhdGVZICsgdGhpcy5MQVJHRV9TUEFDSU5HICsgdGhpcy5IRUlHSFQ7XG4gICAgICAgIHRoaXMuem9vbVJlc2V0R3JvdXAuc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwgJyArIHpvb21SZXNldFRyYW5zbGF0ZVkgKyAnKScpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB6b29tSW5UcmFuc2xhdGVZID1cbiAgICAgICAgICB0aGlzLnpvb21SZXNldEdyb3VwID8gdGhpcy5MQVJHRV9TUEFDSU5HICsgdGhpcy5IRUlHSFQgOiAwO1xuICAgICAgdGhpcy56b29tSW5Hcm91cD8uc2V0QXR0cmlidXRlKFxuICAgICAgICAgICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsICcgKyB6b29tSW5UcmFuc2xhdGVZICsgJyknKTtcbiAgICAgIGNvbnN0IHpvb21PdXRUcmFuc2xhdGVZID1cbiAgICAgICAgICB6b29tSW5UcmFuc2xhdGVZICsgdGhpcy5TTUFMTF9TUEFDSU5HICsgdGhpcy5IRUlHSFQ7XG4gICAgICB0aGlzLnpvb21PdXRHcm91cD8uc2V0QXR0cmlidXRlKFxuICAgICAgICAgICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsICcgKyB6b29tT3V0VHJhbnNsYXRlWSArICcpJyk7XG4gICAgfVxuXG4gICAgdGhpcy50b3AgPSBwb3NpdGlvblJlY3QudG9wO1xuICAgIHRoaXMubGVmdCA9IHBvc2l0aW9uUmVjdC5sZWZ0O1xuICAgIHRoaXMuc3ZnR3JvdXA/LnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHRoaXMubGVmdCArICcsJyArIHRoaXMudG9wICsgJyknKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIHpvb20gaW4gaWNvbiBhbmQgaXRzIGV2ZW50IGhhbmRsZXIuXG4gICAqXG4gICAqIEBwYXJhbSBybmQgVGhlIHJhbmRvbSBzdHJpbmcgdG8gdXNlIGFzIGEgc3VmZml4IGluIHRoZSBjbGlwIHBhdGgncyBJRC5cbiAgICogICAgIFRoZXNlIElEcyBtdXN0IGJlIHVuaXF1ZSBpbiBjYXNlIHRoZXJlIGFyZSBtdWx0aXBsZSBCbG9ja2x5IGluc3RhbmNlc1xuICAgKiAgICAgb24gdGhlIHNhbWUgcGFnZS5cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlWm9vbU91dFN2ZyhybmQ6IHN0cmluZykge1xuICAgIC8qIFRoaXMgbWFya3VwIHdpbGwgYmUgZ2VuZXJhdGVkIGFuZCBhZGRlZCB0byB0aGUgLnN2Z0dyb3VwOlxuICAgICAgICA8ZyBjbGFzcz1cImJsb2NrbHlab29tXCI+XG4gICAgICAgICAgPGNsaXBQYXRoIGlkPVwiYmxvY2tseVpvb21vdXRDbGlwUGF0aDgzNzQ5M1wiPlxuICAgICAgICAgICAgPHJlY3Qgd2lkdGg9XCIzMlwiIGhlaWdodD1cIjMyPjwvcmVjdD5cbiAgICAgICAgICA8L2NsaXBQYXRoPlxuICAgICAgICAgIDxpbWFnZSB3aWR0aD1cIjk2XCIgaGVpZ2h0PVwiMTI0XCIgeD1cIi02NFwiIHk9XCItOTJcIlxuICAgICAgICB4bGluazpocmVmPVwibWVkaWEvc3ByaXRlcy5wbmdcIlxuICAgICAgICAgICAgICBjbGlwLXBhdGg9XCJ1cmwoI2Jsb2NrbHlab29tb3V0Q2xpcFBhdGg4Mzc0OTMpXCI+PC9pbWFnZT5cbiAgICAgICAgPC9nPlxuICAgICAgICAqL1xuICAgIHRoaXMuem9vbU91dEdyb3VwID1cbiAgICAgICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkcsIHsnY2xhc3MnOiAnYmxvY2tseVpvb20nfSwgdGhpcy5zdmdHcm91cCk7XG4gICAgY29uc3QgY2xpcCA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuQ0xJUFBBVEgsIHsnaWQnOiAnYmxvY2tseVpvb21vdXRDbGlwUGF0aCcgKyBybmR9LFxuICAgICAgICB0aGlzLnpvb21PdXRHcm91cCk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgJ3dpZHRoJzogMzIsXG4gICAgICAgICAgJ2hlaWdodCc6IDMyLFxuICAgICAgICB9LFxuICAgICAgICBjbGlwKTtcbiAgICBjb25zdCB6b29tb3V0U3ZnID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5JTUFHRSwge1xuICAgICAgICAgICd3aWR0aCc6IFNQUklURS53aWR0aCxcbiAgICAgICAgICAnaGVpZ2h0JzogU1BSSVRFLmhlaWdodCxcbiAgICAgICAgICAneCc6IC02NCxcbiAgICAgICAgICAneSc6IC05MixcbiAgICAgICAgICAnY2xpcC1wYXRoJzogJ3VybCgjYmxvY2tseVpvb21vdXRDbGlwUGF0aCcgKyBybmQgKyAnKScsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuem9vbU91dEdyb3VwKTtcbiAgICB6b29tb3V0U3ZnLnNldEF0dHJpYnV0ZU5TKFxuICAgICAgICBkb20uWExJTktfTlMsICd4bGluazpocmVmJyxcbiAgICAgICAgdGhpcy53b3Jrc3BhY2Uub3B0aW9ucy5wYXRoVG9NZWRpYSArIFNQUklURS51cmwpO1xuXG4gICAgLy8gQXR0YWNoIGxpc3RlbmVyLlxuICAgIHRoaXMub25ab29tT3V0V3JhcHBlciA9IGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICB0aGlzLnpvb21PdXRHcm91cCwgJ3BvaW50ZXJkb3duJywgbnVsbCwgdGhpcy56b29tLmJpbmQodGhpcywgLTEpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIHpvb20gb3V0IGljb24gYW5kIGl0cyBldmVudCBoYW5kbGVyLlxuICAgKlxuICAgKiBAcGFyYW0gcm5kIFRoZSByYW5kb20gc3RyaW5nIHRvIHVzZSBhcyBhIHN1ZmZpeCBpbiB0aGUgY2xpcCBwYXRoJ3MgSUQuXG4gICAqICAgICBUaGVzZSBJRHMgbXVzdCBiZSB1bmlxdWUgaW4gY2FzZSB0aGVyZSBhcmUgbXVsdGlwbGUgQmxvY2tseSBpbnN0YW5jZXNcbiAgICogICAgIG9uIHRoZSBzYW1lIHBhZ2UuXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZVpvb21JblN2ZyhybmQ6IHN0cmluZykge1xuICAgIC8qIFRoaXMgbWFya3VwIHdpbGwgYmUgZ2VuZXJhdGVkIGFuZCBhZGRlZCB0byB0aGUgLnN2Z0dyb3VwOlxuICAgICAgICA8ZyBjbGFzcz1cImJsb2NrbHlab29tXCI+XG4gICAgICAgICAgPGNsaXBQYXRoIGlkPVwiYmxvY2tseVpvb21pbkNsaXBQYXRoODM3NDkzXCI+XG4gICAgICAgICAgICA8cmVjdCB3aWR0aD1cIjMyXCIgaGVpZ2h0PVwiMzJcIj48L3JlY3Q+XG4gICAgICAgICAgPC9jbGlwUGF0aD5cbiAgICAgICAgICA8aW1hZ2Ugd2lkdGg9XCI5NlwiIGhlaWdodD1cIjEyNFwiIHg9XCItMzJcIiB5PVwiLTkyXCJcbiAgICAgICAgeGxpbms6aHJlZj1cIm1lZGlhL3Nwcml0ZXMucG5nXCJcbiAgICAgICAgICAgICAgY2xpcC1wYXRoPVwidXJsKCNibG9ja2x5Wm9vbWluQ2xpcFBhdGg4Mzc0OTMpXCI+PC9pbWFnZT5cbiAgICAgICAgPC9nPlxuICAgICAgICAqL1xuICAgIHRoaXMuem9vbUluR3JvdXAgPVxuICAgICAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuRywgeydjbGFzcyc6ICdibG9ja2x5Wm9vbSd9LCB0aGlzLnN2Z0dyb3VwKTtcbiAgICBjb25zdCBjbGlwID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5DTElQUEFUSCwgeydpZCc6ICdibG9ja2x5Wm9vbWluQ2xpcFBhdGgnICsgcm5kfSwgdGhpcy56b29tSW5Hcm91cCk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgJ3dpZHRoJzogMzIsXG4gICAgICAgICAgJ2hlaWdodCc6IDMyLFxuICAgICAgICB9LFxuICAgICAgICBjbGlwKTtcbiAgICBjb25zdCB6b29taW5TdmcgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLklNQUdFLCB7XG4gICAgICAgICAgJ3dpZHRoJzogU1BSSVRFLndpZHRoLFxuICAgICAgICAgICdoZWlnaHQnOiBTUFJJVEUuaGVpZ2h0LFxuICAgICAgICAgICd4JzogLTMyLFxuICAgICAgICAgICd5JzogLTkyLFxuICAgICAgICAgICdjbGlwLXBhdGgnOiAndXJsKCNibG9ja2x5Wm9vbWluQ2xpcFBhdGgnICsgcm5kICsgJyknLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLnpvb21Jbkdyb3VwKTtcbiAgICB6b29taW5Tdmcuc2V0QXR0cmlidXRlTlMoXG4gICAgICAgIGRvbS5YTElOS19OUywgJ3hsaW5rOmhyZWYnLFxuICAgICAgICB0aGlzLndvcmtzcGFjZS5vcHRpb25zLnBhdGhUb01lZGlhICsgU1BSSVRFLnVybCk7XG5cbiAgICAvLyBBdHRhY2ggbGlzdGVuZXIuXG4gICAgdGhpcy5vblpvb21JbldyYXBwZXIgPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGhpcy56b29tSW5Hcm91cCwgJ3BvaW50ZXJkb3duJywgbnVsbCwgdGhpcy56b29tLmJpbmQodGhpcywgMSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgYSBtb3VzZSBkb3duIGV2ZW50IG9uIHRoZSB6b29tIGluIG9yIHpvb20gb3V0IGJ1dHRvbnMgb24gdGhlXG4gICAqICAgIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIGFtb3VudCBBbW91bnQgb2Ygem9vbWluZy4gTmVnYXRpdmUgYW1vdW50IHZhbHVlcyB6b29tIG91dCwgYW5kXG4gICAqICAgICBwb3NpdGl2ZSBhbW91bnQgdmFsdWVzIHpvb20gaW4uXG4gICAqIEBwYXJhbSBlIEEgbW91c2UgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgem9vbShhbW91bnQ6IG51bWJlciwgZTogUG9pbnRlckV2ZW50KSB7XG4gICAgdGhpcy53b3Jrc3BhY2UubWFya0ZvY3VzZWQoKTtcbiAgICB0aGlzLndvcmtzcGFjZS56b29tQ2VudGVyKGFtb3VudCk7XG4gICAgdGhpcy5maXJlWm9vbUV2ZW50KCk7XG4gICAgVG91Y2guY2xlYXJUb3VjaElkZW50aWZpZXIoKTsgIC8vIERvbid0IGJsb2NrIGZ1dHVyZSBkcmFncy5cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpOyAgICAgICAgICAgLy8gRG9uJ3Qgc3RhcnQgYSB3b3Jrc3BhY2Ugc2Nyb2xsLlxuICAgIGUucHJldmVudERlZmF1bHQoKTsgICAgICAgICAgICAvLyBTdG9wIGRvdWJsZS1jbGlja2luZyBmcm9tIHNlbGVjdGluZyB0ZXh0LlxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgem9vbSByZXNldCBpY29uIGFuZCBpdHMgZXZlbnQgaGFuZGxlci5cbiAgICpcbiAgICogQHBhcmFtIHJuZCBUaGUgcmFuZG9tIHN0cmluZyB0byB1c2UgYXMgYSBzdWZmaXggaW4gdGhlIGNsaXAgcGF0aCdzIElELlxuICAgKiAgICAgVGhlc2UgSURzIG11c3QgYmUgdW5pcXVlIGluIGNhc2UgdGhlcmUgYXJlIG11bHRpcGxlIEJsb2NrbHkgaW5zdGFuY2VzXG4gICAqICAgICBvbiB0aGUgc2FtZSBwYWdlLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVab29tUmVzZXRTdmcocm5kOiBzdHJpbmcpIHtcbiAgICAvKiBUaGlzIG1hcmt1cCB3aWxsIGJlIGdlbmVyYXRlZCBhbmQgYWRkZWQgdG8gdGhlIC5zdmdHcm91cDpcbiAgICAgICAgPGcgY2xhc3M9XCJibG9ja2x5Wm9vbVwiPlxuICAgICAgICAgIDxjbGlwUGF0aCBpZD1cImJsb2NrbHlab29tcmVzZXRDbGlwUGF0aDgzNzQ5M1wiPlxuICAgICAgICAgICAgPHJlY3Qgd2lkdGg9XCIzMlwiIGhlaWdodD1cIjMyXCI+PC9yZWN0PlxuICAgICAgICAgIDwvY2xpcFBhdGg+XG4gICAgICAgICAgPGltYWdlIHdpZHRoPVwiOTZcIiBoZWlnaHQ9XCIxMjRcIiB4PVwiLTMyXCIgeT1cIi05MlwiXG4gICAgICAgIHhsaW5rOmhyZWY9XCJtZWRpYS9zcHJpdGVzLnBuZ1wiXG4gICAgICAgICAgICAgIGNsaXAtcGF0aD1cInVybCgjYmxvY2tseVpvb21yZXNldENsaXBQYXRoODM3NDkzKVwiPjwvaW1hZ2U+XG4gICAgICAgIDwvZz5cbiAgICAgICAgKi9cbiAgICB0aGlzLnpvb21SZXNldEdyb3VwID1cbiAgICAgICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkcsIHsnY2xhc3MnOiAnYmxvY2tseVpvb20nfSwgdGhpcy5zdmdHcm91cCk7XG4gICAgY29uc3QgY2xpcCA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuQ0xJUFBBVEgsIHsnaWQnOiAnYmxvY2tseVpvb21yZXNldENsaXBQYXRoJyArIHJuZH0sXG4gICAgICAgIHRoaXMuem9vbVJlc2V0R3JvdXApO1xuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5SRUNULCB7J3dpZHRoJzogMzIsICdoZWlnaHQnOiAzMn0sIGNsaXApO1xuICAgIGNvbnN0IHpvb21yZXNldFN2ZyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuSU1BR0UsIHtcbiAgICAgICAgICAnd2lkdGgnOiBTUFJJVEUud2lkdGgsXG4gICAgICAgICAgJ2hlaWdodCc6IFNQUklURS5oZWlnaHQsXG4gICAgICAgICAgJ3knOiAtOTIsXG4gICAgICAgICAgJ2NsaXAtcGF0aCc6ICd1cmwoI2Jsb2NrbHlab29tcmVzZXRDbGlwUGF0aCcgKyBybmQgKyAnKScsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuem9vbVJlc2V0R3JvdXApO1xuICAgIHpvb21yZXNldFN2Zy5zZXRBdHRyaWJ1dGVOUyhcbiAgICAgICAgZG9tLlhMSU5LX05TLCAneGxpbms6aHJlZicsXG4gICAgICAgIHRoaXMud29ya3NwYWNlLm9wdGlvbnMucGF0aFRvTWVkaWEgKyBTUFJJVEUudXJsKTtcblxuICAgIC8vIEF0dGFjaCBldmVudCBsaXN0ZW5lcnMuXG4gICAgdGhpcy5vblpvb21SZXNldFdyYXBwZXIgPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGhpcy56b29tUmVzZXRHcm91cCwgJ3BvaW50ZXJkb3duJywgbnVsbCwgdGhpcy5yZXNldFpvb20uYmluZCh0aGlzKSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyBhIG1vdXNlIGRvd24gZXZlbnQgb24gdGhlIHJlc2V0IHpvb20gYnV0dG9uIG9uIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBlIEEgbW91c2UgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgcmVzZXRab29tKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIHRoaXMud29ya3NwYWNlLm1hcmtGb2N1c2VkKCk7XG5cbiAgICAvLyB6b29tIGlzIHBhc3NlZCBhbW91bnQgYW5kIGNvbXB1dGVzIHRoZSBuZXcgc2NhbGUgdXNpbmcgdGhlIGZvcm11bGE6XG4gICAgLy8gdGFyZ2V0U2NhbGUgPSBjdXJyZW50U2NhbGUgKiBNYXRoLnBvdyhzcGVlZCwgYW1vdW50KVxuICAgIGNvbnN0IHRhcmdldFNjYWxlID0gdGhpcy53b3Jrc3BhY2Uub3B0aW9ucy56b29tT3B0aW9ucy5zdGFydFNjYWxlO1xuICAgIGNvbnN0IGN1cnJlbnRTY2FsZSA9IHRoaXMud29ya3NwYWNlLnNjYWxlO1xuICAgIGNvbnN0IHNwZWVkID0gdGhpcy53b3Jrc3BhY2Uub3B0aW9ucy56b29tT3B0aW9ucy5zY2FsZVNwZWVkO1xuICAgIC8vIFRvIGNvbXB1dGUgYW1vdW50OlxuICAgIC8vIGFtb3VudCA9IGxvZyhzcGVlZCwgKHRhcmdldFNjYWxlIC8gY3VycmVudFNjYWxlKSlcbiAgICAvLyBNYXRoLmxvZyBjb21wdXRlcyBuYXR1cmFsIGxvZ2FyaXRobSAobG4pLCB0byBjaGFuZ2UgdGhlIGJhc2UsIHVzZVxuICAgIC8vIGZvcm11bGE6IGxvZyhiYXNlLCB2YWx1ZSkgPSBsbih2YWx1ZSkgLyBsbihiYXNlKVxuICAgIGNvbnN0IGFtb3VudCA9IE1hdGgubG9nKHRhcmdldFNjYWxlIC8gY3VycmVudFNjYWxlKSAvIE1hdGgubG9nKHNwZWVkKTtcbiAgICB0aGlzLndvcmtzcGFjZS5iZWdpbkNhbnZhc1RyYW5zaXRpb24oKTtcbiAgICB0aGlzLndvcmtzcGFjZS56b29tQ2VudGVyKGFtb3VudCk7XG4gICAgdGhpcy53b3Jrc3BhY2Uuc2Nyb2xsQ2VudGVyKCk7XG5cbiAgICBzZXRUaW1lb3V0KHRoaXMud29ya3NwYWNlLmVuZENhbnZhc1RyYW5zaXRpb24uYmluZCh0aGlzLndvcmtzcGFjZSksIDUwMCk7XG4gICAgdGhpcy5maXJlWm9vbUV2ZW50KCk7XG4gICAgVG91Y2guY2xlYXJUb3VjaElkZW50aWZpZXIoKTsgIC8vIERvbid0IGJsb2NrIGZ1dHVyZSBkcmFncy5cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpOyAgICAgICAgICAgLy8gRG9uJ3Qgc3RhcnQgYSB3b3Jrc3BhY2Ugc2Nyb2xsLlxuICAgIGUucHJldmVudERlZmF1bHQoKTsgICAgICAgICAgICAvLyBTdG9wIGRvdWJsZS1jbGlja2luZyBmcm9tIHNlbGVjdGluZyB0ZXh0LlxuICB9XG5cbiAgLyoqIEZpcmVzIGEgem9vbSBjb250cm9sIFVJIGV2ZW50LiAqL1xuICBwcml2YXRlIGZpcmVab29tRXZlbnQoKSB7XG4gICAgY29uc3QgdWlFdmVudCA9IG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5DTElDSykpKFxuICAgICAgICBudWxsLCB0aGlzLndvcmtzcGFjZS5pZCwgJ3pvb21fY29udHJvbHMnKTtcbiAgICBldmVudFV0aWxzLmZpcmUodWlFdmVudCk7XG4gIH1cbn1cblxuLyoqIENTUyBmb3Igem9vbSBjb250cm9scy4gIFNlZSBjc3MuanMgZm9yIHVzZS4gKi9cbkNzcy5yZWdpc3RlcihgXG4uYmxvY2tseVpvb20+aW1hZ2UsIC5ibG9ja2x5Wm9vbT5zdmc+aW1hZ2Uge1xuICBvcGFjaXR5OiAuNDtcbn1cblxuLmJsb2NrbHlab29tPmltYWdlOmhvdmVyLCAuYmxvY2tseVpvb20+c3ZnPmltYWdlOmhvdmVyIHtcbiAgb3BhY2l0eTogLjY7XG59XG5cbi5ibG9ja2x5Wm9vbT5pbWFnZTphY3RpdmUsIC5ibG9ja2x5Wm9vbT5zdmc+aW1hZ2U6YWN0aXZlIHtcbiAgb3BhY2l0eTogLjg7XG59XG5gKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBIYW5kbGVzIHNlcmlhbGl6aW5nIHZhcmlhYmxlcyB0byBwbGFpbiBKYXZhU2NyaXB0IG9iamVjdHMsIG9ubHkgY29udGFpbmluZ1xuICogc3RhdGUuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LnNlcmlhbGl6YXRpb24udmFyaWFibGVzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuc2VyaWFsaXphdGlvbi52YXJpYWJsZXMnKTtcblxuaW1wb3J0IHR5cGUge0lTZXJpYWxpemVyfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfc2VyaWFsaXplci5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5pbXBvcnQgKiBhcyBwcmlvcml0aWVzIGZyb20gJy4vcHJpb3JpdGllcy5qcyc7XG5pbXBvcnQgKiBhcyBzZXJpYWxpemF0aW9uUmVnaXN0cnkgZnJvbSAnLi9yZWdpc3RyeS5qcyc7XG5cblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBzdGF0ZSBvZiBhIGdpdmVuIHZhcmlhYmxlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24udmFyaWFibGVzLlN0YXRlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGUge1xuICBuYW1lOiBzdHJpbmc7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZ3x1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogU2VyaWFsaXplciBmb3Igc2F2aW5nIGFuZCBsb2FkaW5nIHZhcmlhYmxlIHN0YXRlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnNlcmlhbGl6YXRpb24udmFyaWFibGVzLlZhcmlhYmxlU2VyaWFsaXplclxuICovXG5leHBvcnQgY2xhc3MgVmFyaWFibGVTZXJpYWxpemVyIGltcGxlbWVudHMgSVNlcmlhbGl6ZXIge1xuICBwcmlvcml0eTogbnVtYmVyO1xuXG4gIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZXF1aXJlLWpzZG9jICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8qKiBUaGUgcHJpb3JpdHkgZm9yIGRlc2VyaWFsaXppbmcgdmFyaWFibGVzLiAqL1xuICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0aWVzLlZBUklBQkxFUztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXJpYWxpemVzIHRoZSB2YXJpYWJsZXMgb2YgdGhlIGdpdmVuIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIHNhdmUgdGhlIHZhcmlhYmxlcyBvZi5cbiAgICogQHJldHVybnMgVGhlIHN0YXRlIG9mIHRoZSB3b3Jrc3BhY2UncyB2YXJpYWJsZXMsIG9yIG51bGwgaWYgdGhlcmUgYXJlIG5vXG4gICAqICAgICB2YXJpYWJsZXMuXG4gICAqL1xuICBzYXZlKHdvcmtzcGFjZTogV29ya3NwYWNlKTogU3RhdGVbXXxudWxsIHtcbiAgICBjb25zdCB2YXJpYWJsZVN0YXRlcyA9IFtdO1xuICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2Ygd29ya3NwYWNlLmdldEFsbFZhcmlhYmxlcygpKSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgICAgJ25hbWUnOiB2YXJpYWJsZS5uYW1lLFxuICAgICAgICAnaWQnOiB2YXJpYWJsZS5nZXRJZCgpLFxuICAgICAgfTtcbiAgICAgIGlmICh2YXJpYWJsZS50eXBlKSB7XG4gICAgICAgIChzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWyd0eXBlJ10gPSB2YXJpYWJsZS50eXBlO1xuICAgICAgfVxuICAgICAgdmFyaWFibGVTdGF0ZXMucHVzaChzdGF0ZSk7XG4gICAgfVxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAneyBuYW1lOiBzdHJpbmc7IGlkOiBzdHJpbmc7IH1bXSB8XG4gICAgLy8gbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZSAnU3RhdGVbXSB8IG51bGwnLlxuICAgIHJldHVybiAodmFyaWFibGVTdGF0ZXMubGVuZ3RoID8gdmFyaWFibGVTdGF0ZXMgOiBudWxsKSBhc1xuICAgICAgICBBbnlEdXJpbmdNaWdyYXRpb247XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSB2YXJpYWJsZSBkZWZpbmVkIGJ5IHRoZSBnaXZlbiBzdGF0ZSBpbnRvIHRoZSBnaXZlblxuICAgKiB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBzdGF0ZSBUaGUgc3RhdGUgb2YgdGhlIHZhcmlhYmxlcyB0byBkZXNlcmlhbGl6ZS5cbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRvIGRlc2VyaWFsaXplIGludG8uXG4gICAqL1xuICBsb2FkKHN0YXRlOiBTdGF0ZVtdLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgIGZvciAoY29uc3QgdmFyU3RhdGUgb2Ygc3RhdGUpIHtcbiAgICAgIHdvcmtzcGFjZS5jcmVhdGVWYXJpYWJsZShcbiAgICAgICAgICB2YXJTdGF0ZVsnbmFtZSddLCB2YXJTdGF0ZVsndHlwZSddLCB2YXJTdGF0ZVsnaWQnXSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2VzIG9mIGFueSB2YXJpYWJsZXMgdGhhdCBleGlzdCBvbiB0aGUgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdG8gY2xlYXIgdGhlIHZhcmlhYmxlcyBvZi5cbiAgICovXG4gIGNsZWFyKHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XG4gICAgd29ya3NwYWNlLmdldFZhcmlhYmxlTWFwKCkuY2xlYXIoKTtcbiAgfVxufVxuXG5zZXJpYWxpemF0aW9uUmVnaXN0cnkucmVnaXN0ZXIoJ3ZhcmlhYmxlcycsIG5ldyBWYXJpYWJsZVNlcmlhbGl6ZXIoKSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogU2VyaWFsaXphdGlvbiBtZXRob2RzLlxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnNlcmlhbGl6YXRpb24nKTtcblxuaW1wb3J0ICogYXMgYmxvY2tzIGZyb20gJy4vc2VyaWFsaXphdGlvbi9ibG9ja3MuanMnO1xuaW1wb3J0ICogYXMgZXhjZXB0aW9ucyBmcm9tICcuL3NlcmlhbGl6YXRpb24vZXhjZXB0aW9ucy5qcyc7XG5pbXBvcnQgKiBhcyBwcmlvcml0aWVzIGZyb20gJy4vc2VyaWFsaXphdGlvbi9wcmlvcml0aWVzLmpzJztcbmltcG9ydCAqIGFzIHByb2NlZHVyZXMgZnJvbSAnLi9zZXJpYWxpemF0aW9uL3Byb2NlZHVyZXMuanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi9zZXJpYWxpemF0aW9uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCAqIGFzIHZhcmlhYmxlcyBmcm9tICcuL3NlcmlhbGl6YXRpb24vdmFyaWFibGVzLmpzJztcbmltcG9ydCAqIGFzIHdvcmtzcGFjZXMgZnJvbSAnLi9zZXJpYWxpemF0aW9uL3dvcmtzcGFjZXMuanMnO1xuaW1wb3J0IHtJU2VyaWFsaXplcn0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfc2VyaWFsaXplci5qcyc7XG5cbmV4cG9ydCB7XG4gIGJsb2NrcyxcbiAgZXhjZXB0aW9ucyxcbiAgcHJpb3JpdGllcyxcbiAgcHJvY2VkdXJlcyxcbiAgcmVnaXN0cnksXG4gIHZhcmlhYmxlcyxcbiAgd29ya3NwYWNlcyxcbiAgSVNlcmlhbGl6ZXIsXG59O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IHByb3ZpZGVzIGNvbnN0YW50cyBmb3IgcmVuZGVyaW5nIGJsb2NrcyBpbiBaZWxvc1xuICogbW9kZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS56ZWxvcy5Db25zdGFudFByb3ZpZGVyJyk7XG5cbmltcG9ydCB7Q29ubmVjdGlvblR5cGV9IGZyb20gJy4uLy4uL2Nvbm5lY3Rpb25fdHlwZS5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtUaGVtZX0gZnJvbSAnLi4vLi4vdGhlbWUuanMnO1xuaW1wb3J0ICogYXMgdXRpbHNDb2xvdXIgZnJvbSAnLi4vLi4vdXRpbHMvY29sb3VyLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi8uLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4uLy4uL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdQYXRocyBmcm9tICcuLi8uLi91dGlscy9zdmdfcGF0aHMuanMnO1xuaW1wb3J0IHtDb25zdGFudFByb3ZpZGVyIGFzIEJhc2VDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcbmltcG9ydCB0eXBlIHtTaGFwZX0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBpbnNpZGUgY29ybmVycy4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSW5zaWRlQ29ybmVycyB7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBwYXRoVG9wOiBzdHJpbmc7XG4gIHBhdGhCb3R0b206IHN0cmluZztcbiAgcmlnaHRXaWR0aDogbnVtYmVyO1xuICByaWdodEhlaWdodDogbnVtYmVyO1xuICBwYXRoVG9wUmlnaHQ6IHN0cmluZztcbiAgcGF0aEJvdHRvbVJpZ2h0OiBzdHJpbmc7XG59XG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgcHJvdmlkZXMgY29uc3RhbnRzIGZvciByZW5kZXJpbmcgYmxvY2tzIGluIFplbG9zIG1vZGUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuemVsb3MuQ29uc3RhbnRQcm92aWRlclxuICovXG5leHBvcnQgY2xhc3MgQ29uc3RhbnRQcm92aWRlciBleHRlbmRzIEJhc2VDb25zdGFudFByb3ZpZGVyIHtcbiAgR1JJRF9VTklUID0gNDtcbiAgU1RBVEVNRU5UX0lOUFVUX1NQQUNFUl9NSU5fV0lEVEg6IG51bWJlcjtcblxuICBvdmVycmlkZSBDVVJTT1JfQ09MT1VSID0gJyNmZmEyMDAnO1xuXG4gIC8qKlxuICAgKiBSYWRpdXMgb2YgdGhlIGN1cnNvciBmb3IgaW5wdXQgYW5kIG91dHB1dCBjb25uZWN0aW9ucy5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBDVVJTT1JfUkFESVVTID0gNTtcblxuICBvdmVycmlkZSBKQUdHRURfVEVFVEhfSEVJR0hUID0gMDtcblxuICBvdmVycmlkZSBKQUdHRURfVEVFVEhfV0lEVEggPSAwO1xuICBvdmVycmlkZSBTVEFSVF9IQVRfSEVJR0hUID0gMjI7XG5cbiAgb3ZlcnJpZGUgU1RBUlRfSEFUX1dJRFRIID0gOTY7XG5cbiAgb3ZlcnJpZGUgU0hBUEVTID0ge0hFWEFHT05BTDogMSwgUk9VTkQ6IDIsIFNRVUFSRTogMywgUFVaWkxFOiA0LCBOT1RDSDogNX07XG5cbiAgLyoqXG4gICAqIE1hcCBvZiBvdXRwdXQvaW5wdXQgc2hhcGVzIGFuZCB0aGUgYW1vdW50IHRoZXkgc2hvdWxkIGNhdXNlIGEgYmxvY2sgdG8gYmVcbiAgICogcGFkZGVkLiBPdXRlciBrZXkgaXMgdGhlIG91dGVyIHNoYXBlLCBpbm5lciBrZXkgaXMgdGhlIGlubmVyIHNoYXBlLlxuICAgKiBXaGVuIGEgYmxvY2sgd2l0aCB0aGUgb3V0ZXIgc2hhcGUgY29udGFpbnMgYW4gaW5wdXQgYmxvY2sgd2l0aCB0aGUgaW5uZXJcbiAgICogc2hhcGUgb24gaXRzIGxlZnQgb3IgcmlnaHQgZWRnZSwgdGhlIGJsb2NrIGVsZW1lbnRzIGFyZSBhbGlnbmVkIHN1Y2ggdGhhdFxuICAgKiB0aGUgcGFkZGluZyBzcGVjaWZpZWQgaXMgcmVhY2hlZC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBTSEFQRV9JTl9TSEFQRV9QQURESU5HOiB7W2tleTogbnVtYmVyXToge1trZXk6IG51bWJlcl06IG51bWJlcn19ID0ge1xuICAgIDE6IHtcbiAgICAgIC8vIE91dGVyIHNoYXBlOiBoZXhhZ29uLlxuICAgICAgMDogNSAqIHRoaXMuR1JJRF9VTklULCAgLy8gRmllbGQgaW4gaGV4YWdvbi5cbiAgICAgIDE6IDIgKiB0aGlzLkdSSURfVU5JVCwgIC8vIEhleGFnb24gaW4gaGV4YWdvbi5cbiAgICAgIDI6IDUgKiB0aGlzLkdSSURfVU5JVCwgIC8vIFJvdW5kIGluIGhleGFnb24uXG4gICAgICAzOiA1ICogdGhpcy5HUklEX1VOSVQsICAvLyBTcXVhcmUgaW4gaGV4YWdvbi5cbiAgICB9LFxuICAgIDI6IHtcbiAgICAgIC8vIE91dGVyIHNoYXBlOiByb3VuZC5cbiAgICAgIDA6IDMgKiB0aGlzLkdSSURfVU5JVCwgIC8vIEZpZWxkIGluIHJvdW5kLlxuICAgICAgMTogMyAqIHRoaXMuR1JJRF9VTklULCAgLy8gSGV4YWdvbiBpbiByb3VuZC5cbiAgICAgIDI6IDEgKiB0aGlzLkdSSURfVU5JVCwgIC8vIFJvdW5kIGluIHJvdW5kLlxuICAgICAgMzogMiAqIHRoaXMuR1JJRF9VTklULCAgLy8gU3F1YXJlIGluIHJvdW5kLlxuICAgIH0sXG4gICAgMzoge1xuICAgICAgLy8gT3V0ZXIgc2hhcGU6IHNxdWFyZS5cbiAgICAgIDA6IDIgKiB0aGlzLkdSSURfVU5JVCwgIC8vIEZpZWxkIGluIHNxdWFyZS5cbiAgICAgIDE6IDIgKiB0aGlzLkdSSURfVU5JVCwgIC8vIEhleGFnb24gaW4gc3F1YXJlLlxuICAgICAgMjogMiAqIHRoaXMuR1JJRF9VTklULCAgLy8gUm91bmQgaW4gc3F1YXJlLlxuICAgICAgMzogMiAqIHRoaXMuR1JJRF9VTklULCAgLy8gU3F1YXJlIGluIHNxdWFyZS5cbiAgICB9LFxuICB9O1xuXG4gIG92ZXJyaWRlIEZVTExfQkxPQ0tfRklFTERTID0gdHJ1ZTtcblxuICBvdmVycmlkZSBGSUVMRF9URVhUX0ZPTlRXRUlHSFQgPSAnYm9sZCc7XG5cbiAgb3ZlcnJpZGUgRklFTERfVEVYVF9GT05URkFNSUxZID1cbiAgICAgICdcIkhlbHZldGljYSBOZXVlXCIsIFwiU2Vnb2UgVUlcIiwgSGVsdmV0aWNhLCBzYW5zLXNlcmlmJztcblxuICBvdmVycmlkZSBGSUVMRF9EUk9QRE9XTl9OT19CT1JERVJfUkVDVF9TSEFET1cgPSB0cnVlO1xuXG4gIG92ZXJyaWRlIEZJRUxEX0RST1BET1dOX0NPTE9VUkVEX0RJViA9IHRydWU7XG5cbiAgb3ZlcnJpZGUgRklFTERfRFJPUERPV05fU1ZHX0FSUk9XID0gdHJ1ZTtcbiAgb3ZlcnJpZGUgRklFTERfVEVYVElOUFVUX0JPWF9TSEFET1cgPSB0cnVlO1xuXG4gIG92ZXJyaWRlIEZJRUxEX0NPTE9VUl9GVUxMX0JMT0NLID0gdHJ1ZTtcbiAgTUFYX0RZTkFNSUNfQ09OTkVDVElPTl9TSEFQRV9XSURUSDogbnVtYmVyO1xuXG4gIC8qKiBUaGUgc2VsZWN0ZWQgZ2xvdyBjb2xvdXIuICovXG4gIFNFTEVDVEVEX0dMT1dfQ09MT1VSID0gJyNmZmYyMDAnO1xuXG4gIC8qKiBUaGUgc2l6ZSBvZiB0aGUgc2VsZWN0ZWQgZ2xvdy4gKi9cbiAgU0VMRUNURURfR0xPV19TSVpFID0gMC41O1xuXG4gIC8qKiBUaGUgcmVwbGFjZW1lbnQgZ2xvdyBjb2xvdXIuICovXG4gIFJFUExBQ0VNRU5UX0dMT1dfQ09MT1VSID0gJyNmZmYyMDAnO1xuXG4gIC8qKiBUaGUgc2l6ZSBvZiB0aGUgc2VsZWN0ZWQgZ2xvdy4gKi9cbiAgUkVQTEFDRU1FTlRfR0xPV19TSVpFID0gMjtcblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBzZWxlY3RlZCBnbG93IGZpbHRlciwgb3IgdGhlIGVtcHR5IHN0cmluZyBpZiBubyBmaWx0ZXIgaXNcbiAgICogc2V0LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNlbGVjdGVkR2xvd0ZpbHRlcklkID0gJyc7XG5cbiAgLyoqXG4gICAqIFRoZSA8ZmlsdGVyPiBlbGVtZW50IHRvIHVzZSBmb3IgYSBzZWxlY3RlZCBnbG93LCBvciBudWxsIGlmIG5vdCBzZXQuXG4gICAqL1xuICBwcml2YXRlIHNlbGVjdGVkR2xvd0ZpbHRlcl86IFNWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgcmVwbGFjZW1lbnQgZ2xvdyBmaWx0ZXIsIG9yIHRoZSBlbXB0eSBzdHJpbmcgaWYgbm8gZmlsdGVyXG4gICAqIGlzIHNldC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICByZXBsYWNlbWVudEdsb3dGaWx0ZXJJZCA9ICcnO1xuXG4gIC8qKlxuICAgKiBUaGUgPGZpbHRlcj4gZWxlbWVudCB0byB1c2UgZm9yIGEgcmVwbGFjZW1lbnQgZ2xvdywgb3IgbnVsbCBpZiBub3Qgc2V0LlxuICAgKi9cbiAgcHJpdmF0ZSByZXBsYWNlbWVudEdsb3dGaWx0ZXJfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhleGFnb24gdXNlZCBmb3IgYSBib29sZWFuXG4gICAqIHJlcG9ydGVyIGJsb2NrLiBOdWxsIGJlZm9yZSBpbml0IGlzIGNhbGxlZC5cbiAgICovXG4gIEhFWEFHT05BTDogU2hhcGV8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGV4YWdvbiB1c2VkIGZvciBhIG51bWJlciBvclxuICAgKiBzdHJpbmcgcmVwb3J0ZXIgYmxvY2suIE51bGwgYmVmb3JlIGluaXQgaXMgY2FsbGVkLlxuICAgKi9cbiAgUk9VTkRFRDogU2hhcGV8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGV4YWdvbiB1c2VkIGZvciBhXG4gICAqIHJlY3Rhbmd1bGFyIHJlcG9ydGVyIGJsb2NrLiBOdWxsIGJlZm9yZSBpbml0IGlzIGNhbGxlZC5cbiAgICovXG4gIFNRVUFSRUQ6IFNoYXBlfG51bGwgPSBudWxsO1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuU01BTExfUEFERElORyA9IHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5NRURJVU1fUEFERElORyA9IDIgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuTUVESVVNX0xBUkdFX1BBRERJTkcgPSAzICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkxBUkdFX1BBRERJTkcgPSA0ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkNPUk5FUl9SQURJVVMgPSAxICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLk5PVENIX1dJRFRIID0gOSAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5OT1RDSF9IRUlHSFQgPSAyICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLk5PVENIX09GRlNFVF9MRUZUID0gMyAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5TVEFURU1FTlRfSU5QVVRfTk9UQ0hfT0ZGU0VUID0gdGhpcy5OT1RDSF9PRkZTRVRfTEVGVDtcblxuICAgIHRoaXMuTUlOX0JMT0NLX1dJRFRIID0gMiAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5NSU5fQkxPQ0tfSEVJR0hUID0gMTIgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuRU1QVFlfU1RBVEVNRU5UX0lOUFVUX0hFSUdIVCA9IDYgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuVE9QX1JPV19NSU5fSEVJR0hUID0gdGhpcy5DT1JORVJfUkFESVVTO1xuXG4gICAgdGhpcy5UT1BfUk9XX1BSRUNFREVTX1NUQVRFTUVOVF9NSU5fSEVJR0hUID0gdGhpcy5MQVJHRV9QQURESU5HO1xuXG4gICAgdGhpcy5CT1RUT01fUk9XX01JTl9IRUlHSFQgPSB0aGlzLkNPUk5FUl9SQURJVVM7XG5cbiAgICB0aGlzLkJPVFRPTV9ST1dfQUZURVJfU1RBVEVNRU5UX01JTl9IRUlHSFQgPSA2ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLlNUQVRFTUVOVF9CT1RUT01fU1BBQ0VSID0gLXRoaXMuTk9UQ0hfSEVJR0hUO1xuXG4gICAgLyoqIE1pbmltdW0gc3RhdGVtZW50IGlucHV0IHNwYWNlciB3aWR0aC4gKi9cbiAgICB0aGlzLlNUQVRFTUVOVF9JTlBVVF9TUEFDRVJfTUlOX1dJRFRIID0gNDAgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuU1RBVEVNRU5UX0lOUFVUX1BBRERJTkdfTEVGVCA9IDQgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuRU1QVFlfSU5MSU5FX0lOUFVUX1BBRERJTkcgPSA0ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkVNUFRZX0lOTElORV9JTlBVVF9IRUlHSFQgPSA4ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkRVTU1ZX0lOUFVUX01JTl9IRUlHSFQgPSA4ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkRVTU1ZX0lOUFVUX1NIQURPV19NSU5fSEVJR0hUID0gNiAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5DVVJTT1JfV1NfV0lEVEggPSAyMCAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5GSUVMRF9URVhUX0ZPTlRTSVpFID0gMyAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5GSUVMRF9CT1JERVJfUkVDVF9SQURJVVMgPSB0aGlzLkNPUk5FUl9SQURJVVM7XG5cbiAgICB0aGlzLkZJRUxEX0JPUkRFUl9SRUNUX1hfUEFERElORyA9IDIgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuRklFTERfQk9SREVSX1JFQ1RfWV9QQURESU5HID0gMS42MjUgKiB0aGlzLkdSSURfVU5JVDtcblxuICAgIHRoaXMuRklFTERfQk9SREVSX1JFQ1RfSEVJR0hUID0gOCAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5GSUVMRF9EUk9QRE9XTl9CT1JERVJfUkVDVF9IRUlHSFQgPSA4ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkZJRUxEX0RST1BET1dOX1NWR19BUlJPV19QQURESU5HID0gdGhpcy5GSUVMRF9CT1JERVJfUkVDVF9YX1BBRERJTkc7XG5cbiAgICB0aGlzLkZJRUxEX0NPTE9VUl9ERUZBVUxUX1dJRFRIID0gMiAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgdGhpcy5GSUVMRF9DT0xPVVJfREVGQVVMVF9IRUlHSFQgPSA0ICogdGhpcy5HUklEX1VOSVQ7XG5cbiAgICB0aGlzLkZJRUxEX0NIRUNLQk9YX1hfT0ZGU0VUID0gMSAqIHRoaXMuR1JJRF9VTklUO1xuXG4gICAgLyoqIFRoZSBtYXhpbXVtIHdpZHRoIG9mIGEgZHluYW1pYyBjb25uZWN0aW9uIHNoYXBlLiAqL1xuICAgIHRoaXMuTUFYX0RZTkFNSUNfQ09OTkVDVElPTl9TSEFQRV9XSURUSCA9IDEyICogdGhpcy5HUklEX1VOSVQ7XG4gIH1cblxuICBvdmVycmlkZSBzZXRGb250Q29uc3RhbnRzXyh0aGVtZTogVGhlbWUpIHtcbiAgICBzdXBlci5zZXRGb250Q29uc3RhbnRzXyh0aGVtZSk7XG5cbiAgICB0aGlzLkZJRUxEX0JPUkRFUl9SRUNUX0hFSUdIVCA9XG4gICAgICAgIHRoaXMuRklFTERfVEVYVF9IRUlHSFQgKyB0aGlzLkZJRUxEX0JPUkRFUl9SRUNUX1lfUEFERElORyAqIDI7XG4gICAgdGhpcy5GSUVMRF9EUk9QRE9XTl9CT1JERVJfUkVDVF9IRUlHSFQgPSB0aGlzLkZJRUxEX0JPUkRFUl9SRUNUX0hFSUdIVDtcbiAgfVxuXG4gIG92ZXJyaWRlIGluaXQoKSB7XG4gICAgc3VwZXIuaW5pdCgpO1xuICAgIHRoaXMuSEVYQUdPTkFMID0gdGhpcy5tYWtlSGV4YWdvbmFsKCk7XG4gICAgdGhpcy5ST1VOREVEID0gdGhpcy5tYWtlUm91bmRlZCgpO1xuICAgIHRoaXMuU1FVQVJFRCA9IHRoaXMubWFrZVNxdWFyZWQoKTtcblxuICAgIHRoaXMuU1RBVEVNRU5UX0lOUFVUX05PVENIX09GRlNFVCA9IHRoaXMuTk9UQ0hfT0ZGU0VUX0xFRlQgK1xuICAgICAgICAodGhpcy5JTlNJREVfQ09STkVSUyBhcyBJbnNpZGVDb3JuZXJzKS5yaWdodFdpZHRoO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2V0RHluYW1pY1Byb3BlcnRpZXNfKHRoZW1lOiBUaGVtZSkge1xuICAgIHN1cGVyLnNldER5bmFtaWNQcm9wZXJ0aWVzXyh0aGVtZSk7XG5cbiAgICB0aGlzLlNFTEVDVEVEX0dMT1dfQ09MT1VSID0gdGhlbWUuZ2V0Q29tcG9uZW50U3R5bGUoJ3NlbGVjdGVkR2xvd0NvbG91cicpIHx8XG4gICAgICAgIHRoaXMuU0VMRUNURURfR0xPV19DT0xPVVI7XG4gICAgY29uc3Qgc2VsZWN0ZWRHbG93U2l6ZSA9XG4gICAgICAgIE51bWJlcih0aGVtZS5nZXRDb21wb25lbnRTdHlsZSgnc2VsZWN0ZWRHbG93U2l6ZScpKTtcbiAgICB0aGlzLlNFTEVDVEVEX0dMT1dfU0laRSA9IHNlbGVjdGVkR2xvd1NpemUgJiYgIWlzTmFOKHNlbGVjdGVkR2xvd1NpemUpID9cbiAgICAgICAgc2VsZWN0ZWRHbG93U2l6ZSA6XG4gICAgICAgIHRoaXMuU0VMRUNURURfR0xPV19TSVpFO1xuICAgIHRoaXMuUkVQTEFDRU1FTlRfR0xPV19DT0xPVVIgPVxuICAgICAgICB0aGVtZS5nZXRDb21wb25lbnRTdHlsZSgncmVwbGFjZW1lbnRHbG93Q29sb3VyJykgfHxcbiAgICAgICAgdGhpcy5SRVBMQUNFTUVOVF9HTE9XX0NPTE9VUjtcbiAgICBjb25zdCByZXBsYWNlbWVudEdsb3dTaXplID1cbiAgICAgICAgTnVtYmVyKHRoZW1lLmdldENvbXBvbmVudFN0eWxlKCdyZXBsYWNlbWVudEdsb3dTaXplJykpO1xuICAgIHRoaXMuUkVQTEFDRU1FTlRfR0xPV19TSVpFID1cbiAgICAgICAgcmVwbGFjZW1lbnRHbG93U2l6ZSAmJiAhaXNOYU4ocmVwbGFjZW1lbnRHbG93U2l6ZSkgP1xuICAgICAgICByZXBsYWNlbWVudEdsb3dTaXplIDpcbiAgICAgICAgdGhpcy5SRVBMQUNFTUVOVF9HTE9XX1NJWkU7XG4gIH1cblxuICBvdmVycmlkZSBkaXNwb3NlKCkge1xuICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICBpZiAodGhpcy5zZWxlY3RlZEdsb3dGaWx0ZXJfKSB7XG4gICAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLnNlbGVjdGVkR2xvd0ZpbHRlcl8pO1xuICAgIH1cbiAgICBpZiAodGhpcy5yZXBsYWNlbWVudEdsb3dGaWx0ZXJfKSB7XG4gICAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLnJlcGxhY2VtZW50R2xvd0ZpbHRlcl8pO1xuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIG1ha2VTdGFydEhhdCgpIHtcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLlNUQVJUX0hBVF9IRUlHSFQ7XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLlNUQVJUX0hBVF9XSURUSDtcblxuICAgIGNvbnN0IG1haW5QYXRoID0gc3ZnUGF0aHMuY3VydmUoJ2MnLCBbXG4gICAgICBzdmdQYXRocy5wb2ludCgyNSwgLWhlaWdodCksXG4gICAgICBzdmdQYXRocy5wb2ludCg3MSwgLWhlaWdodCksXG4gICAgICBzdmdQYXRocy5wb2ludCh3aWR0aCwgMCksXG4gICAgXSk7XG4gICAgcmV0dXJuIHtoZWlnaHQsIHdpZHRoLCBwYXRoOiBtYWluUGF0aH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBhIGhleGFnb25hbCBzaGFwZS5cbiAgICpcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGEgaGV4YWdvbmFsXG4gICAqICAgICBzaGFwZSBmb3IgY29ubmVjdGlvbnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFrZUhleGFnb25hbCgpOiBTaGFwZSB7XG4gICAgY29uc3QgbWF4V2lkdGggPSB0aGlzLk1BWF9EWU5BTUlDX0NPTk5FQ1RJT05fU0hBUEVfV0lEVEg7XG5cbiAgICAvKipcbiAgICAgKiBNYWtlIHRoZSBtYWluIHBhdGggZm9yIHRoZSBoZXhhZ29uYWwgY29ubmVjdGlvbiBzaGFwZSBvdXQgb2YgdHdvIGxpbmVzLlxuICAgICAqIFRoZSBsaW5lcyBhcmUgZGVmaW5lZCB3aXRoIHJlbGF0aXZlIHBvc2l0aW9ucyBhbmQgcmVxdWlyZSB0aGUgYmxvY2tcbiAgICAgKiBoZWlnaHQuIFRoZSAndXAnIGFuZCAnZG93bicgdmVyc2lvbnMgb2YgdGhlIHBhdGhzIGFyZSB0aGUgc2FtZSwgYnV0IHRoZSBZXG4gICAgICogc2lnbiBmbGlwcy4gIFRoZSAnbGVmdCcgYW5kICdyaWdodCcgdmVyc2lvbnMgb2YgdGhlIHBhdGggYXJlIGFsc28gdGhlXG4gICAgICogc2FtZSwgYnV0IHRoZSBYIHNpZ24gZmxpcHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIGJsb2NrIHRoZSBjb25uZWN0aW9uIGlzIG9uLlxuICAgICAqIEBwYXJhbSB1cCBUcnVlIGlmIHRoZSBwYXRoIHNob3VsZCBiZSBkcmF3biBmcm9tIGJvdHRvbSB0byB0b3AsIGZhbHNlXG4gICAgICogICAgIG90aGVyd2lzZS5cbiAgICAgKiBAcGFyYW0gcmlnaHQgVHJ1ZSBpZiB0aGUgcGF0aCBpcyBmb3IgdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIGJsb2NrLlxuICAgICAqIEByZXR1cm5zIEEgcGF0aCBmcmFnbWVudCBkZXNjcmliaW5nIGEgcm91bmRlZCBjb25uZWN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1ha2VNYWluUGF0aChoZWlnaHQ6IG51bWJlciwgdXA6IGJvb2xlYW4sIHJpZ2h0OiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAgIGNvbnN0IGhhbGZIZWlnaHQgPSBoZWlnaHQgLyAyO1xuICAgICAgY29uc3Qgd2lkdGggPSBoYWxmSGVpZ2h0ID4gbWF4V2lkdGggPyBtYXhXaWR0aCA6IGhhbGZIZWlnaHQ7XG4gICAgICBjb25zdCBmb3J3YXJkID0gdXAgPyAtMSA6IDE7XG4gICAgICBjb25zdCBkaXJlY3Rpb24gPSByaWdodCA/IC0xIDogMTtcbiAgICAgIGNvbnN0IGR5ID0gZm9yd2FyZCAqIGhlaWdodCAvIDI7XG4gICAgICByZXR1cm4gc3ZnUGF0aHMubGluZVRvKC1kaXJlY3Rpb24gKiB3aWR0aCwgZHkpICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lVG8oZGlyZWN0aW9uICogd2lkdGgsIGR5KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogdGhpcy5TSEFQRVMuSEVYQUdPTkFMLFxuICAgICAgaXNEeW5hbWljOiB0cnVlLFxuICAgICAgd2lkdGgoaGVpZ2h0OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBoYWxmSGVpZ2h0ID0gaGVpZ2h0IC8gMjtcbiAgICAgICAgcmV0dXJuIGhhbGZIZWlnaHQgPiBtYXhXaWR0aCA/IG1heFdpZHRoIDogaGFsZkhlaWdodDtcbiAgICAgIH0sXG4gICAgICBoZWlnaHQoaGVpZ2h0OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gaGVpZ2h0O1xuICAgICAgfSxcbiAgICAgIGNvbm5lY3Rpb25PZmZzZXRZKGNvbm5lY3Rpb25IZWlnaHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBjb25uZWN0aW9uSGVpZ2h0IC8gMjtcbiAgICAgIH0sXG4gICAgICBjb25uZWN0aW9uT2Zmc2V0WChjb25uZWN0aW9uV2lkdGg6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiAtY29ubmVjdGlvbldpZHRoO1xuICAgICAgfSxcbiAgICAgIHBhdGhEb3duKGhlaWdodDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG1ha2VNYWluUGF0aChoZWlnaHQsIGZhbHNlLCBmYWxzZSk7XG4gICAgICB9LFxuICAgICAgcGF0aFVwKGhlaWdodDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG1ha2VNYWluUGF0aChoZWlnaHQsIHRydWUsIGZhbHNlKTtcbiAgICAgIH0sXG4gICAgICBwYXRoUmlnaHREb3duKGhlaWdodDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG1ha2VNYWluUGF0aChoZWlnaHQsIGZhbHNlLCB0cnVlKTtcbiAgICAgIH0sXG4gICAgICBwYXRoUmlnaHRVcChoZWlnaHQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBtYWtlTWFpblBhdGgoaGVpZ2h0LCBmYWxzZSwgdHJ1ZSk7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBhIHJvdW5kZWQgc2hhcGUuXG4gICAqXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBhIHJvdW5kZWRcbiAgICogICAgIHNoYXBlIGZvciBjb25uZWN0aW9ucy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYWtlUm91bmRlZCgpOiBTaGFwZSB7XG4gICAgY29uc3QgbWF4V2lkdGggPSB0aGlzLk1BWF9EWU5BTUlDX0NPTk5FQ1RJT05fU0hBUEVfV0lEVEg7XG4gICAgY29uc3QgbWF4SGVpZ2h0ID0gbWF4V2lkdGggKiAyO1xuXG4gICAgLyoqXG4gICAgICogTWFrZSB0aGUgbWFpbiBwYXRoIGZvciB0aGUgcm91bmRlZCBjb25uZWN0aW9uIHNoYXBlIG91dCBvZiB0d28gYXJjcyBhbmRcbiAgICAgKiBhIGxpbmUgdGhhdCBqb2lucyB0aGVtLiAgVGhlIGFyY3MgYXJlIGRlZmluZWQgd2l0aCByZWxhdGl2ZSBwb3NpdGlvbnMuXG4gICAgICogVXN1YWxseSwgdGhlIGhlaWdodCBvZiB0aGUgYmxvY2sgaXMgc3BsaXQgYmV0d2VlbiB0aGUgdHdvIGFyY3MuIEluIHRoZVxuICAgICAqIGNhc2Ugd2hlcmUgdGhlIGhlaWdodCBvZiB0aGUgYmxvY2sgZXhjZWVkcyB0aGUgbWF4aW11bSBoZWlnaHQsIGEgbGluZSBpc1xuICAgICAqIGRyYXduIGluIGJldHdlZW4gdGhlIHR3byBhcmNzLiBUaGUgJ3VwJyBhbmQgJ2Rvd24nIHZlcnNpb25zIG9mIHRoZSBwYXRoc1xuICAgICAqIGFyZSB0aGUgc2FtZSwgYnV0IHRoZSBZIHNpZ24gZmxpcHMuICBUaGUgJ3VwJyBhbmQgJ3JpZ2h0JyB2ZXJzaW9ucyBvZiB0aGVcbiAgICAgKiBwYXRoIGZsaXAgdGhlIHN3ZWVwLWZsYWcgd2hpY2ggbW92ZXMgdGhlIGFyYyBhdCBuZWdhdGl2ZSBhbmdsZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmxvY2tIZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgYmxvY2sgdGhlIGNvbm5lY3Rpb24gaXMgb24uXG4gICAgICogQHBhcmFtIHVwIFRydWUgaWYgdGhlIHBhdGggc2hvdWxkIGJlIGRyYXduIGZyb20gYm90dG9tIHRvIHRvcCwgZmFsc2VcbiAgICAgKiAgICAgb3RoZXJ3aXNlLlxuICAgICAqIEBwYXJhbSByaWdodCBUcnVlIGlmIHRoZSBwYXRoIGlzIGZvciB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgYmxvY2suXG4gICAgICogQHJldHVybnMgQSBwYXRoIGZyYWdtZW50IGRlc2NyaWJpbmcgYSByb3VuZGVkIGNvbm5lY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFrZU1haW5QYXRoKFxuICAgICAgICBibG9ja0hlaWdodDogbnVtYmVyLCB1cDogYm9vbGVhbiwgcmlnaHQ6IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgICAgY29uc3QgcmVtYWluaW5nSGVpZ2h0ID1cbiAgICAgICAgICBibG9ja0hlaWdodCA+IG1heEhlaWdodCA/IGJsb2NrSGVpZ2h0IC0gbWF4SGVpZ2h0IDogMDtcbiAgICAgIGNvbnN0IGhlaWdodCA9IGJsb2NrSGVpZ2h0ID4gbWF4SGVpZ2h0ID8gbWF4SGVpZ2h0IDogYmxvY2tIZWlnaHQ7XG4gICAgICBjb25zdCByYWRpdXMgPSBoZWlnaHQgLyAyO1xuICAgICAgcmV0dXJuIHN2Z1BhdGhzLmFyYyhcbiAgICAgICAgICAgICAgICAgJ2EnLCAnMCAwLDEnLCByYWRpdXMsXG4gICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KFxuICAgICAgICAgICAgICAgICAgICAgKHVwID8gLTEgOiAxKSAqIHJhZGl1cywgKHVwID8gLTEgOiAxKSAqIHJhZGl1cykpICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgKHJpZ2h0ID8gMSA6IC0xKSAqIHJlbWFpbmluZ0hlaWdodCkgK1xuICAgICAgICAgIHN2Z1BhdGhzLmFyYyhcbiAgICAgICAgICAgICAgJ2EnLCAnMCAwLDEnLCByYWRpdXMsXG4gICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KCh1cCA/IDEgOiAtMSkgKiByYWRpdXMsICh1cCA/IC0xIDogMSkgKiByYWRpdXMpKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogdGhpcy5TSEFQRVMuUk9VTkQsXG4gICAgICBpc0R5bmFtaWM6IHRydWUsXG4gICAgICB3aWR0aChoZWlnaHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGhhbGZIZWlnaHQgPSBoZWlnaHQgLyAyO1xuICAgICAgICByZXR1cm4gaGFsZkhlaWdodCA+IG1heFdpZHRoID8gbWF4V2lkdGggOiBoYWxmSGVpZ2h0O1xuICAgICAgfSxcbiAgICAgIGhlaWdodChoZWlnaHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBoZWlnaHQ7XG4gICAgICB9LFxuICAgICAgY29ubmVjdGlvbk9mZnNldFkoY29ubmVjdGlvbkhlaWdodDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb25IZWlnaHQgLyAyO1xuICAgICAgfSxcbiAgICAgIGNvbm5lY3Rpb25PZmZzZXRYKGNvbm5lY3Rpb25XaWR0aDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIC1jb25uZWN0aW9uV2lkdGg7XG4gICAgICB9LFxuICAgICAgcGF0aERvd24oaGVpZ2h0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbWFrZU1haW5QYXRoKGhlaWdodCwgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH0sXG4gICAgICBwYXRoVXAoaGVpZ2h0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbWFrZU1haW5QYXRoKGhlaWdodCwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgfSxcbiAgICAgIHBhdGhSaWdodERvd24oaGVpZ2h0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbWFrZU1haW5QYXRoKGhlaWdodCwgZmFsc2UsIHRydWUpO1xuICAgICAgfSxcbiAgICAgIHBhdGhSaWdodFVwKGhlaWdodDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG1ha2VNYWluUGF0aChoZWlnaHQsIGZhbHNlLCB0cnVlKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGEgc3F1YXJlZCBzaGFwZS5cbiAgICpcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGEgc3F1YXJlZFxuICAgKiAgICAgc2hhcGUgZm9yIGNvbm5lY3Rpb25zLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VTcXVhcmVkKCk6IFNoYXBlIHtcbiAgICBjb25zdCByYWRpdXMgPSB0aGlzLkNPUk5FUl9SQURJVVM7XG5cbiAgICAvKipcbiAgICAgKiBNYWtlIHRoZSBtYWluIHBhdGggZm9yIHRoZSBzcXVhcmVkIGNvbm5lY3Rpb24gc2hhcGUgb3V0IG9mIHR3byBjb3JuZXJzXG4gICAgICogYW5kIGEgc2luZ2xlIGxpbmUgaW4tYmV0d2VlbiAoYSBhbmQgdikuIFRoZXNlIGFyZSBkZWZpbmVkIGluIHJlbGF0aXZlXG4gICAgICogcG9zaXRpb25zIGFuZCByZXF1aXJlIHRoZSBoZWlnaHQgb2YgdGhlIGJsb2NrLlxuICAgICAqIFRoZSAnbGVmdCcgYW5kICdyaWdodCcgdmVyc2lvbnMgb2YgdGhlIHBhdGhzIGFyZSB0aGUgc2FtZSwgYnV0IHRoZSBZIHNpZ25cbiAgICAgKiBmbGlwcy4gIFRoZSAndXAnIGFuZCAnZG93bicgdmVyc2lvbnMgb2YgdGhlIHBhdGggZGV0ZXJtaW5lIHdoZXJlIHRoZVxuICAgICAqIGNvcm5lciBwb2ludCBpcyBwbGFjZWQgYW5kIGluIHR1cm4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgY29ybmVycy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgYmxvY2sgdGhlIGNvbm5lY3Rpb24gaXMgb24uXG4gICAgICogQHBhcmFtIHVwIFRydWUgaWYgdGhlIHBhdGggc2hvdWxkIGJlIGRyYXduIGZyb20gYm90dG9tIHRvIHRvcCwgZmFsc2VcbiAgICAgKiAgICAgb3RoZXJ3aXNlLlxuICAgICAqIEBwYXJhbSByaWdodCBUcnVlIGlmIHRoZSBwYXRoIGlzIGZvciB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgYmxvY2suXG4gICAgICogQHJldHVybnMgQSBwYXRoIGZyYWdtZW50IGRlc2NyaWJpbmcgYSBzcXVhcmVkIGNvbm5lY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFrZU1haW5QYXRoKGhlaWdodDogbnVtYmVyLCB1cDogYm9vbGVhbiwgcmlnaHQ6IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgICAgY29uc3QgaW5uZXJIZWlnaHQgPSBoZWlnaHQgLSByYWRpdXMgKiAyO1xuICAgICAgcmV0dXJuIHN2Z1BhdGhzLmFyYyhcbiAgICAgICAgICAgICAgICAgJ2EnLCAnMCAwLDEnLCByYWRpdXMsXG4gICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KFxuICAgICAgICAgICAgICAgICAgICAgKHVwID8gLTEgOiAxKSAqIHJhZGl1cywgKHVwID8gLTEgOiAxKSAqIHJhZGl1cykpICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgKHJpZ2h0ID8gMSA6IC0xKSAqIGlubmVySGVpZ2h0KSArXG4gICAgICAgICAgc3ZnUGF0aHMuYXJjKFxuICAgICAgICAgICAgICAnYScsICcwIDAsMScsIHJhZGl1cyxcbiAgICAgICAgICAgICAgc3ZnUGF0aHMucG9pbnQoKHVwID8gMSA6IC0xKSAqIHJhZGl1cywgKHVwID8gLTEgOiAxKSAqIHJhZGl1cykpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiB0aGlzLlNIQVBFUy5TUVVBUkUsXG4gICAgICBpc0R5bmFtaWM6IHRydWUsXG4gICAgICB3aWR0aChfaGVpZ2h0OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gcmFkaXVzO1xuICAgICAgfSxcbiAgICAgIGhlaWdodChoZWlnaHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBoZWlnaHQ7XG4gICAgICB9LFxuICAgICAgY29ubmVjdGlvbk9mZnNldFkoY29ubmVjdGlvbkhlaWdodDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb25IZWlnaHQgLyAyO1xuICAgICAgfSxcbiAgICAgIGNvbm5lY3Rpb25PZmZzZXRYKGNvbm5lY3Rpb25XaWR0aDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIC1jb25uZWN0aW9uV2lkdGg7XG4gICAgICB9LFxuICAgICAgcGF0aERvd24oaGVpZ2h0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbWFrZU1haW5QYXRoKGhlaWdodCwgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH0sXG4gICAgICBwYXRoVXAoaGVpZ2h0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbWFrZU1haW5QYXRoKGhlaWdodCwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgfSxcbiAgICAgIHBhdGhSaWdodERvd24oaGVpZ2h0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbWFrZU1haW5QYXRoKGhlaWdodCwgZmFsc2UsIHRydWUpO1xuICAgICAgfSxcbiAgICAgIHBhdGhSaWdodFVwKGhlaWdodDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG1ha2VNYWluUGF0aChoZWlnaHQsIGZhbHNlLCB0cnVlKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIG92ZXJyaWRlIHNoYXBlRm9yKGNvbm5lY3Rpb246IFJlbmRlcmVkQ29ubmVjdGlvbik6IFNoYXBlIHtcbiAgICBsZXQgY2hlY2tzID0gY29ubmVjdGlvbi5nZXRDaGVjaygpO1xuICAgIGlmICghY2hlY2tzICYmIGNvbm5lY3Rpb24udGFyZ2V0Q29ubmVjdGlvbikge1xuICAgICAgY2hlY2tzID0gY29ubmVjdGlvbi50YXJnZXRDb25uZWN0aW9uLmdldENoZWNrKCk7XG4gICAgfVxuICAgIGxldCBvdXRwdXRTaGFwZTtcbiAgICBzd2l0Y2ggKGNvbm5lY3Rpb24udHlwZSkge1xuICAgICAgY2FzZSBDb25uZWN0aW9uVHlwZS5JTlBVVF9WQUxVRTpcbiAgICAgIGNhc2UgQ29ubmVjdGlvblR5cGUuT1VUUFVUX1ZBTFVFOlxuICAgICAgICBvdXRwdXRTaGFwZSA9IGNvbm5lY3Rpb24uZ2V0U291cmNlQmxvY2soKS5nZXRPdXRwdXRTaGFwZSgpO1xuICAgICAgICAvLyBJZiB0aGUgYmxvY2sgaGFzIGFuIG91dHB1dCBzaGFwZSBzZXQsIHVzZSB0aGF0IGluc3RlYWQuXG4gICAgICAgIGlmIChvdXRwdXRTaGFwZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHN3aXRjaCAob3V0cHV0U2hhcGUpIHtcbiAgICAgICAgICAgIGNhc2UgdGhpcy5TSEFQRVMuSEVYQUdPTkFMOlxuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5IRVhBR09OQUwhO1xuICAgICAgICAgICAgY2FzZSB0aGlzLlNIQVBFUy5ST1VORDpcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUk9VTkRFRCE7XG4gICAgICAgICAgICBjYXNlIHRoaXMuU0hBUEVTLlNRVUFSRTpcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuU1FVQVJFRCE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEluY2x1ZGVzIGRvZXNuJ3Qgd29yayBpbiBJRS5cbiAgICAgICAgaWYgKGNoZWNrcyAmJiBjaGVja3MuaW5kZXhPZignQm9vbGVhbicpICE9PSAtMSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLkhFWEFHT05BTCE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrcyAmJiBjaGVja3MuaW5kZXhPZignTnVtYmVyJykgIT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuUk9VTkRFRCE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrcyAmJiBjaGVja3MuaW5kZXhPZignU3RyaW5nJykgIT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuUk9VTkRFRCE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuUk9VTkRFRCE7XG4gICAgICBjYXNlIENvbm5lY3Rpb25UeXBlLlBSRVZJT1VTX1NUQVRFTUVOVDpcbiAgICAgIGNhc2UgQ29ubmVjdGlvblR5cGUuTkVYVF9TVEFURU1FTlQ6XG4gICAgICAgIHJldHVybiB0aGlzLk5PVENIITtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IEVycm9yKCdVbmtub3duIHR5cGUnKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBtYWtlTm90Y2goKSB7XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLk5PVENIX1dJRFRIO1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuTk9UQ0hfSEVJR0hUO1xuXG4gICAgY29uc3QgaW5uZXJXaWR0aCA9IHdpZHRoIC8gMztcbiAgICBjb25zdCBjdXJ2ZVdpZHRoID0gaW5uZXJXaWR0aCAvIDM7XG5cbiAgICBjb25zdCBoYWxmSGVpZ2h0ID0gaGVpZ2h0IC8gMjtcbiAgICBjb25zdCBxdWFydGVySGVpZ2h0ID0gaGFsZkhlaWdodCAvIDI7XG5cbiAgICAvKipcbiAgICAgKiBNYWtlIHRoZSBtYWluIHBhdGggZm9yIHRoZSBub3RjaC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkaXIgRGlyZWN0aW9uIG11bHRpcGxpZXIgdG8gYXBwbHkgdG8gaG9yaXpvbnRhbCBvZmZzZXRzIGFsb25nIHRoZVxuICAgICAqICAgICBwYXRoLiBFaXRoZXIgMSBvciAtMS5cbiAgICAgKiBAcmV0dXJucyBBIHBhdGggZnJhZ21lbnQgZGVzY3JpYmluZyBhIG5vdGNoLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1ha2VNYWluUGF0aChkaXI6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICByZXR1cm4gc3ZnUGF0aHMuY3VydmUoXG4gICAgICAgICAgICAgICAgICdjJyxcbiAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KGRpciAqIGN1cnZlV2lkdGggLyAyLCAwKSxcbiAgICAgICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoICogMyAvIDQsIHF1YXJ0ZXJIZWlnaHQgLyAyKSxcbiAgICAgICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoLCBxdWFydGVySGVpZ2h0KSxcbiAgICAgICAgICAgICAgICAgXSkgK1xuICAgICAgICAgIHN2Z1BhdGhzLmxpbmUoW3N2Z1BhdGhzLnBvaW50KGRpciAqIGN1cnZlV2lkdGgsIGhhbGZIZWlnaHQpXSkgK1xuICAgICAgICAgIHN2Z1BhdGhzLmN1cnZlKFxuICAgICAgICAgICAgICAnYycsXG4gICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoIC8gNCwgcXVhcnRlckhlaWdodCAvIDIpLFxuICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KGRpciAqIGN1cnZlV2lkdGggLyAyLCBxdWFydGVySGVpZ2h0KSxcbiAgICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoLCBxdWFydGVySGVpZ2h0KSxcbiAgICAgICAgICAgICAgXSkgK1xuICAgICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ2gnLCBkaXIgKiBpbm5lcldpZHRoKSArXG4gICAgICAgICAgc3ZnUGF0aHMuY3VydmUoXG4gICAgICAgICAgICAgICdjJyxcbiAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KGRpciAqIGN1cnZlV2lkdGggLyAyLCAwKSxcbiAgICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoICogMyAvIDQsIC0ocXVhcnRlckhlaWdodCAvIDIpKSxcbiAgICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoLCAtcXVhcnRlckhlaWdodCksXG4gICAgICAgICAgICAgIF0pICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lKFtzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoLCAtaGFsZkhlaWdodCldKSArXG4gICAgICAgICAgc3ZnUGF0aHMuY3VydmUoJ2MnLCBbXG4gICAgICAgICAgICBzdmdQYXRocy5wb2ludChkaXIgKiBjdXJ2ZVdpZHRoIC8gNCwgLShxdWFydGVySGVpZ2h0IC8gMikpLFxuICAgICAgICAgICAgc3ZnUGF0aHMucG9pbnQoZGlyICogY3VydmVXaWR0aCAvIDIsIC1xdWFydGVySGVpZ2h0KSxcbiAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KGRpciAqIGN1cnZlV2lkdGgsIC1xdWFydGVySGVpZ2h0KSxcbiAgICAgICAgICBdKTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXRoTGVmdCA9IG1ha2VNYWluUGF0aCgxKTtcbiAgICBjb25zdCBwYXRoUmlnaHQgPSBtYWtlTWFpblBhdGgoLTEpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IHRoaXMuU0hBUEVTLk5PVENILFxuICAgICAgd2lkdGgsXG4gICAgICBoZWlnaHQsXG4gICAgICBwYXRoTGVmdCxcbiAgICAgIHBhdGhSaWdodCxcbiAgICB9O1xuICB9XG5cbiAgb3ZlcnJpZGUgbWFrZUluc2lkZUNvcm5lcnMoKSB7XG4gICAgY29uc3QgcmFkaXVzID0gdGhpcy5DT1JORVJfUkFESVVTO1xuXG4gICAgY29uc3QgaW5uZXJUb3BMZWZ0Q29ybmVyID1cbiAgICAgICAgc3ZnUGF0aHMuYXJjKCdhJywgJzAgMCwwJywgcmFkaXVzLCBzdmdQYXRocy5wb2ludCgtcmFkaXVzLCByYWRpdXMpKTtcblxuICAgIGNvbnN0IGlubmVyVG9wUmlnaHRDb3JuZXIgPVxuICAgICAgICBzdmdQYXRocy5hcmMoJ2EnLCAnMCAwLDEnLCByYWRpdXMsIHN2Z1BhdGhzLnBvaW50KC1yYWRpdXMsIHJhZGl1cykpO1xuXG4gICAgY29uc3QgaW5uZXJCb3R0b21MZWZ0Q29ybmVyID1cbiAgICAgICAgc3ZnUGF0aHMuYXJjKCdhJywgJzAgMCwwJywgcmFkaXVzLCBzdmdQYXRocy5wb2ludChyYWRpdXMsIHJhZGl1cykpO1xuXG4gICAgY29uc3QgaW5uZXJCb3R0b21SaWdodENvcm5lciA9XG4gICAgICAgIHN2Z1BhdGhzLmFyYygnYScsICcwIDAsMScsIHJhZGl1cywgc3ZnUGF0aHMucG9pbnQocmFkaXVzLCByYWRpdXMpKTtcblxuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogcmFkaXVzLFxuICAgICAgaGVpZ2h0OiByYWRpdXMsXG4gICAgICBwYXRoVG9wOiBpbm5lclRvcExlZnRDb3JuZXIsXG4gICAgICBwYXRoQm90dG9tOiBpbm5lckJvdHRvbUxlZnRDb3JuZXIsXG4gICAgICByaWdodFdpZHRoOiByYWRpdXMsXG4gICAgICByaWdodEhlaWdodDogcmFkaXVzLFxuICAgICAgcGF0aFRvcFJpZ2h0OiBpbm5lclRvcFJpZ2h0Q29ybmVyLFxuICAgICAgcGF0aEJvdHRvbVJpZ2h0OiBpbm5lckJvdHRvbVJpZ2h0Q29ybmVyLFxuICAgIH07XG4gIH1cblxuICBvdmVycmlkZSBnZW5lcmF0ZVNlY29uZGFyeUNvbG91cl8oY29sb3VyOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdXRpbHNDb2xvdXIuYmxlbmQoJyMwMDAnLCBjb2xvdXIsIDAuMTUpIHx8IGNvbG91cjtcbiAgfVxuXG4gIG92ZXJyaWRlIGdlbmVyYXRlVGVydGlhcnlDb2xvdXJfKGNvbG91cjogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHV0aWxzQ29sb3VyLmJsZW5kKCcjMDAwJywgY29sb3VyLCAwLjI1KSB8fCBjb2xvdXI7XG4gIH1cblxuICBvdmVycmlkZSBjcmVhdGVEb20oc3ZnOiBTVkdFbGVtZW50LCB0YWdOYW1lOiBzdHJpbmcsIHNlbGVjdG9yOiBzdHJpbmcpIHtcbiAgICBzdXBlci5jcmVhdGVEb20oc3ZnLCB0YWdOYW1lLCBzZWxlY3Rvcik7XG4gICAgLypcbiAgICAgICAgPGRlZnM+XG4gICAgICAgICAgLi4uIGZpbHRlcnMgZ28gaGVyZSAuLi5cbiAgICAgICAgPC9kZWZzPlxuICAgICAgICAqL1xuICAgIGNvbnN0IGRlZnMgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuREVGUywge30sIHN2Zyk7XG4gICAgLy8gVXNpbmcgYSBkaWxhdGUgZGlzdG9ydHMgdGhlIGJsb2NrIHNoYXBlLlxuICAgIC8vIEluc3RlYWQgdXNlIGEgZ2F1c3NpYW4gYmx1ciwgYW5kIHRoZW4gc2V0IGFsbCBhbHBoYSB0byAxIHdpdGggYSB0cmFuc2Zlci5cbiAgICBjb25zdCBzZWxlY3RlZEdsb3dGaWx0ZXIgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkZJTFRFUiwge1xuICAgICAgICAgICdpZCc6ICdibG9ja2x5U2VsZWN0ZWRHbG93RmlsdGVyJyArIHRoaXMucmFuZG9tSWRlbnRpZmllcixcbiAgICAgICAgICAnaGVpZ2h0JzogJzE2MCUnLFxuICAgICAgICAgICd3aWR0aCc6ICcxODAlJyxcbiAgICAgICAgICAneSc6ICctMzAlJyxcbiAgICAgICAgICAneCc6ICctNDAlJyxcbiAgICAgICAgfSxcbiAgICAgICAgZGVmcyk7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUdBVVNTSUFOQkxVUixcbiAgICAgICAgeydpbic6ICdTb3VyY2VHcmFwaGljJywgJ3N0ZERldmlhdGlvbic6IHRoaXMuU0VMRUNURURfR0xPV19TSVpFfSxcbiAgICAgICAgc2VsZWN0ZWRHbG93RmlsdGVyKTtcbiAgICAvLyBTZXQgYWxsIGdhdXNzaWFuIGJsdXIgcGl4ZWxzIHRvIDEgb3BhY2l0eSBiZWZvcmUgYXBwbHlpbmcgZmxvb2RcbiAgICBjb25zdCBzZWxlY3RlZENvbXBvbmVudFRyYW5zZmVyID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUNPTVBPTkVOVFRSQU5TRkVSLCB7J3Jlc3VsdCc6ICdvdXRCbHVyJ30sIHNlbGVjdGVkR2xvd0ZpbHRlcik7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUZVTkNBLFxuICAgICAgICB7J3R5cGUnOiAndGFibGUnLCAndGFibGVWYWx1ZXMnOiAnMCAxIDEgMSAxIDEgMSAxIDEgMSAxIDEgMSAxIDEgMSAxJ30sXG4gICAgICAgIHNlbGVjdGVkQ29tcG9uZW50VHJhbnNmZXIpO1xuICAgIC8vIENvbG9yIHRoZSBoaWdobGlnaHRcbiAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkZFRkxPT0QsIHtcbiAgICAgICAgICAnZmxvb2QtY29sb3InOiB0aGlzLlNFTEVDVEVEX0dMT1dfQ09MT1VSLFxuICAgICAgICAgICdmbG9vZC1vcGFjaXR5JzogMSxcbiAgICAgICAgICAncmVzdWx0JzogJ291dENvbG9yJyxcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0ZWRHbG93RmlsdGVyKTtcbiAgICBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkZFQ09NUE9TSVRFLCB7XG4gICAgICAgICAgJ2luJzogJ291dENvbG9yJyxcbiAgICAgICAgICAnaW4yJzogJ291dEJsdXInLFxuICAgICAgICAgICdvcGVyYXRvcic6ICdpbicsXG4gICAgICAgICAgJ3Jlc3VsdCc6ICdvdXRHbG93JyxcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0ZWRHbG93RmlsdGVyKTtcbiAgICB0aGlzLnNlbGVjdGVkR2xvd0ZpbHRlcklkID0gc2VsZWN0ZWRHbG93RmlsdGVyLmlkO1xuICAgIHRoaXMuc2VsZWN0ZWRHbG93RmlsdGVyXyA9IHNlbGVjdGVkR2xvd0ZpbHRlcjtcblxuICAgIC8vIFVzaW5nIGEgZGlsYXRlIGRpc3RvcnRzIHRoZSBibG9jayBzaGFwZS5cbiAgICAvLyBJbnN0ZWFkIHVzZSBhIGdhdXNzaWFuIGJsdXIsIGFuZCB0aGVuIHNldCBhbGwgYWxwaGEgdG8gMSB3aXRoIGEgdHJhbnNmZXIuXG4gICAgY29uc3QgcmVwbGFjZW1lbnRHbG93RmlsdGVyID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GSUxURVIsIHtcbiAgICAgICAgICAnaWQnOiAnYmxvY2tseVJlcGxhY2VtZW50R2xvd0ZpbHRlcicgKyB0aGlzLnJhbmRvbUlkZW50aWZpZXIsXG4gICAgICAgICAgJ2hlaWdodCc6ICcxNjAlJyxcbiAgICAgICAgICAnd2lkdGgnOiAnMTgwJScsXG4gICAgICAgICAgJ3knOiAnLTMwJScsXG4gICAgICAgICAgJ3gnOiAnLTQwJScsXG4gICAgICAgIH0sXG4gICAgICAgIGRlZnMpO1xuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRkVHQVVTU0lBTkJMVVIsXG4gICAgICAgIHsnaW4nOiAnU291cmNlR3JhcGhpYycsICdzdGREZXZpYXRpb24nOiB0aGlzLlJFUExBQ0VNRU5UX0dMT1dfU0laRX0sXG4gICAgICAgIHJlcGxhY2VtZW50R2xvd0ZpbHRlcik7XG4gICAgLy8gU2V0IGFsbCBnYXVzc2lhbiBibHVyIHBpeGVscyB0byAxIG9wYWNpdHkgYmVmb3JlIGFwcGx5aW5nIGZsb29kXG4gICAgY29uc3QgcmVwbGFjZW1lbnRDb21wb25lbnRUcmFuc2ZlciA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRkVDT01QT05FTlRUUkFOU0ZFUiwgeydyZXN1bHQnOiAnb3V0Qmx1cid9LCByZXBsYWNlbWVudEdsb3dGaWx0ZXIpO1xuICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRkVGVU5DQSxcbiAgICAgICAgeyd0eXBlJzogJ3RhYmxlJywgJ3RhYmxlVmFsdWVzJzogJzAgMSAxIDEgMSAxIDEgMSAxIDEgMSAxIDEgMSAxIDEgMSd9LFxuICAgICAgICByZXBsYWNlbWVudENvbXBvbmVudFRyYW5zZmVyKTtcbiAgICAvLyBDb2xvciB0aGUgaGlnaGxpZ2h0XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUZMT09ELCB7XG4gICAgICAgICAgJ2Zsb29kLWNvbG9yJzogdGhpcy5SRVBMQUNFTUVOVF9HTE9XX0NPTE9VUixcbiAgICAgICAgICAnZmxvb2Qtb3BhY2l0eSc6IDEsXG4gICAgICAgICAgJ3Jlc3VsdCc6ICdvdXRDb2xvcicsXG4gICAgICAgIH0sXG4gICAgICAgIHJlcGxhY2VtZW50R2xvd0ZpbHRlcik7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUNPTVBPU0lURSwge1xuICAgICAgICAgICdpbic6ICdvdXRDb2xvcicsXG4gICAgICAgICAgJ2luMic6ICdvdXRCbHVyJyxcbiAgICAgICAgICAnb3BlcmF0b3InOiAnaW4nLFxuICAgICAgICAgICdyZXN1bHQnOiAnb3V0R2xvdycsXG4gICAgICAgIH0sXG4gICAgICAgIHJlcGxhY2VtZW50R2xvd0ZpbHRlcik7XG4gICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5GRUNPTVBPU0lURSwge1xuICAgICAgICAgICdpbic6ICdTb3VyY2VHcmFwaGljJyxcbiAgICAgICAgICAnaW4yJzogJ291dEdsb3cnLFxuICAgICAgICAgICdvcGVyYXRvcic6ICdvdmVyJyxcbiAgICAgICAgfSxcbiAgICAgICAgcmVwbGFjZW1lbnRHbG93RmlsdGVyKTtcbiAgICB0aGlzLnJlcGxhY2VtZW50R2xvd0ZpbHRlcklkID0gcmVwbGFjZW1lbnRHbG93RmlsdGVyLmlkO1xuICAgIHRoaXMucmVwbGFjZW1lbnRHbG93RmlsdGVyXyA9IHJlcGxhY2VtZW50R2xvd0ZpbHRlcjtcbiAgfVxuXG4gIG92ZXJyaWRlIGdldENTU18oc2VsZWN0b3I6IHN0cmluZykge1xuICAgIHJldHVybiBbXG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBpbmRlbnQgKi9cbiAgICAgIC8vIFRleHQuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlUZXh0LGAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlGbHlvdXRMYWJlbFRleHQge2AsXG4gICAgICBgZm9udDogJHt0aGlzLkZJRUxEX1RFWFRfRk9OVFdFSUdIVH0gJHt0aGlzLkZJRUxEX1RFWFRfRk9OVFNJWkV9YCArXG4gICAgICAgICAgYHB0ICR7dGhpcy5GSUVMRF9URVhUX0ZPTlRGQU1JTFl9O2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIEZpZWxkcy5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseVRleHQge2AsXG4gICAgICBgZmlsbDogI2ZmZjtgLFxuICAgICAgYH1gLFxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5Tm9uRWRpdGFibGVUZXh0PnJlY3Q6bm90KC5ibG9ja2x5RHJvcGRvd25SZWN0KSxgLFxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5RWRpdGFibGVUZXh0PnJlY3Q6bm90KC5ibG9ja2x5RHJvcGRvd25SZWN0KSB7YCxcbiAgICAgIGBmaWxsOiAke3RoaXMuRklFTERfQk9SREVSX1JFQ1RfQ09MT1VSfTtgLFxuICAgICAgYH1gLFxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5Tm9uRWRpdGFibGVUZXh0PnRleHQsYCxcbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseUVkaXRhYmxlVGV4dD50ZXh0LGAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlOb25FZGl0YWJsZVRleHQ+Zz50ZXh0LGAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlFZGl0YWJsZVRleHQ+Zz50ZXh0IHtgLFxuICAgICAgYGZpbGw6ICM1NzVFNzU7YCxcbiAgICAgIGB9YCxcblxuICAgICAgLy8gRmx5b3V0IGxhYmVscy5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseUZseW91dExhYmVsVGV4dCB7YCxcbiAgICAgIGBmaWxsOiAjNTc1RTc1O2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIEJ1YmJsZXMuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlUZXh0LmJsb2NrbHlCdWJibGVUZXh0IHtgLFxuICAgICAgYGZpbGw6ICM1NzVFNzU7YCxcbiAgICAgIGB9YCxcblxuICAgICAgLy8gRWRpdGFibGUgZmllbGQgaG92ZXIuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlEcmFnZ2FibGU6bm90KC5ibG9ja2x5RGlzYWJsZWQpYCxcbiAgICAgIGAgLmJsb2NrbHlFZGl0YWJsZVRleHQ6bm90KC5lZGl0aW5nKTpob3Zlcj5yZWN0LGAsXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlEcmFnZ2FibGU6bm90KC5ibG9ja2x5RGlzYWJsZWQpYCxcbiAgICAgIGAgLmJsb2NrbHlFZGl0YWJsZVRleHQ6bm90KC5lZGl0aW5nKTpob3Zlcj4uYmxvY2tseVBhdGgge2AsXG4gICAgICBgc3Ryb2tlOiAjZmZmO2AsXG4gICAgICBgc3Ryb2tlLXdpZHRoOiAyO2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIFRleHQgZmllbGQgaW5wdXQuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlIdG1sSW5wdXQge2AsXG4gICAgICBgZm9udC1mYW1pbHk6ICR7dGhpcy5GSUVMRF9URVhUX0ZPTlRGQU1JTFl9O2AsXG4gICAgICBgZm9udC13ZWlnaHQ6ICR7dGhpcy5GSUVMRF9URVhUX0ZPTlRXRUlHSFR9O2AsXG4gICAgICBgY29sb3I6ICM1NzVFNzU7YCxcbiAgICAgIGB9YCxcblxuICAgICAgLy8gRHJvcGRvd24gZmllbGQuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlEcm9wZG93blRleHQge2AsXG4gICAgICBgZmlsbDogI2ZmZiAhaW1wb3J0YW50O2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIFdpZGdldCBhbmQgRHJvcGRvd24gRGl2XG4gICAgICBgJHtzZWxlY3Rvcn0uYmxvY2tseVdpZGdldERpdiAuZ29vZy1tZW51aXRlbSxgLFxuICAgICAgYCR7c2VsZWN0b3J9LmJsb2NrbHlEcm9wRG93bkRpdiAuZ29vZy1tZW51aXRlbSB7YCxcbiAgICAgIGBmb250LWZhbWlseTogJHt0aGlzLkZJRUxEX1RFWFRfRk9OVEZBTUlMWX07YCxcbiAgICAgIGB9YCxcbiAgICAgIGAke3NlbGVjdG9yfS5ibG9ja2x5RHJvcERvd25EaXYgLmdvb2ctbWVudWl0ZW0tY29udGVudCB7YCxcbiAgICAgIGBjb2xvcjogI2ZmZjtgLFxuICAgICAgYH1gLFxuXG4gICAgICAvLyBDb25uZWN0aW9uIGhpZ2hsaWdodC5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseUhpZ2hsaWdodGVkQ29ubmVjdGlvblBhdGgge2AsXG4gICAgICBgc3Ryb2tlOiAke3RoaXMuU0VMRUNURURfR0xPV19DT0xPVVJ9O2AsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIERpc2FibGVkIG91dGxpbmUgcGF0aHMuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlEaXNhYmxlZCA+IC5ibG9ja2x5T3V0bGluZVBhdGgge2AsXG4gICAgICBgZmlsbDogdXJsKCNibG9ja2x5RGlzYWJsZWRQYXR0ZXJuJHt0aGlzLnJhbmRvbUlkZW50aWZpZXJ9KWAsXG4gICAgICBgfWAsXG5cbiAgICAgIC8vIEluc2VydGlvbiBtYXJrZXIuXG4gICAgICBgJHtzZWxlY3Rvcn0gLmJsb2NrbHlJbnNlcnRpb25NYXJrZXI+LmJsb2NrbHlQYXRoIHtgLFxuICAgICAgYGZpbGwtb3BhY2l0eTogJHt0aGlzLklOU0VSVElPTl9NQVJLRVJfT1BBQ0lUWX07YCxcbiAgICAgIGBzdHJva2U6IG5vbmU7YCxcbiAgICAgIGB9YCxcbiAgICBdO1xuICB9XG59XG4vKiBlc2xpbnQtZW5hYmxlIGluZGVudCAqL1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFplbG9zIHJlbmRlcmVyLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnplbG9zLkRyYXdlcicpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uLy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdQYXRocyBmcm9tICcuLi8uLi91dGlscy9zdmdfcGF0aHMuanMnO1xuaW1wb3J0IHR5cGUge0Jhc2VTaGFwZSwgRHluYW1pY1NoYXBlLCBOb3RjaH0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICcuLi9jb21tb24vZGVidWcuanMnO1xuaW1wb3J0IHtEcmF3ZXIgYXMgQmFzZURyYXdlcn0gZnJvbSAnLi4vY29tbW9uL2RyYXdlci5qcyc7XG5pbXBvcnQgdHlwZSB7SW5saW5lSW5wdXR9IGZyb20gJy4uL21lYXN1cmFibGVzL2lubGluZV9pbnB1dC5qcyc7XG5pbXBvcnQgdHlwZSB7Um93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9yb3cuanMnO1xuaW1wb3J0IHR5cGUge1NwYWNlclJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvc3BhY2VyX3Jvdy5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuLi9tZWFzdXJhYmxlcy90eXBlcy5qcyc7XG5cbmltcG9ydCB0eXBlIHtJbnNpZGVDb3JuZXJzfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVySW5mb30gZnJvbSAnLi9pbmZvLmpzJztcbmltcG9ydCB0eXBlIHtTdGF0ZW1lbnRJbnB1dH0gZnJvbSAnLi9tZWFzdXJhYmxlcy9pbnB1dHMuanMnO1xuaW1wb3J0IHR5cGUge1BhdGhPYmplY3R9IGZyb20gJy4vcGF0aF9vYmplY3QuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgZHJhd3MgYSBibG9jayBiYXNlZCBvbiB0aGUgZ2l2ZW4gcmVuZGVyaW5nIGluZm9ybWF0aW9uLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnplbG9zLkRyYXdlclxuICovXG5leHBvcnQgY2xhc3MgRHJhd2VyIGV4dGVuZHMgQmFzZURyYXdlciB7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIG92ZXJyaWRlIGluZm9fITogUmVuZGVySW5mbztcblxuICAvKipcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byByZW5kZXIuXG4gICAqIEBwYXJhbSBpbmZvIEFuIG9iamVjdCBjb250YWluaW5nIGFsbCBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gcmVuZGVyIHRoaXNcbiAgICogICAgIGJsb2NrLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGJsb2NrOiBCbG9ja1N2ZywgaW5mbzogUmVuZGVySW5mbykge1xuICAgIHN1cGVyKGJsb2NrLCBpbmZvKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGRyYXcoKSB7XG4gICAgY29uc3QgcGF0aE9iamVjdCA9IHRoaXMuYmxvY2tfLnBhdGhPYmplY3QgYXMgUGF0aE9iamVjdDtcbiAgICBwYXRoT2JqZWN0LmJlZ2luRHJhd2luZygpO1xuICAgIHRoaXMuaGlkZUhpZGRlbkljb25zXygpO1xuICAgIHRoaXMuZHJhd091dGxpbmVfKCk7XG4gICAgdGhpcy5kcmF3SW50ZXJuYWxzXygpO1xuXG4gICAgcGF0aE9iamVjdC5zZXRQYXRoKHRoaXMub3V0bGluZVBhdGhfICsgJ1xcbicgKyB0aGlzLmlubGluZVBhdGhfKTtcbiAgICBpZiAodGhpcy5pbmZvXy5SVEwpIHtcbiAgICAgIHBhdGhPYmplY3QuZmxpcFJUTCgpO1xuICAgIH1cbiAgICBpZiAoZGVidWcuaXNEZWJ1Z2dlckVuYWJsZWQoKSkge1xuICAgICAgdGhpcy5ibG9ja18/LnJlbmRlcmluZ0RlYnVnZ2VyPy5kcmF3RGVidWcodGhpcy5ibG9ja18sIHRoaXMuaW5mb18pO1xuICAgIH1cbiAgICB0aGlzLnJlY29yZFNpemVPbkJsb2NrXygpO1xuICAgIGlmICh0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgIC8vIFN0b3JlIHRoZSBvdXRwdXQgY29ubmVjdGlvbiBzaGFwZSB0eXBlIGZvciBwYXJlbnQgYmxvY2tzIHRvIHVzZSBkdXJpbmdcbiAgICAgIC8vIHJlbmRlcmluZy5cbiAgICAgIHBhdGhPYmplY3Qub3V0cHV0U2hhcGVUeXBlID0gdGhpcy5pbmZvXy5vdXRwdXRDb25uZWN0aW9uLnNoYXBlLnR5cGU7XG4gICAgfVxuICAgIHBhdGhPYmplY3QuZW5kRHJhd2luZygpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZHJhd091dGxpbmVfKCkge1xuICAgIGlmICh0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24gJiZcbiAgICAgICAgdGhpcy5pbmZvXy5vdXRwdXRDb25uZWN0aW9uLmlzRHluYW1pY1NoYXBlICYmXG4gICAgICAgICF0aGlzLmluZm9fLmhhc1N0YXRlbWVudElucHV0ICYmXG4gICAgICAgICF0aGlzLmluZm9fLmJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbikge1xuICAgICAgdGhpcy5kcmF3RmxhdFRvcF8oKTtcbiAgICAgIHRoaXMuZHJhd1JpZ2h0RHluYW1pY0Nvbm5lY3Rpb25fKCk7XG4gICAgICB0aGlzLmRyYXdGbGF0Qm90dG9tXygpO1xuICAgICAgdGhpcy5kcmF3TGVmdER5bmFtaWNDb25uZWN0aW9uXygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdXBlci5kcmF3T3V0bGluZV8oKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBkcmF3TGVmdF8oKSB7XG4gICAgaWYgKHRoaXMuaW5mb18ub3V0cHV0Q29ubmVjdGlvbiAmJlxuICAgICAgICB0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24uaXNEeW5hbWljU2hhcGUpIHtcbiAgICAgIHRoaXMuZHJhd0xlZnREeW5hbWljQ29ubmVjdGlvbl8oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3VwZXIuZHJhd0xlZnRfKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBzdGVwcyBmb3IgdGhlIHJpZ2h0IHNpZGUgb2YgYSByb3cgdGhhdCBkb2VzIG5vdCBoYXZlIHZhbHVlIG9yXG4gICAqIHN0YXRlbWVudCBpbnB1dCBjb25uZWN0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRvIGRyYXcgdGhlIHNpZGUgb2YuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZHJhd1JpZ2h0U2lkZVJvd18ocm93OiBSb3cpIHtcbiAgICBpZiAocm93LmhlaWdodCA8PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChUeXBlcy5pc1NwYWNlcihyb3cpKSB7XG4gICAgICBjb25zdCBzcGFjZXJSb3cgPSByb3cgYXMgU3BhY2VyUm93O1xuICAgICAgaWYgKHNwYWNlclJvdy5wcmVjZWRlc1N0YXRlbWVudCB8fCBzcGFjZXJSb3cuZm9sbG93c1N0YXRlbWVudCkge1xuICAgICAgICBjb25zdCBjb3JuZXJIZWlnaHQgPVxuICAgICAgICAgICAgKHRoaXMuY29uc3RhbnRzXy5JTlNJREVfQ09STkVSUyBhcyBJbnNpZGVDb3JuZXJzKS5yaWdodEhlaWdodDtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nSGVpZ2h0ID1cbiAgICAgICAgICAgIHNwYWNlclJvdy5oZWlnaHQgLSAoc3BhY2VyUm93LnByZWNlZGVzU3RhdGVtZW50ID8gY29ybmVySGVpZ2h0IDogMCk7XG4gICAgICAgIHRoaXMub3V0bGluZVBhdGhfICs9XG4gICAgICAgICAgICAoc3BhY2VyUm93LmZvbGxvd3NTdGF0ZW1lbnQgP1xuICAgICAgICAgICAgICAgICAodGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTIGFzIEluc2lkZUNvcm5lcnMpXG4gICAgICAgICAgICAgICAgICAgICAucGF0aEJvdHRvbVJpZ2h0IDpcbiAgICAgICAgICAgICAgICAgJycpICtcbiAgICAgICAgICAgIChyZW1haW5pbmdIZWlnaHQgPiAwID9cbiAgICAgICAgICAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnVicsIHNwYWNlclJvdy55UG9zICsgcmVtYWluaW5nSGVpZ2h0KSA6XG4gICAgICAgICAgICAgICAgICcnKSArXG4gICAgICAgICAgICAoc3BhY2VyUm93LnByZWNlZGVzU3RhdGVtZW50ID9cbiAgICAgICAgICAgICAgICAgKHRoaXMuY29uc3RhbnRzXy5JTlNJREVfQ09STkVSUyBhcyBJbnNpZGVDb3JuZXJzKVxuICAgICAgICAgICAgICAgICAgICAgLnBhdGhUb3BSaWdodCA6XG4gICAgICAgICAgICAgICAgICcnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgcm93LnlQb3MgKyByb3cuaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3RlcHMgdG8gZHJhdyB0aGUgcmlnaHQgc2lkZSBvZiBhbiBvdXRwdXQgd2l0aCBhIGR5bmFtaWMgY29ubmVjdGlvbi5cbiAgICovXG4gIHByb3RlY3RlZCBkcmF3UmlnaHREeW5hbWljQ29ubmVjdGlvbl8oKSB7XG4gICAgaWYgKCF0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IGRyYXcgdGhlIG91dHB1dCBjb25uZWN0aW9uIG9mIGEgYmxvY2sgdGhhdCBkb2Vzbid0IGhhdmUgb25lYCk7XG4gICAgfVxuICAgIHRoaXMub3V0bGluZVBhdGhfICs9ICh0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24uc2hhcGUgYXMgRHluYW1pY1NoYXBlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGF0aFJpZ2h0RG93bih0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24uaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3RlcHMgdG8gZHJhdyB0aGUgbGVmdCBzaWRlIG9mIGFuIG91dHB1dCB3aXRoIGEgZHluYW1pYyBjb25uZWN0aW9uLlxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdMZWZ0RHluYW1pY0Nvbm5lY3Rpb25fKCkge1xuICAgIGlmICghdGhpcy5pbmZvXy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBkcmF3IHRoZSBvdXRwdXQgY29ubmVjdGlvbiBvZiBhIGJsb2NrIHRoYXQgZG9lc24ndCBoYXZlIG9uZWApO1xuICAgIH1cbiAgICB0aGlzLnBvc2l0aW9uT3V0cHV0Q29ubmVjdGlvbl8oKTtcblxuICAgIHRoaXMub3V0bGluZVBhdGhfICs9ICh0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb24uc2hhcGUgYXMgRHluYW1pY1NoYXBlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGF0aFVwKHRoaXMuaW5mb18ub3V0cHV0Q29ubmVjdGlvbi5oZWlnaHQpO1xuXG4gICAgLy8gQ2xvc2Ugb2ZmIHRoZSBwYXRoLiAgVGhpcyBkcmF3cyBhIHZlcnRpY2FsIGxpbmUgdXAgdG8gdGhlIHN0YXJ0IG9mIHRoZVxuICAgIC8vIGJsb2NrJ3MgcGF0aCwgd2hpY2ggbWF5IGJlIGVpdGhlciBhIHJvdW5kZWQgb3IgYSBzaGFycCBjb3JuZXIuXG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gJ3onO1xuICB9XG5cbiAgLyoqIEFkZCBzdGVwcyB0byBkcmF3IGEgZmxhdCB0b3Agcm93LiAqL1xuICBwcm90ZWN0ZWQgZHJhd0ZsYXRUb3BfKCkge1xuICAgIGNvbnN0IHRvcFJvdyA9IHRoaXMuaW5mb18udG9wUm93O1xuICAgIHRoaXMucG9zaXRpb25QcmV2aW91c0Nvbm5lY3Rpb25fKCk7XG5cbiAgICB0aGlzLm91dGxpbmVQYXRoXyArPSBzdmdQYXRocy5tb3ZlQnkodG9wUm93LnhQb3MsIHRoaXMuaW5mb18uc3RhcnRZKTtcblxuICAgIHRoaXMub3V0bGluZVBhdGhfICs9IHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ2gnLCB0b3BSb3cud2lkdGgpO1xuICB9XG5cbiAgLyoqIEFkZCBzdGVwcyB0byBkcmF3IGEgZmxhdCBib3R0b20gcm93LiAqL1xuICBwcm90ZWN0ZWQgZHJhd0ZsYXRCb3R0b21fKCkge1xuICAgIGNvbnN0IGJvdHRvbVJvdyA9IHRoaXMuaW5mb18uYm90dG9tUm93O1xuICAgIHRoaXMucG9zaXRpb25OZXh0Q29ubmVjdGlvbl8oKTtcblxuICAgIHRoaXMub3V0bGluZVBhdGhfICs9IHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ1YnLCBib3R0b21Sb3cuYmFzZWxpbmUpO1xuXG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gc3ZnUGF0aHMubGluZU9uQXhpcygnaCcsIC1ib3R0b21Sb3cud2lkdGgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZHJhd0lubGluZUlucHV0XyhpbnB1dDogSW5saW5lSW5wdXQpIHtcbiAgICB0aGlzLnBvc2l0aW9uSW5saW5lSW5wdXRDb25uZWN0aW9uXyhpbnB1dCk7XG5cbiAgICBjb25zdCBpbnB1dE5hbWUgPSBpbnB1dC5pbnB1dC5uYW1lO1xuICAgIGlmIChpbnB1dC5jb25uZWN0ZWRCbG9jayB8fCB0aGlzLmluZm9fLmlzSW5zZXJ0aW9uTWFya2VyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgd2lkdGggPSBpbnB1dC53aWR0aCAtIGlucHV0LmNvbm5lY3Rpb25XaWR0aCAqIDI7XG4gICAgY29uc3QgaGVpZ2h0ID0gaW5wdXQuaGVpZ2h0O1xuICAgIGNvbnN0IHlQb3MgPSBpbnB1dC5jZW50ZXJsaW5lIC0gaGVpZ2h0IC8gMjtcblxuICAgIGNvbnN0IGNvbm5lY3Rpb25SaWdodCA9IGlucHV0LnhQb3MgKyBpbnB1dC5jb25uZWN0aW9uV2lkdGg7XG5cbiAgICBjb25zdCBvdXRsaW5lUGF0aCA9IHN2Z1BhdGhzLm1vdmVUbyhjb25uZWN0aW9uUmlnaHQsIHlQb3MpICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnaCcsIHdpZHRoKSArXG4gICAgICAgIChpbnB1dC5zaGFwZSBhcyBEeW5hbWljU2hhcGUpLnBhdGhSaWdodERvd24oaW5wdXQuaGVpZ2h0KSArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ2gnLCAtd2lkdGgpICtcbiAgICAgICAgKGlucHV0LnNoYXBlIGFzIER5bmFtaWNTaGFwZSkucGF0aFVwKGlucHV0LmhlaWdodCkgKyAneic7XG4gICAgY29uc3QgcGF0aE9iamVjdCA9IHRoaXMuYmxvY2tfLnBhdGhPYmplY3QgYXMgUGF0aE9iamVjdDtcbiAgICBwYXRoT2JqZWN0LnNldE91dGxpbmVQYXRoKGlucHV0TmFtZSwgb3V0bGluZVBhdGgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZHJhd1N0YXRlbWVudElucHV0Xyhyb3c6IFJvdykge1xuICAgIGNvbnN0IGlucHV0ID0gcm93LmdldExhc3RJbnB1dCgpIGFzIFN0YXRlbWVudElucHV0O1xuICAgIC8vIFdoZXJlIHRvIHN0YXJ0IGRyYXdpbmcgdGhlIG5vdGNoLCB3aGljaCBpcyBvbiB0aGUgcmlnaHQgc2lkZSBpbiBMVFIuXG4gICAgY29uc3QgeCA9IGlucHV0LnhQb3MgKyBpbnB1dC5ub3RjaE9mZnNldCArIChpbnB1dC5zaGFwZSBhcyBCYXNlU2hhcGUpLndpZHRoO1xuXG4gICAgY29uc3QgaW5uZXJUb3BMZWZ0Q29ybmVyID0gKGlucHV0LnNoYXBlIGFzIE5vdGNoKS5wYXRoUmlnaHQgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKFxuICAgICAgICAgICAgJ2gnLCAtKGlucHV0Lm5vdGNoT2Zmc2V0IC0gdGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTLndpZHRoKSkgK1xuICAgICAgICB0aGlzLmNvbnN0YW50c18uSU5TSURFX0NPUk5FUlMucGF0aFRvcDtcblxuICAgIGNvbnN0IGlubmVySGVpZ2h0ID0gcm93LmhlaWdodCAtIDIgKiB0aGlzLmNvbnN0YW50c18uSU5TSURFX0NPUk5FUlMuaGVpZ2h0O1xuXG4gICAgY29uc3QgaW5uZXJCb3R0b21MZWZ0Q29ybmVyID0gdGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTLnBhdGhCb3R0b20gK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKFxuICAgICAgICAgICAgJ2gnLCBpbnB1dC5ub3RjaE9mZnNldCAtIHRoaXMuY29uc3RhbnRzXy5JTlNJREVfQ09STkVSUy53aWR0aCkgK1xuICAgICAgICAoaW5wdXQuY29ubmVjdGVkQm90dG9tTmV4dENvbm5lY3Rpb24gPyAnJyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnB1dC5zaGFwZSBhcyBOb3RjaCkucGF0aExlZnQpO1xuXG4gICAgdGhpcy5vdXRsaW5lUGF0aF8gKz0gc3ZnUGF0aHMubGluZU9uQXhpcygnSCcsIHgpICsgaW5uZXJUb3BMZWZ0Q29ybmVyICtcbiAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygndicsIGlubmVySGVpZ2h0KSArIGlubmVyQm90dG9tTGVmdENvcm5lciArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ0gnLCByb3cueFBvcyArIHJvdy53aWR0aCk7XG5cbiAgICB0aGlzLnBvc2l0aW9uU3RhdGVtZW50SW5wdXRDb25uZWN0aW9uXyhyb3cpO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogSW1hZ2UgZmllbGQuICBVc2VkIGZvciBwaWN0dXJlcywgaWNvbnMsIGV0Yy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GaWVsZEltYWdlJyk7XG5cbmltcG9ydCB7RmllbGQsIEZpZWxkQ29uZmlnfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCAqIGFzIGZpZWxkUmVnaXN0cnkgZnJvbSAnLi9maWVsZF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0ICogYXMgcGFyc2luZyBmcm9tICcuL3V0aWxzL3BhcnNpbmcuanMnO1xuaW1wb3J0IHR5cGUge1NlbnRpbmVsfSBmcm9tICcuL3V0aWxzL3NlbnRpbmVsLmpzJztcbmltcG9ydCB7U2l6ZX0gZnJvbSAnLi91dGlscy9zaXplLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGFuIGltYWdlIG9uIGEgYmxvY2suXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmllbGRJbWFnZVxuICovXG5leHBvcnQgY2xhc3MgRmllbGRJbWFnZSBleHRlbmRzIEZpZWxkPHN0cmluZz4ge1xuICAvKipcbiAgICogVmVydGljYWwgcGFkZGluZyBiZWxvdyB0aGUgaW1hZ2UsIHdoaWNoIGlzIGluY2x1ZGVkIGluIHRoZSByZXBvcnRlZCBoZWlnaHRcbiAgICogb2YgdGhlIGZpZWxkLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgWV9QQURESU5HID0gMTtcbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHNpemVfOiBTaXplO1xuICBwcml2YXRlIHJlYWRvbmx5IGltYWdlSGVpZ2h0XzogbnVtYmVyO1xuXG4gIC8qKiBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhpcyBmaWVsZCBpcyBjbGlja2VkLiAqL1xuICBwcml2YXRlIGNsaWNrSGFuZGxlcl86ICgocDE6IEZpZWxkSW1hZ2UpID0+IEFueUR1cmluZ01pZ3JhdGlvbil8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSByZW5kZXJlZCBmaWVsZCdzIGltYWdlIGVsZW1lbnQuICovXG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAvLyAnU1ZHSW1hZ2VFbGVtZW50Jy5cbiAgcHJpdmF0ZSBpbWFnZUVsZW1lbnRfOiBTVkdJbWFnZUVsZW1lbnQgPSBudWxsIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcblxuICAvKipcbiAgICogRWRpdGFibGUgZmllbGRzIHVzdWFsbHkgc2hvdyBzb21lIHNvcnQgb2YgVUkgaW5kaWNhdGluZyB0aGV5IGFyZVxuICAgKiBlZGl0YWJsZS4gVGhpcyBmaWVsZCBzaG91bGQgbm90LlxuICAgKi9cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgRURJVEFCTEUgPSBmYWxzZTtcblxuICAvKipcbiAgICogVXNlZCB0byB0ZWxsIGlmIHRoZSBmaWVsZCBuZWVkcyB0byBiZSByZW5kZXJlZCB0aGUgbmV4dCB0aW1lIHRoZSBibG9jayBpc1xuICAgKiByZW5kZXJlZC4gSW1hZ2UgZmllbGRzIGFyZSBzdGF0aWNhbGx5IHNpemVkLCBhbmQgb25seSBuZWVkIHRvIGJlXG4gICAqIHJlbmRlcmVkIGF0IGluaXRpYWxpemF0aW9uLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGlzRGlydHlfID0gZmFsc2U7XG5cbiAgLyoqIFdoZXRoZXIgdG8gZmxpcCB0aGlzIGltYWdlIGluIFJUTC4gKi9cbiAgcHJpdmF0ZSBmbGlwUnRsXyA9IGZhbHNlO1xuXG4gIC8qKiBBbHQgdGV4dCBvZiB0aGlzIGltYWdlLiAqL1xuICBwcml2YXRlIGFsdFRleHRfID0gJyc7XG4gIG92ZXJyaWRlIHZhbHVlXzogQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gc3JjIFRoZSBVUkwgb2YgdGhlIGltYWdlLlxuICAgKiAgICAgQWxzbyBhY2NlcHRzIEZpZWxkLlNLSVBfU0VUVVAgaWYgeW91IHdpc2ggdG8gc2tpcCBzZXR1cCAob25seSB1c2VkIGJ5XG4gICAqIHN1YmNsYXNzZXMgdGhhdCB3YW50IHRvIGhhbmRsZSBjb25maWd1cmF0aW9uIGFuZCBzZXR0aW5nIHRoZSBmaWVsZCB2YWx1ZVxuICAgKiBhZnRlciB0aGVpciBvd24gY29uc3RydWN0b3JzIGhhdmUgcnVuKS5cbiAgICogQHBhcmFtIHdpZHRoIFdpZHRoIG9mIHRoZSBpbWFnZS5cbiAgICogQHBhcmFtIGhlaWdodCBIZWlnaHQgb2YgdGhlIGltYWdlLlxuICAgKiBAcGFyYW0gb3B0X2FsdCBPcHRpb25hbCBhbHQgdGV4dCBmb3Igd2hlbiBibG9jayBpcyBjb2xsYXBzZWQuXG4gICAqIEBwYXJhbSBvcHRfb25DbGljayBPcHRpb25hbCBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiB0aGUgaW1hZ2UgaXNcbiAgICogICAgIGNsaWNrZWQuIElmIG9wdF9vbkNsaWNrIGlzIGRlZmluZWQsIG9wdF9hbHQgbXVzdCBhbHNvIGJlIGRlZmluZWQuXG4gICAqIEBwYXJhbSBvcHRfZmxpcFJ0bCBXaGV0aGVyIHRvIGZsaXAgdGhlIGljb24gaW4gUlRMLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvaW1hZ2UjY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgc3JjOiBzdHJpbmd8U2VudGluZWwsIHdpZHRoOiBzdHJpbmd8bnVtYmVyLCBoZWlnaHQ6IHN0cmluZ3xudW1iZXIsXG4gICAgICBvcHRfYWx0Pzogc3RyaW5nLCBvcHRfb25DbGljaz86IChwMTogRmllbGRJbWFnZSkgPT4gQW55RHVyaW5nTWlncmF0aW9uLFxuICAgICAgb3B0X2ZsaXBSdGw/OiBib29sZWFuLCBvcHRfY29uZmlnPzogRmllbGRJbWFnZUNvbmZpZykge1xuICAgIHN1cGVyKEZpZWxkLlNLSVBfU0VUVVApO1xuXG4gICAgY29uc3QgaW1hZ2VIZWlnaHQgPSBOdW1iZXIocGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMoaGVpZ2h0KSk7XG4gICAgY29uc3QgaW1hZ2VXaWR0aCA9IE51bWJlcihwYXJzaW5nLnJlcGxhY2VNZXNzYWdlUmVmZXJlbmNlcyh3aWR0aCkpO1xuICAgIGlmIChpc05hTihpbWFnZUhlaWdodCkgfHwgaXNOYU4oaW1hZ2VXaWR0aCkpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdIZWlnaHQgYW5kIHdpZHRoIHZhbHVlcyBvZiBhbiBpbWFnZSBmaWVsZCBtdXN0IGNhc3QgdG8nICtcbiAgICAgICAgICAnIG51bWJlcnMuJyk7XG4gICAgfVxuICAgIGlmIChpbWFnZUhlaWdodCA8PSAwIHx8IGltYWdlV2lkdGggPD0gMCkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgJ0hlaWdodCBhbmQgd2lkdGggdmFsdWVzIG9mIGFuIGltYWdlIGZpZWxkIG11c3QgYmUgZ3JlYXRlcicgK1xuICAgICAgICAgICcgdGhhbiAwLicpO1xuICAgIH1cblxuICAgIC8qKiBUaGUgc2l6ZSBvZiB0aGUgYXJlYSByZW5kZXJlZCBieSB0aGUgZmllbGQuICovXG4gICAgdGhpcy5zaXplXyA9IG5ldyBTaXplKGltYWdlV2lkdGgsIGltYWdlSGVpZ2h0ICsgRmllbGRJbWFnZS5ZX1BBRERJTkcpO1xuXG4gICAgLyoqXG4gICAgICogU3RvcmUgdGhlIGltYWdlIGhlaWdodCwgc2luY2UgaXQgaXMgZGlmZmVyZW50IGZyb20gdGhlIGZpZWxkIGhlaWdodC5cbiAgICAgKi9cbiAgICB0aGlzLmltYWdlSGVpZ2h0XyA9IGltYWdlSGVpZ2h0O1xuXG4gICAgaWYgKHR5cGVvZiBvcHRfb25DbGljayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpcy5jbGlja0hhbmRsZXJfID0gb3B0X29uQ2xpY2s7XG4gICAgfVxuXG4gICAgaWYgKHNyYyA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChvcHRfY29uZmlnKSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyZV8ob3B0X2NvbmZpZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmxpcFJ0bF8gPSAhIW9wdF9mbGlwUnRsO1xuICAgICAgdGhpcy5hbHRUZXh0XyA9IHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKG9wdF9hbHQpIHx8ICcnO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKHNyYykpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyZSB0aGUgZmllbGQgYmFzZWQgb24gdGhlIGdpdmVuIG1hcCBvZiBvcHRpb25zLlxuICAgKlxuICAgKiBAcGFyYW0gY29uZmlnIEEgbWFwIG9mIG9wdGlvbnMgdG8gY29uZmlndXJlIHRoZSBmaWVsZCBiYXNlZCBvbi5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBjb25maWd1cmVfKGNvbmZpZzogRmllbGRJbWFnZUNvbmZpZykge1xuICAgIHN1cGVyLmNvbmZpZ3VyZV8oY29uZmlnKTtcbiAgICBpZiAoY29uZmlnLmZsaXBSdGwpIHRoaXMuZmxpcFJ0bF8gPSBjb25maWcuZmxpcFJ0bDtcbiAgICBpZiAoY29uZmlnLmFsdCkge1xuICAgICAgdGhpcy5hbHRUZXh0XyA9IHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKGNvbmZpZy5hbHQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIGJsb2NrIFVJIGZvciB0aGlzIGltYWdlLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGluaXRWaWV3KCkge1xuICAgIHRoaXMuaW1hZ2VFbGVtZW50XyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuSU1BR0UsIHtcbiAgICAgICAgICAnaGVpZ2h0JzogdGhpcy5pbWFnZUhlaWdodF8gKyAncHgnLFxuICAgICAgICAgICd3aWR0aCc6IHRoaXMuc2l6ZV8ud2lkdGggKyAncHgnLFxuICAgICAgICAgICdhbHQnOiB0aGlzLmFsdFRleHRfLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmZpZWxkR3JvdXBfKTtcbiAgICB0aGlzLmltYWdlRWxlbWVudF8uc2V0QXR0cmlidXRlTlMoXG4gICAgICAgIGRvbS5YTElOS19OUywgJ3hsaW5rOmhyZWYnLCB0aGlzLnZhbHVlXyBhcyBzdHJpbmcpO1xuXG4gICAgaWYgKHRoaXMuY2xpY2tIYW5kbGVyXykge1xuICAgICAgdGhpcy5pbWFnZUVsZW1lbnRfLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJztcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSB1cGRhdGVTaXplXygpIHt9XG4gIC8vIE5PUFxuXG4gIC8qKlxuICAgKiBFbnN1cmUgdGhhdCB0aGUgaW5wdXQgdmFsdWUgKHRoZSBzb3VyY2UgVVJMKSBpcyBhIHN0cmluZy5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9uZXdWYWx1ZSBUaGUgaW5wdXQgdmFsdWUuXG4gICAqIEByZXR1cm5zIEEgc3RyaW5nLCBvciBudWxsIGlmIGludmFsaWQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZG9DbGFzc1ZhbGlkYXRpb25fKG9wdF9uZXdWYWx1ZT86IEFueUR1cmluZ01pZ3JhdGlvbik6XG4gICAgICBzdHJpbmd8bnVsbCB7XG4gICAgaWYgKHR5cGVvZiBvcHRfbmV3VmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIG9wdF9uZXdWYWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoaXMgaW1hZ2UgZmllbGQsIGFuZCB1cGRhdGUgdGhlIGRpc3BsYXllZCBpbWFnZS5cbiAgICpcbiAgICogQHBhcmFtIG5ld1ZhbHVlIFRoZSB2YWx1ZSB0byBiZSBzYXZlZC4gVGhlIGRlZmF1bHQgdmFsaWRhdG9yIGd1YXJhbnRlZXNcbiAgICogICAgIHRoYXQgdGhpcyBpcyBhIHN0cmluZy5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBkb1ZhbHVlVXBkYXRlXyhuZXdWYWx1ZTogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgdGhpcy52YWx1ZV8gPSBuZXdWYWx1ZTtcbiAgICBpZiAodGhpcy5pbWFnZUVsZW1lbnRfKSB7XG4gICAgICB0aGlzLmltYWdlRWxlbWVudF8uc2V0QXR0cmlidXRlTlMoXG4gICAgICAgICAgZG9tLlhMSU5LX05TLCAneGxpbms6aHJlZicsIFN0cmluZyh0aGlzLnZhbHVlXykpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgd2hldGhlciB0byBmbGlwIHRoaXMgaW1hZ2UgaW4gUlRMXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgd2Ugc2hvdWxkIGZsaXAgaW4gUlRMLlxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0RmxpcFJ0bCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5mbGlwUnRsXztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGFsdCB0ZXh0IG9mIHRoaXMgaW1hZ2UuXG4gICAqXG4gICAqIEBwYXJhbSBhbHQgTmV3IGFsdCB0ZXh0LlxuICAgKi9cbiAgc2V0QWx0KGFsdDogc3RyaW5nfG51bGwpIHtcbiAgICBpZiAoYWx0ID09PSB0aGlzLmFsdFRleHRfKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuYWx0VGV4dF8gPSBhbHQgfHwgJyc7XG4gICAgaWYgKHRoaXMuaW1hZ2VFbGVtZW50Xykge1xuICAgICAgdGhpcy5pbWFnZUVsZW1lbnRfLnNldEF0dHJpYnV0ZSgnYWx0JywgdGhpcy5hbHRUZXh0Xyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIElmIGZpZWxkIGNsaWNrIGlzIGNhbGxlZCwgYW5kIGNsaWNrIGhhbmRsZXIgZGVmaW5lZCxcbiAgICogY2FsbCB0aGUgaGFuZGxlci5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBzaG93RWRpdG9yXygpIHtcbiAgICBpZiAodGhpcy5jbGlja0hhbmRsZXJfKSB7XG4gICAgICB0aGlzLmNsaWNrSGFuZGxlcl8odGhpcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGlzIGltYWdlICBpcyBjbGlja2VkLlxuICAgKlxuICAgKiBAcGFyYW0gZnVuYyBUaGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGUgaW1hZ2UgaXMgY2xpY2tlZCwgb3IgbnVsbFxuICAgKiAgICAgdG8gcmVtb3ZlLlxuICAgKi9cbiAgc2V0T25DbGlja0hhbmRsZXIoZnVuYzogKChwMTogRmllbGRJbWFnZSkgPT4gQW55RHVyaW5nTWlncmF0aW9uKXxudWxsKSB7XG4gICAgdGhpcy5jbGlja0hhbmRsZXJfID0gZnVuYztcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2UgdGhlIGBnZXRUZXh0X2AgZGV2ZWxvcGVyIGhvb2sgdG8gb3ZlcnJpZGUgdGhlIGZpZWxkJ3MgdGV4dFxuICAgKiByZXByZXNlbnRhdGlvbi5cbiAgICogUmV0dXJuIHRoZSBpbWFnZSBhbHQgdGV4dCBpbnN0ZWFkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgaW1hZ2UgYWx0IHRleHQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZ2V0VGV4dF8oKTogc3RyaW5nfG51bGwge1xuICAgIHJldHVybiB0aGlzLmFsdFRleHRfO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdCBhIEZpZWxkSW1hZ2UgZnJvbSBhIEpTT04gYXJnIG9iamVjdCxcbiAgICogZGVyZWZlcmVuY2luZyBhbnkgc3RyaW5nIHRhYmxlIHJlZmVyZW5jZXMuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIEEgSlNPTiBvYmplY3Qgd2l0aCBvcHRpb25zIChzcmMsIHdpZHRoLCBoZWlnaHQsIGFsdCwgYW5kXG4gICAqICAgICBmbGlwUnRsKS5cbiAgICogQHJldHVybnMgVGhlIG5ldyBmaWVsZCBpbnN0YW5jZS5cbiAgICogQG5vY29sbGFwc2VcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24ob3B0aW9uczogRmllbGRJbWFnZUZyb21Kc29uQ29uZmlnKTogRmllbGRJbWFnZSB7XG4gICAgaWYgKCFvcHRpb25zLnNyYyB8fCAhb3B0aW9ucy53aWR0aCB8fCAhb3B0aW9ucy5oZWlnaHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnc3JjLCB3aWR0aCwgYW5kIGhlaWdodCB2YWx1ZXMgZm9yIGFuIGltYWdlIGZpZWxkIGFyZScgK1xuICAgICAgICAgICdyZXF1aXJlZC4gVGhlIHdpZHRoIGFuZCBoZWlnaHQgbXVzdCBiZSBub24temVyby4nKTtcbiAgICB9XG4gICAgLy8gYHRoaXNgIG1pZ2h0IGJlIGEgc3ViY2xhc3Mgb2YgRmllbGRJbWFnZSBpZiB0aGF0IGNsYXNzIGRvZXNuJ3Qgb3ZlcnJpZGVcbiAgICAvLyB0aGUgc3RhdGljIGZyb21Kc29uIG1ldGhvZC5cbiAgICByZXR1cm4gbmV3IHRoaXMoXG4gICAgICAgIG9wdGlvbnMuc3JjLCBvcHRpb25zLndpZHRoLCBvcHRpb25zLmhlaWdodCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsXG4gICAgICAgIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gIH1cbn1cblxuZmllbGRSZWdpc3RyeS5yZWdpc3RlcignZmllbGRfaW1hZ2UnLCBGaWVsZEltYWdlKTtcblxuRmllbGRJbWFnZS5wcm90b3R5cGUuREVGQVVMVF9WQUxVRSA9ICcnO1xuXG4vKipcbiAqIENvbmZpZyBvcHRpb25zIGZvciB0aGUgaW1hZ2UgZmllbGQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGRJbWFnZUNvbmZpZyBleHRlbmRzIEZpZWxkQ29uZmlnIHtcbiAgZmxpcFJ0bD86IGJvb2xlYW47XG4gIGFsdD86IHN0cmluZztcbn1cblxuLyoqXG4gKiBmcm9tSnNvbiBjb25maWcgb3B0aW9ucyBmb3IgdGhlIGNvbG91ciBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZEltYWdlRnJvbUpzb25Db25maWcgZXh0ZW5kcyBGaWVsZEltYWdlQ29uZmlnIHtcbiAgc3JjPzogc3RyaW5nO1xuICB3aWR0aD86IG51bWJlcjtcbiAgaGVpZ2h0PzogbnVtYmVyO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRleHQgaW5wdXQgZmllbGQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRmllbGRJbnB1dCcpO1xuXG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19jaGFuZ2UuanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBkaWFsb2cgZnJvbSAnLi9kaWFsb2cuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCAqIGFzIGRyb3BEb3duRGl2IGZyb20gJy4vZHJvcGRvd25kaXYuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL2V2ZW50cy91dGlscy5qcyc7XG5pbXBvcnQge0ZpZWxkLCBGaWVsZENvbmZpZywgRmllbGRWYWxpZGF0b3IsIFVuYXR0YWNoZWRGaWVsZEVycm9yfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCB7TXNnfSBmcm9tICcuL21zZy5qcyc7XG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQge0tleUNvZGVzfSBmcm9tICcuL3V0aWxzL2tleWNvZGVzLmpzJztcbmltcG9ydCB0eXBlIHtTZW50aW5lbH0gZnJvbSAnLi91dGlscy9zZW50aW5lbC5qcyc7XG5pbXBvcnQgKiBhcyB1c2VyQWdlbnQgZnJvbSAnLi91dGlscy91c2VyYWdlbnQuanMnO1xuaW1wb3J0ICogYXMgV2lkZ2V0RGl2IGZyb20gJy4vd2lkZ2V0ZGl2LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cbmV4cG9ydCB0eXBlIElucHV0VHlwZXMgPSBzdHJpbmd8bnVtYmVyO1xuZXhwb3J0IHR5cGUgRmllbGRJbnB1dFZhbGlkYXRvcjxUIGV4dGVuZHMgSW5wdXRUeXBlcz4gPSBGaWVsZFZhbGlkYXRvcjxUPjtcblxuLyoqXG4gKiBDbGFzcyBmb3IgYW4gZWRpdGFibGUgdGV4dCBmaWVsZC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5GaWVsZElucHV0XG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBGaWVsZElucHV0PFQgZXh0ZW5kcyBJbnB1dFR5cGVzPiBleHRlbmRzIEZpZWxkPFQ+IHtcbiAgLyoqXG4gICAqIFBpeGVsIHNpemUgb2YgaW5wdXQgYm9yZGVyIHJhZGl1cy5cbiAgICogU2hvdWxkIG1hdGNoIGJsb2NrbHlUZXh0J3MgYm9yZGVyLXJhZGl1cyBpbiBDU1MuXG4gICAqL1xuICBzdGF0aWMgQk9SREVSUkFESVVTID0gNDtcblxuICAvKiogQWxsb3cgYnJvd3NlciB0byBzcGVsbGNoZWNrIHRoaXMgZmllbGQuICovXG4gIHByb3RlY3RlZCBzcGVsbGNoZWNrXyA9IHRydWU7XG5cbiAgLyoqIFRoZSBIVE1MIGlucHV0IGVsZW1lbnQuICovXG4gIHByb3RlY3RlZCBodG1sSW5wdXRfOiBIVE1MSW5wdXRFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUcnVlIGlmIHRoZSBmaWVsZCdzIHZhbHVlIGlzIGN1cnJlbnRseSBiZWluZyBlZGl0ZWQgdmlhIHRoZSBVSS4gKi9cbiAgcHJvdGVjdGVkIGlzQmVpbmdFZGl0ZWRfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRydWUgaWYgdGhlIHZhbHVlIGN1cnJlbnRseSBkaXNwbGF5ZWQgaW4gdGhlIGZpZWxkJ3MgZWRpdG9yeSBVSSBpcyB2YWxpZC5cbiAgICovXG4gIHByb3RlY3RlZCBpc1RleHRWYWxpZF8gPSBmYWxzZTtcblxuICAvKiogS2V5IGRvd24gZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbktleURvd25XcmFwcGVyXzogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKiBLZXkgaW5wdXQgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbktleUlucHV0V3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgZmllbGQgc2hvdWxkIGNvbnNpZGVyIHRoZSB3aG9sZSBwYXJlbnQgYmxvY2sgdG8gYmUgaXRzIGNsaWNrXG4gICAqIHRhcmdldC5cbiAgICovXG4gIGZ1bGxCbG9ja0NsaWNrVGFyZ2V0XzogYm9vbGVhbnxudWxsID0gZmFsc2U7XG5cbiAgLyoqIFRoZSB3b3Jrc3BhY2UgdGhhdCB0aGlzIGZpZWxkIGJlbG9uZ3MgdG8uICovXG4gIHByb3RlY3RlZCB3b3Jrc3BhY2VfOiBXb3Jrc3BhY2VTdmd8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6YWJsZSBmaWVsZHMgYXJlIHNhdmVkIGJ5IHRoZSBzZXJpYWxpemVyLCBub24tc2VyaWFsaXphYmxlIGZpZWxkc1xuICAgKiBhcmUgbm90LiBFZGl0YWJsZSBmaWVsZHMgc2hvdWxkIGFsc28gYmUgc2VyaWFsaXphYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgU0VSSUFMSVpBQkxFID0gdHJ1ZTtcblxuICAvKiogTW91c2UgY3Vyc29yIHN0eWxlIHdoZW4gb3ZlciB0aGUgaG90c3BvdCB0aGF0IGluaXRpYXRlcyB0aGUgZWRpdG9yLiAqL1xuICBvdmVycmlkZSBDVVJTT1IgPSAndGV4dCc7XG4gIG92ZXJyaWRlIGNsaWNrVGFyZ2V0XzogQW55RHVyaW5nTWlncmF0aW9uO1xuICBvdmVycmlkZSB2YWx1ZV86IEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgb3ZlcnJpZGUgaXNEaXJ0eV86IEFueUR1cmluZ01pZ3JhdGlvbjtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF92YWx1ZSBUaGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgZmllbGQuIFNob3VsZCBjYXN0IHRvIGEgc3RyaW5nLlxuICAgKiAgICAgRGVmYXVsdHMgdG8gYW4gZW1wdHkgc3RyaW5nIGlmIG51bGwgb3IgdW5kZWZpbmVkLiBBbHNvIGFjY2VwdHNcbiAgICogICAgIEZpZWxkLlNLSVBfU0VUVVAgaWYgeW91IHdpc2ggdG8gc2tpcCBzZXR1cCAob25seSB1c2VkIGJ5IHN1YmNsYXNzZXNcbiAgICogICAgIHRoYXQgd2FudCB0byBoYW5kbGUgY29uZmlndXJhdGlvbiBhbmQgc2V0dGluZyB0aGUgZmllbGQgdmFsdWUgYWZ0ZXJcbiAgICogICAgIHRoZWlyIG93biBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4pLlxuICAgKiBAcGFyYW0gb3B0X3ZhbGlkYXRvciBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRvIHZhbGlkYXRlIGNoYW5nZXMgdG8gdGhlXG4gICAqICAgICBmaWVsZCdzIHZhbHVlLiBUYWtlcyBpbiBhIHN0cmluZyAmIHJldHVybnMgYSB2YWxpZGF0ZWQgc3RyaW5nLCBvciBudWxsXG4gICAqICAgICB0byBhYm9ydCB0aGUgY2hhbmdlLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvdGV4dC1pbnB1dCNjcmVhdGlvbn1cbiAgICogZm9yIGEgbGlzdCBvZiBwcm9wZXJ0aWVzIHRoaXMgcGFyYW1ldGVyIHN1cHBvcnRzLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBvcHRfdmFsdWU/OiBzdHJpbmd8U2VudGluZWwsIG9wdF92YWxpZGF0b3I/OiBGaWVsZElucHV0VmFsaWRhdG9yPFQ+fG51bGwsXG4gICAgICBvcHRfY29uZmlnPzogRmllbGRJbnB1dENvbmZpZykge1xuICAgIHN1cGVyKEZpZWxkLlNLSVBfU0VUVVApO1xuXG4gICAgaWYgKG9wdF92YWx1ZSA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKG9wdF92YWx1ZSk7XG4gICAgaWYgKG9wdF92YWxpZGF0b3IpIHtcbiAgICAgIHRoaXMuc2V0VmFsaWRhdG9yKG9wdF92YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBvdmVycmlkZSBjb25maWd1cmVfKGNvbmZpZzogRmllbGRJbnB1dENvbmZpZykge1xuICAgIHN1cGVyLmNvbmZpZ3VyZV8oY29uZmlnKTtcbiAgICBpZiAoY29uZmlnLnNwZWxsY2hlY2sgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5zcGVsbGNoZWNrXyA9IGNvbmZpZy5zcGVsbGNoZWNrO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgb3ZlcnJpZGUgaW5pdFZpZXcoKSB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IFVuYXR0YWNoZWRGaWVsZEVycm9yKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmdldENvbnN0YW50cygpIS5GVUxMX0JMT0NLX0ZJRUxEUykge1xuICAgICAgLy8gU3RlcCBvbmU6IGZpZ3VyZSBvdXQgaWYgdGhpcyBpcyB0aGUgb25seSBmaWVsZCBvbiB0aGlzIGJsb2NrLlxuICAgICAgLy8gUmVuZGVyaW5nIGlzIHF1aXRlIGRpZmZlcmVudCBpbiB0aGF0IGNhc2UuXG4gICAgICBsZXQgbkZpZWxkcyA9IDA7XG4gICAgICBsZXQgbkNvbm5lY3Rpb25zID0gMDtcbiAgICAgIC8vIENvdW50IHRoZSBudW1iZXIgb2YgZmllbGRzLCBleGNsdWRpbmcgdGV4dCBmaWVsZHNcbiAgICAgIGZvciAobGV0IGkgPSAwLCBpbnB1dDsgaW5wdXQgPSBibG9jay5pbnB1dExpc3RbaV07IGkrKykge1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaW5wdXQuZmllbGRSb3dbal07IGorKykge1xuICAgICAgICAgIG5GaWVsZHMrKztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbikge1xuICAgICAgICAgIG5Db25uZWN0aW9ucysrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBUaGUgc3BlY2lhbCBjYXNlIGlzIHdoZW4gdGhpcyBpcyB0aGUgb25seSBub24tbGFiZWwgZmllbGQgb24gdGhlIGJsb2NrXG4gICAgICAvLyBhbmQgaXQgaGFzIGFuIG91dHB1dCBidXQgbm8gaW5wdXRzLlxuICAgICAgdGhpcy5mdWxsQmxvY2tDbGlja1RhcmdldF8gPVxuICAgICAgICAgIG5GaWVsZHMgPD0gMSAmJiBibG9jay5vdXRwdXRDb25uZWN0aW9uICYmICFuQ29ubmVjdGlvbnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZnVsbEJsb2NrQ2xpY2tUYXJnZXRfID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZnVsbEJsb2NrQ2xpY2tUYXJnZXRfKSB7XG4gICAgICB0aGlzLmNsaWNrVGFyZ2V0XyA9ICh0aGlzLnNvdXJjZUJsb2NrXyBhcyBCbG9ja1N2ZykuZ2V0U3ZnUm9vdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNyZWF0ZUJvcmRlclJlY3RfKCk7XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlVGV4dEVsZW1lbnRfKCk7XG4gIH1cblxuICAvKipcbiAgICogRW5zdXJlIHRoYXQgdGhlIGlucHV0IHZhbHVlIGNhc3RzIHRvIGEgdmFsaWQgc3RyaW5nLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIFRoZSBpbnB1dCB2YWx1ZS5cbiAgICogQHJldHVybnMgQSB2YWxpZCBzdHJpbmcsIG9yIG51bGwgaWYgaW52YWxpZC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBkb0NsYXNzVmFsaWRhdGlvbl8ob3B0X25ld1ZhbHVlPzogQW55RHVyaW5nTWlncmF0aW9uKTpcbiAgICAgIEFueUR1cmluZ01pZ3JhdGlvbiB7XG4gICAgaWYgKG9wdF9uZXdWYWx1ZSA9PT0gbnVsbCB8fCBvcHRfbmV3VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcob3B0X25ld1ZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsZWQgYnkgc2V0VmFsdWUgaWYgdGhlIHRleHQgaW5wdXQgaXMgbm90IHZhbGlkLiBJZiB0aGUgZmllbGQgaXNcbiAgICogY3VycmVudGx5IGJlaW5nIGVkaXRlZCBpdCByZXZlcnRzIHZhbHVlIG9mIHRoZSBmaWVsZCB0byB0aGUgcHJldmlvdXNcbiAgICogdmFsdWUgd2hpbGUgYWxsb3dpbmcgdGhlIGRpc3BsYXkgdGV4dCB0byBiZSBoYW5kbGVkIGJ5IHRoZSBodG1sSW5wdXRfLlxuICAgKlxuICAgKiBAcGFyYW0gX2ludmFsaWRWYWx1ZSBUaGUgaW5wdXQgdmFsdWUgdGhhdCB3YXMgZGV0ZXJtaW5lZCB0byBiZSBpbnZhbGlkLlxuICAgKiAgICBUaGlzIGlzIG5vdCB1c2VkIGJ5IHRoZSB0ZXh0IGlucHV0IGJlY2F1c2UgaXRzIGRpc3BsYXkgdmFsdWUgaXMgc3RvcmVkXG4gICAqIG9uIHRoZSBodG1sSW5wdXRfLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvVmFsdWVJbnZhbGlkXyhfaW52YWxpZFZhbHVlOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgICBpZiAodGhpcy5pc0JlaW5nRWRpdGVkXykge1xuICAgICAgdGhpcy5pc0RpcnR5XyA9IHRydWU7XG4gICAgICB0aGlzLmlzVGV4dFZhbGlkXyA9IGZhbHNlO1xuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLnZhbHVlXztcbiAgICAgIC8vIFJldmVydCB2YWx1ZSB3aGVuIHRoZSB0ZXh0IGJlY29tZXMgaW52YWxpZC5cbiAgICAgIHRoaXMudmFsdWVfID0gdGhpcy5odG1sSW5wdXRfIS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdW50eXBlZC1kZWZhdWx0LXZhbHVlJyk7XG4gICAgICBpZiAodGhpcy5zb3VyY2VCbG9ja18gJiYgZXZlbnRVdGlscy5pc0VuYWJsZWQoKSkge1xuICAgICAgICBldmVudFV0aWxzLmZpcmUobmV3IChldmVudFV0aWxzLmdldChldmVudFV0aWxzLkJMT0NLX0NIQU5HRSkpKFxuICAgICAgICAgICAgdGhpcy5zb3VyY2VCbG9ja18sICdmaWVsZCcsIHRoaXMubmFtZSB8fCBudWxsLCBvbGRWYWx1ZSxcbiAgICAgICAgICAgIHRoaXMudmFsdWVfKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCBieSBzZXRWYWx1ZSBpZiB0aGUgdGV4dCBpbnB1dCBpcyB2YWxpZC4gVXBkYXRlcyB0aGUgdmFsdWUgb2YgdGhlXG4gICAqIGZpZWxkLCBhbmQgdXBkYXRlcyB0aGUgdGV4dCBvZiB0aGUgZmllbGQgaWYgaXQgaXMgbm90IGN1cnJlbnRseSBiZWluZ1xuICAgKiBlZGl0ZWQgKGkuZS4gaGFuZGxlZCBieSB0aGUgaHRtbElucHV0XykuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdWYWx1ZSBUaGUgdmFsdWUgdG8gYmUgc2F2ZWQuIFRoZSBkZWZhdWx0IHZhbGlkYXRvciBndWFyYW50ZWVzXG4gICAqICAgICB0aGF0IHRoaXMgaXMgYSBzdHJpbmcuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZG9WYWx1ZVVwZGF0ZV8obmV3VmFsdWU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgIHRoaXMuaXNEaXJ0eV8gPSB0cnVlO1xuICAgIHRoaXMuaXNUZXh0VmFsaWRfID0gdHJ1ZTtcbiAgICB0aGlzLnZhbHVlXyA9IG5ld1ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGV4dCBmaWVsZCB0byBtYXRjaCB0aGUgY29sb3VyL3N0eWxlIG9mIHRoZSBibG9jay5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBhcHBseUNvbG91cigpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlQmxvY2tfIHx8ICF0aGlzLmdldENvbnN0YW50cygpIS5GVUxMX0JMT0NLX0ZJRUxEUykgcmV0dXJuO1xuXG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5zb3VyY2VCbG9ja18gYXMgQmxvY2tTdmc7XG5cbiAgICBpZiAodGhpcy5ib3JkZXJSZWN0Xykge1xuICAgICAgdGhpcy5ib3JkZXJSZWN0Xy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsIHNvdXJjZS5zdHlsZS5jb2xvdXJUZXJ0aWFyeSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNvdXJjZS5wYXRoT2JqZWN0LnN2Z1BhdGguc2V0QXR0cmlidXRlKFxuICAgICAgICAgICdmaWxsJywgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfQ09MT1VSKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgY29sb3VyIG9mIHRoZSBodG1sSW5wdXQgZ2l2ZW4gdGhlIGN1cnJlbnQgdmFsaWRpdHkgb2YgdGhlXG4gICAqIGZpZWxkJ3MgdmFsdWUuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgcmVuZGVyXygpIHtcbiAgICBzdXBlci5yZW5kZXJfKCk7XG4gICAgLy8gVGhpcyBsb2dpYyBpcyBkb25lIGluIHJlbmRlcl8gcmF0aGVyIHRoYW4gZG9WYWx1ZUludmFsaWRfIG9yXG4gICAgLy8gZG9WYWx1ZVVwZGF0ZV8gc28gdGhhdCB0aGUgY29kZSBpcyBtb3JlIGNlbnRyYWxpemVkLlxuICAgIGlmICh0aGlzLmlzQmVpbmdFZGl0ZWRfKSB7XG4gICAgICB0aGlzLnJlc2l6ZUVkaXRvcl8oKTtcbiAgICAgIGNvbnN0IGh0bWxJbnB1dCA9IHRoaXMuaHRtbElucHV0XyBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGlmICghdGhpcy5pc1RleHRWYWxpZF8pIHtcbiAgICAgICAgZG9tLmFkZENsYXNzKGh0bWxJbnB1dCwgJ2Jsb2NrbHlJbnZhbGlkSW5wdXQnKTtcbiAgICAgICAgYXJpYS5zZXRTdGF0ZShodG1sSW5wdXQsIGFyaWEuU3RhdGUuSU5WQUxJRCwgdHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb20ucmVtb3ZlQ2xhc3MoaHRtbElucHV0LCAnYmxvY2tseUludmFsaWRJbnB1dCcpO1xuICAgICAgICBhcmlhLnNldFN0YXRlKGh0bWxJbnB1dCwgYXJpYS5TdGF0ZS5JTlZBTElELCBmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB3aGV0aGVyIHRoaXMgZmllbGQgaXMgc3BlbGxjaGVja2VkIGJ5IHRoZSBicm93c2VyLlxuICAgKlxuICAgKiBAcGFyYW0gY2hlY2sgVHJ1ZSBpZiBjaGVja2VkLlxuICAgKi9cbiAgc2V0U3BlbGxjaGVjayhjaGVjazogYm9vbGVhbikge1xuICAgIGlmIChjaGVjayA9PT0gdGhpcy5zcGVsbGNoZWNrXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNwZWxsY2hlY2tfID0gY2hlY2s7XG4gICAgaWYgKHRoaXMuaHRtbElucHV0Xykge1xuICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdib29sZWFuJyBpcyBub3RcbiAgICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZycuXG4gICAgICB0aGlzLmh0bWxJbnB1dF8uc2V0QXR0cmlidXRlKFxuICAgICAgICAgICdzcGVsbGNoZWNrJywgdGhpcy5zcGVsbGNoZWNrXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGFuIGVkaXRvciBmb3IgdGhlIGZpZWxkLlxuICAgKiBTaG93cyB0aGUgaW5saW5lIGZyZWUtdGV4dCBlZGl0b3Igb24gdG9wIG9mIHRoZSB0ZXh0IGJ5IGRlZmF1bHQuXG4gICAqIFNob3dzIGEgcHJvbXB0IGVkaXRvciBmb3IgbW9iaWxlIGJyb3dzZXJzIGlmIHRoZSBtb2RhbElucHV0cyBvcHRpb24gaXNcbiAgICogZW5hYmxlZC5cbiAgICpcbiAgICogQHBhcmFtIF9vcHRfZSBPcHRpb25hbCBtb3VzZSBldmVudCB0aGF0IHRyaWdnZXJlZCB0aGUgZmllbGQgdG8gb3Blbiwgb3JcbiAgICogICAgIHVuZGVmaW5lZCBpZiB0cmlnZ2VyZWQgcHJvZ3JhbW1hdGljYWxseS5cbiAgICogQHBhcmFtIG9wdF9xdWlldElucHV0IFRydWUgaWYgZWRpdG9yIHNob3VsZCBiZSBjcmVhdGVkIHdpdGhvdXQgZm9jdXMuXG4gICAqICAgICBEZWZhdWx0cyB0byBmYWxzZS5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBzaG93RWRpdG9yXyhfb3B0X2U/OiBFdmVudCwgb3B0X3F1aWV0SW5wdXQ/OiBib29sZWFuKSB7XG4gICAgdGhpcy53b3Jrc3BhY2VfID0gKHRoaXMuc291cmNlQmxvY2tfIGFzIEJsb2NrU3ZnKS53b3Jrc3BhY2U7XG4gICAgY29uc3QgcXVpZXRJbnB1dCA9IG9wdF9xdWlldElucHV0IHx8IGZhbHNlO1xuICAgIGlmICghcXVpZXRJbnB1dCAmJiB0aGlzLndvcmtzcGFjZV8ub3B0aW9ucy5tb2RhbElucHV0cyAmJlxuICAgICAgICAodXNlckFnZW50Lk1PQklMRSB8fCB1c2VyQWdlbnQuQU5EUk9JRCB8fCB1c2VyQWdlbnQuSVBBRCkpIHtcbiAgICAgIHRoaXMuc2hvd1Byb21wdEVkaXRvcl8oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaG93SW5saW5lRWRpdG9yXyhxdWlldElucHV0KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFuZCBzaG93IGEgdGV4dCBpbnB1dCBlZGl0b3IgdGhhdCBpcyBhIHByb21wdCAodXN1YWxseSBhIHBvcHVwKS5cbiAgICogTW9iaWxlIGJyb3dzZXJzIG1heSBoYXZlIGlzc3VlcyB3aXRoIGluLWxpbmUgdGV4dGFyZWFzIChmb2N1cyBhbmRcbiAgICoga2V5Ym9hcmRzKS5cbiAgICovXG4gIHByaXZhdGUgc2hvd1Byb21wdEVkaXRvcl8oKSB7XG4gICAgZGlhbG9nLnByb21wdChcbiAgICAgICAgTXNnWydDSEFOR0VfVkFMVUVfVElUTEUnXSwgdGhpcy5nZXRUZXh0KCksICh0ZXh0OiBzdHJpbmd8bnVsbCkgPT4ge1xuICAgICAgICAgIC8vIFRleHQgaXMgbnVsbCBpZiB1c2VyIHByZXNzZWQgY2FuY2VsIGJ1dHRvbi5cbiAgICAgICAgICBpZiAodGV4dCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh0aGlzLmdldFZhbHVlRnJvbUVkaXRvclRleHRfKHRleHQpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbmQgc2hvdyBhIHRleHQgaW5wdXQgZWRpdG9yIHRoYXQgc2l0cyBkaXJlY3RseSBvdmVyIHRoZSB0ZXh0IGlucHV0LlxuICAgKlxuICAgKiBAcGFyYW0gcXVpZXRJbnB1dCBUcnVlIGlmIGVkaXRvciBzaG91bGQgYmUgY3JlYXRlZCB3aXRob3V0IGZvY3VzLlxuICAgKi9cbiAgcHJpdmF0ZSBzaG93SW5saW5lRWRpdG9yXyhxdWlldElucHV0OiBib29sZWFuKSB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IFVuYXR0YWNoZWRGaWVsZEVycm9yKCk7XG4gICAgfVxuICAgIFdpZGdldERpdi5zaG93KHRoaXMsIGJsb2NrLlJUTCwgdGhpcy53aWRnZXREaXNwb3NlXy5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmh0bWxJbnB1dF8gPSB0aGlzLndpZGdldENyZWF0ZV8oKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHRoaXMuaXNCZWluZ0VkaXRlZF8gPSB0cnVlO1xuXG4gICAgaWYgKCFxdWlldElucHV0KSB7XG4gICAgICAodGhpcy5odG1sSW5wdXRfIGFzIEhUTUxFbGVtZW50KS5mb2N1cyh7XG4gICAgICAgIHByZXZlbnRTY3JvbGw6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuaHRtbElucHV0Xy5zZWxlY3QoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSB0ZXh0IGlucHV0IGVkaXRvciB3aWRnZXQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHRleHQgaW5wdXQgZWRpdG9yLlxuICAgKi9cbiAgcHJvdGVjdGVkIHdpZGdldENyZWF0ZV8oKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGJsb2NrID0gdGhpcy5nZXRTb3VyY2VCbG9jaygpO1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIHRocm93IG5ldyBVbmF0dGFjaGVkRmllbGRFcnJvcigpO1xuICAgIH1cbiAgICBldmVudFV0aWxzLnNldEdyb3VwKHRydWUpO1xuICAgIGNvbnN0IGRpdiA9IFdpZGdldERpdi5nZXREaXYoKTtcblxuICAgIGNvbnN0IGNsaWNrVGFyZ2V0ID0gdGhpcy5nZXRDbGlja1RhcmdldF8oKTtcbiAgICBpZiAoIWNsaWNrVGFyZ2V0KSB0aHJvdyBuZXcgRXJyb3IoJ0EgY2xpY2sgdGFyZ2V0IGhhcyBub3QgYmVlbiBzZXQuJyk7XG4gICAgZG9tLmFkZENsYXNzKGNsaWNrVGFyZ2V0LCAnZWRpdGluZycpO1xuXG4gICAgY29uc3QgaHRtbElucHV0ID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykpO1xuICAgIGh0bWxJbnB1dC5jbGFzc05hbWUgPSAnYmxvY2tseUh0bWxJbnB1dCc7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdib29sZWFuJyBpcyBub3QgYXNzaWduYWJsZVxuICAgIC8vIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgIGh0bWxJbnB1dC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICdzcGVsbGNoZWNrJywgdGhpcy5zcGVsbGNoZWNrXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIGNvbnN0IHNjYWxlID0gdGhpcy53b3Jrc3BhY2VfIS5nZXRTY2FsZSgpO1xuICAgIGNvbnN0IGZvbnRTaXplID0gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9GT05UU0laRSAqIHNjYWxlICsgJ3B0JztcbiAgICBkaXYhLnN0eWxlLmZvbnRTaXplID0gZm9udFNpemU7XG4gICAgaHRtbElucHV0LnN0eWxlLmZvbnRTaXplID0gZm9udFNpemU7XG4gICAgbGV0IGJvcmRlclJhZGl1cyA9IEZpZWxkSW5wdXQuQk9SREVSUkFESVVTICogc2NhbGUgKyAncHgnO1xuXG4gICAgaWYgKHRoaXMuZnVsbEJsb2NrQ2xpY2tUYXJnZXRfKSB7XG4gICAgICBjb25zdCBiQm94ID0gdGhpcy5nZXRTY2FsZWRCQm94KCk7XG5cbiAgICAgIC8vIE92ZXJyaWRlIGJvcmRlciByYWRpdXMuXG4gICAgICBib3JkZXJSYWRpdXMgPSAoYkJveC5ib3R0b20gLSBiQm94LnRvcCkgLyAyICsgJ3B4JztcbiAgICAgIC8vIFB1bGwgc3Ryb2tlIGNvbG91ciBmcm9tIHRoZSBleGlzdGluZyBzaGFkb3cgYmxvY2tcbiAgICAgIGNvbnN0IHN0cm9rZUNvbG91ciA9IGJsb2NrLmdldFBhcmVudCgpID9cbiAgICAgICAgICAoYmxvY2suZ2V0UGFyZW50KCkgYXMgQmxvY2tTdmcpLnN0eWxlLmNvbG91clRlcnRpYXJ5IDpcbiAgICAgICAgICAodGhpcy5zb3VyY2VCbG9ja18gYXMgQmxvY2tTdmcpLnN0eWxlLmNvbG91clRlcnRpYXJ5O1xuICAgICAgaHRtbElucHV0LnN0eWxlLmJvcmRlciA9IDEgKiBzY2FsZSArICdweCBzb2xpZCAnICsgc3Ryb2tlQ29sb3VyO1xuICAgICAgZGl2IS5zdHlsZS5ib3JkZXJSYWRpdXMgPSBib3JkZXJSYWRpdXM7XG4gICAgICBkaXYhLnN0eWxlLnRyYW5zaXRpb24gPSAnYm94LXNoYWRvdyAwLjI1cyBlYXNlIDBzJztcbiAgICAgIGlmICh0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9URVhUSU5QVVRfQk9YX1NIQURPVykge1xuICAgICAgICBkaXYhLnN0eWxlLmJveFNoYWRvdyA9XG4gICAgICAgICAgICAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpIDAgMCAwICcgKyA0ICogc2NhbGUgKyAncHgnO1xuICAgICAgfVxuICAgIH1cbiAgICBodG1sSW5wdXQuc3R5bGUuYm9yZGVyUmFkaXVzID0gYm9yZGVyUmFkaXVzO1xuXG4gICAgZGl2IS5hcHBlbmRDaGlsZChodG1sSW5wdXQpO1xuXG4gICAgaHRtbElucHV0LnZhbHVlID0gaHRtbElucHV0LmRlZmF1bHRWYWx1ZSA9IHRoaXMuZ2V0RWRpdG9yVGV4dF8odGhpcy52YWx1ZV8pO1xuICAgIGh0bWxJbnB1dC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdW50eXBlZC1kZWZhdWx0LXZhbHVlJywgdGhpcy52YWx1ZV8pO1xuXG4gICAgdGhpcy5yZXNpemVFZGl0b3JfKCk7XG5cbiAgICB0aGlzLmJpbmRJbnB1dEV2ZW50c18oaHRtbElucHV0KTtcblxuICAgIHJldHVybiBodG1sSW5wdXQ7XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2VzIHRoZSBlZGl0b3IsIHNhdmVzIHRoZSByZXN1bHRzLCBhbmQgZGlzcG9zZXMgb2YgYW55IGV2ZW50cyBvclxuICAgKiBET00tcmVmZXJlbmNlcyBiZWxvbmdpbmcgdG8gdGhlIGVkaXRvci5cbiAgICovXG4gIHByb3RlY3RlZCB3aWRnZXREaXNwb3NlXygpIHtcbiAgICAvLyBOb24tZGlzcG9zYWwgcmVsYXRlZCB0aGluZ3MgdGhhdCB3ZSBkbyB3aGVuIHRoZSBlZGl0b3IgY2xvc2VzLlxuICAgIHRoaXMuaXNCZWluZ0VkaXRlZF8gPSBmYWxzZTtcbiAgICB0aGlzLmlzVGV4dFZhbGlkXyA9IHRydWU7XG4gICAgLy8gTWFrZSBzdXJlIHRoZSBmaWVsZCdzIG5vZGUgbWF0Y2hlcyB0aGUgZmllbGQncyBpbnRlcm5hbCB2YWx1ZS5cbiAgICB0aGlzLmZvcmNlUmVyZW5kZXIoKTtcbiAgICB0aGlzLm9uRmluaXNoRWRpdGluZ18odGhpcy52YWx1ZV8pO1xuICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAoZmFsc2UpO1xuXG4gICAgLy8gQWN0dWFsIGRpc3Bvc2FsLlxuICAgIHRoaXMudW5iaW5kSW5wdXRFdmVudHNfKCk7XG4gICAgY29uc3Qgc3R5bGUgPSBXaWRnZXREaXYuZ2V0RGl2KCkhLnN0eWxlO1xuICAgIHN0eWxlLndpZHRoID0gJ2F1dG8nO1xuICAgIHN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICBzdHlsZS5mb250U2l6ZSA9ICcnO1xuICAgIHN0eWxlLnRyYW5zaXRpb24gPSAnJztcbiAgICBzdHlsZS5ib3hTaGFkb3cgPSAnJztcbiAgICB0aGlzLmh0bWxJbnB1dF8gPSBudWxsO1xuXG4gICAgY29uc3QgY2xpY2tUYXJnZXQgPSB0aGlzLmdldENsaWNrVGFyZ2V0XygpO1xuICAgIGlmICghY2xpY2tUYXJnZXQpIHRocm93IG5ldyBFcnJvcignQSBjbGljayB0YXJnZXQgaGFzIG5vdCBiZWVuIHNldC4nKTtcbiAgICBkb20ucmVtb3ZlQ2xhc3MoY2xpY2tUYXJnZXQsICdlZGl0aW5nJyk7XG4gIH1cblxuICAvKipcbiAgICogQSBjYWxsYmFjayB0cmlnZ2VyZWQgd2hlbiB0aGUgdXNlciBpcyBkb25lIGVkaXRpbmcgdGhlIGZpZWxkIHZpYSB0aGUgVUkuXG4gICAqXG4gICAqIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyB2YWx1ZSBvZiB0aGUgZmllbGQuXG4gICAqL1xuICBvbkZpbmlzaEVkaXRpbmdfKF92YWx1ZTogQW55RHVyaW5nTWlncmF0aW9uKSB7fVxuICAvLyBOT1AgYnkgZGVmYXVsdC5cbiAgLy8gVE9ETygjMjQ5Nik6IFN1cHBvcnQgcGVvcGxlIHBhc3NpbmcgYSBmdW5jIGludG8gdGhlIGZpZWxkLlxuXG4gIC8qKlxuICAgKiBCaW5kIGhhbmRsZXJzIGZvciB1c2VyIGlucHV0IG9uIHRoZSB0ZXh0IGlucHV0IGZpZWxkJ3MgZWRpdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gaHRtbElucHV0IFRoZSBodG1sSW5wdXQgdG8gd2hpY2ggZXZlbnQgaGFuZGxlcnMgd2lsbCBiZSBib3VuZC5cbiAgICovXG4gIHByb3RlY3RlZCBiaW5kSW5wdXRFdmVudHNfKGh0bWxJbnB1dDogSFRNTEVsZW1lbnQpIHtcbiAgICAvLyBUcmFwIEVudGVyIHdpdGhvdXQgSU1FIGFuZCBFc2MgdG8gaGlkZS5cbiAgICB0aGlzLm9uS2V5RG93bldyYXBwZXJfID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIGh0bWxJbnB1dCwgJ2tleWRvd24nLCB0aGlzLCB0aGlzLm9uSHRtbElucHV0S2V5RG93bl8pO1xuICAgIC8vIFJlc2l6ZSBhZnRlciBldmVyeSBpbnB1dCBjaGFuZ2UuXG4gICAgdGhpcy5vbktleUlucHV0V3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgaHRtbElucHV0LCAnaW5wdXQnLCB0aGlzLCB0aGlzLm9uSHRtbElucHV0Q2hhbmdlXyk7XG4gIH1cblxuICAvKiogVW5iaW5kIGhhbmRsZXJzIGZvciB1c2VyIGlucHV0IGFuZCB3b3Jrc3BhY2Ugc2l6ZSBjaGFuZ2VzLiAqL1xuICBwcm90ZWN0ZWQgdW5iaW5kSW5wdXRFdmVudHNfKCkge1xuICAgIGlmICh0aGlzLm9uS2V5RG93bldyYXBwZXJfKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uS2V5RG93bldyYXBwZXJfKTtcbiAgICAgIHRoaXMub25LZXlEb3duV3JhcHBlcl8gPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5vbktleUlucHV0V3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25LZXlJbnB1dFdyYXBwZXJfKTtcbiAgICAgIHRoaXMub25LZXlJbnB1dFdyYXBwZXJfID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGtleSBkb3duIHRvIHRoZSBlZGl0b3IuXG4gICAqXG4gICAqIEBwYXJhbSBlIEtleWJvYXJkIGV2ZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIG9uSHRtbElucHV0S2V5RG93bl8oZTogRXZlbnQpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdrZXlDb2RlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJ0V2ZW50Jy5cbiAgICBpZiAoKGUgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5rZXlDb2RlID09PSBLZXlDb2Rlcy5FTlRFUikge1xuICAgICAgV2lkZ2V0RGl2LmhpZGUoKTtcbiAgICAgIGRyb3BEb3duRGl2LmhpZGVXaXRob3V0QW5pbWF0aW9uKCk7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdrZXlDb2RlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgICAvLyAnRXZlbnQnLlxuICAgIH0gZWxzZSBpZiAoKGUgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5rZXlDb2RlID09PSBLZXlDb2Rlcy5FU0MpIHtcbiAgICAgIHRoaXMuc2V0VmFsdWUoXG4gICAgICAgICAgdGhpcy5odG1sSW5wdXRfIS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdW50eXBlZC1kZWZhdWx0LXZhbHVlJykpO1xuICAgICAgV2lkZ2V0RGl2LmhpZGUoKTtcbiAgICAgIGRyb3BEb3duRGl2LmhpZGVXaXRob3V0QW5pbWF0aW9uKCk7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdrZXlDb2RlJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgICAvLyAnRXZlbnQnLlxuICAgIH0gZWxzZSBpZiAoKGUgYXMgQW55RHVyaW5nTWlncmF0aW9uKS5rZXlDb2RlID09PSBLZXlDb2Rlcy5UQUIpIHtcbiAgICAgIFdpZGdldERpdi5oaWRlKCk7XG4gICAgICBkcm9wRG93bkRpdi5oaWRlV2l0aG91dEFuaW1hdGlvbigpO1xuICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnc2hpZnRLZXknIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAgIC8vICdFdmVudCcuIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAndGhpcycgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdGaWVsZCcuXG4gICAgICAodGhpcy5zb3VyY2VCbG9ja18gYXMgQmxvY2tTdmcpXG4gICAgICAgICAgLnRhYih0aGlzIGFzIEFueUR1cmluZ01pZ3JhdGlvbiwgIShlIGFzIEFueUR1cmluZ01pZ3JhdGlvbikuc2hpZnRLZXkpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBjaGFuZ2UgdG8gdGhlIGVkaXRvci5cbiAgICpcbiAgICogQHBhcmFtIF9lIEtleWJvYXJkIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBvbkh0bWxJbnB1dENoYW5nZV8oX2U6IEV2ZW50KSB7XG4gICAgdGhpcy5zZXRWYWx1ZSh0aGlzLmdldFZhbHVlRnJvbUVkaXRvclRleHRfKHRoaXMuaHRtbElucHV0XyEudmFsdWUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIEhUTUwgaW5wdXQgdmFsdWUgYW5kIHRoZSBmaWVsZCdzIGludGVybmFsIHZhbHVlLiBUaGUgZGlmZmVyZW5jZVxuICAgKiBiZXR3ZWVuIHRoaXMgYW5kIGBzZXRWYWx1ZWAgaXMgdGhhdCB0aGlzIGFsc28gdXBkYXRlcyB0aGUgSFRNTCBpbnB1dFxuICAgKiB2YWx1ZSB3aGlsc3QgZWRpdGluZy5cbiAgICpcbiAgICogQHBhcmFtIG5ld1ZhbHVlIE5ldyB2YWx1ZS5cbiAgICovXG4gIHByb3RlY3RlZCBzZXRFZGl0b3JWYWx1ZV8obmV3VmFsdWU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgIHRoaXMuaXNEaXJ0eV8gPSB0cnVlO1xuICAgIGlmICh0aGlzLmlzQmVpbmdFZGl0ZWRfKSB7XG4gICAgICAvLyBJbiB0aGUgY2FzZSB0aGlzIG1ldGhvZCBpcyBwYXNzZWQgYW4gaW52YWxpZCB2YWx1ZSwgd2Ugc3RpbGxcbiAgICAgIC8vIHBhc3MgaXQgdGhyb3VnaCB0aGUgdHJhbnNmb3JtYXRpb24gbWV0aG9kIGBnZXRFZGl0b3JUZXh0YCB0byBkZWFsXG4gICAgICAvLyB3aXRoLiBPdGhlcndpc2UsIHRoZSBpbnRlcm5hbCBmaWVsZCdzIHN0YXRlIHdpbGwgYmUgaW5jb25zaXN0ZW50XG4gICAgICAvLyB3aXRoIHdoYXQncyBzaG93biB0byB0aGUgdXNlci5cbiAgICAgIHRoaXMuaHRtbElucHV0XyEudmFsdWUgPSB0aGlzLmdldEVkaXRvclRleHRfKG5ld1ZhbHVlKTtcbiAgICB9XG4gICAgdGhpcy5zZXRWYWx1ZShuZXdWYWx1ZSk7XG4gIH1cblxuICAvKiogUmVzaXplIHRoZSBlZGl0b3IgdG8gZml0IHRoZSB0ZXh0LiAqL1xuICBwcm90ZWN0ZWQgcmVzaXplRWRpdG9yXygpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3QgZGl2ID0gV2lkZ2V0RGl2LmdldERpdigpO1xuICAgIGNvbnN0IGJCb3ggPSB0aGlzLmdldFNjYWxlZEJCb3goKTtcbiAgICBkaXYhLnN0eWxlLndpZHRoID0gYkJveC5yaWdodCAtIGJCb3gubGVmdCArICdweCc7XG4gICAgZGl2IS5zdHlsZS5oZWlnaHQgPSBiQm94LmJvdHRvbSAtIGJCb3gudG9wICsgJ3B4JztcblxuICAgIC8vIEluIFJUTCBtb2RlIGJsb2NrIGZpZWxkcyBhbmQgTFRSIGlucHV0IGZpZWxkcyB0aGUgbGVmdCBlZGdlIG1vdmVzLFxuICAgIC8vIHdoZXJlYXMgdGhlIHJpZ2h0IGVkZ2UgaXMgZml4ZWQuICBSZXBvc2l0aW9uIHRoZSBlZGl0b3IuXG4gICAgY29uc3QgeCA9IGJsb2NrLlJUTCA/IGJCb3gucmlnaHQgLSBkaXYhLm9mZnNldFdpZHRoIDogYkJveC5sZWZ0O1xuICAgIGNvbnN0IHh5ID0gbmV3IENvb3JkaW5hdGUoeCwgYkJveC50b3ApO1xuXG4gICAgZGl2IS5zdHlsZS5sZWZ0ID0geHkueCArICdweCc7XG4gICAgZGl2IS5zdHlsZS50b3AgPSB4eS55ICsgJ3B4JztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBmaWVsZCBpcyB0YWIgbmF2aWdhYmxlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBmaWVsZCBpcyB0YWIgbmF2aWdhYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgaXNUYWJOYXZpZ2FibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVXNlIHRoZSBgZ2V0VGV4dF9gIGRldmVsb3BlciBob29rIHRvIG92ZXJyaWRlIHRoZSBmaWVsZCdzIHRleHRcbiAgICogcmVwcmVzZW50YXRpb24uIFdoZW4gd2UncmUgY3VycmVudGx5IGVkaXRpbmcsIHJldHVybiB0aGUgY3VycmVudCBIVE1MIHZhbHVlXG4gICAqIGluc3RlYWQuIE90aGVyd2lzZSwgcmV0dXJuIG51bGwgd2hpY2ggdGVsbHMgdGhlIGZpZWxkIHRvIHVzZSB0aGUgZGVmYXVsdFxuICAgKiBiZWhhdmlvdXIgKHdoaWNoIGlzIGEgc3RyaW5nIGNhc3Qgb2YgdGhlIGZpZWxkJ3MgdmFsdWUpLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgSFRNTCB2YWx1ZSBpZiB3ZSdyZSBlZGl0aW5nLCBvdGhlcndpc2UgbnVsbC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBnZXRUZXh0XygpOiBzdHJpbmd8bnVsbCB7XG4gICAgaWYgKHRoaXMuaXNCZWluZ0VkaXRlZF8gJiYgdGhpcy5odG1sSW5wdXRfKSB7XG4gICAgICAvLyBXZSBhcmUgY3VycmVudGx5IGVkaXRpbmcsIHJldHVybiB0aGUgSFRNTCBpbnB1dCB2YWx1ZSBpbnN0ZWFkLlxuICAgICAgcmV0dXJuIHRoaXMuaHRtbElucHV0Xy52YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNmb3JtIHRoZSBwcm92aWRlZCB2YWx1ZSBpbnRvIGEgdGV4dCB0byBzaG93IGluIHRoZSBIVE1MIGlucHV0LlxuICAgKiBPdmVycmlkZSB0aGlzIG1ldGhvZCBpZiB0aGUgZmllbGQncyBIVE1MIGlucHV0IHJlcHJlc2VudGF0aW9uIGlzIGRpZmZlcmVudFxuICAgKiB0aGFuIHRoZSBmaWVsZCdzIHZhbHVlLiBUaGlzIHNob3VsZCBiZSBjb3VwbGVkIHdpdGggYW4gb3ZlcnJpZGUgb2ZcbiAgICogYGdldFZhbHVlRnJvbUVkaXRvclRleHRfYC5cbiAgICpcbiAgICogQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSBzdG9yZWQgaW4gdGhpcyBmaWVsZC5cbiAgICogQHJldHVybnMgVGhlIHRleHQgdG8gc2hvdyBvbiB0aGUgSFRNTCBpbnB1dC5cbiAgICovXG4gIHByb3RlY3RlZCBnZXRFZGl0b3JUZXh0Xyh2YWx1ZTogQW55RHVyaW5nTWlncmF0aW9uKTogc3RyaW5nIHtcbiAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2Zvcm0gdGhlIHRleHQgcmVjZWl2ZWQgZnJvbSB0aGUgSFRNTCBpbnB1dCBpbnRvIGEgdmFsdWUgdG8gc3RvcmVcbiAgICogaW4gdGhpcyBmaWVsZC5cbiAgICogT3ZlcnJpZGUgdGhpcyBtZXRob2QgaWYgdGhlIGZpZWxkJ3MgSFRNTCBpbnB1dCByZXByZXNlbnRhdGlvbiBpcyBkaWZmZXJlbnRcbiAgICogdGhhbiB0aGUgZmllbGQncyB2YWx1ZS4gVGhpcyBzaG91bGQgYmUgY291cGxlZCB3aXRoIGFuIG92ZXJyaWRlIG9mXG4gICAqIGBnZXRFZGl0b3JUZXh0X2AuXG4gICAqXG4gICAqIEBwYXJhbSB0ZXh0IFRleHQgcmVjZWl2ZWQgZnJvbSB0aGUgSFRNTCBpbnB1dC5cbiAgICogQHJldHVybnMgVGhlIHZhbHVlIHRvIHN0b3JlLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldFZhbHVlRnJvbUVkaXRvclRleHRfKHRleHQ6IHN0cmluZyk6IEFueUR1cmluZ01pZ3JhdGlvbiB7XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cbn1cblxuLyoqXG4gKiBDb25maWcgb3B0aW9ucyBmb3IgdGhlIGlucHV0IGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkSW5wdXRDb25maWcgZXh0ZW5kcyBGaWVsZENvbmZpZyB7XG4gIHNwZWxsY2hlY2s/OiBib29sZWFuO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRleHQgaW5wdXQgZmllbGQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRmllbGRUZXh0SW5wdXQnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfYmxvY2tfY2hhbmdlLmpzJztcblxuaW1wb3J0IHtGaWVsZElucHV0LCBGaWVsZElucHV0Q29uZmlnLCBGaWVsZElucHV0VmFsaWRhdG9yfSBmcm9tICcuL2ZpZWxkX2lucHV0LmpzJztcbmltcG9ydCAqIGFzIGZpZWxkUmVnaXN0cnkgZnJvbSAnLi9maWVsZF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4vdXRpbHMvcGFyc2luZy5qcyc7XG5pbXBvcnQgdHlwZSB7U2VudGluZWx9IGZyb20gJy4vdXRpbHMvc2VudGluZWwuanMnO1xuXG5leHBvcnQgdHlwZSBGaWVsZFRleHRJbnB1dFZhbGlkYXRvciA9IEZpZWxkSW5wdXRWYWxpZGF0b3I8c3RyaW5nPjtcblxuZXhwb3J0IGNsYXNzIEZpZWxkVGV4dElucHV0IGV4dGVuZHMgRmllbGRJbnB1dDxzdHJpbmc+IHtcbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfdmFsdWUgVGhlIGluaXRpYWwgdmFsdWUgb2YgdGhlIGZpZWxkLiBTaG91bGQgY2FzdCB0byBhIHN0cmluZy5cbiAgICogICAgIERlZmF1bHRzIHRvIGFuIGVtcHR5IHN0cmluZyBpZiBudWxsIG9yIHVuZGVmaW5lZC4gQWxzbyBhY2NlcHRzXG4gICAqICAgICBGaWVsZC5TS0lQX1NFVFVQIGlmIHlvdSB3aXNoIHRvIHNraXAgc2V0dXAgKG9ubHkgdXNlZCBieSBzdWJjbGFzc2VzXG4gICAqICAgICB0aGF0IHdhbnQgdG8gaGFuZGxlIGNvbmZpZ3VyYXRpb24gYW5kIHNldHRpbmcgdGhlIGZpZWxkIHZhbHVlIGFmdGVyXG4gICAqICAgICB0aGVpciBvd24gY29uc3RydWN0b3JzIGhhdmUgcnVuKS5cbiAgICogQHBhcmFtIG9wdF92YWxpZGF0b3IgQSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB0byB2YWxpZGF0ZSBjaGFuZ2VzIHRvIHRoZVxuICAgKiAgICAgZmllbGQncyB2YWx1ZS4gVGFrZXMgaW4gYSBzdHJpbmcgJiByZXR1cm5zIGEgdmFsaWRhdGVkIHN0cmluZywgb3IgbnVsbFxuICAgKiAgICAgdG8gYWJvcnQgdGhlIGNoYW5nZS5cbiAgICogQHBhcmFtIG9wdF9jb25maWcgQSBtYXAgb2Ygb3B0aW9ucyB1c2VkIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQuXG4gICAqICAgICBTZWUgdGhlIFtmaWVsZCBjcmVhdGlvbiBkb2N1bWVudGF0aW9uXXtAbGlua1xuICAgKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy9maWVsZHMvYnVpbHQtaW4tZmllbGRzL3RleHQtaW5wdXQjY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X3ZhbHVlPzogc3RyaW5nfFNlbnRpbmVsLCBvcHRfdmFsaWRhdG9yPzogRmllbGRUZXh0SW5wdXRWYWxpZGF0b3J8bnVsbCxcbiAgICAgIG9wdF9jb25maWc/OiBGaWVsZElucHV0Q29uZmlnKSB7XG4gICAgc3VwZXIob3B0X3ZhbHVlLCBvcHRfdmFsaWRhdG9yLCBvcHRfY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3QgYSBGaWVsZFRleHRJbnB1dCBmcm9tIGEgSlNPTiBhcmcgb2JqZWN0LFxuICAgKiBkZXJlZmVyZW5jaW5nIGFueSBzdHJpbmcgdGFibGUgcmVmZXJlbmNlcy5cbiAgICpcbiAgICogQHBhcmFtIG9wdGlvbnMgQSBKU09OIG9iamVjdCB3aXRoIG9wdGlvbnMgKHRleHQsIGFuZCBzcGVsbGNoZWNrKS5cbiAgICogQHJldHVybnMgVGhlIG5ldyBmaWVsZCBpbnN0YW5jZS5cbiAgICogQG5vY29sbGFwc2VcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24ob3B0aW9uczogRmllbGRUZXh0SW5wdXRGcm9tSnNvbkNvbmZpZyk6IEZpZWxkVGV4dElucHV0IHtcbiAgICBjb25zdCB0ZXh0ID0gcGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMob3B0aW9ucy50ZXh0KTtcbiAgICAvLyBgdGhpc2AgbWlnaHQgYmUgYSBzdWJjbGFzcyBvZiBGaWVsZFRleHRJbnB1dCBpZiB0aGF0IGNsYXNzIGRvZXNuJ3RcbiAgICAvLyBvdmVycmlkZSB0aGUgc3RhdGljIGZyb21Kc29uIG1ldGhvZC5cbiAgICByZXR1cm4gbmV3IHRoaXModGV4dCwgdW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgfVxufVxuXG5maWVsZFJlZ2lzdHJ5LnJlZ2lzdGVyKCdmaWVsZF9pbnB1dCcsIEZpZWxkVGV4dElucHV0KTtcblxuRmllbGRUZXh0SW5wdXQucHJvdG90eXBlLkRFRkFVTFRfVkFMVUUgPSAnJztcblxuLyoqXG4gKiBmcm9tSnNvbiBjb25maWcgb3B0aW9ucyBmb3IgdGhlIHRleHQgaW5wdXQgZmllbGQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGRUZXh0SW5wdXRGcm9tSnNvbkNvbmZpZyBleHRlbmRzIEZpZWxkSW5wdXRDb25maWcge1xuICB0ZXh0Pzogc3RyaW5nO1xufVxuXG5leHBvcnQge0ZpZWxkSW5wdXRDb25maWcgYXMgRmllbGRUZXh0SW5wdXRDb25maWd9O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGJvdHRvbSByb3cgb2YgYSByZW5kZXJlZCBibG9jay5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS56ZWxvcy5Cb3R0b21Sb3cnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uLy4uLy4uL3JlbmRlcmVycy9jb21tb24vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7Qm90dG9tUm93IGFzIEJhc2VCb3R0b21Sb3d9IGZyb20gJy4uLy4uLy4uL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9ib3R0b21fcm93LmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHdoYXQgZWxlbWVudHMgYXJlIGluIHRoZSBib3R0b20gcm93IG9mXG4gKiBhIGJsb2NrIGFzIHdlbGwgYXMgc3BhY2luZyBpbmZvcm1hdGlvbiBmb3IgdGhlIHRvcCByb3cuXG4gKiBFbGVtZW50cyBpbiBhIGJvdHRvbSByb3cgY2FuIGNvbnNpc3Qgb2YgY29ybmVycywgc3BhY2VycyBhbmQgbmV4dFxuICogY29ubmVjdGlvbnMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuemVsb3MuQm90dG9tUm93XG4gKi9cbmV4cG9ydCBjbGFzcyBCb3R0b21Sb3cgZXh0ZW5kcyBCYXNlQm90dG9tUm93IHtcbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyKSB7XG4gICAgc3VwZXIoY29uc3RhbnRzKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGVuZHNXaXRoRWxlbVNwYWNlcigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKiogUmVuZGVyIGEgcm91bmQgY29ybmVyIHVubGVzcyB0aGUgYmxvY2sgaGFzIGFuIG91dHB1dCBjb25uZWN0aW9uLiAqL1xuICBvdmVycmlkZSBoYXNMZWZ0U3F1YXJlQ29ybmVyKGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIHJldHVybiAhIWJsb2NrLm91dHB1dENvbm5lY3Rpb247XG4gIH1cblxuICAvKiogUmVuZGVyIGEgcm91bmQgY29ybmVyIHVubGVzcyB0aGUgYmxvY2sgaGFzIGFuIG91dHB1dCBjb25uZWN0aW9uLiAqL1xuICBvdmVycmlkZSBoYXNSaWdodFNxdWFyZUNvcm5lcihibG9jazogQmxvY2tTdmcpIHtcbiAgICByZXR1cm4gISFibG9jay5vdXRwdXRDb25uZWN0aW9uICYmICFibG9jay5zdGF0ZW1lbnRJbnB1dENvdW50ICYmXG4gICAgICAgICFibG9jay5uZXh0Q29ubmVjdGlvbjtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFplbG9zIHNwZWNpZmljIG9iamVjdHMgcmVwcmVzZW50aW5nIGlucHV0cyB3aXRoIGNvbm5lY3Rpb25zIG9uXG4gKiBhIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnplbG9zLlN0YXRlbWVudElucHV0Jyk7XG5cbi8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycyAqL1xuaW1wb3J0IHR5cGUge0lucHV0fSBmcm9tICcuLi8uLi8uLi9pbnB1dC5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vLi4vLi4vcmVuZGVyZXJzL2NvbW1vbi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtTdGF0ZW1lbnRJbnB1dCBhcyBCYXNlU3RhdGVtZW50SW5wdXR9IGZyb20gJy4uLy4uLy4uL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9zdGF0ZW1lbnRfaW5wdXQuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGEgc3RhdGVtZW50IGlucHV0IHRha2VzIHVwXG4gKiBkdXJpbmcgcmVuZGVyaW5nLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnplbG9zLlN0YXRlbWVudElucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBTdGF0ZW1lbnRJbnB1dCBleHRlbmRzIEJhc2VTdGF0ZW1lbnRJbnB1dCB7XG4gIGNvbm5lY3RlZEJvdHRvbU5leHRDb25uZWN0aW9uID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBwYXJhbSBpbnB1dCBUaGUgc3RhdGVtZW50IGlucHV0IHRvIG1lYXN1cmUgYW5kIHN0b3JlIGluZm9ybWF0aW9uIGZvci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIsIGlucHV0OiBJbnB1dCkge1xuICAgIHN1cGVyKGNvbnN0YW50cywgaW5wdXQpO1xuXG4gICAgaWYgKHRoaXMuY29ubmVjdGVkQmxvY2spIHtcbiAgICAgIC8vIEZpbmQgdGhlIGJvdHRvbS1tb3N0IGNvbm5lY3RlZCBibG9jayBpbiB0aGUgc3RhY2suXG4gICAgICBsZXQgYmxvY2sgPSB0aGlzLmNvbm5lY3RlZEJsb2NrO1xuICAgICAgbGV0IG5leHRCbG9jaztcbiAgICAgIHdoaWxlIChuZXh0QmxvY2sgPSBibG9jay5nZXROZXh0QmxvY2soKSkge1xuICAgICAgICBibG9jayA9IG5leHRCbG9jaztcbiAgICAgIH1cbiAgICAgIGlmICghYmxvY2submV4dENvbm5lY3Rpb24pIHtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLmNvbm5lY3RlZEJsb2NrSGVpZ2h0O1xuICAgICAgICB0aGlzLmNvbm5lY3RlZEJvdHRvbU5leHRDb25uZWN0aW9uID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBaZWxvcyBzcGVjaWZpYyBvYmplY3RzIHJlcHJlc2VudGluZyBlbGVtZW50cyBpbiBhIHJvdyBvZiBhXG4gKiByZW5kZXJlZCBibG9jay5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS56ZWxvcy5SaWdodENvbm5lY3Rpb25TaGFwZScpO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vLi4vLi4vcmVuZGVyZXJzL2NvbW1vbi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtNZWFzdXJhYmxlfSBmcm9tICcuLi8uLi8uLi9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvYmFzZS5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuLi8uLi8uLi9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvdHlwZXMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGEgcmlnaHQgY29ubmVjdGlvbiBzaGFwZVxuICogdGFrZXMgdXAgZHVyaW5nIHJlbmRlcmluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS56ZWxvcy5SaWdodENvbm5lY3Rpb25TaGFwZVxuICovXG5leHBvcnQgY2xhc3MgUmlnaHRDb25uZWN0aW9uU2hhcGUgZXh0ZW5kcyBNZWFzdXJhYmxlIHtcbiAgLy8gU2l6ZSBpcyBkeW5hbWljXG4gIG92ZXJyaWRlIGhlaWdodCA9IDA7XG4gIG92ZXJyaWRlIHdpZHRoID0gMDtcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIpIHtcbiAgICBzdXBlcihjb25zdGFudHMpO1xuICAgIHRoaXMudHlwZSB8PSBUeXBlcy5nZXRUeXBlKCdSSUdIVF9DT05ORUNUSU9OJyk7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB0b3Agcm93IG9mIGEgcmVuZGVyZWQgYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuemVsb3MuVG9wUm93Jyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi8uLi8uLi9yZW5kZXJlcnMvY29tbW9uL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQge1RvcFJvdyBhcyBCYXNlVG9wUm93fSBmcm9tICcuLi8uLi8uLi9yZW5kZXJlcnMvbWVhc3VyYWJsZXMvdG9wX3Jvdy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB3aGF0IGVsZW1lbnRzIGFyZSBpbiB0aGUgdG9wIHJvdyBvZiBhXG4gKiBibG9jayBhcyB3ZWxsIGFzIHNpemluZyBpbmZvcm1hdGlvbiBmb3IgdGhlIHRvcCByb3cuXG4gKiBFbGVtZW50cyBpbiBhIHRvcCByb3cgY2FuIGNvbnNpc3Qgb2YgY29ybmVycywgaGF0cywgc3BhY2VycywgYW5kIHByZXZpb3VzXG4gKiBjb25uZWN0aW9ucy5cbiAqIEFmdGVyIHRoaXMgY29uc3RydWN0b3IgaXMgY2FsbGVkLCB0aGUgcm93IHdpbGwgY29udGFpbiBhbGwgbm9uLXNwYWNlclxuICogZWxlbWVudHMgaXQgbmVlZHMuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuemVsb3MuVG9wUm93XG4gKi9cbmV4cG9ydCBjbGFzcyBUb3BSb3cgZXh0ZW5kcyBCYXNlVG9wUm93IHtcbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyKSB7XG4gICAgc3VwZXIoY29uc3RhbnRzKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGVuZHNXaXRoRWxlbVNwYWNlcigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKiogUmVuZGVyIGEgcm91bmQgY29ybmVyIHVubGVzcyB0aGUgYmxvY2sgaGFzIGFuIG91dHB1dCBjb25uZWN0aW9uLiAqL1xuICBvdmVycmlkZSBoYXNMZWZ0U3F1YXJlQ29ybmVyKGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIGNvbnN0IGhhc0hhdCA9XG4gICAgICAgIChibG9jay5oYXQgPyBibG9jay5oYXQgPT09ICdjYXAnIDogdGhpcy5jb25zdGFudHNfLkFERF9TVEFSVF9IQVRTKSAmJlxuICAgICAgICAhYmxvY2sub3V0cHV0Q29ubmVjdGlvbiAmJiAhYmxvY2sucHJldmlvdXNDb25uZWN0aW9uO1xuICAgIHJldHVybiAhIWJsb2NrLm91dHB1dENvbm5lY3Rpb24gfHwgaGFzSGF0O1xuICB9XG5cbiAgLyoqIFJlbmRlciBhIHJvdW5kIGNvcm5lciB1bmxlc3MgdGhlIGJsb2NrIGhhcyBhbiBvdXRwdXQgY29ubmVjdGlvbi4gKi9cbiAgb3ZlcnJpZGUgaGFzUmlnaHRTcXVhcmVDb3JuZXIoYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgcmV0dXJuICEhYmxvY2sub3V0cHV0Q29ubmVjdGlvbiAmJiAhYmxvY2suc3RhdGVtZW50SW5wdXRDb3VudCAmJlxuICAgICAgICAhYmxvY2submV4dENvbm5lY3Rpb247XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBNYWtlY29kZS9zY3JhdGNoLXN0eWxlIHJlbmRlcmVyLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnplbG9zLlJlbmRlckluZm8nKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHtGaWVsZEltYWdlfSBmcm9tICcuLi8uLi9maWVsZF9pbWFnZS5qcyc7XG5pbXBvcnQge0ZpZWxkTGFiZWx9IGZyb20gJy4uLy4uL2ZpZWxkX2xhYmVsLmpzJztcbmltcG9ydCB7RmllbGRUZXh0SW5wdXR9IGZyb20gJy4uLy4uL2ZpZWxkX3RleHRpbnB1dC5qcyc7XG5pbXBvcnQge0FsaWduLCBJbnB1dH0gZnJvbSAnLi4vLi4vaW5wdXQuanMnO1xuaW1wb3J0IHtpbnB1dFR5cGVzfSBmcm9tICcuLi8uLi9pbnB1dF90eXBlcy5qcyc7XG5pbXBvcnQge1JlbmRlckluZm8gYXMgQmFzZVJlbmRlckluZm99IGZyb20gJy4uL2NvbW1vbi9pbmZvLmpzJztcbmltcG9ydCB0eXBlIHtNZWFzdXJhYmxlfSBmcm9tICcuLi9tZWFzdXJhYmxlcy9iYXNlLmpzJztcbmltcG9ydCB7RmllbGR9IGZyb20gJy4uL21lYXN1cmFibGVzL2ZpZWxkLmpzJztcbmltcG9ydCB7SW5Sb3dTcGFjZXJ9IGZyb20gJy4uL21lYXN1cmFibGVzL2luX3Jvd19zcGFjZXIuanMnO1xuaW1wb3J0IHtJbnB1dENvbm5lY3Rpb259IGZyb20gJy4uL21lYXN1cmFibGVzL2lucHV0X2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge1Jvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvcm93LmpzJztcbmltcG9ydCB0eXBlIHtTcGFjZXJSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3NwYWNlcl9yb3cuanMnO1xuaW1wb3J0IHtUeXBlc30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvdHlwZXMuanMnO1xuXG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlciwgSW5zaWRlQ29ybmVyc30gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtCb3R0b21Sb3d9IGZyb20gJy4vbWVhc3VyYWJsZXMvYm90dG9tX3Jvdy5qcyc7XG5pbXBvcnQge1N0YXRlbWVudElucHV0fSBmcm9tICcuL21lYXN1cmFibGVzL2lucHV0cy5qcyc7XG5pbXBvcnQge1JpZ2h0Q29ubmVjdGlvblNoYXBlfSBmcm9tICcuL21lYXN1cmFibGVzL3Jvd19lbGVtZW50cy5qcyc7XG5pbXBvcnQge1RvcFJvd30gZnJvbSAnLi9tZWFzdXJhYmxlcy90b3Bfcm93LmpzJztcbmltcG9ydCB0eXBlIHtQYXRoT2JqZWN0fSBmcm9tICcuL3BhdGhfb2JqZWN0LmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgc2l6aW5nIGluZm9ybWF0aW9uIG5lZWRlZCB0byBkcmF3IHRoaXMgYmxvY2suXG4gKlxuICogVGhpcyBtZWFzdXJlIHBhc3MgZG9lcyBub3QgcHJvcGFnYXRlIGNoYW5nZXMgdG8gdGhlIGJsb2NrIChhbHRob3VnaCBmaWVsZHNcbiAqIG1heSBjaG9vc2UgdG8gcmVyZW5kZXIgd2hlbiBnZXRTaXplKCkgaXMgY2FsbGVkKS4gIEhvd2V2ZXIsIGNhbGxpbmcgaXRcbiAqIHJlcGVhdGVkbHkgbWF5IGJlIGV4cGVuc2l2ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS56ZWxvcy5SZW5kZXJJbmZvXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJJbmZvIGV4dGVuZHMgQmFzZVJlbmRlckluZm8ge1xuICBvdmVycmlkZSB0b3BSb3c6IFRvcFJvdztcbiAgb3ZlcnJpZGUgYm90dG9tUm93OiBCb3R0b21Sb3c7XG4gIG92ZXJyaWRlIGNvbnN0YW50c186IENvbnN0YW50UHJvdmlkZXI7XG4gIG92ZXJyaWRlIHJlbmRlcmVyXzogUmVuZGVyZXI7XG5cbiAgb3ZlcnJpZGUgaXNJbmxpbmUgPSB0cnVlO1xuICBpc011bHRpUm93OiBib29sZWFuO1xuICBoYXNTdGF0ZW1lbnRJbnB1dDogYm9vbGVhbjtcbiAgcmlnaHRTaWRlOiBSaWdodENvbm5lY3Rpb25TaGFwZXxudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IHJpZ2h0QWxpZ25lZER1bW15SW5wdXRzXzogV2Vha01hcDxSb3csIElucHV0PjtcblxuICAvKipcbiAgICogQHBhcmFtIHJlbmRlcmVyIFRoZSByZW5kZXJlciBpbiB1c2UuXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gbWVhc3VyZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihyZW5kZXJlcjogUmVuZGVyZXIsIGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIHN1cGVyKHJlbmRlcmVyLCBibG9jayk7XG5cbiAgICB0aGlzLnJlbmRlcmVyXyA9IHJlbmRlcmVyO1xuXG4gICAgdGhpcy5jb25zdGFudHNfID0gdGhpcy5yZW5kZXJlcl8uZ2V0Q29uc3RhbnRzKCk7XG5cbiAgICAvKipcbiAgICAgKiBBbiBvYmplY3Qgd2l0aCByZW5kZXJpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRvcCByb3cgb2YgdGhlIGJsb2NrLlxuICAgICAqL1xuICAgIHRoaXMudG9wUm93ID0gbmV3IFRvcFJvdyh0aGlzLmNvbnN0YW50c18pO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IHdpdGggcmVuZGVyaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBib3R0b20gcm93IG9mIHRoZSBibG9jay5cbiAgICAgKi9cbiAgICB0aGlzLmJvdHRvbVJvdyA9IG5ldyBCb3R0b21Sb3codGhpcy5jb25zdGFudHNfKTtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIGJsb2NrIHNob3VsZCBiZSByZW5kZXJlZCBhcyBhIG11bHRpLWxpbmUgYmxvY2ssIGVpdGhlclxuICAgICAqIGJlY2F1c2UgaXQncyBub3QgaW5saW5lIG9yIGJlY2F1c2UgaXQgaGFzIGJlZW4gY29sbGFwc2VkLlxuICAgICAqL1xuICAgIHRoaXMuaXNNdWx0aVJvdyA9ICFibG9jay5nZXRJbnB1dHNJbmxpbmUoKSB8fCBibG9jay5pc0NvbGxhcHNlZCgpO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciBvciBub3QgdGhlIGJsb2NrIGhhcyBhIHN0YXRlbWVudCBpbnB1dCBpbiBvbmUgb2YgaXRzIHJvd3MuXG4gICAgICovXG4gICAgdGhpcy5oYXNTdGF0ZW1lbnRJbnB1dCA9IGJsb2NrLnN0YXRlbWVudElucHV0Q291bnQgPiAwO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IHdpdGggcmVuZGVyaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSByaWdodCBjb25uZWN0aW9uIHNoYXBlLlxuICAgICAqL1xuICAgIHRoaXMucmlnaHRTaWRlID0gdGhpcy5vdXRwdXRDb25uZWN0aW9uID9cbiAgICAgICAgbmV3IFJpZ2h0Q29ubmVjdGlvblNoYXBlKHRoaXMuY29uc3RhbnRzXykgOlxuICAgICAgICBudWxsO1xuXG4gICAgLyoqXG4gICAgICogQSBtYXAgb2Ygcm93cyB0byByaWdodCBhbGlnbmVkIGR1bW15IGlucHV0cyB3aXRoaW4gdGhvc2Ugcm93cy4gVXNlZCB0b1xuICAgICAqIGFkZCBwYWRkaW5nIGJldHdlZW4gbGVmdCBhbmQgcmlnaHQgYWxpZ25lZCBpbnB1dHMuXG4gICAgICovXG4gICAgdGhpcy5yaWdodEFsaWduZWREdW1teUlucHV0c18gPSBuZXcgV2Vha01hcCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYmxvY2sgcmVuZGVyZXIgaW4gdXNlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYmxvY2sgcmVuZGVyZXIgaW4gdXNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGdldFJlbmRlcmVyKCk6IFJlbmRlcmVyIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlcl8gYXMgUmVuZGVyZXI7XG4gIH1cblxuICBvdmVycmlkZSBtZWFzdXJlKCkge1xuICAgIC8vIE1vZGlmeWluZyBwYXJlbnQgbWVhc3VyZSBtZXRob2QgdG8gYWRkIGBhZGp1c3RYUG9zaXRpb25fYC5cbiAgICB0aGlzLmNyZWF0ZVJvd3NfKCk7XG4gICAgdGhpcy5hZGRFbGVtU3BhY2luZ18oKTtcbiAgICB0aGlzLmFkZFJvd1NwYWNpbmdfKCk7XG4gICAgdGhpcy5hZGp1c3RYUG9zaXRpb25fKCk7XG4gICAgdGhpcy5jb21wdXRlQm91bmRzXygpO1xuICAgIHRoaXMuYWxpZ25Sb3dFbGVtZW50c18oKTtcbiAgICB0aGlzLmZpbmFsaXplXygpO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2hvdWxkU3RhcnROZXdSb3dfKGlucHV0OiBJbnB1dCwgbGFzdElucHV0OiBJbnB1dCk6IGJvb2xlYW4ge1xuICAgIC8vIElmIHRoaXMgaXMgdGhlIGZpcnN0IGlucHV0LCBqdXN0IGFkZCB0byB0aGUgZXhpc3Rpbmcgcm93LlxuICAgIC8vIFRoYXQgcm93IGlzIGVpdGhlciBlbXB0eSBvciBoYXMgc29tZSBpY29ucyBpbiBpdC5cbiAgICBpZiAoIWxhc3RJbnB1dCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBBIHN0YXRlbWVudCBpbnB1dCBvciBhbiBpbnB1dCBmb2xsb3dpbmcgb25lIGFsd2F5cyBnZXRzIGEgbmV3IHJvdy5cbiAgICBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5TVEFURU1FTlQgfHxcbiAgICAgICAgbGFzdElucHV0LnR5cGUgPT09IGlucHV0VHlwZXMuU1RBVEVNRU5UKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLy8gVmFsdWUgYW5kIGR1bW15IGlucHV0cyBnZXQgbmV3IHJvdyBpZiBpbnB1dHMgYXJlIG5vdCBpbmxpbmVkLlxuICAgIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLlZBTFVFIHx8IGlucHV0LnR5cGUgPT09IGlucHV0VHlwZXMuRFVNTVkpIHtcbiAgICAgIHJldHVybiAhdGhpcy5pc0lubGluZSB8fCB0aGlzLmlzTXVsdGlSb3c7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG92ZXJyaWRlIGdldERlc2lyZWRSb3dXaWR0aF8ocm93OiBSb3cpOiBudW1iZXIge1xuICAgIGlmIChyb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICBjb25zdCByaWdodENvcm5lcldpZHRoID1cbiAgICAgICAgICAodGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTIGFzIEluc2lkZUNvcm5lcnMpLnJpZ2h0V2lkdGggfHwgMDtcbiAgICAgIHJldHVybiB0aGlzLndpZHRoIC0gdGhpcy5zdGFydFggLSByaWdodENvcm5lcldpZHRoO1xuICAgIH1cbiAgICByZXR1cm4gc3VwZXIuZ2V0RGVzaXJlZFJvd1dpZHRoXyhyb3cpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0SW5Sb3dTcGFjaW5nXyhwcmV2OiBNZWFzdXJhYmxlfG51bGwsIG5leHQ6IE1lYXN1cmFibGV8bnVsbCk6XG4gICAgICBudW1iZXIge1xuICAgIGlmICghcHJldiB8fCAhbmV4dCkge1xuICAgICAgLy8gTm8gbmVlZCBmb3IgcGFkZGluZyBhdCB0aGUgYmVnaW5uaW5nIG9yIGVuZCBvZiB0aGUgcm93IGlmIHRoZVxuICAgICAgLy8gb3V0cHV0IHNoYXBlIGlzIGR5bmFtaWMuXG4gICAgICBpZiAodGhpcy5vdXRwdXRDb25uZWN0aW9uICYmIHRoaXMub3V0cHV0Q29ubmVjdGlvbi5pc0R5bmFtaWNTaGFwZSAmJlxuICAgICAgICAgICF0aGlzLmhhc1N0YXRlbWVudElucHV0ICYmICF0aGlzLmJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghcHJldikge1xuICAgICAgLy8gU3RhdGVtZW50IGlucHV0IHBhZGRpbmcuXG4gICAgICBpZiAobmV4dCAmJiBUeXBlcy5pc1N0YXRlbWVudElucHV0KG5leHQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uU1RBVEVNRU5UX0lOUFVUX1BBRERJTkdfTEVGVDtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgcm91bmRlZCBjb3JuZXIgYW5kIGEgcHJldmlvdXMgb3IgbmV4dCBjb25uZWN0aW9uLlxuICAgIGlmIChwcmV2ICYmIFR5cGVzLmlzTGVmdFJvdW5kZWRDb3JuZXIocHJldikgJiYgbmV4dCkge1xuICAgICAgaWYgKFR5cGVzLmlzUHJldmlvdXNDb25uZWN0aW9uKG5leHQpIHx8IFR5cGVzLmlzTmV4dENvbm5lY3Rpb24obmV4dCkpIHtcbiAgICAgICAgcmV0dXJuIG5leHQubm90Y2hPZmZzZXQgLSB0aGlzLmNvbnN0YW50c18uQ09STkVSX1JBRElVUztcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgc3F1YXJlIGNvcm5lciBhbmQgYSBoYXQuXG4gICAgaWYgKHByZXYgJiYgVHlwZXMuaXNMZWZ0U3F1YXJlQ29ybmVyKHByZXYpICYmIG5leHQgJiYgVHlwZXMuaXNIYXQobmV4dCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTk9fUEFERElORztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFNwYWNlclJvd0hlaWdodF8ocHJldjogUm93LCBuZXh0OiBSb3cpOiBudW1iZXIge1xuICAgIC8vIElmIHdlIGhhdmUgYW4gZW1wdHkgYmxvY2sgYWRkIGEgc3BhY2VyIHRvIGluY3JlYXNlIHRoZSBoZWlnaHQuXG4gICAgaWYgKFR5cGVzLmlzVG9wUm93KHByZXYpICYmIFR5cGVzLmlzQm90dG9tUm93KG5leHQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkVNUFRZX0JMT0NLX1NQQUNFUl9IRUlHSFQ7XG4gICAgfVxuICAgIGNvbnN0IGZvbGxvd3NTdGF0ZW1lbnQgPSBUeXBlcy5pc0lucHV0Um93KHByZXYpICYmIHByZXYuaGFzU3RhdGVtZW50O1xuICAgIGNvbnN0IHByZWNlZGVzU3RhdGVtZW50ID0gVHlwZXMuaXNJbnB1dFJvdyhuZXh0KSAmJiBuZXh0Lmhhc1N0YXRlbWVudDtcbiAgICBpZiAocHJlY2VkZXNTdGF0ZW1lbnQgfHwgZm9sbG93c1N0YXRlbWVudCkge1xuICAgICAgY29uc3QgY29ybmVySGVpZ2h0ID1cbiAgICAgICAgICAodGhpcy5jb25zdGFudHNfLklOU0lERV9DT1JORVJTIGFzIEluc2lkZUNvcm5lcnMpLnJpZ2h0SGVpZ2h0IHx8IDA7XG4gICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heCh0aGlzLmNvbnN0YW50c18uTk9UQ0hfSEVJR0hULCBjb3JuZXJIZWlnaHQpO1xuICAgICAgcmV0dXJuIHByZWNlZGVzU3RhdGVtZW50ICYmIGZvbGxvd3NTdGF0ZW1lbnQgP1xuICAgICAgICAgIE1hdGgubWF4KGhlaWdodCwgdGhpcy5jb25zdGFudHNfLkRVTU1ZX0lOUFVUX01JTl9IRUlHSFQpIDpcbiAgICAgICAgICBoZWlnaHQ7XG4gICAgfVxuICAgIC8vIFRvcCBhbmQgYm90dG9tIHJvd3MgYWN0IGFzIGEgc3BhY2VyIHNvIHdlIGRvbid0IG5lZWQgYW55IGV4dHJhIHBhZGRpbmcuXG4gICAgaWYgKFR5cGVzLmlzVG9wUm93KHByZXYpKSB7XG4gICAgICBjb25zdCB0b3BSb3cgPSBwcmV2IGFzIFRvcFJvdztcbiAgICAgIGlmICghdG9wUm93Lmhhc1ByZXZpb3VzQ29ubmVjdGlvbiAmJlxuICAgICAgICAgICghdGhpcy5vdXRwdXRDb25uZWN0aW9uIHx8IHRoaXMuaGFzU3RhdGVtZW50SW5wdXQpKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyhcbiAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5OT1RDSF9IRUlHSFQgLSB0aGlzLmNvbnN0YW50c18uQ09STkVSX1JBRElVUyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgfVxuICAgIGlmIChUeXBlcy5pc0JvdHRvbVJvdyhuZXh0KSkge1xuICAgICAgY29uc3QgYm90dG9tUm93ID0gbmV4dCBhcyBCb3R0b21Sb3c7XG4gICAgICBpZiAoIXRoaXMub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgICBjb25zdCB0b3BIZWlnaHQgPSBNYXRoLm1heChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9wUm93Lm1pbkhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5OT1RDSF9IRUlHSFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zdGFudHNfLkNPUk5FUl9SQURJVVMpKSAtXG4gICAgICAgICAgICB0aGlzLmNvbnN0YW50c18uQ09STkVSX1JBRElVUztcbiAgICAgICAgcmV0dXJuIHRvcEhlaWdodDtcbiAgICAgIH0gZWxzZSBpZiAoIWJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbiAmJiB0aGlzLmhhc1N0YXRlbWVudElucHV0KSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyhcbiAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5OT1RDSF9IRUlHSFQgLSB0aGlzLmNvbnN0YW50c18uQ09STkVSX1JBRElVUyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUVESVVNX1BBRERJTkc7XG4gIH1cblxuICBvdmVycmlkZSBnZXRTcGFjZXJSb3dXaWR0aF8ocHJldjogUm93LCBuZXh0OiBSb3cpOiBudW1iZXIge1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy53aWR0aCAtIHRoaXMuc3RhcnRYO1xuICAgIGlmIChUeXBlcy5pc0lucHV0Um93KHByZXYpICYmIHByZXYuaGFzU3RhdGVtZW50IHx8XG4gICAgICAgIFR5cGVzLmlzSW5wdXRSb3cobmV4dCkgJiYgbmV4dC5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgIHJldHVybiBNYXRoLm1heCh3aWR0aCwgdGhpcy5jb25zdGFudHNfLlNUQVRFTUVOVF9JTlBVVF9TUEFDRVJfTUlOX1dJRFRIKTtcbiAgICB9XG4gICAgcmV0dXJuIHdpZHRoO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0RWxlbUNlbnRlcmxpbmVfKHJvdzogUm93LCBlbGVtOiBNZWFzdXJhYmxlKTogbnVtYmVyIHtcbiAgICBpZiAocm93Lmhhc1N0YXRlbWVudCAmJiAhVHlwZXMuaXNTcGFjZXIoZWxlbSkgJiZcbiAgICAgICAgIVR5cGVzLmlzU3RhdGVtZW50SW5wdXQoZWxlbSkpIHtcbiAgICAgIHJldHVybiByb3cueVBvcyArIHRoaXMuY29uc3RhbnRzXy5FTVBUWV9TVEFURU1FTlRfSU5QVVRfSEVJR0hUIC8gMjtcbiAgICB9XG4gICAgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQoZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIElucHV0Q29ubmVjdGlvbikge1xuICAgICAgY29uc3QgY29ubmVjdGVkQmxvY2sgPSBlbGVtLmNvbm5lY3RlZEJsb2NrO1xuICAgICAgaWYgKGNvbm5lY3RlZEJsb2NrICYmIGNvbm5lY3RlZEJsb2NrLm91dHB1dENvbm5lY3Rpb24gJiZcbiAgICAgICAgICBjb25uZWN0ZWRCbG9jay5uZXh0Q29ubmVjdGlvbikge1xuICAgICAgICByZXR1cm4gcm93LnlQb3MgKyBjb25uZWN0ZWRCbG9jay5oZWlnaHQgLyAyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3VwZXIuZ2V0RWxlbUNlbnRlcmxpbmVfKHJvdywgZWxlbSk7XG4gIH1cblxuICBvdmVycmlkZSBhZGRJbnB1dF8oaW5wdXQ6IElucHV0LCBhY3RpdmVSb3c6IFJvdykge1xuICAgIC8vIElmIHdlIGhhdmUgdHdvIGR1bW15IGlucHV0cyBvbiB0aGUgc2FtZSByb3csIG9uZSBhbGlnbmVkIGxlZnQgYW5kIHRoZVxuICAgIC8vIG90aGVyIHJpZ2h0LCBrZWVwIHRyYWNrIG9mIHRoZSByaWdodCBhbGlnbmVkIGR1bW15IGlucHV0IHNvIHdlIGNhbiBhZGRcbiAgICAvLyBwYWRkaW5nIGxhdGVyLlxuICAgIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLkRVTU1ZICYmIGFjdGl2ZVJvdy5oYXNEdW1teUlucHV0ICYmXG4gICAgICAgIGFjdGl2ZVJvdy5hbGlnbiA9PT0gQWxpZ24uTEVGVCAmJiBpbnB1dC5hbGlnbiA9PT0gQWxpZ24uUklHSFQpIHtcbiAgICAgIHRoaXMucmlnaHRBbGlnbmVkRHVtbXlJbnB1dHNfLnNldChhY3RpdmVSb3csIGlucHV0KTtcbiAgICB9IGVsc2UgaWYgKGlucHV0LnR5cGUgPT09IGlucHV0VHlwZXMuU1RBVEVNRU5UKSB7XG4gICAgICAvLyBIYW5kbGUgc3RhdGVtZW50cyB3aXRob3V0IG5leHQgY29ubmVjdGlvbnMgY29ycmVjdGx5LlxuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IFN0YXRlbWVudElucHV0KHRoaXMuY29uc3RhbnRzXywgaW5wdXQpKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNTdGF0ZW1lbnQgPSB0cnVlO1xuXG4gICAgICBpZiAoYWN0aXZlUm93LmFsaWduID09PSBudWxsKSB7XG4gICAgICAgIGFjdGl2ZVJvdy5hbGlnbiA9IGlucHV0LmFsaWduO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzdXBlci5hZGRJbnB1dF8oaW5wdXQsIGFjdGl2ZVJvdyk7XG4gIH1cblxuICBvdmVycmlkZSBhZGRBbGlnbm1lbnRQYWRkaW5nXyhyb3c6IFJvdywgbWlzc2luZ1NwYWNlOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5yaWdodEFsaWduZWREdW1teUlucHV0c18uZ2V0KHJvdykpIHtcbiAgICAgIGxldCBhbGlnbm1lbnREaXZpZGVyO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3cuZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgZWxlbSA9IHJvdy5lbGVtZW50c1tpXTtcbiAgICAgICAgaWYgKFR5cGVzLmlzU3BhY2VyKGVsZW0pKSB7XG4gICAgICAgICAgYWxpZ25tZW50RGl2aWRlciA9IGVsZW07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFR5cGVzLmlzRmllbGQoZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIEZpZWxkICYmXG4gICAgICAgICAgICBlbGVtLnBhcmVudElucHV0ID09PSB0aGlzLnJpZ2h0QWxpZ25lZER1bW15SW5wdXRzXy5nZXQocm93KSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYWxpZ25tZW50RGl2aWRlcikge1xuICAgICAgICBhbGlnbm1lbnREaXZpZGVyLndpZHRoICs9IG1pc3NpbmdTcGFjZTtcbiAgICAgICAgcm93LndpZHRoICs9IG1pc3NpbmdTcGFjZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBzdXBlci5hZGRBbGlnbm1lbnRQYWRkaW5nXyhyb3csIG1pc3NpbmdTcGFjZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRqdXN0IHRoZSB4IHBvc2l0aW9uIG9mIGZpZWxkcyB0byBidW1wIGFsbCBub24tbGFiZWwgZmllbGRzIGluIHRoZSBmaXJzdFxuICAgKiByb3cgcGFzdCB0aGUgbm90Y2ggcG9zaXRpb24uICBUaGlzIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBgY29tcHV0ZUJvdW5kc2BcbiAgICogaXMgY2FsbGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGFkanVzdFhQb3NpdGlvbl8oKSB7XG4gICAgY29uc3Qgbm90Y2hUb3RhbFdpZHRoID1cbiAgICAgICAgdGhpcy5jb25zdGFudHNfLk5PVENIX09GRlNFVF9MRUZUICsgdGhpcy5jb25zdGFudHNfLk5PVENIX1dJRFRIO1xuICAgIGxldCBtaW5YUG9zID0gbm90Y2hUb3RhbFdpZHRoO1xuICAgIC8vIFJ1biB0aHJvdWdoIGV2ZXJ5IGlucHV0IHJvdyBvbiB0aGUgYmxvY2sgYW5kIG9ubHkgYXBwbHkgYnVtcCBsb2dpYyB0byB0aGVcbiAgICAvLyBmaXJzdCBpbnB1dCByb3cgKGlmIHRoZSBibG9jayBoYXMgcHJldiBjb25uZWN0aW9uKSBhbmQgZXZlcnkgaW5wdXQgcm93XG4gICAgLy8gdGhhdCBoYXMgYSBwcmV2IGFuZCBuZXh0IG5vdGNoLlxuICAgIGZvciAobGV0IGkgPSAyOyBpIDwgdGhpcy5yb3dzLmxlbmd0aCAtIDE7IGkgKz0gMikge1xuICAgICAgY29uc3QgcHJldlNwYWNlciA9IHRoaXMucm93c1tpIC0gMV0gYXMgU3BhY2VyUm93O1xuICAgICAgY29uc3Qgcm93ID0gdGhpcy5yb3dzW2ldO1xuICAgICAgY29uc3QgbmV4dFNwYWNlciA9IHRoaXMucm93c1tpICsgMV0gYXMgU3BhY2VyUm93O1xuXG4gICAgICBjb25zdCBoYXNQcmV2Tm90Y2ggPSBpID09PSAyID8gISF0aGlzLnRvcFJvdy5oYXNQcmV2aW91c0Nvbm5lY3Rpb24gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEhcHJldlNwYWNlci5mb2xsb3dzU3RhdGVtZW50O1xuICAgICAgY29uc3QgaGFzTmV4dE5vdGNoID0gaSArIDIgPj0gdGhpcy5yb3dzLmxlbmd0aCAtIDEgP1xuICAgICAgICAgICEhdGhpcy5ib3R0b21Sb3cuaGFzTmV4dENvbm5lY3Rpb24gOlxuICAgICAgICAgICEhbmV4dFNwYWNlci5wcmVjZWRlc1N0YXRlbWVudDtcblxuICAgICAgaWYgKFR5cGVzLmlzSW5wdXRSb3cocm93KSAmJiByb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICAgIHJvdy5tZWFzdXJlKCk7XG4gICAgICAgIG1pblhQb3MgPVxuICAgICAgICAgICAgcm93LndpZHRoIC0gKHJvdy5nZXRMYXN0SW5wdXQoKT8ud2lkdGggPz8gMCkgKyBub3RjaFRvdGFsV2lkdGg7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGhhc1ByZXZOb3RjaCAmJiAoaSA9PT0gMiB8fCBoYXNOZXh0Tm90Y2gpICYmIFR5cGVzLmlzSW5wdXRSb3cocm93KSAmJlxuICAgICAgICAgICFyb3cuaGFzU3RhdGVtZW50KSB7XG4gICAgICAgIGxldCB4Q3Vyc29yID0gcm93LnhQb3M7XG4gICAgICAgIGxldCBwcmV2SW5Sb3dTcGFjZXIgPSBudWxsO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJvdy5lbGVtZW50cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGNvbnN0IGVsZW0gPSByb3cuZWxlbWVudHNbal07XG4gICAgICAgICAgaWYgKFR5cGVzLmlzU3BhY2VyKGVsZW0pKSB7XG4gICAgICAgICAgICBwcmV2SW5Sb3dTcGFjZXIgPSBlbGVtO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocHJldkluUm93U3BhY2VyICYmIChUeXBlcy5pc0ZpZWxkKGVsZW0pIHx8IFR5cGVzLmlzSW5wdXQoZWxlbSkpKSB7XG4gICAgICAgICAgICBpZiAoeEN1cnNvciA8IG1pblhQb3MgJiZcbiAgICAgICAgICAgICAgICAhKFR5cGVzLmlzRmllbGQoZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIEZpZWxkICYmXG4gICAgICAgICAgICAgICAgICAoZWxlbS5maWVsZCBpbnN0YW5jZW9mIEZpZWxkTGFiZWwgfHxcbiAgICAgICAgICAgICAgICAgICBlbGVtLmZpZWxkIGluc3RhbmNlb2YgRmllbGRJbWFnZSkpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSBtaW5YUG9zIC0geEN1cnNvcjtcbiAgICAgICAgICAgICAgcHJldkluUm93U3BhY2VyLndpZHRoICs9IGRpZmZlcmVuY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHhDdXJzb3IgKz0gZWxlbS53aWR0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5hbGl6ZSB0aGUgb3V0cHV0IGNvbm5lY3Rpb24gaW5mby4gIEluIHBhcnRpY3VsYXIsIHNldCB0aGUgaGVpZ2h0IG9mIHRoZVxuICAgKiBvdXRwdXQgY29ubmVjdGlvbiB0byBtYXRjaCB0aGF0IG9mIHRoZSBibG9jay4gIEZvciB0aGUgcmlnaHQgc2lkZSwgYWRkIGFcbiAgICogcmlnaHQgY29ubmVjdGlvbiBzaGFwZSBlbGVtZW50IGFuZCBoYXZlIGl0IG1hdGNoIHRoZSBkaW1lbnNpb25zIG9mIHRoZVxuICAgKiBvdXRwdXQgY29ubmVjdGlvbi5cbiAgICovXG4gIHByb3RlY3RlZCBmaW5hbGl6ZU91dHB1dENvbm5lY3Rpb25fKCkge1xuICAgIC8vIER5bmFtaWMgb3V0cHV0IGNvbm5lY3Rpb25zIGRlcGVuZCBvbiB0aGUgaGVpZ2h0IG9mIHRoZSBibG9jay5cbiAgICBpZiAoIXRoaXMub3V0cHV0Q29ubmVjdGlvbiB8fCAhdGhpcy5vdXRwdXRDb25uZWN0aW9uLmlzRHluYW1pY1NoYXBlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG91dHB1dENvbm5lY3Rpb25TaGFwZSA9IHRoaXMub3V0cHV0Q29ubmVjdGlvbi5zaGFwZTtcbiAgICBpZiAoISgnaXNEeW5hbWljJyBpbiBvdXRwdXRDb25uZWN0aW9uU2hhcGUgJiZcbiAgICAgICAgICBvdXRwdXRDb25uZWN0aW9uU2hhcGUuaXNEeW5hbWljKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCB5Q3Vyc29yID0gMDtcbiAgICAvLyBEZXRlcm1pbmUgdGhlIGJsb2NrIGhlaWdodC5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgcm93ID0gdGhpcy5yb3dzW2ldO1xuICAgICAgcm93LnlQb3MgPSB5Q3Vyc29yO1xuICAgICAgeUN1cnNvciArPSByb3cuaGVpZ2h0O1xuICAgIH1cbiAgICB0aGlzLmhlaWdodCA9IHlDdXJzb3I7XG5cbiAgICAvLyBBZGp1c3QgdGhlIGhlaWdodCBvZiB0aGUgb3V0cHV0IGNvbm5lY3Rpb24uXG4gICAgY29uc3QgYmxvY2tIZWlnaHQgPSB0aGlzLmJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbiA/XG4gICAgICAgIHRoaXMuaGVpZ2h0IC0gdGhpcy5ib3R0b21Sb3cuZGVzY2VuZGVySGVpZ2h0IDpcbiAgICAgICAgdGhpcy5oZWlnaHQ7XG4gICAgY29uc3QgY29ubmVjdGlvbkhlaWdodCA9IG91dHB1dENvbm5lY3Rpb25TaGFwZS5oZWlnaHQoYmxvY2tIZWlnaHQpO1xuICAgIGNvbnN0IGNvbm5lY3Rpb25XaWR0aCA9IG91dHB1dENvbm5lY3Rpb25TaGFwZS53aWR0aChibG9ja0hlaWdodCk7XG5cbiAgICB0aGlzLm91dHB1dENvbm5lY3Rpb24uaGVpZ2h0ID0gY29ubmVjdGlvbkhlaWdodDtcbiAgICB0aGlzLm91dHB1dENvbm5lY3Rpb24ud2lkdGggPSBjb25uZWN0aW9uV2lkdGg7XG4gICAgdGhpcy5vdXRwdXRDb25uZWN0aW9uLnN0YXJ0WCA9IGNvbm5lY3Rpb25XaWR0aDtcbiAgICB0aGlzLm91dHB1dENvbm5lY3Rpb24uY29ubmVjdGlvbk9mZnNldFkgPVxuICAgICAgICBvdXRwdXRDb25uZWN0aW9uU2hhcGUuY29ubmVjdGlvbk9mZnNldFkoY29ubmVjdGlvbkhlaWdodCk7XG4gICAgdGhpcy5vdXRwdXRDb25uZWN0aW9uLmNvbm5lY3Rpb25PZmZzZXRYID1cbiAgICAgICAgb3V0cHV0Q29ubmVjdGlvblNoYXBlLmNvbm5lY3Rpb25PZmZzZXRYKGNvbm5lY3Rpb25XaWR0aCk7XG5cbiAgICAvLyBBZGQgdGhlIHJpZ2h0IGNvbm5lY3Rpb24gbWVhc3VyYWJsZS5cbiAgICAvLyBEb24ndCBhZGQgaXQgaWYgd2UgaGF2ZSBhIHZhbHVlLXRvLXN0YXRlbWVudCBvciBhIHZhbHVlLXRvLXN0YWNrIGJsb2NrLlxuICAgIGxldCByaWdodENvbm5lY3Rpb25XaWR0aCA9IDA7XG4gICAgaWYgKCF0aGlzLmhhc1N0YXRlbWVudElucHV0ICYmICF0aGlzLmJvdHRvbVJvdy5oYXNOZXh0Q29ubmVjdGlvbikge1xuICAgICAgcmlnaHRDb25uZWN0aW9uV2lkdGggPSBjb25uZWN0aW9uV2lkdGg7XG4gICAgICB0aGlzLnJpZ2h0U2lkZSEuaGVpZ2h0ID0gY29ubmVjdGlvbkhlaWdodDtcbiAgICAgIHRoaXMucmlnaHRTaWRlIS53aWR0aCA9IHJpZ2h0Q29ubmVjdGlvbldpZHRoO1xuICAgICAgdGhpcy5yaWdodFNpZGUhLmNlbnRlcmxpbmUgPSBjb25uZWN0aW9uSGVpZ2h0IC8gMjtcbiAgICAgIHRoaXMucmlnaHRTaWRlIS54UG9zID0gdGhpcy53aWR0aCArIHJpZ2h0Q29ubmVjdGlvbldpZHRoO1xuICAgIH1cbiAgICB0aGlzLnN0YXJ0WCA9IGNvbm5lY3Rpb25XaWR0aDtcbiAgICB0aGlzLndpZHRoICs9IGNvbm5lY3Rpb25XaWR0aCArIHJpZ2h0Q29ubmVjdGlvbldpZHRoO1xuICAgIHRoaXMud2lkdGhXaXRoQ2hpbGRyZW4gKz0gY29ubmVjdGlvbldpZHRoICsgcmlnaHRDb25uZWN0aW9uV2lkdGg7XG4gIH1cblxuICAvKipcbiAgICogRmluYWxpemUgaG9yaXpvbnRhbCBhbGlnbm1lbnQgb2YgZWxlbWVudHMgb24gdGhlIGJsb2NrLiAgSW4gcGFydGljdWxhcixcbiAgICogcmVkdWNlIHRoZSBpbXBsaWNpdCBzcGFjaW5nIGNyZWF0ZWQgYnkgdGhlIGxlZnQgYW5kIHJpZ2h0IG91dHB1dCBjb25uZWN0aW9uXG4gICAqIHNoYXBlcyBieSBhZGRpbmcgc2V0dGluZyBuZWdhdGl2ZSBzcGFjaW5nIG9udG8gdGhlIGxlZnRtb3N0IGFuZCByaWdodG1vc3RcbiAgICogc3BhY2Vycy5cbiAgICovXG4gIHByb3RlY3RlZCBmaW5hbGl6ZUhvcml6b250YWxBbGlnbm1lbnRfKCkge1xuICAgIGlmICghdGhpcy5vdXRwdXRDb25uZWN0aW9uIHx8IHRoaXMuaGFzU3RhdGVtZW50SW5wdXQgfHxcbiAgICAgICAgdGhpcy5ib3R0b21Sb3cuaGFzTmV4dENvbm5lY3Rpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHRvdGFsTmVnYXRpdmVTcGFjaW5nID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgcm93ID0gdGhpcy5yb3dzW2ldO1xuICAgICAgaWYgKCFUeXBlcy5pc0lucHV0Um93KHJvdykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBmaXJzdEVsZW0gPSByb3cuZWxlbWVudHNbMV07XG4gICAgICBjb25zdCBsYXN0RWxlbSA9IHJvdy5lbGVtZW50c1tyb3cuZWxlbWVudHMubGVuZ3RoIC0gMl07XG4gICAgICBsZXQgbGVmdE5lZ1BhZGRpbmcgPSB0aGlzLmdldE5lZ2F0aXZlU3BhY2luZ18oZmlyc3RFbGVtKTtcbiAgICAgIGxldCByaWdodE5lZ1BhZGRpbmcgPSB0aGlzLmdldE5lZ2F0aXZlU3BhY2luZ18obGFzdEVsZW0pO1xuICAgICAgdG90YWxOZWdhdGl2ZVNwYWNpbmcgPSBsZWZ0TmVnUGFkZGluZyArIHJpZ2h0TmVnUGFkZGluZztcbiAgICAgIGNvbnN0IG1pbkJsb2NrV2lkdGggPVxuICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5NSU5fQkxPQ0tfV0lEVEggKyB0aGlzLm91dHB1dENvbm5lY3Rpb24ud2lkdGggKiAyO1xuICAgICAgaWYgKHRoaXMud2lkdGggLSB0b3RhbE5lZ2F0aXZlU3BhY2luZyA8IG1pbkJsb2NrV2lkdGgpIHtcbiAgICAgICAgLy8gTWFpbnRhaW4gYSBtaW5pbXVtIGJsb2NrIHdpZHRoLCBzcGxpdCBuZWdhdGl2ZSBzcGFjaW5nIGJldHdlZW4gbGVmdFxuICAgICAgICAvLyBhbmQgcmlnaHQgZWRnZS5cbiAgICAgICAgdG90YWxOZWdhdGl2ZVNwYWNpbmcgPSB0aGlzLndpZHRoIC0gbWluQmxvY2tXaWR0aDtcbiAgICAgICAgbGVmdE5lZ1BhZGRpbmcgPSB0b3RhbE5lZ2F0aXZlU3BhY2luZyAvIDI7XG4gICAgICAgIHJpZ2h0TmVnUGFkZGluZyA9IHRvdGFsTmVnYXRpdmVTcGFjaW5nIC8gMjtcbiAgICAgIH1cbiAgICAgIC8vIEFkZCBhIG5lZ2F0aXZlIHNwYWNlciBvbiB0aGUgc3RhcnQgYW5kIGVuZCBvZiB0aGUgYmxvY2suXG4gICAgICByb3cuZWxlbWVudHMudW5zaGlmdChuZXcgSW5Sb3dTcGFjZXIodGhpcy5jb25zdGFudHNfLCAtbGVmdE5lZ1BhZGRpbmcpKTtcbiAgICAgIHJvdy5lbGVtZW50cy5wdXNoKG5ldyBJblJvd1NwYWNlcih0aGlzLmNvbnN0YW50c18sIC1yaWdodE5lZ1BhZGRpbmcpKTtcbiAgICB9XG4gICAgaWYgKHRvdGFsTmVnYXRpdmVTcGFjaW5nKSB7XG4gICAgICB0aGlzLndpZHRoIC09IHRvdGFsTmVnYXRpdmVTcGFjaW5nO1xuICAgICAgdGhpcy53aWR0aFdpdGhDaGlsZHJlbiAtPSB0b3RhbE5lZ2F0aXZlU3BhY2luZztcbiAgICAgIHRoaXMucmlnaHRTaWRlIS54UG9zIC09IHRvdGFsTmVnYXRpdmVTcGFjaW5nO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5yb3dzW2ldO1xuICAgICAgICBpZiAoVHlwZXMuaXNUb3BPckJvdHRvbVJvdyhyb3cpKSB7XG4gICAgICAgICAgcm93LmVsZW1lbnRzWzFdLndpZHRoIC09IHRvdGFsTmVnYXRpdmVTcGFjaW5nO1xuICAgICAgICB9XG4gICAgICAgIHJvdy53aWR0aCAtPSB0b3RhbE5lZ2F0aXZlU3BhY2luZztcbiAgICAgICAgcm93LndpZHRoV2l0aENvbm5lY3RlZEJsb2NrcyAtPSB0b3RhbE5lZ2F0aXZlU3BhY2luZztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSBzcGFjaW5nIHRvIHJlZHVjZSB0aGUgbGVmdCBhbmQgcmlnaHQgZWRnZXMgYnkgYmFzZWQgb24gdGhlXG4gICAqIG91dGVyIGFuZCBpbm5lciBjb25uZWN0aW9uIHNoYXBlLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZmlyc3Qgb3IgbGFzdCBlbGVtZW50IG9uIGEgYmxvY2suXG4gICAqIEByZXR1cm5zIFRoZSBhbW91bnQgb2Ygc3BhY2luZyB0byByZWR1Y2UgdGhlIGZpcnN0IG9yIGxhc3Qgc3BhY2VyLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldE5lZ2F0aXZlU3BhY2luZ18oZWxlbTogTWVhc3VyYWJsZSk6IG51bWJlciB7XG4gICAgaWYgKCFlbGVtIHx8ICF0aGlzLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBjb25uZWN0aW9uV2lkdGggPSB0aGlzLm91dHB1dENvbm5lY3Rpb24ud2lkdGg7XG4gICAgY29uc3Qgb3V0ZXJTaGFwZSA9IHRoaXMub3V0cHV0Q29ubmVjdGlvbi5zaGFwZS50eXBlO1xuICAgIGNvbnN0IGNvbnN0YW50cyA9ICh0aGlzLmNvbnN0YW50c18pO1xuICAgIGlmICh0aGlzLmlzTXVsdGlSb3cgJiYgdGhpcy5pbnB1dFJvd3MubGVuZ3RoID4gMSkge1xuICAgICAgc3dpdGNoIChvdXRlclNoYXBlKSB7XG4gICAgICAgIGNhc2UgY29uc3RhbnRzLlNIQVBFUy5ST1VORDoge1xuICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgbXVsdGktcm93IHJvdW5kIHJlcG9ydGVyIGJsb2Nrcy5cbiAgICAgICAgICBjb25zdCBtYXhXaWR0aCA9IHRoaXMuY29uc3RhbnRzXy5NQVhfRFlOQU1JQ19DT05ORUNUSU9OX1NIQVBFX1dJRFRIO1xuICAgICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5oZWlnaHQgLyAyID4gbWF4V2lkdGggPyBtYXhXaWR0aCA6IHRoaXMuaGVpZ2h0IC8gMjtcbiAgICAgICAgICBjb25zdCB0b3BQYWRkaW5nID0gdGhpcy5jb25zdGFudHNfLlNNQUxMX1BBRERJTkc7XG4gICAgICAgICAgY29uc3Qgcm91bmRQYWRkaW5nID1cbiAgICAgICAgICAgICAgd2lkdGggKiAoMSAtIE1hdGguc2luKE1hdGguYWNvcygod2lkdGggLSB0b3BQYWRkaW5nKSAvIHdpZHRoKSkpO1xuICAgICAgICAgIHJldHVybiBjb25uZWN0aW9uV2lkdGggLSByb3VuZFBhZGRpbmc7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQoZWxlbSkgJiYgZWxlbSBpbnN0YW5jZW9mIElucHV0Q29ubmVjdGlvbikge1xuICAgICAgY29uc3QgY29ubmVjdGVkQmxvY2sgPSBlbGVtLmNvbm5lY3RlZEJsb2NrO1xuICAgICAgY29uc3QgaW5uZXJTaGFwZSA9IGNvbm5lY3RlZEJsb2NrID9cbiAgICAgICAgICAoY29ubmVjdGVkQmxvY2sucGF0aE9iamVjdCBhcyBQYXRoT2JqZWN0KS5vdXRwdXRTaGFwZVR5cGUgOlxuICAgICAgICAgIGVsZW0uc2hhcGUudHlwZTtcbiAgICAgIGlmIChpbm5lclNoYXBlID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIHZhbHVlIHRvIHN0YWNrIC8gdmFsdWUgdG8gc3RhdGVtZW50IGJsb2Nrcy5cbiAgICAgIGlmIChjb25uZWN0ZWRCbG9jayAmJiBjb25uZWN0ZWRCbG9jay5vdXRwdXRDb25uZWN0aW9uICYmXG4gICAgICAgICAgKGNvbm5lY3RlZEJsb2NrLnN0YXRlbWVudElucHV0Q291bnQgfHxcbiAgICAgICAgICAgY29ubmVjdGVkQmxvY2submV4dENvbm5lY3Rpb24pKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgLy8gU3BlY2lhbCBjYXNlIGZvciBoZXhhZ29uYWwgb3V0cHV0LlxuICAgICAgaWYgKG91dGVyU2hhcGUgPT09IGNvbnN0YW50cy5TSEFQRVMuSEVYQUdPTkFMICYmXG4gICAgICAgICAgb3V0ZXJTaGFwZSAhPT0gaW5uZXJTaGFwZSkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb25uZWN0aW9uV2lkdGggLVxuICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5TSEFQRV9JTl9TSEFQRV9QQURESU5HW291dGVyU2hhcGVdW2lubmVyU2hhcGVdO1xuICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNGaWVsZChlbGVtKSAmJiBlbGVtIGluc3RhbmNlb2YgRmllbGQpIHtcbiAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdGV4dCBpbnB1dHMuXG4gICAgICBpZiAob3V0ZXJTaGFwZSA9PT0gY29uc3RhbnRzLlNIQVBFUy5ST1VORCAmJlxuICAgICAgICAgIGVsZW0uZmllbGQgaW5zdGFuY2VvZiBGaWVsZFRleHRJbnB1dCkge1xuICAgICAgICByZXR1cm4gY29ubmVjdGlvbldpZHRoIC0gMi43NSAqIGNvbnN0YW50cy5HUklEX1VOSVQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29ubmVjdGlvbldpZHRoIC1cbiAgICAgICAgICB0aGlzLmNvbnN0YW50c18uU0hBUEVfSU5fU0hBUEVfUEFERElOR1tvdXRlclNoYXBlXVswXTtcbiAgICB9IGVsc2UgaWYgKFR5cGVzLmlzSWNvbihlbGVtKSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5TTUFMTF9QQURESU5HO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5hbGl6ZSB2ZXJ0aWNhbCBhbGlnbm1lbnQgb2Ygcm93cyBvbiBhIGJsb2NrLiAgSW4gcGFydGljdWxhciwgcmVkdWNlIHRoZVxuICAgKiBpbXBsaWNpdCBzcGFjaW5nIHdoZW4gYSBub24tc2hhZG93IGJsb2NrIGlzIGNvbm5lY3RlZCB0byBhbnkgb2YgYW4gaW5wdXRcbiAgICogcm93J3MgaW5saW5lIGlucHV0cy5cbiAgICovXG4gIHByb3RlY3RlZCBmaW5hbGl6ZVZlcnRpY2FsQWxpZ25tZW50XygpIHtcbiAgICBpZiAodGhpcy5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFJ1biB0aHJvdWdoIGV2ZXJ5IGlucHV0IHJvdyBvbiB0aGUgYmxvY2sgYW5kIG9ubHkgYXBwbHkgdGlnaHQgbmVzdGluZ1xuICAgIC8vIGxvZ2ljIHRvIGlucHV0IHJvd3MgdGhhdCBoYXZlIGEgcHJldiBhbmQgbmV4dCBub3RjaC5cbiAgICBmb3IgKGxldCBpID0gMjsgaSA8IHRoaXMucm93cy5sZW5ndGggLSAxOyBpICs9IDIpIHtcbiAgICAgIGNvbnN0IHByZXZTcGFjZXIgPSB0aGlzLnJvd3NbaSAtIDFdIGFzIFNwYWNlclJvdztcbiAgICAgIGNvbnN0IHJvdyA9IHRoaXMucm93c1tpXTtcbiAgICAgIGNvbnN0IG5leHRTcGFjZXIgPSB0aGlzLnJvd3NbaSArIDFdIGFzIFNwYWNlclJvdztcblxuICAgICAgY29uc3QgZmlyc3RSb3cgPSBpID09PSAyO1xuICAgICAgY29uc3QgaGFzUHJldk5vdGNoID0gZmlyc3RSb3cgPyAhIXRoaXMudG9wUm93Lmhhc1ByZXZpb3VzQ29ubmVjdGlvbiA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICEhcHJldlNwYWNlci5mb2xsb3dzU3RhdGVtZW50O1xuICAgICAgY29uc3QgaGFzTmV4dE5vdGNoID0gaSArIDIgPj0gdGhpcy5yb3dzLmxlbmd0aCAtIDEgP1xuICAgICAgICAgICEhdGhpcy5ib3R0b21Sb3cuaGFzTmV4dENvbm5lY3Rpb24gOlxuICAgICAgICAgICEhbmV4dFNwYWNlci5wcmVjZWRlc1N0YXRlbWVudDtcblxuICAgICAgaWYgKGhhc1ByZXZOb3RjaCkge1xuICAgICAgICBjb25zdCBlbGVtID0gcm93LmVsZW1lbnRzWzFdO1xuICAgICAgICBjb25zdCBoYXNTaW5nbGVUZXh0T3JJbWFnZUZpZWxkID0gcm93LmVsZW1lbnRzLmxlbmd0aCA9PT0gMyAmJlxuICAgICAgICAgICAgZWxlbSBpbnN0YW5jZW9mIEZpZWxkICYmXG4gICAgICAgICAgICAoZWxlbS5maWVsZCBpbnN0YW5jZW9mIEZpZWxkTGFiZWwgfHxcbiAgICAgICAgICAgICBlbGVtLmZpZWxkIGluc3RhbmNlb2YgRmllbGRJbWFnZSk7XG4gICAgICAgIGlmICghZmlyc3RSb3cgJiYgaGFzU2luZ2xlVGV4dE9ySW1hZ2VGaWVsZCkge1xuICAgICAgICAgIC8vIFJlbW92ZSBzb21lIHBhZGRpbmcgaWYgd2UgaGF2ZSBhIHNpbmdsZSBpbWFnZSBvciB0ZXh0IGZpZWxkLlxuICAgICAgICAgIHByZXZTcGFjZXIuaGVpZ2h0IC09IHRoaXMuY29uc3RhbnRzXy5TTUFMTF9QQURESU5HO1xuICAgICAgICAgIG5leHRTcGFjZXIuaGVpZ2h0IC09IHRoaXMuY29uc3RhbnRzXy5TTUFMTF9QQURESU5HO1xuICAgICAgICAgIHJvdy5oZWlnaHQgLT0gdGhpcy5jb25zdGFudHNfLk1FRElVTV9QQURESU5HO1xuICAgICAgICB9IGVsc2UgaWYgKCFmaXJzdFJvdyAmJiAhaGFzTmV4dE5vdGNoKSB7XG4gICAgICAgICAgLy8gQWRkIGEgc21hbGwgcGFkZGluZyBzbyB0aGUgbm90Y2ggZG9lc24ndCBjbGFzaCB3aXRoIGlucHV0cy9maWVsZHMuXG4gICAgICAgICAgcHJldlNwYWNlci5oZWlnaHQgKz0gdGhpcy5jb25zdGFudHNfLlNNQUxMX1BBRERJTkc7XG4gICAgICAgIH0gZWxzZSBpZiAoaGFzTmV4dE5vdGNoKSB7XG4gICAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBpbnB1dCByb3cgaGFzIG5vbi1zaGFkb3cgY29ubmVjdGVkIGJsb2Nrcy5cbiAgICAgICAgICBsZXQgaGFzTm9uU2hhZG93Q29ubmVjdGVkQmxvY2tzID0gZmFsc2U7XG4gICAgICAgICAgY29uc3QgbWluVmVydGljYWxUaWdodE5lc3RpbmdIZWlnaHQgPSA0MDtcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJvdy5lbGVtZW50cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY29uc3QgZWxlbSA9IHJvdy5lbGVtZW50c1tqXTtcbiAgICAgICAgICAgIGlmIChlbGVtIGluc3RhbmNlb2YgSW5wdXRDb25uZWN0aW9uICYmIFR5cGVzLmlzSW5saW5lSW5wdXQoZWxlbSkgJiZcbiAgICAgICAgICAgICAgICBlbGVtLmNvbm5lY3RlZEJsb2NrICYmICFlbGVtLmNvbm5lY3RlZEJsb2NrLmlzU2hhZG93KCkgJiZcbiAgICAgICAgICAgICAgICBlbGVtLmNvbm5lY3RlZEJsb2NrLmdldEhlaWdodFdpZHRoKCkuaGVpZ2h0ID49XG4gICAgICAgICAgICAgICAgICAgIG1pblZlcnRpY2FsVGlnaHROZXN0aW5nSGVpZ2h0KSB7XG4gICAgICAgICAgICAgIGhhc05vblNoYWRvd0Nvbm5lY3RlZEJsb2NrcyA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBBcHBseSB0aWdodC1uZXN0aW5nIGlmIHdlIGhhdmUgYm90aCBhIHByZXYgYW5kIG5leHQgbm90Y2ggYW5kIHRoZVxuICAgICAgICAgIC8vIGJsb2NrIGhhcyBub24tc2hhZG93IGNvbm5lY3RlZCBibG9ja3MuXG4gICAgICAgICAgaWYgKGhhc05vblNoYWRvd0Nvbm5lY3RlZEJsb2Nrcykge1xuICAgICAgICAgICAgcHJldlNwYWNlci5oZWlnaHQgLT0gdGhpcy5jb25zdGFudHNfLlNNQUxMX1BBRERJTkc7XG4gICAgICAgICAgICBuZXh0U3BhY2VyLmhlaWdodCAtPSB0aGlzLmNvbnN0YW50c18uU01BTExfUEFERElORztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBmaW5hbGl6ZV8oKSB7XG4gICAgdGhpcy5maW5hbGl6ZU91dHB1dENvbm5lY3Rpb25fKCk7XG4gICAgdGhpcy5maW5hbGl6ZUhvcml6b250YWxBbGlnbm1lbnRfKCk7XG4gICAgdGhpcy5maW5hbGl6ZVZlcnRpY2FsQWxpZ25tZW50XygpO1xuICAgIHN1cGVyLmZpbmFsaXplXygpO1xuXG4gICAgaWYgKHRoaXMucmlnaHRTaWRlKSB7XG4gICAgICB0aGlzLndpZHRoV2l0aENoaWxkcmVuICs9IHRoaXMucmlnaHRTaWRlLndpZHRoO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE1ldGhvZHMgZm9yIGdyYXBoaWNhbGx5IHJlbmRlcmluZyBhIG1hcmtlciBhcyBTVkcuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuemVsb3MuTWFya2VyU3ZnJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtBU1ROb2RlfSBmcm9tICcuLi8uLi9rZXlib2FyZF9uYXYvYXN0X25vZGUuanMnO1xuaW1wb3J0IHR5cGUge01hcmtlcn0gZnJvbSAnLi4vLi4va2V5Ym9hcmRfbmF2L21hcmtlci5qcyc7XG5pbXBvcnQgdHlwZSB7UmVuZGVyZWRDb25uZWN0aW9ufSBmcm9tICcuLi8uLi9yZW5kZXJlZF9jb25uZWN0aW9uLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi8uLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4uLy4uL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuLi8uLi93b3Jrc3BhY2Vfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyIGFzIEJhc2VDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7TWFya2VyU3ZnIGFzIEJhc2VNYXJrZXJTdmd9IGZyb20gJy4uL2NvbW1vbi9tYXJrZXJfc3ZnLmpzJztcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXIgYXMgWmVsb3NDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyB0byBkcmF3IGEgbWFya2VyLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnplbG9zLk1hcmtlclN2Z1xuICovXG5leHBvcnQgY2xhc3MgTWFya2VyU3ZnIGV4dGVuZHMgQmFzZU1hcmtlclN2ZyB7XG4gIC8vIFRPRE8oYi8xMDk4MTY5NTUpOiByZW1vdmUgJyEnLCBzZWUgZ28vc3RyaWN0LXByb3AtaW5pdC1maXguXG4gIGNvbnN0YW50c18hOiBaZWxvc0NvbnN0YW50UHJvdmlkZXI7XG5cbiAgcHJpdmF0ZSBtYXJrZXJDaXJjbGVfOiBTVkdDaXJjbGVFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgdGhlIG1hcmtlciBiZWxvbmdzIHRvLlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSBjb25zdGFudHMgZm9yIHRoZSByZW5kZXJlci5cbiAgICogQHBhcmFtIG1hcmtlciBUaGUgbWFya2VyIHRvIGRyYXcuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnLCBjb25zdGFudHM6IEJhc2VDb25zdGFudFByb3ZpZGVyLFxuICAgICAgbWFya2VyOiBNYXJrZXIpIHtcbiAgICBzdXBlcih3b3Jrc3BhY2UsIGNvbnN0YW50cywgbWFya2VyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3NpdGlvbiBhbmQgZGlzcGxheSB0aGUgbWFya2VyIGZvciBhbiBpbnB1dCBvciBhbiBvdXRwdXQgY29ubmVjdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGN1ck5vZGUgVGhlIG5vZGUgdG8gZHJhdyB0aGUgbWFya2VyIGZvci5cbiAgICovXG4gIHByaXZhdGUgc2hvd1dpdGhJbnB1dE91dHB1dF8oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIGNvbnN0IGJsb2NrID0gY3VyTm9kZS5nZXRTb3VyY2VCbG9jaygpIGFzIEJsb2NrU3ZnO1xuICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBjdXJOb2RlLmdldExvY2F0aW9uKCkgYXMgUmVuZGVyZWRDb25uZWN0aW9uO1xuICAgIGNvbnN0IG9mZnNldEluQmxvY2sgPSBjb25uZWN0aW9uLmdldE9mZnNldEluQmxvY2soKTtcblxuICAgIHRoaXMucG9zaXRpb25DaXJjbGVfKG9mZnNldEluQmxvY2sueCwgb2Zmc2V0SW5CbG9jay55KTtcbiAgICB0aGlzLnNldFBhcmVudF8oYmxvY2spO1xuICAgIHRoaXMuc2hvd0N1cnJlbnRfKCk7XG4gIH1cblxuICBvdmVycmlkZSBzaG93V2l0aE91dHB1dF8oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIHRoaXMuc2hvd1dpdGhJbnB1dE91dHB1dF8oY3VyTm9kZSk7XG4gIH1cblxuICBvdmVycmlkZSBzaG93V2l0aElucHV0XyhjdXJOb2RlOiBBU1ROb2RlKSB7XG4gICAgdGhpcy5zaG93V2l0aElucHV0T3V0cHV0XyhjdXJOb2RlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgcmVjdGFuZ2xlIGFyb3VuZCB0aGUgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBjdXJOb2RlIFRoZSBjdXJyZW50IG5vZGUgb2YgdGhlIG1hcmtlci5cbiAgICovXG4gIG92ZXJyaWRlIHNob3dXaXRoQmxvY2tfKGN1ck5vZGU6IEFTVE5vZGUpIHtcbiAgICBjb25zdCBibG9jayA9IGN1ck5vZGUuZ2V0TG9jYXRpb24oKSBhcyBCbG9ja1N2ZztcblxuICAgIC8vIEdldHMgdGhlIGhlaWdodCBhbmQgd2lkdGggb2YgZW50aXJlIHN0YWNrLlxuICAgIGNvbnN0IGhlaWdodFdpZHRoID0gYmxvY2suZ2V0SGVpZ2h0V2lkdGgoKTtcbiAgICAvLyBBZGQgcGFkZGluZyBzbyB0aGF0IGJlaW5nIG9uIGEgc3RhY2sgbG9va3MgZGlmZmVyZW50IHRoYW4gYmVpbmcgb24gYVxuICAgIC8vIGJsb2NrLlxuICAgIHRoaXMucG9zaXRpb25SZWN0XygwLCAwLCBoZWlnaHRXaWR0aC53aWR0aCwgaGVpZ2h0V2lkdGguaGVpZ2h0KTtcbiAgICB0aGlzLnNldFBhcmVudF8oYmxvY2spO1xuICAgIHRoaXMuc2hvd0N1cnJlbnRfKCk7XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb24gdGhlIGNpcmNsZSB3ZSB1c2UgZm9yIGlucHV0IGFuZCBvdXRwdXQgY29ubmVjdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSB4IFRoZSB4IHBvc2l0aW9uIG9mIHRoZSBjaXJjbGUuXG4gICAqIEBwYXJhbSB5IFRoZSB5IHBvc2l0aW9uIG9mIHRoZSBjaXJjbGUuXG4gICAqL1xuICBwcml2YXRlIHBvc2l0aW9uQ2lyY2xlXyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMubWFya2VyQ2lyY2xlXz8uc2V0QXR0cmlidXRlKCdjeCcsIHgudG9TdHJpbmcoKSk7XG4gICAgdGhpcy5tYXJrZXJDaXJjbGVfPy5zZXRBdHRyaWJ1dGUoJ2N5JywgeS50b1N0cmluZygpKTtcbiAgICB0aGlzLmN1cnJlbnRNYXJrZXJTdmcgPSB0aGlzLm1hcmtlckNpcmNsZV87XG4gIH1cblxuICBvdmVycmlkZSBoaWRlKCkge1xuICAgIHN1cGVyLmhpZGUoKTtcbiAgICBpZiAodGhpcy5tYXJrZXJDaXJjbGVfKSB7XG4gICAgICB0aGlzLm1hcmtlckNpcmNsZV8uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBjcmVhdGVEb21JbnRlcm5hbF8oKSB7XG4gICAgLyogY2xhbmctZm9ybWF0IG9mZiAqL1xuICAgIC8qIFRoaXMgbWFya3VwIHdpbGwgYmUgZ2VuZXJhdGVkIGFuZCBhZGRlZCB0byB0aGUgLnN2Z0dyb3VwXzpcbiAgICAgICAgPGc+XG4gICAgICAgICAgPHJlY3Qgd2lkdGg9XCIxMDBcIiBoZWlnaHQ9XCI1XCI+XG4gICAgICAgICAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVUeXBlPVwiWE1MXCIgYXR0cmlidXRlTmFtZT1cImZpbGxcIiBkdXI9XCIxc1wiXG4gICAgICAgICAgICAgIHZhbHVlcz1cInRyYW5zcGFyZW50O3RyYW5zcGFyZW50OyNmZmY7dHJhbnNwYXJlbnRcIiByZXBlYXRDb3VudD1cImluZGVmaW5pdGVcIiAvPlxuICAgICAgICAgIDwvcmVjdD5cbiAgICAgICAgPC9nPlxuICAgICAgICAqL1xuICAgIC8qIGNsYW5nLWZvcm1hdCBvbiAqL1xuICAgIHN1cGVyLmNyZWF0ZURvbUludGVybmFsXygpO1xuXG4gICAgdGhpcy5tYXJrZXJDaXJjbGVfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5DSVJDTEUsIHtcbiAgICAgICAgICAncic6IHRoaXMuY29uc3RhbnRzXy5DVVJTT1JfUkFESVVTLFxuICAgICAgICAgICdzdHlsZSc6ICdkaXNwbGF5OiBub25lJyxcbiAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogdGhpcy5jb25zdGFudHNfLkNVUlNPUl9TVFJPS0VfV0lEVEgsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMubWFya2VyU3ZnXyk7XG5cbiAgICAvLyBNYXJrZXJzIGFuZCBzdGFjayBjdXJzb3JzIGRvbid0IGJsaW5rLlxuICAgIGlmICh0aGlzLmlzQ3Vyc29yKCkpIHtcbiAgICAgIGNvbnN0IGJsaW5rUHJvcGVydGllcyA9IHRoaXMuZ2V0QmxpbmtQcm9wZXJ0aWVzXygpO1xuICAgICAgZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkFOSU1BVEUsIGJsaW5rUHJvcGVydGllcywgdGhpcy5tYXJrZXJDaXJjbGVfISk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMubWFya2VyU3ZnXyE7XG4gIH1cblxuICBvdmVycmlkZSBhcHBseUNvbG91cl8oY3VyTm9kZTogQVNUTm9kZSkge1xuICAgIHN1cGVyLmFwcGx5Q29sb3VyXyhjdXJOb2RlKTtcblxuICAgIHRoaXMubWFya2VyQ2lyY2xlXz8uc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5jb2xvdXJfKTtcbiAgICB0aGlzLm1hcmtlckNpcmNsZV8/LnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgdGhpcy5jb2xvdXJfKTtcblxuICAgIGlmICh0aGlzLmlzQ3Vyc29yKCkpIHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMuY29sb3VyXyArICc7dHJhbnNwYXJlbnQ7dHJhbnNwYXJlbnQ7JztcbiAgICAgIHRoaXMubWFya2VyQ2lyY2xlXz8uZmlyc3RFbGVtZW50Q2hpbGQhLnNldEF0dHJpYnV0ZSgndmFsdWVzJywgdmFsdWVzKTtcbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBvd25zIGEgYmxvY2sncyByZW5kZXJpbmcgU1ZHIGVsZW1lbnRzLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnplbG9zLlBhdGhPYmplY3QnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Nvbm5lY3Rpb259IGZyb20gJy4uLy4uL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3R5bGV9IGZyb20gJy4uLy4uL3RoZW1lLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi8uLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4uLy4uL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQge1BhdGhPYmplY3QgYXMgQmFzZVBhdGhPYmplY3R9IGZyb20gJy4uL2NvbW1vbi9wYXRoX29iamVjdC5qcyc7XG5cbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBoYW5kbGVzIGNyZWF0aW5nIGFuZCBzZXR0aW5nIGVhY2ggb2YgdGhlIFNWRyBlbGVtZW50c1xuICogdXNlZCBieSB0aGUgcmVuZGVyZXIuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuemVsb3MuUGF0aE9iamVjdFxuICovXG5leHBvcnQgY2xhc3MgUGF0aE9iamVjdCBleHRlbmRzIEJhc2VQYXRoT2JqZWN0IHtcbiAgLyoqIFRoZSBzZWxlY3RlZCBwYXRoIG9mIHRoZSBibG9jay4gKi9cbiAgcHJpdmF0ZSBzdmdQYXRoU2VsZWN0ZWRfOiBTVkdFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgb3V0bGluZSBwYXRocyBvbiB0aGUgYmxvY2suICovXG4gIHByaXZhdGUgcmVhZG9ubHkgb3V0bGluZXMgPSBuZXcgTWFwPHN0cmluZywgU1ZHRWxlbWVudD4oKTtcblxuICAvKipcbiAgICogQSBzZXQgdXNlZCB0byBkZXRlcm1pbmUgd2hpY2ggb3V0bGluZXMgd2VyZSB1c2VkIGR1cmluZyBhIGRyYXcgcGFzcy4gIFRoZVxuICAgKiBzZXQgaXMgaW5pdGlhbGl6ZWQgd2l0aCBhIHJlZmVyZW5jZSB0byBhbGwgdGhlIG91dGxpbmVzIGluXG4gICAqIGB0aGlzLm91dGxpbmVzYC4gRXZlcnkgdGltZSB3ZSB1c2UgYW4gb3V0bGluZSBkdXJpbmcgdGhlIGRyYXcgcGFzcywgdGhlXG4gICAqIHJlZmVyZW5jZSBpcyByZW1vdmVkIGZyb20gdGhpcyBzZXQuXG4gICAqL1xuICBwcml2YXRlIHJlbWFpbmluZ091dGxpbmVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGJsb2NrJ3Mgb3V0cHV0IGNvbm5lY3Rpb24gc2hhcGUuICBUaGlzIGlzIHNldCB3aGVuIGEgYmxvY2tcbiAgICogd2l0aCBhbiBvdXRwdXQgY29ubmVjdGlvbiBpcyBkcmF3bi5cbiAgICovXG4gIG91dHB1dFNoYXBlVHlwZTogbnVtYmVyfG51bGwgPSBudWxsO1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIG92ZXJyaWRlIGNvbnN0YW50czogQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKipcbiAgICogQHBhcmFtIHJvb3QgVGhlIHJvb3QgU1ZHIGVsZW1lbnQuXG4gICAqIEBwYXJhbSBzdHlsZSBUaGUgc3R5bGUgb2JqZWN0IHRvIHVzZSBmb3IgY29sb3VyaW5nLlxuICAgKiBAcGFyYW0gY29uc3RhbnRzIFRoZSByZW5kZXJlcidzIGNvbnN0YW50cy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIHJvb3Q6IFNWR0VsZW1lbnQsIHN0eWxlOiBCbG9ja1N0eWxlLCBjb25zdGFudHM6IENvbnN0YW50UHJvdmlkZXIpIHtcbiAgICBzdXBlcihyb290LCBzdHlsZSwgY29uc3RhbnRzKTtcblxuICAgIHRoaXMuY29uc3RhbnRzID0gY29uc3RhbnRzO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2V0UGF0aChwYXRoU3RyaW5nOiBzdHJpbmcpIHtcbiAgICBzdXBlci5zZXRQYXRoKHBhdGhTdHJpbmcpO1xuICAgIGlmICh0aGlzLnN2Z1BhdGhTZWxlY3RlZF8pIHtcbiAgICAgIHRoaXMuc3ZnUGF0aFNlbGVjdGVkXy5zZXRBdHRyaWJ1dGUoJ2QnLCBwYXRoU3RyaW5nKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBhcHBseUNvbG91cihibG9jazogQmxvY2tTdmcpIHtcbiAgICBzdXBlci5hcHBseUNvbG91cihibG9jayk7XG4gICAgLy8gU2V0IHNoYWRvdyBzdHJva2UgY29sb3VyLlxuICAgIGNvbnN0IHBhcmVudCA9IGJsb2NrLmdldFBhcmVudCgpO1xuICAgIGlmIChibG9jay5pc1NoYWRvdygpICYmIHBhcmVudCkge1xuICAgICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgcGFyZW50LnN0eWxlLmNvbG91clRlcnRpYXJ5KTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBjb2xvdXIgdG8gb3V0bGluZXMuXG4gICAgZm9yIChjb25zdCBvdXRsaW5lIG9mIHRoaXMub3V0bGluZXMudmFsdWVzKCkpIHtcbiAgICAgIG91dGxpbmUuc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5zdHlsZS5jb2xvdXJUZXJ0aWFyeSk7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgZmxpcFJUTCgpIHtcbiAgICBzdXBlci5mbGlwUlRMKCk7XG4gICAgLy8gTWlycm9yIGVhY2ggaW5wdXQgb3V0bGluZSBwYXRoLlxuICAgIGZvciAoY29uc3Qgb3V0bGluZSBvZiB0aGlzLm91dGxpbmVzLnZhbHVlcygpKSB7XG4gICAgICBvdXRsaW5lLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgJ3NjYWxlKC0xIDEpJyk7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgdXBkYXRlU2VsZWN0ZWQoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5zZXRDbGFzc18oJ2Jsb2NrbHlTZWxlY3RlZCcsIGVuYWJsZSk7XG4gICAgaWYgKGVuYWJsZSkge1xuICAgICAgaWYgKCF0aGlzLnN2Z1BhdGhTZWxlY3RlZF8pIHtcbiAgICAgICAgdGhpcy5zdmdQYXRoU2VsZWN0ZWRfID0gdGhpcy5zdmdQYXRoLmNsb25lTm9kZSh0cnVlKSBhcyBTVkdFbGVtZW50O1xuICAgICAgICB0aGlzLnN2Z1BhdGhTZWxlY3RlZF8uc2V0QXR0cmlidXRlKCdmaWxsJywgJ25vbmUnKTtcbiAgICAgICAgdGhpcy5zdmdQYXRoU2VsZWN0ZWRfLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAgICdmaWx0ZXInLCAndXJsKCMnICsgdGhpcy5jb25zdGFudHMuc2VsZWN0ZWRHbG93RmlsdGVySWQgKyAnKScpO1xuICAgICAgICB0aGlzLnN2Z1Jvb3QuYXBwZW5kQ2hpbGQodGhpcy5zdmdQYXRoU2VsZWN0ZWRfKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuc3ZnUGF0aFNlbGVjdGVkXykge1xuICAgICAgICB0aGlzLnN2Z1Jvb3QucmVtb3ZlQ2hpbGQodGhpcy5zdmdQYXRoU2VsZWN0ZWRfKTtcbiAgICAgICAgdGhpcy5zdmdQYXRoU2VsZWN0ZWRfID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSB1cGRhdGVSZXBsYWNlbWVudEZhZGUoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5zZXRDbGFzc18oJ2Jsb2NrbHlSZXBsYWNlYWJsZScsIGVuYWJsZSk7XG4gICAgaWYgKGVuYWJsZSkge1xuICAgICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAnZmlsdGVyJywgJ3VybCgjJyArIHRoaXMuY29uc3RhbnRzLnJlcGxhY2VtZW50R2xvd0ZpbHRlcklkICsgJyknKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdmdQYXRoLnJlbW92ZUF0dHJpYnV0ZSgnZmlsdGVyJyk7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgdXBkYXRlU2hhcGVGb3JJbnB1dEhpZ2hsaWdodChjb25uOiBDb25uZWN0aW9uLCBlbmFibGU6IGJvb2xlYW4pIHtcbiAgICBjb25zdCBuYW1lID0gY29ubi5nZXRQYXJlbnRJbnB1dCgpIS5uYW1lO1xuICAgIGNvbnN0IG91dGxpbmVQYXRoID0gdGhpcy5nZXRPdXRsaW5lUGF0aF8obmFtZSk7XG4gICAgaWYgKCFvdXRsaW5lUGF0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZW5hYmxlKSB7XG4gICAgICBvdXRsaW5lUGF0aC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgJ2ZpbHRlcicsICd1cmwoIycgKyB0aGlzLmNvbnN0YW50cy5yZXBsYWNlbWVudEdsb3dGaWx0ZXJJZCArICcpJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dGxpbmVQYXRoLnJlbW92ZUF0dHJpYnV0ZSgnZmlsdGVyJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0aGF0J3MgY2FsbGVkIHdoZW4gdGhlIGRyYXdlciBpcyBhYm91dCB0byBkcmF3IHRoZSBibG9jay5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBiZWdpbkRyYXdpbmcoKSB7XG4gICAgdGhpcy5yZW1haW5pbmdPdXRsaW5lcy5jbGVhcigpO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIHRoaXMub3V0bGluZXMua2V5cygpKSB7XG4gICAgICB0aGlzLnJlbWFpbmluZ091dGxpbmVzLmFkZChrZXkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNZXRob2QgdGhhdCdzIGNhbGxlZCB3aGVuIHRoZSBkcmF3ZXIgaXMgZG9uZSBkcmF3aW5nLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGVuZERyYXdpbmcoKSB7XG4gICAgLy8gR28gdGhyb3VnaCBhbGwgcmVtYWluaW5nIG91dGxpbmVzIHRoYXQgd2VyZSBub3QgdXNlZCB0aGlzIGRyYXcgcGFzcywgYW5kXG4gICAgLy8gcmVtb3ZlIHRoZW0uXG4gICAgaWYgKHRoaXMucmVtYWluaW5nT3V0bGluZXMuc2l6ZSkge1xuICAgICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5yZW1haW5pbmdPdXRsaW5lcykge1xuICAgICAgICB0aGlzLnJlbW92ZU91dGxpbmVQYXRoXyhrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnJlbWFpbmluZ091dGxpbmVzLmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBwYXRoIGdlbmVyYXRlZCBieSB0aGUgcmVuZGVyZXIgZm9yIGFuIG91dGxpbmUgcGF0aCBvbiB0aGVcbiAgICogcmVzcGVjdGl2ZSBvdXRsaW5lIHBhdGggU1ZHIGVsZW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBpbnB1dCBuYW1lLlxuICAgKiBAcGFyYW0gcGF0aFN0cmluZyBUaGUgcGF0aC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRPdXRsaW5lUGF0aChuYW1lOiBzdHJpbmcsIHBhdGhTdHJpbmc6IHN0cmluZykge1xuICAgIGNvbnN0IG91dGxpbmUgPSB0aGlzLmdldE91dGxpbmVQYXRoXyhuYW1lKTtcbiAgICBvdXRsaW5lLnNldEF0dHJpYnV0ZSgnZCcsIHBhdGhTdHJpbmcpO1xuICAgIG91dGxpbmUuc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5zdHlsZS5jb2xvdXJUZXJ0aWFyeSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlJ3MgYW4gb3V0bGluZSBwYXRoIGZvciB0aGUgc3BlY2lmaWVkIGlucHV0LlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgaW5wdXQgbmFtZS5cbiAgICogQHJldHVybnMgVGhlIFNWRyBvdXRsaW5lIHBhdGguXG4gICAqL1xuICBwcml2YXRlIGdldE91dGxpbmVQYXRoXyhuYW1lOiBzdHJpbmcpOiBTVkdFbGVtZW50IHtcbiAgICBpZiAoIXRoaXMub3V0bGluZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLm91dGxpbmVzLnNldChcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgICAgICBTdmcuUEFUSCwge1xuICAgICAgICAgICAgICAgICdjbGFzcyc6XG4gICAgICAgICAgICAgICAgICAgICdibG9ja2x5T3V0bGluZVBhdGgnLCAgLy8gSUUgZG9lc24ndCBsaWtlIHBhdGhzIHdpdGhvdXQgdGhlXG4gICAgICAgICAgICAgICAgLy8gZGF0YSBkZWZpbml0aW9uLCBzZXQgZW1wdHlcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0XG4gICAgICAgICAgICAgICAgJ2QnOiAnJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGhpcy5zdmdSb290KSk7XG4gICAgfVxuICAgIHRoaXMucmVtYWluaW5nT3V0bGluZXMuZGVsZXRlKG5hbWUpO1xuICAgIHJldHVybiB0aGlzLm91dGxpbmVzLmdldChuYW1lKSE7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFuIG91dGxpbmUgcGF0aCB0aGF0IGlzIGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIGlucHV0LlxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgaW5wdXQgbmFtZS5cbiAgICovXG4gIHByaXZhdGUgcmVtb3ZlT3V0bGluZVBhdGhfKG5hbWU6IHN0cmluZykge1xuICAgIHRoaXMub3V0bGluZXMuZ2V0KG5hbWUpPy5wYXJlbnROb2RlPy5yZW1vdmVDaGlsZCh0aGlzLm91dGxpbmVzLmdldChuYW1lKSEpO1xuICAgIHRoaXMub3V0bGluZXMuZGVsZXRlKG5hbWUpO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogWmVsb3MgcmVuZGVyZXIuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuemVsb3MuUmVuZGVyZXInKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Nvbm5lY3Rpb259IGZyb20gJy4uLy4uL2Nvbm5lY3Rpb24uanMnO1xuaW1wb3J0IHtDb25uZWN0aW9uVHlwZX0gZnJvbSAnLi4vLi4vY29ubmVjdGlvbl90eXBlLmpzJztcbmltcG9ydCB7SW5zZXJ0aW9uTWFya2VyTWFuYWdlcn0gZnJvbSAnLi4vLi4vaW5zZXJ0aW9uX21hcmtlcl9tYW5hZ2VyLmpzJztcbmltcG9ydCB0eXBlIHtNYXJrZXJ9IGZyb20gJy4uLy4uL2tleWJvYXJkX25hdi9tYXJrZXIuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlcmVkQ29ubmVjdGlvbn0gZnJvbSAnLi4vLi4vcmVuZGVyZWRfY29ubmVjdGlvbi5qcyc7XG5pbXBvcnQgdHlwZSB7QmxvY2tTdHlsZX0gZnJvbSAnLi4vLi4vdGhlbWUuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi4vLi4vd29ya3NwYWNlX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja1JlbmRlcmluZyBmcm9tICcuLi9jb21tb24vYmxvY2tfcmVuZGVyaW5nLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJJbmZvIGFzIEJhc2VSZW5kZXJJbmZvfSBmcm9tICcuLi9jb21tb24vaW5mby5qcyc7XG5pbXBvcnQge1JlbmRlcmVyIGFzIEJhc2VSZW5kZXJlcn0gZnJvbSAnLi4vY29tbW9uL3JlbmRlcmVyLmpzJztcblxuaW1wb3J0IHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQge0RyYXdlcn0gZnJvbSAnLi9kcmF3ZXIuanMnO1xuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHtNYXJrZXJTdmd9IGZyb20gJy4vbWFya2VyX3N2Zy5qcyc7XG5pbXBvcnQge1BhdGhPYmplY3R9IGZyb20gJy4vcGF0aF9vYmplY3QuanMnO1xuXG5cbi8qKlxuICogVGhlIHplbG9zIHJlbmRlcmVyLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LnplbG9zLlJlbmRlcmVyXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJlciBleHRlbmRzIEJhc2VSZW5kZXJlciB7XG4gIHByb3RlY3RlZCBvdmVycmlkZSBjb25zdGFudHNfITogQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKipcbiAgICogQHBhcmFtIG5hbWUgVGhlIHJlbmRlcmVyIG5hbWUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIGNvbnN0YW50IHByb3ZpZGVyLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgY29uc3RhbnQgcHJvdmlkZXIuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgbWFrZUNvbnN0YW50c18oKTogQ29uc3RhbnRQcm92aWRlciB7XG4gICAgcmV0dXJuIG5ldyBDb25zdGFudFByb3ZpZGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIHJlbmRlciBpbmZvIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBtZWFzdXJlLlxuICAgKiBAcmV0dXJucyBUaGUgcmVuZGVyIGluZm8gb2JqZWN0LlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIG1ha2VSZW5kZXJJbmZvXyhibG9jazogQmxvY2tTdmcpOiBSZW5kZXJJbmZvIHtcbiAgICByZXR1cm4gbmV3IFJlbmRlckluZm8odGhpcywgYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgcmVuZGVyZXIncyBkcmF3ZXIuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gcmVuZGVyLlxuICAgKiBAcGFyYW0gaW5mbyBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgaW5mb3JtYXRpb24gbmVlZGVkIHRvIHJlbmRlciB0aGlzXG4gICAqICAgICBibG9jay5cbiAgICogQHJldHVybnMgVGhlIGRyYXdlci5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBtYWtlRHJhd2VyXyhibG9jazogQmxvY2tTdmcsIGluZm86IEJhc2VSZW5kZXJJbmZvKTpcbiAgICAgIERyYXdlciB7XG4gICAgcmV0dXJuIG5ldyBEcmF3ZXIoYmxvY2ssIChpbmZvIGFzIFJlbmRlckluZm8pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJlbmRlcmVyJ3MgY3Vyc29yIGRyYXdlci5cbiAgICpcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgd29ya3NwYWNlIHRoZSBjdXJzb3IgYmVsb25ncyB0by5cbiAgICogQHBhcmFtIG1hcmtlciBUaGUgbWFya2VyLlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IGluIGNoYXJnZSBvZiBkcmF3aW5nIHRoZSBtYXJrZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgbWFrZU1hcmtlckRyYXdlcih3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZywgbWFya2VyOiBNYXJrZXIpOlxuICAgICAgTWFya2VyU3ZnIHtcbiAgICByZXR1cm4gbmV3IE1hcmtlclN2Zyh3b3Jrc3BhY2UsIHRoaXMuZ2V0Q29uc3RhbnRzKCksIG1hcmtlcik7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIGEgcmVuZGVyZXIgcGF0aCBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSByb290IFRoZSByb290IFNWRyBlbGVtZW50LlxuICAgKiBAcGFyYW0gc3R5bGUgVGhlIHN0eWxlIG9iamVjdCB0byB1c2UgZm9yIGNvbG91cmluZy5cbiAgICogQHJldHVybnMgVGhlIHJlbmRlcmVyIHBhdGggb2JqZWN0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIG1ha2VQYXRoT2JqZWN0KHJvb3Q6IFNWR0VsZW1lbnQsIHN0eWxlOiBCbG9ja1N0eWxlKTogUGF0aE9iamVjdCB7XG4gICAgcmV0dXJuIG5ldyBQYXRoT2JqZWN0KFxuICAgICAgICByb290LCBzdHlsZSwgKHRoaXMuZ2V0Q29uc3RhbnRzKCkgYXMgQ29uc3RhbnRQcm92aWRlcikpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCByZW5kZXJlcidzIGNvbnN0YW50IHByb3ZpZGVyLiAgV2UgYXNzdW1lIHRoYXQgd2hlbiB0aGlzIGlzXG4gICAqIGNhbGxlZCwgdGhlIHJlbmRlcmVyIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb25zdGFudCBwcm92aWRlci5cbiAgICovXG4gIG92ZXJyaWRlIGdldENvbnN0YW50cygpOiBDb25zdGFudFByb3ZpZGVyIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2hvdWxkSGlnaGxpZ2h0Q29ubmVjdGlvbihjb25uOiBDb25uZWN0aW9uKSB7XG4gICAgcmV0dXJuIGNvbm4udHlwZSAhPT0gQ29ubmVjdGlvblR5cGUuSU5QVVRfVkFMVUUgJiZcbiAgICAgICAgY29ubi50eXBlICE9PSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUU7XG4gIH1cblxuICBvdmVycmlkZSBnZXRDb25uZWN0aW9uUHJldmlld01ldGhvZChcbiAgICAgIGNsb3Nlc3Q6IFJlbmRlcmVkQ29ubmVjdGlvbiwgbG9jYWw6IFJlbmRlcmVkQ29ubmVjdGlvbixcbiAgICAgIHRvcEJsb2NrOiBCbG9ja1N2Zykge1xuICAgIGlmIChsb2NhbC50eXBlID09PSBDb25uZWN0aW9uVHlwZS5PVVRQVVRfVkFMVUUpIHtcbiAgICAgIGlmICghY2xvc2VzdC5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgIHJldHVybiBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyLlBSRVZJRVdfVFlQRS5JTlBVVF9PVVRMSU5FO1xuICAgICAgfVxuICAgICAgLy8gVE9ETzogUmV0dXJuaW5nIHRoaXMgaXMgYSB0b3RhbCBoYWNrLCBiZWNhdXNlIHdlIGRvbid0IHdhbnQgdG8gc2hvd1xuICAgICAgLy8gICBhIHJlcGxhY2VtZW50IGZhZGUsIHdlIHdhbnQgdG8gc2hvdyBhbiBvdXRsaW5lIGFmZmVjdC5cbiAgICAgIC8vICAgU2FkbHkgemVsb3MgZG9lcyBub3Qgc3VwcG9ydCBzaG93aW5nIGFuIG91dGxpbmUgYXJvdW5kIGZpbGxlZFxuICAgICAgLy8gICBpbnB1dHMsIHNvIHdlIGhhdmUgdG8gcHJldGVuZCBsaWtlIHRoZSBjb25uZWN0ZWQgYmxvY2sgaXMgZ2V0dGluZ1xuICAgICAgLy8gICByZXBsYWNlZC5cbiAgICAgIHJldHVybiBJbnNlcnRpb25NYXJrZXJNYW5hZ2VyLlBSRVZJRVdfVFlQRS5SRVBMQUNFTUVOVF9GQURFO1xuICAgIH1cblxuICAgIHJldHVybiBzdXBlci5nZXRDb25uZWN0aW9uUHJldmlld01ldGhvZChjbG9zZXN0LCBsb2NhbCwgdG9wQmxvY2spO1xuICB9XG59XG5cbmJsb2NrUmVuZGVyaW5nLnJlZ2lzdGVyKCd6ZWxvcycsIFJlbmRlcmVyKTtcbiIsIi8qKiBAZmlsZSBSZS1leHBvcnRzIG9mIEJsb2NrbHkuemVsb3MuKiBtb2R1bGVzLiAqL1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogUmUtZXhwb3J0cyBvZiBCbG9ja2x5LnplbG9zLiogbW9kdWxlcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkuemVsb3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS56ZWxvcycpO1xuXG5pbXBvcnQge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7RHJhd2VyfSBmcm9tICcuL2RyYXdlci5qcyc7XG5pbXBvcnQge1JlbmRlckluZm99IGZyb20gJy4vaW5mby5qcyc7XG5pbXBvcnQge01hcmtlclN2Z30gZnJvbSAnLi9tYXJrZXJfc3ZnLmpzJztcbmltcG9ydCB7Qm90dG9tUm93fSBmcm9tICcuL21lYXN1cmFibGVzL2JvdHRvbV9yb3cuanMnO1xuaW1wb3J0IHtTdGF0ZW1lbnRJbnB1dH0gZnJvbSAnLi9tZWFzdXJhYmxlcy9pbnB1dHMuanMnO1xuaW1wb3J0IHtSaWdodENvbm5lY3Rpb25TaGFwZX0gZnJvbSAnLi9tZWFzdXJhYmxlcy9yb3dfZWxlbWVudHMuanMnO1xuaW1wb3J0IHtUb3BSb3d9IGZyb20gJy4vbWVhc3VyYWJsZXMvdG9wX3Jvdy5qcyc7XG5pbXBvcnQge1BhdGhPYmplY3R9IGZyb20gJy4vcGF0aF9vYmplY3QuanMnO1xuaW1wb3J0IHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuZXhwb3J0IHtcbiAgQm90dG9tUm93LFxuICBDb25zdGFudFByb3ZpZGVyLFxuICBEcmF3ZXIsXG4gIE1hcmtlclN2ZyxcbiAgUGF0aE9iamVjdCxcbiAgUmVuZGVyZXIsXG4gIFJlbmRlckluZm8sXG4gIFJpZ2h0Q29ubmVjdGlvblNoYXBlLFxuICBTdGF0ZW1lbnRJbnB1dCxcbiAgVG9wUm93LFxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBOZXcgKGV2b2x2aW5nKSByZW5kZXJlci5cbiAqIFRocmFzb3M6IHNwaXJpdCBvZiBib2xkbmVzcy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS50aHJhc29zLlJlbmRlckluZm8nKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHtSZW5kZXJJbmZvIGFzIEJhc2VSZW5kZXJJbmZvfSBmcm9tICcuLi9jb21tb24vaW5mby5qcyc7XG5pbXBvcnQgdHlwZSB7TWVhc3VyYWJsZX0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvYmFzZS5qcyc7XG5pbXBvcnQgdHlwZSB7Qm90dG9tUm93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9ib3R0b21fcm93LmpzJztcbmltcG9ydCB0eXBlIHtGaWVsZH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvZmllbGQuanMnO1xuaW1wb3J0IHtJblJvd1NwYWNlcn0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvaW5fcm93X3NwYWNlci5qcyc7XG5pbXBvcnQgdHlwZSB7Um93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9yb3cuanMnO1xuaW1wb3J0IHR5cGUge1RvcFJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvdG9wX3Jvdy5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuLi9tZWFzdXJhYmxlcy90eXBlcy5qcyc7XG5cbmltcG9ydCB0eXBlIHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgc2l6aW5nIGluZm9ybWF0aW9uIG5lZWRlZCB0byBkcmF3IHRoaXMgYmxvY2suXG4gKlxuICogVGhpcyBtZWFzdXJlIHBhc3MgZG9lcyBub3QgcHJvcGFnYXRlIGNoYW5nZXMgdG8gdGhlIGJsb2NrIChhbHRob3VnaCBmaWVsZHNcbiAqIG1heSBjaG9vc2UgdG8gcmVyZW5kZXIgd2hlbiBnZXRTaXplKCkgaXMgY2FsbGVkKS4gIEhvd2V2ZXIsIGNhbGxpbmcgaXRcbiAqIHJlcGVhdGVkbHkgbWF5IGJlIGV4cGVuc2l2ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS50aHJhc29zLlJlbmRlckluZm9cbiAqL1xuZXhwb3J0IGNsYXNzIFJlbmRlckluZm8gZXh0ZW5kcyBCYXNlUmVuZGVySW5mbyB7XG4gIC8vIEV4Y2xhbWF0aW9uIGlzIGZpbmUgYi9jIHRoaXMgaXMgYXNzaWduZWQgYnkgdGhlIHN1cGVyIGNvbnN0cnVjdG9yLlxuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgcmVuZGVyZXJfITogUmVuZGVyZXI7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSByZW5kZXJlciBUaGUgcmVuZGVyZXIgaW4gdXNlLlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIG1lYXN1cmUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IocmVuZGVyZXI6IFJlbmRlcmVyLCBibG9jazogQmxvY2tTdmcpIHtcbiAgICBzdXBlcihyZW5kZXJlciwgYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYmxvY2sgcmVuZGVyZXIgaW4gdXNlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYmxvY2sgcmVuZGVyZXIgaW4gdXNlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGdldFJlbmRlcmVyKCk6IFJlbmRlcmVyIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlcl87XG4gIH1cblxuICBvdmVycmlkZSBhZGRFbGVtU3BhY2luZ18oKSB7XG4gICAgbGV0IGhhc0V4dGVybmFsSW5wdXRzID0gZmFsc2U7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHJvdyA9IHRoaXMucm93c1tpXTtcbiAgICAgIGlmIChyb3cuaGFzRXh0ZXJuYWxJbnB1dCkge1xuICAgICAgICBoYXNFeHRlcm5hbElucHV0cyA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgcm93ID0gdGhpcy5yb3dzW2ldO1xuICAgICAgY29uc3Qgb2xkRWxlbXMgPSByb3cuZWxlbWVudHM7XG4gICAgICByb3cuZWxlbWVudHMgPSBbXTtcbiAgICAgIC8vIE5vIHNwYWNpbmcgbmVlZGVkIGJlZm9yZSB0aGUgY29ybmVyIG9uIHRoZSB0b3Agcm93IG9yIHRoZSBib3R0b20gcm93LlxuICAgICAgaWYgKHJvdy5zdGFydHNXaXRoRWxlbVNwYWNlcigpKSB7XG4gICAgICAgIC8vIFRoZXJlJ3MgYSBzcGFjZXIgYmVmb3JlIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSByb3cuXG4gICAgICAgIHJvdy5lbGVtZW50cy5wdXNoKG5ldyBJblJvd1NwYWNlcihcbiAgICAgICAgICAgIHRoaXMuY29uc3RhbnRzXywgdGhpcy5nZXRJblJvd1NwYWNpbmdfKG51bGwsIG9sZEVsZW1zWzBdKSkpO1xuICAgICAgfVxuICAgICAgaWYgKCFvbGRFbGVtcy5sZW5ndGgpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBlID0gMDsgZSA8IG9sZEVsZW1zLmxlbmd0aCAtIDE7IGUrKykge1xuICAgICAgICByb3cuZWxlbWVudHMucHVzaChvbGRFbGVtc1tlXSk7XG4gICAgICAgIGNvbnN0IHNwYWNpbmcgPSB0aGlzLmdldEluUm93U3BhY2luZ18ob2xkRWxlbXNbZV0sIG9sZEVsZW1zW2UgKyAxXSk7XG4gICAgICAgIHJvdy5lbGVtZW50cy5wdXNoKG5ldyBJblJvd1NwYWNlcih0aGlzLmNvbnN0YW50c18sIHNwYWNpbmcpKTtcbiAgICAgIH1cbiAgICAgIHJvdy5lbGVtZW50cy5wdXNoKG9sZEVsZW1zW29sZEVsZW1zLmxlbmd0aCAtIDFdKTtcbiAgICAgIGlmIChyb3cuZW5kc1dpdGhFbGVtU3BhY2VyKCkpIHtcbiAgICAgICAgbGV0IHNwYWNpbmcgPVxuICAgICAgICAgICAgdGhpcy5nZXRJblJvd1NwYWNpbmdfKG9sZEVsZW1zW29sZEVsZW1zLmxlbmd0aCAtIDFdLCBudWxsKTtcbiAgICAgICAgaWYgKGhhc0V4dGVybmFsSW5wdXRzICYmIHJvdy5oYXNEdW1teUlucHV0KSB7XG4gICAgICAgICAgc3BhY2luZyArPSB0aGlzLmNvbnN0YW50c18uVEFCX1dJRFRIO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZXJlJ3MgYSBzcGFjZXIgYWZ0ZXIgdGhlIGxhc3QgZWxlbWVudCBpbiB0aGUgcm93LlxuICAgICAgICByb3cuZWxlbWVudHMucHVzaChuZXcgSW5Sb3dTcGFjZXIodGhpcy5jb25zdGFudHNfLCBzcGFjaW5nKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0SW5Sb3dTcGFjaW5nXyhwcmV2OiBNZWFzdXJhYmxlfG51bGwsIG5leHQ6IE1lYXN1cmFibGV8bnVsbCkge1xuICAgIGlmICghcHJldikge1xuICAgICAgLy8gQmV0d2VlbiBhbiBlZGl0YWJsZSBmaWVsZCBhbmQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcm93LlxuICAgICAgaWYgKG5leHQgJiYgVHlwZXMuaXNGaWVsZChuZXh0KSAmJiAobmV4dCBhcyBGaWVsZCkuaXNFZGl0YWJsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk1FRElVTV9QQURESU5HO1xuICAgICAgfVxuICAgICAgLy8gSW5saW5lIGlucHV0IGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJvdy5cbiAgICAgIGlmIChuZXh0ICYmIFR5cGVzLmlzSW5saW5lSW5wdXQobmV4dCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fTEFSR0VfUEFERElORztcbiAgICAgIH1cbiAgICAgIGlmIChuZXh0ICYmIFR5cGVzLmlzU3RhdGVtZW50SW5wdXQobmV4dCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5TVEFURU1FTlRfSU5QVVRfUEFERElOR19MRUZUO1xuICAgICAgfVxuICAgICAgLy8gQW55dGhpbmcgZWxzZSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSByb3cuXG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgfVxuXG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgbm9uLWlucHV0IGFuZCB0aGUgZW5kIG9mIHRoZSByb3cuXG4gICAgaWYgKCFUeXBlcy5pc0lucHV0KHByZXYpICYmICFuZXh0KSB7XG4gICAgICAvLyBCZXR3ZWVuIGFuIGVkaXRhYmxlIGZpZWxkIGFuZCB0aGUgZW5kIG9mIHRoZSByb3cuXG4gICAgICBpZiAoVHlwZXMuaXNGaWVsZChwcmV2KSAmJiAocHJldiBhcyBGaWVsZCkuaXNFZGl0YWJsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk1FRElVTV9QQURESU5HO1xuICAgICAgfVxuICAgICAgLy8gUGFkZGluZyBhdCB0aGUgZW5kIG9mIGFuIGljb24tb25seSByb3cgdG8gbWFrZSB0aGUgYmxvY2sgc2hhcGUgY2xlYXJlci5cbiAgICAgIGlmIChUeXBlcy5pc0ljb24ocHJldikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HICogMiArIDE7XG4gICAgICB9XG4gICAgICBpZiAoVHlwZXMuaXNIYXQocHJldikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5OT19QQURESU5HO1xuICAgICAgfVxuICAgICAgLy8gRXN0YWJsaXNoIGEgbWluaW11bSB3aWR0aCBmb3IgYSBibG9jayB3aXRoIGEgcHJldmlvdXMgb3IgbmV4dFxuICAgICAgLy8gY29ubmVjdGlvbi5cbiAgICAgIGlmIChUeXBlcy5pc1ByZXZpb3VzT3JOZXh0Q29ubmVjdGlvbihwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgICB9XG4gICAgICAvLyBCZXR3ZWVuIHJvdW5kZWQgY29ybmVyIGFuZCB0aGUgZW5kIG9mIHRoZSByb3cuXG4gICAgICBpZiAoVHlwZXMuaXNMZWZ0Um91bmRlZENvcm5lcihwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk1JTl9CTE9DS19XSURUSDtcbiAgICAgIH1cbiAgICAgIC8vIEJldHdlZW4gYSBqYWdnZWQgZWRnZSBhbmQgdGhlIGVuZCBvZiB0aGUgcm93LlxuICAgICAgaWYgKFR5cGVzLmlzSmFnZ2VkRWRnZShwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgICB9XG4gICAgICAvLyBCZXR3ZWVuIG5vbmVkaXRhYmxlIGZpZWxkcyBhbmQgaWNvbnMgYW5kIHRoZSBlbmQgb2YgdGhlIHJvdy5cbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG4gICAgLy8gQmV0d2VlbiBpbnB1dHMgYW5kIHRoZSBlbmQgb2YgdGhlIHJvdy5cbiAgICBpZiAoVHlwZXMuaXNJbnB1dChwcmV2KSAmJiAhbmV4dCkge1xuICAgICAgaWYgKFR5cGVzLmlzRXh0ZXJuYWxJbnB1dChwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQocHJldikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc1N0YXRlbWVudElucHV0KHByZXYpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTk9fUEFERElORztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTcGFjaW5nIGJldHdlZW4gYSBub24taW5wdXQgYW5kIGFuIGlucHV0LlxuICAgIGlmICghVHlwZXMuaXNJbnB1dChwcmV2KSAmJiBuZXh0ICYmIFR5cGVzLmlzSW5wdXQobmV4dCkpIHtcbiAgICAgIC8vIEJldHdlZW4gYW4gZWRpdGFibGUgZmllbGQgYW5kIGFuIGlucHV0LlxuICAgICAgaWYgKFR5cGVzLmlzRmllbGQocHJldikgJiYgKHByZXYgYXMgRmllbGQpLmlzRWRpdGFibGUpIHtcbiAgICAgICAgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQobmV4dCkpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLlNNQUxMX1BBRERJTkc7XG4gICAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNFeHRlcm5hbElucHV0KG5leHQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5TTUFMTF9QQURESU5HO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoVHlwZXMuaXNJbmxpbmVJbnB1dChuZXh0KSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUVESVVNX0xBUkdFX1BBRERJTkc7XG4gICAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNFeHRlcm5hbElucHV0KG5leHQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fTEFSR0VfUEFERElORztcbiAgICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc1N0YXRlbWVudElucHV0KG5leHQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkcgLSAxO1xuICAgIH1cblxuICAgIC8vIFNwYWNpbmcgYmV0d2VlbiBhbiBpY29uIGFuZCBhbiBpY29uIG9yIGZpZWxkLlxuICAgIGlmIChUeXBlcy5pc0ljb24ocHJldikgJiYgbmV4dCAmJiAhVHlwZXMuaXNJbnB1dChuZXh0KSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgIH1cblxuICAgIC8vIFNwYWNpbmcgYmV0d2VlbiBhbiBpbmxpbmUgaW5wdXQgYW5kIGEgZmllbGQuXG4gICAgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQocHJldikgJiYgbmV4dCAmJiBUeXBlcy5pc0ZpZWxkKG5leHQpKSB7XG4gICAgICAvLyBFZGl0YWJsZSBmaWVsZCBhZnRlciBpbmxpbmUgaW5wdXQuXG4gICAgICBpZiAoKG5leHQgYXMgRmllbGQpLmlzRWRpdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vbmVkaXRhYmxlIGZpZWxkIGFmdGVyIGlubGluZSBpbnB1dC5cbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChUeXBlcy5pc0xlZnRTcXVhcmVDb3JuZXIocHJldikgJiYgbmV4dCkge1xuICAgICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgaGF0IGFuZCBhIGNvcm5lclxuICAgICAgaWYgKFR5cGVzLmlzSGF0KG5leHQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTk9fUEFERElORztcbiAgICAgIH1cbiAgICAgIC8vIFNwYWNpbmcgYmV0d2VlbiBhIHNxdWFyZSBjb3JuZXIgYW5kIGEgcHJldmlvdXMgb3IgbmV4dCBjb25uZWN0aW9uXG4gICAgICBpZiAoVHlwZXMuaXNQcmV2aW91c0Nvbm5lY3Rpb24obmV4dCkgfHwgVHlwZXMuaXNOZXh0Q29ubmVjdGlvbihuZXh0KSkge1xuICAgICAgICByZXR1cm4gbmV4dC5ub3RjaE9mZnNldDtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgcm91bmRlZCBjb3JuZXIgYW5kIGEgcHJldmlvdXMgb3IgbmV4dCBjb25uZWN0aW9uLlxuICAgIGlmIChUeXBlcy5pc0xlZnRSb3VuZGVkQ29ybmVyKHByZXYpICYmIG5leHQpIHtcbiAgICAgIHJldHVybiBuZXh0Lm5vdGNoT2Zmc2V0IC0gdGhpcy5jb25zdGFudHNfLkNPUk5FUl9SQURJVVM7XG4gICAgfVxuXG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIHR3byBmaWVsZHMgb2YgdGhlIHNhbWUgZWRpdGFiaWxpdHkuXG4gICAgaWYgKFR5cGVzLmlzRmllbGQocHJldikgJiYgbmV4dCAmJiBUeXBlcy5pc0ZpZWxkKG5leHQpICYmXG4gICAgICAgIChwcmV2IGFzIEZpZWxkKS5pc0VkaXRhYmxlID09PSAobmV4dCBhcyBGaWVsZCkuaXNFZGl0YWJsZSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgIH1cblxuICAgIC8vIFNwYWNpbmcgYmV0d2VlbiBhbnl0aGluZyBhbmQgYSBqYWdnZWQgZWRnZS5cbiAgICBpZiAobmV4dCAmJiBUeXBlcy5pc0phZ2dlZEVkZ2UobmV4dCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk1FRElVTV9QQURESU5HO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0U3BhY2VyUm93SGVpZ2h0XyhwcmV2OiBSb3csIG5leHQ6IFJvdykge1xuICAgIC8vIElmIHdlIGhhdmUgYW4gZW1wdHkgYmxvY2sgYWRkIGEgc3BhY2VyIHRvIGluY3JlYXNlIHRoZSBoZWlnaHQuXG4gICAgaWYgKFR5cGVzLmlzVG9wUm93KHByZXYpICYmIFR5cGVzLmlzQm90dG9tUm93KG5leHQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkVNUFRZX0JMT0NLX1NQQUNFUl9IRUlHSFQ7XG4gICAgfVxuICAgIC8vIFRvcCBhbmQgYm90dG9tIHJvd3MgYWN0IGFzIGEgc3BhY2VyIHNvIHdlIGRvbid0IG5lZWQgYW55IGV4dHJhIHBhZGRpbmcuXG4gICAgaWYgKFR5cGVzLmlzVG9wUm93KHByZXYpIHx8IFR5cGVzLmlzQm90dG9tUm93KG5leHQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgfVxuICAgIGlmIChwcmV2Lmhhc0V4dGVybmFsSW5wdXQgJiYgbmV4dC5oYXNFeHRlcm5hbElucHV0KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgfVxuICAgIGlmICghcHJldi5oYXNTdGF0ZW1lbnQgJiYgbmV4dC5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uQkVUV0VFTl9TVEFURU1FTlRfUEFERElOR19ZO1xuICAgIH1cbiAgICBpZiAocHJldi5oYXNTdGF0ZW1lbnQgJiYgbmV4dC5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG4gICAgaWYgKHByZXYuaGFzRHVtbXlJbnB1dCB8fCBuZXh0Lmhhc0R1bW15SW5wdXQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEVsZW1DZW50ZXJsaW5lXyhyb3c6IFJvdywgZWxlbTogTWVhc3VyYWJsZSkge1xuICAgIGlmIChUeXBlcy5pc1NwYWNlcihlbGVtKSkge1xuICAgICAgcmV0dXJuIHJvdy55UG9zICsgZWxlbS5oZWlnaHQgLyAyO1xuICAgIH1cbiAgICBpZiAoVHlwZXMuaXNCb3R0b21Sb3cocm93KSkge1xuICAgICAgY29uc3QgYm90dG9tUm93ID0gcm93IGFzIEJvdHRvbVJvdztcbiAgICAgIGNvbnN0IGJhc2VsaW5lID1cbiAgICAgICAgICBib3R0b21Sb3cueVBvcyArIGJvdHRvbVJvdy5oZWlnaHQgLSBib3R0b21Sb3cuZGVzY2VuZGVySGVpZ2h0O1xuICAgICAgaWYgKFR5cGVzLmlzTmV4dENvbm5lY3Rpb24oZWxlbSkpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VsaW5lICsgZWxlbS5oZWlnaHQgLyAyO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VsaW5lIC0gZWxlbS5oZWlnaHQgLyAyO1xuICAgIH1cbiAgICBpZiAoVHlwZXMuaXNUb3BSb3cocm93KSkge1xuICAgICAgY29uc3QgdG9wUm93ID0gcm93IGFzIFRvcFJvdztcbiAgICAgIGlmIChUeXBlcy5pc0hhdChlbGVtKSkge1xuICAgICAgICByZXR1cm4gdG9wUm93LmNhcGxpbmUgLSBlbGVtLmhlaWdodCAvIDI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9wUm93LmNhcGxpbmUgKyBlbGVtLmhlaWdodCAvIDI7XG4gICAgfVxuXG4gICAgbGV0IHJlc3VsdCA9IHJvdy55UG9zO1xuICAgIGlmIChUeXBlcy5pc0ZpZWxkKGVsZW0pICYmIHJvdy5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgIGNvbnN0IG9mZnNldCA9XG4gICAgICAgICAgdGhpcy5jb25zdGFudHNfLlRBTExfSU5QVVRfRklFTERfT0ZGU0VUX1kgKyBlbGVtLmhlaWdodCAvIDI7XG4gICAgICByZXN1bHQgKz0gb2Zmc2V0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgKz0gcm93LmhlaWdodCAvIDI7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBvdmVycmlkZSBmaW5hbGl6ZV8oKSB7XG4gICAgLy8gUGVyZm9ybWFuY2Ugbm90ZTogdGhpcyBjb3VsZCBiZSBjb21iaW5lZCB3aXRoIHRoZSBkcmF3IHBhc3MsIGlmIHRoZSB0aW1lXG4gICAgLy8gdGhhdCB0aGlzIHRha2VzIGlzIGV4Y2Vzc2l2ZS4gIEJ1dCBpdCBzaG91bGRuJ3QgYmUsIGJlY2F1c2UgaXQgb25seVxuICAgIC8vIGFjY2Vzc2VzIGFuZCBzZXRzIHByb3BlcnRpZXMgdGhhdCBhbHJlYWR5IGV4aXN0IG9uIHRoZSBvYmplY3RzLlxuICAgIGxldCB3aWRlc3RSb3dXaXRoQ29ubmVjdGVkQmxvY2tzID0gMDtcbiAgICBsZXQgeUN1cnNvciA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHJvdyA9IHRoaXMucm93c1tpXTtcbiAgICAgIHJvdy55UG9zID0geUN1cnNvcjtcbiAgICAgIHJvdy54UG9zID0gdGhpcy5zdGFydFg7XG4gICAgICB5Q3Vyc29yICs9IHJvdy5oZWlnaHQ7XG5cbiAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgPVxuICAgICAgICAgIE1hdGgubWF4KHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MsIHJvdy53aWR0aFdpdGhDb25uZWN0ZWRCbG9ja3MpO1xuICAgICAgLy8gQWRkIHBhZGRpbmcgdG8gdGhlIGJvdHRvbSByb3cgaWYgYmxvY2sgaGVpZ2h0IGlzIGxlc3MgdGhhbiBtaW5pbXVtXG4gICAgICBjb25zdCBoZWlnaHRXaXRob3V0SGF0ID0geUN1cnNvciAtIHRoaXMudG9wUm93LmFzY2VuZGVySGVpZ2h0O1xuICAgICAgaWYgKHJvdyA9PT0gdGhpcy5ib3R0b21Sb3cgJiZcbiAgICAgICAgICBoZWlnaHRXaXRob3V0SGF0IDwgdGhpcy5jb25zdGFudHNfLk1JTl9CTE9DS19IRUlHSFQpIHtcbiAgICAgICAgLy8gQnV0IHRoZSBoYXQgaGVpZ2h0IHNob3VsZG4ndCBiZSBwYXJ0IG9mIHRoaXMuXG4gICAgICAgIGNvbnN0IGRpZmYgPSB0aGlzLmNvbnN0YW50c18uTUlOX0JMT0NLX0hFSUdIVCAtIGhlaWdodFdpdGhvdXRIYXQ7XG4gICAgICAgIHRoaXMuYm90dG9tUm93LmhlaWdodCArPSBkaWZmO1xuICAgICAgICB5Q3Vyc29yICs9IGRpZmY7XG4gICAgICB9XG4gICAgICB0aGlzLnJlY29yZEVsZW1Qb3NpdGlvbnNfKHJvdyk7XG4gICAgfVxuICAgIGlmICh0aGlzLm91dHB1dENvbm5lY3Rpb24gJiYgdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb24gJiZcbiAgICAgICAgdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb24udGFyZ2V0QmxvY2soKTtcbiAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgLy8gSW5jbHVkZSB3aWR0aCBvZiBjb25uZWN0ZWQgYmxvY2sgaW4gdmFsdWUgdG8gc3RhY2sgd2lkdGggbWVhc3VyZW1lbnQuXG4gICAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgPSBNYXRoLm1heChcbiAgICAgICAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MsIHRhcmdldC5nZXRIZWlnaHRXaWR0aCgpLndpZHRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmJvdHRvbVJvdy5iYXNlbGluZSA9IHlDdXJzb3IgLSB0aGlzLmJvdHRvbVJvdy5kZXNjZW5kZXJIZWlnaHQ7XG4gICAgdGhpcy53aWR0aFdpdGhDaGlsZHJlbiA9IHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgKyB0aGlzLnN0YXJ0WDtcblxuICAgIHRoaXMuaGVpZ2h0ID0geUN1cnNvcjtcbiAgICB0aGlzLnN0YXJ0WSA9IHRoaXMudG9wUm93LmNhcGxpbmU7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBUaHJhc29zIHJlbmRlcmVyLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnRocmFzb3MuUmVuZGVyZXInKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgYmxvY2tSZW5kZXJpbmcgZnJvbSAnLi4vY29tbW9uL2Jsb2NrX3JlbmRlcmluZy5qcyc7XG5pbXBvcnQge1JlbmRlcmVyIGFzIEJhc2VSZW5kZXJlcn0gZnJvbSAnLi4vY29tbW9uL3JlbmRlcmVyLmpzJztcblxuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuXG5cbi8qKlxuICogVGhlIHRocmFzb3MgcmVuZGVyZXIuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkudGhyYXNvcy5SZW5kZXJlclxuICovXG5leHBvcnQgY2xhc3MgUmVuZGVyZXIgZXh0ZW5kcyBCYXNlUmVuZGVyZXIge1xuICAvKipcbiAgICogQHBhcmFtIG5hbWUgVGhlIHJlbmRlcmVyIG5hbWUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIHJlbmRlciBpbmZvIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBtZWFzdXJlLlxuICAgKiBAcmV0dXJucyBUaGUgcmVuZGVyIGluZm8gb2JqZWN0LlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIG1ha2VSZW5kZXJJbmZvXyhibG9jazogQmxvY2tTdmcpOiBSZW5kZXJJbmZvIHtcbiAgICByZXR1cm4gbmV3IFJlbmRlckluZm8odGhpcywgYmxvY2spO1xuICB9XG59XG5cbmJsb2NrUmVuZGVyaW5nLnJlZ2lzdGVyKCd0aHJhc29zJywgUmVuZGVyZXIpO1xuIiwiLyoqIEBmaWxlIFJlLWV4cG9ydHMgb2YgQmxvY2tseS50aHJhc29zLiogbW9kdWxlcy4gKi9cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFJlLWV4cG9ydHMgb2YgQmxvY2tseS50aHJhc29zLiogbW9kdWxlcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkudGhyYXNvc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LnRocmFzb3MnKTtcblxuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuZXhwb3J0IHtSZW5kZXJlciwgUmVuZGVySW5mb307XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgcHJvdmlkZXMgY29uc3RhbnRzIGZvciByZW5kZXJpbmcgYmxvY2tzIGluIHRoZVxuICogbWluaW1hbGlzdCByZW5kZXJlci5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5taW5pbWFsaXN0LkNvbnN0YW50UHJvdmlkZXInKTtcblxuaW1wb3J0IHtDb25zdGFudFByb3ZpZGVyIGFzIEJhc2VDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzLmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IHByb3ZpZGVzIGNvbnN0YW50cyBmb3IgcmVuZGVyaW5nIGJsb2NrcyBpbiB0aGUgc2FtcGxlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5Lm1pbmltYWxpc3QuQ29uc3RhbnRQcm92aWRlclxuICovXG5leHBvcnQgY2xhc3MgQ29uc3RhbnRQcm92aWRlciBleHRlbmRzIEJhc2VDb25zdGFudFByb3ZpZGVyIHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWluaW1hbGlzdCByZW5kZXJpbmcgZHJhd2VyLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5Lm1pbmltYWxpc3QuRHJhd2VyJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB7RHJhd2VyIGFzIEJhc2VEcmF3ZXJ9IGZyb20gJy4uL2NvbW1vbi9kcmF3ZXIuanMnO1xuXG5pbXBvcnQgdHlwZSB7UmVuZGVySW5mb30gZnJvbSAnLi9pbmZvLmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IGRyYXdzIGEgYmxvY2sgYmFzZWQgb24gdGhlIGdpdmVuIHJlbmRlcmluZyBpbmZvcm1hdGlvbi5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5taW5pbWFsaXN0LkRyYXdlclxuICovXG5leHBvcnQgY2xhc3MgRHJhd2VyIGV4dGVuZHMgQmFzZURyYXdlciB7XG4gIC8qKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHJlbmRlci5cbiAgICogQHBhcmFtIGluZm8gQW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIGluZm9ybWF0aW9uIG5lZWRlZCB0byByZW5kZXIgdGhpc1xuICAgKiAgICAgYmxvY2suXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoYmxvY2s6IEJsb2NrU3ZnLCBpbmZvOiBSZW5kZXJJbmZvKSB7XG4gICAgc3VwZXIoYmxvY2ssIGluZm8pO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWluaW1hbGlzdCByZW5kZXIgaW5mbyBvYmplY3QuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkubWluaW1hbGlzdC5SZW5kZXJJbmZvJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB7UmVuZGVySW5mbyBhcyBCYXNlUmVuZGVySW5mb30gZnJvbSAnLi4vY29tbW9uL2luZm8uanMnO1xuXG5pbXBvcnQgdHlwZSB7UmVuZGVyZXJ9IGZyb20gJy4vcmVuZGVyZXIuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHNpemluZyBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gZHJhdyB0aGlzIGJsb2NrLlxuICpcbiAqIFRoaXMgbWVhc3VyZSBwYXNzIGRvZXMgbm90IHByb3BhZ2F0ZSBjaGFuZ2VzIHRvIHRoZSBibG9jayAoYWx0aG91Z2ggZmllbGRzXG4gKiBtYXkgY2hvb3NlIHRvIHJlcmVuZGVyIHdoZW4gZ2V0U2l6ZSgpIGlzIGNhbGxlZCkuICBIb3dldmVyLCBjYWxsaW5nIGl0XG4gKiByZXBlYXRlZGx5IG1heSBiZSBleHBlbnNpdmUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkubWluaW1hbGlzdC5SZW5kZXJJbmZvXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJJbmZvIGV4dGVuZHMgQmFzZVJlbmRlckluZm8ge1xuICAvLyBFeGNsYW1hdGlvbiBpcyBmaW5lIGIvYyB0aGlzIGlzIGFzc2lnbmVkIGJ5IHRoZSBzdXBlciBjb25zdHJ1Y3Rvci5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHJlbmRlcmVyXyE6IFJlbmRlcmVyO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gcmVuZGVyZXIgVGhlIHJlbmRlcmVyIGluIHVzZS5cbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBtZWFzdXJlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKHJlbmRlcmVyOiBSZW5kZXJlciwgYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgc3VwZXIocmVuZGVyZXIsIGJsb2NrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGJsb2NrIHJlbmRlcmVyIGluIHVzZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGJsb2NrIHJlbmRlcmVyIGluIHVzZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBnZXRSZW5kZXJlcigpOiBSZW5kZXJlciB7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXJfO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWluaW1hbGlzdCByZW5kZXJlci5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5taW5pbWFsaXN0LlJlbmRlcmVyJyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCAqIGFzIGJsb2NrUmVuZGVyaW5nIGZyb20gJy4uL2NvbW1vbi9ibG9ja19yZW5kZXJpbmcuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlckluZm8gYXMgQmFzZVJlbmRlckluZm99IGZyb20gJy4uL2NvbW1vbi9pbmZvLmpzJztcbmltcG9ydCB7UmVuZGVyZXIgYXMgQmFzZVJlbmRlcmVyfSBmcm9tICcuLi9jb21tb24vcmVuZGVyZXIuanMnO1xuXG5pbXBvcnQge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7RHJhd2VyfSBmcm9tICcuL2RyYXdlci5qcyc7XG5pbXBvcnQge1JlbmRlckluZm99IGZyb20gJy4vaW5mby5qcyc7XG5cblxuLyoqXG4gKiBUaGUgbWluaW1hbGlzdCByZW5kZXJlci5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5taW5pbWFsaXN0LlJlbmRlcmVyXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJlciBleHRlbmRzIEJhc2VSZW5kZXJlciB7XG4gIC8qKlxuICAgKiBAcGFyYW0gbmFtZSBUaGUgcmVuZGVyZXIgbmFtZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcpIHtcbiAgICBzdXBlcihuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJlbmRlcmVyJ3MgY29uc3RhbnQgcHJvdmlkZXIuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb25zdGFudCBwcm92aWRlci5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBtYWtlQ29uc3RhbnRzXygpOiBDb25zdGFudFByb3ZpZGVyIHtcbiAgICByZXR1cm4gbmV3IENvbnN0YW50UHJvdmlkZXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHJlbmRlcmVyJ3MgcmVuZGVyIGluZm8gb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIG1lYXN1cmUuXG4gICAqIEByZXR1cm5zIFRoZSByZW5kZXIgaW5mbyBvYmplY3QuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgbWFrZVJlbmRlckluZm9fKGJsb2NrOiBCbG9ja1N2Zyk6IFJlbmRlckluZm8ge1xuICAgIHJldHVybiBuZXcgUmVuZGVySW5mbyh0aGlzLCBibG9jayk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIGRyYXdlci5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byByZW5kZXIuXG4gICAqIEBwYXJhbSBpbmZvIEFuIG9iamVjdCBjb250YWluaW5nIGFsbCBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gcmVuZGVyIHRoaXNcbiAgICogICAgIGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgZHJhd2VyLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIG1ha2VEcmF3ZXJfKGJsb2NrOiBCbG9ja1N2ZywgaW5mbzogQmFzZVJlbmRlckluZm8pOlxuICAgICAgRHJhd2VyIHtcbiAgICByZXR1cm4gbmV3IERyYXdlcihibG9jaywgKGluZm8gYXMgUmVuZGVySW5mbykpO1xuICB9XG59XG5cbmJsb2NrUmVuZGVyaW5nLnJlZ2lzdGVyKCdtaW5pbWFsaXN0JywgUmVuZGVyZXIpO1xuIiwiLyoqIEBmaWxlIFJlLWV4cG9ydHMgb2YgQmxvY2tseS5taW5pbWFsaXN0LiogbW9kdWxlcy4gKi9cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFJlLWV4cG9ydHMgb2YgQmxvY2tseS5taW5pbWFsaXN0LiogbW9kdWxlcy5cbiAqXG4gKiBAbmFtZXNwYWNlIEJsb2NrbHkubWluaW1hbGlzdFxuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5Lm1pbmltYWxpc3QnKTtcblxuaW1wb3J0IHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQge0RyYXdlcn0gZnJvbSAnLi9kcmF3ZXIuanMnO1xuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuZXhwb3J0IHtDb25zdGFudFByb3ZpZGVyLCBEcmF3ZXIsIFJlbmRlcmVyLCBSZW5kZXJJbmZvfTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBwcm92aWRlcyBjb25zdGFudHMgZm9yIHJlbmRlcmluZyBibG9ja3MgaW4gR2VyYXNcbiAqIG1vZGUuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuZ2VyYXMuQ29uc3RhbnRQcm92aWRlcicpO1xuXG5pbXBvcnQge0NvbnN0YW50UHJvdmlkZXIgYXMgQmFzZUNvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgcHJvdmlkZXMgY29uc3RhbnRzIGZvciByZW5kZXJpbmcgYmxvY2tzIGluIEdlcmFzIG1vZGUuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuZ2VyYXMuQ29uc3RhbnRQcm92aWRlclxuICovXG5leHBvcnQgY2xhc3MgQ29uc3RhbnRQcm92aWRlciBleHRlbmRzIEJhc2VDb25zdGFudFByb3ZpZGVyIHtcbiAgb3ZlcnJpZGUgRklFTERfVEVYVF9CQVNFTElORV9DRU5URVIgPSBmYWxzZTtcblxuICAvLyBUaGUgZGFyay9zaGFkb3cgcGF0aCBpbiBjbGFzc2ljIHJlbmRlcmluZyBpcyB0aGUgc2FtZSBhcyB0aGUgbm9ybWFsIGJsb2NrXG4gIC8vIHBhdGgsIGJ1dCB0cmFuc2xhdGVkIGRvd24gb25lIGFuZCByaWdodCBvbmUuXG4gIERBUktfUEFUSF9PRkZTRVQgPSAxO1xuXG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSB3aWR0aCBvZiBhIGJvdHRvbSByb3cgdGhhdCBmb2xsb3dzIGEgc3RhdGVtZW50IGlucHV0IGFuZCBoYXNcbiAgICogaW5wdXRzIGlubGluZS5cbiAgICovXG4gIE1BWF9CT1RUT01fV0lEVEggPSAzMDtcbiAgb3ZlcnJpZGUgU1RBVEVNRU5UX0JPVFRPTV9TUEFDRVIgPSAtdGhpcy5OT1RDSF9IRUlHSFQgLyAyO1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRDU1NfKHNlbGVjdG9yOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0Q1NTXyhzZWxlY3RvcikuY29uY2F0KFtcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIGluZGVudCAqL1xuICAgICAgLyogY2xhbmctZm9ybWF0IG9mZiAqL1xuICAgICAgLy8gSW5zZXJ0aW9uIG1hcmtlci5cbiAgICAgIGAke3NlbGVjdG9yfSAuYmxvY2tseUluc2VydGlvbk1hcmtlcj4uYmxvY2tseVBhdGhMaWdodCxgLFxuICAgICAgYCR7c2VsZWN0b3J9IC5ibG9ja2x5SW5zZXJ0aW9uTWFya2VyPi5ibG9ja2x5UGF0aERhcmsge2AsXG4gICAgICBgZmlsbC1vcGFjaXR5OiAke3RoaXMuSU5TRVJUSU9OX01BUktFUl9PUEFDSVRZfTtgLFxuICAgICAgYHN0cm9rZTogbm9uZTtgLFxuICAgICAgJ30nLFxuICAgICAgLyogY2xhbmctZm9ybWF0IG9uICovXG4gICAgICAvKiBlc2xpbnQtZW5hYmxlIGluZGVudCAqL1xuICAgIF0pO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTWV0aG9kcyBmb3IgYWRkaW5nIGhpZ2hsaWdodHMgb24gYmxvY2ssIGZvciByZW5kZXJpbmcgaW5cbiAqIGNvbXBhdGliaWxpdHkgbW9kZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5nZXJhcy5IaWdobGlnaHRlcicpO1xuXG5pbXBvcnQgKiBhcyBzdmdQYXRocyBmcm9tICcuLi8uLi91dGlscy9zdmdfcGF0aHMuanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbW1vbi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHR5cGUge0JvdHRvbVJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvYm90dG9tX3Jvdy5qcyc7XG5pbXBvcnQgdHlwZSB7Um93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy9yb3cuanMnO1xuaW1wb3J0IHtTcGFjZXJSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3NwYWNlcl9yb3cuanMnO1xuaW1wb3J0IHR5cGUge1RvcFJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvdG9wX3Jvdy5qcyc7XG5pbXBvcnQge1R5cGVzfSBmcm9tICcuLi9tZWFzdXJhYmxlcy90eXBlcy5qcyc7XG5cbmltcG9ydCB0eXBlIHtIaWdobGlnaHRDb25zdGFudFByb3ZpZGVyLCBJbnNpZGVDb3JuZXIsIEphZ2dlZFRlZXRoLCBOb3RjaCwgT3V0c2lkZUNvcm5lciwgUHV6emxlVGFiLCBTdGFydEhhdH0gZnJvbSAnLi9oaWdobGlnaHRfY29uc3RhbnRzLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHR5cGUge0lubGluZUlucHV0fSBmcm9tICcuL21lYXN1cmFibGVzL2lubGluZV9pbnB1dC5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBhZGRzIGhpZ2hsaWdodHMgdG8gYSBibG9jayBiYXNlZCBvbiB0aGUgZ2l2ZW4gcmVuZGVyaW5nXG4gKiBpbmZvcm1hdGlvbi5cbiAqXG4gKiBIaWdobGlnaHRpbmcgaXMgaW50ZXJlc3RpbmcgYmVjYXVzZSB0aGUgaGlnaGxpZ2h0cyBkbyBub3QgZnVsbHkgZW5jbG9zZSB0aGVcbiAqIGJsb2NrLiAgSW5zdGVhZCwgdGhleSBhcmUgcG9zaXRpb25lZCBiYXNlZCBvbiBhIGxpZ2h0IHNvdXJjZSBpbiB0aGUgdG9wIGxlZnQuXG4gKiBUaGlzIG1lYW5zIHRoYXQgcmVuZGVyaW5nIGhpZ2hsaWdodHMgcmVxdWlyZXMgZXhhY3QgaW5mb3JtYXRpb24gYWJvdXQgdGhlXG4gKiBwb3NpdGlvbiBvZiBlYWNoIHBhcnQgb2YgdGhlIGJsb2NrLiAgVGhlIHJlc3VsdGluZyBwYXRocyBhcmUgbm90IGNvbnRpbnVvdXNcbiAqIG9yIGNsb3NlZCBwYXRocy4gIFRoZSBoaWdobGlnaHRzIGZvciB0YWJzIGFuZCBub3RjaGVzIGFyZSBsb29zZWx5IGJhc2VkIG9uXG4gKiB0YWIgYW5kIG5vdGNoIHNoYXBlcywgYnV0IGFyZSBub3QgZXhhY3RseSB0aGUgc2FtZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5nZXJhcy5IaWdobGlnaHRlclxuICovXG5leHBvcnQgY2xhc3MgSGlnaGxpZ2h0ZXIge1xuICBpbmZvXzogUmVuZGVySW5mbztcbiAgc3RlcHNfID0gJyc7XG4gIGlubGluZVN0ZXBzXyA9ICcnO1xuICBSVExfOiBib29sZWFuO1xuICBjb25zdGFudHNfOiBDb25zdGFudFByb3ZpZGVyO1xuICBoaWdobGlnaHRDb25zdGFudHNfOiBIaWdobGlnaHRDb25zdGFudFByb3ZpZGVyO1xuICBwcml2YXRlIHJlYWRvbmx5IGhpZ2hsaWdodE9mZnNldF86IG51bWJlcjtcbiAgb3V0c2lkZUNvcm5lclBhdGhzXzogT3V0c2lkZUNvcm5lcjtcbiAgaW5zaWRlQ29ybmVyUGF0aHNfOiBJbnNpZGVDb3JuZXI7XG4gIHB1enpsZVRhYlBhdGhzXzogUHV6emxlVGFiO1xuICBub3RjaFBhdGhzXzogTm90Y2g7XG4gIHN0YXJ0UGF0aHNfOiBTdGFydEhhdDtcbiAgamFnZ2VkVGVldGhQYXRoc186IEphZ2dlZFRlZXRoO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gaW5mbyBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgaW5mb3JtYXRpb24gbmVlZGVkIHRvIHJlbmRlciB0aGlzXG4gICAqICAgICBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihpbmZvOiBSZW5kZXJJbmZvKSB7XG4gICAgdGhpcy5pbmZvXyA9IGluZm87XG5cbiAgICB0aGlzLlJUTF8gPSB0aGlzLmluZm9fLlJUTDtcblxuICAgIGNvbnN0IHJlbmRlcmVyID0gKGluZm8uZ2V0UmVuZGVyZXIoKSk7XG5cbiAgICAvKiogVGhlIHJlbmRlcmVyJ3MgY29uc3RhbnQgcHJvdmlkZXIuICovXG4gICAgdGhpcy5jb25zdGFudHNfID0gcmVuZGVyZXIuZ2V0Q29uc3RhbnRzKCk7XG5cbiAgICB0aGlzLmhpZ2hsaWdodENvbnN0YW50c18gPSByZW5kZXJlci5nZXRIaWdobGlnaHRDb25zdGFudHMoKTtcbiAgICAvKiogVGhlIG9mZnNldCBiZXR3ZWVuIHRoZSBibG9jaydzIG1haW4gcGF0aCBhbmQgaGlnaGxpZ2h0IHBhdGguICovXG4gICAgdGhpcy5oaWdobGlnaHRPZmZzZXRfID0gdGhpcy5oaWdobGlnaHRDb25zdGFudHNfLk9GRlNFVDtcblxuICAgIHRoaXMub3V0c2lkZUNvcm5lclBhdGhzXyA9IHRoaXMuaGlnaGxpZ2h0Q29uc3RhbnRzXy5PVVRTSURFX0NPUk5FUjtcbiAgICB0aGlzLmluc2lkZUNvcm5lclBhdGhzXyA9IHRoaXMuaGlnaGxpZ2h0Q29uc3RhbnRzXy5JTlNJREVfQ09STkVSO1xuICAgIHRoaXMucHV6emxlVGFiUGF0aHNfID0gdGhpcy5oaWdobGlnaHRDb25zdGFudHNfLlBVWlpMRV9UQUI7XG4gICAgdGhpcy5ub3RjaFBhdGhzXyA9IHRoaXMuaGlnaGxpZ2h0Q29uc3RhbnRzXy5OT1RDSDtcbiAgICB0aGlzLnN0YXJ0UGF0aHNfID0gdGhpcy5oaWdobGlnaHRDb25zdGFudHNfLlNUQVJUX0hBVDtcbiAgICB0aGlzLmphZ2dlZFRlZXRoUGF0aHNfID0gdGhpcy5oaWdobGlnaHRDb25zdGFudHNfLkpBR0dFRF9URUVUSDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHN0ZXBzIGZvciB0aGUgaGlnaGxpZ2h0IHBhdGguXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBzdGVwcyBmb3IgdGhlIGhpZ2hsaWdodCBwYXRoLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGdldFBhdGgoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zdGVwc18gKyAnXFxuJyArIHRoaXMuaW5saW5lU3RlcHNfO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIGhpZ2hsaWdodCB0byB0aGUgdG9wIGNvcm5lciBvZiBhIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSB0b3Agcm93IG9mIHRoZSBibG9jay5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBkcmF3VG9wQ29ybmVyKHJvdzogVG9wUm93KSB7XG4gICAgdGhpcy5zdGVwc18gKz0gc3ZnUGF0aHMubW92ZUJ5KHJvdy54UG9zLCB0aGlzLmluZm9fLnN0YXJ0WSk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGVsZW07IGVsZW0gPSByb3cuZWxlbWVudHNbaV07IGkrKykge1xuICAgICAgaWYgKFR5cGVzLmlzTGVmdFNxdWFyZUNvcm5lcihlbGVtKSkge1xuICAgICAgICB0aGlzLnN0ZXBzXyArPSB0aGlzLmhpZ2hsaWdodENvbnN0YW50c18uU1RBUlRfUE9JTlQ7XG4gICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzTGVmdFJvdW5kZWRDb3JuZXIoZWxlbSkpIHtcbiAgICAgICAgdGhpcy5zdGVwc18gKz0gdGhpcy5vdXRzaWRlQ29ybmVyUGF0aHNfLnRvcExlZnQodGhpcy5SVExfKTtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNQcmV2aW91c0Nvbm5lY3Rpb24oZWxlbSkpIHtcbiAgICAgICAgdGhpcy5zdGVwc18gKz0gdGhpcy5ub3RjaFBhdGhzXy5wYXRoTGVmdDtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNIYXQoZWxlbSkpIHtcbiAgICAgICAgdGhpcy5zdGVwc18gKz0gdGhpcy5zdGFydFBhdGhzXy5wYXRoKHRoaXMuUlRMXyk7XG4gICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzU3BhY2VyKGVsZW0pICYmIGVsZW0ud2lkdGggIT09IDApIHtcbiAgICAgICAgLy8gVGhlIGVuZCBwb2ludCBvZiB0aGUgc3BhY2VyIG5lZWRzIHRvIGJlIG9mZnNldCBieSB0aGUgaGlnaGxpZ2h0XG4gICAgICAgIC8vIGFtb3VudC4gU28gaW5zdGVhZCBvZiB1c2luZyB0aGUgc3BhY2VyJ3Mgd2lkdGggZm9yIGEgcmVsYXRpdmVcbiAgICAgICAgLy8gaG9yaXpvbnRhbCwgdXNlIGl0cyB3aWR0aCBhbmQgcG9zaXRpb24gZm9yIGFuIGFic29sdXRlIGhvcml6b250YWxcbiAgICAgICAgLy8gbW92ZS5cbiAgICAgICAgdGhpcy5zdGVwc18gKz0gc3ZnUGF0aHMubGluZU9uQXhpcyhcbiAgICAgICAgICAgICdIJywgZWxlbS54UG9zICsgZWxlbS53aWR0aCAtIHRoaXMuaGlnaGxpZ2h0T2Zmc2V0Xyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmlnaHQgPSByb3cueFBvcyArIHJvdy53aWR0aCAtIHRoaXMuaGlnaGxpZ2h0T2Zmc2V0XztcbiAgICB0aGlzLnN0ZXBzXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCdIJywgcmlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIGhpZ2hsaWdodCBvbiBhIGphZ2dlZCBlZGdlIGZvciBhIGNvbGxhcHNlZCBibG9jay5cbiAgICpcbiAgICogQHBhcmFtIHJvdyAgVGhlIHJvdyB0byBoaWdobGlnaHQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZHJhd0phZ2dlZEVkZ2VfKHJvdzogUm93KSB7XG4gICAgaWYgKHRoaXMuaW5mb18uUlRMKSB7XG4gICAgICBjb25zdCByZW1haW5kZXIgPVxuICAgICAgICAgIHJvdy5oZWlnaHQgLSB0aGlzLmphZ2dlZFRlZXRoUGF0aHNfLmhlaWdodCAtIHRoaXMuaGlnaGxpZ2h0T2Zmc2V0XztcbiAgICAgIHRoaXMuc3RlcHNfICs9XG4gICAgICAgICAgdGhpcy5qYWdnZWRUZWV0aFBhdGhzXy5wYXRoTGVmdCArIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCByZW1haW5kZXIpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBoaWdobGlnaHQgb24gYSB2YWx1ZSBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRoZSBpbnB1dCBiZWxvbmdzIHRvLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdWYWx1ZUlucHV0KHJvdzogUm93KSB7XG4gICAgY29uc3QgaW5wdXQgPSByb3cuZ2V0TGFzdElucHV0KCkgYXMgSW5saW5lSW5wdXQ7XG4gICAgaWYgKHRoaXMuUlRMXykge1xuICAgICAgY29uc3QgYmVsb3dUYWJIZWlnaHQgPSByb3cuaGVpZ2h0IC0gaW5wdXQuY29ubmVjdGlvbkhlaWdodDtcblxuICAgICAgdGhpcy5zdGVwc18gKz1cbiAgICAgICAgICBzdmdQYXRocy5tb3ZlVG8oXG4gICAgICAgICAgICAgIGlucHV0LnhQb3MgKyBpbnB1dC53aWR0aCAtIHRoaXMuaGlnaGxpZ2h0T2Zmc2V0Xywgcm93LnlQb3MpICtcbiAgICAgICAgICB0aGlzLnB1enpsZVRhYlBhdGhzXy5wYXRoRG93bih0aGlzLlJUTF8pICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgYmVsb3dUYWJIZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0ZXBzXyArPSBzdmdQYXRocy5tb3ZlVG8oaW5wdXQueFBvcyArIGlucHV0LndpZHRoLCByb3cueVBvcykgK1xuICAgICAgICAgIHRoaXMucHV6emxlVGFiUGF0aHNfLnBhdGhEb3duKHRoaXMuUlRMXyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIGhpZ2hsaWdodCBvbiBhIHN0YXRlbWVudCBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIHJvdyBUaGUgcm93IHRvIGhpZ2hsaWdodC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBkcmF3U3RhdGVtZW50SW5wdXQocm93OiBSb3cpIHtcbiAgICBjb25zdCBpbnB1dCA9IHJvdy5nZXRMYXN0SW5wdXQoKTtcbiAgICBpZiAoIWlucHV0KSByZXR1cm47XG4gICAgaWYgKHRoaXMuUlRMXykge1xuICAgICAgY29uc3QgaW5uZXJIZWlnaHQgPSByb3cuaGVpZ2h0IC0gMiAqIHRoaXMuaW5zaWRlQ29ybmVyUGF0aHNfLmhlaWdodDtcbiAgICAgIHRoaXMuc3RlcHNfICs9IHN2Z1BhdGhzLm1vdmVUbyhpbnB1dC54UG9zLCByb3cueVBvcykgK1xuICAgICAgICAgIHRoaXMuaW5zaWRlQ29ybmVyUGF0aHNfLnBhdGhUb3AodGhpcy5SVExfKSArXG4gICAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygndicsIGlubmVySGVpZ2h0KSArXG4gICAgICAgICAgdGhpcy5pbnNpZGVDb3JuZXJQYXRoc18ucGF0aEJvdHRvbSh0aGlzLlJUTF8pICtcbiAgICAgICAgICBzdmdQYXRocy5saW5lVG8oXG4gICAgICAgICAgICAgIHJvdy53aWR0aCAtIGlucHV0LnhQb3MgLSB0aGlzLmluc2lkZUNvcm5lclBhdGhzXy53aWR0aCwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RlcHNfICs9IHN2Z1BhdGhzLm1vdmVUbyhpbnB1dC54UG9zLCByb3cueVBvcyArIHJvdy5oZWlnaHQpICtcbiAgICAgICAgICB0aGlzLmluc2lkZUNvcm5lclBhdGhzXy5wYXRoQm90dG9tKHRoaXMuUlRMXykgK1xuICAgICAgICAgIHN2Z1BhdGhzLmxpbmVUbyhcbiAgICAgICAgICAgICAgcm93LndpZHRoIC0gaW5wdXQueFBvcyAtIHRoaXMuaW5zaWRlQ29ybmVyUGF0aHNfLndpZHRoLCAwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgaGlnaGxpZ2h0IG9uIHRoZSByaWdodCBzaWRlIG9mIGEgcm93LlxuICAgKlxuICAgKiBAcGFyYW0gcm93IFRoZSByb3cgdG8gaGlnaGxpZ2h0LlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdSaWdodFNpZGVSb3cocm93OiBSb3cpIHtcbiAgICBjb25zdCByaWdodEVkZ2UgPSByb3cueFBvcyArIHJvdy53aWR0aCAtIHRoaXMuaGlnaGxpZ2h0T2Zmc2V0XztcbiAgICBpZiAocm93IGluc3RhbmNlb2YgU3BhY2VyUm93ICYmIHJvdy5mb2xsb3dzU3RhdGVtZW50KSB7XG4gICAgICB0aGlzLnN0ZXBzXyArPSBzdmdQYXRocy5saW5lT25BeGlzKCdIJywgcmlnaHRFZGdlKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuUlRMXykge1xuICAgICAgdGhpcy5zdGVwc18gKz0gc3ZnUGF0aHMubGluZU9uQXhpcygnSCcsIHJpZ2h0RWRnZSk7XG4gICAgICBpZiAocm93LmhlaWdodCA+IHRoaXMuaGlnaGxpZ2h0T2Zmc2V0Xykge1xuICAgICAgICB0aGlzLnN0ZXBzXyArPSBzdmdQYXRocy5saW5lT25BeGlzKFxuICAgICAgICAgICAgJ1YnLCByb3cueVBvcyArIHJvdy5oZWlnaHQgLSB0aGlzLmhpZ2hsaWdodE9mZnNldF8pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBoaWdobGlnaHQgdG8gdGhlIGJvdHRvbSByb3cuXG4gICAqXG4gICAqIEBwYXJhbSByb3cgVGhlIHJvdyB0byBoaWdobGlnaHQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZHJhd0JvdHRvbVJvdyhyb3c6IEJvdHRvbVJvdykge1xuICAgIC8vIEhpZ2hsaWdodCB0aGUgdmVydGljYWwgZWRnZSBvZiB0aGUgYm90dG9tIHJvdyBvbiB0aGUgaW5wdXQgc2lkZS5cbiAgICAvLyBIaWdobGlnaHRpbmcgaXMgYWx3YXlzIGZyb20gdGhlIHRvcCBsZWZ0LCBib3RoIGluIExUUiBhbmQgUlRMLlxuICAgIGlmICh0aGlzLlJUTF8pIHtcbiAgICAgIHRoaXMuc3RlcHNfICs9XG4gICAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnVicsIHJvdy5iYXNlbGluZSAtIHRoaXMuaGlnaGxpZ2h0T2Zmc2V0Xyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvcm5lckVsZW0gPSB0aGlzLmluZm9fLmJvdHRvbVJvdy5lbGVtZW50c1swXTtcbiAgICAgIGlmIChUeXBlcy5pc0xlZnRTcXVhcmVDb3JuZXIoY29ybmVyRWxlbSkpIHtcbiAgICAgICAgdGhpcy5zdGVwc18gKz0gc3ZnUGF0aHMubW92ZVRvKFxuICAgICAgICAgICAgcm93LnhQb3MgKyB0aGlzLmhpZ2hsaWdodE9mZnNldF8sXG4gICAgICAgICAgICByb3cuYmFzZWxpbmUgLSB0aGlzLmhpZ2hsaWdodE9mZnNldF8pO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc0xlZnRSb3VuZGVkQ29ybmVyKGNvcm5lckVsZW0pKSB7XG4gICAgICAgIHRoaXMuc3RlcHNfICs9IHN2Z1BhdGhzLm1vdmVUbyhyb3cueFBvcywgcm93LmJhc2VsaW5lKTtcbiAgICAgICAgdGhpcy5zdGVwc18gKz0gdGhpcy5vdXRzaWRlQ29ybmVyUGF0aHNfLmJvdHRvbUxlZnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRHJhdyB0aGUgaGlnaGxpZ2h0IG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIGJsb2NrLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGRyYXdMZWZ0KCkge1xuICAgIGNvbnN0IG91dHB1dENvbm5lY3Rpb24gPSB0aGlzLmluZm9fLm91dHB1dENvbm5lY3Rpb247XG4gICAgaWYgKG91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgIGNvbnN0IHRhYkJvdHRvbSA9XG4gICAgICAgICAgb3V0cHV0Q29ubmVjdGlvbi5jb25uZWN0aW9uT2Zmc2V0WSArIG91dHB1dENvbm5lY3Rpb24uaGVpZ2h0O1xuICAgICAgLy8gRHJhdyBhIGxpbmUgdXAgdG8gdGhlIGJvdHRvbSBvZiB0aGUgdGFiLlxuICAgICAgaWYgKHRoaXMuUlRMXykge1xuICAgICAgICB0aGlzLnN0ZXBzXyArPSBzdmdQYXRocy5tb3ZlVG8odGhpcy5pbmZvXy5zdGFydFgsIHRhYkJvdHRvbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBsZWZ0ID0gdGhpcy5pbmZvXy5zdGFydFggKyB0aGlzLmhpZ2hsaWdodE9mZnNldF87XG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMuaW5mb18uYm90dG9tUm93LmJhc2VsaW5lIC0gdGhpcy5oaWdobGlnaHRPZmZzZXRfO1xuICAgICAgICB0aGlzLnN0ZXBzXyArPSBzdmdQYXRocy5tb3ZlVG8obGVmdCwgYm90dG9tKTtcbiAgICAgICAgdGhpcy5zdGVwc18gKz0gc3ZnUGF0aHMubGluZU9uQXhpcygnVicsIHRhYkJvdHRvbSk7XG4gICAgICB9XG4gICAgICB0aGlzLnN0ZXBzXyArPSB0aGlzLnB1enpsZVRhYlBhdGhzXy5wYXRoVXAodGhpcy5SVExfKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuUlRMXykge1xuICAgICAgY29uc3QgdG9wUm93ID0gdGhpcy5pbmZvXy50b3BSb3c7XG4gICAgICBpZiAoVHlwZXMuaXNMZWZ0Um91bmRlZENvcm5lcih0b3BSb3cuZWxlbWVudHNbMF0pKSB7XG4gICAgICAgIHRoaXMuc3RlcHNfICs9XG4gICAgICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgdGhpcy5vdXRzaWRlQ29ybmVyUGF0aHNfLmhlaWdodCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0ZXBzXyArPVxuICAgICAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygnVicsIHRvcFJvdy5jYXBsaW5lICsgdGhpcy5oaWdobGlnaHRPZmZzZXRfKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgaGlnaGxpZ2h0IHRvIGFuIGlubGluZSBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIGlucHV0IFRoZSBpbnB1dCB0byBoaWdobGlnaHQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZHJhd0lubGluZUlucHV0KGlucHV0OiBJbmxpbmVJbnB1dCkge1xuICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuaGlnaGxpZ2h0T2Zmc2V0XztcblxuICAgIC8vIFJlbGF0aXZlIHRvIHRoZSBibG9jaydzIGxlZnQuXG4gICAgY29uc3QgY29ubmVjdGlvblJpZ2h0ID0gaW5wdXQueFBvcyArIGlucHV0LmNvbm5lY3Rpb25XaWR0aDtcbiAgICBjb25zdCB5UG9zID0gaW5wdXQuY2VudGVybGluZSAtIGlucHV0LmhlaWdodCAvIDI7XG4gICAgY29uc3QgYm90dG9tSGlnaGxpZ2h0V2lkdGggPSBpbnB1dC53aWR0aCAtIGlucHV0LmNvbm5lY3Rpb25XaWR0aDtcbiAgICBjb25zdCBzdGFydFkgPSB5UG9zICsgb2Zmc2V0O1xuXG4gICAgaWYgKHRoaXMuUlRMXykge1xuICAgICAgY29uc3QgYWJvdmVUYWJIZWlnaHQgPSBpbnB1dC5jb25uZWN0aW9uT2Zmc2V0WSAtIG9mZnNldDtcbiAgICAgIGNvbnN0IGJlbG93VGFiSGVpZ2h0ID0gaW5wdXQuaGVpZ2h0IC1cbiAgICAgICAgICAoaW5wdXQuY29ubmVjdGlvbk9mZnNldFkgKyBpbnB1dC5jb25uZWN0aW9uSGVpZ2h0KSArIG9mZnNldDtcblxuICAgICAgY29uc3Qgc3RhcnRYID0gY29ubmVjdGlvblJpZ2h0IC0gb2Zmc2V0O1xuXG4gICAgICB0aGlzLmlubGluZVN0ZXBzXyArPVxuICAgICAgICAgIHN2Z1BhdGhzLm1vdmVUbyhzdGFydFgsIHN0YXJ0WSkgKyAgICAgICAgICAgLy8gUmlnaHQgZWRnZSBhYm92ZSB0YWIuXG4gICAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygndicsIGFib3ZlVGFiSGVpZ2h0KSArICAvLyBCYWNrIG9mIHRhYi5cbiAgICAgICAgICB0aGlzLnB1enpsZVRhYlBhdGhzXy5wYXRoRG93bih0aGlzLlJUTF8pICsgIC8vIFJpZ2h0IGVkZ2UgYmVsb3cgdGFiLlxuICAgICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCBiZWxvd1RhYkhlaWdodCkgKyAgLy8gQm90dG9tLlxuICAgICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ2gnLCBib3R0b21IaWdobGlnaHRXaWR0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5saW5lU3RlcHNfICs9ICAvLyBHbyB0byB0b3AgcmlnaHQgY29ybmVyLlxuICAgICAgICAgIHN2Z1BhdGhzLm1vdmVUbyhcbiAgICAgICAgICAgICAgaW5wdXQueFBvcyArIGlucHV0LndpZHRoICsgb2Zmc2V0LFxuICAgICAgICAgICAgICBzdGFydFkpICsgIC8vIEhpZ2hsaWdodCByaWdodCBlZGdlLCBib3R0b20uXG4gICAgICAgICAgc3ZnUGF0aHMubGluZU9uQXhpcygndicsIGlucHV0LmhlaWdodCkgK1xuICAgICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoXG4gICAgICAgICAgICAgICdoJywgLWJvdHRvbUhpZ2hsaWdodFdpZHRoKSArICAvLyBHbyB0byB0b3Agb2YgdGFiLlxuICAgICAgICAgIHN2Z1BhdGhzLm1vdmVUbyhcbiAgICAgICAgICAgICAgY29ubmVjdGlvblJpZ2h0LFxuICAgICAgICAgICAgICB5UG9zICsgaW5wdXQuY29ubmVjdGlvbk9mZnNldFkpICsgIC8vIFNob3J0IGhpZ2hsaWdodCBnbGludCBhdFxuICAgICAgICAgIC8vIGJvdHRvbSBvZiB0YWIuXG4gICAgICAgICAgdGhpcy5wdXp6bGVUYWJQYXRoc18ucGF0aERvd24odGhpcy5SVExfKTtcbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBSZW5kZXJlciB0aGF0IHByZXNlcnZlcyB0aGUgbG9vayBhbmQgZmVlbCBvZiBCbG9ja2x5IHByZS0yMDE5LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmdlcmFzLkRyYXdlcicpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2tTdmd9IGZyb20gJy4uLy4uL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdQYXRocyBmcm9tICcuLi8uLi91dGlscy9zdmdfcGF0aHMuanMnO1xuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnLi4vY29tbW9uL2RlYnVnLmpzJztcbmltcG9ydCB7RHJhd2VyIGFzIEJhc2VEcmF3ZXJ9IGZyb20gJy4uL2NvbW1vbi9kcmF3ZXIuanMnO1xuaW1wb3J0IHR5cGUge1Jvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvcm93LmpzJztcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7SGlnaGxpZ2h0ZXJ9IGZyb20gJy4vaGlnaGxpZ2h0ZXIuanMnO1xuaW1wb3J0IHR5cGUge1JlbmRlckluZm99IGZyb20gJy4vaW5mby5qcyc7XG5pbXBvcnQgdHlwZSB7SW5saW5lSW5wdXR9IGZyb20gJy4vbWVhc3VyYWJsZXMvaW5saW5lX2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtQYXRoT2JqZWN0fSBmcm9tICcuL3BhdGhfb2JqZWN0LmpzJztcblxuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IGRyYXdzIGEgYmxvY2sgYmFzZWQgb24gdGhlIGdpdmVuIHJlbmRlcmluZyBpbmZvcm1hdGlvbi5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5nZXJhcy5EcmF3ZXJcbiAqL1xuZXhwb3J0IGNsYXNzIERyYXdlciBleHRlbmRzIEJhc2VEcmF3ZXIge1xuICBoaWdobGlnaHRlcl86IEhpZ2hsaWdodGVyO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBvdmVycmlkZSBjb25zdGFudHNfITogQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKipcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byByZW5kZXIuXG4gICAqIEBwYXJhbSBpbmZvIEFuIG9iamVjdCBjb250YWluaW5nIGFsbCBpbmZvcm1hdGlvbiBuZWVkZWQgdG8gcmVuZGVyIHRoaXNcbiAgICogICAgIGJsb2NrLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGJsb2NrOiBCbG9ja1N2ZywgaW5mbzogUmVuZGVySW5mbykge1xuICAgIHN1cGVyKGJsb2NrLCBpbmZvKTtcbiAgICAvLyBVbmxpa2UgVGhyYXNvcywgR2VyYXMgaGFzIGhpZ2hsaWdodHMgYW5kIGRyb3Agc2hhZG93cy5cbiAgICB0aGlzLmhpZ2hsaWdodGVyXyA9IG5ldyBIaWdobGlnaHRlcihpbmZvKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGRyYXcoKSB7XG4gICAgdGhpcy5oaWRlSGlkZGVuSWNvbnNfKCk7XG4gICAgdGhpcy5kcmF3T3V0bGluZV8oKTtcbiAgICB0aGlzLmRyYXdJbnRlcm5hbHNfKCk7XG5cbiAgICBjb25zdCBwYXRoT2JqZWN0ID0gdGhpcy5ibG9ja18ucGF0aE9iamVjdCBhcyBQYXRoT2JqZWN0O1xuICAgIHBhdGhPYmplY3Quc2V0UGF0aCh0aGlzLm91dGxpbmVQYXRoXyArICdcXG4nICsgdGhpcy5pbmxpbmVQYXRoXyk7XG4gICAgcGF0aE9iamVjdC5zZXRIaWdobGlnaHRQYXRoKHRoaXMuaGlnaGxpZ2h0ZXJfLmdldFBhdGgoKSk7XG4gICAgaWYgKHRoaXMuaW5mb18uUlRMKSB7XG4gICAgICBwYXRoT2JqZWN0LmZsaXBSVEwoKTtcbiAgICB9XG4gICAgaWYgKGRlYnVnLmlzRGVidWdnZXJFbmFibGVkKCkpIHtcbiAgICAgIHRoaXMuYmxvY2tfPy5yZW5kZXJpbmdEZWJ1Z2dlcj8uZHJhd0RlYnVnKHRoaXMuYmxvY2tfLCB0aGlzLmluZm9fKTtcbiAgICB9XG4gICAgdGhpcy5yZWNvcmRTaXplT25CbG9ja18oKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGRyYXdUb3BfKCkge1xuICAgIHRoaXMuaGlnaGxpZ2h0ZXJfLmRyYXdUb3BDb3JuZXIodGhpcy5pbmZvXy50b3BSb3cpO1xuICAgIHRoaXMuaGlnaGxpZ2h0ZXJfLmRyYXdSaWdodFNpZGVSb3codGhpcy5pbmZvXy50b3BSb3cpO1xuXG4gICAgc3VwZXIuZHJhd1RvcF8oKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGRyYXdKYWdnZWRFZGdlXyhyb3c6IFJvdykge1xuICAgIHRoaXMuaGlnaGxpZ2h0ZXJfLmRyYXdKYWdnZWRFZGdlXyhyb3cpO1xuXG4gICAgc3VwZXIuZHJhd0phZ2dlZEVkZ2VfKHJvdyk7XG4gIH1cblxuICBvdmVycmlkZSBkcmF3VmFsdWVJbnB1dF8ocm93OiBSb3cpIHtcbiAgICB0aGlzLmhpZ2hsaWdodGVyXy5kcmF3VmFsdWVJbnB1dChyb3cpO1xuXG4gICAgc3VwZXIuZHJhd1ZhbHVlSW5wdXRfKHJvdyk7XG4gIH1cblxuICBvdmVycmlkZSBkcmF3U3RhdGVtZW50SW5wdXRfKHJvdzogUm93KSB7XG4gICAgdGhpcy5oaWdobGlnaHRlcl8uZHJhd1N0YXRlbWVudElucHV0KHJvdyk7XG5cbiAgICBzdXBlci5kcmF3U3RhdGVtZW50SW5wdXRfKHJvdyk7XG4gIH1cblxuICBvdmVycmlkZSBkcmF3UmlnaHRTaWRlUm93Xyhyb3c6IFJvdykge1xuICAgIHRoaXMuaGlnaGxpZ2h0ZXJfLmRyYXdSaWdodFNpZGVSb3cocm93KTtcblxuICAgIHRoaXMub3V0bGluZVBhdGhfICs9IHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ0gnLCByb3cueFBvcyArIHJvdy53aWR0aCkgK1xuICAgICAgICBzdmdQYXRocy5saW5lT25BeGlzKCdWJywgcm93LnlQb3MgKyByb3cuaGVpZ2h0KTtcbiAgfVxuXG4gIG92ZXJyaWRlIGRyYXdCb3R0b21fKCkge1xuICAgIHRoaXMuaGlnaGxpZ2h0ZXJfLmRyYXdCb3R0b21Sb3codGhpcy5pbmZvXy5ib3R0b21Sb3cpO1xuXG4gICAgc3VwZXIuZHJhd0JvdHRvbV8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3RlcHMgZm9yIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIGJsb2NrLCB3aGljaCBtYXkgaW5jbHVkZSBhbiBvdXRwdXRcbiAgICogY29ubmVjdGlvblxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRyYXdMZWZ0XygpIHtcbiAgICB0aGlzLmhpZ2hsaWdodGVyXy5kcmF3TGVmdCgpO1xuXG4gICAgc3VwZXIuZHJhd0xlZnRfKCk7XG4gIH1cblxuICBvdmVycmlkZSBkcmF3SW5saW5lSW5wdXRfKGlucHV0OiBJbmxpbmVJbnB1dCkge1xuICAgIHRoaXMuaGlnaGxpZ2h0ZXJfLmRyYXdJbmxpbmVJbnB1dChpbnB1dCBhcyBJbmxpbmVJbnB1dCk7XG5cbiAgICBzdXBlci5kcmF3SW5saW5lSW5wdXRfKGlucHV0KTtcbiAgfVxuXG4gIG92ZXJyaWRlIHBvc2l0aW9uSW5saW5lSW5wdXRDb25uZWN0aW9uXyhpbnB1dDogSW5saW5lSW5wdXQpIHtcbiAgICBjb25zdCB5UG9zID0gaW5wdXQuY2VudGVybGluZSAtIGlucHV0LmhlaWdodCAvIDI7XG4gICAgLy8gTW92ZSB0aGUgY29ubmVjdGlvbi5cbiAgICBpZiAoaW5wdXQuY29ubmVjdGlvbk1vZGVsKSB7XG4gICAgICAvLyB4UG9zIGFscmVhZHkgY29udGFpbnMgaW5mbyBhYm91dCBzdGFydFhcbiAgICAgIGxldCBjb25uWCA9XG4gICAgICAgICAgaW5wdXQueFBvcyArIGlucHV0LmNvbm5lY3Rpb25XaWR0aCArIHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUO1xuICAgICAgaWYgKHRoaXMuaW5mb18uUlRMKSB7XG4gICAgICAgIGNvbm5YICo9IC0xO1xuICAgICAgfVxuICAgICAgaW5wdXQuY29ubmVjdGlvbk1vZGVsLnNldE9mZnNldEluQmxvY2soXG4gICAgICAgICAgY29ublgsXG4gICAgICAgICAgeVBvcyArIGlucHV0LmNvbm5lY3Rpb25PZmZzZXRZICsgdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQpO1xuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIHBvc2l0aW9uU3RhdGVtZW50SW5wdXRDb25uZWN0aW9uXyhyb3c6IFJvdykge1xuICAgIGNvbnN0IGlucHV0ID0gcm93LmdldExhc3RJbnB1dCgpO1xuICAgIGlmIChpbnB1dD8uY29ubmVjdGlvbk1vZGVsKSB7XG4gICAgICBsZXQgY29ublggPSByb3cueFBvcyArIHJvdy5zdGF0ZW1lbnRFZGdlICsgaW5wdXQubm90Y2hPZmZzZXQ7XG4gICAgICBpZiAodGhpcy5pbmZvXy5SVEwpIHtcbiAgICAgICAgY29ublggKj0gLTE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25uWCArPSB0aGlzLmNvbnN0YW50c18uREFSS19QQVRIX09GRlNFVDtcbiAgICAgIH1cbiAgICAgIGlucHV0LmNvbm5lY3Rpb25Nb2RlbC5zZXRPZmZzZXRJbkJsb2NrKFxuICAgICAgICAgIGNvbm5YLCByb3cueVBvcyArIHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBwb3NpdGlvbkV4dGVybmFsVmFsdWVDb25uZWN0aW9uXyhyb3c6IFJvdykge1xuICAgIGNvbnN0IGlucHV0ID0gcm93LmdldExhc3RJbnB1dCgpO1xuICAgIGlmIChpbnB1dCAmJiBpbnB1dC5jb25uZWN0aW9uTW9kZWwpIHtcbiAgICAgIGxldCBjb25uWCA9IHJvdy54UG9zICsgcm93LndpZHRoICsgdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQ7XG4gICAgICBpZiAodGhpcy5pbmZvXy5SVEwpIHtcbiAgICAgICAgY29ublggKj0gLTE7XG4gICAgICB9XG4gICAgICBpbnB1dC5jb25uZWN0aW9uTW9kZWwuc2V0T2Zmc2V0SW5CbG9jayhjb25uWCwgcm93LnlQb3MpO1xuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIHBvc2l0aW9uTmV4dENvbm5lY3Rpb25fKCkge1xuICAgIGNvbnN0IGJvdHRvbVJvdyA9IHRoaXMuaW5mb18uYm90dG9tUm93O1xuXG4gICAgaWYgKGJvdHRvbVJvdy5jb25uZWN0aW9uKSB7XG4gICAgICBjb25zdCBjb25uSW5mbyA9IGJvdHRvbVJvdy5jb25uZWN0aW9uO1xuICAgICAgY29uc3QgeCA9IGNvbm5JbmZvLnhQb3M7ICAvLyBBbHJlYWR5IGNvbnRhaW5zIGluZm8gYWJvdXQgc3RhcnRYLlxuICAgICAgY29uc3QgY29ublggPVxuICAgICAgICAgICh0aGlzLmluZm9fLlJUTCA/IC14IDogeCkgKyB0aGlzLmNvbnN0YW50c18uREFSS19QQVRIX09GRlNFVCAvIDI7XG4gICAgICBjb25uSW5mby5jb25uZWN0aW9uTW9kZWwuc2V0T2Zmc2V0SW5CbG9jayhcbiAgICAgICAgICBjb25uWCwgYm90dG9tUm93LmJhc2VsaW5lICsgdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQpO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdHMgZm9yIHJlbmRlcmluZyBoaWdobGlnaHRzIG9uIGJsb2Nrcy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5nZXJhcy5IaWdobGlnaHRDb25zdGFudFByb3ZpZGVyJyk7XG5cbmltcG9ydCAqIGFzIHN2Z1BhdGhzIGZyb20gJy4uLy4uL3V0aWxzL3N2Z19wYXRocy5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBhbiBvdXRzaWRlIGNvcm5lci4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgT3V0c2lkZUNvcm5lciB7XG4gIGhlaWdodDogbnVtYmVyO1xuICB0b3BMZWZ0OiAocDE6IGJvb2xlYW4pID0+IHN0cmluZztcbiAgYm90dG9tTGVmdDogKCkgPT4gc3RyaW5nO1xufVxuXG4vKiogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGFuIGluc2lkZSBjb3JuZXIuICovXG5leHBvcnQgaW50ZXJmYWNlIEluc2lkZUNvcm5lciB7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBwYXRoVG9wOiAocDE6IGJvb2xlYW4pID0+IHN0cmluZztcbiAgcGF0aEJvdHRvbTogKHAxOiBib29sZWFuKSA9PiBzdHJpbmc7XG59XG5cbi8qKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgYSBzdGFydCBoYXQuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0YXJ0SGF0IHtcbiAgcGF0aDogKHAxOiBib29sZWFuKSA9PiBzdHJpbmc7XG59XG5cbi8qKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgYSBub3RjaC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTm90Y2gge1xuICBwYXRoTGVmdDogc3RyaW5nO1xufVxuXG4vKiogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGEgcHV6emxlIHRhYi4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUHV6emxlVGFiIHtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHBhdGhEb3duOiAocDE6IGJvb2xlYW4pID0+IHN0cmluZztcbiAgcGF0aFVwOiAocDE6IGJvb2xlYW4pID0+IHN0cmluZztcbn1cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBzaXppbmcgYW5kIHBhdGggaW5mb3JtYXRpb24gYWJvdXQgY29sbGFwc2VkIGJsb2NrXG4gKiBpbmRpY2F0b3JzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEphZ2dlZFRlZXRoIHtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG4gIHBhdGhMZWZ0OiBzdHJpbmc7XG59XG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgcHJvdmlkZXMgY29uc3RhbnRzIGZvciByZW5kZXJpbmcgaGlnaGxpZ2h0cyBvbiBibG9ja3MuXG4gKiBTb21lIGhpZ2hsaWdodHMgYXJlIHNpbXBsZSBvZmZzZXRzIG9mIHRoZSBwYXJlbnQgcGF0aHMgYW5kIGNhbiBiZSBnZW5lcmF0ZWRcbiAqIHByb2dyYW1tYXRpY2FsbHkuICBPdGhlcnMsIGVzcGVjaWFsbHkgb24gY3VydmVzLCBhcmUganVzdCBtYWRlIG91dCBvZiBwaWxlc1xuICogb2YgY29uc3RhbnRzIGFuZCBhcmUgaGFyZCB0byB0d2Vhay5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5nZXJhcy5IaWdobGlnaHRDb25zdGFudFByb3ZpZGVyXG4gKi9cbmV4cG9ydCBjbGFzcyBIaWdobGlnaHRDb25zdGFudFByb3ZpZGVyIHtcbiAgY29uc3RhbnRQcm92aWRlcjogQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKiogVGhlIG9mZnNldCBiZXR3ZWVuIHRoZSBibG9jaydzIG1haW4gcGF0aCBhbmQgaGlnaGxpZ2h0IHBhdGguICovXG4gIE9GRlNFVCA9IDAuNTtcbiAgU1RBUlRfUE9JTlQ6IHN0cmluZztcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgSU5TSURFX0NPUk5FUiE6IEluc2lkZUNvcm5lcjtcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgT1VUU0lERV9DT1JORVIhOiBPdXRzaWRlQ29ybmVyO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBQVVpaTEVfVEFCITogUHV6emxlVGFiO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBOT1RDSCE6IE5vdGNoO1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBKQUdHRURfVEVFVEghOiBKYWdnZWRUZWV0aDtcbiAgLy8gVE9ETyhiLzEwOTgxNjk1NSk6IHJlbW92ZSAnIScsIHNlZSBnby9zdHJpY3QtcHJvcC1pbml0LWZpeC5cbiAgU1RBUlRfSEFUITogU3RhcnRIYXQ7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmluZyBjb25zdGFudHMgcHJvdmlkZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyKSB7XG4gICAgLyoqIFRoZSByZW5kZXJlcidzIGNvbnN0YW50IHByb3ZpZGVyLiAqL1xuICAgIHRoaXMuY29uc3RhbnRQcm92aWRlciA9IGNvbnN0YW50cztcblxuICAgIC8qKlxuICAgICAqIFRoZSBzdGFydCBwb2ludCwgd2hpY2ggaXMgb2Zmc2V0IGluIGJvdGggWCBhbmQgWSwgYXMgYW4gU1ZHIHBhdGggY2h1bmsuXG4gICAgICpcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICB0aGlzLlNUQVJUX1BPSU5UID0gc3ZnUGF0aHMubW92ZUJ5KHRoaXMuT0ZGU0VULCB0aGlzLk9GRlNFVCk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBzaGFwZSBvYmplY3RzIGJhc2VkIG9uIHRoZSBjb25zdGFudHMgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvci5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBpbml0KCkge1xuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBpbnNpZGUgY29ybmVyXG4gICAgICogaGlnaGxpZ2h0cy5cbiAgICAgKi9cbiAgICB0aGlzLklOU0lERV9DT1JORVIgPSB0aGlzLm1ha2VJbnNpZGVDb3JuZXIoKTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBvdXRzaWRlIGNvcm5lclxuICAgICAqIGhpZ2hsaWdodHMuXG4gICAgICovXG4gICAgdGhpcy5PVVRTSURFX0NPUk5FUiA9IHRoaXMubWFrZU91dHNpZGVDb3JuZXIoKTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBwdXp6bGUgdGFiXG4gICAgICogaGlnaGxpZ2h0cy5cbiAgICAgKi9cbiAgICB0aGlzLlBVWlpMRV9UQUIgPSB0aGlzLm1ha2VQdXp6bGVUYWIoKTtcblxuICAgIC8qKlxuICAgICAqIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBub3RjaCBoaWdobGlnaHRzLlxuICAgICAqL1xuICAgIHRoaXMuTk9UQ0ggPSB0aGlzLm1ha2VOb3RjaCgpO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGhpZ2hsaWdodHMgZm9yXG4gICAgICogY29sbGFwc2VkIGJsb2NrIGluZGljYXRvcnMuXG4gICAgICovXG4gICAgdGhpcy5KQUdHRURfVEVFVEggPSB0aGlzLm1ha2VKYWdnZWRUZWV0aCgpO1xuXG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IHN0YXJ0IGhhdFxuICAgICAqIGhpZ2hsaWdodHMuXG4gICAgICovXG4gICAgdGhpcy5TVEFSVF9IQVQgPSB0aGlzLm1ha2VTdGFydEhhdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBpbnNpZGVcbiAgICogICAgIGNvcm5lciBoaWdobGlnaHRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VJbnNpZGVDb3JuZXIoKTogSW5zaWRlQ29ybmVyIHtcbiAgICBjb25zdCByYWRpdXMgPSB0aGlzLmNvbnN0YW50UHJvdmlkZXIuQ09STkVSX1JBRElVUztcbiAgICBjb25zdCBvZmZzZXQgPSB0aGlzLk9GRlNFVDtcblxuICAgIC8qKlxuICAgICAqIERpc3RhbmNlIGZyb20gc2hhcGUgZWRnZSB0byBpbnRlcnNlY3Qgd2l0aCBhIGN1cnZlZCBjb3JuZXIgYXQgNDUgZGVncmVlcy5cbiAgICAgKiBBcHBsaWVzIHRvIGhpZ2hsaWdodGluZyBvbiBhcm91bmQgdGhlIG91dHNpZGUgb2YgYSBjdXJ2ZS5cbiAgICAgKi9cbiAgICBjb25zdCBkaXN0YW5jZTQ1b3V0c2lkZSA9ICgxIC0gTWF0aC5TUVJUMV8yKSAqIChyYWRpdXMgKyBvZmZzZXQpIC0gb2Zmc2V0O1xuXG4gICAgY29uc3QgcGF0aFRvcFJ0bCA9IHN2Z1BhdGhzLm1vdmVCeShkaXN0YW5jZTQ1b3V0c2lkZSwgZGlzdGFuY2U0NW91dHNpZGUpICtcbiAgICAgICAgc3ZnUGF0aHMuYXJjKFxuICAgICAgICAgICAgJ2EnLCAnMCAwLDAnLCByYWRpdXMsXG4gICAgICAgICAgICBzdmdQYXRocy5wb2ludChcbiAgICAgICAgICAgICAgICAtZGlzdGFuY2U0NW91dHNpZGUgLSBvZmZzZXQsIHJhZGl1cyAtIGRpc3RhbmNlNDVvdXRzaWRlKSk7XG5cbiAgICBjb25zdCBwYXRoQm90dG9tUnRsID0gc3ZnUGF0aHMuYXJjKFxuICAgICAgICAnYScsICcwIDAsMCcsIHJhZGl1cyArIG9mZnNldCxcbiAgICAgICAgc3ZnUGF0aHMucG9pbnQocmFkaXVzICsgb2Zmc2V0LCByYWRpdXMgKyBvZmZzZXQpKTtcblxuICAgIGNvbnN0IHBhdGhCb3R0b21MdHIgPVxuICAgICAgICBzdmdQYXRocy5tb3ZlQnkoZGlzdGFuY2U0NW91dHNpZGUsIC1kaXN0YW5jZTQ1b3V0c2lkZSkgK1xuICAgICAgICBzdmdQYXRocy5hcmMoXG4gICAgICAgICAgICAnYScsICcwIDAsMCcsIHJhZGl1cyArIG9mZnNldCxcbiAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KFxuICAgICAgICAgICAgICAgIHJhZGl1cyAtIGRpc3RhbmNlNDVvdXRzaWRlLCBkaXN0YW5jZTQ1b3V0c2lkZSArIG9mZnNldCkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiByYWRpdXMgKyBvZmZzZXQsXG4gICAgICBoZWlnaHQ6IHJhZGl1cyxcbiAgICAgIHBhdGhUb3AocnRsKSB7XG4gICAgICAgIHJldHVybiBydGwgPyBwYXRoVG9wUnRsIDogJyc7XG4gICAgICB9LFxuICAgICAgcGF0aEJvdHRvbShydGwpIHtcbiAgICAgICAgcmV0dXJuIHJ0bCA/IHBhdGhCb3R0b21SdGwgOiBwYXRoQm90dG9tTHRyO1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCBjb250YWluaW5nIHNpemluZyBhbmQgcGF0aCBpbmZvcm1hdGlvbiBhYm91dCBvdXRzaWRlXG4gICAqICAgICBjb3JuZXIgaGlnaGxpZ2h0cy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBtYWtlT3V0c2lkZUNvcm5lcigpOiBPdXRzaWRlQ29ybmVyIHtcbiAgICBjb25zdCByYWRpdXMgPSB0aGlzLmNvbnN0YW50UHJvdmlkZXIuQ09STkVSX1JBRElVUztcbiAgICBjb25zdCBvZmZzZXQgPSB0aGlzLk9GRlNFVDtcblxuICAgIC8qKlxuICAgICAqIERpc3RhbmNlIGZyb20gc2hhcGUgZWRnZSB0byBpbnRlcnNlY3Qgd2l0aCBhIGN1cnZlZCBjb3JuZXIgYXQgNDUgZGVncmVlcy5cbiAgICAgKiBBcHBsaWVzIHRvIGhpZ2hsaWdodGluZyBvbiBhcm91bmQgdGhlIGluc2lkZSBvZiBhIGN1cnZlLlxuICAgICAqL1xuICAgIGNvbnN0IGRpc3RhbmNlNDVpbnNpZGUgPSAoMSAtIE1hdGguU1FSVDFfMikgKiAocmFkaXVzIC0gb2Zmc2V0KSArIG9mZnNldDtcblxuICAgIGNvbnN0IHRvcExlZnRTdGFydFggPSBkaXN0YW5jZTQ1aW5zaWRlO1xuICAgIGNvbnN0IHRvcExlZnRTdGFydFkgPSBkaXN0YW5jZTQ1aW5zaWRlO1xuICAgIGNvbnN0IHRvcExlZnRDb3JuZXJIaWdobGlnaHRSdGwgPVxuICAgICAgICBzdmdQYXRocy5tb3ZlQnkodG9wTGVmdFN0YXJ0WCwgdG9wTGVmdFN0YXJ0WSkgK1xuICAgICAgICBzdmdQYXRocy5hcmMoXG4gICAgICAgICAgICAnYScsICcwIDAsMScsIHJhZGl1cyAtIG9mZnNldCxcbiAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KHJhZGl1cyAtIHRvcExlZnRTdGFydFgsIC10b3BMZWZ0U3RhcnRZICsgb2Zmc2V0KSk7XG4gICAgLyoqXG4gICAgICogU1ZHIHBhdGggZm9yIGRyYXdpbmcgdGhlIGhpZ2hsaWdodCBvbiB0aGUgcm91bmRlZCB0b3AtbGVmdCBjb3JuZXIuXG4gICAgICovXG4gICAgY29uc3QgdG9wTGVmdENvcm5lckhpZ2hsaWdodEx0ciA9IHN2Z1BhdGhzLm1vdmVCeShvZmZzZXQsIHJhZGl1cykgK1xuICAgICAgICBzdmdQYXRocy5hcmMoXG4gICAgICAgICAgICAnYScsICcwIDAsMScsIHJhZGl1cyAtIG9mZnNldCxcbiAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KHJhZGl1cywgLXJhZGl1cyArIG9mZnNldCkpO1xuXG4gICAgY29uc3QgYm90dG9tTGVmdFN0YXJ0WCA9IGRpc3RhbmNlNDVpbnNpZGU7XG4gICAgY29uc3QgYm90dG9tTGVmdFN0YXJ0WSA9IC1kaXN0YW5jZTQ1aW5zaWRlO1xuICAgIGNvbnN0IGJvdHRvbUxlZnRQYXRoID0gc3ZnUGF0aHMubW92ZUJ5KGJvdHRvbUxlZnRTdGFydFgsIGJvdHRvbUxlZnRTdGFydFkpICtcbiAgICAgICAgc3ZnUGF0aHMuYXJjKFxuICAgICAgICAgICAgJ2EnLCAnMCAwLDEnLCByYWRpdXMgLSBvZmZzZXQsXG4gICAgICAgICAgICBzdmdQYXRocy5wb2ludChcbiAgICAgICAgICAgICAgICAtYm90dG9tTGVmdFN0YXJ0WCArIG9mZnNldCwgLWJvdHRvbUxlZnRTdGFydFkgLSByYWRpdXMpKTtcblxuICAgIHJldHVybiB7XG4gICAgICBoZWlnaHQ6IHJhZGl1cyxcbiAgICAgIHRvcExlZnQocnRsKSB7XG4gICAgICAgIHJldHVybiBydGwgPyB0b3BMZWZ0Q29ybmVySGlnaGxpZ2h0UnRsIDogdG9wTGVmdENvcm5lckhpZ2hsaWdodEx0cjtcbiAgICAgIH0sXG4gICAgICBib3R0b21MZWZ0KCkge1xuICAgICAgICByZXR1cm4gYm90dG9tTGVmdFBhdGg7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IHB1enpsZSB0YWJcbiAgICogICAgIGhpZ2hsaWdodHMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFrZVB1enpsZVRhYigpOiBQdXp6bGVUYWIge1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5jb25zdGFudFByb3ZpZGVyLlRBQl9XSURUSDtcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmNvbnN0YW50UHJvdmlkZXIuVEFCX0hFSUdIVDtcblxuICAgIC8vIFRoaXMgaXMgaG93IG11Y2ggb2YgdGhlIHZlcnRpY2FsIGJsb2NrIGVkZ2UgaXMgYWN0dWFsbHkgZHJhd24gYnkgdGhlXG4gICAgLy8gcHV6emxlIHRhYi5cbiAgICBjb25zdCB2ZXJ0aWNhbE92ZXJsYXAgPSAyLjU7XG5cbiAgICBjb25zdCBoaWdobGlnaHRSdGxVcCA9XG4gICAgICAgIHN2Z1BhdGhzLm1vdmVCeSgtMiwgLWhlaWdodCArIHZlcnRpY2FsT3ZlcmxhcCArIDAuOSkgK1xuICAgICAgICBzdmdQYXRocy5saW5lVG8od2lkdGggKiAtMC40NSwgLTIuMSk7XG5cbiAgICBjb25zdCBoaWdobGlnaHRSdGxEb3duID0gc3ZnUGF0aHMubGluZU9uQXhpcygndicsIHZlcnRpY2FsT3ZlcmxhcCkgK1xuICAgICAgICBzdmdQYXRocy5tb3ZlQnkoLXdpZHRoICogMC45NywgMi41KSArXG4gICAgICAgIHN2Z1BhdGhzLmN1cnZlKFxuICAgICAgICAgICAgJ3EnLFxuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICBzdmdQYXRocy5wb2ludCgtd2lkdGggKiAwLjA1LCAxMCksXG4gICAgICAgICAgICAgIHN2Z1BhdGhzLnBvaW50KHdpZHRoICogMC4zLCA5LjUpLFxuICAgICAgICAgICAgXSkgK1xuICAgICAgICBzdmdQYXRocy5tb3ZlQnkod2lkdGggKiAwLjY3LCAtMS45KSArXG4gICAgICAgIHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ3YnLCB2ZXJ0aWNhbE92ZXJsYXApO1xuXG4gICAgY29uc3QgaGlnaGxpZ2h0THRyVXAgPSBzdmdQYXRocy5saW5lT25BeGlzKCd2JywgLTEuNSkgK1xuICAgICAgICBzdmdQYXRocy5tb3ZlQnkod2lkdGggKiAtMC45MiwgLTAuNSkgK1xuICAgICAgICBzdmdQYXRocy5jdXJ2ZShcbiAgICAgICAgICAgICdxJyxcbiAgICAgICAgICAgIFtzdmdQYXRocy5wb2ludCh3aWR0aCAqIC0wLjE5LCAtNS41KSwgc3ZnUGF0aHMucG9pbnQoMCwgLTExKV0pICtcbiAgICAgICAgc3ZnUGF0aHMubW92ZUJ5KHdpZHRoICogMC45MiwgMSk7XG5cbiAgICBjb25zdCBoaWdobGlnaHRMdHJEb3duID1cbiAgICAgICAgc3ZnUGF0aHMubW92ZUJ5KC01LCBoZWlnaHQgLSAwLjcpICsgc3ZnUGF0aHMubGluZVRvKHdpZHRoICogMC40NiwgLTIuMSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgd2lkdGgsXG4gICAgICBoZWlnaHQsXG4gICAgICBwYXRoVXAocnRsKSB7XG4gICAgICAgIHJldHVybiBydGwgPyBoaWdobGlnaHRSdGxVcCA6IGhpZ2hsaWdodEx0clVwO1xuICAgICAgfSxcbiAgICAgIHBhdGhEb3duKHJ0bCkge1xuICAgICAgICByZXR1cm4gcnRsID8gaGlnaGxpZ2h0UnRsRG93biA6IGhpZ2hsaWdodEx0ckRvd247XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IG5vdGNoXG4gICAqICAgICBoaWdobGlnaHRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VOb3RjaCgpOiBOb3RjaCB7XG4gICAgLy8gVGhpcyBpcyBvbmx5IGZvciB0aGUgcHJldmlvdXMgY29ubmVjdGlvbi5cbiAgICBjb25zdCBwYXRoTGVmdCA9IHN2Z1BhdGhzLmxpbmVPbkF4aXMoJ2gnLCB0aGlzLk9GRlNFVCkgK1xuICAgICAgICB0aGlzLmNvbnN0YW50UHJvdmlkZXIuTk9UQ0gucGF0aExlZnQ7XG4gICAgcmV0dXJuIHtwYXRoTGVmdH07XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IGNvbGxhcHNlZFxuICAgKiAgICAgYmxvY2sgZWRnZSBoaWdobGlnaHRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VKYWdnZWRUZWV0aCgpOiBKYWdnZWRUZWV0aCB7XG4gICAgY29uc3QgcGF0aExlZnQgPSBzdmdQYXRocy5saW5lVG8oNS4xLCAyLjYpICsgc3ZnUGF0aHMubW92ZUJ5KC0xMC4yLCA2LjgpICtcbiAgICAgICAgc3ZnUGF0aHMubGluZVRvKDUuMSwgMi42KTtcbiAgICByZXR1cm4ge3BhdGhMZWZ0LCBoZWlnaHQ6IDEyLCB3aWR0aDogMTAuMn07XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgc2l6aW5nIGFuZCBwYXRoIGluZm9ybWF0aW9uIGFib3V0IHN0YXJ0XG4gICAqICAgICBoaWdobGlnaHRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG1ha2VTdGFydEhhdCgpOiBTdGFydEhhdCB7XG4gICAgY29uc3QgaGF0SGVpZ2h0ID0gdGhpcy5jb25zdGFudFByb3ZpZGVyLlNUQVJUX0hBVC5oZWlnaHQ7XG4gICAgY29uc3QgcGF0aFJ0bCA9IHN2Z1BhdGhzLm1vdmVCeSgyNSwgLTguNykgKyBzdmdQYXRocy5jdXJ2ZSgnYycsIFtcbiAgICAgIHN2Z1BhdGhzLnBvaW50KDI5LjcsIC02LjIpLFxuICAgICAgc3ZnUGF0aHMucG9pbnQoNTcuMiwgLTAuNSksXG4gICAgICBzdmdQYXRocy5wb2ludCg3NSwgOC43KSxcbiAgICBdKTtcblxuICAgIGNvbnN0IHBhdGhMdHIgPSBzdmdQYXRocy5jdXJ2ZSgnYycsIFtcbiAgICAgIHN2Z1BhdGhzLnBvaW50KDE3LjgsIC05LjIpLFxuICAgICAgc3ZnUGF0aHMucG9pbnQoNDUuMywgLTE0LjkpLFxuICAgICAgc3ZnUGF0aHMucG9pbnQoNzUsIC04LjcpLFxuICAgIF0pICsgc3ZnUGF0aHMubW92ZVRvKDEwMC41LCBoYXRIZWlnaHQgKyAwLjUpO1xuICAgIHJldHVybiB7XG4gICAgICBwYXRoKHJ0bCkge1xuICAgICAgICByZXR1cm4gcnRsID8gcGF0aFJ0bCA6IHBhdGhMdHI7XG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPYmplY3RzIHJlcHJlc2VudGluZyBpbmxpbmUgaW5wdXRzIHdpdGggY29ubmVjdGlvbnMgb24gYVxuICogcmVuZGVyZWQgYmxvY2suXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuZ2VyYXMuSW5saW5lSW5wdXQnKTtcblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzICovXG5pbXBvcnQgdHlwZSB7SW5wdXR9IGZyb20gJy4uLy4uLy4uL2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyIGFzIEJhc2VDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi8uLi8uLi9yZW5kZXJlcnMvY29tbW9uL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQge0lubGluZUlucHV0IGFzIEJhc2VJbmxpbmVJbnB1dH0gZnJvbSAnLi4vLi4vLi4vcmVuZGVyZXJzL21lYXN1cmFibGVzL2lubGluZV9pbnB1dC5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlciBhcyBHZXJhc0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4uL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3BhY2UgYW4gaW5saW5lIGlucHV0IHRha2VzIHVwXG4gKiBkdXJpbmcgcmVuZGVyaW5nLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmdlcmFzLklubGluZUlucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBJbmxpbmVJbnB1dCBleHRlbmRzIEJhc2VJbmxpbmVJbnB1dCB7XG4gIG92ZXJyaWRlIGNvbnN0YW50c186IEdlcmFzQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQHBhcmFtIGlucHV0IFRoZSBpbmxpbmUgaW5wdXQgdG8gbWVhc3VyZSBhbmQgc3RvcmUgaW5mb3JtYXRpb24gZm9yLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQmFzZUNvbnN0YW50UHJvdmlkZXIsIGlucHV0OiBJbnB1dCkge1xuICAgIHN1cGVyKGNvbnN0YW50cywgaW5wdXQpO1xuICAgIHRoaXMuY29uc3RhbnRzXyA9IGNvbnN0YW50cyBhcyBHZXJhc0NvbnN0YW50UHJvdmlkZXI7XG5cbiAgICBpZiAodGhpcy5jb25uZWN0ZWRCbG9jaykge1xuICAgICAgLy8gV2UgYWxsb3cgdGhlIGRhcmsgcGF0aCB0byBzaG93IG9uIHRoZSBwYXJlbnQgYmxvY2sgc28gdGhhdCB0aGUgY2hpbGRcbiAgICAgIC8vIGJsb2NrIGxvb2tzIGVtYm9zc2VkLiAgVGhpcyB0YWtlcyB1cCBhbiBleHRyYSBwaXhlbCBpbiBib3RoIHggYW5kIHkuXG4gICAgICB0aGlzLndpZHRoICs9IHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUO1xuICAgICAgdGhpcy5oZWlnaHQgKz0gdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQ7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogT2JqZWN0cyByZXByZXNlbnRpbmcgc3RhdGVtZW50IGlucHV0cyB3aXRoIGNvbm5lY3Rpb25zIG9uIGFcbiAqIHJlbmRlcmVkIGJsb2NrLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmdlcmFzLlN0YXRlbWVudElucHV0Jyk7XG5cbi8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycyAqL1xuaW1wb3J0IHR5cGUge0lucHV0fSBmcm9tICcuLi8uLi8uLi9pbnB1dC5qcyc7XG5pbXBvcnQgdHlwZSB7Q29uc3RhbnRQcm92aWRlciBhcyBCYXNlQ29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi4vLi4vLi4vcmVuZGVyZXJzL2NvbW1vbi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtTdGF0ZW1lbnRJbnB1dCBhcyBCYXNlU3RhdGVtZW50SW5wdXR9IGZyb20gJy4uLy4uLy4uL3JlbmRlcmVycy9tZWFzdXJhYmxlcy9zdGF0ZW1lbnRfaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXIgYXMgR2VyYXNDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuXG5cbi8qKlxuICogQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNwYWNlIGEgc3RhdGVtZW50IGlucHV0IHRha2VzIHVwXG4gKiBkdXJpbmcgcmVuZGVyaW5nLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LmdlcmFzLlN0YXRlbWVudElucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBTdGF0ZW1lbnRJbnB1dCBleHRlbmRzIEJhc2VTdGF0ZW1lbnRJbnB1dCB7XG4gIG92ZXJyaWRlIGNvbnN0YW50c186IEdlcmFzQ29uc3RhbnRQcm92aWRlcjtcblxuICAvKipcbiAgICogQHBhcmFtIGNvbnN0YW50cyBUaGUgcmVuZGVyaW5nIGNvbnN0YW50cyBwcm92aWRlci5cbiAgICogQHBhcmFtIGlucHV0IFRoZSBzdGF0ZW1lbnQgaW5wdXQgdG8gbWVhc3VyZSBhbmQgc3RvcmUgaW5mb3JtYXRpb24gZm9yLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbnN0YW50czogQmFzZUNvbnN0YW50UHJvdmlkZXIsIGlucHV0OiBJbnB1dCkge1xuICAgIHN1cGVyKGNvbnN0YW50cywgaW5wdXQpO1xuICAgIHRoaXMuY29uc3RhbnRzXyA9IGNvbnN0YW50cyBhcyBHZXJhc0NvbnN0YW50UHJvdmlkZXI7XG5cbiAgICBpZiAodGhpcy5jb25uZWN0ZWRCbG9jaykge1xuICAgICAgLy8gV2UgYWxsb3cgdGhlIGRhcmsgcGF0aCB0byBzaG93IG9uIHRoZSBwYXJlbnQgYmxvY2sgc28gdGhhdCB0aGUgY2hpbGRcbiAgICAgIC8vIGJsb2NrIGxvb2tzIGVtYm9zc2VkLiAgVGhpcyB0YWtlcyB1cCBhbiBleHRyYSBwaXhlbCBpbiBib3RoIHggYW5kIHkuXG4gICAgICB0aGlzLmhlaWdodCArPSB0aGlzLmNvbnN0YW50c18uREFSS19QQVRIX09GRlNFVDtcbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBPbGQgKGNvbXBhdGliaWxpdHkpIHJlbmRlcmVyLlxuICogR2VyYXM6IHNwaXJpdCBvZiBvbGQgYWdlLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmdlcmFzLlJlbmRlckluZm8nKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0lucHV0fSBmcm9tICcuLi8uLi9pbnB1dC5qcyc7XG5pbXBvcnQge2lucHV0VHlwZXN9IGZyb20gJy4uLy4uL2lucHV0X3R5cGVzLmpzJztcbmltcG9ydCB7UmVuZGVySW5mbyBhcyBCYXNlUmVuZGVySW5mb30gZnJvbSAnLi4vY29tbW9uL2luZm8uanMnO1xuaW1wb3J0IHR5cGUge01lYXN1cmFibGV9IGZyb20gJy4uL21lYXN1cmFibGVzL2Jhc2UuanMnO1xuaW1wb3J0IHR5cGUge0JvdHRvbVJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvYm90dG9tX3Jvdy5qcyc7XG5pbXBvcnQge0V4dGVybmFsVmFsdWVJbnB1dH0gZnJvbSAnLi4vbWVhc3VyYWJsZXMvZXh0ZXJuYWxfdmFsdWVfaW5wdXQuanMnO1xuaW1wb3J0IHR5cGUge0ZpZWxkfSBmcm9tICcuLi9tZWFzdXJhYmxlcy9maWVsZC5qcyc7XG5pbXBvcnQge0luUm93U3BhY2VyfSBmcm9tICcuLi9tZWFzdXJhYmxlcy9pbl9yb3dfc3BhY2VyLmpzJztcbmltcG9ydCB0eXBlIHtJbnB1dFJvd30gZnJvbSAnLi4vbWVhc3VyYWJsZXMvaW5wdXRfcm93LmpzJztcbmltcG9ydCB0eXBlIHtSb3d9IGZyb20gJy4uL21lYXN1cmFibGVzL3Jvdy5qcyc7XG5pbXBvcnQgdHlwZSB7VG9wUm93fSBmcm9tICcuLi9tZWFzdXJhYmxlcy90b3Bfcm93LmpzJztcbmltcG9ydCB7VHlwZXN9IGZyb20gJy4uL21lYXN1cmFibGVzL3R5cGVzLmpzJztcblxuaW1wb3J0IHR5cGUge0NvbnN0YW50UHJvdmlkZXJ9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7SW5saW5lSW5wdXR9IGZyb20gJy4vbWVhc3VyYWJsZXMvaW5saW5lX2lucHV0LmpzJztcbmltcG9ydCB7U3RhdGVtZW50SW5wdXR9IGZyb20gJy4vbWVhc3VyYWJsZXMvc3RhdGVtZW50X2lucHV0LmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJlcn0gZnJvbSAnLi9yZW5kZXJlci5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgc2l6aW5nIGluZm9ybWF0aW9uIG5lZWRlZCB0byBkcmF3IHRoaXMgYmxvY2suXG4gKlxuICogVGhpcyBtZWFzdXJlIHBhc3MgZG9lcyBub3QgcHJvcGFnYXRlIGNoYW5nZXMgdG8gdGhlIGJsb2NrIChhbHRob3VnaCBmaWVsZHNcbiAqIG1heSBjaG9vc2UgdG8gcmVyZW5kZXIgd2hlbiBnZXRTaXplKCkgaXMgY2FsbGVkKS4gIEhvd2V2ZXIsIGNhbGxpbmcgaXRcbiAqIHJlcGVhdGVkbHkgbWF5IGJlIGV4cGVuc2l2ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5nZXJhcy5SZW5kZXJJbmZvXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJJbmZvIGV4dGVuZHMgQmFzZVJlbmRlckluZm8ge1xuICAvLyBUT0RPKGIvMTA5ODE2OTU1KTogcmVtb3ZlICchJywgc2VlIGdvL3N0cmljdC1wcm9wLWluaXQtZml4LlxuICBvdmVycmlkZSBjb25zdGFudHNfITogQ29uc3RhbnRQcm92aWRlcjtcblxuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgcmVhZG9ubHkgcmVuZGVyZXJfOiBSZW5kZXJlcjtcblxuICAvKipcbiAgICogQHBhcmFtIHJlbmRlcmVyIFRoZSByZW5kZXJlciBpbiB1c2UuXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gbWVhc3VyZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihyZW5kZXJlcjogUmVuZGVyZXIsIGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIHN1cGVyKHJlbmRlcmVyLCBibG9jayk7XG4gICAgdGhpcy5yZW5kZXJlcl8gPSByZW5kZXJlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGJsb2NrIHJlbmRlcmVyIGluIHVzZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGJsb2NrIHJlbmRlcmVyIGluIHVzZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBnZXRSZW5kZXJlcigpOiBSZW5kZXJlciB7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXJfO1xuICB9XG5cbiAgb3ZlcnJpZGUgcG9wdWxhdGVCb3R0b21Sb3dfKCkge1xuICAgIHN1cGVyLnBvcHVsYXRlQm90dG9tUm93XygpO1xuXG4gICAgY29uc3QgZm9sbG93c1N0YXRlbWVudCA9IHRoaXMuYmxvY2tfLmlucHV0TGlzdC5sZW5ndGggJiZcbiAgICAgICAgdGhpcy5ibG9ja18uaW5wdXRMaXN0W3RoaXMuYmxvY2tfLmlucHV0TGlzdC5sZW5ndGggLSAxXS50eXBlID09PVxuICAgICAgICAgICAgaW5wdXRUeXBlcy5TVEFURU1FTlQ7XG4gICAgLy8gVGhlIG1pbmltdW0gaGVpZ2h0IG9mIHRoZSBib3R0b20gcm93IGlzIHNtYWxsZXIgaW4gR2VyYXMgdGhhbiBpbiBvdGhlclxuICAgIC8vIHJlbmRlcmVycywgYmVjYXVzZSB0aGUgZGFyayBwYXRoIGFkZHMgYSBwaXhlbC5cbiAgICAvLyBJZiBvbmUgb2YgdGhlIHJvdydzIGVsZW1lbnRzIGhhcyBhIGdyZWF0ZXIgaGVpZ2h0IHRoaXMgd2lsbCBiZVxuICAgIC8vIG92ZXJ3cml0dGVuIGluIHRoZSBjb21wdXRlIHBhc3MuXG4gICAgaWYgKCFmb2xsb3dzU3RhdGVtZW50KSB7XG4gICAgICB0aGlzLmJvdHRvbVJvdy5taW5IZWlnaHQgPVxuICAgICAgICAgIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORyAtIHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUO1xuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIGFkZElucHV0XyhpbnB1dDogSW5wdXQsIGFjdGl2ZVJvdzogUm93KSB7XG4gICAgLy8gTm9uLWR1bW15IGlucHV0cyBoYXZlIHZpc3VhbCByZXByZXNlbnRhdGlvbnMgb25zY3JlZW4uXG4gICAgaWYgKHRoaXMuaXNJbmxpbmUgJiYgaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSkge1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IElubGluZUlucHV0KHRoaXMuY29uc3RhbnRzXywgaW5wdXQpKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNJbmxpbmVJbnB1dCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLlNUQVRFTUVOVCkge1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IFN0YXRlbWVudElucHV0KHRoaXMuY29uc3RhbnRzXywgaW5wdXQpKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNTdGF0ZW1lbnQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoaW5wdXQudHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSkge1xuICAgICAgYWN0aXZlUm93LmVsZW1lbnRzLnB1c2gobmV3IEV4dGVybmFsVmFsdWVJbnB1dCh0aGlzLmNvbnN0YW50c18sIGlucHV0KSk7XG4gICAgICBhY3RpdmVSb3cuaGFzRXh0ZXJuYWxJbnB1dCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChpbnB1dC50eXBlID09PSBpbnB1dFR5cGVzLkRVTU1ZKSB7XG4gICAgICAvLyBEdW1teSBpbnB1dHMgaGF2ZSBubyB2aXN1YWwgcmVwcmVzZW50YXRpb24sIGJ1dCB0aGUgaW5mb3JtYXRpb24gaXNcbiAgICAgIC8vIHN0aWxsIGltcG9ydGFudC5cbiAgICAgIGFjdGl2ZVJvdy5taW5IZWlnaHQgPVxuICAgICAgICAgIE1hdGgubWF4KGFjdGl2ZVJvdy5taW5IZWlnaHQsIHRoaXMuY29uc3RhbnRzXy5EVU1NWV9JTlBVVF9NSU5fSEVJR0hUKTtcbiAgICAgIGFjdGl2ZVJvdy5oYXNEdW1teUlucHV0ID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gSWdub3JlIHJvdyBhbGlnbm1lbnQgaWYgaW5saW5lLlxuICAgIGlmICghdGhpcy5pc0lubGluZSAmJiBhY3RpdmVSb3cuYWxpZ24gPT09IG51bGwpIHtcbiAgICAgIGFjdGl2ZVJvdy5hbGlnbiA9IGlucHV0LmFsaWduO1xuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIGFkZEVsZW1TcGFjaW5nXygpIHtcbiAgICBsZXQgaGFzRXh0ZXJuYWxJbnB1dHMgPSBmYWxzZTtcbiAgICBmb3IgKGxldCBpID0gMCwgcm93OyByb3cgPSB0aGlzLnJvd3NbaV07IGkrKykge1xuICAgICAgaWYgKHJvdy5oYXNFeHRlcm5hbElucHV0KSB7XG4gICAgICAgIGhhc0V4dGVybmFsSW5wdXRzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDAsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpKyspIHtcbiAgICAgIGNvbnN0IG9sZEVsZW1zID0gcm93LmVsZW1lbnRzO1xuICAgICAgcm93LmVsZW1lbnRzID0gW107XG4gICAgICAvLyBObyBzcGFjaW5nIG5lZWRlZCBiZWZvcmUgdGhlIGNvcm5lciBvbiB0aGUgdG9wIHJvdyBvciB0aGUgYm90dG9tIHJvdy5cbiAgICAgIGlmIChyb3cuc3RhcnRzV2l0aEVsZW1TcGFjZXIoKSkge1xuICAgICAgICAvLyBUaGVyZSdzIGEgc3BhY2VyIGJlZm9yZSB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgcm93LlxuICAgICAgICByb3cuZWxlbWVudHMucHVzaChuZXcgSW5Sb3dTcGFjZXIoXG4gICAgICAgICAgICB0aGlzLmNvbnN0YW50c18sIHRoaXMuZ2V0SW5Sb3dTcGFjaW5nXyhudWxsLCBvbGRFbGVtc1swXSkpKTtcbiAgICAgIH1cbiAgICAgIGlmICghb2xkRWxlbXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCBvbGRFbGVtcy5sZW5ndGggLSAxOyBlKyspIHtcbiAgICAgICAgcm93LmVsZW1lbnRzLnB1c2gob2xkRWxlbXNbZV0pO1xuICAgICAgICBjb25zdCBzcGFjaW5nID0gdGhpcy5nZXRJblJvd1NwYWNpbmdfKG9sZEVsZW1zW2VdLCBvbGRFbGVtc1tlICsgMV0pO1xuICAgICAgICByb3cuZWxlbWVudHMucHVzaChuZXcgSW5Sb3dTcGFjZXIodGhpcy5jb25zdGFudHNfLCBzcGFjaW5nKSk7XG4gICAgICB9XG4gICAgICByb3cuZWxlbWVudHMucHVzaChvbGRFbGVtc1tvbGRFbGVtcy5sZW5ndGggLSAxXSk7XG4gICAgICBpZiAocm93LmVuZHNXaXRoRWxlbVNwYWNlcigpKSB7XG4gICAgICAgIGxldCBzcGFjaW5nID1cbiAgICAgICAgICAgIHRoaXMuZ2V0SW5Sb3dTcGFjaW5nXyhvbGRFbGVtc1tvbGRFbGVtcy5sZW5ndGggLSAxXSwgbnVsbCk7XG4gICAgICAgIGlmIChoYXNFeHRlcm5hbElucHV0cyAmJiByb3cuaGFzRHVtbXlJbnB1dCkge1xuICAgICAgICAgIHNwYWNpbmcgKz0gdGhpcy5jb25zdGFudHNfLlRBQl9XSURUSDtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGVyZSdzIGEgc3BhY2VyIGFmdGVyIHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIHJvdy5cbiAgICAgICAgcm93LmVsZW1lbnRzLnB1c2gobmV3IEluUm93U3BhY2VyKHRoaXMuY29uc3RhbnRzXywgc3BhY2luZykpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG92ZXJyaWRlIGdldEluUm93U3BhY2luZ18ocHJldjogTWVhc3VyYWJsZXxudWxsLCBuZXh0OiBNZWFzdXJhYmxlfG51bGwpIHtcbiAgICBpZiAoIXByZXYpIHtcbiAgICAgIC8vIEJldHdlZW4gYW4gZWRpdGFibGUgZmllbGQgYW5kIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJvdy5cbiAgICAgIGlmIChuZXh0ICYmIFR5cGVzLmlzRmllbGQobmV4dCkgJiYgKG5leHQgYXMgRmllbGQpLmlzRWRpdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgICAgIH1cbiAgICAgIC8vIElubGluZSBpbnB1dCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSByb3cuXG4gICAgICBpZiAobmV4dCAmJiBUeXBlcy5pc0lubGluZUlucHV0KG5leHQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUVESVVNX0xBUkdFX1BBRERJTkc7XG4gICAgICB9XG4gICAgICBpZiAobmV4dCAmJiBUeXBlcy5pc1N0YXRlbWVudElucHV0KG5leHQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uU1RBVEVNRU5UX0lOUFVUX1BBRERJTkdfTEVGVDtcbiAgICAgIH1cbiAgICAgIC8vIEFueXRoaW5nIGVsc2UgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcm93LlxuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgIH1cblxuICAgIC8vIFNwYWNpbmcgYmV0d2VlbiBhIG5vbi1pbnB1dCBhbmQgdGhlIGVuZCBvZiB0aGUgcm93IG9yIGEgc3RhdGVtZW50IGlucHV0LlxuICAgIGlmICghVHlwZXMuaXNJbnB1dChwcmV2KSAmJiAoIW5leHQgfHwgVHlwZXMuaXNTdGF0ZW1lbnRJbnB1dChuZXh0KSkpIHtcbiAgICAgIC8vIEJldHdlZW4gYW4gZWRpdGFibGUgZmllbGQgYW5kIHRoZSBlbmQgb2YgdGhlIHJvdy5cbiAgICAgIGlmIChUeXBlcy5pc0ZpZWxkKHByZXYpICYmIChwcmV2IGFzIEZpZWxkKS5pc0VkaXRhYmxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUVESVVNX1BBRERJTkc7XG4gICAgICB9XG4gICAgICAvLyBQYWRkaW5nIGF0IHRoZSBlbmQgb2YgYW4gaWNvbi1vbmx5IHJvdyB0byBtYWtlIHRoZSBibG9jayBzaGFwZSBjbGVhcmVyLlxuICAgICAgaWYgKFR5cGVzLmlzSWNvbihwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkcgKiAyICsgMTtcbiAgICAgIH1cbiAgICAgIGlmIChUeXBlcy5pc0hhdChwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgICB9XG4gICAgICAvLyBFc3RhYmxpc2ggYSBtaW5pbXVtIHdpZHRoIGZvciBhIGJsb2NrIHdpdGggYSBwcmV2aW91cyBvciBuZXh0XG4gICAgICAvLyBjb25uZWN0aW9uLlxuICAgICAgaWYgKFR5cGVzLmlzUHJldmlvdXNPck5leHRDb25uZWN0aW9uKHByZXYpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICAgIH1cbiAgICAgIC8vIEJldHdlZW4gcm91bmRlZCBjb3JuZXIgYW5kIHRoZSBlbmQgb2YgdGhlIHJvdy5cbiAgICAgIGlmIChUeXBlcy5pc0xlZnRSb3VuZGVkQ29ybmVyKHByZXYpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUlOX0JMT0NLX1dJRFRIO1xuICAgICAgfVxuICAgICAgLy8gQmV0d2VlbiBhIGphZ2dlZCBlZGdlIGFuZCB0aGUgZW5kIG9mIHRoZSByb3cuXG4gICAgICBpZiAoVHlwZXMuaXNKYWdnZWRFZGdlKHByZXYpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTk9fUEFERElORztcbiAgICAgIH1cbiAgICAgIC8vIEJldHdlZW4gbm9uZWRpdGFibGUgZmllbGRzIGFuZCBpY29ucyBhbmQgdGhlIGVuZCBvZiB0aGUgcm93LlxuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgIH1cblxuICAgIC8vIEJldHdlZW4gaW5wdXRzIGFuZCB0aGUgZW5kIG9mIHRoZSByb3cuXG4gICAgaWYgKFR5cGVzLmlzSW5wdXQocHJldikgJiYgIW5leHQpIHtcbiAgICAgIGlmIChUeXBlcy5pc0V4dGVybmFsSW5wdXQocHJldikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5OT19QQURESU5HO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc0lubGluZUlucHV0KHByZXYpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNTdGF0ZW1lbnRJbnB1dChwcmV2KSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk5PX1BBRERJTkc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgbm9uLWlucHV0IGFuZCBhbiBpbnB1dC5cbiAgICBpZiAoIVR5cGVzLmlzSW5wdXQocHJldikgJiYgbmV4dCAmJiBUeXBlcy5pc0lucHV0KG5leHQpKSB7XG4gICAgICAvLyBCZXR3ZWVuIGFuIGVkaXRhYmxlIGZpZWxkIGFuZCBhbiBpbnB1dC5cbiAgICAgIGlmIChUeXBlcy5pc0ZpZWxkKHByZXYpICYmIChwcmV2IGFzIEZpZWxkKS5pc0VkaXRhYmxlKSB7XG4gICAgICAgIGlmIChUeXBlcy5pc0lubGluZUlucHV0KG5leHQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5TTUFMTF9QQURESU5HO1xuICAgICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzRXh0ZXJuYWxJbnB1dChuZXh0KSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uU01BTExfUEFERElORztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQobmV4dCkpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk1FRElVTV9MQVJHRV9QQURESU5HO1xuICAgICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzRXh0ZXJuYWxJbnB1dChuZXh0KSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTUVESVVNX0xBUkdFX1BBRERJTkc7XG4gICAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNTdGF0ZW1lbnRJbnB1dChuZXh0KSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HIC0gMTtcbiAgICB9XG5cbiAgICAvLyBTcGFjaW5nIGJldHdlZW4gYW4gaWNvbiBhbmQgYW4gaWNvbiBvciBmaWVsZC5cbiAgICBpZiAoVHlwZXMuaXNJY29uKHByZXYpICYmIG5leHQgJiYgIVR5cGVzLmlzSW5wdXQobmV4dCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGFuIGlubGluZSBpbnB1dCBhbmQgYSBmaWVsZC5cbiAgICBpZiAoVHlwZXMuaXNJbmxpbmVJbnB1dChwcmV2KSAmJiBuZXh0ICYmIFR5cGVzLmlzRmllbGQobmV4dCkpIHtcbiAgICAgIC8vIEVkaXRhYmxlIGZpZWxkIGFmdGVyIGlubGluZSBpbnB1dC5cbiAgICAgIGlmICgobmV4dCBhcyBGaWVsZCkuaXNFZGl0YWJsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLk1FRElVTV9QQURESU5HO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTm9uZWRpdGFibGUgZmllbGQgYWZ0ZXIgaW5saW5lIGlucHV0LlxuICAgICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKFR5cGVzLmlzTGVmdFNxdWFyZUNvcm5lcihwcmV2KSAmJiBuZXh0KSB7XG4gICAgICAvLyBTcGFjaW5nIGJldHdlZW4gYSBoYXQgYW5kIGEgY29ybmVyXG4gICAgICBpZiAoVHlwZXMuaXNIYXQobmV4dCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5OT19QQURESU5HO1xuICAgICAgfVxuICAgICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgc3F1YXJlIGNvcm5lciBhbmQgYSBwcmV2aW91cyBvciBuZXh0IGNvbm5lY3Rpb25cbiAgICAgIGlmIChUeXBlcy5pc1ByZXZpb3VzQ29ubmVjdGlvbihuZXh0KSkge1xuICAgICAgICByZXR1cm4gbmV4dC5ub3RjaE9mZnNldDtcbiAgICAgIH0gZWxzZSBpZiAoVHlwZXMuaXNOZXh0Q29ubmVjdGlvbihuZXh0KSkge1xuICAgICAgICAvLyBOZXh0IGNvbm5lY3Rpb25zIGFyZSBzaGlmdGVkIHNsaWdodGx5IHRvIHRoZSBsZWZ0IChpbiBib3RoIExUUiBhbmRcbiAgICAgICAgLy8gUlRMKSB0byBtYWtlIHRoZSBkYXJrIHBhdGggdW5kZXIgdGhlIHByZXZpb3VzIGNvbm5lY3Rpb24gc2hvd1xuICAgICAgICAvLyB0aHJvdWdoLlxuICAgICAgICBjb25zdCBvZmZzZXQgPVxuICAgICAgICAgICAgKHRoaXMuUlRMID8gMSA6IC0xKSAqIHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUIC8gMjtcbiAgICAgICAgcmV0dXJuIG5leHQubm90Y2hPZmZzZXQgKyBvZmZzZXQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU3BhY2luZyBiZXR3ZWVuIGEgcm91bmRlZCBjb3JuZXIgYW5kIGEgcHJldmlvdXMgb3IgbmV4dCBjb25uZWN0aW9uLlxuICAgIGlmIChUeXBlcy5pc0xlZnRSb3VuZGVkQ29ybmVyKHByZXYpICYmIG5leHQpIHtcbiAgICAgIGlmIChUeXBlcy5pc1ByZXZpb3VzQ29ubmVjdGlvbihuZXh0KSkge1xuICAgICAgICByZXR1cm4gbmV4dC5ub3RjaE9mZnNldCAtIHRoaXMuY29uc3RhbnRzXy5DT1JORVJfUkFESVVTO1xuICAgICAgfSBlbHNlIGlmIChUeXBlcy5pc05leHRDb25uZWN0aW9uKG5leHQpKSB7XG4gICAgICAgIC8vIE5leHQgY29ubmVjdGlvbnMgYXJlIHNoaWZ0ZWQgc2xpZ2h0bHkgdG8gdGhlIGxlZnQgKGluIGJvdGggTFRSIGFuZFxuICAgICAgICAvLyBSVEwpIHRvIG1ha2UgdGhlIGRhcmsgcGF0aCB1bmRlciB0aGUgcHJldmlvdXMgY29ubmVjdGlvbiBzaG93XG4gICAgICAgIC8vIHRocm91Z2guXG4gICAgICAgIGNvbnN0IG9mZnNldCA9XG4gICAgICAgICAgICAodGhpcy5SVEwgPyAxIDogLTEpICogdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQgLyAyO1xuICAgICAgICByZXR1cm4gbmV4dC5ub3RjaE9mZnNldCAtIHRoaXMuY29uc3RhbnRzXy5DT1JORVJfUkFESVVTICsgb2Zmc2V0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNwYWNpbmcgYmV0d2VlbiB0d28gZmllbGRzIG9mIHRoZSBzYW1lIGVkaXRhYmlsaXR5LlxuICAgIGlmIChUeXBlcy5pc0ZpZWxkKHByZXYpICYmIG5leHQgJiYgVHlwZXMuaXNGaWVsZChuZXh0KSAmJlxuICAgICAgICAocHJldiBhcyBGaWVsZCkuaXNFZGl0YWJsZSA9PT0gKG5leHQgYXMgRmllbGQpLmlzRWRpdGFibGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG5cbiAgICAvLyBTcGFjaW5nIGJldHdlZW4gYW55dGhpbmcgYW5kIGEgamFnZ2VkIGVkZ2UuXG4gICAgaWYgKG5leHQgJiYgVHlwZXMuaXNKYWdnZWRFZGdlKG5leHQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFNwYWNlclJvd0hlaWdodF8ocHJldjogUm93LCBuZXh0OiBSb3cpIHtcbiAgICAvLyBJZiB3ZSBoYXZlIGFuIGVtcHR5IGJsb2NrIGFkZCBhIHNwYWNlciB0byBpbmNyZWFzZSB0aGUgaGVpZ2h0LlxuICAgIGlmIChUeXBlcy5pc1RvcFJvdyhwcmV2KSAmJiBUeXBlcy5pc0JvdHRvbVJvdyhuZXh0KSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5FTVBUWV9CTE9DS19TUEFDRVJfSEVJR0hUO1xuICAgIH1cbiAgICAvLyBUb3AgYW5kIGJvdHRvbSByb3dzIGFjdCBhcyBhIHNwYWNlciBzbyB3ZSBkb24ndCBuZWVkIGFueSBleHRyYSBwYWRkaW5nLlxuICAgIGlmIChUeXBlcy5pc1RvcFJvdyhwcmV2KSB8fCBUeXBlcy5pc0JvdHRvbVJvdyhuZXh0KSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5OT19QQURESU5HO1xuICAgIH1cbiAgICBpZiAocHJldi5oYXNFeHRlcm5hbElucHV0ICYmIG5leHQuaGFzRXh0ZXJuYWxJbnB1dCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5MQVJHRV9QQURESU5HO1xuICAgIH1cbiAgICBpZiAoIXByZXYuaGFzU3RhdGVtZW50ICYmIG5leHQuaGFzU3RhdGVtZW50KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkJFVFdFRU5fU1RBVEVNRU5UX1BBRERJTkdfWTtcbiAgICB9XG4gICAgaWYgKHByZXYuaGFzU3RhdGVtZW50ICYmIG5leHQuaGFzU3RhdGVtZW50KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgfVxuICAgIGlmICghcHJldi5oYXNTdGF0ZW1lbnQgJiYgbmV4dC5oYXNEdW1teUlucHV0KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25zdGFudHNfLkxBUkdFX1BBRERJTkc7XG4gICAgfVxuICAgIGlmIChwcmV2Lmhhc0R1bW15SW5wdXQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnN0YW50c18uTEFSR0VfUEFERElORztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzXy5NRURJVU1fUEFERElORztcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEVsZW1DZW50ZXJsaW5lXyhyb3c6IFJvdywgZWxlbTogTWVhc3VyYWJsZSkge1xuICAgIGlmIChUeXBlcy5pc1NwYWNlcihlbGVtKSkge1xuICAgICAgcmV0dXJuIHJvdy55UG9zICsgZWxlbS5oZWlnaHQgLyAyO1xuICAgIH1cbiAgICBpZiAoVHlwZXMuaXNCb3R0b21Sb3cocm93KSkge1xuICAgICAgY29uc3QgYm90dG9tUm93ID0gcm93IGFzIEJvdHRvbVJvdztcbiAgICAgIGNvbnN0IGJhc2VsaW5lID1cbiAgICAgICAgICBib3R0b21Sb3cueVBvcyArIGJvdHRvbVJvdy5oZWlnaHQgLSBib3R0b21Sb3cuZGVzY2VuZGVySGVpZ2h0O1xuICAgICAgaWYgKFR5cGVzLmlzTmV4dENvbm5lY3Rpb24oZWxlbSkpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VsaW5lICsgZWxlbS5oZWlnaHQgLyAyO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VsaW5lIC0gZWxlbS5oZWlnaHQgLyAyO1xuICAgIH1cbiAgICBpZiAoVHlwZXMuaXNUb3BSb3cocm93KSkge1xuICAgICAgY29uc3QgdG9wUm93ID0gcm93IGFzIFRvcFJvdztcbiAgICAgIGlmIChUeXBlcy5pc0hhdChlbGVtKSkge1xuICAgICAgICByZXR1cm4gdG9wUm93LmNhcGxpbmUgLSBlbGVtLmhlaWdodCAvIDI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9wUm93LmNhcGxpbmUgKyBlbGVtLmhlaWdodCAvIDI7XG4gICAgfVxuXG4gICAgbGV0IHJlc3VsdCA9IHJvdy55UG9zO1xuICAgIGlmIChUeXBlcy5pc0ZpZWxkKGVsZW0pIHx8IFR5cGVzLmlzSWNvbihlbGVtKSkge1xuICAgICAgcmVzdWx0ICs9IGVsZW0uaGVpZ2h0IC8gMjtcbiAgICAgIGlmICgocm93Lmhhc0lubGluZUlucHV0IHx8IHJvdy5oYXNTdGF0ZW1lbnQpICYmXG4gICAgICAgICAgZWxlbS5oZWlnaHQgKyB0aGlzLmNvbnN0YW50c18uVEFMTF9JTlBVVF9GSUVMRF9PRkZTRVRfWSA8PVxuICAgICAgICAgICAgICByb3cuaGVpZ2h0KSB7XG4gICAgICAgIHJlc3VsdCArPSB0aGlzLmNvbnN0YW50c18uVEFMTF9JTlBVVF9GSUVMRF9PRkZTRVRfWTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKFR5cGVzLmlzSW5saW5lSW5wdXQoZWxlbSkpIHtcbiAgICAgIHJlc3VsdCArPSBlbGVtLmhlaWdodCAvIDI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdCArPSByb3cuaGVpZ2h0IC8gMjtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIG92ZXJyaWRlIGFsaWduUm93RWxlbWVudHNfKCkge1xuICAgIGlmICghdGhpcy5pc0lubGluZSkge1xuICAgICAgc3VwZXIuYWxpZ25Sb3dFbGVtZW50c18oKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gV2FsayBiYWNrZ3JvdW5kcyB0aHJvdWdoIHJvd3Mgb24gdGhlIGJsb2NrLCBrZWVwaW5nIHRyYWNrIG9mIHRoZSByaWdodFxuICAgIC8vIGlucHV0IGVkZ2UuXG4gICAgbGV0IG5leHRSaWdodEVkZ2UgPSAwO1xuICAgIGNvbnN0IHJvd05leHRSaWdodEVkZ2VzID0gbmV3IFdlYWtNYXAoKTtcbiAgICBsZXQgcHJldklucHV0ID0gbnVsbDtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5yb3dzLmxlbmd0aCAtIDEsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpLS0pIHtcbiAgICAgIHJvd05leHRSaWdodEVkZ2VzLnNldChyb3csIG5leHRSaWdodEVkZ2UpO1xuICAgICAgaWYgKFR5cGVzLmlzSW5wdXRSb3cocm93KSkge1xuICAgICAgICBpZiAocm93Lmhhc1N0YXRlbWVudCkge1xuICAgICAgICAgIHRoaXMuYWxpZ25TdGF0ZW1lbnRSb3dfKHJvdyBhcyBJbnB1dFJvdyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZXZJbnB1dCAmJiBwcmV2SW5wdXQuaGFzU3RhdGVtZW50ICYmXG4gICAgICAgICAgICByb3cud2lkdGggPCBwcmV2SW5wdXQud2lkdGgpIHtcbiAgICAgICAgICByb3dOZXh0UmlnaHRFZGdlcy5zZXQocm93LCBwcmV2SW5wdXQud2lkdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5leHRSaWdodEVkZ2UgPSByb3cud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgcHJldklucHV0ID0gcm93O1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBXYWxrIGRvd24gZWFjaCByb3cgZnJvbSB0aGUgdG9wLCBjb21wYXJpbmcgdGhlIHByZXYgYW5kIG5leHQgcmlnaHQgaW5wdXRcbiAgICAvLyBlZGdlcyBhbmQgc2V0dGluZyB0aGUgZGVzaXJlZCB3aWR0aCB0byB0aGUgbWF4IG9mIHRoZSB0d28uXG4gICAgbGV0IHByZXZSaWdodEVkZ2UgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwLCByb3c7IHJvdyA9IHRoaXMucm93c1tpXTsgaSsrKSB7XG4gICAgICBpZiAocm93Lmhhc1N0YXRlbWVudCkge1xuICAgICAgICBwcmV2UmlnaHRFZGdlID0gdGhpcy5nZXREZXNpcmVkUm93V2lkdGhfKHJvdyk7XG4gICAgICB9IGVsc2UgaWYgKFR5cGVzLmlzU3BhY2VyKHJvdykpIHtcbiAgICAgICAgLy8gU2V0IHRoZSBzcGFjZXIgcm93IHRvIHRoZSBtYXggb2YgdGhlIHByZXYgb3IgbmV4dCBpbnB1dCB3aWR0aC5cbiAgICAgICAgcm93LndpZHRoID0gTWF0aC5tYXgocHJldlJpZ2h0RWRnZSwgcm93TmV4dFJpZ2h0RWRnZXMuZ2V0KHJvdykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY3VycmVudFdpZHRoID0gcm93LndpZHRoO1xuICAgICAgICBjb25zdCBkZXNpcmVkV2lkdGggPVxuICAgICAgICAgICAgTWF0aC5tYXgocHJldlJpZ2h0RWRnZSwgcm93TmV4dFJpZ2h0RWRnZXMuZ2V0KHJvdykpO1xuICAgICAgICBjb25zdCBtaXNzaW5nU3BhY2UgPSBkZXNpcmVkV2lkdGggLSBjdXJyZW50V2lkdGg7XG4gICAgICAgIGlmIChtaXNzaW5nU3BhY2UgPiAwKSB7XG4gICAgICAgICAgdGhpcy5hZGRBbGlnbm1lbnRQYWRkaW5nXyhyb3csIG1pc3NpbmdTcGFjZSk7XG4gICAgICAgIH1cbiAgICAgICAgcHJldlJpZ2h0RWRnZSA9IHJvdy53aWR0aDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBnZXREZXNpcmVkUm93V2lkdGhfKHJvdzogUm93KSB7XG4gICAgLy8gTGltaXQgdGhlIHdpZHRoIG9mIGEgc3RhdGVtZW50IHJvdyB3aGVuIGEgYmxvY2sgaXMgaW5saW5lLlxuICAgIGlmICh0aGlzLmlzSW5saW5lICYmIHJvdy5oYXNTdGF0ZW1lbnQpIHtcbiAgICAgIHJldHVybiB0aGlzLnN0YXRlbWVudEVkZ2UgKyB0aGlzLmNvbnN0YW50c18uTUFYX0JPVFRPTV9XSURUSCArXG4gICAgICAgICAgdGhpcy5zdGFydFg7XG4gICAgfVxuICAgIHJldHVybiBzdXBlci5nZXREZXNpcmVkUm93V2lkdGhfKHJvdyk7XG4gIH1cblxuICBvdmVycmlkZSBmaW5hbGl6ZV8oKSB7XG4gICAgLy8gUGVyZm9ybWFuY2Ugbm90ZTogdGhpcyBjb3VsZCBiZSBjb21iaW5lZCB3aXRoIHRoZSBkcmF3IHBhc3MsIGlmIHRoZSB0aW1lXG4gICAgLy8gdGhhdCB0aGlzIHRha2VzIGlzIGV4Y2Vzc2l2ZS4gIEJ1dCBpdCBzaG91bGRuJ3QgYmUsIGJlY2F1c2UgaXQgb25seVxuICAgIC8vIGFjY2Vzc2VzIGFuZCBzZXRzIHByb3BlcnRpZXMgdGhhdCBhbHJlYWR5IGV4aXN0IG9uIHRoZSBvYmplY3RzLlxuICAgIGxldCB3aWRlc3RSb3dXaXRoQ29ubmVjdGVkQmxvY2tzID0gMDtcbiAgICBsZXQgeUN1cnNvciA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDAsIHJvdzsgcm93ID0gdGhpcy5yb3dzW2ldOyBpKyspIHtcbiAgICAgIHJvdy55UG9zID0geUN1cnNvcjtcbiAgICAgIHJvdy54UG9zID0gdGhpcy5zdGFydFg7XG4gICAgICB5Q3Vyc29yICs9IHJvdy5oZWlnaHQ7XG5cbiAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgPVxuICAgICAgICAgIE1hdGgubWF4KHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MsIHJvdy53aWR0aFdpdGhDb25uZWN0ZWRCbG9ja3MpO1xuICAgICAgLy8gQWRkIHBhZGRpbmcgdG8gdGhlIGJvdHRvbSByb3cgaWYgYmxvY2sgaGVpZ2h0IGlzIGxlc3MgdGhhbiBtaW5pbXVtXG4gICAgICBjb25zdCBoZWlnaHRXaXRob3V0SGF0ID0geUN1cnNvciAtIHRoaXMudG9wUm93LmFzY2VuZGVySGVpZ2h0O1xuICAgICAgaWYgKHJvdyA9PT0gdGhpcy5ib3R0b21Sb3cgJiZcbiAgICAgICAgICBoZWlnaHRXaXRob3V0SGF0IDwgdGhpcy5jb25zdGFudHNfLk1JTl9CTE9DS19IRUlHSFQpIHtcbiAgICAgICAgLy8gQnV0IHRoZSBoYXQgaGVpZ2h0IHNob3VsZG4ndCBiZSBwYXJ0IG9mIHRoaXMuXG4gICAgICAgIGNvbnN0IGRpZmYgPSB0aGlzLmNvbnN0YW50c18uTUlOX0JMT0NLX0hFSUdIVCAtIGhlaWdodFdpdGhvdXRIYXQ7XG4gICAgICAgIHRoaXMuYm90dG9tUm93LmhlaWdodCArPSBkaWZmO1xuICAgICAgICB5Q3Vyc29yICs9IGRpZmY7XG4gICAgICB9XG4gICAgICB0aGlzLnJlY29yZEVsZW1Qb3NpdGlvbnNfKHJvdyk7XG4gICAgfVxuICAgIGlmICh0aGlzLm91dHB1dENvbm5lY3Rpb24gJiYgdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb24gJiZcbiAgICAgICAgdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5ibG9ja18ubmV4dENvbm5lY3Rpb24udGFyZ2V0QmxvY2soKTtcbiAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgLy8gSW5jbHVkZSB3aWR0aCBvZiBjb25uZWN0ZWQgYmxvY2sgaW4gdmFsdWUgdG8gc3RhY2sgd2lkdGggbWVhc3VyZW1lbnQuXG4gICAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgPSBNYXRoLm1heChcbiAgICAgICAgICAgIHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MsXG4gICAgICAgICAgICB0YXJnZXQuZ2V0SGVpZ2h0V2lkdGgoKS53aWR0aCAtIHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmJvdHRvbVJvdy5iYXNlbGluZSA9IHlDdXJzb3IgLSB0aGlzLmJvdHRvbVJvdy5kZXNjZW5kZXJIZWlnaHQ7XG4gICAgdGhpcy53aWR0aFdpdGhDaGlsZHJlbiA9IHdpZGVzdFJvd1dpdGhDb25uZWN0ZWRCbG9ja3MgKyB0aGlzLnN0YXJ0WCArXG4gICAgICAgIHRoaXMuY29uc3RhbnRzXy5EQVJLX1BBVEhfT0ZGU0VUO1xuICAgIHRoaXMud2lkdGggKz0gdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQ7XG4gICAgdGhpcy5oZWlnaHQgPSB5Q3Vyc29yICsgdGhpcy5jb25zdGFudHNfLkRBUktfUEFUSF9PRkZTRVQ7XG4gICAgdGhpcy5zdGFydFkgPSB0aGlzLnRvcFJvdy5jYXBsaW5lO1xuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQW4gb2JqZWN0IHRoYXQgb3ducyBhIGJsb2NrJ3MgcmVuZGVyaW5nIFNWRyBlbGVtZW50cy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5nZXJhcy5QYXRoT2JqZWN0Jyk7XG5cbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi4vLi4vYmxvY2tfc3ZnLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N0eWxlfSBmcm9tICcuLi8uLi90aGVtZS5qcyc7XG5pbXBvcnQgKiBhcyBjb2xvdXIgZnJvbSAnLi4vLi4vdXRpbHMvY29sb3VyLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuLi8uLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4uLy4uL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQge1BhdGhPYmplY3QgYXMgQmFzZVBhdGhPYmplY3R9IGZyb20gJy4uL2NvbW1vbi9wYXRoX29iamVjdC5qcyc7XG5cbmltcG9ydCB0eXBlIHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cblxuLyoqXG4gKiBBbiBvYmplY3QgdGhhdCBoYW5kbGVzIGNyZWF0aW5nIGFuZCBzZXR0aW5nIGVhY2ggb2YgdGhlIFNWRyBlbGVtZW50c1xuICogdXNlZCBieSB0aGUgcmVuZGVyZXIuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuZ2VyYXMuUGF0aE9iamVjdFxuICovXG5leHBvcnQgY2xhc3MgUGF0aE9iamVjdCBleHRlbmRzIEJhc2VQYXRoT2JqZWN0IHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdmdQYXRoRGFyazogU1ZHRWxlbWVudDtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdmdQYXRoTGlnaHQ6IFNWR0VsZW1lbnQ7XG5cbiAgLyoqXG4gICAqIFRoZSBjb2xvdXIgb2YgdGhlIGRhcmsgcGF0aCBvbiB0aGUgYmxvY2sgaW4gJyNSUkdHQkInIGZvcm1hdC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb2xvdXJEYXJrID0gJyMwMDAwMDAnO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gcm9vdCBUaGUgcm9vdCBTVkcgZWxlbWVudC5cbiAgICogQHBhcmFtIHN0eWxlIFRoZSBzdHlsZSBvYmplY3QgdG8gdXNlIGZvciBjb2xvdXJpbmcuXG4gICAqIEBwYXJhbSBjb25zdGFudHMgVGhlIHJlbmRlcmVyJ3MgY29uc3RhbnRzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcm9vdDogU1ZHRWxlbWVudCwgc3R5bGU6IEJsb2NrU3R5bGUsXG4gICAgICBwdWJsaWMgb3ZlcnJpZGUgY29uc3RhbnRzOiBDb25zdGFudFByb3ZpZGVyKSB7XG4gICAgc3VwZXIocm9vdCwgc3R5bGUsIGNvbnN0YW50cyk7XG5cbiAgICAvKiogVGhlIGRhcmsgcGF0aCBvZiB0aGUgYmxvY2suICovXG4gICAgdGhpcy5zdmdQYXRoRGFyayA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuUEFUSCwgeydjbGFzcyc6ICdibG9ja2x5UGF0aERhcmsnLCAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZSgxLDEpJ30pO1xuICAgIC8vIFNWRyBkcmF3IG9yZGVyIGlzIGJhc2VkIG9uIHRoZSBvcmRlciBvZiBlbGVtZW50cyAodG9wIG1vc3QgPSBiYWNrIG1vc3QpXG4gICAgLy8gU28gd2UgbmVlZCB0byBpbnNlcnQgdGhlIGRhcmsgcGF0aCBiZWZvcmUgdGhlIGJhc2UgcGF0aCB0byBtYWtlIHN1cmUgaXRcbiAgICAvLyBnZXRzIGRyYXduIGZpcnN0LlxuICAgIHRoaXMuc3ZnUm9vdC5pbnNlcnRCZWZvcmUodGhpcy5zdmdQYXRoRGFyaywgdGhpcy5zdmdQYXRoKTtcblxuICAgIC8qKiBUaGUgbGlnaHQgcGF0aCBvZiB0aGUgYmxvY2suICovXG4gICAgdGhpcy5zdmdQYXRoTGlnaHQgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlBBVEgsIHsnY2xhc3MnOiAnYmxvY2tseVBhdGhMaWdodCd9LCB0aGlzLnN2Z1Jvb3QpO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2V0UGF0aChtYWluUGF0aDogc3RyaW5nKSB7XG4gICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZSgnZCcsIG1haW5QYXRoKTtcbiAgICB0aGlzLnN2Z1BhdGhEYXJrLnNldEF0dHJpYnV0ZSgnZCcsIG1haW5QYXRoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGhpZ2hsaWdodCBwYXRoIGdlbmVyYXRlZCBieSB0aGUgcmVuZGVyZXIgb250byB0aGUgU1ZHIGVsZW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBoaWdobGlnaHRQYXRoIFRoZSBoaWdobGlnaHQgcGF0aC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXRIaWdobGlnaHRQYXRoKGhpZ2hsaWdodFBhdGg6IHN0cmluZykge1xuICAgIHRoaXMuc3ZnUGF0aExpZ2h0LnNldEF0dHJpYnV0ZSgnZCcsIGhpZ2hsaWdodFBhdGgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZmxpcFJUTCgpIHtcbiAgICAvLyBNaXJyb3IgdGhlIGJsb2NrJ3MgcGF0aC5cbiAgICB0aGlzLnN2Z1BhdGguc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCAnc2NhbGUoLTEgMSknKTtcbiAgICB0aGlzLnN2Z1BhdGhMaWdodC5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsICdzY2FsZSgtMSAxKScpO1xuICAgIHRoaXMuc3ZnUGF0aERhcmsuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDEsMSkgc2NhbGUoLTEgMSknKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGFwcGx5Q29sb3VyKGJsb2NrOiBCbG9ja1N2Zykge1xuICAgIHRoaXMuc3ZnUGF0aExpZ2h0LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICB0aGlzLnN2Z1BhdGhEYXJrLnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICBpZiAoIXRoaXMuc3R5bGUuY29sb3VyVGVydGlhcnkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHJlbmRlcmVyIGRpZCBub3QgcHJvcGVybHkgaW5pdGlhbGl6ZSB0aGUgdGVydGlhcnkgY29sb3VyIG9mICcgK1xuICAgICAgICAgICd0aGUgYmxvY2sgc3R5bGUnKTtcbiAgICB9XG4gICAgdGhpcy5zdmdQYXRoTGlnaHQuc2V0QXR0cmlidXRlKCdzdHJva2UnLCB0aGlzLnN0eWxlLmNvbG91clRlcnRpYXJ5KTtcbiAgICB0aGlzLnN2Z1BhdGhEYXJrLnNldEF0dHJpYnV0ZSgnZmlsbCcsIHRoaXMuY29sb3VyRGFyayk7XG5cbiAgICBzdXBlci5hcHBseUNvbG91cihibG9jayk7XG5cbiAgICB0aGlzLnN2Z1BhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnbm9uZScpO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2V0U3R5bGUoYmxvY2tTdHlsZTogQmxvY2tTdHlsZSkge1xuICAgIHRoaXMuc3R5bGUgPSBibG9ja1N0eWxlO1xuICAgIHRoaXMuY29sb3VyRGFyayA9XG4gICAgICAgIGNvbG91ci5ibGVuZCgnIzAwMCcsIHRoaXMuc3R5bGUuY29sb3VyUHJpbWFyeSwgMC4yKSB8fCB0aGlzLmNvbG91ckRhcms7XG4gIH1cblxuICBvdmVycmlkZSB1cGRhdGVIaWdobGlnaHRlZChoaWdobGlnaHRlZDogYm9vbGVhbikge1xuICAgIGlmIChoaWdobGlnaHRlZCkge1xuICAgICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAnZmlsdGVyJywgJ3VybCgjJyArIHRoaXMuY29uc3RhbnRzLmVtYm9zc0ZpbHRlcklkICsgJyknKTtcbiAgICAgIHRoaXMuc3ZnUGF0aExpZ2h0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3ZnUGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbHRlcicsICdub25lJyk7XG4gICAgICB0aGlzLnN2Z1BhdGhMaWdodC5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgdXBkYXRlU2hhZG93XyhzaGFkb3c6IGJvb2xlYW4pIHtcbiAgICBpZiAoc2hhZG93KSB7XG4gICAgICB0aGlzLnN2Z1BhdGhMaWdodC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgaWYgKCF0aGlzLnN0eWxlLmNvbG91clNlY29uZGFyeSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnVGhlIHJlbmRlcmVyIGRpZCBub3QgcHJvcGVybHkgaW5pdGlhbGl6ZSB0aGUgc2Vjb25kYXJ5IGNvbG91ciAnICtcbiAgICAgICAgICAgICdvZiB0aGUgYmxvY2sgc3R5bGUgYmxvY2sgc3R5bGUnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc3ZnUGF0aERhcmsuc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5zdHlsZS5jb2xvdXJTZWNvbmRhcnkpO1xuICAgICAgdGhpcy5zdmdQYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJ25vbmUnKTtcbiAgICAgIHRoaXMuc3ZnUGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCB0aGlzLnN0eWxlLmNvbG91clNlY29uZGFyeSk7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgdXBkYXRlRGlzYWJsZWRfKGRpc2FibGVkOiBib29sZWFuKSB7XG4gICAgc3VwZXIudXBkYXRlRGlzYWJsZWRfKGRpc2FibGVkKTtcbiAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuc3ZnUGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICdub25lJyk7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogR2VyYXMgcmVuZGVyZXIuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuZ2VyYXMuUmVuZGVyZXInKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrU3ZnfSBmcm9tICcuLi8uLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0IHR5cGUge0Jsb2NrU3R5bGUsIFRoZW1lfSBmcm9tICcuLi8uLi90aGVtZS5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja1JlbmRlcmluZyBmcm9tICcuLi9jb21tb24vYmxvY2tfcmVuZGVyaW5nLmpzJztcbmltcG9ydCB0eXBlIHtSZW5kZXJJbmZvIGFzIEJhc2VSZW5kZXJJbmZvfSBmcm9tICcuLi9jb21tb24vaW5mby5qcyc7XG5pbXBvcnQge1JlbmRlcmVyIGFzIEJhc2VSZW5kZXJlcn0gZnJvbSAnLi4vY29tbW9uL3JlbmRlcmVyLmpzJztcblxuaW1wb3J0IHtDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQge0RyYXdlcn0gZnJvbSAnLi9kcmF3ZXIuanMnO1xuaW1wb3J0IHtIaWdobGlnaHRDb25zdGFudFByb3ZpZGVyfSBmcm9tICcuL2hpZ2hsaWdodF9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHtQYXRoT2JqZWN0fSBmcm9tICcuL3BhdGhfb2JqZWN0LmpzJztcblxuXG4vKipcbiAqIFRoZSBnZXJhcyByZW5kZXJlci5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5nZXJhcy5SZW5kZXJlclxuICovXG5leHBvcnQgY2xhc3MgUmVuZGVyZXIgZXh0ZW5kcyBCYXNlUmVuZGVyZXIge1xuICAvKiogVGhlIHJlbmRlcmVyJ3MgaGlnaGxpZ2h0IGNvbnN0YW50IHByb3ZpZGVyLiAqL1xuICBwcml2YXRlIGhpZ2hsaWdodENvbnN0YW50c186IEhpZ2hsaWdodENvbnN0YW50UHJvdmlkZXJ8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSByZW5kZXJlciBuYW1lLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge1xuICAgIHN1cGVyKG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHJlbmRlcmVyLiAgR2VyYXMgaGFzIGEgaGlnaGxpZ2h0IHByb3ZpZGVyIGluIGFkZGl0aW9uIHRvXG4gICAqIHRoZSBub3JtYWwgY29uc3RhbnQgcHJvdmlkZXIuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgaW5pdChcbiAgICAgIHRoZW1lOiBUaGVtZSwgb3B0X3JlbmRlcmVyT3ZlcnJpZGVzPzoge1tyZW5kZXJlckNvbnN0YW50OiBzdHJpbmddOiBhbnl9KSB7XG4gICAgc3VwZXIuaW5pdCh0aGVtZSwgb3B0X3JlbmRlcmVyT3ZlcnJpZGVzKTtcbiAgICB0aGlzLmhpZ2hsaWdodENvbnN0YW50c18gPSB0aGlzLm1ha2VIaWdobGlnaHRDb25zdGFudHNfKCk7XG4gICAgdGhpcy5oaWdobGlnaHRDb25zdGFudHNfLmluaXQoKTtcbiAgfVxuXG4gIG92ZXJyaWRlIHJlZnJlc2hEb20oc3ZnOiBTVkdFbGVtZW50LCB0aGVtZTogVGhlbWUpIHtcbiAgICBzdXBlci5yZWZyZXNoRG9tKHN2ZywgdGhlbWUpO1xuICAgIHRoaXMuZ2V0SGlnaGxpZ2h0Q29uc3RhbnRzKCkuaW5pdCgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgbWFrZUNvbnN0YW50c18oKSB7XG4gICAgcmV0dXJuIG5ldyBDb25zdGFudFByb3ZpZGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIHJlbmRlciBpbmZvIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBtZWFzdXJlLlxuICAgKiBAcmV0dXJucyBUaGUgcmVuZGVyIGluZm8gb2JqZWN0LlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIG1ha2VSZW5kZXJJbmZvXyhibG9jazogQmxvY2tTdmcpOiBSZW5kZXJJbmZvIHtcbiAgICByZXR1cm4gbmV3IFJlbmRlckluZm8odGhpcywgYmxvY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgcmVuZGVyZXIncyBkcmF3ZXIuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gcmVuZGVyLlxuICAgKiBAcGFyYW0gaW5mbyBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgaW5mb3JtYXRpb24gbmVlZGVkIHRvIHJlbmRlciB0aGlzXG4gICAqICAgICBibG9jay5cbiAgICogQHJldHVybnMgVGhlIGRyYXdlci5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBtYWtlRHJhd2VyXyhibG9jazogQmxvY2tTdmcsIGluZm86IEJhc2VSZW5kZXJJbmZvKTpcbiAgICAgIERyYXdlciB7XG4gICAgcmV0dXJuIG5ldyBEcmF3ZXIoYmxvY2ssIChpbmZvIGFzIFJlbmRlckluZm8pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgYSByZW5kZXJlciBwYXRoIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIHJvb3QgVGhlIHJvb3QgU1ZHIGVsZW1lbnQuXG4gICAqIEBwYXJhbSBzdHlsZSBUaGUgc3R5bGUgb2JqZWN0IHRvIHVzZSBmb3IgY29sb3VyaW5nLlxuICAgKiBAcmV0dXJucyBUaGUgcmVuZGVyZXIgcGF0aCBvYmplY3QuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgbWFrZVBhdGhPYmplY3Qocm9vdDogU1ZHRWxlbWVudCwgc3R5bGU6IEJsb2NrU3R5bGUpOiBQYXRoT2JqZWN0IHtcbiAgICByZXR1cm4gbmV3IFBhdGhPYmplY3QoXG4gICAgICAgIHJvb3QsIHN0eWxlLCAodGhpcy5nZXRDb25zdGFudHMoKSBhcyBDb25zdGFudFByb3ZpZGVyKSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSByZW5kZXJlcidzIGhpZ2hsaWdodCBjb25zdGFudCBwcm92aWRlci5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGhpZ2hsaWdodCBjb25zdGFudCBwcm92aWRlci5cbiAgICovXG4gIHByb3RlY3RlZCBtYWtlSGlnaGxpZ2h0Q29uc3RhbnRzXygpOiBIaWdobGlnaHRDb25zdGFudFByb3ZpZGVyIHtcbiAgICByZXR1cm4gbmV3IEhpZ2hsaWdodENvbnN0YW50UHJvdmlkZXIoKHRoaXMuZ2V0Q29uc3RhbnRzKCkpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJlbmRlcmVyJ3MgaGlnaGxpZ2h0IGNvbnN0YW50IHByb3ZpZGVyLiAgV2UgYXNzdW1lIHRoYXQgd2hlbiB0aGlzXG4gICAqIGlzIGNhbGxlZCwgdGhlIHJlbmRlcmVyIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBoaWdobGlnaHQgY29uc3RhbnQgcHJvdmlkZXIuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0SGlnaGxpZ2h0Q29uc3RhbnRzKCk6IEhpZ2hsaWdodENvbnN0YW50UHJvdmlkZXIge1xuICAgIGlmICghdGhpcy5oaWdobGlnaHRDb25zdGFudHNfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBhY2Nlc3MgdGhlIGhpZ2hsaWdodCBjb25zdGFudHMgYmVjYXVzZSBpbml0IGhhcyBub3QgJyArXG4gICAgICAgICAgJ2JlZW4gY2FsbGVkJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmhpZ2hsaWdodENvbnN0YW50c187XG4gIH1cbn1cblxuYmxvY2tSZW5kZXJpbmcucmVnaXN0ZXIoJ2dlcmFzJywgUmVuZGVyZXIpO1xuIiwiLyoqIEBmaWxlIFJlLWV4cG9ydHMgb2YgQmxvY2tseS5nZXJhcy4qIG1vZHVsZXMuICovXG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBSZS1leHBvcnRzIG9mIEJsb2NrbHkuZ2VyYXMuKiBtb2R1bGVzLlxuICpcbiAqIEBuYW1lc3BhY2UgQmxvY2tseS5nZXJhc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LmdlcmFzJyk7XG5cbmltcG9ydCB7Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHtEcmF3ZXJ9IGZyb20gJy4vZHJhd2VyLmpzJztcbmltcG9ydCB7SGlnaGxpZ2h0Q29uc3RhbnRQcm92aWRlcn0gZnJvbSAnLi9oaWdobGlnaHRfY29uc3RhbnRzLmpzJztcbmltcG9ydCB7SGlnaGxpZ2h0ZXJ9IGZyb20gJy4vaGlnaGxpZ2h0ZXIuanMnO1xuaW1wb3J0IHtSZW5kZXJJbmZvfSBmcm9tICcuL2luZm8uanMnO1xuaW1wb3J0IHtJbmxpbmVJbnB1dH0gZnJvbSAnLi9tZWFzdXJhYmxlcy9pbmxpbmVfaW5wdXQuanMnO1xuaW1wb3J0IHtTdGF0ZW1lbnRJbnB1dH0gZnJvbSAnLi9tZWFzdXJhYmxlcy9zdGF0ZW1lbnRfaW5wdXQuanMnO1xuaW1wb3J0IHtQYXRoT2JqZWN0fSBmcm9tICcuL3BhdGhfb2JqZWN0LmpzJztcbmltcG9ydCB7UmVuZGVyZXJ9IGZyb20gJy4vcmVuZGVyZXIuanMnO1xuXG5cbmV4cG9ydCB7XG4gIENvbnN0YW50UHJvdmlkZXIsXG4gIERyYXdlcixcbiAgSGlnaGxpZ2h0Q29uc3RhbnRQcm92aWRlcixcbiAgSGlnaGxpZ2h0ZXIsXG4gIElubGluZUlucHV0LFxuICBQYXRoT2JqZWN0LFxuICBSZW5kZXJlcixcbiAgUmVuZGVySW5mbyxcbiAgU3RhdGVtZW50SW5wdXQsXG59O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEFuIFNWRyB0aGF0IGZsb2F0cyBvbiB0b3Agb2YgdGhlIHdvcmtzcGFjZS5cbiAqIEJsb2NrcyBhcmUgbW92ZWQgaW50byB0aGlzIFNWRyBkdXJpbmcgYSBkcmFnLCBpbXByb3ZpbmcgcGVyZm9ybWFuY2UuXG4gKiBUaGUgZW50aXJlIFNWRyBpcyB0cmFuc2xhdGVkIHVzaW5nIENTUyB0cmFuc2xhdGlvbiBpbnN0ZWFkIG9mIFNWRyBzbyB0aGVcbiAqIGJsb2NrcyBhcmUgbmV2ZXIgcmVwYWludGVkIGR1cmluZyBkcmFnIGltcHJvdmluZyBwZXJmb3JtYW5jZS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Xb3Jrc3BhY2VEcmFnU3VyZmFjZVN2ZycpO1xuXG5pbXBvcnQgdHlwZSB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuaW1wb3J0ICogYXMgc3ZnTWF0aCBmcm9tICcuL3V0aWxzL3N2Z19tYXRoLmpzJztcblxuXG4vKipcbiAqIEJsb2NrcyBhcmUgbW92ZWQgaW50byB0aGlzIFNWRyBkdXJpbmcgYSBkcmFnLCBpbXByb3ZpbmcgcGVyZm9ybWFuY2UuXG4gKiBUaGUgZW50aXJlIFNWRyBpcyB0cmFuc2xhdGVkIHVzaW5nIENTUyB0cmFuc2Zvcm1zIGluc3RlYWQgb2YgU1ZHIHNvIHRoZVxuICogYmxvY2tzIGFyZSBuZXZlciByZXBhaW50ZWQgZHVyaW5nIGRyYWcgaW1wcm92aW5nIHBlcmZvcm1hbmNlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LldvcmtzcGFjZURyYWdTdXJmYWNlU3ZnXG4gKi9cbmV4cG9ydCBjbGFzcyBXb3Jrc3BhY2VEcmFnU3VyZmFjZVN2ZyB7XG4gIC8qKlxuICAgKiBUaGUgU1ZHIGRyYWcgc3VyZmFjZS4gU2V0IG9uY2UgYnkgV29ya3NwYWNlRHJhZ1N1cmZhY2VTdmcuY3JlYXRlRG9tLlxuICAgKi9cbiAgcHJpdmF0ZSBTVkchOiBTVkdFbGVtZW50O1xuXG4gIC8qKlxuICAgKiBUaGUgZWxlbWVudCB0byBpbnNlcnQgdGhlIGJsb2NrIGNhbnZhcyBhbmQgYnViYmxlIGNhbnZhcyBhZnRlciB3aGVuIGl0XG4gICAqIGdvZXMgYmFjayBpbiB0aGUgRE9NIGF0IHRoZSBlbmQgb2YgYSBkcmFnLlxuICAgKi9cbiAgcHJpdmF0ZSBwcmV2aW91c1NpYmxpbmc6IEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEBwYXJhbSBjb250YWluZXIgQ29udGFpbmluZyBlbGVtZW50LiAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNvbnRhaW5lcjogRWxlbWVudCkge1xuICAgIHRoaXMuY3JlYXRlRG9tKCk7XG4gIH1cblxuICAvKiogQ3JlYXRlIHRoZSBkcmFnIHN1cmZhY2UgYW5kIGluamVjdCBpdCBpbnRvIHRoZSBjb250YWluZXIuICovXG4gIGNyZWF0ZURvbSgpIHtcbiAgICBpZiAodGhpcy5TVkcpIHtcbiAgICAgIHJldHVybjsgIC8vIEFscmVhZHkgY3JlYXRlZC5cbiAgICB9XG4gICAgLyoqXG4gICAgICogRG9tIHN0cnVjdHVyZSB3aGVuIHRoZSB3b3Jrc3BhY2UgaXMgYmVpbmcgZHJhZ2dlZC4gSWYgdGhlcmUgaXMgbm8gZHJhZyBpblxuICAgICAqIHByb2dyZXNzLCB0aGUgU1ZHIGlzIGVtcHR5IGFuZCBkaXNwbGF5OiBub25lLlxuICAgICAqIDxzdmcgY2xhc3M9XCJibG9ja2x5V3NEcmFnU3VyZmFjZVwiIHN0eWxlPXRyYW5zZm9ybTp0cmFuc2xhdGUzZCguLi4pPlxuICAgICAqICAgPGcgY2xhc3M9XCJibG9ja2x5QmxvY2tDYW52YXNcIj48L2c+XG4gICAgICogICA8ZyBjbGFzcz1cImJsb2NrbHlCdWJibGVDYW52YXNcIj4vZz5cbiAgICAgKiA8L3N2Zz5cbiAgICAgKi9cbiAgICB0aGlzLlNWRyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5TVkcsIHtcbiAgICAgICd4bWxucyc6IGRvbS5TVkdfTlMsXG4gICAgICAneG1sbnM6aHRtbCc6IGRvbS5IVE1MX05TLFxuICAgICAgJ3htbG5zOnhsaW5rJzogZG9tLlhMSU5LX05TLFxuICAgICAgJ3ZlcnNpb24nOiAnMS4xJyxcbiAgICAgICdjbGFzcyc6ICdibG9ja2x5V3NEcmFnU3VyZmFjZSBibG9ja2x5T3ZlcmZsb3dWaXNpYmxlJyxcbiAgICB9KTtcbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLlNWRyk7XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNsYXRlIHRoZSBlbnRpcmUgZHJhZyBzdXJmYWNlIGR1cmluZyBhIGRyYWcuXG4gICAqIFdlIHRyYW5zbGF0ZSB0aGUgZHJhZyBzdXJmYWNlIGluc3RlYWQgb2YgdGhlIGJsb2NrcyBpbnNpZGUgdGhlIHN1cmZhY2VcbiAgICogc28gdGhhdCB0aGUgYnJvd3NlciBhdm9pZHMgcmVwYWludGluZyB0aGUgU1ZHLlxuICAgKiBCZWNhdXNlIG9mIHRoaXMsIHRoZSBkcmFnIGNvb3JkaW5hdGVzIG11c3QgYmUgYWRqdXN0ZWQgYnkgc2NhbGUuXG4gICAqXG4gICAqIEBwYXJhbSB4IFggdHJhbnNsYXRpb24gZm9yIHRoZSBlbnRpcmUgc3VyZmFjZVxuICAgKiBAcGFyYW0geSBZIHRyYW5zbGF0aW9uIGZvciB0aGUgZW50aXJlIHN1cmZhY2VcbiAgICogQGludGVybmFsXG4gICAqL1xuICB0cmFuc2xhdGVTdXJmYWNlKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgLy8gTWFrZSBzdXJlIHRoZSBzdmcgZXhpc3RzIG9uIGEgcGl4ZWwgYm91bmRhcnkgc28gdGhhdCBpdCBpcyBub3QgZnV6enkuXG4gICAgY29uc3QgZml4ZWRYID0gTWF0aC5yb3VuZCh4KTtcbiAgICBjb25zdCBmaXhlZFkgPSBNYXRoLnJvdW5kKHkpO1xuXG4gICAgdGhpcy5TVkcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgZG9tLnNldENzc1RyYW5zZm9ybShcbiAgICAgICAgdGhpcy5TVkcsICd0cmFuc2xhdGUzZCgnICsgZml4ZWRYICsgJ3B4LCAnICsgZml4ZWRZICsgJ3B4LCAwKScpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcG9ydHMgdGhlIHN1cmZhY2UgdHJhbnNsYXRpb24gaW4gc2NhbGVkIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICogVXNlIHRoaXMgd2hlbiBmaW5pc2hpbmcgYSBkcmFnIHRvIHJldHVybiBibG9ja3MgdG8gdGhlIGNvcnJlY3QgcG9zaXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIEN1cnJlbnQgdHJhbnNsYXRpb24gb2YgdGhlIHN1cmZhY2VcbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRTdXJmYWNlVHJhbnNsYXRpb24oKTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIHN2Z01hdGguZ2V0UmVsYXRpdmVYWSgodGhpcy5TVkcpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoZSBibG9ja0NhbnZhcyBhbmQgYnViYmxlQ2FudmFzIG91dCBvZiB0aGUgc3VyZmFjZSBTVkcgYW5kIG9uIHRvXG4gICAqIG5ld1N1cmZhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdTdXJmYWNlIFRoZSBlbGVtZW50IHRvIHB1dCB0aGUgZHJhZyBzdXJmYWNlIGNvbnRlbnRzIGludG8uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY2xlYXJBbmRIaWRlKG5ld1N1cmZhY2U6IFNWR0VsZW1lbnQpIHtcbiAgICBpZiAoIW5ld1N1cmZhY2UpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdDb3VsZG5cXCd0IGNsZWFyIGFuZCBoaWRlIHRoZSBkcmFnIHN1cmZhY2U6IG1pc3NpbmcgbmV3IHN1cmZhY2UuJyk7XG4gICAgfVxuICAgIGNvbnN0IGJsb2NrQ2FudmFzID0gdGhpcy5TVkcuY2hpbGROb2Rlc1swXSBhcyBFbGVtZW50O1xuICAgIGNvbnN0IGJ1YmJsZUNhbnZhcyA9IHRoaXMuU1ZHLmNoaWxkTm9kZXNbMV0gYXMgRWxlbWVudDtcbiAgICBpZiAoIWJsb2NrQ2FudmFzIHx8ICFidWJibGVDYW52YXMgfHxcbiAgICAgICAgIShibG9ja0NhbnZhcy5jbGFzc0xpc3QuY29udGFpbnMoJ2Jsb2NrbHlCbG9ja0NhbnZhcycpIHx8XG4gICAgICAgICAgIWJ1YmJsZUNhbnZhcy5jbGFzc0xpc3QuY29udGFpbnMoJ2Jsb2NrbHlCdWJibGVDYW52YXMnKSkpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdDb3VsZG5cXCd0IGNsZWFyIGFuZCBoaWRlIHRoZSBkcmFnIHN1cmZhY2UuIEEgbm9kZSB3YXMgbWlzc2luZy4nKTtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGVyZSBpcyBhIHByZXZpb3VzIHNpYmxpbmcsIHB1dCB0aGUgYmxvY2tDYW52YXMgYmFjayByaWdodFxuICAgIC8vIGFmdGVyd2FyZHMsIG90aGVyd2lzZSBpbnNlcnQgaXQgYXMgdGhlIGZpcnN0IGNoaWxkIG5vZGUgaW4gbmV3U3VyZmFjZS5cbiAgICBpZiAodGhpcy5wcmV2aW91c1NpYmxpbmcgIT09IG51bGwpIHtcbiAgICAgIGRvbS5pbnNlcnRBZnRlcihibG9ja0NhbnZhcywgdGhpcy5wcmV2aW91c1NpYmxpbmcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTdXJmYWNlLmluc2VydEJlZm9yZShibG9ja0NhbnZhcywgbmV3U3VyZmFjZS5maXJzdENoaWxkKTtcbiAgICB9XG5cbiAgICAvLyBSZWF0dGFjaCB0aGUgYnViYmxlIGNhbnZhcyBhZnRlciB0aGUgYmxvY2tDYW52YXMuXG4gICAgZG9tLmluc2VydEFmdGVyKGJ1YmJsZUNhbnZhcywgYmxvY2tDYW52YXMpO1xuICAgIC8vIEhpZGUgdGhlIGRyYWcgc3VyZmFjZS5cbiAgICB0aGlzLlNWRy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIGlmICh0aGlzLlNWRy5jaGlsZE5vZGVzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgRXJyb3IoJ0RyYWcgc3VyZmFjZSB3YXMgbm90IGNsZWFyZWQuJyk7XG4gICAgfVxuICAgIGRvbS5zZXRDc3NUcmFuc2Zvcm0odGhpcy5TVkcsICcnKTtcbiAgICB0aGlzLnByZXZpb3VzU2libGluZyA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBTVkcgdG8gaGF2ZSB0aGUgYmxvY2sgY2FudmFzIGFuZCBidWJibGUgY2FudmFzIGluIGl0IGFuZCB0aGVuXG4gICAqIHNob3cgdGhlIHN1cmZhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja0NhbnZhcyBUaGUgYmxvY2sgY2FudmFzIDxnPiBlbGVtZW50IGZyb20gdGhlXG4gICAqICAgICB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSBidWJibGVDYW52YXMgVGhlIDxnPiBlbGVtZW50IHRoYXQgY29udGFpbnMgdGhlXG4gICAgIGJ1YmJsZXMuXG4gICAqIEBwYXJhbSBwcmV2aW91c1NpYmxpbmcgVGhlIGVsZW1lbnQgdG8gaW5zZXJ0IHRoZSBibG9jayBjYW52YXMgYW5kXG4gICAgICAgICAgIGJ1YmJsZSBjYW52YXMgYWZ0ZXIgd2hlbiBpdCBnb2VzIGJhY2sgaW4gdGhlIERPTSBhdCB0aGUgZW5kIG9mIGFcbiAgICAgZHJhZy5cbiAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgd29ya3NwYWNlIFNWRyBlbGVtZW50LlxuICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHdvcmtzcGFjZSBTVkcgZWxlbWVudC5cbiAgICogQHBhcmFtIHNjYWxlIFRoZSBzY2FsZSBvZiB0aGUgd29ya3NwYWNlIGJlaW5nIGRyYWdnZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Q29udGVudHNBbmRTaG93KFxuICAgICAgYmxvY2tDYW52YXM6IFNWR0VsZW1lbnQsIGJ1YmJsZUNhbnZhczogU1ZHRWxlbWVudCxcbiAgICAgIHByZXZpb3VzU2libGluZzogRWxlbWVudCwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHNjYWxlOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5TVkcuY2hpbGROb2Rlcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IEVycm9yKCdBbHJlYWR5IGRyYWdnaW5nIGEgYmxvY2suJyk7XG4gICAgfVxuICAgIHRoaXMucHJldmlvdXNTaWJsaW5nID0gcHJldmlvdXNTaWJsaW5nO1xuICAgIC8vIE1ha2Ugc3VyZSB0aGUgYmxvY2tzIGFuZCBidWJibGUgY2FudmFzIGFyZSBzY2FsZWQgYXBwcm9wcmlhdGVseS5cbiAgICBibG9ja0NhbnZhcy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsIDApIHNjYWxlKCcgKyBzY2FsZSArICcpJyk7XG4gICAgYnViYmxlQ2FudmFzLnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwgMCkgc2NhbGUoJyArIHNjYWxlICsgJyknKTtcbiAgICB0aGlzLlNWRy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgU3RyaW5nKHdpZHRoKSk7XG4gICAgdGhpcy5TVkcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBTdHJpbmcoaGVpZ2h0KSk7XG4gICAgdGhpcy5TVkcuYXBwZW5kQ2hpbGQoYmxvY2tDYW52YXMpO1xuICAgIHRoaXMuU1ZHLmFwcGVuZENoaWxkKGJ1YmJsZUNhbnZhcyk7XG4gICAgdGhpcy5TVkcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBBIGNsYXNzIHRoYXQgbWFuYWdlcyBhIHN1cmZhY2UgZm9yIGRyYWdnaW5nIGJsb2Nrcy4gIFdoZW4gYVxuICogYmxvY2sgZHJhZyBpcyBzdGFydGVkLCB3ZSBtb3ZlIHRoZSBibG9jayAoYW5kIGNoaWxkcmVuKSB0byBhIHNlcGFyYXRlIERPTVxuICogZWxlbWVudCB0aGF0IHdlIG1vdmUgYXJvdW5kIHVzaW5nIHRyYW5zbGF0ZTNkLiBBdCB0aGUgZW5kIG9mIHRoZSBkcmFnLCB0aGVcbiAqIGJsb2NrcyBhcmUgcHV0IGJhY2sgaW4gaW50byB0aGUgU1ZHIHRoZXkgY2FtZSBmcm9tLiBUaGlzIGhlbHBzXG4gKiBwZXJmb3JtYW5jZSBieSBhdm9pZGluZyByZXBhaW50aW5nIHRoZSBlbnRpcmUgU1ZHIG9uIGV2ZXJ5IG1vdXNlIG1vdmVcbiAqIHdoaWxlIGRyYWdnaW5nIGJsb2Nrcy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5CbG9ja0RyYWdTdXJmYWNlU3ZnJyk7XG5cbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBzdmdNYXRoIGZyb20gJy4vdXRpbHMvc3ZnX21hdGguanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgZHJhZyBzdXJmYWNlIGZvciB0aGUgY3VycmVudGx5IGRyYWdnZWQgYmxvY2suIFRoaXMgaXMgYSBzZXBhcmF0ZVxuICogU1ZHIHRoYXQgY29udGFpbnMgb25seSB0aGUgY3VycmVudGx5IG1vdmluZyBibG9jaywgb3Igbm90aGluZy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5CbG9ja0RyYWdTdXJmYWNlU3ZnXG4gKi9cbmV4cG9ydCBjbGFzcyBCbG9ja0RyYWdTdXJmYWNlU3ZnIHtcbiAgLyoqXG4gICAqIFRoZSByb290IGVsZW1lbnQgb2YgdGhlIGRyYWcgc3VyZmFjZS5cbiAgICovXG4gIHByaXZhdGUgc3ZnOiBTVkdFbGVtZW50O1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHdoZXJlIGJsb2NrcyBsaXZlIHdoaWxlIHRoZXkgYXJlIGJlaW5nIGRyYWdnZWQgaWYgdGhlIGRyYWdcbiAgICogc3VyZmFjZSBpcyBlbmFibGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBkcmFnR3JvdXA6IFNWR0VsZW1lbnQ7XG5cbiAgLyoqXG4gICAqIENhY2hlZCB2YWx1ZSBmb3IgdGhlIHNjYWxlIG9mIHRoZSBkcmFnIHN1cmZhY2UuXG4gICAqIFVzZWQgdG8gc2V0L2dldCB0aGUgY29ycmVjdCB0cmFuc2xhdGlvbiBkdXJpbmcgYW5kIGFmdGVyIGEgZHJhZy5cbiAgICovXG4gIHByaXZhdGUgc2NhbGUgPSAxO1xuXG4gIC8qKlxuICAgKiBDYWNoZWQgdmFsdWUgZm9yIHRoZSB0cmFuc2xhdGlvbiBvZiB0aGUgZHJhZyBzdXJmYWNlLlxuICAgKiBUaGlzIHRyYW5zbGF0aW9uIGlzIGluIHBpeGVsIHVuaXRzLCBiZWNhdXNlIHRoZSBzY2FsZSBpcyBhcHBsaWVkIHRvIHRoZVxuICAgKiBkcmFnIGdyb3VwIHJhdGhlciB0aGFuIHRoZSB0b3AtbGV2ZWwgU1ZHLlxuICAgKi9cbiAgcHJpdmF0ZSBzdXJmYWNlWFkgPSBuZXcgQ29vcmRpbmF0ZSgwLCAwKTtcblxuICAvKipcbiAgICogQ2FjaGVkIHZhbHVlIGZvciB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIGNoaWxkIGRyYWcgc3VyZmFjZSBpbiBwaXhlbFxuICAgKiB1bml0cy4gU2luY2UgdGhlIGNoaWxkIGRyYWcgc3VyZmFjZSB0cmFja3MgdGhlIHRyYW5zbGF0aW9uIG9mIHRoZVxuICAgKiB3b3Jrc3BhY2UgdGhpcyBpcyB1bHRpbWF0ZWx5IHRoZSB0cmFuc2xhdGlvbiBvZiB0aGUgd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBjaGlsZFN1cmZhY2VYWSA9IG5ldyBDb29yZGluYXRlKDAsIDApO1xuXG4gIC8qKiBAcGFyYW0gY29udGFpbmVyIENvbnRhaW5pbmcgZWxlbWVudC4gKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb250YWluZXI6IEVsZW1lbnQpIHtcbiAgICB0aGlzLnN2ZyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuU1ZHLCB7XG4gICAgICAgICAgJ3htbG5zJzogZG9tLlNWR19OUyxcbiAgICAgICAgICAneG1sbnM6aHRtbCc6IGRvbS5IVE1MX05TLFxuICAgICAgICAgICd4bWxuczp4bGluayc6IGRvbS5YTElOS19OUyxcbiAgICAgICAgICAndmVyc2lvbic6ICcxLjEnLFxuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5QmxvY2tEcmFnU3VyZmFjZScsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuY29udGFpbmVyKTtcblxuICAgIHRoaXMuZHJhZ0dyb3VwID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLkcsIHt9LCB0aGlzLnN2Zyk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBkcmFnIHN1cmZhY2UgYW5kIGluamVjdCBpdCBpbnRvIHRoZSBjb250YWluZXIuXG4gICAqXG4gICAqIEBkZXByZWNhdGVkIFRoZSBET00gaXMgYXV0b21hdGljYWxseSBjcmVhdGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci5cbiAgICovXG4gIGNyZWF0ZURvbSgpIHtcbiAgICAvLyBObyBhbHRlcm5hdGl2ZSBwcm92aWRlZCwgYmVjYXVzZSBub3cgdGhlIGRvbSBpcyBqdXN0IGF1dG9tYXRpY2FsbHlcbiAgICAvLyBjcmVhdGVkIGluIHRoZSBjb25zdHJ1Y3RvciBub3cuXG4gICAgZGVwcmVjYXRpb24ud2FybignQmxvY2tEcmFnU3VyZmFjZVN2ZyBjcmVhdGVEb20nLCAnSnVuZSAyMDIyJywgJ0p1bmUgMjAyMycpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgU1ZHIGJsb2NrcyBvbiB0aGUgZHJhZyBzdXJmYWNlJ3MgZ3JvdXAgYW5kIHNob3cgdGhlIHN1cmZhY2UuXG4gICAqIE9ubHkgb25lIGJsb2NrIGdyb3VwIHNob3VsZCBiZSBvbiB0aGUgZHJhZyBzdXJmYWNlIGF0IGEgdGltZS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrcyBCbG9jayBvciBncm91cCBvZiBibG9ja3MgdG8gcGxhY2Ugb24gdGhlIGRyYWcgc3VyZmFjZS5cbiAgICovXG4gIHNldEJsb2Nrc0FuZFNob3coYmxvY2tzOiBTVkdFbGVtZW50KSB7XG4gICAgaWYgKHRoaXMuZHJhZ0dyb3VwLmNoaWxkTm9kZXMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBFcnJvcignQWxyZWFkeSBkcmFnZ2luZyBhIGJsb2NrLicpO1xuICAgIH1cbiAgICAvLyBhcHBlbmRDaGlsZCByZW1vdmVzIHRoZSBibG9ja3MgZnJvbSB0aGUgcHJldmlvdXMgcGFyZW50XG4gICAgdGhpcy5kcmFnR3JvdXAuYXBwZW5kQ2hpbGQoYmxvY2tzKTtcbiAgICB0aGlzLnN2Zy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICB0aGlzLnN1cmZhY2VYWSA9IG5ldyBDb29yZGluYXRlKDAsIDApO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYW5zbGF0ZSBhbmQgc2NhbGUgdGhlIGVudGlyZSBkcmFnIHN1cmZhY2UgZ3JvdXAgdG8gdGhlIGdpdmVuIHBvc2l0aW9uLCB0b1xuICAgKiBrZWVwIGluIHN5bmMgd2l0aCB0aGUgd29ya3NwYWNlLlxuICAgKlxuICAgKiBAcGFyYW0geCBYIHRyYW5zbGF0aW9uIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKiBAcGFyYW0geSBZIHRyYW5zbGF0aW9uIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKiBAcGFyYW0gc2NhbGUgU2NhbGUgb2YgdGhlIGdyb3VwLlxuICAgKi9cbiAgdHJhbnNsYXRlQW5kU2NhbGVHcm91cCh4OiBudW1iZXIsIHk6IG51bWJlciwgc2NhbGU6IG51bWJlcikge1xuICAgIHRoaXMuc2NhbGUgPSBzY2FsZTtcbiAgICAvLyBNYWtlIHN1cmUgdGhlIHN2ZyBleGlzdHMgb24gYSBwaXhlbCBib3VuZGFyeSBzbyB0aGF0IGl0IGlzIG5vdCBmdXp6eS5cbiAgICBjb25zdCByb3VuZFggPSBNYXRoLnJvdW5kKHgpO1xuICAgIGNvbnN0IHJvdW5kWSA9IE1hdGgucm91bmQoeSk7XG4gICAgdGhpcy5jaGlsZFN1cmZhY2VYWS54ID0gcm91bmRYO1xuICAgIHRoaXMuY2hpbGRTdXJmYWNlWFkueSA9IHJvdW5kWTtcbiAgICB0aGlzLmRyYWdHcm91cC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICAndHJhbnNsYXRlKCcgKyByb3VuZFggKyAnLCcgKyByb3VuZFkgKyAnKSBzY2FsZSgnICsgc2NhbGUgKyAnKScpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYW5zbGF0ZSB0aGUgZHJhZyBzdXJmYWNlJ3MgU1ZHIGJhc2VkIG9uIGl0cyBpbnRlcm5hbCBzdGF0ZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICB0cmFuc2xhdGVTdXJmYWNlSW50ZXJuYWxfKCkge1xuICAgIC8vIE1ha2Ugc3VyZSB0aGUgc3ZnIGV4aXN0cyBvbiBhIHBpeGVsIGJvdW5kYXJ5IHNvIHRoYXQgaXQgaXMgbm90IGZ1enp5LlxuICAgIGNvbnN0IHggPSBNYXRoLnJvdW5kKHRoaXMuc3VyZmFjZVhZLngpO1xuICAgIGNvbnN0IHkgPSBNYXRoLnJvdW5kKHRoaXMuc3VyZmFjZVhZLnkpO1xuICAgIHRoaXMuc3ZnLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIGRvbS5zZXRDc3NUcmFuc2Zvcm0odGhpcy5zdmcsICd0cmFuc2xhdGUzZCgnICsgeCArICdweCwgJyArIHkgKyAncHgsIDApJyk7XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNsYXRlcyB0aGUgZW50aXJlIHN1cmZhY2UgYnkgYSByZWxhdGl2ZSBvZmZzZXQuXG4gICAqXG4gICAqIEBwYXJhbSBkZWx0YVggSG9yaXpvbnRhbCBvZmZzZXQgaW4gcGl4ZWwgdW5pdHMuXG4gICAqIEBwYXJhbSBkZWx0YVkgVmVydGljYWwgb2Zmc2V0IGluIHBpeGVsIHVuaXRzLlxuICAgKi9cbiAgdHJhbnNsYXRlQnkoZGVsdGFYOiBudW1iZXIsIGRlbHRhWTogbnVtYmVyKSB7XG4gICAgY29uc3QgeCA9IHRoaXMuc3VyZmFjZVhZLnggKyBkZWx0YVg7XG4gICAgY29uc3QgeSA9IHRoaXMuc3VyZmFjZVhZLnkgKyBkZWx0YVk7XG4gICAgdGhpcy5zdXJmYWNlWFkgPSBuZXcgQ29vcmRpbmF0ZSh4LCB5KTtcbiAgICB0aGlzLnRyYW5zbGF0ZVN1cmZhY2VJbnRlcm5hbF8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2xhdGUgdGhlIGVudGlyZSBkcmFnIHN1cmZhY2UgZHVyaW5nIGEgZHJhZy5cbiAgICogV2UgdHJhbnNsYXRlIHRoZSBkcmFnIHN1cmZhY2UgaW5zdGVhZCBvZiB0aGUgYmxvY2tzIGluc2lkZSB0aGUgc3VyZmFjZVxuICAgKiBzbyB0aGF0IHRoZSBicm93c2VyIGF2b2lkcyByZXBhaW50aW5nIHRoZSBTVkcuXG4gICAqIEJlY2F1c2Ugb2YgdGhpcywgdGhlIGRyYWcgY29vcmRpbmF0ZXMgbXVzdCBiZSBhZGp1c3RlZCBieSBzY2FsZS5cbiAgICpcbiAgICogQHBhcmFtIHggWCB0cmFuc2xhdGlvbiBmb3IgdGhlIGVudGlyZSBzdXJmYWNlLlxuICAgKiBAcGFyYW0geSBZIHRyYW5zbGF0aW9uIGZvciB0aGUgZW50aXJlIHN1cmZhY2UuXG4gICAqL1xuICB0cmFuc2xhdGVTdXJmYWNlKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5zdXJmYWNlWFkgPSBuZXcgQ29vcmRpbmF0ZSh4ICogdGhpcy5zY2FsZSwgeSAqIHRoaXMuc2NhbGUpO1xuICAgIHRoaXMudHJhbnNsYXRlU3VyZmFjZUludGVybmFsXygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcG9ydHMgdGhlIHN1cmZhY2UgdHJhbnNsYXRpb24gaW4gc2NhbGVkIHdvcmtzcGFjZSBjb29yZGluYXRlcy5cbiAgICogVXNlIHRoaXMgd2hlbiBmaW5pc2hpbmcgYSBkcmFnIHRvIHJldHVybiBibG9ja3MgdG8gdGhlIGNvcnJlY3QgcG9zaXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIEN1cnJlbnQgdHJhbnNsYXRpb24gb2YgdGhlIHN1cmZhY2UuXG4gICAqL1xuICBnZXRTdXJmYWNlVHJhbnNsYXRpb24oKTogQ29vcmRpbmF0ZSB7XG4gICAgY29uc3QgeHkgPSBzdmdNYXRoLmdldFJlbGF0aXZlWFkodGhpcy5zdmcpO1xuICAgIHJldHVybiBuZXcgQ29vcmRpbmF0ZSh4eS54IC8gdGhpcy5zY2FsZSwgeHkueSAvIHRoaXMuc2NhbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb3ZpZGUgYSByZWZlcmVuY2UgdG8gdGhlIGRyYWcgZ3JvdXAgKHByaW1hcmlseSBmb3JcbiAgICogQmxvY2tTdmcuZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSkuXG4gICAqXG4gICAqIEByZXR1cm5zIERyYWcgc3VyZmFjZSBncm91cCBlbGVtZW50LlxuICAgKi9cbiAgZ2V0R3JvdXAoKTogU1ZHRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuZHJhZ0dyb3VwO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIFNWRyBkcmFnIHN1cmZhY2UuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBTVkcgZHJhZyBzdXJmYWNlLlxuICAgKi9cbiAgZ2V0U3ZnUm9vdCgpOiBTVkdFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5zdmc7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IGJsb2NrcyBvbiB0aGUgZHJhZyBzdXJmYWNlLCBpZiBhbnkgKHByaW1hcmlseVxuICAgKiBmb3IgQmxvY2tTdmcuZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSkuXG4gICAqXG4gICAqIEByZXR1cm5zIERyYWcgc3VyZmFjZSBibG9jayBET00gZWxlbWVudCwgb3IgbnVsbCBpZiBubyBibG9ja3MgZXhpc3QuXG4gICAqL1xuICBnZXRDdXJyZW50QmxvY2soKTogRWxlbWVudHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy5kcmFnR3JvdXAuZmlyc3RDaGlsZCBhcyBFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHRyYW5zbGF0aW9uIG9mIHRoZSBjaGlsZCBibG9jayBzdXJmYWNlXG4gICAqIFRoaXMgc3VyZmFjZSBpcyBpbiBjaGFyZ2Ugb2Yga2VlcGluZyB0cmFjayBvZiBob3cgbXVjaCB0aGUgd29ya3NwYWNlIGhhc1xuICAgKiBtb3ZlZC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGFtb3VudCB0aGUgd29ya3NwYWNlIGhhcyBiZWVuIG1vdmVkLlxuICAgKi9cbiAgZ2V0V3NUcmFuc2xhdGlvbigpOiBDb29yZGluYXRlIHtcbiAgICAvLyBSZXR1cm5pbmcgYSBjb3B5IHNvIHRoZSBjb29yZGluYXRlIGNhbiBub3QgYmUgY2hhbmdlZCBvdXRzaWRlIHRoaXMgY2xhc3MuXG4gICAgcmV0dXJuIHRoaXMuY2hpbGRTdXJmYWNlWFkuY2xvbmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgZ3JvdXAgYW5kIGhpZGUgdGhlIHN1cmZhY2U7IG1vdmUgdGhlIGJsb2NrcyBvZmYgb250byB0aGUgcHJvdmlkZWRcbiAgICogZWxlbWVudC5cbiAgICogSWYgdGhlIGJsb2NrIGlzIGJlaW5nIGRlbGV0ZWQgaXQgZG9lc24ndCBuZWVkIHRvIGdvIGJhY2sgdG8gdGhlIG9yaWdpbmFsXG4gICAqIHN1cmZhY2UsIHNpbmNlIGl0IHdvdWxkIGJlIHJlbW92ZWQgaW1tZWRpYXRlbHkgZHVyaW5nIGRpc3Bvc2UuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfbmV3U3VyZmFjZSBTdXJmYWNlIHRoZSBkcmFnZ2luZyBibG9ja3Mgc2hvdWxkIGJlIG1vdmVkIHRvLCBvclxuICAgKiAgICAgbnVsbCBpZiB0aGUgYmxvY2tzIHNob3VsZCBiZSByZW1vdmVkIGZyb20gdGhpcyBzdXJmYWNlIHdpdGhvdXQgYmVpbmdcbiAgICogICAgIG1vdmVkIHRvIGEgZGlmZmVyZW50IHN1cmZhY2UuXG4gICAqL1xuICBjbGVhckFuZEhpZGUob3B0X25ld1N1cmZhY2U/OiBFbGVtZW50KSB7XG4gICAgY29uc3QgY3VycmVudEJsb2NrRWxlbWVudCA9IHRoaXMuZ2V0Q3VycmVudEJsb2NrKCk7XG4gICAgaWYgKGN1cnJlbnRCbG9ja0VsZW1lbnQpIHtcbiAgICAgIGlmIChvcHRfbmV3U3VyZmFjZSkge1xuICAgICAgICAvLyBhcHBlbmRDaGlsZCByZW1vdmVzIHRoZSBub2RlIGZyb20gdGhpcy5kcmFnR3JvdXBcbiAgICAgICAgb3B0X25ld1N1cmZhY2UuYXBwZW5kQ2hpbGQoY3VycmVudEJsb2NrRWxlbWVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYWdHcm91cC5yZW1vdmVDaGlsZChjdXJyZW50QmxvY2tFbGVtZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zdmcuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICBpZiAodGhpcy5kcmFnR3JvdXAuY2hpbGROb2Rlcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IEVycm9yKCdEcmFnIGdyb3VwIHdhcyBub3QgY2xlYXJlZC4nKTtcbiAgICB9XG4gICAgdGhpcy5zdXJmYWNlWFkgPSBuZXcgQ29vcmRpbmF0ZSgwLCAwKTtcbiAgfVxufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIE9iamVjdCByZXByZXNlbnRpbmcgYSBwYWlyIG9mIHNjcm9sbGJhcnMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuU2Nyb2xsYmFyUGFpcicpO1xuXG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vZXZlbnRzL3V0aWxzLmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyfSBmcm9tICcuL3Njcm9sbGJhci5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHR5cGUge01ldHJpY3N9IGZyb20gJy4vdXRpbHMvbWV0cmljcy5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIHBhaXIgb2Ygc2Nyb2xsYmFycy4gIEhvcml6b250YWwgYW5kIHZlcnRpY2FsLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LlNjcm9sbGJhclBhaXJcbiAqL1xuZXhwb3J0IGNsYXNzIFNjcm9sbGJhclBhaXIge1xuICBoU2Nyb2xsOiBTY3JvbGxiYXJ8bnVsbCA9IG51bGw7XG4gIHZTY3JvbGw6IFNjcm9sbGJhcnxudWxsID0gbnVsbDtcbiAgY29ybmVyXzogU1ZHUmVjdEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFByZXZpb3VzbHkgcmVjb3JkZWQgbWV0cmljcyBmcm9tIHRoZSB3b3Jrc3BhY2UuICovXG4gIHByaXZhdGUgb2xkSG9zdE1ldHJpY3NfOiBNZXRyaWNzfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gd29ya3NwYWNlIFdvcmtzcGFjZSB0byBiaW5kIHRoZSBzY3JvbGxiYXJzIHRvLlxuICAgKiBAcGFyYW0gYWRkSG9yaXpvbnRhbCBXaGV0aGVyIHRvIGFkZCBhIGhvcml6b250YWwgc2Nyb2xsYmFyLlxuICAgKiAgICBEZWZhdWx0cyB0byB0cnVlLlxuICAgKiBAcGFyYW0gYWRkVmVydGljYWwgV2hldGhlciB0byBhZGQgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIuIERlZmF1bHRzIHRvIHRydWUuXG4gICAqIEBwYXJhbSBvcHRfY2xhc3MgQSBjbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZXNlIHNjcm9sbGJhcnMuXG4gICAqIEBwYXJhbSBvcHRfbWFyZ2luIFRoZSBtYXJnaW4gdG8gYXBwbHkgdG8gdGhlc2Ugc2Nyb2xsYmFycy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgcHJpdmF0ZSB3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZywgYWRkSG9yaXpvbnRhbD86IGJvb2xlYW4sXG4gICAgICBhZGRWZXJ0aWNhbD86IGJvb2xlYW4sIG9wdF9jbGFzcz86IHN0cmluZywgb3B0X21hcmdpbj86IG51bWJlcikge1xuICAgIGFkZEhvcml6b250YWwgPSBhZGRIb3Jpem9udGFsID09PSB1bmRlZmluZWQgPyB0cnVlIDogYWRkSG9yaXpvbnRhbDtcbiAgICBhZGRWZXJ0aWNhbCA9IGFkZFZlcnRpY2FsID09PSB1bmRlZmluZWQgPyB0cnVlIDogYWRkVmVydGljYWw7XG4gICAgY29uc3QgaXNQYWlyID0gYWRkSG9yaXpvbnRhbCAmJiBhZGRWZXJ0aWNhbDtcblxuICAgIGlmIChhZGRIb3Jpem9udGFsKSB7XG4gICAgICB0aGlzLmhTY3JvbGwgPVxuICAgICAgICAgIG5ldyBTY3JvbGxiYXIod29ya3NwYWNlLCB0cnVlLCBpc1BhaXIsIG9wdF9jbGFzcywgb3B0X21hcmdpbik7XG4gICAgfVxuICAgIGlmIChhZGRWZXJ0aWNhbCkge1xuICAgICAgdGhpcy52U2Nyb2xsID1cbiAgICAgICAgICBuZXcgU2Nyb2xsYmFyKHdvcmtzcGFjZSwgZmFsc2UsIGlzUGFpciwgb3B0X2NsYXNzLCBvcHRfbWFyZ2luKTtcbiAgICB9XG5cbiAgICBpZiAoaXNQYWlyKSB7XG4gICAgICB0aGlzLmNvcm5lcl8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuUkVDVCwge1xuICAgICAgICAnaGVpZ2h0JzogU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcyxcbiAgICAgICAgJ3dpZHRoJzogU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcyxcbiAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlTY3JvbGxiYXJCYWNrZ3JvdW5kJyxcbiAgICAgIH0pO1xuICAgICAgZG9tLmluc2VydEFmdGVyKHRoaXMuY29ybmVyXywgd29ya3NwYWNlLmdldEJ1YmJsZUNhbnZhcygpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcG9zZSBvZiB0aGlzIHBhaXIgb2Ygc2Nyb2xsYmFycy5cbiAgICogVW5saW5rIGZyb20gYWxsIERPTSBlbGVtZW50cyB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcy5cbiAgICpcbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgZGlzcG9zZSgpIHtcbiAgICBkb20ucmVtb3ZlTm9kZSh0aGlzLmNvcm5lcl8pO1xuICAgIHRoaXMuY29ybmVyXyA9IG51bGw7XG4gICAgdGhpcy5vbGRIb3N0TWV0cmljc18gPSBudWxsO1xuICAgIGlmICh0aGlzLmhTY3JvbGwpIHtcbiAgICAgIHRoaXMuaFNjcm9sbC5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmhTY3JvbGwgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy52U2Nyb2xsKSB7XG4gICAgICB0aGlzLnZTY3JvbGwuZGlzcG9zZSgpO1xuICAgICAgdGhpcy52U2Nyb2xsID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjYWxjdWxhdGUgYm90aCBvZiB0aGUgc2Nyb2xsYmFycycgbG9jYXRpb25zIGFuZCBsZW5ndGhzLlxuICAgKiBBbHNvIHJlcG9zaXRpb24gdGhlIGNvcm5lciByZWN0YW5nbGUuXG4gICAqL1xuICByZXNpemUoKSB7XG4gICAgLy8gTG9vayB1cCB0aGUgaG9zdCBtZXRyaWNzIG9uY2UsIGFuZCB1c2UgZm9yIGJvdGggc2Nyb2xsYmFycy5cbiAgICBjb25zdCBob3N0TWV0cmljcyA9IHRoaXMud29ya3NwYWNlLmdldE1ldHJpY3MoKTtcbiAgICBpZiAoIWhvc3RNZXRyaWNzKSB7XG4gICAgICAvLyBIb3N0IGVsZW1lbnQgaXMgbGlrZWx5IG5vdCB2aXNpYmxlLlxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIE9ubHkgY2hhbmdlIHRoZSBzY3JvbGxiYXJzIGlmIHRoZXJlIGhhcyBiZWVuIGEgY2hhbmdlIGluIG1ldHJpY3MuXG4gICAgbGV0IHJlc2l6ZUggPSBmYWxzZTtcbiAgICBsZXQgcmVzaXplViA9IGZhbHNlO1xuICAgIGlmICghdGhpcy5vbGRIb3N0TWV0cmljc18gfHxcbiAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18udmlld1dpZHRoICE9PSBob3N0TWV0cmljcy52aWV3V2lkdGggfHxcbiAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18udmlld0hlaWdodCAhPT0gaG9zdE1ldHJpY3Mudmlld0hlaWdodCB8fFxuICAgICAgICB0aGlzLm9sZEhvc3RNZXRyaWNzXy5hYnNvbHV0ZVRvcCAhPT0gaG9zdE1ldHJpY3MuYWJzb2x1dGVUb3AgfHxcbiAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18uYWJzb2x1dGVMZWZ0ICE9PSBob3N0TWV0cmljcy5hYnNvbHV0ZUxlZnQpIHtcbiAgICAgIC8vIFRoZSB3aW5kb3cgaGFzIGJlZW4gcmVzaXplZCBvciByZXBvc2l0aW9uZWQuXG4gICAgICByZXNpemVIID0gdHJ1ZTtcbiAgICAgIHJlc2l6ZVYgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBIYXMgdGhlIGNvbnRlbnQgYmVlbiByZXNpemVkIG9yIG1vdmVkP1xuICAgICAgaWYgKCF0aGlzLm9sZEhvc3RNZXRyaWNzXyB8fFxuICAgICAgICAgIHRoaXMub2xkSG9zdE1ldHJpY3NfLnNjcm9sbFdpZHRoICE9PSBob3N0TWV0cmljcy5zY3JvbGxXaWR0aCB8fFxuICAgICAgICAgIHRoaXMub2xkSG9zdE1ldHJpY3NfLnZpZXdMZWZ0ICE9PSBob3N0TWV0cmljcy52aWV3TGVmdCB8fFxuICAgICAgICAgIHRoaXMub2xkSG9zdE1ldHJpY3NfLnNjcm9sbExlZnQgIT09IGhvc3RNZXRyaWNzLnNjcm9sbExlZnQpIHtcbiAgICAgICAgcmVzaXplSCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMub2xkSG9zdE1ldHJpY3NfIHx8XG4gICAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18uc2Nyb2xsSGVpZ2h0ICE9PSBob3N0TWV0cmljcy5zY3JvbGxIZWlnaHQgfHxcbiAgICAgICAgICB0aGlzLm9sZEhvc3RNZXRyaWNzXy52aWV3VG9wICE9PSBob3N0TWV0cmljcy52aWV3VG9wIHx8XG4gICAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18uc2Nyb2xsVG9wICE9PSBob3N0TWV0cmljcy5zY3JvbGxUb3ApIHtcbiAgICAgICAgcmVzaXplViA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHJlc2l6ZUggfHwgcmVzaXplVikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZXZlbnRVdGlscy5kaXNhYmxlKCk7XG4gICAgICAgIGlmICh0aGlzLmhTY3JvbGwgJiYgcmVzaXplSCkge1xuICAgICAgICAgIHRoaXMuaFNjcm9sbC5yZXNpemUoaG9zdE1ldHJpY3MpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnZTY3JvbGwgJiYgcmVzaXplVikge1xuICAgICAgICAgIHRoaXMudlNjcm9sbC5yZXNpemUoaG9zdE1ldHJpY3MpO1xuICAgICAgICB9XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBldmVudFV0aWxzLmVuYWJsZSgpO1xuICAgICAgfVxuICAgICAgdGhpcy53b3Jrc3BhY2UubWF5YmVGaXJlVmlld3BvcnRDaGFuZ2VFdmVudCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhTY3JvbGwgJiYgdGhpcy52U2Nyb2xsKSB7XG4gICAgICAvLyBSZXBvc2l0aW9uIHRoZSBjb3JuZXIgc3F1YXJlLlxuICAgICAgaWYgKCF0aGlzLm9sZEhvc3RNZXRyaWNzXyB8fFxuICAgICAgICAgIHRoaXMub2xkSG9zdE1ldHJpY3NfLnZpZXdXaWR0aCAhPT0gaG9zdE1ldHJpY3Mudmlld1dpZHRoIHx8XG4gICAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18uYWJzb2x1dGVMZWZ0ICE9PSBob3N0TWV0cmljcy5hYnNvbHV0ZUxlZnQpIHtcbiAgICAgICAgdGhpcy5jb3JuZXJfPy5zZXRBdHRyaWJ1dGUoJ3gnLCBTdHJpbmcodGhpcy52U2Nyb2xsLnBvc2l0aW9uLngpKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5vbGRIb3N0TWV0cmljc18gfHxcbiAgICAgICAgICB0aGlzLm9sZEhvc3RNZXRyaWNzXy52aWV3SGVpZ2h0ICE9PSBob3N0TWV0cmljcy52aWV3SGVpZ2h0IHx8XG4gICAgICAgICAgdGhpcy5vbGRIb3N0TWV0cmljc18uYWJzb2x1dGVUb3AgIT09IGhvc3RNZXRyaWNzLmFic29sdXRlVG9wKSB7XG4gICAgICAgIHRoaXMuY29ybmVyXz8uc2V0QXR0cmlidXRlKCd5JywgU3RyaW5nKHRoaXMuaFNjcm9sbC5wb3NpdGlvbi55KSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2FjaGUgdGhlIGN1cnJlbnQgbWV0cmljcyB0byBwb3RlbnRpYWxseSBzaG9ydC1jdXQgdGhlIG5leHQgcmVzaXplIGV2ZW50LlxuICAgIHRoaXMub2xkSG9zdE1ldHJpY3NfID0gaG9zdE1ldHJpY3M7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIHNjcm9sbGluZyBob3Jpem9udGFsbHkgaXMgZW5hYmxlZC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBob3Jpem9udGFsIHNjcm9sbCBpcyBlbmFibGVkLlxuICAgKi9cbiAgY2FuU2Nyb2xsSG9yaXpvbnRhbGx5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuaFNjcm9sbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgc2Nyb2xsaW5nIHZlcnRpY2FsbHkgaXMgZW5hYmxlZC5cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB2ZXJ0aWNhbCBzY3JvbGwgaXMgZW5hYmxlZC5cbiAgICovXG4gIGNhblNjcm9sbFZlcnRpY2FsbHkoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy52U2Nyb2xsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCB0aGUgb3JpZ2luIG9mIHRoZSB3b3Jrc3BhY2UgdGhhdCB0aGUgc2Nyb2xsYmFyIGlzIGluLCBpbiBwaXhlbHNcbiAgICogcmVsYXRpdmUgdG8gdGhlIGluamVjdGlvbiBkaXYgb3JpZ2luLiBUaGlzIGlzIGZvciB0aW1lcyB3aGVuIHRoZSBzY3JvbGxiYXJcbiAgICogaXMgdXNlZCBpbiBhbiBvYmplY3Qgd2hvc2Ugb3JpZ2luIGlzbid0IHRoZSBzYW1lIGFzIHRoZSBtYWluIHdvcmtzcGFjZVxuICAgKiAoZS5nLiBpbiBhIGZseW91dC4pXG4gICAqXG4gICAqIEBwYXJhbSB4IFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHNjcm9sbGJhcidzIG9yaWdpbiwgaW4gQ1NTIHBpeGVscy5cbiAgICogQHBhcmFtIHkgVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgc2Nyb2xsYmFyJ3Mgb3JpZ2luLCBpbiBDU1MgcGl4ZWxzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNldE9yaWdpbih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmhTY3JvbGwpIHtcbiAgICAgIHRoaXMuaFNjcm9sbC5zZXRPcmlnaW4oeCwgeSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnZTY3JvbGwpIHtcbiAgICAgIHRoaXMudlNjcm9sbC5zZXRPcmlnaW4oeCwgeSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgaGFuZGxlcyBvZiBib3RoIHNjcm9sbGJhcnMuXG4gICAqXG4gICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbnRlbnQgZGlzcGxhY2VtZW50LCByZWxhdGl2ZSB0byB0aGUgdmlldyBpblxuICAgKiAgICAgcGl4ZWxzLlxuICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29udGVudCBkaXNwbGFjZW1lbnQsIHJlbGF0aXZlIHRvIHRoZSB2aWV3IGluIHBpeGVscy5cbiAgICogQHBhcmFtIHVwZGF0ZU1ldHJpY3MgV2hldGhlciB0byB1cGRhdGUgbWV0cmljcyBvbiB0aGlzIHNldCBjYWxsLlxuICAgKiAgICBEZWZhdWx0cyB0byB0cnVlLlxuICAgKi9cbiAgc2V0KHg6IG51bWJlciwgeTogbnVtYmVyLCB1cGRhdGVNZXRyaWNzOiBib29sZWFuKSB7XG4gICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBlcXVpdmFsZW50IHRvOlxuICAgIC8vICAgdGhpcy5oU2Nyb2xsLnNldCh4KTtcbiAgICAvLyAgIHRoaXMudlNjcm9sbC5zZXQoeSk7XG4gICAgLy8gSG93ZXZlciwgdGhhdCBjYWxscyBzZXRNZXRyaWNzIHR3aWNlIHdoaWNoIGNhdXNlcyBhIGNoYWluIG9mXG4gICAgLy8gZ2V0QXR0cmlidXRlLT5zZXRBdHRyaWJ1dGUtPmdldEF0dHJpYnV0ZSByZXN1bHRpbmcgaW4gYW4gZXh0cmEgbGF5b3V0XG4gICAgLy8gcGFzcy4gQ29tYmluaW5nIHRoZW0gc3BlZWRzIHVwIHJlbmRlcmluZy5cbiAgICBpZiAodGhpcy5oU2Nyb2xsKSB7XG4gICAgICB0aGlzLmhTY3JvbGwuc2V0KHgsIGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudlNjcm9sbCkge1xuICAgICAgdGhpcy52U2Nyb2xsLnNldCh5LCBmYWxzZSk7XG4gICAgfVxuXG4gICAgaWYgKHVwZGF0ZU1ldHJpY3MgfHwgdXBkYXRlTWV0cmljcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBVcGRhdGUgbWV0cmljcy5cbiAgICAgIGNvbnN0IHh5UmF0aW86IHt4PzogbnVtYmVyLCB5PzogbnVtYmVyfSA9IHt9O1xuICAgICAgaWYgKHRoaXMuaFNjcm9sbCkge1xuICAgICAgICB4eVJhdGlvLnggPSB0aGlzLmhTY3JvbGwuZ2V0UmF0aW9fKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy52U2Nyb2xsKSB7XG4gICAgICAgIHh5UmF0aW8ueSA9IHRoaXMudlNjcm9sbC5nZXRSYXRpb18oKTtcbiAgICAgIH1cbiAgICAgIHRoaXMud29ya3NwYWNlLnNldE1ldHJpY3MoeHlSYXRpbyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgaGFuZGxlIG9mIHRoZSBob3Jpem9udGFsIHNjcm9sbGJhciB0byBiZSBhdCBhIGNlcnRhaW4gcG9zaXRpb24gaW5cbiAgICogICAgQ1NTIHBpeGVscyByZWxhdGl2ZSB0byBpdHMgcGFyZW50cy5cbiAgICpcbiAgICogQHBhcmFtIHggSG9yaXpvbnRhbCBzY3JvbGwgdmFsdWUuXG4gICAqL1xuICBzZXRYKHg6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmhTY3JvbGwpIHtcbiAgICAgIHRoaXMuaFNjcm9sbC5zZXQoeCwgdHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgaGFuZGxlIG9mIHRoZSB2ZXJ0aWNhbCBzY3JvbGxiYXIgdG8gYmUgYXQgYSBjZXJ0YWluIHBvc2l0aW9uIGluXG4gICAqICAgIENTUyBwaXhlbHMgcmVsYXRpdmUgdG8gaXRzIHBhcmVudHMuXG4gICAqXG4gICAqIEBwYXJhbSB5IFZlcnRpY2FsIHNjcm9sbCB2YWx1ZS5cbiAgICovXG4gIHNldFkoeTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMudlNjcm9sbCkge1xuICAgICAgdGhpcy52U2Nyb2xsLnNldCh5LCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhpcyBzY3JvbGxiYXIncyBjb250YWluZXIgaXMgdmlzaWJsZS5cbiAgICpcbiAgICogQHBhcmFtIHZpc2libGUgV2hldGhlciB0aGUgY29udGFpbmVyIGlzIHZpc2libGUuXG4gICAqL1xuICBzZXRDb250YWluZXJWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5oU2Nyb2xsKSB7XG4gICAgICB0aGlzLmhTY3JvbGwuc2V0Q29udGFpbmVyVmlzaWJsZSh2aXNpYmxlKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudlNjcm9sbCkge1xuICAgICAgdGhpcy52U2Nyb2xsLnNldENvbnRhaW5lclZpc2libGUodmlzaWJsZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIElmIGFueSBvZiB0aGUgc2Nyb2xsYmFycyBhcmUgdmlzaWJsZS4gTm9uLXBhaXJlZCBzY3JvbGxiYXJzIG1heSBkaXNhcHBlYXJcbiAgICogd2hlbiB0aGV5IGFyZW4ndCBuZWVkZWQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdmlzaWJsZS5cbiAgICovXG4gIGlzVmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICBsZXQgaXNWaXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuaFNjcm9sbCkge1xuICAgICAgaXNWaXNpYmxlID0gdGhpcy5oU2Nyb2xsLmlzVmlzaWJsZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy52U2Nyb2xsKSB7XG4gICAgICBpc1Zpc2libGUgPSBpc1Zpc2libGUgfHwgdGhpcy52U2Nyb2xsLmlzVmlzaWJsZSgpO1xuICAgIH1cbiAgICByZXR1cm4gaXNWaXNpYmxlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY2FsY3VsYXRlcyB0aGUgc2Nyb2xsYmFycycgbG9jYXRpb25zIHdpdGhpbiB0aGVpciBwYXRoIGFuZCBsZW5ndGguXG4gICAqIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIHRoZSBjb250ZW50cyBvZiB0aGUgd29ya3NwYWNlIGhhdmUgY2hhbmdlZC5cbiAgICpcbiAgICogQHBhcmFtIGhvc3RNZXRyaWNzIEEgZGF0YSBzdHJ1Y3R1cmUgZGVzY3JpYmluZyBhbGwgdGhlIHJlcXVpcmVkIGRpbWVuc2lvbnMsXG4gICAqICAgICBwb3NzaWJseSBmZXRjaGVkIGZyb20gdGhlIGhvc3Qgb2JqZWN0LlxuICAgKi9cbiAgcmVzaXplQ29udGVudChob3N0TWV0cmljczogTWV0cmljcykge1xuICAgIGlmICh0aGlzLmhTY3JvbGwpIHtcbiAgICAgIHRoaXMuaFNjcm9sbC5yZXNpemVDb250ZW50SG9yaXpvbnRhbChob3N0TWV0cmljcyk7XG4gICAgfVxuICAgIGlmICh0aGlzLnZTY3JvbGwpIHtcbiAgICAgIHRoaXMudlNjcm9sbC5yZXNpemVDb250ZW50VmVydGljYWwoaG9zdE1ldHJpY3MpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNhbGN1bGF0ZXMgdGhlIHNjcm9sbGJhcnMnIGxvY2F0aW9ucyBvbiB0aGUgc2NyZWVuIGFuZCBwYXRoIGxlbmd0aC5cbiAgICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIHdoZW4gdGhlIGxheW91dCBvciBzaXplIG9mIHRoZSB3aW5kb3cgaGFzIGNoYW5nZWQuXG4gICAqXG4gICAqIEBwYXJhbSBob3N0TWV0cmljcyBBIGRhdGEgc3RydWN0dXJlIGRlc2NyaWJpbmcgYWxsIHRoZSByZXF1aXJlZCBkaW1lbnNpb25zLFxuICAgKiAgICAgcG9zc2libHkgZmV0Y2hlZCBmcm9tIHRoZSBob3N0IG9iamVjdC5cbiAgICovXG4gIHJlc2l6ZVZpZXcoaG9zdE1ldHJpY3M6IE1ldHJpY3MpIHtcbiAgICBpZiAodGhpcy5oU2Nyb2xsKSB7XG4gICAgICB0aGlzLmhTY3JvbGwucmVzaXplVmlld0hvcml6b250YWwoaG9zdE1ldHJpY3MpO1xuICAgIH1cbiAgICBpZiAodGhpcy52U2Nyb2xsKSB7XG4gICAgICB0aGlzLnZTY3JvbGwucmVzaXplVmlld1ZlcnRpY2FsKGhvc3RNZXRyaWNzKTtcbiAgICB9XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgZ2VuZXJhdGluZyBleGVjdXRhYmxlIGNvZGUgZnJvbVxuICogQmxvY2tseSBjb2RlLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkNvZGVHZW5lcmF0b3InKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQge05hbWVzLCBOYW1lVHlwZX0gZnJvbSAnLi9uYW1lcy5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGNvZGUgZ2VuZXJhdG9yIHRoYXQgdHJhbnNsYXRlcyB0aGUgYmxvY2tzIGludG8gYSBsYW5ndWFnZS5cbiAqXG4gKiBAdW5yZXN0cmljdGVkXG4gKiBAYWxpYXMgQmxvY2tseS5Db2RlR2VuZXJhdG9yXG4gKi9cbmV4cG9ydCBjbGFzcyBDb2RlR2VuZXJhdG9yIHtcbiAgbmFtZV86IHN0cmluZztcblxuICAvKipcbiAgICogVGhpcyBpcyB1c2VkIGFzIGEgcGxhY2Vob2xkZXIgaW4gZnVuY3Rpb25zIGRlZmluZWQgdXNpbmdcbiAgICogQ29kZUdlbmVyYXRvci5wcm92aWRlRnVuY3Rpb25fLiAgSXQgbXVzdCBub3QgYmUgbGVnYWwgY29kZSB0aGF0IGNvdWxkXG4gICAqIGxlZ2l0aW1hdGVseSBhcHBlYXIgaW4gYSBmdW5jdGlvbiBkZWZpbml0aW9uIChvciBjb21tZW50KSwgYW5kIGl0IG11c3RcbiAgICogbm90IGNvbmZ1c2UgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXJzZXIuXG4gICAqL1xuICBwcm90ZWN0ZWQgRlVOQ1RJT05fTkFNRV9QTEFDRUhPTERFUl8gPSAne2xlQ1VJOGh1dEhaSTQ0ODBEY30nO1xuICBGVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX1JFR0VYUF86IFJlZ0V4cDtcblxuICAvKipcbiAgICogQXJiaXRyYXJ5IGNvZGUgdG8gaW5qZWN0IGludG8gbG9jYXRpb25zIHRoYXQgcmlzayBjYXVzaW5nIGluZmluaXRlIGxvb3BzLlxuICAgKiBBbnkgaW5zdGFuY2VzIG9mICclMScgd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYmxvY2sgSUQgdGhhdCBmYWlsZWQuXG4gICAqIEUuZy4gYCAgY2hlY2tUaW1lb3V0KCUxKTtcXG5gXG4gICAqL1xuICBJTkZJTklURV9MT09QX1RSQVA6IHN0cmluZ3xudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQXJiaXRyYXJ5IGNvZGUgdG8gaW5qZWN0IGJlZm9yZSBldmVyeSBzdGF0ZW1lbnQuXG4gICAqIEFueSBpbnN0YW5jZXMgb2YgJyUxJyB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRoZSBibG9jayBJRCBvZiB0aGUgc3RhdGVtZW50LlxuICAgKiBFLmcuIGBoaWdobGlnaHQoJTEpO1xcbmBcbiAgICovXG4gIFNUQVRFTUVOVF9QUkVGSVg6IHN0cmluZ3xudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQXJiaXRyYXJ5IGNvZGUgdG8gaW5qZWN0IGFmdGVyIGV2ZXJ5IHN0YXRlbWVudC5cbiAgICogQW55IGluc3RhbmNlcyBvZiAnJTEnIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIGJsb2NrIElEIG9mIHRoZSBzdGF0ZW1lbnQuXG4gICAqIEUuZy4gYGhpZ2hsaWdodCglMSk7XFxuYFxuICAgKi9cbiAgU1RBVEVNRU5UX1NVRkZJWDogc3RyaW5nfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgbWV0aG9kIG9mIGluZGVudGluZy4gIERlZmF1bHRzIHRvIHR3byBzcGFjZXMsIGJ1dCBsYW5ndWFnZSBnZW5lcmF0b3JzXG4gICAqIG1heSBvdmVycmlkZSB0aGlzIHRvIGluY3JlYXNlIGluZGVudCBvciBjaGFuZ2UgdG8gdGFicy5cbiAgICovXG4gIElOREVOVCA9ICcgICc7XG5cbiAgLyoqXG4gICAqIE1heGltdW0gbGVuZ3RoIGZvciBhIGNvbW1lbnQgYmVmb3JlIHdyYXBwaW5nLiAgRG9lcyBub3QgYWNjb3VudCBmb3JcbiAgICogaW5kZW50aW5nIGxldmVsLlxuICAgKi9cbiAgQ09NTUVOVF9XUkFQID0gNjA7XG5cbiAgLyoqIExpc3Qgb2Ygb3V0ZXItaW5uZXIgcGFpcmluZ3MgdGhhdCBkbyBOT1QgcmVxdWlyZSBwYXJlbnRoZXNlcy4gKi9cbiAgT1JERVJfT1ZFUlJJREVTOiBudW1iZXJbXVtdID0gW107XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGluaXQgbWV0aG9kIGhhcyBiZWVuIGNhbGxlZC5cbiAgICogR2VuZXJhdG9ycyB0aGF0IHNldCB0aGlzIGZsYWcgdG8gZmFsc2UgYWZ0ZXIgY3JlYXRpb24gYW5kIHRydWUgaW4gaW5pdFxuICAgKiB3aWxsIGNhdXNlIGJsb2NrVG9Db2RlIHRvIGVtaXQgYSB3YXJuaW5nIGlmIHRoZSBnZW5lcmF0b3IgaGFzIG5vdCBiZWVuXG4gICAqIGluaXRpYWxpemVkLiBJZiB0aGlzIGZsYWcgaXMgdW50b3VjaGVkLCBpdCB3aWxsIGhhdmUgbm8gZWZmZWN0LlxuICAgKi9cbiAgaXNJbml0aWFsaXplZDogYm9vbGVhbnxudWxsID0gbnVsbDtcblxuICAvKiogQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgcmVzZXJ2ZWQgd29yZHMuICovXG4gIHByb3RlY3RlZCBSRVNFUlZFRF9XT1JEU18gPSAnJztcblxuICAvKiogQSBkaWN0aW9uYXJ5IG9mIGRlZmluaXRpb25zIHRvIGJlIHByaW50ZWQgYmVmb3JlIHRoZSBjb2RlLiAqL1xuICBwcm90ZWN0ZWQgZGVmaW5pdGlvbnNfOiB7W2tleTogc3RyaW5nXTogc3RyaW5nfSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgLyoqXG4gICAqIEEgZGljdGlvbmFyeSBtYXBwaW5nIGRlc2lyZWQgZnVuY3Rpb24gbmFtZXMgaW4gZGVmaW5pdGlvbnNfIHRvIGFjdHVhbFxuICAgKiBmdW5jdGlvbiBuYW1lcyAodG8gYXZvaWQgY29sbGlzaW9ucyB3aXRoIHVzZXIgZnVuY3Rpb25zKS5cbiAgICovXG4gIHByb3RlY3RlZCBmdW5jdGlvbk5hbWVzXzoge1trZXk6IHN0cmluZ106IHN0cmluZ30gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gIC8qKiBBIGRhdGFiYXNlIG9mIHZhcmlhYmxlIGFuZCBwcm9jZWR1cmUgbmFtZXMuICovXG4gIHByb3RlY3RlZCBuYW1lREJfPzogTmFtZXMgPSB1bmRlZmluZWQ7XG5cbiAgLyoqIEBwYXJhbSBuYW1lIExhbmd1YWdlIG5hbWUgb2YgdGhpcyBnZW5lcmF0b3IuICovXG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge1xuICAgIHRoaXMubmFtZV8gPSBuYW1lO1xuXG4gICAgdGhpcy5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX1JFR0VYUF8gPVxuICAgICAgICBuZXcgUmVnRXhwKHRoaXMuRlVOQ1RJT05fTkFNRV9QTEFDRUhPTERFUl8sICdnJyk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29kZSBmb3IgYWxsIGJsb2NrcyBpbiB0aGUgd29ya3NwYWNlIHRvIHRoZSBzcGVjaWZpZWQgbGFuZ3VhZ2UuXG4gICAqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgV29ya3NwYWNlIHRvIGdlbmVyYXRlIGNvZGUgZnJvbS5cbiAgICogQHJldHVybnMgR2VuZXJhdGVkIGNvZGUuXG4gICAqL1xuICB3b3Jrc3BhY2VUb0NvZGUod29ya3NwYWNlPzogV29ya3NwYWNlKTogc3RyaW5nIHtcbiAgICBpZiAoIXdvcmtzcGFjZSkge1xuICAgICAgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZnJvbSBiZWZvcmUgdGhlcmUgY291bGQgYmUgbXVsdGlwbGUgd29ya3NwYWNlcy5cbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnTm8gd29ya3NwYWNlIHNwZWNpZmllZCBpbiB3b3Jrc3BhY2VUb0NvZGUgY2FsbC4gIEd1ZXNzaW5nLicpO1xuICAgICAgd29ya3NwYWNlID0gY29tbW9uLmdldE1haW5Xb3Jrc3BhY2UoKTtcbiAgICB9XG4gICAgY29uc3QgY29kZSA9IFtdO1xuICAgIHRoaXMuaW5pdCh3b3Jrc3BhY2UpO1xuICAgIGNvbnN0IGJsb2NrcyA9IHdvcmtzcGFjZS5nZXRUb3BCbG9ja3ModHJ1ZSk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IGJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgICBsZXQgbGluZSA9IHRoaXMuYmxvY2tUb0NvZGUoYmxvY2spO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGluZSkpIHtcbiAgICAgICAgLy8gVmFsdWUgYmxvY2tzIHJldHVybiB0dXBsZXMgb2YgY29kZSBhbmQgb3BlcmF0b3Igb3JkZXIuXG4gICAgICAgIC8vIFRvcC1sZXZlbCBibG9ja3MgZG9uJ3QgY2FyZSBhYm91dCBvcGVyYXRvciBvcmRlci5cbiAgICAgICAgbGluZSA9IGxpbmVbMF07XG4gICAgICB9XG4gICAgICBpZiAobGluZSkge1xuICAgICAgICBpZiAoYmxvY2sub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgICAgIC8vIFRoaXMgYmxvY2sgaXMgYSBuYWtlZCB2YWx1ZS4gIEFzayB0aGUgbGFuZ3VhZ2UncyBjb2RlIGdlbmVyYXRvciBpZlxuICAgICAgICAgIC8vIGl0IHdhbnRzIHRvIGFwcGVuZCBhIHNlbWljb2xvbiwgb3Igc29tZXRoaW5nLlxuICAgICAgICAgIGxpbmUgPSB0aGlzLnNjcnViTmFrZWRWYWx1ZShsaW5lKTtcbiAgICAgICAgICBpZiAodGhpcy5TVEFURU1FTlRfUFJFRklYICYmICFibG9jay5zdXBwcmVzc1ByZWZpeFN1ZmZpeCkge1xuICAgICAgICAgICAgbGluZSA9IHRoaXMuaW5qZWN0SWQodGhpcy5TVEFURU1FTlRfUFJFRklYLCBibG9jaykgKyBsaW5lO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5TVEFURU1FTlRfU1VGRklYICYmICFibG9jay5zdXBwcmVzc1ByZWZpeFN1ZmZpeCkge1xuICAgICAgICAgICAgbGluZSA9IGxpbmUgKyB0aGlzLmluamVjdElkKHRoaXMuU1RBVEVNRU5UX1NVRkZJWCwgYmxvY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb2RlLnB1c2gobGluZSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEJsYW5rIGxpbmUgYmV0d2VlbiBlYWNoIHNlY3Rpb24uXG4gICAgbGV0IGNvZGVTdHJpbmcgPSBjb2RlLmpvaW4oJ1xcbicpO1xuICAgIGNvZGVTdHJpbmcgPSB0aGlzLmZpbmlzaChjb2RlU3RyaW5nKTtcbiAgICAvLyBGaW5hbCBzY3J1YmJpbmcgb2Ygd2hpdGVzcGFjZS5cbiAgICBjb2RlU3RyaW5nID0gY29kZVN0cmluZy5yZXBsYWNlKC9eXFxzK1xcbi8sICcnKTtcbiAgICBjb2RlU3RyaW5nID0gY29kZVN0cmluZy5yZXBsYWNlKC9cXG5cXHMrJC8sICdcXG4nKTtcbiAgICBjb2RlU3RyaW5nID0gY29kZVN0cmluZy5yZXBsYWNlKC9bIFxcdF0rXFxuL2csICdcXG4nKTtcbiAgICByZXR1cm4gY29kZVN0cmluZztcbiAgfVxuXG4gIC8vIFRoZSBmb2xsb3dpbmcgYXJlIHNvbWUgaGVscGZ1bCBmdW5jdGlvbnMgd2hpY2ggY2FuIGJlIHVzZWQgYnkgbXVsdGlwbGVcblxuICAvLyBsYW5ndWFnZXMuXG5cbiAgLyoqXG4gICAqIFByZXBlbmQgYSBjb21tb24gcHJlZml4IG9udG8gZWFjaCBsaW5lIG9mIGNvZGUuXG4gICAqIEludGVuZGVkIGZvciBpbmRlbnRpbmcgY29kZSBvciBhZGRpbmcgY29tbWVudCBtYXJrZXJzLlxuICAgKlxuICAgKiBAcGFyYW0gdGV4dCBUaGUgbGluZXMgb2YgY29kZS5cbiAgICogQHBhcmFtIHByZWZpeCBUaGUgY29tbW9uIHByZWZpeC5cbiAgICogQHJldHVybnMgVGhlIHByZWZpeGVkIGxpbmVzIG9mIGNvZGUuXG4gICAqL1xuICBwcmVmaXhMaW5lcyh0ZXh0OiBzdHJpbmcsIHByZWZpeDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gcHJlZml4ICsgdGV4dC5yZXBsYWNlKC8oPyFcXG4kKVxcbi9nLCAnXFxuJyArIHByZWZpeCk7XG4gIH1cblxuICAvKipcbiAgICogUmVjdXJzaXZlbHkgc3BpZGVyIGEgdHJlZSBvZiBibG9ja3MsIHJldHVybmluZyBhbGwgdGhlaXIgY29tbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgZnJvbSB3aGljaCB0byBzdGFydCBzcGlkZXJpbmcuXG4gICAqIEByZXR1cm5zIENvbmNhdGVuYXRlZCBsaXN0IG9mIGNvbW1lbnRzLlxuICAgKi9cbiAgYWxsTmVzdGVkQ29tbWVudHMoYmxvY2s6IEJsb2NrKTogc3RyaW5nIHtcbiAgICBjb25zdCBjb21tZW50cyA9IFtdO1xuICAgIGNvbnN0IGJsb2NrcyA9IGJsb2NrLmdldERlc2NlbmRhbnRzKHRydWUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjb21tZW50ID0gYmxvY2tzW2ldLmdldENvbW1lbnRUZXh0KCk7XG4gICAgICBpZiAoY29tbWVudCkge1xuICAgICAgICBjb21tZW50cy5wdXNoKGNvbW1lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBBcHBlbmQgYW4gZW1wdHkgc3RyaW5nIHRvIGNyZWF0ZSBhIHRyYWlsaW5nIGxpbmUgYnJlYWsgd2hlbiBqb2luZWQuXG4gICAgaWYgKGNvbW1lbnRzLmxlbmd0aCkge1xuICAgICAgY29tbWVudHMucHVzaCgnJyk7XG4gICAgfVxuICAgIHJldHVybiBjb21tZW50cy5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb2RlIGZvciB0aGUgc3BlY2lmaWVkIGJsb2NrIChhbmQgYXR0YWNoZWQgYmxvY2tzKS5cbiAgICogVGhlIGdlbmVyYXRvciBtdXN0IGJlIGluaXRpYWxpemVkIGJlZm9yZSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgdG8gZ2VuZXJhdGUgY29kZSBmb3IuXG4gICAqIEBwYXJhbSBvcHRfdGhpc09ubHkgVHJ1ZSB0byBnZW5lcmF0ZSBjb2RlIGZvciBvbmx5IHRoaXMgc3RhdGVtZW50LlxuICAgKiBAcmV0dXJucyBGb3Igc3RhdGVtZW50IGJsb2NrcywgdGhlIGdlbmVyYXRlZCBjb2RlLlxuICAgKiAgICAgRm9yIHZhbHVlIGJsb2NrcywgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgZ2VuZXJhdGVkIGNvZGUgYW5kIGFuXG4gICAqIG9wZXJhdG9yIG9yZGVyIHZhbHVlLiAgUmV0dXJucyAnJyBpZiBibG9jayBpcyBudWxsLlxuICAgKi9cbiAgYmxvY2tUb0NvZGUoYmxvY2s6IEJsb2NrfG51bGwsIG9wdF90aGlzT25seT86IGJvb2xlYW4pOiBzdHJpbmdcbiAgICAgIHxbc3RyaW5nLCBudW1iZXJdIHtcbiAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkID09PSBmYWxzZSkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICdDb2RlR2VuZXJhdG9yIGluaXQgd2FzIG5vdCBjYWxsZWQgYmVmb3JlIGJsb2NrVG9Db2RlIHdhcyBjYWxsZWQuJyk7XG4gICAgfVxuICAgIGlmICghYmxvY2spIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgaWYgKCFibG9jay5pc0VuYWJsZWQoKSkge1xuICAgICAgLy8gU2tpcCBwYXN0IHRoaXMgYmxvY2sgaWYgaXQgaXMgZGlzYWJsZWQuXG4gICAgICByZXR1cm4gb3B0X3RoaXNPbmx5ID8gJycgOiB0aGlzLmJsb2NrVG9Db2RlKGJsb2NrLmdldE5leHRCbG9jaygpKTtcbiAgICB9XG4gICAgaWYgKGJsb2NrLmlzSW5zZXJ0aW9uTWFya2VyKCkpIHtcbiAgICAgIC8vIFNraXAgcGFzdCBpbnNlcnRpb24gbWFya2Vycy5cbiAgICAgIHJldHVybiBvcHRfdGhpc09ubHkgPyAnJyA6IHRoaXMuYmxvY2tUb0NvZGUoYmxvY2suZ2V0Q2hpbGRyZW4oZmFsc2UpWzBdKTtcbiAgICB9XG5cbiAgICBjb25zdCBmdW5jID0gKHRoaXMgYXMgYW55KVtibG9jay50eXBlXTtcbiAgICBpZiAodHlwZW9mIGZ1bmMgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdMYW5ndWFnZSBcIicgKyB0aGlzLm5hbWVfICsgJ1wiIGRvZXMgbm90IGtub3cgaG93IHRvIGdlbmVyYXRlICcgK1xuICAgICAgICAgICdjb2RlIGZvciBibG9jayB0eXBlIFwiJyArIGJsb2NrLnR5cGUgKyAnXCIuJyk7XG4gICAgfVxuICAgIC8vIEZpcnN0IGFyZ3VtZW50IHRvIGZ1bmMuY2FsbCBpcyB0aGUgdmFsdWUgb2YgJ3RoaXMnIGluIHRoZSBnZW5lcmF0b3IuXG4gICAgLy8gUHJpb3IgdG8gMjQgU2VwdGVtYmVyIDIwMTMgJ3RoaXMnIHdhcyB0aGUgb25seSB3YXkgdG8gYWNjZXNzIHRoZSBibG9jay5cbiAgICAvLyBUaGUgY3VycmVudCBwcmVmZXJyZWQgbWV0aG9kIG9mIGFjY2Vzc2luZyB0aGUgYmxvY2sgaXMgdGhyb3VnaCB0aGUgc2Vjb25kXG4gICAgLy8gYXJndW1lbnQgdG8gZnVuYy5jYWxsLCB3aGljaCBiZWNvbWVzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgdG8gdGhlXG4gICAgLy8gZ2VuZXJhdG9yLlxuICAgIGxldCBjb2RlID0gZnVuYy5jYWxsKGJsb2NrLCBibG9jayk7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHtcbiAgICAgIC8vIFZhbHVlIGJsb2NrcyByZXR1cm4gdHVwbGVzIG9mIGNvZGUgYW5kIG9wZXJhdG9yIG9yZGVyLlxuICAgICAgaWYgKCFibG9jay5vdXRwdXRDb25uZWN0aW9uKSB7XG4gICAgICAgIHRocm93IFR5cGVFcnJvcignRXhwZWN0aW5nIHN0cmluZyBmcm9tIHN0YXRlbWVudCBibG9jazogJyArIGJsb2NrLnR5cGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFt0aGlzLnNjcnViXyhibG9jaywgY29kZVswXSwgb3B0X3RoaXNPbmx5KSwgY29kZVsxXV07XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgY29kZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmICh0aGlzLlNUQVRFTUVOVF9QUkVGSVggJiYgIWJsb2NrLnN1cHByZXNzUHJlZml4U3VmZml4KSB7XG4gICAgICAgIGNvZGUgPSB0aGlzLmluamVjdElkKHRoaXMuU1RBVEVNRU5UX1BSRUZJWCwgYmxvY2spICsgY29kZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLlNUQVRFTUVOVF9TVUZGSVggJiYgIWJsb2NrLnN1cHByZXNzUHJlZml4U3VmZml4KSB7XG4gICAgICAgIGNvZGUgPSBjb2RlICsgdGhpcy5pbmplY3RJZCh0aGlzLlNUQVRFTUVOVF9TVUZGSVgsIGJsb2NrKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLnNjcnViXyhibG9jaywgY29kZSwgb3B0X3RoaXNPbmx5KTtcbiAgICB9IGVsc2UgaWYgKGNvZGUgPT09IG51bGwpIHtcbiAgICAgIC8vIEJsb2NrIGhhcyBoYW5kbGVkIGNvZGUgZ2VuZXJhdGlvbiBpdHNlbGYuXG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIHRocm93IFN5bnRheEVycm9yKCdJbnZhbGlkIGNvZGUgZ2VuZXJhdGVkOiAnICsgY29kZSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29kZSByZXByZXNlbnRpbmcgdGhlIHNwZWNpZmllZCB2YWx1ZSBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBjb250YWluaW5nIHRoZSBpbnB1dC5cbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGlucHV0LlxuICAgKiBAcGFyYW0gb3V0ZXJPcmRlciBUaGUgbWF4aW11bSBiaW5kaW5nIHN0cmVuZ3RoIChtaW5pbXVtIG9yZGVyIHZhbHVlKSBvZiBhbnlcbiAgICogICAgIG9wZXJhdG9ycyBhZGphY2VudCB0byBcImJsb2NrXCIuXG4gICAqIEByZXR1cm5zIEdlbmVyYXRlZCBjb2RlIG9yICcnIGlmIG5vIGJsb2NrcyBhcmUgY29ubmVjdGVkIG9yIHRoZSBzcGVjaWZpZWRcbiAgICogICAgIGlucHV0IGRvZXMgbm90IGV4aXN0LlxuICAgKi9cbiAgdmFsdWVUb0NvZGUoYmxvY2s6IEJsb2NrLCBuYW1lOiBzdHJpbmcsIG91dGVyT3JkZXI6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGlzTmFOKG91dGVyT3JkZXIpKSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ0V4cGVjdGluZyB2YWxpZCBvcmRlciBmcm9tIGJsb2NrOiAnICsgYmxvY2sudHlwZSk7XG4gICAgfVxuICAgIGNvbnN0IHRhcmdldEJsb2NrID0gYmxvY2suZ2V0SW5wdXRUYXJnZXRCbG9jayhuYW1lKTtcbiAgICBpZiAoIXRhcmdldEJsb2NrKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGNvbnN0IHR1cGxlID0gdGhpcy5ibG9ja1RvQ29kZSh0YXJnZXRCbG9jayk7XG4gICAgaWYgKHR1cGxlID09PSAnJykge1xuICAgICAgLy8gRGlzYWJsZWQgYmxvY2suXG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIC8vIFZhbHVlIGJsb2NrcyBtdXN0IHJldHVybiBjb2RlIGFuZCBvcmRlciBvZiBvcGVyYXRpb25zIGluZm8uXG4gICAgLy8gU3RhdGVtZW50IGJsb2NrcyBtdXN0IG9ubHkgcmV0dXJuIGNvZGUuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHR1cGxlKSkge1xuICAgICAgdGhyb3cgVHlwZUVycm9yKCdFeHBlY3RpbmcgdHVwbGUgZnJvbSB2YWx1ZSBibG9jazogJyArIHRhcmdldEJsb2NrLnR5cGUpO1xuICAgIH1cbiAgICBsZXQgY29kZSA9IHR1cGxlWzBdO1xuICAgIGNvbnN0IGlubmVyT3JkZXIgPSB0dXBsZVsxXTtcbiAgICBpZiAoaXNOYU4oaW5uZXJPcmRlcikpIHtcbiAgICAgIHRocm93IFR5cGVFcnJvcihcbiAgICAgICAgICAnRXhwZWN0aW5nIHZhbGlkIG9yZGVyIGZyb20gdmFsdWUgYmxvY2s6ICcgKyB0YXJnZXRCbG9jay50eXBlKTtcbiAgICB9XG4gICAgaWYgKCFjb2RlKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgLy8gQWRkIHBhcmVudGhlc2VzIGlmIG5lZWRlZC5cbiAgICBsZXQgcGFyZW5zTmVlZGVkID0gZmFsc2U7XG4gICAgY29uc3Qgb3V0ZXJPcmRlckNsYXNzID0gTWF0aC5mbG9vcihvdXRlck9yZGVyKTtcbiAgICBjb25zdCBpbm5lck9yZGVyQ2xhc3MgPSBNYXRoLmZsb29yKGlubmVyT3JkZXIpO1xuICAgIGlmIChvdXRlck9yZGVyQ2xhc3MgPD0gaW5uZXJPcmRlckNsYXNzKSB7XG4gICAgICBpZiAob3V0ZXJPcmRlckNsYXNzID09PSBpbm5lck9yZGVyQ2xhc3MgJiZcbiAgICAgICAgICAob3V0ZXJPcmRlckNsYXNzID09PSAwIHx8IG91dGVyT3JkZXJDbGFzcyA9PT0gOTkpKSB7XG4gICAgICAgIC8vIERvbid0IGdlbmVyYXRlIHBhcmVucyBhcm91bmQgTk9ORS1OT05FIGFuZCBBVE9NSUMtQVRPTUlDIHBhaXJzLlxuICAgICAgICAvLyAwIGlzIHRoZSBhdG9taWMgb3JkZXIsIDk5IGlzIHRoZSBub25lIG9yZGVyLiAgTm8gcGFyZW50aGVzZXMgbmVlZGVkLlxuICAgICAgICAvLyBJbiBhbGwga25vd24gbGFuZ3VhZ2VzIG11bHRpcGxlIHN1Y2ggY29kZSBibG9ja3MgYXJlIG5vdCBvcmRlclxuICAgICAgICAvLyBzZW5zaXRpdmUuICBJbiBmYWN0IGluIFB5dGhvbiAoJ2EnICdiJykgJ2MnIHdvdWxkIGZhaWwuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUaGUgb3BlcmF0b3JzIG91dHNpZGUgdGhpcyBjb2RlIGFyZSBzdHJvbmdlciB0aGFuIHRoZSBvcGVyYXRvcnNcbiAgICAgICAgLy8gaW5zaWRlIHRoaXMgY29kZS4gIFRvIHByZXZlbnQgdGhlIGNvZGUgZnJvbSBiZWluZyBwdWxsZWQgYXBhcnQsXG4gICAgICAgIC8vIHdyYXAgdGhlIGNvZGUgaW4gcGFyZW50aGVzZXMuXG4gICAgICAgIHBhcmVuc05lZWRlZCA9IHRydWU7XG4gICAgICAgIC8vIENoZWNrIGZvciBzcGVjaWFsIGV4Y2VwdGlvbnMuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5PUkRFUl9PVkVSUklERVMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAodGhpcy5PUkRFUl9PVkVSUklERVNbaV1bMF0gPT09IG91dGVyT3JkZXIgJiZcbiAgICAgICAgICAgICAgdGhpcy5PUkRFUl9PVkVSUklERVNbaV1bMV0gPT09IGlubmVyT3JkZXIpIHtcbiAgICAgICAgICAgIHBhcmVuc05lZWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChwYXJlbnNOZWVkZWQpIHtcbiAgICAgIC8vIFRlY2huaWNhbGx5LCB0aGlzIHNob3VsZCBiZSBoYW5kbGVkIG9uIGEgbGFuZ3VhZ2UtYnktbGFuZ3VhZ2UgYmFzaXMuXG4gICAgICAvLyBIb3dldmVyIGFsbCBrbm93biAoc2FuZSkgbGFuZ3VhZ2VzIHVzZSBwYXJlbnRoZXNlcyBmb3IgZ3JvdXBpbmcuXG4gICAgICBjb2RlID0gJygnICsgY29kZSArICcpJztcbiAgICB9XG4gICAgcmV0dXJuIGNvZGU7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBjb2RlIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGJsb2NrcyBhdHRhY2hlZCB0byB0aGUgbmFtZWRcbiAgICogc3RhdGVtZW50IGlucHV0LiBJbmRlbnQgdGhlIGNvZGUuXG4gICAqIFRoaXMgaXMgbWFpbmx5IHVzZWQgaW4gZ2VuZXJhdG9ycy4gV2hlbiB0cnlpbmcgdG8gZ2VuZXJhdGUgY29kZSB0byBldmFsdWF0ZVxuICAgKiBsb29rIGF0IHVzaW5nIHdvcmtzcGFjZVRvQ29kZSBvciBibG9ja1RvQ29kZS5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayBjb250YWluaW5nIHRoZSBpbnB1dC5cbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGlucHV0LlxuICAgKiBAcmV0dXJucyBHZW5lcmF0ZWQgY29kZSBvciAnJyBpZiBubyBibG9ja3MgYXJlIGNvbm5lY3RlZC5cbiAgICovXG4gIHN0YXRlbWVudFRvQ29kZShibG9jazogQmxvY2ssIG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgdGFyZ2V0QmxvY2sgPSBibG9jay5nZXRJbnB1dFRhcmdldEJsb2NrKG5hbWUpO1xuICAgIGxldCBjb2RlID0gdGhpcy5ibG9ja1RvQ29kZSh0YXJnZXRCbG9jayk7XG4gICAgLy8gVmFsdWUgYmxvY2tzIG11c3QgcmV0dXJuIGNvZGUgYW5kIG9yZGVyIG9mIG9wZXJhdGlvbnMgaW5mby5cbiAgICAvLyBTdGF0ZW1lbnQgYmxvY2tzIG11c3Qgb25seSByZXR1cm4gY29kZS5cbiAgICBpZiAodHlwZW9mIGNvZGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoXG4gICAgICAgICAgJ0V4cGVjdGluZyBjb2RlIGZyb20gc3RhdGVtZW50IGJsb2NrOiAnICtcbiAgICAgICAgICAodGFyZ2V0QmxvY2sgJiYgdGFyZ2V0QmxvY2sudHlwZSkpO1xuICAgIH1cbiAgICBpZiAoY29kZSkge1xuICAgICAgY29kZSA9IHRoaXMucHJlZml4TGluZXMoKGNvZGUpLCB0aGlzLklOREVOVCk7XG4gICAgfVxuICAgIHJldHVybiBjb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBpbmZpbml0ZSBsb29wIHRyYXAgdG8gdGhlIGNvbnRlbnRzIG9mIGEgbG9vcC5cbiAgICogQWRkIHN0YXRlbWVudCBzdWZmaXggYXQgdGhlIHN0YXJ0IG9mIHRoZSBsb29wIGJsb2NrIChyaWdodCBhZnRlciB0aGUgbG9vcFxuICAgKiBzdGF0ZW1lbnQgZXhlY3V0ZXMpLCBhbmQgYSBzdGF0ZW1lbnQgcHJlZml4IHRvIHRoZSBlbmQgb2YgdGhlIGxvb3AgYmxvY2tcbiAgICogKHJpZ2h0IGJlZm9yZSB0aGUgbG9vcCBzdGF0ZW1lbnQgZXhlY3V0ZXMpLlxuICAgKlxuICAgKiBAcGFyYW0gYnJhbmNoIENvZGUgZm9yIGxvb3AgY29udGVudHMuXG4gICAqIEBwYXJhbSBibG9jayBFbmNsb3NpbmcgYmxvY2suXG4gICAqIEByZXR1cm5zIExvb3AgY29udGVudHMsIHdpdGggaW5maW5pdGUgbG9vcCB0cmFwIGFkZGVkLlxuICAgKi9cbiAgYWRkTG9vcFRyYXAoYnJhbmNoOiBzdHJpbmcsIGJsb2NrOiBCbG9jayk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuSU5GSU5JVEVfTE9PUF9UUkFQKSB7XG4gICAgICBicmFuY2ggPSB0aGlzLnByZWZpeExpbmVzKFxuICAgICAgICAgICAgICAgICAgIHRoaXMuaW5qZWN0SWQodGhpcy5JTkZJTklURV9MT09QX1RSQVAsIGJsb2NrKSwgdGhpcy5JTkRFTlQpICtcbiAgICAgICAgICBicmFuY2g7XG4gICAgfVxuICAgIGlmICh0aGlzLlNUQVRFTUVOVF9TVUZGSVggJiYgIWJsb2NrLnN1cHByZXNzUHJlZml4U3VmZml4KSB7XG4gICAgICBicmFuY2ggPSB0aGlzLnByZWZpeExpbmVzKFxuICAgICAgICAgICAgICAgICAgIHRoaXMuaW5qZWN0SWQodGhpcy5TVEFURU1FTlRfU1VGRklYLCBibG9jayksIHRoaXMuSU5ERU5UKSArXG4gICAgICAgICAgYnJhbmNoO1xuICAgIH1cbiAgICBpZiAodGhpcy5TVEFURU1FTlRfUFJFRklYICYmICFibG9jay5zdXBwcmVzc1ByZWZpeFN1ZmZpeCkge1xuICAgICAgYnJhbmNoID0gYnJhbmNoICtcbiAgICAgICAgICB0aGlzLnByZWZpeExpbmVzKFxuICAgICAgICAgICAgICB0aGlzLmluamVjdElkKHRoaXMuU1RBVEVNRU5UX1BSRUZJWCwgYmxvY2spLCB0aGlzLklOREVOVCk7XG4gICAgfVxuICAgIHJldHVybiBicmFuY2g7XG4gIH1cblxuICAvKipcbiAgICogSW5qZWN0IGEgYmxvY2sgSUQgaW50byBhIG1lc3NhZ2UgdG8gcmVwbGFjZSAnJTEnLlxuICAgKiBVc2VkIGZvciBTVEFURU1FTlRfUFJFRklYLCBTVEFURU1FTlRfU1VGRklYLCBhbmQgSU5GSU5JVEVfTE9PUF9UUkFQLlxuICAgKlxuICAgKiBAcGFyYW0gbXNnIENvZGUgc25pcHBldCB3aXRoICclMScuXG4gICAqIEBwYXJhbSBibG9jayBCbG9jayB3aGljaCBoYXMgYW4gSUQuXG4gICAqIEByZXR1cm5zIENvZGUgc25pcHBldCB3aXRoIElELlxuICAgKi9cbiAgaW5qZWN0SWQobXNnOiBzdHJpbmcsIGJsb2NrOiBCbG9jayk6IHN0cmluZyB7XG4gICAgY29uc3QgaWQgPSBibG9jay5pZC5yZXBsYWNlKC9cXCQvZywgJyQkJCQnKTsgIC8vIElzc3VlIDI1MS5cbiAgICByZXR1cm4gbXNnLnJlcGxhY2UoLyUxL2csICdcXCcnICsgaWQgKyAnXFwnJyk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIG9uZSBvciBtb3JlIHdvcmRzIHRvIHRoZSBsaXN0IG9mIHJlc2VydmVkIHdvcmRzIGZvciB0aGlzIGxhbmd1YWdlLlxuICAgKlxuICAgKiBAcGFyYW0gd29yZHMgQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2Ygd29yZHMgdG8gYWRkIHRvIHRoZSBsaXN0LlxuICAgKiAgICAgTm8gc3BhY2VzLiAgRHVwbGljYXRlcyBhcmUgb2suXG4gICAqL1xuICBhZGRSZXNlcnZlZFdvcmRzKHdvcmRzOiBzdHJpbmcpIHtcbiAgICB0aGlzLlJFU0VSVkVEX1dPUkRTXyArPSB3b3JkcyArICcsJztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWZpbmUgYSBkZXZlbG9wZXItZGVmaW5lZCBmdW5jdGlvbiAobm90IGEgdXNlci1kZWZpbmVkIHByb2NlZHVyZSkgdG8gYmVcbiAgICogaW5jbHVkZWQgaW4gdGhlIGdlbmVyYXRlZCBjb2RlLiAgVXNlZCBmb3IgY3JlYXRpbmcgcHJpdmF0ZSBoZWxwZXJcbiAgICogZnVuY3Rpb25zLiBUaGUgZmlyc3QgdGltZSB0aGlzIGlzIGNhbGxlZCB3aXRoIGEgZ2l2ZW4gZGVzaXJlZE5hbWUsIHRoZSBjb2RlXG4gICAqIGlzIHNhdmVkIGFuZCBhbiBhY3R1YWwgbmFtZSBpcyBnZW5lcmF0ZWQuICBTdWJzZXF1ZW50IGNhbGxzIHdpdGggdGhlIHNhbWVcbiAgICogZGVzaXJlZE5hbWUgaGF2ZSBubyBlZmZlY3QgYnV0IGhhdmUgdGhlIHNhbWUgcmV0dXJuIHZhbHVlLlxuICAgKlxuICAgKiBJdCBpcyB1cCB0byB0aGUgY2FsbGVyIHRvIG1ha2Ugc3VyZSB0aGUgc2FtZSBkZXNpcmVkTmFtZSBpcyBub3RcbiAgICogdXNlZCBmb3IgZGlmZmVyZW50IGhlbHBlciBmdW5jdGlvbnMgKGUuZy4gdXNlIFwiY29sb3VyUmFuZG9tXCIgYW5kXG4gICAqIFwibGlzdFJhbmRvbVwiLCBub3QgXCJyYW5kb21cIikuICBUaGVyZSBpcyBubyBkYW5nZXIgb2YgY29sbGlkaW5nIHdpdGggcmVzZXJ2ZWRcbiAgICogd29yZHMsIG9yIHVzZXItZGVmaW5lZCB2YXJpYWJsZSBvciBwcm9jZWR1cmUgbmFtZXMuXG4gICAqXG4gICAqIFRoZSBjb2RlIGdldHMgb3V0cHV0IHdoZW4gQ29kZUdlbmVyYXRvci5maW5pc2goKSBpcyBjYWxsZWQuXG4gICAqXG4gICAqIEBwYXJhbSBkZXNpcmVkTmFtZSBUaGUgZGVzaXJlZCBuYW1lIG9mIHRoZSBmdW5jdGlvbiAoZS5nLiBtYXRoSXNQcmltZSkuXG4gICAqIEBwYXJhbSBjb2RlIEEgbGlzdCBvZiBzdGF0ZW1lbnRzIG9yIG9uZSBtdWx0aS1saW5lIGNvZGUgc3RyaW5nLiAgVXNlICcgICdcbiAgICogICAgIGZvciBpbmRlbnRzICh0aGV5IHdpbGwgYmUgcmVwbGFjZWQpLlxuICAgKiBAcmV0dXJucyBUaGUgYWN0dWFsIG5hbWUgb2YgdGhlIG5ldyBmdW5jdGlvbi4gIFRoaXMgbWF5IGRpZmZlciBmcm9tXG4gICAqICAgICBkZXNpcmVkTmFtZSBpZiB0aGUgZm9ybWVyIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW4gYnkgdGhlIHVzZXIuXG4gICAqL1xuICBwcm90ZWN0ZWQgcHJvdmlkZUZ1bmN0aW9uXyhkZXNpcmVkTmFtZTogc3RyaW5nLCBjb2RlOiBzdHJpbmdbXXxzdHJpbmcpOlxuICAgICAgc3RyaW5nIHtcbiAgICBpZiAoIXRoaXMuZGVmaW5pdGlvbnNfW2Rlc2lyZWROYW1lXSkge1xuICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID1cbiAgICAgICAgICB0aGlzLm5hbWVEQl8hLmdldERpc3RpbmN0TmFtZShkZXNpcmVkTmFtZSwgTmFtZVR5cGUuUFJPQ0VEVVJFKTtcbiAgICAgIHRoaXMuZnVuY3Rpb25OYW1lc19bZGVzaXJlZE5hbWVdID0gZnVuY3Rpb25OYW1lO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHtcbiAgICAgICAgY29kZSA9IGNvZGUuam9pbignXFxuJyk7XG4gICAgICB9XG4gICAgICBsZXQgY29kZVRleHQgPSBjb2RlLnRyaW0oKS5yZXBsYWNlKFxuICAgICAgICAgIHRoaXMuRlVOQ1RJT05fTkFNRV9QTEFDRUhPTERFUl9SRUdFWFBfLCBmdW5jdGlvbk5hbWUpO1xuICAgICAgLy8gQ2hhbmdlIGFsbCAnICAnIGluZGVudHMgaW50byB0aGUgZGVzaXJlZCBpbmRlbnQuXG4gICAgICAvLyBUbyBhdm9pZCBhbiBpbmZpbml0ZSBsb29wIG9mIHJlcGxhY2VtZW50cywgY2hhbmdlIGFsbCBpbmRlbnRzIHRvICdcXDAnXG4gICAgICAvLyBjaGFyYWN0ZXIgZmlyc3QsIHRoZW4gcmVwbGFjZSB0aGVtIGFsbCB3aXRoIHRoZSBpbmRlbnQuXG4gICAgICAvLyBXZSBhcmUgYXNzdW1pbmcgdGhhdCBubyBwcm92aWRlZCBmdW5jdGlvbnMgY29udGFpbiBhIGxpdGVyYWwgbnVsbCBjaGFyLlxuICAgICAgbGV0IG9sZENvZGVUZXh0O1xuICAgICAgd2hpbGUgKG9sZENvZGVUZXh0ICE9PSBjb2RlVGV4dCkge1xuICAgICAgICBvbGRDb2RlVGV4dCA9IGNvZGVUZXh0O1xuICAgICAgICBjb2RlVGV4dCA9IGNvZGVUZXh0LnJlcGxhY2UoL14oKCB7Mn0pKikgezJ9L2dtLCAnJDFcXDAnKTtcbiAgICAgIH1cbiAgICAgIGNvZGVUZXh0ID0gY29kZVRleHQucmVwbGFjZSgvXFwwL2csIHRoaXMuSU5ERU5UKTtcbiAgICAgIHRoaXMuZGVmaW5pdGlvbnNfW2Rlc2lyZWROYW1lXSA9IGNvZGVUZXh0O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5mdW5jdGlvbk5hbWVzX1tkZXNpcmVkTmFtZV07XG4gIH1cblxuICAvKipcbiAgICogSG9vayBmb3IgY29kZSB0byBydW4gYmVmb3JlIGNvZGUgZ2VuZXJhdGlvbiBzdGFydHMuXG4gICAqIFN1YmNsYXNzZXMgbWF5IG92ZXJyaWRlIHRoaXMsIGUuZy4gdG8gaW5pdGlhbGlzZSB0aGUgZGF0YWJhc2Ugb2YgdmFyaWFibGVcbiAgICogbmFtZXMuXG4gICAqXG4gICAqIEBwYXJhbSBfd29ya3NwYWNlIFdvcmtzcGFjZSB0byBnZW5lcmF0ZSBjb2RlIGZyb20uXG4gICAqL1xuICBpbml0KF93b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xuICAgIC8vIE9wdGlvbmFsbHkgb3ZlcnJpZGVcbiAgICAvLyBDcmVhdGUgYSBkaWN0aW9uYXJ5IG9mIGRlZmluaXRpb25zIHRvIGJlIHByaW50ZWQgYmVmb3JlIHRoZSBjb2RlLlxuICAgIHRoaXMuZGVmaW5pdGlvbnNfID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAvLyBDcmVhdGUgYSBkaWN0aW9uYXJ5IG1hcHBpbmcgZGVzaXJlZCBkZXZlbG9wZXItZGVmaW5lZCBmdW5jdGlvbiBuYW1lcyBpblxuICAgIC8vIGRlZmluaXRpb25zXyB0byBhY3R1YWwgZnVuY3Rpb24gbmFtZXMgKHRvIGF2b2lkIGNvbGxpc2lvbnMgd2l0aFxuICAgIC8vIHVzZXItZGVmaW5lZCBwcm9jZWR1cmVzKS5cbiAgICB0aGlzLmZ1bmN0aW9uTmFtZXNfID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21tb24gdGFza3MgZm9yIGdlbmVyYXRpbmcgY29kZSBmcm9tIGJsb2Nrcy4gIFRoaXMgaXMgY2FsbGVkIGZyb21cbiAgICogYmxvY2tUb0NvZGUgYW5kIGlzIGNhbGxlZCBvbiBldmVyeSBibG9jaywgbm90IGp1c3QgdG9wIGxldmVsIGJsb2Nrcy5cbiAgICogU3ViY2xhc3NlcyBtYXkgb3ZlcnJpZGUgdGhpcywgZS5nLiB0byBnZW5lcmF0ZSBjb2RlIGZvciBzdGF0ZW1lbnRzXG4gICAqIGZvbGxvd2luZyB0aGUgYmxvY2ssIG9yIHRvIGhhbmRsZSBjb21tZW50cyBmb3IgdGhlIHNwZWNpZmllZCBibG9jayBhbmQgYW55XG4gICAqIGNvbm5lY3RlZCB2YWx1ZSBibG9ja3MuXG4gICAqXG4gICAqIEBwYXJhbSBfYmxvY2sgVGhlIGN1cnJlbnQgYmxvY2suXG4gICAqIEBwYXJhbSBjb2RlIFRoZSBjb2RlIGNyZWF0ZWQgZm9yIHRoaXMgYmxvY2suXG4gICAqIEBwYXJhbSBfb3B0X3RoaXNPbmx5IFRydWUgdG8gZ2VuZXJhdGUgY29kZSBmb3Igb25seSB0aGlzIHN0YXRlbWVudC5cbiAgICogQHJldHVybnMgQ29kZSB3aXRoIGNvbW1lbnRzIGFuZCBzdWJzZXF1ZW50IGJsb2NrcyBhZGRlZC5cbiAgICovXG4gIHByb3RlY3RlZCBzY3J1Yl8oX2Jsb2NrOiBCbG9jaywgY29kZTogc3RyaW5nLCBfb3B0X3RoaXNPbmx5PzogYm9vbGVhbik6XG4gICAgICBzdHJpbmcge1xuICAgIC8vIE9wdGlvbmFsbHkgb3ZlcnJpZGVcbiAgICByZXR1cm4gY29kZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIb29rIGZvciBjb2RlIHRvIHJ1biBhdCBlbmQgb2YgY29kZSBnZW5lcmF0aW9uLlxuICAgKiBTdWJjbGFzc2VzIG1heSBvdmVycmlkZSB0aGlzLCBlLmcuIHRvIHByZXBlbmQgdGhlIGdlbmVyYXRlZCBjb2RlIHdpdGhcbiAgICogaW1wb3J0IHN0YXRlbWVudHMgb3IgdmFyaWFibGUgZGVmaW5pdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSBjb2RlIEdlbmVyYXRlZCBjb2RlLlxuICAgKiBAcmV0dXJucyBDb21wbGV0ZWQgY29kZS5cbiAgICovXG4gIGZpbmlzaChjb2RlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIE9wdGlvbmFsbHkgb3ZlcnJpZGVcbiAgICAvLyBDbGVhbiB1cCB0ZW1wb3JhcnkgZGF0YS5cbiAgICB0aGlzLmRlZmluaXRpb25zXyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5mdW5jdGlvbk5hbWVzXyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgcmV0dXJuIGNvZGU7XG4gIH1cblxuICAvKipcbiAgICogTmFrZWQgdmFsdWVzIGFyZSB0b3AtbGV2ZWwgYmxvY2tzIHdpdGggb3V0cHV0cyB0aGF0IGFyZW4ndCBwbHVnZ2VkIGludG9cbiAgICogYW55dGhpbmcuXG4gICAqIFN1YmNsYXNzZXMgbWF5IG92ZXJyaWRlIHRoaXMsIGUuZy4gaWYgdGhlaXIgbGFuZ3VhZ2UgZG9lcyBub3QgYWxsb3dcbiAgICogbmFrZWQgdmFsdWVzLlxuICAgKlxuICAgKiBAcGFyYW0gbGluZSBMaW5lIG9mIGdlbmVyYXRlZCBjb2RlLlxuICAgKiBAcmV0dXJucyBMZWdhbCBsaW5lIG9mIGNvZGUuXG4gICAqL1xuICBzY3J1Yk5ha2VkVmFsdWUobGluZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBPcHRpb25hbGx5IG92ZXJyaWRlXG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cbn1cblxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoQ29kZUdlbmVyYXRvci5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIEEgZGF0YWJhc2Ugb2YgdmFyaWFibGUgbmFtZXMuXG4gICAqXG4gICAqIEBuYW1lIEJsb2NrbHkuQ29kZUdlbmVyYXRvci5wcm90b3R5cGUudmFyaWFibGVEQl9cbiAgICogQGRlcHJlY2F0ZWQgJ3ZhcmlhYmxlREJfJyB3YXMgcmVuYW1lZCB0byAnbmFtZURCXycgKE1heSAyMDIxKS5cbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgdmFyaWFibGVEQl86ICh7XG4gICAgLyoqIEByZXR1cm5zIE5hbWUgZGF0YWJhc2UuICovXG4gICAgZ2V0KHRoaXM6IENvZGVHZW5lcmF0b3IpOiBOYW1lcyB8XG4gICAgICAgIHVuZGVmaW5lZCB7XG4gICAgICAgICAgZGVwcmVjYXRpb24ud2FybigndmFyaWFibGVEQl8nLCAndmVyc2lvbiA5JywgJ3ZlcnNpb24gMTAnLCAnbmFtZURCXycpO1xuICAgICAgICAgIHJldHVybiB0aGlzLm5hbWVEQl87XG4gICAgICAgIH0sXG4gICAgLyoqIEBwYXJhbSBuYW1lRGIgTmV3IG5hbWUgZGF0YWJhc2UuICovXG4gICAgc2V0KHRoaXM6IENvZGVHZW5lcmF0b3IsIG5hbWVEYjogTmFtZXN8dW5kZWZpbmVkKSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKCd2YXJpYWJsZURCXycsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcsICduYW1lREJfJyk7XG4gICAgICB0aGlzLm5hbWVEQl8gPSBuYW1lRGI7XG4gICAgfSxcbiAgfSksXG59KTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBidXR0b24gaW4gdGhlIGZseW91dC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GbHlvdXRCdXR0b24nKTtcblxuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCAqIGFzIENzcyBmcm9tICcuL2Nzcy5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0ICogYXMgcGFyc2luZyBmcm9tICcuL3V0aWxzL3BhcnNpbmcuanMnO1xuaW1wb3J0ICogYXMgc3R5bGUgZnJvbSAnLi91dGlscy9zdHlsZS5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuaW1wb3J0IHR5cGUgKiBhcyB0b29sYm94IGZyb20gJy4vdXRpbHMvdG9vbGJveC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgYnV0dG9uIG9yIGxhYmVsIGluIHRoZSBmbHlvdXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmx5b3V0QnV0dG9uXG4gKi9cbmV4cG9ydCBjbGFzcyBGbHlvdXRCdXR0b24ge1xuICAvKiogVGhlIGhvcml6b250YWwgbWFyZ2luIGFyb3VuZCB0aGUgdGV4dCBpbiB0aGUgYnV0dG9uLiAqL1xuICBzdGF0aWMgVEVYVF9NQVJHSU5fWCA9IDU7XG5cbiAgLyoqIFRoZSB2ZXJ0aWNhbCBtYXJnaW4gYXJvdW5kIHRoZSB0ZXh0IGluIHRoZSBidXR0b24uICovXG4gIHN0YXRpYyBURVhUX01BUkdJTl9ZID0gMjtcbiAgcHJpdmF0ZSByZWFkb25seSB0ZXh0Xzogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IHBvc2l0aW9uXzogQ29vcmRpbmF0ZTtcbiAgcHJpdmF0ZSByZWFkb25seSBjYWxsYmFja0tleV86IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBjc3NDbGFzc186IHN0cmluZ3xudWxsO1xuXG4gIC8qKiBNb3VzZSB1cCBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIG9uTW91c2VVcFdyYXBwZXJfOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG4gIGluZm86IHRvb2xib3guQnV0dG9uT3JMYWJlbEluZm87XG5cbiAgLyoqIFRoZSB3aWR0aCBvZiB0aGUgYnV0dG9uJ3MgcmVjdC4gKi9cbiAgd2lkdGggPSAwO1xuXG4gIC8qKiBUaGUgaGVpZ2h0IG9mIHRoZSBidXR0b24ncyByZWN0LiAqL1xuICBoZWlnaHQgPSAwO1xuXG4gIC8qKiBUaGUgcm9vdCBTVkcgZ3JvdXAgZm9yIHRoZSBidXR0b24gb3IgbGFiZWwuICovXG4gIHByaXZhdGUgc3ZnR3JvdXBfOiBTVkdHRWxlbWVudHxudWxsID0gbnVsbDtcblxuICAvKiogVGhlIFNWRyBlbGVtZW50IHdpdGggdGhlIHRleHQgb2YgdGhlIGxhYmVsIG9yIGJ1dHRvbi4gKi9cbiAgcHJpdmF0ZSBzdmdUZXh0XzogU1ZHVGV4dEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSBpbiB3aGljaCB0byBwbGFjZSB0aGlzIGJ1dHRvbi5cbiAgICogQHBhcmFtIHRhcmdldFdvcmtzcGFjZSBUaGUgZmx5b3V0J3MgdGFyZ2V0IHdvcmtzcGFjZS5cbiAgICogQHBhcmFtIGpzb24gVGhlIEpTT04gc3BlY2lmeWluZyB0aGUgbGFiZWwvYnV0dG9uLlxuICAgKiBAcGFyYW0gaXNMYWJlbF8gV2hldGhlciB0aGlzIGJ1dHRvbiBzaG91bGQgYmUgc3R5bGVkIGFzIGEgbGFiZWwuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBwcml2YXRlIHJlYWRvbmx5IHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnLFxuICAgICAgcHJpdmF0ZSByZWFkb25seSB0YXJnZXRXb3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZyxcbiAgICAgIGpzb246IHRvb2xib3guQnV0dG9uT3JMYWJlbEluZm8sIHByaXZhdGUgcmVhZG9ubHkgaXNMYWJlbF86IGJvb2xlYW4pIHtcbiAgICB0aGlzLnRleHRfID0ganNvblsndGV4dCddO1xuXG4gICAgdGhpcy5wb3NpdGlvbl8gPSBuZXcgQ29vcmRpbmF0ZSgwLCAwKTtcblxuICAgIC8qKiBUaGUga2V5IHRvIHRoZSBmdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGlzIGJ1dHRvbiBpcyBjbGlja2VkLiAqL1xuICAgIHRoaXMuY2FsbGJhY2tLZXlfID1cbiAgICAgICAgKGpzb24gYXNcbiAgICAgICAgIEFueUR1cmluZ01pZ3JhdGlvbilbJ2NhbGxiYWNrS2V5J10gfHwgLyogQ2hlY2sgdGhlIGxvd2VyIGNhc2UgdmVyc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vIHRvIHNhdGlzZnkgSUUgKi9cbiAgICAgICAgKGpzb24gYXMgQW55RHVyaW5nTWlncmF0aW9uKVsnY2FsbGJhY2trZXknXTtcblxuICAgIC8qKiBJZiBzcGVjaWZpZWQsIGEgQ1NTIGNsYXNzIHRvIGFkZCB0byB0aGlzIGJ1dHRvbi4gKi9cbiAgICB0aGlzLmNzc0NsYXNzXyA9IChqc29uIGFzIEFueUR1cmluZ01pZ3JhdGlvbilbJ3dlYi1jbGFzcyddIHx8IG51bGw7XG5cbiAgICAvKiogVGhlIEpTT04gc3BlY2lmeWluZyB0aGUgbGFiZWwgLyBidXR0b24uICovXG4gICAgdGhpcy5pbmZvID0ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIGJ1dHRvbiBlbGVtZW50cy5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGJ1dHRvbidzIFNWRyBncm91cC5cbiAgICovXG4gIGNyZWF0ZURvbSgpOiBTVkdFbGVtZW50IHtcbiAgICBsZXQgY3NzQ2xhc3MgPSB0aGlzLmlzTGFiZWxfID8gJ2Jsb2NrbHlGbHlvdXRMYWJlbCcgOiAnYmxvY2tseUZseW91dEJ1dHRvbic7XG4gICAgaWYgKHRoaXMuY3NzQ2xhc3NfKSB7XG4gICAgICBjc3NDbGFzcyArPSAnICcgKyB0aGlzLmNzc0NsYXNzXztcbiAgICB9XG5cbiAgICB0aGlzLnN2Z0dyb3VwXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRywgeydjbGFzcyc6IGNzc0NsYXNzfSwgdGhpcy53b3Jrc3BhY2UuZ2V0Q2FudmFzKCkpO1xuXG4gICAgbGV0IHNoYWRvdztcbiAgICBpZiAoIXRoaXMuaXNMYWJlbF8pIHtcbiAgICAgIC8vIFNoYWRvdyByZWN0YW5nbGUgKGxpZ2h0IHNvdXJjZSBkb2VzIG5vdCBtaXJyb3IgaW4gUlRMKS5cbiAgICAgIHNoYWRvdyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5SRUNULCB7XG4gICAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseUZseW91dEJ1dHRvblNoYWRvdycsXG4gICAgICAgICAgICAncngnOiA0LFxuICAgICAgICAgICAgJ3J5JzogNCxcbiAgICAgICAgICAgICd4JzogMSxcbiAgICAgICAgICAgICd5JzogMSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMuc3ZnR3JvdXBfISk7XG4gICAgfVxuICAgIC8vIEJhY2tncm91bmQgcmVjdGFuZ2xlLlxuICAgIGNvbnN0IHJlY3QgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlJFQ1QsIHtcbiAgICAgICAgICAnY2xhc3MnOiB0aGlzLmlzTGFiZWxfID8gJ2Jsb2NrbHlGbHlvdXRMYWJlbEJhY2tncm91bmQnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Jsb2NrbHlGbHlvdXRCdXR0b25CYWNrZ3JvdW5kJyxcbiAgICAgICAgICAncngnOiA0LFxuICAgICAgICAgICdyeSc6IDQsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuc3ZnR3JvdXBfISk7XG5cbiAgICBjb25zdCBzdmdUZXh0ID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIFN2Zy5URVhULCB7XG4gICAgICAgICAgJ2NsYXNzJzogdGhpcy5pc0xhYmVsXyA/ICdibG9ja2x5Rmx5b3V0TGFiZWxUZXh0JyA6ICdibG9ja2x5VGV4dCcsXG4gICAgICAgICAgJ3gnOiAwLFxuICAgICAgICAgICd5JzogMCxcbiAgICAgICAgICAndGV4dC1hbmNob3InOiAnbWlkZGxlJyxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5zdmdHcm91cF8hKTtcbiAgICBsZXQgdGV4dCA9IHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKHRoaXMudGV4dF8pO1xuICAgIGlmICh0aGlzLndvcmtzcGFjZS5SVEwpIHtcbiAgICAgIC8vIEZvcmNlIHRleHQgdG8gYmUgUlRMIGJ5IGFkZGluZyBhbiBSTE0uXG4gICAgICB0ZXh0ICs9ICdcXHUyMDBGJztcbiAgICB9XG4gICAgc3ZnVGV4dC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgaWYgKHRoaXMuaXNMYWJlbF8pIHtcbiAgICAgIHRoaXMuc3ZnVGV4dF8gPSBzdmdUZXh0O1xuICAgICAgdGhpcy53b3Jrc3BhY2UuZ2V0VGhlbWVNYW5hZ2VyKCkuc3Vic2NyaWJlKFxuICAgICAgICAgIHRoaXMuc3ZnVGV4dF8sICdmbHlvdXRGb3JlZ3JvdW5kQ29sb3VyJywgJ2ZpbGwnKTtcbiAgICB9XG5cbiAgICBjb25zdCBmb250U2l6ZSA9IHN0eWxlLmdldENvbXB1dGVkU3R5bGUoc3ZnVGV4dCwgJ2ZvbnRTaXplJyk7XG4gICAgY29uc3QgZm9udFdlaWdodCA9IHN0eWxlLmdldENvbXB1dGVkU3R5bGUoc3ZnVGV4dCwgJ2ZvbnRXZWlnaHQnKTtcbiAgICBjb25zdCBmb250RmFtaWx5ID0gc3R5bGUuZ2V0Q29tcHV0ZWRTdHlsZShzdmdUZXh0LCAnZm9udEZhbWlseScpO1xuICAgIHRoaXMud2lkdGggPSBkb20uZ2V0RmFzdFRleHRXaWR0aFdpdGhTaXplU3RyaW5nKFxuICAgICAgICBzdmdUZXh0LCBmb250U2l6ZSwgZm9udFdlaWdodCwgZm9udEZhbWlseSk7XG4gICAgY29uc3QgZm9udE1ldHJpY3MgPVxuICAgICAgICBkb20ubWVhc3VyZUZvbnRNZXRyaWNzKHRleHQsIGZvbnRTaXplLCBmb250V2VpZ2h0LCBmb250RmFtaWx5KTtcbiAgICB0aGlzLmhlaWdodCA9IGZvbnRNZXRyaWNzLmhlaWdodDtcblxuICAgIGlmICghdGhpcy5pc0xhYmVsXykge1xuICAgICAgdGhpcy53aWR0aCArPSAyICogRmx5b3V0QnV0dG9uLlRFWFRfTUFSR0lOX1g7XG4gICAgICB0aGlzLmhlaWdodCArPSAyICogRmx5b3V0QnV0dG9uLlRFWFRfTUFSR0lOX1k7XG4gICAgICBzaGFkb3c/LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB0aGlzLndpZHRoLnRvU3RyaW5nKCkpO1xuICAgICAgc2hhZG93Py5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIHRoaXMuaGVpZ2h0LnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICByZWN0LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB0aGlzLndpZHRoLnRvU3RyaW5nKCkpO1xuICAgIHJlY3Quc2V0QXR0cmlidXRlKCdoZWlnaHQnLCB0aGlzLmhlaWdodC50b1N0cmluZygpKTtcblxuICAgIHN2Z1RleHQuc2V0QXR0cmlidXRlKCd4JywgKHRoaXMud2lkdGggLyAyKS50b1N0cmluZygpKTtcbiAgICBzdmdUZXh0LnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3knLFxuICAgICAgICAodGhpcy5oZWlnaHQgLyAyIC0gZm9udE1ldHJpY3MuaGVpZ2h0IC8gMiArIGZvbnRNZXRyaWNzLmJhc2VsaW5lKVxuICAgICAgICAgICAgLnRvU3RyaW5nKCkpO1xuXG4gICAgdGhpcy51cGRhdGVUcmFuc2Zvcm1fKCk7XG5cbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ1NWR0dFbGVtZW50IHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnRXZlbnRUYXJnZXQnLlxuICAgIHRoaXMub25Nb3VzZVVwV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGhpcy5zdmdHcm91cF8gYXMgQW55RHVyaW5nTWlncmF0aW9uLCAncG9pbnRlcnVwJywgdGhpcyxcbiAgICAgICAgdGhpcy5vbk1vdXNlVXBfKTtcbiAgICByZXR1cm4gdGhpcy5zdmdHcm91cF8hO1xuICB9XG5cbiAgLyoqIENvcnJlY3RseSBwb3NpdGlvbiB0aGUgZmx5b3V0IGJ1dHRvbiBhbmQgbWFrZSBpdCB2aXNpYmxlLiAqL1xuICBzaG93KCkge1xuICAgIHRoaXMudXBkYXRlVHJhbnNmb3JtXygpO1xuICAgIHRoaXMuc3ZnR3JvdXBfIS5zZXRBdHRyaWJ1dGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgfVxuXG4gIC8qKiBVcGRhdGUgU1ZHIGF0dHJpYnV0ZXMgdG8gbWF0Y2ggaW50ZXJuYWwgc3RhdGUuICovXG4gIHByaXZhdGUgdXBkYXRlVHJhbnNmb3JtXygpIHtcbiAgICB0aGlzLnN2Z0dyb3VwXyEuc2V0QXR0cmlidXRlKFxuICAgICAgICAndHJhbnNmb3JtJyxcbiAgICAgICAgJ3RyYW5zbGF0ZSgnICsgdGhpcy5wb3NpdGlvbl8ueCArICcsJyArIHRoaXMucG9zaXRpb25fLnkgKyAnKScpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgdGhlIGJ1dHRvbiB0byB0aGUgZ2l2ZW4geCwgeSBjb29yZGluYXRlcy5cbiAgICpcbiAgICogQHBhcmFtIHggVGhlIG5ldyB4IGNvb3JkaW5hdGUuXG4gICAqIEBwYXJhbSB5IFRoZSBuZXcgeSBjb29yZGluYXRlLlxuICAgKi9cbiAgbW92ZVRvKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5wb3NpdGlvbl8ueCA9IHg7XG4gICAgdGhpcy5wb3NpdGlvbl8ueSA9IHk7XG4gICAgdGhpcy51cGRhdGVUcmFuc2Zvcm1fKCk7XG4gIH1cblxuICAvKiogQHJldHVybnMgV2hldGhlciBvciBub3QgdGhlIGJ1dHRvbiBpcyBhIGxhYmVsLiAqL1xuICBpc0xhYmVsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzTGFiZWxfO1xuICB9XG5cbiAgLyoqXG4gICAqIExvY2F0aW9uIG9mIHRoZSBidXR0b24uXG4gICAqXG4gICAqIEByZXR1cm5zIHgsIHkgY29vcmRpbmF0ZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0UG9zaXRpb24oKTogQ29vcmRpbmF0ZSB7XG4gICAgcmV0dXJuIHRoaXMucG9zaXRpb25fO1xuICB9XG5cbiAgLyoqIEByZXR1cm5zIFRleHQgb2YgdGhlIGJ1dHRvbi4gKi9cbiAgZ2V0QnV0dG9uVGV4dCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnRleHRfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYnV0dG9uJ3MgdGFyZ2V0IHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIHRhcmdldCB3b3Jrc3BhY2Ugb2YgdGhlIGZseW91dCB3aGVyZSB0aGlzIGJ1dHRvbiByZXNpZGVzLlxuICAgKi9cbiAgZ2V0VGFyZ2V0V29ya3NwYWNlKCk6IFdvcmtzcGFjZVN2ZyB7XG4gICAgcmV0dXJuIHRoaXMudGFyZ2V0V29ya3NwYWNlO1xuICB9XG5cbiAgLyoqIERpc3Bvc2Ugb2YgdGhpcyBidXR0b24uICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgaWYgKHRoaXMub25Nb3VzZVVwV3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25Nb3VzZVVwV3JhcHBlcl8pO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdmdHcm91cF8pIHtcbiAgICAgIGRvbS5yZW1vdmVOb2RlKHRoaXMuc3ZnR3JvdXBfKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc3ZnVGV4dF8pIHtcbiAgICAgIHRoaXMud29ya3NwYWNlLmdldFRoZW1lTWFuYWdlcigpLnVuc3Vic2NyaWJlKHRoaXMuc3ZnVGV4dF8pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEbyBzb21ldGhpbmcgd2hlbiB0aGUgYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgdXAgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIG9uTW91c2VVcF8oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3QgZ2VzdHVyZSA9IHRoaXMudGFyZ2V0V29ya3NwYWNlLmdldEdlc3R1cmUoZSk7XG4gICAgaWYgKGdlc3R1cmUpIHtcbiAgICAgIGdlc3R1cmUuY2FuY2VsKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNMYWJlbF8gJiYgdGhpcy5jYWxsYmFja0tleV8pIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnTGFiZWxzIHNob3VsZCBub3QgaGF2ZSBjYWxsYmFja3MuIExhYmVsIHRleHQ6ICcgKyB0aGlzLnRleHRfKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICAhdGhpcy5pc0xhYmVsXyAmJlxuICAgICAgICAhKHRoaXMuY2FsbGJhY2tLZXlfICYmXG4gICAgICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UuZ2V0QnV0dG9uQ2FsbGJhY2sodGhpcy5jYWxsYmFja0tleV8pKSkge1xuICAgICAgY29uc29sZS53YXJuKCdCdXR0b25zIHNob3VsZCBoYXZlIGNhbGxiYWNrcy4gQnV0dG9uIHRleHQ6ICcgKyB0aGlzLnRleHRfKTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmlzTGFiZWxfKSB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9XG4gICAgICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UuZ2V0QnV0dG9uQ2FsbGJhY2sodGhpcy5jYWxsYmFja0tleV8pO1xuICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrKHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKiogQ1NTIGZvciBidXR0b25zIGFuZCBsYWJlbHMuIFNlZSBjc3MuanMgZm9yIHVzZS4gKi9cbkNzcy5yZWdpc3RlcihgXG4uYmxvY2tseUZseW91dEJ1dHRvbiB7XG4gIGZpbGw6ICM4ODg7XG4gIGN1cnNvcjogZGVmYXVsdDtcbn1cblxuLmJsb2NrbHlGbHlvdXRCdXR0b25TaGFkb3cge1xuICBmaWxsOiAjNjY2O1xufVxuXG4uYmxvY2tseUZseW91dEJ1dHRvbjpob3ZlciB7XG4gIGZpbGw6ICNhYWE7XG59XG5cbi5ibG9ja2x5Rmx5b3V0TGFiZWwge1xuICBjdXJzb3I6IGRlZmF1bHQ7XG59XG5cbi5ibG9ja2x5Rmx5b3V0TGFiZWxCYWNrZ3JvdW5kIHtcbiAgb3BhY2l0eTogMDtcbn1cbmApO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgYW5kIHJlcG9ydHMgd29ya3NwYWNlIG1ldHJpY3MuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuTWV0cmljc01hbmFnZXInKTtcblxuaW1wb3J0IHR5cGUge0lGbHlvdXR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2ZseW91dC5qcyc7XG5pbXBvcnQgdHlwZSB7SU1ldHJpY3NNYW5hZ2VyfSBmcm9tICcuL2ludGVyZmFjZXMvaV9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge0lUb29sYm94fSBmcm9tICcuL2ludGVyZmFjZXMvaV90b29sYm94LmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge01ldHJpY3N9IGZyb20gJy4vdXRpbHMvbWV0cmljcy5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vdXRpbHMvc2l6ZS5qcyc7XG5pbXBvcnQgKiBhcyB0b29sYm94VXRpbHMgZnJvbSAnLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VTdmd9IGZyb20gJy4vd29ya3NwYWNlX3N2Zy5qcyc7XG5cblxuLyoqXG4gKiBUaGUgbWFuYWdlciBmb3IgYWxsIHdvcmtzcGFjZSBtZXRyaWNzIGNhbGN1bGF0aW9ucy5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5NZXRyaWNzTWFuYWdlclxuICovXG5leHBvcnQgY2xhc3MgTWV0cmljc01hbmFnZXIgaW1wbGVtZW50cyBJTWV0cmljc01hbmFnZXIge1xuICAvKiogVGhlIHdvcmtzcGFjZSB0byBjYWxjdWxhdGUgbWV0cmljcyBmb3IuICovXG4gIHByb3RlY3RlZCByZWFkb25seSB3b3Jrc3BhY2VfOiBXb3Jrc3BhY2VTdmc7XG5cbiAgLyoqIEBwYXJhbSB3b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0byBjYWxjdWxhdGUgbWV0cmljcyBmb3IuICovXG4gIGNvbnN0cnVjdG9yKHdvcmtzcGFjZTogV29ya3NwYWNlU3ZnKSB7XG4gICAgdGhpcy53b3Jrc3BhY2VfID0gd29ya3NwYWNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIGdpdmVuIHdvcmtzcGFjZSBjb21wb25lbnQsIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byBnZXQgdGhlIGRpbWVuc2lvbnMgb2YsIG9yIG51bGwuICBJdCBzaG91bGQgYmUgYVxuICAgKiAgICAgdG9vbGJveCBvciBmbHlvdXQsIGFuZCBzaG91bGQgaW1wbGVtZW50IGdldFdpZHRoKCkgYW5kIGdldEhlaWdodCgpLlxuICAgKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyB3aWR0aCBhbmQgaGVpZ2h0IGF0dHJpYnV0ZXMsIHdoaWNoIHdpbGwgYm90aFxuICAgKiAgICAgYmUgemVybyBpZiBlbGVtIGRpZCBub3QgZXhpc3QuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0RGltZW5zaW9uc1B4XyhlbGVtOiBJVG9vbGJveHxudWxsfElGbHlvdXQpOiBTaXplIHtcbiAgICBsZXQgd2lkdGggPSAwO1xuICAgIGxldCBoZWlnaHQgPSAwO1xuICAgIGlmIChlbGVtKSB7XG4gICAgICB3aWR0aCA9IGVsZW0uZ2V0V2lkdGgoKTtcbiAgICAgIGhlaWdodCA9IGVsZW0uZ2V0SGVpZ2h0KCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgU2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB3aWR0aCBhbmQgdGhlIGhlaWdodCBvZiB0aGUgZmx5b3V0IG9uIHRoZSB3b3Jrc3BhY2UgaW4gcGl4ZWxcbiAgICogY29vcmRpbmF0ZXMuIFJldHVybnMgMCBmb3IgdGhlIHdpZHRoIGFuZCBoZWlnaHQgaWYgdGhlIHdvcmtzcGFjZSBoYXMgYVxuICAgKiBjYXRlZ29yeSB0b29sYm94IGluc3RlYWQgb2YgYSBzaW1wbGUgdG9vbGJveC5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9vd24gV2hldGhlciB0byBvbmx5IHJldHVybiB0aGUgd29ya3NwYWNlJ3Mgb3duIGZseW91dC5cbiAgICogQHJldHVybnMgVGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIGZseW91dC5cbiAgICovXG4gIGdldEZseW91dE1ldHJpY3Mob3B0X293bj86IGJvb2xlYW4pOiBUb29sYm94TWV0cmljcyB7XG4gICAgY29uc3QgZmx5b3V0RGltZW5zaW9ucyA9XG4gICAgICAgIHRoaXMuZ2V0RGltZW5zaW9uc1B4Xyh0aGlzLndvcmtzcGFjZV8uZ2V0Rmx5b3V0KG9wdF9vd24pKTtcbiAgICByZXR1cm4ge1xuICAgICAgd2lkdGg6IGZseW91dERpbWVuc2lvbnMud2lkdGgsXG4gICAgICBoZWlnaHQ6IGZseW91dERpbWVuc2lvbnMuaGVpZ2h0LFxuICAgICAgcG9zaXRpb246IHRoaXMud29ya3NwYWNlXy50b29sYm94UG9zaXRpb24sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB3aWR0aCwgaGVpZ2h0IGFuZCBwb3NpdGlvbiBvZiB0aGUgdG9vbGJveCBvbiB0aGUgd29ya3NwYWNlIGluXG4gICAqIHBpeGVsIGNvb3JkaW5hdGVzLiBSZXR1cm5zIDAgZm9yIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IGlmIHRoZSB3b3Jrc3BhY2UgaGFzXG4gICAqIGEgc2ltcGxlIHRvb2xib3ggaW5zdGVhZCBvZiBhIGNhdGVnb3J5IHRvb2xib3guIFRvIGdldCB0aGUgd2lkdGggYW5kIGhlaWdodFxuICAgKiBvZiBhXG4gICAqIHNpbXBsZSB0b29sYm94IEBzZWUge0BsaW5rIE1ldHJpY3NNYW5hZ2VyI2dldEZseW91dE1ldHJpY3N9LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IHdpdGggdGhlIHdpZHRoLCBoZWlnaHQgYW5kIHBvc2l0aW9uIG9mIHRoZSB0b29sYm94LlxuICAgKi9cbiAgZ2V0VG9vbGJveE1ldHJpY3MoKTogVG9vbGJveE1ldHJpY3Mge1xuICAgIGNvbnN0IHRvb2xib3hEaW1lbnNpb25zID1cbiAgICAgICAgdGhpcy5nZXREaW1lbnNpb25zUHhfKHRoaXMud29ya3NwYWNlXy5nZXRUb29sYm94KCkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiB0b29sYm94RGltZW5zaW9ucy53aWR0aCxcbiAgICAgIGhlaWdodDogdG9vbGJveERpbWVuc2lvbnMuaGVpZ2h0LFxuICAgICAgcG9zaXRpb246IHRoaXMud29ya3NwYWNlXy50b29sYm94UG9zaXRpb24sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSB3b3Jrc3BhY2UncyBwYXJlbnQgU1ZHIGVsZW1lbnQgaW4gcGl4ZWxcbiAgICogY29vcmRpbmF0ZXMuIFRoaXMgYXJlYSBpbmNsdWRlcyB0aGUgdG9vbGJveCBhbmQgdGhlIHZpc2libGUgd29ya3NwYWNlIGFyZWEuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSB3b3Jrc3BhY2UncyBwYXJlbnQgU1ZHIGVsZW1lbnQuXG4gICAqL1xuICBnZXRTdmdNZXRyaWNzKCk6IFNpemUge1xuICAgIHJldHVybiB0aGlzLndvcmtzcGFjZV8uZ2V0Q2FjaGVkUGFyZW50U3ZnU2l6ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGFic29sdXRlIGxlZnQgYW5kIGFic29sdXRlIHRvcCBpbiBwaXhlbCBjb29yZGluYXRlcy5cbiAgICogVGhpcyBpcyB3aGVyZSB0aGUgdmlzaWJsZSB3b3Jrc3BhY2Ugc3RhcnRzIGluIHJlbGF0aW9uIHRvIHRoZSBTVkdcbiAgICogY29udGFpbmVyLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgYWJzb2x1dGUgbWV0cmljcyBmb3IgdGhlIHdvcmtzcGFjZS5cbiAgICovXG4gIGdldEFic29sdXRlTWV0cmljcygpOiBBYnNvbHV0ZU1ldHJpY3Mge1xuICAgIGxldCBhYnNvbHV0ZUxlZnQgPSAwO1xuICAgIGNvbnN0IHRvb2xib3hNZXRyaWNzID0gdGhpcy5nZXRUb29sYm94TWV0cmljcygpO1xuICAgIGNvbnN0IGZseW91dE1ldHJpY3MgPSB0aGlzLmdldEZseW91dE1ldHJpY3ModHJ1ZSk7XG4gICAgY29uc3QgZG9lc1Rvb2xib3hFeGlzdCA9ICEhdGhpcy53b3Jrc3BhY2VfLmdldFRvb2xib3goKTtcbiAgICBjb25zdCBkb2VzRmx5b3V0RXhpc3QgPSAhIXRoaXMud29ya3NwYWNlXy5nZXRGbHlvdXQodHJ1ZSk7XG4gICAgY29uc3QgdG9vbGJveFBvc2l0aW9uID1cbiAgICAgICAgZG9lc1Rvb2xib3hFeGlzdCA/IHRvb2xib3hNZXRyaWNzLnBvc2l0aW9uIDogZmx5b3V0TWV0cmljcy5wb3NpdGlvbjtcblxuICAgIGNvbnN0IGF0TGVmdCA9IHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLkxFRlQ7XG4gICAgY29uc3QgYXRUb3AgPSB0b29sYm94UG9zaXRpb24gPT09IHRvb2xib3hVdGlscy5Qb3NpdGlvbi5UT1A7XG4gICAgaWYgKGRvZXNUb29sYm94RXhpc3QgJiYgYXRMZWZ0KSB7XG4gICAgICBhYnNvbHV0ZUxlZnQgPSB0b29sYm94TWV0cmljcy53aWR0aDtcbiAgICB9IGVsc2UgaWYgKGRvZXNGbHlvdXRFeGlzdCAmJiBhdExlZnQpIHtcbiAgICAgIGFic29sdXRlTGVmdCA9IGZseW91dE1ldHJpY3Mud2lkdGg7XG4gICAgfVxuICAgIGxldCBhYnNvbHV0ZVRvcCA9IDA7XG4gICAgaWYgKGRvZXNUb29sYm94RXhpc3QgJiYgYXRUb3ApIHtcbiAgICAgIGFic29sdXRlVG9wID0gdG9vbGJveE1ldHJpY3MuaGVpZ2h0O1xuICAgIH0gZWxzZSBpZiAoZG9lc0ZseW91dEV4aXN0ICYmIGF0VG9wKSB7XG4gICAgICBhYnNvbHV0ZVRvcCA9IGZseW91dE1ldHJpY3MuaGVpZ2h0O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IGFic29sdXRlVG9wLFxuICAgICAgbGVmdDogYWJzb2x1dGVMZWZ0LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbWV0cmljcyBmb3IgdGhlIHZpc2libGUgd29ya3NwYWNlIGluIGVpdGhlciBwaXhlbCBvciB3b3Jrc3BhY2VcbiAgICogY29vcmRpbmF0ZXMuIFRoZSB2aXNpYmxlIHdvcmtzcGFjZSBkb2VzIG5vdCBpbmNsdWRlIHRoZSB0b29sYm94IG9yIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9nZXRXb3Jrc3BhY2VDb29yZGluYXRlcyBUcnVlIHRvIGdldCB0aGUgdmlldyBtZXRyaWNzIGluXG4gICAqICAgICB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMsIGZhbHNlIHRvIGdldCB0aGVtIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKiBAcmV0dXJucyBUaGUgd2lkdGgsIGhlaWdodCwgdG9wIGFuZCBsZWZ0IG9mIHRoZSB2aWV3cG9ydCBpbiBlaXRoZXJcbiAgICogICAgIHdvcmtzcGFjZSBjb29yZGluYXRlcyBvciBwaXhlbCBjb29yZGluYXRlcy5cbiAgICovXG4gIGdldFZpZXdNZXRyaWNzKG9wdF9nZXRXb3Jrc3BhY2VDb29yZGluYXRlcz86IGJvb2xlYW4pOiBDb250YWluZXJSZWdpb24ge1xuICAgIGNvbnN0IHNjYWxlID0gb3B0X2dldFdvcmtzcGFjZUNvb3JkaW5hdGVzID8gdGhpcy53b3Jrc3BhY2VfLnNjYWxlIDogMTtcbiAgICBjb25zdCBzdmdNZXRyaWNzID0gdGhpcy5nZXRTdmdNZXRyaWNzKCk7XG4gICAgY29uc3QgdG9vbGJveE1ldHJpY3MgPSB0aGlzLmdldFRvb2xib3hNZXRyaWNzKCk7XG4gICAgY29uc3QgZmx5b3V0TWV0cmljcyA9IHRoaXMuZ2V0Rmx5b3V0TWV0cmljcyh0cnVlKTtcbiAgICBjb25zdCBkb2VzVG9vbGJveEV4aXN0ID0gISF0aGlzLndvcmtzcGFjZV8uZ2V0VG9vbGJveCgpO1xuICAgIGNvbnN0IHRvb2xib3hQb3NpdGlvbiA9XG4gICAgICAgIGRvZXNUb29sYm94RXhpc3QgPyB0b29sYm94TWV0cmljcy5wb3NpdGlvbiA6IGZseW91dE1ldHJpY3MucG9zaXRpb247XG5cbiAgICBpZiAodGhpcy53b3Jrc3BhY2VfLmdldFRvb2xib3goKSkge1xuICAgICAgaWYgKHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLlRPUCB8fFxuICAgICAgICAgIHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLkJPVFRPTSkge1xuICAgICAgICBzdmdNZXRyaWNzLmhlaWdodCAtPSB0b29sYm94TWV0cmljcy5oZWlnaHQ7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLkxFRlQgfHxcbiAgICAgICAgICB0b29sYm94UG9zaXRpb24gPT09IHRvb2xib3hVdGlscy5Qb3NpdGlvbi5SSUdIVCkge1xuICAgICAgICBzdmdNZXRyaWNzLndpZHRoIC09IHRvb2xib3hNZXRyaWNzLndpZHRoO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy53b3Jrc3BhY2VfLmdldEZseW91dCh0cnVlKSkge1xuICAgICAgaWYgKHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLlRPUCB8fFxuICAgICAgICAgIHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLkJPVFRPTSkge1xuICAgICAgICBzdmdNZXRyaWNzLmhlaWdodCAtPSBmbHlvdXRNZXRyaWNzLmhlaWdodDtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgdG9vbGJveFBvc2l0aW9uID09PSB0b29sYm94VXRpbHMuUG9zaXRpb24uTEVGVCB8fFxuICAgICAgICAgIHRvb2xib3hQb3NpdGlvbiA9PT0gdG9vbGJveFV0aWxzLlBvc2l0aW9uLlJJR0hUKSB7XG4gICAgICAgIHN2Z01ldHJpY3Mud2lkdGggLT0gZmx5b3V0TWV0cmljcy53aWR0aDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGhlaWdodDogc3ZnTWV0cmljcy5oZWlnaHQgLyBzY2FsZSxcbiAgICAgIHdpZHRoOiBzdmdNZXRyaWNzLndpZHRoIC8gc2NhbGUsXG4gICAgICB0b3A6IC10aGlzLndvcmtzcGFjZV8uc2Nyb2xsWSAvIHNjYWxlLFxuICAgICAgbGVmdDogLXRoaXMud29ya3NwYWNlXy5zY3JvbGxYIC8gc2NhbGUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNvbnRlbnQgbWV0cmljcyBpbiBlaXRoZXIgcGl4ZWwgb3Igd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgKiBUaGUgY29udGVudCBhcmVhIGlzIGEgcmVjdGFuZ2xlIGFyb3VuZCBhbGwgdGhlIHRvcCBib3VuZGVkIGVsZW1lbnRzIG9uIHRoZVxuICAgKiB3b3Jrc3BhY2UgKHdvcmtzcGFjZSBjb21tZW50cyBhbmQgYmxvY2tzKS5cbiAgICpcbiAgICogQHBhcmFtIG9wdF9nZXRXb3Jrc3BhY2VDb29yZGluYXRlcyBUcnVlIHRvIGdldCB0aGUgY29udGVudCBtZXRyaWNzIGluXG4gICAqICAgICB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMsIGZhbHNlIHRvIGdldCB0aGVtIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKiBAcmV0dXJucyBUaGUgbWV0cmljcyBmb3IgdGhlIGNvbnRlbnQgY29udGFpbmVyLlxuICAgKi9cbiAgZ2V0Q29udGVudE1ldHJpY3Mob3B0X2dldFdvcmtzcGFjZUNvb3JkaW5hdGVzPzogYm9vbGVhbik6IENvbnRhaW5lclJlZ2lvbiB7XG4gICAgY29uc3Qgc2NhbGUgPSBvcHRfZ2V0V29ya3NwYWNlQ29vcmRpbmF0ZXMgPyAxIDogdGhpcy53b3Jrc3BhY2VfLnNjYWxlO1xuICAgIC8vIEJsb2NrIGJvdW5kaW5nIGJveCBpcyBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAgY29uc3QgYmxvY2tCb3ggPSB0aGlzLndvcmtzcGFjZV8uZ2V0QmxvY2tzQm91bmRpbmdCb3goKTtcblxuICAgIHJldHVybiB7XG4gICAgICBoZWlnaHQ6IChibG9ja0JveC5ib3R0b20gLSBibG9ja0JveC50b3ApICogc2NhbGUsXG4gICAgICB3aWR0aDogKGJsb2NrQm94LnJpZ2h0IC0gYmxvY2tCb3gubGVmdCkgKiBzY2FsZSxcbiAgICAgIHRvcDogYmxvY2tCb3gudG9wICogc2NhbGUsXG4gICAgICBsZWZ0OiBibG9ja0JveC5sZWZ0ICogc2NhbGUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHNjcm9sbCBhcmVhIGhhcyBmaXhlZCBlZGdlcy5cbiAgICpcbiAgICogQHJldHVybnMgV2hldGhlciB0aGUgc2Nyb2xsIGFyZWEgaGFzIGZpeGVkIGVkZ2VzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhhc0ZpeGVkRWRnZXMoKTogYm9vbGVhbiB7XG4gICAgLy8gVGhpcyBleGlzdHMgZm9yIG9wdGltaXphdGlvbiBvZiBidW1wIGxvZ2ljLlxuICAgIHJldHVybiAhdGhpcy53b3Jrc3BhY2VfLmlzTW92YWJsZUhvcml6b250YWxseSgpIHx8XG4gICAgICAgICF0aGlzLndvcmtzcGFjZV8uaXNNb3ZhYmxlVmVydGljYWxseSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGVzIHRoZSBmaXhlZCBlZGdlcyBvZiB0aGUgc2Nyb2xsIGFyZWEuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfdmlld01ldHJpY3MgVGhlIHZpZXcgbWV0cmljcyBpZiB0aGV5IGhhdmUgYmVlbiBwcmV2aW91c2x5XG4gICAqICAgICBjb21wdXRlZC4gUGFzc2luZyBpbiBudWxsIG1heSBjYXVzZSB0aGUgdmlldyBtZXRyaWNzIHRvIGJlIGNvbXB1dGVkXG4gICAqICAgICBhZ2FpbiwgaWYgaXQgaXMgbmVlZGVkLlxuICAgKiBAcmV0dXJucyBUaGUgZml4ZWQgZWRnZXMgb2YgdGhlIHNjcm9sbCBhcmVhLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldENvbXB1dGVkRml4ZWRFZGdlc18ob3B0X3ZpZXdNZXRyaWNzPzogQ29udGFpbmVyUmVnaW9uKTpcbiAgICAgIEZpeGVkRWRnZXMge1xuICAgIGlmICghdGhpcy5oYXNGaXhlZEVkZ2VzKCkpIHtcbiAgICAgIC8vIFJldHVybiBlYXJseSBpZiB0aGVyZSBhcmUgbm8gZWRnZXMuXG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgY29uc3QgaFNjcm9sbEVuYWJsZWQgPSB0aGlzLndvcmtzcGFjZV8uaXNNb3ZhYmxlSG9yaXpvbnRhbGx5KCk7XG4gICAgY29uc3QgdlNjcm9sbEVuYWJsZWQgPSB0aGlzLndvcmtzcGFjZV8uaXNNb3ZhYmxlVmVydGljYWxseSgpO1xuXG4gICAgY29uc3Qgdmlld01ldHJpY3MgPSBvcHRfdmlld01ldHJpY3MgfHwgdGhpcy5nZXRWaWV3TWV0cmljcyhmYWxzZSk7XG5cbiAgICBjb25zdCBlZGdlcyA9IHt9IGFzIEZpeGVkRWRnZXM7XG4gICAgaWYgKCF2U2Nyb2xsRW5hYmxlZCkge1xuICAgICAgZWRnZXMudG9wID0gdmlld01ldHJpY3MudG9wO1xuICAgICAgZWRnZXMuYm90dG9tID0gdmlld01ldHJpY3MudG9wICsgdmlld01ldHJpY3MuaGVpZ2h0O1xuICAgIH1cbiAgICBpZiAoIWhTY3JvbGxFbmFibGVkKSB7XG4gICAgICBlZGdlcy5sZWZ0ID0gdmlld01ldHJpY3MubGVmdDtcbiAgICAgIGVkZ2VzLnJpZ2h0ID0gdmlld01ldHJpY3MubGVmdCArIHZpZXdNZXRyaWNzLndpZHRoO1xuICAgIH1cbiAgICByZXR1cm4gZWRnZXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY29udGVudCBhcmVhIHdpdGggYWRkZWQgcGFkZGluZy5cbiAgICpcbiAgICogQHBhcmFtIHZpZXdNZXRyaWNzIFRoZSB2aWV3IG1ldHJpY3MuXG4gICAqIEBwYXJhbSBjb250ZW50TWV0cmljcyBUaGUgY29udGVudCBtZXRyaWNzLlxuICAgKiBAcmV0dXJucyBUaGUgcGFkZGVkIGNvbnRlbnQgYXJlYS5cbiAgICovXG4gIHByb3RlY3RlZCBnZXRQYWRkZWRDb250ZW50XyhcbiAgICAgIHZpZXdNZXRyaWNzOiBDb250YWluZXJSZWdpb24sIGNvbnRlbnRNZXRyaWNzOiBDb250YWluZXJSZWdpb24pOlxuICAgICAge3RvcDogbnVtYmVyLCBib3R0b206IG51bWJlciwgbGVmdDogbnVtYmVyLCByaWdodDogbnVtYmVyfSB7XG4gICAgY29uc3QgY29udGVudEJvdHRvbSA9IGNvbnRlbnRNZXRyaWNzLnRvcCArIGNvbnRlbnRNZXRyaWNzLmhlaWdodDtcbiAgICBjb25zdCBjb250ZW50UmlnaHQgPSBjb250ZW50TWV0cmljcy5sZWZ0ICsgY29udGVudE1ldHJpY3Mud2lkdGg7XG5cbiAgICBjb25zdCB2aWV3V2lkdGggPSB2aWV3TWV0cmljcy53aWR0aDtcbiAgICBjb25zdCB2aWV3SGVpZ2h0ID0gdmlld01ldHJpY3MuaGVpZ2h0O1xuICAgIGNvbnN0IGhhbGZXaWR0aCA9IHZpZXdXaWR0aCAvIDI7XG4gICAgY29uc3QgaGFsZkhlaWdodCA9IHZpZXdIZWlnaHQgLyAyO1xuXG4gICAgLy8gQWRkIGEgcGFkZGluZyBhcm91bmQgdGhlIGNvbnRlbnQgdGhhdCBpcyBhdCBsZWFzdCBoYWxmIGEgc2NyZWVuIHdpZGUuXG4gICAgLy8gRW5zdXJlIHBhZGRpbmcgaXMgd2lkZSBlbm91Z2ggdGhhdCBibG9ja3MgY2FuIHNjcm9sbCBvdmVyIGVudGlyZSBzY3JlZW4uXG4gICAgY29uc3QgdG9wID1cbiAgICAgICAgTWF0aC5taW4oY29udGVudE1ldHJpY3MudG9wIC0gaGFsZkhlaWdodCwgY29udGVudEJvdHRvbSAtIHZpZXdIZWlnaHQpO1xuICAgIGNvbnN0IGxlZnQgPVxuICAgICAgICBNYXRoLm1pbihjb250ZW50TWV0cmljcy5sZWZ0IC0gaGFsZldpZHRoLCBjb250ZW50UmlnaHQgLSB2aWV3V2lkdGgpO1xuICAgIGNvbnN0IGJvdHRvbSA9XG4gICAgICAgIE1hdGgubWF4KGNvbnRlbnRCb3R0b20gKyBoYWxmSGVpZ2h0LCBjb250ZW50TWV0cmljcy50b3AgKyB2aWV3SGVpZ2h0KTtcbiAgICBjb25zdCByaWdodCA9XG4gICAgICAgIE1hdGgubWF4KGNvbnRlbnRSaWdodCArIGhhbGZXaWR0aCwgY29udGVudE1ldHJpY3MubGVmdCArIHZpZXdXaWR0aCk7XG5cbiAgICByZXR1cm4ge3RvcCwgYm90dG9tLCBsZWZ0LCByaWdodH07XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbWV0cmljcyBmb3IgdGhlIHNjcm9sbCBhcmVhIG9mIHRoZSB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfZ2V0V29ya3NwYWNlQ29vcmRpbmF0ZXMgVHJ1ZSB0byBnZXQgdGhlIHNjcm9sbCBtZXRyaWNzIGluXG4gICAqICAgICB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMsIGZhbHNlIHRvIGdldCB0aGVtIGluIHBpeGVsIGNvb3JkaW5hdGVzLlxuICAgKiBAcGFyYW0gb3B0X3ZpZXdNZXRyaWNzIFRoZSB2aWV3IG1ldHJpY3MgaWYgdGhleSBoYXZlIGJlZW4gcHJldmlvdXNseVxuICAgKiAgICAgY29tcHV0ZWQuIFBhc3NpbmcgaW4gbnVsbCBtYXkgY2F1c2UgdGhlIHZpZXcgbWV0cmljcyB0byBiZSBjb21wdXRlZFxuICAgKiAgICAgYWdhaW4sIGlmIGl0IGlzIG5lZWRlZC5cbiAgICogQHBhcmFtIG9wdF9jb250ZW50TWV0cmljcyBUaGUgY29udGVudCBtZXRyaWNzIGlmIHRoZXkgaGF2ZSBiZWVuIHByZXZpb3VzbHlcbiAgICogICAgIGNvbXB1dGVkLiBQYXNzaW5nIGluIG51bGwgbWF5IGNhdXNlIHRoZSBjb250ZW50IG1ldHJpY3MgdG8gYmUgY29tcHV0ZWRcbiAgICogICAgIGFnYWluLCBpZiBpdCBpcyBuZWVkZWQuXG4gICAqIEByZXR1cm5zIFRoZSBtZXRyaWNzIGZvciB0aGUgc2Nyb2xsIGNvbnRhaW5lci5cbiAgICovXG4gIGdldFNjcm9sbE1ldHJpY3MoXG4gICAgICBvcHRfZ2V0V29ya3NwYWNlQ29vcmRpbmF0ZXM/OiBib29sZWFuLCBvcHRfdmlld01ldHJpY3M/OiBDb250YWluZXJSZWdpb24sXG4gICAgICBvcHRfY29udGVudE1ldHJpY3M/OiBDb250YWluZXJSZWdpb24pOiBDb250YWluZXJSZWdpb24ge1xuICAgIGNvbnN0IHNjYWxlID0gb3B0X2dldFdvcmtzcGFjZUNvb3JkaW5hdGVzID8gdGhpcy53b3Jrc3BhY2VfLnNjYWxlIDogMTtcbiAgICBjb25zdCB2aWV3TWV0cmljcyA9IG9wdF92aWV3TWV0cmljcyB8fCB0aGlzLmdldFZpZXdNZXRyaWNzKGZhbHNlKTtcbiAgICBjb25zdCBjb250ZW50TWV0cmljcyA9IG9wdF9jb250ZW50TWV0cmljcyB8fCB0aGlzLmdldENvbnRlbnRNZXRyaWNzKCk7XG4gICAgY29uc3QgZml4ZWRFZGdlcyA9IHRoaXMuZ2V0Q29tcHV0ZWRGaXhlZEVkZ2VzXyh2aWV3TWV0cmljcyk7XG5cbiAgICAvLyBBZGQgcGFkZGluZyBhcm91bmQgY29udGVudC5cbiAgICBjb25zdCBwYWRkZWRDb250ZW50ID0gdGhpcy5nZXRQYWRkZWRDb250ZW50Xyh2aWV3TWV0cmljcywgY29udGVudE1ldHJpY3MpO1xuXG4gICAgLy8gVXNlIGNvbWJpbmF0aW9uIG9mIGZpeGVkIGJvdW5kcyBhbmQgcGFkZGVkIGNvbnRlbnQgdG8gbWFrZSBzY3JvbGwgYXJlYS5cbiAgICBjb25zdCB0b3AgPVxuICAgICAgICBmaXhlZEVkZ2VzLnRvcCAhPT0gdW5kZWZpbmVkID8gZml4ZWRFZGdlcy50b3AgOiBwYWRkZWRDb250ZW50LnRvcDtcbiAgICBjb25zdCBsZWZ0ID1cbiAgICAgICAgZml4ZWRFZGdlcy5sZWZ0ICE9PSB1bmRlZmluZWQgPyBmaXhlZEVkZ2VzLmxlZnQgOiBwYWRkZWRDb250ZW50LmxlZnQ7XG4gICAgY29uc3QgYm90dG9tID0gZml4ZWRFZGdlcy5ib3R0b20gIT09IHVuZGVmaW5lZCA/IGZpeGVkRWRnZXMuYm90dG9tIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGVkQ29udGVudC5ib3R0b207XG4gICAgY29uc3QgcmlnaHQgPVxuICAgICAgICBmaXhlZEVkZ2VzLnJpZ2h0ICE9PSB1bmRlZmluZWQgPyBmaXhlZEVkZ2VzLnJpZ2h0IDogcGFkZGVkQ29udGVudC5yaWdodDtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IHRvcCAvIHNjYWxlLFxuICAgICAgbGVmdDogbGVmdCAvIHNjYWxlLFxuICAgICAgd2lkdGg6IChyaWdodCAtIGxlZnQpIC8gc2NhbGUsXG4gICAgICBoZWlnaHQ6IChib3R0b20gLSB0b3ApIC8gc2NhbGUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGNvbW1vbiBtZXRyaWNzIHVzZWQgYnkgVUkgZWxlbWVudHMuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBVSSBtZXRyaWNzLlxuICAgKi9cbiAgZ2V0VWlNZXRyaWNzKCk6IFVpTWV0cmljcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZpZXdNZXRyaWNzOiB0aGlzLmdldFZpZXdNZXRyaWNzKCksXG4gICAgICBhYnNvbHV0ZU1ldHJpY3M6IHRoaXMuZ2V0QWJzb2x1dGVNZXRyaWNzKCksXG4gICAgICB0b29sYm94TWV0cmljczogdGhpcy5nZXRUb29sYm94TWV0cmljcygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBhbGwgdGhlIG1ldHJpY3MgcmVxdWlyZWQgdG8gc2l6ZSBzY3JvbGxiYXJzIGZvciBhXG4gICAqIHRvcCBsZXZlbCB3b3Jrc3BhY2UuICBUaGUgZm9sbG93aW5nIHByb3BlcnRpZXMgYXJlIGNvbXB1dGVkOlxuICAgKiBDb29yZGluYXRlIHN5c3RlbTogcGl4ZWwgY29vcmRpbmF0ZXMsIC1sZWZ0LCAtdXAsICtyaWdodCwgK2Rvd25cbiAgICogLnZpZXdIZWlnaHQ6IEhlaWdodCBvZiB0aGUgdmlzaWJsZSBwb3J0aW9uIG9mIHRoZSB3b3Jrc3BhY2UuXG4gICAqIC52aWV3V2lkdGg6IFdpZHRoIG9mIHRoZSB2aXNpYmxlIHBvcnRpb24gb2YgdGhlIHdvcmtzcGFjZS5cbiAgICogLmNvbnRlbnRIZWlnaHQ6IEhlaWdodCBvZiB0aGUgY29udGVudC5cbiAgICogLmNvbnRlbnRXaWR0aDogV2lkdGggb2YgdGhlIGNvbnRlbnQuXG4gICAqIC5zY3JvbGxIZWlnaHQ6IEhlaWdodCBvZiB0aGUgc2Nyb2xsIGFyZWEuXG4gICAqIC5zY3JvbGxXaWR0aDogV2lkdGggb2YgdGhlIHNjcm9sbCBhcmVhLlxuICAgKiAuc3ZnSGVpZ2h0OiBIZWlnaHQgb2YgdGhlIEJsb2NrbHkgZGl2ICh0aGUgdmlldyArIHRoZSB0b29sYm94LFxuICAgKiAgICBzaW1wbGUgb3Igb3RoZXJ3aXNlKSxcbiAgICogLnN2Z1dpZHRoOiBXaWR0aCBvZiB0aGUgQmxvY2tseSBkaXYgKHRoZSB2aWV3ICsgdGhlIHRvb2xib3gsXG4gICAqICAgIHNpbXBsZSBvciBvdGhlcndpc2UpLFxuICAgKiAudmlld1RvcDogVG9wLWVkZ2Ugb2YgdGhlIHZpc2libGUgcG9ydGlvbiBvZiB0aGUgd29ya3NwYWNlLCByZWxhdGl2ZSB0b1xuICAgKiAgICAgdGhlIHdvcmtzcGFjZSBvcmlnaW4uXG4gICAqIC52aWV3TGVmdDogTGVmdC1lZGdlIG9mIHRoZSB2aXNpYmxlIHBvcnRpb24gb2YgdGhlIHdvcmtzcGFjZSwgcmVsYXRpdmUgdG9cbiAgICogICAgIHRoZSB3b3Jrc3BhY2Ugb3JpZ2luLlxuICAgKiAuY29udGVudFRvcDogVG9wLWVkZ2Ugb2YgdGhlIGNvbnRlbnQsIHJlbGF0aXZlIHRvIHRoZSB3b3Jrc3BhY2Ugb3JpZ2luLlxuICAgKiAuY29udGVudExlZnQ6IExlZnQtZWRnZSBvZiB0aGUgY29udGVudCByZWxhdGl2ZSB0byB0aGUgd29ya3NwYWNlIG9yaWdpbi5cbiAgICogLnNjcm9sbFRvcDogVG9wLWVkZ2Ugb2YgdGhlIHNjcm9sbCBhcmVhLCByZWxhdGl2ZSB0byB0aGUgd29ya3NwYWNlIG9yaWdpbi5cbiAgICogLnNjcm9sbExlZnQ6IExlZnQtZWRnZSBvZiB0aGUgc2Nyb2xsIGFyZWEgcmVsYXRpdmUgdG8gdGhlIHdvcmtzcGFjZSBvcmlnaW4uXG4gICAqIC5hYnNvbHV0ZVRvcDogVG9wLWVkZ2Ugb2YgdGhlIHZpc2libGUgcG9ydGlvbiBvZiB0aGUgd29ya3NwYWNlLCByZWxhdGl2ZVxuICAgKiAgICAgdG8gdGhlIGJsb2NrbHlEaXYuXG4gICAqIC5hYnNvbHV0ZUxlZnQ6IExlZnQtZWRnZSBvZiB0aGUgdmlzaWJsZSBwb3J0aW9uIG9mIHRoZSB3b3Jrc3BhY2UsIHJlbGF0aXZlXG4gICAqICAgICB0byB0aGUgYmxvY2tseURpdi5cbiAgICogLnRvb2xib3hXaWR0aDogV2lkdGggb2YgdGhlIHRvb2xib3gsIGlmIGl0IGV4aXN0cy4gIE90aGVyd2lzZSB6ZXJvLlxuICAgKiAudG9vbGJveEhlaWdodDogSGVpZ2h0IG9mIHRoZSB0b29sYm94LCBpZiBpdCBleGlzdHMuICBPdGhlcndpc2UgemVyby5cbiAgICogLmZseW91dFdpZHRoOiBXaWR0aCBvZiB0aGUgZmx5b3V0IGlmIGl0IGlzIGFsd2F5cyBvcGVuLiAgT3RoZXJ3aXNlIHplcm8uXG4gICAqIC5mbHlvdXRIZWlnaHQ6IEhlaWdodCBvZiB0aGUgZmx5b3V0IGlmIGl0IGlzIGFsd2F5cyBvcGVuLiAgT3RoZXJ3aXNlIHplcm8uXG4gICAqIC50b29sYm94UG9zaXRpb246IFRvcCwgYm90dG9tLCBsZWZ0IG9yIHJpZ2h0LiBVc2UgVE9PTEJPWF9BVCBjb25zdGFudHMgdG9cbiAgICogICAgIGNvbXBhcmUuXG4gICAqXG4gICAqIEByZXR1cm5zIENvbnRhaW5zIHNpemUgYW5kIHBvc2l0aW9uIG1ldHJpY3Mgb2YgYSB0b3AgbGV2ZWwgd29ya3NwYWNlLlxuICAgKi9cbiAgZ2V0TWV0cmljcygpOiBNZXRyaWNzIHtcbiAgICBjb25zdCB0b29sYm94TWV0cmljcyA9IHRoaXMuZ2V0VG9vbGJveE1ldHJpY3MoKTtcbiAgICBjb25zdCBmbHlvdXRNZXRyaWNzID0gdGhpcy5nZXRGbHlvdXRNZXRyaWNzKHRydWUpO1xuICAgIGNvbnN0IHN2Z01ldHJpY3MgPSB0aGlzLmdldFN2Z01ldHJpY3MoKTtcbiAgICBjb25zdCBhYnNvbHV0ZU1ldHJpY3MgPSB0aGlzLmdldEFic29sdXRlTWV0cmljcygpO1xuICAgIGNvbnN0IHZpZXdNZXRyaWNzID0gdGhpcy5nZXRWaWV3TWV0cmljcygpO1xuICAgIGNvbnN0IGNvbnRlbnRNZXRyaWNzID0gdGhpcy5nZXRDb250ZW50TWV0cmljcygpO1xuICAgIGNvbnN0IHNjcm9sbE1ldHJpY3MgPVxuICAgICAgICB0aGlzLmdldFNjcm9sbE1ldHJpY3MoZmFsc2UsIHZpZXdNZXRyaWNzLCBjb250ZW50TWV0cmljcyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudEhlaWdodDogY29udGVudE1ldHJpY3MuaGVpZ2h0LFxuICAgICAgY29udGVudFdpZHRoOiBjb250ZW50TWV0cmljcy53aWR0aCxcbiAgICAgIGNvbnRlbnRUb3A6IGNvbnRlbnRNZXRyaWNzLnRvcCxcbiAgICAgIGNvbnRlbnRMZWZ0OiBjb250ZW50TWV0cmljcy5sZWZ0LFxuXG4gICAgICBzY3JvbGxIZWlnaHQ6IHNjcm9sbE1ldHJpY3MuaGVpZ2h0LFxuICAgICAgc2Nyb2xsV2lkdGg6IHNjcm9sbE1ldHJpY3Mud2lkdGgsXG4gICAgICBzY3JvbGxUb3A6IHNjcm9sbE1ldHJpY3MudG9wLFxuICAgICAgc2Nyb2xsTGVmdDogc2Nyb2xsTWV0cmljcy5sZWZ0LFxuXG4gICAgICB2aWV3SGVpZ2h0OiB2aWV3TWV0cmljcy5oZWlnaHQsXG4gICAgICB2aWV3V2lkdGg6IHZpZXdNZXRyaWNzLndpZHRoLFxuICAgICAgdmlld1RvcDogdmlld01ldHJpY3MudG9wLFxuICAgICAgdmlld0xlZnQ6IHZpZXdNZXRyaWNzLmxlZnQsXG5cbiAgICAgIGFic29sdXRlVG9wOiBhYnNvbHV0ZU1ldHJpY3MudG9wLFxuICAgICAgYWJzb2x1dGVMZWZ0OiBhYnNvbHV0ZU1ldHJpY3MubGVmdCxcblxuICAgICAgc3ZnSGVpZ2h0OiBzdmdNZXRyaWNzLmhlaWdodCxcbiAgICAgIHN2Z1dpZHRoOiBzdmdNZXRyaWNzLndpZHRoLFxuXG4gICAgICB0b29sYm94V2lkdGg6IHRvb2xib3hNZXRyaWNzLndpZHRoLFxuICAgICAgdG9vbGJveEhlaWdodDogdG9vbGJveE1ldHJpY3MuaGVpZ2h0LFxuICAgICAgdG9vbGJveFBvc2l0aW9uOiB0b29sYm94TWV0cmljcy5wb3NpdGlvbixcblxuICAgICAgZmx5b3V0V2lkdGg6IGZseW91dE1ldHJpY3Mud2lkdGgsXG4gICAgICBmbHlvdXRIZWlnaHQ6IGZseW91dE1ldHJpY3MuaGVpZ2h0LFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBNZXRyaWNzTWFuYWdlciB7XG4gIC8qKlxuICAgKiBEZXNjcmliZXMgdGhlIHdpZHRoLCBoZWlnaHQgYW5kIGxvY2F0aW9uIG9mIHRoZSB0b29sYm94IG9uIHRoZSBtYWluXG4gICAqIHdvcmtzcGFjZS5cbiAgICovXG4gIGV4cG9ydCBpbnRlcmZhY2UgVG9vbGJveE1ldHJpY3Mge1xuICAgIHdpZHRoOiBudW1iZXI7XG4gICAgaGVpZ2h0OiBudW1iZXI7XG4gICAgcG9zaXRpb246IHRvb2xib3hVdGlscy5Qb3NpdGlvbjtcbiAgfVxuXG4gIC8qKiBEZXNjcmliZXMgd2hlcmUgdGhlIHZpZXdwb3J0IHN0YXJ0cyBpbiByZWxhdGlvbiB0byB0aGUgd29ya3NwYWNlIFNWRy4gKi9cbiAgZXhwb3J0IGludGVyZmFjZSBBYnNvbHV0ZU1ldHJpY3Mge1xuICAgIGxlZnQ6IG51bWJlcjtcbiAgICB0b3A6IG51bWJlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbGwgdGhlIG1lYXN1cmVtZW50cyBuZWVkZWQgdG8gZGVzY3JpYmUgdGhlIHNpemUgYW5kIGxvY2F0aW9uIG9mIGFcbiAgICogY29udGFpbmVyLlxuICAgKi9cbiAgZXhwb3J0IGludGVyZmFjZSBDb250YWluZXJSZWdpb24ge1xuICAgIGhlaWdodDogbnVtYmVyO1xuICAgIHdpZHRoOiBudW1iZXI7XG4gICAgdG9wOiBudW1iZXI7XG4gICAgbGVmdDogbnVtYmVyO1xuICB9XG5cbiAgLyoqIERlc2NyaWJlcyBmaXhlZCBlZGdlcyBvZiB0aGUgd29ya3NwYWNlLiAqL1xuICBleHBvcnQgaW50ZXJmYWNlIEZpeGVkRWRnZXMge1xuICAgIHRvcD86IG51bWJlcjtcbiAgICBib3R0b20/OiBudW1iZXI7XG4gICAgbGVmdD86IG51bWJlcjtcbiAgICByaWdodD86IG51bWJlcjtcbiAgfVxuXG4gIC8qKiBDb21tb24gbWV0cmljcyB1c2VkIGZvciBVSSBlbGVtZW50cy4gKi9cbiAgZXhwb3J0IGludGVyZmFjZSBVaU1ldHJpY3Mge1xuICAgIHZpZXdNZXRyaWNzOiBDb250YWluZXJSZWdpb247XG4gICAgYWJzb2x1dGVNZXRyaWNzOiBBYnNvbHV0ZU1ldHJpY3M7XG4gICAgdG9vbGJveE1ldHJpY3M6IFRvb2xib3hNZXRyaWNzO1xuICB9XG59XG5cbmV4cG9ydCB0eXBlIFRvb2xib3hNZXRyaWNzID0gTWV0cmljc01hbmFnZXIuVG9vbGJveE1ldHJpY3M7XG5leHBvcnQgdHlwZSBBYnNvbHV0ZU1ldHJpY3MgPSBNZXRyaWNzTWFuYWdlci5BYnNvbHV0ZU1ldHJpY3M7XG5leHBvcnQgdHlwZSBDb250YWluZXJSZWdpb24gPSBNZXRyaWNzTWFuYWdlci5Db250YWluZXJSZWdpb247XG5leHBvcnQgdHlwZSBGaXhlZEVkZ2VzID0gTWV0cmljc01hbmFnZXIuRml4ZWRFZGdlcztcbmV4cG9ydCB0eXBlIFVpTWV0cmljcyA9IE1ldHJpY3NNYW5hZ2VyLlVpTWV0cmljcztcblxucmVnaXN0cnkucmVnaXN0ZXIoXG4gICAgcmVnaXN0cnkuVHlwZS5NRVRSSUNTX01BTkFHRVIsIHJlZ2lzdHJ5LkRFRkFVTFQsIE1ldHJpY3NNYW5hZ2VyKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDYWxjdWxhdGVzIGFuZCByZXBvcnRzIGZseW91dCB3b3Jrc3BhY2UgbWV0cmljcy5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GbHlvdXRNZXRyaWNzTWFuYWdlcicpO1xuXG5pbXBvcnQgdHlwZSB7SUZseW91dH0gZnJvbSAnLi9pbnRlcmZhY2VzL2lfZmx5b3V0LmpzJztcbmltcG9ydCB7Q29udGFpbmVyUmVnaW9uLCBNZXRyaWNzTWFuYWdlcn0gZnJvbSAnLi9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZVN2Z30gZnJvbSAnLi93b3Jrc3BhY2Vfc3ZnLmpzJztcblxuXG4vKipcbiAqIENhbGN1bGF0ZXMgbWV0cmljcyBmb3IgYSBmbHlvdXQncyB3b3Jrc3BhY2UuXG4gKiBUaGUgbWV0cmljcyBhcmUgbWFpbmx5IHVzZWQgdG8gc2l6ZSBzY3JvbGxiYXJzIGZvciB0aGUgZmx5b3V0LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkZseW91dE1ldHJpY3NNYW5hZ2VyXG4gKi9cbmV4cG9ydCBjbGFzcyBGbHlvdXRNZXRyaWNzTWFuYWdlciBleHRlbmRzIE1ldHJpY3NNYW5hZ2VyIHtcbiAgLyoqIFRoZSBmbHlvdXQgdGhhdCBvd25zIHRoZSB3b3Jrc3BhY2UgdG8gY2FsY3VsYXRlIG1ldHJpY3MgZm9yLiAqL1xuICBwcm90ZWN0ZWQgZmx5b3V0XzogSUZseW91dDtcblxuICAvKipcbiAgICogQHBhcmFtIHdvcmtzcGFjZSBUaGUgZmx5b3V0J3Mgd29ya3NwYWNlLlxuICAgKiBAcGFyYW0gZmx5b3V0IFRoZSBmbHlvdXQuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih3b3Jrc3BhY2U6IFdvcmtzcGFjZVN2ZywgZmx5b3V0OiBJRmx5b3V0KSB7XG4gICAgc3VwZXIod29ya3NwYWNlKTtcbiAgICB0aGlzLmZseW91dF8gPSBmbHlvdXQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBibG9ja3Mgb24gdGhlIGZseW91dCdzIHdvcmtzcGFjZS5cbiAgICogVGhpcyBpcyBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBib3VuZGluZyBib3ggb2YgdGhlIGJsb2NrcyBvbiB0aGUgd29ya3NwYWNlLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRCb3VuZGluZ0JveF8oKTogU1ZHUmVjdHxcbiAgICAgIHtoZWlnaHQ6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCB4OiBudW1iZXJ9IHtcbiAgICBsZXQgYmxvY2tCb3VuZGluZ0JveDtcbiAgICB0cnkge1xuICAgICAgYmxvY2tCb3VuZGluZ0JveCA9IHRoaXMud29ya3NwYWNlXy5nZXRDYW52YXMoKS5nZXRCQm94KCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gRmlyZWZveCBoYXMgdHJvdWJsZSB3aXRoIGhpZGRlbiBlbGVtZW50cyAoQnVnIDUyODk2OSkuXG4gICAgICAvLyAyMDIxIFVwZGF0ZTogSXQgbG9va3MgbGlrZSB0aGlzIHdhcyBmaXhlZCBhcm91bmQgRmlyZWZveCA3NyByZWxlYXNlZCBpblxuICAgICAgLy8gMjAyMC5cbiAgICAgIGJsb2NrQm91bmRpbmdCb3ggPSB7aGVpZ2h0OiAwLCB5OiAwLCB3aWR0aDogMCwgeDogMH07XG4gICAgfVxuICAgIHJldHVybiBibG9ja0JvdW5kaW5nQm94O1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0Q29udGVudE1ldHJpY3Mob3B0X2dldFdvcmtzcGFjZUNvb3JkaW5hdGVzPzogYm9vbGVhbikge1xuICAgIC8vIFRoZSBib3VuZGluZyBib3ggaXMgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgIGNvbnN0IGJsb2NrQm91bmRpbmdCb3ggPSB0aGlzLmdldEJvdW5kaW5nQm94XygpO1xuICAgIGNvbnN0IHNjYWxlID0gb3B0X2dldFdvcmtzcGFjZUNvb3JkaW5hdGVzID8gMSA6IHRoaXMud29ya3NwYWNlXy5zY2FsZTtcblxuICAgIHJldHVybiB7XG4gICAgICBoZWlnaHQ6IGJsb2NrQm91bmRpbmdCb3guaGVpZ2h0ICogc2NhbGUsXG4gICAgICB3aWR0aDogYmxvY2tCb3VuZGluZ0JveC53aWR0aCAqIHNjYWxlLFxuICAgICAgdG9wOiBibG9ja0JvdW5kaW5nQm94LnkgKiBzY2FsZSxcbiAgICAgIGxlZnQ6IGJsb2NrQm91bmRpbmdCb3gueCAqIHNjYWxlLFxuICAgIH07XG4gIH1cblxuICBvdmVycmlkZSBnZXRTY3JvbGxNZXRyaWNzKFxuICAgICAgb3B0X2dldFdvcmtzcGFjZUNvb3JkaW5hdGVzPzogYm9vbGVhbiwgb3B0X3ZpZXdNZXRyaWNzPzogQ29udGFpbmVyUmVnaW9uLFxuICAgICAgb3B0X2NvbnRlbnRNZXRyaWNzPzogQ29udGFpbmVyUmVnaW9uKSB7XG4gICAgY29uc3QgY29udGVudE1ldHJpY3MgPSBvcHRfY29udGVudE1ldHJpY3MgfHwgdGhpcy5nZXRDb250ZW50TWV0cmljcygpO1xuICAgIGNvbnN0IG1hcmdpbiA9IHRoaXMuZmx5b3V0Xy5NQVJHSU4gKiB0aGlzLndvcmtzcGFjZV8uc2NhbGU7XG4gICAgY29uc3Qgc2NhbGUgPSBvcHRfZ2V0V29ya3NwYWNlQ29vcmRpbmF0ZXMgPyB0aGlzLndvcmtzcGFjZV8uc2NhbGUgOiAxO1xuXG4gICAgLy8gVGhlIGxlZnQgcGFkZGluZyBpc24ndCBqdXN0IHRoZSBtYXJnaW4uIFNvbWUgYmxvY2tzIGFyZSBhbHNvIG9mZnNldCBieVxuICAgIC8vIHRhYldpZHRoIHNvIHRoYXQgdmFsdWUgYW5kIHN0YXRlbWVudCBibG9ja3MgbGluZSB1cC5cbiAgICAvLyBUaGUgY29udGVudE1ldHJpY3MubGVmdCB2YWx1ZSBpcyBlcXVpdmFsZW50IHRvIHRoZSB2YXJpYWJsZSBsZWZ0IHBhZGRpbmcuXG4gICAgY29uc3QgbGVmdFBhZGRpbmcgPSBjb250ZW50TWV0cmljcy5sZWZ0O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGhlaWdodDogKGNvbnRlbnRNZXRyaWNzLmhlaWdodCArIDIgKiBtYXJnaW4pIC8gc2NhbGUsXG4gICAgICB3aWR0aDogKGNvbnRlbnRNZXRyaWNzLndpZHRoICsgbGVmdFBhZGRpbmcgKyBtYXJnaW4pIC8gc2NhbGUsXG4gICAgICB0b3A6IDAsXG4gICAgICBsZWZ0OiAwLFxuICAgIH07XG4gIH1cbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDExIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBGbHlvdXQgdHJheSBjb250YWluaW5nIGJsb2NrcyB3aGljaCBtYXkgYmUgY3JlYXRlZC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GbHlvdXQnKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCB0eXBlIHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2NvbW1vbi5qcyc7XG5pbXBvcnQge0NvbXBvbmVudE1hbmFnZXJ9IGZyb20gJy4vY29tcG9uZW50X21hbmFnZXIuanMnO1xuaW1wb3J0IHtEZWxldGVBcmVhfSBmcm9tICcuL2RlbGV0ZV9hcmVhLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi9ldmVudHMvdXRpbHMuanMnO1xuaW1wb3J0IHtGbHlvdXRCdXR0b259IGZyb20gJy4vZmx5b3V0X2J1dHRvbi5qcyc7XG5pbXBvcnQge0ZseW91dE1ldHJpY3NNYW5hZ2VyfSBmcm9tICcuL2ZseW91dF9tZXRyaWNzX21hbmFnZXIuanMnO1xuaW1wb3J0IHR5cGUge0lGbHlvdXR9IGZyb20gJy4vaW50ZXJmYWNlcy9pX2ZseW91dC5qcyc7XG5pbXBvcnQgdHlwZSB7T3B0aW9uc30gZnJvbSAnLi9vcHRpb25zLmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyUGFpcn0gZnJvbSAnLi9zY3JvbGxiYXJfcGFpci5qcyc7XG5pbXBvcnQgKiBhcyBibG9ja3MgZnJvbSAnLi9zZXJpYWxpemF0aW9uL2Jsb2Nrcy5qcyc7XG5pbXBvcnQgKiBhcyBUb29sdGlwIGZyb20gJy4vdG9vbHRpcC5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0ICogYXMgaWRHZW5lcmF0b3IgZnJvbSAnLi91dGlscy9pZGdlbmVyYXRvci5qcyc7XG5pbXBvcnQge1N2Z30gZnJvbSAnLi91dGlscy9zdmcuanMnO1xuaW1wb3J0ICogYXMgdG9vbGJveCBmcm9tICcuL3V0aWxzL3Rvb2xib3guanMnO1xuaW1wb3J0ICogYXMgVmFyaWFibGVzIGZyb20gJy4vdmFyaWFibGVzLmpzJztcbmltcG9ydCB7V29ya3NwYWNlU3ZnfSBmcm9tICcuL3dvcmtzcGFjZV9zdmcuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4veG1sLmpzJztcblxuXG5lbnVtIEZseW91dEl0ZW1UeXBlIHtcbiAgQkxPQ0sgPSAnYmxvY2snLFxuICBCVVRUT04gPSAnYnV0dG9uJyxcbn1cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBmbHlvdXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmx5b3V0XG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBGbHlvdXQgZXh0ZW5kcyBEZWxldGVBcmVhIGltcGxlbWVudHMgSUZseW91dCB7XG4gIC8qKlxuICAgKiBQb3NpdGlvbiB0aGUgZmx5b3V0LlxuICAgKi9cbiAgYWJzdHJhY3QgcG9zaXRpb24oKTogdm9pZDtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGlmIGEgZHJhZyBkZWx0YSBpcyB0b3dhcmQgdGhlIHdvcmtzcGFjZSwgYmFzZWQgb24gdGhlIHBvc2l0aW9uXG4gICAqIGFuZCBvcmllbnRhdGlvbiBvZiB0aGUgZmx5b3V0LiBUaGlzIGlzIHVzZWQgaW4gZGV0ZXJtaW5lRHJhZ0ludGVudGlvbl8gdG9cbiAgICogZGV0ZXJtaW5lIGlmIGEgbmV3IGJsb2NrIHNob3VsZCBiZSBjcmVhdGVkIG9yIGlmIHRoZSBmbHlvdXQgc2hvdWxkIHNjcm9sbC5cbiAgICpcbiAgICogQHBhcmFtIGN1cnJlbnREcmFnRGVsdGFYWSBIb3cgZmFyIHRoZSBwb2ludGVyIGhhc1xuICAgKiAgICAgbW92ZWQgZnJvbSB0aGUgcG9zaXRpb24gYXQgbW91c2UgZG93biwgaW4gcGl4ZWwgdW5pdHMuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGRyYWcgaXMgdG93YXJkIHRoZSB3b3Jrc3BhY2UuXG4gICAqL1xuICBhYnN0cmFjdCBpc0RyYWdUb3dhcmRXb3Jrc3BhY2UoY3VycmVudERyYWdEZWx0YVhZOiBDb29yZGluYXRlKTogYm9vbGVhbjtcblxuICAvKipcbiAgICogU2V0cyB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIGZseW91dCB0byBtYXRjaCB0aGUgc2Nyb2xsYmFycy5cbiAgICpcbiAgICogQHBhcmFtIHh5UmF0aW8gQ29udGFpbnMgYSB5IHByb3BlcnR5IHdoaWNoIGlzIGEgZmxvYXRcbiAgICogICAgIGJldHdlZW4gMCBhbmQgMSBzcGVjaWZ5aW5nIHRoZSBkZWdyZWUgb2Ygc2Nyb2xsaW5nIGFuZCBhXG4gICAqICAgICBzaW1pbGFyIHggcHJvcGVydHkuXG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc2V0TWV0cmljc18oeHlSYXRpbzoge3g/OiBudW1iZXIsIHk/OiBudW1iZXJ9KTogdm9pZDtcblxuICAvKipcbiAgICogTGF5IG91dCB0aGUgYmxvY2tzIGluIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSBjb250ZW50cyBUaGUgYmxvY2tzIGFuZCBidXR0b25zIHRvIGxheVxuICAgKiAgICAgb3V0LlxuICAgKiBAcGFyYW0gZ2FwcyBUaGUgdmlzaWJsZSBnYXBzIGJldHdlZW4gYmxvY2tzLlxuICAgKi9cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGxheW91dF8oY29udGVudHM6IEZseW91dEl0ZW1bXSwgZ2FwczogbnVtYmVyW10pOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBTY3JvbGwgdGhlIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2Ugd2hlZWwgc2Nyb2xsIGV2ZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIGFic3RyYWN0IHdoZWVsXyhlOiBXaGVlbEV2ZW50KTogdm9pZDtcblxuICAvKipcbiAgICogQ29tcHV0ZSBoZWlnaHQgb2YgZmx5b3V0LiAgUG9zaXRpb24gbWF0IHVuZGVyIGVhY2ggYmxvY2suXG4gICAqIEZvciBSVEw6IExheSBvdXQgdGhlIGJsb2NrcyByaWdodC1hbGlnbmVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIGFic3RyYWN0IHJlZmxvd0ludGVybmFsXygpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHRoZSB4IGNvb3JkaW5hdGUgZm9yIHRoZSBmbHlvdXQgcG9zaXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFggY29vcmRpbmF0ZS5cbiAgICovXG4gIGFic3RyYWN0IGdldFgoKTogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHRoZSB5IGNvb3JkaW5hdGUgZm9yIHRoZSBmbHlvdXQgcG9zaXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFkgY29vcmRpbmF0ZS5cbiAgICovXG4gIGFic3RyYWN0IGdldFkoKTogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBTY3JvbGwgdGhlIGZseW91dCB0byB0aGUgYmVnaW5uaW5nIG9mIGl0cyBjb250ZW50cy5cbiAgICovXG4gIGFic3RyYWN0IHNjcm9sbFRvU3RhcnQoKTogdm9pZDtcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgYSBmbHlvdXQgY29udGVudCBpdGVtLlxuICAgKi9cbiAgc3RhdGljIEZseW91dEl0ZW1UeXBlID0gRmx5b3V0SXRlbVR5cGU7XG5cbiAgcHJvdGVjdGVkIHdvcmtzcGFjZV86IFdvcmtzcGFjZVN2ZztcbiAgUlRMOiBib29sZWFuO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgZmx5b3V0IHNob3VsZCBiZSBsYWlkIG91dCBob3Jpem9udGFsbHkgb3Igbm90LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGhvcml6b250YWxMYXlvdXQgPSBmYWxzZTtcbiAgcHJvdGVjdGVkIHRvb2xib3hQb3NpdGlvbl86IG51bWJlcjtcblxuICAvKipcbiAgICogT3BhcXVlIGRhdGEgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIEJsb2NrbHkudW5iaW5kRXZlbnRfLlxuICAgKi9cbiAgcHJpdmF0ZSBldmVudFdyYXBwZXJzXzogYnJvd3NlckV2ZW50cy5EYXRhID0gW107XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSByZWdpc3RlcmVkIGFzIGEgY2hhbmdlIGxpc3RlbmVyIG9uIHRoZSB3b3Jrc3BhY2VcbiAgICogdG8gcmVmbG93IHdoZW4gYmxvY2tzIGluIHRoZSBmbHlvdXQgd29ya3NwYWNlIGNoYW5nZS5cbiAgICovXG4gIHByaXZhdGUgcmVmbG93V3JhcHBlcl86IEZ1bmN0aW9ufG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IGRpc2FibGVzIGJsb2NrcyBpbiB0aGUgZmx5b3V0IGJhc2VkIG9uIG1heCBibG9jayBjb3VudHNcbiAgICogYWxsb3dlZCBpbiB0aGUgdGFyZ2V0IHdvcmtzcGFjZS4gUmVnaXN0ZXJlZCBhcyBhIGNoYW5nZSBsaXN0ZW5lciBvbiB0aGVcbiAgICogdGFyZ2V0IHdvcmtzcGFjZS5cbiAgICovXG4gIHByaXZhdGUgZmlsdGVyV3JhcHBlcl86IEZ1bmN0aW9ufG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBMaXN0IG9mIGJhY2tncm91bmQgbWF0cyB0aGF0IGx1cmsgYmVoaW5kIGVhY2ggYmxvY2sgdG8gY2F0Y2ggY2xpY2tzXG4gICAqIGxhbmRpbmcgaW4gdGhlIGJsb2NrcycgbGFrZXMgYW5kIGJheXMuXG4gICAqL1xuICBwcml2YXRlIG1hdHNfOiBTVkdFbGVtZW50W10gPSBbXTtcbiAgLyoqXG4gICAqIExpc3Qgb2YgdmlzaWJsZSBidXR0b25zLlxuICAgKi9cbiAgcHJvdGVjdGVkIGJ1dHRvbnNfOiBGbHlvdXRCdXR0b25bXSA9IFtdO1xuICAvKipcbiAgICogTGlzdCBvZiBldmVudCBsaXN0ZW5lcnMuXG4gICAqL1xuICBwcml2YXRlIGxpc3RlbmVyc186IGJyb3dzZXJFdmVudHMuRGF0YVtdID0gW107XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgYmxvY2tzIHRoYXQgc2hvdWxkIGFsd2F5cyBiZSBkaXNhYmxlZC5cbiAgICovXG4gIHByaXZhdGUgcGVybWFuZW50bHlEaXNhYmxlZF86IEJsb2NrW10gPSBbXTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHRhYldpZHRoXzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgdGFyZ2V0IHdvcmtzcGFjZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICB0YXJnZXRXb3Jrc3BhY2UhOiBXb3Jrc3BhY2VTdmc7XG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgYmxvY2tzIHRoYXQgY2FuIGJlIHJldXNlZC5cbiAgICovXG4gIHByaXZhdGUgcmVjeWNsZWRCbG9ja3NfOiBCbG9ja1N2Z1tdID0gW107XG4gIC8qKlxuICAgKiBEb2VzIHRoZSBmbHlvdXQgYXV0b21hdGljYWxseSBjbG9zZSB3aGVuIGEgYmxvY2sgaXMgY3JlYXRlZD9cbiAgICovXG4gIGF1dG9DbG9zZSA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGZseW91dCBpcyB2aXNpYmxlLlxuICAgKi9cbiAgcHJpdmF0ZSBpc1Zpc2libGVfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHdvcmtzcGFjZSBjb250YWluaW5nIHRoaXMgZmx5b3V0IGlzIHZpc2libGUuXG4gICAqL1xuICBwcml2YXRlIGNvbnRhaW5lclZpc2libGVfID0gdHJ1ZTtcbiAgcHJvdGVjdGVkIHJlY3RNYXBfOiBXZWFrTWFwPEJsb2NrU3ZnLCBTVkdFbGVtZW50PjtcblxuICAvKipcbiAgICogQ29ybmVyIHJhZGl1cyBvZiB0aGUgZmx5b3V0IGJhY2tncm91bmQuXG4gICAqL1xuICByZWFkb25seSBDT1JORVJfUkFESVVTOiBudW1iZXIgPSA4O1xuICByZWFkb25seSBNQVJHSU46IG51bWJlcjtcbiAgcmVhZG9ubHkgR0FQX1g6IG51bWJlcjtcbiAgcmVhZG9ubHkgR0FQX1k6IG51bWJlcjtcblxuICAvKipcbiAgICogVG9wL2JvdHRvbSBwYWRkaW5nIGJldHdlZW4gc2Nyb2xsYmFyIGFuZCBlZGdlIG9mIGZseW91dCBiYWNrZ3JvdW5kLlxuICAgKi9cbiAgcmVhZG9ubHkgU0NST0xMQkFSX01BUkdJTjogbnVtYmVyID0gMi41O1xuXG4gIC8qKlxuICAgKiBXaWR0aCBvZiBmbHlvdXQuXG4gICAqL1xuICBwcm90ZWN0ZWQgd2lkdGhfID0gMDtcblxuICAvKipcbiAgICogSGVpZ2h0IG9mIGZseW91dC5cbiAgICovXG4gIHByb3RlY3RlZCBoZWlnaHRfID0gMDtcbiAgLy8gY2xhbmctZm9ybWF0IG9mZlxuICAvKipcbiAgICogUmFuZ2Ugb2YgYSBkcmFnIGFuZ2xlIGZyb20gYSBmbHlvdXQgY29uc2lkZXJlZCBcImRyYWdnaW5nIHRvd2FyZFxuICAgKiB3b3Jrc3BhY2VcIi4gRHJhZ3MgdGhhdCBhcmUgd2l0aGluIHRoZSBib3VuZHMgb2YgdGhpcyBtYW55IGRlZ3JlZXMgZnJvbVxuICAgKiB0aGUgb3J0aG9nb25hbCBsaW5lIHRvIHRoZSBmbHlvdXQgZWRnZSBhcmUgY29uc2lkZXJlZCB0byBiZSBcImRyYWdzIHRvd2FyZFxuICAgKiB0aGUgd29ya3NwYWNlXCIuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGBgYFxuICAgKiBGbHlvdXQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWRnZSAgIFdvcmtzcGFjZVxuICAgKiBbYmxvY2tdIC8gIDwtd2l0aGluIHRoaXMgYW5nbGUsIGRyYWdzIFwidG93YXJkIHdvcmtzcGFjZVwiIHxcbiAgICogW2Jsb2NrXSAtLS0tIG9ydGhvZ29uYWwgdG8gZmx5b3V0IGJvdW5kYXJ5IC0tLS0gICAgICAgICAgfFxuICAgKiBbYmxvY2tdIFxcICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICAgKiBgYGBcbiAgICpcbiAgICogVGhlIGFuZ2xlIGlzIGdpdmVuIGluIGRlZ3JlZXMgZnJvbSB0aGUgb3J0aG9nb25hbC5cbiAgICpcbiAgICogVGhpcyBpcyB1c2VkIHRvIGtub3cgd2hlbiB0byBjcmVhdGUgYSBuZXcgYmxvY2sgYW5kIHdoZW4gdG8gc2Nyb2xsIHRoZVxuICAgKiBmbHlvdXQuIFNldHRpbmcgaXQgdG8gMzYwIG1lYW5zIHRoYXQgYWxsIGRyYWdzIGNyZWF0ZSBhIG5ldyBibG9jay5cbiAgICovXG4gIC8vIGNsYW5nLWZvcm1hdCBvblxuICBwcm90ZWN0ZWQgZHJhZ0FuZ2xlUmFuZ2VfID0gNzA7XG5cbiAgLyoqXG4gICAqIFRoZSBwYXRoIGFyb3VuZCB0aGUgYmFja2dyb3VuZCBvZiB0aGUgZmx5b3V0LCB3aGljaCB3aWxsIGJlIGZpbGxlZCB3aXRoIGFcbiAgICogYmFja2dyb3VuZCBjb2xvdXIuXG4gICAqL1xuICBwcm90ZWN0ZWQgc3ZnQmFja2dyb3VuZF86IFNWR1BhdGhFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgcm9vdCBTVkcgZ3JvdXAgZm9yIHRoZSBidXR0b24gb3IgbGFiZWwuXG4gICAqL1xuICBwcm90ZWN0ZWQgc3ZnR3JvdXBfOiBTVkdHRWxlbWVudHxudWxsID0gbnVsbDtcbiAgLyoqXG4gICAqIEBwYXJhbSB3b3Jrc3BhY2VPcHRpb25zIERpY3Rpb25hcnkgb2Ygb3B0aW9ucyBmb3IgdGhlXG4gICAqICAgICB3b3Jrc3BhY2UuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih3b3Jrc3BhY2VPcHRpb25zOiBPcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICB3b3Jrc3BhY2VPcHRpb25zLnNldE1ldHJpY3MgPSB0aGlzLnNldE1ldHJpY3NfLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLndvcmtzcGFjZV8gPSBuZXcgV29ya3NwYWNlU3ZnKHdvcmtzcGFjZU9wdGlvbnMpO1xuICAgIHRoaXMud29ya3NwYWNlXy5zZXRNZXRyaWNzTWFuYWdlcihcbiAgICAgICAgbmV3IEZseW91dE1ldHJpY3NNYW5hZ2VyKHRoaXMud29ya3NwYWNlXywgdGhpcykpO1xuXG4gICAgdGhpcy53b3Jrc3BhY2VfLmludGVybmFsSXNGbHlvdXQgPSB0cnVlO1xuICAgIC8vIEtlZXAgdGhlIHdvcmtzcGFjZSB2aXNpYmlsaXR5IGNvbnNpc3RlbnQgd2l0aCB0aGUgZmx5b3V0J3MgdmlzaWJpbGl0eS5cbiAgICB0aGlzLndvcmtzcGFjZV8uc2V0VmlzaWJsZSh0aGlzLmlzVmlzaWJsZV8pO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHVuaXF1ZSBpZCBmb3IgdGhpcyBjb21wb25lbnQgdGhhdCBpcyB1c2VkIHRvIHJlZ2lzdGVyIHdpdGggdGhlXG4gICAgICogQ29tcG9uZW50TWFuYWdlci5cbiAgICAgKi9cbiAgICB0aGlzLmlkID0gaWRHZW5lcmF0b3IuZ2VuVWlkKCk7XG5cbiAgICAvKipcbiAgICAgKiBJcyBSVEwgdnMgTFRSLlxuICAgICAqL1xuICAgIHRoaXMuUlRMID0gISF3b3Jrc3BhY2VPcHRpb25zLlJUTDtcblxuICAgIC8qKlxuICAgICAqIFBvc2l0aW9uIG9mIHRoZSB0b29sYm94IGFuZCBmbHlvdXQgcmVsYXRpdmUgdG8gdGhlIHdvcmtzcGFjZS5cbiAgICAgKi9cbiAgICB0aGlzLnRvb2xib3hQb3NpdGlvbl8gPSB3b3Jrc3BhY2VPcHRpb25zLnRvb2xib3hQb3NpdGlvbjtcblxuICAgIC8qKlxuICAgICAqIFdpZHRoIG9mIG91dHB1dCB0YWIuXG4gICAgICovXG4gICAgdGhpcy50YWJXaWR0aF8gPSB0aGlzLndvcmtzcGFjZV8uZ2V0UmVuZGVyZXIoKS5nZXRDb25zdGFudHMoKS5UQUJfV0lEVEg7XG5cbiAgICAvKipcbiAgICAgKiBBIG1hcCBmcm9tIGJsb2NrcyB0byB0aGUgcmVjdHMgd2hpY2ggYXJlIGJlbmVhdGggdGhlbSB0byBhY3QgYXMgaW5wdXRcbiAgICAgKiB0YXJnZXRzLlxuICAgICAqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgdGhpcy5yZWN0TWFwXyA9IG5ldyBXZWFrTWFwKCk7XG5cbiAgICAvKipcbiAgICAgKiBNYXJnaW4gYXJvdW5kIHRoZSBlZGdlcyBvZiB0aGUgYmxvY2tzIGluIHRoZSBmbHlvdXQuXG4gICAgICovXG4gICAgdGhpcy5NQVJHSU4gPSB0aGlzLkNPUk5FUl9SQURJVVM7XG5cbiAgICAvLyBUT0RPOiBNb3ZlIEdBUF9YIGFuZCBHQVBfWSB0byB0aGVpciBhcHByb3ByaWF0ZSBmaWxlcy5cbiAgICAvKipcbiAgICAgKiBHYXAgYmV0d2VlbiBpdGVtcyBpbiBob3Jpem9udGFsIGZseW91dHMuIENhbiBiZSBvdmVycmlkZGVuIHdpdGggdGhlIFwic2VwXCJcbiAgICAgKiBlbGVtZW50LlxuICAgICAqL1xuICAgIHRoaXMuR0FQX1ggPSB0aGlzLk1BUkdJTiAqIDM7XG5cbiAgICAvKipcbiAgICAgKiBHYXAgYmV0d2VlbiBpdGVtcyBpbiB2ZXJ0aWNhbCBmbHlvdXRzLiBDYW4gYmUgb3ZlcnJpZGRlbiB3aXRoIHRoZSBcInNlcFwiXG4gICAgICogZWxlbWVudC5cbiAgICAgKi9cbiAgICB0aGlzLkdBUF9ZID0gdGhpcy5NQVJHSU4gKiAzO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIGZseW91dCdzIERPTS4gIE9ubHkgbmVlZHMgdG8gYmUgY2FsbGVkIG9uY2UuICBUaGUgZmx5b3V0IGNhblxuICAgKiBlaXRoZXIgZXhpc3QgYXMgaXRzIG93biBTVkcgZWxlbWVudCBvciBiZSBhIGcgZWxlbWVudCBuZXN0ZWQgaW5zaWRlIGFcbiAgICogc2VwYXJhdGUgU1ZHIGVsZW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSB0YWdOYW1lIFRoZSB0eXBlIG9mIHRhZyB0b1xuICAgKiAgICAgcHV0IHRoZSBmbHlvdXQgaW4uIFRoaXMgc2hvdWxkIGJlIDxzdmc+IG9yIDxnPi5cbiAgICogQHJldHVybnMgVGhlIGZseW91dCdzIFNWRyBncm91cC5cbiAgICovXG4gIGNyZWF0ZURvbSh0YWdOYW1lOiBzdHJpbmd8U3ZnPFNWR1NWR0VsZW1lbnQ+fFN2ZzxTVkdHRWxlbWVudD4pOiBTVkdFbGVtZW50IHtcbiAgICAvKlxuICAgICAgICA8c3ZnIHwgZz5cbiAgICAgICAgICA8cGF0aCBjbGFzcz1cImJsb2NrbHlGbHlvdXRCYWNrZ3JvdW5kXCIvPlxuICAgICAgICAgIDxnIGNsYXNzPVwiYmxvY2tseUZseW91dFwiPjwvZz5cbiAgICAgICAgPC8gc3ZnIHwgZz5cbiAgICAgICAgKi9cbiAgICAvLyBTZXR0aW5nIHN0eWxlIHRvIGRpc3BsYXk6bm9uZSB0byBzdGFydC4gVGhlIHRvb2xib3ggYW5kIGZseW91dFxuICAgIC8vIGhpZGUvc2hvdyBjb2RlIHdpbGwgc2V0IHVwIHByb3BlciB2aXNpYmlsaXR5IGFuZCBzaXplIGxhdGVyLlxuICAgIHRoaXMuc3ZnR3JvdXBfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoXG4gICAgICAgIHRhZ05hbWUsIHsnY2xhc3MnOiAnYmxvY2tseUZseW91dCcsICdzdHlsZSc6ICdkaXNwbGF5OiBub25lJ30pO1xuICAgIHRoaXMuc3ZnQmFja2dyb3VuZF8gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLlBBVEgsIHsnY2xhc3MnOiAnYmxvY2tseUZseW91dEJhY2tncm91bmQnfSwgdGhpcy5zdmdHcm91cF8pO1xuICAgIHRoaXMuc3ZnR3JvdXBfLmFwcGVuZENoaWxkKHRoaXMud29ya3NwYWNlXy5jcmVhdGVEb20oKSk7XG4gICAgdGhpcy53b3Jrc3BhY2VfLmdldFRoZW1lTWFuYWdlcigpLnN1YnNjcmliZShcbiAgICAgICAgdGhpcy5zdmdCYWNrZ3JvdW5kXywgJ2ZseW91dEJhY2tncm91bmRDb2xvdXInLCAnZmlsbCcpO1xuICAgIHRoaXMud29ya3NwYWNlXy5nZXRUaGVtZU1hbmFnZXIoKS5zdWJzY3JpYmUoXG4gICAgICAgIHRoaXMuc3ZnQmFja2dyb3VuZF8sICdmbHlvdXRPcGFjaXR5JywgJ2ZpbGwtb3BhY2l0eScpO1xuICAgIHJldHVybiB0aGlzLnN2Z0dyb3VwXztcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgZmx5b3V0LlxuICAgKlxuICAgKiBAcGFyYW0gdGFyZ2V0V29ya3NwYWNlIFRoZSB3b3Jrc3BhY2UgaW4gd2hpY2ggdG9cbiAgICogICAgIGNyZWF0ZSBuZXcgYmxvY2tzLlxuICAgKi9cbiAgaW5pdCh0YXJnZXRXb3Jrc3BhY2U6IFdvcmtzcGFjZVN2Zykge1xuICAgIHRoaXMudGFyZ2V0V29ya3NwYWNlID0gdGFyZ2V0V29ya3NwYWNlO1xuICAgIHRoaXMud29ya3NwYWNlXy50YXJnZXRXb3Jrc3BhY2UgPSB0YXJnZXRXb3Jrc3BhY2U7XG5cbiAgICB0aGlzLndvcmtzcGFjZV8uc2Nyb2xsYmFyID0gbmV3IFNjcm9sbGJhclBhaXIoXG4gICAgICAgIHRoaXMud29ya3NwYWNlXywgdGhpcy5ob3Jpem9udGFsTGF5b3V0LCAhdGhpcy5ob3Jpem9udGFsTGF5b3V0LFxuICAgICAgICAnYmxvY2tseUZseW91dFNjcm9sbGJhcicsIHRoaXMuU0NST0xMQkFSX01BUkdJTik7XG5cbiAgICB0aGlzLmhpZGUoKTtcblxuICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KFxuICAgICAgICB0aGlzLmV2ZW50V3JhcHBlcnNfLFxuICAgICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICAgICh0aGlzLnN2Z0dyb3VwXyBhcyBTVkdHRWxlbWVudCksICd3aGVlbCcsIHRoaXMsIHRoaXMud2hlZWxfKSk7XG4gICAgaWYgKCF0aGlzLmF1dG9DbG9zZSkge1xuICAgICAgdGhpcy5maWx0ZXJXcmFwcGVyXyA9IHRoaXMuZmlsdGVyRm9yQ2FwYWNpdHlfLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLnRhcmdldFdvcmtzcGFjZS5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLmZpbHRlcldyYXBwZXJfKTtcbiAgICB9XG5cbiAgICAvLyBEcmFnZ2luZyB0aGUgZmx5b3V0IHVwIGFuZCBkb3duLlxuICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KFxuICAgICAgICB0aGlzLmV2ZW50V3JhcHBlcnNfLFxuICAgICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgICAgICh0aGlzLnN2Z0JhY2tncm91bmRfIGFzIFNWR1BhdGhFbGVtZW50KSwgJ3BvaW50ZXJkb3duJywgdGhpcyxcbiAgICAgICAgICAgIHRoaXMub25Nb3VzZURvd25fKSk7XG5cbiAgICAvLyBBIGZseW91dCBjb25uZWN0ZWQgdG8gYSB3b3Jrc3BhY2UgZG9lc24ndCBoYXZlIGl0cyBvd24gY3VycmVudCBnZXN0dXJlLlxuICAgIHRoaXMud29ya3NwYWNlXy5nZXRHZXN0dXJlID1cbiAgICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UuZ2V0R2VzdHVyZS5iaW5kKHRoaXMudGFyZ2V0V29ya3NwYWNlKTtcblxuICAgIC8vIEdldCB2YXJpYWJsZXMgZnJvbSB0aGUgbWFpbiB3b3Jrc3BhY2UgcmF0aGVyIHRoYW4gdGhlIHRhcmdldCB3b3Jrc3BhY2UuXG4gICAgdGhpcy53b3Jrc3BhY2VfLnNldFZhcmlhYmxlTWFwKHRoaXMudGFyZ2V0V29ya3NwYWNlLmdldFZhcmlhYmxlTWFwKCkpO1xuXG4gICAgdGhpcy53b3Jrc3BhY2VfLmNyZWF0ZVBvdGVudGlhbFZhcmlhYmxlTWFwKCk7XG5cbiAgICB0YXJnZXRXb3Jrc3BhY2UuZ2V0Q29tcG9uZW50TWFuYWdlcigpLmFkZENvbXBvbmVudCh7XG4gICAgICBjb21wb25lbnQ6IHRoaXMsXG4gICAgICB3ZWlnaHQ6IDEsXG4gICAgICBjYXBhYmlsaXRpZXM6IFtcbiAgICAgICAgQ29tcG9uZW50TWFuYWdlci5DYXBhYmlsaXR5LkRFTEVURV9BUkVBLFxuICAgICAgICBDb21wb25lbnRNYW5hZ2VyLkNhcGFiaWxpdHkuRFJBR19UQVJHRVQsXG4gICAgICBdLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2YgdGhpcyBmbHlvdXQuXG4gICAqIFVubGluayBmcm9tIGFsbCBET00gZWxlbWVudHMgdG8gcHJldmVudCBtZW1vcnkgbGVha3MuXG4gICAqXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy5oaWRlKCk7XG4gICAgdGhpcy53b3Jrc3BhY2VfLmdldENvbXBvbmVudE1hbmFnZXIoKS5yZW1vdmVDb21wb25lbnQodGhpcy5pZCk7XG4gICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5ldmVudFdyYXBwZXJzXyk7XG4gICAgaWYgKHRoaXMuZmlsdGVyV3JhcHBlcl8pIHtcbiAgICAgIHRoaXMudGFyZ2V0V29ya3NwYWNlLnJlbW92ZUNoYW5nZUxpc3RlbmVyKHRoaXMuZmlsdGVyV3JhcHBlcl8pO1xuICAgICAgdGhpcy5maWx0ZXJXcmFwcGVyXyA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLndvcmtzcGFjZV8pIHtcbiAgICAgIHRoaXMud29ya3NwYWNlXy5nZXRUaGVtZU1hbmFnZXIoKS51bnN1YnNjcmliZSh0aGlzLnN2Z0JhY2tncm91bmRfISk7XG4gICAgICB0aGlzLndvcmtzcGFjZV8uZGlzcG9zZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdmdHcm91cF8pIHtcbiAgICAgIGRvbS5yZW1vdmVOb2RlKHRoaXMuc3ZnR3JvdXBfKTtcbiAgICAgIHRoaXMuc3ZnR3JvdXBfID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5zdmdCYWNrZ3JvdW5kXyA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB3aWR0aCBvZiB0aGUgZmx5b3V0LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgd2lkdGggb2YgdGhlIGZseW91dC5cbiAgICovXG4gIGdldFdpZHRoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMud2lkdGhfO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgaGVpZ2h0IG9mIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB3aWR0aCBvZiB0aGUgZmx5b3V0LlxuICAgKi9cbiAgZ2V0SGVpZ2h0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuaGVpZ2h0XztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHNjYWxlICh6b29tIGxldmVsKSBvZiB0aGUgZmx5b3V0LiBCeSBkZWZhdWx0LFxuICAgKiB0aGlzIG1hdGNoZXMgdGhlIHRhcmdldCB3b3Jrc3BhY2Ugc2NhbGUsIGJ1dCB0aGlzIGNhbiBiZSBvdmVycmlkZGVuLlxuICAgKlxuICAgKiBAcmV0dXJucyBGbHlvdXQgd29ya3NwYWNlIHNjYWxlLlxuICAgKi9cbiAgZ2V0Rmx5b3V0U2NhbGUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy50YXJnZXRXb3Jrc3BhY2Uuc2NhbGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB3b3Jrc3BhY2UgaW5zaWRlIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSB3b3Jrc3BhY2UgaW5zaWRlIHRoZSBmbHlvdXQuXG4gICAqL1xuICBnZXRXb3Jrc3BhY2UoKTogV29ya3NwYWNlU3ZnIHtcbiAgICByZXR1cm4gdGhpcy53b3Jrc3BhY2VfO1xuICB9XG5cbiAgLyoqXG4gICAqIElzIHRoZSBmbHlvdXQgdmlzaWJsZT9cbiAgICpcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB2aXNpYmxlLlxuICAgKi9cbiAgaXNWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzVmlzaWJsZV87XG4gIH1cblxuICAvKipcbiAgICogU2V0IHdoZXRoZXIgdGhlIGZseW91dCBpcyB2aXNpYmxlLiBBIHZhbHVlIG9mIHRydWUgZG9lcyBub3QgbmVjZXNzYXJpbHlcbiAgICogbWVhbiB0aGF0IHRoZSBmbHlvdXQgaXMgc2hvd24uIEl0IGNvdWxkIGJlIGhpZGRlbiBiZWNhdXNlIGl0cyBjb250YWluZXIgaXNcbiAgICogaGlkZGVuLlxuICAgKlxuICAgKiBAcGFyYW0gdmlzaWJsZSBUcnVlIGlmIHZpc2libGUuXG4gICAqL1xuICBzZXRWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB2aXNpYmlsaXR5Q2hhbmdlZCA9IHZpc2libGUgIT09IHRoaXMuaXNWaXNpYmxlKCk7XG5cbiAgICB0aGlzLmlzVmlzaWJsZV8gPSB2aXNpYmxlO1xuICAgIGlmICh2aXNpYmlsaXR5Q2hhbmdlZCkge1xuICAgICAgaWYgKCF0aGlzLmF1dG9DbG9zZSkge1xuICAgICAgICAvLyBBdXRvLWNsb3NlIGZseW91dHMgYXJlIGlnbm9yZWQgYXMgZHJhZyB0YXJnZXRzLCBzbyBvbmx5IG5vblxuICAgICAgICAvLyBhdXRvLWNsb3NlIGZseW91dHMgbmVlZCB0byBoYXZlIHRoZWlyIGRyYWcgdGFyZ2V0IHVwZGF0ZWQuXG4gICAgICAgIHRoaXMud29ya3NwYWNlXy5yZWNvcmREcmFnVGFyZ2V0cygpO1xuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVEaXNwbGF5XygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgd2hldGhlciB0aGlzIGZseW91dCdzIGNvbnRhaW5lciBpcyB2aXNpYmxlLlxuICAgKlxuICAgKiBAcGFyYW0gdmlzaWJsZSBXaGV0aGVyIHRoZSBjb250YWluZXIgaXMgdmlzaWJsZS5cbiAgICovXG4gIHNldENvbnRhaW5lclZpc2libGUodmlzaWJsZTogYm9vbGVhbikge1xuICAgIGNvbnN0IHZpc2liaWxpdHlDaGFuZ2VkID0gdmlzaWJsZSAhPT0gdGhpcy5jb250YWluZXJWaXNpYmxlXztcbiAgICB0aGlzLmNvbnRhaW5lclZpc2libGVfID0gdmlzaWJsZTtcbiAgICBpZiAodmlzaWJpbGl0eUNoYW5nZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheV8oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBkaXNwbGF5IHByb3BlcnR5IG9mIHRoZSBmbHlvdXQgYmFzZWQgd2hldGhlciBpdCB0aGlua3MgaXQgc2hvdWxkXG4gICAqIGJlIHZpc2libGUgYW5kIHdoZXRoZXIgaXRzIGNvbnRhaW5pbmcgd29ya3NwYWNlIGlzIHZpc2libGUuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZURpc3BsYXlfKCkge1xuICAgIGxldCBzaG93ID0gdHJ1ZTtcbiAgICBpZiAoIXRoaXMuY29udGFpbmVyVmlzaWJsZV8pIHtcbiAgICAgIHNob3cgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hvdyA9IHRoaXMuaXNWaXNpYmxlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnN2Z0dyb3VwXykge1xuICAgICAgdGhpcy5zdmdHcm91cF8uc3R5bGUuZGlzcGxheSA9IHNob3cgPyAnYmxvY2snIDogJ25vbmUnO1xuICAgIH1cbiAgICAvLyBVcGRhdGUgdGhlIHNjcm9sbGJhcidzIHZpc2liaWxpdHkgdG9vIHNpbmNlIGl0IHNob3VsZCBtaW1pYyB0aGVcbiAgICAvLyBmbHlvdXQncyB2aXNpYmlsaXR5LlxuICAgIHRoaXMud29ya3NwYWNlXy5zY3JvbGxiYXI/LnNldENvbnRhaW5lclZpc2libGUoc2hvdyk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSB2aWV3IGJhc2VkIG9uIGNvb3JkaW5hdGVzIGNhbGN1bGF0ZWQgaW4gcG9zaXRpb24oKS5cbiAgICpcbiAgICogQHBhcmFtIHdpZHRoIFRoZSBjb21wdXRlZCB3aWR0aCBvZiB0aGUgZmx5b3V0J3MgU1ZHIGdyb3VwXG4gICAqIEBwYXJhbSBoZWlnaHQgVGhlIGNvbXB1dGVkIGhlaWdodCBvZiB0aGUgZmx5b3V0J3MgU1ZHIGdyb3VwLlxuICAgKiBAcGFyYW0geCBUaGUgY29tcHV0ZWQgeCBvcmlnaW4gb2YgdGhlIGZseW91dCdzIFNWRyBncm91cC5cbiAgICogQHBhcmFtIHkgVGhlIGNvbXB1dGVkIHkgb3JpZ2luIG9mIHRoZSBmbHlvdXQncyBTVkcgZ3JvdXAuXG4gICAqL1xuICBwcm90ZWN0ZWQgcG9zaXRpb25BdF8od2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgdGhpcy5zdmdHcm91cF8/LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aC50b1N0cmluZygpKTtcbiAgICB0aGlzLnN2Z0dyb3VwXz8uc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQudG9TdHJpbmcoKSk7XG4gICAgdGhpcy53b3Jrc3BhY2VfLnNldENhY2hlZFBhcmVudFN2Z1NpemUod2lkdGgsIGhlaWdodCk7XG5cbiAgICBpZiAodGhpcy5zdmdHcm91cF8/LnRhZ05hbWUgPT09ICdzdmcnKSB7XG4gICAgICBjb25zdCB0cmFuc2Zvcm0gPSAndHJhbnNsYXRlKCcgKyB4ICsgJ3B4LCcgKyB5ICsgJ3B4KSc7XG4gICAgICBkb20uc2V0Q3NzVHJhbnNmb3JtKHRoaXMuc3ZnR3JvdXBfLCB0cmFuc2Zvcm0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJRSBhbmQgRWRnZSBkb24ndCBzdXBwb3J0IENTUyB0cmFuc2Zvcm1zIG9uIFNWRyBlbGVtZW50cyBzb1xuICAgICAgLy8gaXQncyBpbXBvcnRhbnQgdG8gc2V0IHRoZSB0cmFuc2Zvcm0gb24gdGhlIFNWRyBlbGVtZW50IGl0c2VsZlxuICAgICAgY29uc3QgdHJhbnNmb3JtID0gJ3RyYW5zbGF0ZSgnICsgeCArICcsJyArIHkgKyAnKSc7XG4gICAgICB0aGlzLnN2Z0dyb3VwXz8uc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCB0cmFuc2Zvcm0pO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgc2Nyb2xsYmFyIChpZiBvbmUgZXhpc3RzKS5cbiAgICBjb25zdCBzY3JvbGxiYXIgPSB0aGlzLndvcmtzcGFjZV8uc2Nyb2xsYmFyO1xuICAgIGlmIChzY3JvbGxiYXIpIHtcbiAgICAgIC8vIFNldCB0aGUgc2Nyb2xsYmFycyBvcmlnaW4gdG8gYmUgdGhlIHRvcCBsZWZ0IG9mIHRoZSBmbHlvdXQuXG4gICAgICBzY3JvbGxiYXIuc2V0T3JpZ2luKHgsIHkpO1xuICAgICAgc2Nyb2xsYmFyLnJlc2l6ZSgpO1xuICAgICAgLy8gSWYgb3JpZ2luIGNoYW5nZWQgYW5kIG1ldHJpY3MgaGF2ZW4ndCBjaGFuZ2VkIGVub3VnaCB0byB0cmlnZ2VyXG4gICAgICAvLyByZXBvc2l0aW9uIGluIHJlc2l6ZSwgd2UgbmVlZCB0byBjYWxsIHNldFBvc2l0aW9uLiBTZWUgaXNzdWUgIzQ2OTIuXG4gICAgICBpZiAoc2Nyb2xsYmFyLmhTY3JvbGwpIHtcbiAgICAgICAgc2Nyb2xsYmFyLmhTY3JvbGwuc2V0UG9zaXRpb24oXG4gICAgICAgICAgICBzY3JvbGxiYXIuaFNjcm9sbC5wb3NpdGlvbi54LCBzY3JvbGxiYXIuaFNjcm9sbC5wb3NpdGlvbi55KTtcbiAgICAgIH1cbiAgICAgIGlmIChzY3JvbGxiYXIudlNjcm9sbCkge1xuICAgICAgICBzY3JvbGxiYXIudlNjcm9sbC5zZXRQb3NpdGlvbihcbiAgICAgICAgICAgIHNjcm9sbGJhci52U2Nyb2xsLnBvc2l0aW9uLngsIHNjcm9sbGJhci52U2Nyb2xsLnBvc2l0aW9uLnkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIGFuZCBlbXB0eSB0aGUgZmx5b3V0LlxuICAgKi9cbiAgaGlkZSgpIHtcbiAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAvLyBEZWxldGUgYWxsIHRoZSBldmVudCBsaXN0ZW5lcnMuXG4gICAgZm9yIChsZXQgaSA9IDAsIGxpc3RlbjsgbGlzdGVuID0gdGhpcy5saXN0ZW5lcnNfW2ldOyBpKyspIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKGxpc3Rlbik7XG4gICAgfVxuICAgIHRoaXMubGlzdGVuZXJzXy5sZW5ndGggPSAwO1xuICAgIGlmICh0aGlzLnJlZmxvd1dyYXBwZXJfKSB7XG4gICAgICB0aGlzLndvcmtzcGFjZV8ucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5yZWZsb3dXcmFwcGVyXyk7XG4gICAgICB0aGlzLnJlZmxvd1dyYXBwZXJfID0gbnVsbDtcbiAgICB9XG4gIH1cbiAgLy8gRG8gTk9UIGRlbGV0ZSB0aGUgYmxvY2tzIGhlcmUuICBXYWl0IHVudGlsIEZseW91dC5zaG93LlxuICAvLyBodHRwczovL25laWwuZnJhc2VyLm5hbWUvbmV3cy8yMDE0LzA4LzA5L1xuXG4gIC8qKlxuICAgKiBTaG93IGFuZCBwb3B1bGF0ZSB0aGUgZmx5b3V0LlxuICAgKlxuICAgKiBAcGFyYW0gZmx5b3V0RGVmIENvbnRlbnRzIHRvIGRpc3BsYXlcbiAgICogICAgIGluIHRoZSBmbHlvdXQuIFRoaXMgaXMgZWl0aGVyIGFuIGFycmF5IG9mIE5vZGVzLCBhIE5vZGVMaXN0LCBhXG4gICAqICAgICB0b29sYm94IGRlZmluaXRpb24sIG9yIGEgc3RyaW5nIHdpdGggdGhlIG5hbWUgb2YgdGhlIGR5bmFtaWMgY2F0ZWdvcnkuXG4gICAqL1xuICBzaG93KGZseW91dERlZjogdG9vbGJveC5GbHlvdXREZWZpbml0aW9ufHN0cmluZykge1xuICAgIHRoaXMud29ya3NwYWNlXy5zZXRSZXNpemVzRW5hYmxlZChmYWxzZSk7XG4gICAgdGhpcy5oaWRlKCk7XG4gICAgdGhpcy5jbGVhck9sZEJsb2Nrc18oKTtcblxuICAgIC8vIEhhbmRsZSBkeW5hbWljIGNhdGVnb3JpZXMsIHJlcHJlc2VudGVkIGJ5IGEgbmFtZSBpbnN0ZWFkIG9mIGEgbGlzdC5cbiAgICBpZiAodHlwZW9mIGZseW91dERlZiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGZseW91dERlZiA9IHRoaXMuZ2V0RHluYW1pY0NhdGVnb3J5Q29udGVudHNfKGZseW91dERlZik7XG4gICAgfVxuICAgIHRoaXMuc2V0VmlzaWJsZSh0cnVlKTtcblxuICAgIC8vIFBhcnNlIHRoZSBBcnJheSwgTm9kZSBvciBOb2RlTGlzdCBpbnRvIGEgYSBsaXN0IG9mIGZseW91dCBpdGVtcy5cbiAgICBjb25zdCBwYXJzZWRDb250ZW50ID0gdG9vbGJveC5jb252ZXJ0Rmx5b3V0RGVmVG9Kc29uQXJyYXkoZmx5b3V0RGVmKTtcbiAgICBjb25zdCBmbHlvdXRJbmZvID0gdGhpcy5jcmVhdGVGbHlvdXRJbmZvXyhwYXJzZWRDb250ZW50KTtcblxuICAgIHRoaXMubGF5b3V0XyhmbHlvdXRJbmZvLmNvbnRlbnRzLCBmbHlvdXRJbmZvLmdhcHMpO1xuXG4gICAgLy8gSUUgMTEgaXMgYW4gaW5jb21wZXRlbnQgYnJvd3NlciB0aGF0IGZhaWxzIHRvIGZpcmUgbW91c2VvdXQgZXZlbnRzLlxuICAgIC8vIFdoZW4gdGhlIG1vdXNlIGlzIG92ZXIgdGhlIGJhY2tncm91bmQsIGRlc2VsZWN0IGFsbCBibG9ja3MuXG4gICAgZnVuY3Rpb24gZGVzZWxlY3RBbGwodGhpczogRmx5b3V0KSB7XG4gICAgICBjb25zdCB0b3BCbG9ja3MgPSB0aGlzLndvcmtzcGFjZV8uZ2V0VG9wQmxvY2tzKGZhbHNlKTtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSB0b3BCbG9ja3NbaV07IGkrKykge1xuICAgICAgICBibG9jay5yZW1vdmVTZWxlY3QoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmxpc3RlbmVyc18ucHVzaChicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgKHRoaXMuc3ZnQmFja2dyb3VuZF8gYXMgU1ZHUGF0aEVsZW1lbnQpLCAncG9pbnRlcm92ZXInLCB0aGlzLFxuICAgICAgICBkZXNlbGVjdEFsbCkpO1xuXG4gICAgaWYgKHRoaXMuaG9yaXpvbnRhbExheW91dCkge1xuICAgICAgdGhpcy5oZWlnaHRfID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy53aWR0aF8gPSAwO1xuICAgIH1cbiAgICB0aGlzLndvcmtzcGFjZV8uc2V0UmVzaXplc0VuYWJsZWQodHJ1ZSk7XG4gICAgdGhpcy5yZWZsb3coKTtcblxuICAgIHRoaXMuZmlsdGVyRm9yQ2FwYWNpdHlfKCk7XG5cbiAgICAvLyBDb3JyZWN0bHkgcG9zaXRpb24gdGhlIGZseW91dCdzIHNjcm9sbGJhciB3aGVuIGl0IG9wZW5zLlxuICAgIHRoaXMucG9zaXRpb24oKTtcblxuICAgIHRoaXMucmVmbG93V3JhcHBlcl8gPSB0aGlzLnJlZmxvdy5iaW5kKHRoaXMpO1xuICAgIHRoaXMud29ya3NwYWNlXy5hZGRDaGFuZ2VMaXN0ZW5lcih0aGlzLnJlZmxvd1dyYXBwZXJfKTtcbiAgICB0aGlzLmVtcHR5UmVjeWNsZWRCbG9ja3NfKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBjb250ZW50cyBhcnJheSBhbmQgZ2FwcyBhcnJheSBuZWNlc3NhcnkgdG8gY3JlYXRlIHRoZSBsYXlvdXQgZm9yXG4gICAqIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSBwYXJzZWRDb250ZW50IFRoZSBhcnJheVxuICAgKiAgICAgb2Ygb2JqZWN0cyB0byBzaG93IGluIHRoZSBmbHlvdXQuXG4gICAqIEByZXR1cm5zIFRoZSBsaXN0IG9mIGNvbnRlbnRzIGFuZCBnYXBzIG5lZWRlZCB0byBsYXkgb3V0IHRoZSBmbHlvdXQuXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZUZseW91dEluZm9fKHBhcnNlZENvbnRlbnQ6IHRvb2xib3guRmx5b3V0SXRlbUluZm9BcnJheSk6XG4gICAgICB7Y29udGVudHM6IEZseW91dEl0ZW1bXSwgZ2FwczogbnVtYmVyW119IHtcbiAgICBjb25zdCBjb250ZW50czogRmx5b3V0SXRlbVtdID0gW107XG4gICAgY29uc3QgZ2FwczogbnVtYmVyW10gPSBbXTtcbiAgICB0aGlzLnBlcm1hbmVudGx5RGlzYWJsZWRfLmxlbmd0aCA9IDA7XG4gICAgY29uc3QgZGVmYXVsdEdhcCA9IHRoaXMuaG9yaXpvbnRhbExheW91dCA/IHRoaXMuR0FQX1ggOiB0aGlzLkdBUF9ZO1xuICAgIGZvciAobGV0IGkgPSAwLCBjb250ZW50SW5mbzsgY29udGVudEluZm8gPSBwYXJzZWRDb250ZW50W2ldOyBpKyspIHtcbiAgICAgIGlmICgnY3VzdG9tJyBpbiBjb250ZW50SW5mbykge1xuICAgICAgICBjb25zdCBjdXN0b21JbmZvID0gKGNvbnRlbnRJbmZvIGFzIHRvb2xib3guRHluYW1pY0NhdGVnb3J5SW5mbyk7XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5TmFtZSA9IGN1c3RvbUluZm9bJ2N1c3RvbSddO1xuICAgICAgICBjb25zdCBmbHlvdXREZWYgPSB0aGlzLmdldER5bmFtaWNDYXRlZ29yeUNvbnRlbnRzXyhjYXRlZ29yeU5hbWUpO1xuICAgICAgICBjb25zdCBwYXJzZWREeW5hbWljQ29udGVudCA9XG4gICAgICAgICAgICB0b29sYm94LmNvbnZlcnRGbHlvdXREZWZUb0pzb25BcnJheShmbHlvdXREZWYpO1xuICAgICAgICAvLyBSZXBsYWNlIHRoZSBlbGVtZW50IGF0IGkgd2l0aCB0aGUgZHluYW1pYyBjb250ZW50IGl0IHJlcHJlc2VudHMuXG4gICAgICAgIHBhcnNlZENvbnRlbnQuc3BsaWNlLmFwcGx5KFxuICAgICAgICAgICAgcGFyc2VkQ29udGVudCwgW2ksIDEsIC4uLnBhcnNlZER5bmFtaWNDb250ZW50XSk7XG4gICAgICAgIGNvbnRlbnRJbmZvID0gcGFyc2VkQ29udGVudFtpXTtcbiAgICAgIH1cblxuICAgICAgc3dpdGNoIChjb250ZW50SW5mb1sna2luZCddLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgY2FzZSAnQkxPQ0snOiB7XG4gICAgICAgICAgY29uc3QgYmxvY2tJbmZvID0gKGNvbnRlbnRJbmZvIGFzIHRvb2xib3guQmxvY2tJbmZvKTtcbiAgICAgICAgICBjb25zdCBibG9jayA9IHRoaXMuY3JlYXRlRmx5b3V0QmxvY2tfKGJsb2NrSW5mbyk7XG4gICAgICAgICAgY29udGVudHMucHVzaCh7dHlwZTogRmx5b3V0SXRlbVR5cGUuQkxPQ0ssIGJsb2NrOiBibG9ja30pO1xuICAgICAgICAgIHRoaXMuYWRkQmxvY2tHYXBfKGJsb2NrSW5mbywgZ2FwcywgZGVmYXVsdEdhcCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnU0VQJzoge1xuICAgICAgICAgIGNvbnN0IHNlcEluZm8gPSAoY29udGVudEluZm8gYXMgdG9vbGJveC5TZXBhcmF0b3JJbmZvKTtcbiAgICAgICAgICB0aGlzLmFkZFNlcGFyYXRvckdhcF8oc2VwSW5mbywgZ2FwcywgZGVmYXVsdEdhcCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnTEFCRUwnOiB7XG4gICAgICAgICAgY29uc3QgbGFiZWxJbmZvID0gKGNvbnRlbnRJbmZvIGFzIHRvb2xib3guTGFiZWxJbmZvKTtcbiAgICAgICAgICAvLyBBIGxhYmVsIGlzIGEgYnV0dG9uIHdpdGggZGlmZmVyZW50IHN0eWxpbmcuXG4gICAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmNyZWF0ZUJ1dHRvbl8obGFiZWxJbmZvLCAvKiogaXNMYWJlbCAqLyB0cnVlKTtcbiAgICAgICAgICBjb250ZW50cy5wdXNoKHt0eXBlOiBGbHlvdXRJdGVtVHlwZS5CVVRUT04sIGJ1dHRvbjogbGFiZWx9KTtcbiAgICAgICAgICBnYXBzLnB1c2goZGVmYXVsdEdhcCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnQlVUVE9OJzoge1xuICAgICAgICAgIGNvbnN0IGJ1dHRvbkluZm8gPSAoY29udGVudEluZm8gYXMgdG9vbGJveC5CdXR0b25JbmZvKTtcbiAgICAgICAgICBjb25zdCBidXR0b24gPSB0aGlzLmNyZWF0ZUJ1dHRvbl8oYnV0dG9uSW5mbywgLyoqIGlzTGFiZWwgKi8gZmFsc2UpO1xuICAgICAgICAgIGNvbnRlbnRzLnB1c2goe3R5cGU6IEZseW91dEl0ZW1UeXBlLkJVVFRPTiwgYnV0dG9uOiBidXR0b259KTtcbiAgICAgICAgICBnYXBzLnB1c2goZGVmYXVsdEdhcCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtjb250ZW50czogY29udGVudHMsIGdhcHM6IGdhcHN9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGZseW91dCBkZWZpbml0aW9uIGZvciB0aGUgZHluYW1pYyBjYXRlZ29yeS5cbiAgICpcbiAgICogQHBhcmFtIGNhdGVnb3J5TmFtZSBUaGUgbmFtZSBvZiB0aGUgZHluYW1pYyBjYXRlZ29yeS5cbiAgICogQHJldHVybnMgVGhlIGRlZmluaXRpb24gb2YgdGhlXG4gICAqICAgICBmbHlvdXQgaW4gb25lIG9mIGl0cyBtYW55IGZvcm1zLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXREeW5hbWljQ2F0ZWdvcnlDb250ZW50c18oY2F0ZWdvcnlOYW1lOiBzdHJpbmcpOlxuICAgICAgdG9vbGJveC5GbHlvdXREZWZpbml0aW9uIHtcbiAgICAvLyBMb29rIHVwIHRoZSBjb3JyZWN0IGNhdGVnb3J5IGdlbmVyYXRpb24gZnVuY3Rpb24gYW5kIGNhbGwgdGhhdCB0byBnZXQgYVxuICAgIC8vIHZhbGlkIFhNTCBsaXN0LlxuICAgIGNvbnN0IGZuVG9BcHBseSA9XG4gICAgICAgIHRoaXMud29ya3NwYWNlXy50YXJnZXRXb3Jrc3BhY2UhLmdldFRvb2xib3hDYXRlZ29yeUNhbGxiYWNrKFxuICAgICAgICAgICAgY2F0ZWdvcnlOYW1lKTtcbiAgICBpZiAodHlwZW9mIGZuVG9BcHBseSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgVHlwZUVycm9yKFxuICAgICAgICAgICdDb3VsZG5cXCd0IGZpbmQgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIG9wZW5pbmcnICtcbiAgICAgICAgICAnIGEgdG9vbGJveCBjYXRlZ29yeS4nKTtcbiAgICB9XG4gICAgcmV0dXJuIGZuVG9BcHBseSh0aGlzLndvcmtzcGFjZV8udGFyZ2V0V29ya3NwYWNlISk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGZseW91dCBidXR0b24gb3IgYSBmbHlvdXQgbGFiZWwuXG4gICAqXG4gICAqIEBwYXJhbSBidG5JbmZvIFRoZSBvYmplY3QgaG9sZGluZyBpbmZvcm1hdGlvbiBhYm91dCBhIGJ1dHRvbiBvciBhIGxhYmVsLlxuICAgKiBAcGFyYW0gaXNMYWJlbCBUcnVlIGlmIHRoZSBidXR0b24gaXMgYSBsYWJlbCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IHVzZWQgdG8gZGlzcGxheSB0aGUgYnV0dG9uIGluIHRoZVxuICAgKiAgICBmbHlvdXQuXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZUJ1dHRvbl8oYnRuSW5mbzogdG9vbGJveC5CdXR0b25PckxhYmVsSW5mbywgaXNMYWJlbDogYm9vbGVhbik6XG4gICAgICBGbHlvdXRCdXR0b24ge1xuICAgIGNvbnN0IGN1ckJ1dHRvbiA9IG5ldyBGbHlvdXRCdXR0b24oXG4gICAgICAgIHRoaXMud29ya3NwYWNlXywgKHRoaXMudGFyZ2V0V29ya3NwYWNlIGFzIFdvcmtzcGFjZVN2ZyksIGJ0bkluZm8sXG4gICAgICAgIGlzTGFiZWwpO1xuICAgIHJldHVybiBjdXJCdXR0b247XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgYmxvY2sgZnJvbSB0aGUgeG1sIGFuZCBwZXJtYW5lbnRseSBkaXNhYmxlIGFueSBibG9ja3MgdGhhdCB3ZXJlXG4gICAqIGRlZmluZWQgYXMgZGlzYWJsZWQuXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja0luZm8gVGhlIGluZm8gb2YgdGhlIGJsb2NrLlxuICAgKiBAcmV0dXJucyBUaGUgYmxvY2sgY3JlYXRlZCBmcm9tIHRoZSBibG9ja0luZm8uXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZUZseW91dEJsb2NrXyhibG9ja0luZm86IHRvb2xib3guQmxvY2tJbmZvKTogQmxvY2tTdmcge1xuICAgIGxldCBibG9jaztcbiAgICBpZiAoYmxvY2tJbmZvWydibG9ja3htbCddKSB7XG4gICAgICBjb25zdCB4bWwgPSAodHlwZW9mIGJsb2NrSW5mb1snYmxvY2t4bWwnXSA9PT0gJ3N0cmluZycgP1xuICAgICAgICAgICAgICAgICAgICAgICBYbWwudGV4dFRvRG9tKGJsb2NrSW5mb1snYmxvY2t4bWwnXSkgOlxuICAgICAgICAgICAgICAgICAgICAgICBibG9ja0luZm9bJ2Jsb2NreG1sJ10pIGFzIEVsZW1lbnQ7XG4gICAgICBibG9jayA9IHRoaXMuZ2V0UmVjeWNsZWRCbG9ja18oeG1sLmdldEF0dHJpYnV0ZSgndHlwZScpISk7XG4gICAgICBpZiAoIWJsb2NrKSB7XG4gICAgICAgIGJsb2NrID0gWG1sLmRvbVRvQmxvY2soeG1sLCB0aGlzLndvcmtzcGFjZV8pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBibG9jayA9IHRoaXMuZ2V0UmVjeWNsZWRCbG9ja18oYmxvY2tJbmZvWyd0eXBlJ10hKTtcbiAgICAgIGlmICghYmxvY2spIHtcbiAgICAgICAgaWYgKGJsb2NrSW5mb1snZW5hYmxlZCddID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBibG9ja0luZm9bJ2VuYWJsZWQnXSA9IGJsb2NrSW5mb1snZGlzYWJsZWQnXSAhPT0gJ3RydWUnICYmXG4gICAgICAgICAgICAgIGJsb2NrSW5mb1snZGlzYWJsZWQnXSAhPT0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBibG9jayA9IGJsb2Nrcy5hcHBlbmQoKGJsb2NrSW5mbyBhcyBibG9ja3MuU3RhdGUpLCB0aGlzLndvcmtzcGFjZV8pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghYmxvY2suaXNFbmFibGVkKCkpIHtcbiAgICAgIC8vIFJlY29yZCBibG9ja3MgdGhhdCB3ZXJlIGluaXRpYWxseSBkaXNhYmxlZC5cbiAgICAgIC8vIERvIG5vdCBlbmFibGUgdGhlc2UgYmxvY2tzIGFzIGEgcmVzdWx0IG9mIGNhcGFjaXR5IGZpbHRlcmluZy5cbiAgICAgIHRoaXMucGVybWFuZW50bHlEaXNhYmxlZF8ucHVzaChibG9jayk7XG4gICAgfVxuICAgIHJldHVybiAoYmxvY2sgYXMgQmxvY2tTdmcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBibG9jayBmcm9tIHRoZSBhcnJheSBvZiByZWN5Y2xlZCBibG9ja3Mgd2l0aCB0aGUgZ2l2ZW4gdHlwZSwgb3JcbiAgICogdW5kZWZpbmVkIGlmIG9uZSBjYW5ub3QgYmUgZm91bmQuXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja1R5cGUgVGhlIHR5cGUgb2YgdGhlIGJsb2NrIHRvIHRyeSB0byByZWN5Y2xlLlxuICAgKiBAcmV0dXJucyBUaGUgcmVjeWNsZWQgYmxvY2ssIG9yIHVuZGVmaW5lZCBpZlxuICAgKiAgICAgb25lIGNvdWxkIG5vdCBiZSByZWN5Y2xlZC5cbiAgICovXG4gIHByaXZhdGUgZ2V0UmVjeWNsZWRCbG9ja18oYmxvY2tUeXBlOiBzdHJpbmcpOiBCbG9ja1N2Z3x1bmRlZmluZWQge1xuICAgIGxldCBpbmRleCA9IC0xO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5yZWN5Y2xlZEJsb2Nrc18ubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLnJlY3ljbGVkQmxvY2tzX1tpXS50eXBlID09PSBibG9ja1R5cGUpIHtcbiAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGluZGV4ID09PSAtMSA/IHVuZGVmaW5lZCA6IHRoaXMucmVjeWNsZWRCbG9ja3NfLnNwbGljZShpbmRleCwgMSlbMF07XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIGdhcCBpbiB0aGUgZmx5b3V0IGJhc2VkIG9uIGJsb2NrIGluZm8uXG4gICAqXG4gICAqIEBwYXJhbSBibG9ja0luZm8gSW5mb3JtYXRpb24gYWJvdXQgYSBibG9jay5cbiAgICogQHBhcmFtIGdhcHMgVGhlIGxpc3Qgb2YgZ2FwcyBiZXR3ZWVuIGl0ZW1zIGluIHRoZSBmbHlvdXQuXG4gICAqIEBwYXJhbSBkZWZhdWx0R2FwIFRoZSBkZWZhdWx0IGdhcCBiZXR3ZWVuIG9uZSBlbGVtZW50IGFuZCB0aGVcbiAgICogICAgIG5leHQuXG4gICAqL1xuICBwcml2YXRlIGFkZEJsb2NrR2FwXyhcbiAgICAgIGJsb2NrSW5mbzogdG9vbGJveC5CbG9ja0luZm8sIGdhcHM6IG51bWJlcltdLCBkZWZhdWx0R2FwOiBudW1iZXIpIHtcbiAgICBsZXQgZ2FwO1xuICAgIGlmIChibG9ja0luZm9bJ2dhcCddKSB7XG4gICAgICBnYXAgPSBwYXJzZUludChibG9ja0luZm9bJ2dhcCddLnRvU3RyaW5nKCkpO1xuICAgIH0gZWxzZSBpZiAoYmxvY2tJbmZvWydibG9ja3htbCddKSB7XG4gICAgICBjb25zdCB4bWwgPSAodHlwZW9mIGJsb2NrSW5mb1snYmxvY2t4bWwnXSA9PT0gJ3N0cmluZycgP1xuICAgICAgICAgICAgICAgICAgICAgICBYbWwudGV4dFRvRG9tKGJsb2NrSW5mb1snYmxvY2t4bWwnXSkgOlxuICAgICAgICAgICAgICAgICAgICAgICBibG9ja0luZm9bJ2Jsb2NreG1sJ10pIGFzIEVsZW1lbnQ7XG4gICAgICBnYXAgPSBwYXJzZUludCh4bWwuZ2V0QXR0cmlidXRlKCdnYXAnKSEpO1xuICAgIH1cbiAgICBnYXBzLnB1c2goIWdhcCB8fCBpc05hTihnYXApID8gZGVmYXVsdEdhcCA6IGdhcCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHRoZSBuZWNlc3NhcnkgZ2FwIGluIHRoZSBmbHlvdXQgZm9yIGEgc2VwYXJhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gc2VwSW5mbyBUaGUgb2JqZWN0IGhvbGRpbmdcbiAgICogICAgaW5mb3JtYXRpb24gYWJvdXQgYSBzZXBhcmF0b3IuXG4gICAqIEBwYXJhbSBnYXBzIFRoZSBsaXN0IGdhcHMgYmV0d2VlbiBpdGVtcyBpbiB0aGUgZmx5b3V0LlxuICAgKiBAcGFyYW0gZGVmYXVsdEdhcCBUaGUgZGVmYXVsdCBnYXAgYmV0d2VlbiB0aGUgYnV0dG9uIGFuZCBuZXh0XG4gICAqICAgICBlbGVtZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBhZGRTZXBhcmF0b3JHYXBfKFxuICAgICAgc2VwSW5mbzogdG9vbGJveC5TZXBhcmF0b3JJbmZvLCBnYXBzOiBudW1iZXJbXSwgZGVmYXVsdEdhcDogbnVtYmVyKSB7XG4gICAgLy8gQ2hhbmdlIHRoZSBnYXAgYmV0d2VlbiB0d28gdG9vbGJveCBlbGVtZW50cy5cbiAgICAvLyA8c2VwIGdhcD1cIjM2XCI+PC9zZXA+XG4gICAgLy8gVGhlIGRlZmF1bHQgZ2FwIGlzIDI0LCBjYW4gYmUgc2V0IGxhcmdlciBvciBzbWFsbGVyLlxuICAgIC8vIFRoaXMgb3ZlcndyaXRlcyB0aGUgZ2FwIGF0dHJpYnV0ZSBvbiB0aGUgcHJldmlvdXMgZWxlbWVudC5cbiAgICBjb25zdCBuZXdHYXAgPSBwYXJzZUludChzZXBJbmZvWydnYXAnXSEudG9TdHJpbmcoKSk7XG4gICAgLy8gSWdub3JlIGdhcHMgYmVmb3JlIHRoZSBmaXJzdCBibG9jay5cbiAgICBpZiAoIWlzTmFOKG5ld0dhcCkgJiYgZ2Fwcy5sZW5ndGggPiAwKSB7XG4gICAgICBnYXBzW2dhcHMubGVuZ3RoIC0gMV0gPSBuZXdHYXA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdhcHMucHVzaChkZWZhdWx0R2FwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIGJsb2NrcywgbWF0cyBhbmQgYnV0dG9ucyBmcm9tIGEgcHJldmlvdXMgc2hvd2luZyBvZiB0aGUgZmx5b3V0LlxuICAgKi9cbiAgcHJpdmF0ZSBjbGVhck9sZEJsb2Nrc18oKSB7XG4gICAgLy8gRGVsZXRlIGFueSBibG9ja3MgZnJvbSBhIHByZXZpb3VzIHNob3dpbmcuXG4gICAgY29uc3Qgb2xkQmxvY2tzID0gdGhpcy53b3Jrc3BhY2VfLmdldFRvcEJsb2NrcyhmYWxzZSk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IG9sZEJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5ibG9ja0lzUmVjeWNsYWJsZV8oYmxvY2spKSB7XG4gICAgICAgIHRoaXMucmVjeWNsZUJsb2NrXyhibG9jayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBibG9jay5kaXNwb3NlKGZhbHNlLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIERlbGV0ZSBhbnkgbWF0cyBmcm9tIGEgcHJldmlvdXMgc2hvd2luZy5cbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMubWF0c18ubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLm1hdHNfW2pdO1xuICAgICAgaWYgKHJlY3QpIHtcbiAgICAgICAgVG9vbHRpcC51bmJpbmRNb3VzZUV2ZW50cyhyZWN0KTtcbiAgICAgICAgZG9tLnJlbW92ZU5vZGUocmVjdCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMubWF0c18ubGVuZ3RoID0gMDtcbiAgICAvLyBEZWxldGUgYW55IGJ1dHRvbnMgZnJvbSBhIHByZXZpb3VzIHNob3dpbmcuXG4gICAgZm9yIChsZXQgaSA9IDAsIGJ1dHRvbjsgYnV0dG9uID0gdGhpcy5idXR0b25zX1tpXTsgaSsrKSB7XG4gICAgICBidXR0b24uZGlzcG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLmJ1dHRvbnNfLmxlbmd0aCA9IDA7XG5cbiAgICAvLyBDbGVhciBwb3RlbnRpYWwgdmFyaWFibGVzIGZyb20gdGhlIHByZXZpb3VzIHNob3dpbmcuXG4gICAgdGhpcy53b3Jrc3BhY2VfLmdldFBvdGVudGlhbFZhcmlhYmxlTWFwKCk/LmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICogRW1wdGllcyBhbGwgb2YgdGhlIHJlY3ljbGVkIGJsb2NrcywgcHJvcGVybHkgZGlzcG9zaW5nIG9mIHRoZW0uXG4gICAqL1xuICBwcml2YXRlIGVtcHR5UmVjeWNsZWRCbG9ja3NfKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5yZWN5Y2xlZEJsb2Nrc18ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMucmVjeWNsZWRCbG9ja3NfW2ldLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgdGhpcy5yZWN5Y2xlZEJsb2Nrc18gPSBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGdpdmVuIGJsb2NrIGNhbiBiZSByZWN5Y2xlZCBvciBub3QuXG4gICAqXG4gICAqIEBwYXJhbSBfYmxvY2sgVGhlIGJsb2NrIHRvIGNoZWNrIGZvciByZWN5Y2xhYmlsaXR5LlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBibG9jayBjYW4gYmUgcmVjeWNsZWQuIEZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIHByb3RlY3RlZCBibG9ja0lzUmVjeWNsYWJsZV8oX2Jsb2NrOiBCbG9ja1N2Zyk6IGJvb2xlYW4ge1xuICAgIC8vIEJ5IGRlZmF1bHQsIHJlY3ljbGluZyBpcyBkaXNhYmxlZC5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogUHV0cyBhIHByZXZpb3VzbHkgY3JlYXRlZCBibG9jayBpbnRvIHRoZSByZWN5Y2xlIGJpbiBhbmQgbW92ZXMgaXQgdG8gdGhlXG4gICAqIHRvcCBvZiB0aGUgd29ya3NwYWNlLiBVc2VkIGR1cmluZyBsYXJnZSB3b3Jrc3BhY2Ugc3dhcHMgdG8gbGltaXQgdGhlIG51bWJlclxuICAgKiBvZiBuZXcgRE9NIGVsZW1lbnRzIHdlIG5lZWQgdG8gY3JlYXRlLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIHJlY3ljbGUuXG4gICAqL1xuICBwcml2YXRlIHJlY3ljbGVCbG9ja18oYmxvY2s6IEJsb2NrU3ZnKSB7XG4gICAgY29uc3QgeHkgPSBibG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgYmxvY2subW92ZUJ5KC14eS54LCAteHkueSk7XG4gICAgdGhpcy5yZWN5Y2xlZEJsb2Nrc18ucHVzaChibG9jayk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGxpc3RlbmVycyB0byBhIGJsb2NrIHRoYXQgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIHJvb3QgVGhlIHJvb3Qgbm9kZSBvZiB0aGUgU1ZHIGdyb3VwIHRoZSBibG9jayBpcyBpbi5cbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBhZGQgbGlzdGVuZXJzIGZvci5cbiAgICogQHBhcmFtIHJlY3QgVGhlIGludmlzaWJsZSByZWN0YW5nbGUgdW5kZXIgdGhlIGJsb2NrIHRoYXQgYWN0c1xuICAgKiAgICAgYXMgYSBtYXQgZm9yIHRoYXQgYmxvY2suXG4gICAqL1xuICBwcm90ZWN0ZWQgYWRkQmxvY2tMaXN0ZW5lcnNfKFxuICAgICAgcm9vdDogU1ZHRWxlbWVudCwgYmxvY2s6IEJsb2NrU3ZnLCByZWN0OiBTVkdFbGVtZW50KSB7XG4gICAgdGhpcy5saXN0ZW5lcnNfLnB1c2goYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIHJvb3QsICdwb2ludGVyZG93bicsIG51bGwsIHRoaXMuYmxvY2tNb3VzZURvd25fKGJsb2NrKSkpO1xuICAgIHRoaXMubGlzdGVuZXJzXy5wdXNoKGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICByZWN0LCAncG9pbnRlcmRvd24nLCBudWxsLCB0aGlzLmJsb2NrTW91c2VEb3duXyhibG9jaykpKTtcbiAgICB0aGlzLmxpc3RlbmVyc18ucHVzaChcbiAgICAgICAgYnJvd3NlckV2ZW50cy5iaW5kKHJvb3QsICdwb2ludGVyZW50ZXInLCBibG9jaywgYmxvY2suYWRkU2VsZWN0KSk7XG4gICAgdGhpcy5saXN0ZW5lcnNfLnB1c2goXG4gICAgICAgIGJyb3dzZXJFdmVudHMuYmluZChyb290LCAncG9pbnRlcmxlYXZlJywgYmxvY2ssIGJsb2NrLnJlbW92ZVNlbGVjdCkpO1xuICAgIHRoaXMubGlzdGVuZXJzXy5wdXNoKFxuICAgICAgICBicm93c2VyRXZlbnRzLmJpbmQocmVjdCwgJ3BvaW50ZXJlbnRlcicsIGJsb2NrLCBibG9jay5hZGRTZWxlY3QpKTtcbiAgICB0aGlzLmxpc3RlbmVyc18ucHVzaChcbiAgICAgICAgYnJvd3NlckV2ZW50cy5iaW5kKHJlY3QsICdwb2ludGVybGVhdmUnLCBibG9jaywgYmxvY2sucmVtb3ZlU2VsZWN0KSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgcG9pbnRlcmRvd24gb24gYW4gU1ZHIGJsb2NrIGluIGEgbm9uLWNsb3NpbmcgZmx5b3V0LlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGZseW91dCBibG9jayB0byBjb3B5LlxuICAgKiBAcmV0dXJucyBGdW5jdGlvbiB0byBjYWxsIHdoZW4gYmxvY2sgaXMgY2xpY2tlZC5cbiAgICovXG4gIHByaXZhdGUgYmxvY2tNb3VzZURvd25fKGJsb2NrOiBCbG9ja1N2Zyk6IEZ1bmN0aW9uIHtcbiAgICByZXR1cm4gKGU6IFBvaW50ZXJFdmVudCkgPT4ge1xuICAgICAgY29uc3QgZ2VzdHVyZSA9IHRoaXMudGFyZ2V0V29ya3NwYWNlLmdldEdlc3R1cmUoZSk7XG4gICAgICBpZiAoZ2VzdHVyZSkge1xuICAgICAgICBnZXN0dXJlLnNldFN0YXJ0QmxvY2soYmxvY2spO1xuICAgICAgICBnZXN0dXJlLmhhbmRsZUZseW91dFN0YXJ0KGUsIHRoaXMpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUG9pbnRlciBkb3duIG9uIHRoZSBmbHlvdXQgYmFja2dyb3VuZC4gIFN0YXJ0IGEgdmVydGljYWwgc2Nyb2xsIGRyYWcuXG4gICAqXG4gICAqIEBwYXJhbSBlIFBvaW50ZXIgZG93biBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25Nb3VzZURvd25fKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIGNvbnN0IGdlc3R1cmUgPSB0aGlzLnRhcmdldFdvcmtzcGFjZS5nZXRHZXN0dXJlKGUpO1xuICAgIGlmIChnZXN0dXJlKSB7XG4gICAgICBnZXN0dXJlLmhhbmRsZUZseW91dFN0YXJ0KGUsIHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEb2VzIHRoaXMgZmx5b3V0IGFsbG93IHlvdSB0byBjcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIGdpdmVuIGJsb2NrP1xuICAgKiBVc2VkIGZvciBkZWNpZGluZyBpZiBhIGJsb2NrIGNhbiBiZSBcImRyYWdnZWQgb3V0IG9mXCIgdGhlIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBjb3B5IGZyb20gdGhlIGZseW91dC5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB5b3UgY2FuIGNyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgYmxvY2ssIGZhbHNlXG4gICAqICAgIG90aGVyd2lzZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc0Jsb2NrQ3JlYXRhYmxlKGJsb2NrOiBCbG9ja1N2Zyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBibG9jay5pc0VuYWJsZWQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBjb3B5IG9mIHRoaXMgYmxvY2sgb24gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHBhcmFtIG9yaWdpbmFsQmxvY2sgVGhlIGJsb2NrIHRvIGNvcHkgZnJvbSB0aGUgZmx5b3V0LlxuICAgKiBAcmV0dXJucyBUaGUgbmV3bHkgY3JlYXRlZCBibG9jay5cbiAgICogQHRocm93cyB7RXJyb3J9IGlmIHNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggZGVzZXJpYWxpemF0aW9uLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNyZWF0ZUJsb2NrKG9yaWdpbmFsQmxvY2s6IEJsb2NrU3ZnKTogQmxvY2tTdmcge1xuICAgIGxldCBuZXdCbG9jayA9IG51bGw7XG4gICAgZXZlbnRVdGlscy5kaXNhYmxlKCk7XG4gICAgY29uc3QgdmFyaWFibGVzQmVmb3JlQ3JlYXRpb24gPSB0aGlzLnRhcmdldFdvcmtzcGFjZS5nZXRBbGxWYXJpYWJsZXMoKTtcbiAgICB0aGlzLnRhcmdldFdvcmtzcGFjZS5zZXRSZXNpemVzRW5hYmxlZChmYWxzZSk7XG4gICAgdHJ5IHtcbiAgICAgIG5ld0Jsb2NrID0gdGhpcy5wbGFjZU5ld0Jsb2NrXyhvcmlnaW5hbEJsb2NrKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgZXZlbnRVdGlscy5lbmFibGUoKTtcbiAgICB9XG5cbiAgICAvLyBDbG9zZSB0aGUgZmx5b3V0LlxuICAgIHRoaXMudGFyZ2V0V29ya3NwYWNlLmhpZGVDaGFmZigpO1xuXG4gICAgY29uc3QgbmV3VmFyaWFibGVzID0gVmFyaWFibGVzLmdldEFkZGVkVmFyaWFibGVzKFxuICAgICAgICB0aGlzLnRhcmdldFdvcmtzcGFjZSwgdmFyaWFibGVzQmVmb3JlQ3JlYXRpb24pO1xuXG4gICAgaWYgKGV2ZW50VXRpbHMuaXNFbmFibGVkKCkpIHtcbiAgICAgIGV2ZW50VXRpbHMuc2V0R3JvdXAodHJ1ZSk7XG4gICAgICAvLyBGaXJlIGEgVmFyQ3JlYXRlIGV2ZW50IGZvciBlYWNoIChpZiBhbnkpIG5ldyB2YXJpYWJsZSBjcmVhdGVkLlxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdWYXJpYWJsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgdGhpc1ZhcmlhYmxlID0gbmV3VmFyaWFibGVzW2ldO1xuICAgICAgICBldmVudFV0aWxzLmZpcmUoXG4gICAgICAgICAgICBuZXcgKGV2ZW50VXRpbHMuZ2V0KGV2ZW50VXRpbHMuVkFSX0NSRUFURSkpKHRoaXNWYXJpYWJsZSkpO1xuICAgICAgfVxuXG4gICAgICAvLyBCbG9jayBldmVudHMgY29tZSBhZnRlciB2YXIgZXZlbnRzLCBpbiBjYXNlIHRoZXkgcmVmZXIgdG8gbmV3bHkgY3JlYXRlZFxuICAgICAgLy8gdmFyaWFibGVzLlxuICAgICAgZXZlbnRVdGlscy5maXJlKG5ldyAoZXZlbnRVdGlscy5nZXQoZXZlbnRVdGlscy5CTE9DS19DUkVBVEUpKShuZXdCbG9jaykpO1xuICAgIH1cbiAgICBpZiAodGhpcy5hdXRvQ2xvc2UpIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmZpbHRlckZvckNhcGFjaXR5XygpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3QmxvY2s7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgZ2l2ZW4gYnV0dG9uOiBtb3ZlIGl0IHRvIHRoZSBjb3JyZWN0IGxvY2F0aW9uLFxuICAgKiBhZGQgbGlzdGVuZXJzLCBldGMuXG4gICAqXG4gICAqIEBwYXJhbSBidXR0b24gVGhlIGJ1dHRvbiB0byBpbml0aWFsaXplIGFuZCBwbGFjZS5cbiAgICogQHBhcmFtIHggVGhlIHggcG9zaXRpb24gb2YgdGhlIGN1cnNvciBkdXJpbmcgdGhpcyBsYXlvdXQgcGFzcy5cbiAgICogQHBhcmFtIHkgVGhlIHkgcG9zaXRpb24gb2YgdGhlIGN1cnNvciBkdXJpbmcgdGhpcyBsYXlvdXQgcGFzcy5cbiAgICovXG4gIHByb3RlY3RlZCBpbml0Rmx5b3V0QnV0dG9uXyhidXR0b246IEZseW91dEJ1dHRvbiwgeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICBjb25zdCBidXR0b25TdmcgPSBidXR0b24uY3JlYXRlRG9tKCk7XG4gICAgYnV0dG9uLm1vdmVUbyh4LCB5KTtcbiAgICBidXR0b24uc2hvdygpO1xuICAgIC8vIENsaWNraW5nIG9uIGEgZmx5b3V0IGJ1dHRvbiBvciBsYWJlbCBpcyBhIGxvdCBsaWtlIGNsaWNraW5nIG9uIHRoZVxuICAgIC8vIGZseW91dCBiYWNrZ3JvdW5kLlxuICAgIHRoaXMubGlzdGVuZXJzXy5wdXNoKGJyb3dzZXJFdmVudHMuY29uZGl0aW9uYWxCaW5kKFxuICAgICAgICBidXR0b25TdmcsICdwb2ludGVyZG93bicsIHRoaXMsIHRoaXMub25Nb3VzZURvd25fKSk7XG5cbiAgICB0aGlzLmJ1dHRvbnNfLnB1c2goYnV0dG9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW5kIHBsYWNlIGEgcmVjdGFuZ2xlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGJsb2NrLlxuICAgKlxuICAgKiBAcGFyYW0gYmxvY2sgVGhlIGJsb2NrIHRvIGFzc29jaWF0ZSB0aGUgcmVjdCB0by5cbiAgICogQHBhcmFtIHggVGhlIHggcG9zaXRpb24gb2YgdGhlIGN1cnNvciBkdXJpbmcgdGhpcyBsYXlvdXQgcGFzcy5cbiAgICogQHBhcmFtIHkgVGhlIHkgcG9zaXRpb24gb2YgdGhlIGN1cnNvciBkdXJpbmcgdGhpcyBsYXlvdXQgcGFzcy5cbiAgICogQHBhcmFtIGJsb2NrSFcgVGhlIGhlaWdodCBhbmQgd2lkdGggb2ZcbiAgICogICAgIHRoZSBibG9jay5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCBpbnRvIHRoZSBtYXRzIGxpc3Qgd2hlcmUgdGhpcyByZWN0IHNob3VsZFxuICAgKiAgICAgYmUgcGxhY2VkLlxuICAgKiBAcmV0dXJucyBOZXdseSBjcmVhdGVkIFNWRyBlbGVtZW50IGZvciB0aGUgcmVjdGFuZ2xlIGJlaGluZFxuICAgKiAgICAgdGhlIGJsb2NrLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZVJlY3RfKFxuICAgICAgYmxvY2s6IEJsb2NrU3ZnLCB4OiBudW1iZXIsIHk6IG51bWJlcixcbiAgICAgIGJsb2NrSFc6IHtoZWlnaHQ6IG51bWJlciwgd2lkdGg6IG51bWJlcn0sIGluZGV4OiBudW1iZXIpOiBTVkdFbGVtZW50IHtcbiAgICAvLyBDcmVhdGUgYW4gaW52aXNpYmxlIHJlY3RhbmdsZSB1bmRlciB0aGUgYmxvY2sgdG8gYWN0IGFzIGEgYnV0dG9uLiAgSnVzdFxuICAgIC8vIHVzaW5nIHRoZSBibG9jayBhcyBhIGJ1dHRvbiBpcyBwb29yLCBzaW5jZSBibG9ja3MgaGF2ZSBob2xlcyBpbiB0aGVtLlxuICAgIGNvbnN0IHJlY3QgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChTdmcuUkVDVCwge1xuICAgICAgJ2ZpbGwtb3BhY2l0eSc6IDAsXG4gICAgICAneCc6IHgsXG4gICAgICAneSc6IHksXG4gICAgICAnaGVpZ2h0JzogYmxvY2tIVy5oZWlnaHQsXG4gICAgICAnd2lkdGgnOiBibG9ja0hXLndpZHRoLFxuICAgIH0pO1xuICAgIChyZWN0IGFzIEFueUR1cmluZ01pZ3JhdGlvbikudG9vbHRpcCA9IGJsb2NrO1xuICAgIFRvb2x0aXAuYmluZE1vdXNlRXZlbnRzKHJlY3QpO1xuICAgIC8vIEFkZCB0aGUgcmVjdGFuZ2xlcyB1bmRlciB0aGUgYmxvY2tzLCBzbyB0aGF0IHRoZSBibG9ja3MnIHRvb2x0aXBzIHdvcmsuXG4gICAgdGhpcy53b3Jrc3BhY2VfLmdldENhbnZhcygpLmluc2VydEJlZm9yZShyZWN0LCBibG9jay5nZXRTdmdSb290KCkpO1xuXG4gICAgdGhpcy5yZWN0TWFwXy5zZXQoYmxvY2ssIHJlY3QpO1xuICAgIHRoaXMubWF0c19baW5kZXhdID0gcmVjdDtcbiAgICByZXR1cm4gcmVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgcmVjdGFuZ2xlIHRvIHNpdCBleGFjdGx5IGJlaGluZCBhIGJsb2NrLCB0YWtpbmcgaW50byBhY2NvdW50IHRhYnMsXG4gICAqIGhhdHMsIGFuZCBhbnkgb3RoZXIgcHJvdHJ1c2lvbnMgd2UgaW52ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gcmVjdCBUaGUgcmVjdGFuZ2xlIHRvIG1vdmUgZGlyZWN0bHkgYmVoaW5kIHRoZSBibG9jay5cbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0aGUgcmVjdGFuZ2xlIHNob3VsZCBiZSBiZWhpbmQuXG4gICAqL1xuICBwcm90ZWN0ZWQgbW92ZVJlY3RUb0Jsb2NrXyhyZWN0OiBTVkdFbGVtZW50LCBibG9jazogQmxvY2tTdmcpIHtcbiAgICBjb25zdCBibG9ja0hXID0gYmxvY2suZ2V0SGVpZ2h0V2lkdGgoKTtcbiAgICByZWN0LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBibG9ja0hXLndpZHRoLnRvU3RyaW5nKCkpO1xuICAgIHJlY3Quc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBibG9ja0hXLmhlaWdodC50b1N0cmluZygpKTtcblxuICAgIGNvbnN0IGJsb2NrWFkgPSBibG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3knLCBibG9ja1hZLnkudG9TdHJpbmcoKSk7XG4gICAgcmVjdC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICd4JywgKHRoaXMuUlRMID8gYmxvY2tYWS54IC0gYmxvY2tIVy53aWR0aCA6IGJsb2NrWFkueCkudG9TdHJpbmcoKSk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIHRoZSBibG9ja3Mgb24gdGhlIGZseW91dCB0byBkaXNhYmxlIHRoZSBvbmVzIHRoYXQgYXJlIGFib3ZlIHRoZVxuICAgKiBjYXBhY2l0eSBsaW1pdC4gIEZvciBpbnN0YW5jZSwgaWYgdGhlIHVzZXIgbWF5IG9ubHkgcGxhY2UgdHdvIG1vcmUgYmxvY2tzXG4gICAqIG9uIHRoZSB3b3Jrc3BhY2UsIGFuIFwiYSArIGJcIiBibG9jayB0aGF0IGhhcyB0d28gc2hhZG93IGJsb2NrcyB3b3VsZCBiZVxuICAgKiBkaXNhYmxlZC5cbiAgICovXG4gIHByaXZhdGUgZmlsdGVyRm9yQ2FwYWNpdHlfKCkge1xuICAgIGNvbnN0IGJsb2NrcyA9IHRoaXMud29ya3NwYWNlXy5nZXRUb3BCbG9ja3MoZmFsc2UpO1xuICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSBibG9ja3NbaV07IGkrKykge1xuICAgICAgaWYgKHRoaXMucGVybWFuZW50bHlEaXNhYmxlZF8uaW5kZXhPZihibG9jaykgPT09IC0xKSB7XG4gICAgICAgIGNvbnN0IGVuYWJsZSA9IHRoaXMudGFyZ2V0V29ya3NwYWNlLmlzQ2FwYWNpdHlBdmFpbGFibGUoXG4gICAgICAgICAgICBjb21tb24uZ2V0QmxvY2tUeXBlQ291bnRzKGJsb2NrKSk7XG4gICAgICAgIHdoaWxlIChibG9jaykge1xuICAgICAgICAgIGJsb2NrLnNldEVuYWJsZWQoZW5hYmxlKTtcbiAgICAgICAgICBibG9jayA9IGJsb2NrLmdldE5leHRCbG9jaygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZmxvdyBibG9ja3MgYW5kIHRoZWlyIG1hdHMuXG4gICAqL1xuICByZWZsb3coKSB7XG4gICAgaWYgKHRoaXMucmVmbG93V3JhcHBlcl8pIHtcbiAgICAgIHRoaXMud29ya3NwYWNlXy5yZW1vdmVDaGFuZ2VMaXN0ZW5lcih0aGlzLnJlZmxvd1dyYXBwZXJfKTtcbiAgICB9XG4gICAgdGhpcy5yZWZsb3dJbnRlcm5hbF8oKTtcbiAgICBpZiAodGhpcy5yZWZsb3dXcmFwcGVyXykge1xuICAgICAgdGhpcy53b3Jrc3BhY2VfLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMucmVmbG93V3JhcHBlcl8pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgZmx5b3V0IG1heSBiZSBzY3JvbGxlZCB3aXRoIGEgc2Nyb2xsYmFyIG9yXG4gICAqICAgICBieSBkcmFnZ2luZy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBpc1Njcm9sbGFibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMud29ya3NwYWNlXy5zY3JvbGxiYXIgPyB0aGlzLndvcmtzcGFjZV8uc2Nyb2xsYmFyLmlzVmlzaWJsZSgpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIENvcHkgYSBibG9jayBmcm9tIHRoZSBmbHlvdXQgdG8gdGhlIHdvcmtzcGFjZSBhbmQgcG9zaXRpb24gaXQgY29ycmVjdGx5LlxuICAgKlxuICAgKiBAcGFyYW0gb2xkQmxvY2sgVGhlIGZseW91dCBibG9jayB0byBjb3B5LlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGJsb2NrIGluIHRoZSBtYWluIHdvcmtzcGFjZS5cbiAgICovXG4gIHByaXZhdGUgcGxhY2VOZXdCbG9ja18ob2xkQmxvY2s6IEJsb2NrU3ZnKTogQmxvY2tTdmcge1xuICAgIGNvbnN0IHRhcmdldFdvcmtzcGFjZSA9IHRoaXMudGFyZ2V0V29ya3NwYWNlO1xuICAgIGNvbnN0IHN2Z1Jvb3RPbGQgPSBvbGRCbG9jay5nZXRTdmdSb290KCk7XG4gICAgaWYgKCFzdmdSb290T2xkKSB7XG4gICAgICB0aHJvdyBFcnJvcignb2xkQmxvY2sgaXMgbm90IHJlbmRlcmVkLicpO1xuICAgIH1cblxuICAgIC8vIENsb25lIHRoZSBibG9jay5cbiAgICBjb25zdCBqc29uID0gKGJsb2Nrcy5zYXZlKG9sZEJsb2NrKSBhcyBibG9ja3MuU3RhdGUpO1xuICAgIC8vIE5vcm1hbGxseSB0aGlzIHJlc2l6ZXMgbGVhZGluZyB0byB3ZWlyZCBqdW1wcy4gU2F2ZSBpdCBmb3IgdGVybWluYXRlRHJhZy5cbiAgICB0YXJnZXRXb3Jrc3BhY2Uuc2V0UmVzaXplc0VuYWJsZWQoZmFsc2UpO1xuICAgIGNvbnN0IGJsb2NrID0gKGJsb2Nrcy5hcHBlbmQoanNvbiwgdGFyZ2V0V29ya3NwYWNlKSBhcyBCbG9ja1N2Zyk7XG5cbiAgICB0aGlzLnBvc2l0aW9uTmV3QmxvY2tfKG9sZEJsb2NrLCBibG9jayk7XG5cbiAgICByZXR1cm4gYmxvY2s7XG4gIH1cblxuICAvKipcbiAgICogUG9zaXRpb25zIGEgYmxvY2sgb24gdGhlIHRhcmdldCB3b3Jrc3BhY2UuXG4gICAqXG4gICAqIEBwYXJhbSBvbGRCbG9jayBUaGUgZmx5b3V0IGJsb2NrIGJlaW5nIGNvcGllZC5cbiAgICogQHBhcmFtIGJsb2NrIFRoZSBibG9jayB0byBwb3NpaXRvbi5cbiAgICovXG4gIHByaXZhdGUgcG9zaXRpb25OZXdCbG9ja18ob2xkQmxvY2s6IEJsb2NrU3ZnLCBibG9jazogQmxvY2tTdmcpIHtcbiAgICBjb25zdCB0YXJnZXRXb3Jrc3BhY2UgPSB0aGlzLnRhcmdldFdvcmtzcGFjZTtcblxuICAgIC8vIFRoZSBvZmZzZXQgaW4gcGl4ZWxzIGJldHdlZW4gdGhlIG1haW4gd29ya3NwYWNlJ3Mgb3JpZ2luIGFuZCB0aGUgdXBwZXJcbiAgICAvLyBsZWZ0IGNvcm5lciBvZiB0aGUgaW5qZWN0aW9uIGRpdi5cbiAgICBjb25zdCBtYWluT2Zmc2V0UGl4ZWxzID0gdGFyZ2V0V29ya3NwYWNlLmdldE9yaWdpbk9mZnNldEluUGl4ZWxzKCk7XG5cbiAgICAvLyBUaGUgb2Zmc2V0IGluIHBpeGVscyBiZXR3ZWVuIHRoZSBmbHlvdXQgd29ya3NwYWNlJ3Mgb3JpZ2luIGFuZCB0aGUgdXBwZXJcbiAgICAvLyBsZWZ0IGNvcm5lciBvZiB0aGUgaW5qZWN0aW9uIGRpdi5cbiAgICBjb25zdCBmbHlvdXRPZmZzZXRQaXhlbHMgPSB0aGlzLndvcmtzcGFjZV8uZ2V0T3JpZ2luT2Zmc2V0SW5QaXhlbHMoKTtcblxuICAgIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgb2xkIGJsb2NrIGluIGZseW91dCB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAgY29uc3Qgb2xkQmxvY2tQb3MgPSBvbGRCbG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSBvbGQgYmxvY2sgaW4gcGl4ZWxzIHJlbGF0aXZlIHRvIHRoZSBmbHlvdXRcbiAgICAvLyB3b3Jrc3BhY2UncyBvcmlnaW4uXG4gICAgb2xkQmxvY2tQb3Muc2NhbGUodGhpcy53b3Jrc3BhY2VfLnNjYWxlKTtcblxuICAgIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgb2xkIGJsb2NrIGluIHBpeGVscyByZWxhdGl2ZSB0byB0aGUgdXBwZXIgbGVmdCBjb3JuZXJcbiAgICAvLyBvZiB0aGUgaW5qZWN0aW9uIGRpdi5cbiAgICBjb25zdCBvbGRCbG9ja09mZnNldFBpeGVscyA9XG4gICAgICAgIENvb3JkaW5hdGUuc3VtKGZseW91dE9mZnNldFBpeGVscywgb2xkQmxvY2tQb3MpO1xuXG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSBvbGQgYmxvY2sgaW4gcGl4ZWxzIHJlbGF0aXZlIHRvIHRoZSBvcmlnaW4gb2YgdGhlXG4gICAgLy8gbWFpbiB3b3Jrc3BhY2UuXG4gICAgY29uc3QgZmluYWxPZmZzZXQgPVxuICAgICAgICBDb29yZGluYXRlLmRpZmZlcmVuY2Uob2xkQmxvY2tPZmZzZXRQaXhlbHMsIG1haW5PZmZzZXRQaXhlbHMpO1xuICAgIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgb2xkIGJsb2NrIGluIG1haW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLlxuICAgIGZpbmFsT2Zmc2V0LnNjYWxlKDEgLyB0YXJnZXRXb3Jrc3BhY2Uuc2NhbGUpO1xuXG4gICAgYmxvY2subW92ZVRvKG5ldyBDb29yZGluYXRlKGZpbmFsT2Zmc2V0LngsIGZpbmFsT2Zmc2V0LnkpKTtcbiAgfVxufVxuXG4vKipcbiAqIEEgZmx5b3V0IGNvbnRlbnQgaXRlbS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGbHlvdXRJdGVtIHtcbiAgdHlwZTogRmx5b3V0SXRlbVR5cGU7XG4gIGJ1dHRvbj86IEZseW91dEJ1dHRvbnx1bmRlZmluZWQ7XG4gIGJsb2NrPzogQmxvY2tTdmd8dW5kZWZpbmVkO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIExheW91dCBjb2RlIGZvciBhIHZlcnRpY2FsIHZhcmlhbnQgb2YgdGhlIGZseW91dC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5WZXJ0aWNhbEZseW91dCcpO1xuXG5pbXBvcnQgKiBhcyBicm93c2VyRXZlbnRzIGZyb20gJy4vYnJvd3Nlcl9ldmVudHMuanMnO1xuaW1wb3J0ICogYXMgZHJvcERvd25EaXYgZnJvbSAnLi9kcm9wZG93bmRpdi5qcyc7XG5pbXBvcnQge0ZseW91dCwgRmx5b3V0SXRlbX0gZnJvbSAnLi9mbHlvdXRfYmFzZS5qcyc7XG5pbXBvcnQgdHlwZSB7Rmx5b3V0QnV0dG9ufSBmcm9tICcuL2ZseW91dF9idXR0b24uanMnO1xuaW1wb3J0IHR5cGUge09wdGlvbnN9IGZyb20gJy4vb3B0aW9ucy5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7U2Nyb2xsYmFyfSBmcm9tICcuL3Njcm9sbGJhci5qcyc7XG5pbXBvcnQgdHlwZSB7Q29vcmRpbmF0ZX0gZnJvbSAnLi91dGlscy9jb29yZGluYXRlLmpzJztcbmltcG9ydCB7UmVjdH0gZnJvbSAnLi91dGlscy9yZWN0LmpzJztcbmltcG9ydCAqIGFzIHRvb2xib3ggZnJvbSAnLi91dGlscy90b29sYm94LmpzJztcbmltcG9ydCAqIGFzIFdpZGdldERpdiBmcm9tICcuL3dpZGdldGRpdi5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBmbHlvdXQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuVmVydGljYWxGbHlvdXRcbiAqL1xuZXhwb3J0IGNsYXNzIFZlcnRpY2FsRmx5b3V0IGV4dGVuZHMgRmx5b3V0IHtcbiAgLyoqIFRoZSBuYW1lIG9mIHRoZSB2ZXJ0aWNhbCBmbHlvdXQgaW4gdGhlIHJlZ2lzdHJ5LiAqL1xuICBzdGF0aWMgcmVnaXN0cnlOYW1lID0gJ3ZlcnRpY2FsRmx5b3V0JztcblxuICAvKiogQHBhcmFtIHdvcmtzcGFjZU9wdGlvbnMgRGljdGlvbmFyeSBvZiBvcHRpb25zIGZvciB0aGUgd29ya3NwYWNlLiAqL1xuICBjb25zdHJ1Y3Rvcih3b3Jrc3BhY2VPcHRpb25zOiBPcHRpb25zKSB7XG4gICAgc3VwZXIod29ya3NwYWNlT3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIGZseW91dCB0byBtYXRjaCB0aGUgc2Nyb2xsYmFycy5cbiAgICpcbiAgICogQHBhcmFtIHh5UmF0aW8gQ29udGFpbnMgYSB5IHByb3BlcnR5IHdoaWNoIGlzIGEgZmxvYXQgYmV0d2VlbiAwIGFuZCAxXG4gICAqICAgICBzcGVjaWZ5aW5nIHRoZSBkZWdyZWUgb2Ygc2Nyb2xsaW5nIGFuZCBhIHNpbWlsYXIgeCBwcm9wZXJ0eS5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBzZXRNZXRyaWNzXyh4eVJhdGlvOiB7eDogbnVtYmVyLCB5OiBudW1iZXJ9KSB7XG4gICAgaWYgKCF0aGlzLmlzVmlzaWJsZSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1ldHJpY3NNYW5hZ2VyID0gdGhpcy53b3Jrc3BhY2VfLmdldE1ldHJpY3NNYW5hZ2VyKCk7XG4gICAgY29uc3Qgc2Nyb2xsTWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldFNjcm9sbE1ldHJpY3MoKTtcbiAgICBjb25zdCB2aWV3TWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldFZpZXdNZXRyaWNzKCk7XG4gICAgY29uc3QgYWJzb2x1dGVNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0QWJzb2x1dGVNZXRyaWNzKCk7XG5cbiAgICBpZiAodHlwZW9mIHh5UmF0aW8ueSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMud29ya3NwYWNlXy5zY3JvbGxZID1cbiAgICAgICAgICAtKHNjcm9sbE1ldHJpY3MudG9wICtcbiAgICAgICAgICAgIChzY3JvbGxNZXRyaWNzLmhlaWdodCAtIHZpZXdNZXRyaWNzLmhlaWdodCkgKiB4eVJhdGlvLnkpO1xuICAgIH1cbiAgICB0aGlzLndvcmtzcGFjZV8udHJhbnNsYXRlKFxuICAgICAgICB0aGlzLndvcmtzcGFjZV8uc2Nyb2xsWCArIGFic29sdXRlTWV0cmljcy5sZWZ0LFxuICAgICAgICB0aGlzLndvcmtzcGFjZV8uc2Nyb2xsWSArIGFic29sdXRlTWV0cmljcy50b3ApO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZXMgdGhlIHggY29vcmRpbmF0ZSBmb3IgdGhlIGZseW91dCBwb3NpdGlvbi5cbiAgICpcbiAgICogQHJldHVybnMgWCBjb29yZGluYXRlLlxuICAgKi9cbiAgb3ZlcnJpZGUgZ2V0WCgpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGNvbnN0IG1ldHJpY3NNYW5hZ2VyID0gdGhpcy50YXJnZXRXb3Jrc3BhY2UhLmdldE1ldHJpY3NNYW5hZ2VyKCk7XG4gICAgY29uc3QgYWJzb2x1dGVNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0QWJzb2x1dGVNZXRyaWNzKCk7XG4gICAgY29uc3Qgdmlld01ldHJpY3MgPSBtZXRyaWNzTWFuYWdlci5nZXRWaWV3TWV0cmljcygpO1xuICAgIGNvbnN0IHRvb2xib3hNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0VG9vbGJveE1ldHJpY3MoKTtcbiAgICBsZXQgeCA9IDA7XG5cbiAgICAvLyBJZiB0aGlzIGZseW91dCBpcyBub3QgdGhlIHRyYXNoY2FuIGZseW91dCAoZS5nLiB0b29sYm94IG9yIG11dGF0b3IpLlxuICAgIC8vIFRyYXNoY2FuIGZseW91dCBpcyBvcHBvc2l0ZSB0aGUgbWFpbiBmbHlvdXQuXG4gICAgaWYgKHRoaXMudGFyZ2V0V29ya3NwYWNlIS50b29sYm94UG9zaXRpb24gPT09IHRoaXMudG9vbGJveFBvc2l0aW9uXykge1xuICAgICAgLy8gSWYgdGhlcmUgaXMgYSBjYXRlZ29yeSB0b29sYm94LlxuICAgICAgLy8gU2ltcGxlIChmbHlvdXQtb25seSkgdG9vbGJveC5cbiAgICAgIGlmICh0aGlzLnRhcmdldFdvcmtzcGFjZSEuZ2V0VG9vbGJveCgpKSB7XG4gICAgICAgIGlmICh0aGlzLnRvb2xib3hQb3NpdGlvbl8gPT09IHRvb2xib3guUG9zaXRpb24uTEVGVCkge1xuICAgICAgICAgIHggPSB0b29sYm94TWV0cmljcy53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB4ID0gdmlld01ldHJpY3Mud2lkdGggLSB0aGlzLndpZHRoXztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMudG9vbGJveFBvc2l0aW9uXyA9PT0gdG9vbGJveC5Qb3NpdGlvbi5MRUZUKSB7XG4gICAgICAgICAgeCA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVGhlIHNpbXBsZSBmbHlvdXQgZG9lcyBub3QgY292ZXIgdGhlIHdvcmtzcGFjZS5cbiAgICAgICAgICB4ID0gdmlld01ldHJpY3Mud2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMudG9vbGJveFBvc2l0aW9uXyA9PT0gdG9vbGJveC5Qb3NpdGlvbi5MRUZUKSB7XG4gICAgICAgIHggPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQmVjYXVzZSB0aGUgYW5jaG9yIHBvaW50IG9mIHRoZSBmbHlvdXQgaXMgb24gdGhlIGxlZnQsIGJ1dCB3ZSB3YW50XG4gICAgICAgIC8vIHRvIGFsaWduIHRoZSByaWdodCBlZGdlIG9mIHRoZSBmbHlvdXQgd2l0aCB0aGUgcmlnaHQgZWRnZSBvZiB0aGVcbiAgICAgICAgLy8gYmxvY2tseURpdiwgd2UgY2FsY3VsYXRlIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSBkaXYgbWludXMgdGhlIHdpZHRoXG4gICAgICAgIC8vIG9mIHRoZSBmbHlvdXQuXG4gICAgICAgIHggPSB2aWV3TWV0cmljcy53aWR0aCArIGFic29sdXRlTWV0cmljcy5sZWZ0IC0gdGhpcy53aWR0aF87XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHg7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyB0aGUgeSBjb29yZGluYXRlIGZvciB0aGUgZmx5b3V0IHBvc2l0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyBZIGNvb3JkaW5hdGUuXG4gICAqL1xuICBvdmVycmlkZSBnZXRZKCk6IG51bWJlciB7XG4gICAgLy8gWSBpcyBhbHdheXMgMCBzaW5jZSB0aGlzIGlzIGEgdmVydGljYWwgZmx5b3V0LlxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLyoqIE1vdmUgdGhlIGZseW91dCB0byB0aGUgZWRnZSBvZiB0aGUgd29ya3NwYWNlLiAqL1xuICBvdmVycmlkZSBwb3NpdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKCkgfHwgIXRoaXMudGFyZ2V0V29ya3NwYWNlIS5pc1Zpc2libGUoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXRyaWNzTWFuYWdlciA9IHRoaXMudGFyZ2V0V29ya3NwYWNlIS5nZXRNZXRyaWNzTWFuYWdlcigpO1xuICAgIGNvbnN0IHRhcmdldFdvcmtzcGFjZVZpZXdNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0Vmlld01ldHJpY3MoKTtcbiAgICB0aGlzLmhlaWdodF8gPSB0YXJnZXRXb3Jrc3BhY2VWaWV3TWV0cmljcy5oZWlnaHQ7XG5cbiAgICBjb25zdCBlZGdlV2lkdGggPSB0aGlzLndpZHRoXyAtIHRoaXMuQ09STkVSX1JBRElVUztcbiAgICBjb25zdCBlZGdlSGVpZ2h0ID1cbiAgICAgICAgdGFyZ2V0V29ya3NwYWNlVmlld01ldHJpY3MuaGVpZ2h0IC0gMiAqIHRoaXMuQ09STkVSX1JBRElVUztcbiAgICB0aGlzLnNldEJhY2tncm91bmRQYXRoXyhlZGdlV2lkdGgsIGVkZ2VIZWlnaHQpO1xuXG4gICAgY29uc3QgeCA9IHRoaXMuZ2V0WCgpO1xuICAgIGNvbnN0IHkgPSB0aGlzLmdldFkoKTtcblxuICAgIHRoaXMucG9zaXRpb25BdF8odGhpcy53aWR0aF8sIHRoaXMuaGVpZ2h0XywgeCwgeSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFuZCBzZXQgdGhlIHBhdGggZm9yIHRoZSB2aXNpYmxlIGJvdW5kYXJpZXMgb2YgdGhlIGZseW91dC5cbiAgICpcbiAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgZmx5b3V0LCBub3QgaW5jbHVkaW5nIHRoZSByb3VuZGVkIGNvcm5lcnMuXG4gICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgZmx5b3V0LCBub3QgaW5jbHVkaW5nIHJvdW5kZWQgY29ybmVycy5cbiAgICovXG4gIHByaXZhdGUgc2V0QmFja2dyb3VuZFBhdGhfKHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XG4gICAgY29uc3QgYXRSaWdodCA9IHRoaXMudG9vbGJveFBvc2l0aW9uXyA9PT0gdG9vbGJveC5Qb3NpdGlvbi5SSUdIVDtcbiAgICBjb25zdCB0b3RhbFdpZHRoID0gd2lkdGggKyB0aGlzLkNPUk5FUl9SQURJVVM7XG5cbiAgICAvLyBEZWNpZGUgd2hldGhlciB0byBzdGFydCBvbiB0aGUgbGVmdCBvciByaWdodC5cbiAgICBjb25zdCBwYXRoOiBBcnJheTxzdHJpbmd8bnVtYmVyPiA9XG4gICAgICAgIFsnTSAnICsgKGF0UmlnaHQgPyB0b3RhbFdpZHRoIDogMCkgKyAnLDAnXTtcbiAgICAvLyBUb3AuXG4gICAgcGF0aC5wdXNoKCdoJywgKGF0UmlnaHQgPyAtd2lkdGggOiB3aWR0aCkpO1xuICAgIC8vIFJvdW5kZWQgY29ybmVyLlxuICAgIHBhdGgucHVzaChcbiAgICAgICAgJ2EnLCB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUywgMCwgMCwgYXRSaWdodCA/IDAgOiAxLFxuICAgICAgICBhdFJpZ2h0ID8gLXRoaXMuQ09STkVSX1JBRElVUyA6IHRoaXMuQ09STkVSX1JBRElVUywgdGhpcy5DT1JORVJfUkFESVVTKTtcbiAgICAvLyBTaWRlIGNsb3Nlc3QgdG8gd29ya3NwYWNlLlxuICAgIHBhdGgucHVzaCgndicsIE1hdGgubWF4KDAsIGhlaWdodCkpO1xuICAgIC8vIFJvdW5kZWQgY29ybmVyLlxuICAgIHBhdGgucHVzaChcbiAgICAgICAgJ2EnLCB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUywgMCwgMCwgYXRSaWdodCA/IDAgOiAxLFxuICAgICAgICBhdFJpZ2h0ID8gdGhpcy5DT1JORVJfUkFESVVTIDogLXRoaXMuQ09STkVSX1JBRElVUywgdGhpcy5DT1JORVJfUkFESVVTKTtcbiAgICAvLyBCb3R0b20uXG4gICAgcGF0aC5wdXNoKCdoJywgKGF0UmlnaHQgPyB3aWR0aCA6IC13aWR0aCkpO1xuICAgIHBhdGgucHVzaCgneicpO1xuICAgIHRoaXMuc3ZnQmFja2dyb3VuZF8hLnNldEF0dHJpYnV0ZSgnZCcsIHBhdGguam9pbignICcpKTtcbiAgfVxuXG4gIC8qKiBTY3JvbGwgdGhlIGZseW91dCB0byB0aGUgdG9wLiAqL1xuICBvdmVycmlkZSBzY3JvbGxUb1N0YXJ0KCkge1xuICAgIHRoaXMud29ya3NwYWNlXy5zY3JvbGxiYXI/LnNldFkoMCk7XG4gIH1cblxuICAvKipcbiAgICogU2Nyb2xsIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSBlIE1vdXNlIHdoZWVsIHNjcm9sbCBldmVudC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSB3aGVlbF8oZTogV2hlZWxFdmVudCkge1xuICAgIGNvbnN0IHNjcm9sbERlbHRhID0gYnJvd3NlckV2ZW50cy5nZXRTY3JvbGxEZWx0YVBpeGVscyhlKTtcblxuICAgIGlmIChzY3JvbGxEZWx0YS55KSB7XG4gICAgICBjb25zdCBtZXRyaWNzTWFuYWdlciA9IHRoaXMud29ya3NwYWNlXy5nZXRNZXRyaWNzTWFuYWdlcigpO1xuICAgICAgY29uc3Qgc2Nyb2xsTWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldFNjcm9sbE1ldHJpY3MoKTtcbiAgICAgIGNvbnN0IHZpZXdNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0Vmlld01ldHJpY3MoKTtcbiAgICAgIGNvbnN0IHBvcyA9IHZpZXdNZXRyaWNzLnRvcCAtIHNjcm9sbE1ldHJpY3MudG9wICsgc2Nyb2xsRGVsdGEueTtcblxuICAgICAgdGhpcy53b3Jrc3BhY2VfLnNjcm9sbGJhcj8uc2V0WShwb3MpO1xuICAgICAgLy8gV2hlbiB0aGUgZmx5b3V0IG1vdmVzIGZyb20gYSB3aGVlbCBldmVudCwgaGlkZSBXaWRnZXREaXYgYW5kXG4gICAgICAvLyBkcm9wRG93bkRpdi5cbiAgICAgIFdpZGdldERpdi5oaWRlKCk7XG4gICAgICBkcm9wRG93bkRpdi5oaWRlV2l0aG91dEFuaW1hdGlvbigpO1xuICAgIH1cbiAgICAvLyBEb24ndCBzY3JvbGwgdGhlIHBhZ2UuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vIERvbid0IHByb3BhZ2F0ZSBtb3VzZXdoZWVsIGV2ZW50ICh6b29taW5nKS5cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIExheSBvdXQgdGhlIGJsb2NrcyBpbiB0aGUgZmx5b3V0LlxuICAgKlxuICAgKiBAcGFyYW0gY29udGVudHMgVGhlIGJsb2NrcyBhbmQgYnV0dG9ucyB0byBsYXkgb3V0LlxuICAgKiBAcGFyYW0gZ2FwcyBUaGUgdmlzaWJsZSBnYXBzIGJldHdlZW4gYmxvY2tzLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGxheW91dF8oY29udGVudHM6IEZseW91dEl0ZW1bXSwgZ2FwczogbnVtYmVyW10pIHtcbiAgICB0aGlzLndvcmtzcGFjZV8uc2NhbGUgPSB0aGlzLnRhcmdldFdvcmtzcGFjZSEuc2NhbGU7XG4gICAgY29uc3QgbWFyZ2luID0gdGhpcy5NQVJHSU47XG4gICAgY29uc3QgY3Vyc29yWCA9IHRoaXMuUlRMID8gbWFyZ2luIDogbWFyZ2luICsgdGhpcy50YWJXaWR0aF87XG4gICAgbGV0IGN1cnNvclkgPSBtYXJnaW47XG5cbiAgICBmb3IgKGxldCBpID0gMCwgaXRlbTsgaXRlbSA9IGNvbnRlbnRzW2ldOyBpKyspIHtcbiAgICAgIGlmIChpdGVtLnR5cGUgPT09ICdibG9jaycpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBpdGVtLmJsb2NrO1xuICAgICAgICBjb25zdCBhbGxCbG9ja3MgPSBibG9jayEuZ2V0RGVzY2VuZGFudHMoZmFsc2UpO1xuICAgICAgICBmb3IgKGxldCBqID0gMCwgY2hpbGQ7IGNoaWxkID0gYWxsQmxvY2tzW2pdOyBqKyspIHtcbiAgICAgICAgICAvLyBNYXJrIGJsb2NrcyBhcyBiZWluZyBpbnNpZGUgYSBmbHlvdXQuICBUaGlzIGlzIHVzZWQgdG8gZGV0ZWN0IGFuZFxuICAgICAgICAgIC8vIHByZXZlbnQgdGhlIGNsb3N1cmUgb2YgdGhlIGZseW91dCBpZiB0aGUgdXNlciByaWdodC1jbGlja3Mgb24gc3VjaFxuICAgICAgICAgIC8vIGEgYmxvY2suXG4gICAgICAgICAgY2hpbGQuaXNJbkZseW91dCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYmxvY2shLnJlbmRlcigpO1xuICAgICAgICBjb25zdCByb290ID0gYmxvY2shLmdldFN2Z1Jvb3QoKTtcbiAgICAgICAgY29uc3QgYmxvY2tIVyA9IGJsb2NrIS5nZXRIZWlnaHRXaWR0aCgpO1xuICAgICAgICBjb25zdCBtb3ZlWCA9XG4gICAgICAgICAgICBibG9jayEub3V0cHV0Q29ubmVjdGlvbiA/IGN1cnNvclggLSB0aGlzLnRhYldpZHRoXyA6IGN1cnNvclg7XG4gICAgICAgIGJsb2NrIS5tb3ZlQnkobW92ZVgsIGN1cnNvclkpO1xuXG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNyZWF0ZVJlY3RfKFxuICAgICAgICAgICAgYmxvY2shLCB0aGlzLlJUTCA/IG1vdmVYIC0gYmxvY2tIVy53aWR0aCA6IG1vdmVYLCBjdXJzb3JZLCBibG9ja0hXLFxuICAgICAgICAgICAgaSk7XG5cbiAgICAgICAgdGhpcy5hZGRCbG9ja0xpc3RlbmVyc18ocm9vdCwgYmxvY2shLCByZWN0KTtcblxuICAgICAgICBjdXJzb3JZICs9IGJsb2NrSFcuaGVpZ2h0ICsgZ2Fwc1tpXTtcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSAnYnV0dG9uJykge1xuICAgICAgICBjb25zdCBidXR0b24gPSBpdGVtLmJ1dHRvbiBhcyBGbHlvdXRCdXR0b247XG4gICAgICAgIHRoaXMuaW5pdEZseW91dEJ1dHRvbl8oYnV0dG9uLCBjdXJzb3JYLCBjdXJzb3JZKTtcbiAgICAgICAgY3Vyc29yWSArPSBidXR0b24uaGVpZ2h0ICsgZ2Fwc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGlmIGEgZHJhZyBkZWx0YSBpcyB0b3dhcmQgdGhlIHdvcmtzcGFjZSwgYmFzZWQgb24gdGhlIHBvc2l0aW9uXG4gICAqIGFuZCBvcmllbnRhdGlvbiBvZiB0aGUgZmx5b3V0LiBUaGlzIGlzIHVzZWQgaW4gZGV0ZXJtaW5lRHJhZ0ludGVudGlvbl8gdG9cbiAgICogZGV0ZXJtaW5lIGlmIGEgbmV3IGJsb2NrIHNob3VsZCBiZSBjcmVhdGVkIG9yIGlmIHRoZSBmbHlvdXQgc2hvdWxkIHNjcm9sbC5cbiAgICpcbiAgICogQHBhcmFtIGN1cnJlbnREcmFnRGVsdGFYWSBIb3cgZmFyIHRoZSBwb2ludGVyIGhhcyBtb3ZlZCBmcm9tIHRoZSBwb3NpdGlvblxuICAgKiAgICAgYXQgbW91c2UgZG93biwgaW4gcGl4ZWwgdW5pdHMuXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGRyYWcgaXMgdG93YXJkIHRoZSB3b3Jrc3BhY2UuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgaXNEcmFnVG93YXJkV29ya3NwYWNlKGN1cnJlbnREcmFnRGVsdGFYWTogQ29vcmRpbmF0ZSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGR4ID0gY3VycmVudERyYWdEZWx0YVhZLng7XG4gICAgY29uc3QgZHkgPSBjdXJyZW50RHJhZ0RlbHRhWFkueTtcbiAgICAvLyBEaXJlY3Rpb24gZ29lcyBmcm9tIC0xODAgdG8gMTgwLCB3aXRoIDAgdG93YXJkIHRoZSByaWdodCBhbmQgOTAgb24gdG9wLlxuICAgIGNvbnN0IGRyYWdEaXJlY3Rpb24gPSBNYXRoLmF0YW4yKGR5LCBkeCkgLyBNYXRoLlBJICogMTgwO1xuXG4gICAgY29uc3QgcmFuZ2UgPSB0aGlzLmRyYWdBbmdsZVJhbmdlXztcbiAgICAvLyBDaGVjayBmb3IgbGVmdCBvciByaWdodCBkcmFnZ2luZy5cbiAgICBpZiAoZHJhZ0RpcmVjdGlvbiA8IHJhbmdlICYmIGRyYWdEaXJlY3Rpb24gPiAtcmFuZ2UgfHxcbiAgICAgICAgKGRyYWdEaXJlY3Rpb24gPCAtMTgwICsgcmFuZ2UgfHwgZHJhZ0RpcmVjdGlvbiA+IDE4MCAtIHJhbmdlKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBib3VuZGluZyByZWN0YW5nbGUgb2YgdGhlIGRyYWcgdGFyZ2V0IGFyZWEgaW4gcGl4ZWwgdW5pdHNcbiAgICogcmVsYXRpdmUgdG8gdmlld3BvcnQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjb21wb25lbnQncyBib3VuZGluZyBib3guIE51bGwgaWYgZHJhZyB0YXJnZXQgYXJlYSBzaG91bGQgYmVcbiAgICogICAgIGlnbm9yZWQuXG4gICAqL1xuICBvdmVycmlkZSBnZXRDbGllbnRSZWN0KCk6IFJlY3R8bnVsbCB7XG4gICAgaWYgKCF0aGlzLnN2Z0dyb3VwXyB8fCB0aGlzLmF1dG9DbG9zZSB8fCAhdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgLy8gVGhlIGJvdW5kaW5nIHJlY3RhbmdsZSB3b24ndCBjb21wdXRlIGNvcnJlY3RseSBpZiB0aGUgZmx5b3V0IGlzIGNsb3NlZFxuICAgICAgLy8gYW5kIGF1dG8tY2xvc2UgZmx5b3V0cyBhcmVuJ3QgdmFsaWQgZHJhZyB0YXJnZXRzIChvciBkZWxldGUgYXJlYXMpLlxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgZmx5b3V0UmVjdCA9IHRoaXMuc3ZnR3JvdXBfLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIC8vIEJJR19OVU0gaXMgb2Zmc2NyZWVuIHBhZGRpbmcgc28gdGhhdCBibG9ja3MgZHJhZ2dlZCBiZXlvbmQgdGhlIHNob3duXG4gICAgLy8gZmx5b3V0IGFyZWEgYXJlIHN0aWxsIGRlbGV0ZWQuICBNdXN0IGJlIGxhcmdlciB0aGFuIHRoZSBsYXJnZXN0IHNjcmVlblxuICAgIC8vIHNpemUsIGJ1dCBiZSBzbWFsbGVyIHRoYW4gaGFsZiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiAobm90IGF2YWlsYWJsZSBvblxuICAgIC8vIElFKS5cbiAgICBjb25zdCBCSUdfTlVNID0gMTAwMDAwMDAwMDtcbiAgICBjb25zdCBsZWZ0ID0gZmx5b3V0UmVjdC5sZWZ0O1xuXG4gICAgaWYgKHRoaXMudG9vbGJveFBvc2l0aW9uXyA9PT0gdG9vbGJveC5Qb3NpdGlvbi5MRUZUKSB7XG4gICAgICBjb25zdCB3aWR0aCA9IGZseW91dFJlY3Qud2lkdGg7XG4gICAgICByZXR1cm4gbmV3IFJlY3QoLUJJR19OVU0sIEJJR19OVU0sIC1CSUdfTlVNLCBsZWZ0ICsgd2lkdGgpO1xuICAgIH0gZWxzZSB7ICAvLyBSaWdodFxuICAgICAgcmV0dXJuIG5ldyBSZWN0KC1CSUdfTlVNLCBCSUdfTlVNLCBsZWZ0LCBCSUdfTlVNKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29tcHV0ZSB3aWR0aCBvZiBmbHlvdXQuICB0b29sYm94LlBvc2l0aW9uIG1hdCB1bmRlciBlYWNoIGJsb2NrLlxuICAgKiBGb3IgUlRMOiBMYXkgb3V0IHRoZSBibG9ja3MgYW5kIGJ1dHRvbnMgdG8gYmUgcmlnaHQtYWxpZ25lZC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSByZWZsb3dJbnRlcm5hbF8oKSB7XG4gICAgdGhpcy53b3Jrc3BhY2VfLnNjYWxlID0gdGhpcy5nZXRGbHlvdXRTY2FsZSgpO1xuICAgIGxldCBmbHlvdXRXaWR0aCA9IDA7XG4gICAgY29uc3QgYmxvY2tzID0gdGhpcy53b3Jrc3BhY2VfLmdldFRvcEJsb2NrcyhmYWxzZSk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGJsb2NrOyBibG9jayA9IGJsb2Nrc1tpXTsgaSsrKSB7XG4gICAgICBsZXQgd2lkdGggPSBibG9jay5nZXRIZWlnaHRXaWR0aCgpLndpZHRoO1xuICAgICAgaWYgKGJsb2NrLm91dHB1dENvbm5lY3Rpb24pIHtcbiAgICAgICAgd2lkdGggLT0gdGhpcy50YWJXaWR0aF87XG4gICAgICB9XG4gICAgICBmbHlvdXRXaWR0aCA9IE1hdGgubWF4KGZseW91dFdpZHRoLCB3aWR0aCk7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwLCBidXR0b247IGJ1dHRvbiA9IHRoaXMuYnV0dG9uc19baV07IGkrKykge1xuICAgICAgZmx5b3V0V2lkdGggPSBNYXRoLm1heChmbHlvdXRXaWR0aCwgYnV0dG9uLndpZHRoKTtcbiAgICB9XG4gICAgZmx5b3V0V2lkdGggKz0gdGhpcy5NQVJHSU4gKiAxLjUgKyB0aGlzLnRhYldpZHRoXztcbiAgICBmbHlvdXRXaWR0aCAqPSB0aGlzLndvcmtzcGFjZV8uc2NhbGU7XG4gICAgZmx5b3V0V2lkdGggKz0gU2Nyb2xsYmFyLnNjcm9sbGJhclRoaWNrbmVzcztcblxuICAgIGlmICh0aGlzLndpZHRoXyAhPT0gZmx5b3V0V2lkdGgpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSBibG9ja3NbaV07IGkrKykge1xuICAgICAgICBpZiAodGhpcy5SVEwpIHtcbiAgICAgICAgICAvLyBXaXRoIHRoZSBmbHlvdXRXaWR0aCBrbm93biwgcmlnaHQtYWxpZ24gdGhlIGJsb2Nrcy5cbiAgICAgICAgICBjb25zdCBvbGRYID0gYmxvY2suZ2V0UmVsYXRpdmVUb1N1cmZhY2VYWSgpLng7XG4gICAgICAgICAgbGV0IG5ld1ggPSBmbHlvdXRXaWR0aCAvIHRoaXMud29ya3NwYWNlXy5zY2FsZSAtIHRoaXMuTUFSR0lOO1xuICAgICAgICAgIGlmICghYmxvY2sub3V0cHV0Q29ubmVjdGlvbikge1xuICAgICAgICAgICAgbmV3WCAtPSB0aGlzLnRhYldpZHRoXztcbiAgICAgICAgICB9XG4gICAgICAgICAgYmxvY2subW92ZUJ5KG5ld1ggLSBvbGRYLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yZWN0TWFwXy5oYXMoYmxvY2spKSB7XG4gICAgICAgICAgdGhpcy5tb3ZlUmVjdFRvQmxvY2tfKHRoaXMucmVjdE1hcF8uZ2V0KGJsb2NrKSEsIGJsb2NrKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICAgIC8vIFdpdGggdGhlIGZseW91dFdpZHRoIGtub3duLCByaWdodC1hbGlnbiB0aGUgYnV0dG9ucy5cbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGJ1dHRvbjsgYnV0dG9uID0gdGhpcy5idXR0b25zX1tpXTsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgeSA9IGJ1dHRvbi5nZXRQb3NpdGlvbigpLnk7XG4gICAgICAgICAgY29uc3QgeCA9IGZseW91dFdpZHRoIC8gdGhpcy53b3Jrc3BhY2VfLnNjYWxlIC0gYnV0dG9uLndpZHRoIC1cbiAgICAgICAgICAgICAgdGhpcy5NQVJHSU4gLSB0aGlzLnRhYldpZHRoXztcbiAgICAgICAgICBidXR0b24ubW92ZVRvKHgsIHkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnRhcmdldFdvcmtzcGFjZSEudG9vbGJveFBvc2l0aW9uID09PSB0aGlzLnRvb2xib3hQb3NpdGlvbl8gJiZcbiAgICAgICAgICB0aGlzLnRvb2xib3hQb3NpdGlvbl8gPT09IHRvb2xib3guUG9zaXRpb24uTEVGVCAmJlxuICAgICAgICAgICF0aGlzLnRhcmdldFdvcmtzcGFjZSEuZ2V0VG9vbGJveCgpKSB7XG4gICAgICAgIC8vIFRoaXMgZmx5b3V0IGlzIGEgc2ltcGxlIHRvb2xib3guIFJlcG9zaXRpb24gdGhlIHdvcmtzcGFjZSBzbyB0aGF0XG4gICAgICAgIC8vICgwLDApIGlzIGluIHRoZSBjb3JyZWN0IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBuZXcgYWJzb2x1dGUgZWRnZVxuICAgICAgICAvLyAoaWUgdG9vbGJveCBlZGdlKS5cbiAgICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UhLnRyYW5zbGF0ZShcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0V29ya3NwYWNlIS5zY3JvbGxYICsgZmx5b3V0V2lkdGgsXG4gICAgICAgICAgICB0aGlzLnRhcmdldFdvcmtzcGFjZSEuc2Nyb2xsWSk7XG4gICAgICB9XG4gICAgICB0aGlzLndpZHRoXyA9IGZseW91dFdpZHRoO1xuICAgICAgdGhpcy5wb3NpdGlvbigpO1xuICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UhLnJlY29yZERyYWdUYXJnZXRzKCk7XG4gICAgfVxuICB9XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRkxZT1VUU19WRVJUSUNBTF9UT09MQk9YLCByZWdpc3RyeS5ERUZBVUxULCBWZXJ0aWNhbEZseW91dCk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogSG9yaXpvbnRhbCBmbHlvdXQgdHJheSBjb250YWluaW5nIGJsb2NrcyB3aGljaCBtYXkgYmUgY3JlYXRlZC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5Ib3Jpem9udGFsRmx5b3V0Jyk7XG5cbmltcG9ydCAqIGFzIGJyb3dzZXJFdmVudHMgZnJvbSAnLi9icm93c2VyX2V2ZW50cy5qcyc7XG5pbXBvcnQgKiBhcyBkcm9wRG93bkRpdiBmcm9tICcuL2Ryb3Bkb3duZGl2LmpzJztcbmltcG9ydCB7Rmx5b3V0LCBGbHlvdXRJdGVtfSBmcm9tICcuL2ZseW91dF9iYXNlLmpzJztcbmltcG9ydCB0eXBlIHtGbHlvdXRCdXR0b259IGZyb20gJy4vZmx5b3V0X2J1dHRvbi5qcyc7XG5pbXBvcnQgdHlwZSB7T3B0aW9uc30gZnJvbSAnLi9vcHRpb25zLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHtTY3JvbGxiYXJ9IGZyb20gJy4vc2Nyb2xsYmFyLmpzJztcbmltcG9ydCB0eXBlIHtDb29yZGluYXRlfSBmcm9tICcuL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuaW1wb3J0IHtSZWN0fSBmcm9tICcuL3V0aWxzL3JlY3QuanMnO1xuaW1wb3J0ICogYXMgdG9vbGJveCBmcm9tICcuL3V0aWxzL3Rvb2xib3guanMnO1xuaW1wb3J0ICogYXMgV2lkZ2V0RGl2IGZyb20gJy4vd2lkZ2V0ZGl2LmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGZseW91dC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5Ib3Jpem9udGFsRmx5b3V0XG4gKi9cbmV4cG9ydCBjbGFzcyBIb3Jpem9udGFsRmx5b3V0IGV4dGVuZHMgRmx5b3V0IHtcbiAgb3ZlcnJpZGUgaG9yaXpvbnRhbExheW91dCA9IHRydWU7XG5cbiAgLyoqIEBwYXJhbSB3b3Jrc3BhY2VPcHRpb25zIERpY3Rpb25hcnkgb2Ygb3B0aW9ucyBmb3IgdGhlIHdvcmtzcGFjZS4gKi9cbiAgY29uc3RydWN0b3Iod29ya3NwYWNlT3B0aW9uczogT3B0aW9ucykge1xuICAgIHN1cGVyKHdvcmtzcGFjZU9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHRyYW5zbGF0aW9uIG9mIHRoZSBmbHlvdXQgdG8gbWF0Y2ggdGhlIHNjcm9sbGJhcnMuXG4gICAqXG4gICAqIEBwYXJhbSB4eVJhdGlvIENvbnRhaW5zIGEgeSBwcm9wZXJ0eSB3aGljaCBpcyBhIGZsb2F0IGJldHdlZW4gMCBhbmQgMVxuICAgKiAgICAgc3BlY2lmeWluZyB0aGUgZGVncmVlIG9mIHNjcm9sbGluZyBhbmQgYSBzaW1pbGFyIHggcHJvcGVydHkuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgc2V0TWV0cmljc18oeHlSYXRpbzoge3g6IG51bWJlciwgeTogbnVtYmVyfSkge1xuICAgIGlmICghdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG1ldHJpY3NNYW5hZ2VyID0gdGhpcy53b3Jrc3BhY2VfLmdldE1ldHJpY3NNYW5hZ2VyKCk7XG4gICAgY29uc3Qgc2Nyb2xsTWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldFNjcm9sbE1ldHJpY3MoKTtcbiAgICBjb25zdCB2aWV3TWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldFZpZXdNZXRyaWNzKCk7XG4gICAgY29uc3QgYWJzb2x1dGVNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0QWJzb2x1dGVNZXRyaWNzKCk7XG5cbiAgICBpZiAodHlwZW9mIHh5UmF0aW8ueCA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMud29ya3NwYWNlXy5zY3JvbGxYID1cbiAgICAgICAgICAtKHNjcm9sbE1ldHJpY3MubGVmdCArXG4gICAgICAgICAgICAoc2Nyb2xsTWV0cmljcy53aWR0aCAtIHZpZXdNZXRyaWNzLndpZHRoKSAqIHh5UmF0aW8ueCk7XG4gICAgfVxuXG4gICAgdGhpcy53b3Jrc3BhY2VfLnRyYW5zbGF0ZShcbiAgICAgICAgdGhpcy53b3Jrc3BhY2VfLnNjcm9sbFggKyBhYnNvbHV0ZU1ldHJpY3MubGVmdCxcbiAgICAgICAgdGhpcy53b3Jrc3BhY2VfLnNjcm9sbFkgKyBhYnNvbHV0ZU1ldHJpY3MudG9wKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHRoZSB4IGNvb3JkaW5hdGUgZm9yIHRoZSBmbHlvdXQgcG9zaXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFggY29vcmRpbmF0ZS5cbiAgICovXG4gIG92ZXJyaWRlIGdldFgoKTogbnVtYmVyIHtcbiAgICAvLyBYIGlzIGFsd2F5cyAwIHNpbmNlIHRoaXMgaXMgYSBob3Jpem9udGFsIGZseW91dC5cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIHRoZSB5IGNvb3JkaW5hdGUgZm9yIHRoZSBmbHlvdXQgcG9zaXRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIFkgY29vcmRpbmF0ZS5cbiAgICovXG4gIG92ZXJyaWRlIGdldFkoKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKCkpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBtZXRyaWNzTWFuYWdlciA9IHRoaXMudGFyZ2V0V29ya3NwYWNlIS5nZXRNZXRyaWNzTWFuYWdlcigpO1xuICAgIGNvbnN0IGFic29sdXRlTWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldEFic29sdXRlTWV0cmljcygpO1xuICAgIGNvbnN0IHZpZXdNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0Vmlld01ldHJpY3MoKTtcbiAgICBjb25zdCB0b29sYm94TWV0cmljcyA9IG1ldHJpY3NNYW5hZ2VyLmdldFRvb2xib3hNZXRyaWNzKCk7XG5cbiAgICBsZXQgeSA9IDA7XG4gICAgY29uc3QgYXRUb3AgPSB0aGlzLnRvb2xib3hQb3NpdGlvbl8gPT09IHRvb2xib3guUG9zaXRpb24uVE9QO1xuICAgIC8vIElmIHRoaXMgZmx5b3V0IGlzIG5vdCB0aGUgdHJhc2hjYW4gZmx5b3V0IChlLmcuIHRvb2xib3ggb3IgbXV0YXRvcikuXG4gICAgLy8gVHJhc2hjYW4gZmx5b3V0IGlzIG9wcG9zaXRlIHRoZSBtYWluIGZseW91dC5cbiAgICBpZiAodGhpcy50YXJnZXRXb3Jrc3BhY2UhLnRvb2xib3hQb3NpdGlvbiA9PT0gdGhpcy50b29sYm94UG9zaXRpb25fKSB7XG4gICAgICAvLyBJZiB0aGVyZSBpcyBhIGNhdGVnb3J5IHRvb2xib3guXG4gICAgICAvLyBTaW1wbGUgKGZseW91dC1vbmx5KSB0b29sYm94LlxuICAgICAgaWYgKHRoaXMudGFyZ2V0V29ya3NwYWNlIS5nZXRUb29sYm94KCkpIHtcbiAgICAgICAgaWYgKGF0VG9wKSB7XG4gICAgICAgICAgeSA9IHRvb2xib3hNZXRyaWNzLmhlaWdodDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB5ID0gdmlld01ldHJpY3MuaGVpZ2h0IC0gdGhpcy5oZWlnaHRfO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYXRUb3ApIHtcbiAgICAgICAgICB5ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBUaGUgc2ltcGxlIGZseW91dCBkb2VzIG5vdCBjb3ZlciB0aGUgd29ya3NwYWNlLlxuICAgICAgICAgIHkgPSB2aWV3TWV0cmljcy5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGF0VG9wKSB7XG4gICAgICAgIHkgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQmVjYXVzZSB0aGUgYW5jaG9yIHBvaW50IG9mIHRoZSBmbHlvdXQgaXMgb24gdGhlIHRvcCwgYnV0IHdlIHdhbnRcbiAgICAgICAgLy8gdG8gYWxpZ24gdGhlIGJvdHRvbSBlZGdlIG9mIHRoZSBmbHlvdXQgd2l0aCB0aGUgYm90dG9tIGVkZ2Ugb2YgdGhlXG4gICAgICAgIC8vIGJsb2NrbHlEaXYsIHdlIGNhbGN1bGF0ZSB0aGUgZnVsbCBoZWlnaHQgb2YgdGhlIGRpdiBtaW51cyB0aGUgaGVpZ2h0XG4gICAgICAgIC8vIG9mIHRoZSBmbHlvdXQuXG4gICAgICAgIHkgPSB2aWV3TWV0cmljcy5oZWlnaHQgKyBhYnNvbHV0ZU1ldHJpY3MudG9wIC0gdGhpcy5oZWlnaHRfO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB5O1xuICB9XG5cbiAgLyoqIE1vdmUgdGhlIGZseW91dCB0byB0aGUgZWRnZSBvZiB0aGUgd29ya3NwYWNlLiAqL1xuICBvdmVycmlkZSBwb3NpdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKCkgfHwgIXRoaXMudGFyZ2V0V29ya3NwYWNlIS5pc1Zpc2libGUoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXRyaWNzTWFuYWdlciA9IHRoaXMudGFyZ2V0V29ya3NwYWNlIS5nZXRNZXRyaWNzTWFuYWdlcigpO1xuICAgIGNvbnN0IHRhcmdldFdvcmtzcGFjZVZpZXdNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0Vmlld01ldHJpY3MoKTtcbiAgICB0aGlzLndpZHRoXyA9IHRhcmdldFdvcmtzcGFjZVZpZXdNZXRyaWNzLndpZHRoO1xuXG4gICAgY29uc3QgZWRnZVdpZHRoID0gdGFyZ2V0V29ya3NwYWNlVmlld01ldHJpY3Mud2lkdGggLSAyICogdGhpcy5DT1JORVJfUkFESVVTO1xuICAgIGNvbnN0IGVkZ2VIZWlnaHQgPSB0aGlzLmhlaWdodF8gLSB0aGlzLkNPUk5FUl9SQURJVVM7XG4gICAgdGhpcy5zZXRCYWNrZ3JvdW5kUGF0aF8oZWRnZVdpZHRoLCBlZGdlSGVpZ2h0KTtcblxuICAgIGNvbnN0IHggPSB0aGlzLmdldFgoKTtcbiAgICBjb25zdCB5ID0gdGhpcy5nZXRZKCk7XG5cbiAgICB0aGlzLnBvc2l0aW9uQXRfKHRoaXMud2lkdGhfLCB0aGlzLmhlaWdodF8sIHgsIHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbmQgc2V0IHRoZSBwYXRoIGZvciB0aGUgdmlzaWJsZSBib3VuZGFyaWVzIG9mIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIGZseW91dCwgbm90IGluY2x1ZGluZyB0aGUgcm91bmRlZCBjb3JuZXJzLlxuICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIGZseW91dCwgbm90IGluY2x1ZGluZyByb3VuZGVkIGNvcm5lcnMuXG4gICAqL1xuICBwcml2YXRlIHNldEJhY2tncm91bmRQYXRoXyh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIGNvbnN0IGF0VG9wID0gdGhpcy50b29sYm94UG9zaXRpb25fID09PSB0b29sYm94LlBvc2l0aW9uLlRPUDtcbiAgICAvLyBTdGFydCBhdCB0b3AgbGVmdC5cbiAgICBjb25zdCBwYXRoOiAoc3RyaW5nfG51bWJlcilbXSA9IFsnTSAwLCcgKyAoYXRUb3AgPyAwIDogdGhpcy5DT1JORVJfUkFESVVTKV07XG5cbiAgICBpZiAoYXRUb3ApIHtcbiAgICAgIC8vIFRvcC5cbiAgICAgIHBhdGgucHVzaCgnaCcsIHdpZHRoICsgMiAqIHRoaXMuQ09STkVSX1JBRElVUyk7XG4gICAgICAvLyBSaWdodC5cbiAgICAgIHBhdGgucHVzaCgndicsIGhlaWdodCk7XG4gICAgICAvLyBCb3R0b20uXG4gICAgICBwYXRoLnB1c2goXG4gICAgICAgICAgJ2EnLCB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUywgMCwgMCwgMSxcbiAgICAgICAgICAtdGhpcy5DT1JORVJfUkFESVVTLCB0aGlzLkNPUk5FUl9SQURJVVMpO1xuICAgICAgcGF0aC5wdXNoKCdoJywgLXdpZHRoKTtcbiAgICAgIC8vIExlZnQuXG4gICAgICBwYXRoLnB1c2goXG4gICAgICAgICAgJ2EnLCB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUywgMCwgMCwgMSxcbiAgICAgICAgICAtdGhpcy5DT1JORVJfUkFESVVTLCAtdGhpcy5DT1JORVJfUkFESVVTKTtcbiAgICAgIHBhdGgucHVzaCgneicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUb3AuXG4gICAgICBwYXRoLnB1c2goXG4gICAgICAgICAgJ2EnLCB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUywgMCwgMCwgMSxcbiAgICAgICAgICB0aGlzLkNPUk5FUl9SQURJVVMsIC10aGlzLkNPUk5FUl9SQURJVVMpO1xuICAgICAgcGF0aC5wdXNoKCdoJywgd2lkdGgpO1xuICAgICAgLy8gUmlnaHQuXG4gICAgICBwYXRoLnB1c2goXG4gICAgICAgICAgJ2EnLCB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUywgMCwgMCwgMSxcbiAgICAgICAgICB0aGlzLkNPUk5FUl9SQURJVVMsIHRoaXMuQ09STkVSX1JBRElVUyk7XG4gICAgICBwYXRoLnB1c2goJ3YnLCBoZWlnaHQpO1xuICAgICAgLy8gQm90dG9tLlxuICAgICAgcGF0aC5wdXNoKCdoJywgLXdpZHRoIC0gMiAqIHRoaXMuQ09STkVSX1JBRElVUyk7XG4gICAgICAvLyBMZWZ0LlxuICAgICAgcGF0aC5wdXNoKCd6Jyk7XG4gICAgfVxuICAgIHRoaXMuc3ZnQmFja2dyb3VuZF8hLnNldEF0dHJpYnV0ZSgnZCcsIHBhdGguam9pbignICcpKTtcbiAgfVxuXG4gIC8qKiBTY3JvbGwgdGhlIGZseW91dCB0byB0aGUgdG9wLiAqL1xuICBvdmVycmlkZSBzY3JvbGxUb1N0YXJ0KCkge1xuICAgIHRoaXMud29ya3NwYWNlXy5zY3JvbGxiYXI/LnNldFgodGhpcy5SVEwgPyBJbmZpbml0eSA6IDApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCB0aGUgZmx5b3V0LlxuICAgKlxuICAgKiBAcGFyYW0gZSBNb3VzZSB3aGVlbCBzY3JvbGwgZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgd2hlZWxfKGU6IFdoZWVsRXZlbnQpIHtcbiAgICBjb25zdCBzY3JvbGxEZWx0YSA9IGJyb3dzZXJFdmVudHMuZ2V0U2Nyb2xsRGVsdGFQaXhlbHMoZSk7XG4gICAgY29uc3QgZGVsdGEgPSBzY3JvbGxEZWx0YS54IHx8IHNjcm9sbERlbHRhLnk7XG5cbiAgICBpZiAoZGVsdGEpIHtcbiAgICAgIGNvbnN0IG1ldHJpY3NNYW5hZ2VyID0gdGhpcy53b3Jrc3BhY2VfLmdldE1ldHJpY3NNYW5hZ2VyKCk7XG4gICAgICBjb25zdCBzY3JvbGxNZXRyaWNzID0gbWV0cmljc01hbmFnZXIuZ2V0U2Nyb2xsTWV0cmljcygpO1xuICAgICAgY29uc3Qgdmlld01ldHJpY3MgPSBtZXRyaWNzTWFuYWdlci5nZXRWaWV3TWV0cmljcygpO1xuXG4gICAgICBjb25zdCBwb3MgPSB2aWV3TWV0cmljcy5sZWZ0IC0gc2Nyb2xsTWV0cmljcy5sZWZ0ICsgZGVsdGE7XG4gICAgICB0aGlzLndvcmtzcGFjZV8uc2Nyb2xsYmFyPy5zZXRYKHBvcyk7XG4gICAgICAvLyBXaGVuIHRoZSBmbHlvdXQgbW92ZXMgZnJvbSBhIHdoZWVsIGV2ZW50LCBoaWRlIFdpZGdldERpdiBhbmRcbiAgICAgIC8vIGRyb3BEb3duRGl2LlxuICAgICAgV2lkZ2V0RGl2LmhpZGUoKTtcbiAgICAgIGRyb3BEb3duRGl2LmhpZGVXaXRob3V0QW5pbWF0aW9uKCk7XG4gICAgfVxuICAgIC8vIERvbid0IHNjcm9sbCB0aGUgcGFnZS5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gRG9uJ3QgcHJvcGFnYXRlIG1vdXNld2hlZWwgZXZlbnQgKHpvb21pbmcpLlxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogTGF5IG91dCB0aGUgYmxvY2tzIGluIHRoZSBmbHlvdXQuXG4gICAqXG4gICAqIEBwYXJhbSBjb250ZW50cyBUaGUgYmxvY2tzIGFuZCBidXR0b25zIHRvIGxheSBvdXQuXG4gICAqIEBwYXJhbSBnYXBzIFRoZSB2aXNpYmxlIGdhcHMgYmV0d2VlbiBibG9ja3MuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgbGF5b3V0Xyhjb250ZW50czogRmx5b3V0SXRlbVtdLCBnYXBzOiBudW1iZXJbXSkge1xuICAgIHRoaXMud29ya3NwYWNlXy5zY2FsZSA9IHRoaXMudGFyZ2V0V29ya3NwYWNlIS5zY2FsZTtcbiAgICBjb25zdCBtYXJnaW4gPSB0aGlzLk1BUkdJTjtcbiAgICBsZXQgY3Vyc29yWCA9IG1hcmdpbiArIHRoaXMudGFiV2lkdGhfO1xuICAgIGNvbnN0IGN1cnNvclkgPSBtYXJnaW47XG4gICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnJldmVyc2UoKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMCwgaXRlbTsgaXRlbSA9IGNvbnRlbnRzW2ldOyBpKyspIHtcbiAgICAgIGlmIChpdGVtLnR5cGUgPT09ICdibG9jaycpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBpdGVtLmJsb2NrO1xuICAgICAgICBjb25zdCBhbGxCbG9ja3MgPSBibG9jayEuZ2V0RGVzY2VuZGFudHMoZmFsc2UpO1xuICAgICAgICBmb3IgKGxldCBqID0gMCwgY2hpbGQ7IGNoaWxkID0gYWxsQmxvY2tzW2pdOyBqKyspIHtcbiAgICAgICAgICAvLyBNYXJrIGJsb2NrcyBhcyBiZWluZyBpbnNpZGUgYSBmbHlvdXQuICBUaGlzIGlzIHVzZWQgdG8gZGV0ZWN0IGFuZFxuICAgICAgICAgIC8vIHByZXZlbnQgdGhlIGNsb3N1cmUgb2YgdGhlIGZseW91dCBpZiB0aGUgdXNlciByaWdodC1jbGlja3Mgb24gc3VjaFxuICAgICAgICAgIC8vIGEgYmxvY2suXG4gICAgICAgICAgY2hpbGQuaXNJbkZseW91dCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYmxvY2shLnJlbmRlcigpO1xuICAgICAgICBjb25zdCByb290ID0gYmxvY2shLmdldFN2Z1Jvb3QoKTtcbiAgICAgICAgY29uc3QgYmxvY2tIVyA9IGJsb2NrIS5nZXRIZWlnaHRXaWR0aCgpO1xuICAgICAgICAvLyBGaWd1cmUgb3V0IHdoZXJlIHRvIHBsYWNlIHRoZSBibG9jay5cbiAgICAgICAgY29uc3QgdGFiID0gYmxvY2shLm91dHB1dENvbm5lY3Rpb24gPyB0aGlzLnRhYldpZHRoXyA6IDA7XG4gICAgICAgIGxldCBtb3ZlWDtcbiAgICAgICAgaWYgKHRoaXMuUlRMKSB7XG4gICAgICAgICAgbW92ZVggPSBjdXJzb3JYICsgYmxvY2tIVy53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtb3ZlWCA9IGN1cnNvclggLSB0YWI7XG4gICAgICAgIH1cbiAgICAgICAgYmxvY2shLm1vdmVCeShtb3ZlWCwgY3Vyc29yWSk7XG5cbiAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMuY3JlYXRlUmVjdF8oYmxvY2shLCBtb3ZlWCwgY3Vyc29yWSwgYmxvY2tIVywgaSk7XG4gICAgICAgIGN1cnNvclggKz0gYmxvY2tIVy53aWR0aCArIGdhcHNbaV07XG5cbiAgICAgICAgdGhpcy5hZGRCbG9ja0xpc3RlbmVyc18ocm9vdCwgYmxvY2shLCByZWN0KTtcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSAnYnV0dG9uJykge1xuICAgICAgICBjb25zdCBidXR0b24gPSBpdGVtLmJ1dHRvbiBhcyBGbHlvdXRCdXR0b247XG4gICAgICAgIHRoaXMuaW5pdEZseW91dEJ1dHRvbl8oYnV0dG9uLCBjdXJzb3JYLCBjdXJzb3JZKTtcbiAgICAgICAgY3Vyc29yWCArPSBidXR0b24ud2lkdGggKyBnYXBzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgaWYgYSBkcmFnIGRlbHRhIGlzIHRvd2FyZCB0aGUgd29ya3NwYWNlLCBiYXNlZCBvbiB0aGUgcG9zaXRpb25cbiAgICogYW5kIG9yaWVudGF0aW9uIG9mIHRoZSBmbHlvdXQuIFRoaXMgaXMgdXNlZCBpbiBkZXRlcm1pbmVEcmFnSW50ZW50aW9uXyB0b1xuICAgKiBkZXRlcm1pbmUgaWYgYSBuZXcgYmxvY2sgc2hvdWxkIGJlIGNyZWF0ZWQgb3IgaWYgdGhlIGZseW91dCBzaG91bGQgc2Nyb2xsLlxuICAgKlxuICAgKiBAcGFyYW0gY3VycmVudERyYWdEZWx0YVhZIEhvdyBmYXIgdGhlIHBvaW50ZXIgaGFzIG1vdmVkIGZyb20gdGhlIHBvc2l0aW9uXG4gICAqICAgICBhdCBtb3VzZSBkb3duLCBpbiBwaXhlbCB1bml0cy5cbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgZHJhZyBpcyB0b3dhcmQgdGhlIHdvcmtzcGFjZS5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBpc0RyYWdUb3dhcmRXb3Jrc3BhY2UoY3VycmVudERyYWdEZWx0YVhZOiBDb29yZGluYXRlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZHggPSBjdXJyZW50RHJhZ0RlbHRhWFkueDtcbiAgICBjb25zdCBkeSA9IGN1cnJlbnREcmFnRGVsdGFYWS55O1xuICAgIC8vIERpcmVjdGlvbiBnb2VzIGZyb20gLTE4MCB0byAxODAsIHdpdGggMCB0b3dhcmQgdGhlIHJpZ2h0IGFuZCA5MCBvbiB0b3AuXG4gICAgY29uc3QgZHJhZ0RpcmVjdGlvbiA9IE1hdGguYXRhbjIoZHksIGR4KSAvIE1hdGguUEkgKiAxODA7XG5cbiAgICBjb25zdCByYW5nZSA9IHRoaXMuZHJhZ0FuZ2xlUmFuZ2VfO1xuICAgIC8vIENoZWNrIGZvciB1cCBvciBkb3duIGRyYWdnaW5nLlxuICAgIGlmIChkcmFnRGlyZWN0aW9uIDwgOTAgKyByYW5nZSAmJiBkcmFnRGlyZWN0aW9uID4gOTAgLSByYW5nZSB8fFxuICAgICAgICBkcmFnRGlyZWN0aW9uID4gLTkwIC0gcmFuZ2UgJiYgZHJhZ0RpcmVjdGlvbiA8IC05MCArIHJhbmdlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGJvdW5kaW5nIHJlY3RhbmdsZSBvZiB0aGUgZHJhZyB0YXJnZXQgYXJlYSBpbiBwaXhlbCB1bml0c1xuICAgKiByZWxhdGl2ZSB0byB2aWV3cG9ydC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGNvbXBvbmVudCdzIGJvdW5kaW5nIGJveC4gTnVsbCBpZiBkcmFnIHRhcmdldCBhcmVhIHNob3VsZCBiZVxuICAgKiAgICAgaWdub3JlZC5cbiAgICovXG4gIG92ZXJyaWRlIGdldENsaWVudFJlY3QoKTogUmVjdHxudWxsIHtcbiAgICBpZiAoIXRoaXMuc3ZnR3JvdXBfIHx8IHRoaXMuYXV0b0Nsb3NlIHx8ICF0aGlzLmlzVmlzaWJsZSgpKSB7XG4gICAgICAvLyBUaGUgYm91bmRpbmcgcmVjdGFuZ2xlIHdvbid0IGNvbXB1dGUgY29ycmVjdGx5IGlmIHRoZSBmbHlvdXQgaXMgY2xvc2VkXG4gICAgICAvLyBhbmQgYXV0by1jbG9zZSBmbHlvdXRzIGFyZW4ndCB2YWxpZCBkcmFnIHRhcmdldHMgKG9yIGRlbGV0ZSBhcmVhcykuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBmbHlvdXRSZWN0ID0gdGhpcy5zdmdHcm91cF8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgLy8gQklHX05VTSBpcyBvZmZzY3JlZW4gcGFkZGluZyBzbyB0aGF0IGJsb2NrcyBkcmFnZ2VkIGJleW9uZCB0aGUgc2hvd25cbiAgICAvLyBmbHlvdXQgYXJlYSBhcmUgc3RpbGwgZGVsZXRlZC4gIE11c3QgYmUgbGFyZ2VyIHRoYW4gdGhlIGxhcmdlc3Qgc2NyZWVuXG4gICAgLy8gc2l6ZSwgYnV0IGJlIHNtYWxsZXIgdGhhbiBoYWxmIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIChub3QgYXZhaWxhYmxlIG9uXG4gICAgLy8gSUUpLlxuICAgIGNvbnN0IEJJR19OVU0gPSAxMDAwMDAwMDAwO1xuICAgIGNvbnN0IHRvcCA9IGZseW91dFJlY3QudG9wO1xuXG4gICAgaWYgKHRoaXMudG9vbGJveFBvc2l0aW9uXyA9PT0gdG9vbGJveC5Qb3NpdGlvbi5UT1ApIHtcbiAgICAgIGNvbnN0IGhlaWdodCA9IGZseW91dFJlY3QuaGVpZ2h0O1xuICAgICAgcmV0dXJuIG5ldyBSZWN0KC1CSUdfTlVNLCB0b3AgKyBoZWlnaHQsIC1CSUdfTlVNLCBCSUdfTlVNKTtcbiAgICB9IGVsc2UgeyAgLy8gQm90dG9tLlxuICAgICAgcmV0dXJuIG5ldyBSZWN0KHRvcCwgQklHX05VTSwgLUJJR19OVU0sIEJJR19OVU0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlIGhlaWdodCBvZiBmbHlvdXQuICB0b29sYm94LlBvc2l0aW9uIG1hdCB1bmRlciBlYWNoIGJsb2NrLlxuICAgKiBGb3IgUlRMOiBMYXkgb3V0IHRoZSBibG9ja3MgcmlnaHQtYWxpZ25lZC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSByZWZsb3dJbnRlcm5hbF8oKSB7XG4gICAgdGhpcy53b3Jrc3BhY2VfLnNjYWxlID0gdGhpcy5nZXRGbHlvdXRTY2FsZSgpO1xuICAgIGxldCBmbHlvdXRIZWlnaHQgPSAwO1xuICAgIGNvbnN0IGJsb2NrcyA9IHRoaXMud29ya3NwYWNlXy5nZXRUb3BCbG9ja3MoZmFsc2UpO1xuICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSBibG9ja3NbaV07IGkrKykge1xuICAgICAgZmx5b3V0SGVpZ2h0ID0gTWF0aC5tYXgoZmx5b3V0SGVpZ2h0LCBibG9jay5nZXRIZWlnaHRXaWR0aCgpLmhlaWdodCk7XG4gICAgfVxuICAgIGNvbnN0IGJ1dHRvbnMgPSB0aGlzLmJ1dHRvbnNfO1xuICAgIGZvciAobGV0IGkgPSAwLCBidXR0b247IGJ1dHRvbiA9IGJ1dHRvbnNbaV07IGkrKykge1xuICAgICAgZmx5b3V0SGVpZ2h0ID0gTWF0aC5tYXgoZmx5b3V0SGVpZ2h0LCBidXR0b24uaGVpZ2h0KTtcbiAgICB9XG4gICAgZmx5b3V0SGVpZ2h0ICs9IHRoaXMuTUFSR0lOICogMS41O1xuICAgIGZseW91dEhlaWdodCAqPSB0aGlzLndvcmtzcGFjZV8uc2NhbGU7XG4gICAgZmx5b3V0SGVpZ2h0ICs9IFNjcm9sbGJhci5zY3JvbGxiYXJUaGlja25lc3M7XG5cbiAgICBpZiAodGhpcy5oZWlnaHRfICE9PSBmbHlvdXRIZWlnaHQpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBibG9jazsgYmxvY2sgPSBibG9ja3NbaV07IGkrKykge1xuICAgICAgICBpZiAodGhpcy5yZWN0TWFwXy5oYXMoYmxvY2spKSB7XG4gICAgICAgICAgdGhpcy5tb3ZlUmVjdFRvQmxvY2tfKHRoaXMucmVjdE1hcF8uZ2V0KGJsb2NrKSEsIGJsb2NrKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy50YXJnZXRXb3Jrc3BhY2UhLnRvb2xib3hQb3NpdGlvbiA9PT0gdGhpcy50b29sYm94UG9zaXRpb25fICYmXG4gICAgICAgICAgdGhpcy50b29sYm94UG9zaXRpb25fID09PSB0b29sYm94LlBvc2l0aW9uLlRPUCAmJlxuICAgICAgICAgICF0aGlzLnRhcmdldFdvcmtzcGFjZSEuZ2V0VG9vbGJveCgpKSB7XG4gICAgICAgIC8vIFRoaXMgZmx5b3V0IGlzIGEgc2ltcGxlIHRvb2xib3guIFJlcG9zaXRpb24gdGhlIHdvcmtzcGFjZSBzbyB0aGF0XG4gICAgICAgIC8vICgwLDApIGlzIGluIHRoZSBjb3JyZWN0IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBuZXcgYWJzb2x1dGUgZWRnZVxuICAgICAgICAvLyAoaWUgdG9vbGJveCBlZGdlKS5cbiAgICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UhLnRyYW5zbGF0ZShcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0V29ya3NwYWNlIS5zY3JvbGxYLFxuICAgICAgICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UhLnNjcm9sbFkgKyBmbHlvdXRIZWlnaHQpO1xuICAgICAgfVxuICAgICAgdGhpcy5oZWlnaHRfID0gZmx5b3V0SGVpZ2h0O1xuICAgICAgdGhpcy5wb3NpdGlvbigpO1xuICAgICAgdGhpcy50YXJnZXRXb3Jrc3BhY2UhLnJlY29yZERyYWdUYXJnZXRzKCk7XG4gICAgfVxuICB9XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRkxZT1VUU19IT1JJWk9OVEFMX1RPT0xCT1gsIHJlZ2lzdHJ5LkRFRkFVTFQsXG4gICAgSG9yaXpvbnRhbEZseW91dCk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogVmFyaWFibGUgaW5wdXQgZmllbGQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRmllbGRWYXJpYWJsZScpO1xuXG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19jaGFuZ2UuanMnO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4vYmxvY2suanMnO1xuaW1wb3J0IHtGaWVsZCwgRmllbGRDb25maWcsIFVuYXR0YWNoZWRGaWVsZEVycm9yfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCB7RmllbGREcm9wZG93biwgRmllbGREcm9wZG93blZhbGlkYXRvciwgTWVudUdlbmVyYXRvciwgTWVudU9wdGlvbn0gZnJvbSAnLi9maWVsZF9kcm9wZG93bi5qcyc7XG5pbXBvcnQgKiBhcyBmaWVsZFJlZ2lzdHJ5IGZyb20gJy4vZmllbGRfcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgaW50ZXJuYWxDb25zdGFudHMgZnJvbSAnLi9pbnRlcm5hbF9jb25zdGFudHMuanMnO1xuaW1wb3J0IHR5cGUge01lbnV9IGZyb20gJy4vbWVudS5qcyc7XG5pbXBvcnQgdHlwZSB7TWVudUl0ZW19IGZyb20gJy4vbWVudWl0ZW0uanMnO1xuaW1wb3J0IHtNc2d9IGZyb20gJy4vbXNnLmpzJztcbmltcG9ydCAqIGFzIHBhcnNpbmcgZnJvbSAnLi91dGlscy9wYXJzaW5nLmpzJztcbmltcG9ydCB0eXBlIHtTZW50aW5lbH0gZnJvbSAnLi91dGlscy9zZW50aW5lbC5qcyc7XG5pbXBvcnQge1NpemV9IGZyb20gJy4vdXRpbHMvc2l6ZS5qcyc7XG5pbXBvcnQge1ZhcmlhYmxlTW9kZWx9IGZyb20gJy4vdmFyaWFibGVfbW9kZWwuanMnO1xuaW1wb3J0ICogYXMgVmFyaWFibGVzIGZyb20gJy4vdmFyaWFibGVzLmpzJztcbmltcG9ydCAqIGFzIFhtbCBmcm9tICcuL3htbC5qcyc7XG5cbmV4cG9ydCB0eXBlIEZpZWxkVmFyaWFibGVWYWxpZGF0b3IgPSBGaWVsZERyb3Bkb3duVmFsaWRhdG9yO1xuXG4vKipcbiAqIENsYXNzIGZvciBhIHZhcmlhYmxlJ3MgZHJvcGRvd24gZmllbGQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmllbGRWYXJpYWJsZVxuICovXG5leHBvcnQgY2xhc3MgRmllbGRWYXJpYWJsZSBleHRlbmRzIEZpZWxkRHJvcGRvd24ge1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgbWVudUdlbmVyYXRvcl86IE1lbnVHZW5lcmF0b3J8dW5kZWZpbmVkO1xuICBkZWZhdWx0VmFyaWFibGVOYW1lOiBzdHJpbmc7XG5cbiAgLyoqIFRoZSB0eXBlIG9mIHRoZSBkZWZhdWx0IHZhcmlhYmxlIGZvciB0aGlzIGZpZWxkLiAqL1xuICBwcml2YXRlIGRlZmF1bHRUeXBlXyA9ICcnO1xuXG4gIC8qKlxuICAgKiBBbGwgb2YgdGhlIHR5cGVzIG9mIHZhcmlhYmxlcyB0aGF0IHdpbGwgYmUgYXZhaWxhYmxlIGluIHRoaXMgZmllbGQnc1xuICAgKiBkcm9wZG93bi5cbiAgICovXG4gIHZhcmlhYmxlVHlwZXM6IHN0cmluZ1tdfG51bGwgPSBbXTtcbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHNpemVfOiBTaXplO1xuXG4gIC8qKiBUaGUgdmFyaWFibGUgbW9kZWwgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZmllbGQuICovXG4gIHByaXZhdGUgdmFyaWFibGVfOiBWYXJpYWJsZU1vZGVsfG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBTZXJpYWxpemFibGUgZmllbGRzIGFyZSBzYXZlZCBieSB0aGUgc2VyaWFsaXplciwgbm9uLXNlcmlhbGl6YWJsZSBmaWVsZHNcbiAgICogYXJlIG5vdC4gRWRpdGFibGUgZmllbGRzIHNob3VsZCBhbHNvIGJlIHNlcmlhbGl6YWJsZS5cbiAgICovXG4gIG92ZXJyaWRlIFNFUklBTElaQUJMRSA9IHRydWU7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB2YXJOYW1lIFRoZSBkZWZhdWx0IG5hbWUgZm9yIHRoZSB2YXJpYWJsZS5cbiAgICogICAgIElmIG51bGwsIGEgdW5pcXVlIHZhcmlhYmxlIG5hbWUgd2lsbCBiZSBnZW5lcmF0ZWQuXG4gICAqICAgICBBbHNvIGFjY2VwdHMgRmllbGQuU0tJUF9TRVRVUCBpZiB5b3Ugd2lzaCB0byBza2lwIHNldHVwIChvbmx5IHVzZWQgYnlcbiAgICogc3ViY2xhc3NlcyB0aGF0IHdhbnQgdG8gaGFuZGxlIGNvbmZpZ3VyYXRpb24gYW5kIHNldHRpbmcgdGhlIGZpZWxkIHZhbHVlXG4gICAqIGFmdGVyIHRoZWlyIG93biBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4pLlxuICAgKiBAcGFyYW0gb3B0X3ZhbGlkYXRvciBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRvIHZhbGlkYXRlIGNoYW5nZXMgdG8gdGhlXG4gICAqICAgICBmaWVsZCdzIHZhbHVlLiBUYWtlcyBpbiBhIHZhcmlhYmxlIElEICAmIHJldHVybnMgYSB2YWxpZGF0ZWQgdmFyaWFibGVcbiAgICogICAgIElELCBvciBudWxsIHRvIGFib3J0IHRoZSBjaGFuZ2UuXG4gICAqIEBwYXJhbSBvcHRfdmFyaWFibGVUeXBlcyBBIGxpc3Qgb2YgdGhlIHR5cGVzIG9mIHZhcmlhYmxlcyB0byBpbmNsdWRlIGluIHRoZVxuICAgKiAgICAgZHJvcGRvd24uIFdpbGwgb25seSBiZSB1c2VkIGlmIG9wdF9jb25maWcgaXMgbm90IHByb3ZpZGVkLlxuICAgKiBAcGFyYW0gb3B0X2RlZmF1bHRUeXBlIFRoZSB0eXBlIG9mIHZhcmlhYmxlIHRvIGNyZWF0ZSBpZiB0aGlzIGZpZWxkJ3MgdmFsdWVcbiAgICogICAgIGlzIG5vdCBleHBsaWNpdGx5IHNldC4gIERlZmF1bHRzIHRvICcnLiBXaWxsIG9ubHkgYmUgdXNlZCBpZiBvcHRfY29uZmlnXG4gICAqICAgICBpcyBub3QgcHJvdmlkZWQuXG4gICAqIEBwYXJhbSBvcHRfY29uZmlnIEEgbWFwIG9mIG9wdGlvbnMgdXNlZCB0byBjb25maWd1cmUgdGhlIGZpZWxkLlxuICAgKiAgICBTZWUgdGhlIFtmaWVsZCBjcmVhdGlvbiBkb2N1bWVudGF0aW9uXXtAbGlua1xuICAgKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy9maWVsZHMvYnVpbHQtaW4tZmllbGRzL3ZhcmlhYmxlI2NyZWF0aW9ufVxuICAgKiBmb3IgYSBsaXN0IG9mIHByb3BlcnRpZXMgdGhpcyBwYXJhbWV0ZXIgc3VwcG9ydHMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIHZhck5hbWU6IHN0cmluZ3xudWxsfFNlbnRpbmVsLCBvcHRfdmFsaWRhdG9yPzogRmllbGRWYXJpYWJsZVZhbGlkYXRvcixcbiAgICAgIG9wdF92YXJpYWJsZVR5cGVzPzogc3RyaW5nW10sIG9wdF9kZWZhdWx0VHlwZT86IHN0cmluZyxcbiAgICAgIG9wdF9jb25maWc/OiBGaWVsZFZhcmlhYmxlQ29uZmlnKSB7XG4gICAgc3VwZXIoRmllbGQuU0tJUF9TRVRVUCk7XG5cbiAgICAvKipcbiAgICAgKiBBbiBhcnJheSBvZiBvcHRpb25zIGZvciBhIGRyb3Bkb3duIGxpc3QsXG4gICAgICogb3IgYSBmdW5jdGlvbiB3aGljaCBnZW5lcmF0ZXMgdGhlc2Ugb3B0aW9ucy5cbiAgICAgKi9cbiAgICB0aGlzLm1lbnVHZW5lcmF0b3JfID0gRmllbGRWYXJpYWJsZS5kcm9wZG93bkNyZWF0ZSBhcyBNZW51R2VuZXJhdG9yO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGluaXRpYWwgdmFyaWFibGUgbmFtZSBwYXNzZWQgdG8gdGhpcyBmaWVsZCdzIGNvbnN0cnVjdG9yLCBvciBhblxuICAgICAqIGVtcHR5IHN0cmluZyBpZiBhIG5hbWUgd2Fzbid0IHByb3ZpZGVkLiBVc2VkIHRvIGNyZWF0ZSB0aGUgaW5pdGlhbFxuICAgICAqIHZhcmlhYmxlLlxuICAgICAqL1xuICAgIHRoaXMuZGVmYXVsdFZhcmlhYmxlTmFtZSA9IHR5cGVvZiB2YXJOYW1lID09PSAnc3RyaW5nJyA/IHZhck5hbWUgOiAnJztcblxuICAgIC8qKiBUaGUgc2l6ZSBvZiB0aGUgYXJlYSByZW5kZXJlZCBieSB0aGUgZmllbGQuICovXG4gICAgdGhpcy5zaXplXyA9IG5ldyBTaXplKDAsIDApO1xuXG4gICAgaWYgKHZhck5hbWUgPT09IEZpZWxkLlNLSVBfU0VUVVApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldFR5cGVzXyhvcHRfdmFyaWFibGVUeXBlcywgb3B0X2RlZmF1bHRUeXBlKTtcbiAgICB9XG4gICAgaWYgKG9wdF92YWxpZGF0b3IpIHtcbiAgICAgIHRoaXMuc2V0VmFsaWRhdG9yKG9wdF92YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIGZpZWxkIGJhc2VkIG9uIHRoZSBnaXZlbiBtYXAgb2Ygb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGNvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQgYmFzZWQgb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY29uZmlndXJlXyhjb25maWc6IEZpZWxkVmFyaWFibGVDb25maWcpIHtcbiAgICBzdXBlci5jb25maWd1cmVfKGNvbmZpZyk7XG4gICAgdGhpcy5zZXRUeXBlc18oY29uZmlnLnZhcmlhYmxlVHlwZXMsIGNvbmZpZy5kZWZhdWx0VHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgbW9kZWwgZm9yIHRoaXMgZmllbGQgaWYgaXQgaGFzIG5vdCBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuXG4gICAqIElmIHRoZSB2YWx1ZSBoYXMgbm90IGJlZW4gc2V0IHRvIGEgdmFyaWFibGUgYnkgdGhlIGZpcnN0IHJlbmRlciwgd2UgbWFrZSB1cFxuICAgKiBhIHZhcmlhYmxlIHJhdGhlciB0aGFuIGxldCB0aGUgdmFsdWUgYmUgaW52YWxpZC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBpbml0TW9kZWwoKSB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IFVuYXR0YWNoZWRGaWVsZEVycm9yKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnZhcmlhYmxlXykge1xuICAgICAgcmV0dXJuOyAgLy8gSW5pdGlhbGl6YXRpb24gYWxyZWFkeSBoYXBwZW5lZC5cbiAgICB9XG4gICAgY29uc3QgdmFyaWFibGUgPSBWYXJpYWJsZXMuZ2V0T3JDcmVhdGVWYXJpYWJsZVBhY2thZ2UoXG4gICAgICAgIGJsb2NrLndvcmtzcGFjZSwgbnVsbCwgdGhpcy5kZWZhdWx0VmFyaWFibGVOYW1lLCB0aGlzLmRlZmF1bHRUeXBlXyk7XG4gICAgLy8gRG9uJ3QgY2FsbCBzZXRWYWx1ZSBiZWNhdXNlIHdlIGRvbid0IHdhbnQgdG8gY2F1c2UgYSByZXJlbmRlci5cbiAgICB0aGlzLmRvVmFsdWVVcGRhdGVfKHZhcmlhYmxlLmdldElkKCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2hvdWxkQWRkQm9yZGVyUmVjdF8oKSB7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IFVuYXR0YWNoZWRGaWVsZEVycm9yKCk7XG4gICAgfVxuICAgIHJldHVybiBzdXBlci5zaG91bGRBZGRCb3JkZXJSZWN0XygpICYmXG4gICAgICAgICghdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfRFJPUERPV05fTk9fQk9SREVSX1JFQ1RfU0hBRE9XIHx8XG4gICAgICAgICBibG9jay50eXBlICE9PSAndmFyaWFibGVzX2dldCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhpcyBmaWVsZCBiYXNlZCBvbiB0aGUgZ2l2ZW4gWE1MLlxuICAgKlxuICAgKiBAcGFyYW0gZmllbGRFbGVtZW50IFRoZSBlbGVtZW50IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHZhcmlhYmxlXG4gICAqICAgICBmaWVsZCdzIHN0YXRlLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbVhtbChmaWVsZEVsZW1lbnQ6IEVsZW1lbnQpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3QgaWQgPSBmaWVsZEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAgIGNvbnN0IHZhcmlhYmxlTmFtZSA9IGZpZWxkRWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAvLyAndmFyaWFibGV0eXBlJyBzaG91bGQgYmUgbG93ZXJjYXNlLCBidXQgdW50aWwgSnVseSAyMDE5IGl0IHdhcyBzb21ldGltZXNcbiAgICAvLyByZWNvcmRlZCBhcyAndmFyaWFibGVUeXBlJy4gIFRodXMgd2UgbmVlZCB0byBjaGVjayBmb3IgYm90aC5cbiAgICBjb25zdCB2YXJpYWJsZVR5cGUgPSBmaWVsZEVsZW1lbnQuZ2V0QXR0cmlidXRlKCd2YXJpYWJsZXR5cGUnKSB8fFxuICAgICAgICBmaWVsZEVsZW1lbnQuZ2V0QXR0cmlidXRlKCd2YXJpYWJsZVR5cGUnKSB8fCAnJztcblxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnc3RyaW5nIHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nIHwgdW5kZWZpbmVkJy5cbiAgICBjb25zdCB2YXJpYWJsZSA9IFZhcmlhYmxlcy5nZXRPckNyZWF0ZVZhcmlhYmxlUGFja2FnZShcbiAgICAgICAgYmxvY2sud29ya3NwYWNlLCBpZCwgdmFyaWFibGVOYW1lIGFzIEFueUR1cmluZ01pZ3JhdGlvbiwgdmFyaWFibGVUeXBlKTtcblxuICAgIC8vIFRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlbiA6KVxuICAgIGlmICh2YXJpYWJsZVR5cGUgIT09IG51bGwgJiYgdmFyaWFibGVUeXBlICE9PSB2YXJpYWJsZS50eXBlKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnU2VyaWFsaXplZCB2YXJpYWJsZSB0eXBlIHdpdGggaWQgXFwnJyArIHZhcmlhYmxlLmdldElkKCkgK1xuICAgICAgICAgICdcXCcgaGFkIHR5cGUgJyArIHZhcmlhYmxlLnR5cGUgKyAnLCBhbmQgJyArXG4gICAgICAgICAgJ2RvZXMgbm90IG1hdGNoIHZhcmlhYmxlIGZpZWxkIHRoYXQgcmVmZXJlbmNlcyBpdDogJyArXG4gICAgICAgICAgWG1sLmRvbVRvVGV4dChmaWVsZEVsZW1lbnQpICsgJy4nKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldFZhbHVlKHZhcmlhYmxlLmdldElkKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6ZSB0aGlzIGZpZWxkIHRvIFhNTC5cbiAgICpcbiAgICogQHBhcmFtIGZpZWxkRWxlbWVudCBUaGUgZWxlbWVudCB0byBwb3B1bGF0ZSB3aXRoIGluZm8gYWJvdXQgdGhlIGZpZWxkJ3NcbiAgICogICAgIHN0YXRlLlxuICAgKiBAcmV0dXJucyBUaGUgZWxlbWVudCBjb250YWluaW5nIGluZm8gYWJvdXQgdGhlIGZpZWxkJ3Mgc3RhdGUuXG4gICAqL1xuICBvdmVycmlkZSB0b1htbChmaWVsZEVsZW1lbnQ6IEVsZW1lbnQpOiBFbGVtZW50IHtcbiAgICAvLyBNYWtlIHN1cmUgdGhlIHZhcmlhYmxlIGlzIGluaXRpYWxpemVkLlxuICAgIHRoaXMuaW5pdE1vZGVsKCk7XG5cbiAgICBmaWVsZEVsZW1lbnQuaWQgPSB0aGlzLnZhcmlhYmxlXyEuZ2V0SWQoKTtcbiAgICBmaWVsZEVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLnZhcmlhYmxlXyEubmFtZTtcbiAgICBpZiAodGhpcy52YXJpYWJsZV8hLnR5cGUpIHtcbiAgICAgIGZpZWxkRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZhcmlhYmxldHlwZScsIHRoaXMudmFyaWFibGVfIS50eXBlKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlcyB0aGlzIGZpZWxkJ3MgdmFsdWUuXG4gICAqXG4gICAqIEBwYXJhbSBkb0Z1bGxTZXJpYWxpemF0aW9uIElmIHRydWUsIHRoZSB2YXJpYWJsZSBmaWVsZCB3aWxsIHNlcmlhbGl6ZSB0aGVcbiAgICogICAgIGZ1bGwgc3RhdGUgb2YgdGhlIGZpZWxkIGJlaW5nIHJlZmVyZW5jZWQgKGllIElELCBuYW1lLCBhbmQgdHlwZSkgcmF0aGVyXG4gICAqICAgICB0aGFuIGp1c3QgYSByZWZlcmVuY2UgdG8gaXQgKGllIElEKS5cbiAgICogQHJldHVybnMgVGhlIHN0YXRlIG9mIHRoZSB2YXJpYWJsZSBmaWVsZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBzYXZlU3RhdGUoZG9GdWxsU2VyaWFsaXphdGlvbj86IGJvb2xlYW4pOiBBbnlEdXJpbmdNaWdyYXRpb24ge1xuICAgIGNvbnN0IGxlZ2FjeVN0YXRlID0gdGhpcy5zYXZlTGVnYWN5U3RhdGUoRmllbGRWYXJpYWJsZSk7XG4gICAgaWYgKGxlZ2FjeVN0YXRlICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbGVnYWN5U3RhdGU7XG4gICAgfVxuICAgIC8vIE1ha2Ugc3VyZSB0aGUgdmFyaWFibGUgaXMgaW5pdGlhbGl6ZWQuXG4gICAgdGhpcy5pbml0TW9kZWwoKTtcbiAgICBjb25zdCBzdGF0ZSA9IHsnaWQnOiB0aGlzLnZhcmlhYmxlXyEuZ2V0SWQoKX07XG4gICAgaWYgKGRvRnVsbFNlcmlhbGl6YXRpb24pIHtcbiAgICAgIChzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWyduYW1lJ10gPSB0aGlzLnZhcmlhYmxlXyEubmFtZTtcbiAgICAgIChzdGF0ZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pWyd0eXBlJ10gPSB0aGlzLnZhcmlhYmxlXyEudHlwZTtcbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZpZWxkJ3MgdmFsdWUgYmFzZWQgb24gdGhlIGdpdmVuIHN0YXRlLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9mIHRoZSB2YXJpYWJsZSB0byBhc3NpZ24gdG8gdGhpcyB2YXJpYWJsZSBmaWVsZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBsb2FkU3RhdGUoc3RhdGU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgIGNvbnN0IGJsb2NrID0gdGhpcy5nZXRTb3VyY2VCbG9jaygpO1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIHRocm93IG5ldyBVbmF0dGFjaGVkRmllbGRFcnJvcigpO1xuICAgIH1cbiAgICBpZiAodGhpcy5sb2FkTGVnYWN5U3RhdGUoRmllbGRWYXJpYWJsZSwgc3RhdGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHNvIHRoYXQgYmxvY2tzIGluIHRoZSBmbHlvdXQgY2FuIGhhdmUgY3VzdG9tIHZhciBuYW1lcy5cbiAgICBjb25zdCB2YXJpYWJsZSA9IFZhcmlhYmxlcy5nZXRPckNyZWF0ZVZhcmlhYmxlUGFja2FnZShcbiAgICAgICAgYmxvY2sud29ya3NwYWNlLCBzdGF0ZVsnaWQnXSB8fCBudWxsLCBzdGF0ZVsnbmFtZSddLFxuICAgICAgICBzdGF0ZVsndHlwZSddIHx8ICcnKTtcbiAgICB0aGlzLnNldFZhbHVlKHZhcmlhYmxlLmdldElkKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaCB0aGlzIGZpZWxkIHRvIGEgYmxvY2suXG4gICAqXG4gICAqIEBwYXJhbSBibG9jayBUaGUgYmxvY2sgY29udGFpbmluZyB0aGlzIGZpZWxkLlxuICAgKi9cbiAgb3ZlcnJpZGUgc2V0U291cmNlQmxvY2soYmxvY2s6IEJsb2NrKSB7XG4gICAgaWYgKGJsb2NrLmlzU2hhZG93KCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdWYXJpYWJsZSBmaWVsZHMgYXJlIG5vdCBhbGxvd2VkIHRvIGV4aXN0IG9uIHNoYWRvdyBibG9ja3MuJyk7XG4gICAgfVxuICAgIHN1cGVyLnNldFNvdXJjZUJsb2NrKGJsb2NrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHZhcmlhYmxlJ3MgSUQuXG4gICAqXG4gICAqIEByZXR1cm5zIEN1cnJlbnQgdmFyaWFibGUncyBJRC5cbiAgICovXG4gIG92ZXJyaWRlIGdldFZhbHVlKCk6IHN0cmluZ3xudWxsIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZV8gPyB0aGlzLnZhcmlhYmxlXy5nZXRJZCgpIDogbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRleHQgZnJvbSB0aGlzIGZpZWxkLCB3aGljaCBpcyB0aGUgc2VsZWN0ZWQgdmFyaWFibGUncyBuYW1lLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgc2VsZWN0ZWQgdmFyaWFibGUncyBuYW1lLCBvciB0aGUgZW1wdHkgc3RyaW5nIGlmIG5vIHZhcmlhYmxlXG4gICAqICAgICBpcyBzZWxlY3RlZC5cbiAgICovXG4gIG92ZXJyaWRlIGdldFRleHQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZV8gPyB0aGlzLnZhcmlhYmxlXy5uYW1lIDogJyc7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB2YXJpYWJsZSBtb2RlbCBmb3IgdGhlIHNlbGVjdGVkIHZhcmlhYmxlLlxuICAgKiBOb3QgZ3VhcmFudGVlZCB0byBiZSBpbiB0aGUgdmFyaWFibGUgbWFwIG9uIHRoZSB3b3Jrc3BhY2UgKGUuZy4gaWYgYWNjZXNzZWRcbiAgICogYWZ0ZXIgdGhlIHZhcmlhYmxlIGhhcyBiZWVuIGRlbGV0ZWQpLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgc2VsZWN0ZWQgdmFyaWFibGUsIG9yIG51bGwgaWYgbm9uZSB3YXMgc2VsZWN0ZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgZ2V0VmFyaWFibGUoKTogVmFyaWFibGVNb2RlbHxudWxsIHtcbiAgICByZXR1cm4gdGhpcy52YXJpYWJsZV87XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdmFsaWRhdGlvbiBmdW5jdGlvbiBmb3IgdGhpcyBmaWVsZCwgb3IgbnVsbCBpZiBub3Qgc2V0LlxuICAgKiBSZXR1cm5zIG51bGwgaWYgdGhlIHZhcmlhYmxlIGlzIG5vdCBzZXQsIGJlY2F1c2UgdmFsaWRhdG9ycyBzaG91bGQgbm90XG4gICAqIHJ1biBvbiB0aGUgaW5pdGlhbCBzZXRWYWx1ZSBjYWxsLCBiZWNhdXNlIHRoZSBmaWVsZCB3b24ndCBiZSBhdHRhY2hlZCB0b1xuICAgKiBhIGJsb2NrIGFuZCB3b3Jrc3BhY2UgYXQgdGhhdCBwb2ludC5cbiAgICpcbiAgICogQHJldHVybnMgVmFsaWRhdGlvbiBmdW5jdGlvbiwgb3IgbnVsbC5cbiAgICovXG4gIG92ZXJyaWRlIGdldFZhbGlkYXRvcigpOiBGdW5jdGlvbnxudWxsIHtcbiAgICAvLyBWYWxpZGF0b3JzIHNob3VsZG4ndCBvcGVyYXRlIG9uIHRoZSBpbml0aWFsIHNldFZhbHVlIGNhbGwuXG4gICAgLy8gTm9ybWFsbHkgdGhpcyBpcyBhY2hpZXZlZCBieSBjYWxsaW5nIHNldFZhbGlkYXRvciBhZnRlciBzZXRWYWx1ZSwgYnV0XG4gICAgLy8gdGhpcyBpcyBub3QgYSBwb3NzaWJpbGl0eSB3aXRoIHZhcmlhYmxlIGZpZWxkcy5cbiAgICBpZiAodGhpcy52YXJpYWJsZV8pIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRvcl87XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuc3VyZSB0aGF0IHRoZSBJRCBiZWxvbmdzIHRvIGEgdmFsaWQgdmFyaWFibGUgb2YgYW4gYWxsb3dlZCB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIFRoZSBJRCBvZiB0aGUgbmV3IHZhcmlhYmxlIHRvIHNldC5cbiAgICogQHJldHVybnMgVGhlIHZhbGlkYXRlZCBJRCwgb3IgbnVsbCBpZiBpbnZhbGlkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvQ2xhc3NWYWxpZGF0aW9uXyhvcHRfbmV3VmFsdWU/OiBBbnlEdXJpbmdNaWdyYXRpb24pOlxuICAgICAgc3RyaW5nfG51bGwge1xuICAgIGlmIChvcHRfbmV3VmFsdWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgY29uc3QgbmV3SWQgPSBvcHRfbmV3VmFsdWUgYXMgc3RyaW5nO1xuICAgIGNvbnN0IHZhcmlhYmxlID0gVmFyaWFibGVzLmdldFZhcmlhYmxlKGJsb2NrLndvcmtzcGFjZSwgbmV3SWQpO1xuICAgIGlmICghdmFyaWFibGUpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnVmFyaWFibGUgaWQgZG9lc25cXCd0IHBvaW50IHRvIGEgcmVhbCB2YXJpYWJsZSEgJyArXG4gICAgICAgICAgJ0lEIHdhcyAnICsgbmV3SWQpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIFR5cGUgQ2hlY2tzLlxuICAgIGNvbnN0IHR5cGUgPSB2YXJpYWJsZS50eXBlO1xuICAgIGlmICghdGhpcy50eXBlSXNBbGxvd2VkXyh0eXBlKSkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICdWYXJpYWJsZSB0eXBlIGRvZXNuXFwndCBtYXRjaCB0aGlzIGZpZWxkISAgVHlwZSB3YXMgJyArIHR5cGUpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBuZXdJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoaXMgdmFyaWFibGUgZmllbGQsIGFzIHdlbGwgYXMgaXRzIHZhcmlhYmxlIGFuZCB0ZXh0LlxuICAgKlxuICAgKiBUaGUgdmFyaWFibGUgSUQgc2hvdWxkIGJlIHZhbGlkIGF0IHRoaXMgcG9pbnQsIGJ1dCBpZiBhIHZhcmlhYmxlIGZpZWxkXG4gICAqIHZhbGlkYXRvciByZXR1cm5zIGEgYmFkIElELCB0aGlzIGNvdWxkIGJyZWFrLlxuICAgKlxuICAgKiBAcGFyYW0gbmV3SWQgVGhlIHZhbHVlIHRvIGJlIHNhdmVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvVmFsdWVVcGRhdGVfKG5ld0lkOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgdGhpcy52YXJpYWJsZV8gPSBWYXJpYWJsZXMuZ2V0VmFyaWFibGUoYmxvY2sud29ya3NwYWNlLCBuZXdJZCBhcyBzdHJpbmcpO1xuICAgIHN1cGVyLmRvVmFsdWVVcGRhdGVfKG5ld0lkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRoZSBnaXZlbiB2YXJpYWJsZSB0eXBlIGlzIGFsbG93ZWQgb24gdGhpcyBmaWVsZC5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHR5cGUgaXMgaW4gdGhlIGxpc3Qgb2YgYWxsb3dlZCB0eXBlcy5cbiAgICovXG4gIHByaXZhdGUgdHlwZUlzQWxsb3dlZF8odHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdHlwZUxpc3QgPSB0aGlzLmdldFZhcmlhYmxlVHlwZXNfKCk7XG4gICAgaWYgKCF0eXBlTGlzdCkge1xuICAgICAgcmV0dXJuIHRydWU7ICAvLyBJZiBpdCdzIG51bGwsIGFsbCB0eXBlcyBhcmUgdmFsaWQuXG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHlwZUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0eXBlID09PSB0eXBlTGlzdFtpXSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhIGxpc3Qgb2YgdmFyaWFibGUgdHlwZXMgdG8gaW5jbHVkZSBpbiB0aGUgZHJvcGRvd24uXG4gICAqXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIHZhcmlhYmxlIHR5cGVzLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gaWYgdmFyaWFibGVUeXBlcyBpcyBhbiBlbXB0eSBhcnJheS5cbiAgICovXG4gIHByaXZhdGUgZ2V0VmFyaWFibGVUeXBlc18oKTogc3RyaW5nW10ge1xuICAgIC8vIFRPRE8gKCMxNTEzKTogVHJ5IHRvIGF2b2lkIGNhbGxpbmcgdGhpcyBldmVyeSB0aW1lIHRoZSBmaWVsZCBpcyBlZGl0ZWQuXG4gICAgbGV0IHZhcmlhYmxlVHlwZXMgPSB0aGlzLnZhcmlhYmxlVHlwZXM7XG4gICAgaWYgKHZhcmlhYmxlVHlwZXMgPT09IG51bGwpIHtcbiAgICAgIC8vIElmIHZhcmlhYmxlVHlwZXMgaXMgbnVsbCwgcmV0dXJuIGFsbCB2YXJpYWJsZSB0eXBlcy5cbiAgICAgIGlmICh0aGlzLnNvdXJjZUJsb2NrXyAmJiAhdGhpcy5zb3VyY2VCbG9ja18uaXNEZWFkT3JEeWluZygpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvdXJjZUJsb2NrXy53b3Jrc3BhY2UuZ2V0VmFyaWFibGVUeXBlcygpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXJpYWJsZVR5cGVzID0gdmFyaWFibGVUeXBlcyB8fCBbJyddO1xuICAgIGlmICh2YXJpYWJsZVR5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gVGhyb3cgYW4gZXJyb3IgaWYgdmFyaWFibGVUeXBlcyBpcyBhbiBlbXB0eSBsaXN0LlxuICAgICAgY29uc3QgbmFtZSA9IHRoaXMuZ2V0VGV4dCgpO1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgJ1xcJ3ZhcmlhYmxlVHlwZXNcXCcgb2YgZmllbGQgdmFyaWFibGUgJyArIG5hbWUgKyAnIHdhcyBhbiBlbXB0eSBsaXN0Jyk7XG4gICAgfVxuICAgIHJldHVybiB2YXJpYWJsZVR5cGVzO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHRoZSBvcHRpb25hbCBhcmd1bWVudHMgcmVwcmVzZW50aW5nIHRoZSBhbGxvd2VkIHZhcmlhYmxlIHR5cGVzIGFuZFxuICAgKiB0aGUgZGVmYXVsdCB2YXJpYWJsZSB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X3ZhcmlhYmxlVHlwZXMgQSBsaXN0IG9mIHRoZSB0eXBlcyBvZiB2YXJpYWJsZXMgdG8gaW5jbHVkZSBpbiB0aGVcbiAgICogICAgIGRyb3Bkb3duLiAgSWYgbnVsbCBvciB1bmRlZmluZWQsIHZhcmlhYmxlcyBvZiBhbGwgdHlwZXMgd2lsbCBiZVxuICAgKiAgICAgZGlzcGxheWVkIGluIHRoZSBkcm9wZG93bi5cbiAgICogQHBhcmFtIG9wdF9kZWZhdWx0VHlwZSBUaGUgdHlwZSBvZiB0aGUgdmFyaWFibGUgdG8gY3JlYXRlIGlmIHRoaXMgZmllbGQnc1xuICAgKiAgICAgdmFsdWUgaXMgbm90IGV4cGxpY2l0bHkgc2V0LiAgRGVmYXVsdHMgdG8gJycuXG4gICAqL1xuICBwcml2YXRlIHNldFR5cGVzXyhvcHRfdmFyaWFibGVUeXBlcz86IHN0cmluZ1tdLCBvcHRfZGVmYXVsdFR5cGU/OiBzdHJpbmcpIHtcbiAgICAvLyBJZiB5b3UgZXhwZWN0ZWQgdGhhdCB0aGUgZGVmYXVsdCB0eXBlIHdvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBvbmx5IGVudHJ5XG4gICAgLy8gaW4gdGhlIHZhcmlhYmxlIHR5cGVzIGFycmF5LCB0ZWxsIHRoZSBCbG9ja2x5IHRlYW0gYnkgY29tbWVudGluZyBvblxuICAgIC8vICMxNDk5LlxuICAgIGNvbnN0IGRlZmF1bHRUeXBlID0gb3B0X2RlZmF1bHRUeXBlIHx8ICcnO1xuICAgIGxldCB2YXJpYWJsZVR5cGVzO1xuICAgIC8vIFNldCB0aGUgYWxsb3dhYmxlIHZhcmlhYmxlIHR5cGVzLiAgTnVsbCBtZWFucyBhbGwgdHlwZXMgb24gdGhlIHdvcmtzcGFjZS5cbiAgICBpZiAob3B0X3ZhcmlhYmxlVHlwZXMgPT09IG51bGwgfHwgb3B0X3ZhcmlhYmxlVHlwZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFyaWFibGVUeXBlcyA9IG51bGw7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9wdF92YXJpYWJsZVR5cGVzKSkge1xuICAgICAgdmFyaWFibGVUeXBlcyA9IG9wdF92YXJpYWJsZVR5cGVzO1xuICAgICAgLy8gTWFrZSBzdXJlIHRoZSBkZWZhdWx0IHR5cGUgaXMgdmFsaWQuXG4gICAgICBsZXQgaXNJbkFycmF5ID0gZmFsc2U7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhcmlhYmxlVHlwZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHZhcmlhYmxlVHlwZXNbaV0gPT09IGRlZmF1bHRUeXBlKSB7XG4gICAgICAgICAgaXNJbkFycmF5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFpc0luQXJyYXkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAnSW52YWxpZCBkZWZhdWx0IHR5cGUgXFwnJyArIGRlZmF1bHRUeXBlICsgJ1xcJyBpbiAnICtcbiAgICAgICAgICAgICd0aGUgZGVmaW5pdGlvbiBvZiBhIEZpZWxkVmFyaWFibGUnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgJ1xcJ3ZhcmlhYmxlVHlwZXNcXCcgd2FzIG5vdCBhbiBhcnJheSBpbiB0aGUgZGVmaW5pdGlvbiBvZiAnICtcbiAgICAgICAgICAnYSBGaWVsZFZhcmlhYmxlJyk7XG4gICAgfVxuICAgIC8vIE9ubHkgdXBkYXRlIHRoZSBmaWVsZCBvbmNlIGFsbCBjaGVja3MgcGFzcy5cbiAgICB0aGlzLmRlZmF1bHRUeXBlXyA9IGRlZmF1bHRUeXBlO1xuICAgIHRoaXMudmFyaWFibGVUeXBlcyA9IHZhcmlhYmxlVHlwZXM7XG4gIH1cblxuICAvKipcbiAgICogUmVmcmVzaGVzIHRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZSBieSBncmFiYmluZyB0aGUgbmFtZSBvZiB0aGUgbW9kZWwuXG4gICAqIFVzZWQgd2hlbiBhIHZhcmlhYmxlIGdldHMgcmVuYW1lZCwgYnV0IHRoZSBJRCBzdGF5cyB0aGUgc2FtZS4gU2hvdWxkIG9ubHlcbiAgICogYmUgY2FsbGVkIGJ5IHRoZSBibG9jay5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSByZWZyZXNoVmFyaWFibGVOYW1lKCkge1xuICAgIHRoaXMuZm9yY2VSZXJlbmRlcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgc2VsZWN0aW9uIG9mIGFuIGl0ZW0gaW4gdGhlIHZhcmlhYmxlIGRyb3Bkb3duIG1lbnUuXG4gICAqIFNwZWNpYWwgY2FzZSB0aGUgJ1JlbmFtZSB2YXJpYWJsZS4uLicgYW5kICdEZWxldGUgdmFyaWFibGUuLi4nIG9wdGlvbnMuXG4gICAqIEluIHRoZSByZW5hbWUgY2FzZSwgcHJvbXB0IHRoZSB1c2VyIGZvciBhIG5ldyBuYW1lLlxuICAgKlxuICAgKiBAcGFyYW0gbWVudSBUaGUgTWVudSBjb21wb25lbnQgY2xpY2tlZC5cbiAgICogQHBhcmFtIG1lbnVJdGVtIFRoZSBNZW51SXRlbSBzZWxlY3RlZCB3aXRoaW4gbWVudS5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBvbkl0ZW1TZWxlY3RlZF8obWVudTogTWVudSwgbWVudUl0ZW06IE1lbnVJdGVtKSB7XG4gICAgY29uc3QgaWQgPSBtZW51SXRlbS5nZXRWYWx1ZSgpO1xuICAgIC8vIEhhbmRsZSBzcGVjaWFsIGNhc2VzLlxuICAgIGlmICh0aGlzLnNvdXJjZUJsb2NrXyAmJiAhdGhpcy5zb3VyY2VCbG9ja18uaXNEZWFkT3JEeWluZygpKSB7XG4gICAgICBpZiAoaWQgPT09IGludGVybmFsQ29uc3RhbnRzLlJFTkFNRV9WQVJJQUJMRV9JRCkge1xuICAgICAgICAvLyBSZW5hbWUgdmFyaWFibGUuXG4gICAgICAgIFZhcmlhYmxlcy5yZW5hbWVWYXJpYWJsZShcbiAgICAgICAgICAgIHRoaXMuc291cmNlQmxvY2tfLndvcmtzcGFjZSwgdGhpcy52YXJpYWJsZV8gYXMgVmFyaWFibGVNb2RlbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAoaWQgPT09IGludGVybmFsQ29uc3RhbnRzLkRFTEVURV9WQVJJQUJMRV9JRCkge1xuICAgICAgICAvLyBEZWxldGUgdmFyaWFibGUuXG4gICAgICAgIHRoaXMuc291cmNlQmxvY2tfLndvcmtzcGFjZS5kZWxldGVWYXJpYWJsZUJ5SWQodGhpcy52YXJpYWJsZV8hLmdldElkKCkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEhhbmRsZSB1bnNwZWNpYWwgY2FzZS5cbiAgICB0aGlzLnNldFZhbHVlKGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPdmVycmlkZXMgcmVmZXJlbmNlc1ZhcmlhYmxlcygpLCBpbmRpY2F0aW5nIHRoaXMgZmllbGQgcmVmZXJzIHRvIGFcbiAgICogdmFyaWFibGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgcmVmZXJlbmNlc1ZhcmlhYmxlcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3QgYSBGaWVsZFZhcmlhYmxlIGZyb20gYSBKU09OIGFyZyBvYmplY3QsXG4gICAqIGRlcmVmZXJlbmNpbmcgYW55IHN0cmluZyB0YWJsZSByZWZlcmVuY2VzLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBBIEpTT04gb2JqZWN0IHdpdGggb3B0aW9ucyAodmFyaWFibGUsIHZhcmlhYmxlVHlwZXMsIGFuZFxuICAgKiAgICAgZGVmYXVsdFR5cGUpLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBvdmVycmlkZSBmcm9tSnNvbihvcHRpb25zOiBGaWVsZFZhcmlhYmxlRnJvbUpzb25Db25maWcpOlxuICAgICAgRmllbGRWYXJpYWJsZSB7XG4gICAgY29uc3QgdmFyTmFtZSA9IHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKG9wdGlvbnMudmFyaWFibGUpO1xuICAgIC8vIGB0aGlzYCBtaWdodCBiZSBhIHN1YmNsYXNzIG9mIEZpZWxkVmFyaWFibGUgaWYgdGhhdCBjbGFzcyBkb2Vzbid0XG4gICAgLy8gb3ZlcnJpZGUgdGhlIHN0YXRpYyBmcm9tSnNvbiBtZXRob2QuXG4gICAgcmV0dXJuIG5ldyB0aGlzKHZhck5hbWUsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhIHNvcnRlZCBsaXN0IG9mIHZhcmlhYmxlIG5hbWVzIGZvciB2YXJpYWJsZSBkcm9wZG93biBtZW51cy5cbiAgICogSW5jbHVkZSBhIHNwZWNpYWwgb3B0aW9uIGF0IHRoZSBlbmQgZm9yIGNyZWF0aW5nIGEgbmV3IHZhcmlhYmxlIG5hbWUuXG4gICAqXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIHZhcmlhYmxlIG5hbWVzL2lkIHR1cGxlcy5cbiAgICovXG4gIHN0YXRpYyBkcm9wZG93bkNyZWF0ZSh0aGlzOiBGaWVsZFZhcmlhYmxlKTogTWVudU9wdGlvbltdIHtcbiAgICBpZiAoIXRoaXMudmFyaWFibGVfKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnVHJpZWQgdG8gY2FsbCBkcm9wZG93bkNyZWF0ZSBvbiBhIHZhcmlhYmxlIGZpZWxkIHdpdGggbm8nICtcbiAgICAgICAgICAnIHZhcmlhYmxlIHNlbGVjdGVkLicpO1xuICAgIH1cbiAgICBjb25zdCBuYW1lID0gdGhpcy5nZXRUZXh0KCk7XG4gICAgbGV0IHZhcmlhYmxlTW9kZWxMaXN0OiBWYXJpYWJsZU1vZGVsW10gPSBbXTtcbiAgICBpZiAodGhpcy5zb3VyY2VCbG9ja18gJiYgIXRoaXMuc291cmNlQmxvY2tfLmlzRGVhZE9yRHlpbmcoKSkge1xuICAgICAgY29uc3QgdmFyaWFibGVUeXBlcyA9IHRoaXMuZ2V0VmFyaWFibGVUeXBlc18oKTtcbiAgICAgIC8vIEdldCBhIGNvcHkgb2YgdGhlIGxpc3QsIHNvIHRoYXQgYWRkaW5nIHJlbmFtZSBhbmQgbmV3IHZhcmlhYmxlIG9wdGlvbnNcbiAgICAgIC8vIGRvZXNuJ3QgbW9kaWZ5IHRoZSB3b3Jrc3BhY2UncyBsaXN0LlxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YXJpYWJsZVR5cGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlVHlwZSA9IHZhcmlhYmxlVHlwZXNbaV07XG4gICAgICAgIGNvbnN0IHZhcmlhYmxlcyA9XG4gICAgICAgICAgICB0aGlzLnNvdXJjZUJsb2NrXy53b3Jrc3BhY2UuZ2V0VmFyaWFibGVzT2ZUeXBlKHZhcmlhYmxlVHlwZSk7XG4gICAgICAgIHZhcmlhYmxlTW9kZWxMaXN0ID0gdmFyaWFibGVNb2RlbExpc3QuY29uY2F0KHZhcmlhYmxlcyk7XG4gICAgICB9XG4gICAgfVxuICAgIHZhcmlhYmxlTW9kZWxMaXN0LnNvcnQoVmFyaWFibGVNb2RlbC5jb21wYXJlQnlOYW1lKTtcblxuICAgIGNvbnN0IG9wdGlvbnM6IFtzdHJpbmcsIHN0cmluZ11bXSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyaWFibGVNb2RlbExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIC8vIFNldCB0aGUgVVVJRCBhcyB0aGUgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIHZhcmlhYmxlLlxuICAgICAgb3B0aW9uc1tpXSA9IFt2YXJpYWJsZU1vZGVsTGlzdFtpXS5uYW1lLCB2YXJpYWJsZU1vZGVsTGlzdFtpXS5nZXRJZCgpXTtcbiAgICB9XG4gICAgb3B0aW9ucy5wdXNoKFxuICAgICAgICBbTXNnWydSRU5BTUVfVkFSSUFCTEUnXSwgaW50ZXJuYWxDb25zdGFudHMuUkVOQU1FX1ZBUklBQkxFX0lEXSk7XG4gICAgaWYgKE1zZ1snREVMRVRFX1ZBUklBQkxFJ10pIHtcbiAgICAgIG9wdGlvbnMucHVzaChbXG4gICAgICAgIE1zZ1snREVMRVRFX1ZBUklBQkxFJ10ucmVwbGFjZSgnJTEnLCBuYW1lKSxcbiAgICAgICAgaW50ZXJuYWxDb25zdGFudHMuREVMRVRFX1ZBUklBQkxFX0lELFxuICAgICAgXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wdGlvbnM7XG4gIH1cbn1cblxuZmllbGRSZWdpc3RyeS5yZWdpc3RlcignZmllbGRfdmFyaWFibGUnLCBGaWVsZFZhcmlhYmxlKTtcblxuLyoqXG4gKiBDb25maWcgb3B0aW9ucyBmb3IgdGhlIHZhcmlhYmxlIGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkVmFyaWFibGVDb25maWcgZXh0ZW5kcyBGaWVsZENvbmZpZyB7XG4gIHZhcmlhYmxlVHlwZXM/OiBzdHJpbmdbXTtcbiAgZGVmYXVsdFR5cGU/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogZnJvbUpzb24gY29uZmlnIG9wdGlvbnMgZm9yIHRoZSB2YXJpYWJsZSBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZFZhcmlhYmxlRnJvbUpzb25Db25maWcgZXh0ZW5kcyBGaWVsZFZhcmlhYmxlQ29uZmlnIHtcbiAgdmFyaWFibGU/OiBzdHJpbmc7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTnVtYmVyIGlucHV0IGZpZWxkXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRmllbGROdW1iZXInKTtcblxuaW1wb3J0IHtGaWVsZH0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgKiBhcyBmaWVsZFJlZ2lzdHJ5IGZyb20gJy4vZmllbGRfcmVnaXN0cnkuanMnO1xuaW1wb3J0IHtGaWVsZElucHV0LCBGaWVsZElucHV0Q29uZmlnLCBGaWVsZElucHV0VmFsaWRhdG9yfSBmcm9tICcuL2ZpZWxkX2lucHV0LmpzJztcbmltcG9ydCAqIGFzIGFyaWEgZnJvbSAnLi91dGlscy9hcmlhLmpzJztcbmltcG9ydCB0eXBlIHtTZW50aW5lbH0gZnJvbSAnLi91dGlscy9zZW50aW5lbC5qcyc7XG5cbmV4cG9ydCB0eXBlIEZpZWxkTnVtYmVyVmFsaWRhdG9yID0gRmllbGRJbnB1dFZhbGlkYXRvcjxudW1iZXI+O1xuXG4vKipcbiAqIENsYXNzIGZvciBhbiBlZGl0YWJsZSBudW1iZXIgZmllbGQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmllbGROdW1iZXJcbiAqL1xuZXhwb3J0IGNsYXNzIEZpZWxkTnVtYmVyIGV4dGVuZHMgRmllbGRJbnB1dDxudW1iZXI+IHtcbiAgLyoqIFRoZSBtaW5pbXVtIHZhbHVlIHRoaXMgbnVtYmVyIGZpZWxkIGNhbiBjb250YWluLiAqL1xuICBwcm90ZWN0ZWQgbWluXyA9IC1JbmZpbml0eTtcblxuICAvKiogVGhlIG1heGltdW0gdmFsdWUgdGhpcyBudW1iZXIgZmllbGQgY2FuIGNvbnRhaW4uICovXG4gIHByb3RlY3RlZCBtYXhfID0gSW5maW5pdHk7XG5cbiAgLyoqIFRoZSBtdWx0aXBsZSB0byB3aGljaCB0aGlzIGZpZWxkcyB2YWx1ZSBpcyByb3VuZGVkLiAqL1xuICBwcm90ZWN0ZWQgcHJlY2lzaW9uXyA9IDA7XG5cbiAgLyoqXG4gICAqIFRoZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMgdG8gYWxsb3csIG9yIG51bGwgdG8gYWxsb3cgYW55IG51bWJlciBvZlxuICAgKiBkZWNpbWFsIGRpZ2l0cy5cbiAgICovXG4gIHByaXZhdGUgZGVjaW1hbFBsYWNlc186IG51bWJlcnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogU2VyaWFsaXphYmxlIGZpZWxkcyBhcmUgc2F2ZWQgYnkgdGhlIHNlcmlhbGl6ZXIsIG5vbi1zZXJpYWxpemFibGUgZmllbGRzXG4gICAqIGFyZSBub3QuIEVkaXRhYmxlIGZpZWxkcyBzaG91bGQgYWxzbyBiZSBzZXJpYWxpemFibGUuXG4gICAqL1xuICBvdmVycmlkZSBTRVJJQUxJWkFCTEUgPSB0cnVlO1xuXG4gIC8qKiBEb24ndCBzcGVsbGNoZWNrIG51bWJlcnMuICBPdXIgdmFsaWRhdG9yIGRvZXMgYSBiZXR0ZXIgam9iLiAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgc3BlbGxjaGVja18gPSBmYWxzZTtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF92YWx1ZSBUaGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgZmllbGQuIFNob3VsZCBjYXN0IHRvIGEgbnVtYmVyLlxuICAgKiAgICAgRGVmYXVsdHMgdG8gMC4gQWxzbyBhY2NlcHRzIEZpZWxkLlNLSVBfU0VUVVAgaWYgeW91IHdpc2ggdG8gc2tpcCBzZXR1cFxuICAgKiAgICAgKG9ubHkgdXNlZCBieSBzdWJjbGFzc2VzIHRoYXQgd2FudCB0byBoYW5kbGUgY29uZmlndXJhdGlvbiBhbmQgc2V0dGluZ1xuICAgKiAgICAgdGhlIGZpZWxkIHZhbHVlIGFmdGVyIHRoZWlyIG93biBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4pLlxuICAgKiBAcGFyYW0gb3B0X21pbiBNaW5pbXVtIHZhbHVlLiBXaWxsIG9ubHkgYmUgdXNlZCBpZiBvcHRfY29uZmlnIGlzIG5vdFxuICAgKiAgICAgcHJvdmlkZWQuXG4gICAqIEBwYXJhbSBvcHRfbWF4IE1heGltdW0gdmFsdWUuIFdpbGwgb25seSBiZSB1c2VkIGlmIG9wdF9jb25maWcgaXMgbm90XG4gICAqICAgICBwcm92aWRlZC5cbiAgICogQHBhcmFtIG9wdF9wcmVjaXNpb24gUHJlY2lzaW9uIGZvciB2YWx1ZS4gV2lsbCBvbmx5IGJlIHVzZWQgaWYgb3B0X2NvbmZpZ1xuICAgKiAgICAgaXMgbm90IHByb3ZpZGVkLlxuICAgKiBAcGFyYW0gb3B0X3ZhbGlkYXRvciBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRvIHZhbGlkYXRlIGNoYW5nZXMgdG8gdGhlXG4gICAqICAgICBmaWVsZCdzIHZhbHVlLiBUYWtlcyBpbiBhIG51bWJlciAmIHJldHVybnMgYSB2YWxpZGF0ZWQgbnVtYmVyLCBvciBudWxsXG4gICAqICAgICB0byBhYm9ydCB0aGUgY2hhbmdlLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvbnVtYmVyI2NyZWF0aW9ufVxuICAgKiBmb3IgYSBsaXN0IG9mIHByb3BlcnRpZXMgdGhpcyBwYXJhbWV0ZXIgc3VwcG9ydHMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIG9wdF92YWx1ZT86IHN0cmluZ3xudW1iZXJ8U2VudGluZWwsIG9wdF9taW4/OiBzdHJpbmd8bnVtYmVyfG51bGwsXG4gICAgICBvcHRfbWF4Pzogc3RyaW5nfG51bWJlcnxudWxsLCBvcHRfcHJlY2lzaW9uPzogc3RyaW5nfG51bWJlcnxudWxsLFxuICAgICAgb3B0X3ZhbGlkYXRvcj86IEZpZWxkTnVtYmVyVmFsaWRhdG9yfG51bGwsXG4gICAgICBvcHRfY29uZmlnPzogRmllbGROdW1iZXJDb25maWcpIHtcbiAgICAvLyBQYXNzIFNFTlRJTkVMIHNvIHRoYXQgd2UgY2FuIGRlZmluZSBwcm9wZXJ0aWVzIGJlZm9yZSB2YWx1ZSB2YWxpZGF0aW9uLlxuICAgIHN1cGVyKEZpZWxkLlNLSVBfU0VUVVApO1xuXG4gICAgaWYgKG9wdF92YWx1ZSA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldENvbnN0cmFpbnRzKG9wdF9taW4sIG9wdF9tYXgsIG9wdF9wcmVjaXNpb24pO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKG9wdF92YWx1ZSk7XG4gICAgaWYgKG9wdF92YWxpZGF0b3IpIHtcbiAgICAgIHRoaXMuc2V0VmFsaWRhdG9yKG9wdF92YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIGZpZWxkIGJhc2VkIG9uIHRoZSBnaXZlbiBtYXAgb2Ygb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGNvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQgYmFzZWQgb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY29uZmlndXJlXyhjb25maWc6IEZpZWxkTnVtYmVyQ29uZmlnKSB7XG4gICAgc3VwZXIuY29uZmlndXJlXyhjb25maWcpO1xuICAgIHRoaXMuc2V0TWluSW50ZXJuYWxfKGNvbmZpZy5taW4pO1xuICAgIHRoaXMuc2V0TWF4SW50ZXJuYWxfKGNvbmZpZy5tYXgpO1xuICAgIHRoaXMuc2V0UHJlY2lzaW9uSW50ZXJuYWxfKGNvbmZpZy5wcmVjaXNpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbWF4aW11bSwgbWluaW11bSBhbmQgcHJlY2lzaW9uIGNvbnN0cmFpbnRzIG9uIHRoaXMgZmllbGQuXG4gICAqIEFueSBvZiB0aGVzZSBwcm9wZXJ0aWVzIG1heSBiZSB1bmRlZmluZWQgb3IgTmFOIHRvIGJlIGRpc2FibGVkLlxuICAgKiBTZXR0aW5nIHByZWNpc2lvbiAodXN1YWxseSBhIHBvd2VyIG9mIDEwKSBlbmZvcmNlcyBhIG1pbmltdW0gc3RlcCBiZXR3ZWVuXG4gICAqIHZhbHVlcy4gVGhhdCBpcywgdGhlIHVzZXIncyB2YWx1ZSB3aWxsIHJvdW5kZWQgdG8gdGhlIGNsb3Nlc3QgbXVsdGlwbGUgb2ZcbiAgICogcHJlY2lzaW9uLiBUaGUgbGVhc3Qgc2lnbmlmaWNhbnQgZGlnaXQgcGxhY2UgaXMgaW5mZXJyZWQgZnJvbSB0aGVcbiAgICogcHJlY2lzaW9uLiBJbnRlZ2VycyB2YWx1ZXMgY2FuIGJlIGVuZm9yY2VzIGJ5IGNob29zaW5nIGFuIGludGVnZXJcbiAgICogcHJlY2lzaW9uLlxuICAgKlxuICAgKiBAcGFyYW0gbWluIE1pbmltdW0gdmFsdWUuXG4gICAqIEBwYXJhbSBtYXggTWF4aW11bSB2YWx1ZS5cbiAgICogQHBhcmFtIHByZWNpc2lvbiBQcmVjaXNpb24gZm9yIHZhbHVlLlxuICAgKi9cbiAgc2V0Q29uc3RyYWludHMoXG4gICAgICBtaW46IG51bWJlcnxzdHJpbmd8dW5kZWZpbmVkfG51bGwsIG1heDogbnVtYmVyfHN0cmluZ3x1bmRlZmluZWR8bnVsbCxcbiAgICAgIHByZWNpc2lvbjogbnVtYmVyfHN0cmluZ3x1bmRlZmluZWR8bnVsbCkge1xuICAgIHRoaXMuc2V0TWluSW50ZXJuYWxfKG1pbik7XG4gICAgdGhpcy5zZXRNYXhJbnRlcm5hbF8obWF4KTtcbiAgICB0aGlzLnNldFByZWNpc2lvbkludGVybmFsXyhwcmVjaXNpb24pO1xuICAgIHRoaXMuc2V0VmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBtaW5pbXVtIHZhbHVlIHRoaXMgZmllbGQgY2FuIGNvbnRhaW4uIFVwZGF0ZXMgdGhlIHZhbHVlIHRvXG4gICAqIHJlZmxlY3QuXG4gICAqXG4gICAqIEBwYXJhbSBtaW4gTWluaW11bSB2YWx1ZS5cbiAgICovXG4gIHNldE1pbihtaW46IG51bWJlcnxzdHJpbmd8dW5kZWZpbmVkfG51bGwpIHtcbiAgICB0aGlzLnNldE1pbkludGVybmFsXyhtaW4pO1xuICAgIHRoaXMuc2V0VmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBtaW5pbXVtIHZhbHVlIHRoaXMgZmllbGQgY2FuIGNvbnRhaW4uIENhbGxlZCBpbnRlcm5hbGx5IHRvIGF2b2lkXG4gICAqIHZhbHVlIHVwZGF0ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBtaW4gTWluaW11bSB2YWx1ZS5cbiAgICovXG4gIHByaXZhdGUgc2V0TWluSW50ZXJuYWxfKG1pbjogbnVtYmVyfHN0cmluZ3x1bmRlZmluZWR8bnVsbCkge1xuICAgIGlmIChtaW4gPT0gbnVsbCkge1xuICAgICAgdGhpcy5taW5fID0gLUluZmluaXR5O1xuICAgIH0gZWxzZSB7XG4gICAgICBtaW4gPSBOdW1iZXIobWluKTtcbiAgICAgIGlmICghaXNOYU4obWluKSkge1xuICAgICAgICB0aGlzLm1pbl8gPSBtaW47XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgbWluaW11bSB2YWx1ZSB0aGlzIGZpZWxkIGNhbiBjb250YWluLiBEZWZhdWx0IGlzXG4gICAqIC1JbmZpbml0eS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGN1cnJlbnQgbWluaW11bSB2YWx1ZSB0aGlzIGZpZWxkIGNhbiBjb250YWluLlxuICAgKi9cbiAgZ2V0TWluKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubWluXztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBtYXhpbXVtIHZhbHVlIHRoaXMgZmllbGQgY2FuIGNvbnRhaW4uIFVwZGF0ZXMgdGhlIHZhbHVlIHRvXG4gICAqIHJlZmxlY3QuXG4gICAqXG4gICAqIEBwYXJhbSBtYXggTWF4aW11bSB2YWx1ZS5cbiAgICovXG4gIHNldE1heChtYXg6IG51bWJlcnxzdHJpbmd8dW5kZWZpbmVkfG51bGwpIHtcbiAgICB0aGlzLnNldE1heEludGVybmFsXyhtYXgpO1xuICAgIHRoaXMuc2V0VmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBtYXhpbXVtIHZhbHVlIHRoaXMgZmllbGQgY2FuIGNvbnRhaW4uIENhbGxlZCBpbnRlcm5hbGx5IHRvIGF2b2lkXG4gICAqIHZhbHVlIHVwZGF0ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBtYXggTWF4aW11bSB2YWx1ZS5cbiAgICovXG4gIHByaXZhdGUgc2V0TWF4SW50ZXJuYWxfKG1heDogbnVtYmVyfHN0cmluZ3x1bmRlZmluZWR8bnVsbCkge1xuICAgIGlmIChtYXggPT0gbnVsbCkge1xuICAgICAgdGhpcy5tYXhfID0gSW5maW5pdHk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1heCA9IE51bWJlcihtYXgpO1xuICAgICAgaWYgKCFpc05hTihtYXgpKSB7XG4gICAgICAgIHRoaXMubWF4XyA9IG1heDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCBtYXhpbXVtIHZhbHVlIHRoaXMgZmllbGQgY2FuIGNvbnRhaW4uIERlZmF1bHQgaXNcbiAgICogSW5maW5pdHkuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBjdXJyZW50IG1heGltdW0gdmFsdWUgdGhpcyBmaWVsZCBjYW4gY29udGFpbi5cbiAgICovXG4gIGdldE1heCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLm1heF87XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgcHJlY2lzaW9uIG9mIHRoaXMgZmllbGQncyB2YWx1ZSwgaS5lLiB0aGUgbnVtYmVyIHRvIHdoaWNoIHRoZVxuICAgKiB2YWx1ZSBpcyByb3VuZGVkLiBVcGRhdGVzIHRoZSBmaWVsZCB0byByZWZsZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gcHJlY2lzaW9uIFRoZSBudW1iZXIgdG8gd2hpY2ggdGhlIGZpZWxkJ3MgdmFsdWUgaXMgcm91bmRlZC5cbiAgICovXG4gIHNldFByZWNpc2lvbihwcmVjaXNpb246IG51bWJlcnxzdHJpbmd8dW5kZWZpbmVkfG51bGwpIHtcbiAgICB0aGlzLnNldFByZWNpc2lvbkludGVybmFsXyhwcmVjaXNpb24pO1xuICAgIHRoaXMuc2V0VmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwcmVjaXNpb24gb2YgdGhpcyBmaWVsZCdzIHZhbHVlLiBDYWxsZWQgaW50ZXJuYWxseSB0byBhdm9pZFxuICAgKiB2YWx1ZSB1cGRhdGVzLlxuICAgKlxuICAgKiBAcGFyYW0gcHJlY2lzaW9uIFRoZSBudW1iZXIgdG8gd2hpY2ggdGhlIGZpZWxkJ3MgdmFsdWUgaXMgcm91bmRlZC5cbiAgICovXG4gIHByaXZhdGUgc2V0UHJlY2lzaW9uSW50ZXJuYWxfKHByZWNpc2lvbjogbnVtYmVyfHN0cmluZ3x1bmRlZmluZWR8bnVsbCkge1xuICAgIHRoaXMucHJlY2lzaW9uXyA9IE51bWJlcihwcmVjaXNpb24pIHx8IDA7XG4gICAgbGV0IHByZWNpc2lvblN0cmluZyA9IFN0cmluZyh0aGlzLnByZWNpc2lvbl8pO1xuICAgIGlmIChwcmVjaXNpb25TdHJpbmcuaW5kZXhPZignZScpICE9PSAtMSkge1xuICAgICAgLy8gU3RyaW5nKCkgaXMgZmFzdC4gIEJ1dCBpdCB0dXJucyAuMDAwMDAwMSBpbnRvICcxZS03Jy5cbiAgICAgIC8vIFVzZSB0aGUgbXVjaCBzbG93ZXIgdG9Mb2NhbGVTdHJpbmcgdG8gYWNjZXNzIGFsbCB0aGUgZGlnaXRzLlxuICAgICAgcHJlY2lzaW9uU3RyaW5nID1cbiAgICAgICAgICB0aGlzLnByZWNpc2lvbl8udG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJywge21heGltdW1GcmFjdGlvbkRpZ2l0czogMjB9KTtcbiAgICB9XG4gICAgY29uc3QgZGVjaW1hbEluZGV4ID0gcHJlY2lzaW9uU3RyaW5nLmluZGV4T2YoJy4nKTtcbiAgICBpZiAoZGVjaW1hbEluZGV4ID09PSAtMSkge1xuICAgICAgLy8gSWYgdGhlIHByZWNpc2lvbiBpcyAwIChmbG9hdCkgYWxsb3cgYW55IG51bWJlciBvZiBkZWNpbWFscyxcbiAgICAgIC8vIG90aGVyd2lzZSBhbGxvdyBub25lLlxuICAgICAgdGhpcy5kZWNpbWFsUGxhY2VzXyA9IHByZWNpc2lvbiA/IDAgOiBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRlY2ltYWxQbGFjZXNfID0gcHJlY2lzaW9uU3RyaW5nLmxlbmd0aCAtIGRlY2ltYWxJbmRleCAtIDE7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgcHJlY2lzaW9uIG9mIHRoaXMgZmllbGQuIFRoZSBwcmVjaXNpb24gYmVpbmcgdGhlXG4gICAqIG51bWJlciB0byB3aGljaCB0aGUgZmllbGQncyB2YWx1ZSBpcyByb3VuZGVkLiBBIHByZWNpc2lvbiBvZiAwIG1lYW5zIHRoYXRcbiAgICogdGhlIHZhbHVlIGlzIG5vdCByb3VuZGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgbnVtYmVyIHRvIHdoaWNoIHRoaXMgZmllbGQncyB2YWx1ZSBpcyByb3VuZGVkLlxuICAgKi9cbiAgZ2V0UHJlY2lzaW9uKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucHJlY2lzaW9uXztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmUgdGhhdCB0aGUgaW5wdXQgdmFsdWUgaXMgYSB2YWxpZCBudW1iZXIgKG11c3QgZnVsZmlsbCB0aGVcbiAgICogY29uc3RyYWludHMgcGxhY2VkIG9uIHRoZSBmaWVsZCkuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfbmV3VmFsdWUgVGhlIGlucHV0IHZhbHVlLlxuICAgKiBAcmV0dXJucyBBIHZhbGlkIG51bWJlciwgb3IgbnVsbCBpZiBpbnZhbGlkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvQ2xhc3NWYWxpZGF0aW9uXyhvcHRfbmV3VmFsdWU/OiBBbnlEdXJpbmdNaWdyYXRpb24pOlxuICAgICAgbnVtYmVyfG51bGwge1xuICAgIGlmIChvcHRfbmV3VmFsdWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBDbGVhbiB1cCB0ZXh0LlxuICAgIGxldCBuZXdWYWx1ZSA9IFN0cmluZyhvcHRfbmV3VmFsdWUpO1xuICAgIC8vIFRPRE86IEhhbmRsZSBjYXNlcyBsaWtlICd0ZW4nLCAnMS4yMDMsMTQnLCBldGMuXG4gICAgLy8gJ08nIGlzIHNvbWV0aW1lcyBtaXN0YWtlbiBmb3IgJzAnIGJ5IGluZXhwZXJpZW5jZWQgdXNlcnMuXG4gICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKC9PL2lnLCAnMCcpO1xuICAgIC8vIFN0cmlwIG91dCB0aG91c2FuZHMgc2VwYXJhdG9ycy5cbiAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlLnJlcGxhY2UoLywvZywgJycpO1xuICAgIC8vIElnbm9yZSBjYXNlIG9mICdJbmZpbml0eScuXG4gICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKC9pbmZpbml0eS9pLCAnSW5maW5pdHknKTtcblxuICAgIC8vIENsZWFuIHVwIG51bWJlci5cbiAgICBsZXQgbiA9IE51bWJlcihuZXdWYWx1ZSB8fCAwKTtcbiAgICBpZiAoaXNOYU4obikpIHtcbiAgICAgIC8vIEludmFsaWQgbnVtYmVyLlxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIEdldCB0aGUgdmFsdWUgaW4gcmFuZ2UuXG4gICAgbiA9IE1hdGgubWluKE1hdGgubWF4KG4sIHRoaXMubWluXyksIHRoaXMubWF4Xyk7XG4gICAgLy8gUm91bmQgdG8gbmVhcmVzdCBtdWx0aXBsZSBvZiBwcmVjaXNpb24uXG4gICAgaWYgKHRoaXMucHJlY2lzaW9uXyAmJiBpc0Zpbml0ZShuKSkge1xuICAgICAgbiA9IE1hdGgucm91bmQobiAvIHRoaXMucHJlY2lzaW9uXykgKiB0aGlzLnByZWNpc2lvbl87XG4gICAgfVxuICAgIC8vIENsZWFuIHVwIGZsb2F0aW5nIHBvaW50IGVycm9ycy5cbiAgICBpZiAodGhpcy5kZWNpbWFsUGxhY2VzXyAhPT0gbnVsbCkge1xuICAgICAgbiA9IE51bWJlcihuLnRvRml4ZWQodGhpcy5kZWNpbWFsUGxhY2VzXykpO1xuICAgIH1cbiAgICByZXR1cm4gbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgdGhlIG51bWJlciBpbnB1dCBlZGl0b3Igd2lkZ2V0LlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgbmV3bHkgY3JlYXRlZCBudW1iZXIgaW5wdXQgZWRpdG9yLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHdpZGdldENyZWF0ZV8oKTogSFRNTEVsZW1lbnQge1xuICAgIGNvbnN0IGh0bWxJbnB1dCA9IHN1cGVyLndpZGdldENyZWF0ZV8oKTtcblxuICAgIC8vIFNldCB0aGUgYWNjZXNzaWJpbGl0eSBzdGF0ZVxuICAgIGlmICh0aGlzLm1pbl8gPiAtSW5maW5pdHkpIHtcbiAgICAgIGFyaWEuc2V0U3RhdGUoaHRtbElucHV0LCBhcmlhLlN0YXRlLlZBTFVFTUlOLCB0aGlzLm1pbl8pO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhfIDwgSW5maW5pdHkpIHtcbiAgICAgIGFyaWEuc2V0U3RhdGUoaHRtbElucHV0LCBhcmlhLlN0YXRlLlZBTFVFTUFYLCB0aGlzLm1heF8pO1xuICAgIH1cbiAgICByZXR1cm4gaHRtbElucHV0O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdCBhIEZpZWxkTnVtYmVyIGZyb20gYSBKU09OIGFyZyBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIEEgSlNPTiBvYmplY3Qgd2l0aCBvcHRpb25zICh2YWx1ZSwgbWluLCBtYXgsIGFuZCBwcmVjaXNpb24pLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihvcHRpb25zOiBGaWVsZE51bWJlckZyb21Kc29uQ29uZmlnKTogRmllbGROdW1iZXIge1xuICAgIC8vIGB0aGlzYCBtaWdodCBiZSBhIHN1YmNsYXNzIG9mIEZpZWxkTnVtYmVyIGlmIHRoYXQgY2xhc3MgZG9lc24ndCBvdmVycmlkZVxuICAgIC8vIHRoZSBzdGF0aWMgZnJvbUpzb24gbWV0aG9kLlxuICAgIHJldHVybiBuZXcgdGhpcyhcbiAgICAgICAgb3B0aW9ucy52YWx1ZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgfVxufVxuXG5maWVsZFJlZ2lzdHJ5LnJlZ2lzdGVyKCdmaWVsZF9udW1iZXInLCBGaWVsZE51bWJlcik7XG5cbkZpZWxkTnVtYmVyLnByb3RvdHlwZS5ERUZBVUxUX1ZBTFVFID0gMDtcblxuLyoqXG4gKiBDb25maWcgb3B0aW9ucyBmb3IgdGhlIG51bWJlciBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZE51bWJlckNvbmZpZyBleHRlbmRzIEZpZWxkSW5wdXRDb25maWcge1xuICBtaW4/OiBudW1iZXI7XG4gIG1heD86IG51bWJlcjtcbiAgcHJlY2lzaW9uPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIGZyb21Kc29uIGNvbmZpZyBvcHRpb25zIGZvciB0aGUgbnVtYmVyIGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkTnVtYmVyRnJvbUpzb25Db25maWcgZXh0ZW5kcyBGaWVsZE51bWJlckNvbmZpZyB7XG4gIHZhbHVlPzogbnVtYmVyO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRleHQgQXJlYSBmaWVsZC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GaWVsZE11bHRpbGluZUlucHV0Jyk7XG5cbmltcG9ydCAqIGFzIENzcyBmcm9tICcuL2Nzcy5qcyc7XG5pbXBvcnQge0ZpZWxkLCBVbmF0dGFjaGVkRmllbGRFcnJvcn0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgKiBhcyBmaWVsZFJlZ2lzdHJ5IGZyb20gJy4vZmllbGRfcmVnaXN0cnkuanMnO1xuaW1wb3J0IHtGaWVsZFRleHRJbnB1dCwgRmllbGRUZXh0SW5wdXRDb25maWcsIEZpZWxkVGV4dElucHV0VmFsaWRhdG9yfSBmcm9tICcuL2ZpZWxkX3RleHRpbnB1dC5qcyc7XG5pbXBvcnQgKiBhcyBhcmlhIGZyb20gJy4vdXRpbHMvYXJpYS5qcyc7XG5pbXBvcnQgKiBhcyBkb20gZnJvbSAnLi91dGlscy9kb20uanMnO1xuaW1wb3J0IHtLZXlDb2Rlc30gZnJvbSAnLi91dGlscy9rZXljb2Rlcy5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4vdXRpbHMvcGFyc2luZy5qcyc7XG5pbXBvcnQgdHlwZSB7U2VudGluZWx9IGZyb20gJy4vdXRpbHMvc2VudGluZWwuanMnO1xuaW1wb3J0IHtTdmd9IGZyb20gJy4vdXRpbHMvc3ZnLmpzJztcbmltcG9ydCAqIGFzIHVzZXJBZ2VudCBmcm9tICcuL3V0aWxzL3VzZXJhZ2VudC5qcyc7XG5pbXBvcnQgKiBhcyBXaWRnZXREaXYgZnJvbSAnLi93aWRnZXRkaXYuanMnO1xuXG5leHBvcnQgdHlwZSBGaWVsZE11bHRpbGluZUlucHV0VmFsaWRhdG9yID0gRmllbGRUZXh0SW5wdXRWYWxpZGF0b3I7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGFuIGVkaXRhYmxlIHRleHQgYXJlYSBmaWVsZC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5GaWVsZE11bHRpbGluZUlucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBGaWVsZE11bHRpbGluZUlucHV0IGV4dGVuZHMgRmllbGRUZXh0SW5wdXQge1xuICAvKipcbiAgICogVGhlIFNWRyBncm91cCBlbGVtZW50IHRoYXQgd2lsbCBjb250YWluIGEgdGV4dCBlbGVtZW50IGZvciBlYWNoIHRleHQgcm93XG4gICAqICAgICB3aGVuIGluaXRpYWxpemVkLlxuICAgKi9cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gIC8vICdTVkdHRWxlbWVudCcuXG4gIHRleHRHcm91cF86IFNWR0dFbGVtZW50ID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqXG4gICAqIERlZmluZXMgdGhlIG1heGltdW0gbnVtYmVyIG9mIGxpbmVzIG9mIGZpZWxkLlxuICAgKiBJZiBleGNlZWRlZCwgc2Nyb2xsaW5nIGZ1bmN0aW9uYWxpdHkgaXMgZW5hYmxlZC5cbiAgICovXG4gIHByb3RlY3RlZCBtYXhMaW5lc18gPSBJbmZpbml0eTtcblxuICAvKiogV2hldGhlciBZIG92ZXJmbG93IGlzIGN1cnJlbnRseSBvY2N1cnJpbmcuICovXG4gIHByb3RlY3RlZCBpc092ZXJmbG93ZWRZXyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X3ZhbHVlIFRoZSBpbml0aWFsIGNvbnRlbnQgb2YgdGhlIGZpZWxkLiBTaG91bGQgY2FzdCB0byBhIHN0cmluZy5cbiAgICogICAgIERlZmF1bHRzIHRvIGFuIGVtcHR5IHN0cmluZyBpZiBudWxsIG9yIHVuZGVmaW5lZC4gQWxzbyBhY2NlcHRzXG4gICAqICAgICBGaWVsZC5TS0lQX1NFVFVQIGlmIHlvdSB3aXNoIHRvIHNraXAgc2V0dXAgKG9ubHkgdXNlZCBieSBzdWJjbGFzc2VzXG4gICAqICAgICB0aGF0IHdhbnQgdG8gaGFuZGxlIGNvbmZpZ3VyYXRpb24gYW5kIHNldHRpbmcgdGhlIGZpZWxkIHZhbHVlIGFmdGVyXG4gICAqICAgICB0aGVpciBvd24gY29uc3RydWN0b3JzIGhhdmUgcnVuKS5cbiAgICogQHBhcmFtIG9wdF92YWxpZGF0b3IgQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdG8gdmFsaWRhdGUgYW55XG4gICAqICAgICBjb25zdHJhaW50cyBvbiB3aGF0IHRoZSB1c2VyIGVudGVyZWQuICBUYWtlcyB0aGUgbmV3IHRleHQgYXMgYW5cbiAgICogICAgIGFyZ3VtZW50IGFuZCByZXR1cm5zIGVpdGhlciB0aGUgYWNjZXB0ZWQgdGV4dCwgYSByZXBsYWNlbWVudCB0ZXh0LCBvclxuICAgKiAgICAgbnVsbCB0byBhYm9ydCB0aGUgY2hhbmdlLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvbXVsdGlsaW5lLXRleHQtaW5wdXQjY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X3ZhbHVlPzogc3RyaW5nfFNlbnRpbmVsLCBvcHRfdmFsaWRhdG9yPzogRmllbGRNdWx0aWxpbmVJbnB1dFZhbGlkYXRvcixcbiAgICAgIG9wdF9jb25maWc/OiBGaWVsZE11bHRpbGluZUlucHV0Q29uZmlnKSB7XG4gICAgc3VwZXIoRmllbGQuU0tJUF9TRVRVUCk7XG5cbiAgICBpZiAob3B0X3ZhbHVlID09PSBGaWVsZC5TS0lQX1NFVFVQKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChvcHRfY29uZmlnKSB7XG4gICAgICB0aGlzLmNvbmZpZ3VyZV8ob3B0X2NvbmZpZyk7XG4gICAgfVxuICAgIHRoaXMuc2V0VmFsdWUob3B0X3ZhbHVlKTtcbiAgICBpZiAob3B0X3ZhbGlkYXRvcikge1xuICAgICAgdGhpcy5zZXRWYWxpZGF0b3Iob3B0X3ZhbGlkYXRvcik7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGNvbmZpZ3VyZV8oY29uZmlnOiBGaWVsZE11bHRpbGluZUlucHV0Q29uZmlnKSB7XG4gICAgc3VwZXIuY29uZmlndXJlXyhjb25maWcpO1xuICAgIGlmIChjb25maWcubWF4TGluZXMpIHRoaXMuc2V0TWF4TGluZXMoY29uZmlnLm1heExpbmVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXJpYWxpemVzIHRoaXMgZmllbGQncyB2YWx1ZSB0byBYTUwuIFNob3VsZCBvbmx5IGJlIGNhbGxlZCBieSBCbG9ja2x5LlhtbC5cbiAgICpcbiAgICogQHBhcmFtIGZpZWxkRWxlbWVudCBUaGUgZWxlbWVudCB0byBwb3B1bGF0ZSB3aXRoIGluZm8gYWJvdXQgdGhlIGZpZWxkJ3NcbiAgICogICAgIHN0YXRlLlxuICAgKiBAcmV0dXJucyBUaGUgZWxlbWVudCBjb250YWluaW5nIGluZm8gYWJvdXQgdGhlIGZpZWxkJ3Mgc3RhdGUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgdG9YbWwoZmllbGRFbGVtZW50OiBFbGVtZW50KTogRWxlbWVudCB7XG4gICAgLy8gUmVwbGFjZSAnXFxuJyBjaGFyYWN0ZXJzIHdpdGggSFRNTC1lc2NhcGVkIGVxdWl2YWxlbnQgJyYjMTAnLiBUaGlzIGlzXG4gICAgLy8gbmVlZGVkIHNvIHRoZSBwbGFpbi10ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBYTUwgcHJvZHVjZWQgYnlcbiAgICAvLyBgQmxvY2tseS5YbWwuZG9tVG9UZXh0YCB3aWxsIGFwcGVhciBvbiBhIHNpbmdsZSBsaW5lICh0aGlzIGlzIGFcbiAgICAvLyBsaW1pdGF0aW9uIG9mIHRoZSBwbGFpbi10ZXh0IGZvcm1hdCkuXG4gICAgZmllbGRFbGVtZW50LnRleHRDb250ZW50ID1cbiAgICAgICAgKHRoaXMuZ2V0VmFsdWUoKSBhcyBzdHJpbmcpLnJlcGxhY2UoL1xcbi9nLCAnJiMxMDsnKTtcbiAgICByZXR1cm4gZmllbGRFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZpZWxkJ3MgdmFsdWUgYmFzZWQgb24gdGhlIGdpdmVuIFhNTCBlbGVtZW50LiBTaG91bGQgb25seSBiZVxuICAgKiBjYWxsZWQgYnkgQmxvY2tseS5YbWwuXG4gICAqXG4gICAqIEBwYXJhbSBmaWVsZEVsZW1lbnQgVGhlIGVsZW1lbnQgY29udGFpbmluZyBpbmZvIGFib3V0IHRoZSBmaWVsZCdzIHN0YXRlLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGZyb21YbWwoZmllbGRFbGVtZW50OiBFbGVtZW50KSB7XG4gICAgdGhpcy5zZXRWYWx1ZShmaWVsZEVsZW1lbnQudGV4dENvbnRlbnQhLnJlcGxhY2UoLyYjMTA7L2csICdcXG4nKSk7XG4gIH1cblxuICAvKipcbiAgICogU2F2ZXMgdGhpcyBmaWVsZCdzIHZhbHVlLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgc3RhdGUgb2YgdGhpcyBmaWVsZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBzYXZlU3RhdGUoKTogQW55RHVyaW5nTWlncmF0aW9uIHtcbiAgICBjb25zdCBsZWdhY3lTdGF0ZSA9IHRoaXMuc2F2ZUxlZ2FjeVN0YXRlKEZpZWxkTXVsdGlsaW5lSW5wdXQpO1xuICAgIGlmIChsZWdhY3lTdGF0ZSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGxlZ2FjeVN0YXRlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZpZWxkJ3MgdmFsdWUgYmFzZWQgb24gdGhlIGdpdmVuIHN0YXRlLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdGUgVGhlIHN0YXRlIG9mIHRoZSB2YXJpYWJsZSB0byBhc3NpZ24gdG8gdGhpcyB2YXJpYWJsZSBmaWVsZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBvdmVycmlkZSBsb2FkU3RhdGUoc3RhdGU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgIGlmICh0aGlzLmxvYWRMZWdhY3lTdGF0ZShGaWVsZCwgc3RhdGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2V0VmFsdWUoc3RhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmxvY2sgVUkgZm9yIHRoaXMgZmllbGQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgaW5pdFZpZXcoKSB7XG4gICAgdGhpcy5jcmVhdGVCb3JkZXJSZWN0XygpO1xuICAgIHRoaXMudGV4dEdyb3VwXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuRywge1xuICAgICAgICAgICdjbGFzcyc6ICdibG9ja2x5RWRpdGFibGVUZXh0JyxcbiAgICAgICAgfSxcbiAgICAgICAgdGhpcy5maWVsZEdyb3VwXyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB0ZXh0IGZyb20gdGhpcyBmaWVsZCBhcyBkaXNwbGF5ZWQgb24gc2NyZWVuLiAgTWF5IGRpZmZlciBmcm9tXG4gICAqIGdldFRleHQgZHVlIHRvIGVsbGlwc2lzLCBhbmQgb3RoZXIgZm9ybWF0dGluZy5cbiAgICpcbiAgICogQHJldHVybnMgQ3VycmVudGx5IGRpc3BsYXllZCB0ZXh0LlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGdldERpc3BsYXlUZXh0XygpOiBzdHJpbmcge1xuICAgIGNvbnN0IGJsb2NrID0gdGhpcy5nZXRTb3VyY2VCbG9jaygpO1xuICAgIGlmICghYmxvY2spIHtcbiAgICAgIHRocm93IG5ldyBVbmF0dGFjaGVkRmllbGRFcnJvcigpO1xuICAgIH1cbiAgICBsZXQgdGV4dExpbmVzID0gdGhpcy5nZXRUZXh0KCk7XG4gICAgaWYgKCF0ZXh0TGluZXMpIHtcbiAgICAgIC8vIFByZXZlbnQgdGhlIGZpZWxkIGZyb20gZGlzYXBwZWFyaW5nIGlmIGVtcHR5LlxuICAgICAgcmV0dXJuIEZpZWxkLk5CU1A7XG4gICAgfVxuICAgIGNvbnN0IGxpbmVzID0gdGV4dExpbmVzLnNwbGl0KCdcXG4nKTtcbiAgICB0ZXh0TGluZXMgPSAnJztcbiAgICBjb25zdCBkaXNwbGF5TGluZXNOdW1iZXIgPVxuICAgICAgICB0aGlzLmlzT3ZlcmZsb3dlZFlfID8gdGhpcy5tYXhMaW5lc18gOiBsaW5lcy5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNwbGF5TGluZXNOdW1iZXI7IGkrKykge1xuICAgICAgbGV0IHRleHQgPSBsaW5lc1tpXTtcbiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IHRoaXMubWF4RGlzcGxheUxlbmd0aCkge1xuICAgICAgICAvLyBUcnVuY2F0ZSBkaXNwbGF5ZWQgc3RyaW5nIGFuZCBhZGQgYW4gZWxsaXBzaXMgKCcuLi4nKS5cbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIHRoaXMubWF4RGlzcGxheUxlbmd0aCAtIDQpICsgJy4uLic7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNPdmVyZmxvd2VkWV8gJiYgaSA9PT0gZGlzcGxheUxpbmVzTnVtYmVyIC0gMSkge1xuICAgICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoMCwgdGV4dC5sZW5ndGggLSAzKSArICcuLi4nO1xuICAgICAgfVxuICAgICAgLy8gUmVwbGFjZSB3aGl0ZXNwYWNlIHdpdGggbm9uLWJyZWFraW5nIHNwYWNlcyBzbyB0aGUgdGV4dCBkb2Vzbid0XG4gICAgICAvLyBjb2xsYXBzZS5cbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xccy9nLCBGaWVsZC5OQlNQKTtcblxuICAgICAgdGV4dExpbmVzICs9IHRleHQ7XG4gICAgICBpZiAoaSAhPT0gZGlzcGxheUxpbmVzTnVtYmVyIC0gMSkge1xuICAgICAgICB0ZXh0TGluZXMgKz0gJ1xcbic7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChibG9jay5SVEwpIHtcbiAgICAgIC8vIFRoZSBTVkcgaXMgTFRSLCBmb3JjZSB2YWx1ZSB0byBiZSBSVEwuXG4gICAgICB0ZXh0TGluZXMgKz0gJ1xcdTIwMEYnO1xuICAgIH1cbiAgICByZXR1cm4gdGV4dExpbmVzO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCBieSBzZXRWYWx1ZSBpZiB0aGUgdGV4dCBpbnB1dCBpcyB2YWxpZC4gVXBkYXRlcyB0aGUgdmFsdWUgb2YgdGhlXG4gICAqIGZpZWxkLCBhbmQgdXBkYXRlcyB0aGUgdGV4dCBvZiB0aGUgZmllbGQgaWYgaXQgaXMgbm90IGN1cnJlbnRseSBiZWluZ1xuICAgKiBlZGl0ZWQgKGkuZS4gaGFuZGxlZCBieSB0aGUgaHRtbElucHV0XykuIElzIGJlaW5nIHJlZGVmaW5lZCBoZXJlIHRvIHVwZGF0ZVxuICAgKiBvdmVyZmxvdyBzdGF0ZSBvZiB0aGUgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBuZXdWYWx1ZSBUaGUgdmFsdWUgdG8gYmUgc2F2ZWQuIFRoZSBkZWZhdWx0IHZhbGlkYXRvciBndWFyYW50ZWVzXG4gICAqICAgICB0aGF0IHRoaXMgaXMgYSBzdHJpbmcuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZG9WYWx1ZVVwZGF0ZV8obmV3VmFsdWU6IEFueUR1cmluZ01pZ3JhdGlvbikge1xuICAgIHN1cGVyLmRvVmFsdWVVcGRhdGVfKG5ld1ZhbHVlKTtcbiAgICB0aGlzLmlzT3ZlcmZsb3dlZFlfID0gdGhpcy52YWx1ZV8uc3BsaXQoJ1xcbicpLmxlbmd0aCA+IHRoaXMubWF4TGluZXNfO1xuICB9XG5cbiAgLyoqIFVwZGF0ZXMgdGhlIHRleHQgb2YgdGhlIHRleHRFbGVtZW50LiAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgcmVuZGVyXygpIHtcbiAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0U291cmNlQmxvY2soKTtcbiAgICBpZiAoIWJsb2NrKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdHRhY2hlZEZpZWxkRXJyb3IoKTtcbiAgICB9XG4gICAgLy8gUmVtb3ZlIGFsbCB0ZXh0IGdyb3VwIGNoaWxkcmVuLlxuICAgIGxldCBjdXJyZW50Q2hpbGQ7XG4gICAgd2hpbGUgKGN1cnJlbnRDaGlsZCA9IHRoaXMudGV4dEdyb3VwXy5maXJzdENoaWxkKSB7XG4gICAgICB0aGlzLnRleHRHcm91cF8ucmVtb3ZlQ2hpbGQoY3VycmVudENoaWxkKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgaW4gdGV4dCBlbGVtZW50cyBpbnRvIHRoZSBncm91cC5cbiAgICBjb25zdCBsaW5lcyA9IHRoaXMuZ2V0RGlzcGxheVRleHRfKCkuc3BsaXQoJ1xcbicpO1xuICAgIGxldCB5ID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBsaW5lSGVpZ2h0ID0gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9IRUlHSFQgK1xuICAgICAgICAgIHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0JPUkRFUl9SRUNUX1lfUEFERElORztcbiAgICAgIGNvbnN0IHNwYW4gPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuVEVYVCwge1xuICAgICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlUZXh0IGJsb2NrbHlNdWx0aWxpbmVUZXh0JyxcbiAgICAgICAgICAgICd4JzogdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWF9QQURESU5HLFxuICAgICAgICAgICAgJ3knOiB5ICsgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWV9QQURESU5HLFxuICAgICAgICAgICAgJ2R5JzogdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfVEVYVF9CQVNFTElORSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRoaXMudGV4dEdyb3VwXyk7XG4gICAgICBzcGFuLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmVzW2ldKSk7XG4gICAgICB5ICs9IGxpbmVIZWlnaHQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNCZWluZ0VkaXRlZF8pIHtcbiAgICAgIGNvbnN0IGh0bWxJbnB1dCA9IHRoaXMuaHRtbElucHV0XyBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGlmICh0aGlzLmlzT3ZlcmZsb3dlZFlfKSB7XG4gICAgICAgIGRvbS5hZGRDbGFzcyhodG1sSW5wdXQsICdibG9ja2x5SHRtbFRleHRBcmVhSW5wdXRPdmVyZmxvd2VkWScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9tLnJlbW92ZUNsYXNzKGh0bWxJbnB1dCwgJ2Jsb2NrbHlIdG1sVGV4dEFyZWFJbnB1dE92ZXJmbG93ZWRZJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy51cGRhdGVTaXplXygpO1xuXG4gICAgaWYgKHRoaXMuaXNCZWluZ0VkaXRlZF8pIHtcbiAgICAgIGlmIChibG9jay5SVEwpIHtcbiAgICAgICAgLy8gaW4gUlRMLCB3ZSBuZWVkIHRvIGxldCB0aGUgYnJvd3NlciByZWZsb3cgYmVmb3JlIHJlc2l6aW5nXG4gICAgICAgIC8vIGluIG9yZGVyIHRvIGdldCB0aGUgY29ycmVjdCBib3VuZGluZyBib3ggb2YgdGhlIGJvcmRlclJlY3RcbiAgICAgICAgLy8gYXZvaWRpbmcgaXNzdWUgIzI3NzcuXG4gICAgICAgIHNldFRpbWVvdXQodGhpcy5yZXNpemVFZGl0b3JfLmJpbmQodGhpcyksIDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZXNpemVFZGl0b3JfKCk7XG4gICAgICB9XG4gICAgICBjb25zdCBodG1sSW5wdXQgPSB0aGlzLmh0bWxJbnB1dF8gYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBpZiAoIXRoaXMuaXNUZXh0VmFsaWRfKSB7XG4gICAgICAgIGRvbS5hZGRDbGFzcyhodG1sSW5wdXQsICdibG9ja2x5SW52YWxpZElucHV0Jyk7XG4gICAgICAgIGFyaWEuc2V0U3RhdGUoaHRtbElucHV0LCBhcmlhLlN0YXRlLklOVkFMSUQsIHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9tLnJlbW92ZUNsYXNzKGh0bWxJbnB1dCwgJ2Jsb2NrbHlJbnZhbGlkSW5wdXQnKTtcbiAgICAgICAgYXJpYS5zZXRTdGF0ZShodG1sSW5wdXQsIGFyaWEuU3RhdGUuSU5WQUxJRCwgZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBVcGRhdGVzIHRoZSBzaXplIG9mIHRoZSBmaWVsZCBiYXNlZCBvbiB0aGUgdGV4dC4gKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHVwZGF0ZVNpemVfKCkge1xuICAgIGNvbnN0IG5vZGVzID0gdGhpcy50ZXh0R3JvdXBfLmNoaWxkTm9kZXM7XG4gICAgY29uc3QgZm9udFNpemUgPSB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9URVhUX0ZPTlRTSVpFO1xuICAgIGNvbnN0IGZvbnRXZWlnaHQgPSB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9URVhUX0ZPTlRXRUlHSFQ7XG4gICAgY29uc3QgZm9udEZhbWlseSA9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX1RFWFRfRk9OVEZBTUlMWTtcbiAgICBsZXQgdG90YWxXaWR0aCA9IDA7XG4gICAgbGV0IHRvdGFsSGVpZ2h0ID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0c3BhbiA9IG5vZGVzW2ldIGFzIFNWR1RleHRFbGVtZW50O1xuICAgICAgY29uc3QgdGV4dFdpZHRoID1cbiAgICAgICAgICBkb20uZ2V0RmFzdFRleHRXaWR0aCh0c3BhbiwgZm9udFNpemUsIGZvbnRXZWlnaHQsIGZvbnRGYW1pbHkpO1xuICAgICAgaWYgKHRleHRXaWR0aCA+IHRvdGFsV2lkdGgpIHtcbiAgICAgICAgdG90YWxXaWR0aCA9IHRleHRXaWR0aDtcbiAgICAgIH1cbiAgICAgIHRvdGFsSGVpZ2h0ICs9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX1RFWFRfSEVJR0hUICtcbiAgICAgICAgICAoaSA+IDAgPyB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9CT1JERVJfUkVDVF9ZX1BBRERJTkcgOiAwKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNCZWluZ0VkaXRlZF8pIHtcbiAgICAgIC8vIFRoZSBkZWZhdWx0IHdpZHRoIGlzIGJhc2VkIG9uIHRoZSBsb25nZXN0IGxpbmUgaW4gdGhlIGRpc3BsYXkgdGV4dCxcbiAgICAgIC8vIGJ1dCB3aGVuIGl0J3MgYmVpbmcgZWRpdGVkLCB3aWR0aCBzaG91bGQgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGVcbiAgICAgIC8vIGFic29sdXRlIGxvbmdlc3QgbGluZSwgZXZlbiBpZiBpdCB3b3VsZCBiZSB0cnVuY2F0ZWQgYWZ0ZXIgZWRpdGluZy5cbiAgICAgIC8vIE90aGVyd2lzZSB3ZSB3b3VsZCBnZXQgd3JvbmcgZWRpdG9yIHdpZHRoIHdoZW4gdGhlcmUgYXJlIG1vcmVcbiAgICAgIC8vIGxpbmVzIHRoYW4gdGhpcy5tYXhMaW5lc18uXG4gICAgICBjb25zdCBhY3R1YWxFZGl0b3JMaW5lcyA9IHRoaXMudmFsdWVfLnNwbGl0KCdcXG4nKTtcbiAgICAgIGNvbnN0IGR1bW15VGV4dEVsZW1lbnQgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgICBTdmcuVEVYVCwgeydjbGFzcyc6ICdibG9ja2x5VGV4dCBibG9ja2x5TXVsdGlsaW5lVGV4dCd9KTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3R1YWxFZGl0b3JMaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoYWN0dWFsRWRpdG9yTGluZXNbaV0ubGVuZ3RoID4gdGhpcy5tYXhEaXNwbGF5TGVuZ3RoKSB7XG4gICAgICAgICAgYWN0dWFsRWRpdG9yTGluZXNbaV0gPVxuICAgICAgICAgICAgICBhY3R1YWxFZGl0b3JMaW5lc1tpXS5zdWJzdHJpbmcoMCwgdGhpcy5tYXhEaXNwbGF5TGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICBkdW1teVRleHRFbGVtZW50LnRleHRDb250ZW50ID0gYWN0dWFsRWRpdG9yTGluZXNbaV07XG4gICAgICAgIGNvbnN0IGxpbmVXaWR0aCA9IGRvbS5nZXRGYXN0VGV4dFdpZHRoKFxuICAgICAgICAgICAgZHVtbXlUZXh0RWxlbWVudCwgZm9udFNpemUsIGZvbnRXZWlnaHQsIGZvbnRGYW1pbHkpO1xuICAgICAgICBpZiAobGluZVdpZHRoID4gdG90YWxXaWR0aCkge1xuICAgICAgICAgIHRvdGFsV2lkdGggPSBsaW5lV2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2Nyb2xsYmFyV2lkdGggPVxuICAgICAgICAgIHRoaXMuaHRtbElucHV0XyEub2Zmc2V0V2lkdGggLSB0aGlzLmh0bWxJbnB1dF8hLmNsaWVudFdpZHRoO1xuICAgICAgdG90YWxXaWR0aCArPSBzY3JvbGxiYXJXaWR0aDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYm9yZGVyUmVjdF8pIHtcbiAgICAgIHRvdGFsSGVpZ2h0ICs9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0JPUkRFUl9SRUNUX1lfUEFERElORyAqIDI7XG4gICAgICB0b3RhbFdpZHRoICs9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0JPUkRFUl9SRUNUX1hfUEFERElORyAqIDI7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgICAgdGhpcy5ib3JkZXJSZWN0Xy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgdG90YWxXaWR0aCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdudW1iZXInIGlzIG5vdFxuICAgICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICAgIHRoaXMuYm9yZGVyUmVjdF8uc2V0QXR0cmlidXRlKFxuICAgICAgICAgICdoZWlnaHQnLCB0b3RhbEhlaWdodCBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuICAgIH1cbiAgICB0aGlzLnNpemVfLndpZHRoID0gdG90YWxXaWR0aDtcbiAgICB0aGlzLnNpemVfLmhlaWdodCA9IHRvdGFsSGVpZ2h0O1xuXG4gICAgdGhpcy5wb3NpdGlvbkJvcmRlclJlY3RfKCk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyB0aGUgaW5saW5lIGZyZWUtdGV4dCBlZGl0b3Igb24gdG9wIG9mIHRoZSB0ZXh0LlxuICAgKiBPdmVycmlkZXMgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIHRvIGZvcmNlIHJlcmVuZGVyIGluIG9yZGVyIHRvXG4gICAqIGNvcnJlY3QgYmxvY2sgc2l6ZSwgYmFzZWQgb24gZWRpdG9yIHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSBfb3B0X2UgT3B0aW9uYWwgbW91c2UgZXZlbnQgdGhhdCB0cmlnZ2VyZWQgdGhlIGZpZWxkIHRvIG9wZW4sIG9yXG4gICAqICAgICB1bmRlZmluZWQgaWYgdHJpZ2dlcmVkIHByb2dyYW1tYXRpY2FsbHkuXG4gICAqIEBwYXJhbSBvcHRfcXVpZXRJbnB1dCBUcnVlIGlmIGVkaXRvciBzaG91bGQgYmUgY3JlYXRlZCB3aXRob3V0IGZvY3VzLlxuICAgKiAgICAgRGVmYXVsdHMgdG8gZmFsc2UuXG4gICAqL1xuICBvdmVycmlkZSBzaG93RWRpdG9yXyhfb3B0X2U/OiBFdmVudCwgb3B0X3F1aWV0SW5wdXQ/OiBib29sZWFuKSB7XG4gICAgc3VwZXIuc2hvd0VkaXRvcl8oX29wdF9lLCBvcHRfcXVpZXRJbnB1dCk7XG4gICAgdGhpcy5mb3JjZVJlcmVuZGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSB0ZXh0IGlucHV0IGVkaXRvciB3aWRnZXQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHRleHQgaW5wdXQgZWRpdG9yLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHdpZGdldENyZWF0ZV8oKTogSFRNTFRleHRBcmVhRWxlbWVudCB7XG4gICAgY29uc3QgZGl2ID0gV2lkZ2V0RGl2LmdldERpdigpO1xuICAgIGNvbnN0IHNjYWxlID0gdGhpcy53b3Jrc3BhY2VfIS5nZXRTY2FsZSgpO1xuXG4gICAgY29uc3QgaHRtbElucHV0ID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJykpO1xuICAgIGh0bWxJbnB1dC5jbGFzc05hbWUgPSAnYmxvY2tseUh0bWxJbnB1dCBibG9ja2x5SHRtbFRleHRBcmVhSW5wdXQnO1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgQXJndW1lbnQgb2YgdHlwZSAnYm9vbGVhbicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICBodG1sSW5wdXQuc2V0QXR0cmlidXRlKFxuICAgICAgICAnc3BlbGxjaGVjaycsIHRoaXMuc3BlbGxjaGVja18gYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICBjb25zdCBmb250U2l6ZSA9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX1RFWFRfRk9OVFNJWkUgKiBzY2FsZSArICdwdCc7XG4gICAgZGl2IS5zdHlsZS5mb250U2l6ZSA9IGZvbnRTaXplO1xuICAgIGh0bWxJbnB1dC5zdHlsZS5mb250U2l6ZSA9IGZvbnRTaXplO1xuICAgIGNvbnN0IGJvcmRlclJhZGl1cyA9IEZpZWxkVGV4dElucHV0LkJPUkRFUlJBRElVUyAqIHNjYWxlICsgJ3B4JztcbiAgICBodG1sSW5wdXQuc3R5bGUuYm9yZGVyUmFkaXVzID0gYm9yZGVyUmFkaXVzO1xuICAgIGNvbnN0IHBhZGRpbmdYID0gdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWF9QQURESU5HICogc2NhbGU7XG4gICAgY29uc3QgcGFkZGluZ1kgPVxuICAgICAgICB0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9CT1JERVJfUkVDVF9ZX1BBRERJTkcgKiBzY2FsZSAvIDI7XG4gICAgaHRtbElucHV0LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nWSArICdweCAnICsgcGFkZGluZ1ggKyAncHggJyArIHBhZGRpbmdZICtcbiAgICAgICAgJ3B4ICcgKyBwYWRkaW5nWCArICdweCc7XG4gICAgY29uc3QgbGluZUhlaWdodCA9IHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX1RFWFRfSEVJR0hUICtcbiAgICAgICAgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQk9SREVSX1JFQ1RfWV9QQURESU5HO1xuICAgIGh0bWxJbnB1dC5zdHlsZS5saW5lSGVpZ2h0ID0gbGluZUhlaWdodCAqIHNjYWxlICsgJ3B4JztcblxuICAgIGRpdiEuYXBwZW5kQ2hpbGQoaHRtbElucHV0KTtcblxuICAgIGh0bWxJbnB1dC52YWx1ZSA9IGh0bWxJbnB1dC5kZWZhdWx0VmFsdWUgPSB0aGlzLmdldEVkaXRvclRleHRfKHRoaXMudmFsdWVfKTtcbiAgICBodG1sSW5wdXQuc2V0QXR0cmlidXRlKCdkYXRhLXVudHlwZWQtZGVmYXVsdC12YWx1ZScsIHRoaXMudmFsdWVfKTtcbiAgICBodG1sSW5wdXQuc2V0QXR0cmlidXRlKCdkYXRhLW9sZC12YWx1ZScsICcnKTtcbiAgICBpZiAodXNlckFnZW50LkdFQ0tPKSB7XG4gICAgICAvLyBJbiBGRiwgZW5zdXJlIHRoZSBicm93c2VyIHJlZmxvd3MgYmVmb3JlIHJlc2l6aW5nIHRvIGF2b2lkIGlzc3VlICMyNzc3LlxuICAgICAgc2V0VGltZW91dCh0aGlzLnJlc2l6ZUVkaXRvcl8uYmluZCh0aGlzKSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVzaXplRWRpdG9yXygpO1xuICAgIH1cblxuICAgIHRoaXMuYmluZElucHV0RXZlbnRzXyhodG1sSW5wdXQpO1xuXG4gICAgcmV0dXJuIGh0bWxJbnB1dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBtYXhMaW5lcyBjb25maWcgZm9yIHRoaXMgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBtYXhMaW5lcyBEZWZpbmVzIHRoZSBtYXhpbXVtIG51bWJlciBvZiBsaW5lcyBhbGxvd2VkLCBiZWZvcmVcbiAgICogICAgIHNjcm9sbGluZyBmdW5jdGlvbmFsaXR5IGlzIGVuYWJsZWQuXG4gICAqL1xuICBzZXRNYXhMaW5lcyhtYXhMaW5lczogbnVtYmVyKSB7XG4gICAgaWYgKHR5cGVvZiBtYXhMaW5lcyA9PT0gJ251bWJlcicgJiYgbWF4TGluZXMgPiAwICYmXG4gICAgICAgIG1heExpbmVzICE9PSB0aGlzLm1heExpbmVzXykge1xuICAgICAgdGhpcy5tYXhMaW5lc18gPSBtYXhMaW5lcztcbiAgICAgIHRoaXMuZm9yY2VSZXJlbmRlcigpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBtYXhMaW5lcyBjb25maWcgb2YgdGhpcyBmaWVsZC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIG1heExpbmVzIGNvbmZpZyB2YWx1ZS5cbiAgICovXG4gIGdldE1heExpbmVzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubWF4TGluZXNfO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBrZXkgZG93biB0byB0aGUgZWRpdG9yLiBPdmVycmlkZSB0aGUgdGV4dCBpbnB1dCBkZWZpbml0aW9uIG9mIHRoaXNcbiAgICogc28gYXMgdG8gbm90IGNsb3NlIHRoZSBlZGl0b3Igd2hlbiBlbnRlciBpcyB0eXBlZCBpbi5cbiAgICpcbiAgICogQHBhcmFtIGUgS2V5Ym9hcmQgZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgb25IdG1sSW5wdXRLZXlEb3duXyhlOiBFdmVudCkge1xuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2tleUNvZGUnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGVcbiAgICAvLyAnRXZlbnQnLlxuICAgIGlmICgoZSBhcyBBbnlEdXJpbmdNaWdyYXRpb24pLmtleUNvZGUgIT09IEtleUNvZGVzLkVOVEVSKSB7XG4gICAgICBzdXBlci5vbkh0bWxJbnB1dEtleURvd25fKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3QgYSBGaWVsZE11bHRpbGluZUlucHV0IGZyb20gYSBKU09OIGFyZyBvYmplY3QsXG4gICAqIGRlcmVmZXJlbmNpbmcgYW55IHN0cmluZyB0YWJsZSByZWZlcmVuY2VzLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBBIEpTT04gb2JqZWN0IHdpdGggb3B0aW9ucyAodGV4dCwgYW5kIHNwZWxsY2hlY2spLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBvdmVycmlkZSBmcm9tSnNvbihvcHRpb25zOiBGaWVsZE11bHRpbGluZUlucHV0RnJvbUpzb25Db25maWcpOlxuICAgICAgRmllbGRNdWx0aWxpbmVJbnB1dCB7XG4gICAgY29uc3QgdGV4dCA9IHBhcnNpbmcucmVwbGFjZU1lc3NhZ2VSZWZlcmVuY2VzKG9wdGlvbnMudGV4dCk7XG4gICAgLy8gYHRoaXNgIG1pZ2h0IGJlIGEgc3ViY2xhc3Mgb2YgRmllbGRNdWx0aWxpbmVJbnB1dCBpZiB0aGF0IGNsYXNzIGRvZXNuJ3RcbiAgICAvLyBvdmVycmlkZSB0aGUgc3RhdGljIGZyb21Kc29uIG1ldGhvZC5cbiAgICByZXR1cm4gbmV3IHRoaXModGV4dCwgdW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgfVxufVxuXG4vKiogQ1NTIGZvciBtdWx0aWxpbmUgZmllbGQuICBTZWUgY3NzLmpzIGZvciB1c2UuICovXG5Dc3MucmVnaXN0ZXIoYFxuLmJsb2NrbHlIdG1sVGV4dEFyZWFJbnB1dCB7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG4gIHJlc2l6ZTogbm9uZTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgaGVpZ2h0OiAxMDAlO1xuICB0ZXh0LWFsaWduOiBsZWZ0O1xufVxuXG4uYmxvY2tseUh0bWxUZXh0QXJlYUlucHV0T3ZlcmZsb3dlZFkge1xuICBvdmVyZmxvdy15OiBzY3JvbGw7XG59XG5gKTtcblxuZmllbGRSZWdpc3RyeS5yZWdpc3RlcignZmllbGRfbXVsdGlsaW5ldGV4dCcsIEZpZWxkTXVsdGlsaW5lSW5wdXQpO1xuXG4vKipcbiAqIENvbmZpZyBvcHRpb25zIGZvciB0aGUgbXVsdGlsaW5lIGlucHV0IGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkTXVsdGlsaW5lSW5wdXRDb25maWcgZXh0ZW5kcyBGaWVsZFRleHRJbnB1dENvbmZpZyB7XG4gIG1heExpbmVzPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIGZyb21Kc29uIGNvbmZpZyBvcHRpb25zIGZvciB0aGUgbXVsdGlsaW5lIGlucHV0IGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkTXVsdGlsaW5lSW5wdXRGcm9tSnNvbkNvbmZpZyBleHRlbmRzXG4gICAgRmllbGRNdWx0aWxpbmVJbnB1dENvbmZpZyB7XG4gIHRleHQ/OiBzdHJpbmc7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogTm9uLWVkaXRhYmxlLCBzZXJpYWxpemFibGUgdGV4dCBmaWVsZC4gQmVoYXZlcyBsaWtlIGFcbiAqICAgIG5vcm1hbCBsYWJlbCBidXQgaXMgc2VyaWFsaXplZCB0byBYTUwuIEl0IG1heSBvbmx5IGJlXG4gKiAgICBlZGl0ZWQgcHJvZ3JhbW1hdGljYWxseS5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GaWVsZExhYmVsU2VyaWFsaXphYmxlJyk7XG5cbmltcG9ydCB7RmllbGRMYWJlbCwgRmllbGRMYWJlbENvbmZpZywgRmllbGRMYWJlbEZyb21Kc29uQ29uZmlnfSBmcm9tICcuL2ZpZWxkX2xhYmVsLmpzJztcbmltcG9ydCAqIGFzIGZpZWxkUmVnaXN0cnkgZnJvbSAnLi9maWVsZF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgKiBhcyBwYXJzaW5nIGZyb20gJy4vdXRpbHMvcGFyc2luZy5qcyc7XG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgbm9uLWVkaXRhYmxlLCBzZXJpYWxpemFibGUgdGV4dCBmaWVsZC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5GaWVsZExhYmVsU2VyaWFsaXphYmxlXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWVsZExhYmVsU2VyaWFsaXphYmxlIGV4dGVuZHMgRmllbGRMYWJlbCB7XG4gIC8qKlxuICAgKiBFZGl0YWJsZSBmaWVsZHMgdXN1YWxseSBzaG93IHNvbWUgc29ydCBvZiBVSSBpbmRpY2F0aW5nIHRoZXkgYXJlXG4gICAqIGVkaXRhYmxlLiBUaGlzIGZpZWxkIHNob3VsZCBub3QuXG4gICAqL1xuICBvdmVycmlkZSBFRElUQUJMRSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTZXJpYWxpemFibGUgZmllbGRzIGFyZSBzYXZlZCBieSB0aGUgWE1MIHJlbmRlcmVyLCBub24tc2VyaWFsaXphYmxlXG4gICAqIGZpZWxkcyBhcmUgbm90LiAgVGhpcyBmaWVsZCBzaG91bGQgYmUgc2VyaWFsaXplZCwgYnV0IG9ubHkgZWRpdGVkXG4gICAqIHByb2dyYW1tYXRpY2FsbHkuXG4gICAqL1xuICBvdmVycmlkZSBTRVJJQUxJWkFCTEUgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X3ZhbHVlIFRoZSBpbml0aWFsIHZhbHVlIG9mIHRoZSBmaWVsZC4gU2hvdWxkIGNhc3QgdG8gYSBzdHJpbmcuXG4gICAqICAgICBEZWZhdWx0cyB0byBhbiBlbXB0eSBzdHJpbmcgaWYgbnVsbCBvciB1bmRlZmluZWQuXG4gICAqIEBwYXJhbSBvcHRfY2xhc3MgT3B0aW9uYWwgQ1NTIGNsYXNzIGZvciB0aGUgZmllbGQncyB0ZXh0LlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgU2VlIHRoZSBbZmllbGQgY3JlYXRpb24gZG9jdW1lbnRhdGlvbl17QGxpbmtcbiAgICogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYmxvY2tseS9ndWlkZXMvY3JlYXRlLWN1c3RvbS1ibG9ja3MvZmllbGRzL2J1aWx0LWluLWZpZWxkcy9sYWJlbC1zZXJpYWxpemFibGUjY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X3ZhbHVlPzogc3RyaW5nLCBvcHRfY2xhc3M/OiBzdHJpbmcsIG9wdF9jb25maWc/OiBGaWVsZExhYmVsQ29uZmlnKSB7XG4gICAgc3VwZXIoU3RyaW5nKG9wdF92YWx1ZSA/PyAnJyksIG9wdF9jbGFzcywgb3B0X2NvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogQ29uc3RydWN0IGEgRmllbGRMYWJlbFNlcmlhbGl6YWJsZSBmcm9tIGEgSlNPTiBhcmcgb2JqZWN0LFxuICAgKiBkZXJlZmVyZW5jaW5nIGFueSBzdHJpbmcgdGFibGUgcmVmZXJlbmNlcy5cbiAgICpcbiAgICogQHBhcmFtIG9wdGlvbnMgQSBKU09OIG9iamVjdCB3aXRoIG9wdGlvbnMgKHRleHQsIGFuZCBjbGFzcykuXG4gICAqIEByZXR1cm5zIFRoZSBuZXcgZmllbGQgaW5zdGFuY2UuXG4gICAqIEBub2NvbGxhcHNlXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIG92ZXJyaWRlIGZyb21Kc29uKG9wdGlvbnM6IEZpZWxkTGFiZWxGcm9tSnNvbkNvbmZpZyk6XG4gICAgICBGaWVsZExhYmVsU2VyaWFsaXphYmxlIHtcbiAgICBjb25zdCB0ZXh0ID0gcGFyc2luZy5yZXBsYWNlTWVzc2FnZVJlZmVyZW5jZXMob3B0aW9ucy50ZXh0KTtcbiAgICAvLyBgdGhpc2AgbWlnaHQgYmUgYSBzdWJjbGFzcyBvZiBGaWVsZExhYmVsU2VyaWFsaXphYmxlIGlmIHRoYXQgY2xhc3NcbiAgICAvLyBkb2Vzbid0IG92ZXJyaWRlIHRoZSBzdGF0aWMgZnJvbUpzb24gbWV0aG9kLlxuICAgIHJldHVybiBuZXcgdGhpcyh0ZXh0LCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICB9XG59XG5cbmZpZWxkUmVnaXN0cnkucmVnaXN0ZXIoJ2ZpZWxkX2xhYmVsX3NlcmlhbGl6YWJsZScsIEZpZWxkTGFiZWxTZXJpYWxpemFibGUpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENvbG91ciBpbnB1dCBmaWVsZC5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5GaWVsZENvbG91cicpO1xuXG4vLyBVbnVzZWQgaW1wb3J0IHByZXNlcnZlZCBmb3Igc2lkZS1lZmZlY3RzLiBSZW1vdmUgaWYgdW5uZWVkZWQuXG5pbXBvcnQgJy4vZXZlbnRzL2V2ZW50c19ibG9ja19jaGFuZ2UuanMnO1xuXG5pbXBvcnQge0Jsb2NrU3ZnfSBmcm9tICcuL2Jsb2NrX3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyBicm93c2VyRXZlbnRzIGZyb20gJy4vYnJvd3Nlcl9ldmVudHMuanMnO1xuaW1wb3J0ICogYXMgQ3NzIGZyb20gJy4vY3NzLmpzJztcbmltcG9ydCAqIGFzIGRvbSBmcm9tICcuL3V0aWxzL2RvbS5qcyc7XG5pbXBvcnQgKiBhcyBkcm9wRG93bkRpdiBmcm9tICcuL2Ryb3Bkb3duZGl2LmpzJztcbmltcG9ydCB7RmllbGQsIEZpZWxkQ29uZmlnLCBGaWVsZFZhbGlkYXRvcn0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgKiBhcyBmaWVsZFJlZ2lzdHJ5IGZyb20gJy4vZmllbGRfcmVnaXN0cnkuanMnO1xuaW1wb3J0ICogYXMgYXJpYSBmcm9tICcuL3V0aWxzL2FyaWEuanMnO1xuaW1wb3J0ICogYXMgY29sb3VyIGZyb20gJy4vdXRpbHMvY29sb3VyLmpzJztcbmltcG9ydCAqIGFzIGlkR2VuZXJhdG9yIGZyb20gJy4vdXRpbHMvaWRnZW5lcmF0b3IuanMnO1xuaW1wb3J0IHtLZXlDb2Rlc30gZnJvbSAnLi91dGlscy9rZXljb2Rlcy5qcyc7XG5pbXBvcnQgdHlwZSB7U2VudGluZWx9IGZyb20gJy4vdXRpbHMvc2VudGluZWwuanMnO1xuaW1wb3J0IHtTaXplfSBmcm9tICcuL3V0aWxzL3NpemUuanMnO1xuXG5leHBvcnQgdHlwZSBGaWVsZENvbG91clZhbGlkYXRvciA9IEZpZWxkVmFsaWRhdG9yPHN0cmluZz47XG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgY29sb3VyIGlucHV0IGZpZWxkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkZpZWxkQ29sb3VyXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWVsZENvbG91ciBleHRlbmRzIEZpZWxkPHN0cmluZz4ge1xuICAvKipcbiAgICogQW4gYXJyYXkgb2YgY29sb3VyIHN0cmluZ3MgZm9yIHRoZSBwYWxldHRlLlxuICAgKiBDb3BpZWQgZnJvbSBnb29nLnVpLkNvbG9yUGlja2VyLlNJTVBMRV9HUklEX0NPTE9SU1xuICAgKiBBbGwgY29sb3VyIHBpY2tlcnMgdXNlIHRoaXMgdW5sZXNzIG92ZXJyaWRkZW4gd2l0aCBzZXRDb2xvdXJzLlxuICAgKi9cbiAgc3RhdGljIENPTE9VUlM6IHN0cmluZ1tdID0gW1xuICAgIC8vIGdyYXlzXG4gICAgJyNmZmZmZmYnLCAnI2NjY2NjYycsICcjYzBjMGMwJywgJyM5OTk5OTknLFxuICAgICcjNjY2NjY2JywgJyMzMzMzMzMnLCAnIzAwMDAwMCcsICAvLyByZWRzXG4gICAgJyNmZmNjY2MnLCAnI2ZmNjY2NicsICcjZmYwMDAwJywgJyNjYzAwMDAnLFxuICAgICcjOTkwMDAwJywgJyM2NjAwMDAnLCAnIzMzMDAwMCcsICAvLyBvcmFuZ2VzXG4gICAgJyNmZmNjOTknLCAnI2ZmOTk2NicsICcjZmY5OTAwJywgJyNmZjY2MDAnLFxuICAgICcjY2M2NjAwJywgJyM5OTMzMDAnLCAnIzY2MzMwMCcsICAvLyB5ZWxsb3dzXG4gICAgJyNmZmZmOTknLCAnI2ZmZmY2NicsICcjZmZjYzY2JywgJyNmZmNjMzMnLFxuICAgICcjY2M5OTMzJywgJyM5OTY2MzMnLCAnIzY2MzMzMycsICAvLyBvbGl2ZXNcbiAgICAnI2ZmZmZjYycsICcjZmZmZjMzJywgJyNmZmZmMDAnLCAnI2ZmY2MwMCcsXG4gICAgJyM5OTk5MDAnLCAnIzY2NjYwMCcsICcjMzMzMzAwJywgIC8vIGdyZWVuc1xuICAgICcjOTlmZjk5JywgJyM2NmZmOTknLCAnIzMzZmYzMycsICcjMzNjYzAwJyxcbiAgICAnIzAwOTkwMCcsICcjMDA2NjAwJywgJyMwMDMzMDAnLCAgLy8gdHVycXVvaXNlc1xuICAgICcjOTlmZmZmJywgJyMzM2ZmZmYnLCAnIzY2Y2NjYycsICcjMDBjY2NjJyxcbiAgICAnIzMzOTk5OScsICcjMzM2NjY2JywgJyMwMDMzMzMnLCAgLy8gYmx1ZXNcbiAgICAnI2NjZmZmZicsICcjNjZmZmZmJywgJyMzM2NjZmYnLCAnIzMzNjZmZicsXG4gICAgJyMzMzMzZmYnLCAnIzAwMDA5OScsICcjMDAwMDY2JywgIC8vIHB1cnBsZXNcbiAgICAnI2NjY2NmZicsICcjOTk5OWZmJywgJyM2NjY2Y2MnLCAnIzY2MzNmZicsXG4gICAgJyM2NjAwY2MnLCAnIzMzMzM5OScsICcjMzMwMDk5JywgIC8vIHZpb2xldHNcbiAgICAnI2ZmY2NmZicsICcjZmY5OWZmJywgJyNjYzY2Y2MnLCAnI2NjMzNjYycsXG4gICAgJyM5OTMzOTknLCAnIzY2MzM2NicsICcjMzMwMDMzJyxcbiAgXTtcblxuICAvKipcbiAgICogQW4gYXJyYXkgb2YgdG9vbHRpcCBzdHJpbmdzIGZvciB0aGUgcGFsZXR0ZS4gIElmIG5vdCB0aGUgc2FtZSBsZW5ndGggYXNcbiAgICogQ09MT1VSUywgdGhlIGNvbG91cidzIGhleCBjb2RlIHdpbGwgYmUgdXNlZCBmb3IgYW55IG1pc3NpbmcgdGl0bGVzLlxuICAgKiBBbGwgY29sb3VyIHBpY2tlcnMgdXNlIHRoaXMgdW5sZXNzIG92ZXJyaWRkZW4gd2l0aCBzZXRDb2xvdXJzLlxuICAgKi9cbiAgc3RhdGljIFRJVExFUzogc3RyaW5nW10gPSBbXTtcblxuICAvKipcbiAgICogTnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHBhbGV0dGUuXG4gICAqIEFsbCBjb2xvdXIgcGlja2VycyB1c2UgdGhpcyB1bmxlc3Mgb3ZlcnJpZGRlbiB3aXRoIHNldENvbHVtbnMuXG4gICAqL1xuICBzdGF0aWMgQ09MVU1OUyA9IDc7XG5cbiAgLyoqIFRoZSBmaWVsZCdzIGNvbG91ciBwaWNrZXIgZWxlbWVudC4gKi9cbiAgcHJpdmF0ZSBwaWNrZXJfOiBFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBJbmRleCBvZiB0aGUgY3VycmVudGx5IGhpZ2hsaWdodGVkIGVsZW1lbnQuICovXG4gIHByaXZhdGUgaGlnaGxpZ2h0ZWRJbmRleF86IG51bWJlcnxudWxsID0gbnVsbDtcblxuICAvKiogTW91c2UgY2xpY2sgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbkNsaWNrV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogTW91c2UgbW92ZSBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIG9uTW91c2VNb3ZlV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKiogTW91c2UgZW50ZXIgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBvbk1vdXNlRW50ZXJXcmFwcGVyXzogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKiBNb3VzZSBsZWF2ZSBldmVudCBkYXRhLiAqL1xuICBwcml2YXRlIG9uTW91c2VMZWF2ZVdyYXBwZXJfOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIEtleSBkb3duIGV2ZW50IGRhdGEuICovXG4gIHByaXZhdGUgb25LZXlEb3duV3JhcHBlcl86IGJyb3dzZXJFdmVudHMuRGF0YXxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogU2VyaWFsaXphYmxlIGZpZWxkcyBhcmUgc2F2ZWQgYnkgdGhlIHNlcmlhbGl6ZXIsIG5vbi1zZXJpYWxpemFibGUgZmllbGRzXG4gICAqIGFyZSBub3QuIEVkaXRhYmxlIGZpZWxkcyBzaG91bGQgYWxzbyBiZSBzZXJpYWxpemFibGUuXG4gICAqL1xuICBvdmVycmlkZSBTRVJJQUxJWkFCTEUgPSB0cnVlO1xuXG4gIC8qKiBNb3VzZSBjdXJzb3Igc3R5bGUgd2hlbiBvdmVyIHRoZSBob3RzcG90IHRoYXQgaW5pdGlhdGVzIHRoZSBlZGl0b3IuICovXG4gIG92ZXJyaWRlIENVUlNPUiA9ICdkZWZhdWx0JztcblxuICAvKipcbiAgICogVXNlZCB0byB0ZWxsIGlmIHRoZSBmaWVsZCBuZWVkcyB0byBiZSByZW5kZXJlZCB0aGUgbmV4dCB0aW1lIHRoZSBibG9jayBpc1xuICAgKiByZW5kZXJlZC4gQ29sb3VyIGZpZWxkcyBhcmUgc3RhdGljYWxseSBzaXplZCwgYW5kIG9ubHkgbmVlZCB0byBiZVxuICAgKiByZW5kZXJlZCBhdCBpbml0aWFsaXphdGlvbi5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBpc0RpcnR5XyA9IGZhbHNlO1xuXG4gIC8qKiBBcnJheSBvZiBjb2xvdXJzIHVzZWQgYnkgdGhpcyBmaWVsZC4gIElmIG51bGwsIHVzZSB0aGUgZ2xvYmFsIGxpc3QuICovXG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAvLyAnc3RyaW5nW10nLlxuICBwcml2YXRlIGNvbG91cnNfOiBzdHJpbmdbXSA9IG51bGwgYXMgQW55RHVyaW5nTWlncmF0aW9uO1xuXG4gIC8qKlxuICAgKiBBcnJheSBvZiBjb2xvdXIgdG9vbHRpcHMgdXNlZCBieSB0aGlzIGZpZWxkLiAgSWYgbnVsbCwgdXNlIHRoZSBnbG9iYWxcbiAgICogbGlzdC5cbiAgICovXG4gIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgVHlwZSAnbnVsbCcgaXMgbm90IGFzc2lnbmFibGUgdG8gdHlwZVxuICAvLyAnc3RyaW5nW10nLlxuICBwcml2YXRlIHRpdGxlc186IHN0cmluZ1tdID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqXG4gICAqIE51bWJlciBvZiBjb2xvdXIgY29sdW1ucyB1c2VkIGJ5IHRoaXMgZmllbGQuICBJZiAwLCB1c2UgdGhlIGdsb2JhbFxuICAgKiBzZXR0aW5nLiBCeSBkZWZhdWx0IHVzZSB0aGUgZ2xvYmFsIGNvbnN0YW50cyBmb3IgY29sdW1ucy5cbiAgICovXG4gIHByaXZhdGUgY29sdW1uc18gPSAwO1xuICBvdmVycmlkZSBzaXplXzogQW55RHVyaW5nTWlncmF0aW9uO1xuICBvdmVycmlkZSBjbGlja1RhcmdldF86IEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgb3ZlcnJpZGUgdmFsdWVfOiBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfdmFsdWUgVGhlIGluaXRpYWwgdmFsdWUgb2YgdGhlIGZpZWxkLiBTaG91bGQgYmUgaW4gJyNycmdnYmInXG4gICAqICAgICBmb3JtYXQuIERlZmF1bHRzIHRvIHRoZSBmaXJzdCB2YWx1ZSBpbiB0aGUgZGVmYXVsdCBjb2xvdXIgYXJyYXkuIEFsc29cbiAgICogICAgIGFjY2VwdHMgRmllbGQuU0tJUF9TRVRVUCBpZiB5b3Ugd2lzaCB0byBza2lwIHNldHVwIChvbmx5IHVzZWQgYnlcbiAgICogICAgIHN1YmNsYXNzZXMgdGhhdCB3YW50IHRvIGhhbmRsZSBjb25maWd1cmF0aW9uIGFuZCBzZXR0aW5nIHRoZSBmaWVsZFxuICAgKiAgICAgdmFsdWUgYWZ0ZXIgdGhlaXIgb3duIGNvbnN0cnVjdG9ycyBoYXZlIHJ1bikuXG4gICAqIEBwYXJhbSBvcHRfdmFsaWRhdG9yIEEgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdG8gdmFsaWRhdGUgY2hhbmdlcyB0byB0aGVcbiAgICogICAgIGZpZWxkJ3MgdmFsdWUuIFRha2VzIGluIGEgY29sb3VyIHN0cmluZyAmIHJldHVybnMgYSB2YWxpZGF0ZWQgY29sb3VyXG4gICAqICAgICBzdHJpbmcgKCcjcnJnZ2JiJyBmb3JtYXQpLCBvciBudWxsIHRvIGFib3J0IHRoZSBjaGFuZ2UuQmxvY2tseS5cbiAgICogQHBhcmFtIG9wdF9jb25maWcgQSBtYXAgb2Ygb3B0aW9ucyB1c2VkIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQuXG4gICAqICAgICBTZWUgdGhlIFtmaWVsZCBjcmVhdGlvbiBkb2N1bWVudGF0aW9uXXtAbGlua1xuICAgKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy9maWVsZHMvYnVpbHQtaW4tZmllbGRzL2NvbG91cn1cbiAgICogZm9yIGEgbGlzdCBvZiBwcm9wZXJ0aWVzIHRoaXMgcGFyYW1ldGVyIHN1cHBvcnRzLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBvcHRfdmFsdWU/OiBzdHJpbmd8U2VudGluZWwsIG9wdF92YWxpZGF0b3I/OiBGaWVsZENvbG91clZhbGlkYXRvcixcbiAgICAgIG9wdF9jb25maWc/OiBGaWVsZENvbG91ckNvbmZpZykge1xuICAgIHN1cGVyKEZpZWxkLlNLSVBfU0VUVVApO1xuXG4gICAgaWYgKG9wdF92YWx1ZSA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKG9wdF92YWx1ZSk7XG4gICAgaWYgKG9wdF92YWxpZGF0b3IpIHtcbiAgICAgIHRoaXMuc2V0VmFsaWRhdG9yKG9wdF92YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIGZpZWxkIGJhc2VkIG9uIHRoZSBnaXZlbiBtYXAgb2Ygb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGNvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQgYmFzZWQgb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY29uZmlndXJlXyhjb25maWc6IEZpZWxkQ29sb3VyQ29uZmlnKSB7XG4gICAgc3VwZXIuY29uZmlndXJlXyhjb25maWcpO1xuICAgIGlmIChjb25maWcuY29sb3VyT3B0aW9ucykgdGhpcy5jb2xvdXJzXyA9IGNvbmZpZy5jb2xvdXJPcHRpb25zO1xuICAgIGlmIChjb25maWcuY29sb3VyVGl0bGVzKSB0aGlzLnRpdGxlc18gPSBjb25maWcuY29sb3VyVGl0bGVzO1xuICAgIGlmIChjb25maWcuY29sdW1ucykgdGhpcy5jb2x1bW5zXyA9IGNvbmZpZy5jb2x1bW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmxvY2sgVUkgZm9yIHRoaXMgY29sb3VyIGZpZWxkLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIGluaXRWaWV3KCkge1xuICAgIHRoaXMuc2l6ZV8gPSBuZXcgU2l6ZShcbiAgICAgICAgdGhpcy5nZXRDb25zdGFudHMoKSEuRklFTERfQ09MT1VSX0RFRkFVTFRfV0lEVEgsXG4gICAgICAgIHRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0NPTE9VUl9ERUZBVUxUX0hFSUdIVCk7XG4gICAgaWYgKCF0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9DT0xPVVJfRlVMTF9CTE9DSykge1xuICAgICAgdGhpcy5jcmVhdGVCb3JkZXJSZWN0XygpO1xuICAgICAgdGhpcy5nZXRCb3JkZXJSZWN0KCkuc3R5bGVbJ2ZpbGxPcGFjaXR5J10gPSAnMSc7XG4gICAgfSBlbHNlIGlmICh0aGlzLnNvdXJjZUJsb2NrXyBpbnN0YW5jZW9mIEJsb2NrU3ZnKSB7XG4gICAgICB0aGlzLmNsaWNrVGFyZ2V0XyA9IHRoaXMuc291cmNlQmxvY2tfLmdldFN2Z1Jvb3QoKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBhcHBseUNvbG91cigpIHtcbiAgICBpZiAoIXRoaXMuZ2V0Q29uc3RhbnRzKCkhLkZJRUxEX0NPTE9VUl9GVUxMX0JMT0NLKSB7XG4gICAgICBpZiAodGhpcy5ib3JkZXJSZWN0Xykge1xuICAgICAgICB0aGlzLmJvcmRlclJlY3RfLnN0eWxlLmZpbGwgPSB0aGlzLmdldFZhbHVlKCkgYXMgc3RyaW5nO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5zb3VyY2VCbG9ja18gaW5zdGFuY2VvZiBCbG9ja1N2Zykge1xuICAgICAgdGhpcy5zb3VyY2VCbG9ja18ucGF0aE9iamVjdC5zdmdQYXRoLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAnZmlsbCcsIHRoaXMuZ2V0VmFsdWUoKSBhcyBzdHJpbmcpO1xuICAgICAgdGhpcy5zb3VyY2VCbG9ja18ucGF0aE9iamVjdC5zdmdQYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyNmZmYnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5zdXJlIHRoYXQgdGhlIGlucHV0IHZhbHVlIGlzIGEgdmFsaWQgY29sb3VyLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIFRoZSBpbnB1dCB2YWx1ZS5cbiAgICogQHJldHVybnMgQSB2YWxpZCBjb2xvdXIsIG9yIG51bGwgaWYgaW52YWxpZC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBkb0NsYXNzVmFsaWRhdGlvbl8ob3B0X25ld1ZhbHVlPzogQW55RHVyaW5nTWlncmF0aW9uKTpcbiAgICAgIHN0cmluZ3xudWxsIHtcbiAgICBpZiAodHlwZW9mIG9wdF9uZXdWYWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gY29sb3VyLnBhcnNlKG9wdF9uZXdWYWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSB2YWx1ZSBvZiB0aGlzIGNvbG91ciBmaWVsZCwgYW5kIHVwZGF0ZSB0aGUgZGlzcGxheWVkIGNvbG91ci5cbiAgICpcbiAgICogQHBhcmFtIG5ld1ZhbHVlIFRoZSB2YWx1ZSB0byBiZSBzYXZlZC4gVGhlIGRlZmF1bHQgdmFsaWRhdG9yIGd1YXJhbnRlZXNcbiAgICogICAgIHRoYXQgdGhpcyBpcyBhIGNvbG91ciBpbiAnI3JyZ2diYicgZm9ybWF0LlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvVmFsdWVVcGRhdGVfKG5ld1ZhbHVlOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgICB0aGlzLnZhbHVlXyA9IG5ld1ZhbHVlO1xuICAgIGlmICh0aGlzLmJvcmRlclJlY3RfKSB7XG4gICAgICB0aGlzLmJvcmRlclJlY3RfLnN0eWxlLmZpbGwgPSBuZXdWYWx1ZSBhcyBzdHJpbmc7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgICAgdGhpcy5zb3VyY2VCbG9ja18gJiYgdGhpcy5zb3VyY2VCbG9ja18ucmVuZGVyZWQgJiZcbiAgICAgICAgdGhpcy5zb3VyY2VCbG9ja18gaW5zdGFuY2VvZiBCbG9ja1N2Zykge1xuICAgICAgdGhpcy5zb3VyY2VCbG9ja18ucGF0aE9iamVjdC5zdmdQYXRoLnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAnZmlsbCcsIG5ld1ZhbHVlIGFzIHN0cmluZyk7XG4gICAgICB0aGlzLnNvdXJjZUJsb2NrXy5wYXRoT2JqZWN0LnN2Z1BhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnI2ZmZicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRleHQgZm9yIHRoaXMgZmllbGQuICBVc2VkIHdoZW4gdGhlIGJsb2NrIGlzIGNvbGxhcHNlZC5cbiAgICpcbiAgICogQHJldHVybnMgVGV4dCByZXByZXNlbnRpbmcgdGhlIHZhbHVlIG9mIHRoaXMgZmllbGQuXG4gICAqL1xuICBvdmVycmlkZSBnZXRUZXh0KCk6IHN0cmluZyB7XG4gICAgbGV0IGNvbG91ciA9IHRoaXMudmFsdWVfIGFzIHN0cmluZztcbiAgICAvLyBUcnkgdG8gdXNlICNyZ2IgZm9ybWF0IGlmIHBvc3NpYmxlLCByYXRoZXIgdGhhbiAjcnJnZ2JiLlxuICAgIGlmICgvXiMoLilcXDEoLilcXDIoLilcXDMkLy50ZXN0KGNvbG91cikpIHtcbiAgICAgIGNvbG91ciA9ICcjJyArIGNvbG91clsxXSArIGNvbG91clszXSArIGNvbG91cls1XTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbG91cjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgYSBjdXN0b20gY29sb3VyIGdyaWQgZm9yIHRoaXMgZmllbGQuXG4gICAqXG4gICAqIEBwYXJhbSBjb2xvdXJzIEFycmF5IG9mIGNvbG91cnMgZm9yIHRoaXMgYmxvY2ssIG9yIG51bGwgdG8gdXNlIGRlZmF1bHRcbiAgICogICAgIChGaWVsZENvbG91ci5DT0xPVVJTKS5cbiAgICogQHBhcmFtIG9wdF90aXRsZXMgT3B0aW9uYWwgYXJyYXkgb2YgY29sb3VyIHRvb2x0aXBzLCBvciBudWxsIHRvIHVzZSBkZWZhdWx0XG4gICAqICAgICAoRmllbGRDb2xvdXIuVElUTEVTKS5cbiAgICogQHJldHVybnMgUmV0dXJucyBpdHNlbGYgKGZvciBtZXRob2QgY2hhaW5pbmcpLlxuICAgKi9cbiAgc2V0Q29sb3Vycyhjb2xvdXJzOiBzdHJpbmdbXSwgb3B0X3RpdGxlcz86IHN0cmluZ1tdKTogRmllbGRDb2xvdXIge1xuICAgIHRoaXMuY29sb3Vyc18gPSBjb2xvdXJzO1xuICAgIGlmIChvcHRfdGl0bGVzKSB7XG4gICAgICB0aGlzLnRpdGxlc18gPSBvcHRfdGl0bGVzO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgYSBjdXN0b20gZ3JpZCBzaXplIGZvciB0aGlzIGZpZWxkLlxuICAgKlxuICAgKiBAcGFyYW0gY29sdW1ucyBOdW1iZXIgb2YgY29sdW1ucyBmb3IgdGhpcyBibG9jaywgb3IgMCB0byB1c2UgZGVmYXVsdFxuICAgKiAgICAgKEZpZWxkQ29sb3VyLkNPTFVNTlMpLlxuICAgKiBAcmV0dXJucyBSZXR1cm5zIGl0c2VsZiAoZm9yIG1ldGhvZCBjaGFpbmluZykuXG4gICAqL1xuICBzZXRDb2x1bW5zKGNvbHVtbnM6IG51bWJlcik6IEZpZWxkQ29sb3VyIHtcbiAgICB0aGlzLmNvbHVtbnNfID0gY29sdW1ucztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKiBDcmVhdGUgYW5kIHNob3cgdGhlIGNvbG91ciBmaWVsZCdzIGVkaXRvci4gKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIHNob3dFZGl0b3JfKCkge1xuICAgIHRoaXMuZHJvcGRvd25DcmVhdGVfKCk7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICdFbGVtZW50IHwgbnVsbCcgaXMgbm90XG4gICAgLy8gYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnTm9kZScuXG4gICAgZHJvcERvd25EaXYuZ2V0Q29udGVudERpdigpLmFwcGVuZENoaWxkKHRoaXMucGlja2VyXyBhcyBBbnlEdXJpbmdNaWdyYXRpb24pO1xuXG4gICAgZHJvcERvd25EaXYuc2hvd1Bvc2l0aW9uZWRCeUZpZWxkKHRoaXMsIHRoaXMuZHJvcGRvd25EaXNwb3NlXy5iaW5kKHRoaXMpKTtcblxuICAgIC8vIEZvY3VzIHNvIHdlIGNhbiBzdGFydCByZWNlaXZpbmcga2V5Ym9hcmQgZXZlbnRzLlxuICAgIC8vIEFueUR1cmluZ01pZ3JhdGlvbiBiZWNhdXNlOiAgUHJvcGVydHkgJ2ZvY3VzJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlXG4gICAgLy8gJ0VsZW1lbnQnLlxuICAgICh0aGlzLnBpY2tlcl8gYXMgQW55RHVyaW5nTWlncmF0aW9uKSEuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgYSBjbGljayBvbiBhIGNvbG91ciBjZWxsLlxuICAgKlxuICAgKiBAcGFyYW0gZSBNb3VzZSBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25DbGlja18oZTogUG9pbnRlckV2ZW50KSB7XG4gICAgY29uc3QgY2VsbCA9IGUudGFyZ2V0IGFzIEVsZW1lbnQ7XG4gICAgY29uc3QgY29sb3VyID0gY2VsbCAmJiBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb2xvdXInKTtcbiAgICBpZiAoY29sb3VyICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnNldFZhbHVlKGNvbG91cik7XG4gICAgICBkcm9wRG93bkRpdi5oaWRlSWZPd25lcih0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEga2V5IGRvd24gZXZlbnQuIE5hdmlnYXRlIGFyb3VuZCB0aGUgZ3JpZCB3aXRoIHRoZVxuICAgKiBhcnJvdyBrZXlzLiBFbnRlciBzZWxlY3RzIHRoZSBoaWdobGlnaHRlZCBjb2xvdXIuXG4gICAqXG4gICAqIEBwYXJhbSBlIEtleWJvYXJkIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBvbktleURvd25fKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBsZXQgaGFuZGxlZCA9IGZhbHNlO1xuICAgIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLlVQKSB7XG4gICAgICB0aGlzLm1vdmVIaWdobGlnaHRCeV8oMCwgLTEpO1xuICAgICAgaGFuZGxlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLkRPV04pIHtcbiAgICAgIHRoaXMubW92ZUhpZ2hsaWdodEJ5XygwLCAxKTtcbiAgICAgIGhhbmRsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5MRUZUKSB7XG4gICAgICB0aGlzLm1vdmVIaWdobGlnaHRCeV8oLTEsIDApO1xuICAgICAgaGFuZGxlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLlJJR0hUKSB7XG4gICAgICB0aGlzLm1vdmVIaWdobGlnaHRCeV8oMSwgMCk7XG4gICAgICBoYW5kbGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuRU5URVIpIHtcbiAgICAgIC8vIFNlbGVjdCB0aGUgaGlnaGxpZ2h0ZWQgY29sb3VyLlxuICAgICAgY29uc3QgaGlnaGxpZ2h0ZWQgPSB0aGlzLmdldEhpZ2hsaWdodGVkXygpO1xuICAgICAgaWYgKGhpZ2hsaWdodGVkKSB7XG4gICAgICAgIGNvbnN0IGNvbG91ciA9IGhpZ2hsaWdodGVkICYmIGhpZ2hsaWdodGVkLmdldEF0dHJpYnV0ZSgnZGF0YS1jb2xvdXInKTtcbiAgICAgICAgaWYgKGNvbG91ciAhPT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuc2V0VmFsdWUoY29sb3VyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZHJvcERvd25EaXYuaGlkZVdpdGhvdXRBbmltYXRpb24oKTtcbiAgICAgIGhhbmRsZWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoaGFuZGxlZCkge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgY3VycmVudGx5IGhpZ2hsaWdodGVkIHBvc2l0aW9uIGJ5IGR4IGFuZCBkeS5cbiAgICpcbiAgICogQHBhcmFtIGR4IENoYW5nZSBvZiB4XG4gICAqIEBwYXJhbSBkeSBDaGFuZ2Ugb2YgeVxuICAgKi9cbiAgcHJpdmF0ZSBtb3ZlSGlnaGxpZ2h0QnlfKGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcbiAgICBpZiAoIXRoaXMuaGlnaGxpZ2h0ZWRJbmRleF8pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjb2xvdXJzID0gdGhpcy5jb2xvdXJzXyB8fCBGaWVsZENvbG91ci5DT0xPVVJTO1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnNfIHx8IEZpZWxkQ29sb3VyLkNPTFVNTlM7XG5cbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgeCBhbmQgeSBjb29yZGluYXRlc1xuICAgIGxldCB4ID0gdGhpcy5oaWdobGlnaHRlZEluZGV4XyAlIGNvbHVtbnM7XG4gICAgbGV0IHkgPSBNYXRoLmZsb29yKHRoaXMuaGlnaGxpZ2h0ZWRJbmRleF8gLyBjb2x1bW5zKTtcblxuICAgIC8vIEFkZCB0aGUgb2Zmc2V0XG4gICAgeCArPSBkeDtcbiAgICB5ICs9IGR5O1xuXG4gICAgaWYgKGR4IDwgMCkge1xuICAgICAgLy8gTW92ZSBsZWZ0IG9uZSBncmlkIGNlbGwsIGV2ZW4gaW4gUlRMLlxuICAgICAgLy8gTG9vcCBiYWNrIHRvIHRoZSBlbmQgb2YgdGhlIHByZXZpb3VzIHJvdyBpZiB3ZSBoYXZlIHJvb20uXG4gICAgICBpZiAoeCA8IDAgJiYgeSA+IDApIHtcbiAgICAgICAgeCA9IGNvbHVtbnMgLSAxO1xuICAgICAgICB5LS07XG4gICAgICB9IGVsc2UgaWYgKHggPCAwKSB7XG4gICAgICAgIHggPSAwO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZHggPiAwKSB7XG4gICAgICAvLyBNb3ZlIHJpZ2h0IG9uZSBncmlkIGNlbGwsIGV2ZW4gaW4gUlRMLlxuICAgICAgLy8gTG9vcCB0byB0aGUgc3RhcnQgb2YgdGhlIG5leHQgcm93LCBpZiB0aGVyZSdzIHJvb20uXG4gICAgICBpZiAoeCA+IGNvbHVtbnMgLSAxICYmIHkgPCBNYXRoLmZsb29yKGNvbG91cnMubGVuZ3RoIC8gY29sdW1ucykgLSAxKSB7XG4gICAgICAgIHggPSAwO1xuICAgICAgICB5Kys7XG4gICAgICB9IGVsc2UgaWYgKHggPiBjb2x1bW5zIC0gMSkge1xuICAgICAgICB4LS07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkeSA8IDApIHtcbiAgICAgIC8vIE1vdmUgdXAgb25lIGdyaWQgY2VsbCwgc3RvcCBhdCB0aGUgdG9wLlxuICAgICAgaWYgKHkgPCAwKSB7XG4gICAgICAgIHkgPSAwO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZHkgPiAwKSB7XG4gICAgICAvLyBNb3ZlIGRvd24gb25lIGdyaWQgY2VsbCwgc3RvcCBhdCB0aGUgYm90dG9tLlxuICAgICAgaWYgKHkgPiBNYXRoLmZsb29yKGNvbG91cnMubGVuZ3RoIC8gY29sdW1ucykgLSAxKSB7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKGNvbG91cnMubGVuZ3RoIC8gY29sdW1ucykgLSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1vdmUgdGhlIGhpZ2hsaWdodCB0byB0aGUgbmV3IGNvb3JkaW5hdGVzLlxuICAgIGNvbnN0IGNlbGwgPSB0aGlzLnBpY2tlcl8hLmNoaWxkTm9kZXNbeV0uY2hpbGROb2Rlc1t4XSBhcyBFbGVtZW50O1xuICAgIGNvbnN0IGluZGV4ID0geSAqIGNvbHVtbnMgKyB4O1xuICAgIHRoaXMuc2V0SGlnaGxpZ2h0ZWRDZWxsXyhjZWxsLCBpbmRleCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgbW91c2UgbW92ZSBldmVudC4gSGlnaGxpZ2h0IHRoZSBob3ZlcmVkIGNvbG91ci5cbiAgICpcbiAgICogQHBhcmFtIGUgTW91c2UgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIG9uTW91c2VNb3ZlXyhlOiBQb2ludGVyRXZlbnQpIHtcbiAgICBjb25zdCBjZWxsID0gZS50YXJnZXQgYXMgRWxlbWVudDtcbiAgICBjb25zdCBpbmRleCA9IGNlbGwgJiYgTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLWluZGV4JykpO1xuICAgIGlmIChpbmRleCAhPT0gbnVsbCAmJiBpbmRleCAhPT0gdGhpcy5oaWdobGlnaHRlZEluZGV4Xykge1xuICAgICAgdGhpcy5zZXRIaWdobGlnaHRlZENlbGxfKGNlbGwsIGluZGV4KTtcbiAgICB9XG4gIH1cblxuICAvKiogSGFuZGxlIGEgbW91c2UgZW50ZXIgZXZlbnQuIEZvY3VzIHRoZSBwaWNrZXIuICovXG4gIHByaXZhdGUgb25Nb3VzZUVudGVyXygpIHtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIFByb3BlcnR5ICdmb2N1cycgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICdFbGVtZW50Jy5cbiAgICAodGhpcy5waWNrZXJfIGFzIEFueUR1cmluZ01pZ3JhdGlvbikhLmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGEgbW91c2UgbGVhdmUgZXZlbnQuIEJsdXIgdGhlIHBpY2tlciBhbmQgdW5oaWdobGlnaHRcbiAgICogdGhlIGN1cnJlbnRseSBoaWdobGlnaHRlZCBjb2xvdXIuXG4gICAqL1xuICBwcml2YXRlIG9uTW91c2VMZWF2ZV8oKSB7XG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBQcm9wZXJ0eSAnYmx1cicgZG9lcyBub3QgZXhpc3Qgb24gdHlwZVxuICAgIC8vICdFbGVtZW50Jy5cbiAgICAodGhpcy5waWNrZXJfIGFzIEFueUR1cmluZ01pZ3JhdGlvbikhLmJsdXIoKTtcbiAgICBjb25zdCBoaWdobGlnaHRlZCA9IHRoaXMuZ2V0SGlnaGxpZ2h0ZWRfKCk7XG4gICAgaWYgKGhpZ2hsaWdodGVkKSB7XG4gICAgICBkb20ucmVtb3ZlQ2xhc3MoaGlnaGxpZ2h0ZWQsICdibG9ja2x5Q29sb3VySGlnaGxpZ2h0ZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY3VycmVudGx5IGhpZ2hsaWdodGVkIGl0ZW0gKGlmIGFueSkuXG4gICAqXG4gICAqIEByZXR1cm5zIEhpZ2hsaWdodGVkIGl0ZW0gKG51bGwgaWYgbm9uZSkuXG4gICAqL1xuICBwcml2YXRlIGdldEhpZ2hsaWdodGVkXygpOiBIVE1MRWxlbWVudHxudWxsIHtcbiAgICBpZiAoIXRoaXMuaGlnaGxpZ2h0ZWRJbmRleF8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnNfIHx8IEZpZWxkQ29sb3VyLkNPTFVNTlM7XG4gICAgY29uc3QgeCA9IHRoaXMuaGlnaGxpZ2h0ZWRJbmRleF8gJSBjb2x1bW5zO1xuICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKHRoaXMuaGlnaGxpZ2h0ZWRJbmRleF8gLyBjb2x1bW5zKTtcbiAgICBjb25zdCByb3cgPSB0aGlzLnBpY2tlcl8hLmNoaWxkTm9kZXNbeV07XG4gICAgaWYgKCFyb3cpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBjb2wgPSByb3cuY2hpbGROb2Rlc1t4XSBhcyBIVE1MRWxlbWVudDtcbiAgICByZXR1cm4gY29sO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY3VycmVudGx5IGhpZ2hsaWdodGVkIGNlbGwuXG4gICAqXG4gICAqIEBwYXJhbSBjZWxsIHRoZSBuZXcgY2VsbCB0byBoaWdobGlnaHRcbiAgICogQHBhcmFtIGluZGV4IHRoZSBpbmRleCBvZiB0aGUgbmV3IGNlbGxcbiAgICovXG4gIHByaXZhdGUgc2V0SGlnaGxpZ2h0ZWRDZWxsXyhjZWxsOiBFbGVtZW50LCBpbmRleDogbnVtYmVyKSB7XG4gICAgLy8gVW5oaWdobGlnaHQgdGhlIGN1cnJlbnQgaXRlbS5cbiAgICBjb25zdCBoaWdobGlnaHRlZCA9IHRoaXMuZ2V0SGlnaGxpZ2h0ZWRfKCk7XG4gICAgaWYgKGhpZ2hsaWdodGVkKSB7XG4gICAgICBkb20ucmVtb3ZlQ2xhc3MoaGlnaGxpZ2h0ZWQsICdibG9ja2x5Q29sb3VySGlnaGxpZ2h0ZWQnKTtcbiAgICB9XG4gICAgLy8gSGlnaGxpZ2h0IG5ldyBpdGVtLlxuICAgIGRvbS5hZGRDbGFzcyhjZWxsLCAnYmxvY2tseUNvbG91ckhpZ2hsaWdodGVkJyk7XG4gICAgLy8gU2V0IG5ldyBoaWdobGlnaHRlZCBpbmRleC5cbiAgICB0aGlzLmhpZ2hsaWdodGVkSW5kZXhfID0gaW5kZXg7XG5cbiAgICAvLyBVcGRhdGUgYWNjZXNzaWJpbGl0eSByb2xlcy5cbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ3N0cmluZyB8IG51bGwnIGlzIG5vdFxuICAgIC8vIGFzc2lnbmFibGUgdG8gcGFyYW1ldGVyIG9mIHR5cGUgJ3N0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBzdHJpbmdbXScuXG4gICAgYXJpYS5zZXRTdGF0ZShcbiAgICAgICAgdGhpcy5waWNrZXJfIGFzIEVsZW1lbnQsIGFyaWEuU3RhdGUuQUNUSVZFREVTQ0VOREFOVCxcbiAgICAgICAgY2VsbC5nZXRBdHRyaWJ1dGUoJ2lkJykgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgfVxuXG4gIC8qKiBDcmVhdGUgYSBjb2xvdXIgcGlja2VyIGRyb3Bkb3duIGVkaXRvci4gKi9cbiAgcHJpdmF0ZSBkcm9wZG93bkNyZWF0ZV8oKSB7XG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29sdW1uc18gfHwgRmllbGRDb2xvdXIuQ09MVU1OUztcbiAgICBjb25zdCBjb2xvdXJzID0gdGhpcy5jb2xvdXJzXyB8fCBGaWVsZENvbG91ci5DT0xPVVJTO1xuICAgIGNvbnN0IHRpdGxlcyA9IHRoaXMudGl0bGVzXyB8fCBGaWVsZENvbG91ci5USVRMRVM7XG4gICAgY29uc3Qgc2VsZWN0ZWRDb2xvdXIgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgLy8gQ3JlYXRlIHRoZSBwYWxldHRlLlxuICAgIGNvbnN0IHRhYmxlID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJykpO1xuICAgIHRhYmxlLmNsYXNzTmFtZSA9ICdibG9ja2x5Q29sb3VyVGFibGUnO1xuICAgIHRhYmxlLnRhYkluZGV4ID0gMDtcbiAgICB0YWJsZS5kaXIgPSAnbHRyJztcbiAgICBhcmlhLnNldFJvbGUodGFibGUsIGFyaWEuUm9sZS5HUklEKTtcbiAgICBhcmlhLnNldFN0YXRlKHRhYmxlLCBhcmlhLlN0YXRlLkVYUEFOREVELCB0cnVlKTtcbiAgICBhcmlhLnNldFN0YXRlKFxuICAgICAgICB0YWJsZSwgYXJpYS5TdGF0ZS5ST1dDT1VOVCwgTWF0aC5mbG9vcihjb2xvdXJzLmxlbmd0aCAvIGNvbHVtbnMpKTtcbiAgICBhcmlhLnNldFN0YXRlKHRhYmxlLCBhcmlhLlN0YXRlLkNPTENPVU5ULCBjb2x1bW5zKTtcbiAgICBsZXQgcm93OiBFbGVtZW50O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgJSBjb2x1bW5zID09PSAwKSB7XG4gICAgICAgIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgICAgIGFyaWEuc2V0Um9sZShyb3csIGFyaWEuUm9sZS5ST1cpO1xuICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChyb3cpO1xuICAgICAgfVxuICAgICAgY29uc3QgY2VsbCA9IChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpKTtcbiAgICAgIHJvdyEuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICAvLyBUaGlzIGJlY29tZXMgdGhlIHZhbHVlLCBpZiBjbGlja2VkLlxuICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29sb3VyJywgY29sb3Vyc1tpXSk7XG4gICAgICBjZWxsLnRpdGxlID0gdGl0bGVzW2ldIHx8IGNvbG91cnNbaV07XG4gICAgICBjZWxsLmlkID0gaWRHZW5lcmF0b3IuZ2V0TmV4dFVuaXF1ZUlkKCk7XG4gICAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90XG4gICAgICAvLyBhc3NpZ25hYmxlIHRvIHBhcmFtZXRlciBvZiB0eXBlICdzdHJpbmcnLlxuICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnLCBpIGFzIEFueUR1cmluZ01pZ3JhdGlvbik7XG4gICAgICBhcmlhLnNldFJvbGUoY2VsbCwgYXJpYS5Sb2xlLkdSSURDRUxMKTtcbiAgICAgIGFyaWEuc2V0U3RhdGUoY2VsbCwgYXJpYS5TdGF0ZS5MQUJFTCwgY29sb3Vyc1tpXSk7XG4gICAgICBhcmlhLnNldFN0YXRlKGNlbGwsIGFyaWEuU3RhdGUuU0VMRUNURUQsIGNvbG91cnNbaV0gPT09IHNlbGVjdGVkQ29sb3VyKTtcbiAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3Vyc1tpXTtcbiAgICAgIGlmIChjb2xvdXJzW2ldID09PSBzZWxlY3RlZENvbG91cikge1xuICAgICAgICBjZWxsLmNsYXNzTmFtZSA9ICdibG9ja2x5Q29sb3VyU2VsZWN0ZWQnO1xuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkSW5kZXhfID0gaTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb25maWd1cmUgZXZlbnQgaGFuZGxlciBvbiB0aGUgdGFibGUgdG8gbGlzdGVuIGZvciBhbnkgZXZlbnQgaW4gYSBjZWxsLlxuICAgIHRoaXMub25DbGlja1dyYXBwZXJfID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIHRhYmxlLCAncG9pbnRlcmRvd24nLCB0aGlzLCB0aGlzLm9uQ2xpY2tfLCB0cnVlKTtcbiAgICB0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgdGFibGUsICdwb2ludGVybW92ZScsIHRoaXMsIHRoaXMub25Nb3VzZU1vdmVfLCB0cnVlKTtcbiAgICB0aGlzLm9uTW91c2VFbnRlcldyYXBwZXJfID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIHRhYmxlLCAncG9pbnRlcmVudGVyJywgdGhpcywgdGhpcy5vbk1vdXNlRW50ZXJfLCB0cnVlKTtcbiAgICB0aGlzLm9uTW91c2VMZWF2ZVdyYXBwZXJfID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIHRhYmxlLCAncG9pbnRlcmxlYXZlJywgdGhpcywgdGhpcy5vbk1vdXNlTGVhdmVfLCB0cnVlKTtcbiAgICB0aGlzLm9uS2V5RG93bldyYXBwZXJfID1cbiAgICAgICAgYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQodGFibGUsICdrZXlkb3duJywgdGhpcywgdGhpcy5vbktleURvd25fKTtcblxuICAgIHRoaXMucGlja2VyXyA9IHRhYmxlO1xuICB9XG5cbiAgLyoqIERpc3Bvc2VzIG9mIGV2ZW50cyBhbmQgRE9NLXJlZmVyZW5jZXMgYmVsb25naW5nIHRvIHRoZSBjb2xvdXIgZWRpdG9yLiAqL1xuICBwcml2YXRlIGRyb3Bkb3duRGlzcG9zZV8oKSB7XG4gICAgaWYgKHRoaXMub25DbGlja1dyYXBwZXJfKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uQ2xpY2tXcmFwcGVyXyk7XG4gICAgICB0aGlzLm9uQ2xpY2tXcmFwcGVyXyA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25Nb3VzZU1vdmVXcmFwcGVyXyk7XG4gICAgICB0aGlzLm9uTW91c2VNb3ZlV3JhcHBlcl8gPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5vbk1vdXNlRW50ZXJXcmFwcGVyXykge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5vbk1vdXNlRW50ZXJXcmFwcGVyXyk7XG4gICAgICB0aGlzLm9uTW91c2VFbnRlcldyYXBwZXJfID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMub25Nb3VzZUxlYXZlV3JhcHBlcl8pIHtcbiAgICAgIGJyb3dzZXJFdmVudHMudW5iaW5kKHRoaXMub25Nb3VzZUxlYXZlV3JhcHBlcl8pO1xuICAgICAgdGhpcy5vbk1vdXNlTGVhdmVXcmFwcGVyXyA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uS2V5RG93bldyYXBwZXJfKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm9uS2V5RG93bldyYXBwZXJfKTtcbiAgICAgIHRoaXMub25LZXlEb3duV3JhcHBlcl8gPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnBpY2tlcl8gPSBudWxsO1xuICAgIHRoaXMuaGlnaGxpZ2h0ZWRJbmRleF8gPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdCBhIEZpZWxkQ29sb3VyIGZyb20gYSBKU09OIGFyZyBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIEEgSlNPTiBvYmplY3Qgd2l0aCBvcHRpb25zIChjb2xvdXIpLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihvcHRpb25zOiBGaWVsZENvbG91ckZyb21Kc29uQ29uZmlnKTogRmllbGRDb2xvdXIge1xuICAgIC8vIGB0aGlzYCBtaWdodCBiZSBhIHN1YmNsYXNzIG9mIEZpZWxkQ29sb3VyIGlmIHRoYXQgY2xhc3MgZG9lc24ndCBvdmVycmlkZVxuICAgIC8vIHRoZSBzdGF0aWMgZnJvbUpzb24gbWV0aG9kLlxuICAgIHJldHVybiBuZXcgdGhpcyhvcHRpb25zWydjb2xvdXInXSwgdW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgfVxufVxuXG4vKiogVGhlIGRlZmF1bHQgdmFsdWUgZm9yIHRoaXMgZmllbGQuICovXG5GaWVsZENvbG91ci5wcm90b3R5cGUuREVGQVVMVF9WQUxVRSA9IEZpZWxkQ29sb3VyLkNPTE9VUlNbMF07XG5cbi8qKiBDU1MgZm9yIGNvbG91ciBwaWNrZXIuICBTZWUgY3NzLmpzIGZvciB1c2UuICovXG5Dc3MucmVnaXN0ZXIoYFxuLmJsb2NrbHlDb2xvdXJUYWJsZSB7XG4gIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBvdXRsaW5lOiBub25lO1xuICBwYWRkaW5nOiAxcHg7XG59XG5cbi5ibG9ja2x5Q29sb3VyVGFibGU+dHI+dGQge1xuICBib3JkZXI6IC41cHggc29saWQgIzg4ODtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIGhlaWdodDogMjBweDtcbiAgcGFkZGluZzogMDtcbiAgd2lkdGg6IDIwcHg7XG59XG5cbi5ibG9ja2x5Q29sb3VyVGFibGU+dHI+dGQuYmxvY2tseUNvbG91ckhpZ2hsaWdodGVkIHtcbiAgYm9yZGVyLWNvbG9yOiAjZWVlO1xuICBib3gtc2hhZG93OiAycHggMnB4IDdweCAycHggcmdiYSgwLDAsMCwuMyk7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbn1cblxuLmJsb2NrbHlDb2xvdXJTZWxlY3RlZCwgLmJsb2NrbHlDb2xvdXJTZWxlY3RlZDpob3ZlciB7XG4gIGJvcmRlci1jb2xvcjogI2VlZSAhaW1wb3J0YW50O1xuICBvdXRsaW5lOiAxcHggc29saWQgIzMzMztcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xufVxuYCk7XG5cbmZpZWxkUmVnaXN0cnkucmVnaXN0ZXIoJ2ZpZWxkX2NvbG91cicsIEZpZWxkQ29sb3VyKTtcblxuLyoqXG4gKiBDb25maWcgb3B0aW9ucyBmb3IgdGhlIGNvbG91ciBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZENvbG91ckNvbmZpZyBleHRlbmRzIEZpZWxkQ29uZmlnIHtcbiAgY29sb3VyT3B0aW9ucz86IHN0cmluZ1tdO1xuICBjb2xvdXJUaXRsZXM/OiBzdHJpbmdbXTtcbiAgY29sdW1ucz86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBmcm9tSnNvbiBjb25maWcgb3B0aW9ucyBmb3IgdGhlIGNvbG91ciBmaWVsZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGaWVsZENvbG91ckZyb21Kc29uQ29uZmlnIGV4dGVuZHMgRmllbGRDb2xvdXJDb25maWcge1xuICBjb2xvdXI/OiBzdHJpbmc7XG59XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2hlY2tib3ggZmllbGQuICBDaGVja2VkIG9yIG5vdCBjaGVja2VkLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkZpZWxkQ2hlY2tib3gnKTtcblxuLy8gVW51c2VkIGltcG9ydCBwcmVzZXJ2ZWQgZm9yIHNpZGUtZWZmZWN0cy4gUmVtb3ZlIGlmIHVubmVlZGVkLlxuaW1wb3J0ICcuL2V2ZW50cy9ldmVudHNfYmxvY2tfY2hhbmdlLmpzJztcblxuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7RmllbGQsIEZpZWxkQ29uZmlnLCBGaWVsZFZhbGlkYXRvcn0gZnJvbSAnLi9maWVsZC5qcyc7XG5pbXBvcnQgKiBhcyBmaWVsZFJlZ2lzdHJ5IGZyb20gJy4vZmllbGRfcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge1NlbnRpbmVsfSBmcm9tICcuL3V0aWxzL3NlbnRpbmVsLmpzJztcblxuZXhwb3J0IHR5cGUgRmllbGRDaGVja2JveFZhbGlkYXRvciA9IEZpZWxkVmFsaWRhdG9yPGJvb2xlYW4+O1xuXG4vKipcbiAqIENsYXNzIGZvciBhIGNoZWNrYm94IGZpZWxkLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkZpZWxkQ2hlY2tib3hcbiAqL1xuZXhwb3J0IGNsYXNzIEZpZWxkQ2hlY2tib3ggZXh0ZW5kcyBGaWVsZDxib29sZWFuPiB7XG4gIC8qKiBEZWZhdWx0IGNoYXJhY3RlciBmb3IgdGhlIGNoZWNrbWFyay4gKi9cbiAgc3RhdGljIHJlYWRvbmx5IENIRUNLX0NIQVIgPSAn4pyTJztcbiAgcHJpdmF0ZSBjaGVja0NoYXJfOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6YWJsZSBmaWVsZHMgYXJlIHNhdmVkIGJ5IHRoZSBzZXJpYWxpemVyLCBub24tc2VyaWFsaXphYmxlIGZpZWxkc1xuICAgKiBhcmUgbm90LiBFZGl0YWJsZSBmaWVsZHMgc2hvdWxkIGFsc28gYmUgc2VyaWFsaXphYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgU0VSSUFMSVpBQkxFID0gdHJ1ZTtcblxuICAvKipcbiAgICogTW91c2UgY3Vyc29yIHN0eWxlIHdoZW4gb3ZlciB0aGUgaG90c3BvdCB0aGF0IGluaXRpYXRlcyBlZGl0YWJpbGl0eS5cbiAgICovXG4gIG92ZXJyaWRlIENVUlNPUiA9ICdkZWZhdWx0JztcbiAgb3ZlcnJpZGUgdmFsdWVfOiBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfdmFsdWUgVGhlIGluaXRpYWwgdmFsdWUgb2YgdGhlIGZpZWxkLiBTaG91bGQgZWl0aGVyIGJlICdUUlVFJyxcbiAgICogICAgICdGQUxTRScgb3IgYSBib29sZWFuLiBEZWZhdWx0cyB0byAnRkFMU0UnLiBBbHNvIGFjY2VwdHNcbiAgICogICAgIEZpZWxkLlNLSVBfU0VUVVAgaWYgeW91IHdpc2ggdG8gc2tpcCBzZXR1cCAob25seSB1c2VkIGJ5IHN1YmNsYXNzZXNcbiAgICogICAgIHRoYXQgd2FudCB0byBoYW5kbGUgY29uZmlndXJhdGlvbiBhbmQgc2V0dGluZyB0aGUgZmllbGQgdmFsdWUgYWZ0ZXJcbiAgICogICAgIHRoZWlyIG93biBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4pLlxuICAgKiBAcGFyYW0gb3B0X3ZhbGlkYXRvciAgQSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB0byB2YWxpZGF0ZSBjaGFuZ2VzIHRvIHRoZVxuICAgKiAgICAgZmllbGQncyB2YWx1ZS4gVGFrZXMgaW4gYSB2YWx1ZSAoJ1RSVUUnIG9yICdGQUxTRScpICYgcmV0dXJucyBhXG4gICAqICAgICB2YWxpZGF0ZWQgdmFsdWUgKCdUUlVFJyBvciAnRkFMU0UnKSwgb3IgbnVsbCB0byBhYm9ydCB0aGUgY2hhbmdlLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvY2hlY2tib3gjY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X3ZhbHVlPzogc3RyaW5nfGJvb2xlYW58U2VudGluZWwsXG4gICAgICBvcHRfdmFsaWRhdG9yPzogRmllbGRDaGVja2JveFZhbGlkYXRvcixcbiAgICAgIG9wdF9jb25maWc/OiBGaWVsZENoZWNrYm94Q29uZmlnKSB7XG4gICAgc3VwZXIoRmllbGQuU0tJUF9TRVRVUCk7XG5cbiAgICAvKipcbiAgICAgKiBDaGFyYWN0ZXIgZm9yIHRoZSBjaGVjayBtYXJrLiBVc2VkIHRvIGFwcGx5IGEgZGlmZmVyZW50IGNoZWNrIG1hcmtcbiAgICAgKiBjaGFyYWN0ZXIgdG8gaW5kaXZpZHVhbCBmaWVsZHMuXG4gICAgICovXG4gICAgdGhpcy5jaGVja0NoYXJfID0gRmllbGRDaGVja2JveC5DSEVDS19DSEFSO1xuXG4gICAgaWYgKG9wdF92YWx1ZSA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKG9wdF92YWx1ZSk7XG4gICAgaWYgKG9wdF92YWxpZGF0b3IpIHtcbiAgICAgIHRoaXMuc2V0VmFsaWRhdG9yKG9wdF92YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIGZpZWxkIGJhc2VkIG9uIHRoZSBnaXZlbiBtYXAgb2Ygb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGNvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQgYmFzZWQgb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY29uZmlndXJlXyhjb25maWc6IEZpZWxkQ2hlY2tib3hDb25maWcpIHtcbiAgICBzdXBlci5jb25maWd1cmVfKGNvbmZpZyk7XG4gICAgaWYgKGNvbmZpZy5jaGVja0NoYXJhY3RlcikgdGhpcy5jaGVja0NoYXJfID0gY29uZmlnLmNoZWNrQ2hhcmFjdGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIFNhdmVzIHRoaXMgZmllbGQncyB2YWx1ZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGJvb2xlYW4gdmFsdWUgaGVsZCBieSB0aGlzIGZpZWxkLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG92ZXJyaWRlIHNhdmVTdGF0ZSgpOiBBbnlEdXJpbmdNaWdyYXRpb24ge1xuICAgIGNvbnN0IGxlZ2FjeVN0YXRlID0gdGhpcy5zYXZlTGVnYWN5U3RhdGUoRmllbGRDaGVja2JveCk7XG4gICAgaWYgKGxlZ2FjeVN0YXRlICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbGVnYWN5U3RhdGU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdldFZhbHVlQm9vbGVhbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmxvY2sgVUkgZm9yIHRoaXMgY2hlY2tib3guXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgaW5pdFZpZXcoKSB7XG4gICAgc3VwZXIuaW5pdFZpZXcoKTtcblxuICAgIGNvbnN0IHRleHRFbGVtZW50ID0gdGhpcy5nZXRUZXh0RWxlbWVudCgpO1xuICAgIGRvbS5hZGRDbGFzcyh0ZXh0RWxlbWVudCwgJ2Jsb2NrbHlDaGVja2JveCcpO1xuICAgIHRleHRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSB0aGlzLnZhbHVlXyA/ICdibG9jaycgOiAnbm9uZSc7XG4gIH1cblxuICBvdmVycmlkZSByZW5kZXJfKCkge1xuICAgIGlmICh0aGlzLnRleHRDb250ZW50Xykge1xuICAgICAgdGhpcy50ZXh0Q29udGVudF8ubm9kZVZhbHVlID0gdGhpcy5nZXREaXNwbGF5VGV4dF8oKTtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVTaXplXyh0aGlzLmdldENvbnN0YW50cygpIS5GSUVMRF9DSEVDS0JPWF9YX09GRlNFVCk7XG4gIH1cblxuICBvdmVycmlkZSBnZXREaXNwbGF5VGV4dF8oKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hlY2tDaGFyXztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGNoYXJhY3RlciB1c2VkIGZvciB0aGUgY2hlY2sgbWFyay5cbiAgICpcbiAgICogQHBhcmFtIGNoYXJhY3RlciBUaGUgY2hhcmFjdGVyIHRvIHVzZSBmb3IgdGhlIGNoZWNrIG1hcmssIG9yIG51bGwgdG8gdXNlXG4gICAqICAgICB0aGUgZGVmYXVsdC5cbiAgICovXG4gIHNldENoZWNrQ2hhcmFjdGVyKGNoYXJhY3Rlcjogc3RyaW5nfG51bGwpIHtcbiAgICB0aGlzLmNoZWNrQ2hhcl8gPSBjaGFyYWN0ZXIgfHwgRmllbGRDaGVja2JveC5DSEVDS19DSEFSO1xuICAgIHRoaXMuZm9yY2VSZXJlbmRlcigpO1xuICB9XG5cbiAgLyoqIFRvZ2dsZSB0aGUgc3RhdGUgb2YgdGhlIGNoZWNrYm94IG9uIGNsaWNrLiAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgc2hvd0VkaXRvcl8oKSB7XG4gICAgdGhpcy5zZXRWYWx1ZSghdGhpcy52YWx1ZV8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuc3VyZSB0aGF0IHRoZSBpbnB1dCB2YWx1ZSBpcyB2YWxpZCAoJ1RSVUUnIG9yICdGQUxTRScpLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIFRoZSBpbnB1dCB2YWx1ZS5cbiAgICogQHJldHVybnMgQSB2YWxpZCB2YWx1ZSAoJ1RSVUUnIG9yICdGQUxTRSksIG9yIG51bGwgaWYgaW52YWxpZC5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBkb0NsYXNzVmFsaWRhdGlvbl8ob3B0X25ld1ZhbHVlPzogQW55RHVyaW5nTWlncmF0aW9uKTpcbiAgICAgIHN0cmluZ3xudWxsIHtcbiAgICBpZiAob3B0X25ld1ZhbHVlID09PSB0cnVlIHx8IG9wdF9uZXdWYWx1ZSA9PT0gJ1RSVUUnKSB7XG4gICAgICByZXR1cm4gJ1RSVUUnO1xuICAgIH1cbiAgICBpZiAob3B0X25ld1ZhbHVlID09PSBmYWxzZSB8fCBvcHRfbmV3VmFsdWUgPT09ICdGQUxTRScpIHtcbiAgICAgIHJldHVybiAnRkFMU0UnO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZCwgYW5kIHVwZGF0ZSB0aGUgY2hlY2tFbGVtZW50LlxuICAgKlxuICAgKiBAcGFyYW0gbmV3VmFsdWUgVGhlIHZhbHVlIHRvIGJlIHNhdmVkLiBUaGUgZGVmYXVsdCB2YWxpZGF0b3IgZ3VhcmFudGVlc1xuICAgKiAgICAgdGhhdCB0aGlzIGlzIGEgZWl0aGVyICdUUlVFJyBvciAnRkFMU0UnLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvVmFsdWVVcGRhdGVfKG5ld1ZhbHVlOiBBbnlEdXJpbmdNaWdyYXRpb24pIHtcbiAgICB0aGlzLnZhbHVlXyA9IHRoaXMuY29udmVydFZhbHVlVG9Cb29sXyhuZXdWYWx1ZSk7XG4gICAgLy8gVXBkYXRlIHZpc3VhbC5cbiAgICBpZiAodGhpcy50ZXh0RWxlbWVudF8pIHtcbiAgICAgIHRoaXMudGV4dEVsZW1lbnRfLnN0eWxlLmRpc3BsYXkgPSB0aGlzLnZhbHVlXyA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgdmFsdWUgb2YgdGhpcyBmaWVsZCwgZWl0aGVyICdUUlVFJyBvciAnRkFMU0UnLlxuICAgKlxuICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgb2YgdGhpcyBmaWVsZC5cbiAgICovXG4gIG92ZXJyaWRlIGdldFZhbHVlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVfID8gJ1RSVUUnIDogJ0ZBTFNFJztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGJvb2xlYW4gdmFsdWUgb2YgdGhpcyBmaWVsZC5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGJvb2xlYW4gdmFsdWUgb2YgdGhpcyBmaWVsZC5cbiAgICovXG4gIGdldFZhbHVlQm9vbGVhbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZV8gYXMgYm9vbGVhbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRleHQgb2YgdGhpcyBmaWVsZC4gVXNlZCB3aGVuIHRoZSBibG9jayBpcyBjb2xsYXBzZWQuXG4gICAqXG4gICAqIEByZXR1cm5zIFRleHQgcmVwcmVzZW50aW5nIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkICgndHJ1ZScgb3IgJ2ZhbHNlJykuXG4gICAqL1xuICBvdmVycmlkZSBnZXRUZXh0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFN0cmluZyh0aGlzLmNvbnZlcnRWYWx1ZVRvQm9vbF8odGhpcy52YWx1ZV8pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IGEgdmFsdWUgaW50byBhIHB1cmUgYm9vbGVhbi5cbiAgICpcbiAgICogQ29udmVydHMgJ1RSVUUnIHRvIHRydWUgYW5kICdGQUxTRScgdG8gZmFsc2UgY29ycmVjdGx5LCBldmVyeXRoaW5nIGVsc2VcbiAgICogaXMgY2FzdCB0byBhIGJvb2xlYW4uXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC5cbiAgICogQHJldHVybnMgVGhlIGNvbnZlcnRlZCB2YWx1ZS5cbiAgICovXG4gIHByaXZhdGUgY29udmVydFZhbHVlVG9Cb29sXyh2YWx1ZTogQW55RHVyaW5nTWlncmF0aW9uKTogYm9vbGVhbiB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gJ1RSVUUnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gISF2YWx1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29uc3RydWN0IGEgRmllbGRDaGVja2JveCBmcm9tIGEgSlNPTiBhcmcgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBBIEpTT04gb2JqZWN0IHdpdGggb3B0aW9ucyAoY2hlY2tlZCkuXG4gICAqIEByZXR1cm5zIFRoZSBuZXcgZmllbGQgaW5zdGFuY2UuXG4gICAqIEBub2NvbGxhcHNlXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKG9wdGlvbnM6IEZpZWxkQ2hlY2tib3hGcm9tSnNvbkNvbmZpZyk6IEZpZWxkQ2hlY2tib3gge1xuICAgIC8vIGB0aGlzYCBtaWdodCBiZSBhIHN1YmNsYXNzIG9mIEZpZWxkQ2hlY2tib3ggaWYgdGhhdCBjbGFzcyBkb2Vzbid0XG4gICAgLy8gJ292ZXJyaWRlJyB0aGUgc3RhdGljIGZyb21Kc29uIG1ldGhvZC5cbiAgICByZXR1cm4gbmV3IHRoaXMob3B0aW9ucy5jaGVja2VkLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICB9XG59XG5cbmZpZWxkUmVnaXN0cnkucmVnaXN0ZXIoJ2ZpZWxkX2NoZWNrYm94JywgRmllbGRDaGVja2JveCk7XG5cbkZpZWxkQ2hlY2tib3gucHJvdG90eXBlLkRFRkFVTFRfVkFMVUUgPSBmYWxzZTtcblxuLyoqXG4gKiBDb25maWcgb3B0aW9ucyBmb3IgdGhlIGNoZWNrYm94IGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkQ2hlY2tib3hDb25maWcgZXh0ZW5kcyBGaWVsZENvbmZpZyB7XG4gIGNoZWNrQ2hhcmFjdGVyPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIGZyb21Kc29uIGNvbmZpZyBvcHRpb25zIGZvciB0aGUgY2hlY2tib3ggZmllbGQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGRDaGVja2JveEZyb21Kc29uQ29uZmlnIGV4dGVuZHMgRmllbGRDaGVja2JveENvbmZpZyB7XG4gIGNoZWNrZWQ/OiBib29sZWFuO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTMgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEFuZ2xlIGlucHV0IGZpZWxkLlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkZpZWxkQW5nbGUnKTtcblxuaW1wb3J0IHtCbG9ja1N2Z30gZnJvbSAnLi9ibG9ja19zdmcuanMnO1xuaW1wb3J0ICogYXMgYnJvd3NlckV2ZW50cyBmcm9tICcuL2Jyb3dzZXJfZXZlbnRzLmpzJztcbmltcG9ydCAqIGFzIENzcyBmcm9tICcuL2Nzcy5qcyc7XG5pbXBvcnQgKiBhcyBkcm9wRG93bkRpdiBmcm9tICcuL2Ryb3Bkb3duZGl2LmpzJztcbmltcG9ydCB7RmllbGQsIFVuYXR0YWNoZWRGaWVsZEVycm9yfSBmcm9tICcuL2ZpZWxkLmpzJztcbmltcG9ydCAqIGFzIGZpZWxkUmVnaXN0cnkgZnJvbSAnLi9maWVsZF9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge0ZpZWxkSW5wdXQsIEZpZWxkSW5wdXRDb25maWcsIEZpZWxkSW5wdXRWYWxpZGF0b3J9IGZyb20gJy4vZmllbGRfaW5wdXQuanMnO1xuaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vdXRpbHMvZG9tLmpzJztcbmltcG9ydCB7S2V5Q29kZXN9IGZyb20gJy4vdXRpbHMva2V5Y29kZXMuanMnO1xuaW1wb3J0ICogYXMgbWF0aCBmcm9tICcuL3V0aWxzL21hdGguanMnO1xuaW1wb3J0IHR5cGUge1NlbnRpbmVsfSBmcm9tICcuL3V0aWxzL3NlbnRpbmVsLmpzJztcbmltcG9ydCB7U3ZnfSBmcm9tICcuL3V0aWxzL3N2Zy5qcyc7XG5pbXBvcnQgKiBhcyB1c2VyQWdlbnQgZnJvbSAnLi91dGlscy91c2VyYWdlbnQuanMnO1xuaW1wb3J0ICogYXMgV2lkZ2V0RGl2IGZyb20gJy4vd2lkZ2V0ZGl2LmpzJztcblxuZXhwb3J0IHR5cGUgRmllbGRBbmdsZVZhbGlkYXRvciA9IEZpZWxkSW5wdXRWYWxpZGF0b3I8bnVtYmVyPjtcblxuLyoqXG4gKiBDbGFzcyBmb3IgYW4gZWRpdGFibGUgYW5nbGUgZmllbGQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRmllbGRBbmdsZVxuICovXG5leHBvcnQgY2xhc3MgRmllbGRBbmdsZSBleHRlbmRzIEZpZWxkSW5wdXQ8bnVtYmVyPiB7XG4gIC8qKlxuICAgKiBUaGUgZGVmYXVsdCBhbW91bnQgdG8gcm91bmQgYW5nbGVzIHRvIHdoZW4gdXNpbmcgYSBtb3VzZSBvciBrZXlib2FyZCBuYXZcbiAgICogaW5wdXQuIE11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHRvIHN1cHBvcnQga2V5Ym9hcmQgbmF2aWdhdGlvbi5cbiAgICovXG4gIHN0YXRpYyByZWFkb25seSBST1VORCA9IDE1O1xuXG4gIC8qKiBIYWxmIHRoZSB3aWR0aCBvZiBwcm90cmFjdG9yIGltYWdlLiAqL1xuICBzdGF0aWMgcmVhZG9ubHkgSEFMRiA9IDEwMCAvIDI7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgcHJvcGVydHkgZGVzY3JpYmluZyB3aGljaCBkaXJlY3Rpb24gbWFrZXMgYW4gYW5nbGUgZmllbGQncyB2YWx1ZVxuICAgKiBpbmNyZWFzZS4gQW5nbGUgaW5jcmVhc2VzIGNsb2Nrd2lzZSAodHJ1ZSkgb3IgY291bnRlcmNsb2Nrd2lzZSAoZmFsc2UpLlxuICAgKi9cbiAgc3RhdGljIHJlYWRvbmx5IENMT0NLV0lTRSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgZGVmYXVsdCBvZmZzZXQgb2YgMCBkZWdyZWVzIChhbmQgYWxsIGFuZ2xlcykuIEFsd2F5cyBvZmZzZXRzIGluIHRoZVxuICAgKiBjb3VudGVyY2xvY2t3aXNlIGRpcmVjdGlvbiwgcmVnYXJkbGVzcyBvZiB0aGUgZmllbGQncyBjbG9ja3dpc2UgcHJvcGVydHkuXG4gICAqIFVzdWFsbHkgZWl0aGVyIDAgKDAgPSByaWdodCkgb3IgOTAgKDAgPSB1cCkuXG4gICAqL1xuICBzdGF0aWMgcmVhZG9ubHkgT0ZGU0VUID0gMDtcblxuICAvKipcbiAgICogVGhlIGRlZmF1bHQgbWF4aW11bSBhbmdsZSB0byBhbGxvdyBiZWZvcmUgd3JhcHBpbmcuXG4gICAqIFVzdWFsbHkgZWl0aGVyIDM2MCAoZm9yIDAgdG8gMzU5LjkpIG9yIDE4MCAoZm9yIC0xNzkuOSB0byAxODApLlxuICAgKi9cbiAgc3RhdGljIHJlYWRvbmx5IFdSQVAgPSAzNjA7XG5cbiAgLyoqXG4gICAqIFJhZGl1cyBvZiBwcm90cmFjdG9yIGNpcmNsZS4gIFNsaWdodGx5IHNtYWxsZXIgdGhhbiBwcm90cmFjdG9yIHNpemUgc2luY2VcbiAgICogb3RoZXJ3aXNlIFNWRyBjcm9wcyBvZmYgaGFsZiB0aGUgYm9yZGVyIGF0IHRoZSBlZGdlcy5cbiAgICovXG4gIHN0YXRpYyByZWFkb25seSBSQURJVVM6IG51bWJlciA9IEZpZWxkQW5nbGUuSEFMRiAtIDE7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGFuZ2xlIHNob3VsZCBpbmNyZWFzZSBhcyB0aGUgYW5nbGUgcGlja2VyIGlzIG1vdmVkIGNsb2Nrd2lzZVxuICAgKiAodHJ1ZSkgb3IgY291bnRlcmNsb2Nrd2lzZSAoZmFsc2UpLlxuICAgKi9cbiAgcHJpdmF0ZSBjbG9ja3dpc2VfID0gRmllbGRBbmdsZS5DTE9DS1dJU0U7XG5cbiAgLyoqXG4gICAqIFRoZSBvZmZzZXQgb2YgemVybyBkZWdyZWVzIChhbmQgYWxsIG90aGVyIGFuZ2xlcykuXG4gICAqL1xuICBwcml2YXRlIG9mZnNldF8gPSBGaWVsZEFuZ2xlLk9GRlNFVDtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gYW5nbGUgdG8gYWxsb3cgYmVmb3JlIHdyYXBwaW5nLlxuICAgKi9cbiAgcHJpdmF0ZSB3cmFwXyA9IEZpZWxkQW5nbGUuV1JBUDtcblxuICAvKipcbiAgICogVGhlIGFtb3VudCB0byByb3VuZCBhbmdsZXMgdG8gd2hlbiB1c2luZyBhIG1vdXNlIG9yIGtleWJvYXJkIG5hdiBpbnB1dC5cbiAgICovXG4gIHByaXZhdGUgcm91bmRfID0gRmllbGRBbmdsZS5ST1VORDtcblxuICAvKiogVGhlIGFuZ2xlIHBpY2tlcidzIFNWRyBlbGVtZW50LiAqL1xuICBwcml2YXRlIGVkaXRvcl86IFNWR1NWR0VsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBhbmdsZSBwaWNrZXIncyBnYXVnZSBwYXRoIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUuICovXG4gIGdhdWdlXzogU1ZHUGF0aEVsZW1lbnR8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFRoZSBhbmdsZSBwaWNrZXIncyBsaW5lIGRyYXduIHJlcHJlc2VudGluZyB0aGUgdmFsdWUncyBhbmdsZS4gKi9cbiAgbGluZV86IFNWR0xpbmVFbGVtZW50fG51bGwgPSBudWxsO1xuXG4gIC8qKiBUaGUgZGVncmVlIHN5bWJvbCBmb3IgdGhpcyBmaWVsZC4gKi9cbiAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBUeXBlICdudWxsJyBpcyBub3QgYXNzaWduYWJsZSB0byB0eXBlXG4gIC8vICdTVkdUU3BhbkVsZW1lbnQnLlxuICBwcm90ZWN0ZWQgc3ltYm9sXzogU1ZHVFNwYW5FbGVtZW50ID0gbnVsbCBhcyBBbnlEdXJpbmdNaWdyYXRpb247XG5cbiAgLyoqIFdyYXBwZXIgY2xpY2sgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBjbGlja1dyYXBwZXJfOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqIFN1cmZhY2UgY2xpY2sgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBjbGlja1N1cmZhY2VXcmFwcGVyXzogYnJvd3NlckV2ZW50cy5EYXRhfG51bGwgPSBudWxsO1xuXG4gIC8qKiBTdXJmYWNlIG1vdXNlIG1vdmUgZXZlbnQgZGF0YS4gKi9cbiAgcHJpdmF0ZSBtb3ZlU3VyZmFjZVdyYXBwZXJfOiBicm93c2VyRXZlbnRzLkRhdGF8bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6YWJsZSBmaWVsZHMgYXJlIHNhdmVkIGJ5IHRoZSBzZXJpYWxpemVyLCBub24tc2VyaWFsaXphYmxlIGZpZWxkc1xuICAgKiBhcmUgbm90LiBFZGl0YWJsZSBmaWVsZHMgc2hvdWxkIGFsc28gYmUgc2VyaWFsaXphYmxlLlxuICAgKi9cbiAgb3ZlcnJpZGUgU0VSSUFMSVpBQkxFID0gdHJ1ZTtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF92YWx1ZSBUaGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgZmllbGQuIFNob3VsZCBjYXN0IHRvIGEgbnVtYmVyLlxuICAgKiAgICAgRGVmYXVsdHMgdG8gMC4gQWxzbyBhY2NlcHRzIEZpZWxkLlNLSVBfU0VUVVAgaWYgeW91IHdpc2ggdG8gc2tpcCBzZXR1cFxuICAgKiAgICAgKG9ubHkgdXNlZCBieSBzdWJjbGFzc2VzIHRoYXQgd2FudCB0byBoYW5kbGUgY29uZmlndXJhdGlvbiBhbmQgc2V0dGluZ1xuICAgKiAgICAgdGhlIGZpZWxkIHZhbHVlIGFmdGVyIHRoZWlyIG93biBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4pLlxuICAgKiBAcGFyYW0gb3B0X3ZhbGlkYXRvciBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRvIHZhbGlkYXRlIGNoYW5nZXMgdG8gdGhlXG4gICAqICAgICBmaWVsZCdzIHZhbHVlLiBUYWtlcyBpbiBhIG51bWJlciAmIHJldHVybnMgYSB2YWxpZGF0ZWQgbnVtYmVyLCBvciBudWxsXG4gICAqICAgICB0byBhYm9ydCB0aGUgY2hhbmdlLlxuICAgKiBAcGFyYW0gb3B0X2NvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHVzZWQgdG8gY29uZmlndXJlIHRoZSBmaWVsZC5cbiAgICogICAgIFNlZSB0aGUgW2ZpZWxkIGNyZWF0aW9uIGRvY3VtZW50YXRpb25de0BsaW5rXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2ZpZWxkcy9idWlsdC1pbi1maWVsZHMvYW5nbGUjY3JlYXRpb259XG4gICAqIGZvciBhIGxpc3Qgb2YgcHJvcGVydGllcyB0aGlzIHBhcmFtZXRlciBzdXBwb3J0cy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgb3B0X3ZhbHVlPzogc3RyaW5nfG51bWJlcnxTZW50aW5lbCwgb3B0X3ZhbGlkYXRvcj86IEZpZWxkQW5nbGVWYWxpZGF0b3IsXG4gICAgICBvcHRfY29uZmlnPzogRmllbGRBbmdsZUNvbmZpZykge1xuICAgIHN1cGVyKEZpZWxkLlNLSVBfU0VUVVApO1xuXG4gICAgaWYgKG9wdF92YWx1ZSA9PT0gRmllbGQuU0tJUF9TRVRVUCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAob3B0X2NvbmZpZykge1xuICAgICAgdGhpcy5jb25maWd1cmVfKG9wdF9jb25maWcpO1xuICAgIH1cbiAgICB0aGlzLnNldFZhbHVlKG9wdF92YWx1ZSk7XG4gICAgaWYgKG9wdF92YWxpZGF0b3IpIHtcbiAgICAgIHRoaXMuc2V0VmFsaWRhdG9yKG9wdF92YWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIGZpZWxkIGJhc2VkIG9uIHRoZSBnaXZlbiBtYXAgb2Ygb3B0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGNvbmZpZyBBIG1hcCBvZiBvcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgZmllbGQgYmFzZWQgb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY29uZmlndXJlXyhjb25maWc6IEZpZWxkQW5nbGVDb25maWcpIHtcbiAgICBzdXBlci5jb25maWd1cmVfKGNvbmZpZyk7XG5cbiAgICBzd2l0Y2ggKGNvbmZpZy5tb2RlKSB7XG4gICAgICBjYXNlIE1vZGUuQ09NUEFTUzpcbiAgICAgICAgdGhpcy5jbG9ja3dpc2VfID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vZmZzZXRfID0gOTA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBNb2RlLlBST1RSQUNUT1I6XG4gICAgICAgIC8vIFRoaXMgaXMgdGhlIGRlZmF1bHQgbW9kZSwgc28gd2UgY291bGQgZG8gbm90aGluZy4gQnV0IGp1c3QgdG9cbiAgICAgICAgLy8gZnV0dXJlLXByb29mLCB3ZSdsbCBzZXQgaXQgYW55d2F5LlxuICAgICAgICB0aGlzLmNsb2Nrd2lzZV8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vZmZzZXRfID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gQWxsb3cgaW5kaXZpZHVhbCBzZXR0aW5ncyB0byBvdmVycmlkZSB0aGUgbW9kZSBzZXR0aW5nLlxuICAgIGlmIChjb25maWcuY2xvY2t3aXNlKSB0aGlzLmNsb2Nrd2lzZV8gPSBjb25maWcuY2xvY2t3aXNlO1xuICAgIGlmIChjb25maWcub2Zmc2V0KSB0aGlzLm9mZnNldF8gPSBjb25maWcub2Zmc2V0O1xuICAgIGlmIChjb25maWcud3JhcCkgdGhpcy53cmFwXyA9IGNvbmZpZy53cmFwO1xuICAgIGlmIChjb25maWcucm91bmQpIHRoaXMucm91bmRfID0gY29uZmlnLnJvdW5kO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmxvY2sgVUkgZm9yIHRoaXMgZmllbGQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgb3ZlcnJpZGUgaW5pdFZpZXcoKSB7XG4gICAgc3VwZXIuaW5pdFZpZXcoKTtcbiAgICAvLyBBZGQgdGhlIGRlZ3JlZSBzeW1ib2wgdG8gdGhlIGxlZnQgb2YgdGhlIG51bWJlciwgZXZlbiBpbiBSVEwgKGlzc3VlXG4gICAgLy8gIzIzODApXG4gICAgdGhpcy5zeW1ib2xfID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLlRTUEFOLCB7fSk7XG4gICAgdGhpcy5zeW1ib2xfLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCfCsCcpKTtcbiAgICB0aGlzLmdldFRleHRFbGVtZW50KCkuYXBwZW5kQ2hpbGQodGhpcy5zeW1ib2xfKTtcbiAgfVxuXG4gIC8qKiBVcGRhdGVzIHRoZSBncmFwaCB3aGVuIHRoZSBmaWVsZCByZXJlbmRlcnMuICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSByZW5kZXJfKCkge1xuICAgIHN1cGVyLnJlbmRlcl8oKTtcbiAgICB0aGlzLnVwZGF0ZUdyYXBoXygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbmQgc2hvdyB0aGUgYW5nbGUgZmllbGQncyBlZGl0b3IuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRfZSBPcHRpb25hbCBtb3VzZSBldmVudCB0aGF0IHRyaWdnZXJlZCB0aGUgZmllbGQgdG8gb3Blbiwgb3JcbiAgICogICAgIHVuZGVmaW5lZCBpZiB0cmlnZ2VyZWQgcHJvZ3JhbW1hdGljYWxseS5cbiAgICovXG4gIHByb3RlY3RlZCBvdmVycmlkZSBzaG93RWRpdG9yXyhvcHRfZT86IEV2ZW50KSB7XG4gICAgLy8gTW9iaWxlIGJyb3dzZXJzIGhhdmUgaXNzdWVzIHdpdGggaW4tbGluZSB0ZXh0YXJlYXMgKGZvY3VzICYga2V5Ym9hcmRzKS5cbiAgICBjb25zdCBub0ZvY3VzID0gdXNlckFnZW50Lk1PQklMRSB8fCB1c2VyQWdlbnQuQU5EUk9JRCB8fCB1c2VyQWdlbnQuSVBBRDtcbiAgICBzdXBlci5zaG93RWRpdG9yXyhvcHRfZSwgbm9Gb2N1cyk7XG5cbiAgICB0aGlzLmRyb3Bkb3duQ3JlYXRlXygpO1xuICAgIGRyb3BEb3duRGl2LmdldENvbnRlbnREaXYoKS5hcHBlbmRDaGlsZCh0aGlzLmVkaXRvcl8hKTtcblxuICAgIGlmICh0aGlzLnNvdXJjZUJsb2NrXyBpbnN0YW5jZW9mIEJsb2NrU3ZnKSB7XG4gICAgICBkcm9wRG93bkRpdi5zZXRDb2xvdXIoXG4gICAgICAgICAgdGhpcy5zb3VyY2VCbG9ja18uc3R5bGUuY29sb3VyUHJpbWFyeSxcbiAgICAgICAgICB0aGlzLnNvdXJjZUJsb2NrXy5zdHlsZS5jb2xvdXJUZXJ0aWFyeSk7XG4gICAgfVxuXG4gICAgLy8gQW55RHVyaW5nTWlncmF0aW9uIGJlY2F1c2U6ICBBcmd1bWVudCBvZiB0eXBlICd0aGlzJyBpcyBub3QgYXNzaWduYWJsZSB0b1xuICAgIC8vIHBhcmFtZXRlciBvZiB0eXBlICdGaWVsZCcuXG4gICAgZHJvcERvd25EaXYuc2hvd1Bvc2l0aW9uZWRCeUZpZWxkKFxuICAgICAgICB0aGlzIGFzIEFueUR1cmluZ01pZ3JhdGlvbiwgdGhpcy5kcm9wZG93bkRpc3Bvc2VfLmJpbmQodGhpcykpO1xuXG4gICAgdGhpcy51cGRhdGVHcmFwaF8oKTtcbiAgfVxuXG4gIC8qKiBDcmVhdGUgdGhlIGFuZ2xlIGRyb3Bkb3duIGVkaXRvci4gKi9cbiAgcHJpdmF0ZSBkcm9wZG93bkNyZWF0ZV8oKSB7XG4gICAgY29uc3Qgc3ZnID0gZG9tLmNyZWF0ZVN2Z0VsZW1lbnQoU3ZnLlNWRywge1xuICAgICAgJ3htbG5zJzogZG9tLlNWR19OUyxcbiAgICAgICd4bWxuczpodG1sJzogZG9tLkhUTUxfTlMsXG4gICAgICAneG1sbnM6eGxpbmsnOiBkb20uWExJTktfTlMsXG4gICAgICAndmVyc2lvbic6ICcxLjEnLFxuICAgICAgJ2hlaWdodCc6IEZpZWxkQW5nbGUuSEFMRiAqIDIgKyAncHgnLFxuICAgICAgJ3dpZHRoJzogRmllbGRBbmdsZS5IQUxGICogMiArICdweCcsXG4gICAgICAnc3R5bGUnOiAndG91Y2gtYWN0aW9uOiBub25lJyxcbiAgICB9KTtcbiAgICBjb25zdCBjaXJjbGUgPSBkb20uY3JlYXRlU3ZnRWxlbWVudChcbiAgICAgICAgU3ZnLkNJUkNMRSwge1xuICAgICAgICAgICdjeCc6IEZpZWxkQW5nbGUuSEFMRixcbiAgICAgICAgICAnY3knOiBGaWVsZEFuZ2xlLkhBTEYsXG4gICAgICAgICAgJ3InOiBGaWVsZEFuZ2xlLlJBRElVUyxcbiAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseUFuZ2xlQ2lyY2xlJyxcbiAgICAgICAgfSxcbiAgICAgICAgc3ZnKTtcbiAgICB0aGlzLmdhdWdlXyA9XG4gICAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFN2Zy5QQVRILCB7J2NsYXNzJzogJ2Jsb2NrbHlBbmdsZUdhdWdlJ30sIHN2Zyk7XG4gICAgdGhpcy5saW5lXyA9IGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICBTdmcuTElORSwge1xuICAgICAgICAgICd4MSc6IEZpZWxkQW5nbGUuSEFMRixcbiAgICAgICAgICAneTEnOiBGaWVsZEFuZ2xlLkhBTEYsXG4gICAgICAgICAgJ2NsYXNzJzogJ2Jsb2NrbHlBbmdsZUxpbmUnLFxuICAgICAgICB9LFxuICAgICAgICBzdmcpO1xuICAgIC8vIERyYXcgbWFya2VycyBhcm91bmQgdGhlIGVkZ2UuXG4gICAgZm9yIChsZXQgYW5nbGUgPSAwOyBhbmdsZSA8IDM2MDsgYW5nbGUgKz0gMTUpIHtcbiAgICAgIGRvbS5jcmVhdGVTdmdFbGVtZW50KFxuICAgICAgICAgIFN2Zy5MSU5FLCB7XG4gICAgICAgICAgICAneDEnOiBGaWVsZEFuZ2xlLkhBTEYgKyBGaWVsZEFuZ2xlLlJBRElVUyxcbiAgICAgICAgICAgICd5MSc6IEZpZWxkQW5nbGUuSEFMRixcbiAgICAgICAgICAgICd4Mic6IEZpZWxkQW5nbGUuSEFMRiArIEZpZWxkQW5nbGUuUkFESVVTIC1cbiAgICAgICAgICAgICAgICAoYW5nbGUgJSA0NSA9PT0gMCA/IDEwIDogNSksXG4gICAgICAgICAgICAneTInOiBGaWVsZEFuZ2xlLkhBTEYsXG4gICAgICAgICAgICAnY2xhc3MnOiAnYmxvY2tseUFuZ2xlTWFya3MnLFxuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoJyArIGFuZ2xlICsgJywnICsgRmllbGRBbmdsZS5IQUxGICsgJywnICtcbiAgICAgICAgICAgICAgICBGaWVsZEFuZ2xlLkhBTEYgKyAnKScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdmcpO1xuICAgIH1cblxuICAgIC8vIFRoZSBhbmdsZSBwaWNrZXIgaXMgZGlmZmVyZW50IGZyb20gb3RoZXIgZmllbGRzIGluIHRoYXQgaXQgdXBkYXRlcyBvblxuICAgIC8vIG1vdXNlbW92ZSBldmVuIGlmIGl0J3Mgbm90IGluIHRoZSBtaWRkbGUgb2YgYSBkcmFnLiAgSW4gZnV0dXJlIHdlIG1heVxuICAgIC8vIGNoYW5nZSB0aGlzIGJlaGF2aW91ci5cbiAgICB0aGlzLmNsaWNrV3JhcHBlcl8gPVxuICAgICAgICBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChzdmcsICdjbGljaycsIHRoaXMsIHRoaXMuaGlkZV8pO1xuICAgIC8vIE9uIHRvdWNoIGRldmljZXMsIHRoZSBwaWNrZXIncyB2YWx1ZSBpcyBvbmx5IHVwZGF0ZWQgd2l0aCBhIGRyYWcuIEFkZFxuICAgIC8vIGEgY2xpY2sgaGFuZGxlciBvbiB0aGUgZHJhZyBzdXJmYWNlIHRvIHVwZGF0ZSB0aGUgdmFsdWUgaWYgdGhlIHN1cmZhY2VcbiAgICAvLyBpcyBjbGlja2VkLlxuICAgIHRoaXMuY2xpY2tTdXJmYWNlV3JhcHBlcl8gPSBicm93c2VyRXZlbnRzLmNvbmRpdGlvbmFsQmluZChcbiAgICAgICAgY2lyY2xlLCAncG9pbnRlcmRvd24nLCB0aGlzLCB0aGlzLm9uTW91c2VNb3ZlXywgdHJ1ZSk7XG4gICAgdGhpcy5tb3ZlU3VyZmFjZVdyYXBwZXJfID0gYnJvd3NlckV2ZW50cy5jb25kaXRpb25hbEJpbmQoXG4gICAgICAgIGNpcmNsZSwgJ3BvaW50ZXJtb3ZlJywgdGhpcywgdGhpcy5vbk1vdXNlTW92ZV8sIHRydWUpO1xuICAgIHRoaXMuZWRpdG9yXyA9IHN2ZztcbiAgfVxuXG4gIC8qKiBEaXNwb3NlcyBvZiBldmVudHMgYW5kIERPTS1yZWZlcmVuY2VzIGJlbG9uZ2luZyB0byB0aGUgYW5nbGUgZWRpdG9yLiAqL1xuICBwcml2YXRlIGRyb3Bkb3duRGlzcG9zZV8oKSB7XG4gICAgaWYgKHRoaXMuY2xpY2tXcmFwcGVyXykge1xuICAgICAgYnJvd3NlckV2ZW50cy51bmJpbmQodGhpcy5jbGlja1dyYXBwZXJfKTtcbiAgICAgIHRoaXMuY2xpY2tXcmFwcGVyXyA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLmNsaWNrU3VyZmFjZVdyYXBwZXJfKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLmNsaWNrU3VyZmFjZVdyYXBwZXJfKTtcbiAgICAgIHRoaXMuY2xpY2tTdXJmYWNlV3JhcHBlcl8gPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5tb3ZlU3VyZmFjZVdyYXBwZXJfKSB7XG4gICAgICBicm93c2VyRXZlbnRzLnVuYmluZCh0aGlzLm1vdmVTdXJmYWNlV3JhcHBlcl8pO1xuICAgICAgdGhpcy5tb3ZlU3VyZmFjZVdyYXBwZXJfID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5nYXVnZV8gPSBudWxsO1xuICAgIHRoaXMubGluZV8gPSBudWxsO1xuICB9XG5cbiAgLyoqIEhpZGUgdGhlIGVkaXRvci4gKi9cbiAgcHJpdmF0ZSBoaWRlXygpIHtcbiAgICBkcm9wRG93bkRpdi5oaWRlSWZPd25lcih0aGlzKTtcbiAgICBXaWRnZXREaXYuaGlkZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgYW5nbGUgdG8gbWF0Y2ggdGhlIG1vdXNlJ3MgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSBlIE1vdXNlIG1vdmUgZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb25Nb3VzZU1vdmVfKGU6IFBvaW50ZXJFdmVudCkge1xuICAgIC8vIENhbGN1bGF0ZSBhbmdsZS5cbiAgICBjb25zdCBiQm94ID0gdGhpcy5nYXVnZV8hLm93bmVyU1ZHRWxlbWVudCEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgZHggPSBlLmNsaWVudFggLSBiQm94LmxlZnQgLSBGaWVsZEFuZ2xlLkhBTEY7XG4gICAgY29uc3QgZHkgPSBlLmNsaWVudFkgLSBiQm94LnRvcCAtIEZpZWxkQW5nbGUuSEFMRjtcbiAgICBsZXQgYW5nbGUgPSBNYXRoLmF0YW4oLWR5IC8gZHgpO1xuICAgIGlmIChpc05hTihhbmdsZSkpIHtcbiAgICAgIC8vIFRoaXMgc2hvdWxkbid0IGhhcHBlbiwgYnV0IGxldCdzIG5vdCBsZXQgdGhpcyBlcnJvciBwcm9wYWdhdGUgZnVydGhlci5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYW5nbGUgPSBtYXRoLnRvRGVncmVlcyhhbmdsZSk7XG4gICAgLy8gMDogRWFzdCwgOTA6IE5vcnRoLCAxODA6IFdlc3QsIDI3MDogU291dGguXG4gICAgaWYgKGR4IDwgMCkge1xuICAgICAgYW5nbGUgKz0gMTgwO1xuICAgIH0gZWxzZSBpZiAoZHkgPiAwKSB7XG4gICAgICBhbmdsZSArPSAzNjA7XG4gICAgfVxuXG4gICAgLy8gRG8gb2Zmc2V0dGluZy5cbiAgICBpZiAodGhpcy5jbG9ja3dpc2VfKSB7XG4gICAgICBhbmdsZSA9IHRoaXMub2Zmc2V0XyArIDM2MCAtIGFuZ2xlO1xuICAgIH0gZWxzZSB7XG4gICAgICBhbmdsZSA9IDM2MCAtICh0aGlzLm9mZnNldF8gLSBhbmdsZSk7XG4gICAgfVxuXG4gICAgdGhpcy5kaXNwbGF5TW91c2VPcktleWJvYXJkVmFsdWVfKGFuZ2xlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIGFuZCBkaXNwbGF5cyB2YWx1ZXMgdGhhdCBhcmUgaW5wdXQgdmlhIG1vdXNlIG9yIGFycm93IGtleSBpbnB1dC5cbiAgICogVGhlc2UgdmFsdWVzIG5lZWQgdG8gYmUgcm91bmRlZCBhbmQgd3JhcHBlZCBiZWZvcmUgYmVpbmcgZGlzcGxheWVkIHNvXG4gICAqIHRoYXQgdGhlIHRleHQgaW5wdXQncyB2YWx1ZSBpcyBhcHByb3ByaWF0ZS5cbiAgICpcbiAgICogQHBhcmFtIGFuZ2xlIE5ldyBhbmdsZS5cbiAgICovXG4gIHByaXZhdGUgZGlzcGxheU1vdXNlT3JLZXlib2FyZFZhbHVlXyhhbmdsZTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMucm91bmRfKSB7XG4gICAgICBhbmdsZSA9IE1hdGgucm91bmQoYW5nbGUgLyB0aGlzLnJvdW5kXykgKiB0aGlzLnJvdW5kXztcbiAgICB9XG4gICAgYW5nbGUgPSB0aGlzLndyYXBWYWx1ZV8oYW5nbGUpO1xuICAgIGlmIChhbmdsZSAhPT0gdGhpcy52YWx1ZV8pIHtcbiAgICAgIHRoaXMuc2V0RWRpdG9yVmFsdWVfKGFuZ2xlKTtcbiAgICB9XG4gIH1cblxuICAvKiogUmVkcmF3IHRoZSBncmFwaCB3aXRoIHRoZSBjdXJyZW50IGFuZ2xlLiAqL1xuICBwcml2YXRlIHVwZGF0ZUdyYXBoXygpIHtcbiAgICBpZiAoIXRoaXMuZ2F1Z2VfKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIEFsd2F5cyBkaXNwbGF5IHRoZSBpbnB1dCAoaS5lLiBnZXRUZXh0KSBldmVuIGlmIGl0IGlzIGludmFsaWQuXG4gICAgbGV0IGFuZ2xlRGVncmVlcyA9IE51bWJlcih0aGlzLmdldFRleHQoKSkgKyB0aGlzLm9mZnNldF87XG4gICAgYW5nbGVEZWdyZWVzICU9IDM2MDtcbiAgICBsZXQgYW5nbGVSYWRpYW5zID0gbWF0aC50b1JhZGlhbnMoYW5nbGVEZWdyZWVzKTtcbiAgICBjb25zdCBwYXRoID0gWydNICcsIEZpZWxkQW5nbGUuSEFMRiwgJywnLCBGaWVsZEFuZ2xlLkhBTEZdO1xuICAgIGxldCB4MiA9IEZpZWxkQW5nbGUuSEFMRjtcbiAgICBsZXQgeTIgPSBGaWVsZEFuZ2xlLkhBTEY7XG4gICAgaWYgKCFpc05hTihhbmdsZVJhZGlhbnMpKSB7XG4gICAgICBjb25zdCBjbG9ja3dpc2VGbGFnID0gTnVtYmVyKHRoaXMuY2xvY2t3aXNlXyk7XG4gICAgICBjb25zdCBhbmdsZTEgPSBtYXRoLnRvUmFkaWFucyh0aGlzLm9mZnNldF8pO1xuICAgICAgY29uc3QgeDEgPSBNYXRoLmNvcyhhbmdsZTEpICogRmllbGRBbmdsZS5SQURJVVM7XG4gICAgICBjb25zdCB5MSA9IE1hdGguc2luKGFuZ2xlMSkgKiAtRmllbGRBbmdsZS5SQURJVVM7XG4gICAgICBpZiAoY2xvY2t3aXNlRmxhZykge1xuICAgICAgICBhbmdsZVJhZGlhbnMgPSAyICogYW5nbGUxIC0gYW5nbGVSYWRpYW5zO1xuICAgICAgfVxuICAgICAgeDIgKz0gTWF0aC5jb3MoYW5nbGVSYWRpYW5zKSAqIEZpZWxkQW5nbGUuUkFESVVTO1xuICAgICAgeTIgLT0gTWF0aC5zaW4oYW5nbGVSYWRpYW5zKSAqIEZpZWxkQW5nbGUuUkFESVVTO1xuICAgICAgLy8gRG9uJ3QgYXNrIGhvdyB0aGUgZmxhZyBjYWxjdWxhdGlvbnMgd29yay4gIFRoZXkganVzdCBkby5cbiAgICAgIGxldCBsYXJnZUZsYWcgPVxuICAgICAgICAgIE1hdGguYWJzKE1hdGguZmxvb3IoKGFuZ2xlUmFkaWFucyAtIGFuZ2xlMSkgLyBNYXRoLlBJKSAlIDIpO1xuICAgICAgaWYgKGNsb2Nrd2lzZUZsYWcpIHtcbiAgICAgICAgbGFyZ2VGbGFnID0gMSAtIGxhcmdlRmxhZztcbiAgICAgIH1cbiAgICAgIHBhdGgucHVzaChcbiAgICAgICAgICAnIGwgJywgeDEsICcsJywgeTEsICcgQSAnLCBGaWVsZEFuZ2xlLlJBRElVUywgJywnLCBGaWVsZEFuZ2xlLlJBRElVUyxcbiAgICAgICAgICAnIDAgJywgbGFyZ2VGbGFnLCAnICcsIGNsb2Nrd2lzZUZsYWcsICcgJywgeDIsICcsJywgeTIsICcgeicpO1xuICAgIH1cbiAgICB0aGlzLmdhdWdlXy5zZXRBdHRyaWJ1dGUoJ2QnLCBwYXRoLmpvaW4oJycpKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICB0aGlzLmxpbmVfIS5zZXRBdHRyaWJ1dGUoJ3gyJywgeDIgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgICAvLyBBbnlEdXJpbmdNaWdyYXRpb24gYmVjYXVzZTogIEFyZ3VtZW50IG9mIHR5cGUgJ251bWJlcicgaXMgbm90IGFzc2lnbmFibGVcbiAgICAvLyB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnc3RyaW5nJy5cbiAgICB0aGlzLmxpbmVfIS5zZXRBdHRyaWJ1dGUoJ3kyJywgeTIgYXMgQW55RHVyaW5nTWlncmF0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUga2V5IGRvd24gdG8gdGhlIGVkaXRvci5cbiAgICpcbiAgICogQHBhcmFtIGUgS2V5Ym9hcmQgZXZlbnQuXG4gICAqL1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgb25IdG1sSW5wdXRLZXlEb3duXyhlOiBFdmVudCkge1xuICAgIHN1cGVyLm9uSHRtbElucHV0S2V5RG93bl8oZSk7XG4gICAgY29uc3QgYmxvY2sgPSB0aGlzLmdldFNvdXJjZUJsb2NrKCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IFVuYXR0YWNoZWRGaWVsZEVycm9yKCk7XG4gICAgfVxuXG4gICAgY29uc3Qga2V5Ym9hcmRFdmVudCA9IGUgYXMgS2V5Ym9hcmRFdmVudDtcbiAgICBsZXQgbXVsdGlwbGllcjtcbiAgICBpZiAoa2V5Ym9hcmRFdmVudC5rZXlDb2RlID09PSBLZXlDb2Rlcy5MRUZUKSB7XG4gICAgICAvLyBkZWNyZW1lbnQgKGluY3JlbWVudCBpbiBSVEwpXG4gICAgICBtdWx0aXBsaWVyID0gYmxvY2suUlRMID8gMSA6IC0xO1xuICAgIH0gZWxzZSBpZiAoa2V5Ym9hcmRFdmVudC5rZXlDb2RlID09PSBLZXlDb2Rlcy5SSUdIVCkge1xuICAgICAgLy8gaW5jcmVtZW50IChkZWNyZW1lbnQgaW4gUlRMKVxuICAgICAgbXVsdGlwbGllciA9IGJsb2NrLlJUTCA/IC0xIDogMTtcbiAgICB9IGVsc2UgaWYgKGtleWJvYXJkRXZlbnQua2V5Q29kZSA9PT0gS2V5Q29kZXMuRE9XTikge1xuICAgICAgLy8gZGVjcmVtZW50XG4gICAgICBtdWx0aXBsaWVyID0gLTE7XG4gICAgfSBlbHNlIGlmIChrZXlib2FyZEV2ZW50LmtleUNvZGUgPT09IEtleUNvZGVzLlVQKSB7XG4gICAgICAvLyBpbmNyZW1lbnRcbiAgICAgIG11bHRpcGxpZXIgPSAxO1xuICAgIH1cbiAgICBpZiAobXVsdGlwbGllcikge1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCkgYXMgbnVtYmVyO1xuICAgICAgdGhpcy5kaXNwbGF5TW91c2VPcktleWJvYXJkVmFsdWVfKHZhbHVlICsgbXVsdGlwbGllciAqIHRoaXMucm91bmRfKTtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuc3VyZSB0aGF0IHRoZSBpbnB1dCB2YWx1ZSBpcyBhIHZhbGlkIGFuZ2xlLlxuICAgKlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIFRoZSBpbnB1dCB2YWx1ZS5cbiAgICogQHJldHVybnMgQSB2YWxpZCBhbmdsZSwgb3IgbnVsbCBpZiBpbnZhbGlkLlxuICAgKi9cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGRvQ2xhc3NWYWxpZGF0aW9uXyhvcHRfbmV3VmFsdWU/OiBBbnlEdXJpbmdNaWdyYXRpb24pOlxuICAgICAgbnVtYmVyfG51bGwge1xuICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyKG9wdF9uZXdWYWx1ZSk7XG4gICAgaWYgKGlzTmFOKHZhbHVlKSB8fCAhaXNGaW5pdGUodmFsdWUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMud3JhcFZhbHVlXyh2YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogV3JhcHMgdGhlIHZhbHVlIHNvIHRoYXQgaXQgaXMgaW4gdGhlIHJhbmdlICgtMzYwICsgd3JhcCwgd3JhcCkuXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gd3JhcC5cbiAgICogQHJldHVybnMgVGhlIHdyYXBwZWQgdmFsdWUuXG4gICAqL1xuICBwcml2YXRlIHdyYXBWYWx1ZV8odmFsdWU6IG51bWJlcik6IG51bWJlciB7XG4gICAgdmFsdWUgJT0gMzYwO1xuICAgIGlmICh2YWx1ZSA8IDApIHtcbiAgICAgIHZhbHVlICs9IDM2MDtcbiAgICB9XG4gICAgaWYgKHZhbHVlID4gdGhpcy53cmFwXykge1xuICAgICAgdmFsdWUgLT0gMzYwO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogQ29uc3RydWN0IGEgRmllbGRBbmdsZSBmcm9tIGEgSlNPTiBhcmcgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBBIEpTT04gb2JqZWN0IHdpdGggb3B0aW9ucyAoYW5nbGUpLlxuICAgKiBAcmV0dXJucyBUaGUgbmV3IGZpZWxkIGluc3RhbmNlLlxuICAgKiBAbm9jb2xsYXBzZVxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihvcHRpb25zOiBGaWVsZEFuZ2xlRnJvbUpzb25Db25maWcpOiBGaWVsZEFuZ2xlIHtcbiAgICAvLyBgdGhpc2AgbWlnaHQgYmUgYSBzdWJjbGFzcyBvZiBGaWVsZEFuZ2xlIGlmIHRoYXQgY2xhc3MgZG9lc24ndCBvdmVycmlkZVxuICAgIC8vIHRoZSBzdGF0aWMgZnJvbUpzb24gbWV0aG9kLlxuICAgIHJldHVybiBuZXcgdGhpcyhvcHRpb25zLmFuZ2xlLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICB9XG59XG5cbi8qKiBDU1MgZm9yIGFuZ2xlIGZpZWxkLiAgU2VlIGNzcy5qcyBmb3IgdXNlLiAqL1xuQ3NzLnJlZ2lzdGVyKGBcbi5ibG9ja2x5QW5nbGVDaXJjbGUge1xuICBzdHJva2U6ICM0NDQ7XG4gIHN0cm9rZS13aWR0aDogMTtcbiAgZmlsbDogI2RkZDtcbiAgZmlsbC1vcGFjaXR5OiAuODtcbn1cblxuLmJsb2NrbHlBbmdsZU1hcmtzIHtcbiAgc3Ryb2tlOiAjNDQ0O1xuICBzdHJva2Utd2lkdGg6IDE7XG59XG5cbi5ibG9ja2x5QW5nbGVHYXVnZSB7XG4gIGZpbGw6ICNmODg7XG4gIGZpbGwtb3BhY2l0eTogLjg7XG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xufVxuXG4uYmxvY2tseUFuZ2xlTGluZSB7XG4gIHN0cm9rZTogI2YwMDtcbiAgc3Ryb2tlLXdpZHRoOiAyO1xuICBzdHJva2UtbGluZWNhcDogcm91bmQ7XG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xufVxuYCk7XG5cbmZpZWxkUmVnaXN0cnkucmVnaXN0ZXIoJ2ZpZWxkX2FuZ2xlJywgRmllbGRBbmdsZSk7XG5cbkZpZWxkQW5nbGUucHJvdG90eXBlLkRFRkFVTFRfVkFMVUUgPSAwO1xuXG4vKipcbiAqIFRoZSB0d28gbWFpbiBtb2RlcyBvZiB0aGUgYW5nbGUgZmllbGQuXG4gKiBDb21wYXNzIHNwZWNpZmllczpcbiAqICAgLSBjbG9ja3dpc2U6IHRydWVcbiAqICAgLSBvZmZzZXQ6IDkwXG4gKiAgIC0gd3JhcDogMFxuICogICAtIHJvdW5kOiAxNVxuICpcbiAqIFByb3RyYWN0b3Igc3BlY2lmaWVzOlxuICogICAtIGNsb2Nrd2lzZTogZmFsc2VcbiAqICAgLSBvZmZzZXQ6IDBcbiAqICAgLSB3cmFwOiAwXG4gKiAgIC0gcm91bmQ6IDE1XG4gKi9cbmV4cG9ydCBlbnVtIE1vZGUge1xuICBDT01QQVNTID0gJ2NvbXBhc3MnLFxuICBQUk9UUkFDVE9SID0gJ3Byb3RyYWN0b3InLFxufVxuXG4vKipcbiAqIEV4dHJhIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgdGhlIGFuZ2xlIGZpZWxkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkQW5nbGVDb25maWcgZXh0ZW5kcyBGaWVsZElucHV0Q29uZmlnIHtcbiAgbW9kZT86IE1vZGU7XG4gIGNsb2Nrd2lzZT86IGJvb2xlYW47XG4gIG9mZnNldD86IG51bWJlcjtcbiAgd3JhcD86IG51bWJlcjtcbiAgcm91bmQ/OiBudW1iZXI7XG59XG5cbi8qKlxuICogZnJvbUpzb24gY29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgYW5nbGUgZmllbGQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGRBbmdsZUZyb21Kc29uQ29uZmlnIGV4dGVuZHMgRmllbGRBbmdsZUNvbmZpZyB7XG4gIGFuZ2xlPzogbnVtYmVyO1xufVxuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrIG1vdmUgZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkJsb2NrTW92ZScpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4uL2Jsb2NrLmpzJztcbmltcG9ydCB7Q29ubmVjdGlvblR5cGV9IGZyb20gJy4uL2Nvbm5lY3Rpb25fdHlwZS5qcyc7XG5pbXBvcnQgKiBhcyBkZXByZWNhdGlvbiBmcm9tICcuLi91dGlscy9kZXByZWNhdGlvbi5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge0Nvb3JkaW5hdGV9IGZyb20gJy4uL3V0aWxzL2Nvb3JkaW5hdGUuanMnO1xuXG5pbXBvcnQge0Jsb2NrQmFzZSwgQmxvY2tCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfYmxvY2tfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG5pbnRlcmZhY2UgQmxvY2tMb2NhdGlvbiB7XG4gIHBhcmVudElkPzogc3RyaW5nO1xuICBpbnB1dE5hbWU/OiBzdHJpbmc7XG4gIGNvb3JkaW5hdGU/OiBDb29yZGluYXRlO1xufVxuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrIG1vdmUgZXZlbnQuICBDcmVhdGVkIGJlZm9yZSB0aGUgbW92ZS5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMuQmxvY2tNb3ZlXG4gKi9cbmV4cG9ydCBjbGFzcyBCbG9ja01vdmUgZXh0ZW5kcyBCbG9ja0Jhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5CTE9DS19NT1ZFO1xuICBvbGRQYXJlbnRJZD86IHN0cmluZztcbiAgb2xkSW5wdXROYW1lPzogc3RyaW5nO1xuICBvbGRDb29yZGluYXRlPzogQ29vcmRpbmF0ZTtcblxuICBuZXdQYXJlbnRJZD86IHN0cmluZztcbiAgbmV3SW5wdXROYW1lPzogc3RyaW5nO1xuICBuZXdDb29yZGluYXRlPzogQ29vcmRpbmF0ZTtcblxuICAvKiogQHBhcmFtIG9wdF9ibG9jayBUaGUgbW92ZWQgYmxvY2suICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuICovXG4gIGNvbnN0cnVjdG9yKG9wdF9ibG9jaz86IEJsb2NrKSB7XG4gICAgc3VwZXIob3B0X2Jsb2NrKTtcblxuICAgIGlmICghb3B0X2Jsb2NrKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIEJsYW5rIGV2ZW50IHRvIGJlIHBvcHVsYXRlZCBieSBmcm9tSnNvbi5cbiAgICBpZiAob3B0X2Jsb2NrLmlzU2hhZG93KCkpIHtcbiAgICAgIC8vIE1vdmluZyBzaGFkb3cgYmxvY2tzIGlzIGhhbmRsZWQgdmlhIGRpc2Nvbm5lY3Rpb24uXG4gICAgICB0aGlzLnJlY29yZFVuZG8gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBsb2NhdGlvbiA9IHRoaXMuY3VycmVudExvY2F0aW9uXygpO1xuICAgIHRoaXMub2xkUGFyZW50SWQgPSBsb2NhdGlvbi5wYXJlbnRJZDtcbiAgICB0aGlzLm9sZElucHV0TmFtZSA9IGxvY2F0aW9uLmlucHV0TmFtZTtcbiAgICB0aGlzLm9sZENvb3JkaW5hdGUgPSBsb2NhdGlvbi5jb29yZGluYXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBCbG9ja01vdmVKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgQmxvY2tNb3ZlSnNvbjtcbiAgICBqc29uWydvbGRQYXJlbnRJZCddID0gdGhpcy5vbGRQYXJlbnRJZDtcbiAgICBqc29uWydvbGRJbnB1dE5hbWUnXSA9IHRoaXMub2xkSW5wdXROYW1lO1xuICAgIGlmICh0aGlzLm9sZENvb3JkaW5hdGUpIHtcbiAgICAgIGpzb25bJ29sZENvb3JkaW5hdGUnXSA9IGAke01hdGgucm91bmQodGhpcy5vbGRDb29yZGluYXRlLngpfSwgYCArXG4gICAgICAgICAgYCR7TWF0aC5yb3VuZCh0aGlzLm9sZENvb3JkaW5hdGUueSl9YDtcbiAgICB9XG4gICAganNvblsnbmV3UGFyZW50SWQnXSA9IHRoaXMubmV3UGFyZW50SWQ7XG4gICAganNvblsnbmV3SW5wdXROYW1lJ10gPSB0aGlzLm5ld0lucHV0TmFtZTtcbiAgICBpZiAodGhpcy5uZXdDb29yZGluYXRlKSB7XG4gICAgICBqc29uWyduZXdDb29yZGluYXRlJ10gPSBgJHtNYXRoLnJvdW5kKHRoaXMubmV3Q29vcmRpbmF0ZS54KX0sIGAgK1xuICAgICAgICAgIGAke01hdGgucm91bmQodGhpcy5uZXdDb29yZGluYXRlLnkpfWA7XG4gICAgfVxuICAgIGlmICghdGhpcy5yZWNvcmRVbmRvKSB7XG4gICAgICBqc29uWydyZWNvcmRVbmRvJ10gPSB0aGlzLnJlY29yZFVuZG87XG4gICAgfVxuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIGZyb21Kc29uKGpzb246IEJsb2NrTW92ZUpzb24pIHtcbiAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAnQmxvY2tseS5FdmVudHMuQmxvY2tNb3ZlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMub2xkUGFyZW50SWQgPSBqc29uWydvbGRQYXJlbnRJZCddO1xuICAgIHRoaXMub2xkSW5wdXROYW1lID0ganNvblsnb2xkSW5wdXROYW1lJ107XG4gICAgaWYgKGpzb25bJ29sZENvb3JkaW5hdGUnXSkge1xuICAgICAgY29uc3QgeHkgPSBqc29uWydvbGRDb29yZGluYXRlJ10uc3BsaXQoJywnKTtcbiAgICAgIHRoaXMub2xkQ29vcmRpbmF0ZSA9IG5ldyBDb29yZGluYXRlKE51bWJlcih4eVswXSksIE51bWJlcih4eVsxXSkpO1xuICAgIH1cbiAgICB0aGlzLm5ld1BhcmVudElkID0ganNvblsnbmV3UGFyZW50SWQnXTtcbiAgICB0aGlzLm5ld0lucHV0TmFtZSA9IGpzb25bJ25ld0lucHV0TmFtZSddO1xuICAgIGlmIChqc29uWyduZXdDb29yZGluYXRlJ10pIHtcbiAgICAgIGNvbnN0IHh5ID0ganNvblsnbmV3Q29vcmRpbmF0ZSddLnNwbGl0KCcsJyk7XG4gICAgICB0aGlzLm5ld0Nvb3JkaW5hdGUgPSBuZXcgQ29vcmRpbmF0ZShOdW1iZXIoeHlbMF0pLCBOdW1iZXIoeHlbMV0pKTtcbiAgICB9XG4gICAgaWYgKGpzb25bJ3JlY29yZFVuZG8nXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnJlY29yZFVuZG8gPSBqc29uWydyZWNvcmRVbmRvJ107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlc2VyaWFsaXplcyB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCB0byBhcHBlbmQgbmV3IHByb3BlcnRpZXMgdG8uIFNob3VsZCBiZSBhIHN1YmNsYXNzXG4gICAqICAgICBvZiBCbG9ja01vdmUsIGJ1dCB3ZSBjYW4ndCBzcGVjaWZ5IHRoYXQgZHVlIHRvIHRoZSBmYWN0IHRoYXQgcGFyYW1ldGVyc1xuICAgKiAgICAgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3ViY2xhc3NlcyBtdXN0IGJlIHN1cGVydHlwZXMgb2YgcGFyYW1ldGVycyB0b1xuICAgKiAgICAgc3RhdGljIG1ldGhvZHMgaW4gc3VwZXJjbGFzc2VzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBCbG9ja01vdmVKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgQmxvY2tNb3ZlIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IEJsb2NrTW92ZSgpKSBhcyBCbG9ja01vdmU7XG4gICAgbmV3RXZlbnQub2xkUGFyZW50SWQgPSBqc29uWydvbGRQYXJlbnRJZCddO1xuICAgIG5ld0V2ZW50Lm9sZElucHV0TmFtZSA9IGpzb25bJ29sZElucHV0TmFtZSddO1xuICAgIGlmIChqc29uWydvbGRDb29yZGluYXRlJ10pIHtcbiAgICAgIGNvbnN0IHh5ID0ganNvblsnb2xkQ29vcmRpbmF0ZSddLnNwbGl0KCcsJyk7XG4gICAgICBuZXdFdmVudC5vbGRDb29yZGluYXRlID0gbmV3IENvb3JkaW5hdGUoTnVtYmVyKHh5WzBdKSwgTnVtYmVyKHh5WzFdKSk7XG4gICAgfVxuICAgIG5ld0V2ZW50Lm5ld1BhcmVudElkID0ganNvblsnbmV3UGFyZW50SWQnXTtcbiAgICBuZXdFdmVudC5uZXdJbnB1dE5hbWUgPSBqc29uWyduZXdJbnB1dE5hbWUnXTtcbiAgICBpZiAoanNvblsnbmV3Q29vcmRpbmF0ZSddKSB7XG4gICAgICBjb25zdCB4eSA9IGpzb25bJ25ld0Nvb3JkaW5hdGUnXS5zcGxpdCgnLCcpO1xuICAgICAgbmV3RXZlbnQubmV3Q29vcmRpbmF0ZSA9IG5ldyBDb29yZGluYXRlKE51bWJlcih4eVswXSksIE51bWJlcih4eVsxXSkpO1xuICAgIH1cbiAgICBpZiAoanNvblsncmVjb3JkVW5kbyddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG5ld0V2ZW50LnJlY29yZFVuZG8gPSBqc29uWydyZWNvcmRVbmRvJ107XG4gICAgfVxuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxuXG4gIC8qKiBSZWNvcmQgdGhlIGJsb2NrJ3MgbmV3IGxvY2F0aW9uLiAgQ2FsbGVkIGFmdGVyIHRoZSBtb3ZlLiAqL1xuICByZWNvcmROZXcoKSB7XG4gICAgY29uc3QgbG9jYXRpb24gPSB0aGlzLmN1cnJlbnRMb2NhdGlvbl8oKTtcbiAgICB0aGlzLm5ld1BhcmVudElkID0gbG9jYXRpb24ucGFyZW50SWQ7XG4gICAgdGhpcy5uZXdJbnB1dE5hbWUgPSBsb2NhdGlvbi5pbnB1dE5hbWU7XG4gICAgdGhpcy5uZXdDb29yZGluYXRlID0gbG9jYXRpb24uY29vcmRpbmF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBwYXJlbnRJZCBhbmQgaW5wdXQgaWYgdGhlIGJsb2NrIGlzIGNvbm5lY3RlZCxcbiAgICogICBvciB0aGUgWFkgbG9jYXRpb24gaWYgZGlzY29ubmVjdGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyBDb2xsZWN0aW9uIG9mIGxvY2F0aW9uIGluZm8uXG4gICAqL1xuICBwcml2YXRlIGN1cnJlbnRMb2NhdGlvbl8oKTogQmxvY2tMb2NhdGlvbiB7XG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5nZXRFdmVudFdvcmtzcGFjZV8oKTtcbiAgICBpZiAoIXRoaXMuYmxvY2tJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgY29uc3QgYmxvY2sgPSB3b3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKHRoaXMuYmxvY2tJZCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgYXNzb2NpYXRlZCB3aXRoIHRoZSBibG9jayBtb3ZlIGV2ZW50ICcgK1xuICAgICAgICAgICdjb3VsZCBub3QgYmUgZm91bmQnKTtcbiAgICB9XG4gICAgY29uc3QgbG9jYXRpb24gPSB7fSBhcyBCbG9ja0xvY2F0aW9uO1xuICAgIGNvbnN0IHBhcmVudCA9IGJsb2NrLmdldFBhcmVudCgpO1xuICAgIGlmIChwYXJlbnQpIHtcbiAgICAgIGxvY2F0aW9uLnBhcmVudElkID0gcGFyZW50LmlkO1xuICAgICAgY29uc3QgaW5wdXQgPSBwYXJlbnQuZ2V0SW5wdXRXaXRoQmxvY2soYmxvY2spO1xuICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgIGxvY2F0aW9uLmlucHV0TmFtZSA9IGlucHV0Lm5hbWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvY2F0aW9uLmNvb3JkaW5hdGUgPSBibG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7XG4gICAgfVxuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEb2VzIHRoaXMgZXZlbnQgcmVjb3JkIGFueSBjaGFuZ2Ugb2Ygc3RhdGU/XG4gICAqXG4gICAqIEByZXR1cm5zIEZhbHNlIGlmIHNvbWV0aGluZyBjaGFuZ2VkLlxuICAgKi9cbiAgb3ZlcnJpZGUgaXNOdWxsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9sZFBhcmVudElkID09PSB0aGlzLm5ld1BhcmVudElkICYmXG4gICAgICAgIHRoaXMub2xkSW5wdXROYW1lID09PSB0aGlzLm5ld0lucHV0TmFtZSAmJlxuICAgICAgICBDb29yZGluYXRlLmVxdWFscyh0aGlzLm9sZENvb3JkaW5hdGUsIHRoaXMubmV3Q29vcmRpbmF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgbW92ZSBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGZvcndhcmQgVHJ1ZSBpZiBydW4gZm9yd2FyZCwgZmFsc2UgaWYgcnVuIGJhY2t3YXJkICh1bmRvKS5cbiAgICovXG4gIG92ZXJyaWRlIHJ1bihmb3J3YXJkOiBib29sZWFuKSB7XG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5nZXRFdmVudFdvcmtzcGFjZV8oKTtcbiAgICBpZiAoIXRoaXMuYmxvY2tJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgY29uc3QgYmxvY2sgPSB3b3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKHRoaXMuYmxvY2tJZCk7XG4gICAgaWYgKCFibG9jaykge1xuICAgICAgY29uc29sZS53YXJuKCdDYW5cXCd0IG1vdmUgbm9uLWV4aXN0ZW50IGJsb2NrOiAnICsgdGhpcy5ibG9ja0lkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcGFyZW50SWQgPSBmb3J3YXJkID8gdGhpcy5uZXdQYXJlbnRJZCA6IHRoaXMub2xkUGFyZW50SWQ7XG4gICAgY29uc3QgaW5wdXROYW1lID0gZm9yd2FyZCA/IHRoaXMubmV3SW5wdXROYW1lIDogdGhpcy5vbGRJbnB1dE5hbWU7XG4gICAgY29uc3QgY29vcmRpbmF0ZSA9IGZvcndhcmQgPyB0aGlzLm5ld0Nvb3JkaW5hdGUgOiB0aGlzLm9sZENvb3JkaW5hdGU7XG4gICAgbGV0IHBhcmVudEJsb2NrOiBCbG9ja3xudWxsO1xuICAgIGlmIChwYXJlbnRJZCkge1xuICAgICAgcGFyZW50QmxvY2sgPSB3b3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKHBhcmVudElkKTtcbiAgICAgIGlmICghcGFyZW50QmxvY2spIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdDYW5cXCd0IGNvbm5lY3QgdG8gbm9uLWV4aXN0ZW50IGJsb2NrOiAnICsgcGFyZW50SWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChibG9jay5nZXRQYXJlbnQoKSkge1xuICAgICAgYmxvY2sudW5wbHVnKCk7XG4gICAgfVxuICAgIGlmIChjb29yZGluYXRlKSB7XG4gICAgICBjb25zdCB4eSA9IGJsb2NrLmdldFJlbGF0aXZlVG9TdXJmYWNlWFkoKTtcbiAgICAgIGJsb2NrLm1vdmVCeShjb29yZGluYXRlLnggLSB4eS54LCBjb29yZGluYXRlLnkgLSB4eS55KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGJsb2NrQ29ubmVjdGlvbiA9IGJsb2NrLm91dHB1dENvbm5lY3Rpb247XG4gICAgICBpZiAoIWJsb2NrQ29ubmVjdGlvbiB8fFxuICAgICAgICAgIGJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbiAmJiBibG9jay5wcmV2aW91c0Nvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICBibG9ja0Nvbm5lY3Rpb24gPSBibG9jay5wcmV2aW91c0Nvbm5lY3Rpb247XG4gICAgICB9XG4gICAgICBsZXQgcGFyZW50Q29ubmVjdGlvbjtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25UeXBlID0gYmxvY2tDb25uZWN0aW9uLnR5cGU7XG4gICAgICBpZiAoaW5wdXROYW1lKSB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gcGFyZW50QmxvY2shLmdldElucHV0KGlucHV0TmFtZSk7XG4gICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgIHBhcmVudENvbm5lY3Rpb24gPSBpbnB1dC5jb25uZWN0aW9uO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNvbm5lY3Rpb25UeXBlID09PSBDb25uZWN0aW9uVHlwZS5QUkVWSU9VU19TVEFURU1FTlQpIHtcbiAgICAgICAgcGFyZW50Q29ubmVjdGlvbiA9IHBhcmVudEJsb2NrIS5uZXh0Q29ubmVjdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJlbnRDb25uZWN0aW9uKSB7XG4gICAgICAgIGJsb2NrQ29ubmVjdGlvbi5jb25uZWN0KHBhcmVudENvbm5lY3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdDYW5cXCd0IGNvbm5lY3QgdG8gbm9uLWV4aXN0ZW50IGlucHV0OiAnICsgaW5wdXROYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBCbG9ja01vdmVKc29uIGV4dGVuZHMgQmxvY2tCYXNlSnNvbiB7XG4gIG9sZFBhcmVudElkPzogc3RyaW5nO1xuICBvbGRJbnB1dE5hbWU/OiBzdHJpbmc7XG4gIG9sZENvb3JkaW5hdGU/OiBzdHJpbmc7XG4gIG5ld1BhcmVudElkPzogc3RyaW5nO1xuICBuZXdJbnB1dE5hbWU/OiBzdHJpbmc7XG4gIG5ld0Nvb3JkaW5hdGU/OiBzdHJpbmc7XG4gIHJlY29yZFVuZG8/OiBib29sZWFuO1xufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihyZWdpc3RyeS5UeXBlLkVWRU5ULCBldmVudFV0aWxzLk1PVkUsIEJsb2NrTW92ZSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQmFzZSBjbGFzcyBmb3IgY29tbWVudCBldmVudHMuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkNvbW1lbnRCYXNlJyk7XG5cbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHV0aWxzWG1sIGZyb20gJy4uL3V0aWxzL3htbC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlQ29tbWVudH0gZnJvbSAnLi4vd29ya3NwYWNlX2NvbW1lbnQuanMnO1xuaW1wb3J0ICogYXMgWG1sIGZyb20gJy4uL3htbC5qcyc7XG5cbmltcG9ydCB7QWJzdHJhY3QgYXMgQWJzdHJhY3RFdmVudCwgQWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB0eXBlIHtDb21tZW50Q3JlYXRlfSBmcm9tICcuL2V2ZW50c19jb21tZW50X2NyZWF0ZS5qcyc7XG5pbXBvcnQgdHlwZSB7Q29tbWVudERlbGV0ZX0gZnJvbSAnLi9ldmVudHNfY29tbWVudF9kZWxldGUuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBBYnN0cmFjdCBjbGFzcyBmb3IgYSBjb21tZW50IGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5Db21tZW50QmFzZVxuICovXG5leHBvcnQgY2xhc3MgQ29tbWVudEJhc2UgZXh0ZW5kcyBBYnN0cmFjdEV2ZW50IHtcbiAgb3ZlcnJpZGUgaXNCbGFuayA9IHRydWU7XG4gIGNvbW1lbnRJZD86IHN0cmluZztcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF9jb21tZW50IFRoZSBjb21tZW50IHRoaXMgZXZlbnQgY29ycmVzcG9uZHMgdG8uICBVbmRlZmluZWQgZm9yIGFcbiAgICogICAgIGJsYW5rIGV2ZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0X2NvbW1lbnQ/OiBXb3Jrc3BhY2VDb21tZW50KSB7XG4gICAgc3VwZXIoKTtcbiAgICAvKiogV2hldGhlciBvciBub3QgYW4gZXZlbnQgaXMgYmxhbmsuICovXG4gICAgdGhpcy5pc0JsYW5rID0gIW9wdF9jb21tZW50O1xuXG4gICAgaWYgKCFvcHRfY29tbWVudCkgcmV0dXJuO1xuXG4gICAgLyoqIFRoZSBJRCBvZiB0aGUgY29tbWVudCB0aGlzIGV2ZW50IHBlcnRhaW5zIHRvLiAqL1xuICAgIHRoaXMuY29tbWVudElkID0gb3B0X2NvbW1lbnQuaWQ7XG5cbiAgICAvKiogVGhlIHdvcmtzcGFjZSBpZGVudGlmaWVyIGZvciB0aGlzIGV2ZW50LiAqL1xuICAgIHRoaXMud29ya3NwYWNlSWQgPSBvcHRfY29tbWVudC53b3Jrc3BhY2UuaWQ7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZXZlbnQgZ3JvdXAgSUQgZm9yIHRoZSBncm91cCB0aGlzIGV2ZW50IGJlbG9uZ3MgdG8uIEdyb3VwcyBkZWZpbmVcbiAgICAgKiBldmVudHMgdGhhdCBzaG91bGQgYmUgdHJlYXRlZCBhcyBhbiBzaW5nbGUgYWN0aW9uIGZyb20gdGhlIHVzZXInc1xuICAgICAqIHBlcnNwZWN0aXZlLCBhbmQgc2hvdWxkIGJlIHVuZG9uZSB0b2dldGhlci5cbiAgICAgKi9cbiAgICB0aGlzLmdyb3VwID0gZXZlbnRVdGlscy5nZXRHcm91cCgpO1xuXG4gICAgLyoqIFNldHMgd2hldGhlciB0aGUgZXZlbnQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSB1bmRvIHN0YWNrLiAqL1xuICAgIHRoaXMucmVjb3JkVW5kbyA9IGV2ZW50VXRpbHMuZ2V0UmVjb3JkVW5kbygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBDb21tZW50QmFzZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBDb21tZW50QmFzZUpzb247XG4gICAgaWYgKCF0aGlzLmNvbW1lbnRJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgY29tbWVudCBJRCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgY29tbWVudCB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ2NvbW1lbnRJZCddID0gdGhpcy5jb21tZW50SWQ7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogQ29tbWVudEJhc2VKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLkNvbW1lbnRCYXNlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMuY29tbWVudElkID0ganNvblsnY29tbWVudElkJ107XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIENvbW1lbnRCYXNlLCBidXQgd2UgY2FuJ3Qgc3BlY2lmeSB0aGF0IGR1ZSB0byB0aGUgZmFjdCB0aGF0XG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1YmNsYXNzZXMgbXVzdCBiZSBzdXBlcnR5cGVzIG9mXG4gICAqICAgICBwYXJhbWV0ZXJzIHRvIHN0YXRpYyBtZXRob2RzIGluIHN1cGVyY2xhc3Nlcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdGF0aWMgZnJvbUpzb24oanNvbjogQ29tbWVudEJhc2VKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgQ29tbWVudEJhc2Uge1xuICAgIGNvbnN0IG5ld0V2ZW50ID1cbiAgICAgICAgc3VwZXIuZnJvbUpzb24oanNvbiwgd29ya3NwYWNlLCBldmVudCA/PyBuZXcgQ29tbWVudEJhc2UoKSkgYXNcbiAgICAgICAgQ29tbWVudEJhc2U7XG4gICAgbmV3RXZlbnQuY29tbWVudElkID0ganNvblsnY29tbWVudElkJ107XG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBmdW5jdGlvbiBmb3IgQ29tbWVudFtDcmVhdGV8RGVsZXRlXVxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIHJ1bi5cbiAgICogQHBhcmFtIGNyZWF0ZSBpZiBUcnVlIHRoZW4gQ3JlYXRlLCBpZiBGYWxzZSB0aGVuIERlbGV0ZVxuICAgKi9cbiAgc3RhdGljIENvbW1lbnRDcmVhdGVEZWxldGVIZWxwZXIoXG4gICAgICBldmVudDogQ29tbWVudENyZWF0ZXxDb21tZW50RGVsZXRlLCBjcmVhdGU6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSBldmVudC5nZXRFdmVudFdvcmtzcGFjZV8oKTtcbiAgICBpZiAoY3JlYXRlKSB7XG4gICAgICBjb25zdCB4bWxFbGVtZW50ID0gdXRpbHNYbWwuY3JlYXRlRWxlbWVudCgneG1sJyk7XG4gICAgICBpZiAoIWV2ZW50LnhtbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vjb3VudGVyZWQgYSBjb21tZW50IGV2ZW50IHdpdGhvdXQgcHJvcGVyIHhtbCcpO1xuICAgICAgfVxuICAgICAgeG1sRWxlbWVudC5hcHBlbmRDaGlsZChldmVudC54bWwpO1xuICAgICAgWG1sLmRvbVRvV29ya3NwYWNlKHhtbEVsZW1lbnQsIHdvcmtzcGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghZXZlbnQuY29tbWVudElkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdUaGUgY29tbWVudCBJRCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgY29tbWVudCB0byAnICtcbiAgICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbW1lbnQgPSB3b3Jrc3BhY2UuZ2V0Q29tbWVudEJ5SWQoZXZlbnQuY29tbWVudElkKTtcbiAgICAgIGlmIChjb21tZW50KSB7XG4gICAgICAgIGNvbW1lbnQuZGlzcG9zZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT25seSBjb21wbGFpbiBhYm91dCByb290LWxldmVsIGJsb2NrLlxuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAnQ2FuXFwndCB1bmNyZWF0ZSBub24tZXhpc3RlbnQgY29tbWVudDogJyArIGV2ZW50LmNvbW1lbnRJZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbWVudEJhc2VKc29uIGV4dGVuZHMgQWJzdHJhY3RFdmVudEpzb24ge1xuICBjb21tZW50SWQ6IHN0cmluZztcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBDbGFzcyBmb3IgY29tbWVudCBjaGFuZ2UgZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkNvbW1lbnRDaGFuZ2UnKTtcblxuaW1wb3J0ICogYXMgZGVwcmVjYXRpb24gZnJvbSAnLi4vdXRpbHMvZGVwcmVjYXRpb24uanMnO1xuaW1wb3J0ICogYXMgcmVnaXN0cnkgZnJvbSAnLi4vcmVnaXN0cnkuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZUNvbW1lbnR9IGZyb20gJy4uL3dvcmtzcGFjZV9jb21tZW50LmpzJztcblxuaW1wb3J0IHtDb21tZW50QmFzZSwgQ29tbWVudEJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19jb21tZW50X2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBjb21tZW50IGNoYW5nZSBldmVudC5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMuQ29tbWVudENoYW5nZVxuICovXG5leHBvcnQgY2xhc3MgQ29tbWVudENoYW5nZSBleHRlbmRzIENvbW1lbnRCYXNlIHtcbiAgb3ZlcnJpZGUgdHlwZSA9IGV2ZW50VXRpbHMuQ09NTUVOVF9DSEFOR0U7XG4gIG9sZENvbnRlbnRzXz86IHN0cmluZztcbiAgbmV3Q29udGVudHNfPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X2NvbW1lbnQgVGhlIGNvbW1lbnQgdGhhdCBpcyBiZWluZyBjaGFuZ2VkLiAgVW5kZWZpbmVkIGZvciBhXG4gICAqICAgICBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG9wdF9vbGRDb250ZW50cyBQcmV2aW91cyBjb250ZW50cyBvZiB0aGUgY29tbWVudC5cbiAgICogQHBhcmFtIG9wdF9uZXdDb250ZW50cyBOZXcgY29udGVudHMgb2YgdGhlIGNvbW1lbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIG9wdF9jb21tZW50PzogV29ya3NwYWNlQ29tbWVudCwgb3B0X29sZENvbnRlbnRzPzogc3RyaW5nLFxuICAgICAgb3B0X25ld0NvbnRlbnRzPzogc3RyaW5nKSB7XG4gICAgc3VwZXIob3B0X2NvbW1lbnQpO1xuXG4gICAgaWYgKCFvcHRfY29tbWVudCkge1xuICAgICAgcmV0dXJuOyAgLy8gQmxhbmsgZXZlbnQgdG8gYmUgcG9wdWxhdGVkIGJ5IGZyb21Kc29uLlxuICAgIH1cblxuICAgIHRoaXMub2xkQ29udGVudHNfID1cbiAgICAgICAgdHlwZW9mIG9wdF9vbGRDb250ZW50cyA9PT0gJ3VuZGVmaW5lZCcgPyAnJyA6IG9wdF9vbGRDb250ZW50cztcbiAgICB0aGlzLm5ld0NvbnRlbnRzXyA9XG4gICAgICAgIHR5cGVvZiBvcHRfbmV3Q29udGVudHMgPT09ICd1bmRlZmluZWQnID8gJycgOiBvcHRfbmV3Q29udGVudHM7XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIHRoZSBldmVudCBhcyBKU09OLlxuICAgKlxuICAgKiBAcmV0dXJucyBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgdG9Kc29uKCk6IENvbW1lbnRDaGFuZ2VKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgQ29tbWVudENoYW5nZUpzb247XG4gICAgaWYgKCF0aGlzLm9sZENvbnRlbnRzXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgb2xkIGNvbnRlbnRzIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YWx1ZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5uZXdDb250ZW50c18pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIG5ldyBjb250ZW50cyBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgdmFsdWUgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBqc29uWydvbGRDb250ZW50cyddID0gdGhpcy5vbGRDb250ZW50c187XG4gICAganNvblsnbmV3Q29udGVudHMnXSA9IHRoaXMubmV3Q29udGVudHNfO1xuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZSB0aGUgSlNPTiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGpzb24gSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIGZyb21Kc29uKGpzb246IENvbW1lbnRDaGFuZ2VKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLkNvbW1lbnRDaGFuZ2UucHJvdG90eXBlLmZyb21Kc29uJywgJ3ZlcnNpb24gOScsXG4gICAgICAgICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuRXZlbnRzLmZyb21Kc29uJyk7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy5vbGRDb250ZW50c18gPSBqc29uWydvbGRDb250ZW50cyddO1xuICAgIHRoaXMubmV3Q29udGVudHNfID0ganNvblsnbmV3Q29udGVudHMnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgQ29tbWVudENoYW5nZSwgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdFxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZlxuICAgKiAgICAgcGFyYW1ldGVycyB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IENvbW1lbnRDaGFuZ2VKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgQ29tbWVudENoYW5nZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBDb21tZW50Q2hhbmdlKCkpIGFzXG4gICAgICAgIENvbW1lbnRDaGFuZ2U7XG4gICAgbmV3RXZlbnQub2xkQ29udGVudHNfID0ganNvblsnb2xkQ29udGVudHMnXTtcbiAgICBuZXdFdmVudC5uZXdDb250ZW50c18gPSBqc29uWyduZXdDb250ZW50cyddO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEb2VzIHRoaXMgZXZlbnQgcmVjb3JkIGFueSBjaGFuZ2Ugb2Ygc3RhdGU/XG4gICAqXG4gICAqIEByZXR1cm5zIEZhbHNlIGlmIHNvbWV0aGluZyBjaGFuZ2VkLlxuICAgKi9cbiAgb3ZlcnJpZGUgaXNOdWxsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9sZENvbnRlbnRzXyA9PT0gdGhpcy5uZXdDb250ZW50c187XG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgY2hhbmdlIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZm9yd2FyZCBUcnVlIGlmIHJ1biBmb3J3YXJkLCBmYWxzZSBpZiBydW4gYmFja3dhcmQgKHVuZG8pLlxuICAgKi9cbiAgb3ZlcnJpZGUgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmdldEV2ZW50V29ya3NwYWNlXygpO1xuICAgIGlmICghdGhpcy5jb21tZW50SWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGNvbW1lbnQgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGNvbW1lbnQgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICBjb25zdCBjb21tZW50ID0gd29ya3NwYWNlLmdldENvbW1lbnRCeUlkKHRoaXMuY29tbWVudElkKTtcbiAgICBpZiAoIWNvbW1lbnQpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2FuXFwndCBjaGFuZ2Ugbm9uLWV4aXN0ZW50IGNvbW1lbnQ6ICcgKyB0aGlzLmNvbW1lbnRJZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNvbnRlbnRzID0gZm9yd2FyZCA/IHRoaXMubmV3Q29udGVudHNfIDogdGhpcy5vbGRDb250ZW50c187XG4gICAgaWYgKCFjb250ZW50cykge1xuICAgICAgaWYgKGZvcndhcmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgJ1RoZSBuZXcgY29udGVudHMgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIHZhbHVlIHRvICcgK1xuICAgICAgICAgICAgJ3RoZSBjb25zdHJ1Y3Rvciwgb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgb2xkIGNvbnRlbnRzIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSB2YWx1ZSB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGNvbW1lbnQuc2V0Q29udGVudChjb250ZW50cyk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb21tZW50Q2hhbmdlSnNvbiBleHRlbmRzIENvbW1lbnRCYXNlSnNvbiB7XG4gIG9sZENvbnRlbnRzOiBzdHJpbmc7XG4gIG5ld0NvbnRlbnRzOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuQ09NTUVOVF9DSEFOR0UsIENvbW1lbnRDaGFuZ2UpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIGZvciBjb21tZW50IGNyZWF0aW9uIGV2ZW50LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5Db21tZW50Q3JlYXRlJyk7XG5cbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VDb21tZW50fSBmcm9tICcuLi93b3Jrc3BhY2VfY29tbWVudC5qcyc7XG5pbXBvcnQgKiBhcyBYbWwgZnJvbSAnLi4veG1sLmpzJztcblxuaW1wb3J0IHtDb21tZW50QmFzZSwgQ29tbWVudEJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19jb21tZW50X2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBjb21tZW50IGNyZWF0aW9uIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5Db21tZW50Q3JlYXRlXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21tZW50Q3JlYXRlIGV4dGVuZHMgQ29tbWVudEJhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5DT01NRU5UX0NSRUFURTtcblxuICB4bWw/OiBFbGVtZW50fERvY3VtZW50RnJhZ21lbnQ7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfY29tbWVudCBUaGUgY3JlYXRlZCBjb21tZW50LlxuICAgKiAgICAgVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0X2NvbW1lbnQ/OiBXb3Jrc3BhY2VDb21tZW50KSB7XG4gICAgc3VwZXIob3B0X2NvbW1lbnQpO1xuXG4gICAgaWYgKCFvcHRfY29tbWVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgdGhpcy54bWwgPSBvcHRfY29tbWVudC50b1htbFdpdGhYWSgpO1xuICB9XG5cbiAgLy8gVE9ETyAoIzEyNjYpOiBcIkZ1bGxcIiBhbmQgXCJtaW5pbWFsXCIgc2VyaWFsaXphdGlvbi5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBDb21tZW50Q3JlYXRlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIENvbW1lbnRDcmVhdGVKc29uO1xuICAgIGlmICghdGhpcy54bWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIGNvbW1lbnQgWE1MIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSBjb21tZW50IHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAganNvblsneG1sJ10gPSBYbWwuZG9tVG9UZXh0KHRoaXMueG1sKTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBDb21tZW50Q3JlYXRlSnNvbikge1xuICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICdCbG9ja2x5LkV2ZW50cy5Db21tZW50Q3JlYXRlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMueG1sID0gWG1sLnRleHRUb0RvbShqc29uWyd4bWwnXSk7XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIENvbW1lbnRDcmVhdGUsIGJ1dCB3ZSBjYW4ndCBzcGVjaWZ5IHRoYXQgZHVlIHRvIHRoZSBmYWN0IHRoYXRcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3ViY2xhc3NlcyBtdXN0IGJlIHN1cGVydHlwZXMgb2ZcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3VwZXJjbGFzc2VzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBDb21tZW50Q3JlYXRlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIENvbW1lbnRDcmVhdGUge1xuICAgIGNvbnN0IG5ld0V2ZW50ID1cbiAgICAgICAgc3VwZXIuZnJvbUpzb24oanNvbiwgd29ya3NwYWNlLCBldmVudCA/PyBuZXcgQ29tbWVudENyZWF0ZSgpKSBhc1xuICAgICAgICBDb21tZW50Q3JlYXRlO1xuICAgIG5ld0V2ZW50LnhtbCA9IFhtbC50ZXh0VG9Eb20oanNvblsneG1sJ10pO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW4gYSBjcmVhdGlvbiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGZvcndhcmQgVHJ1ZSBpZiBydW4gZm9yd2FyZCwgZmFsc2UgaWYgcnVuIGJhY2t3YXJkICh1bmRvKS5cbiAgICovXG4gIG92ZXJyaWRlIHJ1bihmb3J3YXJkOiBib29sZWFuKSB7XG4gICAgQ29tbWVudEJhc2UuQ29tbWVudENyZWF0ZURlbGV0ZUhlbHBlcih0aGlzLCBmb3J3YXJkKTtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1lbnRDcmVhdGVKc29uIGV4dGVuZHMgQ29tbWVudEJhc2VKc29uIHtcbiAgeG1sOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuQ09NTUVOVF9DUkVBVEUsIENvbW1lbnRDcmVhdGUpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIGZvciBjb21tZW50IGRlbGV0aW9uIGV2ZW50LlxuICpcbiAqIEBjbGFzc1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cy5Db21tZW50RGVsZXRlJyk7XG5cbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2VDb21tZW50fSBmcm9tICcuLi93b3Jrc3BhY2VfY29tbWVudC5qcyc7XG5cbmltcG9ydCB7Q29tbWVudEJhc2UsIENvbW1lbnRCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfY29tbWVudF9iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgKiBhcyBYbWwgZnJvbSAnLi4veG1sLmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgYSBjb21tZW50IGRlbGV0aW9uIGV2ZW50LlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5Db21tZW50RGVsZXRlXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21tZW50RGVsZXRlIGV4dGVuZHMgQ29tbWVudEJhc2Uge1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5DT01NRU5UX0RFTEVURTtcbiAgeG1sPzogRWxlbWVudDtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF9jb21tZW50IFRoZSBkZWxldGVkIGNvbW1lbnQuXG4gICAqICAgICBVbmRlZmluZWQgZm9yIGEgYmxhbmsgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfY29tbWVudD86IFdvcmtzcGFjZUNvbW1lbnQpIHtcbiAgICBzdXBlcihvcHRfY29tbWVudCk7XG5cbiAgICBpZiAoIW9wdF9jb21tZW50KSB7XG4gICAgICByZXR1cm47ICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgfVxuXG4gICAgdGhpcy54bWwgPSBvcHRfY29tbWVudC50b1htbFdpdGhYWSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1biBhIGNyZWF0aW9uIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZm9yd2FyZCBUcnVlIGlmIHJ1biBmb3J3YXJkLCBmYWxzZSBpZiBydW4gYmFja3dhcmQgKHVuZG8pLlxuICAgKi9cbiAgb3ZlcnJpZGUgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBDb21tZW50QmFzZS5Db21tZW50Q3JlYXRlRGVsZXRlSGVscGVyKHRoaXMsICFmb3J3YXJkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSB0b0pzb24oKTogQ29tbWVudERlbGV0ZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBDb21tZW50RGVsZXRlSnNvbjtcbiAgICBpZiAoIXRoaXMueG1sKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBjb21tZW50IFhNTCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgY29tbWVudCB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ3htbCddID0gWG1sLmRvbVRvVGV4dCh0aGlzLnhtbCk7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIENvbW1lbnREZWxldGUsIGJ1dCB3ZSBjYW4ndCBzcGVjaWZ5IHRoYXQgZHVlIHRvIHRoZSBmYWN0IHRoYXRcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3ViY2xhc3NlcyBtdXN0IGJlIHN1cGVydHlwZXMgb2ZcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3VwZXJjbGFzc2VzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBDb21tZW50RGVsZXRlSnNvbiwgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIGV2ZW50PzogYW55KTpcbiAgICAgIENvbW1lbnREZWxldGUge1xuICAgIGNvbnN0IG5ld0V2ZW50ID1cbiAgICAgICAgc3VwZXIuZnJvbUpzb24oanNvbiwgd29ya3NwYWNlLCBldmVudCA/PyBuZXcgQ29tbWVudERlbGV0ZSgpKSBhc1xuICAgICAgICBDb21tZW50RGVsZXRlO1xuICAgIG5ld0V2ZW50LnhtbCA9IFhtbC50ZXh0VG9Eb20oanNvblsneG1sJ10pO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1lbnREZWxldGVKc29uIGV4dGVuZHMgQ29tbWVudEJhc2VKc29uIHtcbiAgeG1sOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuQ09NTUVOVF9ERUxFVEUsIENvbW1lbnREZWxldGUpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIENsYXNzIGZvciBjb21tZW50IG1vdmUgZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkNvbW1lbnRNb3ZlJyk7XG5cbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7Q29vcmRpbmF0ZX0gZnJvbSAnLi4vdXRpbHMvY29vcmRpbmF0ZS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlQ29tbWVudH0gZnJvbSAnLi4vd29ya3NwYWNlX2NvbW1lbnQuanMnO1xuXG5pbXBvcnQge0NvbW1lbnRCYXNlLCBDb21tZW50QmFzZUpzb259IGZyb20gJy4vZXZlbnRzX2NvbW1lbnRfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGNvbW1lbnQgbW92ZSBldmVudC4gIENyZWF0ZWQgYmVmb3JlIHRoZSBtb3ZlLlxuICpcbiAqIEBhbGlhcyBCbG9ja2x5LkV2ZW50cy5Db21tZW50TW92ZVxuICovXG5leHBvcnQgY2xhc3MgQ29tbWVudE1vdmUgZXh0ZW5kcyBDb21tZW50QmFzZSB7XG4gIG92ZXJyaWRlIHR5cGUgPSBldmVudFV0aWxzLkNPTU1FTlRfTU9WRTtcbiAgY29tbWVudF8/OiBXb3Jrc3BhY2VDb21tZW50O1xuICBvbGRDb29yZGluYXRlXz86IENvb3JkaW5hdGU7XG4gIC8qKiBUaGUgbG9jYXRpb24gYWZ0ZXIgdGhlIG1vdmUsIGluIHdvcmtzcGFjZSBjb29yZGluYXRlcy4gKi9cbiAgbmV3Q29vcmRpbmF0ZV8/OiBDb29yZGluYXRlO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gb3B0X2NvbW1lbnQgVGhlIGNvbW1lbnQgdGhhdCBpcyBiZWluZyBtb3ZlZC4gIFVuZGVmaW5lZCBmb3IgYSBibGFua1xuICAgKiAgICAgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfY29tbWVudD86IFdvcmtzcGFjZUNvbW1lbnQpIHtcbiAgICBzdXBlcihvcHRfY29tbWVudCk7XG5cbiAgICBpZiAoIW9wdF9jb21tZW50KSB7XG4gICAgICByZXR1cm47ICAvLyBCbGFuayBldmVudCB0byBiZSBwb3B1bGF0ZWQgYnkgZnJvbUpzb24uXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbW1lbnQgdGhhdCBpcyBiZWluZyBtb3ZlZC5cbiAgICAgKi9cbiAgICB0aGlzLmNvbW1lbnRfID0gb3B0X2NvbW1lbnQ7XG5cbiAgICAvKiogVGhlIGxvY2F0aW9uIGJlZm9yZSB0aGUgbW92ZSwgaW4gd29ya3NwYWNlIGNvb3JkaW5hdGVzLiAqL1xuICAgIHRoaXMub2xkQ29vcmRpbmF0ZV8gPSBvcHRfY29tbWVudC5nZXRYWSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCB0aGUgY29tbWVudCdzIG5ldyBsb2NhdGlvbi4gIENhbGxlZCBhZnRlciB0aGUgbW92ZS4gIENhbiBvbmx5IGJlXG4gICAqIGNhbGxlZCBvbmNlLlxuICAgKi9cbiAgcmVjb3JkTmV3KCkge1xuICAgIGlmICh0aGlzLm5ld0Nvb3JkaW5hdGVfKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnVHJpZWQgdG8gcmVjb3JkIHRoZSBuZXcgcG9zaXRpb24gb2YgYSBjb21tZW50IG9uIHRoZSAnICtcbiAgICAgICAgICAnc2FtZSBldmVudCB0d2ljZS4nKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmNvbW1lbnRfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBjb21tZW50IGlzIHVuZGVmaW5lZC4gUGFzcyBhIGNvbW1lbnQgdG8gJyArXG4gICAgICAgICAgJ3RoZSBjb25zdHJ1Y3RvciBpZiB5b3Ugd2FudCB0byB1c2UgdGhlIHJlY29yZCBmdW5jdGlvbmFsaXR5Jyk7XG4gICAgfVxuICAgIHRoaXMubmV3Q29vcmRpbmF0ZV8gPSB0aGlzLmNvbW1lbnRfLmdldFhZKCk7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGUgdGhlIGxvY2F0aW9uIGJlZm9yZSB0aGUgbW92ZS4gIFVzZSB0aGlzIGlmIHlvdSBkb24ndCBjcmVhdGUgdGhlXG4gICAqIGV2ZW50IHVudGlsIHRoZSBlbmQgb2YgdGhlIG1vdmUsIGJ1dCB5b3Uga25vdyB0aGUgb3JpZ2luYWwgbG9jYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB4eSBUaGUgbG9jYXRpb24gYmVmb3JlIHRoZSBtb3ZlLCBpbiB3b3Jrc3BhY2UgY29vcmRpbmF0ZXMuXG4gICAqL1xuICBzZXRPbGRDb29yZGluYXRlKHh5OiBDb29yZGluYXRlKSB7XG4gICAgdGhpcy5vbGRDb29yZGluYXRlXyA9IHh5O1xuICB9XG5cbiAgLy8gVE9ETyAoIzEyNjYpOiBcIkZ1bGxcIiBhbmQgXCJtaW5pbWFsXCIgc2VyaWFsaXphdGlvbi5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBDb21tZW50TW92ZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBDb21tZW50TW92ZUpzb247XG4gICAgaWYgKCF0aGlzLm9sZENvb3JkaW5hdGVfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBvbGQgY29tbWVudCBwb3NpdGlvbiBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgY29tbWVudCB0byAnICtcbiAgICAgICAgICAndGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5uZXdDb29yZGluYXRlXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgbmV3IGNvbW1lbnQgcG9zaXRpb24gaXMgdW5kZWZpbmVkLiBFaXRoZXIgY2FsbCByZWNvcmROZXcsIG9yICcgK1xuICAgICAgICAgICdjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGpzb25bJ29sZENvb3JkaW5hdGUnXSA9IGAke01hdGgucm91bmQodGhpcy5vbGRDb29yZGluYXRlXy54KX0sIGAgK1xuICAgICAgICBgJHtNYXRoLnJvdW5kKHRoaXMub2xkQ29vcmRpbmF0ZV8ueSl9YDtcbiAgICBqc29uWyduZXdDb29yZGluYXRlJ10gPSBNYXRoLnJvdW5kKHRoaXMubmV3Q29vcmRpbmF0ZV8ueCkgKyAnLCcgK1xuICAgICAgICBNYXRoLnJvdW5kKHRoaXMubmV3Q29vcmRpbmF0ZV8ueSk7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogQ29tbWVudE1vdmVKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLkNvbW1lbnRNb3ZlLnByb3RvdHlwZS5mcm9tSnNvbicsICd2ZXJzaW9uIDknLFxuICAgICAgICAndmVyc2lvbiAxMCcsICdCbG9ja2x5LkV2ZW50cy5mcm9tSnNvbicpO1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIGxldCB4eSA9IGpzb25bJ29sZENvb3JkaW5hdGUnXS5zcGxpdCgnLCcpO1xuICAgIHRoaXMub2xkQ29vcmRpbmF0ZV8gPSBuZXcgQ29vcmRpbmF0ZShOdW1iZXIoeHlbMF0pLCBOdW1iZXIoeHlbMV0pKTtcbiAgICB4eSA9IGpzb25bJ25ld0Nvb3JkaW5hdGUnXS5zcGxpdCgnLCcpO1xuICAgIHRoaXMubmV3Q29vcmRpbmF0ZV8gPSBuZXcgQ29vcmRpbmF0ZShOdW1iZXIoeHlbMF0pLCBOdW1iZXIoeHlbMV0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgdG8gYXBwZW5kIG5ldyBwcm9wZXJ0aWVzIHRvLiBTaG91bGQgYmUgYSBzdWJjbGFzc1xuICAgKiAgICAgb2YgQ29tbWVudE1vdmUsIGJ1dCB3ZSBjYW4ndCBzcGVjaWZ5IHRoYXQgZHVlIHRvIHRoZSBmYWN0IHRoYXRcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3ViY2xhc3NlcyBtdXN0IGJlIHN1cGVydHlwZXMgb2ZcbiAgICogICAgIHBhcmFtZXRlcnMgdG8gc3RhdGljIG1ldGhvZHMgaW4gc3VwZXJjbGFzc2VzLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBDb21tZW50TW92ZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlLCBldmVudD86IGFueSk6XG4gICAgICBDb21tZW50TW92ZSB7XG4gICAgY29uc3QgbmV3RXZlbnQgPVxuICAgICAgICBzdXBlci5mcm9tSnNvbihqc29uLCB3b3Jrc3BhY2UsIGV2ZW50ID8/IG5ldyBDb21tZW50TW92ZSgpKSBhc1xuICAgICAgICBDb21tZW50TW92ZTtcbiAgICBsZXQgeHkgPSBqc29uWydvbGRDb29yZGluYXRlJ10uc3BsaXQoJywnKTtcbiAgICBuZXdFdmVudC5vbGRDb29yZGluYXRlXyA9IG5ldyBDb29yZGluYXRlKE51bWJlcih4eVswXSksIE51bWJlcih4eVsxXSkpO1xuICAgIHh5ID0ganNvblsnbmV3Q29vcmRpbmF0ZSddLnNwbGl0KCcsJyk7XG4gICAgbmV3RXZlbnQubmV3Q29vcmRpbmF0ZV8gPSBuZXcgQ29vcmRpbmF0ZShOdW1iZXIoeHlbMF0pLCBOdW1iZXIoeHlbMV0pKTtcbiAgICByZXR1cm4gbmV3RXZlbnQ7XG4gIH1cblxuICAvKipcbiAgICogRG9lcyB0aGlzIGV2ZW50IHJlY29yZCBhbnkgY2hhbmdlIG9mIHN0YXRlP1xuICAgKlxuICAgKiBAcmV0dXJucyBGYWxzZSBpZiBzb21ldGhpbmcgY2hhbmdlZC5cbiAgICovXG4gIG92ZXJyaWRlIGlzTnVsbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQ29vcmRpbmF0ZS5lcXVhbHModGhpcy5vbGRDb29yZGluYXRlXywgdGhpcy5uZXdDb29yZGluYXRlXyk7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgbW92ZSBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGZvcndhcmQgVHJ1ZSBpZiBydW4gZm9yd2FyZCwgZmFsc2UgaWYgcnVuIGJhY2t3YXJkICh1bmRvKS5cbiAgICovXG4gIG92ZXJyaWRlIHJ1bihmb3J3YXJkOiBib29sZWFuKSB7XG4gICAgY29uc3Qgd29ya3NwYWNlID0gdGhpcy5nZXRFdmVudFdvcmtzcGFjZV8oKTtcbiAgICBpZiAoIXRoaXMuY29tbWVudElkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1RoZSBjb21tZW50IElEIGlzIHVuZGVmaW5lZC4gRWl0aGVyIHBhc3MgYSBjb21tZW50IHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAgY29uc3QgY29tbWVudCA9IHdvcmtzcGFjZS5nZXRDb21tZW50QnlJZCh0aGlzLmNvbW1lbnRJZCk7XG4gICAgaWYgKCFjb21tZW50KSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NhblxcJ3QgbW92ZSBub24tZXhpc3RlbnQgY29tbWVudDogJyArIHRoaXMuY29tbWVudElkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXQgPSBmb3J3YXJkID8gdGhpcy5uZXdDb29yZGluYXRlXyA6IHRoaXMub2xkQ29vcmRpbmF0ZV87XG4gICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnRWl0aGVyIG9sZENvb3JkaW5hdGVfIG9yIG5ld0Nvb3JkaW5hdGVfIGlzIHVuZGVmaW5lZC4gJyArXG4gICAgICAgICAgJ0VpdGhlciBwYXNzIGEgY29tbWVudCB0byB0aGUgY29uc3RydWN0b3IgYW5kIGNhbGwgcmVjb3JkTmV3LCAnICtcbiAgICAgICAgICAnb3IgY2FsbCBmcm9tSnNvbicpO1xuICAgIH1cbiAgICAvLyBUT0RPOiBDaGVjayBpZiB0aGUgY29tbWVudCBpcyBiZWluZyBkcmFnZ2VkLCBhbmQgZ2l2ZSB1cCBpZiBzby5cbiAgICBjb25zdCBjdXJyZW50ID0gY29tbWVudC5nZXRYWSgpO1xuICAgIGNvbW1lbnQubW92ZUJ5KHRhcmdldC54IC0gY3VycmVudC54LCB0YXJnZXQueSAtIGN1cnJlbnQueSk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb21tZW50TW92ZUpzb24gZXh0ZW5kcyBDb21tZW50QmFzZUpzb24ge1xuICBvbGRDb29yZGluYXRlOiBzdHJpbmc7XG4gIG5ld0Nvb3JkaW5hdGU6IHN0cmluZztcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5DT01NRU5UX01PVkUsIENvbW1lbnRNb3ZlKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHtBYnN0cmFjdCBhcyBBYnN0cmFjdEV2ZW50LCBBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0IHR5cGUge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5cbi8qKlxuICogVGhlIGJhc2UgZXZlbnQgZm9yIGFuIGV2ZW50IGFzc29jaWF0ZWQgd2l0aCBhIHByb2NlZHVyZS5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFByb2NlZHVyZUJhc2UgZXh0ZW5kcyBBYnN0cmFjdEV2ZW50IHtcbiAgaXNCbGFuayA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKHdvcmtzcGFjZTogV29ya3NwYWNlLCBwdWJsaWMgcmVhZG9ubHkgbW9kZWw6IElQcm9jZWR1cmVNb2RlbCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy53b3Jrc3BhY2VJZCA9IHdvcmtzcGFjZS5pZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICB0b0pzb24oKTogUHJvY2VkdXJlQmFzZUpzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBQcm9jZWR1cmVCYXNlSnNvbjtcbiAgICBqc29uWydwcm9jZWR1cmVJZCddID0gdGhpcy5tb2RlbC5nZXRJZCgpO1xuICAgIHJldHVybiBqc29uO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvY2VkdXJlQmFzZUpzb24gZXh0ZW5kcyBBYnN0cmFjdEV2ZW50SnNvbiB7XG4gIHByb2NlZHVyZUlkOiBzdHJpbmc7XG59XG4iLCJcbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHR5cGUge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5pbXBvcnQge1Byb2NlZHVyZUJhc2UsIFByb2NlZHVyZUJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHByb2NlZHVyZSdzIHJldHVybiB0eXBlL3N0YXR1cyBjaGFuZ2luZy5cbiAqL1xuZXhwb3J0IGNsYXNzIFByb2NlZHVyZUNoYW5nZVJldHVybiBleHRlbmRzIFByb2NlZHVyZUJhc2Uge1xuICAvKiogQSBzdHJpbmcgdXNlZCB0byBjaGVjayB0aGUgdHlwZSBvZiB0aGUgZXZlbnQuICovXG4gIHR5cGUgPSBldmVudFV0aWxzLlBST0NFRFVSRV9DSEFOR0VfUkVUVVJOO1xuXG4gIC8qKiBUaGUgbmV3IHR5cGUocykgdGhlIHByb2NlZHVyZSdzIHJldHVybiBoYXMgYmVlbiBzZXQgdG8uICovXG4gIHByaXZhdGUgbmV3VHlwZXM6IHN0cmluZ1tdfG51bGw7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvbGRUeXBlcyBUaGUgdHlwZShzKSB0aGUgcHJvY2VkdXJlJ3MgcmV0dXJuIHdhcyBzZXQgdG8gYmVmb3JlIGl0XG4gICAqICAgICBjaGFuZ2VkLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICB3b3JrcGFjZTogV29ya3NwYWNlLCBtb2RlbDogSVByb2NlZHVyZU1vZGVsLFxuICAgICAgcHVibGljIHJlYWRvbmx5IG9sZFR5cGVzOiBzdHJpbmdbXXxudWxsKSB7XG4gICAgc3VwZXIod29ya3BhY2UsIG1vZGVsKTtcblxuICAgIHRoaXMubmV3VHlwZXMgPSBtb2RlbC5nZXRSZXR1cm5UeXBlcygpO1xuICB9XG5cbiAgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCBwcm9jZWR1cmVNb2RlbCA9XG4gICAgICAgIHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCkuZ2V0UHJvY2VkdXJlTWFwKCkuZ2V0KHRoaXMubW9kZWwuZ2V0SWQoKSk7XG4gICAgaWYgKCFwcm9jZWR1cmVNb2RlbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgY2hhbmdlIHRoZSB0eXBlIG9mIGEgcHJvY2VkdXJlIHRoYXQgZG9lcyBub3QgZXhpc3QgJyArXG4gICAgICAgICAgJ2luIHRoZSBwcm9jZWR1cmUgbWFwJyk7XG4gICAgfVxuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICBwcm9jZWR1cmVNb2RlbC5zZXRSZXR1cm5UeXBlcyh0aGlzLm5ld1R5cGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvY2VkdXJlTW9kZWwuc2V0UmV0dXJuVHlwZXModGhpcy5vbGRUeXBlcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIHRvSnNvbigpOiBQcm9jZWR1cmVDaGFuZ2VSZXR1cm5Kc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgUHJvY2VkdXJlQ2hhbmdlUmV0dXJuSnNvbjtcbiAgICBqc29uWydvbGRUeXBlcyddID0gdGhpcy5vbGRUeXBlcztcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IFByb2NlZHVyZUNoYW5nZVJldHVybkpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlKTpcbiAgICAgIFByb2NlZHVyZUNoYW5nZVJldHVybiB7XG4gICAgY29uc3QgbW9kZWwgPSB3b3Jrc3BhY2UuZ2V0UHJvY2VkdXJlTWFwKCkuZ2V0KGpzb25bJ3Byb2NlZHVyZUlkJ10pO1xuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IGRlc2VyaWFsaXplIHByb2NlZHVyZSBjaGFuZ2UgcmV0dXJuIGV2ZW50IGJlY2F1c2UgdGhlICcgK1xuICAgICAgICAgICd0YXJnZXQgcHJvY2VkdXJlIGRvZXMgbm90IGV4aXN0Jyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUHJvY2VkdXJlQ2hhbmdlUmV0dXJuKHdvcmtzcGFjZSwgbW9kZWwsIGpzb25bJ29sZFR5cGVzJ10pO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvY2VkdXJlQ2hhbmdlUmV0dXJuSnNvbiBleHRlbmRzIFByb2NlZHVyZUJhc2VKc29uIHtcbiAgb2xkVHlwZXM6IHN0cmluZ1tdfG51bGw7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuUFJPQ0VEVVJFX0NIQU5HRV9SRVRVUk4sXG4gICAgUHJvY2VkdXJlQ2hhbmdlUmV0dXJuKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHR5cGUge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQge09ic2VydmFibGVQYXJhbWV0ZXJNb2RlbCwgT2JzZXJ2YWJsZVByb2NlZHVyZU1vZGVsfSBmcm9tICcuLi9wcm9jZWR1cmVzLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7bG9hZFByb2NlZHVyZSwgc2F2ZVByb2NlZHVyZSwgU3RhdGUgYXMgUHJvY2VkdXJlU3RhdGV9IGZyb20gJy4uL3NlcmlhbGl6YXRpb24vcHJvY2VkdXJlcy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5pbXBvcnQge1Byb2NlZHVyZUJhc2UsIFByb2NlZHVyZUJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHByb2NlZHVyZSBkYXRhIG1vZGVsIGJlaW5nIGNyZWF0ZWQuXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmVDcmVhdGUgZXh0ZW5kcyBQcm9jZWR1cmVCYXNlIHtcbiAgLyoqIEEgc3RyaW5nIHVzZWQgdG8gY2hlY2sgdGhlIHR5cGUgb2YgdGhlIGV2ZW50LiAqL1xuICB0eXBlID0gZXZlbnRVdGlscy5QUk9DRURVUkVfQ1JFQVRFO1xuXG4gIGNvbnN0cnVjdG9yKHdvcmtzcGFjZTogV29ya3NwYWNlLCBtb2RlbDogSVByb2NlZHVyZU1vZGVsKSB7XG4gICAgc3VwZXIod29ya3NwYWNlLCBtb2RlbCk7XG4gIH1cblxuICBydW4oZm9yd2FyZDogYm9vbGVhbikge1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCk7XG4gICAgY29uc3QgcHJvY2VkdXJlTWFwID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpO1xuICAgIGNvbnN0IHByb2NlZHVyZU1vZGVsID0gcHJvY2VkdXJlTWFwLmdldCh0aGlzLm1vZGVsLmdldElkKCkpO1xuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICBpZiAocHJvY2VkdXJlTW9kZWwpIHJldHVybjtcbiAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIGFkZCB0aGUgbW9kZWwgdG8gdGhlIG1hcCBpbnN0ZWFkIG9mIGNyZWF0aW5nIGEgZHVwZS5cbiAgICAgIHByb2NlZHVyZU1hcC5hZGQobmV3IE9ic2VydmFibGVQcm9jZWR1cmVNb2RlbChcbiAgICAgICAgICB3b3Jrc3BhY2UsIHRoaXMubW9kZWwuZ2V0TmFtZSgpLCB0aGlzLm1vZGVsLmdldElkKCkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFwcm9jZWR1cmVNb2RlbCkgcmV0dXJuO1xuICAgICAgcHJvY2VkdXJlTWFwLmRlbGV0ZSh0aGlzLm1vZGVsLmdldElkKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICB0b0pzb24oKTogUHJvY2VkdXJlQ3JlYXRlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIFByb2NlZHVyZUNyZWF0ZUpzb247XG4gICAganNvblsnbW9kZWwnXSA9IHNhdmVQcm9jZWR1cmUodGhpcy5tb2RlbCk7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBQcm9jZWR1cmVDcmVhdGVKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6XG4gICAgICBQcm9jZWR1cmVDcmVhdGUge1xuICAgIHJldHVybiBuZXcgUHJvY2VkdXJlQ3JlYXRlKFxuICAgICAgICB3b3Jrc3BhY2UsXG4gICAgICAgIGxvYWRQcm9jZWR1cmUoXG4gICAgICAgICAgICBPYnNlcnZhYmxlUHJvY2VkdXJlTW9kZWwsIE9ic2VydmFibGVQYXJhbWV0ZXJNb2RlbCwganNvblsnbW9kZWwnXSxcbiAgICAgICAgICAgIHdvcmtzcGFjZSkpO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvY2VkdXJlQ3JlYXRlSnNvbiBleHRlbmRzIFByb2NlZHVyZUJhc2VKc29uIHtcbiAgbW9kZWw6IFByb2NlZHVyZVN0YXRlLFxufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihcbiAgICByZWdpc3RyeS5UeXBlLkVWRU5ULCBldmVudFV0aWxzLlBST0NFRFVSRV9DUkVBVEUsIFByb2NlZHVyZUNyZWF0ZSk7XG4iLCJcbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHR5cGUge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5pbXBvcnQge09ic2VydmFibGVQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vcHJvY2VkdXJlcy5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5pbXBvcnQge1Byb2NlZHVyZUJhc2UsIFByb2NlZHVyZUJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHByb2NlZHVyZSBkYXRhIG1vZGVsIGJlaW5nIGRlbGV0ZWQuXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmVEZWxldGUgZXh0ZW5kcyBQcm9jZWR1cmVCYXNlIHtcbiAgLyoqIEEgc3RyaW5nIHVzZWQgdG8gY2hlY2sgdGhlIHR5cGUgb2YgdGhlIGV2ZW50LiAqL1xuICB0eXBlID0gZXZlbnRVdGlscy5QUk9DRURVUkVfREVMRVRFO1xuXG4gIGNvbnN0cnVjdG9yKHdvcmtzcGFjZTogV29ya3NwYWNlLCBtb2RlbDogSVByb2NlZHVyZU1vZGVsKSB7XG4gICAgc3VwZXIod29ya3NwYWNlLCBtb2RlbCk7XG4gIH1cblxuICBydW4oZm9yd2FyZDogYm9vbGVhbikge1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCk7XG4gICAgY29uc3QgcHJvY2VkdXJlTWFwID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpO1xuICAgIGNvbnN0IHByb2NlZHVyZU1vZGVsID0gcHJvY2VkdXJlTWFwLmdldCh0aGlzLm1vZGVsLmdldElkKCkpO1xuICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICBpZiAoIXByb2NlZHVyZU1vZGVsKSByZXR1cm47XG4gICAgICBwcm9jZWR1cmVNYXAuZGVsZXRlKHRoaXMubW9kZWwuZ2V0SWQoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcm9jZWR1cmVNb2RlbCkgcmV0dXJuO1xuICAgICAgcHJvY2VkdXJlTWFwLmFkZChuZXcgT2JzZXJ2YWJsZVByb2NlZHVyZU1vZGVsKFxuICAgICAgICAgIHdvcmtzcGFjZSwgdGhpcy5tb2RlbC5nZXROYW1lKCksIHRoaXMubW9kZWwuZ2V0SWQoKSkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICB0b0pzb24oKTogUHJvY2VkdXJlRGVsZXRlSnNvbiB7XG4gICAgcmV0dXJuIHN1cGVyLnRvSnNvbigpIGFzIFByb2NlZHVyZURlbGV0ZUpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBQcm9jZWR1cmVEZWxldGVKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6XG4gICAgICBQcm9jZWR1cmVEZWxldGUge1xuICAgIGNvbnN0IG1vZGVsID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpLmdldChqc29uWydwcm9jZWR1cmVJZCddKTtcbiAgICBpZiAoIW1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBkZXNlcmlhbGl6ZSBwcm9jZWR1cmUgZGVsZXRlIGV2ZW50IGJlY2F1c2UgdGhlICcgK1xuICAgICAgICAgICd0YXJnZXQgcHJvY2VkdXJlIGRvZXMgbm90IGV4aXN0Jyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUHJvY2VkdXJlRGVsZXRlKHdvcmtzcGFjZSwgbW9kZWwpO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvY2VkdXJlRGVsZXRlSnNvbiBleHRlbmRzIFByb2NlZHVyZUJhc2VKc29uIHt9XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuUFJPQ0VEVVJFX0RFTEVURSwgUHJvY2VkdXJlRGVsZXRlKTtcbiIsIlxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgdHlwZSB7SVByb2NlZHVyZU1vZGVsfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfcHJvY2VkdXJlX21vZGVsLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cbmltcG9ydCB7UHJvY2VkdXJlQmFzZSwgUHJvY2VkdXJlQmFzZUpzb259IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHByb2NlZHVyZSBkYXRhIG1vZGVsIGJlaW5nIGVuYWJsZWQgb3IgZGlzYWJsZWQuXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmVFbmFibGUgZXh0ZW5kcyBQcm9jZWR1cmVCYXNlIHtcbiAgLyoqIEEgc3RyaW5nIHVzZWQgdG8gY2hlY2sgdGhlIHR5cGUgb2YgdGhlIGV2ZW50LiAqL1xuICB0eXBlID0gZXZlbnRVdGlscy5QUk9DRURVUkVfRU5BQkxFO1xuXG4gIHByaXZhdGUgb2xkU3RhdGU6IGJvb2xlYW47XG4gIHByaXZhdGUgbmV3U3RhdGU6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3Iod29ya3NwYWNlOiBXb3Jrc3BhY2UsIG1vZGVsOiBJUHJvY2VkdXJlTW9kZWwpIHtcbiAgICBzdXBlcih3b3Jrc3BhY2UsIG1vZGVsKTtcblxuICAgIHRoaXMub2xkU3RhdGUgPSAhbW9kZWwuZ2V0RW5hYmxlZCgpO1xuICAgIHRoaXMubmV3U3RhdGUgPSBtb2RlbC5nZXRFbmFibGVkKCk7XG4gIH1cblxuICBydW4oZm9yd2FyZDogYm9vbGVhbikge1xuICAgIGNvbnN0IHByb2NlZHVyZU1vZGVsID1cbiAgICAgICAgdGhpcy5nZXRFdmVudFdvcmtzcGFjZV8oKS5nZXRQcm9jZWR1cmVNYXAoKS5nZXQodGhpcy5tb2RlbC5nZXRJZCgpKTtcbiAgICBpZiAoIXByb2NlZHVyZU1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBjaGFuZ2UgdGhlIGVuYWJsZWQgc3RhdGUgb2YgYSBwcm9jZWR1cmUgdGhhdCBkb2VzIG5vdCAnICtcbiAgICAgICAgICAnZXhpc3QgaW4gdGhlIHByb2NlZHVyZSBtYXAnKTtcbiAgICB9XG4gICAgaWYgKGZvcndhcmQpIHtcbiAgICAgIHByb2NlZHVyZU1vZGVsLnNldEVuYWJsZWQodGhpcy5uZXdTdGF0ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb2NlZHVyZU1vZGVsLnNldEVuYWJsZWQodGhpcy5vbGRTdGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIHRvSnNvbigpOiBQcm9jZWR1cmVFbmFibGVKc29uIHtcbiAgICByZXR1cm4gc3VwZXIudG9Kc29uKCkgYXMgUHJvY2VkdXJlRW5hYmxlSnNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IFByb2NlZHVyZUVuYWJsZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlKTpcbiAgICAgIFByb2NlZHVyZUVuYWJsZSB7XG4gICAgY29uc3QgbW9kZWwgPSB3b3Jrc3BhY2UuZ2V0UHJvY2VkdXJlTWFwKCkuZ2V0KGpzb25bJ3Byb2NlZHVyZUlkJ10pO1xuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IGRlc2VyaWFsaXplIHByb2NlZHVyZSBlbmFibGUgZXZlbnQgYmVjYXVzZSB0aGUgJyArXG4gICAgICAgICAgJ3RhcmdldCBwcm9jZWR1cmUgZG9lcyBub3QgZXhpc3QnKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQcm9jZWR1cmVFbmFibGUod29ya3NwYWNlLCBtb2RlbCk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQcm9jZWR1cmVFbmFibGVKc29uIGV4dGVuZHMgUHJvY2VkdXJlQmFzZUpzb24ge31cblxucmVnaXN0cnkucmVnaXN0ZXIoXG4gICAgcmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5QUk9DRURVUkVfRU5BQkxFLCBQcm9jZWR1cmVFbmFibGUpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgdHlwZSB7SVByb2NlZHVyZU1vZGVsfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfcHJvY2VkdXJlX21vZGVsLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cbmltcG9ydCB7UHJvY2VkdXJlQmFzZSwgUHJvY2VkdXJlQmFzZUpzb259IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHByb2NlZHVyZSBiZWluZyByZW5hbWVkLlxuICovXG5leHBvcnQgY2xhc3MgUHJvY2VkdXJlUmVuYW1lIGV4dGVuZHMgUHJvY2VkdXJlQmFzZSB7XG4gIC8qKiBBIHN0cmluZyB1c2VkIHRvIGNoZWNrIHRoZSB0eXBlIG9mIHRoZSBldmVudC4gKi9cbiAgdHlwZSA9IGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1JFTkFNRTtcbiAgcHJpdmF0ZSBuZXdOYW1lOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgbW9kZWw6IElQcm9jZWR1cmVNb2RlbCxcbiAgICAgIHB1YmxpYyByZWFkb25seSBvbGROYW1lOiBzdHJpbmcpIHtcbiAgICBzdXBlcih3b3Jrc3BhY2UsIG1vZGVsKTtcblxuICAgIHRoaXMubmV3TmFtZSA9IG1vZGVsLmdldE5hbWUoKTtcbiAgfVxuXG4gIHJ1bihmb3J3YXJkOiBib29sZWFuKSB7XG4gICAgY29uc3QgcHJvY2VkdXJlTW9kZWwgPVxuICAgICAgICB0aGlzLmdldEV2ZW50V29ya3NwYWNlXygpLmdldFByb2NlZHVyZU1hcCgpLmdldCh0aGlzLm1vZGVsLmdldElkKCkpO1xuICAgIGlmICghcHJvY2VkdXJlTW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IGNoYW5nZSB0aGUgdHlwZSBvZiBhIHByb2NlZHVyZSB0aGF0IGRvZXMgbm90IGV4aXN0ICcgK1xuICAgICAgICAgICdpbiB0aGUgcHJvY2VkdXJlIG1hcCcpO1xuICAgIH1cbiAgICBpZiAoZm9yd2FyZCkge1xuICAgICAgcHJvY2VkdXJlTW9kZWwuc2V0TmFtZSh0aGlzLm5ld05hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcm9jZWR1cmVNb2RlbC5zZXROYW1lKHRoaXMub2xkTmFtZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIHRvSnNvbigpOiBQcm9jZWR1cmVSZW5hbWVKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgUHJvY2VkdXJlUmVuYW1lSnNvbjtcbiAgICBqc29uWydvbGROYW1lJ10gPSB0aGlzLm9sZE5hbWU7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBQcm9jZWR1cmVSZW5hbWVKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6XG4gICAgICBQcm9jZWR1cmVSZW5hbWUge1xuICAgIGNvbnN0IG1vZGVsID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpLmdldChqc29uWydwcm9jZWR1cmVJZCddKTtcbiAgICBpZiAoIW1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBkZXNlcmlhbGl6ZSBwcm9jZWR1cmUgcmVuYW1lIGV2ZW50IGJlY2F1c2UgdGhlICcgK1xuICAgICAgICAgICd0YXJnZXQgcHJvY2VkdXJlIGRvZXMgbm90IGV4aXN0Jyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUHJvY2VkdXJlUmVuYW1lKHdvcmtzcGFjZSwgbW9kZWwsIGpzb25bJ29sZE5hbWUnXSk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQcm9jZWR1cmVSZW5hbWVKc29uIGV4dGVuZHMgUHJvY2VkdXJlQmFzZUpzb24ge1xuICBvbGROYW1lOiBzdHJpbmc7XG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1JFTkFNRSwgUHJvY2VkdXJlUmVuYW1lKTtcbiIsIlxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQge0lQYXJhbWV0ZXJNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3BhcmFtZXRlcl9tb2RlbC5qcyc7XG5pbXBvcnQge0lQcm9jZWR1cmVNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3Byb2NlZHVyZV9tb2RlbC5qcyc7XG5cbmltcG9ydCB7UHJvY2VkdXJlQmFzZSwgUHJvY2VkdXJlQmFzZUpzb259IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9iYXNlLmpzJztcblxuaW1wb3J0IHR5cGUge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuLyoqXG4gKiBUaGUgYmFzZSBldmVudCBmb3IgYW4gZXZlbnQgYXNzb2NpYXRlZCB3aXRoIGEgcHJvY2VkdXJlIHBhcmFtZXRlci5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFByb2NlZHVyZVBhcmFtZXRlckJhc2UgZXh0ZW5kcyBQcm9jZWR1cmVCYXNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgbW9kZWw6IElQcm9jZWR1cmVNb2RlbCxcbiAgICAgIHB1YmxpYyByZWFkb25seSBwYXJhbWV0ZXI6IElQYXJhbWV0ZXJNb2RlbCkge1xuICAgIHN1cGVyKHdvcmtzcGFjZSwgbW9kZWwpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIHRvSnNvbigpOiBQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIFByb2NlZHVyZVBhcmFtZXRlckJhc2VKc29uO1xuICAgIGpzb25bJ3BhcmFtZXRlcklkJ10gPSB0aGlzLm1vZGVsLmdldElkKCk7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlSnNvbiBleHRlbmRzIFByb2NlZHVyZUJhc2VKc29uIHtcbiAgcGFyYW1ldGVySWQ6IHN0cmluZyxcbn1cbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHR5cGUge0lQYXJhbWV0ZXJNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3BhcmFtZXRlcl9tb2RlbC5qcyc7XG5pbXBvcnQgdHlwZSB7SVByb2NlZHVyZU1vZGVsfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfcHJvY2VkdXJlX21vZGVsLmpzJztcbmltcG9ydCB7T2JzZXJ2YWJsZVBhcmFtZXRlck1vZGVsfSBmcm9tICcuLi9wcm9jZWR1cmVzL29ic2VydmFibGVfcGFyYW1ldGVyX21vZGVsLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7bG9hZFBhcmFtZXRlciwgUGFyYW1ldGVyU3RhdGUsIHNhdmVQYXJhbWV0ZXJ9IGZyb20gJy4uL3NlcmlhbGl6YXRpb24vcHJvY2VkdXJlcy5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuXG5pbXBvcnQge1Byb2NlZHVyZVBhcmFtZXRlckJhc2UsIFByb2NlZHVyZVBhcmFtZXRlckJhc2VKc29ufSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfcGFyYW1ldGVyX2Jhc2UuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcblxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBwYXJhbWV0ZXIgYmVpbmcgYWRkZWQgdG8gYSBwcm9jZWR1cmUuXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmVQYXJhbWV0ZXJDcmVhdGUgZXh0ZW5kcyBQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlIHtcbiAgLyoqIEEgc3RyaW5nIHVzZWQgdG8gY2hlY2sgdGhlIHR5cGUgb2YgdGhlIGV2ZW50LiAqL1xuICB0eXBlID0gZXZlbnRVdGlscy5QUk9DRURVUkVfUEFSQU1FVEVSX0NSRUFURTtcblxuICAvKipcbiAgICogQHBhcmFtIHBhcmFtZXRlciBUaGUgcGFyYW1ldGVyIG1vZGVsIHRoYXQgd2FzIGp1c3QgYWRkZWQgdG8gdGhlIHByb2NlZHVyZS5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGUgcGFyYW1ldGVyIHdhcyBpbnNlcnRlZCBhdC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgICAgd29ya3NwYWNlOiBXb3Jrc3BhY2UsIHByb2NlZHVyZTogSVByb2NlZHVyZU1vZGVsLFxuICAgICAgcGFyYW1ldGVyOiBJUGFyYW1ldGVyTW9kZWwsIHB1YmxpYyByZWFkb25seSBpbmRleDogbnVtYmVyKSB7XG4gICAgc3VwZXIod29ya3NwYWNlLCBwcm9jZWR1cmUsIHBhcmFtZXRlcik7XG4gIH1cblxuICBydW4oZm9yd2FyZDogYm9vbGVhbikge1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMuZ2V0RXZlbnRXb3Jrc3BhY2VfKCk7XG4gICAgY29uc3QgcHJvY2VkdXJlTWFwID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpO1xuICAgIGNvbnN0IHByb2NlZHVyZU1vZGVsID0gcHJvY2VkdXJlTWFwLmdldCh0aGlzLm1vZGVsLmdldElkKCkpO1xuICAgIGlmICghcHJvY2VkdXJlTW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ2Fubm90IGFkZCBhIHBhcmFtZXRlciB0byBhIHByb2NlZHVyZSB0aGF0IGRvZXMgbm90IGV4aXN0ICcgK1xuICAgICAgICAgICdpbiB0aGUgcHJvY2VkdXJlIG1hcCcpO1xuICAgIH1cbiAgICBjb25zdCBwYXJhbWV0ZXJNb2RlbCA9IHByb2NlZHVyZU1vZGVsLmdldFBhcmFtZXRlcih0aGlzLmluZGV4KTtcbiAgICBpZiAoZm9yd2FyZCkge1xuICAgICAgaWYgKHRoaXMucGFyYW1ldGVyTWF0Y2hlcyhwYXJhbWV0ZXJNb2RlbCkpIHJldHVybjtcbiAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIGp1c3QgYWRkIHRoZSBwYXJhbWV0ZXIgaW5zdGVhZCBvZiBjcmVhdGluZyBhIGR1cGUuXG4gICAgICBwcm9jZWR1cmVNb2RlbC5pbnNlcnRQYXJhbWV0ZXIoXG4gICAgICAgICAgbmV3IE9ic2VydmFibGVQYXJhbWV0ZXJNb2RlbChcbiAgICAgICAgICAgICAgd29ya3NwYWNlLCB0aGlzLnBhcmFtZXRlci5nZXROYW1lKCksIHRoaXMucGFyYW1ldGVyLmdldElkKCkpLFxuICAgICAgICAgIHRoaXMuaW5kZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIXRoaXMucGFyYW1ldGVyTWF0Y2hlcyhwYXJhbWV0ZXJNb2RlbCkpIHJldHVybjtcbiAgICAgIHByb2NlZHVyZU1vZGVsLmRlbGV0ZVBhcmFtZXRlcih0aGlzLmluZGV4KTtcbiAgICB9XG4gIH1cblxuICBwYXJhbWV0ZXJNYXRjaGVzKHBhcmFtOiBJUGFyYW1ldGVyTW9kZWwpIHtcbiAgICByZXR1cm4gcGFyYW0gJiYgcGFyYW0uZ2V0SWQoKSA9PT0gdGhpcy5wYXJhbWV0ZXIuZ2V0SWQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICB0b0pzb24oKTogUHJvY2VkdXJlUGFyYW1ldGVyQ3JlYXRlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIFByb2NlZHVyZVBhcmFtZXRlckNyZWF0ZUpzb247XG4gICAganNvblsncGFyYW1ldGVyJ10gPSBzYXZlUGFyYW1ldGVyKHRoaXMucGFyYW1ldGVyKTtcbiAgICBqc29uWydpbmRleCddID0gdGhpcy5pbmRleDtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXNlcmlhbGl6ZXMgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc3RhdGljIGZyb21Kc29uKGpzb246IFByb2NlZHVyZVBhcmFtZXRlckNyZWF0ZUpzb24sIHdvcmtzcGFjZTogV29ya3NwYWNlKTpcbiAgICAgIFByb2NlZHVyZVBhcmFtZXRlckNyZWF0ZSB7XG4gICAgY29uc3QgcHJvY2VkdXJlID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpLmdldChqc29uWydwcm9jZWR1cmVJZCddKTtcbiAgICBpZiAoIXByb2NlZHVyZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgZGVzZXJpYWxpemUgcGFyYW1ldGVyIGNyZWF0ZSBldmVudCBiZWNhdXNlIHRoZSAnICtcbiAgICAgICAgICAndGFyZ2V0IHByb2NlZHVyZSBkb2VzIG5vdCBleGlzdCcpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFByb2NlZHVyZVBhcmFtZXRlckNyZWF0ZShcbiAgICAgICAgd29ya3NwYWNlLCBwcm9jZWR1cmUsXG4gICAgICAgIGxvYWRQYXJhbWV0ZXIoT2JzZXJ2YWJsZVBhcmFtZXRlck1vZGVsLCBqc29uWydwYXJhbWV0ZXInXSwgd29ya3NwYWNlKSxcbiAgICAgICAganNvblsnaW5kZXgnXSk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQcm9jZWR1cmVQYXJhbWV0ZXJDcmVhdGVKc29uIGV4dGVuZHNcbiAgICBQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlSnNvbiB7XG4gIHBhcmFtZXRlcjogUGFyYW1ldGVyU3RhdGUsIGluZGV4OiBudW1iZXIsXG59XG5cbnJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIHJlZ2lzdHJ5LlR5cGUuRVZFTlQsIGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1BBUkFNRVRFUl9DUkVBVEUsXG4gICAgUHJvY2VkdXJlUGFyYW1ldGVyQ3JlYXRlKTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHR5cGUge0lQYXJhbWV0ZXJNb2RlbH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9pX3BhcmFtZXRlcl9tb2RlbC5qcyc7XG5pbXBvcnQgdHlwZSB7SVByb2NlZHVyZU1vZGVsfSBmcm9tICcuLi9pbnRlcmZhY2VzL2lfcHJvY2VkdXJlX21vZGVsLmpzJztcbmltcG9ydCB7T2JzZXJ2YWJsZVBhcmFtZXRlck1vZGVsfSBmcm9tICcuLi9wcm9jZWR1cmVzL29ic2VydmFibGVfcGFyYW1ldGVyX21vZGVsLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB0eXBlIHtXb3Jrc3BhY2V9IGZyb20gJy4uL3dvcmtzcGFjZS5qcyc7XG5cbmltcG9ydCB7UHJvY2VkdXJlUGFyYW1ldGVyQmFzZSwgUHJvY2VkdXJlUGFyYW1ldGVyQmFzZUpzb259IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9wYXJhbWV0ZXJfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBwYXJhbWV0ZXIgYmVpbmcgcmVtb3ZlZCBmcm9tIGEgcHJvY2VkdXJlLlxuICovXG5leHBvcnQgY2xhc3MgUHJvY2VkdXJlUGFyYW1ldGVyRGVsZXRlIGV4dGVuZHMgUHJvY2VkdXJlUGFyYW1ldGVyQmFzZSB7XG4gIC8qKiBBIHN0cmluZyB1c2VkIHRvIGNoZWNrIHRoZSB0eXBlIG9mIHRoZSBldmVudC4gKi9cbiAgdHlwZSA9IGV2ZW50VXRpbHMuUFJPQ0VEVVJFX1BBUkFNRVRFUl9ERUxFVEU7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBwYXJhbWV0ZXIgVGhlIHBhcmFtZXRlciBtb2RlbCB0aGF0IHdhcyBqdXN0IHJlbW92ZWQgZnJvbSB0aGVcbiAgICogICAgIHByb2NlZHVyZS5cbiAgICogQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGUgcGFyYW1ldGVyIHdhcyBhdCBiZWZvcmUgaXQgd2FzIHJlbW92ZWQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAgIHdvcmtzcGFjZTogV29ya3NwYWNlLCBwcm9jZWR1cmU6IElQcm9jZWR1cmVNb2RlbCxcbiAgICAgIHBhcmFtZXRlcjogSVBhcmFtZXRlck1vZGVsLCBwdWJsaWMgcmVhZG9ubHkgaW5kZXg6IG51bWJlcikge1xuICAgIHN1cGVyKHdvcmtzcGFjZSwgcHJvY2VkdXJlLCBwYXJhbWV0ZXIpO1xuICB9XG5cbiAgcnVuKGZvcndhcmQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmdldEV2ZW50V29ya3NwYWNlXygpO1xuICAgIGNvbnN0IHByb2NlZHVyZU1hcCA9IHdvcmtzcGFjZS5nZXRQcm9jZWR1cmVNYXAoKTtcbiAgICBjb25zdCBwcm9jZWR1cmVNb2RlbCA9IHByb2NlZHVyZU1hcC5nZXQodGhpcy5tb2RlbC5nZXRJZCgpKTtcbiAgICBpZiAoIXByb2NlZHVyZU1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBhZGQgYSBwYXJhbWV0ZXIgdG8gYSBwcm9jZWR1cmUgdGhhdCBkb2VzIG5vdCBleGlzdCAnICtcbiAgICAgICAgICAnaW4gdGhlIHByb2NlZHVyZSBtYXAnKTtcbiAgICB9XG4gICAgY29uc3QgcGFyYW1ldGVyTW9kZWwgPSBwcm9jZWR1cmVNb2RlbC5nZXRQYXJhbWV0ZXIodGhpcy5pbmRleCk7XG4gICAgaWYgKGZvcndhcmQpIHtcbiAgICAgIGlmICghdGhpcy5wYXJhbWV0ZXJNYXRjaGVzKHBhcmFtZXRlck1vZGVsKSkgcmV0dXJuO1xuICAgICAgcHJvY2VkdXJlTW9kZWwuZGVsZXRlUGFyYW1ldGVyKHRoaXMuaW5kZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5wYXJhbWV0ZXJNYXRjaGVzKHBhcmFtZXRlck1vZGVsKSkgcmV0dXJuO1xuICAgICAgLy8gVE9ETzogdGhpcyBzaG91bGQganVzdCBpbnNlcnQgdGhlIG1vZGVsIGluc3RlYWQgb2YgY3JlYXRpbmcgYSBkdXBlLlxuICAgICAgcHJvY2VkdXJlTW9kZWwuaW5zZXJ0UGFyYW1ldGVyKFxuICAgICAgICAgIG5ldyBPYnNlcnZhYmxlUGFyYW1ldGVyTW9kZWwoXG4gICAgICAgICAgICAgIHdvcmtzcGFjZSwgdGhpcy5wYXJhbWV0ZXIuZ2V0TmFtZSgpLCB0aGlzLnBhcmFtZXRlci5nZXRJZCgpKSxcbiAgICAgICAgICB0aGlzLmluZGV4KTtcbiAgICB9XG4gIH1cblxuICBwYXJhbWV0ZXJNYXRjaGVzKHBhcmFtOiBJUGFyYW1ldGVyTW9kZWwpIHtcbiAgICByZXR1cm4gcGFyYW0gJiYgcGFyYW0uZ2V0SWQoKSA9PT0gdGhpcy5wYXJhbWV0ZXIuZ2V0SWQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNvZGUgdGhlIGV2ZW50IGFzIEpTT04uXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICB0b0pzb24oKTogUHJvY2VkdXJlUGFyYW1ldGVyRGVsZXRlSnNvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIFByb2NlZHVyZVBhcmFtZXRlckRlbGV0ZUpzb247XG4gICAganNvblsnaW5kZXgnXSA9IHRoaXMuaW5kZXg7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBQcm9jZWR1cmVQYXJhbWV0ZXJEZWxldGVKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6XG4gICAgICBQcm9jZWR1cmVQYXJhbWV0ZXJEZWxldGUge1xuICAgIGNvbnN0IG1vZGVsID0gd29ya3NwYWNlLmdldFByb2NlZHVyZU1hcCgpLmdldChqc29uWydwcm9jZWR1cmVJZCddKTtcbiAgICBpZiAoIW1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCBkZXNlcmlhbGl6ZSBwcm9jZWR1cmUgZGVsZXRlIGV2ZW50IGJlY2F1c2UgdGhlICcgK1xuICAgICAgICAgICd0YXJnZXQgcHJvY2VkdXJlIGRvZXMgbm90IGV4aXN0Jyk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtID0gbW9kZWwuZ2V0UGFyYW1ldGVyKGpzb25bJ2luZGV4J10pO1xuICAgIHJldHVybiBuZXcgUHJvY2VkdXJlUGFyYW1ldGVyRGVsZXRlKHdvcmtzcGFjZSwgbW9kZWwsIHBhcmFtLCBqc29uWydpbmRleCddKTtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByb2NlZHVyZVBhcmFtZXRlckRlbGV0ZUpzb24gZXh0ZW5kc1xuICAgIFByb2NlZHVyZVBhcmFtZXRlckJhc2VKc29uIHtcbiAgaW5kZXg6IG51bWJlcjtcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIoXG4gICAgcmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5QUk9DRURVUkVfUEFSQU1FVEVSX0RFTEVURSxcbiAgICBQcm9jZWR1cmVQYXJhbWV0ZXJEZWxldGUpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEV2ZW50cyBmaXJlZCBhcyBhIGJsb2NrIGRyYWcuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkJsb2NrRHJhZycpO1xuXG5pbXBvcnQgdHlwZSB7QmxvY2t9IGZyb20gJy4uL2Jsb2NrLmpzJztcbmltcG9ydCAqIGFzIGRlcHJlY2F0aW9uIGZyb20gJy4uL3V0aWxzL2RlcHJlY2F0aW9uLmpzJztcbmltcG9ydCAqIGFzIHJlZ2lzdHJ5IGZyb20gJy4uL3JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7QWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB7VWlCYXNlfSBmcm9tICcuL2V2ZW50c191aV9iYXNlLmpzJztcbmltcG9ydCAqIGFzIGV2ZW50VXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQge1dvcmtzcGFjZX0gZnJvbSAnLi4vd29ya3NwYWNlLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGJsb2NrIGRyYWcgZXZlbnQuXG4gKlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLkJsb2NrRHJhZ1xuICovXG5leHBvcnQgY2xhc3MgQmxvY2tEcmFnIGV4dGVuZHMgVWlCYXNlIHtcbiAgYmxvY2tJZD86IHN0cmluZztcbiAgaXNTdGFydD86IGJvb2xlYW47XG4gIGJsb2Nrcz86IEJsb2NrW107XG4gIG92ZXJyaWRlIHR5cGUgPSBldmVudFV0aWxzLkJMT0NLX0RSQUc7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBvcHRfYmxvY2sgVGhlIHRvcCBibG9jayBpbiB0aGUgc3RhY2sgdGhhdCBpcyBiZWluZyBkcmFnZ2VkLlxuICAgKiAgICAgVW5kZWZpbmVkIGZvciBhIGJsYW5rIGV2ZW50LlxuICAgKiBAcGFyYW0gb3B0X2lzU3RhcnQgV2hldGhlciB0aGlzIGlzIHRoZSBzdGFydCBvZiBhIGJsb2NrIGRyYWcuXG4gICAqICAgIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG9wdF9ibG9ja3MgVGhlIGJsb2NrcyBhZmZlY3RlZCBieSB0aGlzIGRyYWcuIFVuZGVmaW5lZCBmb3IgYSBibGFua1xuICAgKiAgICAgZXZlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihvcHRfYmxvY2s/OiBCbG9jaywgb3B0X2lzU3RhcnQ/OiBib29sZWFuLCBvcHRfYmxvY2tzPzogQmxvY2tbXSkge1xuICAgIGNvbnN0IHdvcmtzcGFjZUlkID0gb3B0X2Jsb2NrID8gb3B0X2Jsb2NrLndvcmtzcGFjZS5pZCA6IHVuZGVmaW5lZDtcbiAgICBzdXBlcih3b3Jrc3BhY2VJZCk7XG4gICAgaWYgKCFvcHRfYmxvY2spIHJldHVybjtcblxuICAgIHRoaXMuYmxvY2tJZCA9IG9wdF9ibG9jay5pZDtcblxuICAgIC8qKiBXaGV0aGVyIHRoaXMgaXMgdGhlIHN0YXJ0IG9mIGEgYmxvY2sgZHJhZy4gKi9cbiAgICB0aGlzLmlzU3RhcnQgPSBvcHRfaXNTdGFydDtcblxuICAgIC8qKiBUaGUgYmxvY2tzIGFmZmVjdGVkIGJ5IHRoaXMgZHJhZyBldmVudC4gKi9cbiAgICB0aGlzLmJsb2NrcyA9IG9wdF9ibG9ja3M7XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIHRoZSBldmVudCBhcyBKU09OLlxuICAgKlxuICAgKiBAcmV0dXJucyBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgdG9Kc29uKCk6IEJsb2NrRHJhZ0pzb24ge1xuICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pzb24oKSBhcyBCbG9ja0RyYWdKc29uO1xuICAgIGlmICh0aGlzLmlzU3RhcnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdXaGV0aGVyIHRoaXMgZXZlbnQgaXMgdGhlIHN0YXJ0IG9mIGEgZHJhZyBpcyB1bmRlZmluZWQuICcgK1xuICAgICAgICAgICdFaXRoZXIgcGFzcyB0aGUgdmFsdWUgdG8gdGhlIGNvbnN0cnVjdG9yLCBvciBjYWxsIGZyb21Kc29uJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmJsb2NrSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdUaGUgYmxvY2sgSUQgaXMgdW5kZWZpbmVkLiBFaXRoZXIgcGFzcyBhIGJsb2NrIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAganNvblsnaXNTdGFydCddID0gdGhpcy5pc1N0YXJ0O1xuICAgIGpzb25bJ2Jsb2NrSWQnXSA9IHRoaXMuYmxvY2tJZDtcbiAgICAvLyBUT0RPOiBJIGRvbid0IHRoaW5rIHdlIHNob3VsZCBhY3R1YWxseSBhcHBseSB0aGUgYmxvY2tzIGFycmF5IHRvIHRoZSBKU09OXG4gICAgLy8gICBvYmplY3QgYi9jIHRoZXkgaGF2ZSBmdW5jdGlvbnMgYW5kIGFyZW4ndCBhY3R1YWxseSBzZXJpYWxpemFibGUuXG4gICAganNvblsnYmxvY2tzJ10gPSB0aGlzLmJsb2NrcztcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNvZGUgdGhlIEpTT04gZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSBqc29uIEpTT04gcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICBvdmVycmlkZSBmcm9tSnNvbihqc29uOiBCbG9ja0RyYWdKc29uKSB7XG4gICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLkJsb2NrRHJhZy5wcm90b3R5cGUuZnJvbUpzb24nLCAndmVyc2lvbiA5JyxcbiAgICAgICAgJ3ZlcnNpb24gMTAnLCAnQmxvY2tseS5FdmVudHMuZnJvbUpzb24nKTtcbiAgICBzdXBlci5mcm9tSnNvbihqc29uKTtcbiAgICB0aGlzLmlzU3RhcnQgPSBqc29uWydpc1N0YXJ0J107XG4gICAgdGhpcy5ibG9ja0lkID0ganNvblsnYmxvY2tJZCddO1xuICAgIHRoaXMuYmxvY2tzID0ganNvblsnYmxvY2tzJ107XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemVzIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIGV2ZW50IHRvIGFwcGVuZCBuZXcgcHJvcGVydGllcyB0by4gU2hvdWxkIGJlIGEgc3ViY2xhc3NcbiAgICogICAgIG9mIEJsb2NrRHJhZywgYnV0IHdlIGNhbid0IHNwZWNpZnkgdGhhdCBkdWUgdG8gdGhlIGZhY3QgdGhhdCBwYXJhbWV0ZXJzXG4gICAqICAgICB0byBzdGF0aWMgbWV0aG9kcyBpbiBzdWJjbGFzc2VzIG11c3QgYmUgc3VwZXJ0eXBlcyBvZiBwYXJhbWV0ZXJzIHRvXG4gICAqICAgICBzdGF0aWMgbWV0aG9kcyBpbiBzdXBlcmNsYXNzZXMuLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHN0YXRpYyBmcm9tSnNvbihqc29uOiBCbG9ja0RyYWdKc29uLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSwgZXZlbnQ/OiBhbnkpOlxuICAgICAgQmxvY2tEcmFnIHtcbiAgICBjb25zdCBuZXdFdmVudCA9XG4gICAgICAgIHN1cGVyLmZyb21Kc29uKGpzb24sIHdvcmtzcGFjZSwgZXZlbnQgPz8gbmV3IEJsb2NrRHJhZygpKSBhcyBCbG9ja0RyYWc7XG4gICAgbmV3RXZlbnQuaXNTdGFydCA9IGpzb25bJ2lzU3RhcnQnXTtcbiAgICBuZXdFdmVudC5ibG9ja0lkID0ganNvblsnYmxvY2tJZCddO1xuICAgIG5ld0V2ZW50LmJsb2NrcyA9IGpzb25bJ2Jsb2NrcyddO1xuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJsb2NrRHJhZ0pzb24gZXh0ZW5kcyBBYnN0cmFjdEV2ZW50SnNvbiB7XG4gIGlzU3RhcnQ6IGJvb2xlYW47XG4gIGJsb2NrSWQ6IHN0cmluZztcbiAgYmxvY2tzPzogQmxvY2tbXTtcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIocmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5CTE9DS19EUkFHLCBCbG9ja0RyYWcpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIChEZXByZWNhdGVkKSBFdmVudHMgZmlyZWQgYXMgYSByZXN1bHQgb2YgVUkgYWN0aW9ucyBpblxuICogQmxvY2tseSdzIGVkaXRvci5cbiAqXG4gKiBAY2xhc3NcbiAqL1xuaW1wb3J0ICogYXMgZ29vZyBmcm9tICcuLi8uLi9jbG9zdXJlL2dvb2cvZ29vZy5qcyc7XG5nb29nLmRlY2xhcmVNb2R1bGVJZCgnQmxvY2tseS5FdmVudHMuVWknKTtcblxuaW1wb3J0IHR5cGUge0Jsb2NrfSBmcm9tICcuLi9ibG9jay5qcyc7XG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQge1VpQmFzZX0gZnJvbSAnLi9ldmVudHNfdWlfYmFzZS5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgVUkgZXZlbnQuXG4gKlxuICogQGRlcHJlY2F0ZWQgRGVjZW1iZXIgMjAyMC4gSW5zdGVhZCB1c2UgYSBtb3JlIHNwZWNpZmljIFVJIGV2ZW50LlxuICogQGFsaWFzIEJsb2NrbHkuRXZlbnRzLlVpXG4gKi9cbmV4cG9ydCBjbGFzcyBVaSBleHRlbmRzIFVpQmFzZSB7XG4gIGJsb2NrSWQ6IEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgZWxlbWVudDogQW55RHVyaW5nTWlncmF0aW9uO1xuICBvbGRWYWx1ZTogQW55RHVyaW5nTWlncmF0aW9uO1xuICBuZXdWYWx1ZTogQW55RHVyaW5nTWlncmF0aW9uO1xuICBvdmVycmlkZSB0eXBlID0gZXZlbnRVdGlscy5VSTtcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF9ibG9jayBUaGUgYWZmZWN0ZWQgYmxvY2suICBOdWxsIGZvciBVSSBldmVudHMgdGhhdCBkbyBub3QgaGF2ZVxuICAgKiAgICAgYW4gYXNzb2NpYXRlZCBibG9jay4gIFVuZGVmaW5lZCBmb3IgYSBibGFuayBldmVudC5cbiAgICogQHBhcmFtIG9wdF9lbGVtZW50IE9uZSBvZiAnc2VsZWN0ZWQnLCAnY29tbWVudCcsICdtdXRhdG9yT3BlbicsIGV0Yy5cbiAgICogQHBhcmFtIG9wdF9vbGRWYWx1ZSBQcmV2aW91cyB2YWx1ZSBvZiBlbGVtZW50LlxuICAgKiBAcGFyYW0gb3B0X25ld1ZhbHVlIE5ldyB2YWx1ZSBvZiBlbGVtZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgICBvcHRfYmxvY2s/OiBCbG9ja3xudWxsLCBvcHRfZWxlbWVudD86IHN0cmluZyxcbiAgICAgIG9wdF9vbGRWYWx1ZT86IEFueUR1cmluZ01pZ3JhdGlvbiwgb3B0X25ld1ZhbHVlPzogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgY29uc3Qgd29ya3NwYWNlSWQgPSBvcHRfYmxvY2sgPyBvcHRfYmxvY2sud29ya3NwYWNlLmlkIDogdW5kZWZpbmVkO1xuICAgIHN1cGVyKHdvcmtzcGFjZUlkKTtcblxuICAgIHRoaXMuYmxvY2tJZCA9IG9wdF9ibG9jayA/IG9wdF9ibG9jay5pZCA6IG51bGw7XG4gICAgdGhpcy5lbGVtZW50ID0gdHlwZW9mIG9wdF9lbGVtZW50ID09PSAndW5kZWZpbmVkJyA/ICcnIDogb3B0X2VsZW1lbnQ7XG4gICAgdGhpcy5vbGRWYWx1ZSA9IHR5cGVvZiBvcHRfb2xkVmFsdWUgPT09ICd1bmRlZmluZWQnID8gJycgOiBvcHRfb2xkVmFsdWU7XG4gICAgdGhpcy5uZXdWYWx1ZSA9IHR5cGVvZiBvcHRfbmV3VmFsdWUgPT09ICd1bmRlZmluZWQnID8gJycgOiBvcHRfbmV3VmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogRW5jb2RlIHRoZSBldmVudCBhcyBKU09OLlxuICAgKlxuICAgKiBAcmV0dXJucyBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgdG9Kc29uKCk6IEFueUR1cmluZ01pZ3JhdGlvbiB7XG4gICAgY29uc3QganNvbiA9IHN1cGVyLnRvSnNvbigpIGFzIEFueUR1cmluZ01pZ3JhdGlvbjtcbiAgICBqc29uWydlbGVtZW50J10gPSB0aGlzLmVsZW1lbnQ7XG4gICAgaWYgKHRoaXMubmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAganNvblsnbmV3VmFsdWUnXSA9IHRoaXMubmV3VmFsdWU7XG4gICAgfVxuICAgIGlmICh0aGlzLmJsb2NrSWQpIHtcbiAgICAgIGpzb25bJ2Jsb2NrSWQnXSA9IHRoaXMuYmxvY2tJZDtcbiAgICB9XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogQW55RHVyaW5nTWlncmF0aW9uKSB7XG4gICAgc3VwZXIuZnJvbUpzb24oanNvbik7XG4gICAgdGhpcy5lbGVtZW50ID0ganNvblsnZWxlbWVudCddO1xuICAgIHRoaXMubmV3VmFsdWUgPSBqc29uWyduZXdWYWx1ZSddO1xuICAgIHRoaXMuYmxvY2tJZCA9IGpzb25bJ2Jsb2NrSWQnXTtcbiAgfVxufVxuXG5yZWdpc3RyeS5yZWdpc3RlcihyZWdpc3RyeS5UeXBlLkVWRU5ULCBldmVudFV0aWxzLlVJLCBVaSk7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQ2xhc3MgZm9yIGEgZmluaXNoZWQgbG9hZGluZyB3b3Jrc3BhY2UgZXZlbnQuXG4gKlxuICogQGNsYXNzXG4gKi9cbmltcG9ydCAqIGFzIGdvb2cgZnJvbSAnLi4vLi4vY2xvc3VyZS9nb29nL2dvb2cuanMnO1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQoJ0Jsb2NrbHkuRXZlbnRzLkZpbmlzaGVkTG9hZGluZycpO1xuXG5pbXBvcnQgKiBhcyByZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS5qcyc7XG5pbXBvcnQgdHlwZSB7V29ya3NwYWNlfSBmcm9tICcuLi93b3Jrc3BhY2UuanMnO1xuaW1wb3J0IHtBYnN0cmFjdCBhcyBBYnN0cmFjdEV2ZW50LCBBYnN0cmFjdEV2ZW50SnNvbn0gZnJvbSAnLi9ldmVudHNfYWJzdHJhY3QuanMnO1xuaW1wb3J0ICogYXMgZXZlbnRVdGlscyBmcm9tICcuL3V0aWxzLmpzJztcblxuXG4vKipcbiAqIENsYXNzIGZvciBhIGZpbmlzaGVkIGxvYWRpbmcgZXZlbnQuXG4gKiBVc2VkIHRvIG5vdGlmeSB0aGUgZGV2ZWxvcGVyIHdoZW4gdGhlIHdvcmtzcGFjZSBoYXMgZmluaXNoZWQgbG9hZGluZyAoaS5lXG4gKiBkb21Ub1dvcmtzcGFjZSkuXG4gKiBGaW5pc2hlZCBsb2FkaW5nIGV2ZW50cyBkbyBub3QgcmVjb3JkIHVuZG8gb3IgcmVkby5cbiAqXG4gKiBAYWxpYXMgQmxvY2tseS5FdmVudHMuRmluaXNoZWRMb2FkaW5nXG4gKi9cbmV4cG9ydCBjbGFzcyBGaW5pc2hlZExvYWRpbmcgZXh0ZW5kcyBBYnN0cmFjdEV2ZW50IHtcbiAgb3ZlcnJpZGUgaXNCbGFuayA9IHRydWU7XG4gIG92ZXJyaWRlIHJlY29yZFVuZG8gPSBmYWxzZTtcbiAgb3ZlcnJpZGUgdHlwZSA9IGV2ZW50VXRpbHMuRklOSVNIRURfTE9BRElORztcblxuICAvKipcbiAgICogQHBhcmFtIG9wdF93b3Jrc3BhY2UgVGhlIHdvcmtzcGFjZSB0aGF0IGhhcyBmaW5pc2hlZCBsb2FkaW5nLiAgVW5kZWZpbmVkXG4gICAqICAgICBmb3IgYSBibGFuayBldmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKG9wdF93b3Jrc3BhY2U/OiBXb3Jrc3BhY2UpIHtcbiAgICBzdXBlcigpO1xuICAgIC8qKiBXaGV0aGVyIG9yIG5vdCB0aGUgZXZlbnQgaXMgYmxhbmsgKHRvIGJlIHBvcHVsYXRlZCBieSBmcm9tSnNvbikuICovXG4gICAgdGhpcy5pc0JsYW5rID0gISFvcHRfd29ya3NwYWNlO1xuXG4gICAgaWYgKCFvcHRfd29ya3NwYWNlKSByZXR1cm47XG5cbiAgICAvKiogVGhlIHdvcmtzcGFjZSBpZGVudGlmaWVyIGZvciB0aGlzIGV2ZW50LiAqL1xuICAgIHRoaXMud29ya3NwYWNlSWQgPSBvcHRfd29ya3NwYWNlLmlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuY29kZSB0aGUgZXZlbnQgYXMgSlNPTi5cbiAgICpcbiAgICogQHJldHVybnMgSlNPTiByZXByZXNlbnRhdGlvbi5cbiAgICovXG4gIG92ZXJyaWRlIHRvSnNvbigpOiBGaW5pc2hlZExvYWRpbmdKc29uIHtcbiAgICBjb25zdCBqc29uID0gc3VwZXIudG9Kc29uKCkgYXMgRmluaXNoZWRMb2FkaW5nSnNvbjtcbiAgICBpZiAoIXRoaXMud29ya3NwYWNlSWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnVGhlIHdvcmtzcGFjZSBJRCBpcyB1bmRlZmluZWQuIEVpdGhlciBwYXNzIGEgd29ya3NwYWNlIHRvICcgK1xuICAgICAgICAgICd0aGUgY29uc3RydWN0b3IsIG9yIGNhbGwgZnJvbUpzb24nKTtcbiAgICB9XG4gICAganNvblsnd29ya3NwYWNlSWQnXSA9IHRoaXMud29ya3NwYWNlSWQ7XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICAvKipcbiAgICogRGVjb2RlIHRoZSBKU09OIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHJlcHJlc2VudGF0aW9uLlxuICAgKi9cbiAgb3ZlcnJpZGUgZnJvbUpzb24oanNvbjogRmluaXNoZWRMb2FkaW5nSnNvbikge1xuICAgIHN1cGVyLmZyb21Kc29uKGpzb24pO1xuICAgIHRoaXMud29ya3NwYWNlSWQgPSBqc29uWyd3b3Jrc3BhY2VJZCddO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmluaXNoZWRMb2FkaW5nSnNvbiBleHRlbmRzIEFic3RyYWN0RXZlbnRKc29uIHtcbiAgd29ya3NwYWNlSWQ6IHN0cmluZztcbn1cblxucmVnaXN0cnkucmVnaXN0ZXIoXG4gICAgcmVnaXN0cnkuVHlwZS5FVkVOVCwgZXZlbnRVdGlscy5GSU5JU0hFRF9MT0FESU5HLCBGaW5pc2hlZExvYWRpbmcpO1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEV2ZW50cyBmaXJlZCBhcyBhIHJlc3VsdCBvZiBhY3Rpb25zIGluIEJsb2NrbHkncyBlZGl0b3IuXG4gKlxuICogQG5hbWVzcGFjZSBCbG9ja2x5LkV2ZW50c1xuICovXG5pbXBvcnQgKiBhcyBnb29nIGZyb20gJy4uLy4uL2Nsb3N1cmUvZ29vZy9nb29nLmpzJztcbmdvb2cuZGVjbGFyZU1vZHVsZUlkKCdCbG9ja2x5LkV2ZW50cycpO1xuXG5cbmltcG9ydCB7QWJzdHJhY3QgYXMgQWJzdHJhY3RFdmVudCwgQWJzdHJhY3RFdmVudEpzb259IGZyb20gJy4vZXZlbnRzX2Fic3RyYWN0LmpzJztcbmltcG9ydCB7QmxvY2tCYXNlLCBCbG9ja0Jhc2VKc29ufSBmcm9tICcuL2V2ZW50c19ibG9ja19iYXNlLmpzJztcbmltcG9ydCB7QmxvY2tDaGFuZ2UsIEJsb2NrQ2hhbmdlSnNvbn0gZnJvbSAnLi9ldmVudHNfYmxvY2tfY2hhbmdlLmpzJztcbmltcG9ydCB7QmxvY2tDcmVhdGUsIEJsb2NrQ3JlYXRlSnNvbn0gZnJvbSAnLi9ldmVudHNfYmxvY2tfY3JlYXRlLmpzJztcbmltcG9ydCB7QmxvY2tEZWxldGUsIEJsb2NrRGVsZXRlSnNvbn0gZnJvbSAnLi9ldmVudHNfYmxvY2tfZGVsZXRlLmpzJztcbmltcG9ydCB7QmxvY2tEcmFnLCBCbG9ja0RyYWdKc29ufSBmcm9tICcuL2V2ZW50c19ibG9ja19kcmFnLmpzJztcbmltcG9ydCB7QmxvY2tNb3ZlLCBCbG9ja01vdmVKc29ufSBmcm9tICcuL2V2ZW50c19ibG9ja19tb3ZlLmpzJztcbmltcG9ydCB7QnViYmxlT3BlbiwgQnViYmxlT3Blbkpzb24sIEJ1YmJsZVR5cGV9IGZyb20gJy4vZXZlbnRzX2J1YmJsZV9vcGVuLmpzJztcbmltcG9ydCB7Q2xpY2ssIENsaWNrSnNvbiwgQ2xpY2tUYXJnZXR9IGZyb20gJy4vZXZlbnRzX2NsaWNrLmpzJztcbmltcG9ydCB7Q29tbWVudEJhc2UsIENvbW1lbnRCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfY29tbWVudF9iYXNlLmpzJztcbmltcG9ydCB7Q29tbWVudENoYW5nZSwgQ29tbWVudENoYW5nZUpzb259IGZyb20gJy4vZXZlbnRzX2NvbW1lbnRfY2hhbmdlLmpzJztcbmltcG9ydCB7Q29tbWVudENyZWF0ZSwgQ29tbWVudENyZWF0ZUpzb259IGZyb20gJy4vZXZlbnRzX2NvbW1lbnRfY3JlYXRlLmpzJztcbmltcG9ydCB7Q29tbWVudERlbGV0ZX0gZnJvbSAnLi9ldmVudHNfY29tbWVudF9kZWxldGUuanMnO1xuaW1wb3J0IHtDb21tZW50TW92ZSwgQ29tbWVudE1vdmVKc29ufSBmcm9tICcuL2V2ZW50c19jb21tZW50X21vdmUuanMnO1xuaW1wb3J0IHtNYXJrZXJNb3ZlLCBNYXJrZXJNb3ZlSnNvbn0gZnJvbSAnLi9ldmVudHNfbWFya2VyX21vdmUuanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVCYXNlfSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfYmFzZS5qcyc7XG5pbXBvcnQge1Byb2NlZHVyZUNoYW5nZVJldHVybn0gZnJvbSAnLi9ldmVudHNfcHJvY2VkdXJlX2NoYW5nZV9yZXR1cm4uanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVDcmVhdGV9IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9jcmVhdGUuanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVEZWxldGV9IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9kZWxldGUuanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVFbmFibGV9IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9lbmFibGUuanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVSZW5hbWV9IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9yZW5hbWUuanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlfSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfcGFyYW1ldGVyX2Jhc2UuanMnO1xuaW1wb3J0IHtQcm9jZWR1cmVQYXJhbWV0ZXJDcmVhdGV9IGZyb20gJy4vZXZlbnRzX3Byb2NlZHVyZV9wYXJhbWV0ZXJfY3JlYXRlLmpzJztcbmltcG9ydCB7UHJvY2VkdXJlUGFyYW1ldGVyRGVsZXRlfSBmcm9tICcuL2V2ZW50c19wcm9jZWR1cmVfcGFyYW1ldGVyX2RlbGV0ZS5qcyc7XG5pbXBvcnQge1Byb2NlZHVyZVBhcmFtZXRlclJlbmFtZX0gZnJvbSAnLi9ldmVudHNfcHJvY2VkdXJlX3BhcmFtZXRlcl9yZW5hbWUuanMnO1xuaW1wb3J0IHtTZWxlY3RlZCwgU2VsZWN0ZWRKc29ufSBmcm9tICcuL2V2ZW50c19zZWxlY3RlZC5qcyc7XG5pbXBvcnQge1RoZW1lQ2hhbmdlLCBUaGVtZUNoYW5nZUpzb259IGZyb20gJy4vZXZlbnRzX3RoZW1lX2NoYW5nZS5qcyc7XG5pbXBvcnQge1Rvb2xib3hJdGVtU2VsZWN0LCBUb29sYm94SXRlbVNlbGVjdEpzb259IGZyb20gJy4vZXZlbnRzX3Rvb2xib3hfaXRlbV9zZWxlY3QuanMnO1xuaW1wb3J0IHtUcmFzaGNhbk9wZW4sIFRyYXNoY2FuT3Blbkpzb259IGZyb20gJy4vZXZlbnRzX3RyYXNoY2FuX29wZW4uanMnO1xuaW1wb3J0IHtVaX0gZnJvbSAnLi9ldmVudHNfdWkuanMnO1xuaW1wb3J0IHtVaUJhc2V9IGZyb20gJy4vZXZlbnRzX3VpX2Jhc2UuanMnO1xuaW1wb3J0IHtWYXJCYXNlLCBWYXJCYXNlSnNvbn0gZnJvbSAnLi9ldmVudHNfdmFyX2Jhc2UuanMnO1xuaW1wb3J0IHtWYXJDcmVhdGUsIFZhckNyZWF0ZUpzb259IGZyb20gJy4vZXZlbnRzX3Zhcl9jcmVhdGUuanMnO1xuaW1wb3J0IHtWYXJEZWxldGUsIFZhckRlbGV0ZUpzb259IGZyb20gJy4vZXZlbnRzX3Zhcl9kZWxldGUuanMnO1xuaW1wb3J0IHtWYXJSZW5hbWUsIFZhclJlbmFtZUpzb259IGZyb20gJy4vZXZlbnRzX3Zhcl9yZW5hbWUuanMnO1xuaW1wb3J0IHtWaWV3cG9ydENoYW5nZSwgVmlld3BvcnRDaGFuZ2VKc29ufSBmcm9tICcuL2V2ZW50c192aWV3cG9ydC5qcyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHtGaW5pc2hlZExvYWRpbmcsIEZpbmlzaGVkTG9hZGluZ0pzb259IGZyb20gJy4vd29ya3NwYWNlX2V2ZW50cy5qcyc7XG5cblxuLy8gRXZlbnRzLlxuZXhwb3J0IGNvbnN0IEFic3RyYWN0ID0gQWJzdHJhY3RFdmVudDtcbmV4cG9ydCB7QWJzdHJhY3RFdmVudEpzb259O1xuZXhwb3J0IHtCdWJibGVPcGVufTtcbmV4cG9ydCB7QnViYmxlT3Blbkpzb259O1xuZXhwb3J0IHtCdWJibGVUeXBlfTtcbmV4cG9ydCB7QmxvY2tCYXNlfTtcbmV4cG9ydCB7QmxvY2tCYXNlSnNvbn07XG5leHBvcnQge0Jsb2NrQ2hhbmdlfTtcbmV4cG9ydCB7QmxvY2tDaGFuZ2VKc29ufTtcbmV4cG9ydCB7QmxvY2tDcmVhdGV9O1xuZXhwb3J0IHtCbG9ja0NyZWF0ZUpzb259O1xuZXhwb3J0IHtCbG9ja0RlbGV0ZX07XG5leHBvcnQge0Jsb2NrRGVsZXRlSnNvbn07XG5leHBvcnQge0Jsb2NrRHJhZ307XG5leHBvcnQge0Jsb2NrRHJhZ0pzb259O1xuZXhwb3J0IHtCbG9ja01vdmV9O1xuZXhwb3J0IHtCbG9ja01vdmVKc29ufTtcbmV4cG9ydCB7Q2xpY2t9O1xuZXhwb3J0IHtDbGlja0pzb259O1xuZXhwb3J0IHtDbGlja1RhcmdldH07XG5leHBvcnQge0NvbW1lbnRCYXNlfTtcbmV4cG9ydCB7Q29tbWVudEJhc2VKc29ufTtcbmV4cG9ydCB7Q29tbWVudENoYW5nZX07XG5leHBvcnQge0NvbW1lbnRDaGFuZ2VKc29ufTtcbmV4cG9ydCB7Q29tbWVudENyZWF0ZX07XG5leHBvcnQge0NvbW1lbnRDcmVhdGVKc29ufTtcbmV4cG9ydCB7Q29tbWVudERlbGV0ZX07XG5leHBvcnQge0NvbW1lbnRNb3ZlfTtcbmV4cG9ydCB7Q29tbWVudE1vdmVKc29ufTtcbmV4cG9ydCB7RmluaXNoZWRMb2FkaW5nfTtcbmV4cG9ydCB7RmluaXNoZWRMb2FkaW5nSnNvbn07XG5leHBvcnQge01hcmtlck1vdmV9O1xuZXhwb3J0IHtNYXJrZXJNb3ZlSnNvbn07XG5leHBvcnQge1Byb2NlZHVyZUJhc2V9O1xuZXhwb3J0IHtQcm9jZWR1cmVDaGFuZ2VSZXR1cm59O1xuZXhwb3J0IHtQcm9jZWR1cmVDcmVhdGV9O1xuZXhwb3J0IHtQcm9jZWR1cmVEZWxldGV9O1xuZXhwb3J0IHtQcm9jZWR1cmVFbmFibGV9O1xuZXhwb3J0IHtQcm9jZWR1cmVSZW5hbWV9O1xuZXhwb3J0IHtQcm9jZWR1cmVQYXJhbWV0ZXJCYXNlfTtcbmV4cG9ydCB7UHJvY2VkdXJlUGFyYW1ldGVyQ3JlYXRlfTtcbmV4cG9ydCB7UHJvY2VkdXJlUGFyYW1ldGVyRGVsZXRlfTtcbmV4cG9ydCB7UHJvY2VkdXJlUGFyYW1ldGVyUmVuYW1lfTtcbmV4cG9ydCB7U2VsZWN0ZWR9O1xuZXhwb3J0IHtTZWxlY3RlZEpzb259O1xuZXhwb3J0IHtUaGVtZUNoYW5nZX07XG5leHBvcnQge1RoZW1lQ2hhbmdlSnNvbn07XG5leHBvcnQge1Rvb2xib3hJdGVtU2VsZWN0fTtcbmV4cG9ydCB7VG9vbGJveEl0ZW1TZWxlY3RKc29ufTtcbmV4cG9ydCB7VHJhc2hjYW5PcGVufTtcbmV4cG9ydCB7VHJhc2hjYW5PcGVuSnNvbn07XG5leHBvcnQge1VpfTtcbmV4cG9ydCB7VWlCYXNlfTtcbmV4cG9ydCB7VmFyQmFzZX07XG5leHBvcnQge1ZhckJhc2VKc29ufTtcbmV4cG9ydCB7VmFyQ3JlYXRlfTtcbmV4cG9ydCB7VmFyQ3JlYXRlSnNvbn07XG5leHBvcnQge1ZhckRlbGV0ZX07XG5leHBvcnQge1ZhckRlbGV0ZUpzb259O1xuZXhwb3J0IHtWYXJSZW5hbWV9O1xuZXhwb3J0IHtWYXJSZW5hbWVKc29ufTtcbmV4cG9ydCB7Vmlld3BvcnRDaGFuZ2V9O1xuZXhwb3J0IHtWaWV3cG9ydENoYW5nZUpzb259O1xuXG4vLyBFdmVudCB0eXBlcy5cbmV4cG9ydCBjb25zdCBCTE9DS19DSEFOR0UgPSBldmVudFV0aWxzLkJMT0NLX0NIQU5HRTtcbmV4cG9ydCBjb25zdCBCTE9DS19DUkVBVEUgPSBldmVudFV0aWxzLkJMT0NLX0NSRUFURTtcbmV4cG9ydCBjb25zdCBCTE9DS19ERUxFVEUgPSBldmVudFV0aWxzLkJMT0NLX0RFTEVURTtcbmV4cG9ydCBjb25zdCBCTE9DS19EUkFHID0gZXZlbnRVdGlscy5CTE9DS19EUkFHO1xuZXhwb3J0IGNvbnN0IEJMT0NLX01PVkUgPSBldmVudFV0aWxzLkJMT0NLX01PVkU7XG5leHBvcnQgY29uc3QgQlVCQkxFX09QRU4gPSBldmVudFV0aWxzLkJVQkJMRV9PUEVOO1xuZXhwb3J0IHR5cGUgQnVtcEV2ZW50ID0gZXZlbnRVdGlscy5CdW1wRXZlbnQ7XG5leHBvcnQgY29uc3QgQlVNUF9FVkVOVFMgPSBldmVudFV0aWxzLkJVTVBfRVZFTlRTO1xuZXhwb3J0IGNvbnN0IENIQU5HRSA9IGV2ZW50VXRpbHMuQ0hBTkdFO1xuZXhwb3J0IGNvbnN0IENMSUNLID0gZXZlbnRVdGlscy5DTElDSztcbmV4cG9ydCBjb25zdCBDT01NRU5UX0NIQU5HRSA9IGV2ZW50VXRpbHMuQ09NTUVOVF9DSEFOR0U7XG5leHBvcnQgY29uc3QgQ09NTUVOVF9DUkVBVEUgPSBldmVudFV0aWxzLkNPTU1FTlRfQ1JFQVRFO1xuZXhwb3J0IGNvbnN0IENPTU1FTlRfREVMRVRFID0gZXZlbnRVdGlscy5DT01NRU5UX0RFTEVURTtcbmV4cG9ydCBjb25zdCBDT01NRU5UX01PVkUgPSBldmVudFV0aWxzLkNPTU1FTlRfTU9WRTtcbmV4cG9ydCBjb25zdCBDUkVBVEUgPSBldmVudFV0aWxzLkNSRUFURTtcbmV4cG9ydCBjb25zdCBERUxFVEUgPSBldmVudFV0aWxzLkRFTEVURTtcbmV4cG9ydCBjb25zdCBGSU5JU0hFRF9MT0FESU5HID0gZXZlbnRVdGlscy5GSU5JU0hFRF9MT0FESU5HO1xuZXhwb3J0IGNvbnN0IE1BUktFUl9NT1ZFID0gZXZlbnRVdGlscy5NQVJLRVJfTU9WRTtcbmV4cG9ydCBjb25zdCBNT1ZFID0gZXZlbnRVdGlscy5NT1ZFO1xuZXhwb3J0IGNvbnN0IFNFTEVDVEVEID0gZXZlbnRVdGlscy5TRUxFQ1RFRDtcbmV4cG9ydCBjb25zdCBUSEVNRV9DSEFOR0UgPSBldmVudFV0aWxzLlRIRU1FX0NIQU5HRTtcbmV4cG9ydCBjb25zdCBUT09MQk9YX0lURU1fU0VMRUNUID0gZXZlbnRVdGlscy5UT09MQk9YX0lURU1fU0VMRUNUO1xuZXhwb3J0IGNvbnN0IFRSQVNIQ0FOX09QRU4gPSBldmVudFV0aWxzLlRSQVNIQ0FOX09QRU47XG5leHBvcnQgY29uc3QgVUkgPSBldmVudFV0aWxzLlVJO1xuZXhwb3J0IGNvbnN0IFZBUl9DUkVBVEUgPSBldmVudFV0aWxzLlZBUl9DUkVBVEU7XG5leHBvcnQgY29uc3QgVkFSX0RFTEVURSA9IGV2ZW50VXRpbHMuVkFSX0RFTEVURTtcbmV4cG9ydCBjb25zdCBWQVJfUkVOQU1FID0gZXZlbnRVdGlscy5WQVJfUkVOQU1FO1xuZXhwb3J0IGNvbnN0IFZJRVdQT1JUX0NIQU5HRSA9IGV2ZW50VXRpbHMuVklFV1BPUlRfQ0hBTkdFO1xuXG4vLyBFdmVudCB1dGlscy5cbmV4cG9ydCBjb25zdCBjbGVhclBlbmRpbmdVbmRvID0gZXZlbnRVdGlscy5jbGVhclBlbmRpbmdVbmRvO1xuZXhwb3J0IGNvbnN0IGRpc2FibGUgPSBldmVudFV0aWxzLmRpc2FibGU7XG5leHBvcnQgY29uc3QgZW5hYmxlID0gZXZlbnRVdGlscy5lbmFibGU7XG5leHBvcnQgY29uc3QgZmlsdGVyID0gZXZlbnRVdGlscy5maWx0ZXI7XG5leHBvcnQgY29uc3QgZmlyZSA9IGV2ZW50VXRpbHMuZmlyZTtcbmV4cG9ydCBjb25zdCBmcm9tSnNvbiA9IGV2ZW50VXRpbHMuZnJvbUpzb247XG5leHBvcnQgY29uc3QgZ2V0RGVzY2VuZGFudElkcyA9IGV2ZW50VXRpbHMuZ2V0RGVzY2VuZGFudElkcztcbmV4cG9ydCBjb25zdCBnZXQgPSBldmVudFV0aWxzLmdldDtcbmV4cG9ydCBjb25zdCBnZXRHcm91cCA9IGV2ZW50VXRpbHMuZ2V0R3JvdXA7XG5leHBvcnQgY29uc3QgZ2V0UmVjb3JkVW5kbyA9IGV2ZW50VXRpbHMuZ2V0UmVjb3JkVW5kbztcbmV4cG9ydCBjb25zdCBpc0VuYWJsZWQgPSBldmVudFV0aWxzLmlzRW5hYmxlZDtcbmV4cG9ydCBjb25zdCBzZXRHcm91cCA9IGV2ZW50VXRpbHMuc2V0R3JvdXA7XG5leHBvcnQgY29uc3Qgc2V0UmVjb3JkVW5kbyA9IGV2ZW50VXRpbHMuc2V0UmVjb3JkVW5kbztcbmV4cG9ydCBjb25zdCBkaXNhYmxlT3JwaGFucyA9IGV2ZW50VXRpbHMuZGlzYWJsZU9ycGhhbnM7XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBUaGUgZW50cnlwb2ludCBmb3IgYmxvY2tseV9jb21wcmVzc2VkLmpzLiAgUHJvdmlkZXNcbiAqICAgICB2YXJpb3VzIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGhhY2tzLiAgTm90IHVzZWQgd2hlbiBsb2FkaW5nXG4gKiAgICAgaW4gdW5jb21waWxlZCAodW5jb21wcmVzc2VkKSBtb2RlIHZpYSBib290c3RyYXAuanMuXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkubWFpbicpO1xuXG5jb25zdCBCbG9ja2x5ID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5Jyk7XG5jb25zdCBDb250ZXh0TWVudSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5Db250ZXh0TWVudScpO1xuY29uc3QgRXZlbnRzID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LkV2ZW50cycpO1xuY29uc3QgTXNnID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5Lk1zZycpO1xuY29uc3QgVG9vbHRpcCA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5Ub29sdGlwJyk7XG5jb25zdCBXaWRnZXREaXYgPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuV2lkZ2V0RGl2Jyk7XG5jb25zdCBjb2xvdXIgPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkudXRpbHMuY29sb3VyJyk7XG5jb25zdCBjb21tb24gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuY29tbW9uJyk7XG5jb25zdCBkZXByZWNhdGlvbiA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS51dGlscy5kZXByZWNhdGlvbicpO1xuY29uc3QgZGlhbG9nID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LmRpYWxvZycpO1xuY29uc3QgZXZlbnRVdGlscyA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5FdmVudHMudXRpbHMnKTtcblxuLypcbiAqIEFsaWFzZWQgZnVuY3Rpb25zIGFuZCBwcm9wZXJ0aWVzIHRoYXQgdXNlZCB0byBiZSBvbiB0aGUgQmxvY2tseSBuYW1lc3BhY2UuXG4gKiBFdmVyeXRoaW5nIGluIHRoaXMgc2VjdGlvbiBpcyBkZXByZWNhdGVkLiBCb3RoIGV4dGVybmFsIGFuZCBpbnRlcm5hbCBjb2RlXG4gKiBzaG91bGQgYXZvaWQgdXNpbmcgdGhlc2UgZnVuY3Rpb25zIGFuZCB1c2UgdGhlIGRlc2lnbmF0ZWQgcmVwbGFjZW1lbnRzLlxuICogRXZlcnl0aGluZyBpbiB0aGlzIHNlY3Rpb24gd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24gb2YgQmxvY2tseS5cbiAqL1xuXG4vLyBBZGQgYWNjZXNzb3JzIGZvciBwcm9wZXJ0aWVzIG9uIEJsb2NrbHkgdGhhdCBoYXZlIG5vdyBiZWVuIGRlcHJlY2F0ZWQuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhCbG9ja2x5LCB7XG4gIC8qKlxuICAgKiBXcmFwcGVyIHRvIHdpbmRvdy5hbGVydCgpIHRoYXQgYXBwIGRldmVsb3BlcnMgbWF5IG92ZXJyaWRlIHRvXG4gICAqIHByb3ZpZGUgYWx0ZXJuYXRpdmVzIHRvIHRoZSBtb2RhbCBicm93c2VyIHdpbmRvdy5cbiAgICogQG5hbWUgQmxvY2tseS5hbGVydFxuICAgKiBAdHlwZSB7IWZ1bmN0aW9uKHN0cmluZywgZnVuY3Rpb24oKT0pfVxuICAgKiBAZGVwcmVjYXRlZCBVc2UgQmxvY2tseS5kaWFsb2cuYWxlcnQgLyAuc2V0QWxlcnQoKSBpbnN0ZWFkLlxuICAgKiAgICAgKERlY2VtYmVyIDIwMjEpXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICovXG4gIGFsZXJ0OiB7XG4gICAgc2V0OiBmdW5jdGlvbihuZXdBbGVydCkge1xuICAgICAgZGVwcmVjYXRpb24ud2FybignQmxvY2tseS5hbGVydCcsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInKTtcbiAgICAgIGRpYWxvZy5zZXRBbGVydChuZXdBbGVydCk7XG4gICAgfSxcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgICAnQmxvY2tseS5hbGVydCcsICdEZWNlbWJlciAyMDIxJywgJ0RlY2VtYmVyIDIwMjInLFxuICAgICAgICAgICdCbG9ja2x5LmRpYWxvZy5hbGVydCgpJyk7XG4gICAgICByZXR1cm4gZGlhbG9nLmFsZXJ0O1xuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBXcmFwcGVyIHRvIHdpbmRvdy5jb25maXJtKCkgdGhhdCBhcHAgZGV2ZWxvcGVycyBtYXkgb3ZlcnJpZGUgdG9cbiAgICogcHJvdmlkZSBhbHRlcm5hdGl2ZXMgdG8gdGhlIG1vZGFsIGJyb3dzZXIgd2luZG93LlxuICAgKiBAbmFtZSBCbG9ja2x5LmNvbmZpcm1cbiAgICogQHR5cGUgeyFmdW5jdGlvbihzdHJpbmcsIGZ1bmN0aW9uKCk9KX1cbiAgICogQGRlcHJlY2F0ZWQgVXNlIEJsb2NrbHkuZGlhbG9nLmNvbmZpcm0gLyAuc2V0Q29uZmlybSgpIGluc3RlYWQuXG4gICAqICAgICAoRGVjZW1iZXIgMjAyMSlcbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgY29uZmlybToge1xuICAgIHNldDogZnVuY3Rpb24obmV3Q29uZmlybSkge1xuICAgICAgZGVwcmVjYXRpb24ud2FybignQmxvY2tseS5jb25maXJtJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicpO1xuICAgICAgZGlhbG9nLnNldENvbmZpcm0obmV3Q29uZmlybSk7XG4gICAgfSxcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgICAnQmxvY2tseS5jb25maXJtJywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAgICAgJ0Jsb2NrbHkuZGlhbG9nLmNvbmZpcm0oKScpO1xuICAgICAgcmV0dXJuIGRpYWxvZy5jb25maXJtO1xuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBUaGUgbWFpbiB3b3Jrc3BhY2UgbW9zdCByZWNlbnRseSB1c2VkLlxuICAgKiBTZXQgYnkgQmxvY2tseS5Xb3Jrc3BhY2VTdmcucHJvdG90eXBlLm1hcmtGb2N1c2VkXG4gICAqIEBuYW1lIEJsb2NrbHkubWFpbldvcmtzcGFjZVxuICAgKiBAdHlwZSB7V29ya3NwYWNlfVxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICBtYWluV29ya3NwYWNlOiB7XG4gICAgc2V0OiBmdW5jdGlvbih4KSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAgICdCbG9ja2x5Lm1haW5Xb3Jrc3BhY2UnLCAndmVyc2lvbiA5JywgJ3ZlcnNpb24gMTAnLFxuICAgICAgICAgICdCbG9ja2x5LmdldE1haW5Xb3Jrc3BhY2UnKTtcbiAgICAgIGNvbW1vbi5zZXRNYWluV29ya3NwYWNlKHgpO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0Jsb2NrbHkubWFpbldvcmtzcGFjZScsICd2ZXJzaW9uIDknLCAndmVyc2lvbiAxMCcsXG4gICAgICAgICAgJ0Jsb2NrbHkuZ2V0TWFpbldvcmtzcGFjZScpO1xuICAgICAgcmV0dXJuIGNvbW1vbi5nZXRNYWluV29ya3NwYWNlKCk7XG4gICAgfSxcbiAgfSxcbiAgLyoqXG4gICAqIFdyYXBwZXIgdG8gd2luZG93LnByb21wdCgpIHRoYXQgYXBwIGRldmVsb3BlcnMgbWF5IG92ZXJyaWRlIHRvXG4gICAqIHByb3ZpZGUgYWx0ZXJuYXRpdmVzIHRvIHRoZSBtb2RhbCBicm93c2VyIHdpbmRvdy4gQnVpbHQtaW5cbiAgICogYnJvd3NlciBwcm9tcHRzIGFyZSBvZnRlbiB1c2VkIGZvciBiZXR0ZXIgdGV4dCBpbnB1dCBleHBlcmllbmNlXG4gICAqIG9uIG1vYmlsZSBkZXZpY2UuIFdlIHN0cm9uZ2x5IHJlY29tbWVuZCB0ZXN0aW5nIG1vYmlsZSB3aGVuXG4gICAqIG92ZXJyaWRpbmcgdGhpcy5cbiAgICogQG5hbWUgQmxvY2tseS5wcm9tcHRcbiAgICogQHR5cGUgeyFmdW5jdGlvbihzdHJpbmcsIHN0cmluZywgZnVuY3Rpb24oKT0pfVxuICAgKiBAZGVwcmVjYXRlZCBVc2UgQmxvY2tseS5kaWFsb2cucHJvbXB0IC8gLnNldFByb21wdCgpIGluc3RlYWQuXG4gICAqICAgICAoRGVjZW1iZXIgMjAyMSlcbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgcHJvbXB0OiB7XG4gICAgc2V0OiBmdW5jdGlvbihuZXdQcm9tcHQpIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oJ0Jsb2NrbHkucHJvbXB0JywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicpO1xuICAgICAgZGlhbG9nLnNldFByb21wdChuZXdQcm9tcHQpO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0Jsb2NrbHkucHJvbXB0JywgJ0RlY2VtYmVyIDIwMjEnLCAnRGVjZW1iZXIgMjAyMicsXG4gICAgICAgICAgJ0Jsb2NrbHkuZGlhbG9nLnByb21wdCgpJyk7XG4gICAgICByZXR1cm4gZGlhbG9nLnByb21wdDtcbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogQ3VycmVudGx5IHNlbGVjdGVkIGJsb2NrLlxuICAgKiBAbmFtZSBCbG9ja2x5LnNlbGVjdGVkXG4gICAqIEB0eXBlIHs/SUNvcHlhYmxlfVxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICBzZWxlY3RlZDoge1xuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAgICdCbG9ja2x5LnNlbGVjdGVkJywgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuZ2V0U2VsZWN0ZWQnKTtcbiAgICAgIHJldHVybiBjb21tb24uZ2V0U2VsZWN0ZWQoKTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24obmV3U2VsZWN0aW9uKSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAgICdCbG9ja2x5LnNlbGVjdGVkJywgJ3ZlcnNpb24gOScsICd2ZXJzaW9uIDEwJywgJ0Jsb2NrbHkuZ2V0U2VsZWN0ZWQnKTtcbiAgICAgIGNvbW1vbi5zZXRTZWxlY3RlZChuZXdTZWxlY3Rpb24pO1xuICAgIH0sXG4gIH0sXG4gIC8qKlxuICAgKiBUaGUgcmljaG5lc3Mgb2YgYmxvY2sgY29sb3VycywgcmVnYXJkbGVzcyBvZiB0aGUgaHVlLlxuICAgKiBNdXN0IGJlIGluIHRoZSByYW5nZSBvZiAwIChpbmNsdXNpdmUpIHRvIDEgKGV4Y2x1c2l2ZSkuXG4gICAqIEBuYW1lIEJsb2NrbHkuSFNWX1NBVFVSQVRJT05cbiAgICogQHR5cGUge251bWJlcn1cbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgSFNWX1NBVFVSQVRJT046IHtcbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGNvbG91ci5nZXRIc3ZTYXR1cmF0aW9uKCk7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICBjb2xvdXIuc2V0SHN2U2F0dXJhdGlvbihuZXdWYWx1ZSk7XG4gICAgfSxcbiAgfSxcbiAgLyoqXG4gICAqIFRoZSBpbnRlbnNpdHkgb2YgYmxvY2sgY29sb3VycywgcmVnYXJkbGVzcyBvZiB0aGUgaHVlLlxuICAgKiBNdXN0IGJlIGluIHRoZSByYW5nZSBvZiAwIChpbmNsdXNpdmUpIHRvIDEgKGV4Y2x1c2l2ZSkuXG4gICAqIEBuYW1lIEJsb2NrbHkuSFNWX1ZBTFVFXG4gICAqIEB0eXBlIHtudW1iZXJ9XG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICovXG4gIEhTVl9WQUxVRToge1xuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gY29sb3VyLmdldEhzdlZhbHVlKCk7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICBjb2xvdXIuc2V0SHN2VmFsdWUobmV3VmFsdWUpO1xuICAgIH0sXG4gIH0sXG59KTtcblxuLy8gQWRkIGFjY2Vzc29ycyBmb3IgcHJvcGVydGllcyBvbiBCbG9ja2x5LkNvbnRleHRNZW51IHRoYXQgaGF2ZSBub3dcbi8vIGJlZW4gZGVwcmVjYXRlZC5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKENvbnRleHRNZW51LCB7XG4gIC8qKlxuICAgKiBXaGljaCBibG9jayBpcyB0aGUgY29udGV4dCBtZW51IGF0dGFjaGVkIHRvP1xuICAgKiBAbmFtZSBCbG9ja2x5LkNvbnRleHRNZW51LmN1cnJlbnRCbG9ja1xuICAgKiBAdHlwZSB7QmxvY2t9XG4gICAqIEBkZXByZWNhdGVkIFVzZSBCbG9ja2x5LlRvb2x0aXAuZ2V0Q3VycmVudEJsb2NrKCkgL1xuICAgKiAgICAgLnNldEN1cnJlbnRCbG9jaygpIGluc3RlYWQuICAoU2VwdGVtYmVyIDIwMjEpXG4gICAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc31cbiAgICovXG4gIGN1cnJlbnRCbG9jazoge1xuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAgICdCbG9ja2x5LkNvbnRleHRNZW51LmN1cnJlbnRCbG9jaycsICdTZXB0ZW1iZXIgMjAyMScsXG4gICAgICAgICAgJ1NlcHRlbWJlciAyMDIyJywgJ0Jsb2NrbHkuVG9vbHRpcC5nZXRDdXJyZW50QmxvY2soKScpO1xuICAgICAgcmV0dXJuIENvbnRleHRNZW51LmdldEN1cnJlbnRCbG9jaygpO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbihibG9jaykge1xuICAgICAgZGVwcmVjYXRpb24ud2FybihcbiAgICAgICAgICAnQmxvY2tseS5Db250ZXh0TWVudS5jdXJyZW50QmxvY2snLCAnU2VwdGVtYmVyIDIwMjEnLFxuICAgICAgICAgICdTZXB0ZW1iZXIgMjAyMicsICdCbG9ja2x5LlRvb2x0aXAuc2V0Q3VycmVudEJsb2NrKGJsb2NrKScpO1xuICAgICAgQ29udGV4dE1lbnUuc2V0Q3VycmVudEJsb2NrKGJsb2NrKTtcbiAgICB9LFxuICB9LFxufSk7XG5cbi8vIEFkZCBhY2Nlc3NvcnMgZm9yIHByb3BlcnRpZXMgb24gQmxvY2tseS5FdmVudHMgdGhhdCBoYXZlIG5vdyBiZWVuXG4vLyBkZXByZWNhdGVkLlxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoRXZlbnRzLCB7XG4gIC8qKlxuICAgKiBTZXRzIHdoZXRoZXIgdGhlIG5leHQgZXZlbnQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSB1bmRvIHN0YWNrLlxuICAgKiBAbmFtZSBCbG9ja2x5LkV2ZW5lbnRzLnJlY29yZFVuZG9cbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqIEBkZXByZWNhdGVkIFVzZSBCbG9ja2x5LkV2ZW50cy5nZXRSZWNvcmRVbmRvKCkgYW5kXG4gICAqICAgICAuc2V0UmVjb3JkVW5kbygpLiAgKFNlcHRlbWJlciAyMDIxKVxuICAgKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9XG4gICAqL1xuICByZWNvcmRVbmRvOiB7XG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0Jsb2NrbHkuRXZlbnRzLnJlY29yZFVuZG8nLCAnU2VwdGVtYmVyIDIwMjEnLCAnU2VwdGVtYmVyIDIwMjInLFxuICAgICAgICAgICdCbG9ja2x5LkV2ZW50cy5nZXRSZWNvcmRVbmRvKCknKTtcbiAgICAgIHJldHVybiBldmVudFV0aWxzLmdldFJlY29yZFVuZG8oKTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24ocmVjb3JkKSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAgICdCbG9ja2x5LkV2ZW50cy5yZWNvcmRVbmRvJywgJ1NlcHRlbWJlciAyMDIxJywgJ1NlcHRlbWJlciAyMDIyJyxcbiAgICAgICAgICAnQmxvY2tseS5FdmVudHMuc2V0UmVjb3JkVW5kbygpJyk7XG4gICAgICBldmVudFV0aWxzLnNldFJlY29yZFVuZG8ocmVjb3JkKTtcbiAgICB9LFxuICB9LFxufSk7XG5cblxuLy8gQWRkIGFjY2Vzc29ycyBmb3IgcHJvcGVydGllcyBvbiBCbG9ja2x5LlRvb2x0aXAgdGhhdCBoYXZlIG5vdyBiZWVuXG4vLyBkZXByZWNhdGVkLlxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoVG9vbHRpcCwge1xuICAvKipcbiAgICogSXMgYSB0b29sdGlwIGN1cnJlbnRseSBzaG93aW5nP1xuICAgKiBAbmFtZSBCbG9ja2x5LlRvb2x0aXAudmlzaWJsZVxuICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICogQGRlcHJlY2F0ZWQgVXNlIEJsb2NrbHkuVG9vbHRpcC5pc1Zpc2libGUoKSBpbnN0ZWFkLiAgKFNlcHRlbWJlclxuICAgKiAgICAgMjAyMSlcbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgdmlzaWJsZToge1xuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICBkZXByZWNhdGlvbi53YXJuKFxuICAgICAgICAgICdCbG9ja2x5LlRvb2x0aXAudmlzaWJsZScsICdTZXB0ZW1iZXIgMjAyMScsICdTZXB0ZW1iZXIgMjAyMicsXG4gICAgICAgICAgJ0Jsb2NrbHkuVG9vbHRpcC5pc1Zpc2libGUoKScpO1xuICAgICAgcmV0dXJuIFRvb2x0aXAuaXNWaXNpYmxlKCk7XG4gICAgfSxcbiAgfSxcbiAgLyoqXG4gICAqIFRoZSBIVE1MIGNvbnRhaW5lci4gIFNldCBvbmNlIGJ5IGNyZWF0ZURvbS5cbiAgICogQG5hbWUgQmxvY2tseS5Ub29sdGlwLkRJVlxuICAgKiBAdHlwZSB7SFRNTERpdkVsZW1lbnR9XG4gICAqIEBkZXByZWNhdGVkIFVzZSBCbG9ja2x5LlRvb2x0aXAuZ2V0RGl2KCkgYW5kIC5zZXREaXYoKS5cbiAgICogICAgIChTZXB0ZW1iZXIgMjAyMSlcbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgRElWOiB7XG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0Jsb2NrbHkuVG9vbHRpcC5ESVYnLCAnU2VwdGVtYmVyIDIwMjEnLCAnU2VwdGVtYmVyIDIwMjInLFxuICAgICAgICAgICdCbG9ja2x5LlRvb2x0aXAuZ2V0RGl2KCknKTtcbiAgICAgIHJldHVybiBUb29sdGlwLmdldERpdigpO1xuICAgIH0sXG4gIH0sXG59KTtcblxuLy8gQWRkIGFjY2Vzc29ycyBmb3IgcHJvcGVydGllcyBvbiBCbG9ja2x5LldpZGdldERpdiB0aGF0IGhhdmUgbm93IGJlZW5cbi8vIGRlcHJlY2F0ZWQuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhXaWRnZXREaXYsIHtcbiAgLyoqXG4gICAqIFRoZSBIVE1MIGNvbnRhaW5lciBmb3IgcG9wdXAgb3ZlcmxheXMgKGUuZy4gZWRpdG9yIHdpZGdldHMpLlxuICAgKiBAbmFtZSBCbG9ja2x5LldpZGdldERpdi5ESVZcbiAgICogQHR5cGUgez9FbGVtZW50fVxuICAgKiBAZGVwcmVjYXRlZCBVc2UgQmxvY2tseS5XaWRnZXREaXYuZ2V0RGl2KCkgYW5kIC5zZXREaXYoKS5cbiAgICogICAgIChTZXB0ZW1iZXIgMjAyMSlcbiAgICogQHN1cHByZXNzIHtjaGVja1R5cGVzfVxuICAgKi9cbiAgRElWOiB7XG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIGRlcHJlY2F0aW9uLndhcm4oXG4gICAgICAgICAgJ0Jsb2NrbHkuV2lkZ2V0RGl2LkRJVicsICdTZXB0ZW1iZXIgMjAyMScsICdTZXB0ZW1iZXIgMjAyMicsXG4gICAgICAgICAgJ0Jsb2NrbHkuV2lkZ2V0RGl2LmdldERpdigpJyk7XG4gICAgICByZXR1cm4gV2lkZ2V0RGl2LmdldERpdigpO1xuICAgIH0sXG4gIH0sXG59KTtcblxuLy8gSWYgQmxvY2tseSBpcyBjb21waWxlZCB3aXRoIEFEVkFOQ0VEX0NPTVBJTEFUSU9OIGFuZC9vciBsb2FkZWQgYXMgYVxuLy8gQ0pTIG9yIEVTIG1vZHVsZSB0aGVyZSB3aWxsIG5vdCBiZSBhIEJsb2NrbHkgZ2xvYmFsIHZhcmlhYmxlXG4vLyBjcmVhdGVkLiAgVGhpcyBjYW4gY2F1c2UgcHJvYmxlbXMgYmVjYXVzZSBhIHZlcnkgY29tbW9uIHdheSBvZlxuLy8gbG9hZGluZyB0cmFuc2xhdGlvbnMgaXMgdG8gdXNlIGEgPHNjcmlwdD4gdGFnIHRvIGxvYWQgb25lIG9mXG4vLyB0aGUgZ2VuZXJhdGVkIG1zZy8qLmpzIGZpbGVzLCB3aGljaCBjb25zaXN0cyBvZiBsaW5lcyBsaWtlOlxuLy9cbi8vIEJsb2NrbHkuTXNnW1wiQUREX0NPTU1FTlRcIl0gPSBcIkFkZCBDb21tZW50XCI7XG4vLyBCbG9ja2x5Lk1zZ1tcIkNMRUFOX1VQXCJdID0gXCJDbGVhbiB1cCBCbG9ja3NcIjtcbi8vXG4vLyBUaGlzIG9idmlvdXNseSBvbmx5IHdvcmtzIGlmIEJsb2NrbHkuTXNnIGlzIHRoZSBNc2cgZXhwb3J0IGZyb20gdGhlXG4vLyBCbG9ja2x5Lk1zZyBtb2R1bGUgLSBzbyBtYWtlIHN1cmUgaXQgaXMsIGJ1dCBvbmx5IGlmIHRoZXJlIGlzIG5vdFxuLy8geWV0IGEgQmxvY2tseSBnbG9iYWwgdmFyaWFibGUuXG5pZiAoISgnQmxvY2tseScgaW4gZ2xvYmFsVGhpcykpIHtcbiAgZ2xvYmFsVGhpc1snQmxvY2tseSddID0geydNc2cnOiBNc2d9O1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/blockly/blockly_compressed.js\n");

/***/ }),

/***/ "./node_modules/blockly/core-browser.js":
/*!**********************************************!*\
  !*** ./node_modules/blockly/core-browser.js ***!
  \**********************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* eslint-disable */\n;(function(root, factory) {\n  if (true) { // AMD\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! ./blockly */ \"./node_modules/blockly/blockly.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly core module for the browser. It includes blockly.js\n *               and adds a helper method for setting the locale.\n */\n\n/* eslint-disable */\n'use strict';\n\n\nreturn Blockly;\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYmxvY2tseS9jb3JlLWJyb3dzZXIuanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2NvcmUtYnJvd3Nlci5qcz9iYTYxIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlICovXG47KGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgeyAvLyBBTURcbiAgICBkZWZpbmUoWycuL2Jsb2NrbHknXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7IC8vIE5vZGUuanNcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnLi9ibG9ja2x5JykpO1xuICB9IGVsc2UgeyAvLyBCcm93c2VyXG4gICAgcm9vdC5CbG9ja2x5ID0gZmFjdG9yeShyb290LkJsb2NrbHkpO1xuICB9XG59KHRoaXMsIGZ1bmN0aW9uKEJsb2NrbHkpIHtcbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEJsb2NrbHkgY29yZSBtb2R1bGUgZm9yIHRoZSBicm93c2VyLiBJdCBpbmNsdWRlcyBibG9ja2x5LmpzXG4gKiAgICAgICAgICAgICAgIGFuZCBhZGRzIGEgaGVscGVyIG1ldGhvZCBmb3Igc2V0dGluZyB0aGUgbG9jYWxlLlxuICovXG5cbi8qIGVzbGludC1kaXNhYmxlICovXG4ndXNlIHN0cmljdCc7XG5cblxucmV0dXJuIEJsb2NrbHk7XG59KSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/blockly/core-browser.js\n");

/***/ }),

/***/ "./node_modules/blockly/javascript.js":
/*!********************************************!*\
  !*** ./node_modules/blockly/javascript.js ***!
  \********************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* eslint-disable */\n;(function(root, factory) {\n  if (true) { // AMD\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! ./core */ \"./node_modules/blockly/core-browser.js\"), __webpack_require__(/*! ./javascript_compressed.js */ \"./node_modules/blockly/javascript_compressed.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n}(this, function(Blockly, BlocklyJavaScript) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview JavaScript Generator module; just a wrapper for\n *     javascript_compressed.js.\n */\n\nreturn BlocklyJavaScript;\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYmxvY2tseS9qYXZhc2NyaXB0LmpzLmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvamF2YXNjcmlwdC5qcz8xNTQ0Il0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlICovXG47KGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgeyAvLyBBTURcbiAgICBkZWZpbmUoWycuL2NvcmUnLCAnLi9qYXZhc2NyaXB0X2NvbXByZXNzZWQuanMnXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7IC8vIE5vZGUuanNcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnLi9jb3JlJyksIHJlcXVpcmUoJy4vamF2YXNjcmlwdF9jb21wcmVzc2VkLmpzJykpO1xuICB9IGVsc2UgeyAvLyBCcm93c2VyXG4gICAgcm9vdC5CbG9ja2x5SmF2YVNjcmlwdCA9IGZhY3Rvcnkocm9vdC5CbG9ja2x5LCByb290LkJsb2NrbHlKYXZhU2NyaXB0KTtcbiAgfVxufSh0aGlzLCBmdW5jdGlvbihCbG9ja2x5LCBCbG9ja2x5SmF2YVNjcmlwdCkge1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgSmF2YVNjcmlwdCBHZW5lcmF0b3IgbW9kdWxlOyBqdXN0IGEgd3JhcHBlciBmb3JcbiAqICAgICBqYXZhc2NyaXB0X2NvbXByZXNzZWQuanMuXG4gKi9cblxucmV0dXJuIEJsb2NrbHlKYXZhU2NyaXB0O1xufSkpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/blockly/javascript.js\n");

/***/ }),

/***/ "./node_modules/blockly/javascript_compressed.js":
/*!*******************************************************!*\
  !*** ./node_modules/blockly/javascript_compressed.js ***!
  \*******************************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// Do not edit this file; automatically generated.\n\n/* eslint-disable */\n;(function(root, factory) {\n  if (true) { // AMD\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! ./blockly_compressed.js */ \"./node_modules/blockly/blockly_compressed.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else { var factoryExports; }\n}(this, function(__parent__) {\nvar $=__parent__.__namespace__;\nvar module$exports$Blockly$JavaScript={},module$contents$Blockly$JavaScript_Variables=$.module$build$src$core$variables,module$contents$Blockly$JavaScript_stringUtils=$.module$build$src$core$utils$string,module$contents$Blockly$JavaScript_CodeGenerator=$.CodeGenerator$$module$build$src$core$generator,module$contents$Blockly$JavaScript_inputTypes=$.module$build$src$core$input_types.inputTypes,module$contents$Blockly$JavaScript_Names=$.module$build$src$core$names.Names,module$contents$Blockly$JavaScript_NameType=\n$.NameType$$module$build$src$core$names;module$exports$Blockly$JavaScript.javascriptGenerator=new $.CodeGenerator$$module$build$src$core$generator(\"JavaScript\");\nmodule$exports$Blockly$JavaScript.javascriptGenerator.addReservedWords(\"break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,\"+Object.getOwnPropertyNames(globalThis).join(\",\"));module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC=0;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NEW=1.1;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER=1.2;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL=2;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_INCREMENT=3;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DECREMENT=3;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_BITWISE_NOT=4.1;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_UNARY_PLUS=4.2;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_UNARY_NEGATION=4.3;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT=4.4;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_TYPEOF=4.5;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_VOID=4.6;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DELETE=4.7;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_AWAIT=4.8;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EXPONENTIATION=5;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MULTIPLICATION=5.1;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DIVISION=5.2;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS=5.3;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION=6.1;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION=6.2;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_BITWISE_SHIFT=7;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_RELATIONAL=8;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_IN=8;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_INSTANCEOF=8;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EQUALITY=9;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_BITWISE_AND=10;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_BITWISE_XOR=11;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_BITWISE_OR=12;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_AND=13;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_OR=14;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_CONDITIONAL=15;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT=16;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_YIELD=17;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_COMMA=18;module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE=99;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_OVERRIDES=[[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER,\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MULTIPLICATION,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MULTIPLICATION],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION],\n[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_AND,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_AND],[module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_OR,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_OR]];module$exports$Blockly$JavaScript.javascriptGenerator.isInitialized=!1;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.init=function(a){Object.getPrototypeOf(this).init.call(this);this.nameDB_?this.nameDB_.reset():this.nameDB_=new $.module$build$src$core$names.Names(this.RESERVED_WORDS_);this.nameDB_.setVariableMap(a.getVariableMap());this.nameDB_.populateVariables(a);this.nameDB_.populateProcedures(a);const b=[];var c=$.module$build$src$core$variables.allDeveloperVariables(a);for(let d=0;d<c.length;d++)b.push(this.nameDB_.getName(c[d],$.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));\na=$.module$build$src$core$variables.allUsedVarModels(a);for(c=0;c<a.length;c++)b.push(this.nameDB_.getName(a[c].getId(),$.NameType$$module$build$src$core$names.VARIABLE));b.length&&(this.definitions_.variables=\"var \"+b.join(\", \")+\";\");this.isInitialized=!0};module$exports$Blockly$JavaScript.javascriptGenerator.finish=function(a){const b=Object.values(this.definitions_);a=Object.getPrototypeOf(this).finish.call(this,a);this.isInitialized=!1;this.nameDB_.reset();return b.join(\"\\n\\n\")+\"\\n\\n\\n\"+a};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.scrubNakedValue=function(a){return a+\";\\n\"};module$exports$Blockly$JavaScript.javascriptGenerator.quote_=function(a){a=a.replace(/\\\\/g,\"\\\\\\\\\").replace(/\\n/g,\"\\\\\\n\").replace(/'/g,\"\\\\'\");return\"'\"+a+\"'\"};module$exports$Blockly$JavaScript.javascriptGenerator.multiline_quote_=function(a){return a.split(/\\n/g).map(this.quote_).join(\" + '\\\\n' +\\n\")};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.scrub_=function(a,b,c){let d=\"\";if(!a.outputConnection||!a.outputConnection.targetConnection){var e=a.getCommentText();e&&(e=$.module$build$src$core$utils$string.wrap(e,this.COMMENT_WRAP-3),d+=this.prefixLines(e+\"\\n\",\"// \"));for(let f=0;f<a.inputList.length;f++)a.inputList[f].type===$.module$build$src$core$input_types.inputTypes.VALUE&&(e=a.inputList[f].connection.targetBlock())&&(e=this.allNestedComments(e))&&(d+=this.prefixLines(e,\"// \"))}a=\na.nextConnection&&a.nextConnection.targetBlock();c=c?\"\":this.blockToCode(a);return d+b+c};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted=function(a,b,c,d,e){c=c||0;e=e||this.ORDER_NONE;a.workspace.options.oneBasedIndex&&c--;const f=a.workspace.options.oneBasedIndex?\"1\":\"0\";let g,h=e;0<c?g=h=this.ORDER_ADDITION:0>c?g=h=this.ORDER_SUBTRACTION:d&&(g=h=this.ORDER_UNARY_NEGATION);a=this.valueToCode(a,b,h)||f;$.module$build$src$core$utils$string.isNumber(a)?(a=Number(a)+c,d&&(a=-a)):(0<c?a=a+\" + \"+c:0>c&&(a=a+\" - \"+-c),d&&(a=c?\"-(\"+a+\")\":\"-\"+a),g=Math.floor(g),e=Math.floor(e),\ng&&e>=g&&(a=\"(\"+a+\")\"));return a};var module$exports$Blockly$JavaScript$variables={},module$contents$Blockly$JavaScript$variables_NameType=$.NameType$$module$build$src$core$names;module$exports$Blockly$JavaScript.javascriptGenerator.variables_get=function(a){return[module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"VAR\"),$.NameType$$module$build$src$core$names.VARIABLE),module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.variables_set=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\"0\";return module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"VAR\"),$.NameType$$module$build$src$core$names.VARIABLE)+\" = \"+b+\";\\n\"};var module$exports$Blockly$JavaScript$variablesDynamic={};module$exports$Blockly$JavaScript.javascriptGenerator.variables_get_dynamic=module$exports$Blockly$JavaScript.javascriptGenerator.variables_get;module$exports$Blockly$JavaScript.javascriptGenerator.variables_set_dynamic=module$exports$Blockly$JavaScript.javascriptGenerator.variables_set;var module$exports$Blockly$JavaScript$texts={},module$contents$Blockly$JavaScript$texts_NameType=$.NameType$$module$build$src$core$names,module$contents$Blockly$JavaScript$texts_strRegExp=/^\\s*'([^']|\\\\')*'\\s*$/,module$contents$Blockly$JavaScript$texts_forceString=function(a){return module$contents$Blockly$JavaScript$texts_strRegExp.test(a)?[a,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]:[\"String(\"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]},\nmodule$contents$Blockly$JavaScript$texts_getSubstringIndex=function(a,b,c){return\"FIRST\"===b?\"0\":\"FROM_END\"===b?a+\".length - 1 - \"+c:\"LAST\"===b?a+\".length - 1\":c};module$exports$Blockly$JavaScript.javascriptGenerator.text=function(a){return[module$exports$Blockly$JavaScript.javascriptGenerator.quote_(a.getFieldValue(\"TEXT\")),module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_multiline=function(a){a=module$exports$Blockly$JavaScript.javascriptGenerator.multiline_quote_(a.getFieldValue(\"TEXT\"));const b=-1!==a.indexOf(\"+\")?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC;return[a,b]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_join=function(a){switch(a.itemCount_){case 0:return[\"''\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC];case 1:return a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ADD0\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\",module$contents$Blockly$JavaScript$texts_forceString(a);case 2:var b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ADD0\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\n\"''\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ADD1\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";return[module$contents$Blockly$JavaScript$texts_forceString(b)[0]+\" + \"+module$contents$Blockly$JavaScript$texts_forceString(a)[0],module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION];default:b=Array(a.itemCount_);for(let c=0;c<a.itemCount_;c++)b[c]=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ADD\"+c,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\n\"''\";return[\"[\"+b.join(\",\")+\"].join('')\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]}};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_append=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"VAR\"),$.NameType$$module$build$src$core$names.VARIABLE);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";return b+\" += \"+module$contents$Blockly$JavaScript$texts_forceString(a)[0]+\";\\n\"};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_length=function(a){return[(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"''\")+\".length\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_isEmpty=function(a){return[\"!\"+(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"''\")+\".length\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_indexOf=function(a){var b=\"FIRST\"===a.getFieldValue(\"END\")?\"indexOf\":\"lastIndexOf\";const c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"FIND\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";b=(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"''\")+\".\"+b+\"(\"+c+\")\";return a.workspace.options.oneBasedIndex?\n[b+\" + 1\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION]:[b,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_charAt=function(a){const b=a.getFieldValue(\"WHERE\")||\"FROM_START\",c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",\"RANDOM\"===b?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"''\";switch(b){case \"FIRST\":return[c+\".charAt(0)\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];case \"LAST\":return[c+\".slice(-1)\",\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];case \"FROM_START\":return a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT\"),[c+\".charAt(\"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];case \"FROM_END\":return a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT\",1,!0),[c+\".slice(\"+a+\").charAt(0)\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];case \"RANDOM\":return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"textRandomLetter\",\n`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`)+\"(\"+c+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]}throw Error(\"Unhandled option (text_charAt).\");};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_getSubstring=function(a){var b=a.getFieldValue(\"WHERE1\"),c=a.getFieldValue(\"WHERE2\"),d=\"FROM_END\"!==b&&\"LAST\"!==b&&\"FROM_END\"!==c&&\"LAST\"!==c,e=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"STRING\",d?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";if(\"FIRST\"===b&&\"LAST\"===c)return[e,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE];\nif(e.match(/^'?\\w+'?$/)||d){switch(b){case \"FROM_START\":b=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT1\");break;case \"FROM_END\":b=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT1\",1,!1,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION);b=e+\".length - \"+b;break;case \"FIRST\":b=\"0\";break;default:throw Error(\"Unhandled option (text_getSubstring).\");}switch(c){case \"FROM_START\":c=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\n\"AT2\",1);break;case \"FROM_END\":c=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT2\",0,!1,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION);c=e+\".length - \"+c;break;case \"LAST\":c=e+\".length\";break;default:throw Error(\"Unhandled option (text_getSubstring).\");}e=e+\".slice(\"+b+\", \"+c+\")\"}else{d=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT1\");a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT2\");const f={FIRST:\"First\",\nLAST:\"Last\",FROM_START:\"FromStart\",FROM_END:\"FromEnd\"};e=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"subsequence\"+f[b]+f[c],`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(sequence${\"FROM_END\"===b||\"FROM_START\"===b?\", at1\":\"\"}${\"FROM_END\"===c||\"FROM_START\"===c?\", at2\":\"\"}) {\n  var start = ${module$contents$Blockly$JavaScript$texts_getSubstringIndex(\"sequence\",b,\"at1\")};\n  var end = ${module$contents$Blockly$JavaScript$texts_getSubstringIndex(\"sequence\",c,\"at2\")} + 1;\n  return sequence.slice(start, end);\n}\n`)+\"(\"+e+(\"FROM_END\"===b||\"FROM_START\"===b?\", \"+d:\"\")+(\"FROM_END\"===c||\"FROM_START\"===c?\", \"+a:\"\")+\")\"}return[e,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_changeCase=function(a){const b={UPPERCASE:\".toUpperCase()\",LOWERCASE:\".toLowerCase()\",TITLECASE:null}[a.getFieldValue(\"CASE\")];a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",b?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";return[b?a+b:module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"textToTitleCase\",\n`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`)+\"(\"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};module$exports$Blockly$JavaScript.javascriptGenerator.text_trim=function(a){const b={LEFT:\".replace(/^[\\\\s\\\\xa0]+/, '')\",RIGHT:\".replace(/[\\\\s\\\\xa0]+$/, '')\",BOTH:\".trim()\"}[a.getFieldValue(\"MODE\")];return[(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"''\")+b,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_print=function(a){return\"window.alert(\"+(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\")+\");\\n\"};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_prompt_ext=function(a){let b=\"window.prompt(\"+(a.getField(\"TEXT\")?module$exports$Blockly$JavaScript.javascriptGenerator.quote_(a.getFieldValue(\"TEXT\")):module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\")+\")\";\"NUMBER\"===a.getFieldValue(\"TYPE\")&&(b=\"Number(\"+b+\")\");return[b,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_prompt=module$exports$Blockly$JavaScript.javascriptGenerator.text_prompt_ext;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_count=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"SUB\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"textCount\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`)+\"(\"+b+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.text_replace=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\",c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"FROM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TO\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\n\"''\";return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"textReplace\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\\\[\\\\]{}+?*.$\\\\^|,:#<!\\\\\\\\])/g, '\\\\\\\\$1')\n                 .replace(/\\\\x08/g, '\\\\\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`)+\"(\"+b+\", \"+c+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};module$exports$Blockly$JavaScript.javascriptGenerator.text_reverse=function(a){return[(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TEXT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"''\")+\".split('').reverse().join('')\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};var module$exports$Blockly$JavaScript$procedures={},module$contents$Blockly$JavaScript$procedures_NameType=$.NameType$$module$build$src$core$names;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.procedures_defreturn=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"NAME\"),$.NameType$$module$build$src$core$names.PROCEDURE);var c=\"\";module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX&&(c+=module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX,a));module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX&&\n(c+=module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX,a));c&&(c=module$exports$Blockly$JavaScript.javascriptGenerator.prefixLines(c,module$exports$Blockly$JavaScript.javascriptGenerator.INDENT));let d=\"\";module$exports$Blockly$JavaScript.javascriptGenerator.INFINITE_LOOP_TRAP&&(d=module$exports$Blockly$JavaScript.javascriptGenerator.prefixLines(module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.INFINITE_LOOP_TRAP,\na),module$exports$Blockly$JavaScript.javascriptGenerator.INDENT));const e=module$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\"STACK\");let f=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"RETURN\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"\",g=\"\";e&&f&&(g=c);f&&(f=module$exports$Blockly$JavaScript.javascriptGenerator.INDENT+\"return \"+f+\";\\n\");const h=[],k=a.getVars();for(let l=0;l<k.length;l++)h[l]=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(k[l],\n$.NameType$$module$build$src$core$names.VARIABLE);c=\"function \"+b+\"(\"+h.join(\", \")+\") {\\n\"+c+d+e+g+f+\"}\";c=module$exports$Blockly$JavaScript.javascriptGenerator.scrub_(a,c);module$exports$Blockly$JavaScript.javascriptGenerator.definitions_[\"%\"+b]=c;return null};module$exports$Blockly$JavaScript.javascriptGenerator.procedures_defnoreturn=module$exports$Blockly$JavaScript.javascriptGenerator.procedures_defreturn;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.procedures_callreturn=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"NAME\"),$.NameType$$module$build$src$core$names.PROCEDURE),c=[],d=a.getVars();for(let e=0;e<d.length;e++)c[e]=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ARG\"+e,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"null\";return[b+\"(\"+c.join(\", \")+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.procedures_callnoreturn=function(a){return module$exports$Blockly$JavaScript.javascriptGenerator.procedures_callreturn(a)[0]+\";\\n\"};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.procedures_ifreturn=function(a){let b=\"if (\"+(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"CONDITION\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"false\")+\") {\\n\";module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX&&(b+=module$exports$Blockly$JavaScript.javascriptGenerator.prefixLines(module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX,\na),module$exports$Blockly$JavaScript.javascriptGenerator.INDENT));a.hasReturnValue_?(a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"null\",b+=module$exports$Blockly$JavaScript.javascriptGenerator.INDENT+\"return \"+a+\";\\n\"):b+=module$exports$Blockly$JavaScript.javascriptGenerator.INDENT+\"return;\\n\";return b+\"}\\n\"};var module$exports$Blockly$JavaScript$math={},module$contents$Blockly$JavaScript$math_NameType=$.NameType$$module$build$src$core$names;module$exports$Blockly$JavaScript.javascriptGenerator.math_number=function(a){a=Number(a.getFieldValue(\"NUM\"));return[a,0<=a?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_UNARY_NEGATION]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_arithmetic=function(a){var b={ADD:[\" + \",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION],MINUS:[\" - \",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION],MULTIPLY:[\" * \",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MULTIPLICATION],DIVIDE:[\" / \",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DIVISION],POWER:[null,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE]}[a.getFieldValue(\"OP\")];\nconst c=b[0];b=b[1];const d=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"A\",b)||\"0\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"B\",b)||\"0\";return c?[d+c+a,b]:[\"Math.pow(\"+d+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_single=function(a){const b=a.getFieldValue(\"OP\");let c;if(\"NEG\"===b)return a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"NUM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_UNARY_NEGATION)||\"0\",\"-\"===a[0]&&(a=\" \"+a),[\"-\"+a,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_UNARY_NEGATION];a=\"SIN\"===b||\"COS\"===b||\"TAN\"===b?module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"NUM\",\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DIVISION)||\"0\":module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"NUM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\";switch(b){case \"ABS\":c=\"Math.abs(\"+a+\")\";break;case \"ROOT\":c=\"Math.sqrt(\"+a+\")\";break;case \"LN\":c=\"Math.log(\"+a+\")\";break;case \"EXP\":c=\"Math.exp(\"+a+\")\";break;case \"POW10\":c=\"Math.pow(10,\"+a+\")\";break;case \"ROUND\":c=\"Math.round(\"+a+\")\";break;case \"ROUNDUP\":c=\"Math.ceil(\"+a+\")\";break;\ncase \"ROUNDDOWN\":c=\"Math.floor(\"+a+\")\";break;case \"SIN\":c=\"Math.sin(\"+a+\" / 180 * Math.PI)\";break;case \"COS\":c=\"Math.cos(\"+a+\" / 180 * Math.PI)\";break;case \"TAN\":c=\"Math.tan(\"+a+\" / 180 * Math.PI)\"}if(c)return[c,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];switch(b){case \"LOG10\":c=\"Math.log(\"+a+\") / Math.log(10)\";break;case \"ASIN\":c=\"Math.asin(\"+a+\") / Math.PI * 180\";break;case \"ACOS\":c=\"Math.acos(\"+a+\") / Math.PI * 180\";break;case \"ATAN\":c=\"Math.atan(\"+a+\") / Math.PI * 180\";\nbreak;default:throw Error(\"Unknown math operator: \"+b);}return[c,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DIVISION]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_constant=function(a){return{PI:[\"Math.PI\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER],E:[\"Math.E\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER],GOLDEN_RATIO:[\"(1 + Math.sqrt(5)) / 2\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DIVISION],SQRT2:[\"Math.SQRT2\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER],SQRT1_2:[\"Math.SQRT1_2\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER],\nINFINITY:[\"Infinity\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]}[a.getFieldValue(\"CONSTANT\")]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_number_property=function(a){var b={EVEN:[\" % 2 === 0\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EQUALITY],ODD:[\" % 2 === 1\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EQUALITY],WHOLE:[\" % 1 === 0\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EQUALITY],\nPOSITIVE:[\" > 0\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_RELATIONAL,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_RELATIONAL],NEGATIVE:[\" < 0\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_RELATIONAL,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_RELATIONAL],DIVISIBLE_BY:[null,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EQUALITY],PRIME:[null,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE,\nmodule$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};const c=a.getFieldValue(\"PROPERTY\"),[d,e,f]=b[c];b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"NUMBER_TO_CHECK\",e)||\"0\";\"PRIME\"===c?a=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathIsPrime\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+\"(\"+b+\")\":\"DIVISIBLE_BY\"===c?(a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"DIVISOR\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS)||\"0\",a=b+\" % \"+a+\" === 0\"):a=b+d;return[a,f]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_change=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"DELTA\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION)||\"0\";a=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"VAR\"),$.NameType$$module$build$src$core$names.VARIABLE);return a+\" = (typeof \"+a+\" === 'number' ? \"+a+\" : 0) + \"+b+\";\\n\"};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_round=module$exports$Blockly$JavaScript.javascriptGenerator.math_single;module$exports$Blockly$JavaScript.javascriptGenerator.math_trig=module$exports$Blockly$JavaScript.javascriptGenerator.math_single;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_on_list=function(a){var b=a.getFieldValue(\"OP\");switch(b){case \"SUM\":a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\";a+=\".reduce(function(x, y) {return x + y;}, 0)\";break;case \"MIN\":a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=\"Math.min.apply(null, \"+\na+\")\";break;case \"MAX\":a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=\"Math.max.apply(null, \"+a+\")\";break;case \"AVERAGE\":b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathMean\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=b+\"(\"+a+\")\";break;case \"MEDIAN\":b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathMedian\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=b+\"(\"+a+\")\";break;case \"MODE\":b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathModes\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n        modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=b+\"(\"+a+\")\";break;case \"STD_DEV\":b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathStandardDeviation\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance = variance / n;\n  return Math.sqrt(variance);\n}\n`);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=b+\"(\"+a+\")\";break;case \"RANDOM\":b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathRandomList\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"[]\";a=b+\"(\"+a+\")\";break;default:throw Error(\"Unknown operator: \"+b);}return[a,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_modulo=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"DIVIDEND\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS)||\"0\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"DIVISOR\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS)||\"0\";return[b+\" % \"+a,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MODULUS]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_constrain=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\",c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LOW\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"HIGH\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\n\"Infinity\";return[\"Math.min(Math.max(\"+b+\", \"+c+\"), \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_random_int=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"FROM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TO\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\";return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"mathRandomInt\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`)+\"(\"+b+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};module$exports$Blockly$JavaScript.javascriptGenerator.math_random_float=function(a){return[\"Math.random()\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.math_atan2=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"X\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\";return[\"Math.atan2(\"+(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"Y\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\")+\", \"+b+\") / Math.PI * 180\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_DIVISION]};var module$exports$Blockly$JavaScript$loops={},module$contents$Blockly$JavaScript$loops_stringUtils=$.module$build$src$core$utils$string,module$contents$Blockly$JavaScript$loops_NameType=$.NameType$$module$build$src$core$names;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_repeat_ext=function(a){let b;b=a.getField(\"TIMES\")?String(Number(a.getFieldValue(\"TIMES\"))):module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TIMES\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\"0\";let c=module$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\"DO\");c=module$exports$Blockly$JavaScript.javascriptGenerator.addLoopTrap(c,a);a=\"\";const d=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(\"count\",\n$.NameType$$module$build$src$core$names.VARIABLE);let e=b;b.match(/^\\w+$/)||$.module$build$src$core$utils$string.isNumber(b)||(e=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(\"repeat_end\",$.NameType$$module$build$src$core$names.VARIABLE),a+=\"var \"+e+\" = \"+b+\";\\n\");return a+(\"for (var \"+d+\" = 0; \"+d+\" < \"+e+\"; \"+d+\"++) {\\n\"+c+\"}\\n\")};module$exports$Blockly$JavaScript.javascriptGenerator.controls_repeat=module$exports$Blockly$JavaScript.javascriptGenerator.controls_repeat_ext;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_whileUntil=function(a){const b=\"UNTIL\"===a.getFieldValue(\"MODE\");let c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"BOOL\",b?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"false\",d=module$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\"DO\");d=module$exports$Blockly$JavaScript.javascriptGenerator.addLoopTrap(d,\na);b&&(c=\"!\"+c);return\"while (\"+c+\") {\\n\"+d+\"}\\n\"};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_for=function(a){var b=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"VAR\"),$.NameType$$module$build$src$core$names.VARIABLE),c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"FROM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\"0\",d=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TO\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\n\"0\";const e=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"BY\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\"1\";let f=module$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\"DO\");f=module$exports$Blockly$JavaScript.javascriptGenerator.addLoopTrap(f,a);if($.module$build$src$core$utils$string.isNumber(c)&&$.module$build$src$core$utils$string.isNumber(d)&&$.module$build$src$core$utils$string.isNumber(e)){var g=Number(c)<=Number(d);a=\n\"for (\"+b+\" = \"+c+\"; \"+b+(g?\" <= \":\" >= \")+d+\"; \"+b;b=Math.abs(Number(e));a=1===b?a+(g?\"++\":\"--\"):a+((g?\" += \":\" -= \")+b);a+=\") {\\n\"+f+\"}\\n\"}else a=\"\",g=c,c.match(/^\\w+$/)||$.module$build$src$core$utils$string.isNumber(c)||(g=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(b+\"_start\",$.NameType$$module$build$src$core$names.VARIABLE),a+=\"var \"+g+\" = \"+c+\";\\n\"),c=d,d.match(/^\\w+$/)||$.module$build$src$core$utils$string.isNumber(d)||(c=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(b+\n\"_end\",$.NameType$$module$build$src$core$names.VARIABLE),a+=\"var \"+c+\" = \"+d+\";\\n\"),d=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(b+\"_inc\",$.NameType$$module$build$src$core$names.VARIABLE),a+=\"var \"+d+\" = \",a=$.module$build$src$core$utils$string.isNumber(e)?a+(Math.abs(e)+\";\\n\"):a+(\"Math.abs(\"+e+\");\\n\"),a+=\"if (\"+g+\" > \"+c+\") {\\n\",a+=module$exports$Blockly$JavaScript.javascriptGenerator.INDENT+d+\" = -\"+d+\";\\n\",a=a+\"}\\nfor (\"+(b+\" = \"+g+\"; \"+d+\" >= 0 ? \"+b+\" <= \"+\nc+\" : \"+b+\" >= \"+c+\"; \"+b+\" += \"+d+\") {\\n\"+f+\"}\\n\");return a};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_forEach=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getName(a.getFieldValue(\"VAR\"),$.NameType$$module$build$src$core$names.VARIABLE);var c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\"[]\";let d=module$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\"DO\");d=module$exports$Blockly$JavaScript.javascriptGenerator.addLoopTrap(d,\na);a=\"\";let e=c;c.match(/^\\w+$/)||(e=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(b+\"_list\",$.NameType$$module$build$src$core$names.VARIABLE),a+=\"var \"+e+\" = \"+c+\";\\n\");c=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(b+\"_index\",$.NameType$$module$build$src$core$names.VARIABLE);d=module$exports$Blockly$JavaScript.javascriptGenerator.INDENT+b+\" = \"+e+\"[\"+c+\"];\\n\"+d;return a+(\"for (var \"+c+\" in \"+e+\") {\\n\"+d+\"}\\n\")};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_flow_statements=function(a){let b=\"\";module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX&&(b+=module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX,a));module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX&&(b+=module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX,\na));if(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX){const c=a.getSurroundLoop();c&&!c.suppressPrefixSuffix&&(b+=module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX,c))}switch(a.getFieldValue(\"FLOW\")){case \"BREAK\":return b+\"break;\\n\";case \"CONTINUE\":return b+\"continue;\\n\"}throw Error(\"Unknown flow statement.\");};var module$exports$Blockly$JavaScript$logic={};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_if=function(a){var b=0;let c=\"\";module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX&&(c+=module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_PREFIX,a));do{const d=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"IF\"+b,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"false\";let e=module$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\n\"DO\"+b);module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX&&(e=module$exports$Blockly$JavaScript.javascriptGenerator.prefixLines(module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX,a),module$exports$Blockly$JavaScript.javascriptGenerator.INDENT)+e);c+=(0<b?\" else \":\"\")+\"if (\"+d+\") {\\n\"+e+\"}\";b++}while(a.getInput(\"IF\"+b));if(a.getInput(\"ELSE\")||module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX)b=\nmodule$exports$Blockly$JavaScript.javascriptGenerator.statementToCode(a,\"ELSE\"),module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX&&(b=module$exports$Blockly$JavaScript.javascriptGenerator.prefixLines(module$exports$Blockly$JavaScript.javascriptGenerator.injectId(module$exports$Blockly$JavaScript.javascriptGenerator.STATEMENT_SUFFIX,a),module$exports$Blockly$JavaScript.javascriptGenerator.INDENT)+b),c+=\" else {\\n\"+b+\"}\";return c+\"\\n\"};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.controls_ifelse=module$exports$Blockly$JavaScript.javascriptGenerator.controls_if;\nmodule$exports$Blockly$JavaScript.javascriptGenerator.logic_compare=function(a){const b={EQ:\"==\",NEQ:\"!=\",LT:\"<\",LTE:\"<=\",GT:\">\",GTE:\">=\"}[a.getFieldValue(\"OP\")],c=\"==\"===b||\"!=\"===b?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_EQUALITY:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_RELATIONAL,d=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"A\",c)||\"0\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"B\",c)||\"0\";return[d+\" \"+b+\n\" \"+a,c]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.logic_operation=function(a){const b=\"AND\"===a.getFieldValue(\"OP\")?\"&&\":\"||\",c=\"&&\"===b?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_AND:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_OR;let d=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"A\",c);a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"B\",c);if(d||a){const e=\"&&\"===b?\"true\":\"false\";d||(d=e);a||(a=e)}else a=\nd=\"false\";return[d+\" \"+b+\" \"+a,c]};module$exports$Blockly$JavaScript.javascriptGenerator.logic_negate=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT;return[\"!\"+(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"BOOL\",b)||\"true\"),b]};module$exports$Blockly$JavaScript.javascriptGenerator.logic_boolean=function(a){return[\"TRUE\"===a.getFieldValue(\"BOOL\")?\"true\":\"false\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.logic_null=function(a){return[\"null\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.logic_ternary=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"IF\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_CONDITIONAL)||\"false\",c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"THEN\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_CONDITIONAL)||\"null\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ELSE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_CONDITIONAL)||\n\"null\";return[b+\" ? \"+c+\" : \"+a,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_CONDITIONAL]};var module$exports$Blockly$JavaScript$lists={},module$contents$Blockly$JavaScript$lists_NameType=$.NameType$$module$build$src$core$names;module$exports$Blockly$JavaScript.javascriptGenerator.lists_create_empty=function(a){return[\"[]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_create_with=function(a){const b=Array(a.itemCount_);for(let c=0;c<a.itemCount_;c++)b[c]=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ADD\"+c,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"null\";return[\"[\"+b.join(\", \")+\"]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_repeat=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"listsRepeat\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`),c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"ITEM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"null\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"NUM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"0\";return[b+\"(\"+c+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_length=function(a){return[(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\")+\".length\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_isEmpty=function(a){return[\"!\"+(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\")+\".length\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_LOGICAL_NOT]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_indexOf=function(a){var b=\"FIRST\"===a.getFieldValue(\"END\")?\"indexOf\":\"lastIndexOf\";const c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"FIND\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";b=(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\")+\".\"+b+\"(\"+c+\")\";return a.workspace.options.oneBasedIndex?\n[b+\" + 1\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ADDITION]:[b,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_getIndex=function(a){const b=a.getFieldValue(\"MODE\")||\"GET\",c=a.getFieldValue(\"WHERE\")||\"FROM_START\";var d=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"VALUE\",\"RANDOM\"===c?module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE:module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\";switch(c){case \"FIRST\":if(\"GET\"===b)return[d+\"[0]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER];\nif(\"GET_REMOVE\"===b)return[d+\".shift()\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER];if(\"REMOVE\"===b)return d+\".shift();\\n\";break;case \"LAST\":if(\"GET\"===b)return[d+\".slice(-1)[0]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER];if(\"GET_REMOVE\"===b)return[d+\".pop()\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER];if(\"REMOVE\"===b)return d+\".pop();\\n\";break;case \"FROM_START\":a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\n\"AT\");if(\"GET\"===b)return[d+\"[\"+a+\"]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER];if(\"GET_REMOVE\"===b)return[d+\".splice(\"+a+\", 1)[0]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];if(\"REMOVE\"===b)return d+\".splice(\"+a+\", 1);\\n\";break;case \"FROM_END\":a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT\",1,!0);if(\"GET\"===b)return[d+\".slice(\"+a+\")[0]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];if(\"GET_REMOVE\"===\nb)return[d+\".splice(\"+a+\", 1)[0]\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];if(\"REMOVE\"===b)return d+\".splice(\"+a+\", 1);\";break;case \"RANDOM\":d=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"listsGetRandomItem\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`)+\"(\"+d+\", \"+(\"GET\"!==b)+\")\";if(\"GET\"===b||\"GET_REMOVE\"===b)return[d,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL];if(\"REMOVE\"===b)return d+\";\\n\"}throw Error(\"Unhandled combination (lists_getIndex).\");};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_setIndex=function(a){function b(){if(c.match(/^\\w+$/))return\"\";const g=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(\"tmpList\",$.NameType$$module$build$src$core$names.VARIABLE),h=\"var \"+g+\" = \"+c+\";\\n\";c=g;return h}let c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\";const d=a.getFieldValue(\"MODE\")||\"GET\";\nvar e=a.getFieldValue(\"WHERE\")||\"FROM_START\";const f=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"TO\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ASSIGNMENT)||\"null\";switch(e){case \"FIRST\":if(\"SET\"===d)return c+\"[0] = \"+f+\";\\n\";if(\"INSERT\"===d)return c+\".unshift(\"+f+\");\\n\";break;case \"LAST\":if(\"SET\"===d)return b()+(c+\"[\"+c+\".length - 1] = \"+f+\";\\n\");if(\"INSERT\"===d)return c+\".push(\"+f+\");\\n\";break;case \"FROM_START\":a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\n\"AT\");if(\"SET\"===d)return c+\"[\"+a+\"] = \"+f+\";\\n\";if(\"INSERT\"===d)return c+\".splice(\"+a+\", 0, \"+f+\");\\n\";break;case \"FROM_END\":a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT\",1,!1,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION);e=b();if(\"SET\"===d)return e+(c+\"[\"+c+\".length - \"+a+\"] = \"+f+\";\\n\");if(\"INSERT\"===d)return e+(c+\".splice(\"+c+\".length - \"+a+\", 0, \"+f+\");\\n\");break;case \"RANDOM\":a=b();e=module$exports$Blockly$JavaScript.javascriptGenerator.nameDB_.getDistinctName(\"tmpX\",\n$.NameType$$module$build$src$core$names.VARIABLE);a+=\"var \"+e+\" = Math.floor(Math.random() * \"+c+\".length);\\n\";if(\"SET\"===d)return a+(c+\"[\"+e+\"] = \"+f+\";\\n\");if(\"INSERT\"===d)return a+(c+\".splice(\"+e+\", 0, \"+f+\");\\n\")}throw Error(\"Unhandled combination (lists_setIndex).\");};var module$contents$Blockly$JavaScript$lists_getSubstringIndex=function(a,b,c){return\"FIRST\"===b?\"0\":\"FROM_END\"===b?a+\".length - 1 - \"+c:\"LAST\"===b?a+\".length - 1\":c};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_getSublist=function(a){var b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER)||\"[]\",c=a.getFieldValue(\"WHERE1\"),d=a.getFieldValue(\"WHERE2\");if(\"FIRST\"===c&&\"LAST\"===d)b+=\".slice(0)\";else if(b.match(/^\\w+$/)||\"FROM_END\"!==c&&\"FROM_START\"===d){switch(c){case \"FROM_START\":c=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT1\");\nbreak;case \"FROM_END\":c=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT1\",1,!1,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION);c=b+\".length - \"+c;break;case \"FIRST\":c=\"0\";break;default:throw Error(\"Unhandled option (lists_getSublist).\");}switch(d){case \"FROM_START\":d=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT2\",1);break;case \"FROM_END\":d=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT2\",0,!1,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_SUBTRACTION);\nd=b+\".length - \"+d;break;case \"LAST\":d=b+\".length\";break;default:throw Error(\"Unhandled option (lists_getSublist).\");}b=b+\".slice(\"+c+\", \"+d+\")\"}else{const e=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT1\");a=module$exports$Blockly$JavaScript.javascriptGenerator.getAdjusted(a,\"AT2\");const f={FIRST:\"First\",LAST:\"Last\",FROM_START:\"FromStart\",FROM_END:\"FromEnd\"};b=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"subsequence\"+f[c]+f[d],`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(sequence${\"FROM_END\"===c||\"FROM_START\"===c?\", at1\":\"\"}${\"FROM_END\"===d||\"FROM_START\"===d?\", at2\":\"\"}) {\n  var start = ${module$contents$Blockly$JavaScript$lists_getSubstringIndex(\"sequence\",c,\"at1\")};\n  var end = ${module$contents$Blockly$JavaScript$lists_getSubstringIndex(\"sequence\",d,\"at2\")} + 1;\n  return sequence.slice(start, end);\n}\n`)+\"(\"+b+(\"FROM_END\"===c||\"FROM_START\"===c?\", \"+e:\"\")+(\"FROM_END\"===d||\"FROM_START\"===d?\", \"+a:\"\")+\")\"}return[b,module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_sort=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL)||\"[]\",c=\"1\"===a.getFieldValue(\"DIRECTION\")?1:-1;a=a.getFieldValue(\"TYPE\");const d=module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"listsGetSortCompare\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return a.toString() > b.toString() ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return a.toString().toLowerCase() > b.toString().toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `);return[b+\".slice().sort(\"+d+'(\"'+a+'\", '+c+\"))\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.lists_split=function(a){let b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"INPUT\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_MEMBER);const c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"DELIM\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"''\";a=a.getFieldValue(\"MODE\");if(\"SPLIT\"===a)b||(b=\"''\"),a=\"split\";else if(\"JOIN\"===a)b||(b=\"[]\"),a=\"join\";else throw Error(\"Unknown mode: \"+\na);return[b+\".\"+a+\"(\"+c+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};module$exports$Blockly$JavaScript.javascriptGenerator.lists_reverse=function(a){return[(module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"LIST\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL)||\"[]\")+\".slice().reverse()\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};var module$exports$Blockly$JavaScript$colour={};module$exports$Blockly$JavaScript.javascriptGenerator.colour_picker=function(a){return[module$exports$Blockly$JavaScript.javascriptGenerator.quote_(a.getFieldValue(\"COLOUR\")),module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_ATOMIC]};module$exports$Blockly$JavaScript.javascriptGenerator.colour_random=function(a){return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"colourRandom\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}() {\n  var num = Math.floor(Math.random() * Math.pow(2, 24));\n  return '#' + ('00000' + num.toString(16)).substr(-6);\n}\n`)+\"()\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.colour_rgb=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"RED\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||0,c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"GREEN\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||0;a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"BLUE\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\n0;return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"colourRgb\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(r, g, b) {\n  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;\n  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;\n  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;\n  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);\n  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);\n  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)+\"(\"+b+\", \"+c+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};\nmodule$exports$Blockly$JavaScript.javascriptGenerator.colour_blend=function(a){const b=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"COLOUR1\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"'#000000'\",c=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"COLOUR2\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\"'#000000'\";a=module$exports$Blockly$JavaScript.javascriptGenerator.valueToCode(a,\"RATIO\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_NONE)||\n.5;return[module$exports$Blockly$JavaScript.javascriptGenerator.provideFunction_(\"colourBlend\",`\nfunction ${module$exports$Blockly$JavaScript.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_}(c1, c2, ratio) {\n  ratio = Math.max(Math.min(Number(ratio), 1), 0);\n  var r1 = parseInt(c1.substring(1, 3), 16);\n  var g1 = parseInt(c1.substring(3, 5), 16);\n  var b1 = parseInt(c1.substring(5, 7), 16);\n  var r2 = parseInt(c2.substring(1, 3), 16);\n  var g2 = parseInt(c2.substring(3, 5), 16);\n  var b2 = parseInt(c2.substring(5, 7), 16);\n  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);\n  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);\n  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);\n  r = ('0' + (r || 0).toString(16)).slice(-2);\n  g = ('0' + (g || 0).toString(16)).slice(-2);\n  b = ('0' + (b || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)+\"(\"+b+\", \"+c+\", \"+a+\")\",module$exports$Blockly$JavaScript.javascriptGenerator.ORDER_FUNCTION_CALL]};var module$exports$Blockly$JavaScript$all=module$exports$Blockly$JavaScript;\nmodule$exports$Blockly$JavaScript.__namespace__=$;\nreturn module$exports$Blockly$JavaScript;\n}));\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvYmxvY2tseS9qYXZhc2NyaXB0X2NvbXByZXNzZWQuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBWUE7QUFPQTtBQWdCQTtBQWlCQTtBQU1BO0FBTUE7QUFNQTtBQU1BO0FBTUE7QUFTQTtBQWFBO0FBU0E7QUFlQTtBQXVCQTtBQWtDQTtBQTRDQTtBQXdCQTtBQWNBO0FBOENBO0FDalNBO0FFbUJBO0FBa0JBO0FBUUE7QUFhQTtBQVdBO0FBUUE7QUFXQTtBQU9BO0FBT0E7QUFXQTtBQUtBO0FBY0E7QUFjQTtBQUNBOzs7O0FBREE7QUFhQTtBQWFBO0FBc0JBO0FBaUJBO0FBVUE7QUFDQTtBQUNBOzs7QUFKQTtBQWtCQTtBQWdCQTtBQUNBOzs7O0FBREE7QUF3QkE7QUFPQTtBQWtCQTtBQUVBO0FBTUE7Ozs7Ozs7QUFEQTtBQWFBO0FBS0E7QUFJQTs7Ozs7QUFEQTtBQ2pWQTtBQVNBO0FBUUE7QUFpQkE7QUFjQTtBQWNBO0FBUUE7QUFVQTtBQ3ZFQTtBQVVBO0FBY0E7QUFrQkE7QUE2QkE7QUErQkE7QUFNQTtBQVFBO0FBS0E7QUFRQTtBQUtBO0FBVUE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQURBO0FBK0JBO0FBV0E7QUFJQTtBQWNBO0FBVUE7OztBQURBO0FBYUE7Ozs7Ozs7Ozs7QUFEQTtBQXNCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQURBO0FBcUNBOzs7Ozs7Ozs7OztBQURBO0FBb0JBOzs7O0FBREE7QUFpQkE7QUFVQTtBQU9BO0FBTUE7QUFPQTs7Ozs7Ozs7O0FBREE7QUFvQkE7QUN0WEE7QUFnQkE7QUFjQTtBQVNBO0FBT0E7QUFPQTtBQVVBO0FBcUJBO0FBaUJBO0FBT0E7QUFRQTtBQWlCQTtBQVVBO0FDakpBO0FBWUE7QUFhQTtBQVlBO0FBRUE7QUFVQTtBQUlBO0FBU0E7QUE4QkE7QUFLQTtBQVVBO0FDcEdBO0FBWUE7QUFHQTs7Ozs7OztBQURBO0FBaUJBO0FBT0E7QUFPQTtBQVVBO0FBS0E7QUFjQTtBQW1CQTtBQWlCQTtBQVVBOzs7Ozs7OztBQURBO0FBc0JBO0FBTUE7QUFrQ0E7QUF5QkE7QUFtQ0E7QUFtQkE7QUFtQkE7QUEwQkE7QUFDQTtBQUNBOzs7QUFKQTtBQWtCQTtBQVNBOzs7Ozs7Ozs7Ozs7QUFEQTtBQXFCQTtBQWtCQTtBQzlXQTs7OztBQURBO0FBVUE7QUFNQTtBQUVBOzs7Ozs7Ozs7QUFEQTtBQWVBO0FBT0E7QUFFQTs7Ozs7Ozs7Ozs7Ozs7OztBQURBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvZ2VuZXJhdG9ycy9qYXZhc2NyaXB0LmpzP2I0NGUiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvZ2VuZXJhdG9ycy9qYXZhc2NyaXB0L3ZhcmlhYmxlcy5qcz9iZDk4Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2dlbmVyYXRvcnMvamF2YXNjcmlwdC92YXJpYWJsZXNfZHluYW1pYy5qcz9kNjBmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2dlbmVyYXRvcnMvamF2YXNjcmlwdC90ZXh0LmpzPzgxYTEiLCJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL2Jsb2NrbHkvZ2VuZXJhdG9ycy9qYXZhc2NyaXB0L3Byb2NlZHVyZXMuanM/MzVmYyIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9nZW5lcmF0b3JzL2phdmFzY3JpcHQvbWF0aC5qcz9hM2Q3Iiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2dlbmVyYXRvcnMvamF2YXNjcmlwdC9sb29wcy5qcz9kMDFmIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2dlbmVyYXRvcnMvamF2YXNjcmlwdC9sb2dpYy5qcz8zNWJhIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2dlbmVyYXRvcnMvamF2YXNjcmlwdC9saXN0cy5qcz9jNjBiIiwid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9ibG9ja2x5L2dlbmVyYXRvcnMvamF2YXNjcmlwdC9jb2xvdXIuanM/ZmVjYSIsIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvYmxvY2tseS9nZW5lcmF0b3JzL2phdmFzY3JpcHQvYWxsLmpzPzdmZWMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgSGVscGVyIGZ1bmN0aW9ucyBmb3IgZ2VuZXJhdGluZyBKYXZhU2NyaXB0IGZvciBibG9ja3MuXG4gKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN8Z2xvYmFsVGhpc31cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5nb29nLm1vZHVsZSgnQmxvY2tseS5KYXZhU2NyaXB0Jyk7XG5cbmNvbnN0IFZhcmlhYmxlcyA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5WYXJpYWJsZXMnKTtcbmNvbnN0IHN0cmluZ1V0aWxzID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LnV0aWxzLnN0cmluZycpO1xuY29uc3Qge0Jsb2NrfSA9IGdvb2cucmVxdWlyZVR5cGUoJ0Jsb2NrbHkuQmxvY2snKTtcbmNvbnN0IHtDb2RlR2VuZXJhdG9yfSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5Db2RlR2VuZXJhdG9yJyk7XG5jb25zdCB7aW5wdXRUeXBlc30gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuaW5wdXRUeXBlcycpO1xuY29uc3Qge05hbWVzLCBOYW1lVHlwZX0gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuTmFtZXMnKTtcbmNvbnN0IHtXb3Jrc3BhY2V9ID0gZ29vZy5yZXF1aXJlVHlwZSgnQmxvY2tseS5Xb3Jrc3BhY2UnKTtcblxuXG4vKipcbiAqIEphdmFTY3JpcHQgY29kZSBnZW5lcmF0b3IuXG4gKiBAdHlwZSB7IUNvZGVHZW5lcmF0b3J9XG4gKi9cbmNvbnN0IEphdmFTY3JpcHQgPSBuZXcgQ29kZUdlbmVyYXRvcignSmF2YVNjcmlwdCcpO1xuXG4vKipcbiAqIExpc3Qgb2YgaWxsZWdhbCB2YXJpYWJsZSBuYW1lcy5cbiAqIFRoaXMgaXMgbm90IGludGVuZGVkIHRvIGJlIGEgc2VjdXJpdHkgZmVhdHVyZS4gIEJsb2NrbHkgaXMgMTAwJSBjbGllbnQtc2lkZSxcbiAqIHNvIGJ5cGFzc2luZyB0aGlzIGxpc3QgaXMgdHJpdmlhbC4gIFRoaXMgaXMgaW50ZW5kZWQgdG8gcHJldmVudCB1c2VycyBmcm9tXG4gKiBhY2NpZGVudGFsbHkgY2xvYmJlcmluZyBhIGJ1aWx0LWluIG9iamVjdCBvciBmdW5jdGlvbi5cbiAqL1xuSmF2YVNjcmlwdC5hZGRSZXNlcnZlZFdvcmRzKFxuICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0xleGljYWxfZ3JhbW1hciNLZXl3b3Jkc1xuICAgICdicmVhayxjYXNlLGNhdGNoLGNsYXNzLGNvbnN0LGNvbnRpbnVlLGRlYnVnZ2VyLGRlZmF1bHQsZGVsZXRlLGRvLGVsc2UsZXhwb3J0LGV4dGVuZHMsZmluYWxseSxmb3IsZnVuY3Rpb24saWYsaW1wb3J0LGluLGluc3RhbmNlb2YsbmV3LHJldHVybixzdXBlcixzd2l0Y2gsdGhpcyx0aHJvdyx0cnksdHlwZW9mLHZhcix2b2lkLHdoaWxlLHdpdGgseWllbGQsJyArXG4gICAgJ2VudW0sJyArXG4gICAgJ2ltcGxlbWVudHMsaW50ZXJmYWNlLGxldCxwYWNrYWdlLHByaXZhdGUscHJvdGVjdGVkLHB1YmxpYyxzdGF0aWMsJyArXG4gICAgJ2F3YWl0LCcgK1xuICAgICdudWxsLHRydWUsZmFsc2UsJyArXG4gICAgLy8gTWFnaWMgdmFyaWFibGUuXG4gICAgJ2FyZ3VtZW50cywnICtcbiAgICAvLyBFdmVyeXRoaW5nIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50ICg4MzUgaXRlbXMgaW4gQ2hyb21lLCAxMDQgaW4gTm9kZSkuXG4gICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZ2xvYmFsVGhpcykuam9pbignLCcpKTtcblxuLyoqXG4gKiBPcmRlciBvZiBvcGVyYXRpb24gRU5VTXMuXG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9PcGVyYXRvcnMvT3BlcmF0b3JfUHJlY2VkZW5jZVxuICovXG5KYXZhU2NyaXB0Lk9SREVSX0FUT01JQyA9IDA7ICAgICAgICAgICAgLy8gMCBcIlwiIC4uLlxuSmF2YVNjcmlwdC5PUkRFUl9ORVcgPSAxLjE7ICAgICAgICAgICAgIC8vIG5ld1xuSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIgPSAxLjI7ICAgICAgICAgIC8vIC4gW11cbkphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTCA9IDI7ICAgICAvLyAoKVxuSmF2YVNjcmlwdC5PUkRFUl9JTkNSRU1FTlQgPSAzOyAgICAgICAgIC8vICsrXG5KYXZhU2NyaXB0Lk9SREVSX0RFQ1JFTUVOVCA9IDM7ICAgICAgICAgLy8gLS1cbkphdmFTY3JpcHQuT1JERVJfQklUV0lTRV9OT1QgPSA0LjE7ICAgICAvLyB+XG5KYXZhU2NyaXB0Lk9SREVSX1VOQVJZX1BMVVMgPSA0LjI7ICAgICAgLy8gK1xuSmF2YVNjcmlwdC5PUkRFUl9VTkFSWV9ORUdBVElPTiA9IDQuMzsgIC8vIC1cbkphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9OT1QgPSA0LjQ7ICAgICAvLyAhXG5KYXZhU2NyaXB0Lk9SREVSX1RZUEVPRiA9IDQuNTsgICAgICAgICAgLy8gdHlwZW9mXG5KYXZhU2NyaXB0Lk9SREVSX1ZPSUQgPSA0LjY7ICAgICAgICAgICAgLy8gdm9pZFxuSmF2YVNjcmlwdC5PUkRFUl9ERUxFVEUgPSA0Ljc7ICAgICAgICAgIC8vIGRlbGV0ZVxuSmF2YVNjcmlwdC5PUkRFUl9BV0FJVCA9IDQuODsgICAgICAgICAgIC8vIGF3YWl0XG5KYXZhU2NyaXB0Lk9SREVSX0VYUE9ORU5USUFUSU9OID0gNS4wOyAgLy8gKipcbkphdmFTY3JpcHQuT1JERVJfTVVMVElQTElDQVRJT04gPSA1LjE7ICAvLyAqXG5KYXZhU2NyaXB0Lk9SREVSX0RJVklTSU9OID0gNS4yOyAgICAgICAgLy8gL1xuSmF2YVNjcmlwdC5PUkRFUl9NT0RVTFVTID0gNS4zOyAgICAgICAgIC8vICVcbkphdmFTY3JpcHQuT1JERVJfU1VCVFJBQ1RJT04gPSA2LjE7ICAgICAvLyAtXG5KYXZhU2NyaXB0Lk9SREVSX0FERElUSU9OID0gNi4yOyAgICAgICAgLy8gK1xuSmF2YVNjcmlwdC5PUkRFUl9CSVRXSVNFX1NISUZUID0gNzsgICAgIC8vIDw8ID4+ID4+PlxuSmF2YVNjcmlwdC5PUkRFUl9SRUxBVElPTkFMID0gODsgICAgICAgIC8vIDwgPD0gPiA+PVxuSmF2YVNjcmlwdC5PUkRFUl9JTiA9IDg7ICAgICAgICAgICAgICAgIC8vIGluXG5KYXZhU2NyaXB0Lk9SREVSX0lOU1RBTkNFT0YgPSA4OyAgICAgICAgLy8gaW5zdGFuY2VvZlxuSmF2YVNjcmlwdC5PUkRFUl9FUVVBTElUWSA9IDk7ICAgICAgICAgIC8vID09ICE9ID09PSAhPT1cbkphdmFTY3JpcHQuT1JERVJfQklUV0lTRV9BTkQgPSAxMDsgICAgICAvLyAmXG5KYXZhU2NyaXB0Lk9SREVSX0JJVFdJU0VfWE9SID0gMTE7ICAgICAgLy8gXlxuSmF2YVNjcmlwdC5PUkRFUl9CSVRXSVNFX09SID0gMTI7ICAgICAgIC8vIHxcbkphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9BTkQgPSAxMzsgICAgICAvLyAmJlxuSmF2YVNjcmlwdC5PUkRFUl9MT0dJQ0FMX09SID0gMTQ7ICAgICAgIC8vIHx8XG5KYXZhU2NyaXB0Lk9SREVSX0NPTkRJVElPTkFMID0gMTU7ICAgICAgLy8gPzpcbkphdmFTY3JpcHQuT1JERVJfQVNTSUdOTUVOVCA9IDE2OyAgICAgICAvLyA9ICs9IC09ICoqPSAqPSAvPSAlPSA8PD0gPj49IC4uLlxuSmF2YVNjcmlwdC5PUkRFUl9ZSUVMRCA9IDE3OyAgICAgICAgICAgIC8vIHlpZWxkXG5KYXZhU2NyaXB0Lk9SREVSX0NPTU1BID0gMTg7ICAgICAgICAgICAgLy8gLFxuSmF2YVNjcmlwdC5PUkRFUl9OT05FID0gOTk7ICAgICAgICAgICAgIC8vICguLi4pXG5cbi8qKlxuICogTGlzdCBvZiBvdXRlci1pbm5lciBwYWlyaW5ncyB0aGF0IGRvIE5PVCByZXF1aXJlIHBhcmVudGhlc2VzLlxuICogQHR5cGUgeyFBcnJheTwhQXJyYXk8bnVtYmVyPj59XG4gKi9cbkphdmFTY3JpcHQuT1JERVJfT1ZFUlJJREVTID0gW1xuICAvLyAoZm9vKCkpLmJhciAtPiBmb28oKS5iYXJcbiAgLy8gKGZvbygpKVswXSAtPiBmb28oKVswXVxuICBbSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUl0sXG4gIC8vIChmb28oKSkoKSAtPiBmb28oKSgpXG4gIFtKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTEwsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF0sXG4gIC8vIChmb28uYmFyKS5iYXogLT4gZm9vLmJhci5iYXpcbiAgLy8gKGZvby5iYXIpWzBdIC0+IGZvby5iYXJbMF1cbiAgLy8gKGZvb1swXSkuYmFyIC0+IGZvb1swXS5iYXJcbiAgLy8gKGZvb1swXSlbMV0gLT4gZm9vWzBdWzFdXG4gIFtKYXZhU2NyaXB0Lk9SREVSX01FTUJFUiwgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVJdLFxuICAvLyAoZm9vLmJhcikoKSAtPiBmb28uYmFyKClcbiAgLy8gKGZvb1swXSkoKSAtPiBmb29bMF0oKVxuICBbSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF0sXG5cbiAgLy8gISghZm9vKSAtPiAhIWZvb1xuICBbSmF2YVNjcmlwdC5PUkRFUl9MT0dJQ0FMX05PVCwgSmF2YVNjcmlwdC5PUkRFUl9MT0dJQ0FMX05PVF0sXG4gIC8vIGEgKiAoYiAqIGMpIC0+IGEgKiBiICogY1xuICBbSmF2YVNjcmlwdC5PUkRFUl9NVUxUSVBMSUNBVElPTiwgSmF2YVNjcmlwdC5PUkRFUl9NVUxUSVBMSUNBVElPTl0sXG4gIC8vIGEgKyAoYiArIGMpIC0+IGEgKyBiICsgY1xuICBbSmF2YVNjcmlwdC5PUkRFUl9BRERJVElPTiwgSmF2YVNjcmlwdC5PUkRFUl9BRERJVElPTl0sXG4gIC8vIGEgJiYgKGIgJiYgYykgLT4gYSAmJiBiICYmIGNcbiAgW0phdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9BTkQsIEphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9BTkRdLFxuICAvLyBhIHx8IChiIHx8IGMpIC0+IGEgfHwgYiB8fCBjXG4gIFtKYXZhU2NyaXB0Lk9SREVSX0xPR0lDQUxfT1IsIEphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9PUl1cbl07XG5cbi8qKlxuICogV2hldGhlciB0aGUgaW5pdCBtZXRob2QgaGFzIGJlZW4gY2FsbGVkLlxuICogQHR5cGUgez9ib29sZWFufVxuICovXG5KYXZhU2NyaXB0LmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuLyoqXG4gKiBJbml0aWFsaXNlIHRoZSBkYXRhYmFzZSBvZiB2YXJpYWJsZSBuYW1lcy5cbiAqIEBwYXJhbSB7IVdvcmtzcGFjZX0gd29ya3NwYWNlIFdvcmtzcGFjZSB0byBnZW5lcmF0ZSBjb2RlIGZyb20uXG4gKi9cbkphdmFTY3JpcHQuaW5pdCA9IGZ1bmN0aW9uKHdvcmtzcGFjZSkge1xuICAvLyBDYWxsIEJsb2NrbHkuQ29kZUdlbmVyYXRvcidzIGluaXQuXG4gIE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5pbml0LmNhbGwodGhpcyk7XG5cbiAgaWYgKCF0aGlzLm5hbWVEQl8pIHtcbiAgICB0aGlzLm5hbWVEQl8gPSBuZXcgTmFtZXModGhpcy5SRVNFUlZFRF9XT1JEU18pO1xuICB9IGVsc2Uge1xuICAgIHRoaXMubmFtZURCXy5yZXNldCgpO1xuICB9XG5cbiAgdGhpcy5uYW1lREJfLnNldFZhcmlhYmxlTWFwKHdvcmtzcGFjZS5nZXRWYXJpYWJsZU1hcCgpKTtcbiAgdGhpcy5uYW1lREJfLnBvcHVsYXRlVmFyaWFibGVzKHdvcmtzcGFjZSk7XG4gIHRoaXMubmFtZURCXy5wb3B1bGF0ZVByb2NlZHVyZXMod29ya3NwYWNlKTtcblxuICBjb25zdCBkZWZ2YXJzID0gW107XG4gIC8vIEFkZCBkZXZlbG9wZXIgdmFyaWFibGVzIChub3QgY3JlYXRlZCBvciBuYW1lZCBieSB0aGUgdXNlcikuXG4gIGNvbnN0IGRldlZhckxpc3QgPSBWYXJpYWJsZXMuYWxsRGV2ZWxvcGVyVmFyaWFibGVzKHdvcmtzcGFjZSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGV2VmFyTGlzdC5sZW5ndGg7IGkrKykge1xuICAgIGRlZnZhcnMucHVzaChcbiAgICAgICAgdGhpcy5uYW1lREJfLmdldE5hbWUoZGV2VmFyTGlzdFtpXSwgTmFtZVR5cGUuREVWRUxPUEVSX1ZBUklBQkxFKSk7XG4gIH1cblxuICAvLyBBZGQgdXNlciB2YXJpYWJsZXMsIGJ1dCBvbmx5IG9uZXMgdGhhdCBhcmUgYmVpbmcgdXNlZC5cbiAgY29uc3QgdmFyaWFibGVzID0gVmFyaWFibGVzLmFsbFVzZWRWYXJNb2RlbHMod29ya3NwYWNlKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YXJpYWJsZXMubGVuZ3RoOyBpKyspIHtcbiAgICBkZWZ2YXJzLnB1c2godGhpcy5uYW1lREJfLmdldE5hbWUodmFyaWFibGVzW2ldLmdldElkKCksIE5hbWVUeXBlLlZBUklBQkxFKSk7XG4gIH1cblxuICAvLyBEZWNsYXJlIGFsbCBvZiB0aGUgdmFyaWFibGVzLlxuICBpZiAoZGVmdmFycy5sZW5ndGgpIHtcbiAgICB0aGlzLmRlZmluaXRpb25zX1sndmFyaWFibGVzJ10gPSAndmFyICcgKyBkZWZ2YXJzLmpvaW4oJywgJykgKyAnOyc7XG4gIH1cbiAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbn07XG5cbi8qKlxuICogUHJlcGVuZCB0aGUgZ2VuZXJhdGVkIGNvZGUgd2l0aCB0aGUgdmFyaWFibGUgZGVmaW5pdGlvbnMuXG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZSBHZW5lcmF0ZWQgY29kZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQ29tcGxldGVkIGNvZGUuXG4gKi9cbkphdmFTY3JpcHQuZmluaXNoID0gZnVuY3Rpb24oY29kZSkge1xuICAvLyBDb252ZXJ0IHRoZSBkZWZpbml0aW9ucyBkaWN0aW9uYXJ5IGludG8gYSBsaXN0LlxuICBjb25zdCBkZWZpbml0aW9ucyA9IE9iamVjdC52YWx1ZXModGhpcy5kZWZpbml0aW9uc18pO1xuICAvLyBDYWxsIEJsb2NrbHkuQ29kZUdlbmVyYXRvcidzIGZpbmlzaC5cbiAgY29kZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5maW5pc2guY2FsbCh0aGlzLCBjb2RlKTtcbiAgdGhpcy5pc0luaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgdGhpcy5uYW1lREJfLnJlc2V0KCk7XG4gIHJldHVybiBkZWZpbml0aW9ucy5qb2luKCdcXG5cXG4nKSArICdcXG5cXG5cXG4nICsgY29kZTtcbn07XG5cbi8qKlxuICogTmFrZWQgdmFsdWVzIGFyZSB0b3AtbGV2ZWwgYmxvY2tzIHdpdGggb3V0cHV0cyB0aGF0IGFyZW4ndCBwbHVnZ2VkIGludG9cbiAqIGFueXRoaW5nLiAgQSB0cmFpbGluZyBzZW1pY29sb24gaXMgbmVlZGVkIHRvIG1ha2UgdGhpcyBsZWdhbC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBsaW5lIExpbmUgb2YgZ2VuZXJhdGVkIGNvZGUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IExlZ2FsIGxpbmUgb2YgY29kZS5cbiAqL1xuSmF2YVNjcmlwdC5zY3J1Yk5ha2VkVmFsdWUgPSBmdW5jdGlvbihsaW5lKSB7XG4gIHJldHVybiBsaW5lICsgJztcXG4nO1xufTtcblxuLyoqXG4gKiBFbmNvZGUgYSBzdHJpbmcgYXMgYSBwcm9wZXJseSBlc2NhcGVkIEphdmFTY3JpcHQgc3RyaW5nLCBjb21wbGV0ZSB3aXRoXG4gKiBxdW90ZXMuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRleHQgdG8gZW5jb2RlLlxuICogQHJldHVybiB7c3RyaW5nfSBKYXZhU2NyaXB0IHN0cmluZy5cbiAqIEBwcm90ZWN0ZWRcbiAqL1xuSmF2YVNjcmlwdC5xdW90ZV8gPSBmdW5jdGlvbihzdHJpbmcpIHtcbiAgLy8gQ2FuJ3QgdXNlIGdvb2cuc3RyaW5nLnF1b3RlIHNpbmNlIEdvb2dsZSdzIHN0eWxlIGd1aWRlIHJlY29tbWVuZHNcbiAgLy8gSlMgc3RyaW5nIGxpdGVyYWxzIHVzZSBzaW5nbGUgcXVvdGVzLlxuICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKVxuICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCAnXFxcXFxcbicpXG4gICAgICAgICAgICAgICAucmVwbGFjZSgvJy9nLCAnXFxcXFxcJycpO1xuICByZXR1cm4gJ1xcJycgKyBzdHJpbmcgKyAnXFwnJztcbn07XG5cbi8qKlxuICogRW5jb2RlIGEgc3RyaW5nIGFzIGEgcHJvcGVybHkgZXNjYXBlZCBtdWx0aWxpbmUgSmF2YVNjcmlwdCBzdHJpbmcsIGNvbXBsZXRlXG4gKiB3aXRoIHF1b3Rlcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGV4dCB0byBlbmNvZGUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEphdmFTY3JpcHQgc3RyaW5nLlxuICogQHByb3RlY3RlZFxuICovXG5KYXZhU2NyaXB0Lm11bHRpbGluZV9xdW90ZV8gPSBmdW5jdGlvbihzdHJpbmcpIHtcbiAgLy8gQ2FuJ3QgdXNlIGdvb2cuc3RyaW5nLnF1b3RlIHNpbmNlIEdvb2dsZSdzIHN0eWxlIGd1aWRlIHJlY29tbWVuZHNcbiAgLy8gSlMgc3RyaW5nIGxpdGVyYWxzIHVzZSBzaW5nbGUgcXVvdGVzLlxuICBjb25zdCBsaW5lcyA9IHN0cmluZy5zcGxpdCgvXFxuL2cpLm1hcCh0aGlzLnF1b3RlXyk7XG4gIHJldHVybiBsaW5lcy5qb2luKCcgKyBcXCdcXFxcblxcJyArXFxuJyk7XG59O1xuXG4vKipcbiAqIENvbW1vbiB0YXNrcyBmb3IgZ2VuZXJhdGluZyBKYXZhU2NyaXB0IGZyb20gYmxvY2tzLlxuICogSGFuZGxlcyBjb21tZW50cyBmb3IgdGhlIHNwZWNpZmllZCBibG9jayBhbmQgYW55IGNvbm5lY3RlZCB2YWx1ZSBibG9ja3MuXG4gKiBDYWxscyBhbnkgc3RhdGVtZW50cyBmb2xsb3dpbmcgdGhpcyBibG9jay5cbiAqIEBwYXJhbSB7IUJsb2NrfSBibG9jayBUaGUgY3VycmVudCBibG9jay5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlIFRoZSBKYXZhU2NyaXB0IGNvZGUgY3JlYXRlZCBmb3IgdGhpcyBibG9jay5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF90aGlzT25seSBUcnVlIHRvIGdlbmVyYXRlIGNvZGUgZm9yIG9ubHkgdGhpcyBzdGF0ZW1lbnQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEphdmFTY3JpcHQgY29kZSB3aXRoIGNvbW1lbnRzIGFuZCBzdWJzZXF1ZW50IGJsb2NrcyBhZGRlZC5cbiAqIEBwcm90ZWN0ZWRcbiAqL1xuSmF2YVNjcmlwdC5zY3J1Yl8gPSBmdW5jdGlvbihibG9jaywgY29kZSwgb3B0X3RoaXNPbmx5KSB7XG4gIGxldCBjb21tZW50Q29kZSA9ICcnO1xuICAvLyBPbmx5IGNvbGxlY3QgY29tbWVudHMgZm9yIGJsb2NrcyB0aGF0IGFyZW4ndCBpbmxpbmUuXG4gIGlmICghYmxvY2sub3V0cHV0Q29ubmVjdGlvbiB8fCAhYmxvY2sub3V0cHV0Q29ubmVjdGlvbi50YXJnZXRDb25uZWN0aW9uKSB7XG4gICAgLy8gQ29sbGVjdCBjb21tZW50IGZvciB0aGlzIGJsb2NrLlxuICAgIGxldCBjb21tZW50ID0gYmxvY2suZ2V0Q29tbWVudFRleHQoKTtcbiAgICBpZiAoY29tbWVudCkge1xuICAgICAgY29tbWVudCA9IHN0cmluZ1V0aWxzLndyYXAoY29tbWVudCwgdGhpcy5DT01NRU5UX1dSQVAgLSAzKTtcbiAgICAgIGNvbW1lbnRDb2RlICs9IHRoaXMucHJlZml4TGluZXMoY29tbWVudCArICdcXG4nLCAnLy8gJyk7XG4gICAgfVxuICAgIC8vIENvbGxlY3QgY29tbWVudHMgZm9yIGFsbCB2YWx1ZSBhcmd1bWVudHMuXG4gICAgLy8gRG9uJ3QgY29sbGVjdCBjb21tZW50cyBmb3IgbmVzdGVkIHN0YXRlbWVudHMuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9jay5pbnB1dExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChibG9jay5pbnB1dExpc3RbaV0udHlwZSA9PT0gaW5wdXRUeXBlcy5WQUxVRSkge1xuICAgICAgICBjb25zdCBjaGlsZEJsb2NrID0gYmxvY2suaW5wdXRMaXN0W2ldLmNvbm5lY3Rpb24udGFyZ2V0QmxvY2soKTtcbiAgICAgICAgaWYgKGNoaWxkQmxvY2spIHtcbiAgICAgICAgICBjb21tZW50ID0gdGhpcy5hbGxOZXN0ZWRDb21tZW50cyhjaGlsZEJsb2NrKTtcbiAgICAgICAgICBpZiAoY29tbWVudCkge1xuICAgICAgICAgICAgY29tbWVudENvZGUgKz0gdGhpcy5wcmVmaXhMaW5lcyhjb21tZW50LCAnLy8gJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNvbnN0IG5leHRCbG9jayA9IGJsb2NrLm5leHRDb25uZWN0aW9uICYmIGJsb2NrLm5leHRDb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7XG4gIGNvbnN0IG5leHRDb2RlID0gb3B0X3RoaXNPbmx5ID8gJycgOiB0aGlzLmJsb2NrVG9Db2RlKG5leHRCbG9jayk7XG4gIHJldHVybiBjb21tZW50Q29kZSArIGNvZGUgKyBuZXh0Q29kZTtcbn07XG5cbi8qKlxuICogR2V0cyBhIHByb3BlcnR5IGFuZCBhZGp1c3RzIHRoZSB2YWx1ZSB3aGlsZSB0YWtpbmcgaW50byBhY2NvdW50IGluZGV4aW5nLlxuICogQHBhcmFtIHshQmxvY2t9IGJsb2NrIFRoZSBibG9jay5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhdElkIFRoZSBwcm9wZXJ0eSBJRCBvZiB0aGUgZWxlbWVudCB0byBnZXQuXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9kZWx0YSBWYWx1ZSB0byBhZGQuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfbmVnYXRlIFdoZXRoZXIgdG8gbmVnYXRlIHRoZSB2YWx1ZS5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X29yZGVyIFRoZSBoaWdoZXN0IG9yZGVyIGFjdGluZyBvbiB0aGlzIHZhbHVlLlxuICogQHJldHVybiB7c3RyaW5nfG51bWJlcn1cbiAqL1xuSmF2YVNjcmlwdC5nZXRBZGp1c3RlZCA9IGZ1bmN0aW9uKFxuICAgIGJsb2NrLCBhdElkLCBvcHRfZGVsdGEsIG9wdF9uZWdhdGUsIG9wdF9vcmRlcikge1xuICBsZXQgZGVsdGEgPSBvcHRfZGVsdGEgfHwgMDtcbiAgbGV0IG9yZGVyID0gb3B0X29yZGVyIHx8IHRoaXMuT1JERVJfTk9ORTtcbiAgaWYgKGJsb2NrLndvcmtzcGFjZS5vcHRpb25zLm9uZUJhc2VkSW5kZXgpIHtcbiAgICBkZWx0YS0tO1xuICB9XG4gIGNvbnN0IGRlZmF1bHRBdEluZGV4ID0gYmxvY2sud29ya3NwYWNlLm9wdGlvbnMub25lQmFzZWRJbmRleCA/ICcxJyA6ICcwJztcblxuICBsZXQgaW5uZXJPcmRlcjtcbiAgbGV0IG91dGVyT3JkZXIgPSBvcmRlcjtcbiAgaWYgKGRlbHRhID4gMCkge1xuICAgIG91dGVyT3JkZXIgPSB0aGlzLk9SREVSX0FERElUSU9OO1xuICAgIGlubmVyT3JkZXIgPSB0aGlzLk9SREVSX0FERElUSU9OO1xuICB9IGVsc2UgaWYgKGRlbHRhIDwgMCkge1xuICAgIG91dGVyT3JkZXIgPSB0aGlzLk9SREVSX1NVQlRSQUNUSU9OO1xuICAgIGlubmVyT3JkZXIgPSB0aGlzLk9SREVSX1NVQlRSQUNUSU9OO1xuICB9IGVsc2UgaWYgKG9wdF9uZWdhdGUpIHtcbiAgICBvdXRlck9yZGVyID0gdGhpcy5PUkRFUl9VTkFSWV9ORUdBVElPTjtcbiAgICBpbm5lck9yZGVyID0gdGhpcy5PUkRFUl9VTkFSWV9ORUdBVElPTjtcbiAgfVxuXG4gIGxldCBhdCA9IHRoaXMudmFsdWVUb0NvZGUoYmxvY2ssIGF0SWQsIG91dGVyT3JkZXIpIHx8IGRlZmF1bHRBdEluZGV4O1xuXG4gIGlmIChzdHJpbmdVdGlscy5pc051bWJlcihhdCkpIHtcbiAgICAvLyBJZiB0aGUgaW5kZXggaXMgYSBuYWtlZCBudW1iZXIsIGFkanVzdCBpdCByaWdodCBub3cuXG4gICAgYXQgPSBOdW1iZXIoYXQpICsgZGVsdGE7XG4gICAgaWYgKG9wdF9uZWdhdGUpIHtcbiAgICAgIGF0ID0gLWF0O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBJZiB0aGUgaW5kZXggaXMgZHluYW1pYywgYWRqdXN0IGl0IGluIGNvZGUuXG4gICAgaWYgKGRlbHRhID4gMCkge1xuICAgICAgYXQgPSBhdCArICcgKyAnICsgZGVsdGE7XG4gICAgfSBlbHNlIGlmIChkZWx0YSA8IDApIHtcbiAgICAgIGF0ID0gYXQgKyAnIC0gJyArIC1kZWx0YTtcbiAgICB9XG4gICAgaWYgKG9wdF9uZWdhdGUpIHtcbiAgICAgIGlmIChkZWx0YSkge1xuICAgICAgICBhdCA9ICctKCcgKyBhdCArICcpJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF0ID0gJy0nICsgYXQ7XG4gICAgICB9XG4gICAgfVxuICAgIGlubmVyT3JkZXIgPSBNYXRoLmZsb29yKGlubmVyT3JkZXIpO1xuICAgIG9yZGVyID0gTWF0aC5mbG9vcihvcmRlcik7XG4gICAgaWYgKGlubmVyT3JkZXIgJiYgb3JkZXIgPj0gaW5uZXJPcmRlcikge1xuICAgICAgYXQgPSAnKCcgKyBhdCArICcpJztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGF0O1xufTtcblxuZXhwb3J0cy5qYXZhc2NyaXB0R2VuZXJhdG9yID0gSmF2YVNjcmlwdDtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEdlbmVyYXRpbmcgSmF2YVNjcmlwdCBmb3IgdmFyaWFibGUgYmxvY2tzLlxuICovXG4ndXNlIHN0cmljdCc7XG5cbmdvb2cubW9kdWxlKCdCbG9ja2x5LkphdmFTY3JpcHQudmFyaWFibGVzJyk7XG5cbmNvbnN0IHtOYW1lVHlwZX0gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuTmFtZXMnKTtcbmNvbnN0IHtqYXZhc2NyaXB0R2VuZXJhdG9yOiBKYXZhU2NyaXB0fSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0Jyk7XG5cblxuSmF2YVNjcmlwdFsndmFyaWFibGVzX2dldCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gVmFyaWFibGUgZ2V0dGVyLlxuICBjb25zdCBjb2RlID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldE5hbWUoYmxvY2suZ2V0RmllbGRWYWx1ZSgnVkFSJyksXG4gICAgICBOYW1lVHlwZS5WQVJJQUJMRSk7XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9BVE9NSUNdO1xufTtcblxuSmF2YVNjcmlwdFsndmFyaWFibGVzX3NldCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gVmFyaWFibGUgc2V0dGVyLlxuICBjb25zdCBhcmd1bWVudDAgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKFxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2ssICdWQUxVRScsIEphdmFTY3JpcHQuT1JERVJfQVNTSUdOTUVOVCkgfHwgJzAnO1xuICBjb25zdCB2YXJOYW1lID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldE5hbWUoXG4gICAgICBibG9jay5nZXRGaWVsZFZhbHVlKCdWQVInKSwgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICByZXR1cm4gdmFyTmFtZSArICcgPSAnICsgYXJndW1lbnQwICsgJztcXG4nO1xufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEdlbmVyYXRpbmcgSmF2YVNjcmlwdCBmb3IgZHluYW1pYyB2YXJpYWJsZSBibG9ja3MuXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC52YXJpYWJsZXNEeW5hbWljJyk7XG5cbmNvbnN0IHtqYXZhc2NyaXB0R2VuZXJhdG9yOiBKYXZhU2NyaXB0fSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0Jyk7XG4vKiogQHN1cHByZXNzIHtleHRyYVJlcXVpcmV9ICovXG5nb29nLnJlcXVpcmUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC52YXJpYWJsZXMnKTtcblxuXG4vLyBKYXZhU2NyaXB0IGlzIGR5bmFtaWNhbGx5IHR5cGVkLlxuSmF2YVNjcmlwdFsndmFyaWFibGVzX2dldF9keW5hbWljJ10gPSBKYXZhU2NyaXB0Wyd2YXJpYWJsZXNfZ2V0J107XG5KYXZhU2NyaXB0Wyd2YXJpYWJsZXNfc2V0X2R5bmFtaWMnXSA9IEphdmFTY3JpcHRbJ3ZhcmlhYmxlc19zZXQnXTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEdlbmVyYXRpbmcgSmF2YVNjcmlwdCBmb3IgdGV4dCBibG9ja3MuXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC50ZXh0cycpO1xuXG5jb25zdCB7TmFtZVR5cGV9ID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5Lk5hbWVzJyk7XG5jb25zdCB7amF2YXNjcmlwdEdlbmVyYXRvcjogSmF2YVNjcmlwdH0gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuSmF2YVNjcmlwdCcpO1xuXG5cbi8qKlxuICogUmVndWxhciBleHByZXNzaW9uIHRvIGRldGVjdCBhIHNpbmdsZS1xdW90ZWQgc3RyaW5nIGxpdGVyYWwuXG4gKi9cbmNvbnN0IHN0clJlZ0V4cCA9IC9eXFxzKicoW14nXXxcXFxcJykqJ1xccyokLztcblxuLyoqXG4gKiBFbmNsb3NlIHRoZSBwcm92aWRlZCB2YWx1ZSBpbiAnU3RyaW5nKC4uLiknIGZ1bmN0aW9uLlxuICogTGVhdmUgc3RyaW5nIGxpdGVyYWxzIGFsb25lLlxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIENvZGUgZXZhbHVhdGluZyB0byBhIHZhbHVlLlxuICogQHJldHVybiB7QXJyYXk8c3RyaW5nfG51bWJlcj59IEFycmF5IGNvbnRhaW5pbmcgY29kZSBldmFsdWF0aW5nIHRvIGEgc3RyaW5nXG4gKiAgICAgYW5kIHRoZSBvcmRlciBvZiB0aGUgcmV0dXJuZWQgY29kZS5bc3RyaW5nLCBudW1iZXJdXG4gKi9cbmNvbnN0IGZvcmNlU3RyaW5nID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgaWYgKHN0clJlZ0V4cC50ZXN0KHZhbHVlKSkge1xuICAgIHJldHVybiBbdmFsdWUsIEphdmFTY3JpcHQuT1JERVJfQVRPTUlDXTtcbiAgfVxuICByZXR1cm4gWydTdHJpbmcoJyArIHZhbHVlICsgJyknLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGFuIGV4cHJlc3Npb24gY2FsY3VsYXRpbmcgdGhlIGluZGV4IGludG8gYSBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nTmFtZSBOYW1lIG9mIHRoZSBzdHJpbmcsIHVzZWQgdG8gY2FsY3VsYXRlIGxlbmd0aC5cbiAqIEBwYXJhbSB7c3RyaW5nfSB3aGVyZSBUaGUgbWV0aG9kIG9mIGluZGV4aW5nLCBzZWxlY3RlZCBieSBkcm9wZG93biBpbiBCbG9ja2x5XG4gKiBAcGFyYW0ge3N0cmluZz19IG9wdF9hdCBUaGUgb3B0aW9uYWwgb2Zmc2V0IHdoZW4gaW5kZXhpbmcgZnJvbSBzdGFydC9lbmQuXG4gKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSBJbmRleCBleHByZXNzaW9uLlxuICovXG5jb25zdCBnZXRTdWJzdHJpbmdJbmRleCA9IGZ1bmN0aW9uKHN0cmluZ05hbWUsIHdoZXJlLCBvcHRfYXQpIHtcbiAgaWYgKHdoZXJlID09PSAnRklSU1QnKSB7XG4gICAgcmV0dXJuICcwJztcbiAgfSBlbHNlIGlmICh3aGVyZSA9PT0gJ0ZST01fRU5EJykge1xuICAgIHJldHVybiBzdHJpbmdOYW1lICsgJy5sZW5ndGggLSAxIC0gJyArIG9wdF9hdDtcbiAgfSBlbHNlIGlmICh3aGVyZSA9PT0gJ0xBU1QnKSB7XG4gICAgcmV0dXJuIHN0cmluZ05hbWUgKyAnLmxlbmd0aCAtIDEnO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBvcHRfYXQ7XG4gIH1cbn07XG5cbkphdmFTY3JpcHRbJ3RleHQnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIFRleHQgdmFsdWUuXG4gIGNvbnN0IGNvZGUgPSBKYXZhU2NyaXB0LnF1b3RlXyhibG9jay5nZXRGaWVsZFZhbHVlKCdURVhUJykpO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfQVRPTUlDXTtcbn07XG5cbkphdmFTY3JpcHRbJ3RleHRfbXVsdGlsaW5lJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBUZXh0IHZhbHVlLlxuICBjb25zdCBjb2RlID0gSmF2YVNjcmlwdC5tdWx0aWxpbmVfcXVvdGVfKGJsb2NrLmdldEZpZWxkVmFsdWUoJ1RFWFQnKSk7XG4gIGNvbnN0IG9yZGVyID0gY29kZS5pbmRleE9mKCcrJykgIT09IC0xID8gSmF2YVNjcmlwdC5PUkRFUl9BRERJVElPTiA6XG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX0FUT01JQztcbiAgcmV0dXJuIFtjb2RlLCBvcmRlcl07XG59O1xuXG5KYXZhU2NyaXB0Wyd0ZXh0X2pvaW4nXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIENyZWF0ZSBhIHN0cmluZyBtYWRlIHVwIG9mIGFueSBudW1iZXIgb2YgZWxlbWVudHMgb2YgYW55IHR5cGUuXG4gIHN3aXRjaCAoYmxvY2suaXRlbUNvdW50Xykge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiBbXCInJ1wiLCBKYXZhU2NyaXB0Lk9SREVSX0FUT01JQ107XG4gICAgY2FzZSAxOiB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0FERDAnLFxuICAgICAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICAgICAgY29uc3QgY29kZUFuZE9yZGVyID0gZm9yY2VTdHJpbmcoZWxlbWVudCk7XG4gICAgICByZXR1cm4gY29kZUFuZE9yZGVyO1xuICAgIH1cbiAgICBjYXNlIDI6IHtcbiAgICAgIGNvbnN0IGVsZW1lbnQwID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0FERDAnLFxuICAgICAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICAgICAgY29uc3QgZWxlbWVudDEgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnQUREMScsXG4gICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCBcIicnXCI7XG4gICAgICBjb25zdCBjb2RlID0gZm9yY2VTdHJpbmcoZWxlbWVudDApWzBdICtcbiAgICAgICAgICAnICsgJyArIGZvcmNlU3RyaW5nKGVsZW1lbnQxKVswXTtcbiAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9BRERJVElPTl07XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnN0IGVsZW1lbnRzID0gbmV3IEFycmF5KGJsb2NrLml0ZW1Db3VudF8pO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9jay5pdGVtQ291bnRfOyBpKyspIHtcbiAgICAgICAgZWxlbWVudHNbaV0gPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnQUREJyArIGksXG4gICAgICAgICAgICBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8IFwiJydcIjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvZGUgPSAnWycgKyBlbGVtZW50cy5qb2luKCcsJykgKyAnXS5qb2luKFxcJ1xcJyknO1xuICAgICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xuICAgIH1cbiAgfVxufTtcblxuSmF2YVNjcmlwdFsndGV4dF9hcHBlbmQnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIEFwcGVuZCB0byBhIHZhcmlhYmxlIGluIHBsYWNlLlxuICBjb25zdCB2YXJOYW1lID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldE5hbWUoXG4gICAgICBibG9jay5nZXRGaWVsZFZhbHVlKCdWQVInKSwgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICBjb25zdCB2YWx1ZSA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdURVhUJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICBjb25zdCBjb2RlID0gdmFyTmFtZSArICcgKz0gJyArXG4gICAgICBmb3JjZVN0cmluZyh2YWx1ZSlbMF0gKyAnO1xcbic7XG4gIHJldHVybiBjb2RlO1xufTtcblxuSmF2YVNjcmlwdFsndGV4dF9sZW5ndGgnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIFN0cmluZyBvciBhcnJheSBsZW5ndGguXG4gIGNvbnN0IHRleHQgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnVkFMVUUnLFxuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIpIHx8IFwiJydcIjtcbiAgcmV0dXJuIFt0ZXh0ICsgJy5sZW5ndGgnLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUl07XG59O1xuXG5KYXZhU2NyaXB0Wyd0ZXh0X2lzRW1wdHknXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIElzIHRoZSBzdHJpbmcgbnVsbCBvciBhcnJheSBlbXB0eT9cbiAgY29uc3QgdGV4dCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdWQUxVRScsXG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUikgfHwgXCInJ1wiO1xuICByZXR1cm4gWychJyArIHRleHQgKyAnLmxlbmd0aCcsIEphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9OT1RdO1xufTtcblxuSmF2YVNjcmlwdFsndGV4dF9pbmRleE9mJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBTZWFyY2ggdGhlIHRleHQgZm9yIGEgc3Vic3RyaW5nLlxuICBjb25zdCBvcGVyYXRvciA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ0VORCcpID09PSAnRklSU1QnID9cbiAgICAgICdpbmRleE9mJyA6ICdsYXN0SW5kZXhPZic7XG4gIGNvbnN0IHN1YnN0cmluZyA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdGSU5EJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICBjb25zdCB0ZXh0ID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1ZBTFVFJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTUVNQkVSKSB8fCBcIicnXCI7XG4gIGNvbnN0IGNvZGUgPSB0ZXh0ICsgJy4nICsgb3BlcmF0b3IgKyAnKCcgKyBzdWJzdHJpbmcgKyAnKSc7XG4gIC8vIEFkanVzdCBpbmRleCBpZiB1c2luZyBvbmUtYmFzZWQgaW5kaWNlcy5cbiAgaWYgKGJsb2NrLndvcmtzcGFjZS5vcHRpb25zLm9uZUJhc2VkSW5kZXgpIHtcbiAgICByZXR1cm4gW2NvZGUgKyAnICsgMScsIEphdmFTY3JpcHQuT1JERVJfQURESVRJT05dO1xuICB9XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ3RleHRfY2hhckF0J10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBHZXQgbGV0dGVyIGF0IGluZGV4LlxuICAvLyBOb3RlOiBVbnRpbCBKYW51YXJ5IDIwMTMgdGhpcyBibG9jayBkaWQgbm90IGhhdmUgdGhlIFdIRVJFIGlucHV0LlxuICBjb25zdCB3aGVyZSA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ1dIRVJFJykgfHwgJ0ZST01fU1RBUlQnO1xuICBjb25zdCB0ZXh0T3JkZXIgPSAod2hlcmUgPT09ICdSQU5ET00nKSA/IEphdmFTY3JpcHQuT1JERVJfTk9ORSA6XG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUjtcbiAgY29uc3QgdGV4dCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdWQUxVRScsIHRleHRPcmRlcikgfHwgXCInJ1wiO1xuICBzd2l0Y2ggKHdoZXJlKSB7XG4gICAgY2FzZSAnRklSU1QnOiB7XG4gICAgICBjb25zdCBjb2RlID0gdGV4dCArICcuY2hhckF0KDApJztcbiAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbiAgICB9XG4gICAgY2FzZSAnTEFTVCc6IHtcbiAgICAgIGNvbnN0IGNvZGUgPSB0ZXh0ICsgJy5zbGljZSgtMSknO1xuICAgICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xuICAgIH1cbiAgICBjYXNlICdGUk9NX1NUQVJUJzoge1xuICAgICAgY29uc3QgYXQgPSBKYXZhU2NyaXB0LmdldEFkanVzdGVkKGJsb2NrLCAnQVQnKTtcbiAgICAgIC8vIEFkanVzdCBpbmRleCBpZiB1c2luZyBvbmUtYmFzZWQgaW5kaWNlcy5cbiAgICAgIGNvbnN0IGNvZGUgPSB0ZXh0ICsgJy5jaGFyQXQoJyArIGF0ICsgJyknO1xuICAgICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xuICAgIH1cbiAgICBjYXNlICdGUk9NX0VORCc6IHtcbiAgICAgIGNvbnN0IGF0ID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChibG9jaywgJ0FUJywgMSwgdHJ1ZSk7XG4gICAgICBjb25zdCBjb2RlID0gdGV4dCArICcuc2xpY2UoJyArIGF0ICsgJykuY2hhckF0KDApJztcbiAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbiAgICB9XG4gICAgY2FzZSAnUkFORE9NJzoge1xuICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCd0ZXh0UmFuZG9tTGV0dGVyJywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffSh0ZXh0KSB7XG4gIHZhciB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGV4dC5sZW5ndGgpO1xuICByZXR1cm4gdGV4dFt4XTtcbn1cbmApO1xuICAgICAgY29uc3QgY29kZSA9IGZ1bmN0aW9uTmFtZSArICcoJyArIHRleHQgKyAnKSc7XG4gICAgICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG4gICAgfVxuICB9XG4gIHRocm93IEVycm9yKCdVbmhhbmRsZWQgb3B0aW9uICh0ZXh0X2NoYXJBdCkuJyk7XG59O1xuXG5KYXZhU2NyaXB0Wyd0ZXh0X2dldFN1YnN0cmluZyddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gR2V0IHN1YnN0cmluZy5cbiAgY29uc3Qgd2hlcmUxID0gYmxvY2suZ2V0RmllbGRWYWx1ZSgnV0hFUkUxJyk7XG4gIGNvbnN0IHdoZXJlMiA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ1dIRVJFMicpO1xuICBjb25zdCByZXF1aXJlc0xlbmd0aENhbGwgPSAod2hlcmUxICE9PSAnRlJPTV9FTkQnICYmIHdoZXJlMSAhPT0gJ0xBU1QnICYmXG4gICAgICB3aGVyZTIgIT09ICdGUk9NX0VORCcgJiYgd2hlcmUyICE9PSAnTEFTVCcpO1xuICBjb25zdCB0ZXh0T3JkZXIgPSByZXF1aXJlc0xlbmd0aENhbGwgPyBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUiA6XG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX05PTkU7XG4gIGNvbnN0IHRleHQgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnU1RSSU5HJywgdGV4dE9yZGVyKSB8fCBcIicnXCI7XG4gIGxldCBjb2RlO1xuICBpZiAod2hlcmUxID09PSAnRklSU1QnICYmIHdoZXJlMiA9PT0gJ0xBU1QnKSB7XG4gICAgY29kZSA9IHRleHQ7XG4gICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX05PTkVdO1xuICB9IGVsc2UgaWYgKHRleHQubWF0Y2goL14nP1xcdysnPyQvKSB8fCByZXF1aXJlc0xlbmd0aENhbGwpIHtcbiAgICAvLyBJZiB0aGUgdGV4dCBpcyBhIHZhcmlhYmxlIG9yIGxpdGVyYWwgb3IgZG9lc24ndCByZXF1aXJlIGEgY2FsbCBmb3JcbiAgICAvLyBsZW5ndGgsIGRvbid0IGdlbmVyYXRlIGEgaGVscGVyIGZ1bmN0aW9uLlxuICAgIGxldCBhdDE7XG4gICAgc3dpdGNoICh3aGVyZTEpIHtcbiAgICAgIGNhc2UgJ0ZST01fU1RBUlQnOlxuICAgICAgICBhdDEgPSBKYXZhU2NyaXB0LmdldEFkanVzdGVkKGJsb2NrLCAnQVQxJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnRlJPTV9FTkQnOlxuICAgICAgICBhdDEgPSBKYXZhU2NyaXB0LmdldEFkanVzdGVkKGJsb2NrLCAnQVQxJywgMSwgZmFsc2UsXG4gICAgICAgICAgICBKYXZhU2NyaXB0Lk9SREVSX1NVQlRSQUNUSU9OKTtcbiAgICAgICAgYXQxID0gdGV4dCArICcubGVuZ3RoIC0gJyArIGF0MTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdGSVJTVCc6XG4gICAgICAgIGF0MSA9ICcwJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBFcnJvcignVW5oYW5kbGVkIG9wdGlvbiAodGV4dF9nZXRTdWJzdHJpbmcpLicpO1xuICAgIH1cbiAgICBsZXQgYXQyO1xuICAgIHN3aXRjaCAod2hlcmUyKSB7XG4gICAgICBjYXNlICdGUk9NX1NUQVJUJzpcbiAgICAgICAgYXQyID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChibG9jaywgJ0FUMicsIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0ZST01fRU5EJzpcbiAgICAgICAgYXQyID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChibG9jaywgJ0FUMicsIDAsIGZhbHNlLFxuICAgICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9TVUJUUkFDVElPTik7XG4gICAgICAgIGF0MiA9IHRleHQgKyAnLmxlbmd0aCAtICcgKyBhdDI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnTEFTVCc6XG4gICAgICAgIGF0MiA9IHRleHQgKyAnLmxlbmd0aCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgRXJyb3IoJ1VuaGFuZGxlZCBvcHRpb24gKHRleHRfZ2V0U3Vic3RyaW5nKS4nKTtcbiAgICB9XG4gICAgY29kZSA9IHRleHQgKyAnLnNsaWNlKCcgKyBhdDEgKyAnLCAnICsgYXQyICsgJyknO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGF0MSA9IEphdmFTY3JpcHQuZ2V0QWRqdXN0ZWQoYmxvY2ssICdBVDEnKTtcbiAgICBjb25zdCBhdDIgPSBKYXZhU2NyaXB0LmdldEFkanVzdGVkKGJsb2NrLCAnQVQyJyk7XG4gICAgY29uc3Qgd2hlcmVQYXNjYWxDYXNlID0geydGSVJTVCc6ICdGaXJzdCcsICdMQVNUJzogJ0xhc3QnLFxuICAgICAgJ0ZST01fU1RBUlQnOiAnRnJvbVN0YXJ0JywgJ0ZST01fRU5EJzogJ0Zyb21FbmQnfTtcbiAgICAvLyBUaGUgdmFsdWUgZm9yICdGUk9NX0VORCcgYW5kJ0ZST01fU1RBUlQnIGRlcGVuZHMgb24gYGF0YCBzb1xuICAgIC8vIHdlIGFkZCBpdCBhcyBhIHBhcmFtZXRlci5cbiAgICBjb25zdCBhdDFQYXJhbSA9XG4gICAgICAgICh3aGVyZTEgPT09ICdGUk9NX0VORCcgfHwgd2hlcmUxID09PSAnRlJPTV9TVEFSVCcpID8gJywgYXQxJyA6ICcnO1xuICAgIGNvbnN0IGF0MlBhcmFtID1cbiAgICAgICAgKHdoZXJlMiA9PT0gJ0ZST01fRU5EJyB8fCB3aGVyZTIgPT09ICdGUk9NX1NUQVJUJykgPyAnLCBhdDInIDogJyc7XG4gICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKFxuICAgICAgICAnc3Vic2VxdWVuY2UnICsgd2hlcmVQYXNjYWxDYXNlW3doZXJlMV0gKyB3aGVyZVBhc2NhbENhc2Vbd2hlcmUyXSwgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffShzZXF1ZW5jZSR7YXQxUGFyYW19JHthdDJQYXJhbX0pIHtcbiAgdmFyIHN0YXJ0ID0gJHtnZXRTdWJzdHJpbmdJbmRleCgnc2VxdWVuY2UnLCB3aGVyZTEsICdhdDEnKX07XG4gIHZhciBlbmQgPSAke2dldFN1YnN0cmluZ0luZGV4KCdzZXF1ZW5jZScsIHdoZXJlMiwgJ2F0MicpfSArIDE7XG4gIHJldHVybiBzZXF1ZW5jZS5zbGljZShzdGFydCwgZW5kKTtcbn1cbmApO1xuICAgIGNvZGUgPSBmdW5jdGlvbk5hbWUgKyAnKCcgKyB0ZXh0ICtcbiAgICAgICAgLy8gVGhlIHZhbHVlIGZvciAnRlJPTV9FTkQnIGFuZCAnRlJPTV9TVEFSVCcgZGVwZW5kcyBvbiBgYXRgIHNvIHdlXG4gICAgICAgIC8vIHBhc3MgaXQuXG4gICAgICAgICgod2hlcmUxID09PSAnRlJPTV9FTkQnIHx8IHdoZXJlMSA9PT0gJ0ZST01fU1RBUlQnKSA/ICcsICcgKyBhdDEgOiAnJykgK1xuICAgICAgICAoKHdoZXJlMiA9PT0gJ0ZST01fRU5EJyB8fCB3aGVyZTIgPT09ICdGUk9NX1NUQVJUJykgPyAnLCAnICsgYXQyIDogJycpICtcbiAgICAgICAgJyknO1xuICB9XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ3RleHRfY2hhbmdlQ2FzZSddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ2hhbmdlIGNhcGl0YWxpemF0aW9uLlxuICBjb25zdCBPUEVSQVRPUlMgPSB7XG4gICAgJ1VQUEVSQ0FTRSc6ICcudG9VcHBlckNhc2UoKScsXG4gICAgJ0xPV0VSQ0FTRSc6ICcudG9Mb3dlckNhc2UoKScsXG4gICAgJ1RJVExFQ0FTRSc6IG51bGwsXG4gIH07XG4gIGNvbnN0IG9wZXJhdG9yID0gT1BFUkFUT1JTW2Jsb2NrLmdldEZpZWxkVmFsdWUoJ0NBU0UnKV07XG4gIGNvbnN0IHRleHRPcmRlciA9IG9wZXJhdG9yID8gSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIgOiBKYXZhU2NyaXB0Lk9SREVSX05PTkU7XG4gIGNvbnN0IHRleHQgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnVEVYVCcsIHRleHRPcmRlcikgfHwgXCInJ1wiO1xuICBsZXQgY29kZTtcbiAgaWYgKG9wZXJhdG9yKSB7XG4gICAgLy8gVXBwZXIgYW5kIGxvd2VyIGNhc2UgYXJlIGZ1bmN0aW9ucyBidWlsdCBpbnRvIEphdmFTY3JpcHQuXG4gICAgY29kZSA9IHRleHQgKyBvcGVyYXRvcjtcbiAgfSBlbHNlIHtcbiAgICAvLyBUaXRsZSBjYXNlIGlzIG5vdCBhIG5hdGl2ZSBKYXZhU2NyaXB0IGZ1bmN0aW9uLiAgRGVmaW5lIG9uZS5cbiAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSBKYXZhU2NyaXB0LnByb3ZpZGVGdW5jdGlvbl8oJ3RleHRUb1RpdGxlQ2FzZScsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30oc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvXFxcXFMrL2csXG4gICAgICBmdW5jdGlvbih0eHQpIHtyZXR1cm4gdHh0WzBdLnRvVXBwZXJDYXNlKCkgKyB0eHQuc3Vic3RyaW5nKDEpLnRvTG93ZXJDYXNlKCk7fSk7XG59XG5gKTtcbiAgICBjb2RlID0gZnVuY3Rpb25OYW1lICsgJygnICsgdGV4dCArICcpJztcbiAgfVxuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG59O1xuXG5KYXZhU2NyaXB0Wyd0ZXh0X3RyaW0nXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIFRyaW0gc3BhY2VzLlxuICBjb25zdCBPUEVSQVRPUlMgPSB7XG4gICAgJ0xFRlQnOiBcIi5yZXBsYWNlKC9eW1xcXFxzXFxcXHhhMF0rLywgJycpXCIsXG4gICAgJ1JJR0hUJzogXCIucmVwbGFjZSgvW1xcXFxzXFxcXHhhMF0rJC8sICcnKVwiLFxuICAgICdCT1RIJzogJy50cmltKCknLFxuICB9O1xuICBjb25zdCBvcGVyYXRvciA9IE9QRVJBVE9SU1tibG9jay5nZXRGaWVsZFZhbHVlKCdNT0RFJyldO1xuICBjb25zdCB0ZXh0ID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1RFWFQnLFxuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIpIHx8IFwiJydcIjtcbiAgcmV0dXJuIFt0ZXh0ICsgb3BlcmF0b3IsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG59O1xuXG5KYXZhU2NyaXB0Wyd0ZXh0X3ByaW50J10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBQcmludCBzdGF0ZW1lbnQuXG4gIGNvbnN0IG1zZyA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdURVhUJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICByZXR1cm4gJ3dpbmRvdy5hbGVydCgnICsgbXNnICsgJyk7XFxuJztcbn07XG5cbkphdmFTY3JpcHRbJ3RleHRfcHJvbXB0X2V4dCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gUHJvbXB0IGZ1bmN0aW9uLlxuICBsZXQgbXNnO1xuICBpZiAoYmxvY2suZ2V0RmllbGQoJ1RFWFQnKSkge1xuICAgIC8vIEludGVybmFsIG1lc3NhZ2UuXG4gICAgbXNnID0gSmF2YVNjcmlwdC5xdW90ZV8oYmxvY2suZ2V0RmllbGRWYWx1ZSgnVEVYVCcpKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBFeHRlcm5hbCBtZXNzYWdlLlxuICAgIG1zZyA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdURVhUJywgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCBcIicnXCI7XG4gIH1cbiAgbGV0IGNvZGUgPSAnd2luZG93LnByb21wdCgnICsgbXNnICsgJyknO1xuICBjb25zdCB0b051bWJlciA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ1RZUEUnKSA9PT0gJ05VTUJFUic7XG4gIGlmICh0b051bWJlcikge1xuICAgIGNvZGUgPSAnTnVtYmVyKCcgKyBjb2RlICsgJyknO1xuICB9XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ3RleHRfcHJvbXB0J10gPSBKYXZhU2NyaXB0Wyd0ZXh0X3Byb21wdF9leHQnXTtcblxuSmF2YVNjcmlwdFsndGV4dF9jb3VudCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgY29uc3QgdGV4dCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdURVhUJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICBjb25zdCBzdWIgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnU1VCJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICBjb25zdCBmdW5jdGlvbk5hbWUgPSBKYXZhU2NyaXB0LnByb3ZpZGVGdW5jdGlvbl8oJ3RleHRDb3VudCcsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30oaGF5c3RhY2ssIG5lZWRsZSkge1xuICBpZiAobmVlZGxlLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBoYXlzdGFjay5sZW5ndGggKyAxO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBoYXlzdGFjay5zcGxpdChuZWVkbGUpLmxlbmd0aCAtIDE7XG4gIH1cbn1cbmApO1xuICBjb25zdCBjb2RlID0gZnVuY3Rpb25OYW1lICsgJygnICsgdGV4dCArICcsICcgKyBzdWIgKyAnKSc7XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ3RleHRfcmVwbGFjZSddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgY29uc3QgdGV4dCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdURVhUJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICBjb25zdCBmcm9tID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0ZST00nLFxuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCBcIicnXCI7XG4gIGNvbnN0IHRvID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1RPJywgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCBcIicnXCI7XG4gIC8vIFRoZSByZWdleCBlc2NhcGluZyBjb2RlIGJlbG93IGlzIHRha2VuIGZyb20gdGhlIGltcGxlbWVudGF0aW9uIG9mXG4gIC8vIGdvb2cuc3RyaW5nLnJlZ0V4cEVzY2FwZS5cbiAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCd0ZXh0UmVwbGFjZScsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30oaGF5c3RhY2ssIG5lZWRsZSwgcmVwbGFjZW1lbnQpIHtcbiAgbmVlZGxlID0gbmVlZGxlLnJlcGxhY2UoLyhbLSgpXFxcXFtcXFxcXXt9Kz8qLiRcXFxcXnwsOiM8IVxcXFxcXFxcXSkvZywgJ1xcXFxcXFxcJDEnKVxuICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxcXHgwOC9nLCAnXFxcXFxcXFx4MDgnKTtcbiAgcmV0dXJuIGhheXN0YWNrLnJlcGxhY2UobmV3IFJlZ0V4cChuZWVkbGUsICdnJyksIHJlcGxhY2VtZW50KTtcbn1cbmApO1xuICBjb25zdCBjb2RlID0gZnVuY3Rpb25OYW1lICsgJygnICsgdGV4dCArICcsICcgKyBmcm9tICsgJywgJyArIHRvICsgJyknO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG59O1xuXG5KYXZhU2NyaXB0Wyd0ZXh0X3JldmVyc2UnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIGNvbnN0IHRleHQgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnVEVYVCcsXG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUikgfHwgXCInJ1wiO1xuICBjb25zdCBjb2RlID0gdGV4dCArIFwiLnNwbGl0KCcnKS5yZXZlcnNlKCkuam9pbignJylcIjtcbiAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEdlbmVyYXRpbmcgSmF2YVNjcmlwdCBmb3IgcHJvY2VkdXJlIGJsb2Nrcy5cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5nb29nLm1vZHVsZSgnQmxvY2tseS5KYXZhU2NyaXB0LnByb2NlZHVyZXMnKTtcblxuY29uc3Qge05hbWVUeXBlfSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5OYW1lcycpO1xuY29uc3Qge2phdmFzY3JpcHRHZW5lcmF0b3I6IEphdmFTY3JpcHR9ID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LkphdmFTY3JpcHQnKTtcblxuXG5KYXZhU2NyaXB0Wydwcm9jZWR1cmVzX2RlZnJldHVybiddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gRGVmaW5lIGEgcHJvY2VkdXJlIHdpdGggYSByZXR1cm4gdmFsdWUuXG4gIGNvbnN0IGZ1bmNOYW1lID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldE5hbWUoXG4gICAgICBibG9jay5nZXRGaWVsZFZhbHVlKCdOQU1FJyksIE5hbWVUeXBlLlBST0NFRFVSRSk7XG4gIGxldCB4Zml4MSA9ICcnO1xuICBpZiAoSmF2YVNjcmlwdC5TVEFURU1FTlRfUFJFRklYKSB7XG4gICAgeGZpeDEgKz0gSmF2YVNjcmlwdC5pbmplY3RJZChKYXZhU2NyaXB0LlNUQVRFTUVOVF9QUkVGSVgsIGJsb2NrKTtcbiAgfVxuICBpZiAoSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYKSB7XG4gICAgeGZpeDEgKz0gSmF2YVNjcmlwdC5pbmplY3RJZChKYXZhU2NyaXB0LlNUQVRFTUVOVF9TVUZGSVgsIGJsb2NrKTtcbiAgfVxuICBpZiAoeGZpeDEpIHtcbiAgICB4Zml4MSA9IEphdmFTY3JpcHQucHJlZml4TGluZXMoeGZpeDEsIEphdmFTY3JpcHQuSU5ERU5UKTtcbiAgfVxuICBsZXQgbG9vcFRyYXAgPSAnJztcbiAgaWYgKEphdmFTY3JpcHQuSU5GSU5JVEVfTE9PUF9UUkFQKSB7XG4gICAgbG9vcFRyYXAgPSBKYXZhU2NyaXB0LnByZWZpeExpbmVzKFxuICAgICAgICBKYXZhU2NyaXB0LmluamVjdElkKEphdmFTY3JpcHQuSU5GSU5JVEVfTE9PUF9UUkFQLCBibG9jayksXG4gICAgICAgIEphdmFTY3JpcHQuSU5ERU5UKTtcbiAgfVxuICBjb25zdCBicmFuY2ggPSBKYXZhU2NyaXB0LnN0YXRlbWVudFRvQ29kZShibG9jaywgJ1NUQUNLJyk7XG4gIGxldCByZXR1cm5WYWx1ZSA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnUkVUVVJOJywgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnJztcbiAgbGV0IHhmaXgyID0gJyc7XG4gIGlmIChicmFuY2ggJiYgcmV0dXJuVmFsdWUpIHtcbiAgICAvLyBBZnRlciBleGVjdXRpbmcgdGhlIGZ1bmN0aW9uIGJvZHksIHJldmlzaXQgdGhpcyBibG9jayBmb3IgdGhlIHJldHVybi5cbiAgICB4Zml4MiA9IHhmaXgxO1xuICB9XG4gIGlmIChyZXR1cm5WYWx1ZSkge1xuICAgIHJldHVyblZhbHVlID0gSmF2YVNjcmlwdC5JTkRFTlQgKyAncmV0dXJuICcgKyByZXR1cm5WYWx1ZSArICc7XFxuJztcbiAgfVxuICBjb25zdCBhcmdzID0gW107XG4gIGNvbnN0IHZhcmlhYmxlcyA9IGJsb2NrLmdldFZhcnMoKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YXJpYWJsZXMubGVuZ3RoOyBpKyspIHtcbiAgICBhcmdzW2ldID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldE5hbWUodmFyaWFibGVzW2ldLCBOYW1lVHlwZS5WQVJJQUJMRSk7XG4gIH1cbiAgbGV0IGNvZGUgPSAnZnVuY3Rpb24gJyArIGZ1bmNOYW1lICsgJygnICsgYXJncy5qb2luKCcsICcpICsgJykge1xcbicgKyB4Zml4MSArXG4gICAgICBsb29wVHJhcCArIGJyYW5jaCArIHhmaXgyICsgcmV0dXJuVmFsdWUgKyAnfSc7XG4gIGNvZGUgPSBKYXZhU2NyaXB0LnNjcnViXyhibG9jaywgY29kZSk7XG4gIC8vIEFkZCAlIHNvIGFzIG5vdCB0byBjb2xsaWRlIHdpdGggaGVscGVyIGZ1bmN0aW9ucyBpbiBkZWZpbml0aW9ucyBsaXN0LlxuICBKYXZhU2NyaXB0LmRlZmluaXRpb25zX1snJScgKyBmdW5jTmFtZV0gPSBjb2RlO1xuICByZXR1cm4gbnVsbDtcbn07XG5cbi8vIERlZmluaW5nIGEgcHJvY2VkdXJlIHdpdGhvdXQgYSByZXR1cm4gdmFsdWUgdXNlcyB0aGUgc2FtZSBnZW5lcmF0b3IgYXNcbi8vIGEgcHJvY2VkdXJlIHdpdGggYSByZXR1cm4gdmFsdWUuXG5KYXZhU2NyaXB0Wydwcm9jZWR1cmVzX2RlZm5vcmV0dXJuJ10gPSBKYXZhU2NyaXB0Wydwcm9jZWR1cmVzX2RlZnJldHVybiddO1xuXG5KYXZhU2NyaXB0Wydwcm9jZWR1cmVzX2NhbGxyZXR1cm4nXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIENhbGwgYSBwcm9jZWR1cmUgd2l0aCBhIHJldHVybiB2YWx1ZS5cbiAgY29uc3QgZnVuY05hbWUgPSBKYXZhU2NyaXB0Lm5hbWVEQl8uZ2V0TmFtZShcbiAgICAgIGJsb2NrLmdldEZpZWxkVmFsdWUoJ05BTUUnKSwgTmFtZVR5cGUuUFJPQ0VEVVJFKTtcbiAgY29uc3QgYXJncyA9IFtdO1xuICBjb25zdCB2YXJpYWJsZXMgPSBibG9jay5nZXRWYXJzKCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyaWFibGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgYXJnc1tpXSA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdBUkcnICsgaSwgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fFxuICAgICAgICAnbnVsbCc7XG4gIH1cbiAgY29uc3QgY29kZSA9IGZ1bmNOYW1lICsgJygnICsgYXJncy5qb2luKCcsICcpICsgJyknO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG59O1xuXG5KYXZhU2NyaXB0Wydwcm9jZWR1cmVzX2NhbGxub3JldHVybiddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ2FsbCBhIHByb2NlZHVyZSB3aXRoIG5vIHJldHVybiB2YWx1ZS5cbiAgLy8gR2VuZXJhdGVkIGNvZGUgaXMgZm9yIGEgZnVuY3Rpb24gY2FsbCBhcyBhIHN0YXRlbWVudCBpcyB0aGUgc2FtZSBhcyBhXG4gIC8vIGZ1bmN0aW9uIGNhbGwgYXMgYSB2YWx1ZSwgd2l0aCB0aGUgYWRkaXRpb24gb2YgbGluZSBlbmRpbmcuXG4gIGNvbnN0IHR1cGxlID0gSmF2YVNjcmlwdFsncHJvY2VkdXJlc19jYWxscmV0dXJuJ10oYmxvY2spO1xuICByZXR1cm4gdHVwbGVbMF0gKyAnO1xcbic7XG59O1xuXG5KYXZhU2NyaXB0Wydwcm9jZWR1cmVzX2lmcmV0dXJuJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBDb25kaXRpb25hbGx5IHJldHVybiB2YWx1ZSBmcm9tIGEgcHJvY2VkdXJlLlxuICBjb25zdCBjb25kaXRpb24gPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0NPTkRJVElPTicsIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHxcbiAgICAgICdmYWxzZSc7XG4gIGxldCBjb2RlID0gJ2lmICgnICsgY29uZGl0aW9uICsgJykge1xcbic7XG4gIGlmIChKYXZhU2NyaXB0LlNUQVRFTUVOVF9TVUZGSVgpIHtcbiAgICAvLyBJbmplY3QgYW55IHN0YXRlbWVudCBzdWZmaXggaGVyZSBzaW5jZSB0aGUgcmVndWxhciBvbmUgYXQgdGhlIGVuZFxuICAgIC8vIHdpbGwgbm90IGdldCBleGVjdXRlZCBpZiB0aGUgcmV0dXJuIGlzIHRyaWdnZXJlZC5cbiAgICBjb2RlICs9IEphdmFTY3JpcHQucHJlZml4TGluZXMoXG4gICAgICAgIEphdmFTY3JpcHQuaW5qZWN0SWQoSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYLCBibG9jayksXG4gICAgICAgIEphdmFTY3JpcHQuSU5ERU5UKTtcbiAgfVxuICBpZiAoYmxvY2suaGFzUmV0dXJuVmFsdWVfKSB7XG4gICAgY29uc3QgdmFsdWUgPVxuICAgICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnVkFMVUUnLCBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8ICdudWxsJztcbiAgICBjb2RlICs9IEphdmFTY3JpcHQuSU5ERU5UICsgJ3JldHVybiAnICsgdmFsdWUgKyAnO1xcbic7XG4gIH0gZWxzZSB7XG4gICAgY29kZSArPSBKYXZhU2NyaXB0LklOREVOVCArICdyZXR1cm47XFxuJztcbiAgfVxuICBjb2RlICs9ICd9XFxuJztcbiAgcmV0dXJuIGNvZGU7XG59O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgR2VuZXJhdGluZyBKYXZhU2NyaXB0IGZvciBtYXRoIGJsb2Nrcy5cbiAqIEBzdXBwcmVzcyB7bWlzc2luZ1JlcXVpcmV9XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC5tYXRoJyk7XG5cbmNvbnN0IHtOYW1lVHlwZX0gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuTmFtZXMnKTtcbmNvbnN0IHtqYXZhc2NyaXB0R2VuZXJhdG9yOiBKYXZhU2NyaXB0fSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0Jyk7XG5cblxuSmF2YVNjcmlwdFsnbWF0aF9udW1iZXInXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIE51bWVyaWMgdmFsdWUuXG4gIGNvbnN0IGNvZGUgPSBOdW1iZXIoYmxvY2suZ2V0RmllbGRWYWx1ZSgnTlVNJykpO1xuICBjb25zdCBvcmRlciA9IGNvZGUgPj0gMCA/IEphdmFTY3JpcHQuT1JERVJfQVRPTUlDIDpcbiAgICAgICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9VTkFSWV9ORUdBVElPTjtcbiAgcmV0dXJuIFtjb2RlLCBvcmRlcl07XG59O1xuXG5KYXZhU2NyaXB0WydtYXRoX2FyaXRobWV0aWMnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIEJhc2ljIGFyaXRobWV0aWMgb3BlcmF0b3JzLCBhbmQgcG93ZXIuXG4gIGNvbnN0IE9QRVJBVE9SUyA9IHtcbiAgICAnQUREJzogWycgKyAnLCBKYXZhU2NyaXB0Lk9SREVSX0FERElUSU9OXSxcbiAgICAnTUlOVVMnOiBbJyAtICcsIEphdmFTY3JpcHQuT1JERVJfU1VCVFJBQ1RJT05dLFxuICAgICdNVUxUSVBMWSc6IFsnICogJywgSmF2YVNjcmlwdC5PUkRFUl9NVUxUSVBMSUNBVElPTl0sXG4gICAgJ0RJVklERSc6IFsnIC8gJywgSmF2YVNjcmlwdC5PUkRFUl9ESVZJU0lPTl0sXG4gICAgJ1BPV0VSJzogW251bGwsIEphdmFTY3JpcHQuT1JERVJfTk9ORV0sICAvLyBIYW5kbGUgcG93ZXIgc2VwYXJhdGVseS5cbiAgfTtcbiAgY29uc3QgdHVwbGUgPSBPUEVSQVRPUlNbYmxvY2suZ2V0RmllbGRWYWx1ZSgnT1AnKV07XG4gIGNvbnN0IG9wZXJhdG9yID0gdHVwbGVbMF07XG4gIGNvbnN0IG9yZGVyID0gdHVwbGVbMV07XG4gIGNvbnN0IGFyZ3VtZW50MCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdBJywgb3JkZXIpIHx8ICcwJztcbiAgY29uc3QgYXJndW1lbnQxID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0InLCBvcmRlcikgfHwgJzAnO1xuICBsZXQgY29kZTtcbiAgLy8gUG93ZXIgaW4gSmF2YVNjcmlwdCByZXF1aXJlcyBhIHNwZWNpYWwgY2FzZSBzaW5jZSBpdCBoYXMgbm8gb3BlcmF0b3IuXG4gIGlmICghb3BlcmF0b3IpIHtcbiAgICBjb2RlID0gJ01hdGgucG93KCcgKyBhcmd1bWVudDAgKyAnLCAnICsgYXJndW1lbnQxICsgJyknO1xuICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbiAgfVxuICBjb2RlID0gYXJndW1lbnQwICsgb3BlcmF0b3IgKyBhcmd1bWVudDE7XG4gIHJldHVybiBbY29kZSwgb3JkZXJdO1xufTtcblxuSmF2YVNjcmlwdFsnbWF0aF9zaW5nbGUnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIE1hdGggb3BlcmF0b3JzIHdpdGggc2luZ2xlIG9wZXJhbmQuXG4gIGNvbnN0IG9wZXJhdG9yID0gYmxvY2suZ2V0RmllbGRWYWx1ZSgnT1AnKTtcbiAgbGV0IGNvZGU7XG4gIGxldCBhcmc7XG4gIGlmIChvcGVyYXRvciA9PT0gJ05FRycpIHtcbiAgICAvLyBOZWdhdGlvbiBpcyBhIHNwZWNpYWwgY2FzZSBnaXZlbiBpdHMgZGlmZmVyZW50IG9wZXJhdG9yIHByZWNlZGVuY2UuXG4gICAgYXJnID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ05VTScsXG4gICAgICAgIEphdmFTY3JpcHQuT1JERVJfVU5BUllfTkVHQVRJT04pIHx8ICcwJztcbiAgICBpZiAoYXJnWzBdID09PSAnLScpIHtcbiAgICAgIC8vIC0tMyBpcyBub3QgbGVnYWwgaW4gSlMuXG4gICAgICBhcmcgPSAnICcgKyBhcmc7XG4gICAgfVxuICAgIGNvZGUgPSAnLScgKyBhcmc7XG4gICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX1VOQVJZX05FR0FUSU9OXTtcbiAgfVxuICBpZiAob3BlcmF0b3IgPT09ICdTSU4nIHx8IG9wZXJhdG9yID09PSAnQ09TJyB8fCBvcGVyYXRvciA9PT0gJ1RBTicpIHtcbiAgICBhcmcgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTlVNJyxcbiAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9ESVZJU0lPTikgfHwgJzAnO1xuICB9IGVsc2Uge1xuICAgIGFyZyA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdOVU0nLFxuICAgICAgICBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8ICcwJztcbiAgfVxuICAvLyBGaXJzdCwgaGFuZGxlIGNhc2VzIHdoaWNoIGdlbmVyYXRlIHZhbHVlcyB0aGF0IGRvbid0IG5lZWQgcGFyZW50aGVzZXNcbiAgLy8gd3JhcHBpbmcgdGhlIGNvZGUuXG4gIHN3aXRjaCAob3BlcmF0b3IpIHtcbiAgICBjYXNlICdBQlMnOlxuICAgICAgY29kZSA9ICdNYXRoLmFicygnICsgYXJnICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnUk9PVCc6XG4gICAgICBjb2RlID0gJ01hdGguc3FydCgnICsgYXJnICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnTE4nOlxuICAgICAgY29kZSA9ICdNYXRoLmxvZygnICsgYXJnICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnRVhQJzpcbiAgICAgIGNvZGUgPSAnTWF0aC5leHAoJyArIGFyZyArICcpJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ1BPVzEwJzpcbiAgICAgIGNvZGUgPSAnTWF0aC5wb3coMTAsJyArIGFyZyArICcpJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ1JPVU5EJzpcbiAgICAgIGNvZGUgPSAnTWF0aC5yb3VuZCgnICsgYXJnICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnUk9VTkRVUCc6XG4gICAgICBjb2RlID0gJ01hdGguY2VpbCgnICsgYXJnICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnUk9VTkRET1dOJzpcbiAgICAgIGNvZGUgPSAnTWF0aC5mbG9vcignICsgYXJnICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnU0lOJzpcbiAgICAgIGNvZGUgPSAnTWF0aC5zaW4oJyArIGFyZyArICcgLyAxODAgKiBNYXRoLlBJKSc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdDT1MnOlxuICAgICAgY29kZSA9ICdNYXRoLmNvcygnICsgYXJnICsgJyAvIDE4MCAqIE1hdGguUEkpJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ1RBTic6XG4gICAgICBjb2RlID0gJ01hdGgudGFuKCcgKyBhcmcgKyAnIC8gMTgwICogTWF0aC5QSSknO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgaWYgKGNvZGUpIHtcbiAgICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG4gIH1cbiAgLy8gU2Vjb25kLCBoYW5kbGUgY2FzZXMgd2hpY2ggZ2VuZXJhdGUgdmFsdWVzIHRoYXQgbWF5IG5lZWQgcGFyZW50aGVzZXNcbiAgLy8gd3JhcHBpbmcgdGhlIGNvZGUuXG4gIHN3aXRjaCAob3BlcmF0b3IpIHtcbiAgICBjYXNlICdMT0cxMCc6XG4gICAgICBjb2RlID0gJ01hdGgubG9nKCcgKyBhcmcgKyAnKSAvIE1hdGgubG9nKDEwKSc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdBU0lOJzpcbiAgICAgIGNvZGUgPSAnTWF0aC5hc2luKCcgKyBhcmcgKyAnKSAvIE1hdGguUEkgKiAxODAnO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnQUNPUyc6XG4gICAgICBjb2RlID0gJ01hdGguYWNvcygnICsgYXJnICsgJykgLyBNYXRoLlBJICogMTgwJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ0FUQU4nOlxuICAgICAgY29kZSA9ICdNYXRoLmF0YW4oJyArIGFyZyArICcpIC8gTWF0aC5QSSAqIDE4MCc7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgRXJyb3IoJ1Vua25vd24gbWF0aCBvcGVyYXRvcjogJyArIG9wZXJhdG9yKTtcbiAgfVxuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRElWSVNJT05dO1xufTtcblxuSmF2YVNjcmlwdFsnbWF0aF9jb25zdGFudCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ29uc3RhbnRzOiBQSSwgRSwgdGhlIEdvbGRlbiBSYXRpbywgc3FydCgyKSwgMS9zcXJ0KDIpLCBJTkZJTklUWS5cbiAgY29uc3QgQ09OU1RBTlRTID0ge1xuICAgICdQSSc6IFsnTWF0aC5QSScsIEphdmFTY3JpcHQuT1JERVJfTUVNQkVSXSxcbiAgICAnRSc6IFsnTWF0aC5FJywgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVJdLFxuICAgICdHT0xERU5fUkFUSU8nOiBbJygxICsgTWF0aC5zcXJ0KDUpKSAvIDInLCBKYXZhU2NyaXB0Lk9SREVSX0RJVklTSU9OXSxcbiAgICAnU1FSVDInOiBbJ01hdGguU1FSVDInLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUl0sXG4gICAgJ1NRUlQxXzInOiBbJ01hdGguU1FSVDFfMicsIEphdmFTY3JpcHQuT1JERVJfTUVNQkVSXSxcbiAgICAnSU5GSU5JVFknOiBbJ0luZmluaXR5JywgSmF2YVNjcmlwdC5PUkRFUl9BVE9NSUNdLFxuICB9O1xuICByZXR1cm4gQ09OU1RBTlRTW2Jsb2NrLmdldEZpZWxkVmFsdWUoJ0NPTlNUQU5UJyldO1xufTtcblxuSmF2YVNjcmlwdFsnbWF0aF9udW1iZXJfcHJvcGVydHknXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIENoZWNrIGlmIGEgbnVtYmVyIGlzIGV2ZW4sIG9kZCwgcHJpbWUsIHdob2xlLCBwb3NpdGl2ZSwgb3IgbmVnYXRpdmVcbiAgLy8gb3IgaWYgaXQgaXMgZGl2aXNpYmxlIGJ5IGNlcnRhaW4gbnVtYmVyLiBSZXR1cm5zIHRydWUgb3IgZmFsc2UuXG4gIGNvbnN0IFBST1BFUlRJRVMgPSB7XG4gICAgJ0VWRU4nOiBbJyAlIDIgPT09IDAnLCBKYXZhU2NyaXB0Lk9SREVSX01PRFVMVVMsIEphdmFTY3JpcHQuT1JERVJfRVFVQUxJVFldLFxuICAgICdPREQnOiBbJyAlIDIgPT09IDEnLCBKYXZhU2NyaXB0Lk9SREVSX01PRFVMVVMsIEphdmFTY3JpcHQuT1JERVJfRVFVQUxJVFldLFxuICAgICdXSE9MRSc6IFsnICUgMSA9PT0gMCcsIEphdmFTY3JpcHQuT1JERVJfTU9EVUxVUyxcbiAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9FUVVBTElUWV0sXG4gICAgJ1BPU0lUSVZFJzogWycgPiAwJywgSmF2YVNjcmlwdC5PUkRFUl9SRUxBVElPTkFMLFxuICAgICAgICBKYXZhU2NyaXB0Lk9SREVSX1JFTEFUSU9OQUxdLFxuICAgICdORUdBVElWRSc6IFsnIDwgMCcsIEphdmFTY3JpcHQuT1JERVJfUkVMQVRJT05BTCxcbiAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9SRUxBVElPTkFMXSxcbiAgICAnRElWSVNJQkxFX0JZJzogW251bGwsIEphdmFTY3JpcHQuT1JERVJfTU9EVUxVUywgSmF2YVNjcmlwdC5PUkRFUl9FUVVBTElUWV0sXG4gICAgJ1BSSU1FJzogW251bGwsIEphdmFTY3JpcHQuT1JERVJfTk9ORSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXSxcbiAgfTtcbiAgY29uc3QgZHJvcGRvd25Qcm9wZXJ0eSA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ1BST1BFUlRZJyk7XG4gIGNvbnN0IFtzdWZmaXgsIGlucHV0T3JkZXIsIG91dHB1dE9yZGVyXSA9IFBST1BFUlRJRVNbZHJvcGRvd25Qcm9wZXJ0eV07XG4gIGNvbnN0IG51bWJlclRvQ2hlY2sgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTlVNQkVSX1RPX0NIRUNLJyxcbiAgICAgIGlucHV0T3JkZXIpIHx8ICcwJztcbiAgbGV0IGNvZGU7XG4gIGlmIChkcm9wZG93blByb3BlcnR5ID09PSAnUFJJTUUnKSB7XG4gICAgLy8gUHJpbWUgaXMgYSBzcGVjaWFsIGNhc2UgYXMgaXQgaXMgbm90IGEgb25lLWxpbmVyIHRlc3QuXG4gICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdtYXRoSXNQcmltZScsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30obikge1xuICAvLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QcmltYWxpdHlfdGVzdCNOYWl2ZV9tZXRob2RzXG4gIGlmIChuID09IDIgfHwgbiA9PSAzKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgLy8gRmFsc2UgaWYgbiBpcyBOYU4sIG5lZ2F0aXZlLCBpcyAxLCBvciBub3Qgd2hvbGUuXG4gIC8vIEFuZCBmYWxzZSBpZiBuIGlzIGRpdmlzaWJsZSBieSAyIG9yIDMuXG4gIGlmIChpc05hTihuKSB8fCBuIDw9IDEgfHwgbiAlIDEgIT09IDAgfHwgbiAlIDIgPT09IDAgfHwgbiAlIDMgPT09IDApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8gQ2hlY2sgYWxsIHRoZSBudW1iZXJzIG9mIGZvcm0gNmsgKy8tIDEsIHVwIHRvIHNxcnQobikuXG4gIGZvciAodmFyIHggPSA2OyB4IDw9IE1hdGguc3FydChuKSArIDE7IHggKz0gNikge1xuICAgIGlmIChuICUgKHggLSAxKSA9PT0gMCB8fCBuICUgKHggKyAxKSA9PT0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cbmApO1xuICAgIGNvZGUgPSBmdW5jdGlvbk5hbWUgKyAnKCcgKyBudW1iZXJUb0NoZWNrICsgJyknO1xuICB9IGVsc2UgaWYgKGRyb3Bkb3duUHJvcGVydHkgPT09ICdESVZJU0lCTEVfQlknKSB7XG4gICAgY29uc3QgZGl2aXNvciA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdESVZJU09SJyxcbiAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9NT0RVTFVTKSB8fCAnMCc7XG4gICAgY29kZSA9IG51bWJlclRvQ2hlY2sgKyAnICUgJyArIGRpdmlzb3IgKyAnID09PSAwJztcbiAgfSBlbHNlIHtcbiAgICBjb2RlID0gbnVtYmVyVG9DaGVjayArIHN1ZmZpeDtcbiAgfVxuICByZXR1cm4gW2NvZGUsIG91dHB1dE9yZGVyXTtcbn07XG5cbkphdmFTY3JpcHRbJ21hdGhfY2hhbmdlJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBBZGQgdG8gYSB2YXJpYWJsZSBpbiBwbGFjZS5cbiAgY29uc3QgYXJndW1lbnQwID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0RFTFRBJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfQURESVRJT04pIHx8ICcwJztcbiAgY29uc3QgdmFyTmFtZSA9IEphdmFTY3JpcHQubmFtZURCXy5nZXROYW1lKFxuICAgICAgYmxvY2suZ2V0RmllbGRWYWx1ZSgnVkFSJyksIE5hbWVUeXBlLlZBUklBQkxFKTtcbiAgcmV0dXJuIHZhck5hbWUgKyAnID0gKHR5cGVvZiAnICsgdmFyTmFtZSArICcgPT09IFxcJ251bWJlclxcJyA/ICcgKyB2YXJOYW1lICtcbiAgICAgICcgOiAwKSArICcgKyBhcmd1bWVudDAgKyAnO1xcbic7XG59O1xuXG4vLyBSb3VuZGluZyBmdW5jdGlvbnMgaGF2ZSBhIHNpbmdsZSBvcGVyYW5kLlxuSmF2YVNjcmlwdFsnbWF0aF9yb3VuZCddID0gSmF2YVNjcmlwdFsnbWF0aF9zaW5nbGUnXTtcbi8vIFRyaWdvbm9tZXRyeSBmdW5jdGlvbnMgaGF2ZSBhIHNpbmdsZSBvcGVyYW5kLlxuSmF2YVNjcmlwdFsnbWF0aF90cmlnJ10gPSBKYXZhU2NyaXB0WydtYXRoX3NpbmdsZSddO1xuXG5KYXZhU2NyaXB0WydtYXRoX29uX2xpc3QnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIE1hdGggZnVuY3Rpb25zIGZvciBsaXN0cy5cbiAgY29uc3QgZnVuYyA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ09QJyk7XG4gIGxldCBsaXN0O1xuICBsZXQgY29kZTtcbiAgc3dpdGNoIChmdW5jKSB7XG4gICAgY2FzZSAnU1VNJzpcbiAgICAgIGxpc3QgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsXG4gICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIpIHx8ICdbXSc7XG4gICAgICBjb2RlID0gbGlzdCArICcucmVkdWNlKGZ1bmN0aW9uKHgsIHkpIHtyZXR1cm4geCArIHk7fSwgMCknO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnTUlOJzpcbiAgICAgIGxpc3QgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsXG4gICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnW10nO1xuICAgICAgY29kZSA9ICdNYXRoLm1pbi5hcHBseShudWxsLCAnICsgbGlzdCArICcpJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ01BWCc6XG4gICAgICBsaXN0ID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0xJU1QnLFxuICAgICAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgJ1tdJztcbiAgICAgIGNvZGUgPSAnTWF0aC5tYXguYXBwbHkobnVsbCwgJyArIGxpc3QgKyAnKSc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdBVkVSQUdFJzoge1xuICAgICAgLy8gbWF0aE1lYW4oW251bGwsbnVsbCwxLDNdKSA9PT0gMi4wLlxuICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdtYXRoTWVhbicsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30obXlMaXN0KSB7XG4gIHJldHVybiBteUxpc3QucmVkdWNlKGZ1bmN0aW9uKHgsIHkpIHtyZXR1cm4geCArIHk7fSwgMCkgLyBteUxpc3QubGVuZ3RoO1xufVxuYCk7XG4gICAgICBsaXN0ID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0xJU1QnLFxuICAgICAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgJ1tdJztcbiAgICAgIGNvZGUgPSBmdW5jdGlvbk5hbWUgKyAnKCcgKyBsaXN0ICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgJ01FRElBTic6IHtcbiAgICAgIC8vIG1hdGhNZWRpYW4oW251bGwsbnVsbCwxLDNdKSA9PT0gMi4wLlxuICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdtYXRoTWVkaWFuJywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffShteUxpc3QpIHtcbiAgdmFyIGxvY2FsTGlzdCA9IG15TGlzdC5maWx0ZXIoZnVuY3Rpb24gKHgpIHtyZXR1cm4gdHlwZW9mIHggPT09ICdudW1iZXInO30pO1xuICBpZiAoIWxvY2FsTGlzdC5sZW5ndGgpIHJldHVybiBudWxsO1xuICBsb2NhbExpc3Quc29ydChmdW5jdGlvbihhLCBiKSB7cmV0dXJuIGIgLSBhO30pO1xuICBpZiAobG9jYWxMaXN0Lmxlbmd0aCAlIDIgPT09IDApIHtcbiAgICByZXR1cm4gKGxvY2FsTGlzdFtsb2NhbExpc3QubGVuZ3RoIC8gMiAtIDFdICsgbG9jYWxMaXN0W2xvY2FsTGlzdC5sZW5ndGggLyAyXSkgLyAyO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBsb2NhbExpc3RbKGxvY2FsTGlzdC5sZW5ndGggLSAxKSAvIDJdO1xuICB9XG59XG5gKTtcbiAgICAgIGxpc3QgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsXG4gICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnW10nO1xuICAgICAgY29kZSA9IGZ1bmN0aW9uTmFtZSArICcoJyArIGxpc3QgKyAnKSc7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSAnTU9ERSc6IHtcbiAgICAgIC8vIEFzIGEgbGlzdCBvZiBudW1iZXJzIGNhbiBjb250YWluIG1vcmUgdGhhbiBvbmUgbW9kZSxcbiAgICAgIC8vIHRoZSByZXR1cm5lZCByZXN1bHQgaXMgcHJvdmlkZWQgYXMgYW4gYXJyYXkuXG4gICAgICAvLyBNb2RlIG9mIFszLCAneCcsICd4JywgMSwgMSwgMiwgJzMnXSAtPiBbJ3gnLCAxXS5cbiAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IEphdmFTY3JpcHQucHJvdmlkZUZ1bmN0aW9uXygnbWF0aE1vZGVzJywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffSh2YWx1ZXMpIHtcbiAgdmFyIG1vZGVzID0gW107XG4gIHZhciBjb3VudHMgPSBbXTtcbiAgdmFyIG1heENvdW50ID0gMDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgdmFsdWUgPSB2YWx1ZXNbaV07XG4gICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgdmFyIHRoaXNDb3VudDtcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvdW50cy5sZW5ndGg7IGorKykge1xuICAgICAgaWYgKGNvdW50c1tqXVswXSA9PT0gdmFsdWUpIHtcbiAgICAgICAgdGhpc0NvdW50ID0gKytjb3VudHNbal1bMV07XG4gICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghZm91bmQpIHtcbiAgICAgIGNvdW50cy5wdXNoKFt2YWx1ZSwgMV0pO1xuICAgICAgdGhpc0NvdW50ID0gMTtcbiAgICB9XG4gICAgbWF4Q291bnQgPSBNYXRoLm1heCh0aGlzQ291bnQsIG1heENvdW50KTtcbiAgfVxuICBmb3IgKHZhciBqID0gMDsgaiA8IGNvdW50cy5sZW5ndGg7IGorKykge1xuICAgIGlmIChjb3VudHNbal1bMV0gPT09IG1heENvdW50KSB7XG4gICAgICAgIG1vZGVzLnB1c2goY291bnRzW2pdWzBdKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1vZGVzO1xufVxuYCk7XG4gICAgICBsaXN0ID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0xJU1QnLFxuICAgICAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgJ1tdJztcbiAgICAgIGNvZGUgPSBmdW5jdGlvbk5hbWUgKyAnKCcgKyBsaXN0ICsgJyknO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgJ1NURF9ERVYnOiB7XG4gICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSBKYXZhU2NyaXB0LnByb3ZpZGVGdW5jdGlvbl8oJ21hdGhTdGFuZGFyZERldmlhdGlvbicsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30obnVtYmVycykge1xuICB2YXIgbiA9IG51bWJlcnMubGVuZ3RoO1xuICBpZiAoIW4pIHJldHVybiBudWxsO1xuICB2YXIgbWVhbiA9IG51bWJlcnMucmVkdWNlKGZ1bmN0aW9uKHgsIHkpIHtyZXR1cm4geCArIHk7fSkgLyBuO1xuICB2YXIgdmFyaWFuY2UgPSAwO1xuICBmb3IgKHZhciBqID0gMDsgaiA8IG47IGorKykge1xuICAgIHZhcmlhbmNlICs9IE1hdGgucG93KG51bWJlcnNbal0gLSBtZWFuLCAyKTtcbiAgfVxuICB2YXJpYW5jZSA9IHZhcmlhbmNlIC8gbjtcbiAgcmV0dXJuIE1hdGguc3FydCh2YXJpYW5jZSk7XG59XG5gKTtcbiAgICAgIGxpc3QgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsXG4gICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnW10nO1xuICAgICAgY29kZSA9IGZ1bmN0aW9uTmFtZSArICcoJyArIGxpc3QgKyAnKSc7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSAnUkFORE9NJzoge1xuICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdtYXRoUmFuZG9tTGlzdCcsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30obGlzdCkge1xuICB2YXIgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGxpc3QubGVuZ3RoKTtcbiAgcmV0dXJuIGxpc3RbeF07XG59XG5gKTtcbiAgICAgIGxpc3QgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsXG4gICAgICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnW10nO1xuICAgICAgY29kZSA9IGZ1bmN0aW9uTmFtZSArICcoJyArIGxpc3QgKyAnKSc7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IEVycm9yKCdVbmtub3duIG9wZXJhdG9yOiAnICsgZnVuYyk7XG4gIH1cbiAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcblxuSmF2YVNjcmlwdFsnbWF0aF9tb2R1bG8nXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIFJlbWFpbmRlciBjb21wdXRhdGlvbi5cbiAgY29uc3QgYXJndW1lbnQwID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0RJVklERU5EJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTU9EVUxVUykgfHwgJzAnO1xuICBjb25zdCBhcmd1bWVudDEgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnRElWSVNPUicsXG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX01PRFVMVVMpIHx8ICcwJztcbiAgY29uc3QgY29kZSA9IGFyZ3VtZW50MCArICcgJSAnICsgYXJndW1lbnQxO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfTU9EVUxVU107XG59O1xuXG5KYXZhU2NyaXB0WydtYXRoX2NvbnN0cmFpbiddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ29uc3RyYWluIGEgbnVtYmVyIGJldHdlZW4gdHdvIGxpbWl0cy5cbiAgY29uc3QgYXJndW1lbnQwID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1ZBTFVFJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgJzAnO1xuICBjb25zdCBhcmd1bWVudDEgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTE9XJyxcbiAgICAgIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgJzAnO1xuICBjb25zdCBhcmd1bWVudDIgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnSElHSCcsXG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8ICdJbmZpbml0eSc7XG4gIGNvbnN0IGNvZGUgPSAnTWF0aC5taW4oTWF0aC5tYXgoJyArIGFyZ3VtZW50MCArICcsICcgKyBhcmd1bWVudDEgKyAnKSwgJyArXG4gICAgICBhcmd1bWVudDIgKyAnKSc7XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ21hdGhfcmFuZG9tX2ludCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gUmFuZG9tIGludGVnZXIgYmV0d2VlbiBbWF0gYW5kIFtZXS5cbiAgY29uc3QgYXJndW1lbnQwID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0ZST00nLFxuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnMCc7XG4gIGNvbnN0IGFyZ3VtZW50MSA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdUTycsXG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8ICcwJztcbiAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdtYXRoUmFuZG9tSW50JywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffShhLCBiKSB7XG4gIGlmIChhID4gYikge1xuICAgIC8vIFN3YXAgYSBhbmQgYiB0byBlbnN1cmUgYSBpcyBzbWFsbGVyLlxuICAgIHZhciBjID0gYTtcbiAgICBhID0gYjtcbiAgICBiID0gYztcbiAgfVxuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGIgLSBhICsgMSkgKyBhKTtcbn1cbmApO1xuICBjb25zdCBjb2RlID0gZnVuY3Rpb25OYW1lICsgJygnICsgYXJndW1lbnQwICsgJywgJyArIGFyZ3VtZW50MSArICcpJztcbiAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcblxuSmF2YVNjcmlwdFsnbWF0aF9yYW5kb21fZmxvYXQnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIFJhbmRvbSBmcmFjdGlvbiBiZXR3ZWVuIDAgYW5kIDEuXG4gIHJldHVybiBbJ01hdGgucmFuZG9tKCknLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcblxuSmF2YVNjcmlwdFsnbWF0aF9hdGFuMiddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQXJjdGFuZ2VudCBvZiBwb2ludCAoWCwgWSkgaW4gZGVncmVlcyBmcm9tIC0xODAgdG8gMTgwLlxuICBjb25zdCBhcmd1bWVudDAgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnWCcsXG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8ICcwJztcbiAgY29uc3QgYXJndW1lbnQxID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1knLFxuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnMCc7XG4gIHJldHVybiBbJ01hdGguYXRhbjIoJyArIGFyZ3VtZW50MSArICcsICcgKyBhcmd1bWVudDAgKyAnKSAvIE1hdGguUEkgKiAxODAnLFxuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9ESVZJU0lPTl07XG59O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgR2VuZXJhdGluZyBKYXZhU2NyaXB0IGZvciBsb29wIGJsb2Nrcy5cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5nb29nLm1vZHVsZSgnQmxvY2tseS5KYXZhU2NyaXB0Lmxvb3BzJyk7XG5cbmNvbnN0IHN0cmluZ1V0aWxzID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LnV0aWxzLnN0cmluZycpO1xuY29uc3Qge05hbWVUeXBlfSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5OYW1lcycpO1xuY29uc3Qge2phdmFzY3JpcHRHZW5lcmF0b3I6IEphdmFTY3JpcHR9ID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LkphdmFTY3JpcHQnKTtcblxuXG5KYXZhU2NyaXB0Wydjb250cm9sc19yZXBlYXRfZXh0J10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBSZXBlYXQgbiB0aW1lcy5cbiAgbGV0IHJlcGVhdHM7XG4gIGlmIChibG9jay5nZXRGaWVsZCgnVElNRVMnKSkge1xuICAgIC8vIEludGVybmFsIG51bWJlci5cbiAgICByZXBlYXRzID0gU3RyaW5nKE51bWJlcihibG9jay5nZXRGaWVsZFZhbHVlKCdUSU1FUycpKSk7XG4gIH0gZWxzZSB7XG4gICAgLy8gRXh0ZXJuYWwgbnVtYmVyLlxuICAgIHJlcGVhdHMgPVxuICAgICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnVElNRVMnLCBKYXZhU2NyaXB0Lk9SREVSX0FTU0lHTk1FTlQpIHx8XG4gICAgICAgICcwJztcbiAgfVxuICBsZXQgYnJhbmNoID0gSmF2YVNjcmlwdC5zdGF0ZW1lbnRUb0NvZGUoYmxvY2ssICdETycpO1xuICBicmFuY2ggPSBKYXZhU2NyaXB0LmFkZExvb3BUcmFwKGJyYW5jaCwgYmxvY2spO1xuICBsZXQgY29kZSA9ICcnO1xuICBjb25zdCBsb29wVmFyID1cbiAgICAgIEphdmFTY3JpcHQubmFtZURCXy5nZXREaXN0aW5jdE5hbWUoJ2NvdW50JywgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICBsZXQgZW5kVmFyID0gcmVwZWF0cztcbiAgaWYgKCFyZXBlYXRzLm1hdGNoKC9eXFx3KyQvKSAmJiAhc3RyaW5nVXRpbHMuaXNOdW1iZXIocmVwZWF0cykpIHtcbiAgICBlbmRWYXIgPVxuICAgICAgICBKYXZhU2NyaXB0Lm5hbWVEQl8uZ2V0RGlzdGluY3ROYW1lKCdyZXBlYXRfZW5kJywgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICAgIGNvZGUgKz0gJ3ZhciAnICsgZW5kVmFyICsgJyA9ICcgKyByZXBlYXRzICsgJztcXG4nO1xuICB9XG4gIGNvZGUgKz0gJ2ZvciAodmFyICcgKyBsb29wVmFyICsgJyA9IDA7ICcgKyBsb29wVmFyICsgJyA8ICcgKyBlbmRWYXIgKyAnOyAnICtcbiAgICAgIGxvb3BWYXIgKyAnKyspIHtcXG4nICsgYnJhbmNoICsgJ31cXG4nO1xuICByZXR1cm4gY29kZTtcbn07XG5cbkphdmFTY3JpcHRbJ2NvbnRyb2xzX3JlcGVhdCddID0gSmF2YVNjcmlwdFsnY29udHJvbHNfcmVwZWF0X2V4dCddO1xuXG5KYXZhU2NyaXB0Wydjb250cm9sc193aGlsZVVudGlsJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBEbyB3aGlsZS91bnRpbCBsb29wLlxuICBjb25zdCB1bnRpbCA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ01PREUnKSA9PT0gJ1VOVElMJztcbiAgbGV0IGFyZ3VtZW50MCA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKFxuICAgICAgICAgIGJsb2NrLCAnQk9PTCcsXG4gICAgICAgICAgdW50aWwgPyBKYXZhU2NyaXB0Lk9SREVSX0xPR0lDQUxfTk9UIDogSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fFxuICAgICAgJ2ZhbHNlJztcbiAgbGV0IGJyYW5jaCA9IEphdmFTY3JpcHQuc3RhdGVtZW50VG9Db2RlKGJsb2NrLCAnRE8nKTtcbiAgYnJhbmNoID0gSmF2YVNjcmlwdC5hZGRMb29wVHJhcChicmFuY2gsIGJsb2NrKTtcbiAgaWYgKHVudGlsKSB7XG4gICAgYXJndW1lbnQwID0gJyEnICsgYXJndW1lbnQwO1xuICB9XG4gIHJldHVybiAnd2hpbGUgKCcgKyBhcmd1bWVudDAgKyAnKSB7XFxuJyArIGJyYW5jaCArICd9XFxuJztcbn07XG5cbkphdmFTY3JpcHRbJ2NvbnRyb2xzX2ZvciddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gRm9yIGxvb3AuXG4gIGNvbnN0IHZhcmlhYmxlMCA9XG4gICAgICBKYXZhU2NyaXB0Lm5hbWVEQl8uZ2V0TmFtZShibG9jay5nZXRGaWVsZFZhbHVlKCdWQVInKSwgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICBjb25zdCBhcmd1bWVudDAgPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0ZST00nLCBKYXZhU2NyaXB0Lk9SREVSX0FTU0lHTk1FTlQpIHx8ICcwJztcbiAgY29uc3QgYXJndW1lbnQxID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdUTycsIEphdmFTY3JpcHQuT1JERVJfQVNTSUdOTUVOVCkgfHwgJzAnO1xuICBjb25zdCBpbmNyZW1lbnQgPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0JZJywgSmF2YVNjcmlwdC5PUkRFUl9BU1NJR05NRU5UKSB8fCAnMSc7XG4gIGxldCBicmFuY2ggPSBKYXZhU2NyaXB0LnN0YXRlbWVudFRvQ29kZShibG9jaywgJ0RPJyk7XG4gIGJyYW5jaCA9IEphdmFTY3JpcHQuYWRkTG9vcFRyYXAoYnJhbmNoLCBibG9jayk7XG4gIGxldCBjb2RlO1xuICBpZiAoc3RyaW5nVXRpbHMuaXNOdW1iZXIoYXJndW1lbnQwKSAmJiBzdHJpbmdVdGlscy5pc051bWJlcihhcmd1bWVudDEpICYmXG4gICAgICBzdHJpbmdVdGlscy5pc051bWJlcihpbmNyZW1lbnQpKSB7XG4gICAgLy8gQWxsIGFyZ3VtZW50cyBhcmUgc2ltcGxlIG51bWJlcnMuXG4gICAgY29uc3QgdXAgPSBOdW1iZXIoYXJndW1lbnQwKSA8PSBOdW1iZXIoYXJndW1lbnQxKTtcbiAgICBjb2RlID0gJ2ZvciAoJyArIHZhcmlhYmxlMCArICcgPSAnICsgYXJndW1lbnQwICsgJzsgJyArIHZhcmlhYmxlMCArXG4gICAgICAgICh1cCA/ICcgPD0gJyA6ICcgPj0gJykgKyBhcmd1bWVudDEgKyAnOyAnICsgdmFyaWFibGUwO1xuICAgIGNvbnN0IHN0ZXAgPSBNYXRoLmFicyhOdW1iZXIoaW5jcmVtZW50KSk7XG4gICAgaWYgKHN0ZXAgPT09IDEpIHtcbiAgICAgIGNvZGUgKz0gdXAgPyAnKysnIDogJy0tJztcbiAgICB9IGVsc2Uge1xuICAgICAgY29kZSArPSAodXAgPyAnICs9ICcgOiAnIC09ICcpICsgc3RlcDtcbiAgICB9XG4gICAgY29kZSArPSAnKSB7XFxuJyArIGJyYW5jaCArICd9XFxuJztcbiAgfSBlbHNlIHtcbiAgICBjb2RlID0gJyc7XG4gICAgLy8gQ2FjaGUgbm9uLXRyaXZpYWwgdmFsdWVzIHRvIHZhcmlhYmxlcyB0byBwcmV2ZW50IHJlcGVhdGVkIGxvb2stdXBzLlxuICAgIGxldCBzdGFydFZhciA9IGFyZ3VtZW50MDtcbiAgICBpZiAoIWFyZ3VtZW50MC5tYXRjaCgvXlxcdyskLykgJiYgIXN0cmluZ1V0aWxzLmlzTnVtYmVyKGFyZ3VtZW50MCkpIHtcbiAgICAgIHN0YXJ0VmFyID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldERpc3RpbmN0TmFtZShcbiAgICAgICAgICB2YXJpYWJsZTAgKyAnX3N0YXJ0JywgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICAgICAgY29kZSArPSAndmFyICcgKyBzdGFydFZhciArICcgPSAnICsgYXJndW1lbnQwICsgJztcXG4nO1xuICAgIH1cbiAgICBsZXQgZW5kVmFyID0gYXJndW1lbnQxO1xuICAgIGlmICghYXJndW1lbnQxLm1hdGNoKC9eXFx3KyQvKSAmJiAhc3RyaW5nVXRpbHMuaXNOdW1iZXIoYXJndW1lbnQxKSkge1xuICAgICAgZW5kVmFyID0gSmF2YVNjcmlwdC5uYW1lREJfLmdldERpc3RpbmN0TmFtZShcbiAgICAgICAgICB2YXJpYWJsZTAgKyAnX2VuZCcsIE5hbWVUeXBlLlZBUklBQkxFKTtcbiAgICAgIGNvZGUgKz0gJ3ZhciAnICsgZW5kVmFyICsgJyA9ICcgKyBhcmd1bWVudDEgKyAnO1xcbic7XG4gICAgfVxuICAgIC8vIERldGVybWluZSBsb29wIGRpcmVjdGlvbiBhdCBzdGFydCwgaW4gY2FzZSBvbmUgb2YgdGhlIGJvdW5kc1xuICAgIC8vIGNoYW5nZXMgZHVyaW5nIGxvb3AgZXhlY3V0aW9uLlxuICAgIGNvbnN0IGluY1ZhciA9IEphdmFTY3JpcHQubmFtZURCXy5nZXREaXN0aW5jdE5hbWUoXG4gICAgICAgIHZhcmlhYmxlMCArICdfaW5jJywgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICAgIGNvZGUgKz0gJ3ZhciAnICsgaW5jVmFyICsgJyA9ICc7XG4gICAgaWYgKHN0cmluZ1V0aWxzLmlzTnVtYmVyKGluY3JlbWVudCkpIHtcbiAgICAgIGNvZGUgKz0gTWF0aC5hYnMoaW5jcmVtZW50KSArICc7XFxuJztcbiAgICB9IGVsc2Uge1xuICAgICAgY29kZSArPSAnTWF0aC5hYnMoJyArIGluY3JlbWVudCArICcpO1xcbic7XG4gICAgfVxuICAgIGNvZGUgKz0gJ2lmICgnICsgc3RhcnRWYXIgKyAnID4gJyArIGVuZFZhciArICcpIHtcXG4nO1xuICAgIGNvZGUgKz0gSmF2YVNjcmlwdC5JTkRFTlQgKyBpbmNWYXIgKyAnID0gLScgKyBpbmNWYXIgKyAnO1xcbic7XG4gICAgY29kZSArPSAnfVxcbic7XG4gICAgY29kZSArPSAnZm9yICgnICsgdmFyaWFibGUwICsgJyA9ICcgKyBzdGFydFZhciArICc7ICcgKyBpbmNWYXIgK1xuICAgICAgICAnID49IDAgPyAnICsgdmFyaWFibGUwICsgJyA8PSAnICsgZW5kVmFyICsgJyA6ICcgKyB2YXJpYWJsZTAgK1xuICAgICAgICAnID49ICcgKyBlbmRWYXIgKyAnOyAnICsgdmFyaWFibGUwICsgJyArPSAnICsgaW5jVmFyICsgJykge1xcbicgK1xuICAgICAgICBicmFuY2ggKyAnfVxcbic7XG4gIH1cbiAgcmV0dXJuIGNvZGU7XG59O1xuXG5KYXZhU2NyaXB0Wydjb250cm9sc19mb3JFYWNoJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBGb3IgZWFjaCBsb29wLlxuICBjb25zdCB2YXJpYWJsZTAgPVxuICAgICAgSmF2YVNjcmlwdC5uYW1lREJfLmdldE5hbWUoYmxvY2suZ2V0RmllbGRWYWx1ZSgnVkFSJyksIE5hbWVUeXBlLlZBUklBQkxFKTtcbiAgY29uc3QgYXJndW1lbnQwID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdMSVNUJywgSmF2YVNjcmlwdC5PUkRFUl9BU1NJR05NRU5UKSB8fFxuICAgICAgJ1tdJztcbiAgbGV0IGJyYW5jaCA9IEphdmFTY3JpcHQuc3RhdGVtZW50VG9Db2RlKGJsb2NrLCAnRE8nKTtcbiAgYnJhbmNoID0gSmF2YVNjcmlwdC5hZGRMb29wVHJhcChicmFuY2gsIGJsb2NrKTtcbiAgbGV0IGNvZGUgPSAnJztcbiAgLy8gQ2FjaGUgbm9uLXRyaXZpYWwgdmFsdWVzIHRvIHZhcmlhYmxlcyB0byBwcmV2ZW50IHJlcGVhdGVkIGxvb2stdXBzLlxuICBsZXQgbGlzdFZhciA9IGFyZ3VtZW50MDtcbiAgaWYgKCFhcmd1bWVudDAubWF0Y2goL15cXHcrJC8pKSB7XG4gICAgbGlzdFZhciA9IEphdmFTY3JpcHQubmFtZURCXy5nZXREaXN0aW5jdE5hbWUoXG4gICAgICAgIHZhcmlhYmxlMCArICdfbGlzdCcsIE5hbWVUeXBlLlZBUklBQkxFKTtcbiAgICBjb2RlICs9ICd2YXIgJyArIGxpc3RWYXIgKyAnID0gJyArIGFyZ3VtZW50MCArICc7XFxuJztcbiAgfVxuICBjb25zdCBpbmRleFZhciA9IEphdmFTY3JpcHQubmFtZURCXy5nZXREaXN0aW5jdE5hbWUoXG4gICAgICB2YXJpYWJsZTAgKyAnX2luZGV4JywgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICBicmFuY2ggPSBKYXZhU2NyaXB0LklOREVOVCArIHZhcmlhYmxlMCArICcgPSAnICsgbGlzdFZhciArICdbJyArIGluZGV4VmFyICtcbiAgICAgICddO1xcbicgKyBicmFuY2g7XG4gIGNvZGUgKz0gJ2ZvciAodmFyICcgKyBpbmRleFZhciArICcgaW4gJyArIGxpc3RWYXIgKyAnKSB7XFxuJyArIGJyYW5jaCArICd9XFxuJztcbiAgcmV0dXJuIGNvZGU7XG59O1xuXG5KYXZhU2NyaXB0Wydjb250cm9sc19mbG93X3N0YXRlbWVudHMnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIEZsb3cgc3RhdGVtZW50czogY29udGludWUsIGJyZWFrLlxuICBsZXQgeGZpeCA9ICcnO1xuICBpZiAoSmF2YVNjcmlwdC5TVEFURU1FTlRfUFJFRklYKSB7XG4gICAgLy8gQXV0b21hdGljIHByZWZpeCBpbnNlcnRpb24gaXMgc3dpdGNoZWQgb2ZmIGZvciB0aGlzIGJsb2NrLiAgQWRkIG1hbnVhbGx5LlxuICAgIHhmaXggKz0gSmF2YVNjcmlwdC5pbmplY3RJZChKYXZhU2NyaXB0LlNUQVRFTUVOVF9QUkVGSVgsIGJsb2NrKTtcbiAgfVxuICBpZiAoSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYKSB7XG4gICAgLy8gSW5qZWN0IGFueSBzdGF0ZW1lbnQgc3VmZml4IGhlcmUgc2luY2UgdGhlIHJlZ3VsYXIgb25lIGF0IHRoZSBlbmRcbiAgICAvLyB3aWxsIG5vdCBnZXQgZXhlY3V0ZWQgaWYgdGhlIGJyZWFrL2NvbnRpbnVlIGlzIHRyaWdnZXJlZC5cbiAgICB4Zml4ICs9IEphdmFTY3JpcHQuaW5qZWN0SWQoSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYLCBibG9jayk7XG4gIH1cbiAgaWYgKEphdmFTY3JpcHQuU1RBVEVNRU5UX1BSRUZJWCkge1xuICAgIGNvbnN0IGxvb3AgPSBibG9jay5nZXRTdXJyb3VuZExvb3AoKTtcbiAgICBpZiAobG9vcCAmJiAhbG9vcC5zdXBwcmVzc1ByZWZpeFN1ZmZpeCkge1xuICAgICAgLy8gSW5qZWN0IGxvb3AncyBzdGF0ZW1lbnQgcHJlZml4IGhlcmUgc2luY2UgdGhlIHJlZ3VsYXIgb25lIGF0IHRoZSBlbmRcbiAgICAgIC8vIG9mIHRoZSBsb29wIHdpbGwgbm90IGdldCBleGVjdXRlZCBpZiAnY29udGludWUnIGlzIHRyaWdnZXJlZC5cbiAgICAgIC8vIEluIHRoZSBjYXNlIG9mICdicmVhaycsIGEgcHJlZml4IGlzIG5lZWRlZCBkdWUgdG8gdGhlIGxvb3AncyBzdWZmaXguXG4gICAgICB4Zml4ICs9IEphdmFTY3JpcHQuaW5qZWN0SWQoSmF2YVNjcmlwdC5TVEFURU1FTlRfUFJFRklYLCBsb29wKTtcbiAgICB9XG4gIH1cbiAgc3dpdGNoIChibG9jay5nZXRGaWVsZFZhbHVlKCdGTE9XJykpIHtcbiAgICBjYXNlICdCUkVBSyc6XG4gICAgICByZXR1cm4geGZpeCArICdicmVhaztcXG4nO1xuICAgIGNhc2UgJ0NPTlRJTlVFJzpcbiAgICAgIHJldHVybiB4Zml4ICsgJ2NvbnRpbnVlO1xcbic7XG4gIH1cbiAgdGhyb3cgRXJyb3IoJ1Vua25vd24gZmxvdyBzdGF0ZW1lbnQuJyk7XG59O1xuIiwiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTIgR29vZ2xlIExMQ1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgR2VuZXJhdGluZyBKYXZhU2NyaXB0IGZvciBsb2dpYyBibG9ja3MuXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC5sb2dpYycpO1xuXG5jb25zdCB7amF2YXNjcmlwdEdlbmVyYXRvcjogSmF2YVNjcmlwdH0gPSBnb29nLnJlcXVpcmUoJ0Jsb2NrbHkuSmF2YVNjcmlwdCcpO1xuXG5cbkphdmFTY3JpcHRbJ2NvbnRyb2xzX2lmJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBJZi9lbHNlaWYvZWxzZSBjb25kaXRpb24uXG4gIGxldCBuID0gMDtcbiAgbGV0IGNvZGUgPSAnJztcbiAgaWYgKEphdmFTY3JpcHQuU1RBVEVNRU5UX1BSRUZJWCkge1xuICAgIC8vIEF1dG9tYXRpYyBwcmVmaXggaW5zZXJ0aW9uIGlzIHN3aXRjaGVkIG9mZiBmb3IgdGhpcyBibG9jay4gIEFkZCBtYW51YWxseS5cbiAgICBjb2RlICs9IEphdmFTY3JpcHQuaW5qZWN0SWQoSmF2YVNjcmlwdC5TVEFURU1FTlRfUFJFRklYLCBibG9jayk7XG4gIH1cbiAgZG8ge1xuICAgIGNvbnN0IGNvbmRpdGlvbkNvZGUgPVxuICAgICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnSUYnICsgbiwgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fFxuICAgICAgICAnZmFsc2UnO1xuICAgIGxldCBicmFuY2hDb2RlID0gSmF2YVNjcmlwdC5zdGF0ZW1lbnRUb0NvZGUoYmxvY2ssICdETycgKyBuKTtcbiAgICBpZiAoSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYKSB7XG4gICAgICBicmFuY2hDb2RlID0gSmF2YVNjcmlwdC5wcmVmaXhMaW5lcyhcbiAgICAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdC5pbmplY3RJZChKYXZhU2NyaXB0LlNUQVRFTUVOVF9TVUZGSVgsIGJsb2NrKSxcbiAgICAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdC5JTkRFTlQpICtcbiAgICAgICAgICBicmFuY2hDb2RlO1xuICAgIH1cbiAgICBjb2RlICs9IChuID4gMCA/ICcgZWxzZSAnIDogJycpICsgJ2lmICgnICsgY29uZGl0aW9uQ29kZSArICcpIHtcXG4nICtcbiAgICAgICAgYnJhbmNoQ29kZSArICd9JztcbiAgICBuKys7XG4gIH0gd2hpbGUgKGJsb2NrLmdldElucHV0KCdJRicgKyBuKSk7XG5cbiAgaWYgKGJsb2NrLmdldElucHV0KCdFTFNFJykgfHwgSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYKSB7XG4gICAgbGV0IGJyYW5jaENvZGUgPSBKYXZhU2NyaXB0LnN0YXRlbWVudFRvQ29kZShibG9jaywgJ0VMU0UnKTtcbiAgICBpZiAoSmF2YVNjcmlwdC5TVEFURU1FTlRfU1VGRklYKSB7XG4gICAgICBicmFuY2hDb2RlID0gSmF2YVNjcmlwdC5wcmVmaXhMaW5lcyhcbiAgICAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdC5pbmplY3RJZChKYXZhU2NyaXB0LlNUQVRFTUVOVF9TVUZGSVgsIGJsb2NrKSxcbiAgICAgICAgICAgICAgICAgICAgICAgSmF2YVNjcmlwdC5JTkRFTlQpICtcbiAgICAgICAgICBicmFuY2hDb2RlO1xuICAgIH1cbiAgICBjb2RlICs9ICcgZWxzZSB7XFxuJyArIGJyYW5jaENvZGUgKyAnfSc7XG4gIH1cbiAgcmV0dXJuIGNvZGUgKyAnXFxuJztcbn07XG5cbkphdmFTY3JpcHRbJ2NvbnRyb2xzX2lmZWxzZSddID0gSmF2YVNjcmlwdFsnY29udHJvbHNfaWYnXTtcblxuSmF2YVNjcmlwdFsnbG9naWNfY29tcGFyZSddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ29tcGFyaXNvbiBvcGVyYXRvci5cbiAgY29uc3QgT1BFUkFUT1JTID1cbiAgICAgIHsnRVEnOiAnPT0nLCAnTkVRJzogJyE9JywgJ0xUJzogJzwnLCAnTFRFJzogJzw9JywgJ0dUJzogJz4nLCAnR1RFJzogJz49J307XG4gIGNvbnN0IG9wZXJhdG9yID0gT1BFUkFUT1JTW2Jsb2NrLmdldEZpZWxkVmFsdWUoJ09QJyldO1xuICBjb25zdCBvcmRlciA9IChvcGVyYXRvciA9PT0gJz09JyB8fCBvcGVyYXRvciA9PT0gJyE9JykgP1xuICAgICAgSmF2YVNjcmlwdC5PUkRFUl9FUVVBTElUWSA6XG4gICAgICBKYXZhU2NyaXB0Lk9SREVSX1JFTEFUSU9OQUw7XG4gIGNvbnN0IGFyZ3VtZW50MCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdBJywgb3JkZXIpIHx8ICcwJztcbiAgY29uc3QgYXJndW1lbnQxID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0InLCBvcmRlcikgfHwgJzAnO1xuICBjb25zdCBjb2RlID0gYXJndW1lbnQwICsgJyAnICsgb3BlcmF0b3IgKyAnICcgKyBhcmd1bWVudDE7XG4gIHJldHVybiBbY29kZSwgb3JkZXJdO1xufTtcblxuSmF2YVNjcmlwdFsnbG9naWNfb3BlcmF0aW9uJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBPcGVyYXRpb25zICdhbmQnLCAnb3InLlxuICBjb25zdCBvcGVyYXRvciA9IChibG9jay5nZXRGaWVsZFZhbHVlKCdPUCcpID09PSAnQU5EJykgPyAnJiYnIDogJ3x8JztcbiAgY29uc3Qgb3JkZXIgPSAob3BlcmF0b3IgPT09ICcmJicpID8gSmF2YVNjcmlwdC5PUkRFUl9MT0dJQ0FMX0FORCA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9PUjtcbiAgbGV0IGFyZ3VtZW50MCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdBJywgb3JkZXIpO1xuICBsZXQgYXJndW1lbnQxID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0InLCBvcmRlcik7XG4gIGlmICghYXJndW1lbnQwICYmICFhcmd1bWVudDEpIHtcbiAgICAvLyBJZiB0aGVyZSBhcmUgbm8gYXJndW1lbnRzLCB0aGVuIHRoZSByZXR1cm4gdmFsdWUgaXMgZmFsc2UuXG4gICAgYXJndW1lbnQwID0gJ2ZhbHNlJztcbiAgICBhcmd1bWVudDEgPSAnZmFsc2UnO1xuICB9IGVsc2Uge1xuICAgIC8vIFNpbmdsZSBtaXNzaW5nIGFyZ3VtZW50cyBoYXZlIG5vIGVmZmVjdCBvbiB0aGUgcmV0dXJuIHZhbHVlLlxuICAgIGNvbnN0IGRlZmF1bHRBcmd1bWVudCA9IChvcGVyYXRvciA9PT0gJyYmJykgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICAgIGlmICghYXJndW1lbnQwKSB7XG4gICAgICBhcmd1bWVudDAgPSBkZWZhdWx0QXJndW1lbnQ7XG4gICAgfVxuICAgIGlmICghYXJndW1lbnQxKSB7XG4gICAgICBhcmd1bWVudDEgPSBkZWZhdWx0QXJndW1lbnQ7XG4gICAgfVxuICB9XG4gIGNvbnN0IGNvZGUgPSBhcmd1bWVudDAgKyAnICcgKyBvcGVyYXRvciArICcgJyArIGFyZ3VtZW50MTtcbiAgcmV0dXJuIFtjb2RlLCBvcmRlcl07XG59O1xuXG5KYXZhU2NyaXB0Wydsb2dpY19uZWdhdGUnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIE5lZ2F0aW9uLlxuICBjb25zdCBvcmRlciA9IEphdmFTY3JpcHQuT1JERVJfTE9HSUNBTF9OT1Q7XG4gIGNvbnN0IGFyZ3VtZW50MCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdCT09MJywgb3JkZXIpIHx8ICd0cnVlJztcbiAgY29uc3QgY29kZSA9ICchJyArIGFyZ3VtZW50MDtcbiAgcmV0dXJuIFtjb2RlLCBvcmRlcl07XG59O1xuXG5KYXZhU2NyaXB0Wydsb2dpY19ib29sZWFuJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBCb29sZWFuIHZhbHVlcyB0cnVlIGFuZCBmYWxzZS5cbiAgY29uc3QgY29kZSA9IChibG9jay5nZXRGaWVsZFZhbHVlKCdCT09MJykgPT09ICdUUlVFJykgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfQVRPTUlDXTtcbn07XG5cbkphdmFTY3JpcHRbJ2xvZ2ljX251bGwnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIE51bGwgZGF0YSB0eXBlLlxuICByZXR1cm4gWydudWxsJywgSmF2YVNjcmlwdC5PUkRFUl9BVE9NSUNdO1xufTtcblxuSmF2YVNjcmlwdFsnbG9naWNfdGVybmFyeSddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gVGVybmFyeSBvcGVyYXRvci5cbiAgY29uc3QgdmFsdWVfaWYgPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0lGJywgSmF2YVNjcmlwdC5PUkRFUl9DT05ESVRJT05BTCkgfHxcbiAgICAgICdmYWxzZSc7XG4gIGNvbnN0IHZhbHVlX3RoZW4gPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1RIRU4nLCBKYXZhU2NyaXB0Lk9SREVSX0NPTkRJVElPTkFMKSB8fFxuICAgICAgJ251bGwnO1xuICBjb25zdCB2YWx1ZV9lbHNlID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdFTFNFJywgSmF2YVNjcmlwdC5PUkRFUl9DT05ESVRJT05BTCkgfHxcbiAgICAgICdudWxsJztcbiAgY29uc3QgY29kZSA9IHZhbHVlX2lmICsgJyA/ICcgKyB2YWx1ZV90aGVuICsgJyA6ICcgKyB2YWx1ZV9lbHNlO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfQ09ORElUSU9OQUxdO1xufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDEyIEdvb2dsZSBMTENcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEdlbmVyYXRpbmcgSmF2YVNjcmlwdCBmb3IgbGlzdCBibG9ja3MuXG4gKiBAc3VwcHJlc3Mge21pc3NpbmdSZXF1aXJlfVxuICovXG4ndXNlIHN0cmljdCc7XG5cbmdvb2cubW9kdWxlKCdCbG9ja2x5LkphdmFTY3JpcHQubGlzdHMnKTtcblxuY29uc3Qge05hbWVUeXBlfSA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5OYW1lcycpO1xuY29uc3Qge2phdmFzY3JpcHRHZW5lcmF0b3I6IEphdmFTY3JpcHR9ID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LkphdmFTY3JpcHQnKTtcblxuXG5KYXZhU2NyaXB0WydsaXN0c19jcmVhdGVfZW1wdHknXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIENyZWF0ZSBhbiBlbXB0eSBsaXN0LlxuICByZXR1cm4gWydbXScsIEphdmFTY3JpcHQuT1JERVJfQVRPTUlDXTtcbn07XG5cbkphdmFTY3JpcHRbJ2xpc3RzX2NyZWF0ZV93aXRoJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBDcmVhdGUgYSBsaXN0IHdpdGggYW55IG51bWJlciBvZiBlbGVtZW50cyBvZiBhbnkgdHlwZS5cbiAgY29uc3QgZWxlbWVudHMgPSBuZXcgQXJyYXkoYmxvY2suaXRlbUNvdW50Xyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2suaXRlbUNvdW50XzsgaSsrKSB7XG4gICAgZWxlbWVudHNbaV0gPVxuICAgICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnQUREJyArIGksIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHxcbiAgICAgICAgJ251bGwnO1xuICB9XG4gIGNvbnN0IGNvZGUgPSAnWycgKyBlbGVtZW50cy5qb2luKCcsICcpICsgJ10nO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfQVRPTUlDXTtcbn07XG5cbkphdmFTY3JpcHRbJ2xpc3RzX3JlcGVhdCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ3JlYXRlIGEgbGlzdCB3aXRoIG9uZSBlbGVtZW50IHJlcGVhdGVkLlxuICBjb25zdCBmdW5jdGlvbk5hbWUgPSBKYXZhU2NyaXB0LnByb3ZpZGVGdW5jdGlvbl8oJ2xpc3RzUmVwZWF0JywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffSh2YWx1ZSwgbikge1xuICB2YXIgYXJyYXkgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICBhcnJheVtpXSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiBhcnJheTtcbn1cbmApO1xuICBjb25zdCBlbGVtZW50ID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdJVEVNJywgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAnbnVsbCc7XG4gIGNvbnN0IHJlcGVhdENvdW50ID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdOVU0nLCBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8ICcwJztcbiAgY29uc3QgY29kZSA9IGZ1bmN0aW9uTmFtZSArICcoJyArIGVsZW1lbnQgKyAnLCAnICsgcmVwZWF0Q291bnQgKyAnKSc7XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ2xpc3RzX2xlbmd0aCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gU3RyaW5nIG9yIGFycmF5IGxlbmd0aC5cbiAgY29uc3QgbGlzdCA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnVkFMVUUnLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUikgfHwgJ1tdJztcbiAgcmV0dXJuIFtsaXN0ICsgJy5sZW5ndGgnLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUl07XG59O1xuXG5KYXZhU2NyaXB0WydsaXN0c19pc0VtcHR5J10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBJcyB0aGUgc3RyaW5nIG51bGwgb3IgYXJyYXkgZW1wdHk/XG4gIGNvbnN0IGxpc3QgPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1ZBTFVFJywgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIpIHx8ICdbXSc7XG4gIHJldHVybiBbJyEnICsgbGlzdCArICcubGVuZ3RoJywgSmF2YVNjcmlwdC5PUkRFUl9MT0dJQ0FMX05PVF07XG59O1xuXG5KYXZhU2NyaXB0WydsaXN0c19pbmRleE9mJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBGaW5kIGFuIGl0ZW0gaW4gdGhlIGxpc3QuXG4gIGNvbnN0IG9wZXJhdG9yID1cbiAgICAgIGJsb2NrLmdldEZpZWxkVmFsdWUoJ0VORCcpID09PSAnRklSU1QnID8gJ2luZGV4T2YnIDogJ2xhc3RJbmRleE9mJztcbiAgY29uc3QgaXRlbSA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnRklORCcsIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgXCInJ1wiO1xuICBjb25zdCBsaXN0ID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdWQUxVRScsIEphdmFTY3JpcHQuT1JERVJfTUVNQkVSKSB8fCAnW10nO1xuICBjb25zdCBjb2RlID0gbGlzdCArICcuJyArIG9wZXJhdG9yICsgJygnICsgaXRlbSArICcpJztcbiAgaWYgKGJsb2NrLndvcmtzcGFjZS5vcHRpb25zLm9uZUJhc2VkSW5kZXgpIHtcbiAgICByZXR1cm4gW2NvZGUgKyAnICsgMScsIEphdmFTY3JpcHQuT1JERVJfQURESVRJT05dO1xuICB9XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ2xpc3RzX2dldEluZGV4J10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBHZXQgZWxlbWVudCBhdCBpbmRleC5cbiAgLy8gTm90ZTogVW50aWwgSmFudWFyeSAyMDEzIHRoaXMgYmxvY2sgZGlkIG5vdCBoYXZlIE1PREUgb3IgV0hFUkUgaW5wdXRzLlxuICBjb25zdCBtb2RlID0gYmxvY2suZ2V0RmllbGRWYWx1ZSgnTU9ERScpIHx8ICdHRVQnO1xuICBjb25zdCB3aGVyZSA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ1dIRVJFJykgfHwgJ0ZST01fU1RBUlQnO1xuICBjb25zdCBsaXN0T3JkZXIgPVxuICAgICAgKHdoZXJlID09PSAnUkFORE9NJykgPyBKYXZhU2NyaXB0Lk9SREVSX05PTkUgOiBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUjtcbiAgY29uc3QgbGlzdCA9IEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdWQUxVRScsIGxpc3RPcmRlcikgfHwgJ1tdJztcblxuICBzd2l0Y2ggKHdoZXJlKSB7XG4gICAgY2FzZSAoJ0ZJUlNUJyk6XG4gICAgICBpZiAobW9kZSA9PT0gJ0dFVCcpIHtcbiAgICAgICAgY29uc3QgY29kZSA9IGxpc3QgKyAnWzBdJztcbiAgICAgICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUl07XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdHRVRfUkVNT1ZFJykge1xuICAgICAgICBjb25zdCBjb2RlID0gbGlzdCArICcuc2hpZnQoKSc7XG4gICAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVJdO1xuICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnUkVNT1ZFJykge1xuICAgICAgICByZXR1cm4gbGlzdCArICcuc2hpZnQoKTtcXG4nO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAoJ0xBU1QnKTpcbiAgICAgIGlmIChtb2RlID09PSAnR0VUJykge1xuICAgICAgICBjb25zdCBjb2RlID0gbGlzdCArICcuc2xpY2UoLTEpWzBdJztcbiAgICAgICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUl07XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdHRVRfUkVNT1ZFJykge1xuICAgICAgICBjb25zdCBjb2RlID0gbGlzdCArICcucG9wKCknO1xuICAgICAgICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfTUVNQkVSXTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ1JFTU9WRScpIHtcbiAgICAgICAgcmV0dXJuIGxpc3QgKyAnLnBvcCgpO1xcbic7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlICgnRlJPTV9TVEFSVCcpOiB7XG4gICAgICBjb25zdCBhdCA9IEphdmFTY3JpcHQuZ2V0QWRqdXN0ZWQoYmxvY2ssICdBVCcpO1xuICAgICAgaWYgKG1vZGUgPT09ICdHRVQnKSB7XG4gICAgICAgIGNvbnN0IGNvZGUgPSBsaXN0ICsgJ1snICsgYXQgKyAnXSc7XG4gICAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVJdO1xuICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnR0VUX1JFTU9WRScpIHtcbiAgICAgICAgY29uc3QgY29kZSA9IGxpc3QgKyAnLnNwbGljZSgnICsgYXQgKyAnLCAxKVswXSc7XG4gICAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ1JFTU9WRScpIHtcbiAgICAgICAgcmV0dXJuIGxpc3QgKyAnLnNwbGljZSgnICsgYXQgKyAnLCAxKTtcXG4nO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgKCdGUk9NX0VORCcpOiB7XG4gICAgICBjb25zdCBhdCA9IEphdmFTY3JpcHQuZ2V0QWRqdXN0ZWQoYmxvY2ssICdBVCcsIDEsIHRydWUpO1xuICAgICAgaWYgKG1vZGUgPT09ICdHRVQnKSB7XG4gICAgICAgIGNvbnN0IGNvZGUgPSBsaXN0ICsgJy5zbGljZSgnICsgYXQgKyAnKVswXSc7XG4gICAgICAgIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ0dFVF9SRU1PVkUnKSB7XG4gICAgICAgIGNvbnN0IGNvZGUgPSBsaXN0ICsgJy5zcGxpY2UoJyArIGF0ICsgJywgMSlbMF0nO1xuICAgICAgICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdSRU1PVkUnKSB7XG4gICAgICAgIHJldHVybiBsaXN0ICsgJy5zcGxpY2UoJyArIGF0ICsgJywgMSk7JztcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlICgnUkFORE9NJyk6IHtcbiAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IEphdmFTY3JpcHQucHJvdmlkZUZ1bmN0aW9uXygnbGlzdHNHZXRSYW5kb21JdGVtJywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffShsaXN0LCByZW1vdmUpIHtcbiAgdmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBsaXN0Lmxlbmd0aCk7XG4gIGlmIChyZW1vdmUpIHtcbiAgICByZXR1cm4gbGlzdC5zcGxpY2UoeCwgMSlbMF07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGxpc3RbeF07XG4gIH1cbn1cbmApO1xuICAgICAgY29uc3QgY29kZSA9IGZ1bmN0aW9uTmFtZSArICcoJyArIGxpc3QgKyAnLCAnICsgKG1vZGUgIT09ICdHRVQnKSArICcpJztcbiAgICAgIGlmIChtb2RlID09PSAnR0VUJyB8fCBtb2RlID09PSAnR0VUX1JFTU9WRScpIHtcbiAgICAgICAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xuICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnUkVNT1ZFJykge1xuICAgICAgICByZXR1cm4gY29kZSArICc7XFxuJztcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICB0aHJvdyBFcnJvcignVW5oYW5kbGVkIGNvbWJpbmF0aW9uIChsaXN0c19nZXRJbmRleCkuJyk7XG59O1xuXG5KYXZhU2NyaXB0WydsaXN0c19zZXRJbmRleCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gU2V0IGVsZW1lbnQgYXQgaW5kZXguXG4gIC8vIE5vdGU6IFVudGlsIEZlYnJ1YXJ5IDIwMTMgdGhpcyBibG9jayBkaWQgbm90IGhhdmUgTU9ERSBvciBXSEVSRSBpbnB1dHMuXG4gIGxldCBsaXN0ID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdMSVNUJywgSmF2YVNjcmlwdC5PUkRFUl9NRU1CRVIpIHx8ICdbXSc7XG4gIGNvbnN0IG1vZGUgPSBibG9jay5nZXRGaWVsZFZhbHVlKCdNT0RFJykgfHwgJ0dFVCc7XG4gIGNvbnN0IHdoZXJlID0gYmxvY2suZ2V0RmllbGRWYWx1ZSgnV0hFUkUnKSB8fCAnRlJPTV9TVEFSVCc7XG4gIGNvbnN0IHZhbHVlID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdUTycsIEphdmFTY3JpcHQuT1JERVJfQVNTSUdOTUVOVCkgfHxcbiAgICAgICdudWxsJztcbiAgLy8gQ2FjaGUgbm9uLXRyaXZpYWwgdmFsdWVzIHRvIHZhcmlhYmxlcyB0byBwcmV2ZW50IHJlcGVhdGVkIGxvb2stdXBzLlxuICAvLyBDbG9zdXJlLCB3aGljaCBhY2Nlc3NlcyBhbmQgbW9kaWZpZXMgJ2xpc3QnLlxuICBmdW5jdGlvbiBjYWNoZUxpc3QoKSB7XG4gICAgaWYgKGxpc3QubWF0Y2goL15cXHcrJC8pKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGNvbnN0IGxpc3RWYXIgPVxuICAgICAgICBKYXZhU2NyaXB0Lm5hbWVEQl8uZ2V0RGlzdGluY3ROYW1lKCd0bXBMaXN0JywgTmFtZVR5cGUuVkFSSUFCTEUpO1xuICAgIGNvbnN0IGNvZGUgPSAndmFyICcgKyBsaXN0VmFyICsgJyA9ICcgKyBsaXN0ICsgJztcXG4nO1xuICAgIGxpc3QgPSBsaXN0VmFyO1xuICAgIHJldHVybiBjb2RlO1xuICB9XG4gIHN3aXRjaCAod2hlcmUpIHtcbiAgICBjYXNlICgnRklSU1QnKTpcbiAgICAgIGlmIChtb2RlID09PSAnU0VUJykge1xuICAgICAgICByZXR1cm4gbGlzdCArICdbMF0gPSAnICsgdmFsdWUgKyAnO1xcbic7XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdJTlNFUlQnKSB7XG4gICAgICAgIHJldHVybiBsaXN0ICsgJy51bnNoaWZ0KCcgKyB2YWx1ZSArICcpO1xcbic7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlICgnTEFTVCcpOlxuICAgICAgaWYgKG1vZGUgPT09ICdTRVQnKSB7XG4gICAgICAgIGxldCBjb2RlID0gY2FjaGVMaXN0KCk7XG4gICAgICAgIGNvZGUgKz0gbGlzdCArICdbJyArIGxpc3QgKyAnLmxlbmd0aCAtIDFdID0gJyArIHZhbHVlICsgJztcXG4nO1xuICAgICAgICByZXR1cm4gY29kZTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ0lOU0VSVCcpIHtcbiAgICAgICAgcmV0dXJuIGxpc3QgKyAnLnB1c2goJyArIHZhbHVlICsgJyk7XFxuJztcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgKCdGUk9NX1NUQVJUJyk6IHtcbiAgICAgIGNvbnN0IGF0ID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChibG9jaywgJ0FUJyk7XG4gICAgICBpZiAobW9kZSA9PT0gJ1NFVCcpIHtcbiAgICAgICAgcmV0dXJuIGxpc3QgKyAnWycgKyBhdCArICddID0gJyArIHZhbHVlICsgJztcXG4nO1xuICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnSU5TRVJUJykge1xuICAgICAgICByZXR1cm4gbGlzdCArICcuc3BsaWNlKCcgKyBhdCArICcsIDAsICcgKyB2YWx1ZSArICcpO1xcbic7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSAoJ0ZST01fRU5EJyk6IHtcbiAgICAgIGNvbnN0IGF0ID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChcbiAgICAgICAgICBibG9jaywgJ0FUJywgMSwgZmFsc2UsIEphdmFTY3JpcHQuT1JERVJfU1VCVFJBQ1RJT04pO1xuICAgICAgbGV0IGNvZGUgPSBjYWNoZUxpc3QoKTtcbiAgICAgIGlmIChtb2RlID09PSAnU0VUJykge1xuICAgICAgICBjb2RlICs9IGxpc3QgKyAnWycgKyBsaXN0ICsgJy5sZW5ndGggLSAnICsgYXQgKyAnXSA9ICcgKyB2YWx1ZSArICc7XFxuJztcbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdJTlNFUlQnKSB7XG4gICAgICAgIGNvZGUgKz0gbGlzdCArICcuc3BsaWNlKCcgKyBsaXN0ICsgJy5sZW5ndGggLSAnICsgYXQgKyAnLCAwLCAnICsgdmFsdWUgK1xuICAgICAgICAgICAgJyk7XFxuJztcbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSAoJ1JBTkRPTScpOiB7XG4gICAgICBsZXQgY29kZSA9IGNhY2hlTGlzdCgpO1xuICAgICAgY29uc3QgeFZhciA9XG4gICAgICAgICAgSmF2YVNjcmlwdC5uYW1lREJfLmdldERpc3RpbmN0TmFtZSgndG1wWCcsIE5hbWVUeXBlLlZBUklBQkxFKTtcbiAgICAgIGNvZGUgKz0gJ3ZhciAnICsgeFZhciArICcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAnICsgbGlzdCArXG4gICAgICAgICAgJy5sZW5ndGgpO1xcbic7XG4gICAgICBpZiAobW9kZSA9PT0gJ1NFVCcpIHtcbiAgICAgICAgY29kZSArPSBsaXN0ICsgJ1snICsgeFZhciArICddID0gJyArIHZhbHVlICsgJztcXG4nO1xuICAgICAgICByZXR1cm4gY29kZTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ0lOU0VSVCcpIHtcbiAgICAgICAgY29kZSArPSBsaXN0ICsgJy5zcGxpY2UoJyArIHhWYXIgKyAnLCAwLCAnICsgdmFsdWUgKyAnKTtcXG4nO1xuICAgICAgICByZXR1cm4gY29kZTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICB0aHJvdyBFcnJvcignVW5oYW5kbGVkIGNvbWJpbmF0aW9uIChsaXN0c19zZXRJbmRleCkuJyk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgYW4gZXhwcmVzc2lvbiBjYWxjdWxhdGluZyB0aGUgaW5kZXggaW50byBhIGxpc3QuXG4gKiBAcGFyYW0ge3N0cmluZ30gbGlzdE5hbWUgTmFtZSBvZiB0aGUgbGlzdCwgdXNlZCB0byBjYWxjdWxhdGUgbGVuZ3RoLlxuICogQHBhcmFtIHtzdHJpbmd9IHdoZXJlIFRoZSBtZXRob2Qgb2YgaW5kZXhpbmcsIHNlbGVjdGVkIGJ5IGRyb3Bkb3duIGluIEJsb2NrbHlcbiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X2F0IFRoZSBvcHRpb25hbCBvZmZzZXQgd2hlbiBpbmRleGluZyBmcm9tIHN0YXJ0L2VuZC5cbiAqIEByZXR1cm4ge3N0cmluZ3x1bmRlZmluZWR9IEluZGV4IGV4cHJlc3Npb24uXG4gKi9cbmNvbnN0IGdldFN1YnN0cmluZ0luZGV4ID0gZnVuY3Rpb24obGlzdE5hbWUsIHdoZXJlLCBvcHRfYXQpIHtcbiAgaWYgKHdoZXJlID09PSAnRklSU1QnKSB7XG4gICAgcmV0dXJuICcwJztcbiAgfSBlbHNlIGlmICh3aGVyZSA9PT0gJ0ZST01fRU5EJykge1xuICAgIHJldHVybiBsaXN0TmFtZSArICcubGVuZ3RoIC0gMSAtICcgKyBvcHRfYXQ7XG4gIH0gZWxzZSBpZiAod2hlcmUgPT09ICdMQVNUJykge1xuICAgIHJldHVybiBsaXN0TmFtZSArICcubGVuZ3RoIC0gMSc7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG9wdF9hdDtcbiAgfVxufTtcblxuSmF2YVNjcmlwdFsnbGlzdHNfZ2V0U3VibGlzdCddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gR2V0IHN1Ymxpc3QuXG4gIGNvbnN0IGxpc3QgPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0xJU1QnLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUikgfHwgJ1tdJztcbiAgY29uc3Qgd2hlcmUxID0gYmxvY2suZ2V0RmllbGRWYWx1ZSgnV0hFUkUxJyk7XG4gIGNvbnN0IHdoZXJlMiA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ1dIRVJFMicpO1xuICBsZXQgY29kZTtcbiAgaWYgKHdoZXJlMSA9PT0gJ0ZJUlNUJyAmJiB3aGVyZTIgPT09ICdMQVNUJykge1xuICAgIGNvZGUgPSBsaXN0ICsgJy5zbGljZSgwKSc7XG4gIH0gZWxzZSBpZiAoXG4gICAgICBsaXN0Lm1hdGNoKC9eXFx3KyQvKSB8fFxuICAgICAgKHdoZXJlMSAhPT0gJ0ZST01fRU5EJyAmJiB3aGVyZTIgPT09ICdGUk9NX1NUQVJUJykpIHtcbiAgICAvLyBJZiB0aGUgbGlzdCBpcyBhIHZhcmlhYmxlIG9yIGRvZXNuJ3QgcmVxdWlyZSBhIGNhbGwgZm9yIGxlbmd0aCwgZG9uJ3RcbiAgICAvLyBnZW5lcmF0ZSBhIGhlbHBlciBmdW5jdGlvbi5cbiAgICBsZXQgYXQxO1xuICAgIHN3aXRjaCAod2hlcmUxKSB7XG4gICAgICBjYXNlICdGUk9NX1NUQVJUJzpcbiAgICAgICAgYXQxID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChibG9jaywgJ0FUMScpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0ZST01fRU5EJzpcbiAgICAgICAgYXQxID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChcbiAgICAgICAgICAgIGJsb2NrLCAnQVQxJywgMSwgZmFsc2UsIEphdmFTY3JpcHQuT1JERVJfU1VCVFJBQ1RJT04pO1xuICAgICAgICBhdDEgPSBsaXN0ICsgJy5sZW5ndGggLSAnICsgYXQxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0ZJUlNUJzpcbiAgICAgICAgYXQxID0gJzAnO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IEVycm9yKCdVbmhhbmRsZWQgb3B0aW9uIChsaXN0c19nZXRTdWJsaXN0KS4nKTtcbiAgICB9XG4gICAgbGV0IGF0MjtcbiAgICBzd2l0Y2ggKHdoZXJlMikge1xuICAgICAgY2FzZSAnRlJPTV9TVEFSVCc6XG4gICAgICAgIGF0MiA9IEphdmFTY3JpcHQuZ2V0QWRqdXN0ZWQoYmxvY2ssICdBVDInLCAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdGUk9NX0VORCc6XG4gICAgICAgIGF0MiA9IEphdmFTY3JpcHQuZ2V0QWRqdXN0ZWQoXG4gICAgICAgICAgICBibG9jaywgJ0FUMicsIDAsIGZhbHNlLCBKYXZhU2NyaXB0Lk9SREVSX1NVQlRSQUNUSU9OKTtcbiAgICAgICAgYXQyID0gbGlzdCArICcubGVuZ3RoIC0gJyArIGF0MjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdMQVNUJzpcbiAgICAgICAgYXQyID0gbGlzdCArICcubGVuZ3RoJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBFcnJvcignVW5oYW5kbGVkIG9wdGlvbiAobGlzdHNfZ2V0U3VibGlzdCkuJyk7XG4gICAgfVxuICAgIGNvZGUgPSBsaXN0ICsgJy5zbGljZSgnICsgYXQxICsgJywgJyArIGF0MiArICcpJztcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBhdDEgPSBKYXZhU2NyaXB0LmdldEFkanVzdGVkKGJsb2NrLCAnQVQxJyk7XG4gICAgY29uc3QgYXQyID0gSmF2YVNjcmlwdC5nZXRBZGp1c3RlZChibG9jaywgJ0FUMicpO1xuICAgIGNvbnN0IHdoZXJlUGFzY2FsQ2FzZSA9IHtcbiAgICAgICdGSVJTVCc6ICdGaXJzdCcsXG4gICAgICAnTEFTVCc6ICdMYXN0JyxcbiAgICAgICdGUk9NX1NUQVJUJzogJ0Zyb21TdGFydCcsXG4gICAgICAnRlJPTV9FTkQnOiAnRnJvbUVuZCcsXG4gICAgfTtcbiAgICAvLyBUaGUgdmFsdWUgZm9yICdGUk9NX0VORCcgYW5kJ0ZST01fU1RBUlQnIGRlcGVuZHMgb24gYGF0YCBzb1xuICAgIC8vIHdlIGFkZCBpdCBhcyBhIHBhcmFtZXRlci5cbiAgICBjb25zdCBhdDFQYXJhbSA9XG4gICAgICAgICh3aGVyZTEgPT09ICdGUk9NX0VORCcgfHwgd2hlcmUxID09PSAnRlJPTV9TVEFSVCcpID8gJywgYXQxJyA6ICcnO1xuICAgIGNvbnN0IGF0MlBhcmFtID1cbiAgICAgICAgKHdoZXJlMiA9PT0gJ0ZST01fRU5EJyB8fCB3aGVyZTIgPT09ICdGUk9NX1NUQVJUJykgPyAnLCBhdDInIDogJyc7XG4gICAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKFxuICAgICAgICAnc3Vic2VxdWVuY2UnICsgd2hlcmVQYXNjYWxDYXNlW3doZXJlMV0gKyB3aGVyZVBhc2NhbENhc2Vbd2hlcmUyXSwgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffShzZXF1ZW5jZSR7YXQxUGFyYW19JHthdDJQYXJhbX0pIHtcbiAgdmFyIHN0YXJ0ID0gJHtnZXRTdWJzdHJpbmdJbmRleCgnc2VxdWVuY2UnLCB3aGVyZTEsICdhdDEnKX07XG4gIHZhciBlbmQgPSAke2dldFN1YnN0cmluZ0luZGV4KCdzZXF1ZW5jZScsIHdoZXJlMiwgJ2F0MicpfSArIDE7XG4gIHJldHVybiBzZXF1ZW5jZS5zbGljZShzdGFydCwgZW5kKTtcbn1cbmApO1xuICAgIGNvZGUgPSBmdW5jdGlvbk5hbWUgKyAnKCcgKyBsaXN0ICtcbiAgICAgICAgLy8gVGhlIHZhbHVlIGZvciAnRlJPTV9FTkQnIGFuZCAnRlJPTV9TVEFSVCcgZGVwZW5kcyBvbiBgYXRgIHNvIHdlXG4gICAgICAgIC8vIHBhc3MgaXQuXG4gICAgICAgICgod2hlcmUxID09PSAnRlJPTV9FTkQnIHx8IHdoZXJlMSA9PT0gJ0ZST01fU1RBUlQnKSA/ICcsICcgKyBhdDEgOiAnJykgK1xuICAgICAgICAoKHdoZXJlMiA9PT0gJ0ZST01fRU5EJyB8fCB3aGVyZTIgPT09ICdGUk9NX1NUQVJUJykgPyAnLCAnICsgYXQyIDogJycpICtcbiAgICAgICAgJyknO1xuICB9XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG5cbkphdmFTY3JpcHRbJ2xpc3RzX3NvcnQnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIEJsb2NrIGZvciBzb3J0aW5nIGEgbGlzdC5cbiAgY29uc3QgbGlzdCA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTCkgfHxcbiAgICAgICdbXSc7XG4gIGNvbnN0IGRpcmVjdGlvbiA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ0RJUkVDVElPTicpID09PSAnMScgPyAxIDogLTE7XG4gIGNvbnN0IHR5cGUgPSBibG9jay5nZXRGaWVsZFZhbHVlKCdUWVBFJyk7XG4gIGNvbnN0IGdldENvbXBhcmVGdW5jdGlvbk5hbWUgPVxuICAgICAgSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdsaXN0c0dldFNvcnRDb21wYXJlJywgYFxuZnVuY3Rpb24gJHtKYXZhU2NyaXB0LkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJffSh0eXBlLCBkaXJlY3Rpb24pIHtcbiAgdmFyIGNvbXBhcmVGdW5jcyA9IHtcbiAgICAnTlVNRVJJQyc6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIE51bWJlcihhKSAtIE51bWJlcihiKTsgfSxcbiAgICAnVEVYVCc6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGEudG9TdHJpbmcoKSA+IGIudG9TdHJpbmcoKSA/IDEgOiAtMTsgfSxcbiAgICAnSUdOT1JFX0NBU0UnOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHJldHVybiBhLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA+IGIudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID8gMSA6IC0xOyB9LFxuICB9O1xuICB2YXIgY29tcGFyZSA9IGNvbXBhcmVGdW5jc1t0eXBlXTtcbiAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGNvbXBhcmUoYSwgYikgKiBkaXJlY3Rpb247IH07XG59XG4gICAgICBgKTtcbiAgcmV0dXJuIFtcbiAgICBsaXN0ICsgJy5zbGljZSgpLnNvcnQoJyArIGdldENvbXBhcmVGdW5jdGlvbk5hbWUgKyAnKFwiJyArIHR5cGUgKyAnXCIsICcgK1xuICAgICAgICBkaXJlY3Rpb24gKyAnKSknLFxuICAgIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTFxuICBdO1xufTtcblxuSmF2YVNjcmlwdFsnbGlzdHNfc3BsaXQnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIEJsb2NrIGZvciBzcGxpdHRpbmcgdGV4dCBpbnRvIGEgbGlzdCwgb3Igam9pbmluZyBhIGxpc3QgaW50byB0ZXh0LlxuICBsZXQgaW5wdXQgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnSU5QVVQnLCBKYXZhU2NyaXB0Lk9SREVSX01FTUJFUik7XG4gIGNvbnN0IGRlbGltaXRlciA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnREVMSU0nLCBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8IFwiJydcIjtcbiAgY29uc3QgbW9kZSA9IGJsb2NrLmdldEZpZWxkVmFsdWUoJ01PREUnKTtcbiAgbGV0IGZ1bmN0aW9uTmFtZTtcbiAgaWYgKG1vZGUgPT09ICdTUExJVCcpIHtcbiAgICBpZiAoIWlucHV0KSB7XG4gICAgICBpbnB1dCA9IFwiJydcIjtcbiAgICB9XG4gICAgZnVuY3Rpb25OYW1lID0gJ3NwbGl0JztcbiAgfSBlbHNlIGlmIChtb2RlID09PSAnSk9JTicpIHtcbiAgICBpZiAoIWlucHV0KSB7XG4gICAgICBpbnB1dCA9ICdbXSc7XG4gICAgfVxuICAgIGZ1bmN0aW9uTmFtZSA9ICdqb2luJztcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBFcnJvcignVW5rbm93biBtb2RlOiAnICsgbW9kZSk7XG4gIH1cbiAgY29uc3QgY29kZSA9IGlucHV0ICsgJy4nICsgZnVuY3Rpb25OYW1lICsgJygnICsgZGVsaW1pdGVyICsgJyknO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTF07XG59O1xuXG5KYXZhU2NyaXB0WydsaXN0c19yZXZlcnNlJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBCbG9jayBmb3IgcmV2ZXJzaW5nIGEgbGlzdC5cbiAgY29uc3QgbGlzdCA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTElTVCcsIEphdmFTY3JpcHQuT1JERVJfRlVOQ1RJT05fQ0FMTCkgfHxcbiAgICAgICdbXSc7XG4gIGNvbnN0IGNvZGUgPSBsaXN0ICsgJy5zbGljZSgpLnJldmVyc2UoKSc7XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxMiBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBHZW5lcmF0aW5nIEphdmFTY3JpcHQgZm9yIGNvbG91ciBibG9ja3MuXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC5jb2xvdXInKTtcblxuY29uc3Qge2phdmFzY3JpcHRHZW5lcmF0b3I6IEphdmFTY3JpcHR9ID0gZ29vZy5yZXF1aXJlKCdCbG9ja2x5LkphdmFTY3JpcHQnKTtcblxuXG5KYXZhU2NyaXB0Wydjb2xvdXJfcGlja2VyJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBDb2xvdXIgcGlja2VyLlxuICBjb25zdCBjb2RlID0gSmF2YVNjcmlwdC5xdW90ZV8oYmxvY2suZ2V0RmllbGRWYWx1ZSgnQ09MT1VSJykpO1xuICByZXR1cm4gW2NvZGUsIEphdmFTY3JpcHQuT1JERVJfQVRPTUlDXTtcbn07XG5cbkphdmFTY3JpcHRbJ2NvbG91cl9yYW5kb20nXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4gIC8vIEdlbmVyYXRlIGEgcmFuZG9tIGNvbG91ci5cbiAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdjb2xvdXJSYW5kb20nLCBgXG5mdW5jdGlvbiAke0phdmFTY3JpcHQuRlVOQ1RJT05fTkFNRV9QTEFDRUhPTERFUl99KCkge1xuICB2YXIgbnVtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogTWF0aC5wb3coMiwgMjQpKTtcbiAgcmV0dXJuICcjJyArICgnMDAwMDAnICsgbnVtLnRvU3RyaW5nKDE2KSkuc3Vic3RyKC02KTtcbn1cbmApO1xuICBjb25zdCBjb2RlID0gZnVuY3Rpb25OYW1lICsgJygpJztcbiAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcblxuSmF2YVNjcmlwdFsnY29sb3VyX3JnYiddID0gZnVuY3Rpb24oYmxvY2spIHtcbiAgLy8gQ29tcG9zZSBhIGNvbG91ciBmcm9tIFJHQiBjb21wb25lbnRzIGV4cHJlc3NlZCBhcyBwZXJjZW50YWdlcy5cbiAgY29uc3QgcmVkID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ1JFRCcsIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHwgMDtcbiAgY29uc3QgZ3JlZW4gPVxuICAgICAgSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0dSRUVOJywgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAwO1xuICBjb25zdCBibHVlID1cbiAgICAgIEphdmFTY3JpcHQudmFsdWVUb0NvZGUoYmxvY2ssICdCTFVFJywgSmF2YVNjcmlwdC5PUkRFUl9OT05FKSB8fCAwO1xuICBjb25zdCBmdW5jdGlvbk5hbWUgPSBKYXZhU2NyaXB0LnByb3ZpZGVGdW5jdGlvbl8oJ2NvbG91clJnYicsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30ociwgZywgYikge1xuICByID0gTWF0aC5tYXgoTWF0aC5taW4oTnVtYmVyKHIpLCAxMDApLCAwKSAqIDIuNTU7XG4gIGcgPSBNYXRoLm1heChNYXRoLm1pbihOdW1iZXIoZyksIDEwMCksIDApICogMi41NTtcbiAgYiA9IE1hdGgubWF4KE1hdGgubWluKE51bWJlcihiKSwgMTAwKSwgMCkgKiAyLjU1O1xuICByID0gKCcwJyArIChNYXRoLnJvdW5kKHIpIHx8IDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICBnID0gKCcwJyArIChNYXRoLnJvdW5kKGcpIHx8IDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICBiID0gKCcwJyArIChNYXRoLnJvdW5kKGIpIHx8IDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICByZXR1cm4gJyMnICsgciArIGcgKyBiO1xufVxuYCk7XG4gIGNvbnN0IGNvZGUgPSBmdW5jdGlvbk5hbWUgKyAnKCcgKyByZWQgKyAnLCAnICsgZ3JlZW4gKyAnLCAnICsgYmx1ZSArICcpJztcbiAgcmV0dXJuIFtjb2RlLCBKYXZhU2NyaXB0Lk9SREVSX0ZVTkNUSU9OX0NBTExdO1xufTtcblxuSmF2YVNjcmlwdFsnY29sb3VyX2JsZW5kJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAvLyBCbGVuZCB0d28gY29sb3VycyB0b2dldGhlci5cbiAgY29uc3QgYzEgPSBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnQ09MT1VSMScsIEphdmFTY3JpcHQuT1JERVJfTk9ORSkgfHxcbiAgICAgIFwiJyMwMDAwMDAnXCI7XG4gIGNvbnN0IGMyID0gSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ0NPTE9VUjInLCBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8XG4gICAgICBcIicjMDAwMDAwJ1wiO1xuICBjb25zdCByYXRpbyA9XG4gICAgICBKYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnUkFUSU8nLCBKYXZhU2NyaXB0Lk9SREVSX05PTkUpIHx8IDAuNTtcbiAgY29uc3QgZnVuY3Rpb25OYW1lID0gSmF2YVNjcmlwdC5wcm92aWRlRnVuY3Rpb25fKCdjb2xvdXJCbGVuZCcsIGBcbmZ1bmN0aW9uICR7SmF2YVNjcmlwdC5GVU5DVElPTl9OQU1FX1BMQUNFSE9MREVSX30oYzEsIGMyLCByYXRpbykge1xuICByYXRpbyA9IE1hdGgubWF4KE1hdGgubWluKE51bWJlcihyYXRpbyksIDEpLCAwKTtcbiAgdmFyIHIxID0gcGFyc2VJbnQoYzEuc3Vic3RyaW5nKDEsIDMpLCAxNik7XG4gIHZhciBnMSA9IHBhcnNlSW50KGMxLnN1YnN0cmluZygzLCA1KSwgMTYpO1xuICB2YXIgYjEgPSBwYXJzZUludChjMS5zdWJzdHJpbmcoNSwgNyksIDE2KTtcbiAgdmFyIHIyID0gcGFyc2VJbnQoYzIuc3Vic3RyaW5nKDEsIDMpLCAxNik7XG4gIHZhciBnMiA9IHBhcnNlSW50KGMyLnN1YnN0cmluZygzLCA1KSwgMTYpO1xuICB2YXIgYjIgPSBwYXJzZUludChjMi5zdWJzdHJpbmcoNSwgNyksIDE2KTtcbiAgdmFyIHIgPSBNYXRoLnJvdW5kKHIxICogKDEgLSByYXRpbykgKyByMiAqIHJhdGlvKTtcbiAgdmFyIGcgPSBNYXRoLnJvdW5kKGcxICogKDEgLSByYXRpbykgKyBnMiAqIHJhdGlvKTtcbiAgdmFyIGIgPSBNYXRoLnJvdW5kKGIxICogKDEgLSByYXRpbykgKyBiMiAqIHJhdGlvKTtcbiAgciA9ICgnMCcgKyAociB8fCAwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgZyA9ICgnMCcgKyAoZyB8fCAwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgYiA9ICgnMCcgKyAoYiB8fCAwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgcmV0dXJuICcjJyArIHIgKyBnICsgYjtcbn1cbmApO1xuICBjb25zdCBjb2RlID0gZnVuY3Rpb25OYW1lICsgJygnICsgYzEgKyAnLCAnICsgYzIgKyAnLCAnICsgcmF0aW8gKyAnKSc7XG4gIHJldHVybiBbY29kZSwgSmF2YVNjcmlwdC5PUkRFUl9GVU5DVElPTl9DQUxMXTtcbn07XG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBDb21wbGV0ZSBoZWxwZXIgZnVuY3Rpb25zIGZvciBnZW5lcmF0aW5nIEphdmFTY3JpcHQgZm9yXG4gKiAgICAgYmxvY2tzLiAgVGhpcyBpcyB0aGUgZW50cnlwb2ludCBmb3IgamF2YXNjcmlwdF9jb21wcmVzc2VkLmpzLlxuICogQHN1cHByZXNzIHtleHRyYVJlcXVpcmV9XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZ29vZy5tb2R1bGUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC5hbGwnKTtcblxuY29uc3QgbW9kdWxlRXhwb3J0cyA9IGdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0Jyk7XG5nb29nLnJlcXVpcmUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC5jb2xvdXInKTtcbmdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0Lmxpc3RzJyk7XG5nb29nLnJlcXVpcmUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC5sb2dpYycpO1xuZ29vZy5yZXF1aXJlKCdCbG9ja2x5LkphdmFTY3JpcHQubG9vcHMnKTtcbmdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0Lm1hdGgnKTtcbmdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0LnByb2NlZHVyZXMnKTtcbmdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0LnRleHRzJyk7XG5nb29nLnJlcXVpcmUoJ0Jsb2NrbHkuSmF2YVNjcmlwdC52YXJpYWJsZXMnKTtcbmdvb2cucmVxdWlyZSgnQmxvY2tseS5KYXZhU2NyaXB0LnZhcmlhYmxlc0R5bmFtaWMnKTtcblxuZXhwb3J0cyA9IG1vZHVsZUV4cG9ydHM7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/blockly/javascript_compressed.js\n");

/***/ }),

/***/ "./src/index.css":
/*!***********************!*\
  !*** ./src/index.css ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ \"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleDomAPI.js */ \"./node_modules/style-loader/dist/runtime/styleDomAPI.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertBySelector.js */ \"./node_modules/style-loader/dist/runtime/insertBySelector.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js */ \"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertStyleElement.js */ \"./node_modules/style-loader/dist/runtime/insertStyleElement.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleTagTransform.js */ \"./node_modules/style-loader/dist/runtime/styleTagTransform.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _node_modules_css_loader_dist_cjs_js_index_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./index.css */ \"./node_modules/css-loader/dist/cjs.js!./src/index.css\");\n\n      \n      \n      \n      \n      \n      \n      \n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());\noptions.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default());\n\n      options.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, \"head\");\n    \noptions.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());\noptions.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());\n\nvar update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_index_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"], options);\n\n\n\n\n       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_index_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"] && _node_modules_css_loader_dist_cjs_js_index_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals ? _node_modules_css_loader_dist_cjs_js_index_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals : undefined);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXguY3NzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vc3JjL2luZGV4LmNzcz9jZmU0Il0sInNvdXJjZXNDb250ZW50IjpbIlxuICAgICAgaW1wb3J0IEFQSSBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luamVjdFN0eWxlc0ludG9TdHlsZVRhZy5qc1wiO1xuICAgICAgaW1wb3J0IGRvbUFQSSBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlRG9tQVBJLmpzXCI7XG4gICAgICBpbXBvcnQgaW5zZXJ0Rm4gZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRCeVNlbGVjdG9yLmpzXCI7XG4gICAgICBpbXBvcnQgc2V0QXR0cmlidXRlcyBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3NldEF0dHJpYnV0ZXNXaXRob3V0QXR0cmlidXRlcy5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydFN0eWxlRWxlbWVudCBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luc2VydFN0eWxlRWxlbWVudC5qc1wiO1xuICAgICAgaW1wb3J0IHN0eWxlVGFnVHJhbnNmb3JtRm4gZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZVRhZ1RyYW5zZm9ybS5qc1wiO1xuICAgICAgaW1wb3J0IGNvbnRlbnQsICogYXMgbmFtZWRFeHBvcnQgZnJvbSBcIiEhLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanMhLi9pbmRleC5jc3NcIjtcbiAgICAgIFxuICAgICAgXG5cbnZhciBvcHRpb25zID0ge307XG5cbm9wdGlvbnMuc3R5bGVUYWdUcmFuc2Zvcm0gPSBzdHlsZVRhZ1RyYW5zZm9ybUZuO1xub3B0aW9ucy5zZXRBdHRyaWJ1dGVzID0gc2V0QXR0cmlidXRlcztcblxuICAgICAgb3B0aW9ucy5pbnNlcnQgPSBpbnNlcnRGbi5iaW5kKG51bGwsIFwiaGVhZFwiKTtcbiAgICBcbm9wdGlvbnMuZG9tQVBJID0gZG9tQVBJO1xub3B0aW9ucy5pbnNlcnRTdHlsZUVsZW1lbnQgPSBpbnNlcnRTdHlsZUVsZW1lbnQ7XG5cbnZhciB1cGRhdGUgPSBBUEkoY29udGVudCwgb3B0aW9ucyk7XG5cblxuXG5leHBvcnQgKiBmcm9tIFwiISEuLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL2luZGV4LmNzc1wiO1xuICAgICAgIGV4cG9ydCBkZWZhdWx0IGNvbnRlbnQgJiYgY29udGVudC5sb2NhbHMgPyBjb250ZW50LmxvY2FscyA6IHVuZGVmaW5lZDtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/index.css\n");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":
/*!****************************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js ***!
  \****************************************************************************/
/***/ ((module) => {

"use strict";
eval("\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzPzJkYmEiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBzdHlsZXNJbkRPTSA9IFtdO1xuZnVuY3Rpb24gZ2V0SW5kZXhCeUlkZW50aWZpZXIoaWRlbnRpZmllcikge1xuICB2YXIgcmVzdWx0ID0gLTE7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3R5bGVzSW5ET00ubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoc3R5bGVzSW5ET01baV0uaWRlbnRpZmllciA9PT0gaWRlbnRpZmllcikge1xuICAgICAgcmVzdWx0ID0gaTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gbW9kdWxlc1RvRG9tKGxpc3QsIG9wdGlvbnMpIHtcbiAgdmFyIGlkQ291bnRNYXAgPSB7fTtcbiAgdmFyIGlkZW50aWZpZXJzID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBpdGVtID0gbGlzdFtpXTtcbiAgICB2YXIgaWQgPSBvcHRpb25zLmJhc2UgPyBpdGVtWzBdICsgb3B0aW9ucy5iYXNlIDogaXRlbVswXTtcbiAgICB2YXIgY291bnQgPSBpZENvdW50TWFwW2lkXSB8fCAwO1xuICAgIHZhciBpZGVudGlmaWVyID0gXCJcIi5jb25jYXQoaWQsIFwiIFwiKS5jb25jYXQoY291bnQpO1xuICAgIGlkQ291bnRNYXBbaWRdID0gY291bnQgKyAxO1xuICAgIHZhciBpbmRleEJ5SWRlbnRpZmllciA9IGdldEluZGV4QnlJZGVudGlmaWVyKGlkZW50aWZpZXIpO1xuICAgIHZhciBvYmogPSB7XG4gICAgICBjc3M6IGl0ZW1bMV0sXG4gICAgICBtZWRpYTogaXRlbVsyXSxcbiAgICAgIHNvdXJjZU1hcDogaXRlbVszXSxcbiAgICAgIHN1cHBvcnRzOiBpdGVtWzRdLFxuICAgICAgbGF5ZXI6IGl0ZW1bNV1cbiAgICB9O1xuICAgIGlmIChpbmRleEJ5SWRlbnRpZmllciAhPT0gLTEpIHtcbiAgICAgIHN0eWxlc0luRE9NW2luZGV4QnlJZGVudGlmaWVyXS5yZWZlcmVuY2VzKys7XG4gICAgICBzdHlsZXNJbkRPTVtpbmRleEJ5SWRlbnRpZmllcl0udXBkYXRlcihvYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgdXBkYXRlciA9IGFkZEVsZW1lbnRTdHlsZShvYmosIG9wdGlvbnMpO1xuICAgICAgb3B0aW9ucy5ieUluZGV4ID0gaTtcbiAgICAgIHN0eWxlc0luRE9NLnNwbGljZShpLCAwLCB7XG4gICAgICAgIGlkZW50aWZpZXI6IGlkZW50aWZpZXIsXG4gICAgICAgIHVwZGF0ZXI6IHVwZGF0ZXIsXG4gICAgICAgIHJlZmVyZW5jZXM6IDFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZGVudGlmaWVycy5wdXNoKGlkZW50aWZpZXIpO1xuICB9XG4gIHJldHVybiBpZGVudGlmaWVycztcbn1cbmZ1bmN0aW9uIGFkZEVsZW1lbnRTdHlsZShvYmosIG9wdGlvbnMpIHtcbiAgdmFyIGFwaSA9IG9wdGlvbnMuZG9tQVBJKG9wdGlvbnMpO1xuICBhcGkudXBkYXRlKG9iaik7XG4gIHZhciB1cGRhdGVyID0gZnVuY3Rpb24gdXBkYXRlcihuZXdPYmopIHtcbiAgICBpZiAobmV3T2JqKSB7XG4gICAgICBpZiAobmV3T2JqLmNzcyA9PT0gb2JqLmNzcyAmJiBuZXdPYmoubWVkaWEgPT09IG9iai5tZWRpYSAmJiBuZXdPYmouc291cmNlTWFwID09PSBvYmouc291cmNlTWFwICYmIG5ld09iai5zdXBwb3J0cyA9PT0gb2JqLnN1cHBvcnRzICYmIG5ld09iai5sYXllciA9PT0gb2JqLmxheWVyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGFwaS51cGRhdGUob2JqID0gbmV3T2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXBpLnJlbW92ZSgpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHVwZGF0ZXI7XG59XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChsaXN0LCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBsaXN0ID0gbGlzdCB8fCBbXTtcbiAgdmFyIGxhc3RJZGVudGlmaWVycyA9IG1vZHVsZXNUb0RvbShsaXN0LCBvcHRpb25zKTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZShuZXdMaXN0KSB7XG4gICAgbmV3TGlzdCA9IG5ld0xpc3QgfHwgW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0SWRlbnRpZmllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBpZGVudGlmaWVyID0gbGFzdElkZW50aWZpZXJzW2ldO1xuICAgICAgdmFyIGluZGV4ID0gZ2V0SW5kZXhCeUlkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICBzdHlsZXNJbkRPTVtpbmRleF0ucmVmZXJlbmNlcy0tO1xuICAgIH1cbiAgICB2YXIgbmV3TGFzdElkZW50aWZpZXJzID0gbW9kdWxlc1RvRG9tKG5ld0xpc3QsIG9wdGlvbnMpO1xuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBsYXN0SWRlbnRpZmllcnMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICB2YXIgX2lkZW50aWZpZXIgPSBsYXN0SWRlbnRpZmllcnNbX2ldO1xuICAgICAgdmFyIF9pbmRleCA9IGdldEluZGV4QnlJZGVudGlmaWVyKF9pZGVudGlmaWVyKTtcbiAgICAgIGlmIChzdHlsZXNJbkRPTVtfaW5kZXhdLnJlZmVyZW5jZXMgPT09IDApIHtcbiAgICAgICAgc3R5bGVzSW5ET01bX2luZGV4XS51cGRhdGVyKCk7XG4gICAgICAgIHN0eWxlc0luRE9NLnNwbGljZShfaW5kZXgsIDEpO1xuICAgICAgfVxuICAgIH1cbiAgICBsYXN0SWRlbnRpZmllcnMgPSBuZXdMYXN0SWRlbnRpZmllcnM7XG4gIH07XG59OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\n");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/insertBySelector.js":
/*!********************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/insertBySelector.js ***!
  \********************************************************************/
/***/ ((module) => {

"use strict";
eval("\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRCeVNlbGVjdG9yLmpzLmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5zZXJ0QnlTZWxlY3Rvci5qcz9iMjE0Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgbWVtbyA9IHt9O1xuXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAgKi9cbmZ1bmN0aW9uIGdldFRhcmdldCh0YXJnZXQpIHtcbiAgaWYgKHR5cGVvZiBtZW1vW3RhcmdldF0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB2YXIgc3R5bGVUYXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhcmdldCk7XG5cbiAgICAvLyBTcGVjaWFsIGNhc2UgdG8gcmV0dXJuIGhlYWQgb2YgaWZyYW1lIGluc3RlYWQgb2YgaWZyYW1lIGl0c2VsZlxuICAgIGlmICh3aW5kb3cuSFRNTElGcmFtZUVsZW1lbnQgJiYgc3R5bGVUYXJnZXQgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTElGcmFtZUVsZW1lbnQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRoaXMgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24gaWYgYWNjZXNzIHRvIGlmcmFtZSBpcyBibG9ja2VkXG4gICAgICAgIC8vIGR1ZSB0byBjcm9zcy1vcmlnaW4gcmVzdHJpY3Rpb25zXG4gICAgICAgIHN0eWxlVGFyZ2V0ID0gc3R5bGVUYXJnZXQuY29udGVudERvY3VtZW50LmhlYWQ7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIGlzdGFuYnVsIGlnbm9yZSBuZXh0XG4gICAgICAgIHN0eWxlVGFyZ2V0ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgbWVtb1t0YXJnZXRdID0gc3R5bGVUYXJnZXQ7XG4gIH1cbiAgcmV0dXJuIG1lbW9bdGFyZ2V0XTtcbn1cblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5mdW5jdGlvbiBpbnNlcnRCeVNlbGVjdG9yKGluc2VydCwgc3R5bGUpIHtcbiAgdmFyIHRhcmdldCA9IGdldFRhcmdldChpbnNlcnQpO1xuICBpZiAoIXRhcmdldCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkbid0IGZpbmQgYSBzdHlsZSB0YXJnZXQuIFRoaXMgcHJvYmFibHkgbWVhbnMgdGhhdCB0aGUgdmFsdWUgZm9yIHRoZSAnaW5zZXJ0JyBwYXJhbWV0ZXIgaXMgaW52YWxpZC5cIik7XG4gIH1cbiAgdGFyZ2V0LmFwcGVuZENoaWxkKHN0eWxlKTtcbn1cbm1vZHVsZS5leHBvcnRzID0gaW5zZXJ0QnlTZWxlY3RvcjsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/style-loader/dist/runtime/insertBySelector.js\n");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/insertStyleElement.js":
/*!**********************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/insertStyleElement.js ***!
  \**********************************************************************/
/***/ ((module) => {

"use strict";
eval("\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRTdHlsZUVsZW1lbnQuanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRTdHlsZUVsZW1lbnQuanM/ZGU2YyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5mdW5jdGlvbiBpbnNlcnRTdHlsZUVsZW1lbnQob3B0aW9ucykge1xuICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgb3B0aW9ucy5zZXRBdHRyaWJ1dGVzKGVsZW1lbnQsIG9wdGlvbnMuYXR0cmlidXRlcyk7XG4gIG9wdGlvbnMuaW5zZXJ0KGVsZW1lbnQsIG9wdGlvbnMub3B0aW9ucyk7XG4gIHJldHVybiBlbGVtZW50O1xufVxubW9kdWxlLmV4cG9ydHMgPSBpbnNlcnRTdHlsZUVsZW1lbnQ7Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/style-loader/dist/runtime/insertStyleElement.js\n");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js ***!
  \**********************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

"use strict";
eval("\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce =  true ? __webpack_require__.nc : 0;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXMuanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYjEvLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXMuanM/ZGRjZSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5mdW5jdGlvbiBzZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXMoc3R5bGVFbGVtZW50KSB7XG4gIHZhciBub25jZSA9IHR5cGVvZiBfX3dlYnBhY2tfbm9uY2VfXyAhPT0gXCJ1bmRlZmluZWRcIiA/IF9fd2VicGFja19ub25jZV9fIDogbnVsbDtcbiAgaWYgKG5vbmNlKSB7XG4gICAgc3R5bGVFbGVtZW50LnNldEF0dHJpYnV0ZShcIm5vbmNlXCIsIG5vbmNlKTtcbiAgfVxufVxubW9kdWxlLmV4cG9ydHMgPSBzZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXM7Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\n");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/styleDomAPI.js":
/*!***************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/styleDomAPI.js ***!
  \***************************************************************/
/***/ ((module) => {

"use strict";
eval("\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZURvbUFQSS5qcy5qcyIsIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlRG9tQVBJLmpzP2U0NzkiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICAqL1xuZnVuY3Rpb24gYXBwbHkoc3R5bGVFbGVtZW50LCBvcHRpb25zLCBvYmopIHtcbiAgdmFyIGNzcyA9IFwiXCI7XG4gIGlmIChvYmouc3VwcG9ydHMpIHtcbiAgICBjc3MgKz0gXCJAc3VwcG9ydHMgKFwiLmNvbmNhdChvYmouc3VwcG9ydHMsIFwiKSB7XCIpO1xuICB9XG4gIGlmIChvYmoubWVkaWEpIHtcbiAgICBjc3MgKz0gXCJAbWVkaWEgXCIuY29uY2F0KG9iai5tZWRpYSwgXCIge1wiKTtcbiAgfVxuICB2YXIgbmVlZExheWVyID0gdHlwZW9mIG9iai5sYXllciAhPT0gXCJ1bmRlZmluZWRcIjtcbiAgaWYgKG5lZWRMYXllcikge1xuICAgIGNzcyArPSBcIkBsYXllclwiLmNvbmNhdChvYmoubGF5ZXIubGVuZ3RoID4gMCA/IFwiIFwiLmNvbmNhdChvYmoubGF5ZXIpIDogXCJcIiwgXCIge1wiKTtcbiAgfVxuICBjc3MgKz0gb2JqLmNzcztcbiAgaWYgKG5lZWRMYXllcikge1xuICAgIGNzcyArPSBcIn1cIjtcbiAgfVxuICBpZiAob2JqLm1lZGlhKSB7XG4gICAgY3NzICs9IFwifVwiO1xuICB9XG4gIGlmIChvYmouc3VwcG9ydHMpIHtcbiAgICBjc3MgKz0gXCJ9XCI7XG4gIH1cbiAgdmFyIHNvdXJjZU1hcCA9IG9iai5zb3VyY2VNYXA7XG4gIGlmIChzb3VyY2VNYXAgJiYgdHlwZW9mIGJ0b2EgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBjc3MgKz0gXCJcXG4vKiMgc291cmNlTWFwcGluZ1VSTD1kYXRhOmFwcGxpY2F0aW9uL2pzb247YmFzZTY0LFwiLmNvbmNhdChidG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShzb3VyY2VNYXApKSkpLCBcIiAqL1wiKTtcbiAgfVxuXG4gIC8vIEZvciBvbGQgSUVcbiAgLyogaXN0YW5idWwgaWdub3JlIGlmICAqL1xuICBvcHRpb25zLnN0eWxlVGFnVHJhbnNmb3JtKGNzcywgc3R5bGVFbGVtZW50LCBvcHRpb25zLm9wdGlvbnMpO1xufVxuZnVuY3Rpb24gcmVtb3ZlU3R5bGVFbGVtZW50KHN0eWxlRWxlbWVudCkge1xuICAvLyBpc3RhbmJ1bCBpZ25vcmUgaWZcbiAgaWYgKHN0eWxlRWxlbWVudC5wYXJlbnROb2RlID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHN0eWxlRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0eWxlRWxlbWVudCk7XG59XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICAqL1xuZnVuY3Rpb24gZG9tQVBJKG9wdGlvbnMpIHtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybiB7XG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSgpIHt9LFxuICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7fVxuICAgIH07XG4gIH1cbiAgdmFyIHN0eWxlRWxlbWVudCA9IG9wdGlvbnMuaW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMpO1xuICByZXR1cm4ge1xuICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKG9iaikge1xuICAgICAgYXBwbHkoc3R5bGVFbGVtZW50LCBvcHRpb25zLCBvYmopO1xuICAgIH0sXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7XG4gICAgICByZW1vdmVTdHlsZUVsZW1lbnQoc3R5bGVFbGVtZW50KTtcbiAgICB9XG4gIH07XG59XG5tb2R1bGUuZXhwb3J0cyA9IGRvbUFQSTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/style-loader/dist/runtime/styleDomAPI.js\n");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/styleTagTransform.js":
/*!*********************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/styleTagTransform.js ***!
  \*********************************************************************/
/***/ ((module) => {

"use strict";
eval("\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZVRhZ1RyYW5zZm9ybS5qcy5qcyIsIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2IxLy4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVUYWdUcmFuc2Zvcm0uanM/MWRkZSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5mdW5jdGlvbiBzdHlsZVRhZ1RyYW5zZm9ybShjc3MsIHN0eWxlRWxlbWVudCkge1xuICBpZiAoc3R5bGVFbGVtZW50LnN0eWxlU2hlZXQpIHtcbiAgICBzdHlsZUVsZW1lbnQuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzO1xuICB9IGVsc2Uge1xuICAgIHdoaWxlIChzdHlsZUVsZW1lbnQuZmlyc3RDaGlsZCkge1xuICAgICAgc3R5bGVFbGVtZW50LnJlbW92ZUNoaWxkKHN0eWxlRWxlbWVudC5maXJzdENoaWxkKTtcbiAgICB9XG4gICAgc3R5bGVFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpO1xuICB9XG59XG5tb2R1bGUuZXhwb3J0cyA9IHN0eWxlVGFnVHJhbnNmb3JtOyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/style-loader/dist/runtime/styleTagTransform.js\n");

/***/ }),

/***/ "./src/blocks.js":
/*!***********************!*\
  !*** ./src/blocks.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"blocks\": () => (/* binding */ blocks)\n/* harmony export */ });\n/* harmony import */ var blockly_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! blockly/core */ \"./node_modules/blockly/core-browser.js\");\n/* harmony import */ var blockly_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(blockly_core__WEBPACK_IMPORTED_MODULE_0__);\n// create custom blockly move forward block and generator stub\n// https://developers.google.com/blockly/guides/create-custom-blocks/define-blocks\n// https://developers.google.com/blockly/guides/create-custom-blocks/define-blocks#blockly_block_definition\n\n\n\n// init = function() {\n// Blockly.Blocks['move_forward'] = {\n//     init: function() {\n//       this.appendDummyInput()\n//           .appendField(\"Move Forward\");\n//       this.setPreviousStatement(true, null);\n//       this.setNextStatement(true, null);\n//       this.setColour(230);\n//       this.setTooltip(\"\");\n//       this.setHelpUrl(\"\");\n//     }\n//   };\n\n  \n//   Blockly.JavaScript['move_forward'] = function(block) {\n//     // Generate JavaScript code for moving character forward one space\n//     var code = 'moveForward(1);\\n';\n//     return code;\n//   };\n// };\nconst moveForward = {\n    'type': 'move_forward',\n    'message0': 'Move Forward',\n    'previousStatement': null,\n    'nextStatement': null,\n    'colour': 230,\n    'tooltip': '',\n    'helpUrl': ''\n    };\nconst blocks = blockly_core__WEBPACK_IMPORTED_MODULE_0__.common.createBlockDefinitionsFromJsonArray(   [moveForward]);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmxvY2tzLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL3NyYy9ibG9ja3MuanM/N2VmYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBjcmVhdGUgY3VzdG9tIGJsb2NrbHkgbW92ZSBmb3J3YXJkIGJsb2NrIGFuZCBnZW5lcmF0b3Igc3R1YlxuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYmxvY2tseS9ndWlkZXMvY3JlYXRlLWN1c3RvbS1ibG9ja3MvZGVmaW5lLWJsb2Nrc1xuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYmxvY2tseS9ndWlkZXMvY3JlYXRlLWN1c3RvbS1ibG9ja3MvZGVmaW5lLWJsb2NrcyNibG9ja2x5X2Jsb2NrX2RlZmluaXRpb25cbmltcG9ydCAqIGFzIEJsb2NrbHkgZnJvbSAnYmxvY2tseS9jb3JlJztcblxuXG4vLyBpbml0ID0gZnVuY3Rpb24oKSB7XG4vLyBCbG9ja2x5LkJsb2Nrc1snbW92ZV9mb3J3YXJkJ10gPSB7XG4vLyAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4vLyAgICAgICB0aGlzLmFwcGVuZER1bW15SW5wdXQoKVxuLy8gICAgICAgICAgIC5hcHBlbmRGaWVsZChcIk1vdmUgRm9yd2FyZFwiKTtcbi8vICAgICAgIHRoaXMuc2V0UHJldmlvdXNTdGF0ZW1lbnQodHJ1ZSwgbnVsbCk7XG4vLyAgICAgICB0aGlzLnNldE5leHRTdGF0ZW1lbnQodHJ1ZSwgbnVsbCk7XG4vLyAgICAgICB0aGlzLnNldENvbG91cigyMzApO1xuLy8gICAgICAgdGhpcy5zZXRUb29sdGlwKFwiXCIpO1xuLy8gICAgICAgdGhpcy5zZXRIZWxwVXJsKFwiXCIpO1xuLy8gICAgIH1cbi8vICAgfTtcblxuICBcbi8vICAgQmxvY2tseS5KYXZhU2NyaXB0Wydtb3ZlX2ZvcndhcmQnXSA9IGZ1bmN0aW9uKGJsb2NrKSB7XG4vLyAgICAgLy8gR2VuZXJhdGUgSmF2YVNjcmlwdCBjb2RlIGZvciBtb3ZpbmcgY2hhcmFjdGVyIGZvcndhcmQgb25lIHNwYWNlXG4vLyAgICAgdmFyIGNvZGUgPSAnbW92ZUZvcndhcmQoMSk7XFxuJztcbi8vICAgICByZXR1cm4gY29kZTtcbi8vICAgfTtcbi8vIH07XG5jb25zdCBtb3ZlRm9yd2FyZCA9IHtcbiAgICAndHlwZSc6ICdtb3ZlX2ZvcndhcmQnLFxuICAgICdtZXNzYWdlMCc6ICdNb3ZlIEZvcndhcmQnLFxuICAgICdwcmV2aW91c1N0YXRlbWVudCc6IG51bGwsXG4gICAgJ25leHRTdGF0ZW1lbnQnOiBudWxsLFxuICAgICdjb2xvdXInOiAyMzAsXG4gICAgJ3Rvb2x0aXAnOiAnJyxcbiAgICAnaGVscFVybCc6ICcnXG4gICAgfTtcbmV4cG9ydCBjb25zdCBibG9ja3MgPSBCbG9ja2x5LmNvbW1vbi5jcmVhdGVCbG9ja0RlZmluaXRpb25zRnJvbUpzb25BcnJheSggICBbbW92ZUZvcndhcmRdKTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/blocks.js\n");

/***/ }),

/***/ "./src/blocks_generator.js":
/*!*********************************!*\
  !*** ./src/blocks_generator.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"generator\": () => (/* binding */ generator)\n/* harmony export */ });\n/* harmony import */ var blockly_javascript__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! blockly/javascript */ \"./node_modules/blockly/javascript.js\");\n/* harmony import */ var blockly_javascript__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(blockly_javascript__WEBPACK_IMPORTED_MODULE_0__);\n\n\nconst generator = Object.create(null);\ngenerator['move_forward'] = function(block) {\n    const moveForward = blockly_javascript__WEBPACK_IMPORTED_MODULE_0__.javascriptGenerator.provideFunction_(\n        'moveForward',\n        ['function ' + blockly_javascript__WEBPACK_IMPORTED_MODULE_0__.javascriptGenerator.FUNCTION_NAME_PLACEHOLDER_ +\n            '(dist) {',\n        '  // Move the sprite forward.',\n        '  current_state[\\'x\\'] += dist;',\n        '}']);\n    // Generate the function call for this block.\n    const code = `${moveForward}(1);\\n`;\n    return code;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvYmxvY2tzX2dlbmVyYXRvci5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYjEvLi9zcmMvYmxvY2tzX2dlbmVyYXRvci5qcz81Y2UwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGphdmFzY3JpcHRHZW5lcmF0b3IgfSAgZnJvbSBcImJsb2NrbHkvamF2YXNjcmlwdFwiO1xuXG5leHBvcnQgY29uc3QgZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbmdlbmVyYXRvclsnbW92ZV9mb3J3YXJkJ10gPSBmdW5jdGlvbihibG9jaykge1xuICAgIGNvbnN0IG1vdmVGb3J3YXJkID0gamF2YXNjcmlwdEdlbmVyYXRvci5wcm92aWRlRnVuY3Rpb25fKFxuICAgICAgICAnbW92ZUZvcndhcmQnLFxuICAgICAgICBbJ2Z1bmN0aW9uICcgKyBqYXZhc2NyaXB0R2VuZXJhdG9yLkZVTkNUSU9OX05BTUVfUExBQ0VIT0xERVJfICtcbiAgICAgICAgICAgICcoZGlzdCkgeycsXG4gICAgICAgICcgIC8vIE1vdmUgdGhlIHNwcml0ZSBmb3J3YXJkLicsXG4gICAgICAgICcgIGN1cnJlbnRfc3RhdGVbXFwneFxcJ10gKz0gZGlzdDsnLFxuICAgICAgICAnfSddKTtcbiAgICAvLyBHZW5lcmF0ZSB0aGUgZnVuY3Rpb24gY2FsbCBmb3IgdGhpcyBibG9jay5cbiAgICBjb25zdCBjb2RlID0gYCR7bW92ZUZvcndhcmR9KDEpO1xcbmA7XG4gICAgcmV0dXJuIGNvZGU7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/blocks_generator.js\n");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var blockly_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! blockly/core */ \"./node_modules/blockly/core-browser.js\");\n/* harmony import */ var blockly_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(blockly_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _blocks_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./blocks.js */ \"./src/blocks.js\");\n/* harmony import */ var _blocks_generator_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./blocks_generator.js */ \"./src/blocks_generator.js\");\n/* harmony import */ var _toolbox_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./toolbox.js */ \"./src/toolbox.js\");\n/* harmony import */ var _index_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./index.css */ \"./src/index.css\");\n//create a blockly game that uses the move forward custom block I defined in blocks.js to move a custom sprite image forward two spaces to a custom goal image on the goal state. Use a grid to display. Execute the users code to see if it works. If it does, then the user has won the game. If not, then the user has lost the game. The user can try again.\n// Create a 5x5 grid\n\n\n\n\n\n\n// Register the blocks and generator with Blockly\nblockly_core__WEBPACK_IMPORTED_MODULE_0__.common.defineBlocks(_blocks_js__WEBPACK_IMPORTED_MODULE_1__.blocks);\nObject.assign(javascriptGenerator, _blocks_generator_js__WEBPACK_IMPORTED_MODULE_2__.generator);\n\n\nconst ROWS = 5;\nconst COLS = 5;\nconst CELL_SIZE = 50;\n//const canvas = document.getElementById('canvas');\n//const ctx = canvas.getContext('2d');\n//canvas.width = COLS * CELL_SIZE;\n//canvas.height = ROWS * CELL_SIZE;\n//const codeDiv = document.getElementById('generatedCode').firstChild;\n//const outputDiv = document.getElementById('output');\nvar svgMaze = document.getElementById('svgMaze');\nconst blocklyDiv = document.getElementById('blocklyDiv');\nconst ws = blockly_core__WEBPACK_IMPORTED_MODULE_0__.inject(blocklyDiv, {toolbox: _toolbox_js__WEBPACK_IMPORTED_MODULE_3__.toolbox});\n\n/*function drawGrid() {\n  for (let i = 0; i <= canvas.width; i += CELL_SIZE) {\n    ctx.moveTo(i, 0);\n    ctx.lineTo(i, canvas.height);\n  }\n  for (let i = 0; i <= canvas.height; i += CELL_SIZE) {\n    ctx.moveTo(0, i);\n    ctx.lineTo(canvas.width, i);\n  }\n  ctx.strokeStyle = 'lightgray';\n  ctx.stroke();\n}*/\nfunction drawMap(){\n  svgMaze.setAttribute(\"width\", COLS * CELL_SIZE);\n  svgMaze.setAttribute(\"height\", ROWS * CELL_SIZE);\n  for (let i = 0; i <= svgMaze.height; i += CELL_SIZE) {\n    for (let j = 0; j <= svgMaze.width; j += CELL_SIZE) {\n      var rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n      rect.setAttribute(\"x\", j);\n      rect.setAttribute(\"y\", i);\n      rect.setAttribute(\"width\", CELL_SIZE);\n      rect.setAttribute(\"height\", CELL_SIZE);\n      rect.setAttribute(\"fill\", \"lightgray\");\n      svgMaze.appendChild(rect);\n      if (i==0 || j==0 || i==4 || j==4){\n        rect.setAttribute(\"fill\", \"black\");\n      }else if (i==1 && j==1){\n        var image = document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n        image.setAttribute(\"x\", j);\n        image.setAttribute(\"y\", i);\n        image.setAttribute(\"width\", CELL_SIZE);\n        image.setAttribute(\"height\", CELL_SIZE);\n        image.setAttribute(\"href\", \"coding4therpy/c4t/images/blue.png\");\n\n      }else if (i==1 && j==3){\n        var image = document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n        image.setAttribute(\"x\", j);\n        image.setAttribute(\"y\", i);\n        image.setAttribute(\"width\", CELL_SIZE);\n        image.setAttribute(\"height\", CELL_SIZE);\n        image.setAttribute(\"href\", \"coding4therpy/c4t/images/bus.png\");\n      }\n    }\n  } \n}\n\n// Load sprite and goal image on the grid\n/*const spriteImage = new Image();\nspriteImage.src = 'coding4therpy/c4t/images/blue.png';\nconst goalImage = new Image();\ngoalImage.src = 'coding4therpy/c4t/images/bus.png';\n\nfunction loadImage(image, x, y) {\n  image.onload = function() {\n    ctx.drawImage(image, x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);\n  }\n}*/\n\n// Set start and goal states\nconst START_STATE = { x: 1, y: 1 };\nconst GOAL_STATE = { x: 3, y: 1 };\nvar current_state = START_STATE;\n\n// Draw grid and load sprite and goal image\n/*drawGrid();\nloadImage(spriteImage, START_STATE.x, START_STATE.y);\nloadImage(goalImage, GOAL_STATE.x, GOAL_STATE.y);*/\ndrawMap();\n\n//create a tool box with the move forward block in it\n// https://developers.google.com/blockly/guides/create-custom-blocks/toolbox\n// https://developers.google.com/blockly/guides/create-custom-blocks/toolbox#blockly_toolbox_definition\n\n\n//create a workspace with the tool box in it\n// https://developers.google.com/blockly/guides/create-custom-blocks/toolbox#blockly_toolbox_definition\n\n\n// log and execute the users code. if the users code moves the sprite to the goal state, then the user has won the game. if not, then the user has lost the game. the user can try again.\n\n// https://developers.google.com/blockly/guides/create-custom-blocks/generator\n// https://developers.google.com/blockly/guides/create-custom-blocks/generator#blockly_generator_definition\nconst codeGenerator = new JavaScriptGenerator();\nconst runButton = document.getElementById('runButton');\nrunButton.addEventListener('click', () => {\n\n\n    const code = codeGenerator.workspaceToCode(ws);\n    codeDiv.innerText = code;\n\n    outputDiv.innerHTML = '';\n\n    eval(code);\n});\n\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXguanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL3NyYy9pbmRleC5qcz9iNjM1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vY3JlYXRlIGEgYmxvY2tseSBnYW1lIHRoYXQgdXNlcyB0aGUgbW92ZSBmb3J3YXJkIGN1c3RvbSBibG9jayBJIGRlZmluZWQgaW4gYmxvY2tzLmpzIHRvIG1vdmUgYSBjdXN0b20gc3ByaXRlIGltYWdlIGZvcndhcmQgdHdvIHNwYWNlcyB0byBhIGN1c3RvbSBnb2FsIGltYWdlIG9uIHRoZSBnb2FsIHN0YXRlLiBVc2UgYSBncmlkIHRvIGRpc3BsYXkuIEV4ZWN1dGUgdGhlIHVzZXJzIGNvZGUgdG8gc2VlIGlmIGl0IHdvcmtzLiBJZiBpdCBkb2VzLCB0aGVuIHRoZSB1c2VyIGhhcyB3b24gdGhlIGdhbWUuIElmIG5vdCwgdGhlbiB0aGUgdXNlciBoYXMgbG9zdCB0aGUgZ2FtZS4gVGhlIHVzZXIgY2FuIHRyeSBhZ2Fpbi5cbi8vIENyZWF0ZSBhIDV4NSBncmlkXG5pbXBvcnQgKiBhcyBCbG9ja2x5IGZyb20gJ2Jsb2NrbHkvY29yZSc7XG5pbXBvcnQge2Jsb2Nrc30gZnJvbSAnLi9ibG9ja3MuanMnO1xuaW1wb3J0IHtnZW5lcmF0b3J9IGZyb20gJy4vYmxvY2tzX2dlbmVyYXRvci5qcyc7XG5pbXBvcnQge3Rvb2xib3h9IGZyb20gJy4vdG9vbGJveC5qcyc7XG5pbXBvcnQgJy4vaW5kZXguY3NzJztcblxuLy8gUmVnaXN0ZXIgdGhlIGJsb2NrcyBhbmQgZ2VuZXJhdG9yIHdpdGggQmxvY2tseVxuQmxvY2tseS5jb21tb24uZGVmaW5lQmxvY2tzKGJsb2Nrcyk7XG5PYmplY3QuYXNzaWduKGphdmFzY3JpcHRHZW5lcmF0b3IsIGdlbmVyYXRvcik7XG5cblxuY29uc3QgUk9XUyA9IDU7XG5jb25zdCBDT0xTID0gNTtcbmNvbnN0IENFTExfU0laRSA9IDUwO1xuLy9jb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJyk7XG4vL2NvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuLy9jYW52YXMud2lkdGggPSBDT0xTICogQ0VMTF9TSVpFO1xuLy9jYW52YXMuaGVpZ2h0ID0gUk9XUyAqIENFTExfU0laRTtcbi8vY29uc3QgY29kZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZWRDb2RlJykuZmlyc3RDaGlsZDtcbi8vY29uc3Qgb3V0cHV0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ291dHB1dCcpO1xudmFyIHN2Z01hemUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ZnTWF6ZScpO1xuY29uc3QgYmxvY2tseURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibG9ja2x5RGl2Jyk7XG5jb25zdCB3cyA9IEJsb2NrbHkuaW5qZWN0KGJsb2NrbHlEaXYsIHt0b29sYm94fSk7XG5cbi8qZnVuY3Rpb24gZHJhd0dyaWQoKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IGNhbnZhcy53aWR0aDsgaSArPSBDRUxMX1NJWkUpIHtcbiAgICBjdHgubW92ZVRvKGksIDApO1xuICAgIGN0eC5saW5lVG8oaSwgY2FudmFzLmhlaWdodCk7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY2FudmFzLmhlaWdodDsgaSArPSBDRUxMX1NJWkUpIHtcbiAgICBjdHgubW92ZVRvKDAsIGkpO1xuICAgIGN0eC5saW5lVG8oY2FudmFzLndpZHRoLCBpKTtcbiAgfVxuICBjdHguc3Ryb2tlU3R5bGUgPSAnbGlnaHRncmF5JztcbiAgY3R4LnN0cm9rZSgpO1xufSovXG5mdW5jdGlvbiBkcmF3TWFwKCl7XG4gIHN2Z01hemUuc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgQ09MUyAqIENFTExfU0laRSk7XG4gIHN2Z01hemUuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsIFJPV1MgKiBDRUxMX1NJWkUpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8PSBzdmdNYXplLmhlaWdodDsgaSArPSBDRUxMX1NJWkUpIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8PSBzdmdNYXplLndpZHRoOyBqICs9IENFTExfU0laRSkge1xuICAgICAgdmFyIHJlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcInJlY3RcIik7XG4gICAgICByZWN0LnNldEF0dHJpYnV0ZShcInhcIiwgaik7XG4gICAgICByZWN0LnNldEF0dHJpYnV0ZShcInlcIiwgaSk7XG4gICAgICByZWN0LnNldEF0dHJpYnV0ZShcIndpZHRoXCIsIENFTExfU0laRSk7XG4gICAgICByZWN0LnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBDRUxMX1NJWkUpO1xuICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIFwibGlnaHRncmF5XCIpO1xuICAgICAgc3ZnTWF6ZS5hcHBlbmRDaGlsZChyZWN0KTtcbiAgICAgIGlmIChpPT0wIHx8IGo9PTAgfHwgaT09NCB8fCBqPT00KXtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIFwiYmxhY2tcIik7XG4gICAgICB9ZWxzZSBpZiAoaT09MSAmJiBqPT0xKXtcbiAgICAgICAgdmFyIGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJpbWFnZVwiKTtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwieFwiLCBqKTtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwieVwiLCBpKTtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgQ0VMTF9TSVpFKTtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsIENFTExfU0laRSk7XG4gICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgXCJjb2Rpbmc0dGhlcnB5L2M0dC9pbWFnZXMvYmx1ZS5wbmdcIik7XG5cbiAgICAgIH1lbHNlIGlmIChpPT0xICYmIGo9PTMpe1xuICAgICAgICB2YXIgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcImltYWdlXCIpO1xuICAgICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJ4XCIsIGopO1xuICAgICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGkpO1xuICAgICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCBDRUxMX1NJWkUpO1xuICAgICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgQ0VMTF9TSVpFKTtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBcImNvZGluZzR0aGVycHkvYzR0L2ltYWdlcy9idXMucG5nXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfSBcbn1cblxuLy8gTG9hZCBzcHJpdGUgYW5kIGdvYWwgaW1hZ2Ugb24gdGhlIGdyaWRcbi8qY29uc3Qgc3ByaXRlSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbnNwcml0ZUltYWdlLnNyYyA9ICdjb2Rpbmc0dGhlcnB5L2M0dC9pbWFnZXMvYmx1ZS5wbmcnO1xuY29uc3QgZ29hbEltYWdlID0gbmV3IEltYWdlKCk7XG5nb2FsSW1hZ2Uuc3JjID0gJ2NvZGluZzR0aGVycHkvYzR0L2ltYWdlcy9idXMucG5nJztcblxuZnVuY3Rpb24gbG9hZEltYWdlKGltYWdlLCB4LCB5KSB7XG4gIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIHggKiBDRUxMX1NJWkUsIHkgKiBDRUxMX1NJWkUsIENFTExfU0laRSwgQ0VMTF9TSVpFKTtcbiAgfVxufSovXG5cbi8vIFNldCBzdGFydCBhbmQgZ29hbCBzdGF0ZXNcbmNvbnN0IFNUQVJUX1NUQVRFID0geyB4OiAxLCB5OiAxIH07XG5jb25zdCBHT0FMX1NUQVRFID0geyB4OiAzLCB5OiAxIH07XG52YXIgY3VycmVudF9zdGF0ZSA9IFNUQVJUX1NUQVRFO1xuXG4vLyBEcmF3IGdyaWQgYW5kIGxvYWQgc3ByaXRlIGFuZCBnb2FsIGltYWdlXG4vKmRyYXdHcmlkKCk7XG5sb2FkSW1hZ2Uoc3ByaXRlSW1hZ2UsIFNUQVJUX1NUQVRFLngsIFNUQVJUX1NUQVRFLnkpO1xubG9hZEltYWdlKGdvYWxJbWFnZSwgR09BTF9TVEFURS54LCBHT0FMX1NUQVRFLnkpOyovXG5kcmF3TWFwKCk7XG5cbi8vY3JlYXRlIGEgdG9vbCBib3ggd2l0aCB0aGUgbW92ZSBmb3J3YXJkIGJsb2NrIGluIGl0XG4vLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy90b29sYm94XG4vLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy90b29sYm94I2Jsb2NrbHlfdG9vbGJveF9kZWZpbml0aW9uXG5cblxuLy9jcmVhdGUgYSB3b3Jrc3BhY2Ugd2l0aCB0aGUgdG9vbCBib3ggaW4gaXRcbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL3Rvb2xib3gjYmxvY2tseV90b29sYm94X2RlZmluaXRpb25cblxuXG4vLyBsb2cgYW5kIGV4ZWN1dGUgdGhlIHVzZXJzIGNvZGUuIGlmIHRoZSB1c2VycyBjb2RlIG1vdmVzIHRoZSBzcHJpdGUgdG8gdGhlIGdvYWwgc3RhdGUsIHRoZW4gdGhlIHVzZXIgaGFzIHdvbiB0aGUgZ2FtZS4gaWYgbm90LCB0aGVuIHRoZSB1c2VyIGhhcyBsb3N0IHRoZSBnYW1lLiB0aGUgdXNlciBjYW4gdHJ5IGFnYWluLlxuXG4vLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9ibG9ja2x5L2d1aWRlcy9jcmVhdGUtY3VzdG9tLWJsb2Nrcy9nZW5lcmF0b3Jcbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Jsb2NrbHkvZ3VpZGVzL2NyZWF0ZS1jdXN0b20tYmxvY2tzL2dlbmVyYXRvciNibG9ja2x5X2dlbmVyYXRvcl9kZWZpbml0aW9uXG5jb25zdCBjb2RlR2VuZXJhdG9yID0gbmV3IEphdmFTY3JpcHRHZW5lcmF0b3IoKTtcbmNvbnN0IHJ1bkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdydW5CdXR0b24nKTtcbnJ1bkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblxuXG4gICAgY29uc3QgY29kZSA9IGNvZGVHZW5lcmF0b3Iud29ya3NwYWNlVG9Db2RlKHdzKTtcbiAgICBjb2RlRGl2LmlubmVyVGV4dCA9IGNvZGU7XG5cbiAgICBvdXRwdXREaXYuaW5uZXJIVE1MID0gJyc7XG5cbiAgICBldmFsKGNvZGUpO1xufSk7XG5cblxuXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/index.js\n");

/***/ }),

/***/ "./src/toolbox.js":
/*!************************!*\
  !*** ./src/toolbox.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"toolbox\": () => (/* binding */ toolbox)\n/* harmony export */ });\nconst toolbox = {\n    'kind': 'flyoutToolbox',\n    'contents': [\n        {\n            'kind': 'block',\n            'type': 'move_forward'\n        }]\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdG9vbGJveC5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NiMS8uL3NyYy90b29sYm94LmpzP2Y3ZTciXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHRvb2xib3ggPSB7XG4gICAgJ2tpbmQnOiAnZmx5b3V0VG9vbGJveCcsXG4gICAgJ2NvbnRlbnRzJzogW1xuICAgICAgICB7XG4gICAgICAgICAgICAna2luZCc6ICdibG9jaycsXG4gICAgICAgICAgICAndHlwZSc6ICdtb3ZlX2ZvcndhcmQnXG4gICAgICAgIH1dXG59OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/toolbox.js\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/nonce */
/******/ 	(() => {
/******/ 		__webpack_require__.nc = undefined;
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ 	
/******/ })()
;